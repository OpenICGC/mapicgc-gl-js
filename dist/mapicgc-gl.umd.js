(function(BA,Pp){typeof exports=="object"&&typeof module<"u"?Pp(exports):typeof define=="function"&&define.amd?define(["exports"],Pp):(BA=typeof globalThis<"u"?globalThis:BA||self,Pp(BA.mapicgcgl={}))})(this,function(BA){"use strict";function Pp(r,t){for(var e=0;e<t.length;e++){const n=t[e];if(typeof n!="string"&&!Array.isArray(n)){for(const i in n)if(i!=="default"&&!(i in r)){const s=Object.getOwnPropertyDescriptor(n,i);s&&Object.defineProperty(r,i,s.get?s:{enumerable:!0,get:()=>n[i]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}var kd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Mp(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var CS={exports:{}};(function(r,t){(function(e,n){r.exports=n()})(kd,function(){var e={},n={};function i(a,o,A){if(n[a]=A,a==="index"){var f="var sharedModule = {}; ("+n.shared+")(sharedModule); ("+n.worker+")(sharedModule);",m={};return n.shared(m),n.index(e,m),typeof window<"u"&&e.setWorkerUrl(window.URL.createObjectURL(new Blob([f],{type:"text/javascript"}))),e}}i("shared",["exports"],function(a){function o(u,c,h,p){return new(h||(h=Promise))(function(b,S){function I(G){try{O(p.next(G))}catch(K){S(K)}}function F(G){try{O(p.throw(G))}catch(K){S(K)}}function O(G){var K;G.done?b(G.value):(K=G.value,K instanceof h?K:new h(function(X){X(K)})).then(I,F)}O((p=p.apply(u,c||[])).next())})}function A(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}typeof SuppressedError=="function"&&SuppressedError;var f=m;function m(u,c){this.x=u,this.y=c}m.prototype={clone:function(){return new m(this.x,this.y)},add:function(u){return this.clone()._add(u)},sub:function(u){return this.clone()._sub(u)},multByPoint:function(u){return this.clone()._multByPoint(u)},divByPoint:function(u){return this.clone()._divByPoint(u)},mult:function(u){return this.clone()._mult(u)},div:function(u){return this.clone()._div(u)},rotate:function(u){return this.clone()._rotate(u)},rotateAround:function(u,c){return this.clone()._rotateAround(u,c)},matMult:function(u){return this.clone()._matMult(u)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(u){return this.x===u.x&&this.y===u.y},dist:function(u){return Math.sqrt(this.distSqr(u))},distSqr:function(u){var c=u.x-this.x,h=u.y-this.y;return c*c+h*h},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(u){return Math.atan2(this.y-u.y,this.x-u.x)},angleWith:function(u){return this.angleWithSep(u.x,u.y)},angleWithSep:function(u,c){return Math.atan2(this.x*c-this.y*u,this.x*u+this.y*c)},_matMult:function(u){var c=u[2]*this.x+u[3]*this.y;return this.x=u[0]*this.x+u[1]*this.y,this.y=c,this},_add:function(u){return this.x+=u.x,this.y+=u.y,this},_sub:function(u){return this.x-=u.x,this.y-=u.y,this},_mult:function(u){return this.x*=u,this.y*=u,this},_div:function(u){return this.x/=u,this.y/=u,this},_multByPoint:function(u){return this.x*=u.x,this.y*=u.y,this},_divByPoint:function(u){return this.x/=u.x,this.y/=u.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var u=this.y;return this.y=this.x,this.x=-u,this},_rotate:function(u){var c=Math.cos(u),h=Math.sin(u),p=h*this.x+c*this.y;return this.x=c*this.x-h*this.y,this.y=p,this},_rotateAround:function(u,c){var h=Math.cos(u),p=Math.sin(u),b=c.y+p*(this.x-c.x)+h*(this.y-c.y);return this.x=c.x+h*(this.x-c.x)-p*(this.y-c.y),this.y=b,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},m.convert=function(u){return u instanceof m?u:Array.isArray(u)?new m(u[0],u[1]):u};var _=A(f),x=B;function B(u,c,h,p){this.cx=3*u,this.bx=3*(h-u)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*c,this.by=3*(p-c)-this.cy,this.ay=1-this.cy-this.by,this.p1x=u,this.p1y=c,this.p2x=h,this.p2y=p}B.prototype={sampleCurveX:function(u){return((this.ax*u+this.bx)*u+this.cx)*u},sampleCurveY:function(u){return((this.ay*u+this.by)*u+this.cy)*u},sampleCurveDerivativeX:function(u){return(3*this.ax*u+2*this.bx)*u+this.cx},solveCurveX:function(u,c){if(c===void 0&&(c=1e-6),u<0)return 0;if(u>1)return 1;for(var h=u,p=0;p<8;p++){var b=this.sampleCurveX(h)-u;if(Math.abs(b)<c)return h;var S=this.sampleCurveDerivativeX(h);if(Math.abs(S)<1e-6)break;h-=b/S}var I=0,F=1;for(h=u,p=0;p<20&&(b=this.sampleCurveX(h),!(Math.abs(b-u)<c));p++)u>b?I=h:F=h,h=.5*(F-I)+I;return h},solve:function(u,c){return this.sampleCurveY(this.solveCurveX(u,c))}};var P=A(x);let M,k;function Q(){return M==null&&(M=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),M}function q(){if(k==null&&(k=!1,Q())){const c=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(c){for(let p=0;p<5*5;p++){const b=4*p;c.fillStyle=`rgb(${b},${b+1},${b+2})`,c.fillRect(p%5,Math.floor(p/5),1,1)}const h=c.getImageData(0,0,5,5).data;for(let p=0;p<5*5*4;p++)if(p%4!=3&&h[p]!==p){k=!0;break}}}return k||!1}function J(u,c,h,p){const b=new P(u,c,h,p);return function(S){return b.solve(S)}}const tt=J(.25,.1,.25,1);function ft(u,c,h){return Math.min(h,Math.max(c,u))}function pt(u,c,h){const p=h-c,b=((u-c)%p+p)%p+c;return b===c?h:b}function mt(u){for(var c=arguments.length,h=new Array(c>1?c-1:0),p=1;p<c;p++)h[p-1]=arguments[p];for(const b of h)for(const S in b)u[S]=b[S];return u}let dt=1;function Rt(u,c,h){const p={};for(const b in u)p[b]=c.call(h||this,u[b],b,u);return p}function Lt(u,c,h){const p={};for(const b in u)c.call(h||this,u[b],b,u)&&(p[b]=u[b]);return p}function st(u){return Array.isArray(u)?u.map(st):typeof u=="object"&&u?Rt(u,st):u}const ct={};function wt(u){ct[u]||(typeof console<"u"&&console.warn(u),ct[u]=!0)}function yt(u,c,h){return(h.y-u.y)*(c.x-u.x)>(c.y-u.y)*(h.x-u.x)}function te(u){let c=0;for(let h,p,b=0,S=u.length,I=S-1;b<S;I=b++)h=u[b],p=u[I],c+=(p.x-h.x)*(h.y+p.y);return c}function Zt(u){return typeof WorkerGlobalScope<"u"&&u!==void 0&&u instanceof WorkerGlobalScope}let re=null;function Xt(u){return typeof ImageBitmap<"u"&&u instanceof ImageBitmap}const ne="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function se(u,c,h,p,b){return o(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const S=new VideoFrame(u,{timestamp:0});try{const I=S==null?void 0:S.format;if(!I||!I.startsWith("BGR")&&!I.startsWith("RGB"))throw new Error(`Unrecognized format ${I}`);const F=I.startsWith("BGR"),O=new Uint8ClampedArray(p*b*4);if(yield S.copyTo(O,function(G,K,X,nt,at){const ut=4*Math.max(-K,0),Bt=(Math.max(0,X)-X)*nt*4+ut,It=4*nt,Nt=Math.max(0,K),ee=Math.max(0,X);return{rect:{x:Nt,y:ee,width:Math.min(G.width,K+nt)-Nt,height:Math.min(G.height,X+at)-ee},layout:[{offset:Bt,stride:It}]}}(u,c,h,p,b)),F)for(let G=0;G<O.length;G+=4){const K=O[G];O[G]=O[G+2],O[G+2]=K}return O}finally{S.close()}})}let we,it;const vt="AbortError";function Ft(){return new Error(vt)}const Ot={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function $t(u){return Ot.REGISTERED_PROTOCOLS[u.substring(0,u.indexOf("://"))]}const jt="global-dispatcher";class ae extends Error{constructor(c,h,p,b){super(`AJAXError: ${h} (${c}): ${p}`),this.status=c,this.statusText=h,this.url=p,this.body=b}}const ie=()=>Zt(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Be=function(u,c){if(/:\/\//.test(u.url)&&!/^https?:|^file:/.test(u.url)){const p=$t(u.url);if(p)return p(u,c);if(Zt(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:u,targetMapId:jt},c)}if(!(/^file:/.test(h=u.url)||/^file:/.test(ie())&&!/^\w+:/.test(h))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(p,b){return o(this,void 0,void 0,function*(){const S=new Request(p.url,{method:p.method||"GET",body:p.body,credentials:p.credentials,headers:p.headers,cache:p.cache,referrer:ie(),signal:b.signal});p.type==="json"&&S.headers.set("Accept","application/json");const I=yield fetch(S);if(!I.ok){const G=yield I.blob();throw new ae(I.status,I.statusText,p.url,G)}let F;F=p.type==="arrayBuffer"||p.type==="image"?I.arrayBuffer():p.type==="json"?I.json():I.text();const O=yield F;if(b.signal.aborted)throw Ft();return{data:O,cacheControl:I.headers.get("Cache-Control"),expires:I.headers.get("Expires")}})}(u,c);if(Zt(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:u,mustQueue:!0,targetMapId:jt},c)}var h;return function(p,b){return new Promise((S,I)=>{const F=new XMLHttpRequest;F.open(p.method||"GET",p.url,!0),p.type!=="arrayBuffer"&&p.type!=="image"||(F.responseType="arraybuffer");for(const O in p.headers)F.setRequestHeader(O,p.headers[O]);p.type==="json"&&(F.responseType="text",F.setRequestHeader("Accept","application/json")),F.withCredentials=p.credentials==="include",F.onerror=()=>{I(new Error(F.statusText))},F.onload=()=>{if(!b.signal.aborted)if((F.status>=200&&F.status<300||F.status===0)&&F.response!==null){let O=F.response;if(p.type==="json")try{O=JSON.parse(F.response)}catch(G){return void I(G)}S({data:O,cacheControl:F.getResponseHeader("Cache-Control"),expires:F.getResponseHeader("Expires")})}else{const O=new Blob([F.response],{type:F.getResponseHeader("Content-Type")});I(new ae(F.status,F.statusText,p.url,O))}},b.signal.addEventListener("abort",()=>{F.abort(),I(Ft())}),F.send(p.body)})}(u,c)};function Ie(u){if(!u||u.indexOf("://")<=0||u.indexOf("data:image/")===0||u.indexOf("blob:")===0)return!0;const c=new URL(u),h=window.location;return c.protocol===h.protocol&&c.host===h.host}function Qe(u,c,h){h[u]&&h[u].indexOf(c)!==-1||(h[u]=h[u]||[],h[u].push(c))}function He(u,c,h){if(h&&h[u]){const p=h[u].indexOf(c);p!==-1&&h[u].splice(p,1)}}class ze{constructor(c){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};mt(this,h),this.type=c}}class ge extends ze{constructor(c){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super("error",mt({error:c},h))}}class Ut{on(c,h){return this._listeners=this._listeners||{},Qe(c,h,this._listeners),this}off(c,h){return He(c,h,this._listeners),He(c,h,this._oneTimeListeners),this}once(c,h){return h?(this._oneTimeListeners=this._oneTimeListeners||{},Qe(c,h,this._oneTimeListeners),this):new Promise(p=>this.once(c,p))}fire(c,h){typeof c=="string"&&(c=new ze(c,h||{}));const p=c.type;if(this.listens(p)){c.target=this;const b=this._listeners&&this._listeners[p]?this._listeners[p].slice():[];for(const F of b)F.call(this,c);const S=this._oneTimeListeners&&this._oneTimeListeners[p]?this._oneTimeListeners[p].slice():[];for(const F of S)He(p,F,this._oneTimeListeners),F.call(this,c);const I=this._eventedParent;I&&(mt(c,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),I.fire(c))}else c instanceof ge&&console.error(c.error);return this}listens(c){return this._listeners&&this._listeners[c]&&this._listeners[c].length>0||this._oneTimeListeners&&this._oneTimeListeners[c]&&this._oneTimeListeners[c].length>0||this._eventedParent&&this._eventedParent.listens(c)}setEventedParent(c,h){return this._eventedParent=c,this._eventedParentData=h,this}}var Jt={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const er=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Se(u,c){const h={};for(const p in u)p!=="ref"&&(h[p]=u[p]);return er.forEach(p=>{p in c&&(h[p]=c[p])}),h}function _e(u,c){if(Array.isArray(u)){if(!Array.isArray(c)||u.length!==c.length)return!1;for(let h=0;h<u.length;h++)if(!_e(u[h],c[h]))return!1;return!0}if(typeof u=="object"&&u!==null&&c!==null){if(typeof c!="object"||Object.keys(u).length!==Object.keys(c).length)return!1;for(const h in u)if(!_e(u[h],c[h]))return!1;return!0}return u===c}function xe(u,c){u.push(c)}function Ne(u,c,h){xe(h,{command:"addSource",args:[u,c[u]]})}function ir(u,c,h){xe(c,{command:"removeSource",args:[u]}),h[u]=!0}function Ar(u,c,h,p){ir(u,h,p),Ne(u,c,h)}function Lr(u,c,h){let p;for(p in u[h])if(Object.prototype.hasOwnProperty.call(u[h],p)&&p!=="data"&&!_e(u[h][p],c[h][p]))return!1;for(p in c[h])if(Object.prototype.hasOwnProperty.call(c[h],p)&&p!=="data"&&!_e(u[h][p],c[h][p]))return!1;return!0}function Tr(u,c,h,p,b,S){u=u||{},c=c||{};for(const I in u)Object.prototype.hasOwnProperty.call(u,I)&&(_e(u[I],c[I])||h.push({command:S,args:[p,I,c[I],b]}));for(const I in c)Object.prototype.hasOwnProperty.call(c,I)&&!Object.prototype.hasOwnProperty.call(u,I)&&(_e(u[I],c[I])||h.push({command:S,args:[p,I,c[I],b]}))}function Nr(u){return u.id}function Qr(u,c){return u[c.id]=c,u}class fe{constructor(c,h,p,b){this.message=(c?`${c}: `:"")+p,b&&(this.identifier=b),h!=null&&h.__line__&&(this.line=h.__line__)}}function Ir(u){for(var c=arguments.length,h=new Array(c>1?c-1:0),p=1;p<c;p++)h[p-1]=arguments[p];for(const b of h)for(const S in b)u[S]=b[S];return u}class De extends Error{constructor(c,h){super(h),this.message=h,this.key=c}}class xn{constructor(c){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.parent=c,this.bindings={};for(const[p,b]of h)this.bindings[p]=b}concat(c){return new xn(this,c)}get(c){if(this.bindings[c])return this.bindings[c];if(this.parent)return this.parent.get(c);throw new Error(`${c} not found in scope.`)}has(c){return!!this.bindings[c]||!!this.parent&&this.parent.has(c)}}const Pr={kind:"null"},Te={kind:"number"},Je={kind:"string"},Ke={kind:"boolean"},Yr={kind:"color"},Or={kind:"object"},gr={kind:"value"},an={kind:"collator"},$r={kind:"formatted"},Ct={kind:"padding"},Z={kind:"resolvedImage"},Y={kind:"variableAnchorOffsetCollection"};function ot(u,c){return{kind:"array",itemType:u,N:c}}function Et(u){if(u.kind==="array"){const c=Et(u.itemType);return typeof u.N=="number"?`array<${c}, ${u.N}>`:u.itemType.kind==="value"?"array":`array<${c}>`}return u.kind}const kt=[Pr,Te,Je,Ke,Yr,$r,Or,ot(gr),Ct,Z,Y];function zt(u,c){if(c.kind==="error")return null;if(u.kind==="array"){if(c.kind==="array"&&(c.N===0&&c.itemType.kind==="value"||!zt(u.itemType,c.itemType))&&(typeof u.N!="number"||u.N===c.N))return null}else{if(u.kind===c.kind)return null;if(u.kind==="value"){for(const h of kt)if(!zt(h,c))return null}}return`Expected ${Et(u)} but found ${Et(c)} instead.`}function qt(u,c){return c.some(h=>h.kind===u.kind)}function St(u,c){return c.some(h=>h==="null"?u===null:h==="array"?Array.isArray(u):h==="object"?u&&!Array.isArray(u)&&typeof u=="object":h===typeof u)}function Yt(u,c){return u.kind==="array"&&c.kind==="array"?u.itemType.kind===c.itemType.kind&&typeof u.N=="number":u.kind===c.kind}const me=.96422,pe=.82521,de=4/29,Ve=6/29,Ye=3*Ve*Ve,Er=Ve*Ve*Ve,lr=Math.PI/180,Ur=180/Math.PI;function kr(u){return(u%=360)<0&&(u+=360),u}function Hr(u){let[c,h,p,b]=u,S,I;const F=mr((.2225045*(c=mn(c))+.7168786*(h=mn(h))+.0606169*(p=mn(p)))/1);c===h&&h===p?S=I=F:(S=mr((.4360747*c+.3850649*h+.1430804*p)/me),I=mr((.0139322*c+.0971045*h+.7141733*p)/pe));const O=116*F-16;return[O<0?0:O,500*(S-F),200*(F-I),b]}function mn(u){return u<=.04045?u/12.92:Math.pow((u+.055)/1.055,2.4)}function mr(u){return u>Er?Math.pow(u,1/3):u/Ye+de}function Wr(u){let[c,h,p,b]=u,S=(c+16)/116,I=isNaN(h)?S:S+h/500,F=isNaN(p)?S:S-p/200;return S=1*Qn(S),I=me*Qn(I),F=pe*Qn(F),[bn(3.1338561*I-1.6168667*S-.4906146*F),bn(-.9787684*I+1.9161415*S+.033454*F),bn(.0719453*I-.2289914*S+1.4052427*F),b]}function bn(u){return(u=u<=.00304?12.92*u:1.055*Math.pow(u,1/2.4)-.055)<0?0:u>1?1:u}function Qn(u){return u>Ve?u*u*u:Ye*(u-de)}function Dt(u){return parseInt(u.padEnd(2,u),16)/255}function Re(u,c){return Le(c?u/100:u,0,1)}function Le(u,c,h){return Math.min(Math.max(c,u),h)}function nn(u){return!u.some(Number.isNaN)}const Un={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Br{constructor(c,h,p){let b=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1,S=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0;this.r=c,this.g=h,this.b=p,this.a=b,S||(this.r*=b,this.g*=b,this.b*=b,b||this.overwriteGetter("rgb",[c,h,p,b]))}static parse(c){if(c instanceof Br)return c;if(typeof c!="string")return;const h=function(p){if((p=p.toLowerCase().trim())==="transparent")return[0,0,0,0];const b=Un[p];if(b){const[I,F,O]=b;return[I/255,F/255,O/255,1]}if(p.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(p)){const I=p.length<6?1:2;let F=1;return[Dt(p.slice(F,F+=I)),Dt(p.slice(F,F+=I)),Dt(p.slice(F,F+=I)),Dt(p.slice(F,F+I)||"ff")]}if(p.startsWith("rgb")){const I=p.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(I){const[F,O,G,K,X,nt,at,ut,Bt,It,Nt,ee]=I,Ht=[K||" ",at||" ",It].join("");if(Ht==="  "||Ht==="  /"||Ht===",,"||Ht===",,,"){const Kt=[G,nt,Bt].join(""),ve=Kt==="%%%"?100:Kt===""?255:0;if(ve){const be=[Le(+O/ve,0,1),Le(+X/ve,0,1),Le(+ut/ve,0,1),Nt?Re(+Nt,ee):1];if(nn(be))return be}}return}}const S=p.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(S){const[I,F,O,G,K,X,nt,at,ut]=S,Bt=[O||" ",K||" ",nt].join("");if(Bt==="  "||Bt==="  /"||Bt===",,"||Bt===",,,"){const It=[+F,Le(+G,0,100),Le(+X,0,100),at?Re(+at,ut):1];if(nn(It))return function(Nt){let[ee,Ht,Kt,ve]=Nt;function be(Ze){const hr=(Ze+ee/30)%12,Xe=Ht*Math.min(Kt,1-Kt);return Kt-Xe*Math.max(-1,Math.min(hr-3,9-hr,1))}return ee=kr(ee),Ht/=100,Kt/=100,[be(0),be(8),be(4),ve]}(It)}}}(c);return h?new Br(...h,!1):void 0}get rgb(){const{r:c,g:h,b:p,a:b}=this,S=b||1/0;return this.overwriteGetter("rgb",[c/S,h/S,p/S,b])}get hcl(){return this.overwriteGetter("hcl",function(c){const[h,p,b,S]=Hr(c),I=Math.sqrt(p*p+b*b);return[Math.round(1e4*I)?kr(Math.atan2(b,p)*Ur):NaN,I,h,S]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Hr(this.rgb))}overwriteGetter(c,h){return Object.defineProperty(this,c,{value:h}),h}toString(){const[c,h,p,b]=this.rgb;return`rgba(${[c,h,p].map(S=>Math.round(255*S)).join(",")},${b})`}}Br.black=new Br(0,0,0,1),Br.white=new Br(1,1,1,1),Br.transparent=new Br(0,0,0,0),Br.red=new Br(1,0,0,1);class yn{constructor(c,h,p){this.sensitivity=c?h?"variant":"case":h?"accent":"base",this.locale=p,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(c,h){return this.collator.compare(c,h)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class xi{constructor(c,h,p,b,S){this.text=c,this.image=h,this.scale=p,this.fontStack=b,this.textColor=S}}class _n{constructor(c){this.sections=c}static fromString(c){return new _n([new xi(c,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(c=>c.text.length!==0||c.image&&c.image.name.length!==0)}static factory(c){return c instanceof _n?c:_n.fromString(c)}toString(){return this.sections.length===0?"":this.sections.map(c=>c.text).join("")}}class sn{constructor(c){this.values=c.slice()}static parse(c){if(c instanceof sn)return c;if(typeof c=="number")return new sn([c,c,c,c]);if(Array.isArray(c)&&!(c.length<1||c.length>4)){for(const h of c)if(typeof h!="number")return;switch(c.length){case 1:c=[c[0],c[0],c[0],c[0]];break;case 2:c=[c[0],c[1],c[0],c[1]];break;case 3:c=[c[0],c[1],c[2],c[1]]}return new sn(c)}}toString(){return JSON.stringify(this.values)}}const Bi=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Yn{constructor(c){this.values=c.slice()}static parse(c){if(c instanceof Yn)return c;if(Array.isArray(c)&&!(c.length<1)&&c.length%2==0){for(let h=0;h<c.length;h+=2){const p=c[h],b=c[h+1];if(typeof p!="string"||!Bi.has(p)||!Array.isArray(b)||b.length!==2||typeof b[0]!="number"||typeof b[1]!="number")return}return new Yn(c)}}toString(){return JSON.stringify(this.values)}}class cs{constructor(c){this.name=c.name,this.available=c.available}toString(){return this.name}static fromString(c){return c?new cs({name:c,available:!1}):null}}function Ns(u,c,h,p){return typeof u=="number"&&u>=0&&u<=255&&typeof c=="number"&&c>=0&&c<=255&&typeof h=="number"&&h>=0&&h<=255?p===void 0||typeof p=="number"&&p>=0&&p<=1?null:`Invalid rgba value [${[u,c,h,p].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof p=="number"?[u,c,h,p]:[u,c,h]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Vo(u){if(u===null||typeof u=="string"||typeof u=="boolean"||typeof u=="number"||u instanceof Br||u instanceof yn||u instanceof _n||u instanceof sn||u instanceof Yn||u instanceof cs)return!0;if(Array.isArray(u)){for(const c of u)if(!Vo(c))return!1;return!0}if(typeof u=="object"){for(const c in u)if(!Vo(u[c]))return!1;return!0}return!1}function Dr(u){if(u===null)return Pr;if(typeof u=="string")return Je;if(typeof u=="boolean")return Ke;if(typeof u=="number")return Te;if(u instanceof Br)return Yr;if(u instanceof yn)return an;if(u instanceof _n)return $r;if(u instanceof sn)return Ct;if(u instanceof Yn)return Y;if(u instanceof cs)return Z;if(Array.isArray(u)){const c=u.length;let h;for(const p of u){const b=Dr(p);if(h){if(h===b)continue;h=gr;break}h=b}return ot(h||gr,c)}return Or}function Zs(u){const c=typeof u;return u===null?"":c==="string"||c==="number"||c==="boolean"?String(u):u instanceof Br||u instanceof _n||u instanceof sn||u instanceof Yn||u instanceof cs?u.toString():JSON.stringify(u)}class Ss{constructor(c,h){this.type=c,this.value=h}static parse(c,h){if(c.length!==2)return h.error(`'literal' expression requires exactly one argument, but found ${c.length-1} instead.`);if(!Vo(c[1]))return h.error("invalid value");const p=c[1];let b=Dr(p);const S=h.expectedType;return b.kind!=="array"||b.N!==0||!S||S.kind!=="array"||typeof S.N=="number"&&S.N!==0||(b=S),new Ss(b,p)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class In{constructor(c){this.name="ExpressionEvaluationError",this.message=c}toJSON(){return this.message}}const wo={string:Je,number:Te,boolean:Ke,object:Or};class Mi{constructor(c,h){this.type=c,this.args=h}static parse(c,h){if(c.length<2)return h.error("Expected at least one argument.");let p,b=1;const S=c[0];if(S==="array"){let F,O;if(c.length>2){const G=c[1];if(typeof G!="string"||!(G in wo)||G==="object")return h.error('The item type argument of "array" must be one of string, number, boolean',1);F=wo[G],b++}else F=gr;if(c.length>3){if(c[2]!==null&&(typeof c[2]!="number"||c[2]<0||c[2]!==Math.floor(c[2])))return h.error('The length argument to "array" must be a positive integer literal',2);O=c[2],b++}p=ot(F,O)}else{if(!wo[S])throw new Error(`Types doesn't contain name = ${S}`);p=wo[S]}const I=[];for(;b<c.length;b++){const F=h.parse(c[b],b,gr);if(!F)return null;I.push(F)}return new Mi(p,I)}evaluate(c){for(let h=0;h<this.args.length;h++){const p=this.args[h].evaluate(c);if(!zt(this.type,Dr(p)))return p;if(h===this.args.length-1)throw new In(`Expected value to be of type ${Et(this.type)}, but found ${Et(Dr(p))} instead.`)}throw new Error}eachChild(c){this.args.forEach(c)}outputDefined(){return this.args.every(c=>c.outputDefined())}}const Ui={"to-boolean":Ke,"to-color":Yr,"to-number":Te,"to-string":Je};class Zn{constructor(c,h){this.type=c,this.args=h}static parse(c,h){if(c.length<2)return h.error("Expected at least one argument.");const p=c[0];if(!Ui[p])throw new Error(`Can't parse ${p} as it is not part of the known types`);if((p==="to-boolean"||p==="to-string")&&c.length!==2)return h.error("Expected one argument.");const b=Ui[p],S=[];for(let I=1;I<c.length;I++){const F=h.parse(c[I],I,gr);if(!F)return null;S.push(F)}return new Zn(b,S)}evaluate(c){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(c);case"color":{let h,p;for(const b of this.args){if(h=b.evaluate(c),p=null,h instanceof Br)return h;if(typeof h=="string"){const S=c.parseColor(h);if(S)return S}else if(Array.isArray(h)&&(p=h.length<3||h.length>4?`Invalid rbga value ${JSON.stringify(h)}: expected an array containing either three or four numeric values.`:Ns(h[0],h[1],h[2],h[3]),!p))return new Br(h[0]/255,h[1]/255,h[2]/255,h[3])}throw new In(p||`Could not parse color from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}case"padding":{let h;for(const p of this.args){h=p.evaluate(c);const b=sn.parse(h);if(b)return b}throw new In(`Could not parse padding from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}case"variableAnchorOffsetCollection":{let h;for(const p of this.args){h=p.evaluate(c);const b=Yn.parse(h);if(b)return b}throw new In(`Could not parse variableAnchorOffsetCollection from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}case"number":{let h=null;for(const p of this.args){if(h=p.evaluate(c),h===null)return 0;const b=Number(h);if(!isNaN(b))return b}throw new In(`Could not convert ${JSON.stringify(h)} to number.`)}case"formatted":return _n.fromString(Zs(this.args[0].evaluate(c)));case"resolvedImage":return cs.fromString(Zs(this.args[0].evaluate(c)));default:return Zs(this.args[0].evaluate(c))}}eachChild(c){this.args.forEach(c)}outputDefined(){return this.args.every(c=>c.outputDefined())}}const Li=["Unknown","Point","LineString","Polygon"];class cn{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Li[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(c){let h=this._parseColorCache[c];return h||(h=this._parseColorCache[c]=Br.parse(c)),h}}class jo{constructor(c,h){let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],b=arguments.length>3?arguments[3]:void 0,S=arguments.length>4&&arguments[4]!==void 0?arguments[4]:new xn,I=arguments.length>5&&arguments[5]!==void 0?arguments[5]:[];this.registry=c,this.path=p,this.key=p.map(F=>`[${F}]`).join(""),this.scope=S,this.errors=I,this.expectedType=b,this._isConstant=h}parse(c,h,p,b){let S=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};return h?this.concat(h,p,b)._parse(c,S):this._parse(c,S)}_parse(c,h){function p(b,S,I){return I==="assert"?new Mi(S,[b]):I==="coerce"?new Zn(S,[b]):b}if(c!==null&&typeof c!="string"&&typeof c!="boolean"&&typeof c!="number"||(c=["literal",c]),Array.isArray(c)){if(c.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const b=c[0];if(typeof b!="string")return this.error(`Expression name must be a string, but found ${typeof b} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const S=this.registry[b];if(S){let I=S.parse(c,this);if(!I)return null;if(this.expectedType){const F=this.expectedType,O=I.type;if(F.kind!=="string"&&F.kind!=="number"&&F.kind!=="boolean"&&F.kind!=="object"&&F.kind!=="array"||O.kind!=="value")if(F.kind!=="color"&&F.kind!=="formatted"&&F.kind!=="resolvedImage"||O.kind!=="value"&&O.kind!=="string")if(F.kind!=="padding"||O.kind!=="value"&&O.kind!=="number"&&O.kind!=="array")if(F.kind!=="variableAnchorOffsetCollection"||O.kind!=="value"&&O.kind!=="array"){if(this.checkSubtype(F,O))return null}else I=p(I,F,h.typeAnnotation||"coerce");else I=p(I,F,h.typeAnnotation||"coerce");else I=p(I,F,h.typeAnnotation||"coerce");else I=p(I,F,h.typeAnnotation||"assert")}if(!(I instanceof Ss)&&I.type.kind!=="resolvedImage"&&this._isConstant(I)){const F=new cn;try{I=new Ss(I.type,I.evaluate(F))}catch(O){return this.error(O.message),null}}return I}return this.error(`Unknown expression "${b}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(c===void 0?"'undefined' value invalid. Use null instead.":typeof c=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof c} instead.`)}concat(c,h,p){const b=typeof c=="number"?this.path.concat(c):this.path,S=p?this.scope.concat(p):this.scope;return new jo(this.registry,this._isConstant,b,h||null,S,this.errors)}error(c){for(var h=arguments.length,p=new Array(h>1?h-1:0),b=1;b<h;b++)p[b-1]=arguments[b];const S=`${this.key}${p.map(I=>`[${I}]`).join("")}`;this.errors.push(new De(S,c))}checkSubtype(c,h){const p=zt(c,h);return p&&this.error(p),p}}class qo{constructor(c,h,p){this.type=an,this.locale=p,this.caseSensitive=c,this.diacriticSensitive=h}static parse(c,h){if(c.length!==2)return h.error("Expected one argument.");const p=c[1];if(typeof p!="object"||Array.isArray(p))return h.error("Collator options argument must be an object.");const b=h.parse(p["case-sensitive"]!==void 0&&p["case-sensitive"],1,Ke);if(!b)return null;const S=h.parse(p["diacritic-sensitive"]!==void 0&&p["diacritic-sensitive"],1,Ke);if(!S)return null;let I=null;return p.locale&&(I=h.parse(p.locale,1,Je),!I)?null:new qo(b,S,I)}evaluate(c){return new yn(this.caseSensitive.evaluate(c),this.diacriticSensitive.evaluate(c),this.locale?this.locale.evaluate(c):null)}eachChild(c){c(this.caseSensitive),c(this.diacriticSensitive),this.locale&&c(this.locale)}outputDefined(){return!1}}const to=8192;function mc(u,c){u[0]=Math.min(u[0],c[0]),u[1]=Math.min(u[1],c[1]),u[2]=Math.max(u[2],c[0]),u[3]=Math.max(u[3],c[1])}function At(u,c){return!(u[0]<=c[0]||u[2]>=c[2]||u[1]<=c[1]||u[3]>=c[3])}function xt(u,c){const h=(180+u[0])/360,p=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+u[1]*Math.PI/360)))/360,b=Math.pow(2,c.z);return[Math.round(h*b*to),Math.round(p*b*to)]}function Qt(u,c,h){const p=u[0]-c[0],b=u[1]-c[1],S=u[0]-h[0],I=u[1]-h[1];return p*I-S*b==0&&p*S<=0&&b*I<=0}function he(u,c){let h=!1;for(let I=0,F=c.length;I<F;I++){const O=c[I];for(let G=0,K=O.length;G<K-1;G++){if(Qt(u,O[G],O[G+1]))return!1;(b=O[G])[1]>(p=u)[1]!=(S=O[G+1])[1]>p[1]&&p[0]<(S[0]-b[0])*(p[1]-b[1])/(S[1]-b[1])+b[0]&&(h=!h)}}var p,b,S;return h}function Pe(u,c){for(let h=0;h<c.length;h++)if(he(u,c[h]))return!0;return!1}function sr(u,c,h,p){const b=p[0]-h[0],S=p[1]-h[1],I=(u[0]-h[0])*S-b*(u[1]-h[1]),F=(c[0]-h[0])*S-b*(c[1]-h[1]);return I>0&&F<0||I<0&&F>0}function zr(u,c,h){for(const G of h)for(let K=0;K<G.length-1;++K)if((F=[(I=G[K+1])[0]-(S=G[K])[0],I[1]-S[1]])[0]*(O=[(b=c)[0]-(p=u)[0],b[1]-p[1]])[1]-F[1]*O[0]!=0&&sr(p,b,S,I)&&sr(S,I,p,b))return!0;var p,b,S,I,F,O;return!1}function Wn(u,c){for(let h=0;h<u.length;++h)if(!he(u[h],c))return!1;for(let h=0;h<u.length-1;++h)if(zr(u[h],u[h+1],c))return!1;return!0}function ti(u,c){for(let h=0;h<c.length;h++)if(Wn(u,c[h]))return!0;return!1}function Ai(u,c,h){const p=[];for(let b=0;b<u.length;b++){const S=[];for(let I=0;I<u[b].length;I++){const F=xt(u[b][I],h);mc(c,F),S.push(F)}p.push(S)}return p}function Hn(u,c,h){const p=[];for(let b=0;b<u.length;b++){const S=Ai(u[b],c,h);p.push(S)}return p}function ah(u,c,h,p){if(u[0]<h[0]||u[0]>h[2]){const b=.5*p;let S=u[0]-h[0]>b?-p:h[0]-u[0]>b?p:0;S===0&&(S=u[0]-h[2]>b?-p:h[2]-u[0]>b?p:0),u[0]+=S}mc(c,u)}function ul(u,c,h,p){const b=Math.pow(2,p.z)*to,S=[p.x*to,p.y*to],I=[];for(const F of u)for(const O of F){const G=[O.x+S[0],O.y+S[1]];ah(G,c,h,b),I.push(G)}return I}function Vr(u,c,h,p){const b=Math.pow(2,p.z)*to,S=[p.x*to,p.y*to],I=[];for(const O of u){const G=[];for(const K of O){const X=[K.x+S[0],K.y+S[1]];mc(c,X),G.push(X)}I.push(G)}if(c[2]-c[0]<=b/2){(F=c)[0]=F[1]=1/0,F[2]=F[3]=-1/0;for(const O of I)for(const G of O)ah(G,c,h,b)}var F;return I}class za{constructor(c,h){this.type=Ke,this.geojson=c,this.geometries=h}static parse(c,h){if(c.length!==2)return h.error(`'within' expression requires exactly one argument, but found ${c.length-1} instead.`);if(Vo(c[1])){const p=c[1];if(p.type==="FeatureCollection"){const b=[];for(const S of p.features){const{type:I,coordinates:F}=S.geometry;I==="Polygon"&&b.push(F),I==="MultiPolygon"&&b.push(...F)}if(b.length)return new za(p,{type:"MultiPolygon",coordinates:b})}else if(p.type==="Feature"){const b=p.geometry.type;if(b==="Polygon"||b==="MultiPolygon")return new za(p,p.geometry)}else if(p.type==="Polygon"||p.type==="MultiPolygon")return new za(p,p)}return h.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(c){if(c.geometry()!=null&&c.canonicalID()!=null){if(c.geometryType()==="Point")return function(h,p){const b=[1/0,1/0,-1/0,-1/0],S=[1/0,1/0,-1/0,-1/0],I=h.canonicalID();if(p.type==="Polygon"){const F=Ai(p.coordinates,S,I),O=ul(h.geometry(),b,S,I);if(!At(b,S))return!1;for(const G of O)if(!he(G,F))return!1}if(p.type==="MultiPolygon"){const F=Hn(p.coordinates,S,I),O=ul(h.geometry(),b,S,I);if(!At(b,S))return!1;for(const G of O)if(!Pe(G,F))return!1}return!0}(c,this.geometries);if(c.geometryType()==="LineString")return function(h,p){const b=[1/0,1/0,-1/0,-1/0],S=[1/0,1/0,-1/0,-1/0],I=h.canonicalID();if(p.type==="Polygon"){const F=Ai(p.coordinates,S,I),O=Vr(h.geometry(),b,S,I);if(!At(b,S))return!1;for(const G of O)if(!Wn(G,F))return!1}if(p.type==="MultiPolygon"){const F=Hn(p.coordinates,S,I),O=Vr(h.geometry(),b,S,I);if(!At(b,S))return!1;for(const G of O)if(!ti(G,F))return!1}return!0}(c,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class su{constructor(c,h){this.type=h.type,this.name=c,this.boundExpression=h}static parse(c,h){if(c.length!==2||typeof c[1]!="string")return h.error("'var' expression requires exactly one string literal argument.");const p=c[1];return h.scope.has(p)?new su(p,h.scope.get(p)):h.error(`Unknown variable "${p}". Make sure "${p}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(c){return this.boundExpression.evaluate(c)}eachChild(){}outputDefined(){return!1}}class vi{constructor(c,h,p,b){this.name=c,this.type=h,this._evaluate=p,this.args=b}evaluate(c){return this._evaluate(c,this.args)}eachChild(c){this.args.forEach(c)}outputDefined(){return!1}static parse(c,h){const p=c[0],b=vi.definitions[p];if(!b)return h.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0);const S=Array.isArray(b)?b[0]:b.type,I=Array.isArray(b)?[[b[1],b[2]]]:b.overloads,F=I.filter(G=>{let[K]=G;return!Array.isArray(K)||K.length===c.length-1});let O=null;for(const[G,K]of F){O=new jo(h.registry,yc,h.path,null,h.scope);const X=[];let nt=!1;for(let at=1;at<c.length;at++){const ut=c[at],Bt=Array.isArray(G)?G[at-1]:G.type,It=O.parse(ut,1+X.length,Bt);if(!It){nt=!0;break}X.push(It)}if(!nt)if(Array.isArray(G)&&G.length!==X.length)O.error(`Expected ${G.length} arguments, but found ${X.length} instead.`);else{for(let at=0;at<X.length;at++){const ut=Array.isArray(G)?G[at]:G.type,Bt=X[at];O.concat(at+1).checkSubtype(ut,Bt.type)}if(O.errors.length===0)return new vi(p,S,K,X)}}if(F.length===1)h.errors.push(...O.errors);else{const G=(F.length?F:I).map(X=>{let[nt]=X;return at=nt,Array.isArray(at)?`(${at.map(Et).join(", ")})`:`(${Et(at.type)}...)`;var at}).join(" | "),K=[];for(let X=1;X<c.length;X++){const nt=h.parse(c[X],1+K.length);if(!nt)return null;K.push(Et(nt.type))}h.error(`Expected arguments of type ${G}, but found (${K.join(", ")}) instead.`)}return null}static register(c,h){vi.definitions=h;for(const p in h)c[p]=vi}}function yc(u){if(u instanceof su)return yc(u.boundExpression);if(u instanceof vi&&u.name==="error"||u instanceof qo||u instanceof za)return!1;const c=u instanceof Zn||u instanceof Mi;let h=!0;return u.eachChild(p=>{h=c?h&&yc(p):h&&p instanceof Ss}),!!h&&Al(u)&&Ga(u,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Al(u){if(u instanceof vi&&(u.name==="get"&&u.args.length===1||u.name==="feature-state"||u.name==="has"&&u.args.length===1||u.name==="properties"||u.name==="geometry-type"||u.name==="id"||/^filter-/.test(u.name))||u instanceof za)return!1;let c=!0;return u.eachChild(h=>{c&&!Al(h)&&(c=!1)}),c}function ma(u){if(u instanceof vi&&u.name==="feature-state")return!1;let c=!0;return u.eachChild(h=>{c&&!ma(h)&&(c=!1)}),c}function Ga(u,c){if(u instanceof vi&&c.indexOf(u.name)>=0)return!1;let h=!0;return u.eachChild(p=>{h&&!Ga(p,c)&&(h=!1)}),h}function hl(u,c){const h=u.length-1;let p,b,S=0,I=h,F=0;for(;S<=I;)if(F=Math.floor((S+I)/2),p=u[F],b=u[F+1],p<=c){if(F===h||c<b)return F;S=F+1}else{if(!(p>c))throw new In("Input is not a number.");I=F-1}return 0}class dl{constructor(c,h,p){this.type=c,this.input=h,this.labels=[],this.outputs=[];for(const[b,S]of p)this.labels.push(b),this.outputs.push(S)}static parse(c,h){if(c.length-1<4)return h.error(`Expected at least 4 arguments, but found only ${c.length-1}.`);if((c.length-1)%2!=0)return h.error("Expected an even number of arguments.");const p=h.parse(c[1],1,Te);if(!p)return null;const b=[];let S=null;h.expectedType&&h.expectedType.kind!=="value"&&(S=h.expectedType);for(let I=1;I<c.length;I+=2){const F=I===1?-1/0:c[I],O=c[I+1],G=I,K=I+1;if(typeof F!="number")return h.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',G);if(b.length&&b[b.length-1][0]>=F)return h.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',G);const X=h.parse(O,K,S);if(!X)return null;S=S||X.type,b.push([F,X])}return new dl(S,p,b)}evaluate(c){const h=this.labels,p=this.outputs;if(h.length===1)return p[0].evaluate(c);const b=this.input.evaluate(c);if(b<=h[0])return p[0].evaluate(c);const S=h.length;return b>=h[S-1]?p[S-1].evaluate(c):p[hl(h,b)].evaluate(c)}eachChild(c){c(this.input);for(const h of this.outputs)c(h)}outputDefined(){return this.outputs.every(c=>c.outputDefined())}}function _d(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}var tA=_c;function _c(u,c,h,p){this.cx=3*u,this.bx=3*(h-u)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*c,this.by=3*(p-c)-this.cy,this.ay=1-this.cy-this.by,this.p1x=u,this.p1y=c,this.p2x=h,this.p2y=p}_c.prototype={sampleCurveX:function(u){return((this.ax*u+this.bx)*u+this.cx)*u},sampleCurveY:function(u){return((this.ay*u+this.by)*u+this.cy)*u},sampleCurveDerivativeX:function(u){return(3*this.ax*u+2*this.bx)*u+this.cx},solveCurveX:function(u,c){if(c===void 0&&(c=1e-6),u<0)return 0;if(u>1)return 1;for(var h=u,p=0;p<8;p++){var b=this.sampleCurveX(h)-u;if(Math.abs(b)<c)return h;var S=this.sampleCurveDerivativeX(h);if(Math.abs(S)<1e-6)break;h-=b/S}var I=0,F=1;for(h=u,p=0;p<20&&(b=this.sampleCurveX(h),!(Math.abs(b-u)<c));p++)u>b?I=h:F=h,h=.5*(F-I)+I;return h},solve:function(u,c){return this.sampleCurveY(this.solveCurveX(u,c))}};var vc=_d(tA);function Va(u,c,h){return u+h*(c-u)}function ya(u,c,h){return u.map((p,b)=>Va(p,c[b],h))}const Ri={number:Va,color:function(u,c,h){switch(arguments.length>3&&arguments[3]!==void 0?arguments[3]:"rgb"){case"rgb":{const[b,S,I,F]=ya(u.rgb,c.rgb,h);return new Br(b,S,I,F,!1)}case"hcl":{const[b,S,I,F]=u.hcl,[O,G,K,X]=c.hcl;let nt,at;if(isNaN(b)||isNaN(O))isNaN(b)?isNaN(O)?nt=NaN:(nt=O,I!==1&&I!==0||(at=G)):(nt=b,K!==1&&K!==0||(at=S));else{let ee=O-b;O>b&&ee>180?ee-=360:O<b&&b-O>180&&(ee+=360),nt=b+h*ee}const[ut,Bt,It,Nt]=function(ee){let[Ht,Kt,ve,be]=ee;return Ht=isNaN(Ht)?0:Ht*lr,Wr([ve,Math.cos(Ht)*Kt,Math.sin(Ht)*Kt,be])}([nt,at??Va(S,G,h),Va(I,K,h),Va(F,X,h)]);return new Br(ut,Bt,It,Nt,!1)}case"lab":{const[b,S,I,F]=Wr(ya(u.lab,c.lab,h));return new Br(b,S,I,F,!1)}}},array:ya,padding:function(u,c,h){return new sn(ya(u.values,c.values,h))},variableAnchorOffsetCollection:function(u,c,h){const p=u.values,b=c.values;if(p.length!==b.length)throw new In(`Cannot interpolate values of different length. from: ${u.toString()}, to: ${c.toString()}`);const S=[];for(let I=0;I<p.length;I+=2){if(p[I]!==b[I])throw new In(`Cannot interpolate values containing mismatched anchors. from[${I}]: ${p[I]}, to[${I}]: ${b[I]}`);S.push(p[I]);const[F,O]=p[I+1],[G,K]=b[I+1];S.push([Va(F,G,h),Va(O,K,h)])}return new Yn(S)}};class Ci{constructor(c,h,p,b,S){this.type=c,this.operator=h,this.interpolation=p,this.input=b,this.labels=[],this.outputs=[];for(const[I,F]of S)this.labels.push(I),this.outputs.push(F)}static interpolationFactor(c,h,p,b){let S=0;if(c.name==="exponential")S=ln(h,c.base,p,b);else if(c.name==="linear")S=ln(h,1,p,b);else if(c.name==="cubic-bezier"){const I=c.controlPoints;S=new vc(I[0],I[1],I[2],I[3]).solve(ln(h,1,p,b))}return S}static parse(c,h){let[p,b,S,...I]=c;if(!Array.isArray(b)||b.length===0)return h.error("Expected an interpolation type expression.",1);if(b[0]==="linear")b={name:"linear"};else if(b[0]==="exponential"){const G=b[1];if(typeof G!="number")return h.error("Exponential interpolation requires a numeric base.",1,1);b={name:"exponential",base:G}}else{if(b[0]!=="cubic-bezier")return h.error(`Unknown interpolation type ${String(b[0])}`,1,0);{const G=b.slice(1);if(G.length!==4||G.some(K=>typeof K!="number"||K<0||K>1))return h.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);b={name:"cubic-bezier",controlPoints:G}}}if(c.length-1<4)return h.error(`Expected at least 4 arguments, but found only ${c.length-1}.`);if((c.length-1)%2!=0)return h.error("Expected an even number of arguments.");if(S=h.parse(S,2,Te),!S)return null;const F=[];let O=null;p==="interpolate-hcl"||p==="interpolate-lab"?O=Yr:h.expectedType&&h.expectedType.kind!=="value"&&(O=h.expectedType);for(let G=0;G<I.length;G+=2){const K=I[G],X=I[G+1],nt=G+3,at=G+4;if(typeof K!="number")return h.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',nt);if(F.length&&F[F.length-1][0]>=K)return h.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',nt);const ut=h.parse(X,at,O);if(!ut)return null;O=O||ut.type,F.push([K,ut])}return Yt(O,Te)||Yt(O,Yr)||Yt(O,Ct)||Yt(O,Y)||Yt(O,ot(Te))?new Ci(O,p,b,S,F):h.error(`Type ${Et(O)} is not interpolatable.`)}evaluate(c){const h=this.labels,p=this.outputs;if(h.length===1)return p[0].evaluate(c);const b=this.input.evaluate(c);if(b<=h[0])return p[0].evaluate(c);const S=h.length;if(b>=h[S-1])return p[S-1].evaluate(c);const I=hl(h,b),F=Ci.interpolationFactor(this.interpolation,b,h[I],h[I+1]),O=p[I].evaluate(c),G=p[I+1].evaluate(c);switch(this.operator){case"interpolate":return Ri[this.type.kind](O,G,F);case"interpolate-hcl":return Ri.color(O,G,F,"hcl");case"interpolate-lab":return Ri.color(O,G,F,"lab")}}eachChild(c){c(this.input);for(const h of this.outputs)c(h)}outputDefined(){return this.outputs.every(c=>c.outputDefined())}}function ln(u,c,h,p){const b=p-h,S=u-h;return b===0?0:c===1?S/b:(Math.pow(c,S)-1)/(Math.pow(c,b)-1)}class fl{constructor(c,h){this.type=c,this.args=h}static parse(c,h){if(c.length<2)return h.error("Expectected at least one argument.");let p=null;const b=h.expectedType;b&&b.kind!=="value"&&(p=b);const S=[];for(const F of c.slice(1)){const O=h.parse(F,1+S.length,p,void 0,{typeAnnotation:"omit"});if(!O)return null;p=p||O.type,S.push(O)}if(!p)throw new Error("No output type");const I=b&&S.some(F=>zt(b,F.type));return new fl(I?gr:p,S)}evaluate(c){let h,p=null,b=0;for(const S of this.args)if(b++,p=S.evaluate(c),p&&p instanceof cs&&!p.available&&(h||(h=p.name),p=null,b===this.args.length&&(p=h)),p!==null)break;return p}eachChild(c){this.args.forEach(c)}outputDefined(){return this.args.every(c=>c.outputDefined())}}class pl{constructor(c,h){this.type=h.type,this.bindings=[].concat(c),this.result=h}evaluate(c){return this.result.evaluate(c)}eachChild(c){for(const h of this.bindings)c(h[1]);c(this.result)}static parse(c,h){if(c.length<4)return h.error(`Expected at least 3 arguments, but found ${c.length-1} instead.`);const p=[];for(let S=1;S<c.length-1;S+=2){const I=c[S];if(typeof I!="string")return h.error(`Expected string, but found ${typeof I} instead.`,S);if(/[^a-zA-Z0-9_]/.test(I))return h.error("Variable names must contain only alphanumeric characters or '_'.",S);const F=h.parse(c[S+1],S+1);if(!F)return null;p.push([I,F])}const b=h.parse(c[c.length-1],c.length-1,h.expectedType,p);return b?new pl(p,b):null}outputDefined(){return this.result.outputDefined()}}class ou{constructor(c,h,p){this.type=c,this.index=h,this.input=p}static parse(c,h){if(c.length!==3)return h.error(`Expected 2 arguments, but found ${c.length-1} instead.`);const p=h.parse(c[1],1,Te),b=h.parse(c[2],2,ot(h.expectedType||gr));return p&&b?new ou(b.type.itemType,p,b):null}evaluate(c){const h=this.index.evaluate(c),p=this.input.evaluate(c);if(h<0)throw new In(`Array index out of bounds: ${h} < 0.`);if(h>=p.length)throw new In(`Array index out of bounds: ${h} > ${p.length-1}.`);if(h!==Math.floor(h))throw new In(`Array index must be an integer, but found ${h} instead.`);return p[h]}eachChild(c){c(this.index),c(this.input)}outputDefined(){return!1}}class Ko{constructor(c,h){this.type=Ke,this.needle=c,this.haystack=h}static parse(c,h){if(c.length!==3)return h.error(`Expected 2 arguments, but found ${c.length-1} instead.`);const p=h.parse(c[1],1,gr),b=h.parse(c[2],2,gr);return p&&b?qt(p.type,[Ke,Je,Te,Pr,gr])?new Ko(p,b):h.error(`Expected first argument to be of type boolean, string, number or null, but found ${Et(p.type)} instead`):null}evaluate(c){const h=this.needle.evaluate(c),p=this.haystack.evaluate(c);if(!p)return!1;if(!St(h,["boolean","string","number","null"]))throw new In(`Expected first argument to be of type boolean, string, number or null, but found ${Et(Dr(h))} instead.`);if(!St(p,["string","array"]))throw new In(`Expected second argument to be of type array or string, but found ${Et(Dr(p))} instead.`);return p.indexOf(h)>=0}eachChild(c){c(this.needle),c(this.haystack)}outputDefined(){return!0}}class $o{constructor(c,h,p){this.type=Te,this.needle=c,this.haystack=h,this.fromIndex=p}static parse(c,h){if(c.length<=2||c.length>=5)return h.error(`Expected 3 or 4 arguments, but found ${c.length-1} instead.`);const p=h.parse(c[1],1,gr),b=h.parse(c[2],2,gr);if(!p||!b)return null;if(!qt(p.type,[Ke,Je,Te,Pr,gr]))return h.error(`Expected first argument to be of type boolean, string, number or null, but found ${Et(p.type)} instead`);if(c.length===4){const S=h.parse(c[3],3,Te);return S?new $o(p,b,S):null}return new $o(p,b)}evaluate(c){const h=this.needle.evaluate(c),p=this.haystack.evaluate(c);if(!St(h,["boolean","string","number","null"]))throw new In(`Expected first argument to be of type boolean, string, number or null, but found ${Et(Dr(h))} instead.`);if(!St(p,["string","array"]))throw new In(`Expected second argument to be of type array or string, but found ${Et(Dr(p))} instead.`);if(this.fromIndex){const b=this.fromIndex.evaluate(c);return p.indexOf(h,b)}return p.indexOf(h)}eachChild(c){c(this.needle),c(this.haystack),this.fromIndex&&c(this.fromIndex)}outputDefined(){return!1}}class eA{constructor(c,h,p,b,S,I){this.inputType=c,this.type=h,this.input=p,this.cases=b,this.outputs=S,this.otherwise=I}static parse(c,h){if(c.length<5)return h.error(`Expected at least 4 arguments, but found only ${c.length-1}.`);if(c.length%2!=1)return h.error("Expected an even number of arguments.");let p,b;h.expectedType&&h.expectedType.kind!=="value"&&(b=h.expectedType);const S={},I=[];for(let G=2;G<c.length-1;G+=2){let K=c[G];const X=c[G+1];Array.isArray(K)||(K=[K]);const nt=h.concat(G);if(K.length===0)return nt.error("Expected at least one branch label.");for(const ut of K){if(typeof ut!="number"&&typeof ut!="string")return nt.error("Branch labels must be numbers or strings.");if(typeof ut=="number"&&Math.abs(ut)>Number.MAX_SAFE_INTEGER)return nt.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof ut=="number"&&Math.floor(ut)!==ut)return nt.error("Numeric branch labels must be integer values.");if(p){if(nt.checkSubtype(p,Dr(ut)))return null}else p=Dr(ut);if(S[String(ut)]!==void 0)return nt.error("Branch labels must be unique.");S[String(ut)]=I.length}const at=h.parse(X,G,b);if(!at)return null;b=b||at.type,I.push(at)}const F=h.parse(c[1],1,gr);if(!F)return null;const O=h.parse(c[c.length-1],c.length-1,b);return O?F.type.kind!=="value"&&h.concat(1).checkSubtype(p,F.type)?null:new eA(p,b,F,S,I,O):null}evaluate(c){const h=this.input.evaluate(c);return(Dr(h)===this.inputType&&this.outputs[this.cases[h]]||this.otherwise).evaluate(c)}eachChild(c){c(this.input),this.outputs.forEach(c),c(this.otherwise)}outputDefined(){return this.outputs.every(c=>c.outputDefined())&&this.otherwise.outputDefined()}}class _a{constructor(c,h,p){this.type=c,this.branches=h,this.otherwise=p}static parse(c,h){if(c.length<4)return h.error(`Expected at least 3 arguments, but found only ${c.length-1}.`);if(c.length%2!=0)return h.error("Expected an odd number of arguments.");let p;h.expectedType&&h.expectedType.kind!=="value"&&(p=h.expectedType);const b=[];for(let I=1;I<c.length-1;I+=2){const F=h.parse(c[I],I,Ke);if(!F)return null;const O=h.parse(c[I+1],I+1,p);if(!O)return null;b.push([F,O]),p=p||O.type}const S=h.parse(c[c.length-1],c.length-1,p);if(!S)return null;if(!p)throw new Error("Can't infer output type");return new _a(p,b,S)}evaluate(c){for(const[h,p]of this.branches)if(h.evaluate(c))return p.evaluate(c);return this.otherwise.evaluate(c)}eachChild(c){for(const[h,p]of this.branches)c(h),c(p);c(this.otherwise)}outputDefined(){return this.branches.every(c=>{let[h,p]=c;return p.outputDefined()})&&this.otherwise.outputDefined()}}class ks{constructor(c,h,p,b){this.type=c,this.input=h,this.beginIndex=p,this.endIndex=b}static parse(c,h){if(c.length<=2||c.length>=5)return h.error(`Expected 3 or 4 arguments, but found ${c.length-1} instead.`);const p=h.parse(c[1],1,gr),b=h.parse(c[2],2,Te);if(!p||!b)return null;if(!qt(p.type,[ot(gr),Je,gr]))return h.error(`Expected first argument to be of type array or string, but found ${Et(p.type)} instead`);if(c.length===4){const S=h.parse(c[3],3,Te);return S?new ks(p.type,p,b,S):null}return new ks(p.type,p,b)}evaluate(c){const h=this.input.evaluate(c),p=this.beginIndex.evaluate(c);if(!St(h,["string","array"]))throw new In(`Expected first argument to be of type array or string, but found ${Et(Dr(h))} instead.`);if(this.endIndex){const b=this.endIndex.evaluate(c);return h.slice(p,b)}return h.slice(p)}eachChild(c){c(this.input),c(this.beginIndex),this.endIndex&&c(this.endIndex)}outputDefined(){return!1}}function au(u,c){return u==="=="||u==="!="?c.kind==="boolean"||c.kind==="string"||c.kind==="number"||c.kind==="null"||c.kind==="value":c.kind==="string"||c.kind==="number"||c.kind==="value"}function bc(u,c,h,p){return p.compare(c,h)===0}function wc(u,c,h){const p=u!=="=="&&u!=="!=";return class Vk{constructor(S,I,F){this.type=Ke,this.lhs=S,this.rhs=I,this.collator=F,this.hasUntypedArgument=S.type.kind==="value"||I.type.kind==="value"}static parse(S,I){if(S.length!==3&&S.length!==4)return I.error("Expected two or three arguments.");const F=S[0];let O=I.parse(S[1],1,gr);if(!O)return null;if(!au(F,O.type))return I.concat(1).error(`"${F}" comparisons are not supported for type '${Et(O.type)}'.`);let G=I.parse(S[2],2,gr);if(!G)return null;if(!au(F,G.type))return I.concat(2).error(`"${F}" comparisons are not supported for type '${Et(G.type)}'.`);if(O.type.kind!==G.type.kind&&O.type.kind!=="value"&&G.type.kind!=="value")return I.error(`Cannot compare types '${Et(O.type)}' and '${Et(G.type)}'.`);p&&(O.type.kind==="value"&&G.type.kind!=="value"?O=new Mi(G.type,[O]):O.type.kind!=="value"&&G.type.kind==="value"&&(G=new Mi(O.type,[G])));let K=null;if(S.length===4){if(O.type.kind!=="string"&&G.type.kind!=="string"&&O.type.kind!=="value"&&G.type.kind!=="value")return I.error("Cannot use collator to compare non-string types.");if(K=I.parse(S[3],3,an),!K)return null}return new Vk(O,G,K)}evaluate(S){const I=this.lhs.evaluate(S),F=this.rhs.evaluate(S);if(p&&this.hasUntypedArgument){const O=Dr(I),G=Dr(F);if(O.kind!==G.kind||O.kind!=="string"&&O.kind!=="number")throw new In(`Expected arguments for "${u}" to be (string, string) or (number, number), but found (${O.kind}, ${G.kind}) instead.`)}if(this.collator&&!p&&this.hasUntypedArgument){const O=Dr(I),G=Dr(F);if(O.kind!=="string"||G.kind!=="string")return c(S,I,F)}return this.collator?h(S,I,F,this.collator.evaluate(S)):c(S,I,F)}eachChild(S){S(this.lhs),S(this.rhs),this.collator&&S(this.collator)}outputDefined(){return!0}}}const cu=wc("==",function(u,c,h){return c===h},bc),vd=wc("!=",function(u,c,h){return c!==h},function(u,c,h,p){return!bc(0,c,h,p)}),rA=wc("<",function(u,c,h){return c<h},function(u,c,h,p){return p.compare(c,h)<0}),nA=wc(">",function(u,c,h){return c>h},function(u,c,h,p){return p.compare(c,h)>0}),ch=wc("<=",function(u,c,h){return c<=h},function(u,c,h,p){return p.compare(c,h)<=0}),lu=wc(">=",function(u,c,h){return c>=h},function(u,c,h,p){return p.compare(c,h)>=0});class gl{constructor(c,h,p,b,S){this.type=Je,this.number=c,this.locale=h,this.currency=p,this.minFractionDigits=b,this.maxFractionDigits=S}static parse(c,h){if(c.length!==3)return h.error("Expected two arguments.");const p=h.parse(c[1],1,Te);if(!p)return null;const b=c[2];if(typeof b!="object"||Array.isArray(b))return h.error("NumberFormat options argument must be an object.");let S=null;if(b.locale&&(S=h.parse(b.locale,1,Je),!S))return null;let I=null;if(b.currency&&(I=h.parse(b.currency,1,Je),!I))return null;let F=null;if(b["min-fraction-digits"]&&(F=h.parse(b["min-fraction-digits"],1,Te),!F))return null;let O=null;return b["max-fraction-digits"]&&(O=h.parse(b["max-fraction-digits"],1,Te),!O)?null:new gl(p,S,I,F,O)}evaluate(c){return new Intl.NumberFormat(this.locale?this.locale.evaluate(c):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(c):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(c):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(c):void 0}).format(this.number.evaluate(c))}eachChild(c){c(this.number),this.locale&&c(this.locale),this.currency&&c(this.currency),this.minFractionDigits&&c(this.minFractionDigits),this.maxFractionDigits&&c(this.maxFractionDigits)}outputDefined(){return!1}}class xc{constructor(c){this.type=$r,this.sections=c}static parse(c,h){if(c.length<2)return h.error("Expected at least one argument.");const p=c[1];if(!Array.isArray(p)&&typeof p=="object")return h.error("First argument must be an image or text section.");const b=[];let S=!1;for(let I=1;I<=c.length-1;++I){const F=c[I];if(S&&typeof F=="object"&&!Array.isArray(F)){S=!1;let O=null;if(F["font-scale"]&&(O=h.parse(F["font-scale"],1,Te),!O))return null;let G=null;if(F["text-font"]&&(G=h.parse(F["text-font"],1,ot(Je)),!G))return null;let K=null;if(F["text-color"]&&(K=h.parse(F["text-color"],1,Yr),!K))return null;const X=b[b.length-1];X.scale=O,X.font=G,X.textColor=K}else{const O=h.parse(c[I],1,gr);if(!O)return null;const G=O.type.kind;if(G!=="string"&&G!=="value"&&G!=="null"&&G!=="resolvedImage")return h.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");S=!0,b.push({content:O,scale:null,font:null,textColor:null})}}return new xc(b)}evaluate(c){return new _n(this.sections.map(h=>{const p=h.content.evaluate(c);return Dr(p)===Z?new xi("",p,null,null,null):new xi(Zs(p),null,h.scale?h.scale.evaluate(c):null,h.font?h.font.evaluate(c).join(","):null,h.textColor?h.textColor.evaluate(c):null)}))}eachChild(c){for(const h of this.sections)c(h.content),h.scale&&c(h.scale),h.font&&c(h.font),h.textColor&&c(h.textColor)}outputDefined(){return!1}}class uu{constructor(c){this.type=Z,this.input=c}static parse(c,h){if(c.length!==2)return h.error("Expected two arguments.");const p=h.parse(c[1],1,Je);return p?new uu(p):h.error("No image name provided.")}evaluate(c){const h=this.input.evaluate(c),p=cs.fromString(h);return p&&c.availableImages&&(p.available=c.availableImages.indexOf(h)>-1),p}eachChild(c){c(this.input)}outputDefined(){return!1}}class iA{constructor(c){this.type=Te,this.input=c}static parse(c,h){if(c.length!==2)return h.error(`Expected 1 argument, but found ${c.length-1} instead.`);const p=h.parse(c[1],1);return p?p.type.kind!=="array"&&p.type.kind!=="string"&&p.type.kind!=="value"?h.error(`Expected argument of type string or array, but found ${Et(p.type)} instead.`):new iA(p):null}evaluate(c){const h=this.input.evaluate(c);if(typeof h=="string"||Array.isArray(h))return h.length;throw new In(`Expected value to be of type string or array, but found ${Et(Dr(h))} instead.`)}eachChild(c){c(this.input)}outputDefined(){return!1}}const Wo={"==":cu,"!=":vd,">":nA,"<":rA,">=":lu,"<=":ch,array:Mi,at:ou,boolean:Mi,case:_a,coalesce:fl,collator:qo,format:xc,image:uu,in:Ko,"index-of":$o,interpolate:Ci,"interpolate-hcl":Ci,"interpolate-lab":Ci,length:iA,let:pl,literal:Ss,match:eA,number:Mi,"number-format":gl,object:Mi,slice:ks,step:dl,string:Mi,"to-boolean":Zn,"to-color":Zn,"to-number":Zn,"to-string":Zn,var:su,within:za};function Bc(u,c){let[h,p,b,S]=c;h=h.evaluate(u),p=p.evaluate(u),b=b.evaluate(u);const I=S?S.evaluate(u):1,F=Ns(h,p,b,I);if(F)throw new In(F);return new Br(h/255,p/255,b/255,I,!1)}function Au(u,c){return u in c}function va(u,c){const h=c[u];return h===void 0?null:h}function Xo(u){return{type:u}}function N(u){return{result:"success",value:u}}function et(u){return{result:"error",value:u}}function Pt(u){return u["property-type"]==="data-driven"||u["property-type"]==="cross-faded-data-driven"}function Vt(u){return!!u.expression&&u.expression.parameters.indexOf("zoom")>-1}function oe(u){return!!u.expression&&u.expression.interpolated}function ce(u){return u instanceof Number?"number":u instanceof String?"string":u instanceof Boolean?"boolean":Array.isArray(u)?"array":u===null?"null":typeof u}function Me(u){return typeof u=="object"&&u!==null&&!Array.isArray(u)}function cr(u){return u}function Mr(u,c){const h=c.type==="color",p=u.stops&&typeof u.stops[0][0]=="object",b=p||!(p||u.property!==void 0),S=u.type||(oe(c)?"exponential":"interval");if(h||c.type==="padding"){const K=h?Br.parse:sn.parse;(u=Ir({},u)).stops&&(u.stops=u.stops.map(X=>[X[0],K(X[1])])),u.default=K(u.default?u.default:c.default)}if(u.colorSpace&&(I=u.colorSpace)!=="rgb"&&I!=="hcl"&&I!=="lab")throw new Error(`Unknown color space: "${u.colorSpace}"`);var I;let F,O,G;if(S==="exponential")F=br;else if(S==="interval")F=wn;else if(S==="categorical"){F=vr,O=Object.create(null);for(const K of u.stops)O[K[0]]=K[1];G=typeof u.stops[0][0]}else{if(S!=="identity")throw new Error(`Unknown function type "${S}"`);F=hi}if(p){const K={},X=[];for(let ut=0;ut<u.stops.length;ut++){const Bt=u.stops[ut],It=Bt[0].zoom;K[It]===void 0&&(K[It]={zoom:It,type:u.type,property:u.property,default:u.default,stops:[]},X.push(It)),K[It].stops.push([Bt[0].value,Bt[1]])}const nt=[];for(const ut of X)nt.push([K[ut].zoom,Mr(K[ut],c)]);const at={name:"linear"};return{kind:"composite",interpolationType:at,interpolationFactor:Ci.interpolationFactor.bind(void 0,at),zoomStops:nt.map(ut=>ut[0]),evaluate:(ut,Bt)=>{let{zoom:It}=ut;return br({stops:nt,base:u.base},c,It).evaluate(It,Bt)}}}if(b){const K=S==="exponential"?{name:"exponential",base:u.base!==void 0?u.base:1}:null;return{kind:"camera",interpolationType:K,interpolationFactor:Ci.interpolationFactor.bind(void 0,K),zoomStops:u.stops.map(X=>X[0]),evaluate:X=>{let{zoom:nt}=X;return F(u,c,nt,O,G)}}}return{kind:"source",evaluate(K,X){const nt=X&&X.properties?X.properties[u.property]:void 0;return nt===void 0?Gr(u.default,c.default):F(u,c,nt,O,G)}}}function Gr(u,c,h){return u!==void 0?u:c!==void 0?c:h!==void 0?h:void 0}function vr(u,c,h,p,b){return Gr(typeof h===b?p[h]:void 0,u.default,c.default)}function wn(u,c,h){if(ce(h)!=="number")return Gr(u.default,c.default);const p=u.stops.length;if(p===1||h<=u.stops[0][0])return u.stops[0][1];if(h>=u.stops[p-1][0])return u.stops[p-1][1];const b=hl(u.stops.map(S=>S[0]),h);return u.stops[b][1]}function br(u,c,h){const p=u.base!==void 0?u.base:1;if(ce(h)!=="number")return Gr(u.default,c.default);const b=u.stops.length;if(b===1||h<=u.stops[0][0])return u.stops[0][1];if(h>=u.stops[b-1][0])return u.stops[b-1][1];const S=hl(u.stops.map(K=>K[0]),h),I=function(K,X,nt,at){const ut=at-nt,Bt=K-nt;return ut===0?0:X===1?Bt/ut:(Math.pow(X,Bt)-1)/(Math.pow(X,ut)-1)}(h,p,u.stops[S][0],u.stops[S+1][0]),F=u.stops[S][1],O=u.stops[S+1][1],G=Ri[c.type]||cr;return typeof F.evaluate=="function"?{evaluate(){for(var K=arguments.length,X=new Array(K),nt=0;nt<K;nt++)X[nt]=arguments[nt];const at=F.evaluate.apply(void 0,X),ut=O.evaluate.apply(void 0,X);if(at!==void 0&&ut!==void 0)return G(at,ut,I,u.colorSpace)}}:G(F,O,I,u.colorSpace)}function hi(u,c,h){switch(c.type){case"color":h=Br.parse(h);break;case"formatted":h=_n.fromString(h.toString());break;case"resolvedImage":h=cs.fromString(h.toString());break;case"padding":h=sn.parse(h);break;default:ce(h)===c.type||c.type==="enum"&&c.values[h]||(h=void 0)}return Gr(h,u.default,c.default)}vi.register(Wo,{error:[{kind:"error"},[Je],(u,c)=>{let[h]=c;throw new In(h.evaluate(u))}],typeof:[Je,[gr],(u,c)=>{let[h]=c;return Et(Dr(h.evaluate(u)))}],"to-rgba":[ot(Te,4),[Yr],(u,c)=>{let[h]=c;const[p,b,S,I]=h.evaluate(u).rgb;return[255*p,255*b,255*S,I]}],rgb:[Yr,[Te,Te,Te],Bc],rgba:[Yr,[Te,Te,Te,Te],Bc],has:{type:Ke,overloads:[[[Je],(u,c)=>{let[h]=c;return Au(h.evaluate(u),u.properties())}],[[Je,Or],(u,c)=>{let[h,p]=c;return Au(h.evaluate(u),p.evaluate(u))}]]},get:{type:gr,overloads:[[[Je],(u,c)=>{let[h]=c;return va(h.evaluate(u),u.properties())}],[[Je,Or],(u,c)=>{let[h,p]=c;return va(h.evaluate(u),p.evaluate(u))}]]},"feature-state":[gr,[Je],(u,c)=>{let[h]=c;return va(h.evaluate(u),u.featureState||{})}],properties:[Or,[],u=>u.properties()],"geometry-type":[Je,[],u=>u.geometryType()],id:[gr,[],u=>u.id()],zoom:[Te,[],u=>u.globals.zoom],"heatmap-density":[Te,[],u=>u.globals.heatmapDensity||0],"line-progress":[Te,[],u=>u.globals.lineProgress||0],accumulated:[gr,[],u=>u.globals.accumulated===void 0?null:u.globals.accumulated],"+":[Te,Xo(Te),(u,c)=>{let h=0;for(const p of c)h+=p.evaluate(u);return h}],"*":[Te,Xo(Te),(u,c)=>{let h=1;for(const p of c)h*=p.evaluate(u);return h}],"-":{type:Te,overloads:[[[Te,Te],(u,c)=>{let[h,p]=c;return h.evaluate(u)-p.evaluate(u)}],[[Te],(u,c)=>{let[h]=c;return-h.evaluate(u)}]]},"/":[Te,[Te,Te],(u,c)=>{let[h,p]=c;return h.evaluate(u)/p.evaluate(u)}],"%":[Te,[Te,Te],(u,c)=>{let[h,p]=c;return h.evaluate(u)%p.evaluate(u)}],ln2:[Te,[],()=>Math.LN2],pi:[Te,[],()=>Math.PI],e:[Te,[],()=>Math.E],"^":[Te,[Te,Te],(u,c)=>{let[h,p]=c;return Math.pow(h.evaluate(u),p.evaluate(u))}],sqrt:[Te,[Te],(u,c)=>{let[h]=c;return Math.sqrt(h.evaluate(u))}],log10:[Te,[Te],(u,c)=>{let[h]=c;return Math.log(h.evaluate(u))/Math.LN10}],ln:[Te,[Te],(u,c)=>{let[h]=c;return Math.log(h.evaluate(u))}],log2:[Te,[Te],(u,c)=>{let[h]=c;return Math.log(h.evaluate(u))/Math.LN2}],sin:[Te,[Te],(u,c)=>{let[h]=c;return Math.sin(h.evaluate(u))}],cos:[Te,[Te],(u,c)=>{let[h]=c;return Math.cos(h.evaluate(u))}],tan:[Te,[Te],(u,c)=>{let[h]=c;return Math.tan(h.evaluate(u))}],asin:[Te,[Te],(u,c)=>{let[h]=c;return Math.asin(h.evaluate(u))}],acos:[Te,[Te],(u,c)=>{let[h]=c;return Math.acos(h.evaluate(u))}],atan:[Te,[Te],(u,c)=>{let[h]=c;return Math.atan(h.evaluate(u))}],min:[Te,Xo(Te),(u,c)=>Math.min(...c.map(h=>h.evaluate(u)))],max:[Te,Xo(Te),(u,c)=>Math.max(...c.map(h=>h.evaluate(u)))],abs:[Te,[Te],(u,c)=>{let[h]=c;return Math.abs(h.evaluate(u))}],round:[Te,[Te],(u,c)=>{let[h]=c;const p=h.evaluate(u);return p<0?-Math.round(-p):Math.round(p)}],floor:[Te,[Te],(u,c)=>{let[h]=c;return Math.floor(h.evaluate(u))}],ceil:[Te,[Te],(u,c)=>{let[h]=c;return Math.ceil(h.evaluate(u))}],"filter-==":[Ke,[Je,gr],(u,c)=>{let[h,p]=c;return u.properties()[h.value]===p.value}],"filter-id-==":[Ke,[gr],(u,c)=>{let[h]=c;return u.id()===h.value}],"filter-type-==":[Ke,[Je],(u,c)=>{let[h]=c;return u.geometryType()===h.value}],"filter-<":[Ke,[Je,gr],(u,c)=>{let[h,p]=c;const b=u.properties()[h.value],S=p.value;return typeof b==typeof S&&b<S}],"filter-id-<":[Ke,[gr],(u,c)=>{let[h]=c;const p=u.id(),b=h.value;return typeof p==typeof b&&p<b}],"filter->":[Ke,[Je,gr],(u,c)=>{let[h,p]=c;const b=u.properties()[h.value],S=p.value;return typeof b==typeof S&&b>S}],"filter-id->":[Ke,[gr],(u,c)=>{let[h]=c;const p=u.id(),b=h.value;return typeof p==typeof b&&p>b}],"filter-<=":[Ke,[Je,gr],(u,c)=>{let[h,p]=c;const b=u.properties()[h.value],S=p.value;return typeof b==typeof S&&b<=S}],"filter-id-<=":[Ke,[gr],(u,c)=>{let[h]=c;const p=u.id(),b=h.value;return typeof p==typeof b&&p<=b}],"filter->=":[Ke,[Je,gr],(u,c)=>{let[h,p]=c;const b=u.properties()[h.value],S=p.value;return typeof b==typeof S&&b>=S}],"filter-id->=":[Ke,[gr],(u,c)=>{let[h]=c;const p=u.id(),b=h.value;return typeof p==typeof b&&p>=b}],"filter-has":[Ke,[gr],(u,c)=>{let[h]=c;return h.value in u.properties()}],"filter-has-id":[Ke,[],u=>u.id()!==null&&u.id()!==void 0],"filter-type-in":[Ke,[ot(Je)],(u,c)=>{let[h]=c;return h.value.indexOf(u.geometryType())>=0}],"filter-id-in":[Ke,[ot(gr)],(u,c)=>{let[h]=c;return h.value.indexOf(u.id())>=0}],"filter-in-small":[Ke,[Je,ot(gr)],(u,c)=>{let[h,p]=c;return p.value.indexOf(u.properties()[h.value])>=0}],"filter-in-large":[Ke,[Je,ot(gr)],(u,c)=>{let[h,p]=c;return function(b,S,I,F){for(;I<=F;){const O=I+F>>1;if(S[O]===b)return!0;S[O]>b?F=O-1:I=O+1}return!1}(u.properties()[h.value],p.value,0,p.value.length-1)}],all:{type:Ke,overloads:[[[Ke,Ke],(u,c)=>{let[h,p]=c;return h.evaluate(u)&&p.evaluate(u)}],[Xo(Ke),(u,c)=>{for(const h of c)if(!h.evaluate(u))return!1;return!0}]]},any:{type:Ke,overloads:[[[Ke,Ke],(u,c)=>{let[h,p]=c;return h.evaluate(u)||p.evaluate(u)}],[Xo(Ke),(u,c)=>{for(const h of c)if(h.evaluate(u))return!0;return!1}]]},"!":[Ke,[Ke],(u,c)=>{let[h]=c;return!h.evaluate(u)}],"is-supported-script":[Ke,[Je],(u,c)=>{let[h]=c;const p=u.globals&&u.globals.isSupportedScript;return!p||p(h.evaluate(u))}],upcase:[Je,[Je],(u,c)=>{let[h]=c;return h.evaluate(u).toUpperCase()}],downcase:[Je,[Je],(u,c)=>{let[h]=c;return h.evaluate(u).toLowerCase()}],concat:[Je,Xo(gr),(u,c)=>c.map(h=>Zs(h.evaluate(u))).join("")],"resolved-locale":[Je,[an],(u,c)=>{let[h]=c;return h.evaluate(u).resolvedLocale()}]});class Kr{constructor(c,h){var p;this.expression=c,this._warningHistory={},this._evaluator=new cn,this._defaultValue=h?(p=h).type==="color"&&Me(p.default)?new Br(0,0,0,0):p.type==="color"?Br.parse(p.default)||null:p.type==="padding"?sn.parse(p.default)||null:p.type==="variableAnchorOffsetCollection"?Yn.parse(p.default)||null:p.default===void 0?null:p.default:null,this._enumValues=h&&h.type==="enum"?h.values:null}evaluateWithoutErrorHandling(c,h,p,b,S,I){return this._evaluator.globals=c,this._evaluator.feature=h,this._evaluator.featureState=p,this._evaluator.canonical=b,this._evaluator.availableImages=S||null,this._evaluator.formattedSection=I,this.expression.evaluate(this._evaluator)}evaluate(c,h,p,b,S,I){this._evaluator.globals=c,this._evaluator.feature=h||null,this._evaluator.featureState=p||null,this._evaluator.canonical=b,this._evaluator.availableImages=S||null,this._evaluator.formattedSection=I||null;try{const F=this.expression.evaluate(this._evaluator);if(F==null||typeof F=="number"&&F!=F)return this._defaultValue;if(this._enumValues&&!(F in this._enumValues))throw new In(`Expected value to be one of ${Object.keys(this._enumValues).map(O=>JSON.stringify(O)).join(", ")}, but found ${JSON.stringify(F)} instead.`);return F}catch(F){return this._warningHistory[F.message]||(this._warningHistory[F.message]=!0,typeof console<"u"&&console.warn(F.message)),this._defaultValue}}}function Xr(u){return Array.isArray(u)&&u.length>0&&typeof u[0]=="string"&&u[0]in Wo}function oi(u,c){const h=new jo(Wo,yc,[],c?function(b){const S={color:Yr,string:Je,number:Te,enum:Je,boolean:Ke,formatted:$r,padding:Ct,resolvedImage:Z,variableAnchorOffsetCollection:Y};return b.type==="array"?ot(S[b.value]||gr,b.length):S[b.type]}(c):void 0),p=h.parse(u,void 0,void 0,void 0,c&&c.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?N(new Kr(p,c)):et(h.errors)}class Qs{constructor(c,h){this.kind=c,this._styleExpression=h,this.isStateDependent=c!=="constant"&&!ma(h.expression)}evaluateWithoutErrorHandling(c,h,p,b,S,I){return this._styleExpression.evaluateWithoutErrorHandling(c,h,p,b,S,I)}evaluate(c,h,p,b,S,I){return this._styleExpression.evaluate(c,h,p,b,S,I)}}class Hs{constructor(c,h,p,b){this.kind=c,this.zoomStops=p,this._styleExpression=h,this.isStateDependent=c!=="camera"&&!ma(h.expression),this.interpolationType=b}evaluateWithoutErrorHandling(c,h,p,b,S,I){return this._styleExpression.evaluateWithoutErrorHandling(c,h,p,b,S,I)}evaluate(c,h,p,b,S,I){return this._styleExpression.evaluate(c,h,p,b,S,I)}interpolationFactor(c,h,p){return this.interpolationType?Ci.interpolationFactor(this.interpolationType,c,h,p):0}}function ba(u,c){const h=oi(u,c);if(h.result==="error")return h;const p=h.value.expression,b=Al(p);if(!b&&!Pt(c))return et([new De("","data expressions not supported")]);const S=Ga(p,["zoom"]);if(!S&&!Vt(c))return et([new De("","zoom expressions not supported")]);const I=Cc(p);return I||S?I instanceof De?et([I]):I instanceof Ci&&!oe(c)?et([new De("",'"interpolate" expressions cannot be used with this property')]):N(I?new Hs(b?"camera":"composite",h.value,I.labels,I instanceof Ci?I.interpolation:void 0):new Qs(b?"constant":"source",h.value)):et([new De("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class ml{constructor(c,h){this._parameters=c,this._specification=h,Ir(this,Mr(this._parameters,this._specification))}static deserialize(c){return new ml(c._parameters,c._specification)}static serialize(c){return{_parameters:c._parameters,_specification:c._specification}}}function Cc(u){let c=null;if(u instanceof pl)c=Cc(u.result);else if(u instanceof fl){for(const h of u.args)if(c=Cc(h),c)break}else(u instanceof dl||u instanceof Ci)&&u.input instanceof vi&&u.input.name==="zoom"&&(c=u);return c instanceof De||u.eachChild(h=>{const p=Cc(h);p instanceof De?c=p:!c&&p?c=new De("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):c&&p&&c!==p&&(c=new De("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),c}function Ec(u){if(u===!0||u===!1)return!0;if(!Array.isArray(u)||u.length===0)return!1;switch(u[0]){case"has":return u.length>=2&&u[1]!=="$id"&&u[1]!=="$type";case"in":return u.length>=3&&(typeof u[1]!="string"||Array.isArray(u[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return u.length!==3||Array.isArray(u[1])||Array.isArray(u[2]);case"any":case"all":for(const c of u.slice(1))if(!Ec(c)&&typeof c!="boolean")return!1;return!0;default:return!0}}const yl={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Sc(u){if(u==null)return{filter:()=>!0,needGeometry:!1};Ec(u)||(u=ls(u));const c=oi(u,yl);if(c.result==="error")throw new Error(c.value.map(h=>`${h.key}: ${h.message}`).join(", "));return{filter:(h,p,b)=>c.value.evaluate(h,p,{},b),needGeometry:ja(u)}}function hu(u,c){return u<c?-1:u>c?1:0}function ja(u){if(!Array.isArray(u))return!1;if(u[0]==="within")return!0;for(let c=1;c<u.length;c++)if(ja(u[c]))return!0;return!1}function ls(u){if(!u)return!0;const c=u[0];return u.length<=1?c!=="any":c==="=="?Tc(u[1],u[2],"=="):c==="!="?Ic(Tc(u[1],u[2],"==")):c==="<"||c===">"||c==="<="||c===">="?Tc(u[1],u[2],c):c==="any"?(h=u.slice(1),["any"].concat(h.map(ls))):c==="all"?["all"].concat(u.slice(1).map(ls)):c==="none"?["all"].concat(u.slice(1).map(ls).map(Ic)):c==="in"?_l(u[1],u.slice(2)):c==="!in"?Ic(_l(u[1],u.slice(2))):c==="has"?vl(u[1]):c==="!has"?Ic(vl(u[1])):c!=="within"||u;var h}function Tc(u,c,h){switch(u){case"$type":return[`filter-type-${h}`,c];case"$id":return[`filter-id-${h}`,c];default:return[`filter-${h}`,u,c]}}function _l(u,c){if(c.length===0)return!1;switch(u){case"$type":return["filter-type-in",["literal",c]];case"$id":return["filter-id-in",["literal",c]];default:return c.length>200&&!c.some(h=>typeof h!=typeof c[0])?["filter-in-large",u,["literal",c.sort(hu)]]:["filter-in-small",u,["literal",c]]}}function vl(u){switch(u){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",u]}}function Ic(u){return["!",u]}function ws(u){const c=typeof u;if(c==="number"||c==="boolean"||c==="string"||u==null)return JSON.stringify(u);if(Array.isArray(u)){let b="[";for(const S of u)b+=`${ws(S)},`;return`${b}]`}const h=Object.keys(u).sort();let p="{";for(let b=0;b<h.length;b++)p+=`${JSON.stringify(h[b])}:${ws(u[h[b]])},`;return`${p}}`}function bd(u){let c="";for(const h of er)c+=`/${ws(u[h])}`;return c}function du(u){const c=u.value;return c?[new fe(u.key,c,"constants have been deprecated as of v8")]:[]}function Xn(u){return u instanceof Number||u instanceof String||u instanceof Boolean?u.valueOf():u}function Ki(u){if(Array.isArray(u))return u.map(Ki);if(u instanceof Object&&!(u instanceof Number||u instanceof String||u instanceof Boolean)){const c={};for(const h in u)c[h]=Ki(u[h]);return c}return Xn(u)}function Oi(u){const c=u.key,h=u.value,p=u.valueSpec||{},b=u.objectElementValidators||{},S=u.style,I=u.styleSpec,F=u.validateSpec;let O=[];const G=ce(h);if(G!=="object")return[new fe(c,h,`object expected, ${G} found`)];for(const K in h){const X=K.split(".")[0],nt=p[X]||p["*"];let at;if(b[X])at=b[X];else if(p[X])at=F;else if(b["*"])at=b["*"];else{if(!p["*"]){O.push(new fe(c,h[K],`unknown property "${K}"`));continue}at=F}O=O.concat(at({key:(c&&`${c}.`)+K,value:h[K],valueSpec:nt,style:S,styleSpec:I,object:h,objectKey:K,validateSpec:F},h))}for(const K in p)b[K]||p[K].required&&p[K].default===void 0&&h[K]===void 0&&O.push(new fe(c,h,`missing required property "${K}"`));return O}function sA(u){const c=u.value,h=u.valueSpec,p=u.style,b=u.styleSpec,S=u.key,I=u.arrayElementValidator||u.validateSpec;if(ce(c)!=="array")return[new fe(S,c,`array expected, ${ce(c)} found`)];if(h.length&&c.length!==h.length)return[new fe(S,c,`array length ${h.length} expected, length ${c.length} found`)];if(h["min-length"]&&c.length<h["min-length"])return[new fe(S,c,`array length at least ${h["min-length"]} expected, length ${c.length} found`)];let F={type:h.value,values:h.values};b.$version<7&&(F.function=h.function),ce(h.value)==="object"&&(F=h.value);let O=[];for(let G=0;G<c.length;G++)O=O.concat(I({array:c,arrayIndex:G,value:c[G],valueSpec:F,validateSpec:u.validateSpec,style:p,styleSpec:b,key:`${S}[${G}]`}));return O}function fu(u){const c=u.key,h=u.value,p=u.valueSpec;let b=ce(h);return b==="number"&&h!=h&&(b="NaN"),b!=="number"?[new fe(c,h,`number expected, ${b} found`)]:"minimum"in p&&h<p.minimum?[new fe(c,h,`${h} is less than the minimum value ${p.minimum}`)]:"maximum"in p&&h>p.maximum?[new fe(c,h,`${h} is greater than the maximum value ${p.maximum}`)]:[]}function qa(u){const c=u.valueSpec,h=Xn(u.value.type);let p,b,S,I={};const F=h!=="categorical"&&u.value.property===void 0,O=!F,G=ce(u.value.stops)==="array"&&ce(u.value.stops[0])==="array"&&ce(u.value.stops[0][0])==="object",K=Oi({key:u.key,value:u.value,valueSpec:u.styleSpec.function,validateSpec:u.validateSpec,style:u.style,styleSpec:u.styleSpec,objectElementValidators:{stops:function(at){if(h==="identity")return[new fe(at.key,at.value,'identity function may not have a "stops" property')];let ut=[];const Bt=at.value;return ut=ut.concat(sA({key:at.key,value:Bt,valueSpec:at.valueSpec,validateSpec:at.validateSpec,style:at.style,styleSpec:at.styleSpec,arrayElementValidator:X})),ce(Bt)==="array"&&Bt.length===0&&ut.push(new fe(at.key,Bt,"array must have at least one stop")),ut},default:function(at){return at.validateSpec({key:at.key,value:at.value,valueSpec:c,validateSpec:at.validateSpec,style:at.style,styleSpec:at.styleSpec})}}});return h==="identity"&&F&&K.push(new fe(u.key,u.value,'missing required property "property"')),h==="identity"||u.value.stops||K.push(new fe(u.key,u.value,'missing required property "stops"')),h==="exponential"&&u.valueSpec.expression&&!oe(u.valueSpec)&&K.push(new fe(u.key,u.value,"exponential functions not supported")),u.styleSpec.$version>=8&&(O&&!Pt(u.valueSpec)?K.push(new fe(u.key,u.value,"property functions not supported")):F&&!Vt(u.valueSpec)&&K.push(new fe(u.key,u.value,"zoom functions not supported"))),h!=="categorical"&&!G||u.value.property!==void 0||K.push(new fe(u.key,u.value,'"property" property is required')),K;function X(at){let ut=[];const Bt=at.value,It=at.key;if(ce(Bt)!=="array")return[new fe(It,Bt,`array expected, ${ce(Bt)} found`)];if(Bt.length!==2)return[new fe(It,Bt,`array length 2 expected, length ${Bt.length} found`)];if(G){if(ce(Bt[0])!=="object")return[new fe(It,Bt,`object expected, ${ce(Bt[0])} found`)];if(Bt[0].zoom===void 0)return[new fe(It,Bt,"object stop key must have zoom")];if(Bt[0].value===void 0)return[new fe(It,Bt,"object stop key must have value")];if(S&&S>Xn(Bt[0].zoom))return[new fe(It,Bt[0].zoom,"stop zoom values must appear in ascending order")];Xn(Bt[0].zoom)!==S&&(S=Xn(Bt[0].zoom),b=void 0,I={}),ut=ut.concat(Oi({key:`${It}[0]`,value:Bt[0],valueSpec:{zoom:{}},validateSpec:at.validateSpec,style:at.style,styleSpec:at.styleSpec,objectElementValidators:{zoom:fu,value:nt}}))}else ut=ut.concat(nt({key:`${It}[0]`,value:Bt[0],valueSpec:{},validateSpec:at.validateSpec,style:at.style,styleSpec:at.styleSpec},Bt));return Xr(Ki(Bt[1]))?ut.concat([new fe(`${It}[1]`,Bt[1],"expressions are not allowed in function stops.")]):ut.concat(at.validateSpec({key:`${It}[1]`,value:Bt[1],valueSpec:c,validateSpec:at.validateSpec,style:at.style,styleSpec:at.styleSpec}))}function nt(at,ut){const Bt=ce(at.value),It=Xn(at.value),Nt=at.value!==null?at.value:ut;if(p){if(Bt!==p)return[new fe(at.key,Nt,`${Bt} stop domain type must match previous stop domain type ${p}`)]}else p=Bt;if(Bt!=="number"&&Bt!=="string"&&Bt!=="boolean")return[new fe(at.key,Nt,"stop domain value must be a number, string, or boolean")];if(Bt!=="number"&&h!=="categorical"){let ee=`number expected, ${Bt} found`;return Pt(c)&&h===void 0&&(ee+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new fe(at.key,Nt,ee)]}return h!=="categorical"||Bt!=="number"||isFinite(It)&&Math.floor(It)===It?h!=="categorical"&&Bt==="number"&&b!==void 0&&It<b?[new fe(at.key,Nt,"stop domain values must appear in ascending order")]:(b=It,h==="categorical"&&It in I?[new fe(at.key,Nt,"stop domain values must be unique")]:(I[It]=!0,[])):[new fe(at.key,Nt,`integer expected, found ${It}`)]}}function Di(u){const c=(u.expressionContext==="property"?ba:oi)(Ki(u.value),u.valueSpec);if(c.result==="error")return c.value.map(p=>new fe(`${u.key}${p.key}`,u.value,p.message));const h=c.value.expression||c.value._styleExpression.expression;if(u.expressionContext==="property"&&u.propertyKey==="text-font"&&!h.outputDefined())return[new fe(u.key,u.value,`Invalid data expression for "${u.propertyKey}". Output values must be contained as literals within the expression.`)];if(u.expressionContext==="property"&&u.propertyType==="layout"&&!ma(h))return[new fe(u.key,u.value,'"feature-state" data expressions are not supported with layout properties.')];if(u.expressionContext==="filter"&&!ma(h))return[new fe(u.key,u.value,'"feature-state" data expressions are not supported with filters.')];if(u.expressionContext&&u.expressionContext.indexOf("cluster")===0){if(!Ga(h,["zoom","feature-state"]))return[new fe(u.key,u.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(u.expressionContext==="cluster-initial"&&!Al(h))return[new fe(u.key,u.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function $i(u){const c=u.key,h=u.value,p=u.valueSpec,b=[];return Array.isArray(p.values)?p.values.indexOf(Xn(h))===-1&&b.push(new fe(c,h,`expected one of [${p.values.join(", ")}], ${JSON.stringify(h)} found`)):Object.keys(p.values).indexOf(Xn(h))===-1&&b.push(new fe(c,h,`expected one of [${Object.keys(p.values).join(", ")}], ${JSON.stringify(h)} found`)),b}function eo(u){return Ec(Ki(u.value))?Di(Ir({},u,{expressionContext:"filter",valueSpec:{value:"boolean"}})):xo(u)}function xo(u){const c=u.value,h=u.key;if(ce(c)!=="array")return[new fe(h,c,`array expected, ${ce(c)} found`)];const p=u.styleSpec;let b,S=[];if(c.length<1)return[new fe(h,c,"filter array must have at least 1 element")];switch(S=S.concat($i({key:`${h}[0]`,value:c[0],valueSpec:p.filter_operator,style:u.style,styleSpec:u.styleSpec})),Xn(c[0])){case"<":case"<=":case">":case">=":c.length>=2&&Xn(c[1])==="$type"&&S.push(new fe(h,c,`"$type" cannot be use with operator "${c[0]}"`));case"==":case"!=":c.length!==3&&S.push(new fe(h,c,`filter array for operator "${c[0]}" must have 3 elements`));case"in":case"!in":c.length>=2&&(b=ce(c[1]),b!=="string"&&S.push(new fe(`${h}[1]`,c[1],`string expected, ${b} found`)));for(let I=2;I<c.length;I++)b=ce(c[I]),Xn(c[1])==="$type"?S=S.concat($i({key:`${h}[${I}]`,value:c[I],valueSpec:p.geometry_type,style:u.style,styleSpec:u.styleSpec})):b!=="string"&&b!=="number"&&b!=="boolean"&&S.push(new fe(`${h}[${I}]`,c[I],`string, number, or boolean expected, ${b} found`));break;case"any":case"all":case"none":for(let I=1;I<c.length;I++)S=S.concat(xo({key:`${h}[${I}]`,value:c[I],style:u.style,styleSpec:u.styleSpec}));break;case"has":case"!has":b=ce(c[1]),c.length!==2?S.push(new fe(h,c,`filter array for "${c[0]}" operator must have 2 elements`)):b!=="string"&&S.push(new fe(`${h}[1]`,c[1],`string expected, ${b} found`));break;case"within":b=ce(c[1]),c.length!==2?S.push(new fe(h,c,`filter array for "${c[0]}" operator must have 2 elements`)):b!=="object"&&S.push(new fe(`${h}[1]`,c[1],`object expected, ${b} found`))}return S}function Bo(u,c){const h=u.key,p=u.validateSpec,b=u.style,S=u.styleSpec,I=u.value,F=u.objectKey,O=S[`${c}_${u.layerType}`];if(!O)return[];const G=F.match(/^(.*)-transition$/);if(c==="paint"&&G&&O[G[1]]&&O[G[1]].transition)return p({key:h,value:I,valueSpec:S.transition,style:b,styleSpec:S});const K=u.valueSpec||O[F];if(!K)return[new fe(h,I,`unknown property "${F}"`)];let X;if(ce(I)==="string"&&Pt(K)&&!K.tokens&&(X=/^{([^}]+)}$/.exec(I)))return[new fe(h,I,`"${F}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(X[1])} }\`.`)];const nt=[];return u.layerType==="symbol"&&(F==="text-field"&&b&&!b.glyphs&&nt.push(new fe(h,I,'use of "text-field" requires a style "glyphs" property')),F==="text-font"&&Me(Ki(I))&&Xn(I.type)==="identity"&&nt.push(new fe(h,I,'"text-font" does not support identity functions'))),nt.concat(p({key:u.key,value:I,valueSpec:K,style:b,styleSpec:S,expressionContext:"property",propertyType:c,propertyKey:F}))}function Lc(u){return Bo(u,"paint")}function ro(u){return Bo(u,"layout")}function wa(u){let c=[];const h=u.value,p=u.key,b=u.style,S=u.styleSpec;h.type||h.ref||c.push(new fe(p,h,'either "type" or "ref" is required'));let I=Xn(h.type);const F=Xn(h.ref);if(h.id){const O=Xn(h.id);for(let G=0;G<u.arrayIndex;G++){const K=b.layers[G];Xn(K.id)===O&&c.push(new fe(p,h.id,`duplicate layer id "${h.id}", previously used at line ${K.id.__line__}`))}}if("ref"in h){let O;["type","source","source-layer","filter","layout"].forEach(G=>{G in h&&c.push(new fe(p,h[G],`"${G}" is prohibited for ref layers`))}),b.layers.forEach(G=>{Xn(G.id)===F&&(O=G)}),O?O.ref?c.push(new fe(p,h.ref,"ref cannot reference another ref layer")):I=Xn(O.type):c.push(new fe(p,h.ref,`ref layer "${F}" not found`))}else if(I!=="background")if(h.source){const O=b.sources&&b.sources[h.source],G=O&&Xn(O.type);O?G==="vector"&&I==="raster"?c.push(new fe(p,h.source,`layer "${h.id}" requires a raster source`)):G!=="raster-dem"&&I==="hillshade"?c.push(new fe(p,h.source,`layer "${h.id}" requires a raster-dem source`)):G==="raster"&&I!=="raster"?c.push(new fe(p,h.source,`layer "${h.id}" requires a vector source`)):G!=="vector"||h["source-layer"]?G==="raster-dem"&&I!=="hillshade"?c.push(new fe(p,h.source,"raster-dem source can only be used with layer type 'hillshade'.")):I!=="line"||!h.paint||!h.paint["line-gradient"]||G==="geojson"&&O.lineMetrics||c.push(new fe(p,h,`layer "${h.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):c.push(new fe(p,h,`layer "${h.id}" must specify a "source-layer"`)):c.push(new fe(p,h.source,`source "${h.source}" not found`))}else c.push(new fe(p,h,'missing required property "source"'));return c=c.concat(Oi({key:p,value:h,valueSpec:S.layer,style:u.style,styleSpec:u.styleSpec,validateSpec:u.validateSpec,objectElementValidators:{"*":()=>[],type:()=>u.validateSpec({key:`${p}.type`,value:h.type,valueSpec:S.layer.type,style:u.style,styleSpec:u.styleSpec,validateSpec:u.validateSpec,object:h,objectKey:"type"}),filter:eo,layout:O=>Oi({layer:h,key:O.key,value:O.value,style:O.style,styleSpec:O.styleSpec,validateSpec:O.validateSpec,objectElementValidators:{"*":G=>ro(Ir({layerType:I},G))}}),paint:O=>Oi({layer:h,key:O.key,value:O.value,style:O.style,styleSpec:O.styleSpec,validateSpec:O.validateSpec,objectElementValidators:{"*":G=>Lc(Ir({layerType:I},G))}})}})),c}function Jo(u){const c=u.value,h=u.key,p=ce(c);return p!=="string"?[new fe(h,c,`string expected, ${p} found`)]:[]}const Ka={promoteId:function(u){let{key:c,value:h}=u;if(ce(h)==="string")return Jo({key:c,value:h});{const p=[];for(const b in h)p.push(...Jo({key:`${c}.${b}`,value:h[b]}));return p}}};function Co(u){const c=u.value,h=u.key,p=u.styleSpec,b=u.style,S=u.validateSpec;if(!c.type)return[new fe(h,c,'"type" is required')];const I=Xn(c.type);let F;switch(I){case"vector":case"raster":return F=Oi({key:h,value:c,valueSpec:p[`source_${I.replace("-","_")}`],style:u.style,styleSpec:p,objectElementValidators:Ka,validateSpec:S}),F;case"raster-dem":return F=function(O){var G;const K=(G=O.sourceName)!==null&&G!==void 0?G:"",X=O.value,nt=O.styleSpec,at=nt.source_raster_dem,ut=O.style;let Bt=[];const It=ce(X);if(X===void 0)return Bt;if(It!=="object")return Bt.push(new fe("source_raster_dem",X,`object expected, ${It} found`)),Bt;const Nt=Xn(X.encoding)==="custom",ee=["redFactor","greenFactor","blueFactor","baseShift"],Ht=O.value.encoding?`"${O.value.encoding}"`:"Default";for(const Kt in X)!Nt&&ee.includes(Kt)?Bt.push(new fe(Kt,X[Kt],`In "${K}": "${Kt}" is only valid when "encoding" is set to "custom". ${Ht} encoding found`)):at[Kt]?Bt=Bt.concat(O.validateSpec({key:Kt,value:X[Kt],valueSpec:at[Kt],validateSpec:O.validateSpec,style:ut,styleSpec:nt})):Bt.push(new fe(Kt,X[Kt],`unknown property "${Kt}"`));return Bt}({sourceName:h,value:c,style:u.style,styleSpec:p,validateSpec:S}),F;case"geojson":if(F=Oi({key:h,value:c,valueSpec:p.source_geojson,style:b,styleSpec:p,validateSpec:S,objectElementValidators:Ka}),c.cluster)for(const O in c.clusterProperties){const[G,K]=c.clusterProperties[O],X=typeof G=="string"?[G,["accumulated"],["get",O]]:G;F.push(...Di({key:`${h}.${O}.map`,value:K,validateSpec:S,expressionContext:"cluster-map"})),F.push(...Di({key:`${h}.${O}.reduce`,value:X,validateSpec:S,expressionContext:"cluster-reduce"}))}return F;case"video":return Oi({key:h,value:c,valueSpec:p.source_video,style:b,validateSpec:S,styleSpec:p});case"image":return Oi({key:h,value:c,valueSpec:p.source_image,style:b,validateSpec:S,styleSpec:p});case"canvas":return[new fe(h,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return $i({key:`${h}.type`,value:c.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:b,validateSpec:S,styleSpec:p})}}function xa(u){const c=u.value,h=u.styleSpec,p=h.light,b=u.style;let S=[];const I=ce(c);if(c===void 0)return S;if(I!=="object")return S=S.concat([new fe("light",c,`object expected, ${I} found`)]),S;for(const F in c){const O=F.match(/^(.*)-transition$/);S=S.concat(O&&p[O[1]]&&p[O[1]].transition?u.validateSpec({key:F,value:c[F],valueSpec:h.transition,validateSpec:u.validateSpec,style:b,styleSpec:h}):p[F]?u.validateSpec({key:F,value:c[F],valueSpec:p[F],validateSpec:u.validateSpec,style:b,styleSpec:h}):[new fe(F,c[F],`unknown property "${F}"`)])}return S}function Fc(u){const c=u.value,h=u.styleSpec,p=h.sky,b=u.style,S=ce(c);if(c===void 0)return[];if(S!=="object")return[new fe("sky",c,`object expected, ${S} found`)];let I=[];for(const F in c)I=I.concat(p[F]?zs({key:F,value:c[F],valueSpec:p[F],style:b,styleSpec:h}):[new fe(F,c[F],`unknown property "${F}"`)]);return I}function Ba(u){const c=u.value,h=u.styleSpec,p=h.terrain,b=u.style;let S=[];const I=ce(c);if(c===void 0)return S;if(I!=="object")return S=S.concat([new fe("terrain",c,`object expected, ${I} found`)]),S;for(const F in c)S=S.concat(p[F]?u.validateSpec({key:F,value:c[F],valueSpec:p[F],validateSpec:u.validateSpec,style:b,styleSpec:h}):[new fe(F,c[F],`unknown property "${F}"`)]);return S}function Yo(u){let c=[];const h=u.value,p=u.key;if(Array.isArray(h)){const b=[],S=[];for(const I in h)h[I].id&&b.includes(h[I].id)&&c.push(new fe(p,h,`all the sprites' ids must be unique, but ${h[I].id} is duplicated`)),b.push(h[I].id),h[I].url&&S.includes(h[I].url)&&c.push(new fe(p,h,`all the sprites' URLs must be unique, but ${h[I].url} is duplicated`)),S.push(h[I].url),c=c.concat(Oi({key:`${p}[${I}]`,value:h[I],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:u.validateSpec}));return c}return Jo({key:p,value:h})}const Ei={"*":()=>[],array:sA,boolean:function(u){const c=u.value,h=u.key,p=ce(c);return p!=="boolean"?[new fe(h,c,`boolean expected, ${p} found`)]:[]},number:fu,color:function(u){const c=u.key,h=u.value,p=ce(h);return p!=="string"?[new fe(c,h,`color expected, ${p} found`)]:Br.parse(String(h))?[]:[new fe(c,h,`color expected, "${h}" found`)]},constants:du,enum:$i,filter:eo,function:qa,layer:wa,object:Oi,source:Co,light:xa,sky:Fc,terrain:Ba,string:Jo,formatted:function(u){return Jo(u).length===0?[]:Di(u)},resolvedImage:function(u){return Jo(u).length===0?[]:Di(u)},padding:function(u){const c=u.key,h=u.value;if(ce(h)==="array"){if(h.length<1||h.length>4)return[new fe(c,h,`padding requires 1 to 4 values; ${h.length} values found`)];const p={type:"number"};let b=[];for(let S=0;S<h.length;S++)b=b.concat(u.validateSpec({key:`${c}[${S}]`,value:h[S],validateSpec:u.validateSpec,valueSpec:p}));return b}return fu({key:c,value:h,valueSpec:{}})},variableAnchorOffsetCollection:function(u){const c=u.key,h=u.value,p=ce(h),b=u.styleSpec;if(p!=="array"||h.length<1||h.length%2!=0)return[new fe(c,h,"variableAnchorOffsetCollection requires a non-empty array of even length")];let S=[];for(let I=0;I<h.length;I+=2)S=S.concat($i({key:`${c}[${I}]`,value:h[I],valueSpec:b.layout_symbol["text-anchor"]})),S=S.concat(sA({key:`${c}[${I+1}]`,value:h[I+1],valueSpec:{length:2,value:"number"},validateSpec:u.validateSpec,style:u.style,styleSpec:b}));return S},sprite:Yo};function zs(u){const c=u.value,h=u.valueSpec,p=u.styleSpec;return u.validateSpec=zs,h.expression&&Me(Xn(c))?qa(u):h.expression&&Xr(Ki(c))?Di(u):h.type&&Ei[h.type]?Ei[h.type](u):Oi(Ir({},u,{valueSpec:h.type?p[h.type]:h}))}function Gs(u){const c=u.value,h=u.key,p=Jo(u);return p.length||(c.indexOf("{fontstack}")===-1&&p.push(new fe(h,c,'"glyphs" url must include a "{fontstack}" token')),c.indexOf("{range}")===-1&&p.push(new fe(h,c,'"glyphs" url must include a "{range}" token'))),p}function Ni(u){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Jt,h=[];return h=h.concat(zs({key:"",value:u,valueSpec:c.$root,styleSpec:c,style:u,validateSpec:zs,objectElementValidators:{glyphs:Gs,"*":()=>[]}})),u.constants&&(h=h.concat(du({key:"constants",value:u.constants,style:u,styleSpec:c,validateSpec:zs}))),Ln(h)}function vn(u){return function(c){return u({...c,validateSpec:zs})}}function Ln(u){return[].concat(u).sort((c,h)=>c.line-h.line)}function Fn(u){return function(){for(var c=arguments.length,h=new Array(c),p=0;p<c;p++)h[p]=arguments[p];return Ln(u.apply(this,h))}}Ni.source=Fn(vn(Co)),Ni.sprite=Fn(vn(Yo)),Ni.glyphs=Fn(vn(Gs)),Ni.light=Fn(vn(xa)),Ni.sky=Fn(vn(Fc)),Ni.terrain=Fn(vn(Ba)),Ni.layer=Fn(vn(wa)),Ni.filter=Fn(vn(eo)),Ni.paintProperty=Fn(vn(Lc)),Ni.layoutProperty=Fn(vn(ro));const ei=Ni,$a=ei.light,Ca=ei.paintProperty,pu=ei.layoutProperty;function Wa(u,c){let h=!1;if(c&&c.length)for(const p of c)u.fire(new ge(new Error(p.message))),h=!0;return h}class gu{constructor(c,h,p){const b=this.cells=[];if(c instanceof ArrayBuffer){this.arrayBuffer=c;const I=new Int32Array(this.arrayBuffer);c=I[0],this.d=(h=I[1])+2*(p=I[2]);for(let O=0;O<this.d*this.d;O++){const G=I[3+O],K=I[3+O+1];b.push(G===K?null:I.subarray(G,K))}const F=I[3+b.length+1];this.keys=I.subarray(I[3+b.length],F),this.bboxes=I.subarray(F),this.insert=this._insertReadonly}else{this.d=h+2*p;for(let I=0;I<this.d*this.d;I++)b.push([]);this.keys=[],this.bboxes=[]}this.n=h,this.extent=c,this.padding=p,this.scale=h/c,this.uid=0;const S=p/h*c;this.min=-S,this.max=c+S}insert(c,h,p,b,S){this._forEachCell(h,p,b,S,this._insertCell,this.uid++,void 0,void 0),this.keys.push(c),this.bboxes.push(h),this.bboxes.push(p),this.bboxes.push(b),this.bboxes.push(S)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(c,h,p,b,S,I){this.cells[S].push(I)}query(c,h,p,b,S){const I=this.min,F=this.max;if(c<=I&&h<=I&&F<=p&&F<=b&&!S)return Array.prototype.slice.call(this.keys);{const O=[];return this._forEachCell(c,h,p,b,this._queryCell,O,{},S),O}}_queryCell(c,h,p,b,S,I,F,O){const G=this.cells[S];if(G!==null){const K=this.keys,X=this.bboxes;for(let nt=0;nt<G.length;nt++){const at=G[nt];if(F[at]===void 0){const ut=4*at;(O?O(X[ut+0],X[ut+1],X[ut+2],X[ut+3]):c<=X[ut+2]&&h<=X[ut+3]&&p>=X[ut+0]&&b>=X[ut+1])?(F[at]=!0,I.push(K[at])):F[at]=!1}}}}_forEachCell(c,h,p,b,S,I,F,O){const G=this._convertToCellCoord(c),K=this._convertToCellCoord(h),X=this._convertToCellCoord(p),nt=this._convertToCellCoord(b);for(let at=G;at<=X;at++)for(let ut=K;ut<=nt;ut++){const Bt=this.d*ut+at;if((!O||O(this._convertFromCellCoord(at),this._convertFromCellCoord(ut),this._convertFromCellCoord(at+1),this._convertFromCellCoord(ut+1)))&&S.call(this,c,h,p,b,Bt,I,F,O))return}}_convertFromCellCoord(c){return(c-this.padding)/this.scale}_convertToCellCoord(c){return Math.max(0,Math.min(this.d-1,Math.floor(c*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const c=this.cells,h=3+this.cells.length+1+1;let p=0;for(let I=0;I<this.cells.length;I++)p+=this.cells[I].length;const b=new Int32Array(h+p+this.keys.length+this.bboxes.length);b[0]=this.extent,b[1]=this.n,b[2]=this.padding;let S=h;for(let I=0;I<c.length;I++){const F=c[I];b[3+I]=S,b.set(F,S),S+=F.length}return b[3+c.length]=S,b.set(this.keys,S),S+=this.keys.length,b[3+c.length+1]=S,b.set(this.bboxes,S),S+=this.bboxes.length,b.buffer}static serialize(c,h){const p=c.toArrayBuffer();return h&&h.push(p),{buffer:p}}static deserialize(c){return new gu(c.buffer)}}const Zo={};function tr(u,c){let h=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(Zo[u])throw new Error(`${u} is already registered.`);Object.defineProperty(c,"_classRegistryKey",{value:u,writeable:!1}),Zo[u]={klass:c,omit:h.omit||[],shallow:h.shallow||[]}}tr("Object",Object),tr("TransferableGridIndex",gu),tr("Color",Br),tr("Error",Error),tr("AJAXError",ae),tr("ResolvedImage",cs),tr("StylePropertyFunction",ml),tr("StyleExpression",Kr,{omit:["_evaluator"]}),tr("ZoomDependentExpression",Hs),tr("ZoomConstantExpression",Qs),tr("CompoundExpression",vi,{omit:["_evaluate"]});for(const u in Wo)Wo[u]._classRegistryKey||tr(`Expression_${u}`,Wo[u]);function oA(u){return u&&typeof ArrayBuffer<"u"&&(u instanceof ArrayBuffer||u.constructor&&u.constructor.name==="ArrayBuffer")}function bl(u,c){if(u==null||typeof u=="boolean"||typeof u=="number"||typeof u=="string"||u instanceof Boolean||u instanceof Number||u instanceof String||u instanceof Date||u instanceof RegExp||u instanceof Blob||u instanceof Error)return u;if(oA(u)||Xt(u))return c&&c.push(u),u;if(ArrayBuffer.isView(u)){const h=u;return c&&c.push(h.buffer),h}if(u instanceof ImageData)return c&&c.push(u.data.buffer),u;if(Array.isArray(u)){const h=[];for(const p of u)h.push(bl(p,c));return h}if(typeof u=="object"){const h=u.constructor,p=h._classRegistryKey;if(!p)throw new Error(`can't serialize object of unregistered class ${h.name}`);if(!Zo[p])throw new Error(`${p} is not registered.`);const b=h.serialize?h.serialize(u,c):{};if(h.serialize){if(c&&b===c[c.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const S in u){if(!u.hasOwnProperty(S)||Zo[p].omit.indexOf(S)>=0)continue;const I=u[S];b[S]=Zo[p].shallow.indexOf(S)>=0?I:bl(I,c)}u instanceof Error&&(b.message=u.message)}if(b.$name)throw new Error("$name property is reserved for worker serialization logic.");return p!=="Object"&&(b.$name=p),b}throw new Error("can't serialize object of type "+typeof u)}function wl(u){if(u==null||typeof u=="boolean"||typeof u=="number"||typeof u=="string"||u instanceof Boolean||u instanceof Number||u instanceof String||u instanceof Date||u instanceof RegExp||u instanceof Blob||u instanceof Error||oA(u)||Xt(u)||ArrayBuffer.isView(u)||u instanceof ImageData)return u;if(Array.isArray(u))return u.map(wl);if(typeof u=="object"){const c=u.$name||"Object";if(!Zo[c])throw new Error(`can't deserialize unregistered class ${c}`);const{klass:h}=Zo[c];if(!h)throw new Error(`can't deserialize unregistered class ${c}`);if(h.deserialize)return h.deserialize(u);const p=Object.create(h.prototype);for(const b of Object.keys(u)){if(b==="$name")continue;const S=u[b];p[b]=Zo[c].shallow.indexOf(b)>=0?S:wl(S)}return p}throw new Error("can't deserialize object of type "+typeof u)}class lh{constructor(){this.first=!0}update(c,h){const p=Math.floor(c);return this.first?(this.first=!1,this.lastIntegerZoom=p,this.lastIntegerZoomTime=0,this.lastZoom=c,this.lastFloorZoom=p,!0):(this.lastFloorZoom>p?(this.lastIntegerZoom=p+1,this.lastIntegerZoomTime=h):this.lastFloorZoom<p&&(this.lastIntegerZoom=p,this.lastIntegerZoomTime=h),c!==this.lastZoom&&(this.lastZoom=c,this.lastFloorZoom=p,!0))}}const qe={"Latin-1 Supplement":u=>u>=128&&u<=255,Arabic:u=>u>=1536&&u<=1791,"Arabic Supplement":u=>u>=1872&&u<=1919,"Arabic Extended-A":u=>u>=2208&&u<=2303,"Hangul Jamo":u=>u>=4352&&u<=4607,"Unified Canadian Aboriginal Syllabics":u=>u>=5120&&u<=5759,Khmer:u=>u>=6016&&u<=6143,"Unified Canadian Aboriginal Syllabics Extended":u=>u>=6320&&u<=6399,"General Punctuation":u=>u>=8192&&u<=8303,"Letterlike Symbols":u=>u>=8448&&u<=8527,"Number Forms":u=>u>=8528&&u<=8591,"Miscellaneous Technical":u=>u>=8960&&u<=9215,"Control Pictures":u=>u>=9216&&u<=9279,"Optical Character Recognition":u=>u>=9280&&u<=9311,"Enclosed Alphanumerics":u=>u>=9312&&u<=9471,"Geometric Shapes":u=>u>=9632&&u<=9727,"Miscellaneous Symbols":u=>u>=9728&&u<=9983,"Miscellaneous Symbols and Arrows":u=>u>=11008&&u<=11263,"CJK Radicals Supplement":u=>u>=11904&&u<=12031,"Kangxi Radicals":u=>u>=12032&&u<=12255,"Ideographic Description Characters":u=>u>=12272&&u<=12287,"CJK Symbols and Punctuation":u=>u>=12288&&u<=12351,Hiragana:u=>u>=12352&&u<=12447,Katakana:u=>u>=12448&&u<=12543,Bopomofo:u=>u>=12544&&u<=12591,"Hangul Compatibility Jamo":u=>u>=12592&&u<=12687,Kanbun:u=>u>=12688&&u<=12703,"Bopomofo Extended":u=>u>=12704&&u<=12735,"CJK Strokes":u=>u>=12736&&u<=12783,"Katakana Phonetic Extensions":u=>u>=12784&&u<=12799,"Enclosed CJK Letters and Months":u=>u>=12800&&u<=13055,"CJK Compatibility":u=>u>=13056&&u<=13311,"CJK Unified Ideographs Extension A":u=>u>=13312&&u<=19903,"Yijing Hexagram Symbols":u=>u>=19904&&u<=19967,"CJK Unified Ideographs":u=>u>=19968&&u<=40959,"Yi Syllables":u=>u>=40960&&u<=42127,"Yi Radicals":u=>u>=42128&&u<=42191,"Hangul Jamo Extended-A":u=>u>=43360&&u<=43391,"Hangul Syllables":u=>u>=44032&&u<=55215,"Hangul Jamo Extended-B":u=>u>=55216&&u<=55295,"Private Use Area":u=>u>=57344&&u<=63743,"CJK Compatibility Ideographs":u=>u>=63744&&u<=64255,"Arabic Presentation Forms-A":u=>u>=64336&&u<=65023,"Vertical Forms":u=>u>=65040&&u<=65055,"CJK Compatibility Forms":u=>u>=65072&&u<=65103,"Small Form Variants":u=>u>=65104&&u<=65135,"Arabic Presentation Forms-B":u=>u>=65136&&u<=65279,"Halfwidth and Fullwidth Forms":u=>u>=65280&&u<=65519};function Wi(u){for(const c of u)if(xl(c.charCodeAt(0)))return!0;return!1}function no(u){for(const c of u)if(!aA(c.charCodeAt(0)))return!1;return!0}function aA(u){return!(qe.Arabic(u)||qe["Arabic Supplement"](u)||qe["Arabic Extended-A"](u)||qe["Arabic Presentation Forms-A"](u)||qe["Arabic Presentation Forms-B"](u))}function xl(u){return!(u!==746&&u!==747&&(u<4352||!(qe["Bopomofo Extended"](u)||qe.Bopomofo(u)||qe["CJK Compatibility Forms"](u)&&!(u>=65097&&u<=65103)||qe["CJK Compatibility Ideographs"](u)||qe["CJK Compatibility"](u)||qe["CJK Radicals Supplement"](u)||qe["CJK Strokes"](u)||!(!qe["CJK Symbols and Punctuation"](u)||u>=12296&&u<=12305||u>=12308&&u<=12319||u===12336)||qe["CJK Unified Ideographs Extension A"](u)||qe["CJK Unified Ideographs"](u)||qe["Enclosed CJK Letters and Months"](u)||qe["Hangul Compatibility Jamo"](u)||qe["Hangul Jamo Extended-A"](u)||qe["Hangul Jamo Extended-B"](u)||qe["Hangul Jamo"](u)||qe["Hangul Syllables"](u)||qe.Hiragana(u)||qe["Ideographic Description Characters"](u)||qe.Kanbun(u)||qe["Kangxi Radicals"](u)||qe["Katakana Phonetic Extensions"](u)||qe.Katakana(u)&&u!==12540||!(!qe["Halfwidth and Fullwidth Forms"](u)||u===65288||u===65289||u===65293||u>=65306&&u<=65310||u===65339||u===65341||u===65343||u>=65371&&u<=65503||u===65507||u>=65512&&u<=65519)||!(!qe["Small Form Variants"](u)||u>=65112&&u<=65118||u>=65123&&u<=65126)||qe["Unified Canadian Aboriginal Syllabics"](u)||qe["Unified Canadian Aboriginal Syllabics Extended"](u)||qe["Vertical Forms"](u)||qe["Yijing Hexagram Symbols"](u)||qe["Yi Syllables"](u)||qe["Yi Radicals"](u))))}function uh(u){return!(xl(u)||function(c){return!!(qe["Latin-1 Supplement"](c)&&(c===167||c===169||c===174||c===177||c===188||c===189||c===190||c===215||c===247)||qe["General Punctuation"](c)&&(c===8214||c===8224||c===8225||c===8240||c===8241||c===8251||c===8252||c===8258||c===8263||c===8264||c===8265||c===8273)||qe["Letterlike Symbols"](c)||qe["Number Forms"](c)||qe["Miscellaneous Technical"](c)&&(c>=8960&&c<=8967||c>=8972&&c<=8991||c>=8996&&c<=9e3||c===9003||c>=9085&&c<=9114||c>=9150&&c<=9165||c===9167||c>=9169&&c<=9179||c>=9186&&c<=9215)||qe["Control Pictures"](c)&&c!==9251||qe["Optical Character Recognition"](c)||qe["Enclosed Alphanumerics"](c)||qe["Geometric Shapes"](c)||qe["Miscellaneous Symbols"](c)&&!(c>=9754&&c<=9759)||qe["Miscellaneous Symbols and Arrows"](c)&&(c>=11026&&c<=11055||c>=11088&&c<=11097||c>=11192&&c<=11243)||qe["CJK Symbols and Punctuation"](c)||qe.Katakana(c)||qe["Private Use Area"](c)||qe["CJK Compatibility Forms"](c)||qe["Small Form Variants"](c)||qe["Halfwidth and Fullwidth Forms"](c)||c===8734||c===8756||c===8757||c>=9984&&c<=10087||c>=10102&&c<=10131||c===65532||c===65533)}(u))}function Bl(u){return u>=1424&&u<=2303||qe["Arabic Presentation Forms-A"](u)||qe["Arabic Presentation Forms-B"](u)}function cA(u,c){return!(!c&&Bl(u)||u>=2304&&u<=3583||u>=3840&&u<=4255||qe.Khmer(u))}function wd(u){for(const c of u)if(Bl(c.charCodeAt(0)))return!0;return!1}const Xa=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(u){this.pluginStatus=u.pluginStatus,this.pluginURL=u.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(u){this.applyArabicShaping=u.applyArabicShaping,this.processBidirectionalText=u.processBidirectionalText,this.processStyledBidirectionalText=u.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class Gn{constructor(c,h){this.zoom=c,h?(this.now=h.now,this.fadeDuration=h.fadeDuration,this.zoomHistory=h.zoomHistory,this.transition=h.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new lh,this.transition={})}isSupportedScript(c){return function(h,p){for(const b of h)if(!cA(b.charCodeAt(0),p))return!1;return!0}(c,Xa.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const c=this.zoom,h=c-Math.floor(c),p=this.crossFadingFactor();return c>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:h+(1-h)*p}:{fromScale:.5,toScale:1,t:1-(1-p)*h}}}class Cl{constructor(c,h){this.property=c,this.value=h,this.expression=function(p,b){if(Me(p))return new ml(p,b);if(Xr(p)){const S=ba(p,b);if(S.result==="error")throw new Error(S.value.map(I=>`${I.key}: ${I.message}`).join(", "));return S.value}{let S=p;return b.type==="color"&&typeof p=="string"?S=Br.parse(p):b.type!=="padding"||typeof p!="number"&&!Array.isArray(p)?b.type==="variableAnchorOffsetCollection"&&Array.isArray(p)&&(S=Yn.parse(p)):S=sn.parse(p),{kind:"constant",evaluate:()=>S}}}(h===void 0?c.specification.default:h,c.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(c,h,p){return this.property.possiblyEvaluate(this,c,h,p)}}class El{constructor(c){this.property=c,this.value=new Cl(c,void 0)}transitioned(c,h){return new fp(this.property,this.value,h,mt({},c.transition,this.transition),c.now)}untransitioned(){return new fp(this.property,this.value,null,{},0)}}class lA{constructor(c){this._properties=c,this._values=Object.create(c.defaultTransitionablePropertyValues)}getValue(c){return st(this._values[c].value.value)}setValue(c,h){Object.prototype.hasOwnProperty.call(this._values,c)||(this._values[c]=new El(this._values[c].property)),this._values[c].value=new Cl(this._values[c].property,h===null?void 0:st(h))}getTransition(c){return st(this._values[c].transition)}setTransition(c,h){Object.prototype.hasOwnProperty.call(this._values,c)||(this._values[c]=new El(this._values[c].property)),this._values[c].transition=st(h)||void 0}serialize(){const c={};for(const h of Object.keys(this._values)){const p=this.getValue(h);p!==void 0&&(c[h]=p);const b=this.getTransition(h);b!==void 0&&(c[`${h}-transition`]=b)}return c}transitioned(c,h){const p=new pp(this._properties);for(const b of Object.keys(this._values))p._values[b]=this._values[b].transitioned(c,h._values[b]);return p}untransitioned(){const c=new pp(this._properties);for(const h of Object.keys(this._values))c._values[h]=this._values[h].untransitioned();return c}}class fp{constructor(c,h,p,b,S){this.property=c,this.value=h,this.begin=S+b.delay||0,this.end=this.begin+b.duration||0,c.specification.transition&&(b.delay||b.duration)&&(this.prior=p)}possiblyEvaluate(c,h,p){const b=c.now||0,S=this.value.possiblyEvaluate(c,h,p),I=this.prior;if(I){if(b>this.end)return this.prior=null,S;if(this.value.isDataDriven())return this.prior=null,S;if(b<this.begin)return I.possiblyEvaluate(c,h,p);{const F=(b-this.begin)/(this.end-this.begin);return this.property.interpolate(I.possiblyEvaluate(c,h,p),S,function(O){if(O<=0)return 0;if(O>=1)return 1;const G=O*O,K=G*O;return 4*(O<.5?K:3*(O-G)+K-.75)}(F))}}return S}}class pp{constructor(c){this._properties=c,this._values=Object.create(c.defaultTransitioningPropertyValues)}possiblyEvaluate(c,h,p){const b=new uA(this._properties);for(const S of Object.keys(this._values))b._values[S]=this._values[S].possiblyEvaluate(c,h,p);return b}hasTransition(){for(const c of Object.keys(this._values))if(this._values[c].prior)return!0;return!1}}class xd{constructor(c){this._properties=c,this._values=Object.create(c.defaultPropertyValues)}hasValue(c){return this._values[c].value!==void 0}getValue(c){return st(this._values[c].value)}setValue(c,h){this._values[c]=new Cl(this._values[c].property,h===null?void 0:st(h))}serialize(){const c={};for(const h of Object.keys(this._values)){const p=this.getValue(h);p!==void 0&&(c[h]=p)}return c}possiblyEvaluate(c,h,p){const b=new uA(this._properties);for(const S of Object.keys(this._values))b._values[S]=this._values[S].possiblyEvaluate(c,h,p);return b}}class ta{constructor(c,h,p){this.property=c,this.value=h,this.parameters=p}isConstant(){return this.value.kind==="constant"}constantOr(c){return this.value.kind==="constant"?this.value.value:c}evaluate(c,h,p,b){return this.property.evaluate(this.value,this.parameters,c,h,p,b)}}class uA{constructor(c){this._properties=c,this._values=Object.create(c.defaultPossiblyEvaluatedValues)}get(c){return this._values[c]}}class dr{constructor(c){this.specification=c}possiblyEvaluate(c,h){if(c.isDataDriven())throw new Error("Value should not be data driven");return c.expression.evaluate(h)}interpolate(c,h,p){const b=Ri[this.specification.type];return b?b(c,h,p):c}}class wr{constructor(c,h){this.specification=c,this.overrides=h}possiblyEvaluate(c,h,p,b){return new ta(this,c.expression.kind==="constant"||c.expression.kind==="camera"?{kind:"constant",value:c.expression.evaluate(h,null,{},p,b)}:c.expression,h)}interpolate(c,h,p){if(c.value.kind!=="constant"||h.value.kind!=="constant")return c;if(c.value.value===void 0||h.value.value===void 0)return new ta(this,{kind:"constant",value:void 0},c.parameters);const b=Ri[this.specification.type];if(b){const S=b(c.value.value,h.value.value,p);return new ta(this,{kind:"constant",value:S},c.parameters)}return c}evaluate(c,h,p,b,S,I){return c.kind==="constant"?c.value:c.evaluate(h,p,b,S,I)}}class Ah extends wr{possiblyEvaluate(c,h,p,b){if(c.value===void 0)return new ta(this,{kind:"constant",value:void 0},h);if(c.expression.kind==="constant"){const S=c.expression.evaluate(h,null,{},p,b),I=c.property.specification.type==="resolvedImage"&&typeof S!="string"?S.name:S,F=this._calculate(I,I,I,h);return new ta(this,{kind:"constant",value:F},h)}if(c.expression.kind==="camera"){const S=this._calculate(c.expression.evaluate({zoom:h.zoom-1}),c.expression.evaluate({zoom:h.zoom}),c.expression.evaluate({zoom:h.zoom+1}),h);return new ta(this,{kind:"constant",value:S},h)}return new ta(this,c.expression,h)}evaluate(c,h,p,b,S,I){if(c.kind==="source"){const F=c.evaluate(h,p,b,S,I);return this._calculate(F,F,F,h)}return c.kind==="composite"?this._calculate(c.evaluate({zoom:Math.floor(h.zoom)-1},p,b),c.evaluate({zoom:Math.floor(h.zoom)},p,b),c.evaluate({zoom:Math.floor(h.zoom)+1},p,b),h):c.value}_calculate(c,h,p,b){return b.zoom>b.zoomHistory.lastIntegerZoom?{from:c,to:h}:{from:p,to:h}}interpolate(c){return c}}class Sl{constructor(c){this.specification=c}possiblyEvaluate(c,h,p,b){if(c.value!==void 0){if(c.expression.kind==="constant"){const S=c.expression.evaluate(h,null,{},p,b);return this._calculate(S,S,S,h)}return this._calculate(c.expression.evaluate(new Gn(Math.floor(h.zoom-1),h)),c.expression.evaluate(new Gn(Math.floor(h.zoom),h)),c.expression.evaluate(new Gn(Math.floor(h.zoom+1),h)),h)}}_calculate(c,h,p,b){return b.zoom>b.zoomHistory.lastIntegerZoom?{from:c,to:h}:{from:p,to:h}}interpolate(c){return c}}class AA{constructor(c){this.specification=c}possiblyEvaluate(c,h,p,b){return!!c.expression.evaluate(h,null,{},p,b)}interpolate(){return!1}}class Xi{constructor(c){this.properties=c,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const h in c){const p=c[h];p.specification.overridable&&this.overridableProperties.push(h);const b=this.defaultPropertyValues[h]=new Cl(p,void 0),S=this.defaultTransitionablePropertyValues[h]=new El(p);this.defaultTransitioningPropertyValues[h]=S.untransitioned(),this.defaultPossiblyEvaluatedValues[h]=b.possiblyEvaluate({})}}}tr("DataDrivenProperty",wr),tr("DataConstantProperty",dr),tr("CrossFadedDataDrivenProperty",Ah),tr("CrossFadedProperty",Sl),tr("ColorRampProperty",AA);const Bd="-transition";class ea extends Ut{constructor(c,h){if(super(),this.id=c.id,this.type=c.type,this._featureFilter={filter:()=>!0,needGeometry:!1},c.type!=="custom"&&(this.metadata=c.metadata,this.minzoom=c.minzoom,this.maxzoom=c.maxzoom,c.type!=="background"&&(this.source=c.source,this.sourceLayer=c["source-layer"],this.filter=c.filter),h.layout&&(this._unevaluatedLayout=new xd(h.layout)),h.paint)){this._transitionablePaint=new lA(h.paint);for(const p in c.paint)this.setPaintProperty(p,c.paint[p],{validate:!1});for(const p in c.layout)this.setLayoutProperty(p,c.layout[p],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new uA(h.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(c){return c==="visibility"?this.visibility:this._unevaluatedLayout.getValue(c)}setLayoutProperty(c,h){let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};h!=null&&this._validate(pu,`layers.${this.id}.layout.${c}`,c,h,p)||(c!=="visibility"?this._unevaluatedLayout.setValue(c,h):this.visibility=h)}getPaintProperty(c){return c.endsWith(Bd)?this._transitionablePaint.getTransition(c.slice(0,-11)):this._transitionablePaint.getValue(c)}setPaintProperty(c,h){let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(h!=null&&this._validate(Ca,`layers.${this.id}.paint.${c}`,c,h,p))return!1;if(c.endsWith(Bd))return this._transitionablePaint.setTransition(c.slice(0,-11),h||void 0),!1;{const b=this._transitionablePaint._values[c],S=b.property.specification["property-type"]==="cross-faded-data-driven",I=b.value.isDataDriven(),F=b.value;this._transitionablePaint.setValue(c,h),this._handleSpecialPaintPropertyUpdate(c);const O=this._transitionablePaint._values[c].value;return O.isDataDriven()||I||S||this._handleOverridablePaintPropertyUpdate(c,F,O)}}_handleSpecialPaintPropertyUpdate(c){}_handleOverridablePaintPropertyUpdate(c,h,p){return!1}isHidden(c){return!!(this.minzoom&&c<this.minzoom)||!!(this.maxzoom&&c>=this.maxzoom)||this.visibility==="none"}updateTransitions(c){this._transitioningPaint=this._transitionablePaint.transitioned(c,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(c,h){c.getCrossfadeParameters&&(this._crossfadeParameters=c.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(c,void 0,h)),this.paint=this._transitioningPaint.possiblyEvaluate(c,void 0,h)}serialize(){const c={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(c.layout=c.layout||{},c.layout.visibility=this.visibility),Lt(c,(h,p)=>!(h===void 0||p==="layout"&&!Object.keys(h).length||p==="paint"&&!Object.keys(h).length))}_validate(c,h,p,b){let S=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};return(!S||S.validate!==!1)&&Wa(this,c.call(ei,{key:h,layerType:this.type,objectKey:p,value:b,styleSpec:Jt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const c in this.paint._values){const h=this.paint.get(c);if(h instanceof ta&&Pt(h.property.specification)&&(h.value.kind==="source"||h.value.kind==="composite")&&h.value.isStateDependent)return!0}return!1}}const Cd={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class hA{constructor(c,h){this._structArray=c,this._pos1=h*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class di{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(c,h){return c._trim(),h&&(c.isTransferred=!0,h.push(c.arrayBuffer)),{length:c.length,arrayBuffer:c.arrayBuffer}}static deserialize(c){const h=Object.create(this.prototype);return h.arrayBuffer=c.arrayBuffer,h.length=c.length,h.capacity=c.arrayBuffer.byteLength/h.bytesPerElement,h._refreshViews(),h}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(c){this.reserve(c),this.length=c}reserve(c){if(c>this.capacity){this.capacity=Math.max(c,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const h=this.uint8;this._refreshViews(),h&&this.uint8.set(h)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Si(u){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,h=0,p=0;return{members:u.map(b=>{const S=Cd[b.type].BYTES_PER_ELEMENT,I=h=gp(h,Math.max(c,S)),F=b.components||1;return p=Math.max(p,S),h+=S*F,{name:b.name,type:b.type,components:F,offset:I}}),size:gp(h,Math.max(p,c)),alignment:c}}function gp(u,c){return Math.ceil(u/c)*c}class Eo extends di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,h){const p=this.length;return this.resize(p+1),this.emplace(p,c,h)}emplace(c,h,p){const b=2*c;return this.int16[b+0]=h,this.int16[b+1]=p,c}}Eo.prototype.bytesPerElement=4,tr("StructArrayLayout2i4",Eo);class ki extends di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,h,p){const b=this.length;return this.resize(b+1),this.emplace(b,c,h,p)}emplace(c,h,p,b){const S=3*c;return this.int16[S+0]=h,this.int16[S+1]=p,this.int16[S+2]=b,c}}ki.prototype.bytesPerElement=6,tr("StructArrayLayout3i6",ki);class ra extends di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,h,p,b){const S=this.length;return this.resize(S+1),this.emplace(S,c,h,p,b)}emplace(c,h,p,b,S){const I=4*c;return this.int16[I+0]=h,this.int16[I+1]=p,this.int16[I+2]=b,this.int16[I+3]=S,c}}ra.prototype.bytesPerElement=8,tr("StructArrayLayout4i8",ra);class Ed extends di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,h,p,b,S,I){const F=this.length;return this.resize(F+1),this.emplace(F,c,h,p,b,S,I)}emplace(c,h,p,b,S,I,F){const O=6*c;return this.int16[O+0]=h,this.int16[O+1]=p,this.int16[O+2]=b,this.int16[O+3]=S,this.int16[O+4]=I,this.int16[O+5]=F,c}}Ed.prototype.bytesPerElement=12,tr("StructArrayLayout2i4i12",Ed);class hh extends di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,h,p,b,S,I){const F=this.length;return this.resize(F+1),this.emplace(F,c,h,p,b,S,I)}emplace(c,h,p,b,S,I,F){const O=4*c,G=8*c;return this.int16[O+0]=h,this.int16[O+1]=p,this.uint8[G+4]=b,this.uint8[G+5]=S,this.uint8[G+6]=I,this.uint8[G+7]=F,c}}hh.prototype.bytesPerElement=8,tr("StructArrayLayout2i4ub8",hh);class So extends di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,h){const p=this.length;return this.resize(p+1),this.emplace(p,c,h)}emplace(c,h,p){const b=2*c;return this.float32[b+0]=h,this.float32[b+1]=p,c}}So.prototype.bytesPerElement=8,tr("StructArrayLayout2f8",So);class Ts extends di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,h,p,b,S,I,F,O,G,K){const X=this.length;return this.resize(X+1),this.emplace(X,c,h,p,b,S,I,F,O,G,K)}emplace(c,h,p,b,S,I,F,O,G,K,X){const nt=10*c;return this.uint16[nt+0]=h,this.uint16[nt+1]=p,this.uint16[nt+2]=b,this.uint16[nt+3]=S,this.uint16[nt+4]=I,this.uint16[nt+5]=F,this.uint16[nt+6]=O,this.uint16[nt+7]=G,this.uint16[nt+8]=K,this.uint16[nt+9]=X,c}}Ts.prototype.bytesPerElement=20,tr("StructArrayLayout10ui20",Ts);class Sd extends di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,h,p,b,S,I,F,O,G,K,X,nt){const at=this.length;return this.resize(at+1),this.emplace(at,c,h,p,b,S,I,F,O,G,K,X,nt)}emplace(c,h,p,b,S,I,F,O,G,K,X,nt,at){const ut=12*c;return this.int16[ut+0]=h,this.int16[ut+1]=p,this.int16[ut+2]=b,this.int16[ut+3]=S,this.uint16[ut+4]=I,this.uint16[ut+5]=F,this.uint16[ut+6]=O,this.uint16[ut+7]=G,this.int16[ut+8]=K,this.int16[ut+9]=X,this.int16[ut+10]=nt,this.int16[ut+11]=at,c}}Sd.prototype.bytesPerElement=24,tr("StructArrayLayout4i4ui4i24",Sd);class Td extends di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,h,p){const b=this.length;return this.resize(b+1),this.emplace(b,c,h,p)}emplace(c,h,p,b){const S=3*c;return this.float32[S+0]=h,this.float32[S+1]=p,this.float32[S+2]=b,c}}Td.prototype.bytesPerElement=12,tr("StructArrayLayout3f12",Td);class Ea extends di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(c){const h=this.length;return this.resize(h+1),this.emplace(h,c)}emplace(c,h){return this.uint32[1*c+0]=h,c}}Ea.prototype.bytesPerElement=4,tr("StructArrayLayout1ul4",Ea);class dA extends di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,h,p,b,S,I,F,O,G){const K=this.length;return this.resize(K+1),this.emplace(K,c,h,p,b,S,I,F,O,G)}emplace(c,h,p,b,S,I,F,O,G,K){const X=10*c,nt=5*c;return this.int16[X+0]=h,this.int16[X+1]=p,this.int16[X+2]=b,this.int16[X+3]=S,this.int16[X+4]=I,this.int16[X+5]=F,this.uint32[nt+3]=O,this.uint16[X+8]=G,this.uint16[X+9]=K,c}}dA.prototype.bytesPerElement=20,tr("StructArrayLayout6i1ul2ui20",dA);class mu extends di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,h,p,b,S,I){const F=this.length;return this.resize(F+1),this.emplace(F,c,h,p,b,S,I)}emplace(c,h,p,b,S,I,F){const O=6*c;return this.int16[O+0]=h,this.int16[O+1]=p,this.int16[O+2]=b,this.int16[O+3]=S,this.int16[O+4]=I,this.int16[O+5]=F,c}}mu.prototype.bytesPerElement=12,tr("StructArrayLayout2i2i2i12",mu);class fA extends di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,h,p,b,S){const I=this.length;return this.resize(I+1),this.emplace(I,c,h,p,b,S)}emplace(c,h,p,b,S,I){const F=4*c,O=8*c;return this.float32[F+0]=h,this.float32[F+1]=p,this.float32[F+2]=b,this.int16[O+6]=S,this.int16[O+7]=I,c}}fA.prototype.bytesPerElement=16,tr("StructArrayLayout2f1f2i16",fA);class pA extends di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,h,p,b){const S=this.length;return this.resize(S+1),this.emplace(S,c,h,p,b)}emplace(c,h,p,b,S){const I=12*c,F=3*c;return this.uint8[I+0]=h,this.uint8[I+1]=p,this.float32[F+1]=b,this.float32[F+2]=S,c}}pA.prototype.bytesPerElement=12,tr("StructArrayLayout2ub2f12",pA);class Tl extends di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,h,p){const b=this.length;return this.resize(b+1),this.emplace(b,c,h,p)}emplace(c,h,p,b){const S=3*c;return this.uint16[S+0]=h,this.uint16[S+1]=p,this.uint16[S+2]=b,c}}Tl.prototype.bytesPerElement=6,tr("StructArrayLayout3ui6",Tl);class Ja extends di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,h,p,b,S,I,F,O,G,K,X,nt,at,ut,Bt,It,Nt){const ee=this.length;return this.resize(ee+1),this.emplace(ee,c,h,p,b,S,I,F,O,G,K,X,nt,at,ut,Bt,It,Nt)}emplace(c,h,p,b,S,I,F,O,G,K,X,nt,at,ut,Bt,It,Nt,ee){const Ht=24*c,Kt=12*c,ve=48*c;return this.int16[Ht+0]=h,this.int16[Ht+1]=p,this.uint16[Ht+2]=b,this.uint16[Ht+3]=S,this.uint32[Kt+2]=I,this.uint32[Kt+3]=F,this.uint32[Kt+4]=O,this.uint16[Ht+10]=G,this.uint16[Ht+11]=K,this.uint16[Ht+12]=X,this.float32[Kt+7]=nt,this.float32[Kt+8]=at,this.uint8[ve+36]=ut,this.uint8[ve+37]=Bt,this.uint8[ve+38]=It,this.uint32[Kt+10]=Nt,this.int16[Ht+22]=ee,c}}Ja.prototype.bytesPerElement=48,tr("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Ja);class na extends di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,h,p,b,S,I,F,O,G,K,X,nt,at,ut,Bt,It,Nt,ee,Ht,Kt,ve,be,Ze,hr,Xe,$e,ke,or){const je=this.length;return this.resize(je+1),this.emplace(je,c,h,p,b,S,I,F,O,G,K,X,nt,at,ut,Bt,It,Nt,ee,Ht,Kt,ve,be,Ze,hr,Xe,$e,ke,or)}emplace(c,h,p,b,S,I,F,O,G,K,X,nt,at,ut,Bt,It,Nt,ee,Ht,Kt,ve,be,Ze,hr,Xe,$e,ke,or,je){const Fe=32*c,Cr=16*c;return this.int16[Fe+0]=h,this.int16[Fe+1]=p,this.int16[Fe+2]=b,this.int16[Fe+3]=S,this.int16[Fe+4]=I,this.int16[Fe+5]=F,this.int16[Fe+6]=O,this.int16[Fe+7]=G,this.uint16[Fe+8]=K,this.uint16[Fe+9]=X,this.uint16[Fe+10]=nt,this.uint16[Fe+11]=at,this.uint16[Fe+12]=ut,this.uint16[Fe+13]=Bt,this.uint16[Fe+14]=It,this.uint16[Fe+15]=Nt,this.uint16[Fe+16]=ee,this.uint16[Fe+17]=Ht,this.uint16[Fe+18]=Kt,this.uint16[Fe+19]=ve,this.uint16[Fe+20]=be,this.uint16[Fe+21]=Ze,this.uint16[Fe+22]=hr,this.uint32[Cr+12]=Xe,this.float32[Cr+13]=$e,this.float32[Cr+14]=ke,this.uint16[Fe+30]=or,this.uint16[Fe+31]=je,c}}na.prototype.bytesPerElement=64,tr("StructArrayLayout8i15ui1ul2f2ui64",na);class yu extends di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c){const h=this.length;return this.resize(h+1),this.emplace(h,c)}emplace(c,h){return this.float32[1*c+0]=h,c}}yu.prototype.bytesPerElement=4,tr("StructArrayLayout1f4",yu);class gA extends di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,h,p){const b=this.length;return this.resize(b+1),this.emplace(b,c,h,p)}emplace(c,h,p,b){const S=3*c;return this.uint16[6*c+0]=h,this.float32[S+1]=p,this.float32[S+2]=b,c}}gA.prototype.bytesPerElement=12,tr("StructArrayLayout1ui2f12",gA);class Il extends di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,h,p){const b=this.length;return this.resize(b+1),this.emplace(b,c,h,p)}emplace(c,h,p,b){const S=4*c;return this.uint32[2*c+0]=h,this.uint16[S+2]=p,this.uint16[S+3]=b,c}}Il.prototype.bytesPerElement=8,tr("StructArrayLayout1ul2ui8",Il);class dh extends di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,h){const p=this.length;return this.resize(p+1),this.emplace(p,c,h)}emplace(c,h,p){const b=2*c;return this.uint16[b+0]=h,this.uint16[b+1]=p,c}}dh.prototype.bytesPerElement=4,tr("StructArrayLayout2ui4",dh);class Id extends di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c){const h=this.length;return this.resize(h+1),this.emplace(h,c)}emplace(c,h){return this.uint16[1*c+0]=h,c}}Id.prototype.bytesPerElement=2,tr("StructArrayLayout1ui2",Id);class fh extends di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,h,p,b){const S=this.length;return this.resize(S+1),this.emplace(S,c,h,p,b)}emplace(c,h,p,b,S){const I=4*c;return this.float32[I+0]=h,this.float32[I+1]=p,this.float32[I+2]=b,this.float32[I+3]=S,c}}fh.prototype.bytesPerElement=16,tr("StructArrayLayout4f16",fh);class mp extends hA{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new _(this.anchorPointX,this.anchorPointY)}}mp.prototype.size=20;class C extends dA{get(c){return new mp(this,c)}}tr("CollisionBoxArray",C);class l extends hA{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(c){this._structArray.uint8[this._pos1+37]=c}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(c){this._structArray.uint8[this._pos1+38]=c}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(c){this._structArray.uint32[this._pos4+10]=c}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}l.prototype.size=48;class d extends Ja{get(c){return new l(this,c)}}tr("PlacedSymbolArray",d);class y extends hA{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(c){this._structArray.uint32[this._pos4+12]=c}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}y.prototype.size=64;class v extends na{get(c){return new y(this,c)}}tr("SymbolInstanceArray",v);class E extends yu{getoffsetX(c){return this.float32[1*c+0]}}tr("GlyphOffsetArray",E);class U extends ki{getx(c){return this.int16[3*c+0]}gety(c){return this.int16[3*c+1]}gettileUnitDistanceFromAnchor(c){return this.int16[3*c+2]}}tr("SymbolLineVertexArray",U);class R extends hA{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}R.prototype.size=12;class g extends gA{get(c){return new R(this,c)}}tr("TextAnchorOffsetArray",g);class w extends hA{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}w.prototype.size=8;class T extends Il{get(c){return new w(this,c)}}tr("FeatureIndexArray",T);class L extends Eo{}class D extends Eo{}class H extends Eo{}class z extends Ed{}class j extends hh{}class V extends So{}class W extends Ts{}class lt extends Sd{}class rt extends Td{}class ht extends Ea{}class gt extends mu{}class Mt extends pA{}class Tt extends Tl{}class _t extends dh{}const bt=Si([{name:"a_pos",components:2,type:"Int16"}],4),{members:Gt}=bt;class Wt{constructor(){let c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];this.segments=c}prepareSegment(c,h,p,b){let S=this.segments[this.segments.length-1];return c>Wt.MAX_VERTEX_ARRAY_LENGTH&&wt(`Max vertices per segment is ${Wt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${c}`),(!S||S.vertexLength+c>Wt.MAX_VERTEX_ARRAY_LENGTH||S.sortKey!==b)&&(S={vertexOffset:h.length,primitiveOffset:p.length,vertexLength:0,primitiveLength:0},b!==void 0&&(S.sortKey=b),this.segments.push(S)),S}get(){return this.segments}destroy(){for(const c of this.segments)for(const h in c.vaos)c.vaos[h].destroy()}static simpleSegment(c,h,p,b){return new Wt([{vertexOffset:c,primitiveOffset:h,vertexLength:p,primitiveLength:b,vaos:{},sortKey:0}])}}function ue(u,c){return 256*(u=ft(Math.floor(u),0,255))+ft(Math.floor(c),0,255)}Wt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,tr("SegmentVector",Wt);const Ae=Si([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var ye={exports:{}},Oe={exports:{}};Oe.exports=function(u,c){var h,p,b,S,I,F,O,G;for(p=u.length-(h=3&u.length),b=c,I=3432918353,F=461845907,G=0;G<p;)O=255&u.charCodeAt(G)|(255&u.charCodeAt(++G))<<8|(255&u.charCodeAt(++G))<<16|(255&u.charCodeAt(++G))<<24,++G,b=27492+(65535&(S=5*(65535&(b=(b^=O=(65535&(O=(O=(65535&O)*I+(((O>>>16)*I&65535)<<16)&4294967295)<<15|O>>>17))*F+(((O>>>16)*F&65535)<<16)&4294967295)<<13|b>>>19))+((5*(b>>>16)&65535)<<16)&4294967295))+((58964+(S>>>16)&65535)<<16);switch(O=0,h){case 3:O^=(255&u.charCodeAt(G+2))<<16;case 2:O^=(255&u.charCodeAt(G+1))<<8;case 1:b^=O=(65535&(O=(O=(65535&(O^=255&u.charCodeAt(G)))*I+(((O>>>16)*I&65535)<<16)&4294967295)<<15|O>>>17))*F+(((O>>>16)*F&65535)<<16)&4294967295}return b^=u.length,b=2246822507*(65535&(b^=b>>>16))+((2246822507*(b>>>16)&65535)<<16)&4294967295,b=3266489909*(65535&(b^=b>>>13))+((3266489909*(b>>>16)&65535)<<16)&4294967295,(b^=b>>>16)>>>0};var Ce=Oe.exports,We={exports:{}};We.exports=function(u,c){for(var h,p=u.length,b=c^p,S=0;p>=4;)h=1540483477*(65535&(h=255&u.charCodeAt(S)|(255&u.charCodeAt(++S))<<8|(255&u.charCodeAt(++S))<<16|(255&u.charCodeAt(++S))<<24))+((1540483477*(h>>>16)&65535)<<16),b=1540483477*(65535&b)+((1540483477*(b>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),p-=4,++S;switch(p){case 3:b^=(255&u.charCodeAt(S+2))<<16;case 2:b^=(255&u.charCodeAt(S+1))<<8;case 1:b=1540483477*(65535&(b^=255&u.charCodeAt(S)))+((1540483477*(b>>>16)&65535)<<16)}return b=1540483477*(65535&(b^=b>>>13))+((1540483477*(b>>>16)&65535)<<16),(b^=b>>>15)>>>0};var nr=Ce,rr=We.exports;ye.exports=nr,ye.exports.murmur3=nr,ye.exports.murmur2=rr;var Sr=A(ye.exports);class Fr{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(c,h,p,b){this.ids.push(tn(c)),this.positions.push(h,p,b)}getPositions(c){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const h=tn(c);let p=0,b=this.ids.length-1;for(;p<b;){const I=p+b>>1;this.ids[I]>=h?b=I:p=I+1}const S=[];for(;this.ids[p]===h;)S.push({index:this.positions[3*p],start:this.positions[3*p+1],end:this.positions[3*p+2]}),p++;return S}static serialize(c,h){const p=new Float64Array(c.ids),b=new Uint32Array(c.positions);return xr(p,b,0,p.length-1),h&&h.push(p.buffer,b.buffer),{ids:p,positions:b}}static deserialize(c){const h=new Fr;return h.ids=c.ids,h.positions=c.positions,h.indexed=!0,h}}function tn(u){const c=+u;return!isNaN(c)&&c<=Number.MAX_SAFE_INTEGER?c:Sr(String(u))}function xr(u,c,h,p){for(;h<p;){const b=u[h+p>>1];let S=h-1,I=p+1;for(;;){do S++;while(u[S]<b);do I--;while(u[I]>b);if(S>=I)break;Jr(u,S,I),Jr(c,3*S,3*I),Jr(c,3*S+1,3*I+1),Jr(c,3*S+2,3*I+2)}I-h<p-I?(xr(u,c,h,I),h=I+1):(xr(u,c,I+1,p),p=I)}}function Jr(u,c,h){const p=u[c];u[c]=u[h],u[h]=p}tr("FeaturePositionMap",Fr);class Cn{constructor(c,h){this.gl=c.gl,this.location=h}}class En extends Cn{constructor(c,h){super(c,h),this.current=0}set(c){this.current!==c&&(this.current=c,this.gl.uniform1f(this.location,c))}}class fi extends Cn{constructor(c,h){super(c,h),this.current=[0,0,0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]&&c[3]===this.current[3]||(this.current=c,this.gl.uniform4f(this.location,c[0],c[1],c[2],c[3]))}}class dn extends Cn{constructor(c,h){super(c,h),this.current=Br.transparent}set(c){c.r===this.current.r&&c.g===this.current.g&&c.b===this.current.b&&c.a===this.current.a||(this.current=c,this.gl.uniform4f(this.location,c.r,c.g,c.b,c.a))}}const us=new Float32Array(16);function Fi(u){return[ue(255*u.r,255*u.g),ue(255*u.b,255*u.a)]}class Vn{constructor(c,h,p){this.value=c,this.uniformNames=h.map(b=>`u_${b}`),this.type=p}setUniform(c,h,p){c.set(p.constantOr(this.value))}getBinding(c,h,p){return this.type==="color"?new dn(c,h):new En(c,h)}}class fn{constructor(c,h){this.uniformNames=h.map(p=>`u_${p}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(c,h){this.pixelRatioFrom=h.pixelRatio,this.pixelRatioTo=c.pixelRatio,this.patternFrom=h.tlbr,this.patternTo=c.tlbr}setUniform(c,h,p,b){const S=b==="u_pattern_to"?this.patternTo:b==="u_pattern_from"?this.patternFrom:b==="u_pixel_ratio_to"?this.pixelRatioTo:b==="u_pixel_ratio_from"?this.pixelRatioFrom:null;S&&c.set(S)}getBinding(c,h,p){return p.substr(0,9)==="u_pattern"?new fi(c,h):new En(c,h)}}class on{constructor(c,h,p,b){this.expression=c,this.type=p,this.maxValue=0,this.paintVertexAttributes=h.map(S=>({name:`a_${S}`,type:"Float32",components:p==="color"?2:1,offset:0})),this.paintVertexArray=new b}populatePaintArray(c,h,p,b,S){const I=this.paintVertexArray.length,F=this.expression.evaluate(new Gn(0),h,{},b,[],S);this.paintVertexArray.resize(c),this._setPaintValue(I,c,F)}updatePaintArray(c,h,p,b){const S=this.expression.evaluate({zoom:0},p,b);this._setPaintValue(c,h,S)}_setPaintValue(c,h,p){if(this.type==="color"){const b=Fi(p);for(let S=c;S<h;S++)this.paintVertexArray.emplace(S,b[0],b[1])}else{for(let b=c;b<h;b++)this.paintVertexArray.emplace(b,p);this.maxValue=Math.max(this.maxValue,Math.abs(p))}}upload(c){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=c.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class pn{constructor(c,h,p,b,S,I){this.expression=c,this.uniformNames=h.map(F=>`u_${F}_t`),this.type=p,this.useIntegerZoom=b,this.zoom=S,this.maxValue=0,this.paintVertexAttributes=h.map(F=>({name:`a_${F}`,type:"Float32",components:p==="color"?4:2,offset:0})),this.paintVertexArray=new I}populatePaintArray(c,h,p,b,S){const I=this.expression.evaluate(new Gn(this.zoom),h,{},b,[],S),F=this.expression.evaluate(new Gn(this.zoom+1),h,{},b,[],S),O=this.paintVertexArray.length;this.paintVertexArray.resize(c),this._setPaintValue(O,c,I,F)}updatePaintArray(c,h,p,b){const S=this.expression.evaluate({zoom:this.zoom},p,b),I=this.expression.evaluate({zoom:this.zoom+1},p,b);this._setPaintValue(c,h,S,I)}_setPaintValue(c,h,p,b){if(this.type==="color"){const S=Fi(p),I=Fi(b);for(let F=c;F<h;F++)this.paintVertexArray.emplace(F,S[0],S[1],I[0],I[1])}else{for(let S=c;S<h;S++)this.paintVertexArray.emplace(S,p,b);this.maxValue=Math.max(this.maxValue,Math.abs(p),Math.abs(b))}}upload(c){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=c.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(c,h){const p=this.useIntegerZoom?Math.floor(h.zoom):h.zoom,b=ft(this.expression.interpolationFactor(p,this.zoom,this.zoom+1),0,1);c.set(b)}getBinding(c,h,p){return new En(c,h)}}class Ti{constructor(c,h,p,b,S,I){this.expression=c,this.type=h,this.useIntegerZoom=p,this.zoom=b,this.layerId=I,this.zoomInPaintVertexArray=new S,this.zoomOutPaintVertexArray=new S}populatePaintArray(c,h,p){const b=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(c),this.zoomOutPaintVertexArray.resize(c),this._setPaintValues(b,c,h.patterns&&h.patterns[this.layerId],p)}updatePaintArray(c,h,p,b,S){this._setPaintValues(c,h,p.patterns&&p.patterns[this.layerId],S)}_setPaintValues(c,h,p,b){if(!b||!p)return;const{min:S,mid:I,max:F}=p,O=b[S],G=b[I],K=b[F];if(O&&G&&K)for(let X=c;X<h;X++)this.zoomInPaintVertexArray.emplace(X,G.tl[0],G.tl[1],G.br[0],G.br[1],O.tl[0],O.tl[1],O.br[0],O.br[1],G.pixelRatio,O.pixelRatio),this.zoomOutPaintVertexArray.emplace(X,G.tl[0],G.tl[1],G.br[0],G.br[1],K.tl[0],K.tl[1],K.br[0],K.br[1],G.pixelRatio,K.pixelRatio)}upload(c){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=c.createVertexBuffer(this.zoomInPaintVertexArray,Ae.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=c.createVertexBuffer(this.zoomOutPaintVertexArray,Ae.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class un{constructor(c,h,p){this.binders={},this._buffers=[];const b=[];for(const S in c.paint._values){if(!p(S))continue;const I=c.paint.get(S);if(!(I instanceof ta&&Pt(I.property.specification)))continue;const F=Ji(S,c.type),O=I.value,G=I.property.specification.type,K=I.property.useIntegerZoom,X=I.property.specification["property-type"],nt=X==="cross-faded"||X==="cross-faded-data-driven";if(O.kind==="constant")this.binders[S]=nt?new fn(O.value,F):new Vn(O.value,F,G),b.push(`/u_${S}`);else if(O.kind==="source"||nt){const at=ri(S,G,"source");this.binders[S]=nt?new Ti(O,G,K,h,at,c.id):new on(O,F,G,at),b.push(`/a_${S}`)}else{const at=ri(S,G,"composite");this.binders[S]=new pn(O,F,G,K,h,at),b.push(`/z_${S}`)}}this.cacheKey=b.sort().join("")}getMaxValue(c){const h=this.binders[c];return h instanceof on||h instanceof pn?h.maxValue:0}populatePaintArrays(c,h,p,b,S){for(const I in this.binders){const F=this.binders[I];(F instanceof on||F instanceof pn||F instanceof Ti)&&F.populatePaintArray(c,h,p,b,S)}}setConstantPatternPositions(c,h){for(const p in this.binders){const b=this.binders[p];b instanceof fn&&b.setConstantPatternPositions(c,h)}}updatePaintArrays(c,h,p,b,S){let I=!1;for(const F in c){const O=h.getPositions(F);for(const G of O){const K=p.feature(G.index);for(const X in this.binders){const nt=this.binders[X];if((nt instanceof on||nt instanceof pn||nt instanceof Ti)&&nt.expression.isStateDependent===!0){const at=b.paint.get(X);nt.expression=at.value,nt.updatePaintArray(G.start,G.end,K,c[F],S),I=!0}}}}return I}defines(){const c=[];for(const h in this.binders){const p=this.binders[h];(p instanceof Vn||p instanceof fn)&&c.push(...p.uniformNames.map(b=>`#define HAS_UNIFORM_${b}`))}return c}getBinderAttributes(){const c=[];for(const h in this.binders){const p=this.binders[h];if(p instanceof on||p instanceof pn)for(let b=0;b<p.paintVertexAttributes.length;b++)c.push(p.paintVertexAttributes[b].name);else if(p instanceof Ti)for(let b=0;b<Ae.members.length;b++)c.push(Ae.members[b].name)}return c}getBinderUniforms(){const c=[];for(const h in this.binders){const p=this.binders[h];if(p instanceof Vn||p instanceof fn||p instanceof pn)for(const b of p.uniformNames)c.push(b)}return c}getPaintVertexBuffers(){return this._buffers}getUniforms(c,h){const p=[];for(const b in this.binders){const S=this.binders[b];if(S instanceof Vn||S instanceof fn||S instanceof pn){for(const I of S.uniformNames)if(h[I]){const F=S.getBinding(c,h[I],I);p.push({name:I,property:b,binding:F})}}}return p}setUniforms(c,h,p,b){for(const{name:S,property:I,binding:F}of h)this.binders[I].setUniform(F,b,p.get(I),S)}updatePaintBuffers(c){this._buffers=[];for(const h in this.binders){const p=this.binders[h];if(c&&p instanceof Ti){const b=c.fromScale===2?p.zoomInPaintVertexBuffer:p.zoomOutPaintVertexBuffer;b&&this._buffers.push(b)}else(p instanceof on||p instanceof pn)&&p.paintVertexBuffer&&this._buffers.push(p.paintVertexBuffer)}}upload(c){for(const h in this.binders){const p=this.binders[h];(p instanceof on||p instanceof pn||p instanceof Ti)&&p.upload(c)}this.updatePaintBuffers()}destroy(){for(const c in this.binders){const h=this.binders[c];(h instanceof on||h instanceof pn||h instanceof Ti)&&h.destroy()}}}class Sn{constructor(c,h){let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:()=>!0;this.programConfigurations={};for(const b of c)this.programConfigurations[b.id]=new un(b,h,p);this.needsUpload=!1,this._featureMap=new Fr,this._bufferOffset=0}populatePaintArrays(c,h,p,b,S,I){for(const F in this.programConfigurations)this.programConfigurations[F].populatePaintArrays(c,h,b,S,I);h.id!==void 0&&this._featureMap.add(h.id,p,this._bufferOffset,c),this._bufferOffset=c,this.needsUpload=!0}updatePaintArrays(c,h,p,b){for(const S of p)this.needsUpload=this.programConfigurations[S.id].updatePaintArrays(c,this._featureMap,h,S,b)||this.needsUpload}get(c){return this.programConfigurations[c]}upload(c){if(this.needsUpload){for(const h in this.programConfigurations)this.programConfigurations[h].upload(c);this.needsUpload=!1}}destroy(){for(const c in this.programConfigurations)this.programConfigurations[c].destroy()}}function Ji(u,c){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[u]||[u.replace(`${c}-`,"").replace(/-/g,"_")]}function ri(u,c,h){const p={color:{source:So,composite:fh},number:{source:yu,composite:So}},b=function(S){return{"line-pattern":{source:W,composite:W},"fill-pattern":{source:W,composite:W},"fill-extrusion-pattern":{source:W,composite:W}}[S]}(u);return b&&b[h]||p[c][h]}tr("ConstantBinder",Vn),tr("CrossFadedConstantBinder",fn),tr("SourceExpressionBinder",on),tr("CrossFadedCompositeBinder",Ti),tr("CompositeExpressionBinder",pn),tr("ProgramConfiguration",un,{omit:["_buffers"]}),tr("ProgramConfigurationSet",Sn);const Dn=8192,ai=Math.pow(2,14)-1,ph=-ai-1;function Pc(u){const c=Dn/u.extent,h=u.loadGeometry();for(let p=0;p<h.length;p++){const b=h[p];for(let S=0;S<b.length;S++){const I=b[S],F=Math.round(I.x*c),O=Math.round(I.y*c);I.x=ft(F,ph,ai),I.y=ft(O,ph,ai),(F<I.x||F>I.x+1||O<I.y||O>I.y+1)&&wt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return h}function Mc(u,c){return{type:u.type,id:u.id,properties:u.properties,geometry:c?Pc(u):[]}}function Ll(u,c,h,p,b){u.emplaceBack(2*c+(p+1)/2,2*h+(b+1)/2)}class To{constructor(c){this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(h=>h.id),this.index=c.index,this.hasPattern=!1,this.layoutVertexArray=new D,this.indexArray=new Tt,this.segments=new Wt,this.programConfigurations=new Sn(c.layers,c.zoom),this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(c,h,p){const b=this.layers[0],S=[];let I=null,F=!1;b.type==="circle"&&(I=b.layout.get("circle-sort-key"),F=!I.isConstant());for(const{feature:O,id:G,index:K,sourceLayerIndex:X}of c){const nt=this.layers[0]._featureFilter.needGeometry,at=Mc(O,nt);if(!this.layers[0]._featureFilter.filter(new Gn(this.zoom),at,p))continue;const ut=F?I.evaluate(at,{},p):void 0,Bt={id:G,properties:O.properties,type:O.type,sourceLayerIndex:X,index:K,geometry:nt?at.geometry:Pc(O),patterns:{},sortKey:ut};S.push(Bt)}F&&S.sort((O,G)=>O.sortKey-G.sortKey);for(const O of S){const{geometry:G,index:K,sourceLayerIndex:X}=O,nt=c[K].feature;this.addFeature(O,G,K,p),h.featureIndex.insert(nt,G,K,X,this.index)}}update(c,h,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(c,h,this.stateDependentLayers,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(c){this.uploaded||(this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,Gt),this.indexBuffer=c.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(c),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(c,h,p,b){for(const S of h)for(const I of S){const F=I.x,O=I.y;if(F<0||F>=Dn||O<0||O>=Dn)continue;const G=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,c.sortKey),K=G.vertexLength;Ll(this.layoutVertexArray,F,O,-1,-1),Ll(this.layoutVertexArray,F,O,1,-1),Ll(this.layoutVertexArray,F,O,1,1),Ll(this.layoutVertexArray,F,O,-1,1),this.indexArray.emplaceBack(K,K+1,K+2),this.indexArray.emplaceBack(K,K+3,K+2),G.vertexLength+=4,G.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,c,p,{},b)}}function _u(u,c){for(let h=0;h<u.length;h++)if(Fl(c,u[h]))return!0;for(let h=0;h<c.length;h++)if(Fl(u,c[h]))return!0;return!!mA(u,c)}function Io(u,c,h){return!!Fl(u,c)||!!yp(c,u,h)}function Uc(u,c){if(u.length===1)return _p(c,u[0]);for(let h=0;h<c.length;h++){const p=c[h];for(let b=0;b<p.length;b++)if(Fl(u,p[b]))return!0}for(let h=0;h<u.length;h++)if(_p(c,u[h]))return!0;for(let h=0;h<c.length;h++)if(mA(u,c[h]))return!0;return!1}function Rc(u,c,h){if(u.length>1){if(mA(u,c))return!0;for(let p=0;p<c.length;p++)if(yp(c[p],u,h))return!0}for(let p=0;p<u.length;p++)if(yp(u[p],c,h))return!0;return!1}function mA(u,c){if(u.length===0||c.length===0)return!1;for(let h=0;h<u.length-1;h++){const p=u[h],b=u[h+1];for(let S=0;S<c.length-1;S++)if(vu(p,b,c[S],c[S+1]))return!0}return!1}function vu(u,c,h,p){return yt(u,h,p)!==yt(c,h,p)&&yt(u,c,h)!==yt(u,c,p)}function yp(u,c,h){const p=h*h;if(c.length===1)return u.distSqr(c[0])<p;for(let b=1;b<c.length;b++)if(Ld(u,c[b-1],c[b])<p)return!0;return!1}function Ld(u,c,h){const p=c.distSqr(h);if(p===0)return u.distSqr(c);const b=((u.x-c.x)*(h.x-c.x)+(u.y-c.y)*(h.y-c.y))/p;return u.distSqr(b<0?c:b>1?h:h.sub(c)._mult(b)._add(c))}function _p(u,c){let h,p,b,S=!1;for(let I=0;I<u.length;I++){h=u[I];for(let F=0,O=h.length-1;F<h.length;O=F++)p=h[F],b=h[O],p.y>c.y!=b.y>c.y&&c.x<(b.x-p.x)*(c.y-p.y)/(b.y-p.y)+p.x&&(S=!S)}return S}function Fl(u,c){let h=!1;for(let p=0,b=u.length-1;p<u.length;b=p++){const S=u[p],I=u[b];S.y>c.y!=I.y>c.y&&c.x<(I.x-S.x)*(c.y-S.y)/(I.y-S.y)+S.x&&(h=!h)}return h}function Fd(u,c,h){const p=h[0],b=h[2];if(u.x<p.x&&c.x<p.x||u.x>b.x&&c.x>b.x||u.y<p.y&&c.y<p.y||u.y>b.y&&c.y>b.y)return!1;const S=yt(u,c,h[0]);return S!==yt(u,c,h[1])||S!==yt(u,c,h[2])||S!==yt(u,c,h[3])}function Pd(u,c,h){const p=c.paint.get(u).value;return p.kind==="constant"?p.value:h.programConfigurations.get(c.id).getMaxValue(u)}function vp(u){return Math.sqrt(u[0]*u[0]+u[1]*u[1])}function gh(u,c,h,p,b){if(!c[0]&&!c[1])return u;const S=_.convert(c)._mult(b);h==="viewport"&&S._rotate(-p);const I=[];for(let F=0;F<u.length;F++)I.push(u[F].sub(S));return I}let Pl,Q_;tr("CircleBucket",To,{omit:["layers"]});var QE={get paint(){return Q_=Q_||new Xi({"circle-radius":new wr(Jt.paint_circle["circle-radius"]),"circle-color":new wr(Jt.paint_circle["circle-color"]),"circle-blur":new wr(Jt.paint_circle["circle-blur"]),"circle-opacity":new wr(Jt.paint_circle["circle-opacity"]),"circle-translate":new dr(Jt.paint_circle["circle-translate"]),"circle-translate-anchor":new dr(Jt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new dr(Jt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new dr(Jt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new wr(Jt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new wr(Jt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new wr(Jt.paint_circle["circle-stroke-opacity"])})},get layout(){return Pl=Pl||new Xi({"circle-sort-key":new wr(Jt.layout_circle["circle-sort-key"])})}},Vs=1e-6,yA=typeof Float32Array<"u"?Float32Array:Array;function mh(u){return u[0]=1,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=1,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=1,u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u}function Rm(u,c,h){var p=c[0],b=c[1],S=c[2],I=c[3],F=c[4],O=c[5],G=c[6],K=c[7],X=c[8],nt=c[9],at=c[10],ut=c[11],Bt=c[12],It=c[13],Nt=c[14],ee=c[15],Ht=h[0],Kt=h[1],ve=h[2],be=h[3];return u[0]=Ht*p+Kt*F+ve*X+be*Bt,u[1]=Ht*b+Kt*O+ve*nt+be*It,u[2]=Ht*S+Kt*G+ve*at+be*Nt,u[3]=Ht*I+Kt*K+ve*ut+be*ee,u[4]=(Ht=h[4])*p+(Kt=h[5])*F+(ve=h[6])*X+(be=h[7])*Bt,u[5]=Ht*b+Kt*O+ve*nt+be*It,u[6]=Ht*S+Kt*G+ve*at+be*Nt,u[7]=Ht*I+Kt*K+ve*ut+be*ee,u[8]=(Ht=h[8])*p+(Kt=h[9])*F+(ve=h[10])*X+(be=h[11])*Bt,u[9]=Ht*b+Kt*O+ve*nt+be*It,u[10]=Ht*S+Kt*G+ve*at+be*Nt,u[11]=Ht*I+Kt*K+ve*ut+be*ee,u[12]=(Ht=h[12])*p+(Kt=h[13])*F+(ve=h[14])*X+(be=h[15])*Bt,u[13]=Ht*b+Kt*O+ve*nt+be*It,u[14]=Ht*S+Kt*G+ve*at+be*Nt,u[15]=Ht*I+Kt*K+ve*ut+be*ee,u}Math.hypot||(Math.hypot=function(){for(var u=0,c=arguments.length;c--;)u+=arguments[c]*arguments[c];return Math.sqrt(u)});var yh,bp=Rm;function _h(u,c,h){var p=c[0],b=c[1],S=c[2],I=c[3];return u[0]=h[0]*p+h[4]*b+h[8]*S+h[12]*I,u[1]=h[1]*p+h[5]*b+h[9]*S+h[13]*I,u[2]=h[2]*p+h[6]*b+h[10]*S+h[14]*I,u[3]=h[3]*p+h[7]*b+h[11]*S+h[15]*I,u}yh=new yA(4),yA!=Float32Array&&(yh[0]=0,yh[1]=0,yh[2]=0,yh[3]=0);class Md extends ea{constructor(c){super(c,QE)}createBucket(c){return new To(c)}queryRadius(c){const h=c;return Pd("circle-radius",this,h)+Pd("circle-stroke-width",this,h)+vp(this.paint.get("circle-translate"))}queryIntersectsFeature(c,h,p,b,S,I,F,O){const G=gh(c,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),I.angle,F),K=this.paint.get("circle-radius").evaluate(h,p)+this.paint.get("circle-stroke-width").evaluate(h,p),X=this.paint.get("circle-pitch-alignment")==="map",nt=X?G:function(ut,Bt){return ut.map(It=>Om(It,Bt))}(G,O),at=X?K*F:K;for(const ut of b)for(const Bt of ut){const It=X?Bt:Om(Bt,O);let Nt=at;const ee=_h([],[Bt.x,Bt.y,0,1],O);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Nt*=ee[3]/I.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Nt*=I.cameraToCenterDistance/ee[3]),Io(nt,It,Nt))return!0}return!1}}function Om(u,c){const h=_h([],[u.x,u.y,0,1],c);return new _(h[0]/h[3],h[1]/h[3])}class H_ extends To{}let Ud;tr("HeatmapBucket",H_,{omit:["layers"]});var z_={get paint(){return Ud=Ud||new Xi({"heatmap-radius":new wr(Jt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new wr(Jt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new dr(Jt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new AA(Jt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new dr(Jt.paint_heatmap["heatmap-opacity"])})}};function Rd(u,c,h,p){let{width:b,height:S}=c;if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==b*S*h)throw new RangeError(`mismatched image size. expected: ${p.length} but got: ${b*S*h}`)}else p=new Uint8Array(b*S*h);return u.width=b,u.height=S,u.data=p,u}function Ml(u,c,h){let{width:p,height:b}=c;if(p===u.width&&b===u.height)return;const S=Rd({},{width:p,height:b},h);wp(u,S,{x:0,y:0},{x:0,y:0},{width:Math.min(u.width,p),height:Math.min(u.height,b)},h),u.width=p,u.height=b,u.data=S.data}function wp(u,c,h,p,b,S){if(b.width===0||b.height===0)return c;if(b.width>u.width||b.height>u.height||h.x>u.width-b.width||h.y>u.height-b.height)throw new RangeError("out of range source coordinates for image copy");if(b.width>c.width||b.height>c.height||p.x>c.width-b.width||p.y>c.height-b.height)throw new RangeError("out of range destination coordinates for image copy");const I=u.data,F=c.data;if(I===F)throw new Error("srcData equals dstData, so image is already copied");for(let O=0;O<b.height;O++){const G=((h.y+O)*u.width+h.x)*S,K=((p.y+O)*c.width+p.x)*S;for(let X=0;X<b.width*S;X++)F[K+X]=I[G+X]}return c}class vh{constructor(c,h){Rd(this,c,1,h)}resize(c){Ml(this,c,1)}clone(){return new vh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(c,h,p,b,S){wp(c,h,p,b,S,1)}}class ia{constructor(c,h){Rd(this,c,4,h)}resize(c){Ml(this,c,4)}replace(c,h){h?this.data.set(c):this.data=c instanceof Uint8ClampedArray?new Uint8Array(c.buffer):c}clone(){return new ia({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(c,h,p,b,S){wp(c,h,p,b,S,4)}}function Dm(u){const c={},h=u.resolution||256,p=u.clips?u.clips.length:1,b=u.image||new ia({width:h,height:p});if(Math.log(h)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${h}`);const S=(I,F,O)=>{c[u.evaluationKey]=O;const G=u.expression.evaluate(c);b.data[I+F+0]=Math.floor(255*G.r/G.a),b.data[I+F+1]=Math.floor(255*G.g/G.a),b.data[I+F+2]=Math.floor(255*G.b/G.a),b.data[I+F+3]=Math.floor(255*G.a)};if(u.clips)for(let I=0,F=0;I<p;++I,F+=4*h)for(let O=0,G=0;O<h;O++,G+=4){const K=O/(h-1),{start:X,end:nt}=u.clips[I];S(F,G,X*(1-K)+nt*K)}else for(let I=0,F=0;I<h;I++,F+=4)S(0,F,I/(h-1));return b}tr("AlphaImage",vh),tr("RGBAImage",ia);class bh extends ea{createBucket(c){return new H_(c)}constructor(c){super(c,z_),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(c){c==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Dm({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let G_;var V_={get paint(){return G_=G_||new Xi({"hillshade-illumination-direction":new dr(Jt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new dr(Jt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new dr(Jt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new dr(Jt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new dr(Jt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new dr(Jt.paint_hillshade["hillshade-accent-color"])})}};class HE extends ea{constructor(c){super(c,V_)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const j_=Si([{name:"a_pos",components:2,type:"Int16"}],4),{members:zE}=j_;var _A={exports:{}};function wh(u,c,h){h=h||2;var p,b,S,I,F,O,G,K=c&&c.length,X=K?c[0]*h:u.length,nt=Od(u,0,X,h,!0),at=[];if(!nt||nt.next===nt.prev)return at;if(K&&(nt=function(Bt,It,Nt,ee){var Ht,Kt,ve,be=[];for(Ht=0,Kt=It.length;Ht<Kt;Ht++)(ve=Od(Bt,It[Ht]*ee,Ht<Kt-1?It[Ht+1]*ee:Bt.length,ee,!1))===ve.next&&(ve.steiner=!0),be.push(Tbt(ve));for(be.sort(GE),Ht=0;Ht<be.length;Ht++)Nt=km(be[Ht],Nt);return Nt}(u,c,nt,h)),u.length>80*h){p=S=u[0],b=I=u[1];for(var ut=h;ut<X;ut+=h)(F=u[ut])<p&&(p=F),(O=u[ut+1])<b&&(b=O),F>S&&(S=F),O>I&&(I=O);G=(G=Math.max(S-p,I-b))!==0?32767/G:0}return Sa(nt,at,h,p,b,G,0),at}function Od(u,c,h,p,b){var S,I;if(b===qE(u,c,h,p)>0)for(S=c;S<h;S+=p)I=IN(S,u[S],u[S+1],I);else for(S=h-p;S>=c;S-=p)I=IN(S,u[S],u[S+1],I);return I&&K_(I,I.next)&&(zm(I),I=I.next),I}function io(u,c){if(!u)return u;c||(c=u);var h,p=u;do if(h=!1,p.steiner||!K_(p,p.next)&&Qi(p.prev,p,p.next)!==0)p=p.next;else{if(zm(p),(p=c=p.prev)===p.next)break;h=!0}while(h||p!==c);return c}function Sa(u,c,h,p,b,S,I){if(u){!I&&S&&function(K,X,nt,at){var ut=K;do ut.z===0&&(ut.z=VE(ut.x,ut.y,X,nt,at)),ut.prevZ=ut.prev,ut.nextZ=ut.next,ut=ut.next;while(ut!==K);ut.prevZ.nextZ=null,ut.prevZ=null,function(Bt){var It,Nt,ee,Ht,Kt,ve,be,Ze,hr=1;do{for(Nt=Bt,Bt=null,Kt=null,ve=0;Nt;){for(ve++,ee=Nt,be=0,It=0;It<hr&&(be++,ee=ee.nextZ);It++);for(Ze=hr;be>0||Ze>0&&ee;)be!==0&&(Ze===0||!ee||Nt.z<=ee.z)?(Ht=Nt,Nt=Nt.nextZ,be--):(Ht=ee,ee=ee.nextZ,Ze--),Kt?Kt.nextZ=Ht:Bt=Ht,Ht.prevZ=Kt,Kt=Ht;Nt=ee}Kt.nextZ=null,hr*=2}while(ve>1)}(ut)}(u,p,b,S);for(var F,O,G=u;u.prev!==u.next;)if(F=u.prev,O=u.next,S?xp(u,p,b,S):bu(u))c.push(F.i/h|0),c.push(u.i/h|0),c.push(O.i/h|0),zm(u),u=O.next,G=O.next;else if((u=O)===G){I?I===1?Sa(u=Nm(io(u),c,h),c,h,p,b,S,2):I===2&&q_(u,c,h,p,b,S):Sa(io(u),c,h,p,b,S,1);break}}}function bu(u){var c=u.prev,h=u,p=u.next;if(Qi(c,h,p)>=0)return!1;for(var b=c.x,S=h.x,I=p.x,F=c.y,O=h.y,G=p.y,K=b<S?b<I?b:I:S<I?S:I,X=F<O?F<G?F:G:O<G?O:G,nt=b>S?b>I?b:I:S>I?S:I,at=F>O?F>G?F:G:O>G?O:G,ut=p.next;ut!==c;){if(ut.x>=K&&ut.x<=nt&&ut.y>=X&&ut.y<=at&&Bp(b,F,S,O,I,G,ut.x,ut.y)&&Qi(ut.prev,ut,ut.next)>=0)return!1;ut=ut.next}return!0}function xp(u,c,h,p){var b=u.prev,S=u,I=u.next;if(Qi(b,S,I)>=0)return!1;for(var F=b.x,O=S.x,G=I.x,K=b.y,X=S.y,nt=I.y,at=F<O?F<G?F:G:O<G?O:G,ut=K<X?K<nt?K:nt:X<nt?X:nt,Bt=F>O?F>G?F:G:O>G?O:G,It=K>X?K>nt?K:nt:X>nt?X:nt,Nt=VE(at,ut,c,h,p),ee=VE(Bt,It,c,h,p),Ht=u.prevZ,Kt=u.nextZ;Ht&&Ht.z>=Nt&&Kt&&Kt.z<=ee;){if(Ht.x>=at&&Ht.x<=Bt&&Ht.y>=ut&&Ht.y<=It&&Ht!==b&&Ht!==I&&Bp(F,K,O,X,G,nt,Ht.x,Ht.y)&&Qi(Ht.prev,Ht,Ht.next)>=0||(Ht=Ht.prevZ,Kt.x>=at&&Kt.x<=Bt&&Kt.y>=ut&&Kt.y<=It&&Kt!==b&&Kt!==I&&Bp(F,K,O,X,G,nt,Kt.x,Kt.y)&&Qi(Kt.prev,Kt,Kt.next)>=0))return!1;Kt=Kt.nextZ}for(;Ht&&Ht.z>=Nt;){if(Ht.x>=at&&Ht.x<=Bt&&Ht.y>=ut&&Ht.y<=It&&Ht!==b&&Ht!==I&&Bp(F,K,O,X,G,nt,Ht.x,Ht.y)&&Qi(Ht.prev,Ht,Ht.next)>=0)return!1;Ht=Ht.prevZ}for(;Kt&&Kt.z<=ee;){if(Kt.x>=at&&Kt.x<=Bt&&Kt.y>=ut&&Kt.y<=It&&Kt!==b&&Kt!==I&&Bp(F,K,O,X,G,nt,Kt.x,Kt.y)&&Qi(Kt.prev,Kt,Kt.next)>=0)return!1;Kt=Kt.nextZ}return!0}function Nm(u,c,h){var p=u;do{var b=p.prev,S=p.next.next;!K_(b,S)&&SN(b,p,p.next,S)&&Hm(b,S)&&Hm(S,b)&&(c.push(b.i/h|0),c.push(p.i/h|0),c.push(S.i/h|0),zm(p),zm(p.next),p=u=S),p=p.next}while(p!==u);return io(p)}function q_(u,c,h,p,b,S){var I=u;do{for(var F=I.next.next;F!==I.prev;){if(I.i!==F.i&&Ibt(I,F)){var O=TN(I,F);return I=io(I,I.next),O=io(O,O.next),Sa(I,c,h,p,b,S,0),void Sa(O,c,h,p,b,S,0)}F=F.next}I=I.next}while(I!==u)}function GE(u,c){return u.x-c.x}function km(u,c){var h=function(b,S){var I,F=S,O=b.x,G=b.y,K=-1/0;do{if(G<=F.y&&G>=F.next.y&&F.next.y!==F.y){var X=F.x+(G-F.y)*(F.next.x-F.x)/(F.next.y-F.y);if(X<=O&&X>K&&(K=X,I=F.x<F.next.x?F:F.next,X===O))return I}F=F.next}while(F!==S);if(!I)return null;var nt,at=I,ut=I.x,Bt=I.y,It=1/0;F=I;do O>=F.x&&F.x>=ut&&O!==F.x&&Bp(G<Bt?O:K,G,ut,Bt,G<Bt?K:O,G,F.x,F.y)&&(nt=Math.abs(G-F.y)/(O-F.x),Hm(F,b)&&(nt<It||nt===It&&(F.x>I.x||F.x===I.x&&Qm(I,F)))&&(I=F,It=nt)),F=F.next;while(F!==at);return I}(u,c);if(!h)return c;var p=TN(h,u);return io(p,p.next),io(h,h.next)}function Qm(u,c){return Qi(u.prev,u,c.prev)<0&&Qi(c.next,u,u.next)<0}function VE(u,c,h,p,b){return(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u=(u-h)*b|0)|u<<8))|u<<4))|u<<2))|u<<1))|(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=(c-p)*b|0)|c<<8))|c<<4))|c<<2))|c<<1))<<1}function Tbt(u){var c=u,h=u;do(c.x<h.x||c.x===h.x&&c.y<h.y)&&(h=c),c=c.next;while(c!==u);return h}function Bp(u,c,h,p,b,S,I,F){return(b-I)*(c-F)>=(u-I)*(S-F)&&(u-I)*(p-F)>=(h-I)*(c-F)&&(h-I)*(S-F)>=(b-I)*(p-F)}function Ibt(u,c){return u.next.i!==c.i&&u.prev.i!==c.i&&!function(h,p){var b=h;do{if(b.i!==h.i&&b.next.i!==h.i&&b.i!==p.i&&b.next.i!==p.i&&SN(b,b.next,h,p))return!0;b=b.next}while(b!==h);return!1}(u,c)&&(Hm(u,c)&&Hm(c,u)&&function(h,p){var b=h,S=!1,I=(h.x+p.x)/2,F=(h.y+p.y)/2;do b.y>F!=b.next.y>F&&b.next.y!==b.y&&I<(b.next.x-b.x)*(F-b.y)/(b.next.y-b.y)+b.x&&(S=!S),b=b.next;while(b!==h);return S}(u,c)&&(Qi(u.prev,u,c.prev)||Qi(u,c.prev,c))||K_(u,c)&&Qi(u.prev,u,u.next)>0&&Qi(c.prev,c,c.next)>0)}function Qi(u,c,h){return(c.y-u.y)*(h.x-c.x)-(c.x-u.x)*(h.y-c.y)}function K_(u,c){return u.x===c.x&&u.y===c.y}function SN(u,c,h,p){var b=W_(Qi(u,c,h)),S=W_(Qi(u,c,p)),I=W_(Qi(h,p,u)),F=W_(Qi(h,p,c));return b!==S&&I!==F||!(b!==0||!$_(u,h,c))||!(S!==0||!$_(u,p,c))||!(I!==0||!$_(h,u,p))||!(F!==0||!$_(h,c,p))}function $_(u,c,h){return c.x<=Math.max(u.x,h.x)&&c.x>=Math.min(u.x,h.x)&&c.y<=Math.max(u.y,h.y)&&c.y>=Math.min(u.y,h.y)}function W_(u){return u>0?1:u<0?-1:0}function Hm(u,c){return Qi(u.prev,u,u.next)<0?Qi(u,c,u.next)>=0&&Qi(u,u.prev,c)>=0:Qi(u,c,u.prev)<0||Qi(u,u.next,c)<0}function TN(u,c){var h=new jE(u.i,u.x,u.y),p=new jE(c.i,c.x,c.y),b=u.next,S=c.prev;return u.next=c,c.prev=u,h.next=b,b.prev=h,p.next=h,h.prev=p,S.next=p,p.prev=S,p}function IN(u,c,h,p){var b=new jE(u,c,h);return p?(b.next=p.next,b.prev=p,p.next.prev=b,p.next=b):(b.prev=b,b.next=b),b}function zm(u){u.next.prev=u.prev,u.prev.next=u.next,u.prevZ&&(u.prevZ.nextZ=u.nextZ),u.nextZ&&(u.nextZ.prevZ=u.prevZ)}function jE(u,c,h){this.i=u,this.x=c,this.y=h,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function qE(u,c,h,p){for(var b=0,S=c,I=h-p;S<h;S+=p)b+=(u[I]-u[S])*(u[S+1]+u[I+1]),I=S;return b}_A.exports=wh,_A.exports.default=wh,wh.deviation=function(u,c,h,p){var b=c&&c.length,S=Math.abs(qE(u,0,b?c[0]*h:u.length,h));if(b)for(var I=0,F=c.length;I<F;I++)S-=Math.abs(qE(u,c[I]*h,I<F-1?c[I+1]*h:u.length,h));var O=0;for(I=0;I<p.length;I+=3){var G=p[I]*h,K=p[I+1]*h,X=p[I+2]*h;O+=Math.abs((u[G]-u[X])*(u[K+1]-u[G+1])-(u[G]-u[K])*(u[X+1]-u[G+1]))}return S===0&&O===0?0:Math.abs((O-S)/S)},wh.flatten=function(u){for(var c=u[0][0].length,h={vertices:[],holes:[],dimensions:c},p=0,b=0;b<u.length;b++){for(var S=0;S<u[b].length;S++)for(var I=0;I<c;I++)h.vertices.push(u[b][S][I]);b>0&&h.holes.push(p+=u[b-1].length)}return h};var LN=A(_A.exports);function Lbt(u,c,h,p,b){FN(u,c,h||0,p||u.length-1,b||Fbt)}function FN(u,c,h,p,b){for(;p>h;){if(p-h>600){var S=p-h+1,I=c-h+1,F=Math.log(S),O=.5*Math.exp(2*F/3),G=.5*Math.sqrt(F*O*(S-O)/S)*(I-S/2<0?-1:1);FN(u,c,Math.max(h,Math.floor(c-I*O/S+G)),Math.min(p,Math.floor(c+(S-I)*O/S+G)),b)}var K=u[c],X=h,nt=p;for(Gm(u,h,c),b(u[p],K)>0&&Gm(u,h,p);X<nt;){for(Gm(u,X,nt),X++,nt--;b(u[X],K)<0;)X++;for(;b(u[nt],K)>0;)nt--}b(u[h],K)===0?Gm(u,h,nt):Gm(u,++nt,p),nt<=c&&(h=nt+1),c<=nt&&(p=nt-1)}}function Gm(u,c,h){var p=u[c];u[c]=u[h],u[h]=p}function Fbt(u,c){return u<c?-1:u>c?1:0}function KE(u,c){const h=u.length;if(h<=1)return[u];const p=[];let b,S;for(let I=0;I<h;I++){const F=te(u[I]);F!==0&&(u[I].area=Math.abs(F),S===void 0&&(S=F<0),S===F<0?(b&&p.push(b),b=[u[I]]):b.push(u[I]))}if(b&&p.push(b),c>1)for(let I=0;I<p.length;I++)p[I].length<=c||(Lbt(p[I],c,1,p[I].length-1,Pbt),p[I]=p[I].slice(0,c));return p}function Pbt(u,c){return c.area-u.area}function $E(u,c,h){const p=h.patternDependencies;let b=!1;for(const S of c){const I=S.paint.get(`${u}-pattern`);I.isConstant()||(b=!0);const F=I.constantOr(null);F&&(b=!0,p[F.to]=!0,p[F.from]=!0)}return b}function WE(u,c,h,p,b){const S=b.patternDependencies;for(const I of c){const F=I.paint.get(`${u}-pattern`).value;if(F.kind!=="constant"){let O=F.evaluate({zoom:p-1},h,{},b.availableImages),G=F.evaluate({zoom:p},h,{},b.availableImages),K=F.evaluate({zoom:p+1},h,{},b.availableImages);O=O&&O.name?O.name:O,G=G&&G.name?G.name:G,K=K&&K.name?K.name:K,S[O]=!0,S[G]=!0,S[K]=!0,h.patterns[I.id]={min:O,mid:G,max:K}}}return h}class XE{constructor(c){this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(h=>h.id),this.index=c.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new H,this.indexArray=new Tt,this.indexArray2=new _t,this.programConfigurations=new Sn(c.layers,c.zoom),this.segments=new Wt,this.segments2=new Wt,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(c,h,p){this.hasPattern=$E("fill",this.layers,h);const b=this.layers[0].layout.get("fill-sort-key"),S=!b.isConstant(),I=[];for(const{feature:F,id:O,index:G,sourceLayerIndex:K}of c){const X=this.layers[0]._featureFilter.needGeometry,nt=Mc(F,X);if(!this.layers[0]._featureFilter.filter(new Gn(this.zoom),nt,p))continue;const at=S?b.evaluate(nt,{},p,h.availableImages):void 0,ut={id:O,properties:F.properties,type:F.type,sourceLayerIndex:K,index:G,geometry:X?nt.geometry:Pc(F),patterns:{},sortKey:at};I.push(ut)}S&&I.sort((F,O)=>F.sortKey-O.sortKey);for(const F of I){const{geometry:O,index:G,sourceLayerIndex:K}=F;if(this.hasPattern){const X=WE("fill",this.layers,F,this.zoom,h);this.patternFeatures.push(X)}else this.addFeature(F,O,G,p,{});h.featureIndex.insert(c[G].feature,O,G,K,this.index)}}update(c,h,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(c,h,this.stateDependentLayers,p)}addFeatures(c,h,p){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,h,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(c){this.uploaded||(this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,zE),this.indexBuffer=c.createIndexBuffer(this.indexArray),this.indexBuffer2=c.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(c),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(c,h,p,b,S){for(const I of KE(h,500)){let F=0;for(const at of I)F+=at.length;const O=this.segments.prepareSegment(F,this.layoutVertexArray,this.indexArray),G=O.vertexLength,K=[],X=[];for(const at of I){if(at.length===0)continue;at!==I[0]&&X.push(K.length/2);const ut=this.segments2.prepareSegment(at.length,this.layoutVertexArray,this.indexArray2),Bt=ut.vertexLength;this.layoutVertexArray.emplaceBack(at[0].x,at[0].y),this.indexArray2.emplaceBack(Bt+at.length-1,Bt),K.push(at[0].x),K.push(at[0].y);for(let It=1;It<at.length;It++)this.layoutVertexArray.emplaceBack(at[It].x,at[It].y),this.indexArray2.emplaceBack(Bt+It-1,Bt+It),K.push(at[It].x),K.push(at[It].y);ut.vertexLength+=at.length,ut.primitiveLength+=at.length}const nt=LN(K,X);for(let at=0;at<nt.length;at+=3)this.indexArray.emplaceBack(G+nt[at],G+nt[at+1],G+nt[at+2]);O.vertexLength+=F,O.primitiveLength+=nt.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,c,p,S,b)}}let PN,MN;tr("FillBucket",XE,{omit:["layers","patternFeatures"]});var Mbt={get paint(){return MN=MN||new Xi({"fill-antialias":new dr(Jt.paint_fill["fill-antialias"]),"fill-opacity":new wr(Jt.paint_fill["fill-opacity"]),"fill-color":new wr(Jt.paint_fill["fill-color"]),"fill-outline-color":new wr(Jt.paint_fill["fill-outline-color"]),"fill-translate":new dr(Jt.paint_fill["fill-translate"]),"fill-translate-anchor":new dr(Jt.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ah(Jt.paint_fill["fill-pattern"])})},get layout(){return PN=PN||new Xi({"fill-sort-key":new wr(Jt.layout_fill["fill-sort-key"])})}};class Ubt extends ea{constructor(c){super(c,Mbt)}recalculate(c,h){super.recalculate(c,h);const p=this.paint._values["fill-outline-color"];p.value.kind==="constant"&&p.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(c){return new XE(c)}queryRadius(){return vp(this.paint.get("fill-translate"))}queryIntersectsFeature(c,h,p,b,S,I,F){return Uc(gh(c,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),I.angle,F),b)}isTileClipped(){return!0}}const Rbt=Si([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Obt=Si([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Dbt}=Rbt;var xh={},Nbt=f,UN=Cp;function Cp(u,c,h,p,b){this.properties={},this.extent=h,this.type=0,this._pbf=u,this._geometry=-1,this._keys=p,this._values=b,u.readFields(kbt,this,c)}function kbt(u,c,h){u==1?c.id=h.readVarint():u==2?function(p,b){for(var S=p.readVarint()+p.pos;p.pos<S;){var I=b._keys[p.readVarint()],F=b._values[p.readVarint()];b.properties[I]=F}}(h,c):u==3?c.type=h.readVarint():u==4&&(c._geometry=h.pos)}function Qbt(u){for(var c,h,p=0,b=0,S=u.length,I=S-1;b<S;I=b++)p+=((h=u[I]).x-(c=u[b]).x)*(c.y+h.y);return p}Cp.types=["Unknown","Point","LineString","Polygon"],Cp.prototype.loadGeometry=function(){var u=this._pbf;u.pos=this._geometry;for(var c,h=u.readVarint()+u.pos,p=1,b=0,S=0,I=0,F=[];u.pos<h;){if(b<=0){var O=u.readVarint();p=7&O,b=O>>3}if(b--,p===1||p===2)S+=u.readSVarint(),I+=u.readSVarint(),p===1&&(c&&F.push(c),c=[]),c.push(new Nbt(S,I));else{if(p!==7)throw new Error("unknown command "+p);c&&c.push(c[0].clone())}}return c&&F.push(c),F},Cp.prototype.bbox=function(){var u=this._pbf;u.pos=this._geometry;for(var c=u.readVarint()+u.pos,h=1,p=0,b=0,S=0,I=1/0,F=-1/0,O=1/0,G=-1/0;u.pos<c;){if(p<=0){var K=u.readVarint();h=7&K,p=K>>3}if(p--,h===1||h===2)(b+=u.readSVarint())<I&&(I=b),b>F&&(F=b),(S+=u.readSVarint())<O&&(O=S),S>G&&(G=S);else if(h!==7)throw new Error("unknown command "+h)}return[I,O,F,G]},Cp.prototype.toGeoJSON=function(u,c,h){var p,b,S=this.extent*Math.pow(2,h),I=this.extent*u,F=this.extent*c,O=this.loadGeometry(),G=Cp.types[this.type];function K(at){for(var ut=0;ut<at.length;ut++){var Bt=at[ut];at[ut]=[360*(Bt.x+I)/S-180,360/Math.PI*Math.atan(Math.exp((180-360*(Bt.y+F)/S)*Math.PI/180))-90]}}switch(this.type){case 1:var X=[];for(p=0;p<O.length;p++)X[p]=O[p][0];K(O=X);break;case 2:for(p=0;p<O.length;p++)K(O[p]);break;case 3:for(O=function(at){var ut=at.length;if(ut<=1)return[at];for(var Bt,It,Nt=[],ee=0;ee<ut;ee++){var Ht=Qbt(at[ee]);Ht!==0&&(It===void 0&&(It=Ht<0),It===Ht<0?(Bt&&Nt.push(Bt),Bt=[at[ee]]):Bt.push(at[ee]))}return Bt&&Nt.push(Bt),Nt}(O),p=0;p<O.length;p++)for(b=0;b<O[p].length;b++)K(O[p][b])}O.length===1?O=O[0]:G="Multi"+G;var nt={type:"Feature",geometry:{type:G,coordinates:O},properties:this.properties};return"id"in this&&(nt.id=this.id),nt};var Hbt=UN,RN=ON;function ON(u,c){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=u,this._keys=[],this._values=[],this._features=[],u.readFields(zbt,this,c),this.length=this._features.length}function zbt(u,c,h){u===15?c.version=h.readVarint():u===1?c.name=h.readString():u===5?c.extent=h.readVarint():u===2?c._features.push(h.pos):u===3?c._keys.push(h.readString()):u===4&&c._values.push(function(p){for(var b=null,S=p.readVarint()+p.pos;p.pos<S;){var I=p.readVarint()>>3;b=I===1?p.readString():I===2?p.readFloat():I===3?p.readDouble():I===4?p.readVarint64():I===5?p.readVarint():I===6?p.readSVarint():I===7?p.readBoolean():null}return b}(h))}ON.prototype.feature=function(u){if(u<0||u>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[u];var c=this._pbf.readVarint()+this._pbf.pos;return new Hbt(this._pbf,c,this.extent,this._keys,this._values)};var Gbt=RN;function Vbt(u,c,h){if(u===3){var p=new Gbt(h,h.readVarint()+h.pos);p.length&&(c[p.name]=p)}}xh.VectorTile=function(u,c){this.layers=u.readFields(Vbt,{},c)},xh.VectorTileFeature=UN,xh.VectorTileLayer=RN;const jbt=xh.VectorTileFeature.types,JE=Math.pow(2,13);function Vm(u,c,h,p,b,S,I,F){u.emplaceBack(c,h,2*Math.floor(p*JE)+I,b*JE*2,S*JE*2,Math.round(F))}class YE{constructor(c){this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(h=>h.id),this.index=c.index,this.hasPattern=!1,this.layoutVertexArray=new z,this.centroidVertexArray=new L,this.indexArray=new Tt,this.programConfigurations=new Sn(c.layers,c.zoom),this.segments=new Wt,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(c,h,p){this.features=[],this.hasPattern=$E("fill-extrusion",this.layers,h);for(const{feature:b,id:S,index:I,sourceLayerIndex:F}of c){const O=this.layers[0]._featureFilter.needGeometry,G=Mc(b,O);if(!this.layers[0]._featureFilter.filter(new Gn(this.zoom),G,p))continue;const K={id:S,sourceLayerIndex:F,index:I,geometry:O?G.geometry:Pc(b),properties:b.properties,type:b.type,patterns:{}};this.hasPattern?this.features.push(WE("fill-extrusion",this.layers,K,this.zoom,h)):this.addFeature(K,K.geometry,I,p,{}),h.featureIndex.insert(b,K.geometry,I,F,this.index,!0)}}addFeatures(c,h,p){for(const b of this.features){const{geometry:S}=b;this.addFeature(b,S,b.index,h,p)}}update(c,h,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(c,h,this.stateDependentLayers,p)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(c){this.uploaded||(this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,Dbt),this.centroidVertexBuffer=c.createVertexBuffer(this.centroidVertexArray,Obt.members,!0),this.indexBuffer=c.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(c),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(c,h,p,b,S){const I={x:0,y:0,vertexCount:0};for(const F of KE(h,500)){let O=0;for(const ut of F)O+=ut.length;let G=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const ut of F){if(ut.length===0||Kbt(ut))continue;let Bt=0;for(let It=0;It<ut.length;It++){const Nt=ut[It];if(It>=1){const ee=ut[It-1];if(!qbt(Nt,ee)){G.vertexLength+4>Wt.MAX_VERTEX_ARRAY_LENGTH&&(G=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Ht=Nt.sub(ee)._perp()._unit(),Kt=ee.dist(Nt);Bt+Kt>32768&&(Bt=0),Vm(this.layoutVertexArray,Nt.x,Nt.y,Ht.x,Ht.y,0,0,Bt),Vm(this.layoutVertexArray,Nt.x,Nt.y,Ht.x,Ht.y,0,1,Bt),I.x+=2*Nt.x,I.y+=2*Nt.y,I.vertexCount+=2,Bt+=Kt,Vm(this.layoutVertexArray,ee.x,ee.y,Ht.x,Ht.y,0,0,Bt),Vm(this.layoutVertexArray,ee.x,ee.y,Ht.x,Ht.y,0,1,Bt),I.x+=2*ee.x,I.y+=2*ee.y,I.vertexCount+=2;const ve=G.vertexLength;this.indexArray.emplaceBack(ve,ve+2,ve+1),this.indexArray.emplaceBack(ve+1,ve+2,ve+3),G.vertexLength+=4,G.primitiveLength+=2}}}}if(G.vertexLength+O>Wt.MAX_VERTEX_ARRAY_LENGTH&&(G=this.segments.prepareSegment(O,this.layoutVertexArray,this.indexArray)),jbt[c.type]!=="Polygon")continue;const K=[],X=[],nt=G.vertexLength;for(const ut of F)if(ut.length!==0){ut!==F[0]&&X.push(K.length/2);for(let Bt=0;Bt<ut.length;Bt++){const It=ut[Bt];Vm(this.layoutVertexArray,It.x,It.y,0,0,1,1,0),I.x+=It.x,I.y+=It.y,I.vertexCount+=1,K.push(It.x),K.push(It.y)}}const at=LN(K,X);for(let ut=0;ut<at.length;ut+=3)this.indexArray.emplaceBack(nt+at[ut],nt+at[ut+2],nt+at[ut+1]);G.primitiveLength+=at.length/3,G.vertexLength+=O}for(let F=0;F<I.vertexCount;F++)this.centroidVertexArray.emplaceBack(Math.floor(I.x/I.vertexCount),Math.floor(I.y/I.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,c,p,S,b)}}function qbt(u,c){return u.x===c.x&&(u.x<0||u.x>Dn)||u.y===c.y&&(u.y<0||u.y>Dn)}function Kbt(u){return u.every(c=>c.x<0)||u.every(c=>c.x>Dn)||u.every(c=>c.y<0)||u.every(c=>c.y>Dn)}let DN;tr("FillExtrusionBucket",YE,{omit:["layers","features"]});var $bt={get paint(){return DN=DN||new Xi({"fill-extrusion-opacity":new dr(Jt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new wr(Jt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new dr(Jt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new dr(Jt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ah(Jt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new wr(Jt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new wr(Jt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new dr(Jt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Wbt extends ea{constructor(c){super(c,$bt)}createBucket(c){return new YE(c)}queryRadius(){return vp(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(c,h,p,b,S,I,F,O){const G=gh(c,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),I.angle,F),K=this.paint.get("fill-extrusion-height").evaluate(h,p),X=this.paint.get("fill-extrusion-base").evaluate(h,p),nt=function(ut,Bt,It,Nt){const ee=[];for(const Ht of ut){const Kt=[Ht.x,Ht.y,0,1];_h(Kt,Kt,Bt),ee.push(new _(Kt[0]/Kt[3],Kt[1]/Kt[3]))}return ee}(G,O),at=function(ut,Bt,It,Nt){const ee=[],Ht=[],Kt=Nt[8]*Bt,ve=Nt[9]*Bt,be=Nt[10]*Bt,Ze=Nt[11]*Bt,hr=Nt[8]*It,Xe=Nt[9]*It,$e=Nt[10]*It,ke=Nt[11]*It;for(const or of ut){const je=[],Fe=[];for(const Cr of or){const pr=Cr.x,en=Cr.y,ci=Nt[0]*pr+Nt[4]*en+Nt[12],pi=Nt[1]*pr+Nt[5]*en+Nt[13],hs=Nt[2]*pr+Nt[6]*en+Nt[14],Ta=Nt[3]*pr+Nt[7]*en+Nt[15],Lo=hs+be,Yi=Ta+Ze,Is=ci+hr,qs=pi+Xe,Fo=hs+$e,Po=Ta+ke,ds=new _((ci+Kt)/Yi,(pi+ve)/Yi);ds.z=Lo/Yi,je.push(ds);const fs=new _(Is/Po,qs/Po);fs.z=Fo/Po,Fe.push(fs)}ee.push(je),Ht.push(Fe)}return[ee,Ht]}(b,X,K,O);return function(ut,Bt,It){let Nt=1/0;Uc(It,Bt)&&(Nt=NN(It,Bt[0]));for(let ee=0;ee<Bt.length;ee++){const Ht=Bt[ee],Kt=ut[ee];for(let ve=0;ve<Ht.length-1;ve++){const be=Ht[ve],Ze=[be,Ht[ve+1],Kt[ve+1],Kt[ve],be];_u(It,Ze)&&(Nt=Math.min(Nt,NN(It,Ze)))}}return Nt!==1/0&&Nt}(at[0],at[1],nt)}}function jm(u,c){return u.x*c.x+u.y*c.y}function NN(u,c){if(u.length===1){let h=0;const p=c[h++];let b;for(;!b||p.equals(b);)if(b=c[h++],!b)return 1/0;for(;h<c.length;h++){const S=c[h],I=u[0],F=b.sub(p),O=S.sub(p),G=I.sub(p),K=jm(F,F),X=jm(F,O),nt=jm(O,O),at=jm(G,F),ut=jm(G,O),Bt=K*nt-X*X,It=(nt*at-X*ut)/Bt,Nt=(K*ut-X*at)/Bt,ee=p.z*(1-It-Nt)+b.z*It+S.z*Nt;if(isFinite(ee))return ee}return 1/0}{let h=1/0;for(const p of c)h=Math.min(h,p.z);return h}}const Xbt=Si([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Jbt}=Xbt,Ybt=Si([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Zbt}=Ybt,twt=xh.VectorTileFeature.types,ewt=Math.cos(Math.PI/180*37.5),kN=Math.pow(2,14)/.5;class ZE{constructor(c){this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(h=>h.id),this.index=c.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(h=>{this.gradients[h.id]={}}),this.layoutVertexArray=new j,this.layoutVertexArray2=new V,this.indexArray=new Tt,this.programConfigurations=new Sn(c.layers,c.zoom),this.segments=new Wt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(c,h,p){this.hasPattern=$E("line",this.layers,h);const b=this.layers[0].layout.get("line-sort-key"),S=!b.isConstant(),I=[];for(const{feature:F,id:O,index:G,sourceLayerIndex:K}of c){const X=this.layers[0]._featureFilter.needGeometry,nt=Mc(F,X);if(!this.layers[0]._featureFilter.filter(new Gn(this.zoom),nt,p))continue;const at=S?b.evaluate(nt,{},p):void 0,ut={id:O,properties:F.properties,type:F.type,sourceLayerIndex:K,index:G,geometry:X?nt.geometry:Pc(F),patterns:{},sortKey:at};I.push(ut)}S&&I.sort((F,O)=>F.sortKey-O.sortKey);for(const F of I){const{geometry:O,index:G,sourceLayerIndex:K}=F;if(this.hasPattern){const X=WE("line",this.layers,F,this.zoom,h);this.patternFeatures.push(X)}else this.addFeature(F,O,G,p,{});h.featureIndex.insert(c[G].feature,O,G,K,this.index)}}update(c,h,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(c,h,this.stateDependentLayers,p)}addFeatures(c,h,p){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,h,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(c){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=c.createVertexBuffer(this.layoutVertexArray2,Zbt)),this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,Jbt),this.indexBuffer=c.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(c),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(c){if(c.properties&&Object.prototype.hasOwnProperty.call(c.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(c.properties,"mapbox_clip_end"))return{start:+c.properties.mapbox_clip_start,end:+c.properties.mapbox_clip_end}}addFeature(c,h,p,b,S){const I=this.layers[0].layout,F=I.get("line-join").evaluate(c,{}),O=I.get("line-cap"),G=I.get("line-miter-limit"),K=I.get("line-round-limit");this.lineClips=this.lineFeatureClips(c);for(const X of h)this.addLine(X,c,F,O,G,K);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,c,p,S,b)}addLine(c,h,p,b,S,I){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Nt=0;Nt<c.length-1;Nt++)this.totalDistance+=c[Nt].dist(c[Nt+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const F=twt[h.type]==="Polygon";let O=c.length;for(;O>=2&&c[O-1].equals(c[O-2]);)O--;let G=0;for(;G<O-1&&c[G].equals(c[G+1]);)G++;if(O<(F?3:2))return;p==="bevel"&&(S=1.05);const K=this.overscaling<=16?15*Dn/(512*this.overscaling):0,X=this.segments.prepareSegment(10*O,this.layoutVertexArray,this.indexArray);let nt,at,ut,Bt,It;this.e1=this.e2=-1,F&&(nt=c[O-2],It=c[G].sub(nt)._unit()._perp());for(let Nt=G;Nt<O;Nt++){if(ut=Nt===O-1?F?c[G+1]:void 0:c[Nt+1],ut&&c[Nt].equals(ut))continue;It&&(Bt=It),nt&&(at=nt),nt=c[Nt],It=ut?ut.sub(nt)._unit()._perp():Bt,Bt=Bt||It;let ee=Bt.add(It);ee.x===0&&ee.y===0||ee._unit();const Ht=Bt.x*It.x+Bt.y*It.y,Kt=ee.x*It.x+ee.y*It.y,ve=Kt!==0?1/Kt:1/0,be=2*Math.sqrt(2-2*Kt),Ze=Kt<ewt&&at&&ut,hr=Bt.x*It.y-Bt.y*It.x>0;if(Ze&&Nt>G){const ke=nt.dist(at);if(ke>2*K){const or=nt.sub(nt.sub(at)._mult(K/ke)._round());this.updateDistance(at,or),this.addCurrentVertex(or,Bt,0,0,X),at=or}}const Xe=at&&ut;let $e=Xe?p:F?"butt":b;if(Xe&&$e==="round"&&(ve<I?$e="miter":ve<=2&&($e="fakeround")),$e==="miter"&&ve>S&&($e="bevel"),$e==="bevel"&&(ve>2&&($e="flipbevel"),ve<S&&($e="miter")),at&&this.updateDistance(at,nt),$e==="miter")ee._mult(ve),this.addCurrentVertex(nt,ee,0,0,X);else if($e==="flipbevel"){if(ve>100)ee=It.mult(-1);else{const ke=ve*Bt.add(It).mag()/Bt.sub(It).mag();ee._perp()._mult(ke*(hr?-1:1))}this.addCurrentVertex(nt,ee,0,0,X),this.addCurrentVertex(nt,ee.mult(-1),0,0,X)}else if($e==="bevel"||$e==="fakeround"){const ke=-Math.sqrt(ve*ve-1),or=hr?ke:0,je=hr?0:ke;if(at&&this.addCurrentVertex(nt,Bt,or,je,X),$e==="fakeround"){const Fe=Math.round(180*be/Math.PI/20);for(let Cr=1;Cr<Fe;Cr++){let pr=Cr/Fe;if(pr!==.5){const ci=pr-.5;pr+=pr*ci*(pr-1)*((1.0904+Ht*(Ht*(3.55645-1.43519*Ht)-3.2452))*ci*ci+(.848013+Ht*(.215638*Ht-1.06021)))}const en=It.sub(Bt)._mult(pr)._add(Bt)._unit()._mult(hr?-1:1);this.addHalfVertex(nt,en.x,en.y,!1,hr,0,X)}}ut&&this.addCurrentVertex(nt,It,-or,-je,X)}else if($e==="butt")this.addCurrentVertex(nt,ee,0,0,X);else if($e==="square"){const ke=at?1:-1;this.addCurrentVertex(nt,ee,ke,ke,X)}else $e==="round"&&(at&&(this.addCurrentVertex(nt,Bt,0,0,X),this.addCurrentVertex(nt,Bt,1,1,X,!0)),ut&&(this.addCurrentVertex(nt,It,-1,-1,X,!0),this.addCurrentVertex(nt,It,0,0,X)));if(Ze&&Nt<O-1){const ke=nt.dist(ut);if(ke>2*K){const or=nt.add(ut.sub(nt)._mult(K/ke)._round());this.updateDistance(nt,or),this.addCurrentVertex(or,It,0,0,X),nt=or}}}}addCurrentVertex(c,h,p,b,S){let I=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!1;const F=h.y*b-h.x,O=-h.y-h.x*b;this.addHalfVertex(c,h.x+h.y*p,h.y-h.x*p,I,!1,p,S),this.addHalfVertex(c,F,O,I,!0,-b,S),this.distance>kN/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(c,h,p,b,S,I))}addHalfVertex(c,h,p,b,S,I,F){let{x:O,y:G}=c;const K=.5*(this.lineClips?this.scaledDistance*(kN-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((O<<1)+(b?1:0),(G<<1)+(S?1:0),Math.round(63*h)+128,Math.round(63*p)+128,1+(I===0?0:I<0?-1:1)|(63&K)<<2,K>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const X=F.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,X),F.primitiveLength++),S?this.e2=X:this.e1=X}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(c,h){this.distance+=c.dist(h),this.updateScaledDistance()}}let QN,HN;tr("LineBucket",ZE,{omit:["layers","patternFeatures"]});var zN={get paint(){return HN=HN||new Xi({"line-opacity":new wr(Jt.paint_line["line-opacity"]),"line-color":new wr(Jt.paint_line["line-color"]),"line-translate":new dr(Jt.paint_line["line-translate"]),"line-translate-anchor":new dr(Jt.paint_line["line-translate-anchor"]),"line-width":new wr(Jt.paint_line["line-width"]),"line-gap-width":new wr(Jt.paint_line["line-gap-width"]),"line-offset":new wr(Jt.paint_line["line-offset"]),"line-blur":new wr(Jt.paint_line["line-blur"]),"line-dasharray":new Sl(Jt.paint_line["line-dasharray"]),"line-pattern":new Ah(Jt.paint_line["line-pattern"]),"line-gradient":new AA(Jt.paint_line["line-gradient"])})},get layout(){return QN=QN||new Xi({"line-cap":new dr(Jt.layout_line["line-cap"]),"line-join":new wr(Jt.layout_line["line-join"]),"line-miter-limit":new dr(Jt.layout_line["line-miter-limit"]),"line-round-limit":new dr(Jt.layout_line["line-round-limit"]),"line-sort-key":new wr(Jt.layout_line["line-sort-key"])})}};class rwt extends wr{possiblyEvaluate(c,h){return h=new Gn(Math.floor(h.zoom),{now:h.now,fadeDuration:h.fadeDuration,zoomHistory:h.zoomHistory,transition:h.transition}),super.possiblyEvaluate(c,h)}evaluate(c,h,p,b){return h=mt({},h,{zoom:Math.floor(h.zoom)}),super.evaluate(c,h,p,b)}}let X_;class nwt extends ea{constructor(c){super(c,zN),this.gradientVersion=0,X_||(X_=new rwt(zN.paint.properties["line-width"].specification),X_.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(c){if(c==="line-gradient"){const h=this.gradientExpression();this.stepInterpolant=!!function(p){return p._styleExpression!==void 0}(h)&&h._styleExpression.expression instanceof dl,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(c,h){super.recalculate(c,h),this.paint._values["line-floorwidth"]=X_.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,c)}createBucket(c){return new ZE(c)}queryRadius(c){const h=c,p=GN(Pd("line-width",this,h),Pd("line-gap-width",this,h)),b=Pd("line-offset",this,h);return p/2+Math.abs(b)+vp(this.paint.get("line-translate"))}queryIntersectsFeature(c,h,p,b,S,I,F){const O=gh(c,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),I.angle,F),G=F/2*GN(this.paint.get("line-width").evaluate(h,p),this.paint.get("line-gap-width").evaluate(h,p)),K=this.paint.get("line-offset").evaluate(h,p);return K&&(b=function(X,nt){const at=[];for(let ut=0;ut<X.length;ut++){const Bt=X[ut],It=[];for(let Nt=0;Nt<Bt.length;Nt++){const ee=Bt[Nt-1],Ht=Bt[Nt],Kt=Bt[Nt+1],ve=Nt===0?new _(0,0):Ht.sub(ee)._unit()._perp(),be=Nt===Bt.length-1?new _(0,0):Kt.sub(Ht)._unit()._perp(),Ze=ve._add(be)._unit(),hr=Ze.x*be.x+Ze.y*be.y;hr!==0&&Ze._mult(1/hr),It.push(Ze._mult(nt)._add(Ht))}at.push(It)}return at}(b,K*F)),function(X,nt,at){for(let ut=0;ut<nt.length;ut++){const Bt=nt[ut];if(X.length>=3){for(let It=0;It<Bt.length;It++)if(Fl(X,Bt[It]))return!0}if(Rc(X,Bt,at))return!0}return!1}(O,b,G)}isTileClipped(){return!0}}function GN(u,c){return c>0?c+2*u:u}const iwt=Si([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),swt=Si([{name:"a_projected_pos",components:3,type:"Float32"}],4);Si([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const owt=Si([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Si([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const VN=Si([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),awt=Si([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function cwt(u,c,h){return u.sections.forEach(p=>{p.text=function(b,S,I){const F=S.layout.get("text-transform").evaluate(I,{});return F==="uppercase"?b=b.toLocaleUpperCase():F==="lowercase"&&(b=b.toLocaleLowerCase()),Xa.applyArabicShaping&&(b=Xa.applyArabicShaping(b)),b}(p.text,c,h)}),u}Si([{name:"triangle",components:3,type:"Uint16"}]),Si([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Si([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Si([{type:"Float32",name:"offsetX"}]),Si([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Si([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const qm={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var As=24,jN=jn,qN=function(u,c,h,p,b){var S,I,F=8*b-p-1,O=(1<<F)-1,G=O>>1,K=-7,X=h?b-1:0,nt=h?-1:1,at=u[c+X];for(X+=nt,S=at&(1<<-K)-1,at>>=-K,K+=F;K>0;S=256*S+u[c+X],X+=nt,K-=8);for(I=S&(1<<-K)-1,S>>=-K,K+=p;K>0;I=256*I+u[c+X],X+=nt,K-=8);if(S===0)S=1-G;else{if(S===O)return I?NaN:1/0*(at?-1:1);I+=Math.pow(2,p),S-=G}return(at?-1:1)*I*Math.pow(2,S-p)},KN=function(u,c,h,p,b,S){var I,F,O,G=8*S-b-1,K=(1<<G)-1,X=K>>1,nt=b===23?Math.pow(2,-24)-Math.pow(2,-77):0,at=p?0:S-1,ut=p?1:-1,Bt=c<0||c===0&&1/c<0?1:0;for(c=Math.abs(c),isNaN(c)||c===1/0?(F=isNaN(c)?1:0,I=K):(I=Math.floor(Math.log(c)/Math.LN2),c*(O=Math.pow(2,-I))<1&&(I--,O*=2),(c+=I+X>=1?nt/O:nt*Math.pow(2,1-X))*O>=2&&(I++,O/=2),I+X>=K?(F=0,I=K):I+X>=1?(F=(c*O-1)*Math.pow(2,b),I+=X):(F=c*Math.pow(2,X-1)*Math.pow(2,b),I=0));b>=8;u[h+at]=255&F,at+=ut,F/=256,b-=8);for(I=I<<b|F,G+=b;G>0;u[h+at]=255&I,at+=ut,I/=256,G-=8);u[h+at-ut]|=128*Bt};function jn(u){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(u)?u:new Uint8Array(u||0),this.pos=0,this.type=0,this.length=this.buf.length}jn.Varint=0,jn.Fixed64=1,jn.Bytes=2,jn.Fixed32=5;var tS=4294967296,$N=1/tS,WN=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function vA(u){return u.type===jn.Bytes?u.readVarint()+u.pos:u.pos+1}function Ep(u,c,h){return h?4294967296*c+(u>>>0):4294967296*(c>>>0)+(u>>>0)}function XN(u,c,h){var p=c<=16383?1:c<=2097151?2:c<=268435455?3:Math.floor(Math.log(c)/(7*Math.LN2));h.realloc(p);for(var b=h.pos-1;b>=u;b--)h.buf[b+p]=h.buf[b]}function lwt(u,c){for(var h=0;h<u.length;h++)c.writeVarint(u[h])}function uwt(u,c){for(var h=0;h<u.length;h++)c.writeSVarint(u[h])}function Awt(u,c){for(var h=0;h<u.length;h++)c.writeFloat(u[h])}function hwt(u,c){for(var h=0;h<u.length;h++)c.writeDouble(u[h])}function dwt(u,c){for(var h=0;h<u.length;h++)c.writeBoolean(u[h])}function fwt(u,c){for(var h=0;h<u.length;h++)c.writeFixed32(u[h])}function pwt(u,c){for(var h=0;h<u.length;h++)c.writeSFixed32(u[h])}function gwt(u,c){for(var h=0;h<u.length;h++)c.writeFixed64(u[h])}function mwt(u,c){for(var h=0;h<u.length;h++)c.writeSFixed64(u[h])}function J_(u,c){return(u[c]|u[c+1]<<8|u[c+2]<<16)+16777216*u[c+3]}function Sp(u,c,h){u[h]=c,u[h+1]=c>>>8,u[h+2]=c>>>16,u[h+3]=c>>>24}function JN(u,c){return(u[c]|u[c+1]<<8|u[c+2]<<16)+(u[c+3]<<24)}jn.prototype={destroy:function(){this.buf=null},readFields:function(u,c,h){for(h=h||this.length;this.pos<h;){var p=this.readVarint(),b=p>>3,S=this.pos;this.type=7&p,u(b,c,this),this.pos===S&&this.skip(p)}return c},readMessage:function(u,c){return this.readFields(u,c,this.readVarint()+this.pos)},readFixed32:function(){var u=J_(this.buf,this.pos);return this.pos+=4,u},readSFixed32:function(){var u=JN(this.buf,this.pos);return this.pos+=4,u},readFixed64:function(){var u=J_(this.buf,this.pos)+J_(this.buf,this.pos+4)*tS;return this.pos+=8,u},readSFixed64:function(){var u=J_(this.buf,this.pos)+JN(this.buf,this.pos+4)*tS;return this.pos+=8,u},readFloat:function(){var u=qN(this.buf,this.pos,!0,23,4);return this.pos+=4,u},readDouble:function(){var u=qN(this.buf,this.pos,!0,52,8);return this.pos+=8,u},readVarint:function(u){var c,h,p=this.buf;return c=127&(h=p[this.pos++]),h<128?c:(c|=(127&(h=p[this.pos++]))<<7,h<128?c:(c|=(127&(h=p[this.pos++]))<<14,h<128?c:(c|=(127&(h=p[this.pos++]))<<21,h<128?c:function(b,S,I){var F,O,G=I.buf;if(F=(112&(O=G[I.pos++]))>>4,O<128||(F|=(127&(O=G[I.pos++]))<<3,O<128)||(F|=(127&(O=G[I.pos++]))<<10,O<128)||(F|=(127&(O=G[I.pos++]))<<17,O<128)||(F|=(127&(O=G[I.pos++]))<<24,O<128)||(F|=(1&(O=G[I.pos++]))<<31,O<128))return Ep(b,F,S);throw new Error("Expected varint not more than 10 bytes")}(c|=(15&(h=p[this.pos]))<<28,u,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var u=this.readVarint();return u%2==1?(u+1)/-2:u/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var u=this.readVarint()+this.pos,c=this.pos;return this.pos=u,u-c>=12&&WN?function(h,p,b){return WN.decode(h.subarray(p,b))}(this.buf,c,u):function(h,p,b){for(var S="",I=p;I<b;){var F,O,G,K=h[I],X=null,nt=K>239?4:K>223?3:K>191?2:1;if(I+nt>b)break;nt===1?K<128&&(X=K):nt===2?(192&(F=h[I+1]))==128&&(X=(31&K)<<6|63&F)<=127&&(X=null):nt===3?(O=h[I+2],(192&(F=h[I+1]))==128&&(192&O)==128&&((X=(15&K)<<12|(63&F)<<6|63&O)<=2047||X>=55296&&X<=57343)&&(X=null)):nt===4&&(O=h[I+2],G=h[I+3],(192&(F=h[I+1]))==128&&(192&O)==128&&(192&G)==128&&((X=(15&K)<<18|(63&F)<<12|(63&O)<<6|63&G)<=65535||X>=1114112)&&(X=null)),X===null?(X=65533,nt=1):X>65535&&(X-=65536,S+=String.fromCharCode(X>>>10&1023|55296),X=56320|1023&X),S+=String.fromCharCode(X),I+=nt}return S}(this.buf,c,u)},readBytes:function(){var u=this.readVarint()+this.pos,c=this.buf.subarray(this.pos,u);return this.pos=u,c},readPackedVarint:function(u,c){if(this.type!==jn.Bytes)return u.push(this.readVarint(c));var h=vA(this);for(u=u||[];this.pos<h;)u.push(this.readVarint(c));return u},readPackedSVarint:function(u){if(this.type!==jn.Bytes)return u.push(this.readSVarint());var c=vA(this);for(u=u||[];this.pos<c;)u.push(this.readSVarint());return u},readPackedBoolean:function(u){if(this.type!==jn.Bytes)return u.push(this.readBoolean());var c=vA(this);for(u=u||[];this.pos<c;)u.push(this.readBoolean());return u},readPackedFloat:function(u){if(this.type!==jn.Bytes)return u.push(this.readFloat());var c=vA(this);for(u=u||[];this.pos<c;)u.push(this.readFloat());return u},readPackedDouble:function(u){if(this.type!==jn.Bytes)return u.push(this.readDouble());var c=vA(this);for(u=u||[];this.pos<c;)u.push(this.readDouble());return u},readPackedFixed32:function(u){if(this.type!==jn.Bytes)return u.push(this.readFixed32());var c=vA(this);for(u=u||[];this.pos<c;)u.push(this.readFixed32());return u},readPackedSFixed32:function(u){if(this.type!==jn.Bytes)return u.push(this.readSFixed32());var c=vA(this);for(u=u||[];this.pos<c;)u.push(this.readSFixed32());return u},readPackedFixed64:function(u){if(this.type!==jn.Bytes)return u.push(this.readFixed64());var c=vA(this);for(u=u||[];this.pos<c;)u.push(this.readFixed64());return u},readPackedSFixed64:function(u){if(this.type!==jn.Bytes)return u.push(this.readSFixed64());var c=vA(this);for(u=u||[];this.pos<c;)u.push(this.readSFixed64());return u},skip:function(u){var c=7&u;if(c===jn.Varint)for(;this.buf[this.pos++]>127;);else if(c===jn.Bytes)this.pos=this.readVarint()+this.pos;else if(c===jn.Fixed32)this.pos+=4;else{if(c!==jn.Fixed64)throw new Error("Unimplemented type: "+c);this.pos+=8}},writeTag:function(u,c){this.writeVarint(u<<3|c)},realloc:function(u){for(var c=this.length||16;c<this.pos+u;)c*=2;if(c!==this.length){var h=new Uint8Array(c);h.set(this.buf),this.buf=h,this.length=c}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(u){this.realloc(4),Sp(this.buf,u,this.pos),this.pos+=4},writeSFixed32:function(u){this.realloc(4),Sp(this.buf,u,this.pos),this.pos+=4},writeFixed64:function(u){this.realloc(8),Sp(this.buf,-1&u,this.pos),Sp(this.buf,Math.floor(u*$N),this.pos+4),this.pos+=8},writeSFixed64:function(u){this.realloc(8),Sp(this.buf,-1&u,this.pos),Sp(this.buf,Math.floor(u*$N),this.pos+4),this.pos+=8},writeVarint:function(u){(u=+u||0)>268435455||u<0?function(c,h){var p,b;if(c>=0?(p=c%4294967296|0,b=c/4294967296|0):(b=~(-c/4294967296),4294967295^(p=~(-c%4294967296))?p=p+1|0:(p=0,b=b+1|0)),c>=18446744073709552e3||c<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");h.realloc(10),function(S,I,F){F.buf[F.pos++]=127&S|128,S>>>=7,F.buf[F.pos++]=127&S|128,S>>>=7,F.buf[F.pos++]=127&S|128,S>>>=7,F.buf[F.pos++]=127&S|128,F.buf[F.pos]=127&(S>>>=7)}(p,0,h),function(S,I){var F=(7&S)<<4;I.buf[I.pos++]|=F|((S>>>=3)?128:0),S&&(I.buf[I.pos++]=127&S|((S>>>=7)?128:0),S&&(I.buf[I.pos++]=127&S|((S>>>=7)?128:0),S&&(I.buf[I.pos++]=127&S|((S>>>=7)?128:0),S&&(I.buf[I.pos++]=127&S|((S>>>=7)?128:0),S&&(I.buf[I.pos++]=127&S)))))}(b,h)}(u,this):(this.realloc(4),this.buf[this.pos++]=127&u|(u>127?128:0),u<=127||(this.buf[this.pos++]=127&(u>>>=7)|(u>127?128:0),u<=127||(this.buf[this.pos++]=127&(u>>>=7)|(u>127?128:0),u<=127||(this.buf[this.pos++]=u>>>7&127))))},writeSVarint:function(u){this.writeVarint(u<0?2*-u-1:2*u)},writeBoolean:function(u){this.writeVarint(!!u)},writeString:function(u){u=String(u),this.realloc(4*u.length),this.pos++;var c=this.pos;this.pos=function(p,b,S){for(var I,F,O=0;O<b.length;O++){if((I=b.charCodeAt(O))>55295&&I<57344){if(!F){I>56319||O+1===b.length?(p[S++]=239,p[S++]=191,p[S++]=189):F=I;continue}if(I<56320){p[S++]=239,p[S++]=191,p[S++]=189,F=I;continue}I=F-55296<<10|I-56320|65536,F=null}else F&&(p[S++]=239,p[S++]=191,p[S++]=189,F=null);I<128?p[S++]=I:(I<2048?p[S++]=I>>6|192:(I<65536?p[S++]=I>>12|224:(p[S++]=I>>18|240,p[S++]=I>>12&63|128),p[S++]=I>>6&63|128),p[S++]=63&I|128)}return S}(this.buf,u,this.pos);var h=this.pos-c;h>=128&&XN(c,h,this),this.pos=c-1,this.writeVarint(h),this.pos+=h},writeFloat:function(u){this.realloc(4),KN(this.buf,u,this.pos,!0,23,4),this.pos+=4},writeDouble:function(u){this.realloc(8),KN(this.buf,u,this.pos,!0,52,8),this.pos+=8},writeBytes:function(u){var c=u.length;this.writeVarint(c),this.realloc(c);for(var h=0;h<c;h++)this.buf[this.pos++]=u[h]},writeRawMessage:function(u,c){this.pos++;var h=this.pos;u(c,this);var p=this.pos-h;p>=128&&XN(h,p,this),this.pos=h-1,this.writeVarint(p),this.pos+=p},writeMessage:function(u,c,h){this.writeTag(u,jn.Bytes),this.writeRawMessage(c,h)},writePackedVarint:function(u,c){c.length&&this.writeMessage(u,lwt,c)},writePackedSVarint:function(u,c){c.length&&this.writeMessage(u,uwt,c)},writePackedBoolean:function(u,c){c.length&&this.writeMessage(u,dwt,c)},writePackedFloat:function(u,c){c.length&&this.writeMessage(u,Awt,c)},writePackedDouble:function(u,c){c.length&&this.writeMessage(u,hwt,c)},writePackedFixed32:function(u,c){c.length&&this.writeMessage(u,fwt,c)},writePackedSFixed32:function(u,c){c.length&&this.writeMessage(u,pwt,c)},writePackedFixed64:function(u,c){c.length&&this.writeMessage(u,gwt,c)},writePackedSFixed64:function(u,c){c.length&&this.writeMessage(u,mwt,c)},writeBytesField:function(u,c){this.writeTag(u,jn.Bytes),this.writeBytes(c)},writeFixed32Field:function(u,c){this.writeTag(u,jn.Fixed32),this.writeFixed32(c)},writeSFixed32Field:function(u,c){this.writeTag(u,jn.Fixed32),this.writeSFixed32(c)},writeFixed64Field:function(u,c){this.writeTag(u,jn.Fixed64),this.writeFixed64(c)},writeSFixed64Field:function(u,c){this.writeTag(u,jn.Fixed64),this.writeSFixed64(c)},writeVarintField:function(u,c){this.writeTag(u,jn.Varint),this.writeVarint(c)},writeSVarintField:function(u,c){this.writeTag(u,jn.Varint),this.writeSVarint(c)},writeStringField:function(u,c){this.writeTag(u,jn.Bytes),this.writeString(c)},writeFloatField:function(u,c){this.writeTag(u,jn.Fixed32),this.writeFloat(c)},writeDoubleField:function(u,c){this.writeTag(u,jn.Fixed64),this.writeDouble(c)},writeBooleanField:function(u,c){this.writeVarintField(u,!!c)}};var eS=A(jN);const rS=3;function ywt(u,c,h){u===1&&h.readMessage(_wt,c)}function _wt(u,c,h){if(u===3){const{id:p,bitmap:b,width:S,height:I,left:F,top:O,advance:G}=h.readMessage(vwt,{});c.push({id:p,bitmap:new vh({width:S+2*rS,height:I+2*rS},b),metrics:{width:S,height:I,left:F,top:O,advance:G}})}}function vwt(u,c,h){u===1?c.id=h.readVarint():u===2?c.bitmap=h.readBytes():u===3?c.width=h.readVarint():u===4?c.height=h.readVarint():u===5?c.left=h.readSVarint():u===6?c.top=h.readSVarint():u===7&&(c.advance=h.readVarint())}const YN=rS;function ZN(u){let c=0,h=0;for(const I of u)c+=I.w*I.h,h=Math.max(h,I.w);u.sort((I,F)=>F.h-I.h);const p=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(c/.95)),h),h:1/0}];let b=0,S=0;for(const I of u)for(let F=p.length-1;F>=0;F--){const O=p[F];if(!(I.w>O.w||I.h>O.h)){if(I.x=O.x,I.y=O.y,S=Math.max(S,I.y+I.h),b=Math.max(b,I.x+I.w),I.w===O.w&&I.h===O.h){const G=p.pop();F<p.length&&(p[F]=G)}else I.h===O.h?(O.x+=I.w,O.w-=I.w):I.w===O.w?(O.y+=I.h,O.h-=I.h):(p.push({x:O.x+I.w,y:O.y,w:O.w-I.w,h:I.h}),O.y+=I.h,O.h-=I.h);break}}return{w:b,h:S,fill:c/(b*S)||0}}const sa=1;class nS{constructor(c,h){let{pixelRatio:p,version:b,stretchX:S,stretchY:I,content:F}=h;this.paddedRect=c,this.pixelRatio=p,this.stretchX=S,this.stretchY=I,this.content=F,this.version=b}get tl(){return[this.paddedRect.x+sa,this.paddedRect.y+sa]}get br(){return[this.paddedRect.x+this.paddedRect.w-sa,this.paddedRect.y+this.paddedRect.h-sa]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*sa)/this.pixelRatio,(this.paddedRect.h-2*sa)/this.pixelRatio]}}class tk{constructor(c,h){const p={},b={};this.haveRenderCallbacks=[];const S=[];this.addImages(c,p,S),this.addImages(h,b,S);const{w:I,h:F}=ZN(S),O=new ia({width:I||1,height:F||1});for(const G in c){const K=c[G],X=p[G].paddedRect;ia.copy(K.data,O,{x:0,y:0},{x:X.x+sa,y:X.y+sa},K.data)}for(const G in h){const K=h[G],X=b[G].paddedRect,nt=X.x+sa,at=X.y+sa,ut=K.data.width,Bt=K.data.height;ia.copy(K.data,O,{x:0,y:0},{x:nt,y:at},K.data),ia.copy(K.data,O,{x:0,y:Bt-1},{x:nt,y:at-1},{width:ut,height:1}),ia.copy(K.data,O,{x:0,y:0},{x:nt,y:at+Bt},{width:ut,height:1}),ia.copy(K.data,O,{x:ut-1,y:0},{x:nt-1,y:at},{width:1,height:Bt}),ia.copy(K.data,O,{x:0,y:0},{x:nt+ut,y:at},{width:1,height:Bt})}this.image=O,this.iconPositions=p,this.patternPositions=b}addImages(c,h,p){for(const b in c){const S=c[b],I={x:0,y:0,w:S.data.width+2*sa,h:S.data.height+2*sa};p.push(I),h[b]=new nS(I,S),S.hasRenderCallback&&this.haveRenderCallbacks.push(b)}}patchUpdatedImages(c,h){c.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const p in c.updatedImages)this.patchUpdatedImage(this.iconPositions[p],c.getImage(p),h),this.patchUpdatedImage(this.patternPositions[p],c.getImage(p),h)}patchUpdatedImage(c,h,p){if(!c||!h||c.version===h.version)return;c.version=h.version;const[b,S]=c.tl;p.update(h.data,void 0,{x:b,y:S})}}var Bh;tr("ImagePosition",nS),tr("ImageAtlas",tk),a.ah=void 0,(Bh=a.ah||(a.ah={}))[Bh.none=0]="none",Bh[Bh.horizontal=1]="horizontal",Bh[Bh.vertical=2]="vertical",Bh[Bh.horizontalOnly=3]="horizontalOnly";const Km=-17;class $m{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(c,h){const p=new $m;return p.scale=c||1,p.fontStack=h,p}static forImage(c){const h=new $m;return h.imageName=c,h}}class Tp{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(c,h){const p=new Tp;for(let b=0;b<c.sections.length;b++){const S=c.sections[b];S.image?p.addImageSection(S):p.addTextSection(S,h)}return p}length(){return this.text.length}getSection(c){return this.sections[this.sectionIndex[c]]}getSectionIndex(c){return this.sectionIndex[c]}getCharCode(c){return this.text.charCodeAt(c)}verticalizePunctuation(){this.text=function(c){let h="";for(let p=0;p<c.length;p++){const b=c.charCodeAt(p+1)||null,S=c.charCodeAt(p-1)||null;h+=b&&uh(b)&&!qm[c[p+1]]||S&&uh(S)&&!qm[c[p-1]]||!qm[c[p]]?c[p]:qm[c[p]]}return h}(this.text)}trim(){let c=0;for(let p=0;p<this.text.length&&Z_[this.text.charCodeAt(p)];p++)c++;let h=this.text.length;for(let p=this.text.length-1;p>=0&&p>=c&&Z_[this.text.charCodeAt(p)];p--)h--;this.text=this.text.substring(c,h),this.sectionIndex=this.sectionIndex.slice(c,h)}substring(c,h){const p=new Tp;return p.text=this.text.substring(c,h),p.sectionIndex=this.sectionIndex.slice(c,h),p.sections=this.sections,p}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((c,h)=>Math.max(c,this.sections[h].scale),0)}addTextSection(c,h){this.text+=c.text,this.sections.push($m.forText(c.scale,c.fontStack||h));const p=this.sections.length-1;for(let b=0;b<c.text.length;++b)this.sectionIndex.push(p)}addImageSection(c){const h=c.image?c.image.name:"";if(h.length===0)return void wt("Can't add FormattedSection with an empty image.");const p=this.getNextImageSectionCharCode();p?(this.text+=String.fromCharCode(p),this.sections.push($m.forImage(h)),this.sectionIndex.push(this.sections.length-1)):wt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Y_(u,c,h,p,b,S,I,F,O,G,K,X,nt,at,ut,Bt){const It=Tp.fromFeature(u,b);let Nt;X===a.ah.vertical&&It.verticalizePunctuation();const{processBidirectionalText:ee,processStyledBidirectionalText:Ht}=Xa;if(ee&&It.sections.length===1){Nt=[];const be=ee(It.toString(),iS(It,G,S,c,p,at,ut));for(const Ze of be){const hr=new Tp;hr.text=Ze,hr.sections=It.sections;for(let Xe=0;Xe<Ze.length;Xe++)hr.sectionIndex.push(0);Nt.push(hr)}}else if(Ht){Nt=[];const be=Ht(It.text,It.sectionIndex,iS(It,G,S,c,p,at,ut));for(const Ze of be){const hr=new Tp;hr.text=Ze[0],hr.sectionIndex=Ze[1],hr.sections=It.sections,Nt.push(hr)}}else Nt=function(be,Ze){const hr=[],Xe=be.text;let $e=0;for(const ke of Ze)hr.push(be.substring($e,ke)),$e=ke;return $e<Xe.length&&hr.push(be.substring($e,Xe.length)),hr}(It,iS(It,G,S,c,p,at,ut));const Kt=[],ve={positionedLines:Kt,text:It.toString(),top:K[1],bottom:K[1],left:K[0],right:K[0],writingMode:X,iconsInText:!1,verticalizable:!1};return function(be,Ze,hr,Xe,$e,ke,or,je,Fe,Cr,pr,en){let ci=0,pi=Km,hs=0,Ta=0;const Lo=je==="right"?1:je==="left"?0:.5;let Yi=0;for(const ds of $e){ds.trim();const fs=ds.getMaxScale(),so=(fs-1)*As,Mo={positionedGlyphs:[],lineOffset:0};be.positionedLines[Yi]=Mo;const oo=Mo.positionedGlyphs;let oa=0;if(!ds.length()){pi+=ke,++Yi;continue}for(let ps=0;ps<ds.length();ps++){const An=ds.getSection(ps),ao=ds.getSectionIndex(ps),Ks=ds.getCharCode(ps);let gs=0,Oc=null,Ul=null,Rl=null,bA=As;const Dc=!(Fe===a.ah.horizontal||!pr&&!xl(Ks)||pr&&(Z_[Ks]||(Is=Ks,qe.Arabic(Is)||qe["Arabic Supplement"](Is)||qe["Arabic Extended-A"](Is)||qe["Arabic Presentation Forms-A"](Is)||qe["Arabic Presentation Forms-B"](Is))));if(An.imageName){const Za=Xe[An.imageName];if(!Za)continue;Rl=An.imageName,be.iconsInText=be.iconsInText||!0,Ul=Za.paddedRect;const ca=Za.displaySize;An.scale=An.scale*As/en,Oc={width:ca[0],height:ca[1],left:sa,top:-YN,advance:Dc?ca[1]:ca[0]},gs=so+(As-ca[1]*An.scale),bA=Oc.advance;const wA=Dc?ca[0]*An.scale-As*fs:ca[1]*An.scale-As*fs;wA>0&&wA>oa&&(oa=wA)}else{const Za=hr[An.fontStack],ca=Za&&Za[Ks];if(ca&&ca.rect)Ul=ca.rect,Oc=ca.metrics;else{const wA=Ze[An.fontStack],Zm=wA&&wA[Ks];if(!Zm)continue;Oc=Zm.metrics}gs=(fs-An.scale)*As}Dc?(be.verticalizable=!0,oo.push({glyph:Ks,imageName:Rl,x:ci,y:pi+gs,vertical:Dc,scale:An.scale,fontStack:An.fontStack,sectionIndex:ao,metrics:Oc,rect:Ul}),ci+=bA*An.scale+Cr):(oo.push({glyph:Ks,imageName:Rl,x:ci,y:pi+gs,vertical:Dc,scale:An.scale,fontStack:An.fontStack,sectionIndex:ao,metrics:Oc,rect:Ul}),ci+=Oc.advance*An.scale+Cr)}oo.length!==0&&(hs=Math.max(ci-Cr,hs),xwt(oo,0,oo.length-1,Lo,oa)),ci=0;const aa=ke*fs+oa;Mo.lineOffset=Math.max(oa,so),pi+=aa,Ta=Math.max(aa,Ta),++Yi}var Is;const qs=pi-Km,{horizontalAlign:Fo,verticalAlign:Po}=sS(or);(function(ds,fs,so,Mo,oo,oa,aa,ps,An){const ao=(fs-so)*oo;let Ks=0;Ks=oa!==aa?-ps*Mo-Km:(-Mo*An+.5)*aa;for(const gs of ds)for(const Oc of gs.positionedGlyphs)Oc.x+=ao,Oc.y+=Ks})(be.positionedLines,Lo,Fo,Po,hs,Ta,ke,qs,$e.length),be.top+=-Po*qs,be.bottom=be.top+qs,be.left+=-Fo*hs,be.right=be.left+hs}(ve,c,h,p,Nt,I,F,O,X,G,nt,Bt),!function(be){for(const Ze of be)if(Ze.positionedGlyphs.length!==0)return!1;return!0}(Kt)&&ve}const Z_={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},bwt={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function ek(u,c,h,p,b,S){if(c.imageName){const I=p[c.imageName];return I?I.displaySize[0]*c.scale*As/S+b:0}{const I=h[c.fontStack],F=I&&I[u];return F?F.metrics.advance*c.scale+b:0}}function rk(u,c,h,p){const b=Math.pow(u-c,2);return p?u<c?b/2:2*b:b+Math.abs(h)*h}function wwt(u,c,h){let p=0;return u===10&&(p-=1e4),h&&(p+=150),u!==40&&u!==65288||(p+=50),c!==41&&c!==65289||(p+=50),p}function nk(u,c,h,p,b,S){let I=null,F=rk(c,h,b,S);for(const O of p){const G=rk(c-O.x,h,b,S)+O.badness;G<=F&&(I=O,F=G)}return{index:u,x:c,priorBreak:I,badness:F}}function ik(u){return u?ik(u.priorBreak).concat(u.index):[]}function iS(u,c,h,p,b,S,I){if(S!=="point")return[];if(!u)return[];const F=[],O=function(nt,at,ut,Bt,It,Nt){let ee=0;for(let Ht=0;Ht<nt.length();Ht++){const Kt=nt.getSection(Ht);ee+=ek(nt.getCharCode(Ht),Kt,Bt,It,at,Nt)}return ee/Math.max(1,Math.ceil(ee/ut))}(u,c,h,p,b,I),G=u.text.indexOf("")>=0;let K=0;for(let nt=0;nt<u.length();nt++){const at=u.getSection(nt),ut=u.getCharCode(nt);if(Z_[ut]||(K+=ek(ut,at,p,b,c,I)),nt<u.length()-1){const Bt=!((X=ut)<11904||!(qe["Bopomofo Extended"](X)||qe.Bopomofo(X)||qe["CJK Compatibility Forms"](X)||qe["CJK Compatibility Ideographs"](X)||qe["CJK Compatibility"](X)||qe["CJK Radicals Supplement"](X)||qe["CJK Strokes"](X)||qe["CJK Symbols and Punctuation"](X)||qe["CJK Unified Ideographs Extension A"](X)||qe["CJK Unified Ideographs"](X)||qe["Enclosed CJK Letters and Months"](X)||qe["Halfwidth and Fullwidth Forms"](X)||qe.Hiragana(X)||qe["Ideographic Description Characters"](X)||qe["Kangxi Radicals"](X)||qe["Katakana Phonetic Extensions"](X)||qe.Katakana(X)||qe["Vertical Forms"](X)||qe["Yi Radicals"](X)||qe["Yi Syllables"](X)));(bwt[ut]||Bt||at.imageName)&&F.push(nk(nt+1,K,O,F,wwt(ut,u.getCharCode(nt+1),Bt&&G),!1))}}var X;return ik(nk(u.length(),K,O,F,0,!0))}function sS(u){let c=.5,h=.5;switch(u){case"right":case"top-right":case"bottom-right":c=1;break;case"left":case"top-left":case"bottom-left":c=0}switch(u){case"bottom":case"bottom-right":case"bottom-left":h=1;break;case"top":case"top-right":case"top-left":h=0}return{horizontalAlign:c,verticalAlign:h}}function xwt(u,c,h,p,b){if(!p&&!b)return;const S=u[h],I=(u[h].x+S.metrics.advance*S.scale)*p;for(let F=c;F<=h;F++)u[F].x-=I,u[F].y+=b}function Bwt(u,c,h){const{horizontalAlign:p,verticalAlign:b}=sS(h),S=c[0]-u.displaySize[0]*p,I=c[1]-u.displaySize[1]*b;return{image:u,top:I,bottom:I+u.displaySize[1],left:S,right:S+u.displaySize[0]}}function sk(u,c,h,p,b,S){const I=u.image;let F;if(I.content){const It=I.content,Nt=I.pixelRatio||1;F=[It[0]/Nt,It[1]/Nt,I.displaySize[0]-It[2]/Nt,I.displaySize[1]-It[3]/Nt]}const O=c.left*S,G=c.right*S;let K,X,nt,at;h==="width"||h==="both"?(at=b[0]+O-p[3],X=b[0]+G+p[1]):(at=b[0]+(O+G-I.displaySize[0])/2,X=at+I.displaySize[0]);const ut=c.top*S,Bt=c.bottom*S;return h==="height"||h==="both"?(K=b[1]+ut-p[0],nt=b[1]+Bt+p[2]):(K=b[1]+(ut+Bt-I.displaySize[1])/2,nt=K+I.displaySize[1]),{image:I,top:K,right:X,bottom:nt,left:at,collisionPadding:F}}const Wm=255,wu=128,Ch=Wm*wu;function ok(u,c){const{expression:h}=c;if(h.kind==="constant")return{kind:"constant",layoutSize:h.evaluate(new Gn(u+1))};if(h.kind==="source")return{kind:"source"};{const{zoomStops:p,interpolationType:b}=h;let S=0;for(;S<p.length&&p[S]<=u;)S++;S=Math.max(0,S-1);let I=S;for(;I<p.length&&p[I]<u+1;)I++;I=Math.min(p.length-1,I);const F=p[S],O=p[I];return h.kind==="composite"?{kind:"composite",minZoom:F,maxZoom:O,interpolationType:b}:{kind:"camera",minZoom:F,maxZoom:O,minSize:h.evaluate(new Gn(F)),maxSize:h.evaluate(new Gn(O)),interpolationType:b}}}function oS(u,c,h){let p="never";const b=u.get(c);return b?p=b:u.get(h)&&(p="always"),p}const Cwt=xh.VectorTileFeature.types,Ewt=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function tv(u,c,h,p,b,S,I,F,O,G,K,X,nt){const at=F?Math.min(Ch,Math.round(F[0])):0,ut=F?Math.min(Ch,Math.round(F[1])):0;u.emplaceBack(c,h,Math.round(32*p),Math.round(32*b),S,I,(at<<1)+(O?1:0),ut,16*G,16*K,256*X,256*nt)}function aS(u,c,h){u.emplaceBack(c.x,c.y,h),u.emplaceBack(c.x,c.y,h),u.emplaceBack(c.x,c.y,h),u.emplaceBack(c.x,c.y,h)}function Swt(u){for(const c of u.sections)if(wd(c.text))return!0;return!1}class cS{constructor(c){this.layoutVertexArray=new lt,this.indexArray=new Tt,this.programConfigurations=c,this.segments=new Wt,this.dynamicLayoutVertexArray=new rt,this.opacityVertexArray=new ht,this.hasVisibleVertices=!1,this.placedSymbolArray=new d}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(c,h,p,b){this.isEmpty()||(p&&(this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,iwt.members),this.indexBuffer=c.createIndexBuffer(this.indexArray,h),this.dynamicLayoutVertexBuffer=c.createVertexBuffer(this.dynamicLayoutVertexArray,swt.members,!0),this.opacityVertexBuffer=c.createVertexBuffer(this.opacityVertexArray,Ewt,!0),this.opacityVertexBuffer.itemSize=1),(p||b)&&this.programConfigurations.upload(c))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}tr("SymbolBuffers",cS);class lS{constructor(c,h,p){this.layoutVertexArray=new c,this.layoutAttributes=h,this.indexArray=new p,this.segments=new Wt,this.collisionVertexArray=new Mt}upload(c){this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=c.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=c.createVertexBuffer(this.collisionVertexArray,owt.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}tr("CollisionBuffers",lS);class Ip{constructor(c){this.collisionBoxArray=c.collisionBoxArray,this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(I=>I.id),this.index=c.index,this.pixelRatio=c.pixelRatio,this.sourceLayerIndex=c.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=mh([]),this.placementViewportMatrix=mh([]);const h=this.layers[0]._unevaluatedLayout._values;this.textSizeData=ok(this.zoom,h["text-size"]),this.iconSizeData=ok(this.zoom,h["icon-size"]);const p=this.layers[0].layout,b=p.get("symbol-sort-key"),S=p.get("symbol-z-order");this.canOverlap=oS(p,"text-overlap","text-allow-overlap")!=="never"||oS(p,"icon-overlap","icon-allow-overlap")!=="never"||p.get("text-ignore-placement")||p.get("icon-ignore-placement"),this.sortFeaturesByKey=S!=="viewport-y"&&!b.isConstant(),this.sortFeaturesByY=(S==="viewport-y"||S==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,p.get("symbol-placement")==="point"&&(this.writingModes=p.get("text-writing-mode").map(I=>a.ah[I])),this.stateDependentLayerIds=this.layers.filter(I=>I.isStateDependent()).map(I=>I.id),this.sourceID=c.sourceID}createArrays(){this.text=new cS(new Sn(this.layers,this.zoom,c=>/^text/.test(c))),this.icon=new cS(new Sn(this.layers,this.zoom,c=>/^icon/.test(c))),this.glyphOffsetArray=new E,this.lineVertexArray=new U,this.symbolInstances=new v,this.textAnchorOffsets=new g}calculateGlyphDependencies(c,h,p,b,S){for(let I=0;I<c.length;I++)if(h[c.charCodeAt(I)]=!0,(p||b)&&S){const F=qm[c.charAt(I)];F&&(h[F.charCodeAt(0)]=!0)}}populate(c,h,p){const b=this.layers[0],S=b.layout,I=S.get("text-font"),F=S.get("text-field"),O=S.get("icon-image"),G=(F.value.kind!=="constant"||F.value.value instanceof _n&&!F.value.value.isEmpty()||F.value.value.toString().length>0)&&(I.value.kind!=="constant"||I.value.value.length>0),K=O.value.kind!=="constant"||!!O.value.value||Object.keys(O.parameters).length>0,X=S.get("symbol-sort-key");if(this.features=[],!G&&!K)return;const nt=h.iconDependencies,at=h.glyphDependencies,ut=h.availableImages,Bt=new Gn(this.zoom);for(const{feature:It,id:Nt,index:ee,sourceLayerIndex:Ht}of c){const Kt=b._featureFilter.needGeometry,ve=Mc(It,Kt);if(!b._featureFilter.filter(Bt,ve,p))continue;let be,Ze;if(Kt||(ve.geometry=Pc(It)),G){const Xe=b.getValueAndResolveTokens("text-field",ve,p,ut),$e=_n.factory(Xe),ke=this.hasRTLText=this.hasRTLText||Swt($e);(!ke||Xa.getRTLTextPluginStatus()==="unavailable"||ke&&Xa.isParsed())&&(be=cwt($e,b,ve))}if(K){const Xe=b.getValueAndResolveTokens("icon-image",ve,p,ut);Ze=Xe instanceof cs?Xe:cs.fromString(Xe)}if(!be&&!Ze)continue;const hr=this.sortFeaturesByKey?X.evaluate(ve,{},p):void 0;if(this.features.push({id:Nt,text:be,icon:Ze,index:ee,sourceLayerIndex:Ht,geometry:ve.geometry,properties:It.properties,type:Cwt[It.type],sortKey:hr}),Ze&&(nt[Ze.name]=!0),be){const Xe=I.evaluate(ve,{},p).join(","),$e=S.get("text-rotation-alignment")!=="viewport"&&S.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(a.ah.vertical)>=0;for(const ke of be.sections)if(ke.image)nt[ke.image.name]=!0;else{const or=Wi(be.toString()),je=ke.fontStack||Xe,Fe=at[je]=at[je]||{};this.calculateGlyphDependencies(ke.text,Fe,$e,this.allowVerticalPlacement,or)}}}S.get("symbol-placement")==="line"&&(this.features=function(It){const Nt={},ee={},Ht=[];let Kt=0;function ve(Xe){Ht.push(It[Xe]),Kt++}function be(Xe,$e,ke){const or=ee[Xe];return delete ee[Xe],ee[$e]=or,Ht[or].geometry[0].pop(),Ht[or].geometry[0]=Ht[or].geometry[0].concat(ke[0]),or}function Ze(Xe,$e,ke){const or=Nt[$e];return delete Nt[$e],Nt[Xe]=or,Ht[or].geometry[0].shift(),Ht[or].geometry[0]=ke[0].concat(Ht[or].geometry[0]),or}function hr(Xe,$e,ke){const or=ke?$e[0][$e[0].length-1]:$e[0][0];return`${Xe}:${or.x}:${or.y}`}for(let Xe=0;Xe<It.length;Xe++){const $e=It[Xe],ke=$e.geometry,or=$e.text?$e.text.toString():null;if(!or){ve(Xe);continue}const je=hr(or,ke),Fe=hr(or,ke,!0);if(je in ee&&Fe in Nt&&ee[je]!==Nt[Fe]){const Cr=Ze(je,Fe,ke),pr=be(je,Fe,Ht[Cr].geometry);delete Nt[je],delete ee[Fe],ee[hr(or,Ht[pr].geometry,!0)]=pr,Ht[Cr].geometry=null}else je in ee?be(je,Fe,ke):Fe in Nt?Ze(je,Fe,ke):(ve(Xe),Nt[je]=Kt-1,ee[Fe]=Kt-1)}return Ht.filter(Xe=>Xe.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((It,Nt)=>It.sortKey-Nt.sortKey)}update(c,h,p){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(c,h,this.layers,p),this.icon.programConfigurations.updatePaintArrays(c,h,this.layers,p))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(c){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(c),this.iconCollisionBox.upload(c)),this.text.upload(c,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(c,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(c,h){const p=this.lineVertexArray.length;if(c.segment!==void 0){let b=c.dist(h[c.segment+1]),S=c.dist(h[c.segment]);const I={};for(let F=c.segment+1;F<h.length;F++)I[F]={x:h[F].x,y:h[F].y,tileUnitDistanceFromAnchor:b},F<h.length-1&&(b+=h[F+1].dist(h[F]));for(let F=c.segment||0;F>=0;F--)I[F]={x:h[F].x,y:h[F].y,tileUnitDistanceFromAnchor:S},F>0&&(S+=h[F-1].dist(h[F]));for(let F=0;F<h.length;F++){const O=I[F];this.lineVertexArray.emplaceBack(O.x,O.y,O.tileUnitDistanceFromAnchor)}}return{lineStartIndex:p,lineLength:this.lineVertexArray.length-p}}addSymbols(c,h,p,b,S,I,F,O,G,K,X,nt){const at=c.indexArray,ut=c.layoutVertexArray,Bt=c.segments.prepareSegment(4*h.length,ut,at,this.canOverlap?I.sortKey:void 0),It=this.glyphOffsetArray.length,Nt=Bt.vertexLength,ee=this.allowVerticalPlacement&&F===a.ah.vertical?Math.PI/2:0,Ht=I.text&&I.text.sections;for(let Kt=0;Kt<h.length;Kt++){const{tl:ve,tr:be,bl:Ze,br:hr,tex:Xe,pixelOffsetTL:$e,pixelOffsetBR:ke,minFontScaleX:or,minFontScaleY:je,glyphOffset:Fe,isSDF:Cr,sectionIndex:pr}=h[Kt],en=Bt.vertexLength,ci=Fe[1];tv(ut,O.x,O.y,ve.x,ci+ve.y,Xe.x,Xe.y,p,Cr,$e.x,$e.y,or,je),tv(ut,O.x,O.y,be.x,ci+be.y,Xe.x+Xe.w,Xe.y,p,Cr,ke.x,$e.y,or,je),tv(ut,O.x,O.y,Ze.x,ci+Ze.y,Xe.x,Xe.y+Xe.h,p,Cr,$e.x,ke.y,or,je),tv(ut,O.x,O.y,hr.x,ci+hr.y,Xe.x+Xe.w,Xe.y+Xe.h,p,Cr,ke.x,ke.y,or,je),aS(c.dynamicLayoutVertexArray,O,ee),at.emplaceBack(en,en+1,en+2),at.emplaceBack(en+1,en+2,en+3),Bt.vertexLength+=4,Bt.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Fe[0]),Kt!==h.length-1&&pr===h[Kt+1].sectionIndex||c.programConfigurations.populatePaintArrays(ut.length,I,I.index,{},nt,Ht&&Ht[pr])}c.placedSymbolArray.emplaceBack(O.x,O.y,It,this.glyphOffsetArray.length-It,Nt,G,K,O.segment,p?p[0]:0,p?p[1]:0,b[0],b[1],F,0,!1,0,X)}_addCollisionDebugVertex(c,h,p,b,S,I){return h.emplaceBack(0,0),c.emplaceBack(p.x,p.y,b,S,Math.round(I.x),Math.round(I.y))}addCollisionDebugVertices(c,h,p,b,S,I,F){const O=S.segments.prepareSegment(4,S.layoutVertexArray,S.indexArray),G=O.vertexLength,K=S.layoutVertexArray,X=S.collisionVertexArray,nt=F.anchorX,at=F.anchorY;this._addCollisionDebugVertex(K,X,I,nt,at,new _(c,h)),this._addCollisionDebugVertex(K,X,I,nt,at,new _(p,h)),this._addCollisionDebugVertex(K,X,I,nt,at,new _(p,b)),this._addCollisionDebugVertex(K,X,I,nt,at,new _(c,b)),O.vertexLength+=4;const ut=S.indexArray;ut.emplaceBack(G,G+1),ut.emplaceBack(G+1,G+2),ut.emplaceBack(G+2,G+3),ut.emplaceBack(G+3,G),O.primitiveLength+=4}addDebugCollisionBoxes(c,h,p,b){for(let S=c;S<h;S++){const I=this.collisionBoxArray.get(S);this.addCollisionDebugVertices(I.x1,I.y1,I.x2,I.y2,b?this.textCollisionBox:this.iconCollisionBox,I.anchorPoint,p)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new lS(gt,VN.members,_t),this.iconCollisionBox=new lS(gt,VN.members,_t);for(let c=0;c<this.symbolInstances.length;c++){const h=this.symbolInstances.get(c);this.addDebugCollisionBoxes(h.textBoxStartIndex,h.textBoxEndIndex,h,!0),this.addDebugCollisionBoxes(h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h,!0),this.addDebugCollisionBoxes(h.iconBoxStartIndex,h.iconBoxEndIndex,h,!1),this.addDebugCollisionBoxes(h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex,h,!1)}}_deserializeCollisionBoxesForSymbol(c,h,p,b,S,I,F,O,G){const K={};for(let X=h;X<p;X++){const nt=c.get(X);K.textBox={x1:nt.x1,y1:nt.y1,x2:nt.x2,y2:nt.y2,anchorPointX:nt.anchorPointX,anchorPointY:nt.anchorPointY},K.textFeatureIndex=nt.featureIndex;break}for(let X=b;X<S;X++){const nt=c.get(X);K.verticalTextBox={x1:nt.x1,y1:nt.y1,x2:nt.x2,y2:nt.y2,anchorPointX:nt.anchorPointX,anchorPointY:nt.anchorPointY},K.verticalTextFeatureIndex=nt.featureIndex;break}for(let X=I;X<F;X++){const nt=c.get(X);K.iconBox={x1:nt.x1,y1:nt.y1,x2:nt.x2,y2:nt.y2,anchorPointX:nt.anchorPointX,anchorPointY:nt.anchorPointY},K.iconFeatureIndex=nt.featureIndex;break}for(let X=O;X<G;X++){const nt=c.get(X);K.verticalIconBox={x1:nt.x1,y1:nt.y1,x2:nt.x2,y2:nt.y2,anchorPointX:nt.anchorPointX,anchorPointY:nt.anchorPointY},K.verticalIconFeatureIndex=nt.featureIndex;break}return K}deserializeCollisionBoxes(c){this.collisionArrays=[];for(let h=0;h<this.symbolInstances.length;h++){const p=this.symbolInstances.get(h);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(c,p.textBoxStartIndex,p.textBoxEndIndex,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p.iconBoxStartIndex,p.iconBoxEndIndex,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(c,h){const p=c.placedSymbolArray.get(h),b=p.vertexStartIndex+4*p.numGlyphs;for(let S=p.vertexStartIndex;S<b;S+=4)c.indexArray.emplaceBack(S,S+1,S+2),c.indexArray.emplaceBack(S+1,S+2,S+3)}getSortedSymbolIndexes(c){if(this.sortedAngle===c&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const h=Math.sin(c),p=Math.cos(c),b=[],S=[],I=[];for(let F=0;F<this.symbolInstances.length;++F){I.push(F);const O=this.symbolInstances.get(F);b.push(0|Math.round(h*O.anchorX+p*O.anchorY)),S.push(O.featureIndex)}return I.sort((F,O)=>b[F]-b[O]||S[O]-S[F]),I}addToSortKeyRanges(c,h){const p=this.sortKeyRanges[this.sortKeyRanges.length-1];p&&p.sortKey===h?p.symbolInstanceEnd=c+1:this.sortKeyRanges.push({sortKey:h,symbolInstanceStart:c,symbolInstanceEnd:c+1})}sortFeatures(c){if(this.sortFeaturesByY&&this.sortedAngle!==c&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(c),this.sortedAngle=c,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const h of this.symbolInstanceIndexes){const p=this.symbolInstances.get(h);this.featureSortOrder.push(p.featureIndex),[p.rightJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.leftJustifiedTextSymbolIndex].forEach((b,S,I)=>{b>=0&&I.indexOf(b)===S&&this.addIndicesForPlacedSymbol(this.text,b)}),p.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,p.verticalPlacedTextSymbolIndex),p.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,p.placedIconSymbolIndex),p.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,p.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let ak,ck;tr("SymbolBucket",Ip,{omit:["layers","collisionBoxArray","features","compareText"]}),Ip.MAX_GLYPHS=65535,Ip.addDynamicAttributes=aS;var uS={get paint(){return ck=ck||new Xi({"icon-opacity":new wr(Jt.paint_symbol["icon-opacity"]),"icon-color":new wr(Jt.paint_symbol["icon-color"]),"icon-halo-color":new wr(Jt.paint_symbol["icon-halo-color"]),"icon-halo-width":new wr(Jt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new wr(Jt.paint_symbol["icon-halo-blur"]),"icon-translate":new dr(Jt.paint_symbol["icon-translate"]),"icon-translate-anchor":new dr(Jt.paint_symbol["icon-translate-anchor"]),"text-opacity":new wr(Jt.paint_symbol["text-opacity"]),"text-color":new wr(Jt.paint_symbol["text-color"],{runtimeType:Yr,getOverride:u=>u.textColor,hasOverride:u=>!!u.textColor}),"text-halo-color":new wr(Jt.paint_symbol["text-halo-color"]),"text-halo-width":new wr(Jt.paint_symbol["text-halo-width"]),"text-halo-blur":new wr(Jt.paint_symbol["text-halo-blur"]),"text-translate":new dr(Jt.paint_symbol["text-translate"]),"text-translate-anchor":new dr(Jt.paint_symbol["text-translate-anchor"])})},get layout(){return ak=ak||new Xi({"symbol-placement":new dr(Jt.layout_symbol["symbol-placement"]),"symbol-spacing":new dr(Jt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new dr(Jt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new wr(Jt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new dr(Jt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new dr(Jt.layout_symbol["icon-allow-overlap"]),"icon-overlap":new dr(Jt.layout_symbol["icon-overlap"]),"icon-ignore-placement":new dr(Jt.layout_symbol["icon-ignore-placement"]),"icon-optional":new dr(Jt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new dr(Jt.layout_symbol["icon-rotation-alignment"]),"icon-size":new wr(Jt.layout_symbol["icon-size"]),"icon-text-fit":new dr(Jt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new dr(Jt.layout_symbol["icon-text-fit-padding"]),"icon-image":new wr(Jt.layout_symbol["icon-image"]),"icon-rotate":new wr(Jt.layout_symbol["icon-rotate"]),"icon-padding":new wr(Jt.layout_symbol["icon-padding"]),"icon-keep-upright":new dr(Jt.layout_symbol["icon-keep-upright"]),"icon-offset":new wr(Jt.layout_symbol["icon-offset"]),"icon-anchor":new wr(Jt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new dr(Jt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new dr(Jt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new dr(Jt.layout_symbol["text-rotation-alignment"]),"text-field":new wr(Jt.layout_symbol["text-field"]),"text-font":new wr(Jt.layout_symbol["text-font"]),"text-size":new wr(Jt.layout_symbol["text-size"]),"text-max-width":new wr(Jt.layout_symbol["text-max-width"]),"text-line-height":new dr(Jt.layout_symbol["text-line-height"]),"text-letter-spacing":new wr(Jt.layout_symbol["text-letter-spacing"]),"text-justify":new wr(Jt.layout_symbol["text-justify"]),"text-radial-offset":new wr(Jt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new dr(Jt.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new wr(Jt.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new wr(Jt.layout_symbol["text-anchor"]),"text-max-angle":new dr(Jt.layout_symbol["text-max-angle"]),"text-writing-mode":new dr(Jt.layout_symbol["text-writing-mode"]),"text-rotate":new wr(Jt.layout_symbol["text-rotate"]),"text-padding":new dr(Jt.layout_symbol["text-padding"]),"text-keep-upright":new dr(Jt.layout_symbol["text-keep-upright"]),"text-transform":new wr(Jt.layout_symbol["text-transform"]),"text-offset":new wr(Jt.layout_symbol["text-offset"]),"text-allow-overlap":new dr(Jt.layout_symbol["text-allow-overlap"]),"text-overlap":new dr(Jt.layout_symbol["text-overlap"]),"text-ignore-placement":new dr(Jt.layout_symbol["text-ignore-placement"]),"text-optional":new dr(Jt.layout_symbol["text-optional"])})}};class lk{constructor(c){if(c.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=c.property.overrides?c.property.overrides.runtimeType:Pr,this.defaultValue=c}evaluate(c){if(c.formattedSection){const h=this.defaultValue.property.overrides;if(h&&h.hasOverride(c.formattedSection))return h.getOverride(c.formattedSection)}return c.feature&&c.featureState?this.defaultValue.evaluate(c.feature,c.featureState):this.defaultValue.property.specification.default}eachChild(c){this.defaultValue.isConstant()||c(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}tr("FormatSectionOverride",lk,{omit:["defaultValue"]});class ev extends ea{constructor(c){super(c,uS)}recalculate(c,h){if(super.recalculate(c,h),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const p=this.layout.get("text-writing-mode");if(p){const b=[];for(const S of p)b.indexOf(S)<0&&b.push(S);this.layout._values["text-writing-mode"]=b}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(c,h,p,b){const S=this.layout.get(c).evaluate(h,{},p,b),I=this._unevaluatedLayout._values[c];return I.isDataDriven()||Xr(I.value)||!S?S:function(F,O){return O.replace(/{([^{}]+)}/g,(G,K)=>F&&K in F?String(F[K]):"")}(h.properties,S)}createBucket(c){return new Ip(c)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const c of uS.paint.overridableProperties){if(!ev.hasPaintOverride(this.layout,c))continue;const h=this.paint.get(c),p=new lk(h),b=new Kr(p,h.property.specification);let S=null;S=h.value.kind==="constant"||h.value.kind==="source"?new Qs("source",b):new Hs("composite",b,h.value.zoomStops),this.paint._values[c]=new ta(h.property,S,h.parameters)}}_handleOverridablePaintPropertyUpdate(c,h,p){return!(!this.layout||h.isDataDriven()||p.isDataDriven())&&ev.hasPaintOverride(this.layout,c)}static hasPaintOverride(c,h){const p=c.get("text-field"),b=uS.paint.properties[h];let S=!1;const I=F=>{for(const O of F)if(b.overrides&&b.overrides.hasOverride(O))return void(S=!0)};if(p.value.kind==="constant"&&p.value.value instanceof _n)I(p.value.value.sections);else if(p.value.kind==="source"){const F=G=>{S||(G instanceof Ss&&Dr(G.value)===$r?I(G.value.sections):G instanceof xc?I(G.sections):G.eachChild(F))},O=p.value;O._styleExpression&&F(O._styleExpression.expression)}return S}}let uk;var Twt={get paint(){return uk=uk||new Xi({"background-color":new dr(Jt.paint_background["background-color"]),"background-pattern":new Sl(Jt.paint_background["background-pattern"]),"background-opacity":new dr(Jt.paint_background["background-opacity"])})}};class Iwt extends ea{constructor(c){super(c,Twt)}}let Ak;var Lwt={get paint(){return Ak=Ak||new Xi({"raster-opacity":new dr(Jt.paint_raster["raster-opacity"]),"raster-hue-rotate":new dr(Jt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new dr(Jt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new dr(Jt.paint_raster["raster-brightness-max"]),"raster-saturation":new dr(Jt.paint_raster["raster-saturation"]),"raster-contrast":new dr(Jt.paint_raster["raster-contrast"]),"raster-resampling":new dr(Jt.paint_raster["raster-resampling"]),"raster-fade-duration":new dr(Jt.paint_raster["raster-fade-duration"])})}};class Fwt extends ea{constructor(c){super(c,Lwt)}}class Pwt extends ea{constructor(c){super(c,{}),this.onAdd=h=>{this.implementation.onAdd&&this.implementation.onAdd(h,h.painter.context.gl)},this.onRemove=h=>{this.implementation.onRemove&&this.implementation.onRemove(h,h.painter.context.gl)},this.implementation=c}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Mwt{constructor(c){this._methodToThrottle=c,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const AS=63710088e-1;class Eh{constructor(c,h){if(isNaN(c)||isNaN(h))throw new Error(`Invalid LngLat object: (${c}, ${h})`);if(this.lng=+c,this.lat=+h,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Eh(pt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(c){const h=Math.PI/180,p=this.lat*h,b=c.lat*h,S=Math.sin(p)*Math.sin(b)+Math.cos(p)*Math.cos(b)*Math.cos((c.lng-this.lng)*h);return AS*Math.acos(Math.min(S,1))}static convert(c){if(c instanceof Eh)return c;if(Array.isArray(c)&&(c.length===2||c.length===3))return new Eh(Number(c[0]),Number(c[1]));if(!Array.isArray(c)&&typeof c=="object"&&c!==null)return new Eh(Number("lng"in c?c.lng:c.lon),Number(c.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const hk=2*Math.PI*AS;function dk(u){return hk*Math.cos(u*Math.PI/180)}function fk(u){return(180+u)/360}function pk(u){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+u*Math.PI/360)))/360}function gk(u,c){return u/dk(c)}function hS(u){return 360/Math.PI*Math.atan(Math.exp((180-360*u)*Math.PI/180))-90}class rv{constructor(c,h){let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;this.x=+c,this.y=+h,this.z=+p}static fromLngLat(c){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const p=Eh.convert(c);return new rv(fk(p.lng),pk(p.lat),gk(h,p.lat))}toLngLat(){return new Eh(360*this.x-180,hS(this.y))}toAltitude(){return this.z*dk(hS(this.y))}meterInMercatorCoordinateUnits(){return 1/hk*(c=hS(this.y),1/Math.cos(c*Math.PI/180));var c}}function mk(u,c,h){var p=2*Math.PI*6378137/256/Math.pow(2,h);return[u*p-2*Math.PI*6378137/2,c*p-2*Math.PI*6378137/2]}class dS{constructor(c,h,p){if(c<0||c>25||p<0||p>=Math.pow(2,c)||h<0||h>=Math.pow(2,c))throw new Error(`x=${h}, y=${p}, z=${c} outside of bounds. 0<=x<${Math.pow(2,c)}, 0<=y<${Math.pow(2,c)} 0<=z<=25 `);this.z=c,this.x=h,this.y=p,this.key=Xm(0,c,c,h,p)}equals(c){return this.z===c.z&&this.x===c.x&&this.y===c.y}url(c,h,p){const b=(I=this.y,F=this.z,O=mk(256*(S=this.x),256*(I=Math.pow(2,F)-I-1),F),G=mk(256*(S+1),256*(I+1),F),O[0]+","+O[1]+","+G[0]+","+G[1]);var S,I,F,O,G;const K=function(X,nt,at){let ut,Bt="";for(let It=X;It>0;It--)ut=1<<It-1,Bt+=(nt&ut?1:0)+(at&ut?2:0);return Bt}(this.z,this.x,this.y);return c[(this.x+this.y)%c.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(p==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,h>1?"@2x":"").replace(/{quadkey}/g,K).replace(/{bbox-epsg-3857}/g,b)}isChildOf(c){const h=this.z-c.z;return h>0&&c.x===this.x>>h&&c.y===this.y>>h}getTilePoint(c){const h=Math.pow(2,this.z);return new _((c.x*h-this.x)*Dn,(c.y*h-this.y)*Dn)}toString(){return`${this.z}/${this.x}/${this.y}`}}class yk{constructor(c,h){this.wrap=c,this.canonical=h,this.key=Xm(c,h.z,h.z,h.x,h.y)}}class Ya{constructor(c,h,p,b,S){if(c<p)throw new Error(`overscaledZ should be >= z; overscaledZ = ${c}; z = ${p}`);this.overscaledZ=c,this.wrap=h,this.canonical=new dS(p,+b,+S),this.key=Xm(h,c,p,b,S)}clone(){return new Ya(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(c){return this.overscaledZ===c.overscaledZ&&this.wrap===c.wrap&&this.canonical.equals(c.canonical)}scaledTo(c){if(c>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${c}; overscaledZ = ${this.overscaledZ}`);const h=this.canonical.z-c;return c>this.canonical.z?new Ya(c,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ya(c,this.wrap,c,this.canonical.x>>h,this.canonical.y>>h)}calculateScaledKey(c,h){if(c>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${c}; overscaledZ = ${this.overscaledZ}`);const p=this.canonical.z-c;return c>this.canonical.z?Xm(this.wrap*+h,c,this.canonical.z,this.canonical.x,this.canonical.y):Xm(this.wrap*+h,c,c,this.canonical.x>>p,this.canonical.y>>p)}isChildOf(c){if(c.wrap!==this.wrap)return!1;const h=this.canonical.z-c.canonical.z;return c.overscaledZ===0||c.overscaledZ<this.overscaledZ&&c.canonical.x===this.canonical.x>>h&&c.canonical.y===this.canonical.y>>h}children(c){if(this.overscaledZ>=c)return[new Ya(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const h=this.canonical.z+1,p=2*this.canonical.x,b=2*this.canonical.y;return[new Ya(h,this.wrap,h,p,b),new Ya(h,this.wrap,h,p+1,b),new Ya(h,this.wrap,h,p,b+1),new Ya(h,this.wrap,h,p+1,b+1)]}isLessThan(c){return this.wrap<c.wrap||!(this.wrap>c.wrap)&&(this.overscaledZ<c.overscaledZ||!(this.overscaledZ>c.overscaledZ)&&(this.canonical.x<c.canonical.x||!(this.canonical.x>c.canonical.x)&&this.canonical.y<c.canonical.y))}wrapped(){return new Ya(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(c){return new Ya(this.overscaledZ,c,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new yk(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(c){return this.canonical.getTilePoint(new rv(c.x-this.wrap,c.y))}}function Xm(u,c,h,p,b){(u*=2)<0&&(u=-1*u-1);const S=1<<h;return(S*S*u+S*b+p).toString(36)+h.toString(36)+c.toString(36)}tr("CanonicalTileID",dS),tr("OverscaledTileID",Ya,{omit:["posMatrix"]});class _k{constructor(c,h,p){let b=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1,S=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1,I=arguments.length>5&&arguments[5]!==void 0?arguments[5]:1,F=arguments.length>6&&arguments[6]!==void 0?arguments[6]:0;if(this.uid=c,h.height!==h.width)throw new RangeError("DEM tiles must be square");if(p&&!["mapbox","terrarium","custom"].includes(p))return void wt(`"${p}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=h.height;const O=this.dim=h.height-2;switch(this.data=new Uint32Array(h.data.buffer),p){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=b,this.greenFactor=S,this.blueFactor=I,this.baseShift=F;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let G=0;G<O;G++)this.data[this._idx(-1,G)]=this.data[this._idx(0,G)],this.data[this._idx(O,G)]=this.data[this._idx(O-1,G)],this.data[this._idx(G,-1)]=this.data[this._idx(G,0)],this.data[this._idx(G,O)]=this.data[this._idx(G,O-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(O,-1)]=this.data[this._idx(O-1,0)],this.data[this._idx(-1,O)]=this.data[this._idx(0,O-1)],this.data[this._idx(O,O)]=this.data[this._idx(O-1,O-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let G=0;G<O;G++)for(let K=0;K<O;K++){const X=this.get(G,K);X>this.max&&(this.max=X),X<this.min&&(this.min=X)}}get(c,h){const p=new Uint8Array(this.data.buffer),b=4*this._idx(c,h);return this.unpack(p[b],p[b+1],p[b+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(c,h){if(c<-1||c>=this.dim+1||h<-1||h>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(h+1)*this.stride+(c+1)}unpack(c,h,p){return c*this.redFactor+h*this.greenFactor+p*this.blueFactor-this.baseShift}getPixels(){return new ia({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(c,h,p){if(this.dim!==c.dim)throw new Error("dem dimension mismatch");let b=h*this.dim,S=h*this.dim+this.dim,I=p*this.dim,F=p*this.dim+this.dim;switch(h){case-1:b=S-1;break;case 1:S=b+1}switch(p){case-1:I=F-1;break;case 1:F=I+1}const O=-h*this.dim,G=-p*this.dim;for(let K=I;K<F;K++)for(let X=b;X<S;X++)this.data[this._idx(X,K)]=c.data[this._idx(X+O,K+G)]}}tr("DEMData",_k);class vk{constructor(c){this._stringToNumber={},this._numberToString=[];for(let h=0;h<c.length;h++){const p=c[h];this._stringToNumber[p]=h,this._numberToString[h]=p}}encode(c){return this._stringToNumber[c]}decode(c){if(c>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${c} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[c]}}class bk{constructor(c,h,p,b,S){this.type="Feature",this._vectorTileFeature=c,c._z=h,c._x=p,c._y=b,this.properties=c.properties,this.id=S}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(c){this._geometry=c}toJSON(){const c={geometry:this.geometry};for(const h in this)h!=="_geometry"&&h!=="_vectorTileFeature"&&(c[h]=this[h]);return c}}class wk{constructor(c,h){this.tileID=c,this.x=c.canonical.x,this.y=c.canonical.y,this.z=c.canonical.z,this.grid=new gu(Dn,16,0),this.grid3D=new gu(Dn,16,0),this.featureIndexArray=new T,this.promoteId=h}insert(c,h,p,b,S,I){const F=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(p,b,S);const O=I?this.grid3D:this.grid;for(let G=0;G<h.length;G++){const K=h[G],X=[1/0,1/0,-1/0,-1/0];for(let nt=0;nt<K.length;nt++){const at=K[nt];X[0]=Math.min(X[0],at.x),X[1]=Math.min(X[1],at.y),X[2]=Math.max(X[2],at.x),X[3]=Math.max(X[3],at.y)}X[0]<Dn&&X[1]<Dn&&X[2]>=0&&X[3]>=0&&O.insert(F,X[0],X[1],X[2],X[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new xh.VectorTile(new eS(this.rawTileData)).layers,this.sourceLayerCoder=new vk(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(c,h,p,b){this.loadVTLayers();const S=c.params||{},I=Dn/c.tileSize/c.scale,F=Sc(S.filter),O=c.queryGeometry,G=c.queryPadding*I,K=Bk(O),X=this.grid.query(K.minX-G,K.minY-G,K.maxX+G,K.maxY+G),nt=Bk(c.cameraQueryGeometry),at=this.grid3D.query(nt.minX-G,nt.minY-G,nt.maxX+G,nt.maxY+G,(It,Nt,ee,Ht)=>function(Kt,ve,be,Ze,hr){for(const $e of Kt)if(ve<=$e.x&&be<=$e.y&&Ze>=$e.x&&hr>=$e.y)return!0;const Xe=[new _(ve,be),new _(ve,hr),new _(Ze,hr),new _(Ze,be)];if(Kt.length>2){for(const $e of Xe)if(Fl(Kt,$e))return!0}for(let $e=0;$e<Kt.length-1;$e++)if(Fd(Kt[$e],Kt[$e+1],Xe))return!0;return!1}(c.cameraQueryGeometry,It-G,Nt-G,ee+G,Ht+G));for(const It of at)X.push(It);X.sort(Uwt);const ut={};let Bt;for(let It=0;It<X.length;It++){const Nt=X[It];if(Nt===Bt)continue;Bt=Nt;const ee=this.featureIndexArray.get(Nt);let Ht=null;this.loadMatchingFeature(ut,ee.bucketIndex,ee.sourceLayerIndex,ee.featureIndex,F,S.layers,S.availableImages,h,p,b,(Kt,ve,be)=>(Ht||(Ht=Pc(Kt)),ve.queryIntersectsFeature(O,Kt,be,Ht,this.z,c.transform,I,c.pixelPosMatrix)))}return ut}loadMatchingFeature(c,h,p,b,S,I,F,O,G,K,X){const nt=this.bucketLayerIDs[h];if(I&&!function(It,Nt){for(let ee=0;ee<It.length;ee++)if(Nt.indexOf(It[ee])>=0)return!0;return!1}(I,nt))return;const at=this.sourceLayerCoder.decode(p),ut=this.vtLayers[at].feature(b);if(S.needGeometry){const It=Mc(ut,!0);if(!S.filter(new Gn(this.tileID.overscaledZ),It,this.tileID.canonical))return}else if(!S.filter(new Gn(this.tileID.overscaledZ),ut))return;const Bt=this.getId(ut,at);for(let It=0;It<nt.length;It++){const Nt=nt[It];if(I&&I.indexOf(Nt)<0)continue;const ee=O[Nt];if(!ee)continue;let Ht={};Bt&&K&&(Ht=K.getState(ee.sourceLayer||"_geojsonTileLayer",Bt));const Kt=mt({},G[Nt]);Kt.paint=xk(Kt.paint,ee.paint,ut,Ht,F),Kt.layout=xk(Kt.layout,ee.layout,ut,Ht,F);const ve=!X||X(ut,ee,Ht);if(!ve)continue;const be=new bk(ut,this.z,this.x,this.y,Bt);be.layer=Kt;let Ze=c[Nt];Ze===void 0&&(Ze=c[Nt]=[]),Ze.push({featureIndex:b,feature:be,intersectionZ:ve})}}lookupSymbolFeatures(c,h,p,b,S,I,F,O){const G={};this.loadVTLayers();const K=Sc(S);for(const X of c)this.loadMatchingFeature(G,p,b,X,K,I,F,O,h);return G}hasLayer(c){for(const h of this.bucketLayerIDs)for(const p of h)if(c===p)return!0;return!1}getId(c,h){let p=c.id;return this.promoteId&&(p=c.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[h]],typeof p=="boolean"&&(p=Number(p))),p}}function xk(u,c,h,p,b){return Rt(u,(S,I)=>{const F=c instanceof uA?c.get(I):null;return F&&F.evaluate?F.evaluate(h,p,b):F})}function Bk(u){let c=1/0,h=1/0,p=-1/0,b=-1/0;for(const S of u)c=Math.min(c,S.x),h=Math.min(h,S.y),p=Math.max(p,S.x),b=Math.max(b,S.y);return{minX:c,minY:h,maxX:p,maxY:b}}function Uwt(u,c){return c-u}function Ck(u,c,h,p,b){const S=[];for(let I=0;I<u.length;I++){const F=u[I];let O;for(let G=0;G<F.length-1;G++){let K=F[G],X=F[G+1];K.x<c&&X.x<c||(K.x<c?K=new _(c,K.y+(c-K.x)/(X.x-K.x)*(X.y-K.y))._round():X.x<c&&(X=new _(c,K.y+(c-K.x)/(X.x-K.x)*(X.y-K.y))._round()),K.y<h&&X.y<h||(K.y<h?K=new _(K.x+(h-K.y)/(X.y-K.y)*(X.x-K.x),h)._round():X.y<h&&(X=new _(K.x+(h-K.y)/(X.y-K.y)*(X.x-K.x),h)._round()),K.x>=p&&X.x>=p||(K.x>=p?K=new _(p,K.y+(p-K.x)/(X.x-K.x)*(X.y-K.y))._round():X.x>=p&&(X=new _(p,K.y+(p-K.x)/(X.x-K.x)*(X.y-K.y))._round()),K.y>=b&&X.y>=b||(K.y>=b?K=new _(K.x+(b-K.y)/(X.y-K.y)*(X.x-K.x),b)._round():X.y>=b&&(X=new _(K.x+(b-K.y)/(X.y-K.y)*(X.x-K.x),b)._round()),O&&K.equals(O[O.length-1])||(O=[K],S.push(O)),O.push(X)))))}}return S}tr("FeatureIndex",wk,{omit:["rawTileData","sourceLayerCoder"]});class Sh extends _{constructor(c,h,p,b){super(c,h),this.angle=p,b!==void 0&&(this.segment=b)}clone(){return new Sh(this.x,this.y,this.angle,this.segment)}}function Ek(u,c,h,p,b){if(c.segment===void 0||h===0)return!0;let S=c,I=c.segment+1,F=0;for(;F>-h/2;){if(I--,I<0)return!1;F-=u[I].dist(S),S=u[I]}F+=u[I].dist(u[I+1]),I++;const O=[];let G=0;for(;F<h/2;){const K=u[I],X=u[I+1];if(!X)return!1;let nt=u[I-1].angleTo(K)-K.angleTo(X);for(nt=Math.abs((nt+3*Math.PI)%(2*Math.PI)-Math.PI),O.push({distance:F,angleDelta:nt}),G+=nt;F-O[0].distance>p;)G-=O.shift().angleDelta;if(G>b)return!1;I++,F+=K.dist(X)}return!0}function Sk(u){let c=0;for(let h=0;h<u.length-1;h++)c+=u[h].dist(u[h+1]);return c}function Tk(u,c,h){return u?.6*c*h:0}function Ik(u,c){return Math.max(u?u.right-u.left:0,c?c.right-c.left:0)}function Rwt(u,c,h,p,b,S){const I=Tk(h,b,S),F=Ik(h,p)*S;let O=0;const G=Sk(u)/2;for(let K=0;K<u.length-1;K++){const X=u[K],nt=u[K+1],at=X.dist(nt);if(O+at>G){const ut=(G-O)/at,Bt=Ri.number(X.x,nt.x,ut),It=Ri.number(X.y,nt.y,ut),Nt=new Sh(Bt,It,nt.angleTo(X),K);return Nt._round(),!I||Ek(u,Nt,F,I,c)?Nt:void 0}O+=at}}function Owt(u,c,h,p,b,S,I,F,O){const G=Tk(p,S,I),K=Ik(p,b),X=K*I,nt=u[0].x===0||u[0].x===O||u[0].y===0||u[0].y===O;return c-X<c/4&&(c=X+c/4),Lk(u,nt?c/2*F%c:(K/2+2*S)*I*F%c,c,G,h,X,nt,!1,O)}function Lk(u,c,h,p,b,S,I,F,O){const G=S/2,K=Sk(u);let X=0,nt=c-h,at=[];for(let ut=0;ut<u.length-1;ut++){const Bt=u[ut],It=u[ut+1],Nt=Bt.dist(It),ee=It.angleTo(Bt);for(;nt+h<X+Nt;){nt+=h;const Ht=(nt-X)/Nt,Kt=Ri.number(Bt.x,It.x,Ht),ve=Ri.number(Bt.y,It.y,Ht);if(Kt>=0&&Kt<O&&ve>=0&&ve<O&&nt-G>=0&&nt+G<=K){const be=new Sh(Kt,ve,ee,ut);be._round(),p&&!Ek(u,be,S,p,b)||at.push(be)}}X+=Nt}return F||at.length||I||(at=Lk(u,X/2,h,p,b,S,I,!0,O)),at}tr("Anchor",Sh);const Lp=sa;function Fk(u,c,h,p){const b=[],S=u.image,I=S.pixelRatio,F=S.paddedRect.w-2*Lp,O=S.paddedRect.h-2*Lp,G=u.right-u.left,K=u.bottom-u.top,X=S.stretchX||[[0,F]],nt=S.stretchY||[[0,O]],at=(ke,or)=>ke+or[1]-or[0],ut=X.reduce(at,0),Bt=nt.reduce(at,0),It=F-ut,Nt=O-Bt;let ee=0,Ht=ut,Kt=0,ve=Bt,be=0,Ze=It,hr=0,Xe=Nt;if(S.content&&p){const ke=S.content;ee=nv(X,0,ke[0]),Kt=nv(nt,0,ke[1]),Ht=nv(X,ke[0],ke[2]),ve=nv(nt,ke[1],ke[3]),be=ke[0]-ee,hr=ke[1]-Kt,Ze=ke[2]-ke[0]-Ht,Xe=ke[3]-ke[1]-ve}const $e=(ke,or,je,Fe)=>{const Cr=iv(ke.stretch-ee,Ht,G,u.left),pr=sv(ke.fixed-be,Ze,ke.stretch,ut),en=iv(or.stretch-Kt,ve,K,u.top),ci=sv(or.fixed-hr,Xe,or.stretch,Bt),pi=iv(je.stretch-ee,Ht,G,u.left),hs=sv(je.fixed-be,Ze,je.stretch,ut),Ta=iv(Fe.stretch-Kt,ve,K,u.top),Lo=sv(Fe.fixed-hr,Xe,Fe.stretch,Bt),Yi=new _(Cr,en),Is=new _(pi,en),qs=new _(pi,Ta),Fo=new _(Cr,Ta),Po=new _(pr/I,ci/I),ds=new _(hs/I,Lo/I),fs=c*Math.PI/180;if(fs){const oo=Math.sin(fs),oa=Math.cos(fs),aa=[oa,-oo,oo,oa];Yi._matMult(aa),Is._matMult(aa),Fo._matMult(aa),qs._matMult(aa)}const so=ke.stretch+ke.fixed,Mo=or.stretch+or.fixed;return{tl:Yi,tr:Is,bl:Fo,br:qs,tex:{x:S.paddedRect.x+Lp+so,y:S.paddedRect.y+Lp+Mo,w:je.stretch+je.fixed-so,h:Fe.stretch+Fe.fixed-Mo},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Po,pixelOffsetBR:ds,minFontScaleX:Ze/I/G,minFontScaleY:Xe/I/K,isSDF:h}};if(p&&(S.stretchX||S.stretchY)){const ke=Pk(X,It,ut),or=Pk(nt,Nt,Bt);for(let je=0;je<ke.length-1;je++){const Fe=ke[je],Cr=ke[je+1];for(let pr=0;pr<or.length-1;pr++)b.push($e(Fe,or[pr],Cr,or[pr+1]))}}else b.push($e({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:F+1},{fixed:0,stretch:O+1}));return b}function nv(u,c,h){let p=0;for(const b of u)p+=Math.max(c,Math.min(h,b[1]))-Math.max(c,Math.min(h,b[0]));return p}function Pk(u,c,h){const p=[{fixed:-Lp,stretch:0}];for(const[b,S]of u){const I=p[p.length-1];p.push({fixed:b-I.stretch,stretch:I.stretch}),p.push({fixed:b-I.stretch,stretch:I.stretch+(S-b)})}return p.push({fixed:c+Lp,stretch:h}),p}function iv(u,c,h,p){return u/c*h+p}function sv(u,c,h,p){return u-c*h/p}class ov{constructor(c,h,p,b,S,I,F,O,G,K){if(this.boxStartIndex=c.length,G){let X=I.top,nt=I.bottom;const at=I.collisionPadding;at&&(X-=at[1],nt+=at[3]);let ut=nt-X;ut>0&&(ut=Math.max(10,ut),this.circleDiameter=ut)}else{let X=I.top*F-O[0],nt=I.bottom*F+O[2],at=I.left*F-O[3],ut=I.right*F+O[1];const Bt=I.collisionPadding;if(Bt&&(at-=Bt[0]*F,X-=Bt[1]*F,ut+=Bt[2]*F,nt+=Bt[3]*F),K){const It=new _(at,X),Nt=new _(ut,X),ee=new _(at,nt),Ht=new _(ut,nt),Kt=K*Math.PI/180;It._rotate(Kt),Nt._rotate(Kt),ee._rotate(Kt),Ht._rotate(Kt),at=Math.min(It.x,Nt.x,ee.x,Ht.x),ut=Math.max(It.x,Nt.x,ee.x,Ht.x),X=Math.min(It.y,Nt.y,ee.y,Ht.y),nt=Math.max(It.y,Nt.y,ee.y,Ht.y)}c.emplaceBack(h.x,h.y,at,X,ut,nt,p,b,S)}this.boxEndIndex=c.length}}class Dwt{constructor(){let c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Nwt;if(this.data=c,this.length=this.data.length,this.compare=h,this.length>0)for(let p=(this.length>>1)-1;p>=0;p--)this._down(p)}push(c){this.data.push(c),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const c=this.data[0],h=this.data.pop();return this.length--,this.length>0&&(this.data[0]=h,this._down(0)),c}peek(){return this.data[0]}_up(c){const{data:h,compare:p}=this,b=h[c];for(;c>0;){const S=c-1>>1,I=h[S];if(p(b,I)>=0)break;h[c]=I,c=S}h[c]=b}_down(c){const{data:h,compare:p}=this,b=this.length>>1,S=h[c];for(;c<b;){let I=1+(c<<1),F=h[I];const O=I+1;if(O<this.length&&p(h[O],F)<0&&(I=O,F=h[O]),p(F,S)>=0)break;h[c]=F,c=I}h[c]=S}}function Nwt(u,c){return u<c?-1:u>c?1:0}function kwt(u){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,h=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,p=1/0,b=1/0,S=-1/0,I=-1/0;const F=u[0];for(let at=0;at<F.length;at++){const ut=F[at];(!at||ut.x<p)&&(p=ut.x),(!at||ut.y<b)&&(b=ut.y),(!at||ut.x>S)&&(S=ut.x),(!at||ut.y>I)&&(I=ut.y)}const O=Math.min(S-p,I-b);let G=O/2;const K=new Dwt([],Qwt);if(O===0)return new _(p,b);for(let at=p;at<S;at+=O)for(let ut=b;ut<I;ut+=O)K.push(new Fp(at+G,ut+G,G,u));let X=function(at){let ut=0,Bt=0,It=0;const Nt=at[0];for(let ee=0,Ht=Nt.length,Kt=Ht-1;ee<Ht;Kt=ee++){const ve=Nt[ee],be=Nt[Kt],Ze=ve.x*be.y-be.x*ve.y;Bt+=(ve.x+be.x)*Ze,It+=(ve.y+be.y)*Ze,ut+=3*Ze}return new Fp(Bt/ut,It/ut,0,at)}(u),nt=K.length;for(;K.length;){const at=K.pop();(at.d>X.d||!X.d)&&(X=at,h&&console.log("found best %d after %d probes",Math.round(1e4*at.d)/1e4,nt)),at.max-X.d<=c||(G=at.h/2,K.push(new Fp(at.p.x-G,at.p.y-G,G,u)),K.push(new Fp(at.p.x+G,at.p.y-G,G,u)),K.push(new Fp(at.p.x-G,at.p.y+G,G,u)),K.push(new Fp(at.p.x+G,at.p.y+G,G,u)),nt+=4)}return h&&(console.log(`num probes: ${nt}`),console.log(`best distance: ${X.d}`)),X.p}function Qwt(u,c){return c.max-u.max}function Fp(u,c,h,p){this.p=new _(u,c),this.h=h,this.d=function(b,S){let I=!1,F=1/0;for(let O=0;O<S.length;O++){const G=S[O];for(let K=0,X=G.length,nt=X-1;K<X;nt=K++){const at=G[K],ut=G[nt];at.y>b.y!=ut.y>b.y&&b.x<(ut.x-at.x)*(b.y-at.y)/(ut.y-at.y)+at.x&&(I=!I),F=Math.min(F,Ld(b,at,ut))}}return(I?1:-1)*Math.sqrt(F)}(this.p,p),this.max=this.d+this.h*Math.SQRT2}var js;a.ap=void 0,(js=a.ap||(a.ap={}))[js.center=1]="center",js[js.left=2]="left",js[js.right=3]="right",js[js.top=4]="top",js[js.bottom=5]="bottom",js[js["top-left"]=6]="top-left",js[js["top-right"]=7]="top-right",js[js["bottom-left"]=8]="bottom-left",js[js["bottom-right"]=9]="bottom-right";const Th=7,fS=Number.POSITIVE_INFINITY;function Mk(u,c){return c[1]!==fS?function(h,p,b){let S=0,I=0;switch(p=Math.abs(p),b=Math.abs(b),h){case"top-right":case"top-left":case"top":I=b-Th;break;case"bottom-right":case"bottom-left":case"bottom":I=-b+Th}switch(h){case"top-right":case"bottom-right":case"right":S=-p;break;case"top-left":case"bottom-left":case"left":S=p}return[S,I]}(u,c[0],c[1]):function(h,p){let b=0,S=0;p<0&&(p=0);const I=p/Math.SQRT2;switch(h){case"top-right":case"top-left":S=I-Th;break;case"bottom-right":case"bottom-left":S=-I+Th;break;case"bottom":S=-p+Th;break;case"top":S=p-Th}switch(h){case"top-right":case"bottom-right":b=-I;break;case"top-left":case"bottom-left":b=I;break;case"left":b=p;break;case"right":b=-p}return[b,S]}(u,c[0])}function Uk(u,c,h){var p;const b=u.layout,S=(p=b.get("text-variable-anchor-offset"))===null||p===void 0?void 0:p.evaluate(c,{},h);if(S){const F=S.values,O=[];for(let G=0;G<F.length;G+=2){const K=O[G]=F[G],X=F[G+1].map(nt=>nt*As);K.startsWith("top")?X[1]-=Th:K.startsWith("bottom")&&(X[1]+=Th),O[G+1]=X}return new Yn(O)}const I=b.get("text-variable-anchor");if(I){let F;F=u._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[b.get("text-radial-offset").evaluate(c,{},h)*As,fS]:b.get("text-offset").evaluate(c,{},h).map(G=>G*As);const O=[];for(const G of I)O.push(G,Mk(G,F));return new Yn(O)}return null}function pS(u){switch(u){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Hwt(u,c,h,p,b,S,I,F,O,G,K){let X=S.textMaxSize.evaluate(c,{});X===void 0&&(X=I);const nt=u.layers[0].layout,at=nt.get("icon-offset").evaluate(c,{},K),ut=Ok(h.horizontal),Bt=I/24,It=u.tilePixelRatio*Bt,Nt=u.tilePixelRatio*X/24,ee=u.tilePixelRatio*F,Ht=u.tilePixelRatio*nt.get("symbol-spacing"),Kt=nt.get("text-padding")*u.tilePixelRatio,ve=function(Fe,Cr,pr){let en=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;const ci=Fe.get("icon-padding").evaluate(Cr,{},pr),pi=ci&&ci.values;return[pi[0]*en,pi[1]*en,pi[2]*en,pi[3]*en]}(nt,c,K,u.tilePixelRatio),be=nt.get("text-max-angle")/180*Math.PI,Ze=nt.get("text-rotation-alignment")!=="viewport"&&nt.get("symbol-placement")!=="point",hr=nt.get("icon-rotation-alignment")==="map"&&nt.get("symbol-placement")!=="point",Xe=nt.get("symbol-placement"),$e=Ht/2,ke=nt.get("icon-text-fit");let or;p&&ke!=="none"&&(u.allowVerticalPlacement&&h.vertical&&(or=sk(p,h.vertical,ke,nt.get("icon-text-fit-padding"),at,Bt)),ut&&(p=sk(p,ut,ke,nt.get("icon-text-fit-padding"),at,Bt)));const je=(Fe,Cr)=>{Cr.x<0||Cr.x>=Dn||Cr.y<0||Cr.y>=Dn||function(pr,en,ci,pi,hs,Ta,Lo,Yi,Is,qs,Fo,Po,ds,fs,so,Mo,oo,oa,aa,ps,An,ao,Ks,gs,Oc){const Ul=pr.addToLineVertexArray(en,ci);let Rl,bA,Dc,Za,ca=0,wA=0,Zm=0,Qk=0,xS=-1,BS=-1;const xA={};let Hk=Sr("");if(pr.allowVerticalPlacement&&pi.vertical){const co=Yi.layout.get("text-rotate").evaluate(An,{},gs)+90;Dc=new ov(Is,en,qs,Fo,Po,pi.vertical,ds,fs,so,co),Lo&&(Za=new ov(Is,en,qs,Fo,Po,Lo,oo,oa,so,co))}if(hs){const co=Yi.layout.get("icon-rotate").evaluate(An,{}),tc=Yi.layout.get("icon-text-fit")!=="none",Dd=Fk(hs,co,Ks,tc),Dl=Lo?Fk(Lo,co,Ks,tc):void 0;bA=new ov(Is,en,qs,Fo,Po,hs,oo,oa,!1,co),ca=4*Dd.length;const Nd=pr.iconSizeData;let xu=null;Nd.kind==="source"?(xu=[wu*Yi.layout.get("icon-size").evaluate(An,{})],xu[0]>Ch&&wt(`${pr.layerIds[0]}: Value for "icon-size" is >= ${Wm}. Reduce your "icon-size".`)):Nd.kind==="composite"&&(xu=[wu*ao.compositeIconSizes[0].evaluate(An,{},gs),wu*ao.compositeIconSizes[1].evaluate(An,{},gs)],(xu[0]>Ch||xu[1]>Ch)&&wt(`${pr.layerIds[0]}: Value for "icon-size" is >= ${Wm}. Reduce your "icon-size".`)),pr.addSymbols(pr.icon,Dd,xu,ps,aa,An,a.ah.none,en,Ul.lineStartIndex,Ul.lineLength,-1,gs),xS=pr.icon.placedSymbolArray.length-1,Dl&&(wA=4*Dl.length,pr.addSymbols(pr.icon,Dl,xu,ps,aa,An,a.ah.vertical,en,Ul.lineStartIndex,Ul.lineLength,-1,gs),BS=pr.icon.placedSymbolArray.length-1)}const zk=Object.keys(pi.horizontal);for(const co of zk){const tc=pi.horizontal[co];if(!Rl){Hk=Sr(tc.text);const Dl=Yi.layout.get("text-rotate").evaluate(An,{},gs);Rl=new ov(Is,en,qs,Fo,Po,tc,ds,fs,so,Dl)}const Dd=tc.positionedLines.length===1;if(Zm+=Rk(pr,en,tc,Ta,Yi,so,An,Mo,Ul,pi.vertical?a.ah.horizontal:a.ah.horizontalOnly,Dd?zk:[co],xA,xS,ao,gs),Dd)break}pi.vertical&&(Qk+=Rk(pr,en,pi.vertical,Ta,Yi,so,An,Mo,Ul,a.ah.vertical,["vertical"],xA,BS,ao,gs));const Vwt=Rl?Rl.boxStartIndex:pr.collisionBoxArray.length,jwt=Rl?Rl.boxEndIndex:pr.collisionBoxArray.length,qwt=Dc?Dc.boxStartIndex:pr.collisionBoxArray.length,Kwt=Dc?Dc.boxEndIndex:pr.collisionBoxArray.length,$wt=bA?bA.boxStartIndex:pr.collisionBoxArray.length,Wwt=bA?bA.boxEndIndex:pr.collisionBoxArray.length,Xwt=Za?Za.boxStartIndex:pr.collisionBoxArray.length,Jwt=Za?Za.boxEndIndex:pr.collisionBoxArray.length;let Ol=-1;const cv=(co,tc)=>co&&co.circleDiameter?Math.max(co.circleDiameter,tc):tc;Ol=cv(Rl,Ol),Ol=cv(Dc,Ol),Ol=cv(bA,Ol),Ol=cv(Za,Ol);const Gk=Ol>-1?1:0;Gk&&(Ol*=Oc/As),pr.glyphOffsetArray.length>=Ip.MAX_GLYPHS&&wt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),An.sortKey!==void 0&&pr.addToSortKeyRanges(pr.symbolInstances.length,An.sortKey);const Ywt=Uk(Yi,An,gs),[Zwt,t2t]=function(co,tc){const Dd=co.length,Dl=tc==null?void 0:tc.values;if((Dl==null?void 0:Dl.length)>0)for(let Nd=0;Nd<Dl.length;Nd+=2){const xu=Dl[Nd+1];co.emplaceBack(a.ap[Dl[Nd]],xu[0],xu[1])}return[Dd,co.length]}(pr.textAnchorOffsets,Ywt);pr.symbolInstances.emplaceBack(en.x,en.y,xA.right>=0?xA.right:-1,xA.center>=0?xA.center:-1,xA.left>=0?xA.left:-1,xA.vertical||-1,xS,BS,Hk,Vwt,jwt,qwt,Kwt,$wt,Wwt,Xwt,Jwt,qs,Zm,Qk,ca,wA,Gk,0,ds,Ol,Zwt,t2t)}(u,Cr,Fe,h,p,b,or,u.layers[0],u.collisionBoxArray,c.index,c.sourceLayerIndex,u.index,It,[Kt,Kt,Kt,Kt],Ze,O,ee,ve,hr,at,c,S,G,K,I)};if(Xe==="line")for(const Fe of Ck(c.geometry,0,0,Dn,Dn)){const Cr=Owt(Fe,Ht,be,h.vertical||ut,p,24,Nt,u.overscaling,Dn);for(const pr of Cr)ut&&zwt(u,ut.text,$e,pr)||je(Fe,pr)}else if(Xe==="line-center"){for(const Fe of c.geometry)if(Fe.length>1){const Cr=Rwt(Fe,be,h.vertical||ut,p,24,Nt);Cr&&je(Fe,Cr)}}else if(c.type==="Polygon")for(const Fe of KE(c.geometry,0)){const Cr=kwt(Fe,16);je(Fe[0],new Sh(Cr.x,Cr.y,0))}else if(c.type==="LineString")for(const Fe of c.geometry)je(Fe,new Sh(Fe[0].x,Fe[0].y,0));else if(c.type==="Point")for(const Fe of c.geometry)for(const Cr of Fe)je([Cr],new Sh(Cr.x,Cr.y,0))}function Rk(u,c,h,p,b,S,I,F,O,G,K,X,nt,at,ut){const Bt=function(ee,Ht,Kt,ve,be,Ze,hr,Xe){const $e=ve.layout.get("text-rotate").evaluate(Ze,{})*Math.PI/180,ke=[];for(const or of Ht.positionedLines)for(const je of or.positionedGlyphs){if(!je.rect)continue;const Fe=je.rect||{};let Cr=YN+1,pr=!0,en=1,ci=0;const pi=(be||Xe)&&je.vertical,hs=je.metrics.advance*je.scale/2;if(Xe&&Ht.verticalizable&&(ci=or.lineOffset/2-(je.imageName?-(As-je.metrics.width*je.scale)/2:(je.scale-1)*As)),je.imageName){const ps=hr[je.imageName];pr=ps.sdf,en=ps.pixelRatio,Cr=sa/en}const Ta=be?[je.x+hs,je.y]:[0,0];let Lo=be?[0,0]:[je.x+hs+Kt[0],je.y+Kt[1]-ci],Yi=[0,0];pi&&(Yi=Lo,Lo=[0,0]);const Is=je.metrics.isDoubleResolution?2:1,qs=(je.metrics.left-Cr)*je.scale-hs+Lo[0],Fo=(-je.metrics.top-Cr)*je.scale+Lo[1],Po=qs+Fe.w/Is*je.scale/en,ds=Fo+Fe.h/Is*je.scale/en,fs=new _(qs,Fo),so=new _(Po,Fo),Mo=new _(qs,ds),oo=new _(Po,ds);if(pi){const ps=new _(-hs,hs-Km),An=-Math.PI/2,ao=As/2-hs,Ks=new _(5-Km-ao,-(je.imageName?ao:0)),gs=new _(...Yi);fs._rotateAround(An,ps)._add(Ks)._add(gs),so._rotateAround(An,ps)._add(Ks)._add(gs),Mo._rotateAround(An,ps)._add(Ks)._add(gs),oo._rotateAround(An,ps)._add(Ks)._add(gs)}if($e){const ps=Math.sin($e),An=Math.cos($e),ao=[An,-ps,ps,An];fs._matMult(ao),so._matMult(ao),Mo._matMult(ao),oo._matMult(ao)}const oa=new _(0,0),aa=new _(0,0);ke.push({tl:fs,tr:so,bl:Mo,br:oo,tex:Fe,writingMode:Ht.writingMode,glyphOffset:Ta,sectionIndex:je.sectionIndex,isSDF:pr,pixelOffsetTL:oa,pixelOffsetBR:aa,minFontScaleX:0,minFontScaleY:0})}return ke}(0,h,F,b,S,I,p,u.allowVerticalPlacement),It=u.textSizeData;let Nt=null;It.kind==="source"?(Nt=[wu*b.layout.get("text-size").evaluate(I,{})],Nt[0]>Ch&&wt(`${u.layerIds[0]}: Value for "text-size" is >= ${Wm}. Reduce your "text-size".`)):It.kind==="composite"&&(Nt=[wu*at.compositeTextSizes[0].evaluate(I,{},ut),wu*at.compositeTextSizes[1].evaluate(I,{},ut)],(Nt[0]>Ch||Nt[1]>Ch)&&wt(`${u.layerIds[0]}: Value for "text-size" is >= ${Wm}. Reduce your "text-size".`)),u.addSymbols(u.text,Bt,Nt,F,S,I,G,c,O.lineStartIndex,O.lineLength,nt,ut);for(const ee of K)X[ee]=u.text.placedSymbolArray.length-1;return 4*Bt.length}function Ok(u){for(const c in u)return u[c];return null}function zwt(u,c,h,p){const b=u.compareText;if(c in b){const S=b[c];for(let I=S.length-1;I>=0;I--)if(p.dist(S[I])<h)return!0}else b[c]=[];return b[c].push(p),!1}const Dk=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class gS{static from(c){if(!(c instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[h,p]=new Uint8Array(c,0,2);if(h!==219)throw new Error("Data does not appear to be in a KDBush format.");const b=p>>4;if(b!==1)throw new Error(`Got v${b} data when expected v1.`);const S=Dk[15&p];if(!S)throw new Error("Unrecognized array type.");const[I]=new Uint16Array(c,2,1),[F]=new Uint32Array(c,4,1);return new gS(F,I,S,c)}constructor(c){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:64,p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Float64Array,b=arguments.length>3?arguments[3]:void 0;if(isNaN(c)||c<0)throw new Error(`Unpexpected numItems value: ${c}.`);this.numItems=+c,this.nodeSize=Math.min(Math.max(+h,2),65535),this.ArrayType=p,this.IndexArrayType=c<65536?Uint16Array:Uint32Array;const S=Dk.indexOf(this.ArrayType),I=2*c*this.ArrayType.BYTES_PER_ELEMENT,F=c*this.IndexArrayType.BYTES_PER_ELEMENT,O=(8-F%8)%8;if(S<0)throw new Error(`Unexpected typed array class: ${p}.`);b&&b instanceof ArrayBuffer?(this.data=b,this.ids=new this.IndexArrayType(this.data,8,c),this.coords=new this.ArrayType(this.data,8+F+O,2*c),this._pos=2*c,this._finished=!0):(this.data=new ArrayBuffer(8+I+F+O),this.ids=new this.IndexArrayType(this.data,8,c),this.coords=new this.ArrayType(this.data,8+F+O,2*c),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+S]),new Uint16Array(this.data,2,1)[0]=h,new Uint32Array(this.data,4,1)[0]=c)}add(c,h){const p=this._pos>>1;return this.ids[p]=p,this.coords[this._pos++]=c,this.coords[this._pos++]=h,p}finish(){const c=this._pos>>1;if(c!==this.numItems)throw new Error(`Added ${c} items when expected ${this.numItems}.`);return mS(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(c,h,p,b){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:S,coords:I,nodeSize:F}=this,O=[0,S.length-1,0],G=[];for(;O.length;){const K=O.pop()||0,X=O.pop()||0,nt=O.pop()||0;if(X-nt<=F){for(let It=nt;It<=X;It++){const Nt=I[2*It],ee=I[2*It+1];Nt>=c&&Nt<=p&&ee>=h&&ee<=b&&G.push(S[It])}continue}const at=nt+X>>1,ut=I[2*at],Bt=I[2*at+1];ut>=c&&ut<=p&&Bt>=h&&Bt<=b&&G.push(S[at]),(K===0?c<=ut:h<=Bt)&&(O.push(nt),O.push(at-1),O.push(1-K)),(K===0?p>=ut:b>=Bt)&&(O.push(at+1),O.push(X),O.push(1-K))}return G}within(c,h,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:b,coords:S,nodeSize:I}=this,F=[0,b.length-1,0],O=[],G=p*p;for(;F.length;){const K=F.pop()||0,X=F.pop()||0,nt=F.pop()||0;if(X-nt<=I){for(let It=nt;It<=X;It++)kk(S[2*It],S[2*It+1],c,h)<=G&&O.push(b[It]);continue}const at=nt+X>>1,ut=S[2*at],Bt=S[2*at+1];kk(ut,Bt,c,h)<=G&&O.push(b[at]),(K===0?c-p<=ut:h-p<=Bt)&&(F.push(nt),F.push(at-1),F.push(1-K)),(K===0?c+p>=ut:h+p>=Bt)&&(F.push(at+1),F.push(X),F.push(1-K))}return O}}function mS(u,c,h,p,b,S){if(b-p<=h)return;const I=p+b>>1;Nk(u,c,I,p,b,S),mS(u,c,h,p,I-1,1-S),mS(u,c,h,I+1,b,1-S)}function Nk(u,c,h,p,b,S){for(;b>p;){if(b-p>600){const G=b-p+1,K=h-p+1,X=Math.log(G),nt=.5*Math.exp(2*X/3),at=.5*Math.sqrt(X*nt*(G-nt)/G)*(K-G/2<0?-1:1);Nk(u,c,h,Math.max(p,Math.floor(h-K*nt/G+at)),Math.min(b,Math.floor(h+(G-K)*nt/G+at)),S)}const I=c[2*h+S];let F=p,O=b;for(Jm(u,c,p,h),c[2*b+S]>I&&Jm(u,c,p,b);F<O;){for(Jm(u,c,F,O),F++,O--;c[2*F+S]<I;)F++;for(;c[2*O+S]>I;)O--}c[2*p+S]===I?Jm(u,c,p,O):(O++,Jm(u,c,O,b)),O<=h&&(p=O+1),h<=O&&(b=O-1)}}function Jm(u,c,h,p){yS(u,h,p),yS(c,2*h,2*p),yS(c,2*h+1,2*p+1)}function yS(u,c,h){const p=u[c];u[c]=u[h],u[h]=p}function kk(u,c,h,p){const b=u-h,S=c-p;return b*b+S*S}var _S;a.bd=void 0,(_S=a.bd||(a.bd={})).create="create",_S.load="load",_S.fullLoad="fullLoad";let av=null,Ym=[];const vS=1e3/60,bS="loadTime",wS="fullLoadTime",Gwt={mark(u){performance.mark(u)},frame(u){const c=u;av!=null&&Ym.push(c-av),av=c},clearMetrics(){av=null,Ym=[],performance.clearMeasures(bS),performance.clearMeasures(wS);for(const u in a.bd)performance.clearMarks(a.bd[u])},getPerformanceMetrics(){performance.measure(bS,a.bd.create,a.bd.load),performance.measure(wS,a.bd.create,a.bd.fullLoad);const u=performance.getEntriesByName(bS)[0].duration,c=performance.getEntriesByName(wS)[0].duration,h=Ym.length,p=1/(Ym.reduce((S,I)=>S+I,0)/h/1e3),b=Ym.filter(S=>S>vS).reduce((S,I)=>S+(I-vS)/vS,0);return{loadTime:u,fullLoadTime:c,fps:p,percentDroppedFrames:b/(h+b)*100,totalFrames:h}}};a.$=Wt,a.A=yA,a.B=function(u){if(re==null){const c=u.navigator?u.navigator.userAgent:null;re=!!u.safari||!(!c||!(/\b(iPad|iPhone|iPod)\b/.test(c)||c.match("Safari")&&!c.match("Chrome")))}return re},a.C=class{constructor(u,c){this.target=u,this.mapId=c,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Mwt(()=>this.process()),this.subscription=function(h,p,b,S){return h.addEventListener(p,b,!1),{unsubscribe:()=>{h.removeEventListener(p,b,!1)}}}(this.target,"message",h=>this.receive(h)),this.globalScope=Zt(self)?u:window}registerMessageHandler(u,c){this.messageHandlers[u]=c}sendAsync(u,c){return new Promise((h,p)=>{const b=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[b]={resolve:h,reject:p},c&&c.signal.addEventListener("abort",()=>{delete this.resolveRejects[b];const F={id:b,type:"<cancel>",origin:location.origin,targetMapId:u.targetMapId,sourceMapId:this.mapId};this.target.postMessage(F)},{once:!0});const S=[],I=Object.assign(Object.assign({},u),{id:b,sourceMapId:this.mapId,origin:location.origin,data:bl(u.data,S)});this.target.postMessage(I,{transfer:S})})}receive(u){const c=u.data,h=c.id;if(!(c.origin!=="file://"&&location.origin!=="file://"&&c.origin!==location.origin||c.targetMapId&&this.mapId!==c.targetMapId)){if(c.type==="<cancel>"){delete this.tasks[h];const p=this.abortControllers[h];return delete this.abortControllers[h],void(p&&p.abort())}if(Zt(self)||c.mustQueue)return this.tasks[h]=c,this.taskQueue.push(h),void this.invoker.trigger();this.processTask(h,c)}}process(){if(this.taskQueue.length===0)return;const u=this.taskQueue.shift(),c=this.tasks[u];delete this.tasks[u],this.taskQueue.length>0&&this.invoker.trigger(),c&&this.processTask(u,c)}processTask(u,c){return o(this,void 0,void 0,function*(){if(c.type==="<response>"){const b=this.resolveRejects[u];return delete this.resolveRejects[u],b?void(c.error?b.reject(wl(c.error)):b.resolve(wl(c.data))):void 0}if(!this.messageHandlers[c.type])return void this.completeTask(u,new Error(`Could not find a registered handler for ${c.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const h=wl(c.data),p=new AbortController;this.abortControllers[u]=p;try{const b=yield this.messageHandlers[c.type](c.sourceMapId,h,p);this.completeTask(u,null,b)}catch(b){this.completeTask(u,b)}})}completeTask(u,c,h){const p=[];delete this.abortControllers[u];const b={id:u,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:c?bl(c):null,data:bl(h,p)};this.target.postMessage(b,{transfer:p})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},a.D=dr,a.E=Ut,a.F=function(){var u=new yA(16);return yA!=Float32Array&&(u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[11]=0,u[12]=0,u[13]=0,u[14]=0),u[0]=1,u[5]=1,u[10]=1,u[15]=1,u},a.G=jt,a.H=function(u,c,h){var p,b,S,I,F,O,G,K,X,nt,at,ut,Bt=h[0],It=h[1],Nt=h[2];return c===u?(u[12]=c[0]*Bt+c[4]*It+c[8]*Nt+c[12],u[13]=c[1]*Bt+c[5]*It+c[9]*Nt+c[13],u[14]=c[2]*Bt+c[6]*It+c[10]*Nt+c[14],u[15]=c[3]*Bt+c[7]*It+c[11]*Nt+c[15]):(b=c[1],S=c[2],I=c[3],F=c[4],O=c[5],G=c[6],K=c[7],X=c[8],nt=c[9],at=c[10],ut=c[11],u[0]=p=c[0],u[1]=b,u[2]=S,u[3]=I,u[4]=F,u[5]=O,u[6]=G,u[7]=K,u[8]=X,u[9]=nt,u[10]=at,u[11]=ut,u[12]=p*Bt+F*It+X*Nt+c[12],u[13]=b*Bt+O*It+nt*Nt+c[13],u[14]=S*Bt+G*It+at*Nt+c[14],u[15]=I*Bt+K*It+ut*Nt+c[15]),u},a.I=nS,a.J=function(u,c,h){var p=h[0],b=h[1],S=h[2];return u[0]=c[0]*p,u[1]=c[1]*p,u[2]=c[2]*p,u[3]=c[3]*p,u[4]=c[4]*b,u[5]=c[5]*b,u[6]=c[6]*b,u[7]=c[7]*b,u[8]=c[8]*S,u[9]=c[9]*S,u[10]=c[10]*S,u[11]=c[11]*S,u[12]=c[12],u[13]=c[13],u[14]=c[14],u[15]=c[15],u},a.K=Rm,a.L=function(u,c){const h={};for(let p=0;p<c.length;p++){const b=c[p];b in u&&(h[b]=u[b])}return h},a.M=Eh,a.N=fk,a.O=pk,a.P=_,a.Q=Ya,a.R=ia,a.S=Q,a.T=lA,a.U=q,a.V=se,a.W=Dn,a.X=Si,a.Y=rv,a.Z=class extends ra{},a._=o,a.a=Ot,a.a$=function(u,c,h){return u[0]=c[0]*h[0],u[1]=c[1]*h[1],u[2]=c[2]*h[2],u[3]=c[3]*h[3],u},a.a0=dS,a.a1=fe,a.a2=u=>{const c=window.document.createElement("video");return c.muted=!0,new Promise(h=>{c.onloadstart=()=>{h(c)};for(const p of u){const b=window.document.createElement("source");Ie(p)||(c.crossOrigin="Anonymous"),b.src=p,c.appendChild(b)}})},a.a3=function(){return dt++},a.a4=C,a.a5=Ip,a.a6=Sc,a.a7=Mc,a.a8=Gn,a.a9=bk,a.aA=st,a.aB=function(u,c){if(!u)return[{command:"setStyle",args:[c]}];let h=[];try{if(!_e(u.version,c.version))return[{command:"setStyle",args:[c]}];_e(u.center,c.center)||h.push({command:"setCenter",args:[c.center]}),_e(u.zoom,c.zoom)||h.push({command:"setZoom",args:[c.zoom]}),_e(u.bearing,c.bearing)||h.push({command:"setBearing",args:[c.bearing]}),_e(u.pitch,c.pitch)||h.push({command:"setPitch",args:[c.pitch]}),_e(u.sprite,c.sprite)||h.push({command:"setSprite",args:[c.sprite]}),_e(u.glyphs,c.glyphs)||h.push({command:"setGlyphs",args:[c.glyphs]}),_e(u.transition,c.transition)||h.push({command:"setTransition",args:[c.transition]}),_e(u.light,c.light)||h.push({command:"setLight",args:[c.light]}),_e(u.terrain,c.terrain)||h.push({command:"setTerrain",args:[c.terrain]}),_e(u.sky,c.sky)||h.push({command:"setSky",args:[c.sky]});const p={},b=[];(function(I,F,O,G){let K;for(K in F=F||{},I=I||{})Object.prototype.hasOwnProperty.call(I,K)&&(Object.prototype.hasOwnProperty.call(F,K)||ir(K,O,G));for(K in F)Object.prototype.hasOwnProperty.call(F,K)&&(Object.prototype.hasOwnProperty.call(I,K)?_e(I[K],F[K])||(I[K].type==="geojson"&&F[K].type==="geojson"&&Lr(I,F,K)?xe(O,{command:"setGeoJSONSourceData",args:[K,F[K].data]}):Ar(K,F,O,G)):Ne(K,F,O))})(u.sources,c.sources,b,p);const S=[];u.layers&&u.layers.forEach(I=>{"source"in I&&p[I.source]?h.push({command:"removeLayer",args:[I.id]}):S.push(I)}),h=h.concat(b),function(I,F,O){F=F||[];const G=(I=I||[]).map(Nr),K=F.map(Nr),X=I.reduce(Qr,{}),nt=F.reduce(Qr,{}),at=G.slice(),ut=Object.create(null);let Bt,It,Nt,ee,Ht;for(let Kt=0,ve=0;Kt<G.length;Kt++)Bt=G[Kt],Object.prototype.hasOwnProperty.call(nt,Bt)?ve++:(xe(O,{command:"removeLayer",args:[Bt]}),at.splice(at.indexOf(Bt,ve),1));for(let Kt=0,ve=0;Kt<K.length;Kt++)Bt=K[K.length-1-Kt],at[at.length-1-Kt]!==Bt&&(Object.prototype.hasOwnProperty.call(X,Bt)?(xe(O,{command:"removeLayer",args:[Bt]}),at.splice(at.lastIndexOf(Bt,at.length-ve),1)):ve++,ee=at[at.length-Kt],xe(O,{command:"addLayer",args:[nt[Bt],ee]}),at.splice(at.length-Kt,0,Bt),ut[Bt]=!0);for(let Kt=0;Kt<K.length;Kt++)if(Bt=K[Kt],It=X[Bt],Nt=nt[Bt],!ut[Bt]&&!_e(It,Nt))if(_e(It.source,Nt.source)&&_e(It["source-layer"],Nt["source-layer"])&&_e(It.type,Nt.type)){for(Ht in Tr(It.layout,Nt.layout,O,Bt,null,"setLayoutProperty"),Tr(It.paint,Nt.paint,O,Bt,null,"setPaintProperty"),_e(It.filter,Nt.filter)||xe(O,{command:"setFilter",args:[Bt,Nt.filter]}),_e(It.minzoom,Nt.minzoom)&&_e(It.maxzoom,Nt.maxzoom)||xe(O,{command:"setLayerZoomRange",args:[Bt,Nt.minzoom,Nt.maxzoom]}),It)Object.prototype.hasOwnProperty.call(It,Ht)&&Ht!=="layout"&&Ht!=="paint"&&Ht!=="filter"&&Ht!=="metadata"&&Ht!=="minzoom"&&Ht!=="maxzoom"&&(Ht.indexOf("paint.")===0?Tr(It[Ht],Nt[Ht],O,Bt,Ht.slice(6),"setPaintProperty"):_e(It[Ht],Nt[Ht])||xe(O,{command:"setLayerProperty",args:[Bt,Ht,Nt[Ht]]}));for(Ht in Nt)Object.prototype.hasOwnProperty.call(Nt,Ht)&&!Object.prototype.hasOwnProperty.call(It,Ht)&&Ht!=="layout"&&Ht!=="paint"&&Ht!=="filter"&&Ht!=="metadata"&&Ht!=="minzoom"&&Ht!=="maxzoom"&&(Ht.indexOf("paint.")===0?Tr(It[Ht],Nt[Ht],O,Bt,Ht.slice(6),"setPaintProperty"):_e(It[Ht],Nt[Ht])||xe(O,{command:"setLayerProperty",args:[Bt,Ht,Nt[Ht]]}))}else xe(O,{command:"removeLayer",args:[Bt]}),ee=at[at.lastIndexOf(Bt)+1],xe(O,{command:"addLayer",args:[Nt,ee]})}(S,c.layers,h)}catch(p){console.warn("Unable to compute style diff:",p),h=[{command:"setStyle",args:[c]}]}return h},a.aC=function(u){const c=[],h=u.id;return h===void 0&&c.push({message:`layers.${h}: missing required property "id"`}),u.render===void 0&&c.push({message:`layers.${h}: missing required method "render"`}),u.renderingMode&&u.renderingMode!=="2d"&&u.renderingMode!=="3d"&&c.push({message:`layers.${h}: property "renderingMode" must be either "2d" or "3d"`}),c},a.aD=function u(c,h){if(Array.isArray(c)){if(!Array.isArray(h)||c.length!==h.length)return!1;for(let p=0;p<c.length;p++)if(!u(c[p],h[p]))return!1;return!0}if(typeof c=="object"&&c!==null&&h!==null){if(typeof h!="object"||Object.keys(c).length!==Object.keys(h).length)return!1;for(const p in c)if(!u(c[p],h[p]))return!1;return!0}return c===h},a.aE=Rt,a.aF=Lt,a.aG=class extends Cn{constructor(u,c){super(u,c),this.current=0}set(u){this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))}},a.aH=En,a.aI=class extends Cn{constructor(u,c){super(u,c),this.current=us}set(u){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(let c=1;c<16;c++)if(u[c]!==this.current[c]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}}},a.aJ=fi,a.aK=class extends Cn{constructor(u,c){super(u,c),this.current=[0,0,0]}set(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2]))}},a.aL=class extends Cn{constructor(u,c){super(u,c),this.current=[0,0]}set(u){u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1]))}},a.aM=dn,a.aN=function(u,c,h,p,b,S,I){var F=1/(c-h),O=1/(p-b),G=1/(S-I);return u[0]=-2*F,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=-2*O,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=2*G,u[11]=0,u[12]=(c+h)*F,u[13]=(b+p)*O,u[14]=(I+S)*G,u[15]=1,u},a.aO=Br,a.aP=bp,a.aQ=class extends fA{},a.aR=awt,a.aS=class extends Tl{},a.aT=function(u){return u<=1?1:Math.pow(2,Math.ceil(Math.log(u)/Math.LN2))},a.aU=Dm,a.aV=L,a.aW=class extends Id{},a.aX=Tt,a.aY=function(u,c){return u[0]===c[0]&&u[1]===c[1]&&u[2]===c[2]&&u[3]===c[3]&&u[4]===c[4]&&u[5]===c[5]&&u[6]===c[6]&&u[7]===c[7]&&u[8]===c[8]&&u[9]===c[9]&&u[10]===c[10]&&u[11]===c[11]&&u[12]===c[12]&&u[13]===c[13]&&u[14]===c[14]&&u[15]===c[15]},a.aZ=function(u,c){var h=u[0],p=u[1],b=u[2],S=u[3],I=u[4],F=u[5],O=u[6],G=u[7],K=u[8],X=u[9],nt=u[10],at=u[11],ut=u[12],Bt=u[13],It=u[14],Nt=u[15],ee=c[0],Ht=c[1],Kt=c[2],ve=c[3],be=c[4],Ze=c[5],hr=c[6],Xe=c[7],$e=c[8],ke=c[9],or=c[10],je=c[11],Fe=c[12],Cr=c[13],pr=c[14],en=c[15];return Math.abs(h-ee)<=Vs*Math.max(1,Math.abs(h),Math.abs(ee))&&Math.abs(p-Ht)<=Vs*Math.max(1,Math.abs(p),Math.abs(Ht))&&Math.abs(b-Kt)<=Vs*Math.max(1,Math.abs(b),Math.abs(Kt))&&Math.abs(S-ve)<=Vs*Math.max(1,Math.abs(S),Math.abs(ve))&&Math.abs(I-be)<=Vs*Math.max(1,Math.abs(I),Math.abs(be))&&Math.abs(F-Ze)<=Vs*Math.max(1,Math.abs(F),Math.abs(Ze))&&Math.abs(O-hr)<=Vs*Math.max(1,Math.abs(O),Math.abs(hr))&&Math.abs(G-Xe)<=Vs*Math.max(1,Math.abs(G),Math.abs(Xe))&&Math.abs(K-$e)<=Vs*Math.max(1,Math.abs(K),Math.abs($e))&&Math.abs(X-ke)<=Vs*Math.max(1,Math.abs(X),Math.abs(ke))&&Math.abs(nt-or)<=Vs*Math.max(1,Math.abs(nt),Math.abs(or))&&Math.abs(at-je)<=Vs*Math.max(1,Math.abs(at),Math.abs(je))&&Math.abs(ut-Fe)<=Vs*Math.max(1,Math.abs(ut),Math.abs(Fe))&&Math.abs(Bt-Cr)<=Vs*Math.max(1,Math.abs(Bt),Math.abs(Cr))&&Math.abs(It-pr)<=Vs*Math.max(1,Math.abs(It),Math.abs(pr))&&Math.abs(Nt-en)<=Vs*Math.max(1,Math.abs(Nt),Math.abs(en))},a.a_=function(u,c){return u[0]=c[0],u[1]=c[1],u[2]=c[2],u[3]=c[3],u[4]=c[4],u[5]=c[5],u[6]=c[6],u[7]=c[7],u[8]=c[8],u[9]=c[9],u[10]=c[10],u[11]=c[11],u[12]=c[12],u[13]=c[13],u[14]=c[14],u[15]=c[15],u},a.aa=function(u){const c={};if(u.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(h,p,b,S)=>{const I=b||S;return c[p]=!I||I.toLowerCase(),""}),c["max-age"]){const h=parseInt(c["max-age"],10);isNaN(h)?delete c["max-age"]:c["max-age"]=h}return c},a.ab=function(u,c){const h=[];for(const p in u)p in c||h.push(p);return h},a.ac=ft,a.ad=function(u,c,h){var p=Math.sin(h),b=Math.cos(h),S=c[0],I=c[1],F=c[2],O=c[3],G=c[4],K=c[5],X=c[6],nt=c[7];return c!==u&&(u[8]=c[8],u[9]=c[9],u[10]=c[10],u[11]=c[11],u[12]=c[12],u[13]=c[13],u[14]=c[14],u[15]=c[15]),u[0]=S*b+G*p,u[1]=I*b+K*p,u[2]=F*b+X*p,u[3]=O*b+nt*p,u[4]=G*b-S*p,u[5]=K*b-I*p,u[6]=X*b-F*p,u[7]=nt*b-O*p,u},a.ae=function(u){var c=new yA(16);return c[0]=u[0],c[1]=u[1],c[2]=u[2],c[3]=u[3],c[4]=u[4],c[5]=u[5],c[6]=u[6],c[7]=u[7],c[8]=u[8],c[9]=u[9],c[10]=u[10],c[11]=u[11],c[12]=u[12],c[13]=u[13],c[14]=u[14],c[15]=u[15],c},a.af=_h,a.ag=function(u,c){let h=0,p=0;if(u.kind==="constant")p=u.layoutSize;else if(u.kind!=="source"){const{interpolationType:b,minZoom:S,maxZoom:I}=u,F=b?ft(Ci.interpolationFactor(b,c,S,I),0,1):0;u.kind==="camera"?p=Ri.number(u.minSize,u.maxSize,F):h=F}return{uSizeT:h,uSize:p}},a.ai=function(u,c,h){let{uSize:p,uSizeT:b}=c,{lowerSize:S,upperSize:I}=h;return u.kind==="source"?S/wu:u.kind==="composite"?Ri.number(S/wu,I/wu,b):p},a.aj=aS,a.ak=function(u,c,h,p){const b=c.y-u.y,S=c.x-u.x,I=p.y-h.y,F=p.x-h.x,O=I*S-F*b;if(O===0)return null;const G=(F*(u.y-h.y)-I*(u.x-h.x))/O;return new _(u.x+G*S,u.y+G*b)},a.al=Ck,a.am=_u,a.an=mh,a.ao=As,a.aq=oS,a.ar=function(u,c){var h=c[0],p=c[1],b=c[2],S=c[3],I=c[4],F=c[5],O=c[6],G=c[7],K=c[8],X=c[9],nt=c[10],at=c[11],ut=c[12],Bt=c[13],It=c[14],Nt=c[15],ee=h*F-p*I,Ht=h*O-b*I,Kt=h*G-S*I,ve=p*O-b*F,be=p*G-S*F,Ze=b*G-S*O,hr=K*Bt-X*ut,Xe=K*It-nt*ut,$e=K*Nt-at*ut,ke=X*It-nt*Bt,or=X*Nt-at*Bt,je=nt*Nt-at*It,Fe=ee*je-Ht*or+Kt*ke+ve*$e-be*Xe+Ze*hr;return Fe?(u[0]=(F*je-O*or+G*ke)*(Fe=1/Fe),u[1]=(b*or-p*je-S*ke)*Fe,u[2]=(Bt*Ze-It*be+Nt*ve)*Fe,u[3]=(nt*be-X*Ze-at*ve)*Fe,u[4]=(O*$e-I*je-G*Xe)*Fe,u[5]=(h*je-b*$e+S*Xe)*Fe,u[6]=(It*Kt-ut*Ze-Nt*Ht)*Fe,u[7]=(K*Ze-nt*Kt+at*Ht)*Fe,u[8]=(I*or-F*$e+G*hr)*Fe,u[9]=(p*$e-h*or-S*hr)*Fe,u[10]=(ut*be-Bt*Kt+Nt*ee)*Fe,u[11]=(X*Kt-K*be-at*ee)*Fe,u[12]=(F*Xe-I*ke-O*hr)*Fe,u[13]=(h*ke-p*Xe+b*hr)*Fe,u[14]=(Bt*Ht-ut*ve-It*ee)*Fe,u[15]=(K*ve-X*Ht+nt*ee)*Fe,u):null},a.as=pS,a.at=sS,a.au=gS,a.av=function(){const u={},c=Jt.$version;for(const h in Jt.$root){const p=Jt.$root[h];if(p.required){let b=null;b=h==="version"?c:p.type==="array"?[]:{},b!=null&&(u[h]=b)}}return u},a.aw=lh,a.ax=ie,a.ay=function(u){u=u.slice();const c=Object.create(null);for(let h=0;h<u.length;h++)c[u[h].id]=u[h];for(let h=0;h<u.length;h++)"ref"in u[h]&&(u[h]=Se(u[h],c[u[h].ref]));return u},a.az=function(u){if(u.type==="custom")return new Pwt(u);switch(u.type){case"background":return new Iwt(u);case"circle":return new Md(u);case"fill":return new Ubt(u);case"fill-extrusion":return new Wbt(u);case"heatmap":return new bh(u);case"hillshade":return new HE(u);case"line":return new nwt(u);case"raster":return new Fwt(u);case"symbol":return new ev(u)}},a.b=Xt,a.b0=function(u,c){return u[0]*c[0]+u[1]*c[1]+u[2]*c[2]+u[3]*c[3]},a.b1=pt,a.b2=yk,a.b3=gk,a.b4=function(u,c,h,p,b){var S,I=1/Math.tan(c/2);return u[0]=I/h,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=I,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[11]=-1,u[12]=0,u[13]=0,u[15]=0,b!=null&&b!==1/0?(u[10]=(b+p)*(S=1/(p-b)),u[14]=2*b*p*S):(u[10]=-1,u[14]=-2*p),u},a.b5=function(u,c,h){var p=Math.sin(h),b=Math.cos(h),S=c[4],I=c[5],F=c[6],O=c[7],G=c[8],K=c[9],X=c[10],nt=c[11];return c!==u&&(u[0]=c[0],u[1]=c[1],u[2]=c[2],u[3]=c[3],u[12]=c[12],u[13]=c[13],u[14]=c[14],u[15]=c[15]),u[4]=S*b+G*p,u[5]=I*b+K*p,u[6]=F*b+X*p,u[7]=O*b+nt*p,u[8]=G*b-S*p,u[9]=K*b-I*p,u[10]=X*b-F*p,u[11]=nt*b-O*p,u},a.b6=J,a.b7=tt,a.b8=function(u){return u*Math.PI/180},a.b9=function(u,c){return u[0]=c[0],u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=c[1],u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=c[2],u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u},a.bA=Xa,a.ba=class extends ki{},a.bb=AS,a.bc=Gwt,a.be=ae,a.bf=function(u,c){Ot.REGISTERED_PROTOCOLS[u]=c},a.bg=function(u){delete Ot.REGISTERED_PROTOCOLS[u]},a.bh=function(u,c){const h={};for(let b=0;b<u.length;b++){const S=c&&c[u[b].id]||bd(u[b]);c&&(c[u[b].id]=S);let I=h[S];I||(I=h[S]=[]),I.push(u[b])}const p=[];for(const b in h)p.push(h[b]);return p},a.bi=tr,a.bj=vk,a.bk=wk,a.bl=tk,a.bm=function(u){u.bucket.createArrays(),u.bucket.tilePixelRatio=Dn/(512*u.bucket.overscaling),u.bucket.compareText={},u.bucket.iconsNeedLinear=!1;const c=u.bucket.layers[0],h=c.layout,p=c._unevaluatedLayout._values,b={layoutIconSize:p["icon-size"].possiblyEvaluate(new Gn(u.bucket.zoom+1),u.canonical),layoutTextSize:p["text-size"].possiblyEvaluate(new Gn(u.bucket.zoom+1),u.canonical),textMaxSize:p["text-size"].possiblyEvaluate(new Gn(18))};if(u.bucket.textSizeData.kind==="composite"){const{minZoom:G,maxZoom:K}=u.bucket.textSizeData;b.compositeTextSizes=[p["text-size"].possiblyEvaluate(new Gn(G),u.canonical),p["text-size"].possiblyEvaluate(new Gn(K),u.canonical)]}if(u.bucket.iconSizeData.kind==="composite"){const{minZoom:G,maxZoom:K}=u.bucket.iconSizeData;b.compositeIconSizes=[p["icon-size"].possiblyEvaluate(new Gn(G),u.canonical),p["icon-size"].possiblyEvaluate(new Gn(K),u.canonical)]}const S=h.get("text-line-height")*As,I=h.get("text-rotation-alignment")!=="viewport"&&h.get("symbol-placement")!=="point",F=h.get("text-keep-upright"),O=h.get("text-size");for(const G of u.bucket.features){const K=h.get("text-font").evaluate(G,{},u.canonical).join(","),X=O.evaluate(G,{},u.canonical),nt=b.layoutTextSize.evaluate(G,{},u.canonical),at=b.layoutIconSize.evaluate(G,{},u.canonical),ut={horizontal:{},vertical:void 0},Bt=G.text;let It,Nt=[0,0];if(Bt){const Kt=Bt.toString(),ve=h.get("text-letter-spacing").evaluate(G,{},u.canonical)*As,be=no(Kt)?ve:0,Ze=h.get("text-anchor").evaluate(G,{},u.canonical),hr=Uk(c,G,u.canonical);if(!hr){const je=h.get("text-radial-offset").evaluate(G,{},u.canonical);Nt=je?Mk(Ze,[je*As,fS]):h.get("text-offset").evaluate(G,{},u.canonical).map(Fe=>Fe*As)}let Xe=I?"center":h.get("text-justify").evaluate(G,{},u.canonical);const $e=h.get("symbol-placement"),ke=$e==="point"?h.get("text-max-width").evaluate(G,{},u.canonical)*As:0,or=()=>{u.bucket.allowVerticalPlacement&&Wi(Kt)&&(ut.vertical=Y_(Bt,u.glyphMap,u.glyphPositions,u.imagePositions,K,ke,S,Ze,"left",be,Nt,a.ah.vertical,!0,$e,nt,X))};if(!I&&hr){const je=new Set;if(Xe==="auto")for(let Cr=0;Cr<hr.values.length;Cr+=2)je.add(pS(hr.values[Cr]));else je.add(Xe);let Fe=!1;for(const Cr of je)if(!ut.horizontal[Cr])if(Fe)ut.horizontal[Cr]=ut.horizontal[0];else{const pr=Y_(Bt,u.glyphMap,u.glyphPositions,u.imagePositions,K,ke,S,"center",Cr,be,Nt,a.ah.horizontal,!1,$e,nt,X);pr&&(ut.horizontal[Cr]=pr,Fe=pr.positionedLines.length===1)}or()}else{Xe==="auto"&&(Xe=pS(Ze));const je=Y_(Bt,u.glyphMap,u.glyphPositions,u.imagePositions,K,ke,S,Ze,Xe,be,Nt,a.ah.horizontal,!1,$e,nt,X);je&&(ut.horizontal[Xe]=je),or(),Wi(Kt)&&I&&F&&(ut.vertical=Y_(Bt,u.glyphMap,u.glyphPositions,u.imagePositions,K,ke,S,Ze,Xe,be,Nt,a.ah.vertical,!1,$e,nt,X))}}let ee=!1;if(G.icon&&G.icon.name){const Kt=u.imageMap[G.icon.name];Kt&&(It=Bwt(u.imagePositions[G.icon.name],h.get("icon-offset").evaluate(G,{},u.canonical),h.get("icon-anchor").evaluate(G,{},u.canonical)),ee=!!Kt.sdf,u.bucket.sdfIcons===void 0?u.bucket.sdfIcons=ee:u.bucket.sdfIcons!==ee&&wt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Kt.pixelRatio!==u.bucket.pixelRatio||h.get("icon-rotate").constantOr(1)!==0)&&(u.bucket.iconsNeedLinear=!0))}const Ht=Ok(ut.horizontal)||ut.vertical;u.bucket.iconsInText=!!Ht&&Ht.iconsInText,(Ht||It)&&Hwt(u.bucket,G,ut,It,u.imageMap,b,nt,at,Nt,ee,u.canonical)}u.showCollisionBoxes&&u.bucket.generateCollisionDebugBuffers()},a.bn=ZE,a.bo=XE,a.bp=YE,a.bq=xh,a.br=eS,a.bs=class{constructor(u){this._marks={start:[u.url,"start"].join("#"),end:[u.url,"end"].join("#"),measure:u.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let u=performance.getEntriesByName(this._marks.measure);return u.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),u=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),u}},a.bt=function(u,c,h,p,b){return o(this,void 0,void 0,function*(){if(q())try{return yield se(u,c,h,p,b)}catch{}return function(S,I,F,O,G){const K=S.width,X=S.height;we&&it||(we=new OffscreenCanvas(K,X),it=we.getContext("2d",{willReadFrequently:!0})),we.width=K,we.height=X,it.drawImage(S,0,0,K,X);const nt=it.getImageData(I,F,O,G);return it.clearRect(0,0,K,X),nt.data}(u,c,h,p,b)})},a.bu=_k,a.bv=A,a.bw=f,a.bx=jN,a.by=oi,a.bz=function(u){return u.message===vt},a.c=Ft,a.d=u=>o(void 0,void 0,void 0,function*(){if(u.byteLength===0)return createImageBitmap(new ImageData(1,1));const c=new Blob([new Uint8Array(u)],{type:"image/png"});try{return createImageBitmap(c)}catch(h){throw new Error(`Could not load image because of ${h.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),a.e=mt,a.f=u=>new Promise((c,h)=>{const p=new Image;p.onload=()=>{c(p),URL.revokeObjectURL(p.src),p.onload=null,window.requestAnimationFrame(()=>{p.src=ne})},p.onerror=()=>h(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const b=new Blob([new Uint8Array(u)],{type:"image/png"});p.src=u.byteLength?URL.createObjectURL(b):ne}),a.g=$t,a.h=(u,c)=>Be(mt(u,{type:"json"}),c),a.i=Zt,a.j=ge,a.k=ze,a.l=(u,c)=>Be(mt(u,{type:"arrayBuffer"}),c),a.m=Be,a.n=function(u){return new eS(u).readFields(ywt,[])},a.o=vh,a.p=ZN,a.q=Xi,a.r=$a,a.s=Ie,a.t=Wa,a.u=qe,a.v=Jt,a.w=wt,a.x=ei,a.y=function(u){let[c,h,p]=u;return h+=90,h*=Math.PI/180,p*=Math.PI/180,{x:c*Math.cos(h)*Math.sin(p),y:c*Math.sin(h)*Math.sin(p),z:c*Math.cos(p)}},a.z=Ri}),i("worker",["./shared"],function(a){class o{constructor(Z){this.keyCache={},Z&&this.replace(Z)}replace(Z){this._layerConfigs={},this._layers={},this.update(Z,[])}update(Z,Y){for(const Et of Z){this._layerConfigs[Et.id]=Et;const kt=this._layers[Et.id]=a.az(Et);kt._featureFilter=a.a6(kt.filter),this.keyCache[Et.id]&&delete this.keyCache[Et.id]}for(const Et of Y)delete this.keyCache[Et],delete this._layerConfigs[Et],delete this._layers[Et];this.familiesBySource={};const ot=a.bh(Object.values(this._layerConfigs),this.keyCache);for(const Et of ot){const kt=Et.map(pe=>this._layers[pe.id]),zt=kt[0];if(zt.visibility==="none")continue;const qt=zt.source||"";let St=this.familiesBySource[qt];St||(St=this.familiesBySource[qt]={});const Yt=zt.sourceLayer||"_geojsonTileLayer";let me=St[Yt];me||(me=St[Yt]=[]),me.push(kt)}}}class A{constructor(Z){const Y={},ot=[];for(const qt in Z){const St=Z[qt],Yt=Y[qt]={};for(const me in St){const pe=St[+me];if(!pe||pe.bitmap.width===0||pe.bitmap.height===0)continue;const de={x:0,y:0,w:pe.bitmap.width+2,h:pe.bitmap.height+2};ot.push(de),Yt[me]={rect:de,metrics:pe.metrics}}}const{w:Et,h:kt}=a.p(ot),zt=new a.o({width:Et||1,height:kt||1});for(const qt in Z){const St=Z[qt];for(const Yt in St){const me=St[+Yt];if(!me||me.bitmap.width===0||me.bitmap.height===0)continue;const pe=Y[qt][Yt].rect;a.o.copy(me.bitmap,zt,{x:0,y:0},{x:pe.x+1,y:pe.y+1},me.bitmap)}}this.image=zt,this.positions=Y}}a.bi("GlyphAtlas",A);class f{constructor(Z){this.tileID=new a.Q(Z.tileID.overscaledZ,Z.tileID.wrap,Z.tileID.canonical.z,Z.tileID.canonical.x,Z.tileID.canonical.y),this.uid=Z.uid,this.zoom=Z.zoom,this.pixelRatio=Z.pixelRatio,this.tileSize=Z.tileSize,this.source=Z.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Z.showCollisionBoxes,this.collectResourceTiming=!!Z.collectResourceTiming,this.returnDependencies=!!Z.returnDependencies,this.promoteId=Z.promoteId,this.inFlightDependencies=[]}parse(Z,Y,ot,Et){return a._(this,void 0,void 0,function*(){this.status="parsing",this.data=Z,this.collisionBoxArray=new a.a4;const kt=new a.bj(Object.keys(Z.layers).sort()),zt=new a.bk(this.tileID,this.promoteId);zt.bucketLayerIDs=[];const qt={},St={featureIndex:zt,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ot},Yt=Y.familiesBySource[this.source];for(const mr in Yt){const Wr=Z.layers[mr];if(!Wr)continue;Wr.version===1&&a.w(`Vector tile source "${this.source}" layer "${mr}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const bn=kt.encode(mr),Qn=[];for(let Dt=0;Dt<Wr.length;Dt++){const Re=Wr.feature(Dt),Le=zt.getId(Re,mr);Qn.push({feature:Re,id:Le,index:Dt,sourceLayerIndex:bn})}for(const Dt of Yt[mr]){const Re=Dt[0];Re.source!==this.source&&a.w(`layer.source = ${Re.source} does not equal this.source = ${this.source}`),Re.minzoom&&this.zoom<Math.floor(Re.minzoom)||Re.maxzoom&&this.zoom>=Re.maxzoom||Re.visibility!=="none"&&(m(Dt,this.zoom,ot),(qt[Re.id]=Re.createBucket({index:zt.bucketLayerIDs.length,layers:Dt,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:bn,sourceID:this.source})).populate(Qn,St,this.tileID.canonical),zt.bucketLayerIDs.push(Dt.map(Le=>Le.id)))}}const me=a.aE(St.glyphDependencies,mr=>Object.keys(mr).map(Number));this.inFlightDependencies.forEach(mr=>mr==null?void 0:mr.abort()),this.inFlightDependencies=[];let pe=Promise.resolve({});if(Object.keys(me).length){const mr=new AbortController;this.inFlightDependencies.push(mr),pe=Et.sendAsync({type:"GG",data:{stacks:me,source:this.source,tileID:this.tileID,type:"glyphs"}},mr)}const de=Object.keys(St.iconDependencies);let Ve=Promise.resolve({});if(de.length){const mr=new AbortController;this.inFlightDependencies.push(mr),Ve=Et.sendAsync({type:"GI",data:{icons:de,source:this.source,tileID:this.tileID,type:"icons"}},mr)}const Ye=Object.keys(St.patternDependencies);let Er=Promise.resolve({});if(Ye.length){const mr=new AbortController;this.inFlightDependencies.push(mr),Er=Et.sendAsync({type:"GI",data:{icons:Ye,source:this.source,tileID:this.tileID,type:"patterns"}},mr)}const[lr,Ur,kr]=yield Promise.all([pe,Ve,Er]),Hr=new A(lr),mn=new a.bl(Ur,kr);for(const mr in qt){const Wr=qt[mr];Wr instanceof a.a5?(m(Wr.layers,this.zoom,ot),a.bm({bucket:Wr,glyphMap:lr,glyphPositions:Hr.positions,imageMap:Ur,imagePositions:mn.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Wr.hasPattern&&(Wr instanceof a.bn||Wr instanceof a.bo||Wr instanceof a.bp)&&(m(Wr.layers,this.zoom,ot),Wr.addFeatures(St,this.tileID.canonical,mn.patternPositions))}return this.status="done",{buckets:Object.values(qt).filter(mr=>!mr.isEmpty()),featureIndex:zt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Hr.image,imageAtlas:mn,glyphMap:this.returnDependencies?lr:null,iconMap:this.returnDependencies?Ur:null,glyphPositions:this.returnDependencies?Hr.positions:null}})}}function m(Ct,Z,Y){const ot=new a.a8(Z);for(const Et of Ct)Et.recalculate(ot,Y)}class _{constructor(Z,Y,ot){this.actor=Z,this.layerIndex=Y,this.availableImages=ot,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(Z,Y){return a._(this,void 0,void 0,function*(){const ot=yield a.l(Z.request,Y);try{return{vectorTile:new a.bq.VectorTile(new a.br(ot.data)),rawData:ot.data,cacheControl:ot.cacheControl,expires:ot.expires}}catch(Et){const kt=new Uint8Array(ot.data);let zt=`Unable to parse the tile at ${Z.request.url}, `;throw zt+=kt[0]===31&&kt[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${Et.messge}`,new Error(zt)}})}loadTile(Z){return a._(this,void 0,void 0,function*(){const Y=Z.uid,ot=!!(Z&&Z.request&&Z.request.collectResourceTiming)&&new a.bs(Z.request),Et=new f(Z);this.loading[Y]=Et;const kt=new AbortController;Et.abort=kt;try{const zt=yield this.loadVectorTile(Z,kt);if(delete this.loading[Y],!zt)return null;const qt=zt.rawData,St={};zt.expires&&(St.expires=zt.expires),zt.cacheControl&&(St.cacheControl=zt.cacheControl);const Yt={};if(ot){const pe=ot.finish();pe&&(Yt.resourceTiming=JSON.parse(JSON.stringify(pe)))}Et.vectorTile=zt.vectorTile;const me=Et.parse(zt.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[Y]=Et,this.fetching[Y]={rawTileData:qt,cacheControl:St,resourceTiming:Yt};try{const pe=yield me;return a.e({rawTileData:qt.slice(0)},pe,St,Yt)}finally{delete this.fetching[Y]}}catch(zt){throw delete this.loading[Y],Et.status="done",this.loaded[Y]=Et,zt}})}reloadTile(Z){return a._(this,void 0,void 0,function*(){const Y=Z.uid;if(!this.loaded||!this.loaded[Y])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const ot=this.loaded[Y];if(ot.showCollisionBoxes=Z.showCollisionBoxes,ot.status==="parsing"){const Et=yield ot.parse(ot.vectorTile,this.layerIndex,this.availableImages,this.actor);let kt;if(this.fetching[Y]){const{rawTileData:zt,cacheControl:qt,resourceTiming:St}=this.fetching[Y];delete this.fetching[Y],kt=a.e({rawTileData:zt.slice(0)},Et,qt,St)}else kt=Et;return kt}if(ot.status==="done"&&ot.vectorTile)return ot.parse(ot.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(Z){return a._(this,void 0,void 0,function*(){const Y=this.loading,ot=Z.uid;Y&&Y[ot]&&Y[ot].abort&&(Y[ot].abort.abort(),delete Y[ot])})}removeTile(Z){return a._(this,void 0,void 0,function*(){this.loaded&&this.loaded[Z.uid]&&delete this.loaded[Z.uid]})}}class x{constructor(){this.loaded={}}loadTile(Z){return a._(this,void 0,void 0,function*(){const{uid:Y,encoding:ot,rawImageData:Et,redFactor:kt,greenFactor:zt,blueFactor:qt,baseShift:St}=Z,Yt=Et.width+2,me=Et.height+2,pe=a.b(Et)?new a.R({width:Yt,height:me},yield a.bt(Et,-1,-1,Yt,me)):Et,de=new a.bu(Y,pe,ot,kt,zt,qt,St);return this.loaded=this.loaded||{},this.loaded[Y]=de,de})}removeTile(Z){const Y=this.loaded,ot=Z.uid;Y&&Y[ot]&&delete Y[ot]}}function B(Ct,Z){if(Ct.length!==0){P(Ct[0],Z);for(var Y=1;Y<Ct.length;Y++)P(Ct[Y],!Z)}}function P(Ct,Z){for(var Y=0,ot=0,Et=0,kt=Ct.length,zt=kt-1;Et<kt;zt=Et++){var qt=(Ct[Et][0]-Ct[zt][0])*(Ct[zt][1]+Ct[Et][1]),St=Y+qt;ot+=Math.abs(Y)>=Math.abs(qt)?Y-St+qt:qt-St+Y,Y=St}Y+ot>=0!=!!Z&&Ct.reverse()}var M=a.bv(function Ct(Z,Y){var ot,Et=Z&&Z.type;if(Et==="FeatureCollection")for(ot=0;ot<Z.features.length;ot++)Ct(Z.features[ot],Y);else if(Et==="GeometryCollection")for(ot=0;ot<Z.geometries.length;ot++)Ct(Z.geometries[ot],Y);else if(Et==="Feature")Ct(Z.geometry,Y);else if(Et==="Polygon")B(Z.coordinates,Y);else if(Et==="MultiPolygon")for(ot=0;ot<Z.coordinates.length;ot++)B(Z.coordinates[ot],Y);return Z});const k=a.bq.VectorTileFeature.prototype.toGeoJSON;var Q={exports:{}},q=a.bw,J=a.bq.VectorTileFeature,tt=ft;function ft(Ct,Z){this.options=Z||{},this.features=Ct,this.length=Ct.length}function pt(Ct,Z){this.id=typeof Ct.id=="number"?Ct.id:void 0,this.type=Ct.type,this.rawGeometry=Ct.type===1?[Ct.geometry]:Ct.geometry,this.properties=Ct.tags,this.extent=Z||4096}ft.prototype.feature=function(Ct){return new pt(this.features[Ct],this.options.extent)},pt.prototype.loadGeometry=function(){var Ct=this.rawGeometry;this.geometry=[];for(var Z=0;Z<Ct.length;Z++){for(var Y=Ct[Z],ot=[],Et=0;Et<Y.length;Et++)ot.push(new q(Y[Et][0],Y[Et][1]));this.geometry.push(ot)}return this.geometry},pt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Ct=this.geometry,Z=1/0,Y=-1/0,ot=1/0,Et=-1/0,kt=0;kt<Ct.length;kt++)for(var zt=Ct[kt],qt=0;qt<zt.length;qt++){var St=zt[qt];Z=Math.min(Z,St.x),Y=Math.max(Y,St.x),ot=Math.min(ot,St.y),Et=Math.max(Et,St.y)}return[Z,ot,Y,Et]},pt.prototype.toGeoJSON=J.prototype.toGeoJSON;var mt=a.bx,dt=tt;function Rt(Ct){var Z=new mt;return function(Y,ot){for(var Et in Y.layers)ot.writeMessage(3,Lt,Y.layers[Et])}(Ct,Z),Z.finish()}function Lt(Ct,Z){var Y;Z.writeVarintField(15,Ct.version||1),Z.writeStringField(1,Ct.name||""),Z.writeVarintField(5,Ct.extent||4096);var ot={keys:[],values:[],keycache:{},valuecache:{}};for(Y=0;Y<Ct.length;Y++)ot.feature=Ct.feature(Y),Z.writeMessage(2,st,ot);var Et=ot.keys;for(Y=0;Y<Et.length;Y++)Z.writeStringField(3,Et[Y]);var kt=ot.values;for(Y=0;Y<kt.length;Y++)Z.writeMessage(4,Zt,kt[Y])}function st(Ct,Z){var Y=Ct.feature;Y.id!==void 0&&Z.writeVarintField(1,Y.id),Z.writeMessage(2,ct,Ct),Z.writeVarintField(3,Y.type),Z.writeMessage(4,te,Y)}function ct(Ct,Z){var Y=Ct.feature,ot=Ct.keys,Et=Ct.values,kt=Ct.keycache,zt=Ct.valuecache;for(var qt in Y.properties){var St=Y.properties[qt],Yt=kt[qt];if(St!==null){Yt===void 0&&(ot.push(qt),kt[qt]=Yt=ot.length-1),Z.writeVarint(Yt);var me=typeof St;me!=="string"&&me!=="boolean"&&me!=="number"&&(St=JSON.stringify(St));var pe=me+":"+St,de=zt[pe];de===void 0&&(Et.push(St),zt[pe]=de=Et.length-1),Z.writeVarint(de)}}}function wt(Ct,Z){return(Z<<3)+(7&Ct)}function yt(Ct){return Ct<<1^Ct>>31}function te(Ct,Z){for(var Y=Ct.loadGeometry(),ot=Ct.type,Et=0,kt=0,zt=Y.length,qt=0;qt<zt;qt++){var St=Y[qt],Yt=1;ot===1&&(Yt=St.length),Z.writeVarint(wt(1,Yt));for(var me=ot===3?St.length-1:St.length,pe=0;pe<me;pe++){pe===1&&ot!==1&&Z.writeVarint(wt(2,me-1));var de=St[pe].x-Et,Ve=St[pe].y-kt;Z.writeVarint(yt(de)),Z.writeVarint(yt(Ve)),Et+=de,kt+=Ve}ot===3&&Z.writeVarint(wt(7,1))}}function Zt(Ct,Z){var Y=typeof Ct;Y==="string"?Z.writeStringField(1,Ct):Y==="boolean"?Z.writeBooleanField(7,Ct):Y==="number"&&(Ct%1!=0?Z.writeDoubleField(3,Ct):Ct<0?Z.writeSVarintField(6,Ct):Z.writeVarintField(5,Ct))}Q.exports=Rt,Q.exports.fromVectorTileJs=Rt,Q.exports.fromGeojsonVt=function(Ct,Z){Z=Z||{};var Y={};for(var ot in Ct)Y[ot]=new dt(Ct[ot].features,Z),Y[ot].name=ot,Y[ot].version=Z.version,Y[ot].extent=Z.extent;return Rt({layers:Y})},Q.exports.GeoJSONWrapper=dt;var re=a.bv(Q.exports);const Xt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ct=>Ct},ne=Math.fround||(se=new Float32Array(1),Ct=>(se[0]=+Ct,se[0]));var se;const we=3,it=5,vt=6;class Ft{constructor(Z){this.options=Object.assign(Object.create(Xt),Z),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Z){const{log:Y,minZoom:ot,maxZoom:Et}=this.options;Y&&console.time("total time");const kt=`prepare ${Z.length} points`;Y&&console.time(kt),this.points=Z;const zt=[];for(let St=0;St<Z.length;St++){const Yt=Z[St];if(!Yt.geometry)continue;const[me,pe]=Yt.geometry.coordinates,de=ne(jt(me)),Ve=ne(ae(pe));zt.push(de,Ve,1/0,St,-1,1),this.options.reduce&&zt.push(0)}let qt=this.trees[Et+1]=this._createTree(zt);Y&&console.timeEnd(kt);for(let St=Et;St>=ot;St--){const Yt=+Date.now();qt=this.trees[St]=this._createTree(this._cluster(qt,St)),Y&&console.log("z%d: %d clusters in %dms",St,qt.numItems,+Date.now()-Yt)}return Y&&console.timeEnd("total time"),this}getClusters(Z,Y){let ot=((Z[0]+180)%360+360)%360-180;const Et=Math.max(-90,Math.min(90,Z[1]));let kt=Z[2]===180?180:((Z[2]+180)%360+360)%360-180;const zt=Math.max(-90,Math.min(90,Z[3]));if(Z[2]-Z[0]>=360)ot=-180,kt=180;else if(ot>kt){const pe=this.getClusters([ot,Et,180,zt],Y),de=this.getClusters([-180,Et,kt,zt],Y);return pe.concat(de)}const qt=this.trees[this._limitZoom(Y)],St=qt.range(jt(ot),ae(zt),jt(kt),ae(Et)),Yt=qt.data,me=[];for(const pe of St){const de=this.stride*pe;me.push(Yt[de+it]>1?Ot(Yt,de,this.clusterProps):this.points[Yt[de+we]])}return me}getChildren(Z){const Y=this._getOriginId(Z),ot=this._getOriginZoom(Z),Et="No cluster with the specified id.",kt=this.trees[ot];if(!kt)throw new Error(Et);const zt=kt.data;if(Y*this.stride>=zt.length)throw new Error(Et);const qt=this.options.radius/(this.options.extent*Math.pow(2,ot-1)),St=kt.within(zt[Y*this.stride],zt[Y*this.stride+1],qt),Yt=[];for(const me of St){const pe=me*this.stride;zt[pe+4]===Z&&Yt.push(zt[pe+it]>1?Ot(zt,pe,this.clusterProps):this.points[zt[pe+we]])}if(Yt.length===0)throw new Error(Et);return Yt}getLeaves(Z,Y,ot){const Et=[];return this._appendLeaves(Et,Z,Y=Y||10,ot=ot||0,0),Et}getTile(Z,Y,ot){const Et=this.trees[this._limitZoom(Z)],kt=Math.pow(2,Z),{extent:zt,radius:qt}=this.options,St=qt/zt,Yt=(ot-St)/kt,me=(ot+1+St)/kt,pe={features:[]};return this._addTileFeatures(Et.range((Y-St)/kt,Yt,(Y+1+St)/kt,me),Et.data,Y,ot,kt,pe),Y===0&&this._addTileFeatures(Et.range(1-St/kt,Yt,1,me),Et.data,kt,ot,kt,pe),Y===kt-1&&this._addTileFeatures(Et.range(0,Yt,St/kt,me),Et.data,-1,ot,kt,pe),pe.features.length?pe:null}getClusterExpansionZoom(Z){let Y=this._getOriginZoom(Z)-1;for(;Y<=this.options.maxZoom;){const ot=this.getChildren(Z);if(Y++,ot.length!==1)break;Z=ot[0].properties.cluster_id}return Y}_appendLeaves(Z,Y,ot,Et,kt){const zt=this.getChildren(Y);for(const qt of zt){const St=qt.properties;if(St&&St.cluster?kt+St.point_count<=Et?kt+=St.point_count:kt=this._appendLeaves(Z,St.cluster_id,ot,Et,kt):kt<Et?kt++:Z.push(qt),Z.length===ot)break}return kt}_createTree(Z){const Y=new a.au(Z.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ot=0;ot<Z.length;ot+=this.stride)Y.add(Z[ot],Z[ot+1]);return Y.finish(),Y.data=Z,Y}_addTileFeatures(Z,Y,ot,Et,kt,zt){for(const qt of Z){const St=qt*this.stride,Yt=Y[St+it]>1;let me,pe,de;if(Yt)me=$t(Y,St,this.clusterProps),pe=Y[St],de=Y[St+1];else{const Er=this.points[Y[St+we]];me=Er.properties;const[lr,Ur]=Er.geometry.coordinates;pe=jt(lr),de=ae(Ur)}const Ve={type:1,geometry:[[Math.round(this.options.extent*(pe*kt-ot)),Math.round(this.options.extent*(de*kt-Et))]],tags:me};let Ye;Ye=Yt||this.options.generateId?Y[St+we]:this.points[Y[St+we]].id,Ye!==void 0&&(Ve.id=Ye),zt.features.push(Ve)}}_limitZoom(Z){return Math.max(this.options.minZoom,Math.min(Math.floor(+Z),this.options.maxZoom+1))}_cluster(Z,Y){const{radius:ot,extent:Et,reduce:kt,minPoints:zt}=this.options,qt=ot/(Et*Math.pow(2,Y)),St=Z.data,Yt=[],me=this.stride;for(let pe=0;pe<St.length;pe+=me){if(St[pe+2]<=Y)continue;St[pe+2]=Y;const de=St[pe],Ve=St[pe+1],Ye=Z.within(St[pe],St[pe+1],qt),Er=St[pe+it];let lr=Er;for(const Ur of Ye){const kr=Ur*me;St[kr+2]>Y&&(lr+=St[kr+it])}if(lr>Er&&lr>=zt){let Ur,kr=de*Er,Hr=Ve*Er,mn=-1;const mr=((pe/me|0)<<5)+(Y+1)+this.points.length;for(const Wr of Ye){const bn=Wr*me;if(St[bn+2]<=Y)continue;St[bn+2]=Y;const Qn=St[bn+it];kr+=St[bn]*Qn,Hr+=St[bn+1]*Qn,St[bn+4]=mr,kt&&(Ur||(Ur=this._map(St,pe,!0),mn=this.clusterProps.length,this.clusterProps.push(Ur)),kt(Ur,this._map(St,bn)))}St[pe+4]=mr,Yt.push(kr/lr,Hr/lr,1/0,mr,-1,lr),kt&&Yt.push(mn)}else{for(let Ur=0;Ur<me;Ur++)Yt.push(St[pe+Ur]);if(lr>1)for(const Ur of Ye){const kr=Ur*me;if(!(St[kr+2]<=Y)){St[kr+2]=Y;for(let Hr=0;Hr<me;Hr++)Yt.push(St[kr+Hr])}}}}return Yt}_getOriginId(Z){return Z-this.points.length>>5}_getOriginZoom(Z){return(Z-this.points.length)%32}_map(Z,Y,ot){if(Z[Y+it]>1){const zt=this.clusterProps[Z[Y+vt]];return ot?Object.assign({},zt):zt}const Et=this.points[Z[Y+we]].properties,kt=this.options.map(Et);return ot&&kt===Et?Object.assign({},kt):kt}}function Ot(Ct,Z,Y){return{type:"Feature",id:Ct[Z+we],properties:$t(Ct,Z,Y),geometry:{type:"Point",coordinates:[(ot=Ct[Z],360*(ot-.5)),ie(Ct[Z+1])]}};var ot}function $t(Ct,Z,Y){const ot=Ct[Z+it],Et=ot>=1e4?`${Math.round(ot/1e3)}k`:ot>=1e3?Math.round(ot/100)/10+"k":ot,kt=Ct[Z+vt],zt=kt===-1?{}:Object.assign({},Y[kt]);return Object.assign(zt,{cluster:!0,cluster_id:Ct[Z+we],point_count:ot,point_count_abbreviated:Et})}function jt(Ct){return Ct/360+.5}function ae(Ct){const Z=Math.sin(Ct*Math.PI/180),Y=.5-.25*Math.log((1+Z)/(1-Z))/Math.PI;return Y<0?0:Y>1?1:Y}function ie(Ct){const Z=(180-360*Ct)*Math.PI/180;return 360*Math.atan(Math.exp(Z))/Math.PI-90}function Be(Ct,Z,Y,ot){for(var Et,kt=ot,zt=Y-Z>>1,qt=Y-Z,St=Ct[Z],Yt=Ct[Z+1],me=Ct[Y],pe=Ct[Y+1],de=Z+3;de<Y;de+=3){var Ve=Ie(Ct[de],Ct[de+1],St,Yt,me,pe);if(Ve>kt)Et=de,kt=Ve;else if(Ve===kt){var Ye=Math.abs(de-zt);Ye<qt&&(Et=de,qt=Ye)}}kt>ot&&(Et-Z>3&&Be(Ct,Z,Et,ot),Ct[Et+2]=kt,Y-Et>3&&Be(Ct,Et,Y,ot))}function Ie(Ct,Z,Y,ot,Et,kt){var zt=Et-Y,qt=kt-ot;if(zt!==0||qt!==0){var St=((Ct-Y)*zt+(Z-ot)*qt)/(zt*zt+qt*qt);St>1?(Y=Et,ot=kt):St>0&&(Y+=zt*St,ot+=qt*St)}return(zt=Ct-Y)*zt+(qt=Z-ot)*qt}function Qe(Ct,Z,Y,ot){var Et={id:Ct===void 0?null:Ct,type:Z,geometry:Y,tags:ot,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(kt){var zt=kt.geometry,qt=kt.type;if(qt==="Point"||qt==="MultiPoint"||qt==="LineString")He(kt,zt);else if(qt==="Polygon"||qt==="MultiLineString")for(var St=0;St<zt.length;St++)He(kt,zt[St]);else if(qt==="MultiPolygon")for(St=0;St<zt.length;St++)for(var Yt=0;Yt<zt[St].length;Yt++)He(kt,zt[St][Yt])}(Et),Et}function He(Ct,Z){for(var Y=0;Y<Z.length;Y+=3)Ct.minX=Math.min(Ct.minX,Z[Y]),Ct.minY=Math.min(Ct.minY,Z[Y+1]),Ct.maxX=Math.max(Ct.maxX,Z[Y]),Ct.maxY=Math.max(Ct.maxY,Z[Y+1])}function ze(Ct,Z,Y,ot){if(Z.geometry){var Et=Z.geometry.coordinates,kt=Z.geometry.type,zt=Math.pow(Y.tolerance/((1<<Y.maxZoom)*Y.extent),2),qt=[],St=Z.id;if(Y.promoteId?St=Z.properties[Y.promoteId]:Y.generateId&&(St=ot||0),kt==="Point")ge(Et,qt);else if(kt==="MultiPoint")for(var Yt=0;Yt<Et.length;Yt++)ge(Et[Yt],qt);else if(kt==="LineString")Ut(Et,qt,zt,!1);else if(kt==="MultiLineString"){if(Y.lineMetrics){for(Yt=0;Yt<Et.length;Yt++)Ut(Et[Yt],qt=[],zt,!1),Ct.push(Qe(St,"LineString",qt,Z.properties));return}Jt(Et,qt,zt,!1)}else if(kt==="Polygon")Jt(Et,qt,zt,!0);else{if(kt!=="MultiPolygon"){if(kt==="GeometryCollection"){for(Yt=0;Yt<Z.geometry.geometries.length;Yt++)ze(Ct,{id:St,geometry:Z.geometry.geometries[Yt],properties:Z.properties},Y,ot);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Yt=0;Yt<Et.length;Yt++){var me=[];Jt(Et[Yt],me,zt,!0),qt.push(me)}}Ct.push(Qe(St,kt,qt,Z.properties))}}function ge(Ct,Z){Z.push(er(Ct[0])),Z.push(Se(Ct[1])),Z.push(0)}function Ut(Ct,Z,Y,ot){for(var Et,kt,zt=0,qt=0;qt<Ct.length;qt++){var St=er(Ct[qt][0]),Yt=Se(Ct[qt][1]);Z.push(St),Z.push(Yt),Z.push(0),qt>0&&(zt+=ot?(Et*Yt-St*kt)/2:Math.sqrt(Math.pow(St-Et,2)+Math.pow(Yt-kt,2))),Et=St,kt=Yt}var me=Z.length-3;Z[2]=1,Be(Z,0,me,Y),Z[me+2]=1,Z.size=Math.abs(zt),Z.start=0,Z.end=Z.size}function Jt(Ct,Z,Y,ot){for(var Et=0;Et<Ct.length;Et++){var kt=[];Ut(Ct[Et],kt,Y,ot),Z.push(kt)}}function er(Ct){return Ct/360+.5}function Se(Ct){var Z=Math.sin(Ct*Math.PI/180),Y=.5-.25*Math.log((1+Z)/(1-Z))/Math.PI;return Y<0?0:Y>1?1:Y}function _e(Ct,Z,Y,ot,Et,kt,zt,qt){if(ot/=Z,kt>=(Y/=Z)&&zt<ot)return Ct;if(zt<Y||kt>=ot)return null;for(var St=[],Yt=0;Yt<Ct.length;Yt++){var me=Ct[Yt],pe=me.geometry,de=me.type,Ve=Et===0?me.minX:me.minY,Ye=Et===0?me.maxX:me.maxY;if(Ve>=Y&&Ye<ot)St.push(me);else if(!(Ye<Y||Ve>=ot)){var Er=[];if(de==="Point"||de==="MultiPoint")xe(pe,Er,Y,ot,Et);else if(de==="LineString")Ne(pe,Er,Y,ot,Et,!1,qt.lineMetrics);else if(de==="MultiLineString")Ar(pe,Er,Y,ot,Et,!1);else if(de==="Polygon")Ar(pe,Er,Y,ot,Et,!0);else if(de==="MultiPolygon")for(var lr=0;lr<pe.length;lr++){var Ur=[];Ar(pe[lr],Ur,Y,ot,Et,!0),Ur.length&&Er.push(Ur)}if(Er.length){if(qt.lineMetrics&&de==="LineString"){for(lr=0;lr<Er.length;lr++)St.push(Qe(me.id,de,Er[lr],me.tags));continue}de!=="LineString"&&de!=="MultiLineString"||(Er.length===1?(de="LineString",Er=Er[0]):de="MultiLineString"),de!=="Point"&&de!=="MultiPoint"||(de=Er.length===3?"Point":"MultiPoint"),St.push(Qe(me.id,de,Er,me.tags))}}}return St.length?St:null}function xe(Ct,Z,Y,ot,Et){for(var kt=0;kt<Ct.length;kt+=3){var zt=Ct[kt+Et];zt>=Y&&zt<=ot&&(Z.push(Ct[kt]),Z.push(Ct[kt+1]),Z.push(Ct[kt+2]))}}function Ne(Ct,Z,Y,ot,Et,kt,zt){for(var qt,St,Yt=ir(Ct),me=Et===0?Tr:Nr,pe=Ct.start,de=0;de<Ct.length-3;de+=3){var Ve=Ct[de],Ye=Ct[de+1],Er=Ct[de+2],lr=Ct[de+3],Ur=Ct[de+4],kr=Et===0?Ve:Ye,Hr=Et===0?lr:Ur,mn=!1;zt&&(qt=Math.sqrt(Math.pow(Ve-lr,2)+Math.pow(Ye-Ur,2))),kr<Y?Hr>Y&&(St=me(Yt,Ve,Ye,lr,Ur,Y),zt&&(Yt.start=pe+qt*St)):kr>ot?Hr<ot&&(St=me(Yt,Ve,Ye,lr,Ur,ot),zt&&(Yt.start=pe+qt*St)):Lr(Yt,Ve,Ye,Er),Hr<Y&&kr>=Y&&(St=me(Yt,Ve,Ye,lr,Ur,Y),mn=!0),Hr>ot&&kr<=ot&&(St=me(Yt,Ve,Ye,lr,Ur,ot),mn=!0),!kt&&mn&&(zt&&(Yt.end=pe+qt*St),Z.push(Yt),Yt=ir(Ct)),zt&&(pe+=qt)}var mr=Ct.length-3;Ve=Ct[mr],Ye=Ct[mr+1],Er=Ct[mr+2],(kr=Et===0?Ve:Ye)>=Y&&kr<=ot&&Lr(Yt,Ve,Ye,Er),mr=Yt.length-3,kt&&mr>=3&&(Yt[mr]!==Yt[0]||Yt[mr+1]!==Yt[1])&&Lr(Yt,Yt[0],Yt[1],Yt[2]),Yt.length&&Z.push(Yt)}function ir(Ct){var Z=[];return Z.size=Ct.size,Z.start=Ct.start,Z.end=Ct.end,Z}function Ar(Ct,Z,Y,ot,Et,kt){for(var zt=0;zt<Ct.length;zt++)Ne(Ct[zt],Z,Y,ot,Et,kt,!1)}function Lr(Ct,Z,Y,ot){Ct.push(Z),Ct.push(Y),Ct.push(ot)}function Tr(Ct,Z,Y,ot,Et,kt){var zt=(kt-Z)/(ot-Z);return Ct.push(kt),Ct.push(Y+(Et-Y)*zt),Ct.push(1),zt}function Nr(Ct,Z,Y,ot,Et,kt){var zt=(kt-Y)/(Et-Y);return Ct.push(Z+(ot-Z)*zt),Ct.push(kt),Ct.push(1),zt}function Qr(Ct,Z){for(var Y=[],ot=0;ot<Ct.length;ot++){var Et,kt=Ct[ot],zt=kt.type;if(zt==="Point"||zt==="MultiPoint"||zt==="LineString")Et=fe(kt.geometry,Z);else if(zt==="MultiLineString"||zt==="Polygon"){Et=[];for(var qt=0;qt<kt.geometry.length;qt++)Et.push(fe(kt.geometry[qt],Z))}else if(zt==="MultiPolygon")for(Et=[],qt=0;qt<kt.geometry.length;qt++){for(var St=[],Yt=0;Yt<kt.geometry[qt].length;Yt++)St.push(fe(kt.geometry[qt][Yt],Z));Et.push(St)}Y.push(Qe(kt.id,zt,Et,kt.tags))}return Y}function fe(Ct,Z){var Y=[];Y.size=Ct.size,Ct.start!==void 0&&(Y.start=Ct.start,Y.end=Ct.end);for(var ot=0;ot<Ct.length;ot+=3)Y.push(Ct[ot]+Z,Ct[ot+1],Ct[ot+2]);return Y}function Ir(Ct,Z){if(Ct.transformed)return Ct;var Y,ot,Et,kt=1<<Ct.z,zt=Ct.x,qt=Ct.y;for(Y=0;Y<Ct.features.length;Y++){var St=Ct.features[Y],Yt=St.geometry,me=St.type;if(St.geometry=[],me===1)for(ot=0;ot<Yt.length;ot+=2)St.geometry.push(De(Yt[ot],Yt[ot+1],Z,kt,zt,qt));else for(ot=0;ot<Yt.length;ot++){var pe=[];for(Et=0;Et<Yt[ot].length;Et+=2)pe.push(De(Yt[ot][Et],Yt[ot][Et+1],Z,kt,zt,qt));St.geometry.push(pe)}}return Ct.transformed=!0,Ct}function De(Ct,Z,Y,ot,Et,kt){return[Math.round(Y*(Ct*ot-Et)),Math.round(Y*(Z*ot-kt))]}function xn(Ct,Z,Y,ot,Et){for(var kt=Z===Et.maxZoom?0:Et.tolerance/((1<<Z)*Et.extent),zt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Y,y:ot,z:Z,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},qt=0;qt<Ct.length;qt++){zt.numFeatures++,Pr(zt,Ct[qt],kt,Et);var St=Ct[qt].minX,Yt=Ct[qt].minY,me=Ct[qt].maxX,pe=Ct[qt].maxY;St<zt.minX&&(zt.minX=St),Yt<zt.minY&&(zt.minY=Yt),me>zt.maxX&&(zt.maxX=me),pe>zt.maxY&&(zt.maxY=pe)}return zt}function Pr(Ct,Z,Y,ot){var Et=Z.geometry,kt=Z.type,zt=[];if(kt==="Point"||kt==="MultiPoint")for(var qt=0;qt<Et.length;qt+=3)zt.push(Et[qt]),zt.push(Et[qt+1]),Ct.numPoints++,Ct.numSimplified++;else if(kt==="LineString")Te(zt,Et,Ct,Y,!1,!1);else if(kt==="MultiLineString"||kt==="Polygon")for(qt=0;qt<Et.length;qt++)Te(zt,Et[qt],Ct,Y,kt==="Polygon",qt===0);else if(kt==="MultiPolygon")for(var St=0;St<Et.length;St++){var Yt=Et[St];for(qt=0;qt<Yt.length;qt++)Te(zt,Yt[qt],Ct,Y,!0,qt===0)}if(zt.length){var me=Z.tags||null;if(kt==="LineString"&&ot.lineMetrics){for(var pe in me={},Z.tags)me[pe]=Z.tags[pe];me.mapbox_clip_start=Et.start/Et.size,me.mapbox_clip_end=Et.end/Et.size}var de={geometry:zt,type:kt==="Polygon"||kt==="MultiPolygon"?3:kt==="LineString"||kt==="MultiLineString"?2:1,tags:me};Z.id!==null&&(de.id=Z.id),Ct.features.push(de)}}function Te(Ct,Z,Y,ot,Et,kt){var zt=ot*ot;if(ot>0&&Z.size<(Et?zt:ot))Y.numPoints+=Z.length/3;else{for(var qt=[],St=0;St<Z.length;St+=3)(ot===0||Z[St+2]>zt)&&(Y.numSimplified++,qt.push(Z[St]),qt.push(Z[St+1])),Y.numPoints++;Et&&function(Yt,me){for(var pe=0,de=0,Ve=Yt.length,Ye=Ve-2;de<Ve;Ye=de,de+=2)pe+=(Yt[de]-Yt[Ye])*(Yt[de+1]+Yt[Ye+1]);if(pe>0===me)for(de=0,Ve=Yt.length;de<Ve/2;de+=2){var Er=Yt[de],lr=Yt[de+1];Yt[de]=Yt[Ve-2-de],Yt[de+1]=Yt[Ve-1-de],Yt[Ve-2-de]=Er,Yt[Ve-1-de]=lr}}(qt,kt),Ct.push(qt)}}function Je(Ct,Z){var Y=(Z=this.options=function(Et,kt){for(var zt in kt)Et[zt]=kt[zt];return Et}(Object.create(this.options),Z)).debug;if(Y&&console.time("preprocess data"),Z.maxZoom<0||Z.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Z.promoteId&&Z.generateId)throw new Error("promoteId and generateId cannot be used together.");var ot=function(Et,kt){var zt=[];if(Et.type==="FeatureCollection")for(var qt=0;qt<Et.features.length;qt++)ze(zt,Et.features[qt],kt,qt);else ze(zt,Et.type==="Feature"?Et:{geometry:Et},kt);return zt}(Ct,Z);this.tiles={},this.tileCoords=[],Y&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Z.indexMaxZoom,Z.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ot=function(Et,kt){var zt=kt.buffer/kt.extent,qt=Et,St=_e(Et,1,-1-zt,zt,0,-1,2,kt),Yt=_e(Et,1,1-zt,2+zt,0,-1,2,kt);return(St||Yt)&&(qt=_e(Et,1,-zt,1+zt,0,-1,2,kt)||[],St&&(qt=Qr(St,1).concat(qt)),Yt&&(qt=qt.concat(Qr(Yt,-1)))),qt}(ot,Z),ot.length&&this.splitTile(ot,0,0,0),Y&&(ot.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Ke(Ct,Z,Y){return 32*((1<<Ct)*Y+Z)+Ct}function Yr(Ct,Z){return Z?Ct.properties[Z]:Ct.id}function Or(Ct,Z){if(Ct==null)return!0;if(Ct.type==="Feature")return Yr(Ct,Z)!=null;if(Ct.type==="FeatureCollection"){const Y=new Set;for(const ot of Ct.features){const Et=Yr(ot,Z);if(Et==null||Y.has(Et))return!1;Y.add(Et)}return!0}return!1}function gr(Ct,Z){const Y=new Map;if(Ct!=null)if(Ct.type==="Feature")Y.set(Yr(Ct,Z),Ct);else for(const ot of Ct.features)Y.set(Yr(ot,Z),ot);return Y}Je.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Je.prototype.splitTile=function(Ct,Z,Y,ot,Et,kt,zt){for(var qt=[Ct,Z,Y,ot],St=this.options,Yt=St.debug;qt.length;){ot=qt.pop(),Y=qt.pop(),Z=qt.pop(),Ct=qt.pop();var me=1<<Z,pe=Ke(Z,Y,ot),de=this.tiles[pe];if(!de&&(Yt>1&&console.time("creation"),de=this.tiles[pe]=xn(Ct,Z,Y,ot,St),this.tileCoords.push({z:Z,x:Y,y:ot}),Yt)){Yt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Z,Y,ot,de.numFeatures,de.numPoints,de.numSimplified),console.timeEnd("creation"));var Ve="z"+Z;this.stats[Ve]=(this.stats[Ve]||0)+1,this.total++}if(de.source=Ct,Et){if(Z===St.maxZoom||Z===Et)continue;var Ye=1<<Et-Z;if(Y!==Math.floor(kt/Ye)||ot!==Math.floor(zt/Ye))continue}else if(Z===St.indexMaxZoom||de.numPoints<=St.indexMaxPoints)continue;if(de.source=null,Ct.length!==0){Yt>1&&console.time("clipping");var Er,lr,Ur,kr,Hr,mn,mr=.5*St.buffer/St.extent,Wr=.5-mr,bn=.5+mr,Qn=1+mr;Er=lr=Ur=kr=null,Hr=_e(Ct,me,Y-mr,Y+bn,0,de.minX,de.maxX,St),mn=_e(Ct,me,Y+Wr,Y+Qn,0,de.minX,de.maxX,St),Ct=null,Hr&&(Er=_e(Hr,me,ot-mr,ot+bn,1,de.minY,de.maxY,St),lr=_e(Hr,me,ot+Wr,ot+Qn,1,de.minY,de.maxY,St),Hr=null),mn&&(Ur=_e(mn,me,ot-mr,ot+bn,1,de.minY,de.maxY,St),kr=_e(mn,me,ot+Wr,ot+Qn,1,de.minY,de.maxY,St),mn=null),Yt>1&&console.timeEnd("clipping"),qt.push(Er||[],Z+1,2*Y,2*ot),qt.push(lr||[],Z+1,2*Y,2*ot+1),qt.push(Ur||[],Z+1,2*Y+1,2*ot),qt.push(kr||[],Z+1,2*Y+1,2*ot+1)}}},Je.prototype.getTile=function(Ct,Z,Y){var ot=this.options,Et=ot.extent,kt=ot.debug;if(Ct<0||Ct>24)return null;var zt=1<<Ct,qt=Ke(Ct,Z=(Z%zt+zt)%zt,Y);if(this.tiles[qt])return Ir(this.tiles[qt],Et);kt>1&&console.log("drilling down to z%d-%d-%d",Ct,Z,Y);for(var St,Yt=Ct,me=Z,pe=Y;!St&&Yt>0;)Yt--,me=Math.floor(me/2),pe=Math.floor(pe/2),St=this.tiles[Ke(Yt,me,pe)];return St&&St.source?(kt>1&&console.log("found parent tile z%d-%d-%d",Yt,me,pe),kt>1&&console.time("drilling down"),this.splitTile(St.source,Yt,me,pe,Ct,Z,Y),kt>1&&console.timeEnd("drilling down"),this.tiles[qt]?Ir(this.tiles[qt],Et):null):null};class an extends _{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(Z,Y){return a._(this,void 0,void 0,function*(){const ot=Z.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const Et=this._geoJSONIndex.getTile(ot.z,ot.x,ot.y);if(!Et)return null;const kt=new class{constructor(qt){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=a.W,this.length=qt.length,this._features=qt}feature(qt){return new class{constructor(St){this._feature=St,this.extent=a.W,this.type=St.type,this.properties=St.tags,"id"in St&&!isNaN(St.id)&&(this.id=parseInt(St.id,10))}loadGeometry(){if(this._feature.type===1){const St=[];for(const Yt of this._feature.geometry)St.push([new a.P(Yt[0],Yt[1])]);return St}{const St=[];for(const Yt of this._feature.geometry){const me=[];for(const pe of Yt)me.push(new a.P(pe[0],pe[1]));St.push(me)}return St}}toGeoJSON(St,Yt,me){return k.call(this,St,Yt,me)}}(this._features[qt])}}(Et.features);let zt=re(kt);return zt.byteOffset===0&&zt.byteLength===zt.buffer.byteLength||(zt=new Uint8Array(zt)),{vectorTile:kt,rawData:zt.buffer}})}loadData(Z){return a._(this,void 0,void 0,function*(){var Y;(Y=this._pendingRequest)===null||Y===void 0||Y.abort();const ot=!!(Z&&Z.request&&Z.request.collectResourceTiming)&&new a.bs(Z.request);this._pendingRequest=new AbortController;try{let Et=yield this.loadGeoJSON(Z,this._pendingRequest);if(delete this._pendingRequest,typeof Et!="object")throw new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`);if(M(Et,!0),Z.filter){const zt=a.by(Z.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(zt.result==="error")throw new Error(zt.value.map(St=>`${St.key}: ${St.message}`).join(", "));Et={type:"FeatureCollection",features:Et.features.filter(St=>zt.value.evaluate({zoom:0},St))}}this._geoJSONIndex=Z.cluster?new Ft(function(zt){let{superclusterOptions:qt,clusterProperties:St}=zt;if(!St||!qt)return qt;const Yt={},me={},pe={accumulated:null,zoom:0},de={properties:null},Ve=Object.keys(St);for(const Ye of Ve){const[Er,lr]=St[Ye],Ur=a.by(lr),kr=a.by(typeof Er=="string"?[Er,["accumulated"],["get",Ye]]:Er);Yt[Ye]=Ur.value,me[Ye]=kr.value}return qt.map=Ye=>{de.properties=Ye;const Er={};for(const lr of Ve)Er[lr]=Yt[lr].evaluate(pe,de);return Er},qt.reduce=(Ye,Er)=>{de.properties=Er;for(const lr of Ve)pe.accumulated=Ye[lr],Ye[lr]=me[lr].evaluate(pe,de)},qt}(Z)).load(Et.features):function(zt,qt){return new Je(zt,qt)}(Et,Z.geojsonVtOptions),this.loaded={};const kt={};if(ot){const zt=ot.finish();zt&&(kt.resourceTiming={},kt.resourceTiming[Z.source]=JSON.parse(JSON.stringify(zt)))}return kt}catch(Et){if(delete this._pendingRequest,a.bz(Et))return{abandoned:!0};throw Et}})}reloadTile(Z){const Y=this.loaded;return Y&&Y[Z.uid]?super.reloadTile(Z):this.loadTile(Z)}loadGeoJSON(Z,Y){return a._(this,void 0,void 0,function*(){const{promoteId:ot}=Z;if(Z.request){const Et=yield a.h(Z.request,Y);return this._dataUpdateable=Or(Et.data,ot)?gr(Et.data,ot):void 0,Et.data}if(typeof Z.data=="string")try{const Et=JSON.parse(Z.data);return this._dataUpdateable=Or(Et,ot)?gr(Et,ot):void 0,Et}catch{throw new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`)}if(!Z.dataDiff)throw new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${Z.source}`);return function(Et,kt,zt){var qt,St,Yt,me;if(kt.removeAll&&Et.clear(),kt.remove)for(const pe of kt.remove)Et.delete(pe);if(kt.add)for(const pe of kt.add){const de=Yr(pe,zt);de!=null&&Et.set(de,pe)}if(kt.update)for(const pe of kt.update){let de=Et.get(pe.id);if(de==null)continue;const Ve=!pe.removeAllProperties&&(((qt=pe.removeProperties)===null||qt===void 0?void 0:qt.length)>0||((St=pe.addOrUpdateProperties)===null||St===void 0?void 0:St.length)>0);if((pe.newGeometry||pe.removeAllProperties||Ve)&&(de=Object.assign({},de),Et.set(pe.id,de),Ve&&(de.properties=Object.assign({},de.properties))),pe.newGeometry&&(de.geometry=pe.newGeometry),pe.removeAllProperties)de.properties={};else if(((Yt=pe.removeProperties)===null||Yt===void 0?void 0:Yt.length)>0)for(const Ye of pe.removeProperties)Object.prototype.hasOwnProperty.call(de.properties,Ye)&&delete de.properties[Ye];if(((me=pe.addOrUpdateProperties)===null||me===void 0?void 0:me.length)>0)for(const{key:Ye,value:Er}of pe.addOrUpdateProperties)de.properties[Ye]=Er}}(this._dataUpdateable,Z.dataDiff,ot),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(Z){return a._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(Z){return this._geoJSONIndex.getClusterExpansionZoom(Z.clusterId)}getClusterChildren(Z){return this._geoJSONIndex.getChildren(Z.clusterId)}getClusterLeaves(Z){return this._geoJSONIndex.getLeaves(Z.clusterId,Z.limit,Z.offset)}}class $r{constructor(Z){this.self=Z,this.actor=new a.C(Z),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(Y,ot)=>{if(this.externalWorkerSourceTypes[Y])throw new Error(`Worker source with name "${Y}" already registered.`);this.externalWorkerSourceTypes[Y]=ot},this.self.addProtocol=a.bf,this.self.removeProtocol=a.bg,this.self.registerRTLTextPlugin=Y=>{if(a.bA.isParsed())throw new Error("RTL text plugin already registered.");a.bA.setMethods(Y)},this.actor.registerMessageHandler("LDT",(Y,ot)=>this._getDEMWorkerSource(Y,ot.source).loadTile(ot)),this.actor.registerMessageHandler("RDT",(Y,ot)=>a._(this,void 0,void 0,function*(){this._getDEMWorkerSource(Y,ot.source).removeTile(ot)})),this.actor.registerMessageHandler("GCEZ",(Y,ot)=>a._(this,void 0,void 0,function*(){return this._getWorkerSource(Y,ot.type,ot.source).getClusterExpansionZoom(ot)})),this.actor.registerMessageHandler("GCC",(Y,ot)=>a._(this,void 0,void 0,function*(){return this._getWorkerSource(Y,ot.type,ot.source).getClusterChildren(ot)})),this.actor.registerMessageHandler("GCL",(Y,ot)=>a._(this,void 0,void 0,function*(){return this._getWorkerSource(Y,ot.type,ot.source).getClusterLeaves(ot)})),this.actor.registerMessageHandler("LD",(Y,ot)=>this._getWorkerSource(Y,ot.type,ot.source).loadData(ot)),this.actor.registerMessageHandler("LT",(Y,ot)=>this._getWorkerSource(Y,ot.type,ot.source).loadTile(ot)),this.actor.registerMessageHandler("RT",(Y,ot)=>this._getWorkerSource(Y,ot.type,ot.source).reloadTile(ot)),this.actor.registerMessageHandler("AT",(Y,ot)=>this._getWorkerSource(Y,ot.type,ot.source).abortTile(ot)),this.actor.registerMessageHandler("RMT",(Y,ot)=>this._getWorkerSource(Y,ot.type,ot.source).removeTile(ot)),this.actor.registerMessageHandler("RS",(Y,ot)=>a._(this,void 0,void 0,function*(){if(!this.workerSources[Y]||!this.workerSources[Y][ot.type]||!this.workerSources[Y][ot.type][ot.source])return;const Et=this.workerSources[Y][ot.type][ot.source];delete this.workerSources[Y][ot.type][ot.source],Et.removeSource!==void 0&&Et.removeSource(ot)})),this.actor.registerMessageHandler("RM",Y=>a._(this,void 0,void 0,function*(){delete this.layerIndexes[Y],delete this.availableImages[Y],delete this.workerSources[Y],delete this.demWorkerSources[Y]})),this.actor.registerMessageHandler("SR",(Y,ot)=>a._(this,void 0,void 0,function*(){this.referrer=ot})),this.actor.registerMessageHandler("SRPS",(Y,ot)=>this._syncRTLPluginState(Y,ot)),this.actor.registerMessageHandler("IS",(Y,ot)=>a._(this,void 0,void 0,function*(){this.self.importScripts(ot)})),this.actor.registerMessageHandler("SI",(Y,ot)=>this._setImages(Y,ot)),this.actor.registerMessageHandler("UL",(Y,ot)=>a._(this,void 0,void 0,function*(){this._getLayerIndex(Y).update(ot.layers,ot.removedIds)})),this.actor.registerMessageHandler("SL",(Y,ot)=>a._(this,void 0,void 0,function*(){this._getLayerIndex(Y).replace(ot)}))}_setImages(Z,Y){return a._(this,void 0,void 0,function*(){this.availableImages[Z]=Y;for(const ot in this.workerSources[Z]){const Et=this.workerSources[Z][ot];for(const kt in Et)Et[kt].availableImages=Y}})}_syncRTLPluginState(Z,Y){return a._(this,void 0,void 0,function*(){if(a.bA.isParsed())return a.bA.getState();if(Y.pluginStatus!=="loading")return a.bA.setState(Y),Y;const ot=Y.pluginURL;if(this.self.importScripts(ot),a.bA.isParsed()){const Et={pluginStatus:"loaded",pluginURL:ot};return a.bA.setState(Et),Et}throw a.bA.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${ot}`)})}_getAvailableImages(Z){let Y=this.availableImages[Z];return Y||(Y=[]),Y}_getLayerIndex(Z){let Y=this.layerIndexes[Z];return Y||(Y=this.layerIndexes[Z]=new o),Y}_getWorkerSource(Z,Y,ot){if(this.workerSources[Z]||(this.workerSources[Z]={}),this.workerSources[Z][Y]||(this.workerSources[Z][Y]={}),!this.workerSources[Z][Y][ot]){const Et={sendAsync:(kt,zt)=>(kt.targetMapId=Z,this.actor.sendAsync(kt,zt))};switch(Y){case"vector":this.workerSources[Z][Y][ot]=new _(Et,this._getLayerIndex(Z),this._getAvailableImages(Z));break;case"geojson":this.workerSources[Z][Y][ot]=new an(Et,this._getLayerIndex(Z),this._getAvailableImages(Z));break;default:this.workerSources[Z][Y][ot]=new this.externalWorkerSourceTypes[Y](Et,this._getLayerIndex(Z),this._getAvailableImages(Z))}}return this.workerSources[Z][Y][ot]}_getDEMWorkerSource(Z,Y){return this.demWorkerSources[Z]||(this.demWorkerSources[Z]={}),this.demWorkerSources[Z][Y]||(this.demWorkerSources[Z][Y]=new x),this.demWorkerSources[Z][Y]}}return a.i(self)&&(self.worker=new $r(self)),$r}),i("index",["exports","./shared"],function(a,o){var A="4.1.3";let f,m;const _={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:C=>new Promise((l,d)=>{const y=requestAnimationFrame(l);C.signal.addEventListener("abort",()=>{cancelAnimationFrame(y),d(o.c())})}),getImageData(C){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return this.getImageCanvasContext(C).getImageData(-l,-l,C.width+2*l,C.height+2*l)},getImageCanvasContext(C){const l=window.document.createElement("canvas"),d=l.getContext("2d",{willReadFrequently:!0});if(!d)throw new Error("failed to create canvas 2d context");return l.width=C.width,l.height=C.height,d.drawImage(C,0,0,C.width,C.height),d},resolveURL:C=>(f||(f=document.createElement("a")),f.href=C,f.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(m==null&&(m=matchMedia("(prefers-reduced-motion: reduce)")),m.matches)}};class x{static testProp(l){if(!x.docStyle)return l[0];for(let d=0;d<l.length;d++)if(l[d]in x.docStyle)return l[d];return l[0]}static create(l,d,y){const v=window.document.createElement(l);return d!==void 0&&(v.className=d),y&&y.appendChild(v),v}static createNS(l,d){return window.document.createElementNS(l,d)}static disableDrag(){x.docStyle&&x.selectProp&&(x.userSelect=x.docStyle[x.selectProp],x.docStyle[x.selectProp]="none")}static enableDrag(){x.docStyle&&x.selectProp&&(x.docStyle[x.selectProp]=x.userSelect)}static setTransform(l,d){l.style[x.transformProp]=d}static addEventListener(l,d,y){let v=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};l.addEventListener(d,y,"passive"in v?v:v.capture)}static removeEventListener(l,d,y){let v=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};l.removeEventListener(d,y,"passive"in v?v:v.capture)}static suppressClickInternal(l){l.preventDefault(),l.stopPropagation(),window.removeEventListener("click",x.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",x.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",x.suppressClickInternal,!0)},0)}static getScale(l){const d=l.getBoundingClientRect();return{x:d.width/l.offsetWidth||1,y:d.height/l.offsetHeight||1,boundingClientRect:d}}static getPoint(l,d,y){const v=d.boundingClientRect;return new o.P((y.clientX-v.left)/d.x-l.clientLeft,(y.clientY-v.top)/d.y-l.clientTop)}static mousePos(l,d){const y=x.getScale(l);return x.getPoint(l,y,d)}static touchPos(l,d){const y=[],v=x.getScale(l);for(let E=0;E<d.length;E++)y.push(x.getPoint(l,v,d[E]));return y}static mouseButton(l){return l.button}static remove(l){l.parentNode&&l.parentNode.removeChild(l)}}x.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,x.selectProp=x.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),x.transformProp=x.testProp(["transform","WebkitTransform"]);const B={supported:!1,testSupport:function(C){!k&&M&&(Q?q(C):P=C)}};let P,M,k=!1,Q=!1;function q(C){const l=C.createTexture();C.bindTexture(C.TEXTURE_2D,l);try{if(C.texImage2D(C.TEXTURE_2D,0,C.RGBA,C.RGBA,C.UNSIGNED_BYTE,M),C.isContextLost())return;B.supported=!0}catch{}C.deleteTexture(l),k=!0}var J;typeof document<"u"&&(M=document.createElement("img"),M.onload=function(){P&&q(P),P=null,Q=!0},M.onerror=function(){k=!0,P=null},M.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(C){let l,d,y,v;C.resetRequestQueue=()=>{l=[],d=0,y=0,v={}},C.addThrottleControl=g=>{const w=y++;return v[w]=g,w},C.removeThrottleControl=g=>{delete v[g],U()},C.getImage=function(g,w){let T=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return new Promise((L,D)=>{B.supported&&(g.headers||(g.headers={}),g.headers.accept="image/webp,*/*"),o.e(g,{type:"image"}),l.push({abortController:w,requestParameters:g,supportImageRefresh:T,state:"queued",onError:H=>{D(H)},onSuccess:H=>{L(H)}}),U()})};const E=g=>o._(this,void 0,void 0,function*(){g.state="running";const{requestParameters:w,supportImageRefresh:T,onError:L,onSuccess:D,abortController:H}=g,z=T===!1&&!o.i(self)&&!o.g(w.url)&&(!w.headers||Object.keys(w.headers).reduce((W,lt)=>W&&lt==="accept",!0));d++;const j=z?R(w,H):o.m(w,H);try{const W=yield j;delete g.abortController,g.state="completed",W.data instanceof HTMLImageElement||o.b(W.data)?D(W):W.data&&D({data:yield(V=W.data,typeof createImageBitmap=="function"?o.d(V):o.f(V)),cacheControl:W.cacheControl,expires:W.expires})}catch(W){delete g.abortController,L(W)}finally{d--,U()}var V}),U=()=>{const g=(()=>{for(const w of Object.keys(v))if(v[w]())return!0;return!1})()?o.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:o.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let w=d;w<g&&l.length>0;w++){const T=l.shift();T.abortController.signal.aborted?w--:E(T)}},R=(g,w)=>new Promise((T,L)=>{const D=new Image,H=g.url,z=g.credentials;z&&z==="include"?D.crossOrigin="use-credentials":(z&&z==="same-origin"||!o.s(H))&&(D.crossOrigin="anonymous"),w.signal.addEventListener("abort",()=>{D.src="",L(o.c())}),D.fetchPriority="high",D.onload=()=>{D.onerror=D.onload=null,T({data:D})},D.onerror=()=>{D.onerror=D.onload=null,w.signal.aborted||L(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},D.src=H})}(J||(J={})),J.resetRequestQueue();class tt{constructor(l){this._transformRequestFn=l}transformRequest(l,d){return this._transformRequestFn&&this._transformRequestFn(l,d)||{url:l}}normalizeSpriteURL(l,d,y){const v=function(E){const U=E.match(ft);if(!U)throw new Error(`Unable to parse URL "${E}"`);return{protocol:U[1],authority:U[2],path:U[3]||"/",params:U[4]?U[4].split("&"):[]}}(l);return v.path+=`${d}${y}`,function(E){const U=E.params.length?`?${E.params.join("&")}`:"";return`${E.protocol}://${E.authority}${E.path}${U}`}(v)}setTransformRequest(l){this._transformRequestFn=l}}const ft=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function pt(C){var l=new o.A(3);return l[0]=C[0],l[1]=C[1],l[2]=C[2],l}var mt,dt=function(C,l,d){return C[0]=l[0]-d[0],C[1]=l[1]-d[1],C[2]=l[2]-d[2],C};mt=new o.A(3),o.A!=Float32Array&&(mt[0]=0,mt[1]=0,mt[2]=0);var Rt=function(C){var l=C[0],d=C[1];return l*l+d*d};function Lt(C){const l=[];if(typeof C=="string")l.push({id:"default",url:C});else if(C&&C.length>0){const d=[];for(const{id:y,url:v}of C){const E=`${y}${v}`;d.indexOf(E)===-1&&(d.push(E),l.push({id:y,url:v}))}}return l}(function(){var C=new o.A(2);o.A!=Float32Array&&(C[0]=0,C[1]=0)})();class st{constructor(l,d,y,v){this.context=l,this.format=y,this.texture=l.gl.createTexture(),this.update(d,v)}update(l,d,y){const{width:v,height:E}=l,U=!(this.size&&this.size[0]===v&&this.size[1]===E||y),{context:R}=this,{gl:g}=R;if(this.useMipmap=!!(d&&d.useMipmap),g.bindTexture(g.TEXTURE_2D,this.texture),R.pixelStoreUnpackFlipY.set(!1),R.pixelStoreUnpack.set(1),R.pixelStoreUnpackPremultiplyAlpha.set(this.format===g.RGBA&&(!d||d.premultiply!==!1)),U)this.size=[v,E],l instanceof HTMLImageElement||l instanceof HTMLCanvasElement||l instanceof HTMLVideoElement||l instanceof ImageData||o.b(l)?g.texImage2D(g.TEXTURE_2D,0,this.format,this.format,g.UNSIGNED_BYTE,l):g.texImage2D(g.TEXTURE_2D,0,this.format,v,E,0,this.format,g.UNSIGNED_BYTE,l.data);else{const{x:w,y:T}=y||{x:0,y:0};l instanceof HTMLImageElement||l instanceof HTMLCanvasElement||l instanceof HTMLVideoElement||l instanceof ImageData||o.b(l)?g.texSubImage2D(g.TEXTURE_2D,0,w,T,g.RGBA,g.UNSIGNED_BYTE,l):g.texSubImage2D(g.TEXTURE_2D,0,w,T,v,E,g.RGBA,g.UNSIGNED_BYTE,l.data)}this.useMipmap&&this.isSizePowerOfTwo()&&g.generateMipmap(g.TEXTURE_2D)}bind(l,d,y){const{context:v}=this,{gl:E}=v;E.bindTexture(E.TEXTURE_2D,this.texture),y!==E.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(y=E.LINEAR),l!==this.filter&&(E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MAG_FILTER,l),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MIN_FILTER,y||l),this.filter=l),d!==this.wrap&&(E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_S,d),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_T,d),this.wrap=d)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:l}=this.context;l.deleteTexture(this.texture),this.texture=null}}function ct(C){const{userImage:l}=C;return!!(l&&l.render&&l.render())&&(C.data.replace(new Uint8Array(l.data.buffer)),!0)}class wt extends o.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(l){if(this.loaded!==l&&(this.loaded=l,l)){for(const{ids:d,promiseResolve:y}of this.requestors)y(this._getImagesForIds(d));this.requestors=[]}}getImage(l){const d=this.images[l];if(d&&!d.data&&d.spriteData){const y=d.spriteData;d.data=new o.R({width:y.width,height:y.height},y.context.getImageData(y.x,y.y,y.width,y.height).data),d.spriteData=null}return d}addImage(l,d){if(this.images[l])throw new Error(`Image id ${l} already exist, use updateImage instead`);this._validate(l,d)&&(this.images[l]=d)}_validate(l,d){let y=!0;const v=d.data||d.spriteData;return this._validateStretch(d.stretchX,v&&v.width)||(this.fire(new o.j(new Error(`Image "${l}" has invalid "stretchX" value`))),y=!1),this._validateStretch(d.stretchY,v&&v.height)||(this.fire(new o.j(new Error(`Image "${l}" has invalid "stretchY" value`))),y=!1),this._validateContent(d.content,d)||(this.fire(new o.j(new Error(`Image "${l}" has invalid "content" value`))),y=!1),y}_validateStretch(l,d){if(!l)return!0;let y=0;for(const v of l){if(v[0]<y||v[1]<v[0]||d<v[1])return!1;y=v[1]}return!0}_validateContent(l,d){if(!l)return!0;if(l.length!==4)return!1;const y=d.spriteData,v=y&&y.width||d.data.width,E=y&&y.height||d.data.height;return!(l[0]<0||v<l[0]||l[1]<0||E<l[1]||l[2]<0||v<l[2]||l[3]<0||E<l[3]||l[2]<l[0]||l[3]<l[1])}updateImage(l,d){let y=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const v=this.getImage(l);if(y&&(v.data.width!==d.data.width||v.data.height!==d.data.height))throw new Error(`size mismatch between old image (${v.data.width}x${v.data.height}) and new image (${d.data.width}x${d.data.height}).`);d.version=v.version+1,this.images[l]=d,this.updatedImages[l]=!0}removeImage(l){const d=this.images[l];delete this.images[l],delete this.patterns[l],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(l){return new Promise((d,y)=>{let v=!0;if(!this.isLoaded())for(const E of l)this.images[E]||(v=!1);this.isLoaded()||v?d(this._getImagesForIds(l)):this.requestors.push({ids:l,promiseResolve:d})})}_getImagesForIds(l){const d={};for(const y of l){let v=this.getImage(y);v||(this.fire(new o.k("styleimagemissing",{id:y})),v=this.getImage(y)),v?d[y]={data:v.data.clone(),pixelRatio:v.pixelRatio,sdf:v.sdf,version:v.version,stretchX:v.stretchX,stretchY:v.stretchY,content:v.content,hasRenderCallback:!!(v.userImage&&v.userImage.render)}:o.w(`Image "${y}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return d}getPixelSize(){const{width:l,height:d}=this.atlasImage;return{width:l,height:d}}getPattern(l){const d=this.patterns[l],y=this.getImage(l);if(!y)return null;if(d&&d.position.version===y.version)return d.position;if(d)d.position.version=y.version;else{const v={w:y.data.width+2,h:y.data.height+2,x:0,y:0},E=new o.I(v,y);this.patterns[l]={bin:v,position:E}}return this._updatePatternAtlas(),this.patterns[l].position}bind(l){const d=l.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new st(l,this.atlasImage,d.RGBA),this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(){const l=[];for(const E in this.patterns)l.push(this.patterns[E].bin);const{w:d,h:y}=o.p(l),v=this.atlasImage;v.resize({width:d||1,height:y||1});for(const E in this.patterns){const{bin:U}=this.patterns[E],R=U.x+1,g=U.y+1,w=this.getImage(E).data,T=w.width,L=w.height;o.R.copy(w,v,{x:0,y:0},{x:R,y:g},{width:T,height:L}),o.R.copy(w,v,{x:0,y:L-1},{x:R,y:g-1},{width:T,height:1}),o.R.copy(w,v,{x:0,y:0},{x:R,y:g+L},{width:T,height:1}),o.R.copy(w,v,{x:T-1,y:0},{x:R-1,y:g},{width:1,height:L}),o.R.copy(w,v,{x:0,y:0},{x:R+T,y:g},{width:1,height:L})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(l){for(const d of l){if(this.callbackDispatchedThisFrame[d])continue;this.callbackDispatchedThisFrame[d]=!0;const y=this.getImage(d);y||o.w(`Image with ID: "${d}" was not found`),ct(y)&&this.updateImage(d,y)}}}const yt=1e20;function te(C,l,d,y,v,E,U,R,g){for(let w=l;w<l+y;w++)Zt(C,d*E+w,E,v,U,R,g);for(let w=d;w<d+v;w++)Zt(C,w*E+l,1,y,U,R,g)}function Zt(C,l,d,y,v,E,U){E[0]=0,U[0]=-yt,U[1]=yt,v[0]=C[l];for(let R=1,g=0,w=0;R<y;R++){v[R]=C[l+R*d];const T=R*R;do{const L=E[g];w=(v[R]-v[L]+T-L*L)/(R-L)/2}while(w<=U[g]&&--g>-1);g++,E[g]=R,U[g]=w,U[g+1]=yt}for(let R=0,g=0;R<y;R++){for(;U[g+1]<R;)g++;const w=E[g],T=R-w;C[l+R*d]=v[w]+T*T}}class re{constructor(l,d){this.requestManager=l,this.localIdeographFontFamily=d,this.entries={}}setURL(l){this.url=l}getGlyphs(l){return o._(this,void 0,void 0,function*(){const d=[];for(const E in l)for(const U of l[E])d.push(this._getAndCacheGlyphsPromise(E,U));const y=yield Promise.all(d),v={};for(const{stack:E,id:U,glyph:R}of y)v[E]||(v[E]={}),v[E][U]=R&&{id:R.id,bitmap:R.bitmap.clone(),metrics:R.metrics};return v})}_getAndCacheGlyphsPromise(l,d){return o._(this,void 0,void 0,function*(){let y=this.entries[l];y||(y=this.entries[l]={glyphs:{},requests:{},ranges:{}});let v=y.glyphs[d];if(v!==void 0)return{stack:l,id:d,glyph:v};if(v=this._tinySDF(y,l,d),v)return y.glyphs[d]=v,{stack:l,id:d,glyph:v};const E=Math.floor(d/256);if(256*E>65535)throw new Error("glyphs > 65535 not supported");if(y.ranges[E])return{stack:l,id:d,glyph:v};if(!this.url)throw new Error("glyphsUrl is not set");if(!y.requests[E]){const R=re.loadGlyphRange(l,E,this.url,this.requestManager);y.requests[E]=R}const U=yield y.requests[E];for(const R in U)this._doesCharSupportLocalGlyph(+R)||(y.glyphs[+R]=U[+R]);return y.ranges[E]=!0,{stack:l,id:d,glyph:U[d]||null}})}_doesCharSupportLocalGlyph(l){return!!this.localIdeographFontFamily&&(o.u["CJK Unified Ideographs"](l)||o.u["Hangul Syllables"](l)||o.u.Hiragana(l)||o.u.Katakana(l))}_tinySDF(l,d,y){const v=this.localIdeographFontFamily;if(!v||!this._doesCharSupportLocalGlyph(y))return;let E=l.tinySDF;if(!E){let R="400";/bold/i.test(d)?R="900":/medium/i.test(d)?R="500":/light/i.test(d)&&(R="200"),E=l.tinySDF=new re.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:v,fontWeight:R})}const U=E.draw(String.fromCharCode(y));return{id:y,bitmap:new o.o({width:U.width||60,height:U.height||60},U.data),metrics:{width:U.glyphWidth/2||24,height:U.glyphHeight/2||24,left:U.glyphLeft/2+.5||0,top:U.glyphTop/2-27.5||-8,advance:U.glyphAdvance/2||24,isDoubleResolution:!0}}}}re.loadGlyphRange=function(C,l,d,y){return o._(this,void 0,void 0,function*(){const v=256*l,E=v+255,U=y.transformRequest(d.replace("{fontstack}",C).replace("{range}",`${v}-${E}`),"Glyphs"),R=yield o.l(U,new AbortController);if(!R||!R.data)throw new Error(`Could not load glyph range. range: ${l}, ${v}-${E}`);const g={};for(const w of o.n(R.data))g[w.id]=w;return g})},re.TinySDF=class{constructor(){let{fontSize:C=24,buffer:l=3,radius:d=8,cutoff:y=.25,fontFamily:v="sans-serif",fontWeight:E="normal",fontStyle:U="normal"}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.buffer=l,this.cutoff=y,this.radius=d;const R=this.size=C+4*l,g=this._createCanvas(R),w=this.ctx=g.getContext("2d",{willReadFrequently:!0});w.font=`${U} ${E} ${C}px ${v}`,w.textBaseline="alphabetic",w.textAlign="left",w.fillStyle="black",this.gridOuter=new Float64Array(R*R),this.gridInner=new Float64Array(R*R),this.f=new Float64Array(R),this.z=new Float64Array(R+1),this.v=new Uint16Array(R)}_createCanvas(C){const l=document.createElement("canvas");return l.width=l.height=C,l}draw(C){const{width:l,actualBoundingBoxAscent:d,actualBoundingBoxDescent:y,actualBoundingBoxLeft:v,actualBoundingBoxRight:E}=this.ctx.measureText(C),U=Math.ceil(d),R=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(E-v))),g=Math.min(this.size-this.buffer,U+Math.ceil(y)),w=R+2*this.buffer,T=g+2*this.buffer,L=Math.max(w*T,0),D=new Uint8ClampedArray(L),H={data:D,width:w,height:T,glyphWidth:R,glyphHeight:g,glyphTop:U,glyphLeft:0,glyphAdvance:l};if(R===0||g===0)return H;const{ctx:z,buffer:j,gridInner:V,gridOuter:W}=this;z.clearRect(j,j,R,g),z.fillText(C,j,j+U);const lt=z.getImageData(j,j,R,g);W.fill(yt,0,L),V.fill(0,0,L);for(let rt=0;rt<g;rt++)for(let ht=0;ht<R;ht++){const gt=lt.data[4*(rt*R+ht)+3]/255;if(gt===0)continue;const Mt=(rt+j)*w+ht+j;if(gt===1)W[Mt]=0,V[Mt]=yt;else{const Tt=.5-gt;W[Mt]=Tt>0?Tt*Tt:0,V[Mt]=Tt<0?Tt*Tt:0}}te(W,0,0,w,T,w,this.f,this.v,this.z),te(V,j,j,R,g,w,this.f,this.v,this.z);for(let rt=0;rt<L;rt++){const ht=Math.sqrt(W[rt])-Math.sqrt(V[rt]);D[rt]=Math.round(255-255*(ht/this.radius+this.cutoff))}return H}};class Xt{constructor(){this.specification=o.v.light.position}possiblyEvaluate(l,d){return o.y(l.expression.evaluate(d))}interpolate(l,d,y){return{x:o.z.number(l.x,d.x,y),y:o.z.number(l.y,d.y,y),z:o.z.number(l.z,d.z,y)}}}let ne;class se extends o.E{constructor(l){super(),ne=ne||new o.q({anchor:new o.D(o.v.light.anchor),position:new Xt,color:new o.D(o.v.light.color),intensity:new o.D(o.v.light.intensity)}),this._transitionable=new o.T(ne),this.setLight(l),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(l){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!this._validate(o.r,l,d))for(const y in l){const v=l[y];y.endsWith("-transition")?this._transitionable.setTransition(y.slice(0,-11),v):this._transitionable.setValue(y,v)}}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,d,y){return(!y||y.validate!==!1)&&o.t(this,l.call(o.x,{value:d,style:{glyphs:!0,sprite:!0},styleSpec:o.v}))}}class we{constructor(l,d){this.width=l,this.height=d,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(l,d){const y=l.join(",")+String(d);return this.dashEntry[y]||(this.dashEntry[y]=this.addDash(l,d)),this.dashEntry[y]}getDashRanges(l,d,y){const v=[];let E=l.length%2==1?-l[l.length-1]*y:0,U=l[0]*y,R=!0;v.push({left:E,right:U,isDash:R,zeroLength:l[0]===0});let g=l[0];for(let w=1;w<l.length;w++){R=!R;const T=l[w];E=g*y,g+=T,U=g*y,v.push({left:E,right:U,isDash:R,zeroLength:T===0})}return v}addRoundDash(l,d,y){const v=d/2;for(let E=-y;E<=y;E++){const U=this.width*(this.nextRow+y+E);let R=0,g=l[R];for(let w=0;w<this.width;w++){w/g.right>1&&(g=l[++R]);const T=Math.abs(w-g.left),L=Math.abs(w-g.right),D=Math.min(T,L);let H;const z=E/y*(v+1);if(g.isDash){const j=v-Math.abs(z);H=Math.sqrt(D*D+j*j)}else H=v-Math.sqrt(D*D+z*z);this.data[U+w]=Math.max(0,Math.min(255,H+128))}}}addRegularDash(l){for(let R=l.length-1;R>=0;--R){const g=l[R],w=l[R+1];g.zeroLength?l.splice(R,1):w&&w.isDash===g.isDash&&(w.left=g.left,l.splice(R,1))}const d=l[0],y=l[l.length-1];d.isDash===y.isDash&&(d.left=y.left-this.width,y.right=d.right+this.width);const v=this.width*this.nextRow;let E=0,U=l[E];for(let R=0;R<this.width;R++){R/U.right>1&&(U=l[++E]);const g=Math.abs(R-U.left),w=Math.abs(R-U.right),T=Math.min(g,w);this.data[v+R]=Math.max(0,Math.min(255,(U.isDash?T:-T)+128))}}addDash(l,d){const y=d?7:0,v=2*y+1;if(this.nextRow+v>this.height)return o.w("LineAtlas out of space"),null;let E=0;for(let R=0;R<l.length;R++)E+=l[R];if(E!==0){const R=this.width/E,g=this.getDashRanges(l,this.width,R);d?this.addRoundDash(g,R,y):this.addRegularDash(g)}const U={y:(this.nextRow+y+.5)/this.height,height:2*y/this.height,width:E};return this.nextRow+=v,this.dirty=!0,U}bind(l){const d=l.gl;this.texture?(d.bindTexture(d.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,d.texSubImage2D(d.TEXTURE_2D,0,0,0,this.width,this.height,d.ALPHA,d.UNSIGNED_BYTE,this.data))):(this.texture=d.createTexture(),d.bindTexture(d.TEXTURE_2D,this.texture),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texImage2D(d.TEXTURE_2D,0,d.ALPHA,this.width,this.height,0,d.ALPHA,d.UNSIGNED_BYTE,this.data))}}const it="maplibre_preloaded_worker_pool";class vt{constructor(){this.active={}}acquire(l){if(!this.workers)for(this.workers=[];this.workers.length<vt.workerCount;)this.workers.push(new Worker(o.a.WORKER_URL));return this.active[l]=!0,this.workers.slice()}release(l){delete this.active[l],this.numActive()===0&&(this.workers.forEach(d=>{d.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[it]}numActive(){return Object.keys(this.active).length}}const Ft=Math.floor(_.hardwareConcurrency/2);let Ot,$t;function jt(){return Ot||(Ot=new vt),Ot}vt.workerCount=o.B(globalThis)?Math.max(Math.min(Ft,3),1):1;class ae{constructor(l,d){this.workerPool=l,this.actors=[],this.currentActor=0,this.id=d;const y=this.workerPool.acquire(d);for(let v=0;v<y.length;v++){const E=new o.C(y[v],d);E.name=`Worker ${v}`,this.actors.push(E)}if(!this.actors.length)throw new Error("No actors found")}broadcast(l,d){const y=[];for(const v of this.actors)y.push(v.sendAsync({type:l,data:d}));return Promise.all(y)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.actors.forEach(d=>{d.remove()}),this.actors=[],l&&this.workerPool.release(this.id)}registerMessageHandler(l,d){for(const y of this.actors)y.registerMessageHandler(l,d)}}function ie(){return $t||($t=new ae(jt(),o.G),$t.registerMessageHandler("GR",(C,l,d)=>o.m(l,d))),$t}function Be(C,l){const d=o.F();return o.H(d,d,[1,1,0]),o.J(d,d,[.5*C.width,.5*C.height,1]),o.K(d,d,C.calculatePosMatrix(l.toUnwrapped()))}function Ie(C,l,d,y,v,E){const U=function(L,D,H){if(L)for(const z of L){const j=D[z];if(j&&j.source===H&&j.type==="fill-extrusion")return!0}else for(const z in D){const j=D[z];if(j.source===H&&j.type==="fill-extrusion")return!0}return!1}(v&&v.layers,l,C.id),R=E.maxPitchScaleFactor(),g=C.tilesIn(y,R,U);g.sort(Qe);const w=[];for(const L of g)w.push({wrappedTileID:L.tileID.wrapped().key,queryResults:L.tile.queryRenderedFeatures(l,d,C._state,L.queryGeometry,L.cameraQueryGeometry,L.scale,v,E,R,Be(C.transform,L.tileID))});const T=function(L){const D={},H={};for(const z of L){const j=z.queryResults,V=z.wrappedTileID,W=H[V]=H[V]||{};for(const lt in j){const rt=j[lt],ht=W[lt]=W[lt]||{},gt=D[lt]=D[lt]||[];for(const Mt of rt)ht[Mt.featureIndex]||(ht[Mt.featureIndex]=!0,gt.push(Mt))}}return D}(w);for(const L in T)T[L].forEach(D=>{const H=D.feature,z=C.getFeatureState(H.layer["source-layer"],H.id);H.source=H.layer.source,H.layer["source-layer"]&&(H.sourceLayer=H.layer["source-layer"]),H.state=z});return T}function Qe(C,l){const d=C.tileID,y=l.tileID;return d.overscaledZ-y.overscaledZ||d.canonical.y-y.canonical.y||d.wrap-y.wrap||d.canonical.x-y.canonical.x}function He(C,l,d){return o._(this,void 0,void 0,function*(){let y=C;if(C.url?y=(yield o.h(l.transformRequest(C.url,"Source"),d)).data:yield _.frameAsync(d),!y)return null;const v=o.L(o.e(y,C),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in y&&y.vector_layers&&(v.vectorLayerIds=y.vector_layers.map(E=>E.id)),v})}class ze{constructor(l,d){l&&(d?this.setSouthWest(l).setNorthEast(d):Array.isArray(l)&&(l.length===4?this.setSouthWest([l[0],l[1]]).setNorthEast([l[2],l[3]]):this.setSouthWest(l[0]).setNorthEast(l[1])))}setNorthEast(l){return this._ne=l instanceof o.M?new o.M(l.lng,l.lat):o.M.convert(l),this}setSouthWest(l){return this._sw=l instanceof o.M?new o.M(l.lng,l.lat):o.M.convert(l),this}extend(l){const d=this._sw,y=this._ne;let v,E;if(l instanceof o.M)v=l,E=l;else{if(!(l instanceof ze))return Array.isArray(l)?l.length===4||l.every(Array.isArray)?this.extend(ze.convert(l)):this.extend(o.M.convert(l)):l&&("lng"in l||"lon"in l)&&"lat"in l?this.extend(o.M.convert(l)):this;if(v=l._sw,E=l._ne,!v||!E)return this}return d||y?(d.lng=Math.min(v.lng,d.lng),d.lat=Math.min(v.lat,d.lat),y.lng=Math.max(E.lng,y.lng),y.lat=Math.max(E.lat,y.lat)):(this._sw=new o.M(v.lng,v.lat),this._ne=new o.M(E.lng,E.lat)),this}getCenter(){return new o.M((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new o.M(this.getWest(),this.getNorth())}getSouthEast(){return new o.M(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(l){const{lng:d,lat:y}=o.M.convert(l);let v=this._sw.lng<=d&&d<=this._ne.lng;return this._sw.lng>this._ne.lng&&(v=this._sw.lng>=d&&d>=this._ne.lng),this._sw.lat<=y&&y<=this._ne.lat&&v}static convert(l){return l instanceof ze?l:l&&new ze(l)}static fromLngLat(l){const y=360*(arguments.length>1&&arguments[1]!==void 0?arguments[1]:0)/40075017,v=y/Math.cos(Math.PI/180*l.lat);return new ze(new o.M(l.lng-v,l.lat-y),new o.M(l.lng+v,l.lat+y))}}class ge{constructor(l,d,y){this.bounds=ze.convert(this.validateBounds(l)),this.minzoom=d||0,this.maxzoom=y||24}validateBounds(l){return Array.isArray(l)&&l.length===4?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]}contains(l){const d=Math.pow(2,l.z),y=Math.floor(o.N(this.bounds.getWest())*d),v=Math.floor(o.O(this.bounds.getNorth())*d),E=Math.ceil(o.N(this.bounds.getEast())*d),U=Math.ceil(o.O(this.bounds.getSouth())*d);return l.x>=y&&l.x<E&&l.y>=v&&l.y<U}}class Ut extends o.E{constructor(l,d,y,v){if(super(),this.id=l,this.dispatcher=y,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.e(this,o.L(d,["url","scheme","tileSize","promoteId"])),this._options=o.e({type:"vector"},d),this._collectResourceTiming=d.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(v)}load(){return o._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new o.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const l=yield He(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),l&&(o.e(this,l),l.bounds&&(this.tileBounds=new ge(l.bounds,this.minzoom,this.maxzoom)),this.fire(new o.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.k("data",{dataType:"source",sourceDataType:"content"})))}catch(l){this._tileJSONRequest=null,this.fire(new o.j(l))}})}loaded(){return this._loaded}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}onAdd(l){this.map=l,this.load()}setSourceProperty(l){this._tileJSONRequest&&this._tileJSONRequest.abort(),l(),this.load()}setTiles(l){return this.setSourceProperty(()=>{this._options.tiles=l}),this}setUrl(l){return this.setSourceProperty(()=>{this.url=l,this._options.url=l}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return o.e({},this._options)}loadTile(l){return o._(this,void 0,void 0,function*(){const d=l.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),y={request:this.map._requestManager.transformRequest(d,"Tile"),uid:l.uid,tileID:l.tileID,zoom:l.tileID.overscaledZ,tileSize:this.tileSize*l.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};y.request.collectResourceTiming=this._collectResourceTiming;let v="RT";if(l.actor&&l.state!=="expired"){if(l.state==="loading")return new Promise((E,U)=>{l.reloadPromise={resolve:E,reject:U}})}else l.actor=this.dispatcher.getActor(),v="LT";l.abortController=new AbortController;try{const E=yield l.actor.sendAsync({type:v,data:y},l.abortController);if(delete l.abortController,l.aborted)return;this._afterTileLoadWorkerResponse(l,E)}catch(E){if(delete l.abortController,l.aborted)return;if(E&&E.status!==404)throw E;this._afterTileLoadWorkerResponse(l,null)}})}_afterTileLoadWorkerResponse(l,d){if(d&&d.resourceTiming&&(l.resourceTiming=d.resourceTiming),d&&this.map._refreshExpiredTiles&&l.setExpiryData(d),l.loadVectorData(d,this.map.painter),l.reloadPromise){const y=l.reloadPromise;l.reloadPromise=null,this.loadTile(l).then(y.resolve).catch(y.reject)}}abortTile(l){return o._(this,void 0,void 0,function*(){l.abortController&&(l.abortController.abort(),delete l.abortController),l.actor&&(yield l.actor.sendAsync({type:"AT",data:{uid:l.uid,type:this.type,source:this.id}}))})}unloadTile(l){return o._(this,void 0,void 0,function*(){l.unloadVectorData(),l.actor&&(yield l.actor.sendAsync({type:"RMT",data:{uid:l.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Jt extends o.E{constructor(l,d,y,v){super(),this.id=l,this.dispatcher=y,this.setEventedParent(v),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.e({type:"raster"},d),o.e(this,o.L(d,["url","scheme","tileSize"]))}load(){return o._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new o.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const l=yield He(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,l&&(o.e(this,l),l.bounds&&(this.tileBounds=new ge(l.bounds,this.minzoom,this.maxzoom)),this.fire(new o.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.k("data",{dataType:"source",sourceDataType:"content"})))}catch(l){this._tileJSONRequest=null,this.fire(new o.j(l))}})}loaded(){return this._loaded}onAdd(l){this.map=l,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(l){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),l(),this.load()}setTiles(l){return this.setSourceProperty(()=>{this._options.tiles=l}),this}setUrl(l){return this.setSourceProperty(()=>{this.url=l,this._options.url=l}),this}serialize(){return o.e({},this._options)}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}loadTile(l){return o._(this,void 0,void 0,function*(){const d=l.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);l.abortController=new AbortController;try{const y=yield J.getImage(this.map._requestManager.transformRequest(d,"Tile"),l.abortController,this.map._refreshExpiredTiles);if(delete l.abortController,l.aborted)return void(l.state="unloaded");if(y&&y.data){this.map._refreshExpiredTiles&&y.cacheControl&&y.expires&&l.setExpiryData({cacheControl:y.cacheControl,expires:y.expires});const v=this.map.painter.context,E=v.gl,U=y.data;l.texture=this.map.painter.getTileTexture(U.width),l.texture?l.texture.update(U,{useMipmap:!0}):(l.texture=new st(v,U,E.RGBA,{useMipmap:!0}),l.texture.bind(E.LINEAR,E.CLAMP_TO_EDGE,E.LINEAR_MIPMAP_NEAREST),v.extTextureFilterAnisotropic&&E.texParameterf(E.TEXTURE_2D,v.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,v.extTextureFilterAnisotropicMax)),l.state="loaded"}}catch(y){if(delete l.abortController,l.aborted)l.state="unloaded";else if(y)throw l.state="errored",y}})}abortTile(l){return o._(this,void 0,void 0,function*(){l.abortController&&(l.abortController.abort(),delete l.abortController)})}unloadTile(l){return o._(this,void 0,void 0,function*(){l.texture&&this.map.painter.saveTileTexture(l.texture)})}hasTransition(){return!1}}class er extends Jt{constructor(l,d,y,v){super(l,d,y,v),this.type="raster-dem",this.maxzoom=22,this._options=o.e({type:"raster-dem"},d),this.encoding=d.encoding||"mapbox",this.redFactor=d.redFactor,this.greenFactor=d.greenFactor,this.blueFactor=d.blueFactor,this.baseShift=d.baseShift}loadTile(l){return o._(this,void 0,void 0,function*(){const d=l.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),y=this.map._requestManager.transformRequest(d,"Tile");l.neighboringTiles=this._getNeighboringTiles(l.tileID),l.abortController=new AbortController;try{const v=yield J.getImage(y,l.abortController,this.map._refreshExpiredTiles);if(delete l.abortController,l.aborted)return void(l.state="unloaded");if(v&&v.data){const E=v.data;this.map._refreshExpiredTiles&&v.cacheControl&&v.expires&&l.setExpiryData({cacheControl:v.cacheControl,expires:v.expires});const U=o.b(E)&&o.S()?E:yield this.readImageNow(E),R={type:this.type,uid:l.uid,source:this.id,rawImageData:U,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!l.actor||l.state==="expired"){l.actor=this.dispatcher.getActor();const g=yield l.actor.sendAsync({type:"LDT",data:R});l.dem=g,l.needsHillshadePrepare=!0,l.needsTerrainPrepare=!0,l.state="loaded"}}}catch(v){if(delete l.abortController,l.aborted)l.state="unloaded";else if(v)throw l.state="errored",v}})}readImageNow(l){return o._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&o.U()){const d=l.width+2,y=l.height+2;try{return new o.R({width:d,height:y},yield o.V(l,-1,-1,d,y))}catch{}}return _.getImageData(l,1)})}_getNeighboringTiles(l){const d=l.canonical,y=Math.pow(2,d.z),v=(d.x-1+y)%y,E=d.x===0?l.wrap-1:l.wrap,U=(d.x+1+y)%y,R=d.x+1===y?l.wrap+1:l.wrap,g={};return g[new o.Q(l.overscaledZ,E,d.z,v,d.y).key]={backfilled:!1},g[new o.Q(l.overscaledZ,R,d.z,U,d.y).key]={backfilled:!1},d.y>0&&(g[new o.Q(l.overscaledZ,E,d.z,v,d.y-1).key]={backfilled:!1},g[new o.Q(l.overscaledZ,l.wrap,d.z,d.x,d.y-1).key]={backfilled:!1},g[new o.Q(l.overscaledZ,R,d.z,U,d.y-1).key]={backfilled:!1}),d.y+1<y&&(g[new o.Q(l.overscaledZ,E,d.z,v,d.y+1).key]={backfilled:!1},g[new o.Q(l.overscaledZ,l.wrap,d.z,d.x,d.y+1).key]={backfilled:!1},g[new o.Q(l.overscaledZ,R,d.z,U,d.y+1).key]={backfilled:!1}),g}unloadTile(l){return o._(this,void 0,void 0,function*(){l.demTexture&&this.map.painter.saveTileTexture(l.demTexture),l.fbo&&(l.fbo.destroy(),delete l.fbo),l.dem&&delete l.dem,delete l.neighboringTiles,l.state="unloaded",l.actor&&(yield l.actor.sendAsync({type:"RDT",data:{type:this.type,uid:l.uid,source:this.id}}))})}}class Se extends o.E{constructor(l,d,y,v){super(),this.id=l,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=y.getActor(),this.setEventedParent(v),this._data=d.data,this._options=o.e({},d),this._collectResourceTiming=d.collectResourceTiming,d.maxzoom!==void 0&&(this.maxzoom=d.maxzoom),d.type&&(this.type=d.type),d.attribution&&(this.attribution=d.attribution),this.promoteId=d.promoteId;const E=o.W/this.tileSize;this.workerOptions=o.e({source:this.id,cluster:d.cluster||!1,geojsonVtOptions:{buffer:(d.buffer!==void 0?d.buffer:128)*E,tolerance:(d.tolerance!==void 0?d.tolerance:.375)*E,extent:o.W,maxZoom:this.maxzoom,lineMetrics:d.lineMetrics||!1,generateId:d.generateId||!1},superclusterOptions:{maxZoom:d.clusterMaxZoom!==void 0?d.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,d.clusterMinPoints||2),extent:o.W,radius:(d.clusterRadius||50)*E,log:!1,generateId:d.generateId||!1},clusterProperties:d.clusterProperties,filter:d.filter},d.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return o._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(l){this.map=l,this.load()}setData(l){return this._data=l,this._updateWorkerData(),this}updateData(l){return this._updateWorkerData(l),this}setClusterOptions(l){return this.workerOptions.cluster=l.cluster,l&&(l.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=l.clusterRadius),l.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=l.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(l){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:l,source:this.id}})}getClusterChildren(l){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:l,source:this.id}})}getClusterLeaves(l,d,y){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:l,limit:d,offset:y}})}_updateWorkerData(l){return o._(this,void 0,void 0,function*(){const d=o.e({type:this.type},this.workerOptions);l?d.dataDiff=l:typeof this._data=="string"?(d.request=this.map._requestManager.transformRequest(_.resolveURL(this._data),"Source"),d.request.collectResourceTiming=this._collectResourceTiming):d.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new o.k("dataloading",{dataType:"source"}));try{const y=yield this.actor.sendAsync({type:"LD",data:d});if(this._pendingLoads--,this._removed||y.abandoned)return void this.fire(new o.k("dataabort",{dataType:"source"}));let v=null;y.resourceTiming&&y.resourceTiming[this.id]&&(v=y.resourceTiming[this.id].slice(0));const E={dataType:"source"};this._collectResourceTiming&&v&&v.length>0&&o.e(E,{resourceTiming:v}),this.fire(new o.k("data",Object.assign(Object.assign({},E),{sourceDataType:"metadata"}))),this.fire(new o.k("data",Object.assign(Object.assign({},E),{sourceDataType:"content"})))}catch(y){if(this._pendingLoads--,this._removed)return void this.fire(new o.k("dataabort",{dataType:"source"}));this.fire(new o.j(y))}})}loaded(){return this._pendingLoads===0}loadTile(l){return o._(this,void 0,void 0,function*(){const d=l.actor?"RT":"LT";l.actor=this.actor;const y={type:this.type,uid:l.uid,tileID:l.tileID,zoom:l.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};l.abortController=new AbortController;const v=yield this.actor.sendAsync({type:d,data:y},l.abortController);delete l.abortController,l.unloadVectorData(),l.aborted||l.loadVectorData(v,this.map.painter,d==="RT")})}abortTile(l){return o._(this,void 0,void 0,function*(){l.abortController&&(l.abortController.abort(),delete l.abortController),l.aborted=!0})}unloadTile(l){return o._(this,void 0,void 0,function*(){l.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:l.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return o.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var _e=o.X([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class xe extends o.E{constructor(l,d,y,v){super(),this.id=l,this.dispatcher=y,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(v),this.options=d}load(l){return o._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new o.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const d=yield J.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,d&&d.data&&(this.image=d.data,l&&(this.coordinates=l),this._finishLoading())}catch(d){this._request=null,this._loaded=!0,this.fire(new o.j(d))}})}loaded(){return this._loaded}updateImage(l){return l.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=l.url,this.load(l.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(l){this.map=l,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(l){this.coordinates=l;const d=l.map(o.Y.fromLngLat);this.tileID=function(v){let E=1/0,U=1/0,R=-1/0,g=-1/0;for(const D of v)E=Math.min(E,D.x),U=Math.min(U,D.y),R=Math.max(R,D.x),g=Math.max(g,D.y);const w=Math.max(R-E,g-U),T=Math.max(0,Math.floor(-Math.log(w)/Math.LN2)),L=Math.pow(2,T);return new o.a0(T,Math.floor((E+R)/2*L),Math.floor((U+g)/2*L))}(d),this.minzoom=this.maxzoom=this.tileID.z;const y=d.map(v=>this.tileID.getTilePoint(v)._round());return this._boundsArray=new o.Z,this._boundsArray.emplaceBack(y[0].x,y[0].y,0,0),this._boundsArray.emplaceBack(y[1].x,y[1].y,o.W,0),this._boundsArray.emplaceBack(y[3].x,y[3].y,0,o.W),this._boundsArray.emplaceBack(y[2].x,y[2].y,o.W,o.W),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new o.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const l=this.map.painter.context,d=l.gl;this.boundsBuffer||(this.boundsBuffer=l.createVertexBuffer(this._boundsArray,_e.members)),this.boundsSegments||(this.boundsSegments=o.$.simpleSegment(0,0,4,2)),this.texture||(this.texture=new st(l,this.image,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE));let y=!1;for(const v in this.tiles){const E=this.tiles[v];E.state!=="loaded"&&(E.state="loaded",E.texture=this.texture,y=!0)}y&&this.fire(new o.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(l){return o._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(l.tileID.canonical)?(this.tiles[String(l.tileID.wrap)]=l,l.buckets={}):l.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Ne extends xe{constructor(l,d,y,v){super(l,d,y,v),this.roundZoom=!0,this.type="video",this.options=d}load(){return o._(this,void 0,void 0,function*(){this._loaded=!1;const l=this.options;this.urls=[];for(const d of l.urls)this.urls.push(this.map._requestManager.transformRequest(d,"Source").url);try{const d=yield o.a2(this.urls);if(this._loaded=!0,!d)return;this.video=d,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(d){this.fire(new o.j(d))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(l){if(this.video){const d=this.video.seekable;l<d.start(0)||l>d.end(0)?this.fire(new o.j(new o.a1(`sources.${this.id}`,null,`Playback for this video can be set only between the ${d.start(0)} and ${d.end(0)}-second mark.`))):this.video.currentTime=l}}getVideo(){return this.video}onAdd(l){this.map||(this.map=l,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const l=this.map.painter.context,d=l.gl;this.boundsBuffer||(this.boundsBuffer=l.createVertexBuffer(this._boundsArray,_e.members)),this.boundsSegments||(this.boundsSegments=o.$.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE),d.texSubImage2D(d.TEXTURE_2D,0,0,0,d.RGBA,d.UNSIGNED_BYTE,this.video)):(this.texture=new st(l,this.video,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE));let y=!1;for(const v in this.tiles){const E=this.tiles[v];E.state!=="loaded"&&(E.state="loaded",E.texture=this.texture,y=!0)}y&&this.fire(new o.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class ir extends xe{constructor(l,d,y,v){super(l,d,y,v),d.coordinates?Array.isArray(d.coordinates)&&d.coordinates.length===4&&!d.coordinates.some(E=>!Array.isArray(E)||E.length!==2||E.some(U=>typeof U!="number"))||this.fire(new o.j(new o.a1(`sources.${l}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.j(new o.a1(`sources.${l}`,null,'missing required property "coordinates"'))),d.animate&&typeof d.animate!="boolean"&&this.fire(new o.j(new o.a1(`sources.${l}`,null,'optional "animate" property must be a boolean value'))),d.canvas?typeof d.canvas=="string"||d.canvas instanceof HTMLCanvasElement||this.fire(new o.j(new o.a1(`sources.${l}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.j(new o.a1(`sources.${l}`,null,'missing required property "canvas"'))),this.options=d,this.animate=d.animate===void 0||d.animate}load(){return o._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(l){this.map=l,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let l=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,l=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,l=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const d=this.map.painter.context,y=d.gl;this.boundsBuffer||(this.boundsBuffer=d.createVertexBuffer(this._boundsArray,_e.members)),this.boundsSegments||(this.boundsSegments=o.$.simpleSegment(0,0,4,2)),this.texture?(l||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new st(d,this.canvas,y.RGBA,{premultiply:!0});let v=!1;for(const E in this.tiles){const U=this.tiles[E];U.state!=="loaded"&&(U.state="loaded",U.texture=this.texture,v=!0)}v&&this.fire(new o.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const l of[this.canvas.width,this.canvas.height])if(isNaN(l)||l<=0)return!0;return!1}}const Ar={},Lr=C=>{switch(C){case"geojson":return Se;case"image":return xe;case"raster":return Jt;case"raster-dem":return er;case"vector":return Ut;case"video":return Ne;case"canvas":return ir}return Ar[C]},Tr="RTLPluginLoaded";class Nr extends o.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=ie()}_syncState(l){return this.status=l,this.dispatcher.broadcast("SRPS",{pluginStatus:l,pluginURL:this.url}).catch(d=>{throw this.status="error",d})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(l){return o._(this,arguments,void 0,function(d){var y=this;let v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return function*(){if(y.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(y.url=_.resolveURL(d),!y.url)throw new Error(`requested url ${d} is invalid`);if(y.status==="unavailable"){if(!v)return y._requestImport();y.status="deferred",y._syncState(y.status)}else if(y.status==="requested")return y._requestImport()}()})}_requestImport(){return o._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new o.k(Tr))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Qr=null;function fe(){return Qr||(Qr=new Nr),Qr}class Ir{constructor(l,d){this.timeAdded=0,this.fadeEndTime=0,this.tileID=l,this.uid=o.a3(),this.uses=0,this.tileSize=d,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(l){const d=l+this.timeAdded;d<this.fadeEndTime||(this.fadeEndTime=d)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(l){this.demTexture&&l.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(l,d,y){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",l){l.featureIndex&&(this.latestFeatureIndex=l.featureIndex,l.rawTileData?(this.latestRawTileData=l.rawTileData,this.latestFeatureIndex.rawTileData=l.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=l.collisionBoxArray,this.buckets=function(v,E){const U={};if(!E)return U;for(const R of v){const g=R.layerIds.map(w=>E.getLayer(w)).filter(Boolean);if(g.length!==0){R.layers=g,R.stateDependentLayerIds&&(R.stateDependentLayers=R.stateDependentLayerIds.map(w=>g.filter(T=>T.id===w)[0]));for(const w of g)U[w.id]=R}}return U}(l.buckets,d.style),this.hasSymbolBuckets=!1;for(const v in this.buckets){const E=this.buckets[v];if(E instanceof o.a5){if(this.hasSymbolBuckets=!0,!y)break;E.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const v in this.buckets){const E=this.buckets[v];if(E instanceof o.a5&&E.hasRTLText){this.hasRTLText=!0,fe().lazyLoad();break}}this.queryPadding=0;for(const v in this.buckets){const E=this.buckets[v];this.queryPadding=Math.max(this.queryPadding,d.style.getLayer(v).queryRadius(E))}l.imageAtlas&&(this.imageAtlas=l.imageAtlas),l.glyphAtlasImage&&(this.glyphAtlasImage=l.glyphAtlasImage)}else this.collisionBoxArray=new o.a4}unloadVectorData(){for(const l in this.buckets)this.buckets[l].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(l){return this.buckets[l.id]}upload(l){for(const y in this.buckets){const v=this.buckets[y];v.uploadPending()&&v.upload(l)}const d=l.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new st(l,this.imageAtlas.image,d.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new st(l,this.glyphAtlasImage,d.ALPHA),this.glyphAtlasImage=null)}prepare(l){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(l,this.imageAtlasTexture)}queryRenderedFeatures(l,d,y,v,E,U,R,g,w,T){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:v,cameraQueryGeometry:E,scale:U,tileSize:this.tileSize,pixelPosMatrix:T,transform:g,params:R,queryPadding:this.queryPadding*w},l,d,y):{}}querySourceFeatures(l,d){const y=this.latestFeatureIndex;if(!y||!y.rawTileData)return;const v=y.loadVTLayers(),E=d&&d.sourceLayer?d.sourceLayer:"",U=v._geojsonTileLayer||v[E];if(!U)return;const R=o.a6(d&&d.filter),{z:g,x:w,y:T}=this.tileID.canonical,L={z:g,x:w,y:T};for(let D=0;D<U.length;D++){const H=U.feature(D);if(R.needGeometry){const V=o.a7(H,!0);if(!R.filter(new o.a8(this.tileID.overscaledZ),V,this.tileID.canonical))continue}else if(!R.filter(new o.a8(this.tileID.overscaledZ),H))continue;const z=y.getId(H,E),j=new o.a9(H,g,w,T,z);j.tile=L,l.push(j)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(l){const d=this.expirationTime;if(l.cacheControl){const y=o.aa(l.cacheControl);y["max-age"]&&(this.expirationTime=Date.now()+1e3*y["max-age"])}else l.expires&&(this.expirationTime=new Date(l.expires).getTime());if(this.expirationTime){const y=Date.now();let v=!1;if(this.expirationTime>y)v=!1;else if(d)if(this.expirationTime<d)v=!0;else{const E=this.expirationTime-d;E?this.expirationTime=y+Math.max(E,3e4):v=!0}else v=!0;v?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(l,d){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(l).length===0)return;const y=this.latestFeatureIndex.loadVTLayers();for(const v in this.buckets){if(!d.style.hasLayer(v))continue;const E=this.buckets[v],U=E.layers[0].sourceLayer||"_geojsonTileLayer",R=y[U],g=l[U];if(!R||!g||Object.keys(g).length===0)continue;E.update(g,R,this.imageAtlas&&this.imageAtlas.patternPositions||{});const w=d&&d.style&&d.style.getLayer(v);w&&(this.queryPadding=Math.max(this.queryPadding,w.queryRadius(E)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<_.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(l){this.symbolFadeHoldUntil=_.now()+l}setDependencies(l,d){const y={};for(const v of d)y[v]=!0;this.dependencies[l]=y}hasDependency(l,d){for(const y of l){const v=this.dependencies[y];if(v){for(const E of d)if(v[E])return!0}}return!1}}class De{constructor(l,d){this.max=l,this.onRemove=d,this.reset()}reset(){for(const l in this.data)for(const d of this.data[l])d.timeout&&clearTimeout(d.timeout),this.onRemove(d.value);return this.data={},this.order=[],this}add(l,d,y){const v=l.wrapped().key;this.data[v]===void 0&&(this.data[v]=[]);const E={value:d,timeout:void 0};if(y!==void 0&&(E.timeout=setTimeout(()=>{this.remove(l,E)},y)),this.data[v].push(E),this.order.push(v),this.order.length>this.max){const U=this._getAndRemoveByKey(this.order[0]);U&&this.onRemove(U)}return this}has(l){return l.wrapped().key in this.data}getAndRemove(l){return this.has(l)?this._getAndRemoveByKey(l.wrapped().key):null}_getAndRemoveByKey(l){const d=this.data[l].shift();return d.timeout&&clearTimeout(d.timeout),this.data[l].length===0&&delete this.data[l],this.order.splice(this.order.indexOf(l),1),d.value}getByKey(l){const d=this.data[l];return d?d[0].value:null}get(l){return this.has(l)?this.data[l.wrapped().key][0].value:null}remove(l,d){if(!this.has(l))return this;const y=l.wrapped().key,v=d===void 0?0:this.data[y].indexOf(d),E=this.data[y][v];return this.data[y].splice(v,1),E.timeout&&clearTimeout(E.timeout),this.data[y].length===0&&delete this.data[y],this.onRemove(E.value),this.order.splice(this.order.indexOf(y),1),this}setMaxSize(l){for(this.max=l;this.order.length>this.max;){const d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this}filter(l){const d=[];for(const y in this.data)for(const v of this.data[y])l(v.value)||d.push(v);for(const y of d)this.remove(y.value.tileID,y)}}class xn{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(l,d,y){const v=String(d);if(this.stateChanges[l]=this.stateChanges[l]||{},this.stateChanges[l][v]=this.stateChanges[l][v]||{},o.e(this.stateChanges[l][v],y),this.deletedStates[l]===null){this.deletedStates[l]={};for(const E in this.state[l])E!==v&&(this.deletedStates[l][E]=null)}else if(this.deletedStates[l]&&this.deletedStates[l][v]===null){this.deletedStates[l][v]={};for(const E in this.state[l][v])y[E]||(this.deletedStates[l][v][E]=null)}else for(const E in y)this.deletedStates[l]&&this.deletedStates[l][v]&&this.deletedStates[l][v][E]===null&&delete this.deletedStates[l][v][E]}removeFeatureState(l,d,y){if(this.deletedStates[l]===null)return;const v=String(d);if(this.deletedStates[l]=this.deletedStates[l]||{},y&&d!==void 0)this.deletedStates[l][v]!==null&&(this.deletedStates[l][v]=this.deletedStates[l][v]||{},this.deletedStates[l][v][y]=null);else if(d!==void 0)if(this.stateChanges[l]&&this.stateChanges[l][v])for(y in this.deletedStates[l][v]={},this.stateChanges[l][v])this.deletedStates[l][v][y]=null;else this.deletedStates[l][v]=null;else this.deletedStates[l]=null}getState(l,d){const y=String(d),v=o.e({},(this.state[l]||{})[y],(this.stateChanges[l]||{})[y]);if(this.deletedStates[l]===null)return{};if(this.deletedStates[l]){const E=this.deletedStates[l][d];if(E===null)return{};for(const U in E)delete v[U]}return v}initializeTileState(l,d){l.setFeatureState(this.state,d)}coalesceChanges(l,d){const y={};for(const v in this.stateChanges){this.state[v]=this.state[v]||{};const E={};for(const U in this.stateChanges[v])this.state[v][U]||(this.state[v][U]={}),o.e(this.state[v][U],this.stateChanges[v][U]),E[U]=this.state[v][U];y[v]=E}for(const v in this.deletedStates){this.state[v]=this.state[v]||{};const E={};if(this.deletedStates[v]===null)for(const U in this.state[v])E[U]={},this.state[v][U]={};else for(const U in this.deletedStates[v]){if(this.deletedStates[v][U]===null)this.state[v][U]={};else for(const R of Object.keys(this.deletedStates[v][U]))delete this.state[v][U][R];E[U]=this.state[v][U]}y[v]=y[v]||{},o.e(y[v],E)}if(this.stateChanges={},this.deletedStates={},Object.keys(y).length!==0)for(const v in l)l[v].setFeatureState(y,d)}}class Pr extends o.E{constructor(l,d,y){super(),this.id=l,this.dispatcher=y,this.on("data",v=>this._dataHandler(v)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((v,E,U,R)=>{const g=new(Lr(E.type))(v,E,U,R);if(g.id!==v)throw new Error(`Expected Source id to be ${v} instead of ${g.id}`);return g})(l,d,y,this),this._tiles={},this._cache=new De(0,v=>this._unloadTile(v)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new xn,this._didEmitContent=!1,this._updated=!1}onAdd(l){this.map=l,this._maxTileCacheSize=l?l._maxTileCacheSize:null,this._maxTileCacheZoomLevels=l?l._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(l)}onRemove(l){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(l)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const l in this._tiles){const d=this._tiles[l];if(d.state!=="loaded"&&d.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const l=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,l&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(l,d,y){return o._(this,void 0,void 0,function*(){try{yield this._source.loadTile(l),this._tileLoaded(l,d,y)}catch(v){l.state="errored",v.status!==404?this._source.fire(new o.j(v,{tile:l})):this.update(this.transform,this.terrain)}})}_unloadTile(l){this._source.unloadTile&&this._source.unloadTile(l)}_abortTile(l){this._source.abortTile&&this._source.abortTile(l),this._source.fire(new o.k("dataabort",{tile:l,coord:l.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(l){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const d in this._tiles){const y=this._tiles[d];y.upload(l),y.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(l=>l.tileID).sort(Te).map(l=>l.key)}getRenderableIds(l){const d=[];for(const y in this._tiles)this._isIdRenderable(y,l)&&d.push(this._tiles[y]);return l?d.sort((y,v)=>{const E=y.tileID,U=v.tileID,R=new o.P(E.canonical.x,E.canonical.y)._rotate(this.transform.angle),g=new o.P(U.canonical.x,U.canonical.y)._rotate(this.transform.angle);return E.overscaledZ-U.overscaledZ||g.y-R.y||g.x-R.x}).map(y=>y.tileID.key):d.map(y=>y.tileID).sort(Te).map(y=>y.key)}hasRenderableParent(l){const d=this.findLoadedParent(l,0);return!!d&&this._isIdRenderable(d.tileID.key)}_isIdRenderable(l,d){return this._tiles[l]&&this._tiles[l].hasData()&&!this._coveredTiles[l]&&(d||!this._tiles[l].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const l in this._tiles)this._tiles[l].state!=="errored"&&this._reloadTile(l,"reloading")}}_reloadTile(l,d){return o._(this,void 0,void 0,function*(){const y=this._tiles[l];y&&(y.state!=="loading"&&(y.state=d),yield this._loadTile(y,l,d))})}_tileLoaded(l,d,y){l.timeAdded=_.now(),y==="expired"&&(l.refreshedUponExpiration=!0),this._setTileReloadTimer(d,l),this.getSource().type==="raster-dem"&&l.dem&&this._backfillDEM(l),this._state.initializeTileState(l,this.map?this.map.painter:null),l.aborted||this._source.fire(new o.k("data",{dataType:"source",tile:l,coord:l.tileID}))}_backfillDEM(l){const d=this.getRenderableIds();for(let v=0;v<d.length;v++){const E=d[v];if(l.neighboringTiles&&l.neighboringTiles[E]){const U=this.getTileByID(E);y(l,U),y(U,l)}}function y(v,E){v.needsHillshadePrepare=!0,v.needsTerrainPrepare=!0;let U=E.tileID.canonical.x-v.tileID.canonical.x;const R=E.tileID.canonical.y-v.tileID.canonical.y,g=Math.pow(2,v.tileID.canonical.z),w=E.tileID.key;U===0&&R===0||Math.abs(R)>1||(Math.abs(U)>1&&(Math.abs(U+g)===1?U+=g:Math.abs(U-g)===1&&(U-=g)),E.dem&&v.dem&&(v.dem.backfillBorder(E.dem,U,R),v.neighboringTiles&&v.neighboringTiles[w]&&(v.neighboringTiles[w].backfilled=!0)))}}getTile(l){return this.getTileByID(l.key)}getTileByID(l){return this._tiles[l]}_retainLoadedChildren(l,d,y,v){for(const E in this._tiles){let U=this._tiles[E];if(v[E]||!U.hasData()||U.tileID.overscaledZ<=d||U.tileID.overscaledZ>y)continue;let R=U.tileID;for(;U&&U.tileID.overscaledZ>d+1;){const w=U.tileID.scaledTo(U.tileID.overscaledZ-1);U=this._tiles[w.key],U&&U.hasData()&&(R=w)}let g=R;for(;g.overscaledZ>d;)if(g=g.scaledTo(g.overscaledZ-1),l[g.key]){v[R.key]=R;break}}}findLoadedParent(l,d){if(l.key in this._loadedParentTiles){const y=this._loadedParentTiles[l.key];return y&&y.tileID.overscaledZ>=d?y:null}for(let y=l.overscaledZ-1;y>=d;y--){const v=l.scaledTo(y),E=this._getLoadedTile(v);if(E)return E}}_getLoadedTile(l){const d=this._tiles[l.key];return d&&d.hasData()?d:this._cache.getByKey(l.wrapped().key)}updateCacheSize(l){const d=Math.ceil(l.width/this._source.tileSize)+1,y=Math.ceil(l.height/this._source.tileSize)+1,v=Math.floor(d*y*(this._maxTileCacheZoomLevels===null?o.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),E=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,v):v;this._cache.setMaxSize(E)}handleWrapJump(l){const d=Math.round((l-(this._prevLng===void 0?l:this._prevLng))/360);if(this._prevLng=l,d){const y={};for(const v in this._tiles){const E=this._tiles[v];E.tileID=E.tileID.unwrapTo(E.tileID.wrap+d),y[E.tileID.key]=E}this._tiles=y;for(const v in this._timers)clearTimeout(this._timers[v]),delete this._timers[v];for(const v in this._tiles)this._setTileReloadTimer(v,this._tiles[v])}}update(l,d){if(!this._sourceLoaded||this._paused)return;let y;this.transform=l,this.terrain=d,this.updateCacheSize(l),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?y=l.getVisibleUnwrappedCoordinates(this._source.tileID).map(T=>new o.Q(T.canonical.z,T.wrap,T.canonical.z,T.canonical.x,T.canonical.y)):(y=l.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:d}),this._source.hasTile&&(y=y.filter(T=>this._source.hasTile(T)))):y=[];const v=l.coveringZoomLevel(this._source),E=Math.max(v-Pr.maxOverzooming,this._source.minzoom),U=Math.max(v+Pr.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const T={};for(const L of y)if(L.canonical.z>this._source.minzoom){const D=L.scaledTo(L.canonical.z-1);T[D.key]=D;const H=L.scaledTo(Math.max(this._source.minzoom,Math.min(L.canonical.z,5)));T[H.key]=H}y=y.concat(Object.values(T))}const R=y.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,R&&this.fire(new o.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const g=this._updateRetainedTiles(y,v);if(Je(this._source.type)){const T={},L={},D=Object.keys(g),H=_.now();for(const z of D){const j=g[z],V=this._tiles[z];if(!V||V.fadeEndTime!==0&&V.fadeEndTime<=H)continue;const W=this.findLoadedParent(j,E);W&&(this._addTile(W.tileID),T[W.tileID.key]=W.tileID),L[z]=j}this._retainLoadedChildren(L,v,U,g);for(const z in T)g[z]||(this._coveredTiles[z]=!0,g[z]=T[z]);if(d){const z={},j={};for(const V of y)this._tiles[V.key].hasData()?z[V.key]=V:j[V.key]=V;for(const V in j){const W=j[V].children(this._source.maxzoom);this._tiles[W[0].key]&&this._tiles[W[1].key]&&this._tiles[W[2].key]&&this._tiles[W[3].key]&&(z[W[0].key]=g[W[0].key]=W[0],z[W[1].key]=g[W[1].key]=W[1],z[W[2].key]=g[W[2].key]=W[2],z[W[3].key]=g[W[3].key]=W[3],delete j[V])}for(const V in j){const W=this.findLoadedParent(j[V],this._source.minzoom);if(W){z[W.tileID.key]=g[W.tileID.key]=W.tileID;for(const lt in z)z[lt].isChildOf(W.tileID)&&delete z[lt]}}for(const V in this._tiles)z[V]||(this._coveredTiles[V]=!0)}}for(const T in g)this._tiles[T].clearFadeHold();const w=o.ab(this._tiles,g);for(const T of w){const L=this._tiles[T];L.hasSymbolBuckets&&!L.holdingForFade()?L.setHoldDuration(this.map._fadeDuration):L.hasSymbolBuckets&&!L.symbolFadeFinished()||this._removeTile(T)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const l in this._tiles)this._tiles[l].holdingForFade()&&this._removeTile(l)}_updateRetainedTiles(l,d){const y={},v={},E=Math.max(d-Pr.maxOverzooming,this._source.minzoom),U=Math.max(d+Pr.maxUnderzooming,this._source.minzoom),R={};for(const g of l){const w=this._addTile(g);y[g.key]=g,w.hasData()||d<this._source.maxzoom&&(R[g.key]=g)}this._retainLoadedChildren(R,d,U,y);for(const g of l){let w=this._tiles[g.key];if(w.hasData())continue;if(d+1>this._source.maxzoom){const L=g.children(this._source.maxzoom)[0],D=this.getTile(L);if(D&&D.hasData()){y[L.key]=L;continue}}else{const L=g.children(this._source.maxzoom);if(y[L[0].key]&&y[L[1].key]&&y[L[2].key]&&y[L[3].key])continue}let T=w.wasRequested();for(let L=g.overscaledZ-1;L>=E;--L){const D=g.scaledTo(L);if(v[D.key])break;if(v[D.key]=!0,w=this.getTile(D),!w&&T&&(w=this._addTile(D)),w){const H=w.hasData();if((T||H)&&(y[D.key]=D),T=w.wasRequested(),H)break}}}return y}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const l in this._tiles){const d=[];let y,v=this._tiles[l].tileID;for(;v.overscaledZ>0;){if(v.key in this._loadedParentTiles){y=this._loadedParentTiles[v.key];break}d.push(v.key);const E=v.scaledTo(v.overscaledZ-1);if(y=this._getLoadedTile(E),y)break;v=E}for(const E of d)this._loadedParentTiles[E]=y}}_addTile(l){let d=this._tiles[l.key];if(d)return d;d=this._cache.getAndRemove(l),d&&(this._setTileReloadTimer(l.key,d),d.tileID=l,this._state.initializeTileState(d,this.map?this.map.painter:null),this._cacheTimers[l.key]&&(clearTimeout(this._cacheTimers[l.key]),delete this._cacheTimers[l.key],this._setTileReloadTimer(l.key,d)));const y=d;return d||(d=new Ir(l,this._source.tileSize*l.overscaleFactor()),this._loadTile(d,l.key,d.state)),d.uses++,this._tiles[l.key]=d,y||this._source.fire(new o.k("dataloading",{tile:d,coord:d.tileID,dataType:"source"})),d}_setTileReloadTimer(l,d){l in this._timers&&(clearTimeout(this._timers[l]),delete this._timers[l]);const y=d.getExpiryTimeout();y&&(this._timers[l]=setTimeout(()=>{this._reloadTile(l,"expired"),delete this._timers[l]},y))}_removeTile(l){const d=this._tiles[l];d&&(d.uses--,delete this._tiles[l],this._timers[l]&&(clearTimeout(this._timers[l]),delete this._timers[l]),d.uses>0||(d.hasData()&&d.state!=="reloading"?this._cache.add(d.tileID,d,d.getExpiryTimeout()):(d.aborted=!0,this._abortTile(d),this._unloadTile(d))))}_dataHandler(l){const d=l.sourceDataType;l.dataType==="source"&&d==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&l.dataType==="source"&&d==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const l in this._tiles)this._removeTile(l);this._cache.reset()}tilesIn(l,d,y){const v=[],E=this.transform;if(!E)return v;const U=y?E.getCameraQueryGeometry(l):l,R=l.map(z=>E.pointCoordinate(z,this.terrain)),g=U.map(z=>E.pointCoordinate(z,this.terrain)),w=this.getIds();let T=1/0,L=1/0,D=-1/0,H=-1/0;for(const z of g)T=Math.min(T,z.x),L=Math.min(L,z.y),D=Math.max(D,z.x),H=Math.max(H,z.y);for(let z=0;z<w.length;z++){const j=this._tiles[w[z]];if(j.holdingForFade())continue;const V=j.tileID,W=Math.pow(2,E.zoom-j.tileID.overscaledZ),lt=d*j.queryPadding*o.W/j.tileSize/W,rt=[V.getTilePoint(new o.Y(T,L)),V.getTilePoint(new o.Y(D,H))];if(rt[0].x-lt<o.W&&rt[0].y-lt<o.W&&rt[1].x+lt>=0&&rt[1].y+lt>=0){const ht=R.map(Mt=>V.getTilePoint(Mt)),gt=g.map(Mt=>V.getTilePoint(Mt));v.push({tile:j,tileID:V,queryGeometry:ht,cameraQueryGeometry:gt,scale:W})}}return v}getVisibleCoordinates(l){const d=this.getRenderableIds(l).map(y=>this._tiles[y].tileID);for(const y of d)y.posMatrix=this.transform.calculatePosMatrix(y.toUnwrapped());return d}hasTransition(){if(this._source.hasTransition())return!0;if(Je(this._source.type)){const l=_.now();for(const d in this._tiles)if(this._tiles[d].fadeEndTime>=l)return!0}return!1}setFeatureState(l,d,y){this._state.updateState(l=l||"_geojsonTileLayer",d,y)}removeFeatureState(l,d,y){this._state.removeFeatureState(l=l||"_geojsonTileLayer",d,y)}getFeatureState(l,d){return this._state.getState(l=l||"_geojsonTileLayer",d)}setDependencies(l,d,y){const v=this._tiles[l];v&&v.setDependencies(d,y)}reloadTilesForDependencies(l,d){for(const y in this._tiles)this._tiles[y].hasDependency(l,d)&&this._reloadTile(y,"reloading");this._cache.filter(y=>!y.hasDependency(l,d))}}function Te(C,l){const d=Math.abs(2*C.wrap)-+(C.wrap<0),y=Math.abs(2*l.wrap)-+(l.wrap<0);return C.overscaledZ-l.overscaledZ||y-d||l.canonical.y-C.canonical.y||l.canonical.x-C.canonical.x}function Je(C){return C==="raster"||C==="image"||C==="video"}Pr.maxOverzooming=10,Pr.maxUnderzooming=3;class Ke{constructor(l,d){this.reset(l,d)}reset(l,d){this.points=l||[],this._distances=[0];for(let y=1;y<this.points.length;y++)this._distances[y]=this._distances[y-1]+this.points[y].dist(this.points[y-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(l){if(this.points.length===1)return this.points[0];l=o.ac(l,0,1);let d=1,y=this._distances[d];const v=l*this.paddedLength+this.padding;for(;y<v&&d<this._distances.length;)y=this._distances[++d];const E=d-1,U=this._distances[E],R=y-U,g=R>0?(v-U)/R:0;return this.points[E].mult(1-g).add(this.points[d].mult(g))}}function Yr(C,l){let d=!0;return C==="always"||C!=="never"&&l!=="never"||(d=!1),d}class Or{constructor(l,d,y){const v=this.boxCells=[],E=this.circleCells=[];this.xCellCount=Math.ceil(l/y),this.yCellCount=Math.ceil(d/y);for(let U=0;U<this.xCellCount*this.yCellCount;U++)v.push([]),E.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=d,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(l,d,y,v,E){this._forEachCell(d,y,v,E,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(d),this.bboxes.push(y),this.bboxes.push(v),this.bboxes.push(E)}insertCircle(l,d,y,v){this._forEachCell(d-v,y-v,d+v,y+v,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(d),this.circles.push(y),this.circles.push(v)}_insertBoxCell(l,d,y,v,E,U){this.boxCells[E].push(U)}_insertCircleCell(l,d,y,v,E,U){this.circleCells[E].push(U)}_query(l,d,y,v,E,U,R){if(y<0||l>this.width||v<0||d>this.height)return[];const g=[];if(l<=0&&d<=0&&this.width<=y&&this.height<=v){if(E)return[{key:null,x1:l,y1:d,x2:y,y2:v}];for(let w=0;w<this.boxKeys.length;w++)g.push({key:this.boxKeys[w],x1:this.bboxes[4*w],y1:this.bboxes[4*w+1],x2:this.bboxes[4*w+2],y2:this.bboxes[4*w+3]});for(let w=0;w<this.circleKeys.length;w++){const T=this.circles[3*w],L=this.circles[3*w+1],D=this.circles[3*w+2];g.push({key:this.circleKeys[w],x1:T-D,y1:L-D,x2:T+D,y2:L+D})}}else this._forEachCell(l,d,y,v,this._queryCell,g,{hitTest:E,overlapMode:U,seenUids:{box:{},circle:{}}},R);return g}query(l,d,y,v){return this._query(l,d,y,v,!1,null)}hitTest(l,d,y,v,E,U){return this._query(l,d,y,v,!0,E,U).length>0}hitTestCircle(l,d,y,v,E){const U=l-y,R=l+y,g=d-y,w=d+y;if(R<0||U>this.width||w<0||g>this.height)return!1;const T=[];return this._forEachCell(U,g,R,w,this._queryCellCircle,T,{hitTest:!0,overlapMode:v,circle:{x:l,y:d,radius:y},seenUids:{box:{},circle:{}}},E),T.length>0}_queryCell(l,d,y,v,E,U,R,g){const{seenUids:w,hitTest:T,overlapMode:L}=R,D=this.boxCells[E];if(D!==null){const z=this.bboxes;for(const j of D)if(!w.box[j]){w.box[j]=!0;const V=4*j,W=this.boxKeys[j];if(l<=z[V+2]&&d<=z[V+3]&&y>=z[V+0]&&v>=z[V+1]&&(!g||g(W))&&(!T||!Yr(L,W.overlapMode))&&(U.push({key:W,x1:z[V],y1:z[V+1],x2:z[V+2],y2:z[V+3]}),T))return!0}}const H=this.circleCells[E];if(H!==null){const z=this.circles;for(const j of H)if(!w.circle[j]){w.circle[j]=!0;const V=3*j,W=this.circleKeys[j];if(this._circleAndRectCollide(z[V],z[V+1],z[V+2],l,d,y,v)&&(!g||g(W))&&(!T||!Yr(L,W.overlapMode))){const lt=z[V],rt=z[V+1],ht=z[V+2];if(U.push({key:W,x1:lt-ht,y1:rt-ht,x2:lt+ht,y2:rt+ht}),T)return!0}}}return!1}_queryCellCircle(l,d,y,v,E,U,R,g){const{circle:w,seenUids:T,overlapMode:L}=R,D=this.boxCells[E];if(D!==null){const z=this.bboxes;for(const j of D)if(!T.box[j]){T.box[j]=!0;const V=4*j,W=this.boxKeys[j];if(this._circleAndRectCollide(w.x,w.y,w.radius,z[V+0],z[V+1],z[V+2],z[V+3])&&(!g||g(W))&&!Yr(L,W.overlapMode))return U.push(!0),!0}}const H=this.circleCells[E];if(H!==null){const z=this.circles;for(const j of H)if(!T.circle[j]){T.circle[j]=!0;const V=3*j,W=this.circleKeys[j];if(this._circlesCollide(z[V],z[V+1],z[V+2],w.x,w.y,w.radius)&&(!g||g(W))&&!Yr(L,W.overlapMode))return U.push(!0),!0}}}_forEachCell(l,d,y,v,E,U,R,g){const w=this._convertToXCellCoord(l),T=this._convertToYCellCoord(d),L=this._convertToXCellCoord(y),D=this._convertToYCellCoord(v);for(let H=w;H<=L;H++)for(let z=T;z<=D;z++)if(E.call(this,l,d,y,v,this.xCellCount*z+H,U,R,g))return}_convertToXCellCoord(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))}_convertToYCellCoord(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))}_circlesCollide(l,d,y,v,E,U){const R=v-l,g=E-d,w=y+U;return w*w>R*R+g*g}_circleAndRectCollide(l,d,y,v,E,U,R){const g=(U-v)/2,w=Math.abs(l-(v+g));if(w>g+y)return!1;const T=(R-E)/2,L=Math.abs(d-(E+T));if(L>T+y)return!1;if(w<=g||L<=T)return!0;const D=w-g,H=L-T;return D*D+H*H<=y*y}}function gr(C,l,d,y,v){const E=o.F();return l?(o.J(E,E,[1/v,1/v,1]),d||o.ad(E,E,y.angle)):o.K(E,y.labelPlaneMatrix,C),E}function an(C,l,d,y,v){if(l){const E=o.ae(C);return o.J(E,E,[v,v,1]),d||o.ad(E,E,-y.angle),E}return y.glCoordMatrix}function $r(C,l,d){let y;d?(y=[C.x,C.y,d(C.x,C.y),1],o.af(y,y,l)):(y=[C.x,C.y,0,1],Ve(y,y,l));const v=y[3];return{point:new o.P(y[0]/v,y[1]/v),signedDistanceFromCamera:v}}function Ct(C,l){return .5+C/l*.5}function Z(C,l){const d=C[0]/C[3],y=C[1]/C[3];return d>=-l[0]&&d<=l[0]&&y>=-l[1]&&y<=l[1]}function Y(C,l,d,y,v,E,U,R,g,w){const T=y?C.textSizeData:C.iconSizeData,L=o.ag(T,d.transform.zoom),D=[256/d.width*2+1,256/d.height*2+1],H=y?C.text.dynamicLayoutVertexArray:C.icon.dynamicLayoutVertexArray;H.clear();const z=C.lineVertexArray,j=y?C.text.placedSymbolArray:C.icon.placedSymbolArray,V=d.transform.width/d.transform.height;let W=!1;for(let lt=0;lt<j.length;lt++){const rt=j.get(lt);if(rt.hidden||rt.writingMode===o.ah.vertical&&!W){de(rt.numGlyphs,H);continue}let ht;if(W=!1,w?(ht=[rt.anchorX,rt.anchorY,w(rt.anchorX,rt.anchorY),1],o.af(ht,ht,l)):(ht=[rt.anchorX,rt.anchorY,0,1],Ve(ht,ht,l)),!Z(ht,D)){de(rt.numGlyphs,H);continue}const gt=Ct(d.transform.cameraToCenterDistance,ht[3]),Mt=o.ai(T,L,rt),Tt=U?Mt/gt:Mt*gt,_t=new o.P(rt.anchorX,rt.anchorY),bt=$r(_t,v,w).point,Gt={projections:{},offsets:{}},Wt=kt(rt,Tt,!1,R,l,v,E,C.glyphOffsetArray,z,H,bt,_t,Gt,V,g,w);W=Wt.useVertical,(Wt.notEnoughRoom||W||Wt.needsFlipping&&kt(rt,Tt,!0,R,l,v,E,C.glyphOffsetArray,z,H,bt,_t,Gt,V,g,w).notEnoughRoom)&&de(rt.numGlyphs,H)}y?C.text.dynamicLayoutVertexBuffer.updateData(H):C.icon.dynamicLayoutVertexBuffer.updateData(H)}function ot(C,l,d,y,v,E,U,R,g,w,T,L,D){const H=R.glyphStartIndex+R.numGlyphs,z=R.lineStartIndex,j=R.lineStartIndex+R.lineLength,V=l.getoffsetX(R.glyphStartIndex),W=l.getoffsetX(H-1),lt=me(C*V,d,y,v,E,U,R.segment,z,j,g,w,T,L,D);if(!lt)return null;const rt=me(C*W,d,y,v,E,U,R.segment,z,j,g,w,T,L,D);return rt?{first:lt,last:rt}:null}function Et(C,l,d,y){return C===o.ah.horizontal&&Math.abs(d.y-l.y)>Math.abs(d.x-l.x)*y?{useVertical:!0}:(C===o.ah.vertical?l.y<d.y:l.x>d.x)?{needsFlipping:!0}:null}function kt(C,l,d,y,v,E,U,R,g,w,T,L,D,H,z,j){const V=l/24,W=C.lineOffsetX*V,lt=C.lineOffsetY*V;let rt;if(C.numGlyphs>1){const ht=C.glyphStartIndex+C.numGlyphs,gt=C.lineStartIndex,Mt=C.lineStartIndex+C.lineLength,Tt=ot(V,R,W,lt,d,T,L,C,g,E,D,z,j);if(!Tt)return{notEnoughRoom:!0};const _t=$r(Tt.first.point,U,j).point,bt=$r(Tt.last.point,U,j).point;if(y&&!d){const Gt=Et(C.writingMode,_t,bt,H);if(Gt)return Gt}rt=[Tt.first];for(let Gt=C.glyphStartIndex+1;Gt<ht-1;Gt++)rt.push(me(V*R.getoffsetX(Gt),W,lt,d,T,L,C.segment,gt,Mt,g,E,D,z,j));rt.push(Tt.last)}else{if(y&&!d){const gt=$r(L,v,j).point,Mt=C.lineStartIndex+C.segment+1,Tt=new o.P(g.getx(Mt),g.gety(Mt)),_t=$r(Tt,v,j),bt=_t.signedDistanceFromCamera>0?_t.point:zt(L,Tt,gt,1,v,j),Gt=Et(C.writingMode,gt,bt,H);if(Gt)return Gt}const ht=me(V*R.getoffsetX(C.glyphStartIndex),W,lt,d,T,L,C.segment,C.lineStartIndex,C.lineStartIndex+C.lineLength,g,E,D,z,j);if(!ht)return{notEnoughRoom:!0};rt=[ht]}for(const ht of rt)o.aj(w,ht.point,ht.angle);return{}}function zt(C,l,d,y,v,E){const U=$r(C.add(C.sub(l)._unit()),v,E).point,R=d.sub(U);return d.add(R._mult(y/R.mag()))}function qt(C,l){const{projectionCache:d,lineVertexArray:y,labelPlaneMatrix:v,tileAnchorPoint:E,distanceFromAnchor:U,getElevation:R,previousVertex:g,direction:w,absOffsetX:T}=l;if(d.projections[C])return d.projections[C];const L=new o.P(y.getx(C),y.gety(C)),D=$r(L,v,R);if(D.signedDistanceFromCamera>0)return d.projections[C]=D.point,D.point;const H=C-w;return zt(U===0?E:new o.P(y.getx(H),y.gety(H)),L,g,T-U+1,v,R)}function St(C,l,d){return C._unit()._perp()._mult(l*d)}function Yt(C,l,d,y,v,E,U,R){const{projectionCache:g,direction:w}=R;if(g.offsets[C])return g.offsets[C];const T=d.add(l);if(C+w<y||C+w>=v)return g.offsets[C]=T,T;const L=qt(C+w,R),D=St(L.sub(d),U,w),H=d.add(D),z=L.add(D);return g.offsets[C]=o.ak(E,T,H,z)||T,g.offsets[C]}function me(C,l,d,y,v,E,U,R,g,w,T,L,D,H){const z=y?C-l:C+l;let j=z>0?1:-1,V=0;y&&(j*=-1,V=Math.PI),j<0&&(V+=Math.PI);let W,lt,rt=j>0?R+U:R+U+1,ht=v,gt=v,Mt=0,Tt=0;const _t=Math.abs(z),bt=[];let Gt;for(;Mt+Tt<=_t;){if(rt+=j,rt<R||rt>=g)return null;Mt+=Tt,gt=ht,lt=W;const Ae={projectionCache:L,lineVertexArray:w,labelPlaneMatrix:T,tileAnchorPoint:E,distanceFromAnchor:Mt,getElevation:H,previousVertex:gt,direction:j,absOffsetX:_t};if(ht=qt(rt,Ae),d===0)bt.push(gt),Gt=ht.sub(gt);else{let ye;const Oe=ht.sub(gt);ye=Oe.mag()===0?St(qt(rt+j,Ae).sub(ht),d,j):St(Oe,d,j),lt||(lt=gt.add(ye)),W=Yt(rt,ye,ht,R,g,lt,d,Ae),bt.push(lt),Gt=W.sub(lt)}Tt=Gt.mag()}const Wt=Gt._mult((_t-Mt)/Tt)._add(lt||gt),ue=V+Math.atan2(ht.y-gt.y,ht.x-gt.x);return bt.push(Wt),{point:Wt,angle:D?ue:0,path:bt}}const pe=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function de(C,l){for(let d=0;d<C;d++){const y=l.length;l.resize(y+4),l.float32.set(pe,3*y)}}function Ve(C,l,d){const y=l[0],v=l[1];return C[0]=d[0]*y+d[4]*v+d[12],C[1]=d[1]*y+d[5]*v+d[13],C[3]=d[3]*y+d[7]*v+d[15],C}const Ye=100;class Er{constructor(l){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Or(l.width+200,l.height+200,25),y=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new Or(l.width+200,l.height+200,25);this.transform=l,this.grid=d,this.ignoredGrid=y,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+Ye,this.screenBottomBoundary=l.height+Ye,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(l,d,y,v,E,U){const R=this.projectAndGetPerspectiveRatio(v,l.anchorPointX,l.anchorPointY,U),g=y*R.perspectiveRatio,w=l.x1*g+R.point.x,T=l.y1*g+R.point.y,L=l.x2*g+R.point.x,D=l.y2*g+R.point.y;return!this.isInsideGrid(w,T,L,D)||d!=="always"&&this.grid.hitTest(w,T,L,D,d,E)||R.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[w,T,L,D],offscreen:this.isOffscreen(w,T,L,D)}}placeCollisionCircles(l,d,y,v,E,U,R,g,w,T,L,D,H,z){const j=[],V=new o.P(d.anchorX,d.anchorY),W=$r(V,U,z),lt=Ct(this.transform.cameraToCenterDistance,W.signedDistanceFromCamera),rt=(T?E/lt:E*lt)/o.ao,ht=$r(V,R,z).point,gt=ot(rt,v,d.lineOffsetX*rt,d.lineOffsetY*rt,!1,ht,V,d,y,R,{projections:{},offsets:{}},!1,z);let Mt=!1,Tt=!1,_t=!0;if(gt){const bt=.5*D*lt+H,Gt=new o.P(-100,-100),Wt=new o.P(this.screenRightBoundary,this.screenBottomBoundary),ue=new Ke,Ae=gt.first,ye=gt.last;let Oe=[];for(let nr=Ae.path.length-1;nr>=1;nr--)Oe.push(Ae.path[nr]);for(let nr=1;nr<ye.path.length;nr++)Oe.push(ye.path[nr]);const Ce=2.5*bt;if(g){const nr=Oe.map(rr=>$r(rr,g,z));Oe=nr.some(rr=>rr.signedDistanceFromCamera<=0)?[]:nr.map(rr=>rr.point)}let We=[];if(Oe.length>0){const nr=Oe[0].clone(),rr=Oe[0].clone();for(let Sr=1;Sr<Oe.length;Sr++)nr.x=Math.min(nr.x,Oe[Sr].x),nr.y=Math.min(nr.y,Oe[Sr].y),rr.x=Math.max(rr.x,Oe[Sr].x),rr.y=Math.max(rr.y,Oe[Sr].y);We=nr.x>=Gt.x&&rr.x<=Wt.x&&nr.y>=Gt.y&&rr.y<=Wt.y?[Oe]:rr.x<Gt.x||nr.x>Wt.x||rr.y<Gt.y||nr.y>Wt.y?[]:o.al([Oe],Gt.x,Gt.y,Wt.x,Wt.y)}for(const nr of We){ue.reset(nr,.25*bt);let rr=0;rr=ue.length<=.5*bt?1:Math.ceil(ue.paddedLength/Ce)+1;for(let Sr=0;Sr<rr;Sr++){const Fr=Sr/Math.max(rr-1,1),tn=ue.lerp(Fr),xr=tn.x+Ye,Jr=tn.y+Ye;j.push(xr,Jr,bt,0);const Cn=xr-bt,En=Jr-bt,fi=xr+bt,dn=Jr+bt;if(_t=_t&&this.isOffscreen(Cn,En,fi,dn),Tt=Tt||this.isInsideGrid(Cn,En,fi,dn),l!=="always"&&this.grid.hitTestCircle(xr,Jr,bt,l,L)&&(Mt=!0,!w))return{circles:[],offscreen:!1,collisionDetected:Mt}}}}return{circles:!w&&Mt||!Tt||lt<this.perspectiveRatioCutoff?[]:j,offscreen:_t,collisionDetected:Mt}}queryRenderedSymbols(l){if(l.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const d=[];let y=1/0,v=1/0,E=-1/0,U=-1/0;for(const T of l){const L=new o.P(T.x+Ye,T.y+Ye);y=Math.min(y,L.x),v=Math.min(v,L.y),E=Math.max(E,L.x),U=Math.max(U,L.y),d.push(L)}const R=this.grid.query(y,v,E,U).concat(this.ignoredGrid.query(y,v,E,U)),g={},w={};for(const T of R){const L=T.key;if(g[L.bucketInstanceId]===void 0&&(g[L.bucketInstanceId]={}),g[L.bucketInstanceId][L.featureIndex])continue;const D=[new o.P(T.x1,T.y1),new o.P(T.x2,T.y1),new o.P(T.x2,T.y2),new o.P(T.x1,T.y2)];o.am(d,D)&&(g[L.bucketInstanceId][L.featureIndex]=!0,w[L.bucketInstanceId]===void 0&&(w[L.bucketInstanceId]=[]),w[L.bucketInstanceId].push(L.featureIndex))}return w}insertCollisionBox(l,d,y,v,E,U){(y?this.ignoredGrid:this.grid).insert({bucketInstanceId:v,featureIndex:E,collisionGroupID:U,overlapMode:d},l[0],l[1],l[2],l[3])}insertCollisionCircles(l,d,y,v,E,U){const R=y?this.ignoredGrid:this.grid,g={bucketInstanceId:v,featureIndex:E,collisionGroupID:U,overlapMode:d};for(let w=0;w<l.length;w+=4)R.insertCircle(g,l[w],l[w+1],l[w+2])}projectAndGetPerspectiveRatio(l,d,y,v){let E;return v?(E=[d,y,v(d,y),1],o.af(E,E,l)):(E=[d,y,0,1],Ve(E,E,l)),{point:new o.P((E[0]/E[3]+1)/2*this.transform.width+Ye,(-E[1]/E[3]+1)/2*this.transform.height+Ye),perspectiveRatio:.5+this.transform.cameraToCenterDistance/E[3]*.5}}isOffscreen(l,d,y,v){return y<Ye||l>=this.screenRightBoundary||v<Ye||d>this.screenBottomBoundary}isInsideGrid(l,d,y,v){return y>=0&&l<this.gridRightBoundary&&v>=0&&d<this.gridBottomBoundary}getViewportMatrix(){const l=o.an([]);return o.H(l,l,[-100,-100,0]),l}}function lr(C,l,d){return l*(o.W/(C.tileSize*Math.pow(2,d-C.tileID.overscaledZ)))}class Ur{constructor(l,d,y,v){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?d:-d))):v&&y?1:0,this.placed=y}isHidden(){return this.opacity===0&&!this.placed}}class kr{constructor(l,d,y,v,E){this.text=new Ur(l?l.text:null,d,y,E),this.icon=new Ur(l?l.icon:null,d,v,E)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Hr{constructor(l,d,y){this.text=l,this.icon=d,this.skipFade=y}}class mn{constructor(){this.invProjMatrix=o.F(),this.viewportMatrix=o.F(),this.circles=[]}}class mr{constructor(l,d,y,v,E){this.bucketInstanceId=l,this.featureIndex=d,this.sourceLayerIndex=y,this.bucketIndex=v,this.tileID=E}}class Wr{constructor(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}}get(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){const d=++this.maxGroupID;this.collisionGroups[l]={ID:d,predicate:y=>y.collisionGroupID===d}}return this.collisionGroups[l]}}function bn(C,l,d,y,v){const{horizontalAlign:E,verticalAlign:U}=o.at(C);return new o.P(-(E-.5)*l+y[0]*v,-(U-.5)*d+y[1]*v)}function Qn(C,l,d,y,v,E){const{x1:U,x2:R,y1:g,y2:w,anchorPointX:T,anchorPointY:L}=C,D=new o.P(l,d);return y&&D._rotate(v?E:-E),{x1:U+D.x,y1:g+D.y,x2:R+D.x,y2:w+D.y,anchorPointX:T,anchorPointY:L}}class Dt{constructor(l,d,y,v,E){this.transform=l.clone(),this.terrain=d,this.collisionIndex=new Er(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=y,this.retainedQueryData={},this.collisionGroups=new Wr(v),this.collisionCircleArrays={},this.prevPlacement=E,E&&(E.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(l,d,y,v){const E=y.getBucket(d),U=y.latestFeatureIndex;if(!E||!U||d.id!==E.layerIds[0])return;const R=y.collisionBoxArray,g=E.layers[0].layout,w=Math.pow(2,this.transform.zoom-y.tileID.overscaledZ),T=y.tileSize/o.W,L=this.transform.calculatePosMatrix(y.tileID.toUnwrapped()),D=g.get("text-pitch-alignment")==="map",H=g.get("text-rotation-alignment")==="map",z=lr(y,1,this.transform.zoom),j=gr(L,D,H,this.transform,z);let V=null;if(D){const lt=an(L,D,H,this.transform,z);V=o.K([],this.transform.labelPlaneMatrix,lt)}this.retainedQueryData[E.bucketInstanceId]=new mr(E.bucketInstanceId,U,E.sourceLayerIndex,E.index,y.tileID);const W={bucket:E,layout:g,posMatrix:L,textLabelPlaneMatrix:j,labelToScreenMatrix:V,scale:w,textPixelRatio:T,holdingForFade:y.holdingForFade(),collisionBoxArray:R,partiallyEvaluatedTextSize:o.ag(E.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(E.sourceID)};if(v)for(const lt of E.sortKeyRanges){const{sortKey:rt,symbolInstanceStart:ht,symbolInstanceEnd:gt}=lt;l.push({sortKey:rt,symbolInstanceStart:ht,symbolInstanceEnd:gt,parameters:W})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:E.symbolInstances.length,parameters:W})}attemptAnchorPlacement(l,d,y,v,E,U,R,g,w,T,L,D,H,z,j,V){const W=o.ap[l.textAnchor],lt=[l.textOffset0,l.textOffset1],rt=bn(W,y,v,lt,E),ht=this.collisionIndex.placeCollisionBox(Qn(d,rt.x,rt.y,U,R,this.transform.angle),L,g,w,T.predicate,V);if((!j||this.collisionIndex.placeCollisionBox(Qn(j,rt.x,rt.y,U,R,this.transform.angle),L,g,w,T.predicate,V).box.length!==0)&&ht.box.length>0){let gt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[D.crossTileID]&&this.prevPlacement.placements[D.crossTileID]&&this.prevPlacement.placements[D.crossTileID].text&&(gt=this.prevPlacement.variableOffsets[D.crossTileID].anchor),D.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[D.crossTileID]={textOffset:lt,width:y,height:v,anchor:W,textBoxScale:E,prevAnchor:gt},this.markUsedJustification(H,W,D,z),H.allowVerticalPlacement&&(this.markUsedOrientation(H,z,D),this.placedOrientations[D.crossTileID]=z),{shift:rt,placedGlyphBoxes:ht}}}placeLayerBucketPart(l,d,y){const{bucket:v,layout:E,posMatrix:U,textLabelPlaneMatrix:R,labelToScreenMatrix:g,textPixelRatio:w,holdingForFade:T,collisionBoxArray:L,partiallyEvaluatedTextSize:D,collisionGroup:H}=l.parameters,z=E.get("text-optional"),j=E.get("icon-optional"),V=o.aq(E,"text-overlap","text-allow-overlap"),W=V==="always",lt=o.aq(E,"icon-overlap","icon-allow-overlap"),rt=lt==="always",ht=E.get("text-rotation-alignment")==="map",gt=E.get("text-pitch-alignment")==="map",Mt=E.get("icon-text-fit")!=="none",Tt=E.get("symbol-z-order")==="viewport-y",_t=W&&(rt||!v.hasIconData()||j),bt=rt&&(W||!v.hasTextData()||z);!v.collisionArrays&&L&&v.deserializeCollisionBoxes(L);const Gt=this.retainedQueryData[v.bucketInstanceId].tileID,Wt=this.terrain?(Ae,ye)=>this.terrain.getElevation(Gt,Ae,ye):null,ue=(Ae,ye)=>{var Oe,Ce;if(d[Ae.crossTileID])return;if(T)return void(this.placements[Ae.crossTileID]=new Hr(!1,!1,!1));let We=!1,nr=!1,rr=!0,Sr=null,Fr={box:null,offscreen:null},tn={box:null,offscreen:null},xr=null,Jr=null,Cn=null,En=0,fi=0,dn=0;ye.textFeatureIndex?En=ye.textFeatureIndex:Ae.useRuntimeCollisionCircles&&(En=Ae.featureIndex),ye.verticalTextFeatureIndex&&(fi=ye.verticalTextFeatureIndex);const us=ye.textBox;if(us){const fn=un=>{let Sn=o.ah.horizontal;if(v.allowVerticalPlacement&&!un&&this.prevPlacement){const Ji=this.prevPlacement.placedOrientations[Ae.crossTileID];Ji&&(this.placedOrientations[Ae.crossTileID]=Ji,Sn=Ji,this.markUsedOrientation(v,Sn,Ae))}return Sn},on=(un,Sn)=>{if(v.allowVerticalPlacement&&Ae.numVerticalGlyphVertices>0&&ye.verticalTextBox){for(const Ji of v.writingModes)if(Ji===o.ah.vertical?(Fr=Sn(),tn=Fr):Fr=un(),Fr&&Fr.box&&Fr.box.length)break}else Fr=un()},pn=Ae.textAnchorOffsetStartIndex,Ti=Ae.textAnchorOffsetEndIndex;if(Ti===pn){const un=(Sn,Ji)=>{const ri=this.collisionIndex.placeCollisionBox(Sn,V,w,U,H.predicate,Wt);return ri&&ri.box&&ri.box.length&&(this.markUsedOrientation(v,Ji,Ae),this.placedOrientations[Ae.crossTileID]=Ji),ri};on(()=>un(us,o.ah.horizontal),()=>{const Sn=ye.verticalTextBox;return v.allowVerticalPlacement&&Ae.numVerticalGlyphVertices>0&&Sn?un(Sn,o.ah.vertical):{box:null,offscreen:null}}),fn(Fr&&Fr.box&&Fr.box.length)}else{let un=o.ap[(Ce=(Oe=this.prevPlacement)===null||Oe===void 0?void 0:Oe.variableOffsets[Ae.crossTileID])===null||Ce===void 0?void 0:Ce.anchor];const Sn=(ri,Dn,ai)=>{const ph=ri.x2-ri.x1,Pc=ri.y2-ri.y1,Mc=Ae.textBoxScale,Ll=Mt&&lt==="never"?Dn:null;let To={box:[],offscreen:!1},_u=V==="never"?1:2,Io="never";un&&_u++;for(let Uc=0;Uc<_u;Uc++){for(let Rc=pn;Rc<Ti;Rc++){const mA=v.textAnchorOffsets.get(Rc);if(un&&mA.textAnchor!==un)continue;const vu=this.attemptAnchorPlacement(mA,ri,ph,Pc,Mc,ht,gt,w,U,H,Io,Ae,v,ai,Ll,Wt);if(vu&&(To=vu.placedGlyphBoxes,To&&To.box&&To.box.length))return We=!0,Sr=vu.shift,To}un?un=null:Io=V}return To};on(()=>Sn(us,ye.iconBox,o.ah.horizontal),()=>{const ri=ye.verticalTextBox;return v.allowVerticalPlacement&&!(Fr&&Fr.box&&Fr.box.length)&&Ae.numVerticalGlyphVertices>0&&ri?Sn(ri,ye.verticalIconBox,o.ah.vertical):{box:null,offscreen:null}}),Fr&&(We=Fr.box,rr=Fr.offscreen);const Ji=fn(Fr&&Fr.box);if(!We&&this.prevPlacement){const ri=this.prevPlacement.variableOffsets[Ae.crossTileID];ri&&(this.variableOffsets[Ae.crossTileID]=ri,this.markUsedJustification(v,ri.anchor,Ae,Ji))}}}if(xr=Fr,We=xr&&xr.box&&xr.box.length>0,rr=xr&&xr.offscreen,Ae.useRuntimeCollisionCircles){const fn=v.text.placedSymbolArray.get(Ae.centerJustifiedTextSymbolIndex),on=o.ai(v.textSizeData,D,fn),pn=E.get("text-padding");Jr=this.collisionIndex.placeCollisionCircles(V,fn,v.lineVertexArray,v.glyphOffsetArray,on,U,R,g,y,gt,H.predicate,Ae.collisionCircleDiameter,pn,Wt),Jr.circles.length&&Jr.collisionDetected&&!y&&o.w("Collisions detected, but collision boxes are not shown"),We=W||Jr.circles.length>0&&!Jr.collisionDetected,rr=rr&&Jr.offscreen}if(ye.iconFeatureIndex&&(dn=ye.iconFeatureIndex),ye.iconBox){const fn=on=>{const pn=Mt&&Sr?Qn(on,Sr.x,Sr.y,ht,gt,this.transform.angle):on;return this.collisionIndex.placeCollisionBox(pn,lt,w,U,H.predicate,Wt)};tn&&tn.box&&tn.box.length&&ye.verticalIconBox?(Cn=fn(ye.verticalIconBox),nr=Cn.box.length>0):(Cn=fn(ye.iconBox),nr=Cn.box.length>0),rr=rr&&Cn.offscreen}const Fi=z||Ae.numHorizontalGlyphVertices===0&&Ae.numVerticalGlyphVertices===0,Vn=j||Ae.numIconVertices===0;if(Fi||Vn?Vn?Fi||(nr=nr&&We):We=nr&&We:nr=We=nr&&We,We&&xr&&xr.box&&this.collisionIndex.insertCollisionBox(xr.box,V,E.get("text-ignore-placement"),v.bucketInstanceId,tn&&tn.box&&fi?fi:En,H.ID),nr&&Cn&&this.collisionIndex.insertCollisionBox(Cn.box,lt,E.get("icon-ignore-placement"),v.bucketInstanceId,dn,H.ID),Jr&&(We&&this.collisionIndex.insertCollisionCircles(Jr.circles,V,E.get("text-ignore-placement"),v.bucketInstanceId,En,H.ID),y)){const fn=v.bucketInstanceId;let on=this.collisionCircleArrays[fn];on===void 0&&(on=this.collisionCircleArrays[fn]=new mn);for(let pn=0;pn<Jr.circles.length;pn+=4)on.circles.push(Jr.circles[pn+0]),on.circles.push(Jr.circles[pn+1]),on.circles.push(Jr.circles[pn+2]),on.circles.push(Jr.collisionDetected?1:0)}if(Ae.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(v.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Ae.crossTileID]=new Hr(We||_t,nr||bt,rr||v.justReloaded),d[Ae.crossTileID]=!0};if(Tt){if(l.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Ae=v.getSortedSymbolIndexes(this.transform.angle);for(let ye=Ae.length-1;ye>=0;--ye){const Oe=Ae[ye];ue(v.symbolInstances.get(Oe),v.collisionArrays[Oe])}}else for(let Ae=l.symbolInstanceStart;Ae<l.symbolInstanceEnd;Ae++)ue(v.symbolInstances.get(Ae),v.collisionArrays[Ae]);if(y&&v.bucketInstanceId in this.collisionCircleArrays){const Ae=this.collisionCircleArrays[v.bucketInstanceId];o.ar(Ae.invProjMatrix,U),Ae.viewportMatrix=this.collisionIndex.getViewportMatrix()}v.justReloaded=!1}markUsedJustification(l,d,y,v){let E;E=v===o.ah.vertical?y.verticalPlacedTextSymbolIndex:{left:y.leftJustifiedTextSymbolIndex,center:y.centerJustifiedTextSymbolIndex,right:y.rightJustifiedTextSymbolIndex}[o.as(d)];const U=[y.leftJustifiedTextSymbolIndex,y.centerJustifiedTextSymbolIndex,y.rightJustifiedTextSymbolIndex,y.verticalPlacedTextSymbolIndex];for(const R of U)R>=0&&(l.text.placedSymbolArray.get(R).crossTileID=E>=0&&R!==E?0:y.crossTileID)}markUsedOrientation(l,d,y){const v=d===o.ah.horizontal||d===o.ah.horizontalOnly?d:0,E=d===o.ah.vertical?d:0,U=[y.leftJustifiedTextSymbolIndex,y.centerJustifiedTextSymbolIndex,y.rightJustifiedTextSymbolIndex];for(const R of U)l.text.placedSymbolArray.get(R).placedOrientation=v;y.verticalPlacedTextSymbolIndex&&(l.text.placedSymbolArray.get(y.verticalPlacedTextSymbolIndex).placedOrientation=E)}commit(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;const d=this.prevPlacement;let y=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;const v=d?d.symbolFadeChange(l):1,E=d?d.opacities:{},U=d?d.variableOffsets:{},R=d?d.placedOrientations:{};for(const g in this.placements){const w=this.placements[g],T=E[g];T?(this.opacities[g]=new kr(T,v,w.text,w.icon),y=y||w.text!==T.text.placed||w.icon!==T.icon.placed):(this.opacities[g]=new kr(null,v,w.text,w.icon,w.skipFade),y=y||w.text||w.icon)}for(const g in E){const w=E[g];if(!this.opacities[g]){const T=new kr(w,v,!1,!1);T.isHidden()||(this.opacities[g]=T,y=y||w.text.placed||w.icon.placed)}}for(const g in U)this.variableOffsets[g]||!this.opacities[g]||this.opacities[g].isHidden()||(this.variableOffsets[g]=U[g]);for(const g in R)this.placedOrientations[g]||!this.opacities[g]||this.opacities[g].isHidden()||(this.placedOrientations[g]=R[g]);if(d&&d.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");y?this.lastPlacementChangeTime=l:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:l)}updateLayerOpacities(l,d){const y={};for(const v of d){const E=v.getBucket(l);E&&v.latestFeatureIndex&&l.id===E.layerIds[0]&&this.updateBucketOpacities(E,y,v.collisionBoxArray)}}updateBucketOpacities(l,d,y){l.hasTextData()&&(l.text.opacityVertexArray.clear(),l.text.hasVisibleVertices=!1),l.hasIconData()&&(l.icon.opacityVertexArray.clear(),l.icon.hasVisibleVertices=!1),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();const v=l.layers[0],E=v.layout,U=new kr(null,0,!1,!1,!0),R=E.get("text-allow-overlap"),g=E.get("icon-allow-overlap"),w=v._unevaluatedLayout.hasValue("text-variable-anchor")||v._unevaluatedLayout.hasValue("text-variable-anchor-offset"),T=E.get("text-rotation-alignment")==="map",L=E.get("text-pitch-alignment")==="map",D=E.get("icon-text-fit")!=="none",H=new kr(null,0,R&&(g||!l.hasIconData()||E.get("icon-optional")),g&&(R||!l.hasTextData()||E.get("text-optional")),!0);!l.collisionArrays&&y&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(y);const z=(j,V,W)=>{for(let lt=0;lt<V/4;lt++)j.opacityVertexArray.emplaceBack(W);j.hasVisibleVertices=j.hasVisibleVertices||W!==Bi};for(let j=0;j<l.symbolInstances.length;j++){const V=l.symbolInstances.get(j),{numHorizontalGlyphVertices:W,numVerticalGlyphVertices:lt,crossTileID:rt}=V;let ht=this.opacities[rt];d[rt]?ht=U:ht||(ht=H,this.opacities[rt]=ht),d[rt]=!0;const gt=V.numIconVertices>0,Mt=this.placedOrientations[V.crossTileID],Tt=Mt===o.ah.vertical,_t=Mt===o.ah.horizontal||Mt===o.ah.horizontalOnly;if(W>0||lt>0){const bt=sn(ht.text);z(l.text,W,Tt?Bi:bt),z(l.text,lt,_t?Bi:bt);const Gt=ht.text.isHidden();[V.rightJustifiedTextSymbolIndex,V.centerJustifiedTextSymbolIndex,V.leftJustifiedTextSymbolIndex].forEach(Ae=>{Ae>=0&&(l.text.placedSymbolArray.get(Ae).hidden=Gt||Tt?1:0)}),V.verticalPlacedTextSymbolIndex>=0&&(l.text.placedSymbolArray.get(V.verticalPlacedTextSymbolIndex).hidden=Gt||_t?1:0);const Wt=this.variableOffsets[V.crossTileID];Wt&&this.markUsedJustification(l,Wt.anchor,V,Mt);const ue=this.placedOrientations[V.crossTileID];ue&&(this.markUsedJustification(l,"left",V,ue),this.markUsedOrientation(l,ue,V))}if(gt){const bt=sn(ht.icon),Gt=!(D&&V.verticalPlacedIconSymbolIndex&&Tt);V.placedIconSymbolIndex>=0&&(z(l.icon,V.numIconVertices,Gt?bt:Bi),l.icon.placedSymbolArray.get(V.placedIconSymbolIndex).hidden=ht.icon.isHidden()),V.verticalPlacedIconSymbolIndex>=0&&(z(l.icon,V.numVerticalIconVertices,Gt?Bi:bt),l.icon.placedSymbolArray.get(V.verticalPlacedIconSymbolIndex).hidden=ht.icon.isHidden())}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){const bt=l.collisionArrays[j];if(bt){let Gt=new o.P(0,0);if(bt.textBox||bt.verticalTextBox){let ue=!0;if(w){const Ae=this.variableOffsets[rt];Ae?(Gt=bn(Ae.anchor,Ae.width,Ae.height,Ae.textOffset,Ae.textBoxScale),T&&Gt._rotate(L?this.transform.angle:-this.transform.angle)):ue=!1}bt.textBox&&Re(l.textCollisionBox.collisionVertexArray,ht.text.placed,!ue||Tt,Gt.x,Gt.y),bt.verticalTextBox&&Re(l.textCollisionBox.collisionVertexArray,ht.text.placed,!ue||_t,Gt.x,Gt.y)}const Wt=!!(!_t&&bt.verticalIconBox);bt.iconBox&&Re(l.iconCollisionBox.collisionVertexArray,ht.icon.placed,Wt,D?Gt.x:0,D?Gt.y:0),bt.verticalIconBox&&Re(l.iconCollisionBox.collisionVertexArray,ht.icon.placed,!Wt,D?Gt.x:0,D?Gt.y:0)}}}if(l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.text.opacityVertexArray.length!==l.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${l.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${l.text.layoutVertexArray.length}) / 4`);if(l.icon.opacityVertexArray.length!==l.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${l.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${l.icon.layoutVertexArray.length}) / 4`);if(l.bucketInstanceId in this.collisionCircleArrays){const j=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=j.invProjMatrix,l.placementViewportMatrix=j.viewportMatrix,l.collisionCircleArray=j.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}}symbolFadeChange(l){return this.fadeDuration===0?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(l){return Math.max(0,(this.transform.zoom-l)/1.5)}hasTransitions(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(l,d){const y=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*y>l}setStale(){this.stale=!0}}function Re(C,l,d,y,v){C.emplaceBack(l?1:0,d?1:0,y||0,v||0),C.emplaceBack(l?1:0,d?1:0,y||0,v||0),C.emplaceBack(l?1:0,d?1:0,y||0,v||0),C.emplaceBack(l?1:0,d?1:0,y||0,v||0)}const Le=Math.pow(2,25),nn=Math.pow(2,24),Un=Math.pow(2,17),Br=Math.pow(2,16),yn=Math.pow(2,9),xi=Math.pow(2,8),_n=Math.pow(2,1);function sn(C){if(C.opacity===0&&!C.placed)return 0;if(C.opacity===1&&C.placed)return 4294967295;const l=C.placed?1:0,d=Math.floor(127*C.opacity);return d*Le+l*nn+d*Un+l*Br+d*yn+l*xi+d*_n+l}const Bi=0;class Yn{constructor(l){this._sortAcrossTiles=l.layout.get("symbol-z-order")!=="viewport-y"&&!l.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(l,d,y,v,E){const U=this._bucketParts;for(;this._currentTileIndex<l.length;)if(d.getBucketParts(U,v,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,E())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,U.sort((R,g)=>R.sortKey-g.sortKey));this._currentPartIndex<U.length;)if(d.placeLayerBucketPart(U[this._currentPartIndex],this._seenCrossTileIDs,y),this._currentPartIndex++,E())return!0;return!1}}class cs{constructor(l,d,y,v,E,U,R,g){this.placement=new Dt(l,d,U,R,g),this._currentPlacementIndex=y.length-1,this._forceFullPlacement=v,this._showCollisionBoxes=E,this._done=!1}isDone(){return this._done}continuePlacement(l,d,y){const v=_.now(),E=()=>!this._forceFullPlacement&&_.now()-v>2;for(;this._currentPlacementIndex>=0;){const U=d[l[this._currentPlacementIndex]],R=this.placement.collisionIndex.transform.zoom;if(U.type==="symbol"&&(!U.minzoom||U.minzoom<=R)&&(!U.maxzoom||U.maxzoom>R)){if(this._inProgressLayer||(this._inProgressLayer=new Yn(U)),this._inProgressLayer.continuePlacement(y[U.source],this.placement,this._showCollisionBoxes,U,E))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(l){return this.placement.commit(l),this.placement}}const Ns=512/o.W/2;class Vo{constructor(l,d,y){this.tileID=l,this.bucketInstanceId=y,this._symbolsByKey={};const v=new Map;for(let E=0;E<d.length;E++){const U=d.get(E),R=U.key,g=v.get(R);g?g.push(U):v.set(R,[U])}for(const[E,U]of v){const R={positions:U.map(g=>({x:Math.floor(g.anchorX*Ns),y:Math.floor(g.anchorY*Ns)})),crossTileIDs:U.map(g=>g.crossTileID)};if(R.positions.length>128){const g=new o.au(R.positions.length,16,Uint16Array);for(const{x:w,y:T}of R.positions)g.add(w,T);g.finish(),delete R.positions,R.index=g}this._symbolsByKey[E]=R}}getScaledCoordinates(l,d){const{x:y,y:v,z:E}=this.tileID.canonical,{x:U,y:R,z:g}=d.canonical,w=Ns/Math.pow(2,g-E),T=(R*o.W+l.anchorY)*w,L=v*o.W*Ns;return{x:Math.floor((U*o.W+l.anchorX)*w-y*o.W*Ns),y:Math.floor(T-L)}}findMatches(l,d,y){const v=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z);for(let E=0;E<l.length;E++){const U=l.get(E);if(U.crossTileID)continue;const R=this._symbolsByKey[U.key];if(!R)continue;const g=this.getScaledCoordinates(U,d);if(R.index){const w=R.index.range(g.x-v,g.y-v,g.x+v,g.y+v).sort();for(const T of w){const L=R.crossTileIDs[T];if(!y[L]){y[L]=!0,U.crossTileID=L;break}}}else if(R.positions)for(let w=0;w<R.positions.length;w++){const T=R.positions[w],L=R.crossTileIDs[w];if(Math.abs(T.x-g.x)<=v&&Math.abs(T.y-g.y)<=v&&!y[L]){y[L]=!0,U.crossTileID=L;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(l=>{let{crossTileIDs:d}=l;return d})}}class Dr{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Zs{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(l){const d=Math.round((l-this.lng)/360);if(d!==0)for(const y in this.indexes){const v=this.indexes[y],E={};for(const U in v){const R=v[U];R.tileID=R.tileID.unwrapTo(R.tileID.wrap+d),E[R.tileID.key]=R}this.indexes[y]=E}this.lng=l}addBucket(l,d,y){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(let E=0;E<d.symbolInstances.length;E++)d.symbolInstances.get(E).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]={});const v=this.usedCrossTileIDs[l.overscaledZ];for(const E in this.indexes){const U=this.indexes[E];if(Number(E)>l.overscaledZ)for(const R in U){const g=U[R];g.tileID.isChildOf(l)&&g.findMatches(d.symbolInstances,l,v)}else{const R=U[l.scaledTo(Number(E)).key];R&&R.findMatches(d.symbolInstances,l,v)}}for(let E=0;E<d.symbolInstances.length;E++){const U=d.symbolInstances.get(E);U.crossTileID||(U.crossTileID=y.generate(),v[U.crossTileID]=!0)}return this.indexes[l.overscaledZ]===void 0&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new Vo(l,d.symbolInstances,d.bucketInstanceId),!0}removeBucketCrossTileIDs(l,d){for(const y of d.getCrossTileIDsLists())for(const v of y)delete this.usedCrossTileIDs[l][v]}removeStaleBuckets(l){let d=!1;for(const y in this.indexes){const v=this.indexes[y];for(const E in v)l[v[E].bucketInstanceId]||(this.removeBucketCrossTileIDs(y,v[E]),delete v[E],d=!0)}return d}}class Ss{constructor(){this.layerIndexes={},this.crossTileIDs=new Dr,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(l,d,y){let v=this.layerIndexes[l.id];v===void 0&&(v=this.layerIndexes[l.id]=new Zs);let E=!1;const U={};v.handleWrapJump(y);for(const R of d){const g=R.getBucket(l);g&&l.id===g.layerIds[0]&&(g.bucketInstanceId||(g.bucketInstanceId=++this.maxBucketInstanceId),v.addBucket(R.tileID,g,this.crossTileIDs)&&(E=!0),U[g.bucketInstanceId]=!0)}return v.removeStaleBuckets(U)&&(E=!0),E}pruneUnusedLayers(l){const d={};l.forEach(y=>{d[y]=!0});for(const y in this.layerIndexes)d[y]||delete this.layerIndexes[y]}}const In=(C,l)=>o.t(C,l&&l.filter(d=>d.identifier!=="source.canvas")),wo=o.av();class Mi extends o.E{constructor(l){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),this._rtlPluginLoaded=()=>{for(const y in this.sourceCaches){const v=this.sourceCaches[y].getSource().type;v!=="vector"&&v!=="geojson"||this.sourceCaches[y].reload()}},this.map=l,this.dispatcher=new ae(jt(),l._getMapId()),this.dispatcher.registerMessageHandler("GG",(y,v)=>this.getGlyphs(y,v)),this.dispatcher.registerMessageHandler("GI",(y,v)=>this.getImages(y,v)),this.imageManager=new wt,this.imageManager.setEventedParent(this),this.glyphManager=new re(l._requestManager,d.localIdeographFontFamily),this.lineAtlas=new we(256,512),this.crossTileSymbolIndex=new Ss,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new o.aw,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",o.ax()),fe().on(Tr,this._rtlPluginLoaded),this.on("data",y=>{if(y.dataType!=="source"||y.sourceDataType!=="metadata")return;const v=this.sourceCaches[y.sourceId];if(!v)return;const E=v.getSource();if(E&&E.vectorLayerIds)for(const U in this._layers){const R=this._layers[U];R.source===E.id&&this._validateLayer(R)}})}loadURL(l){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},y=arguments.length>2?arguments[2]:void 0;this.fire(new o.k("dataloading",{dataType:"style"})),d.validate=typeof d.validate!="boolean"||d.validate;const v=this.map._requestManager.transformRequest(l,"Style");this._loadStyleRequest=new AbortController,o.h(v,this._loadStyleRequest).then(E=>{this._loadStyleRequest=null,this._load(E.data,d,y)}).catch(E=>{this._loadStyleRequest=null,E&&this.fire(new o.j(E))})}loadJSON(l){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},y=arguments.length>2?arguments[2]:void 0;this.fire(new o.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,_.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,d.validate=d.validate!==!1,this._load(l,d,y)}).catch(()=>{})}loadEmpty(){this.fire(new o.k("dataloading",{dataType:"style"})),this._load(wo,{validate:!1})}_load(l,d,y){var v;const E=d.transformStyle?d.transformStyle(y,l):l;if(!d.validate||!In(this,o.x(E))){this._loaded=!0,this.stylesheet=E;for(const U in E.sources)this.addSource(U,E.sources[U],{validate:!1});E.sprite?this._loadSprite(E.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(E.glyphs),this._createLayers(),this.light=new se(this.stylesheet.light),this.map.setTerrain((v=this.stylesheet.terrain)!==null&&v!==void 0?v:null),this.fire(new o.k("data",{dataType:"style"})),this.fire(new o.k("style.load"))}}_createLayers(){const l=o.ay(this.stylesheet.layers);this.dispatcher.broadcast("SL",l),this._order=l.map(d=>d.id),this._layers={},this._serializedLayers=null;for(const d of l){const y=o.az(d);y.setEventedParent(this,{layer:{id:d.id}}),this._layers[d.id]=y}}_loadSprite(l){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,y=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0,v;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(E,U,R,g){return o._(this,void 0,void 0,function*(){const w=Lt(E),T=R>1?"@2x":"",L={},D={};for(const{id:H,url:z}of w){const j=U.transformRequest(U.normalizeSpriteURL(z,T,".json"),"SpriteJSON");L[H]=o.h(j,g);const V=U.transformRequest(U.normalizeSpriteURL(z,T,".png"),"SpriteImage");D[H]=J.getImage(V,g)}return yield Promise.all([...Object.values(L),...Object.values(D)]),function(H,z){return o._(this,void 0,void 0,function*(){const j={};for(const V in H){j[V]={};const W=_.getImageCanvasContext((yield z[V]).data),lt=(yield H[V]).data;for(const rt in lt){const{width:ht,height:gt,x:Mt,y:Tt,sdf:_t,pixelRatio:bt,stretchX:Gt,stretchY:Wt,content:ue}=lt[rt];j[V][rt]={data:null,pixelRatio:bt,sdf:_t,stretchX:Gt,stretchY:Wt,content:ue,spriteData:{width:ht,height:gt,x:Mt,y:Tt,context:W}}}}return j})}(L,D)})}(l,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(E=>{if(this._spriteRequest=null,E)for(const U in E){this._spritesImagesIds[U]=[];const R=this._spritesImagesIds[U]?this._spritesImagesIds[U].filter(g=>!(g in E)):[];for(const g of R)this.imageManager.removeImage(g),this._changedImages[g]=!0;for(const g in E[U]){const w=U==="default"?g:`${U}:${g}`;this._spritesImagesIds[U].push(w),w in this.imageManager.images?this.imageManager.updateImage(w,E[U][g],!1):this.imageManager.addImage(w,E[U][g]),d&&(this._changedImages[w]=!0)}}}).catch(E=>{this._spriteRequest=null,v=E,this.fire(new o.j(v))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),d&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.k("data",{dataType:"style"})),y&&y(v)})}_unloadSprite(){for(const l of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(l),this._changedImages[l]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.k("data",{dataType:"style"}))}_validateLayer(l){const d=this.sourceCaches[l.source];if(!d)return;const y=l.sourceLayer;if(!y)return;const v=d.getSource();(v.type==="geojson"||v.vectorLayerIds&&v.vectorLayerIds.indexOf(y)===-1)&&this.fire(new o.j(new Error(`Source layer "${y}" does not exist on source "${v.id}" as specified by style layer "${l.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const l in this.sourceCaches)if(!this.sourceCaches[l].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(l){const d=this._serializedAllLayers();if(!l||l.length===0)return Object.values(d);const y=[];for(const v of l)d[v]&&y.push(d[v]);return y}_serializedAllLayers(){let l=this._serializedLayers;if(l)return l;l=this._serializedLayers={};const d=Object.keys(this._layers);for(const y of d){const v=this._layers[y];v.type!=="custom"&&(l[y]=v.serialize())}return l}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const l in this.sourceCaches)if(this.sourceCaches[l].hasTransition())return!0;for(const l in this._layers)if(this._layers[l].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(l){if(!this._loaded)return;const d=this._changed;if(d){const v=Object.keys(this._updatedLayers),E=Object.keys(this._removedLayers);(v.length||E.length)&&this._updateWorkerLayers(v,E);for(const U in this._updatedSources){const R=this._updatedSources[U];if(R==="reload")this._reloadSource(U);else{if(R!=="clear")throw new Error(`Invalid action ${R}`);this._clearSource(U)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const U in this._updatedPaintProps)this._layers[U].updateTransitions(l);this.light.updateTransitions(l),this._resetUpdates()}const y={};for(const v in this.sourceCaches){const E=this.sourceCaches[v];y[v]=E.used,E.used=!1}for(const v of this._order){const E=this._layers[v];E.recalculate(l,this._availableImages),!E.isHidden(l.zoom)&&E.source&&(this.sourceCaches[E.source].used=!0)}for(const v in y){const E=this.sourceCaches[v];!!y[v]!=!!E.used&&E.fire(new o.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:v}))}this.light.recalculate(l),this.z=l.zoom,d&&this.fire(new o.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const l=Object.keys(this._changedImages);if(l.length){for(const d in this.sourceCaches)this.sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],l);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const l in this.sourceCaches)this.sourceCaches[l].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(l,d){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(l),removedIds:d})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(l){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var y;this._checkLoaded();const v=this.serialize();if(l=d.transformStyle?d.transformStyle(v,l):l,((y=d.validate)===null||y===void 0||y)&&In(this,o.x(l)))return!1;(l=o.aA(l)).layers=o.ay(l.layers);const E=o.aB(v,l),U=this._getOperationsToPerform(E);if(U.unimplemented.length>0)throw new Error(`Unimplemented: ${U.unimplemented.join(", ")}.`);if(U.operations.length===0)return!1;for(const R of U.operations)R();return this.stylesheet=l,this._serializedLayers=null,!0}_getOperationsToPerform(l){const d=[],y=[];for(const v of l)switch(v.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":d.push(()=>this.addLayer.apply(this,v.args));break;case"removeLayer":d.push(()=>this.removeLayer.apply(this,v.args));break;case"setPaintProperty":d.push(()=>this.setPaintProperty.apply(this,v.args));break;case"setLayoutProperty":d.push(()=>this.setLayoutProperty.apply(this,v.args));break;case"setFilter":d.push(()=>this.setFilter.apply(this,v.args));break;case"addSource":d.push(()=>this.addSource.apply(this,v.args));break;case"removeSource":d.push(()=>this.removeSource.apply(this,v.args));break;case"setLayerZoomRange":d.push(()=>this.setLayerZoomRange.apply(this,v.args));break;case"setLight":d.push(()=>this.setLight.apply(this,v.args));break;case"setGeoJSONSourceData":d.push(()=>this.setGeoJSONSourceData.apply(this,v.args));break;case"setGlyphs":d.push(()=>this.setGlyphs.apply(this,v.args));break;case"setSprite":d.push(()=>this.setSprite.apply(this,v.args));break;case"setTerrain":d.push(()=>this.map.setTerrain.apply(this,v.args));break;case"setTransition":d.push(()=>{});break;default:y.push(v.command)}return{operations:d,unimplemented:y}}addImage(l,d){if(this.getImage(l))return this.fire(new o.j(new Error(`An image named "${l}" already exists.`)));this.imageManager.addImage(l,d),this._afterImageUpdated(l)}updateImage(l,d){this.imageManager.updateImage(l,d)}getImage(l){return this.imageManager.getImage(l)}removeImage(l){if(!this.getImage(l))return this.fire(new o.j(new Error(`An image named "${l}" does not exist.`)));this.imageManager.removeImage(l),this._afterImageUpdated(l)}_afterImageUpdated(l){this._availableImages=this.imageManager.listImages(),this._changedImages[l]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(l,d){let y=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(this._checkLoaded(),this.sourceCaches[l]!==void 0)throw new Error(`Source "${l}" already exists.`);if(!d.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(d).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(o.x.source,`sources.${l}`,d,null,y))return;this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);const v=this.sourceCaches[l]=new Pr(l,d,this.dispatcher);v.style=this,v.setEventedParent(this,()=>({isSourceLoaded:v.loaded(),source:v.serialize(),sourceId:l})),v.onAdd(this.map),this._changed=!0}removeSource(l){if(this._checkLoaded(),this.sourceCaches[l]===void 0)throw new Error("There is no source with this ID");for(const y in this._layers)if(this._layers[y].source===l)return this.fire(new o.j(new Error(`Source "${l}" cannot be removed while layer "${y}" is using it.`)));const d=this.sourceCaches[l];delete this.sourceCaches[l],delete this._updatedSources[l],d.fire(new o.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:l})),d.setEventedParent(null),d.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(l,d){if(this._checkLoaded(),this.sourceCaches[l]===void 0)throw new Error(`There is no source with this ID=${l}`);const y=this.sourceCaches[l].getSource();if(y.type!=="geojson")throw new Error(`geojsonSource.type is ${y.type}, which is !== 'geojson`);y.setData(d),this._changed=!0}getSource(l){return this.sourceCaches[l]&&this.sourceCaches[l].getSource()}addLayer(l,d){let y=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this._checkLoaded();const v=l.id;if(this.getLayer(v))return void this.fire(new o.j(new Error(`Layer "${v}" already exists on this map.`)));let E;if(l.type==="custom"){if(In(this,o.aC(l)))return;E=o.az(l)}else{if("source"in l&&typeof l.source=="object"&&(this.addSource(v,l.source),l=o.aA(l),l=o.e(l,{source:v})),this._validate(o.x.layer,`layers.${v}`,l,{arrayIndex:-1},y))return;E=o.az(l),this._validateLayer(E),E.setEventedParent(this,{layer:{id:v}})}const U=d?this._order.indexOf(d):this._order.length;if(d&&U===-1)this.fire(new o.j(new Error(`Cannot add layer "${v}" before non-existing layer "${d}".`)));else{if(this._order.splice(U,0,v),this._layerOrderChanged=!0,this._layers[v]=E,this._removedLayers[v]&&E.source&&E.type!=="custom"){const R=this._removedLayers[v];delete this._removedLayers[v],R.type!==E.type?this._updatedSources[E.source]="clear":(this._updatedSources[E.source]="reload",this.sourceCaches[E.source].pause())}this._updateLayer(E),E.onAdd&&E.onAdd(this.map)}}moveLayer(l,d){if(this._checkLoaded(),this._changed=!0,!this._layers[l])return void this.fire(new o.j(new Error(`The layer '${l}' does not exist in the map's style and cannot be moved.`)));if(l===d)return;const y=this._order.indexOf(l);this._order.splice(y,1);const v=d?this._order.indexOf(d):this._order.length;d&&v===-1?this.fire(new o.j(new Error(`Cannot move layer "${l}" before non-existing layer "${d}".`))):(this._order.splice(v,0,l),this._layerOrderChanged=!0)}removeLayer(l){this._checkLoaded();const d=this._layers[l];if(!d)return void this.fire(new o.j(new Error(`Cannot remove non-existing layer "${l}".`)));d.setEventedParent(null);const y=this._order.indexOf(l);this._order.splice(y,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[l]=d,delete this._layers[l],this._serializedLayers&&delete this._serializedLayers[l],delete this._updatedLayers[l],delete this._updatedPaintProps[l],d.onRemove&&d.onRemove(this.map)}getLayer(l){return this._layers[l]}getLayersOrder(){return[...this._order]}hasLayer(l){return l in this._layers}setLayerZoomRange(l,d,y){this._checkLoaded();const v=this.getLayer(l);v?v.minzoom===d&&v.maxzoom===y||(d!=null&&(v.minzoom=d),y!=null&&(v.maxzoom=y),this._updateLayer(v)):this.fire(new o.j(new Error(`Cannot set the zoom range of non-existing layer "${l}".`)))}setFilter(l,d){let y=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this._checkLoaded();const v=this.getLayer(l);if(v){if(!o.aD(v.filter,d))return d==null?(v.filter=void 0,void this._updateLayer(v)):void(this._validate(o.x.filter,`layers.${v.id}.filter`,d,null,y)||(v.filter=o.aA(d),this._updateLayer(v)))}else this.fire(new o.j(new Error(`Cannot filter non-existing layer "${l}".`)))}getFilter(l){return o.aA(this.getLayer(l).filter)}setLayoutProperty(l,d,y){let v=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};this._checkLoaded();const E=this.getLayer(l);E?o.aD(E.getLayoutProperty(d),y)||(E.setLayoutProperty(d,y,v),this._updateLayer(E)):this.fire(new o.j(new Error(`Cannot style non-existing layer "${l}".`)))}getLayoutProperty(l,d){const y=this.getLayer(l);if(y)return y.getLayoutProperty(d);this.fire(new o.j(new Error(`Cannot get style of non-existing layer "${l}".`)))}setPaintProperty(l,d,y){let v=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};this._checkLoaded();const E=this.getLayer(l);E?o.aD(E.getPaintProperty(d),y)||(E.setPaintProperty(d,y,v)&&this._updateLayer(E),this._changed=!0,this._updatedPaintProps[l]=!0,this._serializedLayers=null):this.fire(new o.j(new Error(`Cannot style non-existing layer "${l}".`)))}getPaintProperty(l,d){return this.getLayer(l).getPaintProperty(d)}setFeatureState(l,d){this._checkLoaded();const y=l.source,v=l.sourceLayer,E=this.sourceCaches[y];if(E===void 0)return void this.fire(new o.j(new Error(`The source '${y}' does not exist in the map's style.`)));const U=E.getSource().type;U==="geojson"&&v?this.fire(new o.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):U!=="vector"||v?(l.id===void 0&&this.fire(new o.j(new Error("The feature id parameter must be provided."))),E.setFeatureState(v,l.id,d)):this.fire(new o.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(l,d){this._checkLoaded();const y=l.source,v=this.sourceCaches[y];if(v===void 0)return void this.fire(new o.j(new Error(`The source '${y}' does not exist in the map's style.`)));const E=v.getSource().type,U=E==="vector"?l.sourceLayer:void 0;E!=="vector"||U?d&&typeof l.id!="string"&&typeof l.id!="number"?this.fire(new o.j(new Error("A feature id is required to remove its specific state property."))):v.removeFeatureState(U,l.id,d):this.fire(new o.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(l){this._checkLoaded();const d=l.source,y=l.sourceLayer,v=this.sourceCaches[d];if(v!==void 0)return v.getSource().type!=="vector"||y?(l.id===void 0&&this.fire(new o.j(new Error("The feature id parameter must be provided."))),v.getFeatureState(y,l.id)):void this.fire(new o.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new o.j(new Error(`The source '${d}' does not exist in the map's style.`)))}getTransition(){return o.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const l=o.aE(this.sourceCaches,E=>E.serialize()),d=this._serializeByIds(this._order),y=this.map.getTerrain()||void 0,v=this.stylesheet;return o.aF({version:v.version,name:v.name,metadata:v.metadata,light:v.light,center:v.center,zoom:v.zoom,bearing:v.bearing,pitch:v.pitch,sprite:v.sprite,glyphs:v.glyphs,transition:v.transition,sources:l,layers:d,terrain:y},E=>E!==void 0)}_updateLayer(l){this._updatedLayers[l.id]=!0,l.source&&!this._updatedSources[l.source]&&this.sourceCaches[l.source].getSource().type!=="raster"&&(this._updatedSources[l.source]="reload",this.sourceCaches[l.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(l){const d=U=>this._layers[U].type==="fill-extrusion",y={},v=[];for(let U=this._order.length-1;U>=0;U--){const R=this._order[U];if(d(R)){y[R]=U;for(const g of l){const w=g[R];if(w)for(const T of w)v.push(T)}}}v.sort((U,R)=>R.intersectionZ-U.intersectionZ);const E=[];for(let U=this._order.length-1;U>=0;U--){const R=this._order[U];if(d(R))for(let g=v.length-1;g>=0;g--){const w=v[g].feature;if(y[w.layer.id]<U)break;E.push(w),v.pop()}else for(const g of l){const w=g[R];if(w)for(const T of w)E.push(T.feature)}}return E}queryRenderedFeatures(l,d,y){d&&d.filter&&this._validate(o.x.filter,"queryRenderedFeatures.filter",d.filter,null,d);const v={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new o.j(new Error("parameters.layers must be an Array."))),[];for(const R of d.layers){const g=this._layers[R];if(!g)return this.fire(new o.j(new Error(`The layer '${R}' does not exist in the map's style and cannot be queried for features.`))),[];v[g.source]=!0}}const E=[];d.availableImages=this._availableImages;const U=this._serializedAllLayers();for(const R in this.sourceCaches)d.layers&&!v[R]||E.push(Ie(this.sourceCaches[R],this._layers,U,l,d,y));return this.placement&&E.push(function(R,g,w,T,L,D,H){const z={},j=D.queryRenderedSymbols(T),V=[];for(const W of Object.keys(j).map(Number))V.push(H[W]);V.sort(Qe);for(const W of V){const lt=W.featureIndex.lookupSymbolFeatures(j[W.bucketInstanceId],g,W.bucketIndex,W.sourceLayerIndex,L.filter,L.layers,L.availableImages,R);for(const rt in lt){const ht=z[rt]=z[rt]||[],gt=lt[rt];gt.sort((Mt,Tt)=>{const _t=W.featureSortOrder;if(_t){const bt=_t.indexOf(Mt.featureIndex);return _t.indexOf(Tt.featureIndex)-bt}return Tt.featureIndex-Mt.featureIndex});for(const Mt of gt)ht.push(Mt)}}for(const W in z)z[W].forEach(lt=>{const rt=lt.feature,ht=w[R[W].source].getFeatureState(rt.layer["source-layer"],rt.id);rt.source=rt.layer.source,rt.layer["source-layer"]&&(rt.sourceLayer=rt.layer["source-layer"]),rt.state=ht});return z}(this._layers,U,this.sourceCaches,l,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(E)}querySourceFeatures(l,d){d&&d.filter&&this._validate(o.x.filter,"querySourceFeatures.filter",d.filter,null,d);const y=this.sourceCaches[l];return y?function(v,E){const U=v.getRenderableIds().map(w=>v.getTileByID(w)),R=[],g={};for(let w=0;w<U.length;w++){const T=U[w],L=T.tileID.canonical.key;g[L]||(g[L]=!0,T.querySourceFeatures(R,E))}return R}(y,d):[]}getLight(){return this.light.getLight()}setLight(l){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this._checkLoaded();const y=this.light.getLight();let v=!1;for(const U in l)if(!o.aD(l[U],y[U])){v=!0;break}if(!v)return;const E={now:_.now(),transition:o.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(l,d),this.light.updateTransitions(E)}_validate(l,d,y,v){let E=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};return(!E||E.validate!==!1)&&In(this,l.call(o.x,o.e({key:d,style:this.serialize(),value:y,styleSpec:o.v},v)))}_remove(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),fe().off(Tr,this._rtlPluginLoaded);for(const d in this._layers)this._layers[d].setEventedParent(null);for(const d in this.sourceCaches){const y=this.sourceCaches[d];y.setEventedParent(null),y.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),l&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(l)}_clearSource(l){this.sourceCaches[l].clearTiles()}_reloadSource(l){this.sourceCaches[l].resume(),this.sourceCaches[l].reload()}_updateSources(l){for(const d in this.sourceCaches)this.sourceCaches[d].update(l,this.map.terrain)}_generateCollisionBoxes(){for(const l in this.sourceCaches)this._reloadSource(l)}_updatePlacement(l,d,y,v){let E=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1,U=!1,R=!1;const g={};for(const w of this._order){const T=this._layers[w];if(T.type!=="symbol")continue;if(!g[T.source]){const D=this.sourceCaches[T.source];g[T.source]=D.getRenderableIds(!0).map(H=>D.getTileByID(H)).sort((H,z)=>z.tileID.overscaledZ-H.tileID.overscaledZ||(H.tileID.isLessThan(z.tileID)?-1:1))}const L=this.crossTileSymbolIndex.addLayer(T,g[T.source],l.center.lng);U=U||L}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((E=E||this._layerOrderChanged||y===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(_.now(),l.zoom))&&(this.pauseablePlacement=new cs(l,this.map.terrain,this._order,E,d,y,v,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,g),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(_.now()),R=!0),U&&this.pauseablePlacement.placement.setStale()),R||U)for(const w of this._order){const T=this._layers[w];T.type==="symbol"&&this.placement.updateLayerOpacities(T,g[T.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(_.now())}_releaseSymbolFadeTiles(){for(const l in this.sourceCaches)this.sourceCaches[l].releaseSymbolFadeTiles()}getImages(l,d){return o._(this,void 0,void 0,function*(){const y=yield this.imageManager.getImages(d.icons);this._updateTilesForChangedImages();const v=this.sourceCaches[d.source];return v&&v.setDependencies(d.tileID.key,d.type,d.icons),y})}getGlyphs(l,d){return o._(this,void 0,void 0,function*(){const y=yield this.glyphManager.getGlyphs(d.stacks),v=this.sourceCaches[d.source];return v&&v.setDependencies(d.tileID.key,d.type,[""]),y})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(l){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this._checkLoaded(),l&&this._validate(o.x.glyphs,"glyphs",l,null,d)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=l,this.glyphManager.entries={},this.glyphManager.setURL(l))}addSprite(l,d){let y=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},v=arguments.length>3?arguments[3]:void 0;this._checkLoaded();const E=[{id:l,url:d}],U=[...Lt(this.stylesheet.sprite),...E];this._validate(o.x.sprite,"sprite",U,null,y)||(this.stylesheet.sprite=U,this._loadSprite(E,!0,v))}removeSprite(l){this._checkLoaded();const d=Lt(this.stylesheet.sprite);if(d.find(y=>y.id===l)){if(this._spritesImagesIds[l])for(const y of this._spritesImagesIds[l])this.imageManager.removeImage(y),this._changedImages[y]=!0;d.splice(d.findIndex(y=>y.id===l),1),this.stylesheet.sprite=d.length>0?d:void 0,delete this._spritesImagesIds[l],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.k("data",{dataType:"style"}))}else this.fire(new o.j(new Error(`Sprite "${l}" doesn't exists on this map.`)))}getSprite(){return Lt(this.stylesheet.sprite)}setSprite(l){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},y=arguments.length>2?arguments[2]:void 0;this._checkLoaded(),l&&this._validate(o.x.sprite,"sprite",l,null,d)||(this.stylesheet.sprite=l,l?this._loadSprite(l,!0,y):(this._unloadSprite(),y&&y(null)))}}var Ui=o.X([{name:"a_pos",type:"Int16",components:2}]),Zn="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const Li={prelude:cn(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:cn(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:cn(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:cn(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:cn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:cn(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:cn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:cn("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:cn("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:cn("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:cn(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:cn(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:cn(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:cn(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:cn(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:cn(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:cn(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:cn(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:cn(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:cn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:cn(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:cn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:cn(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:cn(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:cn(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:cn(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:cn("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Zn),terrainDepth:cn("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Zn),terrainCoords:cn("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Zn)};function cn(C,l){const d=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,y=l.match(/attribute ([\w]+) ([\w]+)/g),v=C.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),E=l.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),U=E?E.concat(v):v,R={};return{fragmentSource:C=C.replace(d,(g,w,T,L,D)=>(R[D]=!0,w==="define"?`
#ifndef HAS_UNIFORM_u_${D}
varying ${T} ${L} ${D};
#else
uniform ${T} ${L} u_${D};
#endif
`:`
#ifdef HAS_UNIFORM_u_${D}
    ${T} ${L} ${D} = u_${D};
#endif
`)),vertexSource:l=l.replace(d,(g,w,T,L,D)=>{const H=L==="float"?"vec2":"vec4",z=D.match(/color/)?"color":H;return R[D]?w==="define"?`
#ifndef HAS_UNIFORM_u_${D}
uniform lowp float u_${D}_t;
attribute ${T} ${H} a_${D};
varying ${T} ${L} ${D};
#else
uniform ${T} ${L} u_${D};
#endif
`:z==="vec4"?`
#ifndef HAS_UNIFORM_u_${D}
    ${D} = a_${D};
#else
    ${T} ${L} ${D} = u_${D};
#endif
`:`
#ifndef HAS_UNIFORM_u_${D}
    ${D} = unpack_mix_${z}(a_${D}, u_${D}_t);
#else
    ${T} ${L} ${D} = u_${D};
#endif
`:w==="define"?`
#ifndef HAS_UNIFORM_u_${D}
uniform lowp float u_${D}_t;
attribute ${T} ${H} a_${D};
#else
uniform ${T} ${L} u_${D};
#endif
`:z==="vec4"?`
#ifndef HAS_UNIFORM_u_${D}
    ${T} ${L} ${D} = a_${D};
#else
    ${T} ${L} ${D} = u_${D};
#endif
`:`
#ifndef HAS_UNIFORM_u_${D}
    ${T} ${L} ${D} = unpack_mix_${z}(a_${D}, u_${D}_t);
#else
    ${T} ${L} ${D} = u_${D};
#endif
`}),staticAttributes:y,staticUniforms:U}}class jo{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(l,d,y,v,E,U,R,g,w){this.context=l;let T=this.boundPaintVertexBuffers.length!==v.length;for(let L=0;!T&&L<v.length;L++)this.boundPaintVertexBuffers[L]!==v[L]&&(T=!0);!this.vao||this.boundProgram!==d||this.boundLayoutVertexBuffer!==y||T||this.boundIndexBuffer!==E||this.boundVertexOffset!==U||this.boundDynamicVertexBuffer!==R||this.boundDynamicVertexBuffer2!==g||this.boundDynamicVertexBuffer3!==w?this.freshBind(d,y,v,E,U,R,g,w):(l.bindVertexArray.set(this.vao),R&&R.bind(),E&&E.dynamicDraw&&E.bind(),g&&g.bind(),w&&w.bind())}freshBind(l,d,y,v,E,U,R,g){const w=l.numAttributes,T=this.context,L=T.gl;this.vao&&this.destroy(),this.vao=T.createVertexArray(),T.bindVertexArray.set(this.vao),this.boundProgram=l,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=y,this.boundIndexBuffer=v,this.boundVertexOffset=E,this.boundDynamicVertexBuffer=U,this.boundDynamicVertexBuffer2=R,this.boundDynamicVertexBuffer3=g,d.enableAttributes(L,l);for(const D of y)D.enableAttributes(L,l);U&&U.enableAttributes(L,l),R&&R.enableAttributes(L,l),g&&g.enableAttributes(L,l),d.bind(),d.setVertexAttribPointers(L,l,E);for(const D of y)D.bind(),D.setVertexAttribPointers(L,l,E);U&&(U.bind(),U.setVertexAttribPointers(L,l,E)),v&&v.bind(),R&&(R.bind(),R.setVertexAttribPointers(L,l,E)),g&&(g.bind(),g.setVertexAttribPointers(L,l,E)),T.currentNumAttributes=w}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function qo(C){const l=[];for(let d=0;d<C.length;d++){if(C[d]===null)continue;const y=C[d].split(" ");l.push(y.pop())}return l}class to{constructor(l,d,y,v,E,U){const R=l.gl;this.program=R.createProgram();const g=qo(d.staticAttributes),w=y?y.getBinderAttributes():[],T=g.concat(w),L=Li.prelude.staticUniforms?qo(Li.prelude.staticUniforms):[],D=d.staticUniforms?qo(d.staticUniforms):[],H=y?y.getBinderUniforms():[],z=L.concat(D).concat(H),j=[];for(const Mt of z)j.indexOf(Mt)<0&&j.push(Mt);const V=y?y.defines():[];E&&V.push("#define OVERDRAW_INSPECTOR;"),U&&V.push("#define TERRAIN3D;");const W=V.concat(Li.prelude.fragmentSource,d.fragmentSource).join(`
`),lt=V.concat(Li.prelude.vertexSource,d.vertexSource).join(`
`),rt=R.createShader(R.FRAGMENT_SHADER);if(R.isContextLost())return void(this.failedToCreate=!0);if(R.shaderSource(rt,W),R.compileShader(rt),!R.getShaderParameter(rt,R.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${R.getShaderInfoLog(rt)}`);R.attachShader(this.program,rt);const ht=R.createShader(R.VERTEX_SHADER);if(R.isContextLost())return void(this.failedToCreate=!0);if(R.shaderSource(ht,lt),R.compileShader(ht),!R.getShaderParameter(ht,R.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${R.getShaderInfoLog(ht)}`);R.attachShader(this.program,ht),this.attributes={};const gt={};this.numAttributes=T.length;for(let Mt=0;Mt<this.numAttributes;Mt++)T[Mt]&&(R.bindAttribLocation(this.program,Mt,T[Mt]),this.attributes[T[Mt]]=Mt);if(R.linkProgram(this.program),!R.getProgramParameter(this.program,R.LINK_STATUS))throw new Error(`Program failed to link: ${R.getProgramInfoLog(this.program)}`);R.deleteShader(ht),R.deleteShader(rt);for(let Mt=0;Mt<j.length;Mt++){const Tt=j[Mt];if(Tt&&!gt[Tt]){const _t=R.getUniformLocation(this.program,Tt);_t&&(gt[Tt]=_t)}}this.fixedUniforms=v(l,gt),this.terrainUniforms=((Mt,Tt)=>({u_depth:new o.aG(Mt,Tt.u_depth),u_terrain:new o.aG(Mt,Tt.u_terrain),u_terrain_dim:new o.aH(Mt,Tt.u_terrain_dim),u_terrain_matrix:new o.aI(Mt,Tt.u_terrain_matrix),u_terrain_unpack:new o.aJ(Mt,Tt.u_terrain_unpack),u_terrain_exaggeration:new o.aH(Mt,Tt.u_terrain_exaggeration)}))(l,gt),this.binderUniforms=y?y.getUniforms(l,gt):[]}draw(l,d,y,v,E,U,R,g,w,T,L,D,H,z,j,V,W,lt){const rt=l.gl;if(this.failedToCreate)return;if(l.program.set(this.program),l.setDepthMode(y),l.setStencilMode(v),l.setColorMode(E),l.setCullFace(U),g){l.activeTexture.set(rt.TEXTURE2),rt.bindTexture(rt.TEXTURE_2D,g.depthTexture),l.activeTexture.set(rt.TEXTURE3),rt.bindTexture(rt.TEXTURE_2D,g.texture);for(const gt in this.terrainUniforms)this.terrainUniforms[gt].set(g[gt])}for(const gt in this.fixedUniforms)this.fixedUniforms[gt].set(R[gt]);j&&j.setUniforms(l,this.binderUniforms,H,{zoom:z});let ht=0;switch(d){case rt.LINES:ht=2;break;case rt.TRIANGLES:ht=3;break;case rt.LINE_STRIP:ht=1}for(const gt of D.get()){const Mt=gt.vaos||(gt.vaos={});(Mt[w]||(Mt[w]=new jo)).bind(l,this,T,j?j.getPaintVertexBuffers():[],L,gt.vertexOffset,V,W,lt),rt.drawElements(d,gt.primitiveLength*ht,rt.UNSIGNED_SHORT,gt.primitiveOffset*ht*2)}}}function mc(C,l,d){const y=1/lr(d,1,l.transform.tileZoom),v=Math.pow(2,d.tileID.overscaledZ),E=d.tileSize*Math.pow(2,l.transform.tileZoom)/v,U=E*(d.tileID.canonical.x+d.tileID.wrap*v),R=E*d.tileID.canonical.y;return{u_image:0,u_texsize:d.imageAtlasTexture.size,u_scale:[y,C.fromScale,C.toScale],u_fade:C.t,u_pixel_coord_upper:[U>>16,R>>16],u_pixel_coord_lower:[65535&U,65535&R]}}const At=(C,l,d,y)=>{const v=l.style.light,E=v.properties.get("position"),U=[E.x,E.y,E.z],R=function(){var w=new o.A(9);return o.A!=Float32Array&&(w[1]=0,w[2]=0,w[3]=0,w[5]=0,w[6]=0,w[7]=0),w[0]=1,w[4]=1,w[8]=1,w}();v.properties.get("anchor")==="viewport"&&function(w,T){var L=Math.sin(T),D=Math.cos(T);w[0]=D,w[1]=L,w[2]=0,w[3]=-L,w[4]=D,w[5]=0,w[6]=0,w[7]=0,w[8]=1}(R,-l.transform.angle),function(w,T,L){var D=T[0],H=T[1],z=T[2];w[0]=D*L[0]+H*L[3]+z*L[6],w[1]=D*L[1]+H*L[4]+z*L[7],w[2]=D*L[2]+H*L[5]+z*L[8]}(U,U,R);const g=v.properties.get("color");return{u_matrix:C,u_lightpos:U,u_lightintensity:v.properties.get("intensity"),u_lightcolor:[g.r,g.g,g.b],u_vertical_gradient:+d,u_opacity:y}},xt=(C,l,d,y,v,E,U)=>o.e(At(C,l,d,y),mc(E,l,U),{u_height_factor:-Math.pow(2,v.overscaledZ)/U.tileSize/8}),Qt=C=>({u_matrix:C}),he=(C,l,d,y)=>o.e(Qt(C),mc(d,l,y)),Pe=(C,l)=>({u_matrix:C,u_world:l}),sr=(C,l,d,y,v)=>o.e(he(C,l,d,y),{u_world:v}),zr=(C,l,d,y)=>{const v=C.transform;let E,U;if(y.paint.get("circle-pitch-alignment")==="map"){const R=lr(d,1,v.zoom);E=!0,U=[R,R]}else E=!1,U=v.pixelsToGLUnits;return{u_camera_to_center_distance:v.cameraToCenterDistance,u_scale_with_map:+(y.paint.get("circle-pitch-scale")==="map"),u_matrix:C.translatePosMatrix(l.posMatrix,d,y.paint.get("circle-translate"),y.paint.get("circle-translate-anchor")),u_pitch_with_map:+E,u_device_pixel_ratio:C.pixelRatio,u_extrude_scale:U}},Wn=(C,l,d)=>{const y=lr(d,1,l.zoom),v=Math.pow(2,l.zoom-d.tileID.overscaledZ),E=d.tileID.overscaleFactor();return{u_matrix:C,u_camera_to_center_distance:l.cameraToCenterDistance,u_pixels_to_tile_units:y,u_extrude_scale:[l.pixelsToGLUnits[0]/(y*v),l.pixelsToGLUnits[1]/(y*v)],u_overscale_factor:E}},ti=function(C,l){let d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;return{u_matrix:C,u_color:l,u_overlay:0,u_overlay_scale:d}},Ai=C=>({u_matrix:C}),Hn=(C,l,d,y)=>({u_matrix:C,u_extrude_scale:lr(l,1,d),u_intensity:y});function ah(C,l){const d=Math.pow(2,l.canonical.z),y=l.canonical.y;return[new o.Y(0,y/d).toLngLat().lat,new o.Y(0,(y+1)/d).toLngLat().lat]}const ul=(C,l,d,y)=>{const v=C.transform;return{u_matrix:yc(C,l,d,y),u_ratio:1/lr(l,1,v.zoom),u_device_pixel_ratio:C.pixelRatio,u_units_to_pixels:[1/v.pixelsToGLUnits[0],1/v.pixelsToGLUnits[1]]}},Vr=(C,l,d,y,v)=>o.e(ul(C,l,d,v),{u_image:0,u_image_height:y}),za=(C,l,d,y,v)=>{const E=C.transform,U=vi(l,E);return{u_matrix:yc(C,l,d,v),u_texsize:l.imageAtlasTexture.size,u_ratio:1/lr(l,1,E.zoom),u_device_pixel_ratio:C.pixelRatio,u_image:0,u_scale:[U,y.fromScale,y.toScale],u_fade:y.t,u_units_to_pixels:[1/E.pixelsToGLUnits[0],1/E.pixelsToGLUnits[1]]}},su=(C,l,d,y,v,E)=>{const U=C.lineAtlas,R=vi(l,C.transform),g=d.layout.get("line-cap")==="round",w=U.getDash(y.from,g),T=U.getDash(y.to,g),L=w.width*v.fromScale,D=T.width*v.toScale;return o.e(ul(C,l,d,E),{u_patternscale_a:[R/L,-w.height/2],u_patternscale_b:[R/D,-T.height/2],u_sdfgamma:U.width/(256*Math.min(L,D)*C.pixelRatio)/2,u_image:0,u_tex_y_a:w.y,u_tex_y_b:T.y,u_mix:v.t})};function vi(C,l){return 1/lr(C,1,l.tileZoom)}function yc(C,l,d,y){return C.translatePosMatrix(y?y.posMatrix:l.tileID.posMatrix,l,d.paint.get("line-translate"),d.paint.get("line-translate-anchor"))}const Al=(C,l,d,y,v)=>{return{u_matrix:C,u_tl_parent:l,u_scale_parent:d,u_buffer_scale:1,u_fade_t:y.mix,u_opacity:y.opacity*v.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:v.paint.get("raster-brightness-min"),u_brightness_high:v.paint.get("raster-brightness-max"),u_saturation_factor:(U=v.paint.get("raster-saturation"),U>0?1-1/(1.001-U):-U),u_contrast_factor:(E=v.paint.get("raster-contrast"),E>0?1/(1-E):1+E),u_spin_weights:ma(v.paint.get("raster-hue-rotate"))};var E,U};function ma(C){C*=Math.PI/180;const l=Math.sin(C),d=Math.cos(C);return[(2*d+1)/3,(-Math.sqrt(3)*l-d+1)/3,(Math.sqrt(3)*l-d+1)/3]}const Ga=(C,l,d,y,v,E,U,R,g,w)=>{const T=v.transform;return{u_is_size_zoom_constant:+(C==="constant"||C==="source"),u_is_size_feature_constant:+(C==="constant"||C==="camera"),u_size_t:l?l.uSizeT:0,u_size:l?l.uSize:0,u_camera_to_center_distance:T.cameraToCenterDistance,u_pitch:T.pitch/360*2*Math.PI,u_rotate_symbol:+d,u_aspect_ratio:T.width/T.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_matrix:E,u_label_plane_matrix:U,u_coord_matrix:R,u_is_text:+g,u_pitch_with_map:+y,u_texsize:w,u_texture:0}},hl=(C,l,d,y,v,E,U,R,g,w,T)=>{const L=v.transform;return o.e(Ga(C,l,d,y,v,E,U,R,g,w),{u_gamma_scale:y?Math.cos(L._pitch)*L.cameraToCenterDistance:1,u_device_pixel_ratio:v.pixelRatio,u_is_halo:+T})},dl=(C,l,d,y,v,E,U,R,g,w)=>o.e(hl(C,l,d,y,v,E,U,R,!0,g,!0),{u_texsize_icon:w,u_texture_icon:1}),_d=(C,l,d)=>({u_matrix:C,u_opacity:l,u_color:d}),tA=(C,l,d,y,v,E)=>o.e(function(U,R,g,w){const T=g.imageManager.getPattern(U.from.toString()),L=g.imageManager.getPattern(U.to.toString()),{width:D,height:H}=g.imageManager.getPixelSize(),z=Math.pow(2,w.tileID.overscaledZ),j=w.tileSize*Math.pow(2,g.transform.tileZoom)/z,V=j*(w.tileID.canonical.x+w.tileID.wrap*z),W=j*w.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:T.tl,u_pattern_br_a:T.br,u_pattern_tl_b:L.tl,u_pattern_br_b:L.br,u_texsize:[D,H],u_mix:R.t,u_pattern_size_a:T.displaySize,u_pattern_size_b:L.displaySize,u_scale_a:R.fromScale,u_scale_b:R.toScale,u_tile_units_to_pixels:1/lr(w,1,g.transform.tileZoom),u_pixel_coord_upper:[V>>16,W>>16],u_pixel_coord_lower:[65535&V,65535&W]}}(y,E,d,v),{u_matrix:C,u_opacity:l}),_c={fillExtrusion:(C,l)=>({u_matrix:new o.aI(C,l.u_matrix),u_lightpos:new o.aK(C,l.u_lightpos),u_lightintensity:new o.aH(C,l.u_lightintensity),u_lightcolor:new o.aK(C,l.u_lightcolor),u_vertical_gradient:new o.aH(C,l.u_vertical_gradient),u_opacity:new o.aH(C,l.u_opacity)}),fillExtrusionPattern:(C,l)=>({u_matrix:new o.aI(C,l.u_matrix),u_lightpos:new o.aK(C,l.u_lightpos),u_lightintensity:new o.aH(C,l.u_lightintensity),u_lightcolor:new o.aK(C,l.u_lightcolor),u_vertical_gradient:new o.aH(C,l.u_vertical_gradient),u_height_factor:new o.aH(C,l.u_height_factor),u_image:new o.aG(C,l.u_image),u_texsize:new o.aL(C,l.u_texsize),u_pixel_coord_upper:new o.aL(C,l.u_pixel_coord_upper),u_pixel_coord_lower:new o.aL(C,l.u_pixel_coord_lower),u_scale:new o.aK(C,l.u_scale),u_fade:new o.aH(C,l.u_fade),u_opacity:new o.aH(C,l.u_opacity)}),fill:(C,l)=>({u_matrix:new o.aI(C,l.u_matrix)}),fillPattern:(C,l)=>({u_matrix:new o.aI(C,l.u_matrix),u_image:new o.aG(C,l.u_image),u_texsize:new o.aL(C,l.u_texsize),u_pixel_coord_upper:new o.aL(C,l.u_pixel_coord_upper),u_pixel_coord_lower:new o.aL(C,l.u_pixel_coord_lower),u_scale:new o.aK(C,l.u_scale),u_fade:new o.aH(C,l.u_fade)}),fillOutline:(C,l)=>({u_matrix:new o.aI(C,l.u_matrix),u_world:new o.aL(C,l.u_world)}),fillOutlinePattern:(C,l)=>({u_matrix:new o.aI(C,l.u_matrix),u_world:new o.aL(C,l.u_world),u_image:new o.aG(C,l.u_image),u_texsize:new o.aL(C,l.u_texsize),u_pixel_coord_upper:new o.aL(C,l.u_pixel_coord_upper),u_pixel_coord_lower:new o.aL(C,l.u_pixel_coord_lower),u_scale:new o.aK(C,l.u_scale),u_fade:new o.aH(C,l.u_fade)}),circle:(C,l)=>({u_camera_to_center_distance:new o.aH(C,l.u_camera_to_center_distance),u_scale_with_map:new o.aG(C,l.u_scale_with_map),u_pitch_with_map:new o.aG(C,l.u_pitch_with_map),u_extrude_scale:new o.aL(C,l.u_extrude_scale),u_device_pixel_ratio:new o.aH(C,l.u_device_pixel_ratio),u_matrix:new o.aI(C,l.u_matrix)}),collisionBox:(C,l)=>({u_matrix:new o.aI(C,l.u_matrix),u_camera_to_center_distance:new o.aH(C,l.u_camera_to_center_distance),u_pixels_to_tile_units:new o.aH(C,l.u_pixels_to_tile_units),u_extrude_scale:new o.aL(C,l.u_extrude_scale),u_overscale_factor:new o.aH(C,l.u_overscale_factor)}),collisionCircle:(C,l)=>({u_matrix:new o.aI(C,l.u_matrix),u_inv_matrix:new o.aI(C,l.u_inv_matrix),u_camera_to_center_distance:new o.aH(C,l.u_camera_to_center_distance),u_viewport_size:new o.aL(C,l.u_viewport_size)}),debug:(C,l)=>({u_color:new o.aM(C,l.u_color),u_matrix:new o.aI(C,l.u_matrix),u_overlay:new o.aG(C,l.u_overlay),u_overlay_scale:new o.aH(C,l.u_overlay_scale)}),clippingMask:(C,l)=>({u_matrix:new o.aI(C,l.u_matrix)}),heatmap:(C,l)=>({u_extrude_scale:new o.aH(C,l.u_extrude_scale),u_intensity:new o.aH(C,l.u_intensity),u_matrix:new o.aI(C,l.u_matrix)}),heatmapTexture:(C,l)=>({u_matrix:new o.aI(C,l.u_matrix),u_world:new o.aL(C,l.u_world),u_image:new o.aG(C,l.u_image),u_color_ramp:new o.aG(C,l.u_color_ramp),u_opacity:new o.aH(C,l.u_opacity)}),hillshade:(C,l)=>({u_matrix:new o.aI(C,l.u_matrix),u_image:new o.aG(C,l.u_image),u_latrange:new o.aL(C,l.u_latrange),u_light:new o.aL(C,l.u_light),u_shadow:new o.aM(C,l.u_shadow),u_highlight:new o.aM(C,l.u_highlight),u_accent:new o.aM(C,l.u_accent)}),hillshadePrepare:(C,l)=>({u_matrix:new o.aI(C,l.u_matrix),u_image:new o.aG(C,l.u_image),u_dimension:new o.aL(C,l.u_dimension),u_zoom:new o.aH(C,l.u_zoom),u_unpack:new o.aJ(C,l.u_unpack)}),line:(C,l)=>({u_matrix:new o.aI(C,l.u_matrix),u_ratio:new o.aH(C,l.u_ratio),u_device_pixel_ratio:new o.aH(C,l.u_device_pixel_ratio),u_units_to_pixels:new o.aL(C,l.u_units_to_pixels)}),lineGradient:(C,l)=>({u_matrix:new o.aI(C,l.u_matrix),u_ratio:new o.aH(C,l.u_ratio),u_device_pixel_ratio:new o.aH(C,l.u_device_pixel_ratio),u_units_to_pixels:new o.aL(C,l.u_units_to_pixels),u_image:new o.aG(C,l.u_image),u_image_height:new o.aH(C,l.u_image_height)}),linePattern:(C,l)=>({u_matrix:new o.aI(C,l.u_matrix),u_texsize:new o.aL(C,l.u_texsize),u_ratio:new o.aH(C,l.u_ratio),u_device_pixel_ratio:new o.aH(C,l.u_device_pixel_ratio),u_image:new o.aG(C,l.u_image),u_units_to_pixels:new o.aL(C,l.u_units_to_pixels),u_scale:new o.aK(C,l.u_scale),u_fade:new o.aH(C,l.u_fade)}),lineSDF:(C,l)=>({u_matrix:new o.aI(C,l.u_matrix),u_ratio:new o.aH(C,l.u_ratio),u_device_pixel_ratio:new o.aH(C,l.u_device_pixel_ratio),u_units_to_pixels:new o.aL(C,l.u_units_to_pixels),u_patternscale_a:new o.aL(C,l.u_patternscale_a),u_patternscale_b:new o.aL(C,l.u_patternscale_b),u_sdfgamma:new o.aH(C,l.u_sdfgamma),u_image:new o.aG(C,l.u_image),u_tex_y_a:new o.aH(C,l.u_tex_y_a),u_tex_y_b:new o.aH(C,l.u_tex_y_b),u_mix:new o.aH(C,l.u_mix)}),raster:(C,l)=>({u_matrix:new o.aI(C,l.u_matrix),u_tl_parent:new o.aL(C,l.u_tl_parent),u_scale_parent:new o.aH(C,l.u_scale_parent),u_buffer_scale:new o.aH(C,l.u_buffer_scale),u_fade_t:new o.aH(C,l.u_fade_t),u_opacity:new o.aH(C,l.u_opacity),u_image0:new o.aG(C,l.u_image0),u_image1:new o.aG(C,l.u_image1),u_brightness_low:new o.aH(C,l.u_brightness_low),u_brightness_high:new o.aH(C,l.u_brightness_high),u_saturation_factor:new o.aH(C,l.u_saturation_factor),u_contrast_factor:new o.aH(C,l.u_contrast_factor),u_spin_weights:new o.aK(C,l.u_spin_weights)}),symbolIcon:(C,l)=>({u_is_size_zoom_constant:new o.aG(C,l.u_is_size_zoom_constant),u_is_size_feature_constant:new o.aG(C,l.u_is_size_feature_constant),u_size_t:new o.aH(C,l.u_size_t),u_size:new o.aH(C,l.u_size),u_camera_to_center_distance:new o.aH(C,l.u_camera_to_center_distance),u_pitch:new o.aH(C,l.u_pitch),u_rotate_symbol:new o.aG(C,l.u_rotate_symbol),u_aspect_ratio:new o.aH(C,l.u_aspect_ratio),u_fade_change:new o.aH(C,l.u_fade_change),u_matrix:new o.aI(C,l.u_matrix),u_label_plane_matrix:new o.aI(C,l.u_label_plane_matrix),u_coord_matrix:new o.aI(C,l.u_coord_matrix),u_is_text:new o.aG(C,l.u_is_text),u_pitch_with_map:new o.aG(C,l.u_pitch_with_map),u_texsize:new o.aL(C,l.u_texsize),u_texture:new o.aG(C,l.u_texture)}),symbolSDF:(C,l)=>({u_is_size_zoom_constant:new o.aG(C,l.u_is_size_zoom_constant),u_is_size_feature_constant:new o.aG(C,l.u_is_size_feature_constant),u_size_t:new o.aH(C,l.u_size_t),u_size:new o.aH(C,l.u_size),u_camera_to_center_distance:new o.aH(C,l.u_camera_to_center_distance),u_pitch:new o.aH(C,l.u_pitch),u_rotate_symbol:new o.aG(C,l.u_rotate_symbol),u_aspect_ratio:new o.aH(C,l.u_aspect_ratio),u_fade_change:new o.aH(C,l.u_fade_change),u_matrix:new o.aI(C,l.u_matrix),u_label_plane_matrix:new o.aI(C,l.u_label_plane_matrix),u_coord_matrix:new o.aI(C,l.u_coord_matrix),u_is_text:new o.aG(C,l.u_is_text),u_pitch_with_map:new o.aG(C,l.u_pitch_with_map),u_texsize:new o.aL(C,l.u_texsize),u_texture:new o.aG(C,l.u_texture),u_gamma_scale:new o.aH(C,l.u_gamma_scale),u_device_pixel_ratio:new o.aH(C,l.u_device_pixel_ratio),u_is_halo:new o.aG(C,l.u_is_halo)}),symbolTextAndIcon:(C,l)=>({u_is_size_zoom_constant:new o.aG(C,l.u_is_size_zoom_constant),u_is_size_feature_constant:new o.aG(C,l.u_is_size_feature_constant),u_size_t:new o.aH(C,l.u_size_t),u_size:new o.aH(C,l.u_size),u_camera_to_center_distance:new o.aH(C,l.u_camera_to_center_distance),u_pitch:new o.aH(C,l.u_pitch),u_rotate_symbol:new o.aG(C,l.u_rotate_symbol),u_aspect_ratio:new o.aH(C,l.u_aspect_ratio),u_fade_change:new o.aH(C,l.u_fade_change),u_matrix:new o.aI(C,l.u_matrix),u_label_plane_matrix:new o.aI(C,l.u_label_plane_matrix),u_coord_matrix:new o.aI(C,l.u_coord_matrix),u_is_text:new o.aG(C,l.u_is_text),u_pitch_with_map:new o.aG(C,l.u_pitch_with_map),u_texsize:new o.aL(C,l.u_texsize),u_texsize_icon:new o.aL(C,l.u_texsize_icon),u_texture:new o.aG(C,l.u_texture),u_texture_icon:new o.aG(C,l.u_texture_icon),u_gamma_scale:new o.aH(C,l.u_gamma_scale),u_device_pixel_ratio:new o.aH(C,l.u_device_pixel_ratio),u_is_halo:new o.aG(C,l.u_is_halo)}),background:(C,l)=>({u_matrix:new o.aI(C,l.u_matrix),u_opacity:new o.aH(C,l.u_opacity),u_color:new o.aM(C,l.u_color)}),backgroundPattern:(C,l)=>({u_matrix:new o.aI(C,l.u_matrix),u_opacity:new o.aH(C,l.u_opacity),u_image:new o.aG(C,l.u_image),u_pattern_tl_a:new o.aL(C,l.u_pattern_tl_a),u_pattern_br_a:new o.aL(C,l.u_pattern_br_a),u_pattern_tl_b:new o.aL(C,l.u_pattern_tl_b),u_pattern_br_b:new o.aL(C,l.u_pattern_br_b),u_texsize:new o.aL(C,l.u_texsize),u_mix:new o.aH(C,l.u_mix),u_pattern_size_a:new o.aL(C,l.u_pattern_size_a),u_pattern_size_b:new o.aL(C,l.u_pattern_size_b),u_scale_a:new o.aH(C,l.u_scale_a),u_scale_b:new o.aH(C,l.u_scale_b),u_pixel_coord_upper:new o.aL(C,l.u_pixel_coord_upper),u_pixel_coord_lower:new o.aL(C,l.u_pixel_coord_lower),u_tile_units_to_pixels:new o.aH(C,l.u_tile_units_to_pixels)}),terrain:(C,l)=>({u_matrix:new o.aI(C,l.u_matrix),u_texture:new o.aG(C,l.u_texture),u_ele_delta:new o.aH(C,l.u_ele_delta)}),terrainDepth:(C,l)=>({u_matrix:new o.aI(C,l.u_matrix),u_ele_delta:new o.aH(C,l.u_ele_delta)}),terrainCoords:(C,l)=>({u_matrix:new o.aI(C,l.u_matrix),u_texture:new o.aG(C,l.u_texture),u_terrain_coords_id:new o.aH(C,l.u_terrain_coords_id),u_ele_delta:new o.aH(C,l.u_ele_delta)})};class vc{constructor(l,d,y){this.context=l;const v=l.gl;this.buffer=v.createBuffer(),this.dynamicDraw=!!y,this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),v.bufferData(v.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(l){const d=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Va={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ya{constructor(l,d,y,v){this.length=d.length,this.attributes=y,this.itemSize=d.bytesPerElement,this.dynamicDraw=v,this.context=l;const E=l.gl;this.buffer=E.createBuffer(),l.bindVertexBuffer.set(this.buffer),E.bufferData(E.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?E.DYNAMIC_DRAW:E.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(l){if(l.length!==this.length)throw new Error(`Length of new data is ${l.length}, which doesn't match current length of ${this.length}`);const d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,l.arrayBuffer)}enableAttributes(l,d){for(let y=0;y<this.attributes.length;y++){const v=d.attributes[this.attributes[y].name];v!==void 0&&l.enableVertexAttribArray(v)}}setVertexAttribPointers(l,d,y){for(let v=0;v<this.attributes.length;v++){const E=this.attributes[v],U=d.attributes[E.name];U!==void 0&&l.vertexAttribPointer(U,E.components,l[Va[E.type]],!1,this.itemSize,E.offset+this.itemSize*(y||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ri=new WeakMap;function Ci(C){var l;if(Ri.has(C))return Ri.get(C);{const d=(l=C.getParameter(C.VERSION))===null||l===void 0?void 0:l.startsWith("WebGL 2.0");return Ri.set(C,d),d}}class ln{constructor(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(l){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class fl extends ln{getDefault(){return o.aO.transparent}set(l){const d=this.current;(l.r!==d.r||l.g!==d.g||l.b!==d.b||l.a!==d.a||this.dirty)&&(this.gl.clearColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class pl extends ln{getDefault(){return 1}set(l){(l!==this.current||this.dirty)&&(this.gl.clearDepth(l),this.current=l,this.dirty=!1)}}class ou extends ln{getDefault(){return 0}set(l){(l!==this.current||this.dirty)&&(this.gl.clearStencil(l),this.current=l,this.dirty=!1)}}class Ko extends ln{getDefault(){return[!0,!0,!0,!0]}set(l){const d=this.current;(l[0]!==d[0]||l[1]!==d[1]||l[2]!==d[2]||l[3]!==d[3]||this.dirty)&&(this.gl.colorMask(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class $o extends ln{getDefault(){return!0}set(l){(l!==this.current||this.dirty)&&(this.gl.depthMask(l),this.current=l,this.dirty=!1)}}class eA extends ln{getDefault(){return 255}set(l){(l!==this.current||this.dirty)&&(this.gl.stencilMask(l),this.current=l,this.dirty=!1)}}class _a extends ln{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(l){const d=this.current;(l.func!==d.func||l.ref!==d.ref||l.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(l.func,l.ref,l.mask),this.current=l,this.dirty=!1)}}class ks extends ln{getDefault(){const l=this.gl;return[l.KEEP,l.KEEP,l.KEEP]}set(l){const d=this.current;(l[0]!==d[0]||l[1]!==d[1]||l[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(l[0],l[1],l[2]),this.current=l,this.dirty=!1)}}class au extends ln{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;l?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=l,this.dirty=!1}}class bc extends ln{getDefault(){return[0,1]}set(l){const d=this.current;(l[0]!==d[0]||l[1]!==d[1]||this.dirty)&&(this.gl.depthRange(l[0],l[1]),this.current=l,this.dirty=!1)}}class wc extends ln{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;l?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=l,this.dirty=!1}}class cu extends ln{getDefault(){return this.gl.LESS}set(l){(l!==this.current||this.dirty)&&(this.gl.depthFunc(l),this.current=l,this.dirty=!1)}}class vd extends ln{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;l?d.enable(d.BLEND):d.disable(d.BLEND),this.current=l,this.dirty=!1}}class rA extends ln{getDefault(){const l=this.gl;return[l.ONE,l.ZERO]}set(l){const d=this.current;(l[0]!==d[0]||l[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(l[0],l[1]),this.current=l,this.dirty=!1)}}class nA extends ln{getDefault(){return o.aO.transparent}set(l){const d=this.current;(l.r!==d.r||l.g!==d.g||l.b!==d.b||l.a!==d.a||this.dirty)&&(this.gl.blendColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class ch extends ln{getDefault(){return this.gl.FUNC_ADD}set(l){(l!==this.current||this.dirty)&&(this.gl.blendEquation(l),this.current=l,this.dirty=!1)}}class lu extends ln{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;l?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=l,this.dirty=!1}}class gl extends ln{getDefault(){return this.gl.BACK}set(l){(l!==this.current||this.dirty)&&(this.gl.cullFace(l),this.current=l,this.dirty=!1)}}class xc extends ln{getDefault(){return this.gl.CCW}set(l){(l!==this.current||this.dirty)&&(this.gl.frontFace(l),this.current=l,this.dirty=!1)}}class uu extends ln{getDefault(){return null}set(l){(l!==this.current||this.dirty)&&(this.gl.useProgram(l),this.current=l,this.dirty=!1)}}class iA extends ln{getDefault(){return this.gl.TEXTURE0}set(l){(l!==this.current||this.dirty)&&(this.gl.activeTexture(l),this.current=l,this.dirty=!1)}}class Wo extends ln{getDefault(){const l=this.gl;return[0,0,l.drawingBufferWidth,l.drawingBufferHeight]}set(l){const d=this.current;(l[0]!==d[0]||l[1]!==d[1]||l[2]!==d[2]||l[3]!==d[3]||this.dirty)&&(this.gl.viewport(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class Bc extends ln{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,l),this.current=l,this.dirty=!1}}class Au extends ln{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class va extends ln{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.bindTexture(d.TEXTURE_2D,l),this.current=l,this.dirty=!1}}class Xo extends ln{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class N extends ln{getDefault(){return null}set(l){const d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class et extends ln{getDefault(){return null}set(l){var d;if(l===this.current&&!this.dirty)return;const y=this.gl;Ci(y)?y.bindVertexArray(l):(d=y.getExtension("OES_vertex_array_object"))===null||d===void 0||d.bindVertexArrayOES(l),this.current=l,this.dirty=!1}}class Pt extends ln{getDefault(){return 4}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,l),this.current=l,this.dirty=!1}}class Vt extends ln{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,l),this.current=l,this.dirty=!1}}class oe extends ln{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,l),this.current=l,this.dirty=!1}}class ce extends ln{constructor(l,d){super(l),this.context=l,this.parent=d}getDefault(){return null}}class Me extends ce{setDirty(){this.dirty=!0}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,l,0),this.current=l,this.dirty=!1}}class cr extends ce{set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class Mr extends ce{set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_STENCIL_ATTACHMENT,d.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class Gr{constructor(l,d,y,v,E){this.context=l,this.width=d,this.height=y;const U=l.gl,R=this.framebuffer=U.createFramebuffer();if(this.colorAttachment=new Me(l,R),v)this.depthAttachment=E?new Mr(l,R):new cr(l,R);else if(E)throw new Error("Stencil cannot be set without depth");if(U.checkFramebufferStatus(U.FRAMEBUFFER)!==U.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const l=this.context.gl,d=this.colorAttachment.get();if(d&&l.deleteTexture(d),this.depthAttachment){const y=this.depthAttachment.get();y&&l.deleteRenderbuffer(y)}l.deleteFramebuffer(this.framebuffer)}}class vr{constructor(l,d,y){this.blendFunction=l,this.blendColor=d,this.mask=y}}vr.Replace=[1,0],vr.disabled=new vr(vr.Replace,o.aO.transparent,[!1,!1,!1,!1]),vr.unblended=new vr(vr.Replace,o.aO.transparent,[!0,!0,!0,!0]),vr.alphaBlended=new vr([1,771],o.aO.transparent,[!0,!0,!0,!0]);class wn{constructor(l){var d,y;if(this.gl=l,this.clearColor=new fl(this),this.clearDepth=new pl(this),this.clearStencil=new ou(this),this.colorMask=new Ko(this),this.depthMask=new $o(this),this.stencilMask=new eA(this),this.stencilFunc=new _a(this),this.stencilOp=new ks(this),this.stencilTest=new au(this),this.depthRange=new bc(this),this.depthTest=new wc(this),this.depthFunc=new cu(this),this.blend=new vd(this),this.blendFunc=new rA(this),this.blendColor=new nA(this),this.blendEquation=new ch(this),this.cullFace=new lu(this),this.cullFaceSide=new gl(this),this.frontFace=new xc(this),this.program=new uu(this),this.activeTexture=new iA(this),this.viewport=new Wo(this),this.bindFramebuffer=new Bc(this),this.bindRenderbuffer=new Au(this),this.bindTexture=new va(this),this.bindVertexBuffer=new Xo(this),this.bindElementBuffer=new N(this),this.bindVertexArray=new et(this),this.pixelStoreUnpack=new Pt(this),this.pixelStoreUnpackPremultiplyAlpha=new Vt(this),this.pixelStoreUnpackFlipY=new oe(this),this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE),Ci(l)){this.HALF_FLOAT=l.HALF_FLOAT;const v=l.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(d=l.RGBA16F)!==null&&d!==void 0?d:v==null?void 0:v.RGBA16F_EXT,this.RGB16F=(y=l.RGB16F)!==null&&y!==void 0?y:v==null?void 0:v.RGB16F_EXT,l.getExtension("EXT_color_buffer_float")}else{l.getExtension("EXT_color_buffer_half_float"),l.getExtension("OES_texture_half_float_linear");const v=l.getExtension("OES_texture_half_float");this.HALF_FLOAT=v==null?void 0:v.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(l,d){return new vc(this,l,d)}createVertexBuffer(l,d,y){return new ya(this,l,d,y)}createRenderbuffer(l,d,y){const v=this.gl,E=v.createRenderbuffer();return this.bindRenderbuffer.set(E),v.renderbufferStorage(v.RENDERBUFFER,l,d,y),this.bindRenderbuffer.set(null),E}createFramebuffer(l,d,y,v){return new Gr(this,l,d,y,v)}clear(l){let{color:d,depth:y,stencil:v}=l;const E=this.gl;let U=0;d&&(U|=E.COLOR_BUFFER_BIT,this.clearColor.set(d),this.colorMask.set([!0,!0,!0,!0])),y!==void 0&&(U|=E.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(y),this.depthMask.set(!0)),v!==void 0&&(U|=E.STENCIL_BUFFER_BIT,this.clearStencil.set(v),this.stencilMask.set(255)),E.clear(U)}setCullFace(l){l.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))}setDepthMode(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)}setStencilMode(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)}setColorMode(l){o.aD(l.blendFunction,vr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor)),this.colorMask.set(l.mask)}createVertexArray(){var l;return Ci(this.gl)?this.gl.createVertexArray():(l=this.gl.getExtension("OES_vertex_array_object"))===null||l===void 0?void 0:l.createVertexArrayOES()}deleteVertexArray(l){var d;return Ci(this.gl)?this.gl.deleteVertexArray(l):(d=this.gl.getExtension("OES_vertex_array_object"))===null||d===void 0?void 0:d.deleteVertexArrayOES(l)}unbindVAO(){this.bindVertexArray.set(null)}}class br{constructor(l,d,y){this.func=l,this.mask=d,this.range=y}}br.ReadOnly=!1,br.ReadWrite=!0,br.disabled=new br(519,br.ReadOnly,[0,1]);const hi=7680;class Kr{constructor(l,d,y,v,E,U){this.test=l,this.ref=d,this.mask=y,this.fail=v,this.depthFail=E,this.pass=U}}Kr.disabled=new Kr({func:519,mask:0},0,0,hi,hi,hi);class Xr{constructor(l,d,y){this.enable=l,this.mode=d,this.frontFace=y}}let oi;function Qs(C,l,d,y,v,E,U){const R=C.context,g=R.gl,w=C.useProgram("collisionBox"),T=[];let L=0,D=0;for(let rt=0;rt<y.length;rt++){const ht=y[rt],gt=l.getTile(ht),Mt=gt.getBucket(d);if(!Mt)continue;let Tt=ht.posMatrix;v[0]===0&&v[1]===0||(Tt=C.translatePosMatrix(ht.posMatrix,gt,v,E));const _t=U?Mt.textCollisionBox:Mt.iconCollisionBox,bt=Mt.collisionCircleArray;if(bt.length>0){const Gt=o.F(),Wt=Tt;o.aP(Gt,Mt.placementInvProjMatrix,C.transform.glCoordMatrix),o.aP(Gt,Gt,Mt.placementViewportMatrix),T.push({circleArray:bt,circleOffset:D,transform:Wt,invTransform:Gt,coord:ht}),L+=bt.length/4,D=L}_t&&w.draw(R,g.LINES,br.disabled,Kr.disabled,C.colorModeForRenderPass(),Xr.disabled,Wn(Tt,C.transform,gt),C.style.map.terrain&&C.style.map.terrain.getTerrainData(ht),d.id,_t.layoutVertexBuffer,_t.indexBuffer,_t.segments,null,C.transform.zoom,null,null,_t.collisionVertexBuffer)}if(!U||!T.length)return;const H=C.useProgram("collisionCircle"),z=new o.aQ;z.resize(4*L),z._trim();let j=0;for(const rt of T)for(let ht=0;ht<rt.circleArray.length/4;ht++){const gt=4*ht,Mt=rt.circleArray[gt+0],Tt=rt.circleArray[gt+1],_t=rt.circleArray[gt+2],bt=rt.circleArray[gt+3];z.emplace(j++,Mt,Tt,_t,bt,0),z.emplace(j++,Mt,Tt,_t,bt,1),z.emplace(j++,Mt,Tt,_t,bt,2),z.emplace(j++,Mt,Tt,_t,bt,3)}(!oi||oi.length<2*L)&&(oi=function(rt){const ht=2*rt,gt=new o.aS;gt.resize(ht),gt._trim();for(let Mt=0;Mt<ht;Mt++){const Tt=6*Mt;gt.uint16[Tt+0]=4*Mt+0,gt.uint16[Tt+1]=4*Mt+1,gt.uint16[Tt+2]=4*Mt+2,gt.uint16[Tt+3]=4*Mt+2,gt.uint16[Tt+4]=4*Mt+3,gt.uint16[Tt+5]=4*Mt+0}return gt}(L));const V=R.createIndexBuffer(oi,!0),W=R.createVertexBuffer(z,o.aR.members,!0);for(const rt of T){const ht={u_matrix:rt.transform,u_inv_matrix:rt.invTransform,u_camera_to_center_distance:(lt=C.transform).cameraToCenterDistance,u_viewport_size:[lt.width,lt.height]};H.draw(R,g.TRIANGLES,br.disabled,Kr.disabled,C.colorModeForRenderPass(),Xr.disabled,ht,C.style.map.terrain&&C.style.map.terrain.getTerrainData(rt.coord),d.id,W,V,o.$.simpleSegment(0,2*rt.circleOffset,rt.circleArray.length,rt.circleArray.length/2),null,C.transform.zoom,null,null,null)}var lt;W.destroy(),V.destroy()}Xr.disabled=new Xr(!1,1029,2305),Xr.backCCW=new Xr(!0,1029,2305);const Hs=o.an(new Float32Array(16));function ba(C,l,d,y,v,E){const{horizontalAlign:U,verticalAlign:R}=o.at(C);return new o.P((-(U-.5)*l/v+y[0])*E,(-(R-.5)*d/v+y[1])*E)}function ml(C,l,d,y,v,E,U,R,g,w,T){const L=C.text.placedSymbolArray,D=C.text.dynamicLayoutVertexArray,H=C.icon.dynamicLayoutVertexArray,z={};D.clear();for(let j=0;j<L.length;j++){const V=L.get(j),W=V.hidden||!V.crossTileID||C.allowVerticalPlacement&&!V.placedOrientation?null:y[V.crossTileID];if(W){const lt=new o.P(V.anchorX,V.anchorY),rt=$r(lt,d?U:E,T),ht=Ct(v.cameraToCenterDistance,rt.signedDistanceFromCamera);let gt=o.ai(C.textSizeData,g,V)*ht/o.ao;d&&(gt*=C.tilePixelRatio/R);const{width:Mt,height:Tt,anchor:_t,textOffset:bt,textBoxScale:Gt}=W,Wt=ba(_t,Mt,Tt,bt,Gt,gt),ue=d?$r(lt.add(Wt),E,T).point:rt.point.add(l?Wt.rotate(-v.angle):Wt),Ae=C.allowVerticalPlacement&&V.placedOrientation===o.ah.vertical?Math.PI/2:0;for(let ye=0;ye<V.numGlyphs;ye++)o.aj(D,ue,Ae);w&&V.associatedIconIndex>=0&&(z[V.associatedIconIndex]={shiftedAnchor:ue,angle:Ae})}else de(V.numGlyphs,D)}if(w){H.clear();const j=C.icon.placedSymbolArray;for(let V=0;V<j.length;V++){const W=j.get(V);if(W.hidden)de(W.numGlyphs,H);else{const lt=z[V];if(lt)for(let rt=0;rt<W.numGlyphs;rt++)o.aj(H,lt.shiftedAnchor,lt.angle);else de(W.numGlyphs,H)}}C.icon.dynamicLayoutVertexBuffer.updateData(H)}C.text.dynamicLayoutVertexBuffer.updateData(D)}function Cc(C,l,d){return d.iconsInText&&l?"symbolTextAndIcon":C?"symbolSDF":"symbolIcon"}function Ec(C,l,d,y,v,E,U,R,g,w,T,L){const D=C.context,H=D.gl,z=C.transform,j=R==="map",V=g==="map",W=R!=="viewport"&&d.layout.get("symbol-placement")!=="point",lt=j&&!V&&!W,rt=!d.layout.get("symbol-sort-key").isConstant();let ht=!1;const gt=C.depthModeForSublayer(0,br.ReadOnly),Mt=d._unevaluatedLayout.hasValue("text-variable-anchor")||d._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Tt=[];for(const _t of y){const bt=l.getTile(_t),Gt=bt.getBucket(d);if(!Gt)continue;const Wt=v?Gt.text:Gt.icon;if(!Wt||!Wt.segments.get().length||!Wt.hasVisibleVertices)continue;const ue=Wt.programConfigurations.get(d.id),Ae=v||Gt.sdfIcons,ye=v?Gt.textSizeData:Gt.iconSizeData,Oe=V||z.pitch!==0,Ce=C.useProgram(Cc(Ae,v,Gt),ue),We=o.ag(ye,z.zoom),nr=C.style.map.terrain&&C.style.map.terrain.getTerrainData(_t);let rr,Sr,Fr,tn,xr=[0,0],Jr=null;if(v)Sr=bt.glyphAtlasTexture,Fr=H.LINEAR,rr=bt.glyphAtlasTexture.size,Gt.iconsInText&&(xr=bt.imageAtlasTexture.size,Jr=bt.imageAtlasTexture,tn=Oe||C.options.rotating||C.options.zooming||ye.kind==="composite"||ye.kind==="camera"?H.LINEAR:H.NEAREST);else{const un=d.layout.get("icon-size").constantOr(0)!==1||Gt.iconsNeedLinear;Sr=bt.imageAtlasTexture,Fr=Ae||C.options.rotating||C.options.zooming||un||Oe?H.LINEAR:H.NEAREST,rr=bt.imageAtlasTexture.size}const Cn=lr(bt,1,C.transform.zoom),En=gr(_t.posMatrix,V,j,C.transform,Cn),fi=an(_t.posMatrix,V,j,C.transform,Cn),dn=Mt&&Gt.hasTextData(),us=d.layout.get("icon-text-fit")!=="none"&&dn&&Gt.hasIconData();if(W){const un=C.style.map.terrain?(Ji,ri)=>C.style.map.terrain.getElevation(_t,Ji,ri):null,Sn=d.layout.get("text-rotation-alignment")==="map";Y(Gt,_t.posMatrix,C,v,En,fi,V,w,Sn,un)}const Fi=C.translatePosMatrix(_t.posMatrix,bt,E,U),Vn=W||v&&Mt||us?Hs:En,fn=C.translatePosMatrix(fi,bt,E,U,!0),on=Ae&&d.paint.get(v?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let pn;pn=Ae?Gt.iconsInText?dl(ye.kind,We,lt,V,C,Fi,Vn,fn,rr,xr):hl(ye.kind,We,lt,V,C,Fi,Vn,fn,v,rr,!0):Ga(ye.kind,We,lt,V,C,Fi,Vn,fn,v,rr);const Ti={program:Ce,buffers:Wt,uniformValues:pn,atlasTexture:Sr,atlasTextureIcon:Jr,atlasInterpolation:Fr,atlasInterpolationIcon:tn,isSDF:Ae,hasHalo:on};if(rt&&Gt.canOverlap){ht=!0;const un=Wt.segments.get();for(const Sn of un)Tt.push({segments:new o.$([Sn]),sortKey:Sn.sortKey,state:Ti,terrainData:nr})}else Tt.push({segments:Wt.segments,sortKey:0,state:Ti,terrainData:nr})}ht&&Tt.sort((_t,bt)=>_t.sortKey-bt.sortKey);for(const _t of Tt){const bt=_t.state;if(D.activeTexture.set(H.TEXTURE0),bt.atlasTexture.bind(bt.atlasInterpolation,H.CLAMP_TO_EDGE),bt.atlasTextureIcon&&(D.activeTexture.set(H.TEXTURE1),bt.atlasTextureIcon&&bt.atlasTextureIcon.bind(bt.atlasInterpolationIcon,H.CLAMP_TO_EDGE)),bt.isSDF){const Gt=bt.uniformValues;bt.hasHalo&&(Gt.u_is_halo=1,yl(bt.buffers,_t.segments,d,C,bt.program,gt,T,L,Gt,_t.terrainData)),Gt.u_is_halo=0}yl(bt.buffers,_t.segments,d,C,bt.program,gt,T,L,bt.uniformValues,_t.terrainData)}}function yl(C,l,d,y,v,E,U,R,g,w){const T=y.context;v.draw(T,T.gl.TRIANGLES,E,U,R,Xr.disabled,g,w,d.id,C.layoutVertexBuffer,C.indexBuffer,l,d.paint,y.transform.zoom,C.programConfigurations.get(d.id),C.dynamicLayoutVertexBuffer,C.opacityVertexBuffer)}function Sc(C,l,d,y,v){if(!d||!y||!y.imageAtlas)return;const E=y.imageAtlas.patternPositions;let U=E[d.to.toString()],R=E[d.from.toString()];if(!U&&R&&(U=R),!R&&U&&(R=U),!U||!R){const g=v.getPaintProperty(l);U=E[g],R=E[g]}U&&R&&C.setConstantPatternPositions(U,R)}function hu(C,l,d,y,v,E,U){const R=C.context.gl,g="fill-pattern",w=d.paint.get(g),T=w&&w.constantOr(1),L=d.getCrossfadeParameters();let D,H,z,j,V;U?(H=T&&!d.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",D=R.LINES):(H=T?"fillPattern":"fill",D=R.TRIANGLES);const W=w.constantOr(null);for(const lt of y){const rt=l.getTile(lt);if(T&&!rt.patternsLoaded())continue;const ht=rt.getBucket(d);if(!ht)continue;const gt=ht.programConfigurations.get(d.id),Mt=C.useProgram(H,gt),Tt=C.style.map.terrain&&C.style.map.terrain.getTerrainData(lt);T&&(C.context.activeTexture.set(R.TEXTURE0),rt.imageAtlasTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),gt.updatePaintBuffers(L)),Sc(gt,g,W,rt,d);const _t=Tt?lt:null,bt=C.translatePosMatrix(_t?_t.posMatrix:lt.posMatrix,rt,d.paint.get("fill-translate"),d.paint.get("fill-translate-anchor"));if(U){j=ht.indexBuffer2,V=ht.segments2;const Gt=[R.drawingBufferWidth,R.drawingBufferHeight];z=H==="fillOutlinePattern"&&T?sr(bt,C,L,rt,Gt):Pe(bt,Gt)}else j=ht.indexBuffer,V=ht.segments,z=T?he(bt,C,L,rt):Qt(bt);Mt.draw(C.context,D,v,C.stencilModeForClipping(lt),E,Xr.disabled,z,Tt,d.id,ht.layoutVertexBuffer,j,V,d.paint,C.transform.zoom,gt)}}function ja(C,l,d,y,v,E,U){const R=C.context,g=R.gl,w="fill-extrusion-pattern",T=d.paint.get(w),L=T.constantOr(1),D=d.getCrossfadeParameters(),H=d.paint.get("fill-extrusion-opacity"),z=T.constantOr(null);for(const j of y){const V=l.getTile(j),W=V.getBucket(d);if(!W)continue;const lt=C.style.map.terrain&&C.style.map.terrain.getTerrainData(j),rt=W.programConfigurations.get(d.id),ht=C.useProgram(L?"fillExtrusionPattern":"fillExtrusion",rt);L&&(C.context.activeTexture.set(g.TEXTURE0),V.imageAtlasTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE),rt.updatePaintBuffers(D)),Sc(rt,w,z,V,d);const gt=C.translatePosMatrix(j.posMatrix,V,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),Mt=d.paint.get("fill-extrusion-vertical-gradient"),Tt=L?xt(gt,C,Mt,H,j,D,V):At(gt,C,Mt,H);ht.draw(R,R.gl.TRIANGLES,v,E,U,Xr.backCCW,Tt,lt,d.id,W.layoutVertexBuffer,W.indexBuffer,W.segments,d.paint,C.transform.zoom,rt,C.style.map.terrain&&W.centroidVertexBuffer)}}function ls(C,l,d,y,v,E,U){const R=C.context,g=R.gl,w=d.fbo;if(!w)return;const T=C.useProgram("hillshade"),L=C.style.map.terrain&&C.style.map.terrain.getTerrainData(l);R.activeTexture.set(g.TEXTURE0),g.bindTexture(g.TEXTURE_2D,w.colorAttachment.get()),T.draw(R,g.TRIANGLES,v,E,U,Xr.disabled,((D,H,z,j)=>{const V=z.paint.get("hillshade-shadow-color"),W=z.paint.get("hillshade-highlight-color"),lt=z.paint.get("hillshade-accent-color");let rt=z.paint.get("hillshade-illumination-direction")*(Math.PI/180);z.paint.get("hillshade-illumination-anchor")==="viewport"&&(rt-=D.transform.angle);const ht=!D.options.moving;return{u_matrix:j?j.posMatrix:D.transform.calculatePosMatrix(H.tileID.toUnwrapped(),ht),u_image:0,u_latrange:ah(0,H.tileID),u_light:[z.paint.get("hillshade-exaggeration"),rt],u_shadow:V,u_highlight:W,u_accent:lt}})(C,d,y,L?l:null),L,y.id,C.rasterBoundsBuffer,C.quadTriangleIndexBuffer,C.rasterBoundsSegments)}function Tc(C,l,d,y,v,E){const U=C.context,R=U.gl,g=l.dem;if(g&&g.data){const w=g.dim,T=g.stride,L=g.getPixels();if(U.activeTexture.set(R.TEXTURE1),U.pixelStoreUnpackPremultiplyAlpha.set(!1),l.demTexture=l.demTexture||C.getTileTexture(T),l.demTexture){const H=l.demTexture;H.update(L,{premultiply:!1}),H.bind(R.NEAREST,R.CLAMP_TO_EDGE)}else l.demTexture=new st(U,L,R.RGBA,{premultiply:!1}),l.demTexture.bind(R.NEAREST,R.CLAMP_TO_EDGE);U.activeTexture.set(R.TEXTURE0);let D=l.fbo;if(!D){const H=new st(U,{width:w,height:w,data:null},R.RGBA);H.bind(R.LINEAR,R.CLAMP_TO_EDGE),D=l.fbo=U.createFramebuffer(w,w,!0,!1),D.colorAttachment.set(H.texture)}U.bindFramebuffer.set(D.framebuffer),U.viewport.set([0,0,w,w]),C.useProgram("hillshadePrepare").draw(U,R.TRIANGLES,y,v,E,Xr.disabled,((H,z)=>{const j=z.stride,V=o.F();return o.aN(V,0,o.W,-o.W,0,0,1),o.H(V,V,[0,-o.W,0]),{u_matrix:V,u_image:1,u_dimension:[j,j],u_zoom:H.overscaledZ,u_unpack:z.getUnpackVector()}})(l.tileID,g),null,d.id,C.rasterBoundsBuffer,C.quadTriangleIndexBuffer,C.rasterBoundsSegments),l.needsHillshadePrepare=!1}}function _l(C,l,d,y,v,E){const U=y.paint.get("raster-fade-duration");if(!E&&U>0){const R=_.now(),g=(R-C.timeAdded)/U,w=l?(R-l.timeAdded)/U:-1,T=d.getSource(),L=v.coveringZoomLevel({tileSize:T.tileSize,roundZoom:T.roundZoom}),D=!l||Math.abs(l.tileID.overscaledZ-L)>Math.abs(C.tileID.overscaledZ-L),H=D&&C.refreshedUponExpiration?1:o.ac(D?g:1-w,0,1);return C.refreshedUponExpiration&&g>=1&&(C.refreshedUponExpiration=!1),l?{opacity:1,mix:1-H}:{opacity:H,mix:0}}return{opacity:1,mix:0}}const vl=new o.aO(1,0,0,1),Ic=new o.aO(0,1,0,1),ws=new o.aO(0,0,1,1),bd=new o.aO(1,0,1,1),du=new o.aO(0,1,1,1);function Xn(C,l,d,y){Oi(C,0,l+d/2,C.transform.width,d,y)}function Ki(C,l,d,y){Oi(C,l-d/2,0,d,C.transform.height,y)}function Oi(C,l,d,y,v,E){const U=C.context,R=U.gl;R.enable(R.SCISSOR_TEST),R.scissor(l*C.pixelRatio,d*C.pixelRatio,y*C.pixelRatio,v*C.pixelRatio),U.clear({color:E}),R.disable(R.SCISSOR_TEST)}function sA(C,l,d){const y=C.context,v=y.gl,E=d.posMatrix,U=C.useProgram("debug"),R=br.disabled,g=Kr.disabled,w=C.colorModeForRenderPass(),T="$debug",L=C.style.map.terrain&&C.style.map.terrain.getTerrainData(d);y.activeTexture.set(v.TEXTURE0);const D=l.getTileByID(d.key).latestRawTileData,H=Math.floor((D&&D.byteLength||0)/1024),z=l.getTile(d).tileSize,j=512/Math.min(z,512)*(d.overscaledZ/C.transform.zoom)*.5;let V=d.canonical.toString();d.overscaledZ!==d.canonical.z&&(V+=` => ${d.overscaledZ}`),function(W,lt){W.initDebugOverlayCanvas();const rt=W.debugOverlayCanvas,ht=W.context.gl,gt=W.debugOverlayCanvas.getContext("2d");gt.clearRect(0,0,rt.width,rt.height),gt.shadowColor="white",gt.shadowBlur=2,gt.lineWidth=1.5,gt.strokeStyle="white",gt.textBaseline="top",gt.font="bold 36px Open Sans, sans-serif",gt.fillText(lt,5,5),gt.strokeText(lt,5,5),W.debugOverlayTexture.update(rt),W.debugOverlayTexture.bind(ht.LINEAR,ht.CLAMP_TO_EDGE)}(C,`${V} ${H}kB`),U.draw(y,v.TRIANGLES,R,g,vr.alphaBlended,Xr.disabled,ti(E,o.aO.transparent,j),null,T,C.debugBuffer,C.quadTriangleIndexBuffer,C.debugSegments),U.draw(y,v.LINE_STRIP,R,g,w,Xr.disabled,ti(E,o.aO.red),L,T,C.debugBuffer,C.tileBorderIndexBuffer,C.debugSegments)}function fu(C,l,d){const y=C.context,v=y.gl,E=C.colorModeForRenderPass(),U=new br(v.LEQUAL,br.ReadWrite,C.depthRangeFor3D),R=C.useProgram("terrain"),g=l.getTerrainMesh();y.bindFramebuffer.set(null),y.viewport.set([0,0,C.width,C.height]);for(const w of d){const T=C.renderToTexture.getTexture(w),L=l.getTerrainData(w.tileID);y.activeTexture.set(v.TEXTURE0),v.bindTexture(v.TEXTURE_2D,T.texture);const D={u_matrix:C.transform.calculatePosMatrix(w.tileID.toUnwrapped()),u_texture:0,u_ele_delta:l.getMeshFrameDelta(C.transform.zoom)};R.draw(y,v.TRIANGLES,U,Kr.disabled,E,Xr.backCCW,D,L,"terrain",g.vertexBuffer,g.indexBuffer,g.segments)}}class qa{constructor(l,d){this.context=new wn(l),this.transform=d,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:o.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Pr.maxUnderzooming+Pr.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ss}resize(l,d,y){if(this.width=Math.floor(l*y),this.height=Math.floor(d*y),this.pixelRatio=y,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const v of this.style._order)this.style._layers[v].resize()}setup(){const l=this.context,d=new o.aV;d.emplaceBack(0,0),d.emplaceBack(o.W,0),d.emplaceBack(0,o.W),d.emplaceBack(o.W,o.W),this.tileExtentBuffer=l.createVertexBuffer(d,Ui.members),this.tileExtentSegments=o.$.simpleSegment(0,0,4,2);const y=new o.aV;y.emplaceBack(0,0),y.emplaceBack(o.W,0),y.emplaceBack(0,o.W),y.emplaceBack(o.W,o.W),this.debugBuffer=l.createVertexBuffer(y,Ui.members),this.debugSegments=o.$.simpleSegment(0,0,4,5);const v=new o.Z;v.emplaceBack(0,0,0,0),v.emplaceBack(o.W,0,o.W,0),v.emplaceBack(0,o.W,0,o.W),v.emplaceBack(o.W,o.W,o.W,o.W),this.rasterBoundsBuffer=l.createVertexBuffer(v,_e.members),this.rasterBoundsSegments=o.$.simpleSegment(0,0,4,2);const E=new o.aV;E.emplaceBack(0,0),E.emplaceBack(1,0),E.emplaceBack(0,1),E.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(E,Ui.members),this.viewportSegments=o.$.simpleSegment(0,0,4,2);const U=new o.aW;U.emplaceBack(0),U.emplaceBack(1),U.emplaceBack(3),U.emplaceBack(2),U.emplaceBack(0),this.tileBorderIndexBuffer=l.createIndexBuffer(U);const R=new o.aX;R.emplaceBack(0,1,2),R.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(R);const g=this.context.gl;this.stencilClearMode=new Kr({func:g.ALWAYS,mask:0},0,255,g.ZERO,g.ZERO,g.ZERO)}clearStencil(){const l=this.context,d=l.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const y=o.F();o.aN(y,0,this.width,this.height,0,0,1),o.J(y,y,[d.drawingBufferWidth,d.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(l,d.TRIANGLES,br.disabled,this.stencilClearMode,vr.disabled,Xr.disabled,Ai(y),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(l,d){if(this.currentStencilSource===l.source||!l.isTileClipped()||!d||!d.length)return;this.currentStencilSource=l.source;const y=this.context,v=y.gl;this.nextStencilID+d.length>256&&this.clearStencil(),y.setColorMode(vr.disabled),y.setDepthMode(br.disabled);const E=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const U of d){const R=this._tileClippingMaskIDs[U.key]=this.nextStencilID++,g=this.style.map.terrain&&this.style.map.terrain.getTerrainData(U);E.draw(y,v.TRIANGLES,br.disabled,new Kr({func:v.ALWAYS,mask:0},R,255,v.KEEP,v.KEEP,v.REPLACE),vr.disabled,Xr.disabled,Ai(U.posMatrix),g,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const l=this.nextStencilID++,d=this.context.gl;return new Kr({func:d.NOTEQUAL,mask:255},l,255,d.KEEP,d.KEEP,d.REPLACE)}stencilModeForClipping(l){const d=this.context.gl;return new Kr({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,d.KEEP,d.KEEP,d.REPLACE)}stencilConfigForOverlap(l){const d=this.context.gl,y=l.sort((U,R)=>R.overscaledZ-U.overscaledZ),v=y[y.length-1].overscaledZ,E=y[0].overscaledZ-v+1;if(E>1){this.currentStencilSource=void 0,this.nextStencilID+E>256&&this.clearStencil();const U={};for(let R=0;R<E;R++)U[R+v]=new Kr({func:d.GEQUAL,mask:255},R+this.nextStencilID,255,d.KEEP,d.KEEP,d.REPLACE);return this.nextStencilID+=E,[U,y]}return[{[v]:Kr.disabled},y]}colorModeForRenderPass(){const l=this.context.gl;return this._showOverdrawInspector?new vr([l.CONSTANT_COLOR,l.ONE],new o.aO(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?vr.unblended:vr.alphaBlended}depthModeForSublayer(l,d,y){if(!this.opaquePassEnabledForLayer())return br.disabled;const v=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new br(y||this.context.gl.LEQUAL,d,[v,v])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(l,d){this.style=l,this.options=d,this.lineAtlas=l.lineAtlas,this.imageManager=l.imageManager,this.glyphManager=l.glyphManager,this.symbolFadeChange=l.placement.symbolFadeChange(_.now()),this.imageManager.beginFrame();const y=this.style._order,v=this.style.sourceCaches,E={},U={},R={};for(const g in v){const w=v[g];w.used&&w.prepare(this.context),E[g]=w.getVisibleCoordinates(),U[g]=E[g].slice().reverse(),R[g]=w.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let g=0;g<y.length;g++)if(this.style._layers[y[g]].is3D()){this.opaquePassCutoff=g;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const g of y){const w=this.style._layers[g];if(!w.hasOffscreenPass()||w.isHidden(this.transform.zoom))continue;const T=U[w.source];(w.type==="custom"||T.length)&&this.renderLayer(this,v[w.source],w,T)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:d.showOverdrawInspector?o.aO.black:o.aO.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=d.showOverdrawInspector,this.depthRangeFor3D=[0,1-(l._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=y.length-1;this.currentLayer>=0;this.currentLayer--){const g=this.style._layers[y[this.currentLayer]],w=v[g.source],T=E[g.source];this._renderTileClippingMasks(g,T),this.renderLayer(this,w,g,T)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<y.length;this.currentLayer++){const g=this.style._layers[y[this.currentLayer]],w=v[g.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(g))continue;const T=(g.type==="symbol"?R:U)[g.source];this._renderTileClippingMasks(g,E[g.source]),this.renderLayer(this,w,g,T)}if(this.options.showTileBoundaries){const g=function(w,T){let L=null;const D=Object.values(w._layers).flatMap(V=>V.source&&!V.isHidden(T)?[w.sourceCaches[V.source]]:[]),H=D.filter(V=>V.getSource().type==="vector"),z=D.filter(V=>V.getSource().type!=="vector"),j=V=>{(!L||L.getSource().maxzoom<V.getSource().maxzoom)&&(L=V)};return H.forEach(V=>j(V)),L||z.forEach(V=>j(V)),L}(this.style,this.transform.zoom);g&&function(w,T,L){for(let D=0;D<L.length;D++)sA(w,T,L[D])}(this,g,g.getVisibleCoordinates())}this.options.showPadding&&function(g){const w=g.transform.padding;Xn(g,g.transform.height-(w.top||0),3,vl),Xn(g,w.bottom||0,3,Ic),Ki(g,w.left||0,3,ws),Ki(g,g.transform.width-(w.right||0),3,bd);const T=g.transform.centerPoint;(function(L,D,H,z){Oi(L,D-1,H-10,2,20,z),Oi(L,D-10,H-1,20,2,z)})(g,T.x,g.transform.height-T.y,du)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(l){if(!this.style||!this.style.map||!this.style.map.terrain)return;const d=this.terrainFacilitator.matrix,y=this.transform.projMatrix;let v=this.terrainFacilitator.dirty;v||(v=l?!o.aY(d,y):!o.aZ(d,y)),v||(v=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),v&&(o.a_(d,y),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(E,U){const R=E.context,g=R.gl,w=vr.unblended,T=new br(g.LEQUAL,br.ReadWrite,[0,1]),L=U.getTerrainMesh(),D=U.sourceCache.getRenderableTiles(),H=E.useProgram("terrainDepth");R.bindFramebuffer.set(U.getFramebuffer("depth").framebuffer),R.viewport.set([0,0,E.width/devicePixelRatio,E.height/devicePixelRatio]),R.clear({color:o.aO.transparent,depth:1});for(const z of D){const j=U.getTerrainData(z.tileID),V={u_matrix:E.transform.calculatePosMatrix(z.tileID.toUnwrapped()),u_ele_delta:U.getMeshFrameDelta(E.transform.zoom)};H.draw(R,g.TRIANGLES,T,Kr.disabled,w,Xr.backCCW,V,j,"terrain",L.vertexBuffer,L.indexBuffer,L.segments)}R.bindFramebuffer.set(null),R.viewport.set([0,0,E.width,E.height])}(this,this.style.map.terrain),function(E,U){const R=E.context,g=R.gl,w=vr.unblended,T=new br(g.LEQUAL,br.ReadWrite,[0,1]),L=U.getTerrainMesh(),D=U.getCoordsTexture(),H=U.sourceCache.getRenderableTiles(),z=E.useProgram("terrainCoords");R.bindFramebuffer.set(U.getFramebuffer("coords").framebuffer),R.viewport.set([0,0,E.width/devicePixelRatio,E.height/devicePixelRatio]),R.clear({color:o.aO.transparent,depth:1}),U.coordsIndex=[];for(const j of H){const V=U.getTerrainData(j.tileID);R.activeTexture.set(g.TEXTURE0),g.bindTexture(g.TEXTURE_2D,D.texture);const W={u_matrix:E.transform.calculatePosMatrix(j.tileID.toUnwrapped()),u_terrain_coords_id:(255-U.coordsIndex.length)/255,u_texture:0,u_ele_delta:U.getMeshFrameDelta(E.transform.zoom)};z.draw(R,g.TRIANGLES,T,Kr.disabled,w,Xr.backCCW,W,V,"terrain",L.vertexBuffer,L.indexBuffer,L.segments),U.coordsIndex.push(j.tileID.key)}R.bindFramebuffer.set(null),R.viewport.set([0,0,E.width,E.height])}(this,this.style.map.terrain))}renderLayer(l,d,y,v){if(!y.isHidden(this.transform.zoom)&&(y.type==="background"||y.type==="custom"||(v||[]).length))switch(this.id=y.id,y.type){case"symbol":(function(E,U,R,g,w){if(E.renderPass!=="translucent")return;const T=Kr.disabled,L=E.colorModeForRenderPass();(R._unevaluatedLayout.hasValue("text-variable-anchor")||R._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(D,H,z,j,V,W,lt){const rt=H.transform,ht=V==="map",gt=W==="map";for(const Mt of D){const Tt=j.getTile(Mt),_t=Tt.getBucket(z);if(!_t||!_t.text||!_t.text.segments.get().length)continue;const bt=o.ag(_t.textSizeData,rt.zoom),Gt=lr(Tt,1,H.transform.zoom),Wt=gr(Mt.posMatrix,gt,ht,H.transform,Gt),ue=z.layout.get("icon-text-fit")!=="none"&&_t.hasIconData();if(bt){const Ae=Math.pow(2,rt.zoom-Tt.tileID.overscaledZ);ml(_t,ht,gt,lt,rt,Wt,Mt.posMatrix,Ae,bt,ue,H.style.map.terrain?(ye,Oe)=>H.style.map.terrain.getElevation(Mt,ye,Oe):null)}}}(g,E,R,U,R.layout.get("text-rotation-alignment"),R.layout.get("text-pitch-alignment"),w),R.paint.get("icon-opacity").constantOr(1)!==0&&Ec(E,U,R,g,!1,R.paint.get("icon-translate"),R.paint.get("icon-translate-anchor"),R.layout.get("icon-rotation-alignment"),R.layout.get("icon-pitch-alignment"),R.layout.get("icon-keep-upright"),T,L),R.paint.get("text-opacity").constantOr(1)!==0&&Ec(E,U,R,g,!0,R.paint.get("text-translate"),R.paint.get("text-translate-anchor"),R.layout.get("text-rotation-alignment"),R.layout.get("text-pitch-alignment"),R.layout.get("text-keep-upright"),T,L),U.map.showCollisionBoxes&&(Qs(E,U,R,g,R.paint.get("text-translate"),R.paint.get("text-translate-anchor"),!0),Qs(E,U,R,g,R.paint.get("icon-translate"),R.paint.get("icon-translate-anchor"),!1))})(l,d,y,v,this.style.placement.variableOffsets);break;case"circle":(function(E,U,R,g){if(E.renderPass!=="translucent")return;const w=R.paint.get("circle-opacity"),T=R.paint.get("circle-stroke-width"),L=R.paint.get("circle-stroke-opacity"),D=!R.layout.get("circle-sort-key").isConstant();if(w.constantOr(1)===0&&(T.constantOr(1)===0||L.constantOr(1)===0))return;const H=E.context,z=H.gl,j=E.depthModeForSublayer(0,br.ReadOnly),V=Kr.disabled,W=E.colorModeForRenderPass(),lt=[];for(let rt=0;rt<g.length;rt++){const ht=g[rt],gt=U.getTile(ht),Mt=gt.getBucket(R);if(!Mt)continue;const Tt=Mt.programConfigurations.get(R.id),_t=E.useProgram("circle",Tt),bt=Mt.layoutVertexBuffer,Gt=Mt.indexBuffer,Wt=E.style.map.terrain&&E.style.map.terrain.getTerrainData(ht),ue={programConfiguration:Tt,program:_t,layoutVertexBuffer:bt,indexBuffer:Gt,uniformValues:zr(E,ht,gt,R),terrainData:Wt};if(D){const Ae=Mt.segments.get();for(const ye of Ae)lt.push({segments:new o.$([ye]),sortKey:ye.sortKey,state:ue})}else lt.push({segments:Mt.segments,sortKey:0,state:ue})}D&&lt.sort((rt,ht)=>rt.sortKey-ht.sortKey);for(const rt of lt){const{programConfiguration:ht,program:gt,layoutVertexBuffer:Mt,indexBuffer:Tt,uniformValues:_t,terrainData:bt}=rt.state;gt.draw(H,z.TRIANGLES,j,V,W,Xr.disabled,_t,bt,R.id,Mt,Tt,rt.segments,R.paint,E.transform.zoom,ht)}})(l,d,y,v);break;case"heatmap":(function(E,U,R,g){if(R.paint.get("heatmap-opacity")!==0)if(E.renderPass==="offscreen"){const w=E.context,T=w.gl,L=Kr.disabled,D=new vr([T.ONE,T.ONE],o.aO.transparent,[!0,!0,!0,!0]);(function(H,z,j){const V=H.gl;H.activeTexture.set(V.TEXTURE1),H.viewport.set([0,0,z.width/4,z.height/4]);let W=j.heatmapFbo;if(W)V.bindTexture(V.TEXTURE_2D,W.colorAttachment.get()),H.bindFramebuffer.set(W.framebuffer);else{const lt=V.createTexture();V.bindTexture(V.TEXTURE_2D,lt),V.texParameteri(V.TEXTURE_2D,V.TEXTURE_WRAP_S,V.CLAMP_TO_EDGE),V.texParameteri(V.TEXTURE_2D,V.TEXTURE_WRAP_T,V.CLAMP_TO_EDGE),V.texParameteri(V.TEXTURE_2D,V.TEXTURE_MIN_FILTER,V.LINEAR),V.texParameteri(V.TEXTURE_2D,V.TEXTURE_MAG_FILTER,V.LINEAR),W=j.heatmapFbo=H.createFramebuffer(z.width/4,z.height/4,!1,!1),function(rt,ht,gt,Mt){var Tt,_t;const bt=rt.gl,Gt=(Tt=rt.HALF_FLOAT)!==null&&Tt!==void 0?Tt:bt.UNSIGNED_BYTE,Wt=(_t=rt.RGBA16F)!==null&&_t!==void 0?_t:bt.RGBA;bt.texImage2D(bt.TEXTURE_2D,0,Wt,ht.width/4,ht.height/4,0,bt.RGBA,Gt,null),Mt.colorAttachment.set(gt)}(H,z,lt,W)}})(w,E,R),w.clear({color:o.aO.transparent});for(let H=0;H<g.length;H++){const z=g[H];if(U.hasRenderableParent(z))continue;const j=U.getTile(z),V=j.getBucket(R);if(!V)continue;const W=V.programConfigurations.get(R.id),lt=E.useProgram("heatmap",W),{zoom:rt}=E.transform;lt.draw(w,T.TRIANGLES,br.disabled,L,D,Xr.disabled,Hn(z.posMatrix,j,rt,R.paint.get("heatmap-intensity")),null,R.id,V.layoutVertexBuffer,V.indexBuffer,V.segments,R.paint,E.transform.zoom,W)}w.viewport.set([0,0,E.width,E.height])}else E.renderPass==="translucent"&&(E.context.setColorMode(E.colorModeForRenderPass()),function(w,T){const L=w.context,D=L.gl,H=T.heatmapFbo;if(!H)return;L.activeTexture.set(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,H.colorAttachment.get()),L.activeTexture.set(D.TEXTURE1);let z=T.colorRampTexture;z||(z=T.colorRampTexture=new st(L,T.colorRamp,D.RGBA)),z.bind(D.LINEAR,D.CLAMP_TO_EDGE),w.useProgram("heatmapTexture").draw(L,D.TRIANGLES,br.disabled,Kr.disabled,w.colorModeForRenderPass(),Xr.disabled,((j,V,W,lt)=>{const rt=o.F();o.aN(rt,0,j.width,j.height,0,0,1);const ht=j.context.gl;return{u_matrix:rt,u_world:[ht.drawingBufferWidth,ht.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:V.paint.get("heatmap-opacity")}})(w,T),null,T.id,w.viewportBuffer,w.quadTriangleIndexBuffer,w.viewportSegments,T.paint,w.transform.zoom)}(E,R))})(l,d,y,v);break;case"line":(function(E,U,R,g){if(E.renderPass!=="translucent")return;const w=R.paint.get("line-opacity"),T=R.paint.get("line-width");if(w.constantOr(1)===0||T.constantOr(1)===0)return;const L=E.depthModeForSublayer(0,br.ReadOnly),D=E.colorModeForRenderPass(),H=R.paint.get("line-dasharray"),z=R.paint.get("line-pattern"),j=z.constantOr(1),V=R.paint.get("line-gradient"),W=R.getCrossfadeParameters(),lt=j?"linePattern":H?"lineSDF":V?"lineGradient":"line",rt=E.context,ht=rt.gl;let gt=!0;for(const Mt of g){const Tt=U.getTile(Mt);if(j&&!Tt.patternsLoaded())continue;const _t=Tt.getBucket(R);if(!_t)continue;const bt=_t.programConfigurations.get(R.id),Gt=E.context.program.get(),Wt=E.useProgram(lt,bt),ue=gt||Wt.program!==Gt,Ae=E.style.map.terrain&&E.style.map.terrain.getTerrainData(Mt),ye=z.constantOr(null);if(ye&&Tt.imageAtlas){const We=Tt.imageAtlas,nr=We.patternPositions[ye.to.toString()],rr=We.patternPositions[ye.from.toString()];nr&&rr&&bt.setConstantPatternPositions(nr,rr)}const Oe=Ae?Mt:null,Ce=j?za(E,Tt,R,W,Oe):H?su(E,Tt,R,H,W,Oe):V?Vr(E,Tt,R,_t.lineClipsArray.length,Oe):ul(E,Tt,R,Oe);if(j)rt.activeTexture.set(ht.TEXTURE0),Tt.imageAtlasTexture.bind(ht.LINEAR,ht.CLAMP_TO_EDGE),bt.updatePaintBuffers(W);else if(H&&(ue||E.lineAtlas.dirty))rt.activeTexture.set(ht.TEXTURE0),E.lineAtlas.bind(rt);else if(V){const We=_t.gradients[R.id];let nr=We.texture;if(R.gradientVersion!==We.version){let rr=256;if(R.stepInterpolant){const Sr=U.getSource().maxzoom,Fr=Mt.canonical.z===Sr?Math.ceil(1<<E.transform.maxZoom-Mt.canonical.z):1;rr=o.ac(o.aT(_t.maxLineLength/o.W*1024*Fr),256,rt.maxTextureSize)}We.gradient=o.aU({expression:R.gradientExpression(),evaluationKey:"lineProgress",resolution:rr,image:We.gradient||void 0,clips:_t.lineClipsArray}),We.texture?We.texture.update(We.gradient):We.texture=new st(rt,We.gradient,ht.RGBA),We.version=R.gradientVersion,nr=We.texture}rt.activeTexture.set(ht.TEXTURE0),nr.bind(R.stepInterpolant?ht.NEAREST:ht.LINEAR,ht.CLAMP_TO_EDGE)}Wt.draw(rt,ht.TRIANGLES,L,E.stencilModeForClipping(Mt),D,Xr.disabled,Ce,Ae,R.id,_t.layoutVertexBuffer,_t.indexBuffer,_t.segments,R.paint,E.transform.zoom,bt,_t.layoutVertexBuffer2),gt=!1}})(l,d,y,v);break;case"fill":(function(E,U,R,g){const w=R.paint.get("fill-color"),T=R.paint.get("fill-opacity");if(T.constantOr(1)===0)return;const L=E.colorModeForRenderPass(),D=R.paint.get("fill-pattern"),H=E.opaquePassEnabledForLayer()&&!D.constantOr(1)&&w.constantOr(o.aO.transparent).a===1&&T.constantOr(0)===1?"opaque":"translucent";if(E.renderPass===H){const z=E.depthModeForSublayer(1,E.renderPass==="opaque"?br.ReadWrite:br.ReadOnly);hu(E,U,R,g,z,L,!1)}if(E.renderPass==="translucent"&&R.paint.get("fill-antialias")){const z=E.depthModeForSublayer(R.getPaintProperty("fill-outline-color")?2:0,br.ReadOnly);hu(E,U,R,g,z,L,!0)}})(l,d,y,v);break;case"fill-extrusion":(function(E,U,R,g){const w=R.paint.get("fill-extrusion-opacity");if(w!==0&&E.renderPass==="translucent"){const T=new br(E.context.gl.LEQUAL,br.ReadWrite,E.depthRangeFor3D);if(w!==1||R.paint.get("fill-extrusion-pattern").constantOr(1))ja(E,U,R,g,T,Kr.disabled,vr.disabled),ja(E,U,R,g,T,E.stencilModeFor3D(),E.colorModeForRenderPass());else{const L=E.colorModeForRenderPass();ja(E,U,R,g,T,Kr.disabled,L)}}})(l,d,y,v);break;case"hillshade":(function(E,U,R,g){if(E.renderPass!=="offscreen"&&E.renderPass!=="translucent")return;const w=E.context,T=E.depthModeForSublayer(0,br.ReadOnly),L=E.colorModeForRenderPass(),[D,H]=E.renderPass==="translucent"?E.stencilConfigForOverlap(g):[{},g];for(const z of H){const j=U.getTile(z);j.needsHillshadePrepare!==void 0&&j.needsHillshadePrepare&&E.renderPass==="offscreen"?Tc(E,j,R,T,Kr.disabled,L):E.renderPass==="translucent"&&ls(E,z,j,R,T,D[z.overscaledZ],L)}w.viewport.set([0,0,E.width,E.height])})(l,d,y,v);break;case"raster":(function(E,U,R,g){if(E.renderPass!=="translucent"||R.paint.get("raster-opacity")===0||!g.length)return;const w=E.context,T=w.gl,L=U.getSource(),D=E.useProgram("raster"),H=E.colorModeForRenderPass(),[z,j]=L instanceof xe?[{},g]:E.stencilConfigForOverlap(g),V=j[j.length-1].overscaledZ,W=!E.options.moving;for(const lt of j){const rt=E.depthModeForSublayer(lt.overscaledZ-V,R.paint.get("raster-opacity")===1?br.ReadWrite:br.ReadOnly,T.LESS),ht=U.getTile(lt);ht.registerFadeDuration(R.paint.get("raster-fade-duration"));const gt=U.findLoadedParent(lt,0),Mt=_l(ht,gt,U,R,E.transform,E.style.map.terrain);let Tt,_t;const bt=R.paint.get("raster-resampling")==="nearest"?T.NEAREST:T.LINEAR;w.activeTexture.set(T.TEXTURE0),ht.texture.bind(bt,T.CLAMP_TO_EDGE,T.LINEAR_MIPMAP_NEAREST),w.activeTexture.set(T.TEXTURE1),gt?(gt.texture.bind(bt,T.CLAMP_TO_EDGE,T.LINEAR_MIPMAP_NEAREST),Tt=Math.pow(2,gt.tileID.overscaledZ-ht.tileID.overscaledZ),_t=[ht.tileID.canonical.x*Tt%1,ht.tileID.canonical.y*Tt%1]):ht.texture.bind(bt,T.CLAMP_TO_EDGE,T.LINEAR_MIPMAP_NEAREST);const Gt=E.style.map.terrain&&E.style.map.terrain.getTerrainData(lt),Wt=Gt?lt:null,ue=Wt?Wt.posMatrix:E.transform.calculatePosMatrix(lt.toUnwrapped(),W),Ae=Al(ue,_t||[0,0],Tt||1,Mt,R);L instanceof xe?D.draw(w,T.TRIANGLES,rt,Kr.disabled,H,Xr.disabled,Ae,Gt,R.id,L.boundsBuffer,E.quadTriangleIndexBuffer,L.boundsSegments):D.draw(w,T.TRIANGLES,rt,z[lt.overscaledZ],H,Xr.disabled,Ae,Gt,R.id,E.rasterBoundsBuffer,E.quadTriangleIndexBuffer,E.rasterBoundsSegments)}})(l,d,y,v);break;case"background":(function(E,U,R,g){const w=R.paint.get("background-color"),T=R.paint.get("background-opacity");if(T===0)return;const L=E.context,D=L.gl,H=E.transform,z=H.tileSize,j=R.paint.get("background-pattern");if(E.isPatternMissing(j))return;const V=!j&&w.a===1&&T===1&&E.opaquePassEnabledForLayer()?"opaque":"translucent";if(E.renderPass!==V)return;const W=Kr.disabled,lt=E.depthModeForSublayer(0,V==="opaque"?br.ReadWrite:br.ReadOnly),rt=E.colorModeForRenderPass(),ht=E.useProgram(j?"backgroundPattern":"background"),gt=g||H.coveringTiles({tileSize:z,terrain:E.style.map.terrain});j&&(L.activeTexture.set(D.TEXTURE0),E.imageManager.bind(E.context));const Mt=R.getCrossfadeParameters();for(const Tt of gt){const _t=g?Tt.posMatrix:E.transform.calculatePosMatrix(Tt.toUnwrapped()),bt=j?tA(_t,T,E,j,{tileID:Tt,tileSize:z},Mt):_d(_t,T,w),Gt=E.style.map.terrain&&E.style.map.terrain.getTerrainData(Tt);ht.draw(L,D.TRIANGLES,lt,W,rt,Xr.disabled,bt,Gt,R.id,E.tileExtentBuffer,E.quadTriangleIndexBuffer,E.tileExtentSegments)}})(l,0,y,v);break;case"custom":(function(E,U,R){const g=E.context,w=R.implementation;if(E.renderPass==="offscreen"){const T=w.prerender;T&&(E.setCustomLayerDefaults(),g.setColorMode(E.colorModeForRenderPass()),T.call(w,g.gl,E.transform.customLayerMatrix()),g.setDirty(),E.setBaseState())}else if(E.renderPass==="translucent"){E.setCustomLayerDefaults(),g.setColorMode(E.colorModeForRenderPass()),g.setStencilMode(Kr.disabled);const T=w.renderingMode==="3d"?new br(E.context.gl.LEQUAL,br.ReadWrite,E.depthRangeFor3D):E.depthModeForSublayer(0,br.ReadOnly);g.setDepthMode(T),w.render(g.gl,E.transform.customLayerMatrix()),g.setDirty(),E.setBaseState(),g.bindFramebuffer.set(null)}})(l,0,y)}}translatePosMatrix(l,d,y,v,E){if(!y[0]&&!y[1])return l;const U=E?v==="map"?this.transform.angle:0:v==="viewport"?-this.transform.angle:0;if(U){const w=Math.sin(U),T=Math.cos(U);y=[y[0]*T-y[1]*w,y[0]*w+y[1]*T]}const R=[E?y[0]:lr(d,y[0],this.transform.zoom),E?y[1]:lr(d,y[1],this.transform.zoom),0],g=new Float32Array(16);return o.H(g,l,R),g}saveTileTexture(l){const d=this._tileTextures[l.size[0]];d?d.push(l):this._tileTextures[l.size[0]]=[l]}getTileTexture(l){const d=this._tileTextures[l];return d&&d.length>0?d.pop():null}isPatternMissing(l){if(!l)return!1;if(!l.from||!l.to)return!0;const d=this.imageManager.getPattern(l.from.toString()),y=this.imageManager.getPattern(l.to.toString());return!d||!y}useProgram(l,d){this.cache=this.cache||{};const y=l+(d?d.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[y]||(this.cache[y]=new to(this.context,Li[l],d,_c[l],this._showOverdrawInspector,this.style.map.terrain)),this.cache[y]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new st(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:l,drawingBufferHeight:d}=this.context.gl;return this.width!==l||this.height!==d}}class Di{constructor(l,d){this.points=l,this.planes=d}static fromInvProjectionMatrix(l,d,y){const v=Math.pow(2,y),E=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(R=>{const g=1/(R=o.af([],R,l))[3]/d*v;return o.a$(R,R,[g,g,1/R[3],g])}),U=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(R=>{const g=function(D,H){var z=H[0],j=H[1],V=H[2],W=z*z+j*j+V*V;return W>0&&(W=1/Math.sqrt(W)),D[0]=H[0]*W,D[1]=H[1]*W,D[2]=H[2]*W,D}([],function(D,H,z){var j=H[0],V=H[1],W=H[2],lt=z[0],rt=z[1],ht=z[2];return D[0]=V*ht-W*rt,D[1]=W*lt-j*ht,D[2]=j*rt-V*lt,D}([],dt([],E[R[0]],E[R[1]]),dt([],E[R[2]],E[R[1]]))),w=-((T=g)[0]*(L=E[R[1]])[0]+T[1]*L[1]+T[2]*L[2]);var T,L;return g.concat(w)});return new Di(E,U)}}class $i{constructor(l,d){this.min=l,this.max=d,this.center=function(y,v,E){return y[0]=.5*v[0],y[1]=.5*v[1],y[2]=.5*v[2],y}([],function(y,v,E){return y[0]=v[0]+E[0],y[1]=v[1]+E[1],y[2]=v[2]+E[2],y}([],this.min,this.max))}quadrant(l){const d=[l%2==0,l<2],y=pt(this.min),v=pt(this.max);for(let E=0;E<d.length;E++)y[E]=d[E]?this.min[E]:this.center[E],v[E]=d[E]?this.center[E]:this.max[E];return v[2]=this.max[2],new $i(y,v)}distanceX(l){return Math.max(Math.min(this.max[0],l[0]),this.min[0])-l[0]}distanceY(l){return Math.max(Math.min(this.max[1],l[1]),this.min[1])-l[1]}intersects(l){const d=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let y=!0;for(let v=0;v<l.planes.length;v++){const E=l.planes[v];let U=0;for(let R=0;R<d.length;R++)o.b0(E,d[R])>=0&&U++;if(U===0)return 0;U!==d.length&&(y=!1)}if(y)return 2;for(let v=0;v<3;v++){let E=Number.MAX_VALUE,U=-Number.MAX_VALUE;for(let R=0;R<l.points.length;R++){const g=l.points[R][v]-this.min[v];E=Math.min(E,g),U=Math.max(U,g)}if(U<0||E>this.max[v]-this.min[v])return 0}return 1}}class eo{constructor(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,y=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,v=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;if(isNaN(l)||l<0||isNaN(d)||d<0||isNaN(y)||y<0||isNaN(v)||v<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=d,this.left=y,this.right=v}interpolate(l,d,y){return d.top!=null&&l.top!=null&&(this.top=o.z.number(l.top,d.top,y)),d.bottom!=null&&l.bottom!=null&&(this.bottom=o.z.number(l.bottom,d.bottom,y)),d.left!=null&&l.left!=null&&(this.left=o.z.number(l.left,d.left,y)),d.right!=null&&l.right!=null&&(this.right=o.z.number(l.right,d.right,y)),this}getCenter(l,d){const y=o.ac((this.left+l-this.right)/2,0,l),v=o.ac((this.top+d-this.bottom)/2,0,d);return new o.P(y,v)}equals(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right}clone(){return new eo(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const xo=85.051129;class Bo{constructor(l,d,y,v,E){this.tileSize=512,this._renderWorldCopies=E===void 0||!!E,this._minZoom=l||0,this._maxZoom=d||22,this._minPitch=y??0,this._maxPitch=v??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new o.M(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new eo,this._posMatrixCache={},this._alignedPosMatrixCache={},this.minElevationForCurrentTile=0}clone(){const l=new Bo(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return l.apply(this),l}apply(l){this.tileSize=l.tileSize,this.latRange=l.latRange,this.width=l.width,this.height=l.height,this._center=l._center,this._elevation=l._elevation,this.minElevationForCurrentTile=l.minElevationForCurrentTile,this.zoom=l.zoom,this.angle=l.angle,this._fov=l._fov,this._pitch=l._pitch,this._unmodified=l._unmodified,this._edgeInsets=l._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))}get maxZoom(){return this._maxZoom}set maxZoom(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))}get minPitch(){return this._minPitch}set minPitch(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))}get maxPitch(){return this._maxPitch}set maxPitch(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(l){l===void 0?l=!0:l===null&&(l=!1),this._renderWorldCopies=l}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(l){const d=-o.b1(l,-180,180)*Math.PI/180;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=function(){var y=new o.A(4);return o.A!=Float32Array&&(y[1]=0,y[2]=0),y[0]=1,y[3]=1,y}(),function(y,v,E){var U=v[0],R=v[1],g=v[2],w=v[3],T=Math.sin(E),L=Math.cos(E);y[0]=U*L+g*T,y[1]=R*L+w*T,y[2]=U*-T+g*L,y[3]=R*-T+w*L}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(l){const d=o.ac(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==d&&(this._unmodified=!1,this._pitch=d,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=l/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(l){const d=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==d&&(this._unmodified=!1,this._zoom=d,this.tileZoom=Math.max(0,Math.floor(d)),this.scale=this.zoomScale(d),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(l){l!==this._elevation&&(this._elevation=l,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(l){return this._edgeInsets.equals(l)}interpolatePadding(l,d,y){this._unmodified=!1,this._edgeInsets.interpolate(l,d,y),this._constrain(),this._calcMatrices()}coveringZoomLevel(l){const d=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,d)}getVisibleUnwrappedCoordinates(l){const d=[new o.b2(0,l)];if(this._renderWorldCopies){const y=this.pointCoordinate(new o.P(0,0)),v=this.pointCoordinate(new o.P(this.width,0)),E=this.pointCoordinate(new o.P(this.width,this.height)),U=this.pointCoordinate(new o.P(0,this.height)),R=Math.floor(Math.min(y.x,v.x,E.x,U.x)),g=Math.floor(Math.max(y.x,v.x,E.x,U.x)),w=1;for(let T=R-w;T<=g+w;T++)T!==0&&d.push(new o.b2(T,l))}return d}coveringTiles(l){var d,y;let v=this.coveringZoomLevel(l);const E=v;if(l.minzoom!==void 0&&v<l.minzoom)return[];l.maxzoom!==void 0&&v>l.maxzoom&&(v=l.maxzoom);const U=this.pointCoordinate(this.getCameraPoint()),R=o.Y.fromLngLat(this.center),g=Math.pow(2,v),w=[g*U.x,g*U.y,0],T=[g*R.x,g*R.y,0],L=Di.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,v);let D=l.minzoom||0;!l.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(D=v);const H=l.terrain?2/Math.min(this.tileSize,l.tileSize)*this.tileSize:3,z=rt=>({aabb:new $i([rt*g,0,0],[(rt+1)*g,g,0]),zoom:0,x:0,y:0,wrap:rt,fullyVisible:!1}),j=[],V=[],W=v,lt=l.reparseOverscaled?E:v;if(this._renderWorldCopies)for(let rt=1;rt<=3;rt++)j.push(z(-rt)),j.push(z(rt));for(j.push(z(0));j.length>0;){const rt=j.pop(),ht=rt.x,gt=rt.y;let Mt=rt.fullyVisible;if(!Mt){const Wt=rt.aabb.intersects(L);if(Wt===0)continue;Mt=Wt===2}const Tt=l.terrain?w:T,_t=rt.aabb.distanceX(Tt),bt=rt.aabb.distanceY(Tt),Gt=Math.max(Math.abs(_t),Math.abs(bt));if(rt.zoom===W||Gt>H+(1<<W-rt.zoom)-2&&rt.zoom>=D){const Wt=W-rt.zoom,ue=w[0]-.5-(ht<<Wt),Ae=w[1]-.5-(gt<<Wt);V.push({tileID:new o.Q(rt.zoom===W?lt:rt.zoom,rt.wrap,rt.zoom,ht,gt),distanceSq:Rt([T[0]-.5-ht,T[1]-.5-gt]),tileDistanceToCamera:Math.sqrt(ue*ue+Ae*Ae)})}else for(let Wt=0;Wt<4;Wt++){const ue=(ht<<1)+Wt%2,Ae=(gt<<1)+(Wt>>1),ye=rt.zoom+1;let Oe=rt.aabb.quadrant(Wt);if(l.terrain){const Ce=new o.Q(ye,rt.wrap,ye,ue,Ae),We=l.terrain.getMinMaxElevation(Ce),nr=(d=We.minElevation)!==null&&d!==void 0?d:this.elevation,rr=(y=We.maxElevation)!==null&&y!==void 0?y:this.elevation;Oe=new $i([Oe.min[0],Oe.min[1],nr],[Oe.max[0],Oe.max[1],rr])}j.push({aabb:Oe,zoom:ye,x:ue,y:Ae,wrap:rt.wrap,fullyVisible:Mt})}}return V.sort((rt,ht)=>rt.distanceSq-ht.distanceSq).map(rt=>rt.tileID)}resize(l,d){this.width=l,this.height=d,this.pixelsToGLUnits=[2/l,-2/d],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(l){return Math.pow(2,l)}scaleZoom(l){return Math.log(l)/Math.LN2}project(l){const d=o.ac(l.lat,-85.051129,xo);return new o.P(o.N(l.lng)*this.worldSize,o.O(d)*this.worldSize)}unproject(l){return new o.Y(l.x/this.worldSize,l.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(l){const d=this.elevation,y=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,v=this.pointLocation(this.centerPoint,l),E=l.getElevationForLngLatZoom(v,this.tileZoom);if(!(this.elevation-E))return;const U=y+d-E,R=Math.cos(this._pitch)*this.cameraToCenterDistance/U/o.b3(1,v.lat),g=this.scaleZoom(R/this.tileSize);this._elevation=E,this._center=v,this.zoom=g}setLocationAtPoint(l,d){const y=this.pointCoordinate(d),v=this.pointCoordinate(this.centerPoint),E=this.locationCoordinate(l),U=new o.Y(E.x-(y.x-v.x),E.y-(y.y-v.y));this.center=this.coordinateLocation(U),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(l,d){return d?this.coordinatePoint(this.locationCoordinate(l),d.getElevationForLngLatZoom(l,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(l))}pointLocation(l,d){return this.coordinateLocation(this.pointCoordinate(l,d))}locationCoordinate(l){return o.Y.fromLngLat(l)}coordinateLocation(l){return l&&l.toLngLat()}pointCoordinate(l,d){if(d){const D=d.pointCoordinate(l);if(D!=null)return D}const y=[l.x,l.y,0,1],v=[l.x,l.y,1,1];o.af(y,y,this.pixelMatrixInverse),o.af(v,v,this.pixelMatrixInverse);const E=y[3],U=v[3],R=y[1]/E,g=v[1]/U,w=y[2]/E,T=v[2]/U,L=w===T?0:(0-w)/(T-w);return new o.Y(o.z.number(y[0]/E,v[0]/U,L)/this.worldSize,o.z.number(R,g,L)/this.worldSize)}coordinatePoint(l){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,y=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.pixelMatrix;const v=[l.x*this.worldSize,l.y*this.worldSize,d,1];return o.af(v,v,y),new o.P(v[0]/v[3],v[1]/v[3])}getBounds(){const l=Math.max(0,this.height/2-this.getHorizon());return new ze().extend(this.pointLocation(new o.P(0,l))).extend(this.pointLocation(new o.P(this.width,l))).extend(this.pointLocation(new o.P(this.width,this.height))).extend(this.pointLocation(new o.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new ze([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(l){l?(this.lngRange=[l.getWest(),l.getEast()],this.latRange=[l.getSouth(),l.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,xo])}calculatePosMatrix(l){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const y=l.key,v=d?this._alignedPosMatrixCache:this._posMatrixCache;if(v[y])return v[y];const E=l.canonical,U=this.worldSize/this.zoomScale(E.z),R=E.x+Math.pow(2,E.z)*l.wrap,g=o.an(new Float64Array(16));return o.H(g,g,[R*U,E.y*U,0]),o.J(g,g,[U/o.W,U/o.W,1]),o.K(g,d?this.alignedProjMatrix:this.projMatrix,g),v[y]=new Float32Array(g),v[y]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(l,d){d=o.ac(+d,this.minZoom,this.maxZoom);const y={center:new o.M(l.lng,l.lat),zoom:d};let v=this.lngRange;if(!this._renderWorldCopies&&v===null){const rt=179.9999999999;v=[-rt,rt]}const E=this.tileSize*this.zoomScale(y.zoom);let U=0,R=E,g=0,w=E,T=0,L=0;const{x:D,y:H}=this.size;if(this.latRange){const rt=this.latRange;U=o.O(rt[1])*E,R=o.O(rt[0])*E,R-U<H&&(T=H/(R-U))}v&&(g=o.b1(o.N(v[0])*E,0,E),w=o.b1(o.N(v[1])*E,0,E),w<g&&(w+=E),w-g<D&&(L=D/(w-g)));const{x:z,y:j}=this.project.call({worldSize:E},l);let V,W;const lt=Math.max(L||0,T||0);if(lt){const rt=new o.P(L?(w+g)/2:z,T?(R+U)/2:j);return y.center=this.unproject.call({worldSize:E},rt).wrap(),y.zoom+=this.scaleZoom(lt),y}if(this.latRange){const rt=H/2;j-rt<U&&(W=U+rt),j+rt>R&&(W=R-rt)}if(v){const rt=(g+w)/2;let ht=z;this._renderWorldCopies&&(ht=o.b1(z,rt-E/2,rt+E/2));const gt=D/2;ht-gt<g&&(V=g+gt),ht+gt>w&&(V=w-gt)}if(V!==void 0||W!==void 0){const rt=new o.P(V??z,W??j);y.center=this.unproject.call({worldSize:E},rt).wrap()}return y}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const l=this._unmodified,{center:d,zoom:y}=this.getConstrained(this.center,this.zoom);this.center=d,this.zoom=y,this._unmodified=l,this._constraining=!1}_calcMatrices(){if(!this.height)return;const l=this.centerOffset,d=this.point.x,y=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=o.b3(1,this.center.lat)*this.worldSize;let v=o.an(new Float64Array(16));o.J(v,v,[this.width/2,-this.height/2,1]),o.H(v,v,[1,-1,0]),this.labelPlaneMatrix=v,v=o.an(new Float64Array(16)),o.J(v,v,[1,-1,1]),o.H(v,v,[-1,-1,0]),o.J(v,v,[2/this.width,2/this.height,1]),this.glCoordMatrix=v;const E=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),U=Math.min(this.elevation,this.minElevationForCurrentTile),R=E-U*this._pixelPerMeter/Math.cos(this._pitch),g=U<0?R:E,w=Math.PI/2+this._pitch,T=this._fov*(.5+l.y/this.height),L=Math.sin(T)*g/Math.sin(o.ac(Math.PI-w-T,.01,Math.PI-.01)),D=this.getHorizon(),H=2*Math.atan(D/this.cameraToCenterDistance)*(.5+l.y/(2*D)),z=Math.sin(H)*g/Math.sin(o.ac(Math.PI-w-H,.01,Math.PI-.01)),j=Math.min(L,z),V=1.01*(Math.cos(Math.PI/2-this._pitch)*j+g),W=this.height/50;v=new Float64Array(16),o.b4(v,this._fov,this.width/this.height,W,V),v[8]=2*-l.x/this.width,v[9]=2*l.y/this.height,o.J(v,v,[1,-1,1]),o.H(v,v,[0,0,-this.cameraToCenterDistance]),o.b5(v,v,this._pitch),o.ad(v,v,this.angle),o.H(v,v,[-d,-y,0]),this.mercatorMatrix=o.J([],v,[this.worldSize,this.worldSize,this.worldSize]),o.J(v,v,[1,1,this._pixelPerMeter]),this.pixelMatrix=o.K(new Float64Array(16),this.labelPlaneMatrix,v),o.H(v,v,[0,0,-this.elevation]),this.projMatrix=v,this.invProjMatrix=o.ar([],v),this.pixelMatrix3D=o.K(new Float64Array(16),this.labelPlaneMatrix,v);const lt=this.width%2/2,rt=this.height%2/2,ht=Math.cos(this.angle),gt=Math.sin(this.angle),Mt=d-Math.round(d)+ht*lt+gt*rt,Tt=y-Math.round(y)+ht*rt+gt*lt,_t=new Float64Array(v);if(o.H(_t,_t,[Mt>.5?Mt-1:Mt,Tt>.5?Tt-1:Tt,0]),this.alignedProjMatrix=_t,v=o.ar(new Float64Array(16),this.pixelMatrix),!v)throw new Error("failed to invert matrix");this.pixelMatrixInverse=v,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const l=this.pointCoordinate(new o.P(0,0)),d=[l.x*this.worldSize,l.y*this.worldSize,0,1];return o.af(d,d,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(0,l))}getCameraQueryGeometry(l){const d=this.getCameraPoint();if(l.length===1)return[l[0],d];{let y=d.x,v=d.y,E=d.x,U=d.y;for(const R of l)y=Math.min(y,R.x),v=Math.min(v,R.y),E=Math.max(E,R.x),U=Math.max(U,R.y);return[new o.P(y,v),new o.P(E,v),new o.P(E,U),new o.P(y,U),new o.P(y,v)]}}lngLatToCameraDepth(l,d){const y=this.locationCoordinate(l),v=[y.x*this.worldSize,y.y*this.worldSize,d,1];return o.af(v,v,this.projMatrix),v[2]/v[3]}}function Lc(C,l){var d=this;let y,v=!1,E=null,U=null;const R=()=>{E=null,v&&(C.apply(U,y),E=setTimeout(R,l),v=!1)};return function(){for(var g=arguments.length,w=new Array(g),T=0;T<g;T++)w[T]=arguments[T];return v=!0,U=d,y=w,E||R(),E}}class ro{constructor(l){this._getCurrentHash=()=>{const d=window.location.hash.replace("#","");if(this._hashName){let y;return d.split("&").map(v=>v.split("=")).forEach(v=>{v[0]===this._hashName&&(y=v)}),(y&&y[1]||"").split("/")}return d.split("/")},this._onHashChange=()=>{const d=this._getCurrentHash();if(d.length>=3&&!d.some(y=>isNaN(y))){const y=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(d[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+d[2],+d[1]],zoom:+d[0],bearing:y,pitch:+(d[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const d=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,d)}catch{}},this._updateHash=Lc(this._updateHashUnthrottled,300),this._hashName=l&&encodeURIComponent(l)}addTo(l){return this._map=l,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(l){const d=this._map.getCenter(),y=Math.round(100*this._map.getZoom())/100,v=Math.ceil((y*Math.LN2+Math.log(512/360/.5))/Math.LN10),E=Math.pow(10,v),U=Math.round(d.lng*E)/E,R=Math.round(d.lat*E)/E,g=this._map.getBearing(),w=this._map.getPitch();let T="";if(T+=l?`/${U}/${R}/${y}`:`${y}/${R}/${U}`,(g||w)&&(T+="/"+Math.round(10*g)/10),w&&(T+=`/${Math.round(w)}`),this._hashName){const L=this._hashName;let D=!1;const H=window.location.hash.slice(1).split("&").map(z=>{const j=z.split("=")[0];return j===L?(D=!0,`${j}=${T}`):z}).filter(z=>z);return D||H.push(`${L}=${T}`),`#${H.join("&")}`}return`#${T}`}}const wa={linearity:.3,easing:o.b6(0,0,.3,1)},Jo=o.e({deceleration:2500,maxSpeed:1400},wa),Ka=o.e({deceleration:20,maxSpeed:1400},wa),Co=o.e({deceleration:1e3,maxSpeed:360},wa),xa=o.e({deceleration:1e3,maxSpeed:90},wa);class Fc{constructor(l){this._map=l,this.clear()}clear(){this._inertiaBuffer=[]}record(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:_.now(),settings:l})}_drainInertiaBuffer(){const l=this._inertiaBuffer,d=_.now();for(;l.length>0&&d-l[0].time>160;)l.shift()}_onMoveEnd(l){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const d={zoom:0,bearing:0,pitch:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:E}of this._inertiaBuffer)d.zoom+=E.zoomDelta||0,d.bearing+=E.bearingDelta||0,d.pitch+=E.pitchDelta||0,E.panDelta&&d.pan._add(E.panDelta),E.around&&(d.around=E.around),E.pinchAround&&(d.pinchAround=E.pinchAround);const y=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,v={};if(d.pan.mag()){const E=Yo(d.pan.mag(),y,o.e({},Jo,l||{}));v.offset=d.pan.mult(E.amount/d.pan.mag()),v.center=this._map.transform.center,Ba(v,E)}if(d.zoom){const E=Yo(d.zoom,y,Ka);v.zoom=this._map.transform.zoom+E.amount,Ba(v,E)}if(d.bearing){const E=Yo(d.bearing,y,Co);v.bearing=this._map.transform.bearing+o.ac(E.amount,-179,179),Ba(v,E)}if(d.pitch){const E=Yo(d.pitch,y,xa);v.pitch=this._map.transform.pitch+E.amount,Ba(v,E)}if(v.zoom||v.bearing){const E=d.pinchAround===void 0?d.around:d.pinchAround;v.around=E?this._map.unproject(E):this._map.getCenter()}return this.clear(),o.e(v,{noMoveStart:!0})}}function Ba(C,l){(!C.duration||C.duration<l.duration)&&(C.duration=l.duration,C.easing=l.easing)}function Yo(C,l,d){const{maxSpeed:y,linearity:v,deceleration:E}=d,U=o.ac(C*v/(l/1e3),-y,y),R=Math.abs(U)/(E*v);return{easing:d.easing,duration:1e3*R,amount:U*(R/2)}}class Ei extends o.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,d,y){let v=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const E=x.mousePos(d.getCanvas(),y),U=d.unproject(E);super(l,o.e({point:E,lngLat:U,originalEvent:y},v)),this._defaultPrevented=!1,this.target=d}}class zs extends o.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,d,y){const v=l==="touchend"?y.changedTouches:y.touches,E=x.touchPos(d.getCanvasContainer(),v),U=E.map(g=>d.unproject(g)),R=E.reduce((g,w,T,L)=>g.add(w.div(L.length)),new o.P(0,0));super(l,{points:E,point:R,lngLats:U,lngLat:d.unproject(R),originalEvent:y}),this._defaultPrevented=!1}}class Gs extends o.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,d,y){super(l,{originalEvent:y}),this._defaultPrevented=!1}}class Ni{constructor(l,d){this._map=l,this._clickTolerance=d.clickTolerance}reset(){delete this._mousedownPos}wheel(l){return this._firePreventable(new Gs(l.type,this._map,l))}mousedown(l,d){return this._mousedownPos=d,this._firePreventable(new Ei(l.type,this._map,l))}mouseup(l){this._map.fire(new Ei(l.type,this._map,l))}click(l,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||this._map.fire(new Ei(l.type,this._map,l))}dblclick(l){return this._firePreventable(new Ei(l.type,this._map,l))}mouseover(l){this._map.fire(new Ei(l.type,this._map,l))}mouseout(l){this._map.fire(new Ei(l.type,this._map,l))}touchstart(l){return this._firePreventable(new zs(l.type,this._map,l))}touchmove(l){this._map.fire(new zs(l.type,this._map,l))}touchend(l){this._map.fire(new zs(l.type,this._map,l))}touchcancel(l){this._map.fire(new zs(l.type,this._map,l))}_firePreventable(l){if(this._map.fire(l),l.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class vn{constructor(l){this._map=l}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(l){this._map.fire(new Ei(l.type,this._map,l))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ei("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(l){this._delayContextMenu?this._contextMenuEvent=l:this._ignoreContextMenu||this._map.fire(new Ei(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ln{constructor(l){this._map=l}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(l){return this.transform.pointLocation(o.P.convert(l),this._map.terrain)}}class Fn{constructor(l,d){this._map=l,this._tr=new Ln(l),this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=d.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(l,d){this.isEnabled()&&l.shiftKey&&l.button===0&&(x.disableDrag(),this._startPos=this._lastPos=d,this._active=!0)}mousemoveWindow(l,d){if(!this._active)return;const y=d;if(this._lastPos.equals(y)||!this._box&&y.dist(this._startPos)<this._clickTolerance)return;const v=this._startPos;this._lastPos=y,this._box||(this._box=x.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",l));const E=Math.min(v.x,y.x),U=Math.max(v.x,y.x),R=Math.min(v.y,y.y),g=Math.max(v.y,y.y);x.setTransform(this._box,`translate(${E}px,${R}px)`),this._box.style.width=U-E+"px",this._box.style.height=g-R+"px"}mouseupWindow(l,d){if(!this._active||l.button!==0)return;const y=this._startPos,v=d;if(this.reset(),x.suppressClick(),y.x!==v.x||y.y!==v.y)return this._map.fire(new o.k("boxzoomend",{originalEvent:l})),{cameraAnimation:E=>E.fitScreenCoordinates(y,v,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",l)}keydown(l){this._active&&l.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",l))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(x.remove(this._box),this._box=null),x.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(l,d){return this._map.fire(new o.k(l,{originalEvent:d}))}}function ei(C,l){if(C.length!==l.length)throw new Error(`The number of touches and points are not equal - touches ${C.length}, points ${l.length}`);const d={};for(let y=0;y<C.length;y++)d[C[y].identifier]=l[y];return d}class $a{constructor(l){this.reset(),this.numTouches=l.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(l,d,y){(this.centroid||y.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=l.timeStamp),y.length===this.numTouches&&(this.centroid=function(v){const E=new o.P(0,0);for(const U of v)E._add(U);return E.div(v.length)}(d),this.touches=ei(y,d)))}touchmove(l,d,y){if(this.aborted||!this.centroid)return;const v=ei(y,d);for(const E in this.touches){const U=v[E];(!U||U.dist(this.touches[E])>30)&&(this.aborted=!0)}}touchend(l,d,y){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),y.length===0){const v=!this.aborted&&this.centroid;if(this.reset(),v)return v}}}class Ca{constructor(l){this.singleTap=new $a(l),this.numTaps=l.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(l,d,y){this.singleTap.touchstart(l,d,y)}touchmove(l,d,y){this.singleTap.touchmove(l,d,y)}touchend(l,d,y){const v=this.singleTap.touchend(l,d,y);if(v){const E=l.timeStamp-this.lastTime<500,U=!this.lastTap||this.lastTap.dist(v)<30;if(E&&U||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=v,this.count===this.numTaps)return this.reset(),v}}}class pu{constructor(l){this._tr=new Ln(l),this._zoomIn=new Ca({numTouches:1,numTaps:2}),this._zoomOut=new Ca({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(l,d,y){this._zoomIn.touchstart(l,d,y),this._zoomOut.touchstart(l,d,y)}touchmove(l,d,y){this._zoomIn.touchmove(l,d,y),this._zoomOut.touchmove(l,d,y)}touchend(l,d,y){const v=this._zoomIn.touchend(l,d,y),E=this._zoomOut.touchend(l,d,y),U=this._tr;return v?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:R=>R.easeTo({duration:300,zoom:U.zoom+1,around:U.unproject(v)},{originalEvent:l})}):E?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:R=>R.easeTo({duration:300,zoom:U.zoom-1,around:U.unproject(E)},{originalEvent:l})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Wa{constructor(l){this._enabled=!!l.enable,this._moveStateManager=l.moveStateManager,this._clickTolerance=l.clickTolerance||1,this._moveFunction=l.move,this._activateOnStart=!!l.activateOnStart,l.assignEvents(this),this.reset()}reset(l){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(l)}_move(){const l=this._moveFunction(...arguments);if(l.bearingDelta||l.pitchDelta||l.around||l.panDelta)return this._active=!0,l}dragStart(l,d){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(l)&&(this._moveStateManager.startMove(l),this._lastPoint=d.length?d[0]:d,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(l,d){if(!this.isEnabled())return;const y=this._lastPoint;if(!y)return;if(l.preventDefault(),!this._moveStateManager.isValidMoveEvent(l))return void this.reset(l);const v=d.length?d[0]:d;return!this._moved&&v.dist(y)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=v,this._move(y,v))}dragEnd(l){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(l)&&(this._moved&&x.suppressClick(),this.reset(l))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const gu={0:1,2:2};class Zo{constructor(l){this._correctEvent=l.checkCorrectEvent}startMove(l){const d=x.mouseButton(l);this._eventButton=d}endMove(l){delete this._eventButton}isValidStartEvent(l){return this._correctEvent(l)}isValidMoveEvent(l){return!function(d,y){const v=gu[y];return d.buttons===void 0||(d.buttons&v)!==v}(l,this._eventButton)}isValidEndEvent(l){return x.mouseButton(l)===this._eventButton}}class tr{constructor(){this._firstTouch=void 0}_isOneFingerTouch(l){return l.targetTouches.length===1}_isSameTouchEvent(l){return l.targetTouches[0].identifier===this._firstTouch}startMove(l){this._firstTouch=l.targetTouches[0].identifier}endMove(l){delete this._firstTouch}isValidStartEvent(l){return this._isOneFingerTouch(l)}isValidMoveEvent(l){return this._isOneFingerTouch(l)&&this._isSameTouchEvent(l)}isValidEndEvent(l){return this._isOneFingerTouch(l)&&this._isSameTouchEvent(l)}}const oA=C=>{C.mousedown=C.dragStart,C.mousemoveWindow=C.dragMove,C.mouseup=C.dragEnd,C.contextmenu=function(l){l.preventDefault()}},bl=C=>{let{enable:l,clickTolerance:d,bearingDegreesPerPixelMoved:y=.8}=C;const v=new Zo({checkCorrectEvent:E=>x.mouseButton(E)===0&&E.ctrlKey||x.mouseButton(E)===2});return new Wa({clickTolerance:d,move:(E,U)=>({bearingDelta:(U.x-E.x)*y}),moveStateManager:v,enable:l,assignEvents:oA})},wl=C=>{let{enable:l,clickTolerance:d,pitchDegreesPerPixelMoved:y=-.5}=C;const v=new Zo({checkCorrectEvent:E=>x.mouseButton(E)===0&&E.ctrlKey||x.mouseButton(E)===2});return new Wa({clickTolerance:d,move:(E,U)=>({pitchDelta:(U.y-E.y)*y}),moveStateManager:v,enable:l,assignEvents:oA})};class lh{constructor(l,d){this._clickTolerance=l.clickTolerance||1,this._map=d,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0)}minTouchs(){return this._map.cooperativeGestures.isEnabled()?2:1}touchstart(l,d,y){return this._calculateTransform(l,d,y)}touchmove(l,d,y){if(this._active&&!(y.length<this.minTouchs()))return l.preventDefault(),this._calculateTransform(l,d,y)}touchend(l,d,y){this._calculateTransform(l,d,y),this._active&&y.length<this.minTouchs()&&this.reset()}touchcancel(){this.reset()}_calculateTransform(l,d,y){y.length>0&&(this._active=!0);const v=ei(y,d),E=new o.P(0,0),U=new o.P(0,0);let R=0;for(const w in v){const T=v[w],L=this._touches[w];L&&(E._add(T),U._add(T.sub(L)),R++,v[w]=T)}if(this._touches=v,R<this.minTouchs()||!U.mag())return;const g=U.div(R);return this._sum._add(g),this._sum.mag()<this._clickTolerance?void 0:{around:E.div(R),panDelta:g}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class qe{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(l,d,y){this._firstTwoTouches||y.length<2||(this._firstTwoTouches=[y[0].identifier,y[1].identifier],this._start([d[0],d[1]]))}touchmove(l,d,y){if(!this._firstTwoTouches)return;l.preventDefault();const[v,E]=this._firstTwoTouches,U=Wi(y,d,v),R=Wi(y,d,E);if(!U||!R)return;const g=this._aroundCenter?null:U.add(R).div(2);return this._move([U,R],g,l)}touchend(l,d,y){if(!this._firstTwoTouches)return;const[v,E]=this._firstTwoTouches,U=Wi(y,d,v),R=Wi(y,d,E);U&&R||(this._active&&x.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(l){this._enabled=!0,this._aroundCenter=!!l&&l.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Wi(C,l,d){for(let y=0;y<C.length;y++)if(C[y].identifier===d)return l[y]}function no(C,l){return Math.log(C/l)/Math.LN2}class aA extends qe{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(l){this._startDistance=this._distance=l[0].dist(l[1])}_move(l,d){const y=this._distance;if(this._distance=l[0].dist(l[1]),this._active||!(Math.abs(no(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:no(this._distance,y),pinchAround:d}}}function xl(C,l){return 180*C.angleWith(l)/Math.PI}class uh extends qe{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(l){this._startVector=this._vector=l[0].sub(l[1]),this._minDiameter=l[0].dist(l[1])}_move(l,d,y){const v=this._vector;if(this._vector=l[0].sub(l[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:xl(this._vector,v),pinchAround:d}}_isBelowThreshold(l){this._minDiameter=Math.min(this._minDiameter,l.mag());const d=25/(Math.PI*this._minDiameter)*360,y=xl(l,this._startVector);return Math.abs(y)<d}}function Bl(C){return Math.abs(C.y)>Math.abs(C.x)}class cA extends qe{constructor(l){super(),this._currentTouchCount=0,this._map=l}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(l,d,y){super.touchstart(l,d,y),this._currentTouchCount=y.length}_start(l){this._lastPoints=l,Bl(l[0].sub(l[1]))&&(this._valid=!1)}_move(l,d,y){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const v=l[0].sub(this._lastPoints[0]),E=l[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(v,E,y.timeStamp),this._valid?(this._lastPoints=l,this._active=!0,{pitchDelta:(v.y+E.y)/2*-.5}):void 0}gestureBeginsVertically(l,d,y){if(this._valid!==void 0)return this._valid;const v=l.mag()>=2,E=d.mag()>=2;if(!v&&!E)return;if(!v||!E)return this._firstMove===void 0&&(this._firstMove=y),y-this._firstMove<100&&void 0;const U=l.y>0==d.y>0;return Bl(l)&&Bl(d)&&U}}const wd={panStep:100,bearingStep:15,pitchStep:10};class Xa{constructor(l){this._tr=new Ln(l);const d=wd;this._panStep=d.panStep,this._bearingStep=d.bearingStep,this._pitchStep=d.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(l){if(l.altKey||l.ctrlKey||l.metaKey)return;let d=0,y=0,v=0,E=0,U=0;switch(l.keyCode){case 61:case 107:case 171:case 187:d=1;break;case 189:case 109:case 173:d=-1;break;case 37:l.shiftKey?y=-1:(l.preventDefault(),E=-1);break;case 39:l.shiftKey?y=1:(l.preventDefault(),E=1);break;case 38:l.shiftKey?v=1:(l.preventDefault(),U=-1);break;case 40:l.shiftKey?v=-1:(l.preventDefault(),U=1);break;default:return}return this._rotationDisabled&&(y=0,v=0),{cameraAnimation:R=>{const g=this._tr;R.easeTo({duration:300,easeId:"keyboardHandler",easing:Gn,zoom:d?Math.round(g.zoom)+d*(l.shiftKey?2:1):g.zoom,bearing:g.bearing+y*this._bearingStep,pitch:g.pitch+v*this._pitchStep,offset:[-E*this._panStep,-U*this._panStep],center:g.center},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Gn(C){return C*(2-C)}const Cl=4.000244140625;class El{constructor(l,d){this._onTimeout=y=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(y)},this._map=l,this._tr=new Ln(l),this._triggerRenderFrame=d,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(l){this._defaultZoomRate=l}setWheelZoomRate(l){this._wheelZoomRate=l}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!l&&l.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(l){if(!this.isEnabled()||this._map.cooperativeGestures.isEnabled()&&!l[this._map.cooperativeGestures._bypassKey])return;let d=l.deltaMode===WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY;const y=_.now(),v=y-(this._lastWheelEventTime||0);this._lastWheelEventTime=y,d!==0&&d%Cl==0?this._type="wheel":d!==0&&Math.abs(d)<4?this._type="trackpad":v>400?(this._type=null,this._lastValue=d,this._timeout=setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(v*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),l.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=l,this._delta-=d,this._active||this._start(l)),l.preventDefault()}_start(l){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const d=x.mousePos(this._map.getCanvas(),l),y=this._tr;this._around=d.y>y.transform.height/2-y.transform.getHorizon()?o.M.convert(this._aroundCenter?y.center:y.unproject(d)):o.M.convert(y.center),this._aroundPoint=y.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const l=this._tr.transform;if(this._delta!==0){const R=this._type==="wheel"&&Math.abs(this._delta)>Cl?this._wheelZoomRate:this._defaultZoomRate;let g=2/(1+Math.exp(-Math.abs(this._delta*R)));this._delta<0&&g!==0&&(g=1/g);const w=typeof this._targetZoom=="number"?l.zoomScale(this._targetZoom):l.scale;this._targetZoom=Math.min(l.maxZoom,Math.max(l.minZoom,l.scaleZoom(w*g))),this._type==="wheel"&&(this._startZoom=l.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const d=typeof this._targetZoom=="number"?this._targetZoom:l.zoom,y=this._startZoom,v=this._easing;let E,U=!1;if(this._type==="wheel"&&y&&v){const R=Math.min((_.now()-this._lastWheelEventTime)/200,1),g=v(R);E=o.z.number(y,d,g),R<1?this._frameId||(this._frameId=!0):U=!0}else E=d,U=!0;return this._active=!0,U&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!U,zoomDelta:E-l.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(l){let d=o.b7;if(this._prevEase){const y=this._prevEase,v=(_.now()-y.start)/y.duration,E=y.easing(v+.01)-y.easing(v),U=.27/Math.sqrt(E*E+1e-4)*.01,R=Math.sqrt(.0729-U*U);d=o.b6(U,R,.25,1)}return this._prevEase={start:_.now(),duration:l,easing:d},d}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class lA{constructor(l,d){this._clickZoom=l,this._tapZoom=d}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class fp{constructor(l){this._tr=new Ln(l),this.reset()}reset(){this._active=!1}dblclick(l,d){return l.preventDefault(),{cameraAnimation:y=>{y.easeTo({duration:300,zoom:this._tr.zoom+(l.shiftKey?-1:1),around:this._tr.unproject(d)},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class pp{constructor(){this._tap=new Ca({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(l,d,y){if(!this._swipePoint)if(this._tapTime){const v=d[0],E=l.timeStamp-this._tapTime<500,U=this._tapPoint.dist(v)<30;E&&U?y.length>0&&(this._swipePoint=v,this._swipeTouch=y[0].identifier):this.reset()}else this._tap.touchstart(l,d,y)}touchmove(l,d,y){if(this._tapTime){if(this._swipePoint){if(y[0].identifier!==this._swipeTouch)return;const v=d[0],E=v.y-this._swipePoint.y;return this._swipePoint=v,l.preventDefault(),this._active=!0,{zoomDelta:E/128}}}else this._tap.touchmove(l,d,y)}touchend(l,d,y){if(this._tapTime)this._swipePoint&&y.length===0&&this.reset();else{const v=this._tap.touchend(l,d,y);v&&(this._tapTime=l.timeStamp,this._tapPoint=v)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class xd{constructor(l,d,y){this._el=l,this._mousePan=d,this._touchPan=y}enable(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ta{constructor(l,d,y){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=d,this._mousePitch=y}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class uA{constructor(l,d,y,v){this._el=l,this._touchZoom=d,this._touchRotate=y,this._tapDragZoom=v,this._rotationDisabled=!1,this._enabled=!0}enable(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class dr{constructor(l,d){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=l,this._options=d,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const l=this._map.getCanvasContainer();l.classList.add("maplibregl-cooperative-gestures"),this._container=x.create("div","maplibregl-cooperative-gesture-screen",l);let d=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(d=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const y=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),v=document.createElement("div");v.className="maplibregl-desktop-message",v.textContent=d,this._container.appendChild(v);const E=document.createElement("div");E.className="maplibregl-mobile-message",E.textContent=y,this._container.appendChild(E),this._container.setAttribute("aria-hidden","true")}_destoryUI(){this._container&&(x.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destoryUI()}isEnabled(){return this._enabled}touchmove(l){this._onCooperativeGesture(l.touches.length===1)}wheel(l){this._map.scrollZoom.isEnabled()&&this._onCooperativeGesture(!l[this._bypassKey])}_onCooperativeGesture(l){this._enabled&&l&&(this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const wr=C=>C.zoom||C.drag||C.pitch||C.rotate;class Ah extends o.k{}function Sl(C){return C.panDelta&&C.panDelta.mag()||C.zoomDelta||C.bearingDelta||C.pitchDelta}class AA{constructor(l,d){this.handleWindowEvent=v=>{this.handleEvent(v,`${v.type}Window`)},this.handleEvent=(v,E)=>{if(v.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const U=v.type==="renderFrame"?void 0:v,R={needsRenderFrame:!1},g={},w={},T=v.touches,L=T?this._getMapTouches(T):void 0,D=L?x.touchPos(this._map.getCanvas(),L):x.mousePos(this._map.getCanvas(),v);for(const{handlerName:j,handler:V,allowed:W}of this._handlers){if(!V.isEnabled())continue;let lt;this._blockedByActive(w,W,j)?V.reset():V[E||v.type]&&(lt=V[E||v.type](v,D,L),this.mergeHandlerResult(R,g,lt,j,U),lt&&lt.needsRenderFrame&&this._triggerRenderFrame()),(lt||V.isActive())&&(w[j]=V)}const H={};for(const j in this._previousActiveHandlers)w[j]||(H[j]=U);this._previousActiveHandlers=w,(Object.keys(H).length||Sl(R))&&(this._changes.push([R,g,H]),this._triggerRenderFrame()),(Object.keys(w).length||Sl(R))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:z}=R;z&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],z(this._map))},this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Fc(l),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(d);const y=this._el;this._listeners=[[y,"touchstart",{passive:!0}],[y,"touchmove",{passive:!1}],[y,"touchend",void 0],[y,"touchcancel",void 0],[y,"mousedown",void 0],[y,"mousemove",void 0],[y,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[y,"mouseover",void 0],[y,"mouseout",void 0],[y,"dblclick",void 0],[y,"click",void 0],[y,"keydown",{capture:!1}],[y,"keyup",void 0],[y,"wheel",{passive:!1}],[y,"contextmenu",void 0],[window,"blur",void 0]];for(const[v,E,U]of this._listeners)x.addEventListener(v,E,v===document?this.handleWindowEvent:this.handleEvent,U)}destroy(){for(const[l,d,y]of this._listeners)x.removeEventListener(l,d,l===document?this.handleWindowEvent:this.handleEvent,y)}_addDefaultHandlers(l){const d=this._map,y=d.getCanvasContainer();this._add("mapEvent",new Ni(d,l));const v=d.boxZoom=new Fn(d,l);this._add("boxZoom",v),l.interactive&&l.boxZoom&&v.enable();const E=d.cooperativeGestures=new dr(d,l.cooperativeGestures);this._add("cooperativeGestures",E),l.cooperativeGestures&&E.enable();const U=new pu(d),R=new fp(d);d.doubleClickZoom=new lA(R,U),this._add("tapZoom",U),this._add("clickZoom",R),l.interactive&&l.doubleClickZoom&&d.doubleClickZoom.enable();const g=new pp;this._add("tapDragZoom",g);const w=d.touchPitch=new cA(d);this._add("touchPitch",w),l.interactive&&l.touchPitch&&d.touchPitch.enable(l.touchPitch);const T=bl(l),L=wl(l);d.dragRotate=new ta(l,T,L),this._add("mouseRotate",T,["mousePitch"]),this._add("mousePitch",L,["mouseRotate"]),l.interactive&&l.dragRotate&&d.dragRotate.enable();const D=(lt=>{let{enable:rt,clickTolerance:ht}=lt;const gt=new Zo({checkCorrectEvent:Mt=>x.mouseButton(Mt)===0&&!Mt.ctrlKey});return new Wa({clickTolerance:ht,move:(Mt,Tt)=>({around:Tt,panDelta:Tt.sub(Mt)}),activateOnStart:!0,moveStateManager:gt,enable:rt,assignEvents:oA})})(l),H=new lh(l,d);d.dragPan=new xd(y,D,H),this._add("mousePan",D),this._add("touchPan",H,["touchZoom","touchRotate"]),l.interactive&&l.dragPan&&d.dragPan.enable(l.dragPan);const z=new uh,j=new aA;d.touchZoomRotate=new uA(y,j,z,g),this._add("touchRotate",z,["touchPan","touchZoom"]),this._add("touchZoom",j,["touchPan","touchRotate"]),l.interactive&&l.touchZoomRotate&&d.touchZoomRotate.enable(l.touchZoomRotate);const V=d.scrollZoom=new El(d,()=>this._triggerRenderFrame());this._add("scrollZoom",V,["mousePan"]),l.interactive&&l.scrollZoom&&d.scrollZoom.enable(l.scrollZoom);const W=d.keyboard=new Xa(d);this._add("keyboard",W),l.interactive&&l.keyboard&&d.keyboard.enable(),this._add("blockableMapEvent",new vn(d))}_add(l,d,y){this._handlers.push({handlerName:l,handler:d,allowed:y}),this._handlersById[l]=d}stop(l){if(!this._updatingCamera){for(const{handler:d}of this._handlers)d.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[]}}isActive(){for(const{handler:l}of this._handlers)if(l.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!wr(this._eventsInProgress)||this.isZooming()}_blockedByActive(l,d,y){for(const v in l)if(v!==y&&(!d||d.indexOf(v)<0))return!0;return!1}_getMapTouches(l){const d=[];for(const y of l)this._el.contains(y.target)&&d.push(y);return d}mergeHandlerResult(l,d,y,v,E){if(!y)return;o.e(l,y);const U={handlerName:v,originalEvent:y.originalEvent||E};y.zoomDelta!==void 0&&(d.zoom=U),y.panDelta!==void 0&&(d.drag=U),y.pitchDelta!==void 0&&(d.pitch=U),y.bearingDelta!==void 0&&(d.rotate=U)}_applyChanges(){const l={},d={},y={};for(const[v,E,U]of this._changes)v.panDelta&&(l.panDelta=(l.panDelta||new o.P(0,0))._add(v.panDelta)),v.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+v.zoomDelta),v.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+v.bearingDelta),v.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+v.pitchDelta),v.around!==void 0&&(l.around=v.around),v.pinchAround!==void 0&&(l.pinchAround=v.pinchAround),v.noInertia&&(l.noInertia=v.noInertia),o.e(d,E),o.e(y,U);this._updateMapTransform(l,d,y),this._changes=[]}_updateMapTransform(l,d,y){const v=this._map,E=v._getTransformForUpdate(),U=v.terrain;if(!(Sl(l)||U&&this._terrainMovement))return this._fireEvents(d,y,!0);let{panDelta:R,zoomDelta:g,bearingDelta:w,pitchDelta:T,around:L,pinchAround:D}=l;D!==void 0&&(L=D),v._stop(!0),L=L||v.transform.centerPoint;const H=E.pointLocation(R?L.sub(R):L);w&&(E.bearing+=w),T&&(E.pitch+=T),g&&(E.zoom+=g),U?this._terrainMovement||!d.drag&&!d.zoom?d.drag&&this._terrainMovement?E.center=E.pointLocation(E.centerPoint.sub(R)):E.setLocationAtPoint(H,L):(this._terrainMovement=!0,this._map._elevationFreeze=!0,E.setLocationAtPoint(H,L),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,E.recalculateZoom(v.terrain)})):E.setLocationAtPoint(H,L),v._applyUpdatedTransform(E),this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(d,y,!0)}_fireEvents(l,d,y){const v=wr(this._eventsInProgress),E=wr(l),U={};for(const T in l){const{originalEvent:L}=l[T];this._eventsInProgress[T]||(U[`${T}start`]=L),this._eventsInProgress[T]=l[T]}!v&&E&&this._fireEvent("movestart",E.originalEvent);for(const T in U)this._fireEvent(T,U[T]);E&&this._fireEvent("move",E.originalEvent);for(const T in l){const{originalEvent:L}=l[T];this._fireEvent(T,L)}const R={};let g;for(const T in this._eventsInProgress){const{handlerName:L,originalEvent:D}=this._eventsInProgress[T];this._handlersById[L].isActive()||(delete this._eventsInProgress[T],g=d[L]||D,R[`${T}end`]=g)}for(const T in R)this._fireEvent(T,R[T]);const w=wr(this._eventsInProgress);if(y&&(v||E)&&!w){this._updatingCamera=!0;const T=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),L=D=>D!==0&&-this._bearingSnap<D&&D<this._bearingSnap;!T||!T.essential&&_.prefersReducedMotion?(this._map.fire(new o.k("moveend",{originalEvent:g})),L(this._map.getBearing())&&this._map.resetNorth()):(L(T.bearing||this._map.getBearing())&&(T.bearing=0),T.freezeElevation=!0,this._map.easeTo(T,{originalEvent:g})),this._updatingCamera=!1}}_fireEvent(l,d){this._map.fire(new o.k(l,d?{originalEvent:d}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(l=>{delete this._frameId,this.handleEvent(new Ah("renderFrame",{timeStamp:l})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Xi extends o.E{constructor(l,d){super(),this._renderFrameCallback=()=>{const y=Math.min((_.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(y)),y<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=l,this._bearingSnap=d.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new o.M(this.transform.center.lng,this.transform.center.lat)}setCenter(l,d){return this.jumpTo({center:l},d)}panBy(l,d,y){return l=o.P.convert(l).mult(-1),this.panTo(this.transform.center,o.e({offset:l},d),y)}panTo(l,d,y){return this.easeTo(o.e({center:l},d),y)}getZoom(){return this.transform.zoom}setZoom(l,d){return this.jumpTo({zoom:l},d),this}zoomTo(l,d,y){return this.easeTo(o.e({zoom:l},d),y)}zoomIn(l,d){return this.zoomTo(this.getZoom()+1,l,d),this}zoomOut(l,d){return this.zoomTo(this.getZoom()-1,l,d),this}getBearing(){return this.transform.bearing}setBearing(l,d){return this.jumpTo({bearing:l},d),this}getPadding(){return this.transform.padding}setPadding(l,d){return this.jumpTo({padding:l},d),this}rotateTo(l,d,y){return this.easeTo(o.e({bearing:l},d),y)}resetNorth(l,d){return this.rotateTo(0,o.e({duration:1e3},l),d),this}resetNorthPitch(l,d){return this.easeTo(o.e({bearing:0,pitch:0,duration:1e3},l),d),this}snapToNorth(l,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(l,d):this}getPitch(){return this.transform.pitch}setPitch(l,d){return this.jumpTo({pitch:l},d),this}cameraForBounds(l,d){l=ze.convert(l);const y=d&&d.bearing||0;return this._cameraForBoxAndBearing(l.getNorthWest(),l.getSouthEast(),y,d)}_cameraForBoxAndBearing(l,d,y,v){const E={top:0,bottom:0,right:0,left:0};if(typeof(v=o.e({padding:E,offset:[0,0],maxZoom:this.transform.maxZoom},v)).padding=="number"){const Wt=v.padding;v.padding={top:Wt,bottom:Wt,right:Wt,left:Wt}}v.padding=o.e(E,v.padding);const U=this.transform,R=U.padding,g=new ze(l,d),w=U.project(g.getNorthWest()),T=U.project(g.getNorthEast()),L=U.project(g.getSouthEast()),D=U.project(g.getSouthWest()),H=o.b8(-y),z=w.rotate(H),j=T.rotate(H),V=L.rotate(H),W=D.rotate(H),lt=new o.P(Math.max(z.x,j.x,W.x,V.x),Math.max(z.y,j.y,W.y,V.y)),rt=new o.P(Math.min(z.x,j.x,W.x,V.x),Math.min(z.y,j.y,W.y,V.y)),ht=lt.sub(rt),gt=(U.width-(R.left+R.right+v.padding.left+v.padding.right))/ht.x,Mt=(U.height-(R.top+R.bottom+v.padding.top+v.padding.bottom))/ht.y;if(Mt<0||gt<0)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Tt=Math.min(U.scaleZoom(U.scale*Math.min(gt,Mt)),v.maxZoom),_t=o.P.convert(v.offset),bt=new o.P((v.padding.left-v.padding.right)/2,(v.padding.top-v.padding.bottom)/2).rotate(o.b8(y)),Gt=_t.add(bt).mult(U.scale/U.zoomScale(Tt));return{center:U.unproject(w.add(L).div(2).sub(Gt)),zoom:Tt,bearing:y}}fitBounds(l,d,y){return this._fitInternal(this.cameraForBounds(l,d),d,y)}fitScreenCoordinates(l,d,y,v,E){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(o.P.convert(l)),this.transform.pointLocation(o.P.convert(d)),y,v),v,E)}_fitInternal(l,d,y){return l?(delete(d=o.e(l,d)).padding,d.linear?this.easeTo(d,y):this.flyTo(d,y)):this}jumpTo(l,d){this.stop();const y=this._getTransformForUpdate();let v=!1,E=!1,U=!1;return"zoom"in l&&y.zoom!==+l.zoom&&(v=!0,y.zoom=+l.zoom),l.center!==void 0&&(y.center=o.M.convert(l.center)),"bearing"in l&&y.bearing!==+l.bearing&&(E=!0,y.bearing=+l.bearing),"pitch"in l&&y.pitch!==+l.pitch&&(U=!0,y.pitch=+l.pitch),l.padding==null||y.isPaddingEqual(l.padding)||(y.padding=l.padding),this._applyUpdatedTransform(y),this.fire(new o.k("movestart",d)).fire(new o.k("move",d)),v&&this.fire(new o.k("zoomstart",d)).fire(new o.k("zoom",d)).fire(new o.k("zoomend",d)),E&&this.fire(new o.k("rotatestart",d)).fire(new o.k("rotate",d)).fire(new o.k("rotateend",d)),U&&this.fire(new o.k("pitchstart",d)).fire(new o.k("pitch",d)).fire(new o.k("pitchend",d)),this.fire(new o.k("moveend",d))}calculateCameraOptionsFromTo(l,d,y){let v=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;const E=o.Y.fromLngLat(l,d),U=o.Y.fromLngLat(y,v),R=U.x-E.x,g=U.y-E.y,w=U.z-E.z,T=Math.hypot(R,g,w);if(T===0)throw new Error("Can't calculate camera options with same From and To");const L=Math.hypot(R,g),D=this.transform.scaleZoom(this.transform.cameraToCenterDistance/T/this.transform.tileSize),H=180*Math.atan2(R,-g)/Math.PI;let z=180*Math.acos(L/T)/Math.PI;return z=w<0?90-z:90+z,{center:U.toLngLat(),zoom:D,pitch:z,bearing:H}}easeTo(l,d){var y;this._stop(!1,l.easeId),((l=o.e({offset:[0,0],duration:500,easing:o.b7},l)).animate===!1||!l.essential&&_.prefersReducedMotion)&&(l.duration=0);const v=this._getTransformForUpdate(),E=this.getZoom(),U=this.getBearing(),R=this.getPitch(),g=this.getPadding(),w="bearing"in l?this._normalizeBearing(l.bearing,U):U,T="pitch"in l?+l.pitch:R,L="padding"in l?l.padding:v.padding,D=o.P.convert(l.offset);let H=v.centerPoint.add(D);const z=v.pointLocation(H),{center:j,zoom:V}=v.getConstrained(o.M.convert(l.center||z),(y=l.zoom)!==null&&y!==void 0?y:E);this._normalizeCenter(j);const W=v.project(z),lt=v.project(j).sub(W),rt=v.zoomScale(V-E);let ht,gt;l.around&&(ht=o.M.convert(l.around),gt=v.locationPoint(ht));const Mt={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||V!==E,this._rotating=this._rotating||U!==w,this._pitching=this._pitching||T!==R,this._padding=!v.isPaddingEqual(L),this._easeId=l.easeId,this._prepareEase(d,l.noMoveStart,Mt),this.terrain&&this._prepareElevation(j),this._ease(Tt=>{if(this._zooming&&(v.zoom=o.z.number(E,V,Tt)),this._rotating&&(v.bearing=o.z.number(U,w,Tt)),this._pitching&&(v.pitch=o.z.number(R,T,Tt)),this._padding&&(v.interpolatePadding(g,L,Tt),H=v.centerPoint.add(D)),this.terrain&&!l.freezeElevation&&this._updateElevation(Tt),ht)v.setLocationAtPoint(ht,gt);else{const _t=v.zoomScale(v.zoom-E),bt=V>E?Math.min(2,rt):Math.max(.5,rt),Gt=Math.pow(bt,1-Tt),Wt=v.unproject(W.add(lt.mult(Tt*Gt)).mult(_t));v.setLocationAtPoint(v.renderWorldCopies?Wt.wrap():Wt,H)}this._applyUpdatedTransform(v),this._fireMoveEvents(d)},Tt=>{this.terrain&&this._finalizeElevation(),this._afterEase(d,Tt)},l),this}_prepareEase(l,d){let y=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this._moving=!0,d||y.moving||this.fire(new o.k("movestart",l)),this._zooming&&!y.zooming&&this.fire(new o.k("zoomstart",l)),this._rotating&&!y.rotating&&this.fire(new o.k("rotatestart",l)),this._pitching&&!y.pitching&&this.fire(new o.k("pitchstart",l))}_prepareElevation(l){this._elevationCenter=l,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(l,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(l){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const d=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(l<1&&d!==this._elevationTarget){const y=this._elevationTarget-this._elevationStart;this._elevationStart+=l*(y-(d-(y*l+this._elevationStart))/(1-l)),this._elevationTarget=d}this.transform.elevation=o.z.number(this._elevationStart,this._elevationTarget,l)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(l){if(!this.transformCameraUpdate)return;const d=l.clone(),{center:y,zoom:v,pitch:E,bearing:U,elevation:R}=this.transformCameraUpdate(d);y&&(d.center=y),v!==void 0&&(d.zoom=v),E!==void 0&&(d.pitch=E),U!==void 0&&(d.bearing=U),R!==void 0&&(d.elevation=R),this.transform.apply(d)}_fireMoveEvents(l){this.fire(new o.k("move",l)),this._zooming&&this.fire(new o.k("zoom",l)),this._rotating&&this.fire(new o.k("rotate",l)),this._pitching&&this.fire(new o.k("pitch",l))}_afterEase(l,d){if(this._easeId&&d&&this._easeId===d)return;delete this._easeId;const y=this._zooming,v=this._rotating,E=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,y&&this.fire(new o.k("zoomend",l)),v&&this.fire(new o.k("rotateend",l)),E&&this.fire(new o.k("pitchend",l)),this.fire(new o.k("moveend",l))}flyTo(l,d){var y;if(!l.essential&&_.prefersReducedMotion){const Ce=o.L(l,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ce,d)}this.stop(),l=o.e({offset:[0,0],speed:1.2,curve:1.42,easing:o.b7},l);const v=this._getTransformForUpdate(),E=this.getZoom(),U=this.getBearing(),R=this.getPitch(),g=this.getPadding(),w="bearing"in l?this._normalizeBearing(l.bearing,U):U,T="pitch"in l?+l.pitch:R,L="padding"in l?l.padding:v.padding,D=o.P.convert(l.offset);let H=v.centerPoint.add(D);const z=v.pointLocation(H),{center:j,zoom:V}=v.getConstrained(o.M.convert(l.center||z),(y=l.zoom)!==null&&y!==void 0?y:E);this._normalizeCenter(j);const W=v.zoomScale(V-E),lt=v.project(z),rt=v.project(j).sub(lt);let ht=l.curve;const gt=Math.max(v.width,v.height),Mt=gt/W,Tt=rt.mag();if("minZoom"in l){const Ce=o.ac(Math.min(l.minZoom,E,V),v.minZoom,v.maxZoom),We=gt/v.zoomScale(Ce-E);ht=Math.sqrt(We/Tt*2)}const _t=ht*ht;function bt(Ce){const We=(Mt*Mt-gt*gt+(Ce?-1:1)*_t*_t*Tt*Tt)/(2*(Ce?Mt:gt)*_t*Tt);return Math.log(Math.sqrt(We*We+1)-We)}function Gt(Ce){return(Math.exp(Ce)-Math.exp(-Ce))/2}function Wt(Ce){return(Math.exp(Ce)+Math.exp(-Ce))/2}const ue=bt(!1);let Ae=function(Ce){return Wt(ue)/Wt(ue+ht*Ce)},ye=function(Ce){return gt*((Wt(ue)*(Gt(We=ue+ht*Ce)/Wt(We))-Gt(ue))/_t)/Tt;var We},Oe=(bt(!0)-ue)/ht;if(Math.abs(Tt)<1e-6||!isFinite(Oe)){if(Math.abs(gt-Mt)<1e-6)return this.easeTo(l,d);const Ce=Mt<gt?-1:1;Oe=Math.abs(Math.log(Mt/gt))/ht,ye=function(){return 0},Ae=function(We){return Math.exp(Ce*ht*We)}}return l.duration="duration"in l?+l.duration:1e3*Oe/("screenSpeed"in l?+l.screenSpeed/ht:+l.speed),l.maxDuration&&l.duration>l.maxDuration&&(l.duration=0),this._zooming=!0,this._rotating=U!==w,this._pitching=T!==R,this._padding=!v.isPaddingEqual(L),this._prepareEase(d,!1),this.terrain&&this._prepareElevation(j),this._ease(Ce=>{const We=Ce*Oe,nr=1/Ae(We);v.zoom=Ce===1?V:E+v.scaleZoom(nr),this._rotating&&(v.bearing=o.z.number(U,w,Ce)),this._pitching&&(v.pitch=o.z.number(R,T,Ce)),this._padding&&(v.interpolatePadding(g,L,Ce),H=v.centerPoint.add(D)),this.terrain&&!l.freezeElevation&&this._updateElevation(Ce);const rr=Ce===1?j:v.unproject(lt.add(rt.mult(ye(We))).mult(nr));v.setLocationAtPoint(v.renderWorldCopies?rr.wrap():rr,H),this._applyUpdatedTransform(v),this._fireMoveEvents(d)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(d)},l),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(l,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const y=this._onEaseEnd;delete this._onEaseEnd,y.call(this,d)}if(!l){const y=this.handlers;y&&y.stop(!1)}return this}_ease(l,d,y){y.animate===!1||y.duration===0?(l(1),d()):(this._easeStart=_.now(),this._easeOptions=y,this._onEaseFrame=l,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(l,d){l=o.b1(l,-180,180);const y=Math.abs(l-d);return Math.abs(l-360-d)<y&&(l-=360),Math.abs(l+360-d)<y&&(l+=360),l}_normalizeCenter(l){const d=this.transform;if(!d.renderWorldCopies||d.lngRange)return;const y=l.lng-d.center.lng;l.lng+=y>180?-360:y<-180?360:0}queryTerrainElevation(l){return this.terrain?this.terrain.getElevationForLngLatZoom(o.M.convert(l),this.transform.tileZoom)-this.transform.elevation:null}}const Bd={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class ea{constructor(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Bd;this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=d=>{!d||d.sourceDataType!=="metadata"&&d.sourceDataType!=="visibility"&&d.dataType!=="style"&&d.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=l}getDefaultPosition(){return"bottom-right"}onAdd(l){return this._map=l,this._compact=this.options.compact,this._container=x.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=x.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=x.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){x.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(l,d){const y=this._map._getUIString(`AttributionControl.${d}`);l.title=y,l.setAttribute("aria-label",y)}_updateAttributions(){if(!this._map.style)return;let l=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=l.concat(this.options.customAttribution.map(v=>typeof v!="string"?"":v)):typeof this.options.customAttribution=="string"&&l.push(this.options.customAttribution)),this._map.style.stylesheet){const v=this._map.style.stylesheet;this.styleOwner=v.owner,this.styleId=v.id}const d=this._map.style.sourceCaches;for(const v in d){const E=d[v];if(E.used||E.usedForTerrain){const U=E.getSource();U.attribution&&l.indexOf(U.attribution)<0&&l.push(U.attribution)}}l=l.filter(v=>String(v).trim()),l.sort((v,E)=>v.length-E.length),l=l.filter((v,E)=>{for(let U=E+1;U<l.length;U++)if(l[U].indexOf(v)>=0)return!1;return!0});const y=l.join(" | ");y!==this._attribHTML&&(this._attribHTML=y,l.length?(this._innerContainer.innerHTML=y,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Cd{constructor(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._updateCompact=()=>{const d=this._container.children;if(d.length){const y=d[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&y.classList.add("maplibregl-compact"):y.classList.remove("maplibregl-compact")}},this.options=l}getDefaultPosition(){return"bottom-left"}onAdd(l){this._map=l,this._compact=this.options&&this.options.compact,this._container=x.create("div","maplibregl-ctrl");const d=x.create("a","maplibregl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://maplibre.org/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){x.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class hA{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(l){const d=++this._id;return this._queue.push({callback:l,id:d,cancelled:!1}),d}remove(l){const d=this._currentlyRunning,y=d?this._queue.concat(d):this._queue;for(const v of y)if(v.id===l)return void(v.cancelled=!0)}run(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const d=this._currentlyRunning=this._queue;this._queue=[];for(const y of d)if(!y.cancelled&&(y.callback(l),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var di=o.X([{name:"a_pos3d",type:"Int16",components:3}]);class Si extends o.E{constructor(l){super(),this.sourceCache=l,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,l.usedForTerrain=!0,l.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(l,d){this.sourceCache.update(l,d),this._renderableTilesKeys=[];const y={};for(const v of l.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:d}))y[v.key]=!0,this._renderableTilesKeys.push(v.key),this._tiles[v.key]||(v.posMatrix=new Float64Array(16),o.aN(v.posMatrix,0,o.W,0,o.W,0,1),this._tiles[v.key]=new Ir(v,this.tileSize));for(const v in this._tiles)y[v]||delete this._tiles[v]}freeRtt(l){for(const d in this._tiles){const y=this._tiles[d];(!l||y.tileID.equals(l)||y.tileID.isChildOf(l)||l.isChildOf(y.tileID))&&(y.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(l=>this.getTileByID(l))}getTileByID(l){return this._tiles[l]}getTerrainCoords(l){const d={};for(const y of this._renderableTilesKeys){const v=this._tiles[y].tileID;if(v.canonical.equals(l.canonical)){const E=l.clone();E.posMatrix=new Float64Array(16),o.aN(E.posMatrix,0,o.W,0,o.W,0,1),d[y]=E}else if(v.canonical.isChildOf(l.canonical)){const E=l.clone();E.posMatrix=new Float64Array(16);const U=v.canonical.z-l.canonical.z,R=v.canonical.x-(v.canonical.x>>U<<U),g=v.canonical.y-(v.canonical.y>>U<<U),w=o.W>>U;o.aN(E.posMatrix,0,w,0,w,0,1),o.H(E.posMatrix,E.posMatrix,[-R*w,-g*w,0]),d[y]=E}else if(l.canonical.isChildOf(v.canonical)){const E=l.clone();E.posMatrix=new Float64Array(16);const U=l.canonical.z-v.canonical.z,R=l.canonical.x-(l.canonical.x>>U<<U),g=l.canonical.y-(l.canonical.y>>U<<U),w=o.W>>U;o.aN(E.posMatrix,0,o.W,0,o.W,0,1),o.H(E.posMatrix,E.posMatrix,[R*w,g*w,0]),o.J(E.posMatrix,E.posMatrix,[1/2**U,1/2**U,0]),d[y]=E}}return d}getSourceTile(l,d){const y=this.sourceCache._source;let v=l.overscaledZ-this.deltaZoom;if(v>y.maxzoom&&(v=y.maxzoom),v<y.minzoom)return null;this._sourceTileCache[l.key]||(this._sourceTileCache[l.key]=l.scaledTo(v).key);let E=this.sourceCache.getTileByID(this._sourceTileCache[l.key]);if((!E||!E.dem)&&d)for(;v>=y.minzoom&&(!E||!E.dem);)E=this.sourceCache.getTileByID(l.scaledTo(v--).key);return E}tilesAfterTime(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Date.now();return Object.values(this._tiles).filter(d=>d.timeAdded>=l)}}class gp{constructor(l,d,y){this.painter=l,this.sourceCache=new Si(d),this.options=y,this.exaggeration=typeof y.exaggeration=="number"?y.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(l,d,y){let v=arguments.length>3&&arguments[3]!==void 0?arguments[3]:o.W;var E;if(!(d>=0&&d<v&&y>=0&&y<v))return 0;const U=this.getTerrainData(l),R=(E=U.tile)===null||E===void 0?void 0:E.dem;if(!R)return 0;const g=function(z,j,V){var W=j[0],lt=j[1];return z[0]=V[0]*W+V[4]*lt+V[12],z[1]=V[1]*W+V[5]*lt+V[13],z}([],[d/v*o.W,y/v*o.W],U.u_terrain_matrix),w=[g[0]*R.dim,g[1]*R.dim],T=Math.floor(w[0]),L=Math.floor(w[1]),D=w[0]-T,H=w[1]-L;return R.get(T,L)*(1-D)*(1-H)+R.get(T+1,L)*D*(1-H)+R.get(T,L+1)*(1-D)*H+R.get(T+1,L+1)*D*H}getElevationForLngLatZoom(l,d){const{tileID:y,mercatorX:v,mercatorY:E}=this._getOverscaledTileIDFromLngLatZoom(l,d);return this.getElevation(y,v%o.W,E%o.W,o.W)}getElevation(l,d,y){let v=arguments.length>3&&arguments[3]!==void 0?arguments[3]:o.W;return this.getDEMElevation(l,d,y,v)*this.exaggeration}getTerrainData(l){if(!this._emptyDemTexture){const v=this.painter.context,E=new o.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new st(v,E,v.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new st(v,new o.R({width:1,height:1}),v.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(v.gl.NEAREST,v.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=o.an([])}const d=this.sourceCache.getSourceTile(l,!0);if(d&&d.dem&&(!d.demTexture||d.needsTerrainPrepare)){const v=this.painter.context;d.demTexture=this.painter.getTileTexture(d.dem.stride),d.demTexture?d.demTexture.update(d.dem.getPixels(),{premultiply:!1}):d.demTexture=new st(v,d.dem.getPixels(),v.gl.RGBA,{premultiply:!1}),d.demTexture.bind(v.gl.NEAREST,v.gl.CLAMP_TO_EDGE),d.needsTerrainPrepare=!1}const y=d&&d+d.tileID.key+l.key;if(y&&!this._demMatrixCache[y]){const v=this.sourceCache.sourceCache._source.maxzoom;let E=l.canonical.z-d.tileID.canonical.z;l.overscaledZ>l.canonical.z&&(l.canonical.z>=v?E=l.canonical.z-v:o.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const U=l.canonical.x-(l.canonical.x>>E<<E),R=l.canonical.y-(l.canonical.y>>E<<E),g=o.b9(new Float64Array(16),[1/(o.W<<E),1/(o.W<<E),0]);o.H(g,g,[U*o.W,R*o.W,0]),this._demMatrixCache[l.key]={matrix:g,coord:l}}return{u_depth:2,u_terrain:3,u_terrain_dim:d&&d.dem&&d.dem.dim||1,u_terrain_matrix:y?this._demMatrixCache[l.key].matrix:this._emptyDemMatrix,u_terrain_unpack:d&&d.dem&&d.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(d&&d.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:d}}getFramebuffer(l){const d=this.painter,y=d.width/devicePixelRatio,v=d.height/devicePixelRatio;return!this._fbo||this._fbo.width===y&&this._fbo.height===v||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new st(d.context,{width:y,height:v,data:null},d.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(d.context.gl.NEAREST,d.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new st(d.context,{width:y,height:v,data:null},d.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(d.context.gl.NEAREST,d.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=d.context.createFramebuffer(y,v,!0,!1),this._fbo.depthAttachment.set(d.context.createRenderbuffer(d.context.gl.DEPTH_COMPONENT16,y,v))),this._fbo.colorAttachment.set(l==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const l=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const d=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let E=0,U=0;E<this._coordsTextureSize;E++)for(let R=0;R<this._coordsTextureSize;R++,U+=4)d[U+0]=255&R,d[U+1]=255&E,d[U+2]=R>>8<<4|E>>8,d[U+3]=0;const y=new o.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(d.buffer)),v=new st(l,y,l.gl.RGBA,{premultiply:!1});return v.bind(l.gl.NEAREST,l.gl.CLAMP_TO_EDGE),this._coordsTexture=v,v}pointCoordinate(l){this.painter.maybeDrawDepthAndCoords(!0);const d=new Uint8Array(4),y=this.painter.context,v=y.gl,E=Math.round(l.x*this.painter.pixelRatio/devicePixelRatio),U=Math.round(l.y*this.painter.pixelRatio/devicePixelRatio),R=Math.round(this.painter.height/devicePixelRatio);y.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),v.readPixels(E,R-U-1,1,1,v.RGBA,v.UNSIGNED_BYTE,d),y.bindFramebuffer.set(null);const g=d[0]+(d[2]>>4<<8),w=d[1]+((15&d[2])<<8),T=this.coordsIndex[255-d[3]],L=T&&this.sourceCache.getTileByID(T);if(!L)return null;const D=this._coordsTextureSize,H=(1<<L.tileID.canonical.z)*D;return new o.Y((L.tileID.canonical.x*D+g)/H+L.tileID.wrap,(L.tileID.canonical.y*D+w)/H,this.getElevation(L.tileID,g,w,D))}depthAtPoint(l){const d=new Uint8Array(4),y=this.painter.context,v=y.gl;return y.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),v.readPixels(l.x,this.painter.height/devicePixelRatio-l.y-1,1,1,v.RGBA,v.UNSIGNED_BYTE,d),y.bindFramebuffer.set(null),(d[0]/16777216+d[1]/65536+d[2]/256+d[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const l=this.painter.context,d=new o.ba,y=new o.aX,v=this.meshSize,E=o.W/v,U=v*v;for(let L=0;L<=v;L++)for(let D=0;D<=v;D++)d.emplaceBack(D*E,L*E,0);for(let L=0;L<U;L+=v+1)for(let D=0;D<v;D++)y.emplaceBack(D+L,v+D+L+1,v+D+L+2),y.emplaceBack(D+L,v+D+L+2,D+L+1);const R=d.length,g=R+2*(v+1);for(const L of[0,1])for(let D=0;D<=v;D++)for(const H of[0,1])d.emplaceBack(D*E,L*o.W,H);for(let L=0;L<2*v;L+=2)y.emplaceBack(g+L,g+L+1,g+L+3),y.emplaceBack(g+L,g+L+3,g+L+2),y.emplaceBack(R+L,R+L+3,R+L+1),y.emplaceBack(R+L,R+L+2,R+L+3);const w=d.length,T=w+2*(v+1);for(const L of[0,1])for(let D=0;D<=v;D++)for(const H of[0,1])d.emplaceBack(L*o.W,D*E,H);for(let L=0;L<2*v;L+=2)y.emplaceBack(w+L,w+L+1,w+L+3),y.emplaceBack(w+L,w+L+3,w+L+2),y.emplaceBack(T+L,T+L+3,T+L+1),y.emplaceBack(T+L,T+L+2,T+L+3);return this._mesh={indexBuffer:l.createIndexBuffer(y),vertexBuffer:l.createVertexBuffer(d,di.members),segments:o.$.simpleSegment(0,0,d.length,y.length)},this._mesh}getMeshFrameDelta(l){return 2*Math.PI*o.bb/Math.pow(2,l)/5}getMinTileElevationForLngLatZoom(l,d){var y;const{tileID:v}=this._getOverscaledTileIDFromLngLatZoom(l,d);return(y=this.getMinMaxElevation(v).minElevation)!==null&&y!==void 0?y:0}getMinMaxElevation(l){const d=this.getTerrainData(l).tile,y={minElevation:null,maxElevation:null};return d&&d.dem&&(y.minElevation=d.dem.min*this.exaggeration,y.maxElevation=d.dem.max*this.exaggeration),y}_getOverscaledTileIDFromLngLatZoom(l,d){const y=o.Y.fromLngLat(l.wrap()),v=(1<<d)*o.W,E=y.x*v,U=y.y*v,R=Math.floor(E/o.W),g=Math.floor(U/o.W);return{tileID:new o.Q(d,0,d,R,g),mercatorX:E,mercatorY:U}}}class Eo{constructor(l,d,y){this._context=l,this._size=d,this._tileSize=y,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const l of this._objects)l.texture.destroy(),l.fbo.destroy()}_createObject(l){const d=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),y=new st(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return y.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),d.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),d.colorAttachment.set(y.texture),{id:l,fbo:d,texture:y,stamp:-1,inUse:!1}}getObjectForId(l){return this._objects[l]}useObject(l){l.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(d=>l.id!==d),this._recentlyUsed.push(l.id)}stampObject(l){l.stamp=++this._stamp}getOrCreateFreeObject(){for(const d of this._recentlyUsed)if(!this._objects[d].inUse)return this._objects[d];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const l=this._createObject(this._objects.length);return this._objects.push(l),l}freeObject(l){l.inUse=!1}freeAllObjects(){for(const l of this._objects)this.freeObject(l)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(l=>!l.inUse)===!1}}const ki={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class ra{constructor(l,d){this.painter=l,this.terrain=d,this.pool=new Eo(l.context,30,d.sourceCache.tileSize*d.qualityFactor)}destruct(){this.pool.destruct()}getTexture(l){return this.pool.getObjectForId(l.rtt[this._stacks.length-1].id).texture}prepareForRender(l,d){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=l._order.filter(y=>!l._layers[y].isHidden(d)),this._coordsDescendingInv={};for(const y in l.sourceCaches){this._coordsDescendingInv[y]={};const v=l.sourceCaches[y].getVisibleCoordinates();for(const E of v){const U=this.terrain.sourceCache.getTerrainCoords(E);for(const R in U)this._coordsDescendingInv[y][R]||(this._coordsDescendingInv[y][R]=[]),this._coordsDescendingInv[y][R].push(U[R])}}this._coordsDescendingInvStr={};for(const y of l._order){const v=l._layers[y],E=v.source;if(ki[v.type]&&!this._coordsDescendingInvStr[E]){this._coordsDescendingInvStr[E]={};for(const U in this._coordsDescendingInv[E])this._coordsDescendingInvStr[E][U]=this._coordsDescendingInv[E][U].map(R=>R.key).sort().join()}}for(const y of this._renderableTiles)for(const v in this._coordsDescendingInvStr){const E=this._coordsDescendingInvStr[v][y.tileID.key];E&&E!==y.rttCoords[v]&&(y.rtt=[])}}renderLayer(l){if(l.isHidden(this.painter.transform.zoom))return!1;const d=l.type,y=this.painter,v=this._renderableLayerIds[this._renderableLayerIds.length-1]===l.id;if(ki[d]&&(this._prevType&&ki[this._prevType]||this._stacks.push([]),this._prevType=d,this._stacks[this._stacks.length-1].push(l.id),!v))return!0;if(ki[this._prevType]||ki[d]&&v){this._prevType=d;const E=this._stacks.length-1,U=this._stacks[E]||[];for(const R of this._renderableTiles){if(this.pool.isFull()&&(fu(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(R),R.rtt[E]){const w=this.pool.getObjectForId(R.rtt[E].id);if(w.stamp===R.rtt[E].stamp){this.pool.useObject(w);continue}}const g=this.pool.getOrCreateFreeObject();this.pool.useObject(g),this.pool.stampObject(g),R.rtt[E]={id:g.id,stamp:g.stamp},y.context.bindFramebuffer.set(g.fbo.framebuffer),y.context.clear({color:o.aO.transparent,stencil:0}),y.currentStencilSource=void 0;for(let w=0;w<U.length;w++){const T=y.style._layers[U[w]],L=T.source?this._coordsDescendingInv[T.source][R.tileID.key]:[R.tileID];y.context.viewport.set([0,0,g.fbo.width,g.fbo.height]),y._renderTileClippingMasks(T,L),y.renderLayer(y,y.style.sourceCaches[T.source],T,L),T.source&&(R.rttCoords[T.source]=this._coordsDescendingInvStr[T.source][R.tileID.key])}}return fu(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),ki[d]}return!1}}const Ed={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},hh=A,So={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:Bd,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:o.a.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},Ts=C=>{C.touchstart=C.dragStart,C.touchmoveWindow=C.dragMove,C.touchend=C.dragEnd},Sd={showCompass:!0,showZoom:!0,visualizePitch:!1};class Td{constructor(l,d){let y=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;this.mousedown=U=>{this.startMouse(o.e({},U,{ctrlKey:!0,preventDefault:()=>U.preventDefault()}),x.mousePos(this.element,U)),x.addEventListener(window,"mousemove",this.mousemove),x.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=U=>{this.moveMouse(U,x.mousePos(this.element,U))},this.mouseup=U=>{this.mouseRotate.dragEnd(U),this.mousePitch&&this.mousePitch.dragEnd(U),this.offTemp()},this.touchstart=U=>{U.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=x.touchPos(this.element,U.targetTouches)[0],this.startTouch(U,this._startPos),x.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),x.addEventListener(window,"touchend",this.touchend))},this.touchmove=U=>{U.targetTouches.length!==1?this.reset():(this._lastPos=x.touchPos(this.element,U.targetTouches)[0],this.moveTouch(U,this._lastPos))},this.touchend=U=>{U.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const v=l.dragRotate._mouseRotate.getClickTolerance(),E=l.dragRotate._mousePitch.getClickTolerance();this.element=d,this.mouseRotate=bl({clickTolerance:v,enable:!0}),this.touchRotate=(U=>{let{enable:R,clickTolerance:g,bearingDegreesPerPixelMoved:w=.8}=U;const T=new tr;return new Wa({clickTolerance:g,move:(L,D)=>({bearingDelta:(D.x-L.x)*w}),moveStateManager:T,enable:R,assignEvents:Ts})})({clickTolerance:v,enable:!0}),this.map=l,y&&(this.mousePitch=wl({clickTolerance:E,enable:!0}),this.touchPitch=(U=>{let{enable:R,clickTolerance:g,pitchDegreesPerPixelMoved:w=-.5}=U;const T=new tr;return new Wa({clickTolerance:g,move:(L,D)=>({pitchDelta:(D.y-L.y)*w}),moveStateManager:T,enable:R,assignEvents:Ts})})({clickTolerance:E,enable:!0})),x.addEventListener(d,"mousedown",this.mousedown),x.addEventListener(d,"touchstart",this.touchstart,{passive:!1}),x.addEventListener(d,"touchcancel",this.reset)}startMouse(l,d){this.mouseRotate.dragStart(l,d),this.mousePitch&&this.mousePitch.dragStart(l,d),x.disableDrag()}startTouch(l,d){this.touchRotate.dragStart(l,d),this.touchPitch&&this.touchPitch.dragStart(l,d),x.disableDrag()}moveMouse(l,d){const y=this.map,{bearingDelta:v}=this.mouseRotate.dragMove(l,d)||{};if(v&&y.setBearing(y.getBearing()+v),this.mousePitch){const{pitchDelta:E}=this.mousePitch.dragMove(l,d)||{};E&&y.setPitch(y.getPitch()+E)}}moveTouch(l,d){const y=this.map,{bearingDelta:v}=this.touchRotate.dragMove(l,d)||{};if(v&&y.setBearing(y.getBearing()+v),this.touchPitch){const{pitchDelta:E}=this.touchPitch.dragMove(l,d)||{};E&&y.setPitch(y.getPitch()+E)}}off(){const l=this.element;x.removeEventListener(l,"mousedown",this.mousedown),x.removeEventListener(l,"touchstart",this.touchstart,{passive:!1}),x.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),x.removeEventListener(window,"touchend",this.touchend),x.removeEventListener(l,"touchcancel",this.reset),this.offTemp()}offTemp(){x.enableDrag(),x.removeEventListener(window,"mousemove",this.mousemove),x.removeEventListener(window,"mouseup",this.mouseup),x.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),x.removeEventListener(window,"touchend",this.touchend)}}let Ea;function dA(C,l,d){const y=new o.M(C.lng,C.lat);if(C=new o.M(C.lng,C.lat),l){const v=new o.M(C.lng-360,C.lat),E=new o.M(C.lng+360,C.lat),U=d.locationPoint(C).distSqr(l);d.locationPoint(v).distSqr(l)<U?C=v:d.locationPoint(E).distSqr(l)<U&&(C=E)}for(;Math.abs(C.lng-d.center.lng)>180;){const v=d.locationPoint(C);if(v.x>=0&&v.y>=0&&v.x<=d.width&&v.y<=d.height)break;C.lng>d.center.lng?C.lng-=360:C.lng+=360}return C.lng!==y.lng&&d.locationPoint(C).y>d.height/2-d.getHorizon()?C:y}const mu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function fA(C,l,d){const y=C.classList;for(const v in mu)y.remove(`maplibregl-${d}-anchor-${v}`);y.add(`maplibregl-${d}-anchor-${l}`)}class pA extends o.E{constructor(l){if(super(),this._onKeyPress=d=>{const y=d.code,v=d.charCode||d.keyCode;y!=="Space"&&y!=="Enter"&&v!==32&&v!==13||this.togglePopup()},this._onMapClick=d=>{const y=d.originalEvent.target,v=this._element;this._popup&&(y===v||v.contains(y))&&this.togglePopup()},this._update=d=>{var y;if(!this._map)return;const v=this._map.loaded()&&!this._map.isMoving();((d==null?void 0:d.type)==="terrain"||(d==null?void 0:d.type)==="render"&&!v)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?dA(this._lngLat,this._flatPos,this._map.transform):(y=this._lngLat)===null||y===void 0?void 0:y.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let E="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?E=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(E=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let U="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?U="rotateX(0deg)":this._pitchAlignment==="map"&&(U=`rotateX(${this._map.getPitch()}deg)`),d&&d.type!=="moveend"||(this._pos=this._pos.round()),x.setTransform(this._element,`${mu[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${U} ${E}`),_.frameAsync(new AbortController).then(()=>{this._updateOpacity(d&&d.type==="moveend")}).catch(()=>{})},this._onMove=d=>{if(!this._isDragging){const y=this._clickTolerance||this._map._clickTolerance;this._isDragging=d.point.dist(this._pointerdownPos)>=y}this._isDragging&&(this._pos=d.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.k("dragstart"))),this.fire(new o.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new o.k("dragend")),this._state="inactive"},this._addDragHandler=d=>{this._element.contains(d.originalEvent.target)&&(d.preventDefault(),this._positionDelta=d.point.sub(this._pos).add(this._offset),this._pointerdownPos=d.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=l&&l.anchor||"center",this._color=l&&l.color||"#3FB1CE",this._scale=l&&l.scale||1,this._draggable=l&&l.draggable||!1,this._clickTolerance=l&&l.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=l&&l.rotation||0,this._rotationAlignment=l&&l.rotationAlignment||"auto",this._pitchAlignment=l&&l.pitchAlignment&&l.pitchAlignment!=="auto"?l.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(l==null?void 0:l.opacity,l==null?void 0:l.opacityWhenCovered),l&&l.element)this._element=l.element,this._offset=o.P.convert(l&&l.offset||[0,0]);else{this._defaultMarker=!0,this._element=x.create("div"),this._element.setAttribute("aria-label","Map marker");const d=x.createNS("http://www.w3.org/2000/svg","svg"),y=41,v=27;d.setAttributeNS(null,"display","block"),d.setAttributeNS(null,"height",`${y}px`),d.setAttributeNS(null,"width",`${v}px`),d.setAttributeNS(null,"viewBox",`0 0 ${v} ${y}`);const E=x.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"stroke","none"),E.setAttributeNS(null,"stroke-width","1"),E.setAttributeNS(null,"fill","none"),E.setAttributeNS(null,"fill-rule","evenodd");const U=x.createNS("http://www.w3.org/2000/svg","g");U.setAttributeNS(null,"fill-rule","nonzero");const R=x.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"transform","translate(3.0, 29.0)"),R.setAttributeNS(null,"fill","#000000");const g=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const W of g){const lt=x.createNS("http://www.w3.org/2000/svg","ellipse");lt.setAttributeNS(null,"opacity","0.04"),lt.setAttributeNS(null,"cx","10.5"),lt.setAttributeNS(null,"cy","5.80029008"),lt.setAttributeNS(null,"rx",W.rx),lt.setAttributeNS(null,"ry",W.ry),R.appendChild(lt)}const w=x.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"fill",this._color);const T=x.createNS("http://www.w3.org/2000/svg","path");T.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),w.appendChild(T);const L=x.createNS("http://www.w3.org/2000/svg","g");L.setAttributeNS(null,"opacity","0.25"),L.setAttributeNS(null,"fill","#000000");const D=x.createNS("http://www.w3.org/2000/svg","path");D.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),L.appendChild(D);const H=x.createNS("http://www.w3.org/2000/svg","g");H.setAttributeNS(null,"transform","translate(6.0, 7.0)"),H.setAttributeNS(null,"fill","#FFFFFF");const z=x.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"transform","translate(8.0, 8.0)");const j=x.createNS("http://www.w3.org/2000/svg","circle");j.setAttributeNS(null,"fill","#000000"),j.setAttributeNS(null,"opacity","0.25"),j.setAttributeNS(null,"cx","5.5"),j.setAttributeNS(null,"cy","5.5"),j.setAttributeNS(null,"r","5.4999962");const V=x.createNS("http://www.w3.org/2000/svg","circle");V.setAttributeNS(null,"fill","#FFFFFF"),V.setAttributeNS(null,"cx","5.5"),V.setAttributeNS(null,"cy","5.5"),V.setAttributeNS(null,"r","5.4999962"),z.appendChild(j),z.appendChild(V),U.appendChild(R),U.appendChild(w),U.appendChild(L),U.appendChild(H),U.appendChild(z),d.appendChild(U),d.setAttributeNS(null,"height",y*this._scale+"px"),d.setAttributeNS(null,"width",v*this._scale+"px"),this._element.appendChild(d),this._offset=o.P.convert(l&&l.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",d=>{d.preventDefault()}),this._element.addEventListener("mousedown",d=>{d.preventDefault()}),fA(this._element,this._anchor,"marker"),l&&l.className)for(const d of l.className.split(" "))this._element.classList.add(d);this._popup=null}addTo(l){return this.remove(),this._map=l,l.getCanvasContainer().appendChild(this._element),l.on("move",this._update),l.on("moveend",this._update),l.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),x.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(l){return this._lngLat=o.M.convert(l),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(l){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),l){if(!("offset"in l.options)){const v=Math.abs(13.5)/Math.SQRT2;l.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[v,-1*(38.1-13.5+v)],"bottom-right":[-v,-1*(38.1-13.5+v)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=l,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const l=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:l?(l.isOpen()?l.remove():(l.setLngLat(this._lngLat),l.addTo(this._map)),this):this}_updateOpacity(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;var d,y;if(!(!((d=this._map)===null||d===void 0)&&d.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(l)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const v=this._map,E=v.terrain.depthAtPoint(this._pos),U=v.terrain.getElevationForLngLatZoom(this._lngLat,v.transform.tileZoom);if(v.transform.lngLatToCameraDepth(this._lngLat,U)-E<.006)return void(this._element.style.opacity=this._opacity);const R=-this._offset.y/v.transform._pixelPerMeter,g=Math.sin(v.getPitch()*Math.PI/180)*R,w=v.terrain.depthAtPoint(new o.P(this._pos.x,this._pos.y-this._offset.y)),T=v.transform.lngLatToCameraDepth(this._lngLat,U+g)-w>.006;!((y=this._popup)===null||y===void 0)&&y.isOpen()&&T&&this._popup.remove(),this._element.style.opacity=T?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(l){return this._offset=o.P.convert(l),this._update(),this}addClassName(l){this._element.classList.add(l)}removeClassName(l){this._element.classList.remove(l)}toggleClassName(l){return this._element.classList.toggle(l)}setDraggable(l){return this._draggable=!!l,this._map&&(l?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(l){return this._rotation=l||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(l){return this._rotationAlignment=l||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(l){return this._pitchAlignment=l&&l!=="auto"?l:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(l,d){return l===void 0&&d===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),l!==void 0&&(this._opacity=l),d!==void 0&&(this._opacityWhenCovered=d),this._map&&this._updateOpacity(!0),this}}const Tl={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Ja=0,na=!1;const yu={maxWidth:100,unit:"metric"};function gA(C,l,d){const y=d&&d.maxWidth||100,v=C._container.clientHeight/2,E=C.unproject([0,v]),U=C.unproject([y,v]),R=E.distanceTo(U);if(d&&d.unit==="imperial"){const g=3.2808*R;g>5280?Il(l,y,g/5280,C._getUIString("ScaleControl.Miles")):Il(l,y,g,C._getUIString("ScaleControl.Feet"))}else d&&d.unit==="nautical"?Il(l,y,R/1852,C._getUIString("ScaleControl.NauticalMiles")):R>=1e3?Il(l,y,R/1e3,C._getUIString("ScaleControl.Kilometers")):Il(l,y,R,C._getUIString("ScaleControl.Meters"))}function Il(C,l,d,y){const v=function(E){const U=Math.pow(10,`${Math.floor(E)}`.length-1);let R=E/U;return R=R>=10?10:R>=5?5:R>=3?3:R>=2?2:R>=1?1:function(g){const w=Math.pow(10,Math.ceil(-Math.log(g)/Math.LN10));return Math.round(g*w)/w}(R),U*R}(d);C.style.width=l*(v/d)+"px",C.innerHTML=`${v}&nbsp;${y}`}const dh={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},Id=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function fh(C){if(C){if(typeof C=="number"){const l=Math.round(Math.abs(C)/Math.SQRT2);return{center:new o.P(0,0),top:new o.P(0,C),"top-left":new o.P(l,l),"top-right":new o.P(-l,l),bottom:new o.P(0,-C),"bottom-left":new o.P(l,-l),"bottom-right":new o.P(-l,-l),left:new o.P(C,0),right:new o.P(-C,0)}}if(C instanceof o.P||Array.isArray(C)){const l=o.P.convert(C);return{center:l,top:l,"top-left":l,"top-right":l,bottom:l,"bottom-left":l,"bottom-right":l,left:l,right:l}}return{center:o.P.convert(C.center||[0,0]),top:o.P.convert(C.top||[0,0]),"top-left":o.P.convert(C["top-left"]||[0,0]),"top-right":o.P.convert(C["top-right"]||[0,0]),bottom:o.P.convert(C.bottom||[0,0]),"bottom-left":o.P.convert(C["bottom-left"]||[0,0]),"bottom-right":o.P.convert(C["bottom-right"]||[0,0]),left:o.P.convert(C.left||[0,0]),right:o.P.convert(C.right||[0,0])}}return fh(new o.P(0,0))}const mp=A;a.AJAXError=o.be,a.Evented=o.E,a.LngLat=o.M,a.MercatorCoordinate=o.Y,a.Point=o.P,a.addProtocol=o.bf,a.config=o.a,a.removeProtocol=o.bg,a.AttributionControl=ea,a.BoxZoomHandler=Fn,a.CanvasSource=ir,a.CooperativeGesturesHandler=dr,a.DoubleClickZoomHandler=lA,a.DragPanHandler=xd,a.DragRotateHandler=ta,a.EdgeInsets=eo,a.FullscreenControl=class extends o.E{constructor(){let C=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this._onFullscreenChange=()=>{var l;let d=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((l=d==null?void 0:d.shadowRoot)===null||l===void 0)&&l.fullscreenElement;)d=d.shadowRoot.fullscreenElement;d===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,C&&C.container&&(C.container instanceof HTMLElement?this._container=C.container:o.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(C){return this._map=C,this._container||(this._container=this._map.getContainer()),this._controlContainer=x.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){x.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const C=this._fullscreenButton=x.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);x.create("span","maplibregl-ctrl-icon",C).setAttribute("aria-hidden","true"),C.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const C=this._getTitle();this._fullscreenButton.setAttribute("aria-label",C),this._fullscreenButton.title=C}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new o.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new o.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},a.GeoJSONSource=Se,a.GeolocateControl=class extends o.E{constructor(C){super(),this._onSuccess=l=>{if(this._map){if(this._isOutOfMapMaxBounds(l))return this._setErrorState(),this.fire(new o.k("outofmaxbounds",l)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=l,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(l),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(l),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new o.k("geolocate",l)),this._finish()}},this._updateCamera=l=>{const d=new o.M(l.coords.longitude,l.coords.latitude),y=l.coords.accuracy,v=this._map.getBearing(),E=o.e({bearing:v},this.options.fitBoundsOptions),U=ze.fromLngLat(d,y);this._map.fitBounds(U,E,{geolocateSource:!0})},this._updateMarker=l=>{if(l){const d=new o.M(l.coords.longitude,l.coords.latitude);this._accuracyCircleMarker.setLngLat(d).addTo(this._map),this._userLocationDotMarker.setLngLat(d).addTo(this._map),this._accuracy=l.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=l=>{if(this._map){if(this.options.trackUserLocation)if(l.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(l.code===3&&na)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new o.k("error",l)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=l=>{if(this._map){if(this._container.addEventListener("contextmenu",d=>d.preventDefault()),this._geolocateButton=x.create("button","maplibregl-ctrl-geolocate",this._container),x.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",l===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");const d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d)}else{const d=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=x.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new pA({element:this._dotElement}),this._circleElement=x.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new pA({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",d=>{d.geolocateSource||this._watchState!=="ACTIVE_LOCK"||d.originalEvent&&d.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new o.k("trackuserlocationend")))})}},this.options=o.e({},Tl,C)}onAdd(C){return this._map=C,this._container=x.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(){return o._(this,arguments,void 0,function(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;return function*(){if(Ea!==void 0&&!l)return Ea;if(window.navigator.permissions===void 0)return Ea=!!window.navigator.geolocation,Ea;try{Ea=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Ea=!!window.navigator.geolocation}return Ea}()})}().then(l=>this._setupUI(l)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),x.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Ja=0,na=!1}_isOutOfMapMaxBounds(C){const l=this._map.getMaxBounds(),d=C.coords;return l&&(d.longitude<l.getWest()||d.longitude>l.getEast()||d.latitude<l.getSouth()||d.latitude>l.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const C=this._map.getBounds(),l=C.getSouthEast(),d=C.getNorthEast(),y=l.distanceTo(d),v=Math.ceil(this._accuracy/(y/this._map._container.clientHeight)*2);this._circleElement.style.width=`${v}px`,this._circleElement.style.height=`${v}px`}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ja--,na=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new o.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let C;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Ja++,Ja>1?(C={maximumAge:6e5,timeout:0},na=!0):(C=this.options.positionOptions,na=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,C)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},a.Hash=ro,a.ImageSource=xe,a.KeyboardHandler=Xa,a.LngLatBounds=ze,a.LogoControl=Cd,a.Map=class extends Xi{constructor(C){if(o.bc.mark(o.bd.create),(C=o.e({},So,C)).minZoom!=null&&C.maxZoom!=null&&C.minZoom>C.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(C.minPitch!=null&&C.maxPitch!=null&&C.minPitch>C.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(C.minPitch!=null&&C.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(C.maxPitch!=null&&C.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Bo(C.minZoom,C.maxZoom,C.minPitch,C.maxPitch,C.renderWorldCopies),{bearingSnap:C.bearingSnap}),this._contextLost=l=>{l.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new o.k("webglcontextlost",{originalEvent:l}))},this._contextRestored=l=>{this._setupPainter(),this.resize(),this._update(),this.fire(new o.k("webglcontextrestored",{originalEvent:l}))},this._onMapScroll=l=>{if(l.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=C.interactive,this._maxTileCacheSize=C.maxTileCacheSize,this._maxTileCacheZoomLevels=C.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=C.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=C.preserveDrawingBuffer,this._antialias=C.antialias,this._trackResize=C.trackResize,this._bearingSnap=C.bearingSnap,this._refreshExpiredTiles=C.refreshExpiredTiles,this._fadeDuration=C.fadeDuration,this._crossSourceCollisions=C.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=C.collectResourceTiming,this._renderTaskQueue=new hA,this._controls=[],this._mapId=o.a3(),this._locale=o.e({},Ed,C.locale),this._clickTolerance=C.clickTolerance,this._overridePixelRatio=C.pixelRatio,this._maxCanvasSize=C.maxCanvasSize,this.transformCameraUpdate=C.transformCameraUpdate,this._imageQueueHandle=J.addThrottleControl(()=>this.isMoving()),this._requestManager=new tt(C.transformRequest),typeof C.container=="string"){if(this._container=document.getElementById(C.container),!this._container)throw new Error(`Container '${C.container}' not found.`)}else{if(!(C.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=C.container}if(C.maxBounds&&this.setMaxBounds(C.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let l=!1;const d=Lc(y=>{this._trackResize&&!this._removed&&this.resize(y)._update()},50);this._resizeObserver=new ResizeObserver(y=>{l?d(y):l=!0}),this._resizeObserver.observe(this._container)}this.handlers=new AA(this,C),this._hash=C.hash&&new ro(typeof C.hash=="string"&&C.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:C.center,zoom:C.zoom,bearing:C.bearing,pitch:C.pitch}),C.bounds&&(this.resize(),this.fitBounds(C.bounds,o.e({},C.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=C.localIdeographFontFamily,this._validateStyle=C.validateStyle,C.style&&this.setStyle(C.style,{localIdeographFontFamily:C.localIdeographFontFamily}),C.attributionControl&&this.addControl(new ea(typeof C.attributionControl=="boolean"?void 0:C.attributionControl)),C.maplibreLogo&&this.addControl(new Cd,C.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",l=>{this._update(l.dataType==="style"),this.fire(new o.k(`${l.dataType}data`,l))}),this.on("dataloading",l=>{this.fire(new o.k(`${l.dataType}dataloading`,l))}),this.on("dataabort",l=>{this.fire(new o.k("sourcedataabort",l))})}_getMapId(){return this._mapId}addControl(C,l){if(l===void 0&&(l=C.getDefaultPosition?C.getDefaultPosition():"top-right"),!C||!C.onAdd)return this.fire(new o.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const d=C.onAdd(this);this._controls.push(C);const y=this._controlPositions[l];return l.indexOf("bottom")!==-1?y.insertBefore(d,y.firstChild):y.appendChild(d),this}removeControl(C){if(!C||!C.onRemove)return this.fire(new o.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const l=this._controls.indexOf(C);return l>-1&&this._controls.splice(l,1),C.onRemove(this),this}hasControl(C){return this._controls.indexOf(C)>-1}calculateCameraOptionsFromTo(C,l,d,y){return y==null&&this.terrain&&(y=this.terrain.getElevationForLngLatZoom(d,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(C,l,d,y)}resize(C){var l;const d=this._containerDimensions(),y=d[0],v=d[1],E=this._getClampedPixelRatio(y,v);if(this._resizeCanvas(y,v,E),this.painter.resize(y,v,E),this.painter.overLimit()){const R=this.painter.context.gl;this._maxCanvasSize=[R.drawingBufferWidth,R.drawingBufferHeight];const g=this._getClampedPixelRatio(y,v);this._resizeCanvas(y,v,g),this.painter.resize(y,v,g)}this.transform.resize(y,v),(l=this._requestedCameraState)===null||l===void 0||l.resize(y,v);const U=!this._moving;return U&&(this.stop(),this.fire(new o.k("movestart",C)).fire(new o.k("move",C))),this.fire(new o.k("resize",C)),U&&this.fire(new o.k("moveend",C)),this}_getClampedPixelRatio(C,l){const{0:d,1:y}=this._maxCanvasSize,v=this.getPixelRatio(),E=C*v,U=l*v;return Math.min(E>d?d/E:1,U>y?y/U:1)*v}getPixelRatio(){var C;return(C=this._overridePixelRatio)!==null&&C!==void 0?C:devicePixelRatio}setPixelRatio(C){this._overridePixelRatio=C,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(C){return this.transform.setMaxBounds(ze.convert(C)),this._update()}setMinZoom(C){if((C=C??-2)>=-2&&C<=this.transform.maxZoom)return this.transform.minZoom=C,this._update(),this.getZoom()<C&&this.setZoom(C),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(C){if((C=C??22)>=this.transform.minZoom)return this.transform.maxZoom=C,this._update(),this.getZoom()>C&&this.setZoom(C),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(C){if((C=C??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(C>=0&&C<=this.transform.maxPitch)return this.transform.minPitch=C,this._update(),this.getPitch()<C&&this.setPitch(C),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(C){if((C=C??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(C>=this.transform.minPitch)return this.transform.maxPitch=C,this._update(),this.getPitch()>C&&this.setPitch(C),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(C){return this.transform.renderWorldCopies=C,this._update()}project(C){return this.transform.locationPoint(o.M.convert(C),this.style&&this.terrain)}unproject(C){return this.transform.pointLocation(o.P.convert(C),this.terrain)}isMoving(){var C;return this._moving||((C=this.handlers)===null||C===void 0?void 0:C.isMoving())}isZooming(){var C;return this._zooming||((C=this.handlers)===null||C===void 0?void 0:C.isZooming())}isRotating(){var C;return this._rotating||((C=this.handlers)===null||C===void 0?void 0:C.isRotating())}_createDelegatedListener(C,l,d){if(C==="mouseenter"||C==="mouseover"){let y=!1;return{layer:l,listener:d,delegates:{mousemove:E=>{const U=this.getLayer(l)?this.queryRenderedFeatures(E.point,{layers:[l]}):[];U.length?y||(y=!0,d.call(this,new Ei(C,this,E.originalEvent,{features:U}))):y=!1},mouseout:()=>{y=!1}}}}if(C==="mouseleave"||C==="mouseout"){let y=!1;return{layer:l,listener:d,delegates:{mousemove:U=>{(this.getLayer(l)?this.queryRenderedFeatures(U.point,{layers:[l]}):[]).length?y=!0:y&&(y=!1,d.call(this,new Ei(C,this,U.originalEvent)))},mouseout:U=>{y&&(y=!1,d.call(this,new Ei(C,this,U.originalEvent)))}}}}{const y=v=>{const E=this.getLayer(l)?this.queryRenderedFeatures(v.point,{layers:[l]}):[];E.length&&(v.features=E,d.call(this,v),delete v.features)};return{layer:l,listener:d,delegates:{[C]:y}}}}on(C,l,d){if(d===void 0)return super.on(C,l);const y=this._createDelegatedListener(C,l,d);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[C]=this._delegatedListeners[C]||[],this._delegatedListeners[C].push(y);for(const v in y.delegates)this.on(v,y.delegates[v]);return this}once(C,l,d){if(d===void 0)return super.once(C,l);const y=this._createDelegatedListener(C,l,d);for(const v in y.delegates)this.once(v,y.delegates[v]);return this}off(C,l,d){return d===void 0?super.off(C,l):(this._delegatedListeners&&this._delegatedListeners[C]&&(y=>{const v=this._delegatedListeners[C];for(let E=0;E<v.length;E++){const U=v[E];if(U.layer===l&&U.listener===d){for(const R in U.delegates)this.off(R,U.delegates[R]);return v.splice(E,1),this}}})(),this)}queryRenderedFeatures(C,l){if(!this.style)return[];let d;const y=C instanceof o.P||Array.isArray(C),v=y?C:[[0,0],[this.transform.width,this.transform.height]];if(l=l||(y?{}:C)||{},v instanceof o.P||typeof v[0]=="number")d=[o.P.convert(v)];else{const E=o.P.convert(v[0]),U=o.P.convert(v[1]);d=[E,new o.P(U.x,E.y),U,new o.P(E.x,U.y),E]}return this.style.queryRenderedFeatures(d,l,this.transform)}querySourceFeatures(C,l){return this.style.querySourceFeatures(C,l)}setStyle(C,l){return(l=o.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},l)).diff!==!1&&l.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&C?(this._diffStyle(C,l),this):(this._localIdeographFontFamily=l.localIdeographFontFamily,this._updateStyle(C,l))}setTransformRequest(C){return this._requestManager.setTransformRequest(C),this}_getUIString(C){const l=this._locale[C];if(l==null)throw new Error(`Missing UI string '${C}'`);return l}_updateStyle(C,l){if(l.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(C,l));const d=this.style&&l.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!C)),C?(this.style=new Mi(this,l||{}),this.style.setEventedParent(this,{style:this.style}),typeof C=="string"?this.style.loadURL(C,l,d):this.style.loadJSON(C,l,d),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Mi(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(C,l){if(typeof C=="string"){const d=this._requestManager.transformRequest(C,"Style");o.h(d,new AbortController).then(y=>{this._updateDiff(y.data,l)}).catch(y=>{y&&this.fire(new o.j(y))})}else typeof C=="object"&&this._updateDiff(C,l)}_updateDiff(C,l){try{this.style.setState(C,l)&&this._update(!0)}catch(d){o.w(`Unable to perform style diff: ${d.message||d.error||d}.  Rebuilding the style from scratch.`),this._updateStyle(C,l)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():o.w("There is no style added to the map.")}addSource(C,l){return this._lazyInitEmptyStyle(),this.style.addSource(C,l),this._update(!0)}isSourceLoaded(C){const l=this.style&&this.style.sourceCaches[C];if(l!==void 0)return l.loaded();this.fire(new o.j(new Error(`There is no source with ID '${C}'`)))}setTerrain(C){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),C){const l=this.style.sourceCaches[C.source];if(!l)throw new Error(`cannot load terrain, because there exists no source with ID: ${C.source}`);this.terrain===null&&l.reload();for(const d in this.style._layers){const y=this.style._layers[d];y.type==="hillshade"&&y.source===C.source&&o.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new gp(this.painter,l,C),this.painter.renderToTexture=new ra(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=d=>{d.dataType==="style"?this.terrain.sourceCache.freeRtt():d.dataType==="source"&&d.tile&&(d.sourceId!==C.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(d.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new o.k("terrain",{terrain:C})),this}getTerrain(){var C,l;return(l=(C=this.terrain)===null||C===void 0?void 0:C.options)!==null&&l!==void 0?l:null}areTilesLoaded(){const C=this.style&&this.style.sourceCaches;for(const l in C){const d=C[l]._tiles;for(const y in d){const v=d[y];if(v.state!=="loaded"&&v.state!=="errored")return!1}}return!0}removeSource(C){return this.style.removeSource(C),this._update(!0)}getSource(C){return this.style.getSource(C)}addImage(C,l){let d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{pixelRatio:y=1,sdf:v=!1,stretchX:E,stretchY:U,content:R}=d;if(this._lazyInitEmptyStyle(),!(l instanceof HTMLImageElement||o.b(l))){if(l.width===void 0||l.height===void 0)return this.fire(new o.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:g,height:w,data:T}=l,L=l;return this.style.addImage(C,{data:new o.R({width:g,height:w},new Uint8Array(T)),pixelRatio:y,stretchX:E,stretchY:U,content:R,sdf:v,version:0,userImage:L}),L.onAdd&&L.onAdd(this,C),this}}{const{width:g,height:w,data:T}=_.getImageData(l);this.style.addImage(C,{data:new o.R({width:g,height:w},T),pixelRatio:y,stretchX:E,stretchY:U,content:R,sdf:v,version:0})}}updateImage(C,l){const d=this.style.getImage(C);if(!d)return this.fire(new o.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const y=l instanceof HTMLImageElement||o.b(l)?_.getImageData(l):l,{width:v,height:E,data:U}=y;if(v===void 0||E===void 0)return this.fire(new o.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(v!==d.data.width||E!==d.data.height)return this.fire(new o.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const R=!(l instanceof HTMLImageElement||o.b(l));return d.data.replace(U,R),this.style.updateImage(C,d),this}getImage(C){return this.style.getImage(C)}hasImage(C){return C?!!this.style.getImage(C):(this.fire(new o.j(new Error("Missing required image id"))),!1)}removeImage(C){this.style.removeImage(C)}loadImage(C){return J.getImage(this._requestManager.transformRequest(C,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(C,l){return this._lazyInitEmptyStyle(),this.style.addLayer(C,l),this._update(!0)}moveLayer(C,l){return this.style.moveLayer(C,l),this._update(!0)}removeLayer(C){return this.style.removeLayer(C),this._update(!0)}getLayer(C){return this.style.getLayer(C)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(C,l,d){return this.style.setLayerZoomRange(C,l,d),this._update(!0)}setFilter(C,l){let d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.style.setFilter(C,l,d),this._update(!0)}getFilter(C){return this.style.getFilter(C)}setPaintProperty(C,l,d){let y=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return this.style.setPaintProperty(C,l,d,y),this._update(!0)}getPaintProperty(C,l){return this.style.getPaintProperty(C,l)}setLayoutProperty(C,l,d){let y=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return this.style.setLayoutProperty(C,l,d,y),this._update(!0)}getLayoutProperty(C,l){return this.style.getLayoutProperty(C,l)}setGlyphs(C){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setGlyphs(C,l),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(C,l){let d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this._lazyInitEmptyStyle(),this.style.addSprite(C,l,d,y=>{y||this._update(!0)}),this}removeSprite(C){return this._lazyInitEmptyStyle(),this.style.removeSprite(C),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(C){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setSprite(C,l,d=>{d||this._update(!0)}),this}setLight(C){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setLight(C,l),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(C,l){return this.style.setFeatureState(C,l),this._update()}removeFeatureState(C,l){return this.style.removeFeatureState(C,l),this._update()}getFeatureState(C){return this.style.getFeatureState(C)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let C=0,l=0;return this._container&&(C=this._container.clientWidth||400,l=this._container.clientHeight||300),[C,l]}_setupContainer(){const C=this._container;C.classList.add("maplibregl-map");const l=this._canvasContainer=x.create("div","maplibregl-canvas-container",C);this._interactive&&l.classList.add("maplibregl-interactive"),this._canvas=x.create("canvas","maplibregl-canvas",l),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const d=this._containerDimensions(),y=this._getClampedPixelRatio(d[0],d[1]);this._resizeCanvas(d[0],d[1],y);const v=this._controlContainer=x.create("div","maplibregl-control-container",C),E=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(U=>{E[U]=x.create("div",`maplibregl-ctrl-${U} `,v)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(C,l,d){this._canvas.width=Math.floor(d*C),this._canvas.height=Math.floor(d*l),this._canvas.style.width=`${C}px`,this._canvas.style.height=`${l}px`}_setupPainter(){const C={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let l=null;this._canvas.addEventListener("webglcontextcreationerror",y=>{l={requestedAttributes:C},y&&(l.statusMessage=y.statusMessage,l.type=y.type)},{once:!0});const d=this._canvas.getContext("webgl2",C)||this._canvas.getContext("webgl",C);if(!d){const y="Failed to initialize WebGL";throw l?(l.message=y,new Error(JSON.stringify(l))):new Error(y)}this.painter=new qa(d,this.transform),B.testSupport(d)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(C){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||C,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(C){return this._update(),this._renderTaskQueue.add(C)}_cancelRenderFrame(C){this._renderTaskQueue.remove(C)}_render(C){const l=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(C),this._removed)return;let d=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const v=this.transform.zoom,E=_.now();this.style.zoomHistory.update(v,E);const U=new o.a8(v,{now:E,fadeDuration:l,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),R=U.crossFadingFactor();R===1&&R===this._crossFadingFactor||(d=!0,this._crossFadingFactor=R),this.style.update(U)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,l,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:l,showPadding:this.showPadding}),this.fire(new o.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,o.bc.mark(o.bd.load),this.fire(new o.k("load"))),this.style&&(this.style.hasTransitions()||d)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const y=this._sourcesDirty||this._styleDirty||this._placementDirty;return y||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new o.k("idle")),!this._loaded||this._fullyLoaded||y||(this._fullyLoaded=!0,o.bc.mark(o.bd.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var C;this._hash&&this._hash.remove();for(const d of this._controls)d.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),J.removeThrottleControl(this._imageQueueHandle),(C=this._resizeObserver)===null||C===void 0||C.disconnect();const l=this.painter.context.gl.getExtension("WEBGL_lose_context");l&&l.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),x.remove(this._canvasContainer),x.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),o.bc.clearMetrics(),this._removed=!0,this.fire(new o.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,_.frameAsync(this._frameRequest).then(C=>{o.bc.frame(C),this._frameRequest=null,this._render(C)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(C){this._showTileBoundaries!==C&&(this._showTileBoundaries=C,this._update())}get showPadding(){return!!this._showPadding}set showPadding(C){this._showPadding!==C&&(this._showPadding=C,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(C){this._showCollisionBoxes!==C&&(this._showCollisionBoxes=C,C?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(C){this._showOverdrawInspector!==C&&(this._showOverdrawInspector=C,this._update())}get repaint(){return!!this._repaint}set repaint(C){this._repaint!==C&&(this._repaint=C,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(C){this._vertices=C,this._update()}get version(){return hh}getCameraTargetElevation(){return this.transform.elevation}},a.MapMouseEvent=Ei,a.MapTouchEvent=zs,a.MapWheelEvent=Gs,a.Marker=pA,a.NavigationControl=class{constructor(C){this._updateZoomButtons=()=>{const l=this._map.getZoom(),d=l===this._map.getMaxZoom(),y=l===this._map.getMinZoom();this._zoomInButton.disabled=d,this._zoomOutButton.disabled=y,this._zoomInButton.setAttribute("aria-disabled",d.toString()),this._zoomOutButton.setAttribute("aria-disabled",y.toString())},this._rotateCompassArrow=()=>{const l=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=l},this._setButtonTitle=(l,d)=>{const y=this._map._getUIString(`NavigationControl.${d}`);l.title=y,l.setAttribute("aria-label",y)},this.options=o.e({},Sd,C),this._container=x.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",l=>l.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",l=>this._map.zoomIn({},{originalEvent:l})),x.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",l=>this._map.zoomOut({},{originalEvent:l})),x.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",l=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:l}):this._map.resetNorth({},{originalEvent:l})}),this._compassIcon=x.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(C){return this._map=C,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Td(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){x.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(C,l){const d=x.create("button",C,this._container);return d.type="button",d.addEventListener("click",l),d}},a.Popup=class extends o.E{constructor(C){super(),this.remove=()=>(this._content&&x.remove(this._content),this._container&&(x.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new o.k("close"))),this),this._onMouseUp=l=>{this._update(l.point)},this._onMouseMove=l=>{this._update(l.point)},this._onDrag=l=>{this._update(l.point)},this._update=l=>{var d;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=x.create("div","maplibregl-popup",this._map.getContainer()),this._tip=x.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const R of this.options.className.split(" "))this._container.classList.add(R);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?dA(this._lngLat,this._flatPos,this._map.transform):(d=this._lngLat)===null||d===void 0?void 0:d.wrap(),this._trackPointer&&!l)return;const y=this._flatPos=this._pos=this._trackPointer&&l?l:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&l?l:this._map.transform.locationPoint(this._lngLat));let v=this.options.anchor;const E=fh(this.options.offset);if(!v){const R=this._container.offsetWidth,g=this._container.offsetHeight;let w;w=y.y+E.bottom.y<g?["top"]:y.y>this._map.transform.height-g?["bottom"]:[],y.x<R/2?w.push("left"):y.x>this._map.transform.width-R/2&&w.push("right"),v=w.length===0?"bottom":w.join("-")}let U=y.add(E[v]);this.options.subpixelPositioning||(U=U.round()),x.setTransform(this._container,`${mu[v]} translate(${U.x}px,${U.y}px)`),fA(this._container,v,"popup")},this._onClose=()=>{this.remove()},this.options=o.e(Object.create(dh),C)}addTo(C){return this._map&&this.remove(),this._map=C,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new o.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(C){return this._lngLat=o.M.convert(C),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(C){return this.setDOMContent(document.createTextNode(C))}setHTML(C){const l=document.createDocumentFragment(),d=document.createElement("body");let y;for(d.innerHTML=C;y=d.firstChild,y;)l.appendChild(y);return this.setDOMContent(l)}getMaxWidth(){var C;return(C=this._container)===null||C===void 0?void 0:C.style.maxWidth}setMaxWidth(C){return this.options.maxWidth=C,this._update(),this}setDOMContent(C){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=x.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(C),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(C){this._container&&this._container.classList.add(C)}removeClassName(C){this._container&&this._container.classList.remove(C)}setOffset(C){return this.options.offset=C,this._update(),this}toggleClassName(C){if(this._container)return this._container.classList.toggle(C)}setSubpixelPositioning(C){this.options.subpixelPositioning=C}_createCloseButton(){this.options.closeButton&&(this._closeButton=x.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const C=this._container.querySelector(Id);C&&C.focus()}},a.RasterDEMTileSource=er,a.RasterTileSource=Jt,a.ScaleControl=class{constructor(C){this._onMove=()=>{gA(this._map,this._container,this.options)},this.setUnit=l=>{this.options.unit=l,gA(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},yu),C)}getDefaultPosition(){return"bottom-left"}onAdd(C){return this._map=C,this._container=x.create("div","maplibregl-ctrl maplibregl-ctrl-scale",C.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){x.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},a.ScrollZoomHandler=El,a.Style=Mi,a.TerrainControl=class{constructor(C){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=C}onAdd(C){return this._map=C,this._container=x.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=x.create("button","maplibregl-ctrl-terrain",this._container),x.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){x.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},a.TwoFingersTouchPitchHandler=cA,a.TwoFingersTouchRotateHandler=uh,a.TwoFingersTouchZoomHandler=aA,a.TwoFingersTouchZoomRotateHandler=uA,a.VectorTileSource=Ut,a.VideoSource=Ne,a.addSourceType=(C,l)=>o._(void 0,void 0,void 0,function*(){if(Lr(C))throw new Error(`A source type called "${C}" already exists.`);((d,y)=>{Ar[d]=y})(C,l)}),a.clearPrewarmedResources=function(){const C=Ot;C&&(C.isPreloaded()&&C.numActive()===1?(C.release(it),Ot=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},a.getMaxParallelImageRequests=function(){return o.a.MAX_PARALLEL_IMAGE_REQUESTS},a.getRTLTextPluginStatus=function(){return fe().getRTLTextPluginStatus()},a.getVersion=function(){return mp},a.getWorkerCount=function(){return vt.workerCount},a.getWorkerUrl=function(){return o.a.WORKER_URL},a.importScriptInWorkers=function(C){return ie().broadcast("IS",C)},a.prewarm=function(){jt().acquire(it)},a.setMaxParallelImageRequests=function(C){o.a.MAX_PARALLEL_IMAGE_REQUESTS=C},a.setRTLTextPlugin=function(C,l){return fe().setRTLTextPlugin(C,l)},a.setWorkerCount=function(C){vt.workerCount=C},a.setWorkerUrl=function(C){o.a.WORKER_URL=C}});var s=e;return s})})(CS);var ES=CS.exports;const Ls=Mp(ES);var Fs;(function(r){r[r.Unknown=0]="Unknown",r[r.Point=1]="Point",r[r.LineString=2]="LineString",r[r.Polygon=3]="Polygon",r[r.MultiPoint=4]="MultiPoint",r[r.MultiLineString=5]="MultiLineString",r[r.MultiPolygon=6]="MultiPolygon",r[r.GeometryCollection=7]="GeometryCollection",r[r.CircularString=8]="CircularString",r[r.CompoundCurve=9]="CompoundCurve",r[r.CurvePolygon=10]="CurvePolygon",r[r.MultiCurve=11]="MultiCurve",r[r.MultiSurface=12]="MultiSurface",r[r.Curve=13]="Curve",r[r.Surface=14]="Surface",r[r.PolyhedralSurface=15]="PolyhedralSurface",r[r.TIN=16]="TIN",r[r.Triangle=17]="Triangle"})(Fs||(Fs={}));const Up=4,Rp=4,Op=4,CA=new Int32Array(2),SS=new Float32Array(CA.buffer),TS=new Float64Array(CA.buffer),t0=new Uint16Array(new Uint8Array([1,0]).buffer)[0]===1;var lv;(function(r){r[r.UTF8_BYTES=1]="UTF8_BYTES",r[r.UTF16_STRING=2]="UTF16_STRING"})(lv||(lv={}));class Bu{constructor(t){this.bytes_=t,this.position_=0,this.text_decoder_=new TextDecoder}static allocate(t){return new Bu(new Uint8Array(t))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(t){this.position_=t}capacity(){return this.bytes_.length}readInt8(t){return this.readUint8(t)<<24>>24}readUint8(t){return this.bytes_[t]}readInt16(t){return this.readUint16(t)<<16>>16}readUint16(t){return this.bytes_[t]|this.bytes_[t+1]<<8}readInt32(t){return this.bytes_[t]|this.bytes_[t+1]<<8|this.bytes_[t+2]<<16|this.bytes_[t+3]<<24}readUint32(t){return this.readInt32(t)>>>0}readInt64(t){return BigInt.asIntN(64,BigInt(this.readUint32(t))+(BigInt(this.readUint32(t+4))<<BigInt(32)))}readUint64(t){return BigInt.asUintN(64,BigInt(this.readUint32(t))+(BigInt(this.readUint32(t+4))<<BigInt(32)))}readFloat32(t){return CA[0]=this.readInt32(t),SS[0]}readFloat64(t){return CA[t0?0:1]=this.readInt32(t),CA[t0?1:0]=this.readInt32(t+4),TS[0]}writeInt8(t,e){this.bytes_[t]=e}writeUint8(t,e){this.bytes_[t]=e}writeInt16(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8}writeUint16(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8}writeInt32(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8,this.bytes_[t+2]=e>>16,this.bytes_[t+3]=e>>24}writeUint32(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8,this.bytes_[t+2]=e>>16,this.bytes_[t+3]=e>>24}writeInt64(t,e){this.writeInt32(t,Number(BigInt.asIntN(32,e))),this.writeInt32(t+4,Number(BigInt.asIntN(32,e>>BigInt(32))))}writeUint64(t,e){this.writeUint32(t,Number(BigInt.asUintN(32,e))),this.writeUint32(t+4,Number(BigInt.asUintN(32,e>>BigInt(32))))}writeFloat32(t,e){SS[0]=e,this.writeInt32(t,CA[0])}writeFloat64(t,e){TS[0]=e,this.writeInt32(t,CA[t0?0:1]),this.writeInt32(t+4,CA[t0?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+Up+Rp)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let t="";for(let e=0;e<Rp;e++)t+=String.fromCharCode(this.readInt8(this.position_+Up+e));return t}__offset(t,e){const n=t-this.readInt32(t);return e<this.readInt16(n)?this.readInt16(n+e):0}__union(t,e){return t.bb_pos=e+this.readInt32(e),t.bb=this,t}__string(t,e){t+=this.readInt32(t);const n=this.readInt32(t);t+=Up;const i=this.bytes_.subarray(t,t+n);return e===lv.UTF8_BYTES?i:this.text_decoder_.decode(i)}__union_with_string(t,e){return typeof t=="string"?this.__string(e):this.__union(t,e)}__indirect(t){return t+this.readInt32(t)}__vector(t){return t+this.readInt32(t)+Up}__vector_len(t){return this.readInt32(t+this.readInt32(t))}__has_identifier(t){if(t.length!=Rp)throw new Error("FlatBuffers: file identifier must be length "+Rp);for(let e=0;e<Rp;e++)if(t.charCodeAt(e)!=this.readInt8(this.position()+Up+e))return!1;return!0}createScalarList(t,e){const n=[];for(let i=0;i<e;++i){const s=t(i);s!==null&&n.push(s)}return n}createObjList(t,e){const n=[];for(let i=0;i<e;++i){const s=t(i);s!==null&&n.push(s.unpack())}return n}}let jk=class Ia{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsGeometry(t,e){return(e||new Ia).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsGeometry(t,e){return t.setPosition(t.position()+Op),(e||new Ia).__init(t.readInt32(t.position())+t.position(),t)}ends(t){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readUint32(this.bb.__vector(this.bb_pos+e)+t*4):0}endsLength(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__vector_len(this.bb_pos+t):0}endsArray(){const t=this.bb.__offset(this.bb_pos,4);return t?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}xy(t){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readFloat64(this.bb.__vector(this.bb_pos+e)+t*8):0}xyLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}xyArray(){const t=this.bb.__offset(this.bb_pos,6);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}z(t){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.readFloat64(this.bb.__vector(this.bb_pos+e)+t*8):0}zLength(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}zArray(){const t=this.bb.__offset(this.bb_pos,8);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}m(t){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.readFloat64(this.bb.__vector(this.bb_pos+e)+t*8):0}mLength(){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__vector_len(this.bb_pos+t):0}mArray(){const t=this.bb.__offset(this.bb_pos,10);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}t(t){const e=this.bb.__offset(this.bb_pos,12);return e?this.bb.readFloat64(this.bb.__vector(this.bb_pos+e)+t*8):0}tLength(){const t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__vector_len(this.bb_pos+t):0}tArray(){const t=this.bb.__offset(this.bb_pos,12);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}tm(t){const e=this.bb.__offset(this.bb_pos,14);return e?this.bb.readUint64(this.bb.__vector(this.bb_pos+e)+t*8):BigInt(0)}tmLength(){const t=this.bb.__offset(this.bb_pos,14);return t?this.bb.__vector_len(this.bb_pos+t):0}type(){const t=this.bb.__offset(this.bb_pos,16);return t?this.bb.readUint8(this.bb_pos+t):Fs.Unknown}parts(t,e){const n=this.bb.__offset(this.bb_pos,18);return n?(e||new Ia).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+t*4),this.bb):null}partsLength(){const t=this.bb.__offset(this.bb_pos,18);return t?this.bb.__vector_len(this.bb_pos+t):0}static startGeometry(t){t.startObject(8)}static addEnds(t,e){t.addFieldOffset(0,e,0)}static createEndsVector(t,e){t.startVector(4,e.length,4);for(let n=e.length-1;n>=0;n--)t.addInt32(e[n]);return t.endVector()}static startEndsVector(t,e){t.startVector(4,e,4)}static addXy(t,e){t.addFieldOffset(1,e,0)}static createXyVector(t,e){t.startVector(8,e.length,8);for(let n=e.length-1;n>=0;n--)t.addFloat64(e[n]);return t.endVector()}static startXyVector(t,e){t.startVector(8,e,8)}static addZ(t,e){t.addFieldOffset(2,e,0)}static createZVector(t,e){t.startVector(8,e.length,8);for(let n=e.length-1;n>=0;n--)t.addFloat64(e[n]);return t.endVector()}static startZVector(t,e){t.startVector(8,e,8)}static addM(t,e){t.addFieldOffset(3,e,0)}static createMVector(t,e){t.startVector(8,e.length,8);for(let n=e.length-1;n>=0;n--)t.addFloat64(e[n]);return t.endVector()}static startMVector(t,e){t.startVector(8,e,8)}static addT(t,e){t.addFieldOffset(4,e,0)}static createTVector(t,e){t.startVector(8,e.length,8);for(let n=e.length-1;n>=0;n--)t.addFloat64(e[n]);return t.endVector()}static startTVector(t,e){t.startVector(8,e,8)}static addTm(t,e){t.addFieldOffset(5,e,0)}static createTmVector(t,e){t.startVector(8,e.length,8);for(let n=e.length-1;n>=0;n--)t.addInt64(e[n]);return t.endVector()}static startTmVector(t,e){t.startVector(8,e,8)}static addType(t,e){t.addFieldInt8(6,e,Fs.Unknown)}static addParts(t,e){t.addFieldOffset(7,e,0)}static createPartsVector(t,e){t.startVector(4,e.length,4);for(let n=e.length-1;n>=0;n--)t.addOffset(e[n]);return t.endVector()}static startPartsVector(t,e){t.startVector(4,e,4)}static endGeometry(t){return t.endObject()}static createGeometry(t,e,n,i,s,a,o,A,f){return Ia.startGeometry(t),Ia.addEnds(t,e),Ia.addXy(t,n),Ia.addZ(t,i),Ia.addM(t,s),Ia.addT(t,a),Ia.addTm(t,o),Ia.addType(t,A),Ia.addParts(t,f),Ia.endGeometry(t)}};function uv(r,t){const e=[];for(let n=0;n<r.length;n+=2){const i=[r[n],r[n+1]];t&&i.push(t[n>>1]),e.push(i)}return e}function IS(r,t,e){if(!e||e.length===0)return[uv(r,t)];let n=0;const i=Array.from(e).map(a=>r.slice(n,n=a<<1));let s;return t&&(n=0,s=Array.from(e).map(a=>t.slice(n,n=a))),i.map((a,o)=>uv(a,s?s[o]:void 0))}function qk(r,t){const e=r.xyArray(),n=r.zArray();switch(t){case Fs.Point:{const i=Array.from(e);return n&&i.push(n[0]),i}case Fs.MultiPoint:case Fs.LineString:return uv(e,n);case Fs.MultiLineString:return IS(e,n,r.endsArray());case Fs.Polygon:return IS(e,n,r.endsArray())}}function Av(r,t){let e=t;if(e===Fs.Unknown&&(e=r.type()),e===Fs.GeometryCollection){const i=[];for(let s=0;s<r.partsLength();s++){const a=r.parts(s),o=a.type();i.push(Av(a,o))}return{type:Fs[e],geometries:i}}else if(e===Fs.MultiPolygon){const i=[];for(let s=0;s<r.partsLength();s++)i.push(Av(r.parts(s),Fs.Polygon));return{type:Fs[e],coordinates:i.map(s=>s.coordinates)}}const n=qk(r,e);return{type:Fs[e],coordinates:n}}var Ps;(function(r){r[r.Byte=0]="Byte",r[r.UByte=1]="UByte",r[r.Bool=2]="Bool",r[r.Short=3]="Short",r[r.UShort=4]="UShort",r[r.Int=5]="Int",r[r.UInt=6]="UInt",r[r.Long=7]="Long",r[r.ULong=8]="ULong",r[r.Float=9]="Float",r[r.Double=10]="Double",r[r.String=11]="String",r[r.Json=12]="Json",r[r.DateTime=13]="DateTime",r[r.Binary=14]="Binary"})(Ps||(Ps={}));class Ms{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsColumn(t,e){return(e||new Ms).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsColumn(t,e){return t.setPosition(t.position()+Op),(e||new Ms).__init(t.readInt32(t.position())+t.position(),t)}name(t){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null}type(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readUint8(this.bb_pos+t):Ps.Byte}title(t){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__string(this.bb_pos+e,t):null}description(t){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__string(this.bb_pos+e,t):null}width(){const t=this.bb.__offset(this.bb_pos,12);return t?this.bb.readInt32(this.bb_pos+t):-1}precision(){const t=this.bb.__offset(this.bb_pos,14);return t?this.bb.readInt32(this.bb_pos+t):-1}scale(){const t=this.bb.__offset(this.bb_pos,16);return t?this.bb.readInt32(this.bb_pos+t):-1}nullable(){const t=this.bb.__offset(this.bb_pos,18);return t?!!this.bb.readInt8(this.bb_pos+t):!0}unique(){const t=this.bb.__offset(this.bb_pos,20);return t?!!this.bb.readInt8(this.bb_pos+t):!1}primaryKey(){const t=this.bb.__offset(this.bb_pos,22);return t?!!this.bb.readInt8(this.bb_pos+t):!1}metadata(t){const e=this.bb.__offset(this.bb_pos,24);return e?this.bb.__string(this.bb_pos+e,t):null}static startColumn(t){t.startObject(11)}static addName(t,e){t.addFieldOffset(0,e,0)}static addType(t,e){t.addFieldInt8(1,e,Ps.Byte)}static addTitle(t,e){t.addFieldOffset(2,e,0)}static addDescription(t,e){t.addFieldOffset(3,e,0)}static addWidth(t,e){t.addFieldInt32(4,e,-1)}static addPrecision(t,e){t.addFieldInt32(5,e,-1)}static addScale(t,e){t.addFieldInt32(6,e,-1)}static addNullable(t,e){t.addFieldInt8(7,+e,1)}static addUnique(t,e){t.addFieldInt8(8,+e,0)}static addPrimaryKey(t,e){t.addFieldInt8(9,+e,0)}static addMetadata(t,e){t.addFieldOffset(10,e,0)}static endColumn(t){const e=t.endObject();return t.requiredField(e,4),e}static createColumn(t,e,n,i,s,a,o,A,f,m,_,x){return Ms.startColumn(t),Ms.addName(t,e),Ms.addType(t,n),Ms.addTitle(t,i),Ms.addDescription(t,s),Ms.addWidth(t,a),Ms.addPrecision(t,o),Ms.addScale(t,A),Ms.addNullable(t,f),Ms.addUnique(t,m),Ms.addPrimaryKey(t,_),Ms.addMetadata(t,x),Ms.endColumn(t)}}class Nc{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsFeature(t,e){return(e||new Nc).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsFeature(t,e){return t.setPosition(t.position()+Op),(e||new Nc).__init(t.readInt32(t.position())+t.position(),t)}geometry(t){const e=this.bb.__offset(this.bb_pos,4);return e?(t||new jk).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null}properties(t){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readUint8(this.bb.__vector(this.bb_pos+e)+t):0}propertiesLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}propertiesArray(){const t=this.bb.__offset(this.bb_pos,6);return t?new Uint8Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}columns(t,e){const n=this.bb.__offset(this.bb_pos,8);return n?(e||new Ms).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+t*4),this.bb):null}columnsLength(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}static startFeature(t){t.startObject(3)}static addGeometry(t,e){t.addFieldOffset(0,e,0)}static addProperties(t,e){t.addFieldOffset(1,e,0)}static createPropertiesVector(t,e){t.startVector(1,e.length,1);for(let n=e.length-1;n>=0;n--)t.addInt8(e[n]);return t.endVector()}static startPropertiesVector(t,e){t.startVector(1,e,1)}static addColumns(t,e){t.addFieldOffset(2,e,0)}static createColumnsVector(t,e){t.startVector(4,e.length,4);for(let n=e.length-1;n>=0;n--)t.addOffset(e[n]);return t.endVector()}static startColumnsVector(t,e){t.startVector(4,e,4)}static endFeature(t){return t.endObject()}static finishFeatureBuffer(t,e){t.finish(e)}static finishSizePrefixedFeatureBuffer(t,e){t.finish(e,void 0,!0)}static createFeature(t,e,n,i){return Nc.startFeature(t),Nc.addGeometry(t,e),Nc.addProperties(t,n),Nc.addColumns(t,i),Nc.endFeature(t)}}new TextEncoder;const LS=new TextDecoder;function Kk(r,t){const e={};if(!t||t.length===0)return e;const n=r.propertiesArray();if(!n)return e;const i=new DataView(n.buffer,n.byteOffset),s=r.propertiesLength();let a=0;for(;a<s;){const o=i.getUint16(a,!0);a+=2;const A=t[o],f=A.name;switch(A.type){case Ps.Bool:{e[f]=!!i.getUint8(a),a+=1;break}case Ps.Byte:{e[f]=i.getInt8(a),a+=1;break}case Ps.UByte:{e[f]=i.getUint8(a),a+=1;break}case Ps.Short:{e[f]=i.getInt16(a,!0),a+=2;break}case Ps.UShort:{e[f]=i.getUint16(a,!0),a+=2;break}case Ps.Int:{e[f]=i.getInt32(a,!0),a+=4;break}case Ps.UInt:{e[f]=i.getUint32(a,!0),a+=4;break}case Ps.Long:{e[f]=Number(i.getBigInt64(a,!0)),a+=8;break}case Ps.ULong:{e[f]=Number(i.getBigUint64(a,!0)),a+=8;break}case Ps.Float:{e[f]=i.getFloat32(a,!0),a+=4;break}case Ps.Double:{e[f]=i.getFloat64(a,!0),a+=8;break}case Ps.DateTime:case Ps.String:{const m=i.getUint32(a,!0);a+=4,e[f]=LS.decode(n.subarray(a,a+m)),a+=m;break}case Ps.Json:{const m=i.getUint32(a,!0);a+=4;const _=LS.decode(n.subarray(a,a+m));e[f]=JSON.parse(_),a+=m;break}default:throw new Error("Unknown type "+A.type)}}return e}function hv(r,t){const e=t.columns;return{type:"Feature",geometry:Av(r.geometry(),t.geometryType),properties:Kk(r,e)}}const dv=new Uint8Array(0);function $k(){return this._source.cancel()}function Wk(r,t){if(!r.length)return t;if(!t.length)return r;var e=new Uint8Array(r.length+t.length);return e.set(r),e.set(t,r.length),e}function Xk(){var r=this,t=r._array.subarray(r._index);return r._source.read().then(function(e){return r._array=dv,r._index=0,e.done?t.length>0?{done:!1,value:t}:{done:!0,value:void 0}:{done:!1,value:Wk(t,e.value)}})}function Jk(r){if((r|=0)<0)throw new Error("invalid length");var t=this,e=this._array.length-this._index;if(this._index+r<=this._array.length)return Promise.resolve(this._array.subarray(this._index,this._index+=r));var n=new Uint8Array(r);return n.set(this._array.subarray(this._index)),function i(){return t._source.read().then(function(s){return s.done?(t._array=dv,t._index=0,e>0?n.subarray(0,e):null):e+s.value.length>=r?(t._array=s.value,t._index=r-e,n.set(s.value.subarray(0,r-e),e),n):(n.set(s.value,e),e+=s.value.length,i())})}()}function Yk(r){return typeof r.slice=="function"?r:new e0(typeof r.read=="function"?r:r.getReader())}function e0(r){this._source=r,this._array=dv,this._index=0}e0.prototype.read=Xk,e0.prototype.slice=Jk,e0.prototype.cancel=$k;class ec{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsCrs(t,e){return(e||new ec).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsCrs(t,e){return t.setPosition(t.position()+Op),(e||new ec).__init(t.readInt32(t.position())+t.position(),t)}org(t){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null}code(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readInt32(this.bb_pos+t):0}name(t){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__string(this.bb_pos+e,t):null}description(t){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__string(this.bb_pos+e,t):null}wkt(t){const e=this.bb.__offset(this.bb_pos,12);return e?this.bb.__string(this.bb_pos+e,t):null}codeString(t){const e=this.bb.__offset(this.bb_pos,14);return e?this.bb.__string(this.bb_pos+e,t):null}static startCrs(t){t.startObject(6)}static addOrg(t,e){t.addFieldOffset(0,e,0)}static addCode(t,e){t.addFieldInt32(1,e,0)}static addName(t,e){t.addFieldOffset(2,e,0)}static addDescription(t,e){t.addFieldOffset(3,e,0)}static addWkt(t,e){t.addFieldOffset(4,e,0)}static addCodeString(t,e){t.addFieldOffset(5,e,0)}static endCrs(t){return t.endObject()}static createCrs(t,e,n,i,s,a,o){return ec.startCrs(t),ec.addOrg(t,e),ec.addCode(t,n),ec.addName(t,i),ec.addDescription(t,s),ec.addWkt(t,a),ec.addCodeString(t,o),ec.endCrs(t)}}class r0{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsHeader(t,e){return(e||new r0).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsHeader(t,e){return t.setPosition(t.position()+Op),(e||new r0).__init(t.readInt32(t.position())+t.position(),t)}name(t){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null}envelope(t){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readFloat64(this.bb.__vector(this.bb_pos+e)+t*8):0}envelopeLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}envelopeArray(){const t=this.bb.__offset(this.bb_pos,6);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}geometryType(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readUint8(this.bb_pos+t):Fs.Unknown}hasZ(){const t=this.bb.__offset(this.bb_pos,10);return t?!!this.bb.readInt8(this.bb_pos+t):!1}hasM(){const t=this.bb.__offset(this.bb_pos,12);return t?!!this.bb.readInt8(this.bb_pos+t):!1}hasT(){const t=this.bb.__offset(this.bb_pos,14);return t?!!this.bb.readInt8(this.bb_pos+t):!1}hasTm(){const t=this.bb.__offset(this.bb_pos,16);return t?!!this.bb.readInt8(this.bb_pos+t):!1}columns(t,e){const n=this.bb.__offset(this.bb_pos,18);return n?(e||new Ms).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+t*4),this.bb):null}columnsLength(){const t=this.bb.__offset(this.bb_pos,18);return t?this.bb.__vector_len(this.bb_pos+t):0}featuresCount(){const t=this.bb.__offset(this.bb_pos,20);return t?this.bb.readUint64(this.bb_pos+t):BigInt("0")}indexNodeSize(){const t=this.bb.__offset(this.bb_pos,22);return t?this.bb.readUint16(this.bb_pos+t):16}crs(t){const e=this.bb.__offset(this.bb_pos,24);return e?(t||new ec).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null}title(t){const e=this.bb.__offset(this.bb_pos,26);return e?this.bb.__string(this.bb_pos+e,t):null}description(t){const e=this.bb.__offset(this.bb_pos,28);return e?this.bb.__string(this.bb_pos+e,t):null}metadata(t){const e=this.bb.__offset(this.bb_pos,30);return e?this.bb.__string(this.bb_pos+e,t):null}static startHeader(t){t.startObject(14)}static addName(t,e){t.addFieldOffset(0,e,0)}static addEnvelope(t,e){t.addFieldOffset(1,e,0)}static createEnvelopeVector(t,e){t.startVector(8,e.length,8);for(let n=e.length-1;n>=0;n--)t.addFloat64(e[n]);return t.endVector()}static startEnvelopeVector(t,e){t.startVector(8,e,8)}static addGeometryType(t,e){t.addFieldInt8(2,e,Fs.Unknown)}static addHasZ(t,e){t.addFieldInt8(3,+e,0)}static addHasM(t,e){t.addFieldInt8(4,+e,0)}static addHasT(t,e){t.addFieldInt8(5,+e,0)}static addHasTm(t,e){t.addFieldInt8(6,+e,0)}static addColumns(t,e){t.addFieldOffset(7,e,0)}static createColumnsVector(t,e){t.startVector(4,e.length,4);for(let n=e.length-1;n>=0;n--)t.addOffset(e[n]);return t.endVector()}static startColumnsVector(t,e){t.startVector(4,e,4)}static addFeaturesCount(t,e){t.addFieldInt64(8,e,BigInt("0"))}static addIndexNodeSize(t,e){t.addFieldInt16(9,e,16)}static addCrs(t,e){t.addFieldOffset(10,e,0)}static addTitle(t,e){t.addFieldOffset(11,e,0)}static addDescription(t,e){t.addFieldOffset(12,e,0)}static addMetadata(t,e){t.addFieldOffset(13,e,0)}static endHeader(t){return t.endObject()}static finishHeaderBuffer(t,e){t.finish(e)}static finishSizePrefixedHeaderBuffer(t,e){t.finish(e,void 0,!0)}}function fv(r){const t=r0.getRootAsHeader(r),e=t.featuresCount(),n=t.indexNodeSize(),i=[];for(let A=0;A<t.columnsLength();A++){const f=t.columns(A);if(!f)throw new Error("Column unexpectedly missing");if(!f.name())throw new Error("Column name unexpectedly missing");i.push({name:f.name(),type:f.type(),title:f.title(),description:f.description(),width:f.width(),precision:f.precision(),scale:f.scale(),nullable:f.nullable(),unique:f.unique(),primary_key:f.primaryKey()})}const s=t.crs(),a=s?{org:s.org(),code:s.code(),name:s.name(),description:s.description(),wkt:s.wkt(),code_string:s.codeString()}:null;return{geometryType:t.geometryType(),columns:i,envelope:null,featuresCount:Number(e),indexNodeSize:n,crs:a,title:t.title(),description:t.description(),metadata:t.metadata()}}/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var pv=function(r,t){return pv=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var i in n)n.hasOwnProperty(i)&&(e[i]=n[i])},pv(r,t)};function Zk(r,t){pv(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}function Qd(r,t,e,n){function i(s){return s instanceof e?s:new e(function(a){a(s)})}return new(e||(e=Promise))(function(s,a){function o(m){try{f(n.next(m))}catch(_){a(_)}}function A(m){try{f(n.throw(m))}catch(_){a(_)}}function f(m){m.done?s(m.value):i(m.value).then(o,A)}f((n=n.apply(r,t||[])).next())})}function EA(r,t){var e={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,i,s,a;return a={next:o(0),throw:o(1),return:o(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function o(f){return function(m){return A([f,m])}}function A(f){if(n)throw new TypeError("Generator is already executing.");for(;e;)try{if(n=1,i&&(s=f[0]&2?i.return:f[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,f[1])).done)return s;switch(i=0,s&&(f=[f[0]&2,s.value]),f[0]){case 0:case 1:s=f;break;case 4:return e.label++,{value:f[1],done:!1};case 5:e.label++,i=f[1],f=[0];continue;case 7:f=e.ops.pop(),e.trys.pop();continue;default:if(s=e.trys,!(s=s.length>0&&s[s.length-1])&&(f[0]===6||f[0]===2)){e=0;continue}if(f[0]===3&&(!s||f[1]>s[0]&&f[1]<s[3])){e.label=f[1];break}if(f[0]===6&&e.label<s[1]){e.label=s[1],s=f;break}if(s&&e.label<s[2]){e.label=s[2],e.ops.push(f);break}s[2]&&e.ops.pop(),e.trys.pop();continue}f=t.call(r,e)}catch(m){f=[6,m],i=0}finally{n=s=0}if(f[0]&5)throw f[1];return{value:f[0]?f[1]:void 0,done:!0}}}function Hd(r){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&r[t],n=0;if(e)return e.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Dp(r){return this instanceof Dp?(this.v=r,this):new Dp(r)}function t8(r,t,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=e.apply(r,t||[]),i,s=[];return i={},a("next"),a("throw"),a("return"),i[Symbol.asyncIterator]=function(){return this},i;function a(x){n[x]&&(i[x]=function(B){return new Promise(function(P,M){s.push([x,B,P,M])>1||o(x,B)})})}function o(x,B){try{A(n[x](B))}catch(P){_(s[0][3],P)}}function A(x){x.value instanceof Dp?Promise.resolve(x.value.v).then(f,m):_(s[0][2],x)}function f(x){o("next",x)}function m(x){o("throw",x)}function _(x,B){x(B),s.shift(),s.length&&o(s[0][0],s[0][1])}}var FS=function(r){Zk(t,r);function t(e){var n=r.call(this,e)||this;return Object.defineProperty(n,"name",{value:"RepeaterOverflowError",enumerable:!1}),typeof Object.setPrototypeOf=="function"?Object.setPrototypeOf(n,n.constructor.prototype):n.__proto__=n.constructor.prototype,typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(n,n.constructor),n}return t}(Error);(function(){function r(t){if(t<0)throw new RangeError("Capacity may not be less than 0");this._c=t,this._q=[]}return Object.defineProperty(r.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"full",{get:function(){return this._q.length>=this._c},enumerable:!1,configurable:!0}),r.prototype.add=function(t){if(this.full)throw new Error("Buffer full");this._q.push(t)},r.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},r})(),function(){function r(t){if(t<1)throw new RangeError("Capacity may not be less than 1");this._c=t,this._q=[]}return Object.defineProperty(r.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"full",{get:function(){return!1},enumerable:!1,configurable:!0}),r.prototype.add=function(t){for(;this._q.length>=this._c;)this._q.shift();this._q.push(t)},r.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},r}(),function(){function r(t){if(t<1)throw new RangeError("Capacity may not be less than 1");this._c=t,this._q=[]}return Object.defineProperty(r.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"full",{get:function(){return!1},enumerable:!1,configurable:!0}),r.prototype.add=function(t){this._q.length<this._c&&this._q.push(t)},r.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},r}();function gv(r){r!=null&&typeof r.then=="function"&&r.then(s0,s0)}var mv=0,PS=1,Ih=2,n0=3,yv=4,i0=1024,s0=function(){};function zd(r){var t=r.err,e=Promise.resolve(r.execution).then(function(n){if(t!=null)throw t;return n});return r.err=void 0,r.execution=e.then(function(){},function(){}),r.pending===void 0?e:r.pending.then(function(){return e})}function Lh(r,t){var e=r.state>=n0;return Promise.resolve(t).then(function(n){return!e&&r.state>=yv?zd(r).then(function(i){return{value:i,done:!0}}):{value:n,done:e}})}function _v(r,t){var e,n;if(!(r.state>=Ih))if(r.state=Ih,r.onnext(),r.onstop(),r.err==null&&(r.err=t),r.pushes.length===0&&(typeof r.buffer>"u"||r.buffer.empty))Np(r);else try{for(var i=Hd(r.pushes),s=i.next();!s.done;s=i.next()){var a=s.value;a.resolve()}}catch(o){e={error:o}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}}function Np(r){var t,e;if(!(r.state>=n0)){r.state<Ih&&_v(r),r.state=n0,r.buffer=void 0;try{for(var n=Hd(r.nexts),i=n.next();!i.done;i=n.next()){var s=i.value,a=r.pending===void 0?zd(r):r.pending.then(function(){return zd(r)});s.resolve(Lh(r,a))}}catch(o){t={error:o}}finally{try{i&&!i.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}r.pushes=[],r.nexts=[]}}function MS(r){r.state>=yv||(r.state<n0&&Np(r),r.state=yv)}function e8(r,t){if(gv(t),r.pushes.length>=i0)throw new FS("No more than "+i0+" pending calls to push are allowed on a single repeater.");if(r.state>=Ih)return Promise.resolve(void 0);var e=r.pending===void 0?Promise.resolve(t):r.pending.then(function(){return t});e=e.catch(function(A){r.state<Ih&&(r.err=A),MS(r)});var n;if(r.nexts.length){var i=r.nexts.shift();i.resolve(Lh(r,e)),r.nexts.length?n=Promise.resolve(r.nexts[0].value):n=new Promise(function(A){return r.onnext=A})}else typeof r.buffer<"u"&&!r.buffer.full?(r.buffer.add(e),n=Promise.resolve(void 0)):n=new Promise(function(A){return r.pushes.push({resolve:A,value:e})});var s=!0,a={},o=n.catch(function(A){if(s)throw A});return a.then=function(A,f){return s=!1,Promise.prototype.then.call(n,A,f)},a.catch=function(A){return s=!1,Promise.prototype.catch.call(n,A)},a.finally=n.finally.bind(n),r.pending=e.then(function(){return o}).catch(function(A){r.err=A,MS(r)}),a}function r8(r){var t=_v.bind(null,r),e=new Promise(function(n){return r.onstop=n});return t.then=e.then.bind(e),t.catch=e.catch.bind(e),t.finally=e.finally.bind(e),t}function n8(r){if(!(r.state>=PS)){r.state=PS;var t=e8.bind(null,r),e=r8(r);r.execution=new Promise(function(n){return n(r.executor(t,e))}),r.execution.catch(function(){return _v(r)})}}var o0=new WeakMap,kp=function(){function r(t,e){o0.set(this,{executor:t,buffer:e,err:void 0,state:mv,pushes:[],nexts:[],pending:void 0,execution:void 0,onnext:s0,onstop:s0})}return r.prototype.next=function(t){gv(t);var e=o0.get(this);if(e===void 0)throw new Error("WeakMap error");if(e.nexts.length>=i0)throw new FS("No more than "+i0+" pending calls to next are allowed on a single repeater.");if(e.state<=mv&&n8(e),e.onnext(t),typeof e.buffer<"u"&&!e.buffer.empty){var n=Lh(e,e.buffer.remove());if(e.pushes.length){var i=e.pushes.shift();e.buffer.add(i.value),e.onnext=i.resolve}return n}else if(e.pushes.length){var s=e.pushes.shift();return e.onnext=s.resolve,Lh(e,s.value)}else if(e.state>=Ih)return Np(e),Lh(e,zd(e));return new Promise(function(a){return e.nexts.push({resolve:a,value:t})})},r.prototype.return=function(t){gv(t);var e=o0.get(this);if(e===void 0)throw new Error("WeakMap error");return Np(e),e.execution=Promise.resolve(e.execution).then(function(){return t}),Lh(e,zd(e))},r.prototype.throw=function(t){var e=o0.get(this);if(e===void 0)throw new Error("WeakMap error");return e.state<=mv||e.state>=Ih||typeof e.buffer<"u"&&!e.buffer.empty?(Np(e),e.err==null&&(e.err=t),Lh(e,zd(e))):this.next(Promise.reject(t))},r.prototype[Symbol.asyncIterator]=function(){return this},r.race=i8,r.merge=s8,r.zip=o8,r.latest=a8,r}();function a0(r,t){var e,n,i=[],s=function(f){f!=null&&typeof f[Symbol.asyncIterator]=="function"?i.push(f[Symbol.asyncIterator]()):f!=null&&typeof f[Symbol.iterator]=="function"?i.push(f[Symbol.iterator]()):i.push(function(){return t8(this,arguments,function(){return EA(this,function(x){switch(x.label){case 0:return t.yieldValues?[4,Dp(f)]:[3,3];case 1:return[4,x.sent()];case 2:x.sent(),x.label=3;case 3:return t.returnValues?[4,Dp(f)]:[3,5];case 4:return[2,x.sent()];case 5:return[2]}})})}())};try{for(var a=Hd(r),o=a.next();!o.done;o=a.next()){var A=o.value;s(A)}}catch(f){e={error:f}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}return i}function i8(r){var t=this,e=a0(r,{returnValues:!0});return new kp(function(n,i){return Qd(t,void 0,void 0,function(){var s,a,o,A,f,m;return EA(this,function(_){switch(_.label){case 0:if(!e.length)return i(),[2];a=!1,i.then(function(){s(),a=!0}),_.label=1;case 1:_.trys.push([1,,5,7]),A=void 0,f=0,m=function(){var x,B,P,M,k,Q;return EA(this,function(q){switch(q.label){case 0:x=f;try{for(B=(k=void 0,Hd(e)),P=B.next();!P.done;P=B.next())M=P.value,Promise.resolve(M.next()).then(function(J){J.done?(i(),o===void 0&&(o=J)):f===x&&(f++,s(J))},function(J){return i(J)})}catch(J){k={error:J}}finally{try{P&&!P.done&&(Q=B.return)&&Q.call(B)}finally{if(k)throw k.error}}return[4,new Promise(function(J){return s=J})];case 1:return A=q.sent(),A===void 0?[3,3]:[4,n(A.value)];case 2:q.sent(),q.label=3;case 3:return[2]}})},_.label=2;case 2:return a?[3,4]:[5,m()];case 3:return _.sent(),[3,2];case 4:return[2,o&&o.value];case 5:return i(),[4,Promise.race(e.map(function(x){return x.return&&x.return()}))];case 6:return _.sent(),[7];case 7:return[2]}})})})}function s8(r){var t=this,e=a0(r,{yieldValues:!0});return new kp(function(n,i){return Qd(t,void 0,void 0,function(){var s,a,o,A=this;return EA(this,function(f){switch(f.label){case 0:if(!e.length)return i(),[2];s=[],a=!1,i.then(function(){var m,_;a=!0;try{for(var x=Hd(s),B=x.next();!B.done;B=x.next()){var P=B.value;P()}}catch(M){m={error:M}}finally{try{B&&!B.done&&(_=x.return)&&_.call(x)}finally{if(m)throw m.error}}}),f.label=1;case 1:return f.trys.push([1,,3,4]),[4,Promise.all(e.map(function(m,_){return Qd(A,void 0,void 0,function(){var x,B;return EA(this,function(P){switch(P.label){case 0:P.trys.push([0,,6,9]),P.label=1;case 1:return a?[3,5]:(Promise.resolve(m.next()).then(function(M){return s[_](M)},function(M){return i(M)}),[4,new Promise(function(M){s[_]=M})]);case 2:return x=P.sent(),x===void 0?[3,4]:x.done?(o=x,[2]):[4,n(x.value)];case 3:P.sent(),P.label=4;case 4:return[3,1];case 5:return[3,9];case 6:return B=m.return,B?[4,m.return()]:[3,8];case 7:B=P.sent(),P.label=8;case 8:return[7];case 9:return[2]}})})}))];case 2:return f.sent(),[2,o&&o.value];case 3:return i(),[7];case 4:return[2]}})})})}function o8(r){var t=this,e=a0(r,{returnValues:!0});return new kp(function(n,i){return Qd(t,void 0,void 0,function(){var s,a,o,A;return EA(this,function(f){switch(f.label){case 0:if(!e.length)return i(),[2,[]];a=!1,i.then(function(){s(),a=!0}),f.label=1;case 1:f.trys.push([1,,6,8]),f.label=2;case 2:return a?[3,5]:(Promise.all(e.map(function(m){return m.next()})).then(function(m){return s(m)},function(m){return i(m)}),[4,new Promise(function(m){return s=m})]);case 3:return o=f.sent(),o===void 0?[2]:(A=o.map(function(m){return m.value}),o.some(function(m){return m.done})?[2,A]:[4,n(A)]);case 4:return f.sent(),[3,2];case 5:return[3,8];case 6:return i(),[4,Promise.all(e.map(function(m){return m.return&&m.return()}))];case 7:return f.sent(),[7];case 8:return[2]}})})})}function a8(r){var t=this,e=a0(r,{yieldValues:!0,returnValues:!0});return new kp(function(n,i){return Qd(t,void 0,void 0,function(){var s,a,o,A,f,m=this;return EA(this,function(_){switch(_.label){case 0:if(!e.length)return i(),[2,[]];a=[],o=!1,i.then(function(){var x,B;s();try{for(var P=Hd(a),M=P.next();!M.done;M=P.next()){var k=M.value;k()}}catch(Q){x={error:Q}}finally{try{M&&!M.done&&(B=P.return)&&B.call(P)}finally{if(x)throw x.error}}o=!0}),_.label=1;case 1:return _.trys.push([1,,5,7]),Promise.all(e.map(function(x){return x.next()})).then(function(x){return s(x)},function(x){return i(x)}),[4,new Promise(function(x){return s=x})];case 2:return A=_.sent(),A===void 0?[2]:(f=A.map(function(x){return x.value}),A.every(function(x){return x.done})?[2,f]:[4,n(f.slice())]);case 3:return _.sent(),[4,Promise.all(e.map(function(x,B){return Qd(m,void 0,void 0,function(){var P;return EA(this,function(M){switch(M.label){case 0:if(A[B].done)return[2,A[B].value];M.label=1;case 1:return o?[3,4]:(Promise.resolve(x.next()).then(function(k){return a[B](k)},function(k){return i(k)}),[4,new Promise(function(k){return a[B]=k})]);case 2:return P=M.sent(),P===void 0?[2,A[B].value]:P.done?[2,P.value]:(f[B]=P.value,[4,n(f.slice())]);case 3:return M.sent(),[3,1];case 4:return[2]}})})}))];case 4:return[2,_.sent()];case 5:return i(),[4,Promise.all(e.map(function(x){return x.return&&x.return()}))];case 6:return _.sent(),[7];case 7:return[2]}})})})}let c0=class{constructor(){this._extraRequestThreshold=256*1024}extraRequestThreshold(){return this._extraRequestThreshold}setExtraRequestThreshold(t){if(t<0)throw new Error("extraRequestThreshold cannot be negative");this._extraRequestThreshold=t}};c0.global=new c0;var kc;(function(r){r[r.Debug=0]="Debug",r[r.Info=1]="Info",r[r.Warn=2]="Warn",r[r.Error=3]="Error"})(kc||(kc={}));class Us{static debug(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this.log(kc.Debug,...e)}static info(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this.log(kc.Info,...e)}static warn(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this.log(kc.Warn,...e)}static error(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this.log(kc.Error,...e)}static log(t){if(!(this.logLevel>t)){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];switch(t){case kc.Debug:{console.debug(...n);break}case kc.Info:{console.info(...n);break}case kc.Warn:{console.warn(...n);break}case kc.Error:{console.error(...n);break}}}}}Us.logLevel=kc.Warn;const Fh=8*4+8,c8=16;function vv(r,t){t=Math.min(Math.max(+t,2),65535);let e=r,n=e;do e=Math.ceil(e/t),n+=e;while(e!==1);return n*Fh}function l8(r,t){if(t<2)throw new Error("Node size must be at least 2");if(r===0)throw new Error("Number of items must be greater than 0");let e=r,n=e;const i=[e];do e=Math.ceil(e/t),n+=e,i.push(e);while(e!==1);const s=[];e=n;for(const o of i)s.push(e-o),e-=o;const a=[];for(let o=0;o<i.length;o++)a.push([s[o],s[o]+i[o]]);return a}async function*u8(r,t,e,n){class i{constructor(P,M){this._level=M,this.nodes=P}level(){return this._level}startNodeIdx(){return this.nodes[0]}endNodeIdx(){return this.nodes[1]}extendEndNodeIdx(P){console.assert(P>this.nodes[1]),this.nodes[1]=P}toString(){return`[NodeRange level: ${this._level}, nodes: ${this.nodes[0]}-${this.nodes[1]}]`}}const{minX:s,minY:a,maxX:o,maxY:A}=e;Us.info(`tree items: ${r}, nodeSize: ${t}`);const f=l8(r,t),m=f[0][0],x=[(()=>{const B=[0,1],P=f.length-1;return new i(B,P)})()];for(Us.debug(`starting stream search with queue: ${x}, numItems: ${r}, nodeSize: ${t}, levelBounds: ${f}`);x.length!=0;){const B=x.shift();Us.debug(`popped node: ${B}, queueLength: ${x.length}`);const P=B.startNodeIdx(),M=P>=m,k=(()=>{const[,tt]=f[B.level()],ft=Math.min(B.endNodeIdx()+t,tt);return M&&ft<tt?ft+1:ft})(),Q=k-P,q=await n(P*Fh,Q*Fh),J=new DataView(q);for(let tt=P;tt<k;tt++){const ft=tt-P,pt=ft*Fh;if(o<J.getFloat64(pt+0,!0)||A<J.getFloat64(pt+8,!0)||s>J.getFloat64(pt+16,!0)||a>J.getFloat64(pt+24,!0))continue;const mt=J.getBigUint64(pt+32,!0);if(M){const ct=mt,wt=(()=>{if(tt<r-1){const te=(ft+1)*Fh;return J.getBigUint64(te+32,!0)-ct}else return null})(),yt=tt-m;yield[Number(ct),yt,Number(wt)];continue}const dt=mt,Rt=c0.global.extraRequestThreshold()/Fh,Lt=x[x.length-1];if(Lt!==void 0&&Lt.level()==B.level()-1&&dt<Lt.endNodeIdx()+Rt){Us.debug(`Merging "nodeRange" request into existing range: ${Lt}, newEndNodeIdx: ${Lt.endNodeIdx()} -> ${dt}`),Lt.extendEndNodeIdx(Number(dt));continue}const st=(()=>{const ct=B.level()-1,wt=[Number(dt),Number(dt)+1];return new i(wt,ct)})();Lt!==void 0&&Lt.level()==st.level()?Us.info(`Same level, but too far away. Pushing new request for nodeIdx: ${dt} rather than merging with distant ${Lt}`):Us.info(`Pushing new level for ${st} onto queue with nearestNodeRange: ${Lt} since there's not already a range for this level.`),x.push(st)}}}const SA=new Uint8Array([102,103,98,3,102,103,98,0]),Cu=4;class bv{constructor(t,e,n,i,s){this.headerClient=t,this.header=e,this.headerLength=n,this.indexLength=i,this.nocache=s}static async open(t,e){const i=new US(t,e),s=(()=>{const x=c8,B=3;let P=0,M;for(M=0;M<B;M++){const k=x**M*Fh;P+=k}return P})(),a=2024+s;Us.debug(`fetching header. minReqLength: ${a} (assumedHeaderLength: 2024, assumedIndexLength: ${s})`);{const x=new Uint8Array(await i.getRange(0,8,a,"header"));if(!x.subarray(0,3).every((B,P)=>SA[P]===B))throw Us.error(`bytes: ${x} != ${SA}`),new Error("Not a FlatGeobuf file");Us.debug("magic bytes look good")}let o;{const x=await i.getRange(8,4,a,"header");o=new DataView(x).getUint32(0,!0);const B=1048576*10;if(o>B||o<8)throw new Error("Invalid header size");Us.debug(`headerLength: ${o}`)}const A=await i.getRange(12,o,a,"header"),f=new Bu(new Uint8Array(A)),m=fv(f),_=vv(m.featuresCount,m.indexNodeSize);return Us.debug("completed: opening http reader"),new bv(i,m,o,_,e)}async*selectBbox(t){const e=this.lengthBeforeTree(),n=this.headerClient,i=async function(A,f){return n.getRange(e+A,f,0,"index")},s=[];let a=[];for await(const A of u8(this.header.featuresCount,this.header.indexNodeSize,t,i)){const[f,,]=A;let[,,m]=A;if(m||(Us.info("final feature"),m=4),a.length==0){a.push([f,m]);continue}const _=a[a.length-1],x=f-(_[0]+_[1]);x>c0.global.extraRequestThreshold()&&(Us.info(`Pushing new feature batch, since gap ${x} was too large`),s.push(a),a=[]),a.push([f,m])}this.headerClient.logUsage("header+index"),a.length>0&&s.push(a);const o=s.flatMap(A=>this.readFeatureBatch(A,this.nocache));yield*kp.merge(o)}lengthBeforeTree(){return SA.length+Cu+this.headerLength}lengthBeforeFeatures(){return this.lengthBeforeTree()+this.indexLength}buildFeatureClient(t){return new US(this.headerClient.httpClient,t)}async*readFeatureBatch(t,e){const[n]=t[0],[i,s]=t[t.length-1],a=n,A=i+s-a,f=this.buildFeatureClient(e);let m=A;for(const[_]of t)yield await this.readFeature(f,_,m),m=0;f.logUsage("feature")}async readFeature(t,e,n){const i=e+this.lengthBeforeFeatures();let s;{const m=await t.getRange(i,4,n,"feature length");s=new DataView(m).getUint32(0,!0)}const a=await t.getRange(i+4,s,n,"feature data"),o=new Uint8Array(a),A=new Uint8Array(s+Cu);A.set(o,Cu);const f=new Bu(A);return f.setPosition(Cu),Nc.getRootAsFeature(f)}}class US{constructor(t,e){if(this.bytesEverUsed=0,this.bytesEverFetched=0,this.buffer=new ArrayBuffer(0),this.head=0,typeof t=="string")this.httpClient=new RS(t,e);else if(t instanceof RS)this.httpClient=t;else throw new Error("Unknown source ")}async getRange(t,e,n,i){this.bytesEverUsed+=e;const s=t-this.head,a=s+e;if(s>=0&&a<=this.buffer.byteLength)return this.buffer.slice(s,a);const o=Math.max(e,n);return this.bytesEverFetched+=o,Us.debug(`requesting for new Range: ${t}-${t+o-1}`),this.buffer=await this.httpClient.getRange(t,o,i),this.head=t,this.buffer.slice(0,e)}logUsage(t){const e=t.split(" ")[0],n=this.bytesEverUsed,i=this.bytesEverFetched,s=(100*n/i).toFixed(2);Us.info(`${e} bytes used/requested: ${n} / ${i} = ${s}%`)}}class RS{constructor(t,e){this.requestsEverMade=0,this.bytesEverRequested=0,this.url=t,this.nocache=e}async getRange(t,e,n){this.requestsEverMade+=1,this.bytesEverRequested+=e;const i=`bytes=${t}-${t+e-1}`;Us.info(`request: #${this.requestsEverMade}, purpose: ${n}), bytes: (this_request: ${e}, ever: ${this.bytesEverRequested}), Range: ${i}`);const s={Range:i};return this.nocache&&(s["Cache-Control"]="no-cache, no-store"),(await fetch(this.url,{headers:s})).arrayBuffer()}}function A8(r,t,e){if(!r.subarray(0,3).every((m,_)=>SA[_]===m))throw new Error("Not a FlatGeobuf file");const n=new Bu(r),i=n.readUint32(SA.length);n.setPosition(SA.length+Cu);const s=fv(n);e&&e(s);let a=SA.length+Cu+i;const{indexNodeSize:o,featuresCount:A}=s;o>0&&(a+=vv(A,o));const f=[];for(;a<n.capacity();){const m=n.readUint32(a);n.setPosition(a+Cu);const _=Nc.getRootAsFeature(n);f.push(t(_,s)),a+=Cu+m}return f}async function*h8(r,t,e){const n=Yk(r),i=async x=>await n.slice(x);let s=new Uint8Array(await i(8));if(!s.subarray(0,3).every((x,B)=>SA[B]===x))throw new Error("Not a FlatGeobuf file");s=new Uint8Array(await i(4));let a=new Bu(s);const o=a.readUint32(0);s=new Uint8Array(await i(o)),a=new Bu(s);const A=fv(a);e&&e(A);const{indexNodeSize:f,featuresCount:m}=A;if(f>0){const x=vv(m,f);await i(x)}let _;for(;_=await f8(i,A,t);)yield _}function d8(r,t,e,n){try{let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;return async function*(){const s=await bv.open(r,i);Us.debug("opened reader"),n&&n(s.header);for await(const a of s.selectBbox(t))yield e(a,s.header)}()}catch(i){return Promise.reject(i)}}async function f8(r,t,e){let n=new Uint8Array(await r(4,"feature length"));if(n.byteLength===0)return;let i=new Bu(n);const s=i.readUint32(0);n=new Uint8Array(await r(s,"feature data"));const a=new Uint8Array(s+4);a.set(n,4),i=new Bu(a),i.setPosition(Cu);const o=Nc.getRootAsFeature(i);return e(o,t)}function p8(r,t){return{type:"FeatureCollection",features:A8(r,hv,t)}}function g8(r,t){return h8(r,hv,t)}function m8(r,t,e){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;return d8(r,t,hv,e,n)}function OS(r,t,e){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;return r instanceof Uint8Array?p8(r,e):r instanceof ReadableStream?g8(r,e):m8(r,t,e,n)}class y8{constructor(){this._bearing=0,this._pitch=60,this._minpitchzoom=null}onAdd(t){this._map=t;let e=this;return this._btn=document.createElement("button"),this._btn.className="maplibregl-ctrl-icon maplibregl-ctrl-pitchtoggle-3d",this._btn.id="bt3D",this._btn.type="button",this._btn["aria-label"]="Vista 3D",this._btn.onclick=function(){if(e._btn.className.indexOf("3d")!=-1){let f={pitch:e._pitch,bearing:e._bearing};e._minpitchzoom&&t.getZoom()>e._minpitchzoom&&(f.zoom=e._minpitchzoom);var n=0,i=38.5,s=6,a=62.33,{longitude:o,latitude:A}=t.getCenter();t.getZoom()<10?t.setTerrain({source:"terrainMapZen",exaggeration:1.5}):o>=n&&o<=s&&A>=i&&A<=a?t.setTerrain({source:"terrainICGC",exaggeration:1.2}):t.setTerrain({source:"terrainMapZen",exaggeration:1.5}),t.easeTo(f),e._btn.className="maplibregl-ctrl-icon maplibregl-ctrl-pitchtoggle-2d"}else t.setTerrain(null),t.easeTo({pitch:0,bearing:0}),e._btn.className="maplibregl-ctrl-icon maplibregl-ctrl-pitchtoggle-3d"},this._container=document.createElement("div"),this._container.className="maplibregl-ctrl maplibregl-ctrl-group",this._container.title="Vista 3D",this._container.appendChild(this._btn),this._container}onRemove(){this._container.parentNode.removeChild(this._container),this._map=void 0}}function Qp(r){"@babel/helpers - typeof";return Qp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Qp(r)}function _8(r,t){if(Qp(r)!="object"||!r)return r;var e=r[Symbol.toPrimitive];if(e!==void 0){var n=e.call(r,t||"default");if(Qp(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(r)}function v8(r){var t=_8(r,"string");return Qp(t)=="symbol"?t:String(t)}function $(r,t,e){return t=v8(t),t in r?Object.defineProperty(r,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):r[t]=e,r}function li(r,t){if(!r)throw new Error(t||"loader assertion failed.")}const l0=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),DS=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);DS&&parseFloat(DS[1]);const b8="3.4.14";function Nl(r,t){if(!r)throw new Error(t||"loaders.gl assertion failed.")}const wv={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document},w8=wv.global||wv.self||wv.window||{},Eu=typeof process!="object"||String(process)!=="[object process]"||process.browser,xv=typeof importScripts=="function",x8=typeof window<"u"&&typeof window.orientation<"u",NS=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);NS&&parseFloat(NS[1]);class B8{constructor(t,e){$(this,"name",void 0),$(this,"workerThread",void 0),$(this,"isRunning",!0),$(this,"result",void 0),$(this,"_resolve",()=>{}),$(this,"_reject",()=>{}),this.name=t,this.workerThread=e,this.result=new Promise((n,i)=>{this._resolve=n,this._reject=i})}postMessage(t,e){this.workerThread.postMessage({source:"loaders.gl",type:t,payload:e})}done(t){Nl(this.isRunning),this.isRunning=!1,this._resolve(t)}error(t){Nl(this.isRunning),this.isRunning=!1,this._reject(t)}}let Bv=class{terminate(){}};const Cv=new Map;function C8(r){Nl(r.source&&!r.url||!r.source&&r.url);let t=Cv.get(r.source||r.url);return t||(r.url&&(t=E8(r.url),Cv.set(r.url,t)),r.source&&(t=kS(r.source),Cv.set(r.source,t))),Nl(t),t}function E8(r){if(!r.startsWith("http"))return r;const t=S8(r);return kS(t)}function kS(r){const t=new Blob([r],{type:"application/javascript"});return URL.createObjectURL(t)}function S8(r){return`try {
  importScripts('`.concat(r,`');
} catch (error) {
  console.error(error);
  throw error;
}`)}function QS(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,e=arguments.length>2?arguments[2]:void 0;const n=e||new Set;if(r){if(HS(r))n.add(r);else if(HS(r.buffer))n.add(r.buffer);else if(!ArrayBuffer.isView(r)){if(t&&typeof r=="object")for(const i in r)QS(r[i],t,n)}}return e===void 0?Array.from(n):[]}function HS(r){return r?r instanceof ArrayBuffer||typeof MessagePort<"u"&&r instanceof MessagePort||typeof ImageBitmap<"u"&&r instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&r instanceof OffscreenCanvas:!1}const Ev=()=>{};class Sv{static isSupported(){return typeof Worker<"u"&&Eu||typeof Bv<"u"&&!Eu}constructor(t){$(this,"name",void 0),$(this,"source",void 0),$(this,"url",void 0),$(this,"terminated",!1),$(this,"worker",void 0),$(this,"onMessage",void 0),$(this,"onError",void 0),$(this,"_loadableURL","");const{name:e,source:n,url:i}=t;Nl(n||i),this.name=e,this.source=n,this.url=i,this.onMessage=Ev,this.onError=s=>console.log(s),this.worker=Eu?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=Ev,this.onError=Ev,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(t,e){e=e||QS(t),this.worker.postMessage(t,e)}_getErrorFromErrorEvent(t){let e="Failed to load ";return e+="worker ".concat(this.name," from ").concat(this.url,". "),t.message&&(e+="".concat(t.message," in ")),t.lineno&&(e+=":".concat(t.lineno,":").concat(t.colno)),new Error(e)}_createBrowserWorker(){this._loadableURL=C8({source:this.source,url:this.url});const t=new Worker(this._loadableURL,{name:this.name});return t.onmessage=e=>{e.data?this.onMessage(e.data):this.onError(new Error("No data received"))},t.onerror=e=>{this.onError(this._getErrorFromErrorEvent(e)),this.terminated=!0},t.onmessageerror=e=>console.error(e),t}_createNodeWorker(){let t;if(this.url){const n=this.url.includes(":/")||this.url.startsWith("/")?this.url:"./".concat(this.url);t=new Bv(n,{eval:!1})}else if(this.source)t=new Bv(this.source,{eval:!0});else throw new Error("no worker");return t.on("message",e=>{this.onMessage(e)}),t.on("error",e=>{this.onError(e)}),t.on("exit",e=>{}),t}}class T8{static isSupported(){return Sv.isSupported()}constructor(t){$(this,"name","unnamed"),$(this,"source",void 0),$(this,"url",void 0),$(this,"maxConcurrency",1),$(this,"maxMobileConcurrency",1),$(this,"onDebug",()=>{}),$(this,"reuseWorkers",!0),$(this,"props",{}),$(this,"jobQueue",[]),$(this,"idleQueue",[]),$(this,"count",0),$(this,"isDestroyed",!1),this.source=t.source,this.url=t.url,this.setProps(t)}destroy(){this.idleQueue.forEach(t=>t.destroy()),this.isDestroyed=!0}setProps(t){this.props={...this.props,...t},t.name!==void 0&&(this.name=t.name),t.maxConcurrency!==void 0&&(this.maxConcurrency=t.maxConcurrency),t.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=t.maxMobileConcurrency),t.reuseWorkers!==void 0&&(this.reuseWorkers=t.reuseWorkers),t.onDebug!==void 0&&(this.onDebug=t.onDebug)}async startJob(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:(s,a,o)=>s.done(o),n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:(s,a)=>s.error(a);const i=new Promise(s=>(this.jobQueue.push({name:t,onMessage:e,onError:n,onStart:s}),this));return this._startQueuedJob(),await i}async _startQueuedJob(){if(!this.jobQueue.length)return;const t=this._getAvailableWorker();if(!t)return;const e=this.jobQueue.shift();if(e){this.onDebug({message:"Starting job",name:e.name,workerThread:t,backlog:this.jobQueue.length});const n=new B8(e.name,t);t.onMessage=i=>e.onMessage(n,i.type,i.payload),t.onError=i=>e.onError(n,i),e.onStart(n);try{await n.result}finally{this.returnWorkerToQueue(t)}}}returnWorkerToQueue(t){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(t.destroy(),this.count--):this.idleQueue.push(t),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const t="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new Sv({name:t,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return x8?this.maxMobileConcurrency:this.maxConcurrency}}const I8={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class Su{static isSupported(){return Sv.isSupported()}static getWorkerFarm(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Su._workerFarm=Su._workerFarm||new Su({}),Su._workerFarm.setProps(t),Su._workerFarm}constructor(t){$(this,"props",void 0),$(this,"workerPools",new Map),this.props={...I8},this.setProps(t),this.workerPools=new Map}destroy(){for(const t of this.workerPools.values())t.destroy();this.workerPools=new Map}setProps(t){this.props={...this.props,...t};for(const e of this.workerPools.values())e.setProps(this._getWorkerPoolProps())}getWorkerPool(t){const{name:e,source:n,url:i}=t;let s=this.workerPools.get(e);return s||(s=new T8({name:e,source:n,url:i}),s.setProps(this._getWorkerPoolProps()),this.workerPools.set(e,s)),s}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}$(Su,"_workerFarm",void 0);const L8="latest";function F8(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const e=t[r.id]||{},n="".concat(r.id,"-worker.js");let i=e.workerUrl;if(!i&&r.id==="compression"&&(i=t.workerUrl),t._workerType==="test"&&(i="modules/".concat(r.module,"/dist/").concat(n)),!i){let s=r.version;s==="latest"&&(s=L8);const a=s?"@".concat(s):"";i="https://unpkg.com/@loaders.gl/".concat(r.module).concat(a,"/dist/").concat(n)}return Nl(i),i}function P8(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:b8;Nl(r,"no worker provided");const e=r.version;return!(!t||!e)}const M8=null,U8=null,Tv=null,zS=null,R8=Object.freeze(Object.defineProperty({__proto__:null,readFileAsArrayBuffer:M8,readFileAsText:U8,requireFromFile:Tv,requireFromString:zS},Symbol.toStringTag,{value:"Module"})),O8="3.4.14",Iv={};async function Ph(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return t&&(r=D8(r,t,e)),Iv[r]=Iv[r]||N8(r),await Iv[r]}function D8(r,t,e){if(r.startsWith("http"))return r;const n=e.modules||{};return n[r]?n[r]:Eu?e.CDN?(Nl(e.CDN.startsWith("http")),"".concat(e.CDN,"/").concat(t,"@").concat(O8,"/dist/libs/").concat(r)):xv?"../src/libs/".concat(r):"modules/".concat(t,"/src/libs/").concat(r):"modules/".concat(t,"/dist/libs/").concat(r)}async function N8(r){if(r.endsWith("wasm"))return await(await fetch(r)).arrayBuffer();if(!Eu)try{return R8&&Tv&&await Tv(r)}catch{return null}if(xv)return importScripts(r);const e=await(await fetch(r)).text();return k8(e,r)}function k8(r,t){if(!Eu)return zS;if(xv)return eval.call(w8,r),null;const e=document.createElement("script");e.id=t;try{e.appendChild(document.createTextNode(r))}catch{e.text=r}return document.body.appendChild(e),null}function Q8(r,t){return!Su.isSupported()||!Eu&&!(t!=null&&t._nodeWorkers)?!1:r.worker&&(t==null?void 0:t.worker)}async function H8(r,t,e,n,i){const s=r.id,a=F8(r,e),A=Su.getWorkerFarm(e).getWorkerPool({name:s,url:a});e=JSON.parse(JSON.stringify(e)),n=JSON.parse(JSON.stringify(n||{}));const f=await A.startJob("process-on-worker",z8.bind(null,i));return f.postMessage("process",{input:t,options:e,context:n}),await(await f.result).result}async function z8(r,t,e,n){switch(e){case"done":t.done(n);break;case"error":t.error(new Error(n.error));break;case"process":const{id:i,input:s,options:a}=n;try{const o=await r(s,a);t.postMessage("done",{id:i,result:o})}catch(o){const A=o instanceof Error?o.message:"unknown error";t.postMessage("error",{id:i,error:A})}break;default:console.warn("parse-with-worker unknown message ".concat(e))}}function G8(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof r=="string"?r.slice(0,t):ArrayBuffer.isView(r)?GS(r.buffer,r.byteOffset,t):r instanceof ArrayBuffer?GS(r,0,t):""}function GS(r,t,e){if(r.byteLength<=t+e)return"";const n=new DataView(r);let i="";for(let s=0;s<e;s++)i+=String.fromCharCode(n.getUint8(t+s));return i}function V8(r){try{return JSON.parse(r)}catch{throw new Error('Failed to parse JSON from data starting with "'.concat(G8(r),'"'))}}function j8(r,t,e){if(e=e||r.byteLength,r.byteLength<e||t.byteLength<e)return!1;const n=new Uint8Array(r),i=new Uint8Array(t);for(let s=0;s<n.length;++s)if(n[s]!==i[s])return!1;return!0}function q8(){for(var r=arguments.length,t=new Array(r),e=0;e<r;e++)t[e]=arguments[e];const n=t.map(o=>o instanceof ArrayBuffer?new Uint8Array(o):o),i=n.reduce((o,A)=>o+A.byteLength,0),s=new Uint8Array(i);let a=0;for(const o of n)s.set(o,a),a+=o.byteLength;return s.buffer}function Lv(r,t,e){const n=e!==void 0?new Uint8Array(r).subarray(t,t+e):new Uint8Array(r).subarray(t);return new Uint8Array(n).buffer}function Hp(r,t){return li(r>=0),li(t>0),r+(t-1)&~(t-1)}function K8(r,t,e){let n;if(r instanceof ArrayBuffer)n=new Uint8Array(r);else{const i=r.byteOffset,s=r.byteLength;n=new Uint8Array(r.buffer||r.arrayBuffer,i,s)}return t.set(n,e),e+Hp(n.byteLength,4)}async function $8(r){const t=[];for await(const e of r)t.push(e);return q8(...t)}function VS(){let r;if(typeof window<"u"&&window.performance)r=window.performance.now();else if(typeof process<"u"&&process.hrtime){const t=process.hrtime();r=t[0]*1e3+t[1]/1e6}else r=Date.now();return r}let jS=class{constructor(t,e){this.name=void 0,this.type=void 0,this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=t,this.type=e,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(t){return this.sampleSize=t,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(t){return this._count+=t,this._samples++,this._checkSampling(),this}subtractCount(t){return this._count-=t,this._samples++,this._checkSampling(),this}addTime(t){return this._time+=t,this.lastTiming=t,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=VS(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(VS()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}},W8=class{constructor(t){this.id=void 0,this.stats={},this.id=t.id,this.stats={},this._initializeStats(t.stats),Object.seal(this)}get(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:t,type:e})}get size(){return Object.keys(this.stats).length}reset(){for(const t of Object.values(this.stats))t.reset();return this}forEach(t){for(const e of Object.values(this.stats))t(e)}getTable(){const t={};return this.forEach(e=>{t[e.name]={time:e.time||0,count:e.count||0,average:e.getAverageTime()||0,hz:e.getHz()||0}}),t}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(e=>this._getOrCreate(e))}_getOrCreate(t){const{name:e,type:n}=t;let i=this.stats[e];return i||(t instanceof jS?i=t:i=new jS(e,n),this.stats[e]=i),i}};const X8="Queued Requests",J8="Active Requests",Y8="Cancelled Requests",Z8="Queued Requests Ever",tQ="Active Requests Ever",eQ={id:"request-scheduler",throttleRequests:!0,maxRequests:6};class rQ{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};$(this,"props",void 0),$(this,"stats",void 0),$(this,"activeRequestCount",0),$(this,"requestQueue",[]),$(this,"requestMap",new Map),$(this,"deferredUpdate",null),this.props={...eQ,...t},this.stats=new W8({id:this.props.id}),this.stats.get(X8),this.stats.get(J8),this.stats.get(Y8),this.stats.get(Z8),this.stats.get(tQ)}scheduleRequest(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:()=>0;if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(t))return this.requestMap.get(t);const n={handle:t,priority:0,getPriority:e},i=new Promise(s=>(n.resolve=s,n));return this.requestQueue.push(n),this.requestMap.set(t,i),this._issueNewRequests(),i}_issueRequest(t){const{handle:e,resolve:n}=t;let i=!1;const s=()=>{i||(i=!0,this.requestMap.delete(e),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,n?n({done:s}):Promise.resolve({done:s})}_issueNewRequests(){this.deferredUpdate||(this.deferredUpdate=setTimeout(()=>this._issueNewRequestsAsync(),0))}_issueNewRequestsAsync(){this.deferredUpdate=null;const t=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(t!==0){this._updateAllRequests();for(let e=0;e<t;++e){const n=this.requestQueue.shift();n&&this._issueRequest(n)}}}_updateAllRequests(){const t=this.requestQueue;for(let e=0;e<t.length;++e){const n=t[e];this._updateRequest(n)||(t.splice(e,1),this.requestMap.delete(n.handle),e--)}t.sort((e,n)=>e.priority-n.priority)}_updateRequest(t){return t.priority=t.getPriority(t.handle),t.priority<0?(t.resolve(null),!1):!0}}let nQ="";const qS={};function iQ(r){for(const t in qS)if(r.startsWith(t)){const e=qS[t];r=r.replace(t,e)}return!r.startsWith("http://")&&!r.startsWith("https://")&&(r="".concat(nQ).concat(r)),r}function e2t(r){return r}function sQ(r){return r&&typeof r=="object"&&r.isBuffer}function KS(r){if(sQ(r))return r;if(r instanceof ArrayBuffer)return r;if(ArrayBuffer.isView(r))return r.byteOffset===0&&r.byteLength===r.buffer.byteLength?r.buffer:r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength);if(typeof r=="string"){const t=r;return new TextEncoder().encode(t).buffer}if(r&&typeof r=="object"&&r._toArrayBuffer)return r._toArrayBuffer();throw new Error("toArrayBuffer")}function $S(r){const t=r?r.lastIndexOf("/"):-1;return t>=0?r.substr(t+1):""}function Fv(r){const t=r?r.lastIndexOf("/"):-1;return t>=0?r.substr(0,t):""}const oQ=r=>typeof r=="boolean",zp=r=>typeof r=="function",Gp=r=>r!==null&&typeof r=="object",WS=r=>Gp(r)&&r.constructor==={}.constructor,aQ=r=>r&&typeof r[Symbol.iterator]=="function",cQ=r=>r&&typeof r[Symbol.asyncIterator]=="function",Mh=r=>typeof Response<"u"&&r instanceof Response||r&&r.arrayBuffer&&r.text&&r.json,Uh=r=>typeof Blob<"u"&&r instanceof Blob,lQ=r=>r&&typeof r=="object"&&r.isBuffer,uQ=r=>typeof ReadableStream<"u"&&r instanceof ReadableStream||Gp(r)&&zp(r.tee)&&zp(r.cancel)&&zp(r.getReader),AQ=r=>Gp(r)&&zp(r.read)&&zp(r.pipe)&&oQ(r.readable),XS=r=>uQ(r)||AQ(r),hQ=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,dQ=/^([-\w.]+\/[-\w.+]+)/;function fQ(r){const t=dQ.exec(r);return t?t[1]:r}function JS(r){const t=hQ.exec(r);return t?t[1]:""}const YS=/\?.*/;function pQ(r){const t=r.match(YS);return t&&t[0]}function Pv(r){return r.replace(YS,"")}function u0(r){return Mh(r)?r.url:Uh(r)?r.name||"":typeof r=="string"?r:""}function Mv(r){if(Mh(r)){const t=r,e=t.headers.get("content-type")||"",n=Pv(t.url);return fQ(e)||JS(n)}return Uh(r)?r.type||"":typeof r=="string"?JS(r):""}function gQ(r){return Mh(r)?r.headers["content-length"]||-1:Uh(r)?r.size:typeof r=="string"?r.length:r instanceof ArrayBuffer||ArrayBuffer.isView(r)?r.byteLength:-1}async function ZS(r){if(Mh(r))return r;const t={},e=gQ(r);e>=0&&(t["content-length"]=String(e));const n=u0(r),i=Mv(r);i&&(t["content-type"]=i);const s=await _Q(r);s&&(t["x-first-bytes"]=s),typeof r=="string"&&(r=new TextEncoder().encode(r));const a=new Response(r,{headers:t});return Object.defineProperty(a,"url",{value:n}),a}async function mQ(r){if(!r.ok){const t=await yQ(r);throw new Error(t)}}async function yQ(r){let t="Failed to fetch resource ".concat(r.url," (").concat(r.status,"): ");try{const e=r.headers.get("Content-Type");let n=r.statusText;e.includes("application/json")&&(n+=" ".concat(await r.text())),t+=n,t=t.length>60?"".concat(t.slice(0,60),"..."):t}catch{}return t}async function _Q(r){if(typeof r=="string")return"data:,".concat(r.slice(0,5));if(r instanceof Blob){const e=r.slice(0,5);return await new Promise(n=>{const i=new FileReader;i.onload=s=>{var a;return n(s==null||(a=s.target)===null||a===void 0?void 0:a.result)},i.readAsDataURL(e)})}if(r instanceof ArrayBuffer){const e=r.slice(0,5),n=vQ(e);return"data:base64,".concat(n)}return null}function vQ(r){let t="";const e=new Uint8Array(r);for(let n=0;n<e.byteLength;n++)t+=String.fromCharCode(e[n]);return btoa(t)}async function tT(r,t){if(typeof r=="string"){r=iQ(r);let e=t;return t!=null&&t.fetch&&typeof(t==null?void 0:t.fetch)!="function"&&(e=t.fetch),await fetch(r,e)}return await ZS(r)}function bQ(r){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron)return!0;const t=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,e=r||t;return!!(e&&e.indexOf("Electron")>=0)}function Vp(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||bQ()}const A0=globalThis.window||globalThis.self||globalThis.global,jp=globalThis.process||{},eT=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";Vp();function wQ(r){try{const t=window[r],e="__storage_test__";return t.setItem(e,e),t.removeItem(e),t}catch{return null}}let xQ=class{constructor(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";this.storage=void 0,this.id=void 0,this.config=void 0,this.storage=wQ(n),this.id=t,this.config=e,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(t){if(Object.assign(this.config,t),this.storage){const e=JSON.stringify(this.config);this.storage.setItem(this.id,e)}}_loadConfiguration(){let t={};if(this.storage){const e=this.storage.getItem(this.id);t=e?JSON.parse(e):{}}return Object.assign(this.config,t),this}};function BQ(r){let t;return r<10?t=`${r.toFixed(2)}ms`:r<100?t=`${r.toFixed(1)}ms`:r<1e3?t=`${r.toFixed(0)}ms`:t=`${(r/1e3).toFixed(2)}s`,t}function CQ(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const e=Math.max(t-r.length,0);return`${" ".repeat(e)}${r}`}function Uv(r,t,e){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const i=r.src.replace(/\(/g,"%28").replace(/\)/g,"%29");r.width>n&&(e=Math.min(e,n/r.width));const s=r.width*e,a=r.height*e,o=["font-size:1px;",`padding:${Math.floor(a/2)}px ${Math.floor(s/2)}px;`,`line-height:${a}px;`,`background:url(${i});`,`background-size:${s}px ${a}px;`,"color:transparent;"].join("");return[`${t} %c+`,o]}let h0;(function(r){r[r.BLACK=30]="BLACK",r[r.RED=31]="RED",r[r.GREEN=32]="GREEN",r[r.YELLOW=33]="YELLOW",r[r.BLUE=34]="BLUE",r[r.MAGENTA=35]="MAGENTA",r[r.CYAN=36]="CYAN",r[r.WHITE=37]="WHITE",r[r.BRIGHT_BLACK=90]="BRIGHT_BLACK",r[r.BRIGHT_RED=91]="BRIGHT_RED",r[r.BRIGHT_GREEN=92]="BRIGHT_GREEN",r[r.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",r[r.BRIGHT_BLUE=94]="BRIGHT_BLUE",r[r.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",r[r.BRIGHT_CYAN=96]="BRIGHT_CYAN",r[r.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(h0||(h0={}));const EQ=10;function rT(r){return typeof r!="string"?r:(r=r.toUpperCase(),h0[r]||h0.WHITE)}function SQ(r,t,e){return!Vp&&typeof r=="string"&&(t&&(r=`\x1B[${rT(t)}m${r}\x1B[39m`),e&&(r=`\x1B[${rT(e)+EQ}m${r}\x1B[49m`)),r}function TQ(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const e=Object.getPrototypeOf(r),n=Object.getOwnPropertyNames(e),i=r;for(const s of n){const a=i[s];typeof a=="function"&&(t.find(o=>s===o)||(i[s]=a.bind(r)))}}function d0(r,t){if(!r)throw new Error(t||"Assertion failed")}function Gd(){let r;if(Vp()&&A0.performance){var t,e;r=A0==null||(t=A0.performance)===null||t===void 0||(e=t.now)===null||e===void 0?void 0:e.call(t)}else if("hrtime"in jp){var n;const i=jp==null||(n=jp.hrtime)===null||n===void 0?void 0:n.call(jp);r=i[0]*1e3+i[1]/1e6}else r=Date.now();return r}const Vd={debug:Vp()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},IQ={enabled:!0,level:0};function rc(){}const nT={},iT={once:!0};let Rv=class{constructor(){let{id:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};this.id=void 0,this.VERSION=eT,this._startTs=Gd(),this._deltaTs=Gd(),this._storage=void 0,this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=t,this.userData={},this._storage=new xQ(`__probe-${this.id}__`,IQ),this.timeStamp(`${this.id} started`),TQ(this),Object.seal(this)}set level(t){this.setLevel(t)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Gd()-this._startTs).toPrecision(10))}getDelta(){return Number((Gd()-this._deltaTs).toPrecision(10))}set priority(t){this.level=t}get priority(){return this.level}getPriority(){return this.level}enable(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.setConfiguration({enabled:t}),this}setLevel(t){return this._storage.setConfiguration({level:t}),this}get(t){return this._storage.config[t]}set(t,e){this._storage.setConfiguration({[t]:e})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(t,e){d0(t,e)}warn(t){return this._getLogFunction(0,t,Vd.warn,arguments,iT)}error(t){return this._getLogFunction(0,t,Vd.error,arguments)}deprecated(t,e){return this.warn(`\`${t}\` is deprecated and will be removed in a later version. Use \`${e}\` instead`)}removed(t,e){return this.error(`\`${t}\` has been removed. Use \`${e}\` instead`)}probe(t,e){return this._getLogFunction(t,e,Vd.log,arguments,{time:!0,once:!0})}log(t,e){return this._getLogFunction(t,e,Vd.debug,arguments)}info(t,e){return this._getLogFunction(t,e,console.info,arguments)}once(t,e){return this._getLogFunction(t,e,Vd.debug||Vd.info,arguments,iT)}table(t,e,n){return e?this._getLogFunction(t,e,console.table||rc,n&&[n],{tag:MQ(e)}):rc}image(t){let{logLevel:e,priority:n,image:i,message:s="",scale:a=1}=t;return this._shouldLog(e||n)?Vp()?PQ({image:i,message:s,scale:a}):FQ():rc}time(t,e){return this._getLogFunction(t,e,console.time?console.time:console.info)}timeEnd(t,e){return this._getLogFunction(t,e,console.timeEnd?console.timeEnd:console.info)}timeStamp(t,e){return this._getLogFunction(t,e,console.timeStamp||rc)}group(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const i=oT({logLevel:t,message:e,opts:n}),{collapsed:s}=n;return i.method=(s?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(t,e,Object.assign({},n,{collapsed:!0}))}groupEnd(t){return this._getLogFunction(t,"",console.groupEnd||rc)}withGroup(t,e,n){this.group(t,e)();try{n()}finally{this.groupEnd(t)()}}trace(){console.trace&&console.trace()}_shouldLog(t){return this.isEnabled()&&this.getLevel()>=sT(t)}_getLogFunction(t,e,n,i,s){if(this._shouldLog(t)){s=oT({logLevel:t,message:e,args:i,opts:s}),n=n||s.method,d0(n),s.total=this.getTotal(),s.delta=this.getDelta(),this._deltaTs=Gd();const a=s.tag||s.message;if(s.once&&a)if(!nT[a])nT[a]=Gd();else return rc;return e=LQ(this.id,s.message,s),n.bind(console,e,...s.args)}return rc}};Rv.VERSION=eT;function sT(r){if(!r)return 0;let t;switch(typeof r){case"number":t=r;break;case"object":t=r.logLevel||r.priority||0;break;default:return 0}return d0(Number.isFinite(t)&&t>=0),t}function oT(r){const{logLevel:t,message:e}=r;r.logLevel=sT(t);const n=r.args?Array.from(r.args):[];for(;n.length&&n.shift()!==e;);switch(typeof t){case"string":case"function":e!==void 0&&n.unshift(e),r.message=t;break;case"object":Object.assign(r,t);break}typeof r.message=="function"&&(r.message=r.message());const i=typeof r.message;return d0(i==="string"||i==="object"),Object.assign(r,{args:n},r.opts)}function LQ(r,t,e){if(typeof t=="string"){const n=e.time?CQ(BQ(e.total)):"";t=e.time?`${r}: ${n}  ${t}`:`${r}: ${t}`,t=SQ(t,e.color,e.background)}return t}function FQ(r){return console.warn("removed"),rc}function PQ(r){let{image:t,message:e="",scale:n=1}=r;if(typeof t=="string"){const s=new Image;return s.onload=()=>{const a=Uv(s,e,n);console.log(...a)},s.src=t,rc}const i=t.nodeName||"";if(i.toLowerCase()==="img")return console.log(...Uv(t,e,n)),rc;if(i.toLowerCase()==="canvas"){const s=new Image;return s.onload=()=>console.log(...Uv(s,e,n)),s.src=t.toDataURL(),rc}return rc}function MQ(r){for(const t in r)for(const e in r[t])return e||"untitled";return"empty"}const aT=new Rv({id:"loaders.gl"});class UQ{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class RQ{constructor(){$(this,"console",void 0),this.console=console}log(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.console.log.bind(this.console,...e)}info(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.console.info.bind(this.console,...e)}warn(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.console.warn.bind(this.console,...e)}error(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.console.error.bind(this.console,...e)}}const cT={fetch:null,mimeType:void 0,nothrow:!1,log:new RQ,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:l0,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},OQ={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function lT(){globalThis.loaders=globalThis.loaders||{};const{loaders:r}=globalThis;return r._state=r._state||{},r._state}const uT=()=>{const r=lT();return r.globalOptions=r.globalOptions||{...cT},r.globalOptions};function DQ(r,t,e,n){return e=e||[],e=Array.isArray(e)?e:[e],NQ(r,e),QQ(t,r,n)}function NQ(r,t){AT(r,null,cT,OQ,t);for(const e of t){const n=r&&r[e.id]||{},i=e.options&&e.options[e.id]||{},s=e.deprecatedOptions&&e.deprecatedOptions[e.id]||{};AT(n,e.id,i,s,t)}}function AT(r,t,e,n,i){const s=t||"Top level",a=t?"".concat(t,"."):"";for(const o in r){const A=!t&&Gp(r[o]),f=o==="baseUri"&&!t,m=o==="workerUrl"&&t;if(!(o in e)&&!f&&!m){if(o in n)aT.warn("".concat(s," loader option '").concat(a).concat(o,"' no longer supported, use '").concat(n[o],"'"))();else if(!A){const _=kQ(o,i);aT.warn("".concat(s," loader option '").concat(a).concat(o,"' not recognized. ").concat(_))()}}}}function kQ(r,t){const e=r.toLowerCase();let n="";for(const i of t)for(const s in i.options){if(r===s)return"Did you mean '".concat(i.id,".").concat(s,"'?");const a=s.toLowerCase();(e.startsWith(a)||a.startsWith(e))&&(n=n||"Did you mean '".concat(i.id,".").concat(s,"'?"))}return n}function QQ(r,t,e){const i={...r.options||{}};return HQ(i,e),i.log===null&&(i.log=new UQ),hT(i,uT()),hT(i,t),i}function hT(r,t){for(const e in t)if(e in t){const n=t[e];WS(n)&&WS(r[e])?r[e]={...r[e],...t[e]}:r[e]=t[e]}}function HQ(r,t){t&&!("baseUri"in r)&&(r.baseUri=t)}function Ov(r){var t;return r?(Array.isArray(r)&&(r=r[0]),Array.isArray((t=r)===null||t===void 0?void 0:t.extensions)):!1}function Dv(r){var t,e;li(r,"null loader"),li(Ov(r),"invalid loader");let n;return Array.isArray(r)&&(n=r[1],r=r[0],r={...r,options:{...r.options,...n}}),((t=r)!==null&&t!==void 0&&t.parseTextSync||(e=r)!==null&&e!==void 0&&e.parseText)&&(r.text=!0),r.text||(r.binary=!0),r}const dT=()=>{const r=lT();return r.loaderRegistry=r.loaderRegistry||[],r.loaderRegistry};function zQ(r){const t=dT();r=Array.isArray(r)?r:[r];for(const e of r){const n=Dv(e);t.find(i=>n===i)||t.unshift(n)}}function GQ(){return dT()}const VQ=new Rv({id:"loaders.gl"}),jQ=/\.([^.]+)$/;async function qQ(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],e=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;if(!pT(r))return null;let i=fT(r,t,{...e,nothrow:!0},n);if(i)return i;if(Uh(r)&&(r=await r.slice(0,10).arrayBuffer(),i=fT(r,t,e,n)),!i&&!(e!=null&&e.nothrow))throw new Error(gT(r));return i}function fT(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],e=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;if(!pT(r))return null;if(t&&!Array.isArray(t))return Dv(t);let i=[];t&&(i=i.concat(t)),e!=null&&e.ignoreRegisteredLoaders||i.push(...GQ()),$Q(i);const s=KQ(r,i,e,n);if(!s&&!(e!=null&&e.nothrow))throw new Error(gT(r));return s}function KQ(r,t,e,n){const i=u0(r),s=Mv(r),a=Pv(i)||(n==null?void 0:n.url);let o=null,A="";if(e!=null&&e.mimeType&&(o=Nv(t,e==null?void 0:e.mimeType),A="match forced by supplied MIME type ".concat(e==null?void 0:e.mimeType)),o=o||WQ(t,a),A=A||(o?"matched url ".concat(a):""),o=o||Nv(t,s),A=A||(o?"matched MIME type ".concat(s):""),o=o||JQ(t,r),A=A||(o?"matched initial data ".concat(yT(r)):""),o=o||Nv(t,e==null?void 0:e.fallbackMimeType),A=A||(o?"matched fallback MIME type ".concat(s):""),A){var f;VQ.log(1,"selectLoader selected ".concat((f=o)===null||f===void 0?void 0:f.name,": ").concat(A,"."))}return o}function pT(r){return!(r instanceof Response&&r.status===204)}function gT(r){const t=u0(r),e=Mv(r);let n="No valid loader found (";n+=t?"".concat($S(t),", "):"no url provided, ",n+="MIME type: ".concat(e?'"'.concat(e,'"'):"not provided",", ");const i=r?yT(r):"";return n+=i?' first bytes: "'.concat(i,'"'):"first bytes: not available",n+=")",n}function $Q(r){for(const t of r)Dv(t)}function WQ(r,t){const e=t&&jQ.exec(t),n=e&&e[1];return n?XQ(r,n):null}function XQ(r,t){t=t.toLowerCase();for(const e of r)for(const n of e.extensions)if(n.toLowerCase()===t)return e;return null}function Nv(r,t){for(const e of r)if(e.mimeTypes&&e.mimeTypes.includes(t)||t==="application/x.".concat(e.id))return e;return null}function JQ(r,t){if(!t)return null;for(const e of r)if(typeof t=="string"){if(YQ(t,e))return e}else if(ArrayBuffer.isView(t)){if(mT(t.buffer,t.byteOffset,e))return e}else if(t instanceof ArrayBuffer&&mT(t,0,e))return e;return null}function YQ(r,t){return t.testText?t.testText(r):(Array.isArray(t.tests)?t.tests:[t.tests]).some(n=>r.startsWith(n))}function mT(r,t,e){return(Array.isArray(e.tests)?e.tests:[e.tests]).some(i=>ZQ(r,t,e,i))}function ZQ(r,t,e,n){if(n instanceof ArrayBuffer)return j8(n,r,n.byteLength);switch(typeof n){case"function":return n(r,e);case"string":const i=kv(r,t,n.length);return n===i;default:return!1}}function yT(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof r=="string"?r.slice(0,t):ArrayBuffer.isView(r)?kv(r.buffer,r.byteOffset,t):r instanceof ArrayBuffer?kv(r,0,t):""}function kv(r,t,e){if(r.byteLength<t+e)return"";const n=new DataView(r);let i="";for(let s=0;s<e;s++)i+=String.fromCharCode(n.getUint8(t+s));return i}const tH=256*1024;function*eH(r,t){const e=(t==null?void 0:t.chunkSize)||tH;let n=0;const i=new TextEncoder;for(;n<r.length;){const s=Math.min(r.length-n,e),a=r.slice(n,n+s);n+=s,yield i.encode(a)}}const rH=256*1024;function nH(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){const{chunkSize:e=rH}=t;let n=0;for(;n<r.byteLength;){const i=Math.min(r.byteLength-n,e),s=new ArrayBuffer(i),a=new Uint8Array(r,n,i);new Uint8Array(s).set(a),n+=i,yield s}}()}const iH=1024*1024;async function*sH(r,t){const e=(t==null?void 0:t.chunkSize)||iH;let n=0;for(;n<r.size;){const i=n+e,s=await r.slice(n,i).arrayBuffer();n=i,yield s}}function _T(r,t){return l0?oH(r,t):aH(r)}async function*oH(r,t){const e=r.getReader();let n;try{for(;;){const i=n||e.read();t!=null&&t._streamReadAhead&&(n=e.read());const{done:s,value:a}=await i;if(s)return;yield KS(a)}}catch{e.releaseLock()}}async function*aH(r,t){for await(const e of r)yield KS(e)}function cH(r,t){if(typeof r=="string")return eH(r,t);if(r instanceof ArrayBuffer)return nH(r,t);if(Uh(r))return sH(r,t);if(XS(r))return _T(r,t);if(Mh(r))return _T(r.body,t);throw new Error("makeIterator")}const vT="Cannot convert supplied data type";function lH(r,t,e){if(t.text&&typeof r=="string")return r;if(lQ(r)&&(r=r.buffer),r instanceof ArrayBuffer){const n=r;return t.text&&!t.binary?new TextDecoder("utf8").decode(n):n}if(ArrayBuffer.isView(r)){if(t.text&&!t.binary)return new TextDecoder("utf8").decode(r);let n=r.buffer;const i=r.byteLength||r.length;return(r.byteOffset!==0||i!==n.byteLength)&&(n=n.slice(r.byteOffset,r.byteOffset+i)),n}throw new Error(vT)}async function uH(r,t,e){const n=r instanceof ArrayBuffer||ArrayBuffer.isView(r);if(typeof r=="string"||n)return lH(r,t);if(Uh(r)&&(r=await ZS(r)),Mh(r)){const i=r;return await mQ(i),t.binary?await i.arrayBuffer():await i.text()}if(XS(r)&&(r=cH(r,e)),aQ(r)||cQ(r))return $8(r);throw new Error(vT)}function bT(r,t){const e=uT(),n=r||e;return typeof n.fetch=="function"?n.fetch:Gp(n.fetch)?i=>tT(i,n):t!=null&&t.fetch?t==null?void 0:t.fetch:tT}function AH(r,t,e){if(e)return e;const n={fetch:bT(t,r),...r};if(n.url){const i=Pv(n.url);n.baseUrl=i,n.queryString=pQ(n.url),n.filename=$S(i),n.baseUrl=Fv(i)}return Array.isArray(n.loaders)||(n.loaders=null),n}function hH(r,t){if(!t&&r&&!Array.isArray(r))return r;let e;if(r&&(e=Array.isArray(r)?r:[r]),t&&t.loaders){const n=Array.isArray(t.loaders)?t.loaders:[t.loaders];e=e?[...e,...n]:n}return e&&e.length?e:null}async function Qv(r,t,e,n){Nl(!n||typeof n=="object"),t&&!Array.isArray(t)&&!Ov(t)&&(n=void 0,e=t,t=void 0),r=await r,e=e||{};const i=u0(r),a=hH(t,n),o=await qQ(r,a,e);return o?(e=DQ(e,o,a,i),n=AH({url:i,parse:Qv,loaders:a},e,n||null),await dH(o,r,e,n)):null}async function dH(r,t,e,n){if(P8(r),Mh(t)){const i=t,{ok:s,redirected:a,status:o,statusText:A,type:f,url:m}=i,_=Object.fromEntries(i.headers.entries());n.response={headers:_,ok:s,redirected:a,status:o,statusText:A,type:f,url:m}}if(t=await uH(t,r,e),r.parseTextSync&&typeof t=="string")return e.dataType="text",r.parseTextSync(t,e,n,r);if(Q8(r,e))return await H8(r,t,e,n,Qv);if(r.parseText&&typeof t=="string")return await r.parseText(t,e,n,r);if(r.parse)return await r.parse(t,e,n,r);throw Nl(!r.parseSync),new Error("".concat(r.id," loader - no parser found and worker is disabled"))}async function TA(r,t,e,n){!Array.isArray(t)&&!Ov(t)&&(e=t,t=void 0);const i=bT(e);let s=r;return typeof r=="string"&&(s=await i(r)),Uh(r)&&(s=await i(r)),await Qv(s,t,e)}const fH="3.4.14",{_parseImageNode:pH}=globalThis,Hv=typeof Image<"u",zv=typeof ImageBitmap<"u",Gv=l0?!0:!!pH;function gH(r){switch(r){case"auto":return zv||Hv||Gv;case"imagebitmap":return zv;case"image":return Hv;case"data":return Gv;default:throw new Error("@loaders.gl/images: image ".concat(r," not supported in this environment"))}}function mH(){if(zv)return"imagebitmap";if(Hv)return"image";if(Gv)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function yH(r){const t=vH(r);if(!t)throw new Error("Not an image");return t}function _H(r){switch(yH(r)){case"data":return r;case"image":case"imagebitmap":const t=document.createElement("canvas"),e=t.getContext("2d");if(!e)throw new Error("getImageData");return t.width=r.width,t.height=r.height,e.drawImage(r,0,0),e.getImageData(0,0,r.width,r.height);default:throw new Error("getImageData")}}function vH(r){return typeof ImageBitmap<"u"&&r instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&r instanceof Image?"image":r&&typeof r=="object"&&r.data&&r.width&&r.height?"data":null}const bH=/^data:image\/svg\+xml/,wH=/\.svg((\?|#).*)?$/;function Vv(r){return r&&(bH.test(r)||wH.test(r))}function xH(r,t){if(Vv(t)){let n=new TextDecoder().decode(r);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(n=unescape(encodeURIComponent(n)))}catch(s){throw new Error(s.message)}return"data:image/svg+xml;base64,".concat(btoa(n))}return wT(r,t)}function wT(r,t){if(Vv(t))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(r)])}async function xT(r,t,e){const n=xH(r,e),i=self.URL||self.webkitURL,s=typeof n!="string"&&i.createObjectURL(n);try{return await BH(s||n,t)}finally{s&&i.revokeObjectURL(s)}}async function BH(r,t){const e=new Image;return e.src=r,t.image&&t.image.decode&&e.decode?(await e.decode(),e):await new Promise((n,i)=>{try{e.onload=()=>n(e),e.onerror=s=>i(new Error("Could not load image ".concat(r,": ").concat(s)))}catch(s){i(s)}})}const CH={};let BT=!0;async function EH(r,t,e){let n;Vv(e)?n=await xT(r,t,e):n=wT(r,e);const i=t&&t.imagebitmap;return await SH(n,i)}async function SH(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if((TH(t)||!BT)&&(t=null),t)try{return await createImageBitmap(r,t)}catch(e){console.warn(e),BT=!1}return await createImageBitmap(r)}function TH(r){for(const t in r||CH)return!1;return!0}function IH(r){return!MH(r,"ftyp",4)||!(r[8]&96)?null:LH(r)}function LH(r){switch(FH(r,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function FH(r,t,e){return String.fromCharCode(...r.slice(t,e))}function PH(r){return[...r].map(t=>t.charCodeAt(0))}function MH(r,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const n=PH(t);for(let i=0;i<n.length;++i)if(n[i]!==r[i+e])return!1;return!0}const kl=!1,qp=!0;function jv(r){const t=Kp(r);return RH(t)||NH(t)||OH(t)||DH(t)||UH(t)}function UH(r){const t=new Uint8Array(r instanceof DataView?r.buffer:r),e=IH(t);return e?{mimeType:e.mimeType,width:0,height:0}:null}function RH(r){const t=Kp(r);return t.byteLength>=24&&t.getUint32(0,kl)===2303741511?{mimeType:"image/png",width:t.getUint32(16,kl),height:t.getUint32(20,kl)}:null}function OH(r){const t=Kp(r);return t.byteLength>=10&&t.getUint32(0,kl)===1195984440?{mimeType:"image/gif",width:t.getUint16(6,qp),height:t.getUint16(8,qp)}:null}function DH(r){const t=Kp(r);return t.byteLength>=14&&t.getUint16(0,kl)===16973&&t.getUint32(2,qp)===t.byteLength?{mimeType:"image/bmp",width:t.getUint32(18,qp),height:t.getUint32(22,qp)}:null}function NH(r){const t=Kp(r);if(!(t.byteLength>=3&&t.getUint16(0,kl)===65496&&t.getUint8(2)===255))return null;const{tableMarkers:n,sofMarkers:i}=kH();let s=2;for(;s+9<t.byteLength;){const a=t.getUint16(s,kl);if(i.has(a))return{mimeType:"image/jpeg",height:t.getUint16(s+5,kl),width:t.getUint16(s+7,kl)};if(!n.has(a))return null;s+=2,s+=t.getUint16(s,kl)}return null}function kH(){const r=new Set([65499,65476,65484,65501,65534]);for(let e=65504;e<65520;++e)r.add(e);return{tableMarkers:r,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function Kp(r){if(r instanceof DataView)return r;if(ArrayBuffer.isView(r))return new DataView(r.buffer);if(r instanceof ArrayBuffer)return new DataView(r);throw new Error("toDataView")}async function QH(r,t){const{mimeType:e}=jv(r)||{},n=globalThis._parseImageNode;return li(n),await n(r,e)}async function HH(r,t,e){t=t||{};const i=(t.image||{}).type||"auto",{url:s}=e||{},a=zH(i);let o;switch(a){case"imagebitmap":o=await EH(r,t,s);break;case"image":o=await xT(r,t,s);break;case"data":o=await QH(r);break;default:li(!1)}return i==="data"&&(o=_H(o)),o}function zH(r){switch(r){case"auto":case"data":return mH();default:return gH(r),r}}const CT={id:"image",module:"images",name:"Images",version:fH,mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],parse:HH,tests:[r=>!!jv(new DataView(r))],options:{image:{type:"auto",decode:!0}}},qv={};function GH(r){if(qv[r]===void 0){const t=l0?jH(r):VH(r);qv[r]=t}return qv[r]}function VH(r){const t=["image/png","image/jpeg","image/gif"],{_parseImageNode:e,_imageFormatsNode:n=t}=globalThis;return!!e&&n.includes(r)}function jH(r){switch(r){case"image/avif":case"image/webp":return qH(r);default:return!0}}function qH(r){try{return document.createElement("canvas").toDataURL(r).indexOf("data:".concat(r))===0}catch{return!1}}function ET(r){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron)return!0;const t=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,e=r||t;return!!(e&&e.indexOf("Electron")>=0)}function Tu(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||ET()}const f0={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document,process:typeof process=="object"&&process},p0=f0.window||f0.self||f0.global,$p=f0.process||{},ST=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";Tu();const Kv=globalThis;function TT(r){if(!r&&!Tu())return"Node";if(ET(r))return"Electron";const e=r||(typeof navigator<"u"?navigator:{}).userAgent||"";if(e.indexOf("Edge")>-1)return"Edge";const n=e.indexOf("MSIE ")!==-1,i=e.indexOf("Trident/")!==-1;return n||i?"IE":Kv.chrome?"Chrome":Kv.safari?"Safari":Kv.mozInnerScreenX?"Firefox":"Unknown"}function KH(r){try{const t=window[r],e="__storage_test__";return t.setItem(e,e),t.removeItem(e),t}catch{return null}}class $H{constructor(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";$(this,"storage",void 0),$(this,"id",void 0),$(this,"config",void 0),this.storage=KH(n),this.id=t,this.config=e,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(t){if(Object.assign(this.config,t),this.storage){const e=JSON.stringify(this.config);this.storage.setItem(this.id,e)}}_loadConfiguration(){let t={};if(this.storage){const e=this.storage.getItem(this.id);t=e?JSON.parse(e):{}}return Object.assign(this.config,t),this}}function WH(r){let t;return r<10?t="".concat(r.toFixed(2),"ms"):r<100?t="".concat(r.toFixed(1),"ms"):r<1e3?t="".concat(r.toFixed(0),"ms"):t="".concat((r/1e3).toFixed(2),"s"),t}function XH(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const e=Math.max(t-r.length,0);return"".concat(" ".repeat(e)).concat(r)}function $v(r,t,e){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const i=r.src.replace(/\(/g,"%28").replace(/\)/g,"%29");r.width>n&&(e=Math.min(e,n/r.width));const s=r.width*e,a=r.height*e,o=["font-size:1px;","padding:".concat(Math.floor(a/2),"px ").concat(Math.floor(s/2),"px;"),"line-height:".concat(a,"px;"),"background:url(".concat(i,");"),"background-size:".concat(s,"px ").concat(a,"px;"),"color:transparent;"].join("");return["".concat(t," %c+"),o]}let g0;(function(r){r[r.BLACK=30]="BLACK",r[r.RED=31]="RED",r[r.GREEN=32]="GREEN",r[r.YELLOW=33]="YELLOW",r[r.BLUE=34]="BLUE",r[r.MAGENTA=35]="MAGENTA",r[r.CYAN=36]="CYAN",r[r.WHITE=37]="WHITE",r[r.BRIGHT_BLACK=90]="BRIGHT_BLACK",r[r.BRIGHT_RED=91]="BRIGHT_RED",r[r.BRIGHT_GREEN=92]="BRIGHT_GREEN",r[r.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",r[r.BRIGHT_BLUE=94]="BRIGHT_BLUE",r[r.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",r[r.BRIGHT_CYAN=96]="BRIGHT_CYAN",r[r.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(g0||(g0={}));function IT(r){return typeof r=="string"?g0[r.toUpperCase()]||g0.WHITE:r}function JH(r,t,e){return!Tu&&typeof r=="string"&&(t&&(t=IT(t),r="\x1B[".concat(t,"m").concat(r,"\x1B[39m")),e&&(t=IT(e),r="\x1B[".concat(e+10,"m").concat(r,"\x1B[49m"))),r}function YH(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const e=Object.getPrototypeOf(r),n=Object.getOwnPropertyNames(e);for(const i of n)typeof r[i]=="function"&&(t.find(s=>i===s)||(r[i]=r[i].bind(r)))}function m0(r,t){if(!r)throw new Error(t||"Assertion failed")}function jd(){let r;if(Tu&&"performance"in p0){var t,e;r=p0==null||(t=p0.performance)===null||t===void 0||(e=t.now)===null||e===void 0?void 0:e.call(t)}else if("hrtime"in $p){var n;const i=$p==null||(n=$p.hrtime)===null||n===void 0?void 0:n.call($p);r=i[0]*1e3+i[1]/1e6}else r=Date.now();return r}const qd={debug:Tu&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},ZH={enabled:!0,level:0};function nc(){}const LT={},FT={once:!0};class Wv{constructor(){let{id:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};$(this,"id",void 0),$(this,"VERSION",ST),$(this,"_startTs",jd()),$(this,"_deltaTs",jd()),$(this,"_storage",void 0),$(this,"userData",{}),$(this,"LOG_THROTTLE_TIMEOUT",0),this.id=t,this.userData={},this._storage=new $H("__probe-".concat(this.id,"__"),ZH),this.timeStamp("".concat(this.id," started")),YH(this),Object.seal(this)}set level(t){this.setLevel(t)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((jd()-this._startTs).toPrecision(10))}getDelta(){return Number((jd()-this._deltaTs).toPrecision(10))}set priority(t){this.level=t}get priority(){return this.level}getPriority(){return this.level}enable(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.setConfiguration({enabled:t}),this}setLevel(t){return this._storage.setConfiguration({level:t}),this}get(t){return this._storage.config[t]}set(t,e){this._storage.setConfiguration({[t]:e})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(t,e){m0(t,e)}warn(t){return this._getLogFunction(0,t,qd.warn,arguments,FT)}error(t){return this._getLogFunction(0,t,qd.error,arguments)}deprecated(t,e){return this.warn("`".concat(t,"` is deprecated and will be removed in a later version. Use `").concat(e,"` instead"))}removed(t,e){return this.error("`".concat(t,"` has been removed. Use `").concat(e,"` instead"))}probe(t,e){return this._getLogFunction(t,e,qd.log,arguments,{time:!0,once:!0})}log(t,e){return this._getLogFunction(t,e,qd.debug,arguments)}info(t,e){return this._getLogFunction(t,e,console.info,arguments)}once(t,e){for(var n=arguments.length,i=new Array(n>2?n-2:0),s=2;s<n;s++)i[s-2]=arguments[s];return this._getLogFunction(t,e,qd.debug||qd.info,arguments,FT)}table(t,e,n){return e?this._getLogFunction(t,e,console.table||nc,n&&[n],{tag:nz(e)}):nc}image(t){let{logLevel:e,priority:n,image:i,message:s="",scale:a=1}=t;return this._shouldLog(e||n)?Tu?rz({image:i,message:s,scale:a}):ez():nc}time(t,e){return this._getLogFunction(t,e,console.time?console.time:console.info)}timeEnd(t,e){return this._getLogFunction(t,e,console.timeEnd?console.timeEnd:console.info)}timeStamp(t,e){return this._getLogFunction(t,e,console.timeStamp||nc)}group(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const i=MT({logLevel:t,message:e,opts:n}),{collapsed:s}=n;return i.method=(s?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(t,e,Object.assign({},n,{collapsed:!0}))}groupEnd(t){return this._getLogFunction(t,"",console.groupEnd||nc)}withGroup(t,e,n){this.group(t,e)();try{n()}finally{this.groupEnd(t)()}}trace(){console.trace&&console.trace()}_shouldLog(t){return this.isEnabled()&&this.getLevel()>=PT(t)}_getLogFunction(t,e,n,i,s){if(this._shouldLog(t)){s=MT({logLevel:t,message:e,args:i,opts:s}),n=n||s.method,m0(n),s.total=this.getTotal(),s.delta=this.getDelta(),this._deltaTs=jd();const a=s.tag||s.message;if(s.once)if(!LT[a])LT[a]=jd();else return nc;return e=tz(this.id,s.message,s),n.bind(console,e,...s.args)}return nc}}$(Wv,"VERSION",ST);function PT(r){if(!r)return 0;let t;switch(typeof r){case"number":t=r;break;case"object":t=r.logLevel||r.priority||0;break;default:return 0}return m0(Number.isFinite(t)&&t>=0),t}function MT(r){const{logLevel:t,message:e}=r;r.logLevel=PT(t);const n=r.args?Array.from(r.args):[];for(;n.length&&n.shift()!==e;);switch(typeof t){case"string":case"function":e!==void 0&&n.unshift(e),r.message=t;break;case"object":Object.assign(r,t);break}typeof r.message=="function"&&(r.message=r.message());const i=typeof r.message;return m0(i==="string"||i==="object"),Object.assign(r,{args:n},r.opts)}function tz(r,t,e){if(typeof t=="string"){const n=e.time?XH(WH(e.total)):"";t=e.time?"".concat(r,": ").concat(n,"  ").concat(t):"".concat(r,": ").concat(t),t=JH(t,e.color,e.background)}return t}function ez(r){return console.warn("removed"),nc}function rz(r){let{image:t,message:e="",scale:n=1}=r;if(typeof t=="string"){const s=new Image;return s.onload=()=>{const a=$v(s,e,n);console.log(...a)},s.src=t,nc}const i=t.nodeName||"";if(i.toLowerCase()==="img")return console.log(...$v(t,e,n)),nc;if(i.toLowerCase()==="canvas"){const s=new Image;return s.onload=()=>console.log(...$v(s,e,n)),s.src=t.toDataURL(),nc}return nc}function nz(r){for(const t in r)for(const e in r[t])return e||"untitled";return"empty"}const Pn=new Wv({id:"deck"}),IA={attributeUpdateStart:-1,attributeManagerUpdateStart:-1,attributeUpdateMessages:[]},Xv=1,Wp=2,Jv=3,Yv=4,iz=2,sz=r=>({"layer.changeFlag":(t,e,n)=>{r.log(Jv,"".concat(t.id," ").concat(e,": "),n[e])()},"layer.initialize":t=>{r.log(Xv,"Initializing ".concat(t))()},"layer.update":(t,e)=>{if(e){const n=t.getChangeFlags();r.log(Wp,"Updating ".concat(t," because: ").concat(Object.keys(n).filter(i=>n[i]).join(", ")))()}else r.log(Yv,"".concat(t," does not need update"))()},"layer.matched":(t,e)=>{e&&r.log(Yv,"Matched ".concat(t,", state transfered"))()},"layer.finalize":t=>{r.log(Xv,"Finalizing ".concat(t))()},"compositeLayer.renderLayers":(t,e,n)=>{e?r.log(Wp,"Composite layer rendered new subLayers ".concat(t),n)():r.log(Yv,"Composite layer reused subLayers ".concat(t),n)()},"layerManager.setLayers":(t,e,n)=>{e&&r.log(Wp,"Updating ".concat(n.length," deck layers"))()},"layerManager.activateViewport":(t,e)=>{r.log(Jv,"Viewport changed",e)()},"attributeManager.invalidate":(t,e,n)=>{r.log(Xv,n?"invalidated attributes ".concat(n," (").concat(e,") for ").concat(t.id):"invalidated all attributes for ".concat(t.id))()},"attributeManager.updateStart":t=>{IA.attributeUpdateMessages.length=0,IA.attributeManagerUpdateStart=Date.now()},"attributeManager.updateEnd":(t,e)=>{const n=Math.round(Date.now()-IA.attributeManagerUpdateStart);r.groupCollapsed(Wp,"Updated attributes for ".concat(e," instances in ").concat(t.id," in ").concat(n,"ms"))();for(const i of IA.attributeUpdateMessages)r.log(Jv,i)();r.groupEnd(Wp)()},"attribute.updateStart":t=>{IA.attributeUpdateStart=Date.now()},"attribute.allocate":(t,e)=>{const n="".concat(t.id," allocated ").concat(e);IA.attributeUpdateMessages.push(n)},"attribute.updateEnd":(t,e)=>{const n=Math.round(Date.now()-IA.attributeUpdateStart),i="".concat(t.id," updated ").concat(e," in ").concat(n,"ms");IA.attributeUpdateMessages.push(i)},"deckRenderer.renderLayers":(t,e,n)=>{const{pass:i,redrawReason:s,stats:a}=n;for(const o of e){const{totalCount:A,visibleCount:f,compositeCount:m,pickableCount:_}=o,B=A-m-f;r.log(iz,"RENDER #".concat(t.renderCount,"   ").concat(f," (of ").concat(A," layers) to ").concat(i," because ").concat(s,"   (").concat(B," hidden, ").concat(m," composite ").concat(_," pickable)"))(),a&&a.get("Redraw Layers").add(f)}}});var oz={};let y0={};oz.NODE_ENV!=="production"&&(y0=sz(Pn));function az(r){y0=r}function lo(r,t,e,n){Pn.level>0&&y0[r]&&y0[r].call(null,t,e,n)}function cz(r){const t=r[0],e=r[r.length-1];return t==="{"&&e==="}"||t==="["&&e==="]"}const lz={id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:cz,parseTextSync:JSON.parse};function uz(){const r="8.9.35",t=globalThis.deck&&globalThis.deck.VERSION;if(t&&t!==r)throw new Error("deck.gl - multiple versions detected: ".concat(t," vs ").concat(r));return t||(Pn.log(1,"deck.gl ".concat(r))(),globalThis.deck={...globalThis.deck,VERSION:r,version:r,log:Pn,_registerLoggers:az},zQ([lz,[CT,{imagebitmap:{premultiplyAlpha:"none"}}]])),r}const Az=uz(),Tn={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(Tn,"IDENTITY",{get:()=>(Pn.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const Ql={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Zv={common:0,meters:1,pixels:2},UT={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},yr=new Wv({id:"luma.gl"});function Uo(r,t){if(!r)throw new Error(t||"luma.gl: assertion failed.")}const hz="Invalid WebGLRenderingContext",dz="Requires WebGL2";function _0(r){return typeof WebGLRenderingContext<"u"&&r instanceof WebGLRenderingContext||typeof WebGL2RenderingContext<"u"&&r instanceof WebGL2RenderingContext?!0:!!(r&&Number.isFinite(r._version))}function gn(r){return typeof WebGL2RenderingContext<"u"&&r instanceof WebGL2RenderingContext?!0:!!(r&&r._version===2)}function fz(r){return gn(r)?r:null}function v0(r){return Uo(_0(r),hz),r}function Ro(r){return Uo(gn(r),dz),r}const Xp={};function pz(r){globalThis.console&&globalThis.console.error&&globalThis.console.error(r)}function gz(r){globalThis.console&&globalThis.console.log&&globalThis.console.log(r)}function mz(r,t){Xp[r]=!0,t!==void 0&&pz(t)}function yz(r){const t=r.getError;r.getError=function(){let n;do n=t.apply(r),n!==0&&(Xp[n]=!0);while(n!==0);for(n in Xp)if(Xp[n])return delete Xp[n],parseInt(n,10);return 0}}const Jp=function r(t){const e=t.gl;this.ext=t,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(t.maxVertexAttribs);for(let n=0;n<this.attribs.length;n++){const i=new r.VertexAttrib(e);this.attribs[n]=i}this.maxAttrib=0};Jp.VertexAttrib=function(t){this.enabled=!1,this.buffer=null,this.size=4,this.type=5126,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()},Jp.VertexAttrib.prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};const Rh=function(t){const e=this;this.gl=t,yz(t);const n=this.original={getParameter:t.getParameter,enableVertexAttribArray:t.enableVertexAttribArray,disableVertexAttribArray:t.disableVertexAttribArray,bindBuffer:t.bindBuffer,getVertexAttrib:t.getVertexAttrib,vertexAttribPointer:t.vertexAttribPointer};t.getParameter=function(s){return s===e.VERTEX_ARRAY_BINDING_OES?e.currentVertexArrayObject===e.defaultVertexArrayObject?null:e.currentVertexArrayObject:n.getParameter.apply(this,arguments)},t.enableVertexAttribArray=function(s){const a=e.currentVertexArrayObject;a.maxAttrib=Math.max(a.maxAttrib,s);const o=a.attribs[s];return o.enabled=!0,n.enableVertexAttribArray.apply(this,arguments)},t.disableVertexAttribArray=function(s){const a=e.currentVertexArrayObject;a.maxAttrib=Math.max(a.maxAttrib,s);const o=a.attribs[s];return o.enabled=!1,n.disableVertexAttribArray.apply(this,arguments)},t.bindBuffer=function(s,a){switch(s){case 34962:e.currentArrayBuffer=a;break;case 34963:e.currentVertexArrayObject.elementArrayBuffer=a;break}return n.bindBuffer.apply(this,arguments)},t.getVertexAttrib=function(s,a){const A=e.currentVertexArrayObject.attribs[s];switch(a){case 34975:return A.buffer;case 34338:return A.enabled;case 34339:return A.size;case 34340:return A.stride;case 34341:return A.type;case 34922:return A.normalized;default:return n.getVertexAttrib.apply(this,arguments)}},t.vertexAttribPointer=function(s,a,o,A,f,m){const _=e.currentVertexArrayObject;_.maxAttrib=Math.max(_.maxAttrib,s);const x=_.attribs[s];return x.buffer=e.currentArrayBuffer,x.size=a,x.type=o,x.normalized=A,x.stride=f,x.offset=m,x.recache(),n.vertexAttribPointer.apply(this,arguments)},t.instrumentExtension&&t.instrumentExtension(this,"OES_vertex_array_object"),t.canvas&&t.canvas.addEventListener("webglcontextrestored",()=>{gz("OESVertexArrayObject emulation library context restored"),e.reset_()},!0),this.reset_()};Rh.prototype.VERTEX_ARRAY_BINDING_OES=34229,Rh.prototype.reset_=function(){if(this.vertexArrayObjects!==void 0)for(let n=0;n<this.vertexArrayObjects.length;++n)this.vertexArrayObjects.isAlive=!1;const e=this.gl;this.maxVertexAttribs=e.getParameter(34921),this.defaultVertexArrayObject=new Jp(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)},Rh.prototype.createVertexArrayOES=function(){const t=new Jp(this);return this.vertexArrayObjects.push(t),t},Rh.prototype.deleteVertexArrayOES=function(t){t.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(t),1),this.currentVertexArrayObject===t&&this.bindVertexArrayOES(null)},Rh.prototype.isVertexArrayOES=function(t){return!!(t&&t instanceof Jp&&t.hasBeenBound&&t.ext===this)},Rh.prototype.bindVertexArrayOES=function(t){const e=this.gl;if(t&&!t.isAlive){mz(1282,"bindVertexArrayOES: attempt to bind deleted arrayObject");return}const n=this.original,i=this.currentVertexArrayObject;this.currentVertexArrayObject=t||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;const s=this.currentVertexArrayObject;if(i===s)return;(!i||s.elementArrayBuffer!==i.elementArrayBuffer)&&n.bindBuffer.call(e,34963,s.elementArrayBuffer);let a=this.currentArrayBuffer;const o=Math.max(i?i.maxAttrib:0,s.maxAttrib);for(let A=0;A<=o;A++){const f=s.attribs[A],m=i?i.attribs[A]:null;if((!i||f.enabled!==m.enabled)&&(f.enabled?n.enableVertexAttribArray.call(e,A):n.disableVertexAttribArray.call(e,A)),f.enabled){let _=!1;(!i||f.buffer!==m.buffer)&&(a!==f.buffer&&(n.bindBuffer.call(e,34962,f.buffer),a=f.buffer),_=!0),(_||f.cached!==m.cached)&&n.vertexAttribPointer.call(e,A,f.size,f.type,f.normalized,f.stride,f.offset)}}this.currentArrayBuffer!==a&&n.bindBuffer.call(e,34962,this.currentArrayBuffer)};function _z(r){if(typeof r.createVertexArray=="function")return;const t=r.getSupportedExtensions;r.getSupportedExtensions=function(){const i=t.call(this)||[];return i.indexOf("OES_vertex_array_object")<0&&i.push("OES_vertex_array_object"),i};const e=r.getExtension;r.getExtension=function(i){const s=e.call(this,i);return s||(i!=="OES_vertex_array_object"?null:(r.__OESVertexArrayObject||(this.__OESVertexArrayObject=new Rh(this)),this.__OESVertexArrayObject))}}const RT="OES_element_index",OT="WEBGL_draw_buffers",vz="EXT_disjoint_timer_query",bz="EXT_disjoint_timer_query_webgl2",wz="EXT_texture_filter_anisotropic",DT="WEBGL_debug_renderer_info",xz=35723,Bz=4352,Cz=36795,Ez=34047,Sz=37445,Tz=37446,gi=r=>gn(r)?void 0:0,Iz={3074:r=>gn(r)?void 0:36064,[xz]:r=>gn(r)?void 0:Bz,35977:gi,32937:gi,[Cz]:(r,t)=>{const e=gn(r)?r.getExtension(bz):r.getExtension(vz);return e&&e.GPU_DISJOINT_EXT?t(e.GPU_DISJOINT_EXT):0},[Sz]:(r,t)=>{const e=r.getExtension(DT);return t(e&&e.UNMASKED_VENDOR_WEBGL||7936)},[Tz]:(r,t)=>{const e=r.getExtension(DT);return t(e&&e.UNMASKED_RENDERER_WEBGL||7937)},[Ez]:(r,t)=>{const e=r.luma.extensions[wz];return e?t(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1},32883:gi,35071:gi,37447:gi,36063:(r,t)=>{if(!gn(r)){const e=r.getExtension(OT);return e?t(e.MAX_COLOR_ATTACHMENTS_WEBGL):0}},35379:gi,35374:gi,35377:gi,34852:r=>{if(!gn(r)){const t=r.getExtension(OT);return t?t.MAX_DRAW_BUFFERS_WEBGL:0}},36203:r=>r.getExtension(RT)?2147483647:65535,33001:r=>r.getExtension(RT)?16777216:65535,33e3:r=>16777216,37157:gi,35373:gi,35657:gi,36183:gi,37137:gi,34045:gi,35978:gi,35979:gi,35968:gi,35376:gi,35375:gi,35659:gi,37154:gi,35371:gi,35658:gi,35076:gi,35077:gi,35380:gi};function Lz(r,t,e){const n=Iz[e],i=typeof n=="function"?n(r,t,e):n;return i!==void 0?i:t(e)}const Fz="OES_vertex_array_object",NT="ANGLE_instanced_arrays",Pz="WEBGL_draw_buffers",Mz="EXT_disjoint_timer_query",Uz="EXT_texture_filter_anisotropic",Rz="VertexArray requires WebGL2 or OES_vertex_array_object extension";function Oz(r,t){return{webgl2:gn(r),ext:r.getExtension(t)}}const kT={[Fz]:{meta:{suffix:"OES"},createVertexArray:()=>{Uo(!1,Rz)},deleteVertexArray:()=>{},bindVertexArray:()=>{},isVertexArray:()=>!1},[NT]:{meta:{suffix:"ANGLE"},vertexAttribDivisor(r,t){Uo(t===0,"WebGL instanced rendering not supported")},drawElementsInstanced:()=>{},drawArraysInstanced:()=>{}},[Pz]:{meta:{suffix:"WEBGL"},drawBuffers:()=>{Uo(!1)}},[Mz]:{meta:{suffix:"EXT"},createQuery:()=>{Uo(!1)},deleteQuery:()=>{Uo(!1)},beginQuery:()=>{Uo(!1)},endQuery:()=>{},getQuery(r,t){return this.getQueryObject(r,t)},getQueryParameter(r,t){return this.getQueryObject(r,t)},getQueryObject:()=>{}}},tb={readBuffer:(r,t,e)=>{gn(r)&&t(e)},getVertexAttrib:(r,t,e,n)=>{const{webgl2:i,ext:s}=Oz(r,NT);let a;switch(n){case 35069:a=i?void 0:!1;break;case 35070:a=!i&&!s?0:void 0;break}return a!==void 0?a:t(e,n)},getProgramParameter:(r,t,e,n)=>{if(!gn(r))switch(n){case 35967:return 35981;case 35971:return 0;case 35382:return 0}return t(e,n)},getInternalformatParameter:(r,t,e,n,i)=>{if(!gn(r))switch(i){case 32937:return new Int32Array([0])}return r.getInternalformatParameter(e,n,i)},getTexParameter(r,t,e,n){switch(n){case 34046:const{extensions:i}=r.luma,s=i[Uz];n=s&&s.TEXTURE_MAX_ANISOTROPY_EXT||34046;break}return t(e,n)},getParameter:Lz,hint(r,t,e,n){return t(e,n)}};function Dz(r){r.luma=r.luma||{};const{luma:t}=r;return t.polyfilled||(_z(r),Nz(r),Qz(r,kT),kz(r,{target:t,target2:r}),t.polyfilled=!0),r}globalThis.polyfillContext=Dz;function Nz(r){r.luma.extensions={};const t=r.getSupportedExtensions()||[];for(const e of t)r.luma[e]=r.getExtension(e)}function kz(r,t){let{target:e,target2:n}=t;Object.keys(tb).forEach(i=>{if(typeof tb[i]=="function"){const s=r[i]?r[i].bind(r):()=>{},a=tb[i].bind(null,r,s);e[i]=a,n[i]=a}})}function Qz(r,t){for(const e of Object.getOwnPropertyNames(t))e!=="overrides"&&Hz(r,{extension:e,target:r.luma,target2:r})}function Hz(r,t){let{extension:e,target:n,target2:i}=t;const s=kT[e];Uo(s);const{meta:a={}}=s,{suffix:o=""}=a,A=r.getExtension(e);for(const f of Object.keys(s)){const m="".concat(f).concat(o);let _=null;f==="meta"||typeof r[f]=="function"||(A&&typeof A[m]=="function"?_=function(){return A[m](...arguments)}:typeof s[f]=="function"&&(_=s[f].bind(n))),_&&(n[f]=_,i[f]=_)}}const eb={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,36006:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],3333:4,3317:4,37440:!1,37441:!1,37443:37444,35723:4352,36010:null,35977:!1,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},LA=(r,t,e)=>t?r.enable(e):r.disable(e),QT=(r,t,e)=>r.hint(e,t),La=(r,t,e)=>r.pixelStorei(e,t),zz=(r,t)=>{const e=gn(r)?36009:36160;return r.bindFramebuffer(e,t)},Gz=(r,t)=>r.bindFramebuffer(36008,t);function Yp(r){return Array.isArray(r)||ArrayBuffer.isView(r)}const Vz={3042:LA,32773:(r,t)=>r.blendColor(...t),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(r,t)=>r.clearColor(...t),3107:(r,t)=>r.colorMask(...t),2884:LA,2885:(r,t)=>r.cullFace(t),2929:LA,2931:(r,t)=>r.clearDepth(t),2932:(r,t)=>r.depthFunc(t),2928:(r,t)=>r.depthRange(...t),2930:(r,t)=>r.depthMask(t),3024:LA,35723:QT,36006:zz,2886:(r,t)=>r.frontFace(t),33170:QT,2849:(r,t)=>r.lineWidth(t),32823:LA,32824:"polygonOffset",10752:"polygonOffset",35977:LA,32938:"sampleCoverage",32939:"sampleCoverage",3089:LA,3088:(r,t)=>r.scissor(...t),2960:LA,2961:(r,t)=>r.clearStencil(t),2968:(r,t)=>r.stencilMaskSeparate(1028,t),36005:(r,t)=>r.stencilMaskSeparate(1029,t),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(r,t)=>r.viewport(...t),3333:La,3317:La,37440:La,37441:La,37443:La,3330:La,3332:La,3331:La,36010:Gz,3314:La,32878:La,3316:La,3315:La,32877:La,framebuffer:(r,t)=>{const e=t&&"handle"in t?t.handle:t;return r.bindFramebuffer(36160,e)},blend:(r,t)=>t?r.enable(3042):r.disable(3042),blendColor:(r,t)=>r.blendColor(...t),blendEquation:(r,t)=>{t=Yp(t)?t:[t,t],r.blendEquationSeparate(...t)},blendFunc:(r,t)=>{t=Yp(t)&&t.length===2?[...t,...t]:t,r.blendFuncSeparate(...t)},clearColor:(r,t)=>r.clearColor(...t),clearDepth:(r,t)=>r.clearDepth(t),clearStencil:(r,t)=>r.clearStencil(t),colorMask:(r,t)=>r.colorMask(...t),cull:(r,t)=>t?r.enable(2884):r.disable(2884),cullFace:(r,t)=>r.cullFace(t),depthTest:(r,t)=>t?r.enable(2929):r.disable(2929),depthFunc:(r,t)=>r.depthFunc(t),depthMask:(r,t)=>r.depthMask(t),depthRange:(r,t)=>r.depthRange(...t),dither:(r,t)=>t?r.enable(3024):r.disable(3024),derivativeHint:(r,t)=>{r.hint(35723,t)},frontFace:(r,t)=>r.frontFace(t),mipmapHint:(r,t)=>r.hint(33170,t),lineWidth:(r,t)=>r.lineWidth(t),polygonOffsetFill:(r,t)=>t?r.enable(32823):r.disable(32823),polygonOffset:(r,t)=>r.polygonOffset(...t),sampleCoverage:(r,t)=>r.sampleCoverage(...t),scissorTest:(r,t)=>t?r.enable(3089):r.disable(3089),scissor:(r,t)=>r.scissor(...t),stencilTest:(r,t)=>t?r.enable(2960):r.disable(2960),stencilMask:(r,t)=>{t=Yp(t)?t:[t,t];const[e,n]=t;r.stencilMaskSeparate(1028,e),r.stencilMaskSeparate(1029,n)},stencilFunc:(r,t)=>{t=Yp(t)&&t.length===3?[...t,...t]:t;const[e,n,i,s,a,o]=t;r.stencilFuncSeparate(1028,e,n,i),r.stencilFuncSeparate(1029,s,a,o)},stencilOp:(r,t)=>{t=Yp(t)&&t.length===3?[...t,...t]:t;const[e,n,i,s,a,o]=t;r.stencilOpSeparate(1028,e,n,i),r.stencilOpSeparate(1029,s,a,o)},viewport:(r,t)=>r.viewport(...t)};function Hi(r,t,e){return t[r]!==void 0?t[r]:e[r]}const jz={blendEquation:(r,t,e)=>r.blendEquationSeparate(Hi(32777,t,e),Hi(34877,t,e)),blendFunc:(r,t,e)=>r.blendFuncSeparate(Hi(32969,t,e),Hi(32968,t,e),Hi(32971,t,e),Hi(32970,t,e)),polygonOffset:(r,t,e)=>r.polygonOffset(Hi(32824,t,e),Hi(10752,t,e)),sampleCoverage:(r,t,e)=>r.sampleCoverage(Hi(32938,t,e),Hi(32939,t,e)),stencilFuncFront:(r,t,e)=>r.stencilFuncSeparate(1028,Hi(2962,t,e),Hi(2967,t,e),Hi(2963,t,e)),stencilFuncBack:(r,t,e)=>r.stencilFuncSeparate(1029,Hi(34816,t,e),Hi(36003,t,e),Hi(36004,t,e)),stencilOpFront:(r,t,e)=>r.stencilOpSeparate(1028,Hi(2964,t,e),Hi(2965,t,e),Hi(2966,t,e)),stencilOpBack:(r,t,e)=>r.stencilOpSeparate(1029,Hi(34817,t,e),Hi(34818,t,e),Hi(34819,t,e))},HT={enable:(r,t)=>r({[t]:!0}),disable:(r,t)=>r({[t]:!1}),pixelStorei:(r,t,e)=>r({[t]:e}),hint:(r,t,e)=>r({[t]:e}),bindFramebuffer:(r,t,e)=>{switch(t){case 36160:return r({36006:e,36010:e});case 36009:return r({36006:e});case 36008:return r({36010:e});default:return null}},blendColor:(r,t,e,n,i)=>r({32773:new Float32Array([t,e,n,i])}),blendEquation:(r,t)=>r({32777:t,34877:t}),blendEquationSeparate:(r,t,e)=>r({32777:t,34877:e}),blendFunc:(r,t,e)=>r({32969:t,32968:e,32971:t,32970:e}),blendFuncSeparate:(r,t,e,n,i)=>r({32969:t,32968:e,32971:n,32970:i}),clearColor:(r,t,e,n,i)=>r({3106:new Float32Array([t,e,n,i])}),clearDepth:(r,t)=>r({2931:t}),clearStencil:(r,t)=>r({2961:t}),colorMask:(r,t,e,n,i)=>r({3107:[t,e,n,i]}),cullFace:(r,t)=>r({2885:t}),depthFunc:(r,t)=>r({2932:t}),depthRange:(r,t,e)=>r({2928:new Float32Array([t,e])}),depthMask:(r,t)=>r({2930:t}),frontFace:(r,t)=>r({2886:t}),lineWidth:(r,t)=>r({2849:t}),polygonOffset:(r,t,e)=>r({32824:t,10752:e}),sampleCoverage:(r,t,e)=>r({32938:t,32939:e}),scissor:(r,t,e,n,i)=>r({3088:new Int32Array([t,e,n,i])}),stencilMask:(r,t)=>r({2968:t,36005:t}),stencilMaskSeparate:(r,t,e)=>r({[t===1028?2968:36005]:e}),stencilFunc:(r,t,e,n)=>r({2962:t,2967:e,2963:n,34816:t,36003:e,36004:n}),stencilFuncSeparate:(r,t,e,n,i)=>r({[t===1028?2962:34816]:e,[t===1028?2967:36003]:n,[t===1028?2963:36004]:i}),stencilOp:(r,t,e,n)=>r({2964:t,2965:e,2966:n,34817:t,34818:e,34819:n}),stencilOpSeparate:(r,t,e,n,i)=>r({[t===1028?2964:34817]:e,[t===1028?2965:34818]:n,[t===1028?2966:34819]:i}),viewport:(r,t,e,n,i)=>r({2978:[t,e,n,i]})},Hl=(r,t)=>r.isEnabled(t),zT={3042:Hl,2884:Hl,2929:Hl,3024:Hl,32823:Hl,32926:Hl,32928:Hl,3089:Hl,2960:Hl,35977:Hl};function GT(r){for(const t in r)return!1;return!0}function qz(r,t){if(r===t)return!0;const e=Array.isArray(r)||ArrayBuffer.isView(r),n=Array.isArray(t)||ArrayBuffer.isView(t);if(e&&n&&r.length===t.length){for(let i=0;i<r.length;++i)if(r[i]!==t[i])return!1;return!0}return!1}function VT(r,t){const e=r[t].bind(r);r[t]=function(){const i=arguments.length<=0?void 0:arguments[0];return i in r.state.cache?r.state.enable?r.state.cache[i]:e(...arguments):e(...arguments)},Object.defineProperty(r[t],"name",{value:"".concat(t,"-from-cache"),configurable:!1})}function Kz(r,t,e){const n=r[t].bind(r);r[t]=function(){for(var s=arguments.length,a=new Array(s),o=0;o<s;o++)a[o]=arguments[o];const{valueChanged:A,oldValue:f}=e(r.state._updateCache,...a);return A&&n(...a),f},Object.defineProperty(r[t],"name",{value:"".concat(t,"-to-cache"),configurable:!1})}function $z(r){const t=r.useProgram.bind(r);r.useProgram=function(n){r.state.program!==n&&(t(n),r.state.program=n)}}class Wz{constructor(t){let{copyState:e=!1,log:n=()=>{}}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=t,this.program=null,this.stateStack=[],this.enable=!0,this.cache=e?Jz(t):Object.assign({},eb),this.log=n,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(){this.stateStack.push({})}pop(){Uo(this.stateStack.length>0);const t=this.stateStack[this.stateStack.length-1];Iu(this.gl,t),this.stateStack.pop()}_updateCache(t){let e=!1,n;const i=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(const s in t){Uo(s!==void 0);const a=t[s],o=this.cache[s];qz(a,o)||(e=!0,n=o,i&&!(s in i)&&(i[s]=o),this.cache[s]=a)}return{valueChanged:e,oldValue:n}}}function jT(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{enable:e=!0,copyState:n}=t;if(Uo(n!==void 0),!r.state){const{polyfillContext:i}=globalThis;i&&i(r),r.state=new Wz(r,{copyState:n}),$z(r);for(const s in HT){const a=HT[s];Kz(r,s,a)}VT(r,"getParameter"),VT(r,"isEnabled")}return r.state.enable=e,r}function Xz(r){r.state||jT(r,{copyState:!1}),r.state.push()}function qT(r){Uo(r.state),r.state.pop()}function Iu(r,t){if(Uo(_0(r),"setParameters requires a WebGL context"),GT(t))return;const e={};for(const i in t){const s=Number(i),a=Vz[i];a&&(typeof a=="string"?e[a]=!0:a(r,t[i],s))}const n=r.state&&r.state.cache;if(n)for(const i in e){const s=jz[i];s(r,t,n)}}function Jz(r,t){if(t=t||eb,typeof t=="number"){const i=t,s=zT[i];return s?s(r,i):r.getParameter(i)}const e=Array.isArray(t)?t:Object.keys(t),n={};for(const i of e){const s=zT[i];n[i]=s?s(r,Number(i)):r.getParameter(Number(i))}return n}function Yz(r){Iu(r,eb)}function Qc(r,t,e){if(GT(t))return e(r);const{nocatch:n=!0}=t;Xz(r),Iu(r,t);let i;if(n)i=e(r),qT(r);else try{i=e(r)}finally{qT(r)}return i}function Kd(r){const{luma:t}=r;if(r.canvas&&t){const e=t.canvasSizeInfo,n="clientWidth"in e?e.clientWidth:r.canvas.clientWidth;return n?r.drawingBufferWidth/n:1}return 1}function rb(r,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const n=Kd(r),i=r.drawingBufferWidth,s=r.drawingBufferHeight;return t7(t,n,i,s,e)}function Zz(r){const t=typeof window>"u"?1:window.devicePixelRatio||1;return Number.isFinite(r)?r<=0?1:r:r?t:1}function t7(r,t,e,n,i){const s=KT(r[0],t,e);let a=$T(r[1],t,n,i),o=KT(r[0]+1,t,e);const A=o===e-1?o:o-1;o=$T(r[1]+1,t,n,i);let f;return i?(o=o===0?o:o+1,f=a,a=o):f=o===n-1?o:o-1,{x:s,y:a,width:Math.max(A-s+1,1),height:Math.max(f-a+1,1)}}function KT(r,t,e){return Math.min(Math.round(r*t),e-1)}function $T(r,t,e,n){return n?Math.max(0,e-1-Math.round(r*t)):Math.min(Math.round(r*t),e-1)}const nb=Tu(),e7=nb&&typeof document<"u",WT={webgl2:!0,webgl1:!0,throwOnError:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function XT(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Uo(nb,`createGLContext only available in the browser.
Create your own headless context or use 'createHeadlessContext' from @luma.gl/test-utils`),r=Object.assign({},WT,r);const{width:t,height:e}=r;function n(o){if(r.throwOnError)throw new Error(o);return console.error(o),null}r.onError=n;let i;const{canvas:s}=r,a=s7({canvas:s,width:t,height:e,onError:n});return i=i7(a,r),i?(i=ib(i,r),o7(i),i):null}function ib(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!r||r._instrumented)return r;r._version=r._version||a7(r),r.luma=r.luma||{},r.luma.canvasSizeInfo=r.luma.canvasSizeInfo||{},t=Object.assign({},WT,t);const{manageState:e,debug:n}=t;return e&&jT(r,{copyState:!1,log:function(){for(var i=arguments.length,s=new Array(i),a=0;a<i;a++)s[a]=arguments[a];return yr.log(1,...s)()}}),nb&&n&&(globalThis.makeDebugContext?(r=globalThis.makeDebugContext(r,t),yr.level=Math.max(yr.level,1)):yr.warn('WebGL debug mode not activated. import "@luma.gl/debug" to enable.')()),r._instrumented=!0,r}function r7(r){const t=r.getParameter(7936),e=r.getParameter(7937),n=r.getExtension("WEBGL_debug_renderer_info"),i=n&&r.getParameter(n.UNMASKED_VENDOR_WEBGL||7936),s=n&&r.getParameter(n.UNMASKED_RENDERER_WEBGL||7937);return{vendor:i||t,renderer:s||e,vendorMasked:t,rendererMasked:e,version:r.getParameter(7938),shadingLanguageVersion:r.getParameter(35724)}}function n7(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(r.canvas){const n=Zz(t.useDevicePixels);c7(r,n,t);return}const e=r.getExtension("STACKGL_resize_drawingbuffer");e&&"width"in t&&"height"in t&&e.resize(t.width,t.height)}function i7(r,t){const{onError:e}=t;let n=null;const i=A=>n=A.statusMessage||n;r.addEventListener("webglcontextcreationerror",i,!1);const{webgl1:s=!0,webgl2:a=!0}=t;let o=null;return a&&(o=o||r.getContext("webgl2",t),o=o||r.getContext("experimental-webgl2",t)),s&&(o=o||r.getContext("webgl",t),o=o||r.getContext("experimental-webgl",t)),r.removeEventListener("webglcontextcreationerror",i,!1),o?(t.onContextLost&&r.addEventListener("webglcontextlost",t.onContextLost,!1),t.onContextRestored&&r.addEventListener("webglcontextrestored",t.onContextRestored,!1),o):e("Failed to create ".concat(a&&!s?"WebGL2":"WebGL"," context: ").concat(n||"Unknown error"))}function s7(r){let{canvas:t,width:e=800,height:n=600,onError:i}=r,s;return typeof t=="string"?(e7&&document.readyState==="complete"||i("createGLContext called on canvas '".concat(t,"' before page was loaded")),s=document.getElementById(t)):t?s=t:(s=document.createElement("canvas"),s.id="lumagl-canvas",s.style.width=Number.isFinite(e)?"".concat(e,"px"):"100%",s.style.height=Number.isFinite(n)?"".concat(n,"px"):"100%",document.body.insertBefore(s,document.body.firstChild)),s}function o7(r){const t=gn(r)?"WebGL2":"WebGL1",e=r7(r),n=e?"(".concat(e.vendor,",").concat(e.renderer,")"):"",i=r.debug?" debug":"";yr.info(1,"".concat(t).concat(i," context ").concat(n))()}function a7(r){return typeof WebGL2RenderingContext<"u"&&r instanceof WebGL2RenderingContext?2:1}function c7(r,t,e){let n="width"in e?e.width:r.canvas.clientWidth,i="height"in e?e.height:r.canvas.clientHeight;(!n||!i)&&(yr.log(1,"Canvas clientWidth/clientHeight is 0")(),t=1,n=r.canvas.width||1,i=r.canvas.height||1),r.luma=r.luma||{},r.luma.canvasSizeInfo=r.luma.canvasSizeInfo||{};const s=r.luma.canvasSizeInfo;if(s.clientWidth!==n||s.clientHeight!==i||s.devicePixelRatio!==t){let a=t;const o=Math.floor(n*a),A=Math.floor(i*a);r.canvas.width=o,r.canvas.height=A,(r.drawingBufferWidth!==o||r.drawingBufferHeight!==A)&&(yr.warn("Device pixel ratio clamped")(),a=Math.min(r.drawingBufferWidth/n,r.drawingBufferHeight/i),r.canvas.width=Math.floor(n*a),r.canvas.height=Math.floor(i*a)),Object.assign(r.luma.canvasSizeInfo,{clientWidth:n,clientHeight:i,devicePixelRatio:t})}}function JT(){let r;if(typeof window<"u"&&window.performance)r=window.performance.now();else if(typeof process<"u"&&process.hrtime){const t=process.hrtime();r=t[0]*1e3+t[1]/1e6}else r=Date.now();return r}let YT=class{constructor(t,e){$(this,"name",void 0),$(this,"type",void 0),$(this,"sampleSize",1),$(this,"time",void 0),$(this,"count",void 0),$(this,"samples",void 0),$(this,"lastTiming",void 0),$(this,"lastSampleTime",void 0),$(this,"lastSampleCount",void 0),$(this,"_count",0),$(this,"_time",0),$(this,"_samples",0),$(this,"_startTime",0),$(this,"_timerPending",!1),this.name=t,this.type=e,this.reset()}setSampleSize(t){return this.sampleSize=t,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(t){return this._count+=t,this._samples++,this._checkSampling(),this}subtractCount(t){return this._count-=t,this._samples++,this._checkSampling(),this}addTime(t){return this._time+=t,this.lastTiming=t,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=JT(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(JT()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}},sb=class{constructor(t){$(this,"id",void 0),$(this,"stats",{}),this.id=t.id,this.stats={},this._initializeStats(t.stats),Object.seal(this)}get(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:t,type:e})}get size(){return Object.keys(this.stats).length}reset(){for(const t in this.stats)this.stats[t].reset();return this}forEach(t){for(const e in this.stats)t(this.stats[e])}getTable(){const t={};return this.forEach(e=>{t[e.name]={time:e.time||0,count:e.count||0,average:e.getAverageTime()||0,hz:e.getHz()||0}}),t}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(e=>this._getOrCreate(e))}_getOrCreate(t){if(!t||!t.name)return null;const{name:e,type:n}=t;return this.stats[e]||(t instanceof YT?this.stats[e]=t:this.stats[e]=new YT(e,n)),this.stats[e]}};const Zp="8.5.21",l7="set luma.log.level=1 (or higher) to trace rendering";class u7{constructor(){this.stats=new Map}get(t){return this.stats.has(t)||this.stats.set(t,new sb({id:t})),this.stats.get(t)}}const Oh=new u7;if(globalThis.luma&&globalThis.luma.VERSION!==Zp)throw new Error("luma.gl - multiple VERSIONs detected: ".concat(globalThis.luma.VERSION," vs ").concat(Zp));globalThis.luma||(Tu()&&yr.log(1,"luma.gl ".concat(Zp," - ").concat(l7))(),globalThis.luma=globalThis.luma||{VERSION:Zp,version:Zp,log:yr,stats:Oh,globals:{modules:{},nodeIO:{}}});function A7(r){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(r):setTimeout(r,1e3/60)}function h7(r){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(r):clearTimeout(r)}function ar(r,t){if(!r)throw new Error(t||"luma.gl: assertion failed.")}function ob(r,t){if(typeof t!="string")return t;const e=Number(t);if(!isNaN(e))return e;t=t.replace(/^.*\./,"");const n=r[t];return ar(n!==void 0,"Accessing undefined constant GL.".concat(t)),n}function FA(r,t){t=Number(t);for(const e in r)if(r[e]===t)return"GL.".concat(e);return String(t)}const ab={};function Lu(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"id";ab[r]=ab[r]||1;const t=ab[r]++;return"".concat(r,"-").concat(t)}function ZT(r){return ar(typeof r=="number","Input must be a number"),r&&(r&r-1)===0}function $d(r){let t=!0;for(const e in r){t=!1;break}return t}function t5(r,t,e,n){const i="See luma.gl ".concat(e," Upgrade Guide at https://luma.gl/docs/upgrade-guide"),s=Object.getPrototypeOf(r);n.forEach(a=>{s.methodName||(s[a]=()=>{throw yr.removed("Calling removed method ".concat(t,".").concat(a,": "),i)(),new Error(a)})})}const Wd="Resource subclass must define virtual methods";let Fu=class{get[Symbol.toStringTag](){return"Resource"}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};v0(t);const{id:n,userData:i={}}=e;this.gl=t,this.gl2=t,this.id=n||Lu(this[Symbol.toStringTag]),this.userData=i,this._bound=!1,this._handle=e.handle,this._handle===void 0&&(this._handle=this._createHandle()),this.byteLength=0,this._addStats()}toString(){return"".concat(this[Symbol.toStringTag]||this.constructor.name,"(").concat(this.id,")")}get handle(){return this._handle}delete(){let{deleteChildren:t=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=this._handle&&this._deleteHandle(this._handle);return this._handle&&this._removeStats(),this._handle=null,e&&t&&e.filter(Boolean).forEach(n=>n.delete()),this}bind(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.handle;if(typeof t!="function")return this._bindHandle(t),this;let e;return this._bound?e=t():(this._bindHandle(this.handle),this._bound=!0,e=t(),this._bound=!1,this._bindHandle(null)),e}unbind(){this.bind(null)}getParameter(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};t=ob(this.gl,t),ar(t);const i=(this.constructor.PARAMETERS||{})[t];if(i){const s=gn(this.gl);if(!((!("webgl2"in i)||s)&&(!("extension"in i)||this.gl.getExtension(i.extension)))){const o=i.webgl1,A="webgl2"in i?i.webgl2:i.webgl1;return s?A:o}}return this._getParameter(t,e)}getParameters(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{parameters:e,keys:n}=t,i=this.constructor.PARAMETERS||{},s=gn(this.gl),a={},o=e||Object.keys(i);for(const A of o){const f=i[A];if(f&&(!("webgl2"in f)||s)&&(!("extension"in f)||this.gl.getExtension(f.extension))){const _=n?FA(this.gl,A):A;a[_]=this.getParameter(A,t),n&&f.type==="GLenum"&&(a[_]=FA(this.gl,a[_]))}}return a}setParameter(t,e){t=ob(this.gl,t),ar(t);const i=(this.constructor.PARAMETERS||{})[t];if(i){const s=gn(this.gl);if(!((!("webgl2"in i)||s)&&(!("extension"in i)||this.gl.getExtension(i.extension))))throw new Error("Parameter not available on this platform");i.type==="GLenum"&&(e=ob(e))}return this._setParameter(t,e),this}setParameters(t){for(const e in t)this.setParameter(e,t[e]);return this}stubRemovedMethods(t,e,n){return t5(this,t,e,n)}initialize(t){}_createHandle(){throw new Error(Wd)}_deleteHandle(){throw new Error(Wd)}_bindHandle(t){throw new Error(Wd)}_getOptsFromHandle(){throw new Error(Wd)}_getParameter(t,e){throw new Error(Wd)}_setParameter(t,e){throw new Error(Wd)}_context(){return this.gl.luma=this.gl.luma||{},this.gl.luma}_addStats(){const t=this[Symbol.toStringTag],e=Oh.get("Resource Counts");e.get("Resources Created").incrementCount(),e.get("".concat(t,"s Created")).incrementCount(),e.get("".concat(t,"s Active")).incrementCount()}_removeStats(){const t=this[Symbol.toStringTag];Oh.get("Resource Counts").get("".concat(t,"s Active")).decrementCount()}_trackAllocatedMemory(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag];this._trackAllocatedMemoryForContext(t,e),this._trackAllocatedMemoryForContext(t,e,this.gl.canvas&&this.gl.canvas.id),this.byteLength=t}_trackAllocatedMemoryForContext(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag],n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";const i=Oh.get("Memory Usage".concat(n));i.get("GPU Memory").addCount(t),i.get("".concat(e," Memory")).addCount(t)}_trackDeallocatedMemory(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag];this._trackDeallocatedMemoryForContext(t),this._trackDeallocatedMemoryForContext(t,this.gl.canvas&&this.gl.canvas.id),this.byteLength=0}_trackDeallocatedMemoryForContext(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const n=Oh.get("Memory Usage".concat(e));n.get("GPU Memory").subtractCount(this.byteLength),n.get("".concat(t," Memory")).subtractCount(this.byteLength)}};const d7="Failed to deduce GL constant from typed array";function cb(r){switch(ArrayBuffer.isView(r)?r.constructor:r){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(d7)}}function tg(r){let{clamped:t=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};switch(r){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return t?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function f7(r){let{data:t,width:e,height:n,bytesPerPixel:i=4,temp:s}=r;const a=e*i;s=s||new Uint8Array(a);for(let o=0;o<n/2;++o){const A=o*a,f=(n-o-1)*a;s.set(t.subarray(A,A+a)),t.copyWithin(A,f,f+a),t.set(s,f)}}function p7(r){let{data:t,width:e,height:n}=r;const i=Math.round(e/2),s=Math.round(n/2),a=new Uint8Array(i*s*4);for(let o=0;o<s;o++)for(let A=0;A<i;A++)for(let f=0;f<4;f++)a[(o*i+A)*4+f]=t[(o*2*e+A*2)*4+f];return{data:a,width:i,height:s}}function lb(r,t,e){const{removedProps:n={},deprecatedProps:i={},replacedProps:s={}}=e;for(const o in n)if(o in t){const f=n[o]?"".concat(r,".").concat(n[o]):"N/A";yr.removed("".concat(r,".").concat(o),f)()}for(const o in i)if(o in t){const A=i[o];yr.deprecated("".concat(r,".").concat(o),"".concat(r,".").concat(A))()}let a=null;for(const o in s)if(o in t){const A=s[o];yr.deprecated("".concat(r,".").concat(o),"".concat(r,".").concat(A))(),a=a||Object.assign({},t),a[A]=t[o],delete a[o]}return a||t}const g7={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},m7={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class la{static getBytesPerElement(t){return tg(t.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(t){return ar(t.size),tg(t.type||5126).BYTES_PER_ELEMENT*t.size}static resolve(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return new la(g7,...e)}constructor(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];e.forEach(i=>this._assign(i)),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return la.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return la.getBytesPerVertex(this)}_assign(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t=lb("Accessor",t,m7),t.type!==void 0&&(this.type=t.type,(t.type===5124||t.type===5125)&&(this.integer=!0)),t.size!==void 0&&(this.size=t.size),t.offset!==void 0&&(this.offset=t.offset),t.stride!==void 0&&(this.stride=t.stride),t.normalized!==void 0&&(this.normalized=t.normalized),t.integer!==void 0&&(this.integer=t.integer),t.divisor!==void 0&&(this.divisor=t.divisor),t.buffer!==void 0&&(this.buffer=t.buffer),t.index!==void 0&&(typeof t.index=="boolean"?this.index=t.index?1:0:this.index=t.index),t.instanced!==void 0&&(this.divisor=t.instanced?1:0),t.isInstanced!==void 0&&(this.divisor=t.isInstanced?1:0),this}}const e5=10,r5={offset:"accessor.offset",stride:"accessor.stride",type:"accessor.type",size:"accessor.size",divisor:"accessor.divisor",normalized:"accessor.normalized",integer:"accessor.integer",instanced:"accessor.divisor",isInstanced:"accessor.divisor"},y7={removedProps:{},replacedProps:{bytes:"byteLength"},deprecatedProps:r5},_7={removedProps:r5};let ni=class extends Fu{get[Symbol.toStringTag](){return"Buffer"}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(t,e),this.stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),this.target=e.target||(this.gl.webgl2?36662:34962),this.initialize(e),Object.seal(this)}getElementCount(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/la.getBytesPerElement(t))}getVertexCount(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/la.getBytesPerVertex(t))}initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return ArrayBuffer.isView(t)&&(t={data:t}),Number.isFinite(t)&&(t={byteLength:t}),t=lb("Buffer",t,y7),this.usage=t.usage||35044,this.debugData=null,this.setAccessor(Object.assign({},t,t.accessor)),t.data?this._setData(t.data,t.offset,t.byteLength):this._setByteLength(t.byteLength||0),this}setProps(t){return t=lb("Buffer",t,_7),"accessor"in t&&this.setAccessor(t.accessor),this}setAccessor(t){return t=Object.assign({},t),delete t.buffer,this.accessor=new la(t),this}reallocate(t){return t>this.byteLength?(this._setByteLength(t),!0):(this.bytesUsed=t,!1)}setData(t){return this.initialize(t)}subData(t){ArrayBuffer.isView(t)&&(t={data:t});const{data:e,offset:n=0,srcOffset:i=0}=t,s=t.byteLength||t.length;ar(e);const a=this.gl.webgl2?36663:this.target;return this.gl.bindBuffer(a,this.handle),i!==0||s!==void 0?(Ro(this.gl),this.gl.bufferSubData(this.target,n,e,i,s)):this.gl.bufferSubData(a,n,e),this.gl.bindBuffer(a,null),this.debugData=null,this._inferType(e),this}copyData(t){let{sourceBuffer:e,readOffset:n=0,writeOffset:i=0,size:s}=t;const{gl:a}=this;return Ro(a),a.bindBuffer(36662,e.handle),a.bindBuffer(36663,this.handle),a.copyBufferSubData(36662,36663,n,i,s),a.bindBuffer(36662,null),a.bindBuffer(36663,null),this.debugData=null,this}getData(){let{dstData:t=null,srcByteOffset:e=0,dstOffset:n=0,length:i=0}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Ro(this.gl);const s=tg(this.accessor.type||5126,{clamped:!1}),a=this._getAvailableElementCount(e),o=n;let A,f;t?(f=t.length,A=f-o):(A=Math.min(a,i||a),f=o+A);const m=Math.min(a,A);return i=i||m,ar(i<=m),t=t||new s(f),this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,e,t,n,i),this.gl.bindBuffer(36662,null),t}bind(){let{target:t=this.target,index:e=this.accessor&&this.accessor.index,offset:n=0,size:i}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t===35345||t===35982?i!==void 0?this.gl.bindBufferRange(t,e,this.handle,n,i):(ar(n===0),this.gl.bindBufferBase(t,e,this.handle)):this.gl.bindBuffer(t,this.handle),this}unbind(){let{target:t=this.target,index:e=this.accessor&&this.accessor.index}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t===35345||t===35982?this.gl.bindBufferBase(t,e,null):this.gl.bindBuffer(t,null),this}getDebugData(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:Math.min(e5,this.byteLength)}),{data:this.debugData,changed:!0})}invalidateDebugData(){this.debugData=null}_setData(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:t.byteLength+e;ar(ArrayBuffer.isView(t)),this._trackDeallocatedMemory();const i=this._getTarget();this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,n,this.usage),this.gl.bufferSubData(i,e,t),this.gl.bindBuffer(i,null),this.debugData=t.slice(0,e5),this.bytesUsed=n,this._trackAllocatedMemory(n);const s=cb(t);return ar(s),this.setAccessor(new la(this.accessor,{type:s})),this}_setByteLength(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.usage;ar(t>=0),this._trackDeallocatedMemory();let n=t;t===0&&(n=new Float32Array(0));const i=this._getTarget();return this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,n,e),this.gl.bindBuffer(i,null),this.usage=e,this.debugData=null,this.bytesUsed=t,this._trackAllocatedMemory(t),this}_getTarget(){return this.gl.webgl2?36663:this.target}_getAvailableElementCount(t){const e=tg(this.accessor.type||5126,{clamped:!1}),n=t/e.BYTES_PER_ELEMENT;return this.getElementCount()-n}_inferType(t){this.accessor.type||this.setAccessor(new la(this.accessor,{type:cb(t)}))}_createHandle(){return this.gl.createBuffer()}_deleteHandle(){this.gl.deleteBuffer(this.handle),this._trackDeallocatedMemory()}_getParameter(t){this.gl.bindBuffer(this.target,this.handle);const e=this.gl.getBufferParameter(this.target,t);return this.gl.bindBuffer(this.target,null),e}get type(){return yr.deprecated("Buffer.type","Buffer.accessor.type")(),this.accessor.type}get bytes(){return yr.deprecated("Buffer.bytes","Buffer.byteLength")(),this.byteLength}setByteLength(t){return yr.deprecated("setByteLength","reallocate")(),this.reallocate(t)}updateAccessor(t){return yr.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)")(),this.accessor=new la(this.accessor,t),this}};const ub={6407:{dataFormat:6407,types:[5121,33635]},6408:{dataFormat:6408,types:[5121,32819,32820]},6406:{dataFormat:6406,types:[5121]},6409:{dataFormat:6409,types:[5121]},6410:{dataFormat:6410,types:[5121]},33326:{dataFormat:6403,types:[5126],gl2:!0},33328:{dataFormat:33319,types:[5126],gl2:!0},34837:{dataFormat:6407,types:[5126],gl2:!0},34836:{dataFormat:6408,types:[5126],gl2:!0}},n5={6403:1,36244:1,33319:2,33320:2,6407:3,36248:3,6408:4,36249:4,6402:1,34041:1,6406:1,6409:1,6410:2},i5={5126:4,5125:4,5124:4,5123:2,5122:2,5131:2,5120:1,5121:1};function v7(r,t){const e=ub[t];if(!e)return!1;if(e.gl1===void 0&&e.gl2===void 0)return!0;const n=gn(r)&&e.gl2||e.gl1;return typeof n=="string"?r.getExtension(n):n}function b7(r,t){const e=ub[t];switch(e&&e.types[0]){case 5126:return r.getExtension("OES_texture_float_linear");case 5131:return r.getExtension("OES_texture_half_float_linear");default:return!0}}const w7=[9729,9728],s5=globalThis.WebGLBuffer||function(){};class Xd extends Fu{get[Symbol.toStringTag](){return"Texture"}static isSupported(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{format:n,linearFiltering:i}=e;let s=!0;return n&&(s=s&&v7(t,n),s=s&&(!i||b7(t,n))),s}constructor(t,e){const{id:n=Lu("texture"),handle:i,target:s}=e;super(t,{id:n,handle:i}),this.target=s,this.textureUnit=void 0,this.loaded=!1,this.width=void 0,this.height=void 0,this.depth=void 0,this.format=void 0,this.type=void 0,this.dataFormat=void 0,this.border=void 0,this.textureUnit=void 0,this.mipmaps=void 0}toString(){return"Texture(".concat(this.id,",").concat(this.width,"x").concat(this.height,")")}initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=t.data;if(e instanceof Promise)return e.then(q=>this.initialize(Object.assign({},t,{pixels:q,data:q}))),this;const n=typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement;if(n&&e.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,e.addEventListener("loadeddata",()=>this.initialize(t)),this;const{pixels:i=null,format:s=6408,border:a=0,recreate:o=!1,parameters:A={},pixelStore:f={},textureUnit:m=void 0}=t;e||(e=i);let{width:_,height:x,dataFormat:B,type:P,compressed:M=!1,mipmaps:k=!0}=t;const{depth:Q=0}=t;return{width:_,height:x,compressed:M,dataFormat:B,type:P}=this._deduceParameters({format:s,type:P,dataFormat:B,compressed:M,data:e,width:_,height:x}),this.width=_,this.height=x,this.depth=Q,this.format=s,this.type=P,this.dataFormat=B,this.border=a,this.textureUnit=m,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),k&&this._isNPOT()&&(yr.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),k=!1,this._updateForNPOT(A)),this.mipmaps=k,this.setImageData({data:e,width:_,height:x,depth:Q,format:s,type:P,dataFormat:B,border:a,mipmaps:k,parameters:f,compressed:M}),k&&this.generateMipmap(),this.setParameters(A),o&&(this.data=e),n&&(this._video={video:e,parameters:A,lastTime:e.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?e.currentTime:-1}),this}update(){if(this._video){const{video:t,parameters:e,lastTime:n}=this._video;if(n===t.currentTime||t.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:t,parameters:e}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=t.currentTime}}resize(t){let{height:e,width:n,mipmaps:i=!1}=t;return n!==this.width||e!==this.height?this.initialize({width:n,height:e,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:i}):this}generateMipmap(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isNPOT()?(yr.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),this):(this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),Qc(this.gl,t,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this)}setImageData(t){this._trackDeallocatedMemory("Texture");const{target:e=this.target,pixels:n=null,level:i=0,format:s=this.format,border:a=this.border,offset:o=0,parameters:A={}}=t;let{data:f=null,type:m=this.type,width:_=this.width,height:x=this.height,dataFormat:B=this.dataFormat,compressed:P=!1}=t;f||(f=n),{type:m,dataFormat:B,compressed:P,width:_,height:x}=this._deduceParameters({format:s,type:m,dataFormat:B,compressed:P,data:f,width:_,height:x});const{gl:M}=this;M.bindTexture(this.target,this.handle);let k=null;({data:f,dataType:k}=this._getDataType({data:f,compressed:P}));let Q,q=0;if(Qc(this.gl,A,()=>{switch(k){case"null":M.texImage2D(e,i,s,_,x,a,B,m,f);break;case"typed-array":M.texImage2D(e,i,s,_,x,a,B,m,f,o);break;case"buffer":Q=Ro(M),Q.bindBuffer(35052,f.handle||f),Q.texImage2D(e,i,s,_,x,a,B,m,o),Q.bindBuffer(35052,null);break;case"browser-object":gn(M)?M.texImage2D(e,i,s,_,x,a,B,m,f):M.texImage2D(e,i,s,B,m,f);break;case"compressed":for(const[J,tt]of f.entries())M.compressedTexImage2D(e,J,tt.format,tt.width,tt.height,a,tt.data),q+=tt.levelSize;break;default:ar(!1,"Unknown image data type")}}),k==="compressed")this._trackAllocatedMemory(q,"Texture");else if(f&&f.byteLength)this._trackAllocatedMemory(f.byteLength,"Texture");else{const J=n5[this.dataFormat]||4,tt=i5[this.type]||1;this._trackAllocatedMemory(this.width*this.height*J*tt,"Texture")}return this.loaded=!0,this}setSubImageData(t){let{target:e=this.target,pixels:n=null,data:i=null,x:s=0,y:a=0,width:o=this.width,height:A=this.height,level:f=0,format:m=this.format,type:_=this.type,dataFormat:x=this.dataFormat,compressed:B=!1,offset:P=0,border:M=this.border,parameters:k={}}=t;if({type:_,dataFormat:x,compressed:B,width:o,height:A}=this._deduceParameters({format:m,type:_,dataFormat:x,compressed:B,data:i,width:o,height:A}),ar(this.depth===0,"texSubImage not supported for 3D textures"),i||(i=n),i&&i.data){const Q=i;i=Q.data,o=Q.shape[0],A=Q.shape[1]}i instanceof ni&&(i=i.handle),this.gl.bindTexture(this.target,this.handle),Qc(this.gl,k,()=>{if(B)this.gl.compressedTexSubImage2D(e,f,s,a,o,A,m,i);else if(i===null)this.gl.texSubImage2D(e,f,s,a,o,A,x,_,null);else if(ArrayBuffer.isView(i))this.gl.texSubImage2D(e,f,s,a,o,A,x,_,i,P);else if(i instanceof s5){const Q=Ro(this.gl);Q.bindBuffer(35052,i),Q.texSubImage2D(e,f,s,a,o,A,x,_,P),Q.bindBuffer(35052,null)}else gn(this.gl)?Ro(this.gl).texSubImage2D(e,f,s,a,o,A,x,_,i):this.gl.texSubImage2D(e,f,s,a,x,_,i)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(){return yr.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:e}=this;return t!==void 0&&(this.textureUnit=t,e.activeTexture(33984+t)),e.bindTexture(this.target,this.handle),t}unbind(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:e}=this;return t!==void 0&&(this.textureUnit=t,e.activeTexture(33984+t)),e.bindTexture(this.target,null),t}_getDataType(t){let{data:e,compressed:n=!1}=t;return n?{data:e,dataType:"compressed"}:e===null?{data:e,dataType:"null"}:ArrayBuffer.isView(e)?{data:e,dataType:"typed-array"}:e instanceof ni?{data:e.handle,dataType:"buffer"}:e instanceof s5?{data:e,dataType:"buffer"}:{data:e,dataType:"browser-object"}}_deduceParameters(t){const{format:e,data:n}=t;let{width:i,height:s,dataFormat:a,type:o,compressed:A}=t;const f=ub[e];return a=a||f&&f.dataFormat,o=o||f&&f.types[0],A=A||f&&f.compressed,{width:i,height:s}=this._deduceImageSize(n,i,s),{dataFormat:a,type:o,compressed:A,width:i,height:s,format:e,data:n}}_deduceImageSize(t,e,n){let i;return typeof ImageData<"u"&&t instanceof ImageData?i={width:t.width,height:t.height}:typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement?i={width:t.naturalWidth,height:t.naturalHeight}:typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement?i={width:t.width,height:t.height}:typeof ImageBitmap<"u"&&t instanceof ImageBitmap?i={width:t.width,height:t.height}:typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement?i={width:t.videoWidth,height:t.videoHeight}:t?i={width:e,height:n}:i={width:e>=0?e:1,height:n>=0?n:1},ar(i,"Could not deduced texture size"),ar(e===void 0||i.width===e,"Deduced texture width does not match supplied width"),ar(n===void 0||i.height===n,"Deduced texture height does not match supplied height"),i}_createHandle(){return this.gl.createTexture()}_deleteHandle(){this.gl.deleteTexture(this.handle),this._trackDeallocatedMemory("Texture")}_getParameter(t){switch(t){case 4096:return this.width;case 4097:return this.height;default:this.gl.bindTexture(this.target,this.handle);const e=this.gl.getTexParameter(this.target,t);return this.gl.bindTexture(this.target,null),e}}_setParameter(t,e){switch(this.gl.bindTexture(this.target,this.handle),e=this._getNPOTParam(t,e),t){case 33082:case 33083:this.gl.texParameterf(this.handle,t,e);break;case 4096:case 4097:ar(!1);break;default:this.gl.texParameteri(this.target,t,e);break}return this.gl.bindTexture(this.target,null),this}_isNPOT(){return gn(this.gl)||!this.width||!this.height?!1:!ZT(this.width)||!ZT(this.height)}_updateForNPOT(t){t[this.gl.TEXTURE_MIN_FILTER]===void 0&&(t[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),t[this.gl.TEXTURE_WRAP_S]===void 0&&(t[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),t[this.gl.TEXTURE_WRAP_T]===void 0&&(t[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}_getNPOTParam(t,e){if(this._isNPOT())switch(t){case 10241:w7.indexOf(e)===-1&&(e=9729);break;case 10242:case 10243:e!==33071&&(e=33071);break}return e}}let x7="";function B7(r,t){return ar(typeof r=="string"),r=x7+r,new Promise((e,n)=>{try{const i=new Image;i.onload=()=>e(i),i.onerror=()=>n(new Error("Could not load image ".concat(r,"."))),i.crossOrigin=t&&t.crossOrigin||"anonymous",i.src=r}catch(i){n(i)}})}class Fa extends Xd{get[Symbol.toStringTag](){return"Texture2D"}static isSupported(t,e){return Xd.isSupported(t,e)}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};v0(t),(e instanceof Promise||typeof e=="string")&&(e={data:e}),typeof e.data=="string"&&(e=Object.assign({},e,{data:B7(e.data)})),super(t,Object.assign({},e,{target:3553})),this.initialize(e),Object.seal(this)}}const Ab=[34069,34070,34071,34072,34073,34074];class o5 extends Xd{get[Symbol.toStringTag](){return"TextureCube"}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};v0(t),super(t,Object.assign({},e,{target:34067})),this.initialize(e),Object.seal(this)}initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{mipmaps:e=!0,parameters:n={}}=t;return this.opts=t,this.setCubeMapImageData(t).then(()=>{this.loaded=!0,e&&this.generateMipmap(t),this.setParameters(n)}),this}subImage(t){let{face:e,data:n,x:i=0,y:s=0,mipmapLevel:a=0}=t;return this._subImage({target:e,data:n,x:i,y:s,mipmapLevel:a})}async setCubeMapImageData(t){let{width:e,height:n,pixels:i,data:s,border:a=0,format:o=6408,type:A=5121}=t;const{gl:f}=this,m=i||s,_=await Promise.all(Ab.map(x=>{const B=m[x];return Promise.all(Array.isArray(B)?B:[B])}));this.bind(),Ab.forEach((x,B)=>{_[B].length>1&&this.opts.mipmaps!==!1&&yr.warn("".concat(this.id," has mipmap and multiple LODs."))(),_[B].forEach((P,M)=>{e&&n?f.texImage2D(x,M,o,e,n,a,o,A,P):f.texImage2D(x,M,o,o,A,P)})}),this.unbind()}setImageDataForFace(t){const{face:e,width:n,height:i,pixels:s,data:a,border:o=0,format:A=6408,type:f=5121}=t,{gl:m}=this,_=s||a;return this.bind(),_ instanceof Promise?_.then(x=>this.setImageDataForFace(Object.assign({},t,{face:e,data:x,pixels:x}))):this.width||this.height?m.texImage2D(e,0,A,n,i,o,A,f,_):m.texImage2D(e,0,A,A,f,_),this}}o5.FACES=Ab;class C7 extends Xd{get[Symbol.toStringTag](){return"Texture3D"}static isSupported(t){return gn(t)}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Ro(t),e=Object.assign({depth:1},e,{target:32879,unpackFlipY:!1}),super(t,e),this.initialize(e),Object.seal(this)}setImageData(t){let{level:e=0,dataFormat:n=6408,width:i,height:s,depth:a=1,border:o=0,format:A,type:f=5121,offset:m=0,data:_,parameters:x={}}=t;if(this._trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle),Qc(this.gl,x,()=>{ArrayBuffer.isView(_)&&this.gl.texImage3D(this.target,e,n,i,s,a,o,A,f,_),_ instanceof ni&&(this.gl.bindBuffer(35052,_.handle),this.gl.texImage3D(this.target,e,n,i,s,a,o,A,f,m))}),_&&_.byteLength)this._trackAllocatedMemory(_.byteLength,"Texture");else{const B=n5[this.dataFormat]||4,P=i5[this.type]||1;this._trackAllocatedMemory(this.width*this.height*this.depth*B*P,"Texture")}return this.loaded=!0,this}}const Dh="EXT_color_buffer_float",a5={33189:{bpp:2},33190:{gl2:!0,bpp:3},36012:{gl2:!0,bpp:4},36168:{bpp:1},34041:{bpp:4},35056:{gl2:!0,bpp:4},36013:{gl2:!0,bpp:5},32854:{bpp:2},36194:{bpp:2},32855:{bpp:2},33321:{gl2:!0,bpp:1},33330:{gl2:!0,bpp:1},33329:{gl2:!0,bpp:1},33332:{gl2:!0,bpp:2},33331:{gl2:!0,bpp:2},33334:{gl2:!0,bpp:4},33333:{gl2:!0,bpp:4},33323:{gl2:!0,bpp:2},33336:{gl2:!0,bpp:2},33335:{gl2:!0,bpp:2},33338:{gl2:!0,bpp:4},33337:{gl2:!0,bpp:4},33340:{gl2:!0,bpp:8},33339:{gl2:!0,bpp:8},32849:{gl2:!0,bpp:3},32856:{gl2:!0,bpp:4},32857:{gl2:!0,bpp:4},36220:{gl2:!0,bpp:4},36238:{gl2:!0,bpp:4},36975:{gl2:!0,bpp:4},36214:{gl2:!0,bpp:8},36232:{gl2:!0,bpp:8},36226:{gl2:!0,bpp:16},36208:{gl2:!0,bpp:16},33325:{gl2:Dh,bpp:2},33327:{gl2:Dh,bpp:4},34842:{gl2:Dh,bpp:8},33326:{gl2:Dh,bpp:4},33328:{gl2:Dh,bpp:8},34836:{gl2:Dh,bpp:16},35898:{gl2:Dh,bpp:4}};function E7(r,t,e){const n=e[t];if(!n)return!1;const i=gn(r)&&n.gl2||n.gl1;return typeof i=="string"?r.getExtension(i):i}class Jd extends Fu{get[Symbol.toStringTag](){return"Renderbuffer"}static isSupported(t){let{format:e}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{format:null};return!e||E7(t,e,a5)}static getSamplesForFormat(t,e){let{format:n}=e;return t.getInternalformatParameter(36161,n,32937)}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(t,e),this.initialize(e),Object.seal(this)}initialize(t){let{format:e,width:n=1,height:i=1,samples:s=0}=t;return ar(e,"Needs format"),this._trackDeallocatedMemory(),this.gl.bindRenderbuffer(36161,this.handle),s!==0&&gn(this.gl)?this.gl.renderbufferStorageMultisample(36161,s,e,n,i):this.gl.renderbufferStorage(36161,e,n,i),this.format=e,this.width=n,this.height=i,this.samples=s,this._trackAllocatedMemory(this.width*this.height*(this.samples||1)*a5[this.format].bpp),this}resize(t){let{width:e,height:n}=t;return e!==this.width||n!==this.height?this.initialize({width:e,height:n,format:this.format,samples:this.samples}):this}_createHandle(){return this.gl.createRenderbuffer()}_deleteHandle(){this.gl.deleteRenderbuffer(this.handle),this._trackDeallocatedMemory()}_bindHandle(t){this.gl.bindRenderbuffer(36161,t)}_syncHandle(t){this.format=this.getParameter(36164),this.width=this.getParameter(36162),this.height=this.getParameter(36163),this.samples=this.getParameter(36011)}_getParameter(t){return this.gl.bindRenderbuffer(36161,this.handle),this.gl.getRenderbufferParameter(36161,t)}}const S7=256,T7=1024,I7=16384,c5=6144,l5=6145,u5=6146,A5=34041,h5="clear: bad arguments";function hb(r){let{framebuffer:t=null,color:e=null,depth:n=null,stencil:i=null}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s={};t&&(s.framebuffer=t);let a=0;e&&(a|=I7,e!==!0&&(s.clearColor=e)),n&&(a|=S7,n!==!0&&(s.clearDepth=n)),i&&(a|=T7,n!==!0&&(s.clearStencil=n)),ar(a!==0,h5),Qc(r,s,()=>{r.clear(a)})}function L7(r){let{framebuffer:t=null,buffer:e=c5,drawBuffer:n=0,value:i=[0,0,0,0]}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Ro(r),Qc(r,{framebuffer:t},()=>{switch(e){case c5:switch(i.constructor){case Int32Array:r.clearBufferiv(e,n,i);break;case Uint32Array:r.clearBufferuiv(e,n,i);break;case Float32Array:default:r.clearBufferfv(e,n,i)}break;case l5:r.clearBufferfv(l5,0,[i]);break;case u5:r.clearBufferiv(u5,0,[i]);break;case A5:const[s,a]=i;r.clearBufferfi(A5,0,s,a);break;default:ar(!1,h5)}})}function F7(r){switch(r){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return ar(!1),0}}function b0(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{sourceX:e=0,sourceY:n=0,sourceFormat:i=6408}=t;let{sourceAttachment:s=36064,target:a=null,sourceWidth:o,sourceHeight:A,sourceType:f}=t;const{framebuffer:m,deleteFramebuffer:_}=P7(r);ar(m);const{gl:x,handle:B,attachments:P}=m;o=o||m.width,A=A||m.height,s===36064&&B===null&&(s=1028),ar(P[s]),f=f||P[s].type,a=M7(a,f,i,o,A),f=f||cb(a);const M=x.bindFramebuffer(36160,B);return x.readPixels(e,n,o,A,i,f,a),x.bindFramebuffer(36160,M||null),_&&m.delete(),a}function d5(r){let{sourceAttachment:t=36064,targetMaxHeight:e=Number.MAX_SAFE_INTEGER}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=b0(r,{sourceAttachment:t}),{width:i,height:s}=r;for(;s>e;)({data:n,width:i,height:s}=p7({data:n,width:i,height:s}));f7({data:n,width:i,height:s});const a=document.createElement("canvas");a.width=i,a.height=s;const o=a.getContext("2d"),A=o.createImageData(i,s);return A.data.set(n),o.putImageData(A,0,0),a.toDataURL()}function P7(r){return r instanceof xs?{framebuffer:r,deleteFramebuffer:!1}:{framebuffer:z7(r),deleteFramebuffer:!0}}function M7(r,t,e,n,i){if(r)return r;t=t||5121;const s=tg(t,{clamped:!1}),a=F7(e);return new s(n*i*a)}const mi={WEBGL2:"WEBGL2",VERTEX_ARRAY_OBJECT:"VERTEX_ARRAY_OBJECT",TIMER_QUERY:"TIMER_QUERY",INSTANCED_RENDERING:"INSTANCED_RENDERING",MULTIPLE_RENDER_TARGETS:"MULTIPLE_RENDER_TARGETS",ELEMENT_INDEX_UINT32:"ELEMENT_INDEX_UINT32",BLEND_EQUATION_MINMAX:"BLEND_EQUATION_MINMAX",FLOAT_BLEND:"FLOAT_BLEND",COLOR_ENCODING_SRGB:"COLOR_ENCODING_SRGB",TEXTURE_DEPTH:"TEXTURE_DEPTH",TEXTURE_FLOAT:"TEXTURE_FLOAT",TEXTURE_HALF_FLOAT:"TEXTURE_HALF_FLOAT",TEXTURE_FILTER_LINEAR_FLOAT:"TEXTURE_FILTER_LINEAR_FLOAT",TEXTURE_FILTER_LINEAR_HALF_FLOAT:"TEXTURE_FILTER_LINEAR_HALF_FLOAT",TEXTURE_FILTER_ANISOTROPIC:"TEXTURE_FILTER_ANISOTROPIC",COLOR_ATTACHMENT_RGBA32F:"COLOR_ATTACHMENT_RGBA32F",COLOR_ATTACHMENT_FLOAT:"COLOR_ATTACHMENT_FLOAT",COLOR_ATTACHMENT_HALF_FLOAT:"COLOR_ATTACHMENT_HALF_FLOAT",GLSL_FRAG_DATA:"GLSL_FRAG_DATA",GLSL_FRAG_DEPTH:"GLSL_FRAG_DEPTH",GLSL_DERIVATIVES:"GLSL_DERIVATIVES",GLSL_TEXTURE_LOD:"GLSL_TEXTURE_LOD"};function U7(r){const t=new Fa(r,{format:6408,type:5126,dataFormat:6408}),e=new xs(r,{id:"test-framebuffer",check:!1,attachments:{36064:t}}),n=e.getStatus();return t.delete(),e.delete(),n===36053}const f5={[mi.WEBGL2]:[!1,!0],[mi.VERTEX_ARRAY_OBJECT]:["OES_vertex_array_object",!0],[mi.TIMER_QUERY]:["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"],[mi.INSTANCED_RENDERING]:["ANGLE_instanced_arrays",!0],[mi.MULTIPLE_RENDER_TARGETS]:["WEBGL_draw_buffers",!0],[mi.ELEMENT_INDEX_UINT32]:["OES_element_index_uint",!0],[mi.BLEND_EQUATION_MINMAX]:["EXT_blend_minmax",!0],[mi.FLOAT_BLEND]:["EXT_float_blend"],[mi.COLOR_ENCODING_SRGB]:["EXT_sRGB",!0],[mi.TEXTURE_DEPTH]:["WEBGL_depth_texture",!0],[mi.TEXTURE_FLOAT]:["OES_texture_float",!0],[mi.TEXTURE_HALF_FLOAT]:["OES_texture_half_float",!0],[mi.TEXTURE_FILTER_LINEAR_FLOAT]:["OES_texture_float_linear"],[mi.TEXTURE_FILTER_LINEAR_HALF_FLOAT]:["OES_texture_half_float_linear"],[mi.TEXTURE_FILTER_ANISOTROPIC]:["EXT_texture_filter_anisotropic"],[mi.COLOR_ATTACHMENT_RGBA32F]:[U7,"EXT_color_buffer_float"],[mi.COLOR_ATTACHMENT_FLOAT]:[!1,"EXT_color_buffer_float"],[mi.COLOR_ATTACHMENT_HALF_FLOAT]:["EXT_color_buffer_half_float"],[mi.GLSL_FRAG_DATA]:["WEBGL_draw_buffers",!0],[mi.GLSL_FRAG_DEPTH]:["EXT_frag_depth",!0],[mi.GLSL_DERIVATIVES]:["OES_standard_derivatives",!0],[mi.GLSL_TEXTURE_LOD]:["EXT_shader_texture_lod",!0]},R7=2;function db(r,t){return p5(r,t)}function p5(r,t){return t=Array.isArray(t)?t:[t],t.every(e=>g5(r,e))}function O7(r){r.luma=r.luma||{},r.luma.caps=r.luma.caps||{};for(const t in f5)r.luma.caps[t]===void 0&&(r.luma.caps[t]=g5(r,t));return r.luma.caps}function g5(r,t){return r.luma=r.luma||{},r.luma.caps=r.luma.caps||{},r.luma.caps[t]===void 0&&(r.luma.caps[t]=D7(r,t)),r.luma.caps[t]||yr.log(R7,"Feature: ".concat(t," not supported"))(),r.luma.caps[t]}function D7(r,t){const e=f5[t];ar(e,t);let n;const i=gn(r)&&e[1]||e[0];if(typeof i=="function")n=i(r);else if(Array.isArray(i)){n=!0;for(const s of i)n=n&&!!r.getExtension(s)}else typeof i=="string"?n=!!r.getExtension(i):typeof i=="boolean"?n=i:ar(!1);return n}const m5="Multiple render targets not supported";class xs extends Fu{get[Symbol.toStringTag](){return"Framebuffer"}static isSupported(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{colorBufferFloat:n,colorBufferHalfFloat:i}=e;let s=!0;return n&&(s=!!(t.getExtension("EXT_color_buffer_float")||t.getExtension("WEBGL_color_buffer_float")||t.getExtension("OES_texture_float"))),i&&(s=s&&!!(t.getExtension("EXT_color_buffer_float")||t.getExtension("EXT_color_buffer_half_float"))),s}static getDefaultFramebuffer(t){return t.luma=t.luma||{},t.luma.defaultFramebuffer=t.luma.defaultFramebuffer||new xs(t,{id:"default-framebuffer",handle:null,attachments:{}}),t.luma.defaultFramebuffer}get MAX_COLOR_ATTACHMENTS(){const t=Ro(this.gl);return t.getParameter(t.MAX_COLOR_ATTACHMENTS)}get MAX_DRAW_BUFFERS(){const t=Ro(this.gl);return t.getParameter(t.MAX_DRAW_BUFFERS)}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(t,e),this.width=null,this.height=null,this.attachments={},this.readBuffer=36064,this.drawBuffers=[36064],this.ownResources=[],this.initialize(e),Object.seal(this)}get color(){return this.attachments[36064]||null}get texture(){return this.attachments[36064]||null}get depth(){return this.attachments[36096]||this.attachments[33306]||null}get stencil(){return this.attachments[36128]||this.attachments[33306]||null}initialize(t){let{width:e=1,height:n=1,attachments:i=null,color:s=!0,depth:a=!0,stencil:o=!1,check:A=!0,readBuffer:f=void 0,drawBuffers:m=void 0}=t;if(ar(e>=0&&n>=0,"Width and height need to be integers"),this.width=e,this.height=n,i)for(const _ in i){const x=i[_];(Array.isArray(x)?x[0]:x).resize({width:e,height:n})}else i=this._createDefaultAttachments(s,a,o,e,n);this.update({clearAttachments:!0,attachments:i,readBuffer:f,drawBuffers:m}),i&&A&&this.checkStatus()}delete(){for(const t of this.ownResources)t.delete();return super.delete(),this}update(t){let{attachments:e={},readBuffer:n,drawBuffers:i,clearAttachments:s=!1,resizeAttachments:a=!0}=t;this.attach(e,{clearAttachments:s,resizeAttachments:a});const{gl:o}=this,A=o.bindFramebuffer(36160,this.handle);return n&&this._setReadBuffer(n),i&&this._setDrawBuffers(i),o.bindFramebuffer(36160,A||null),this}resize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{width:e,height:n}=t;if(this.handle===null)return ar(e===void 0&&n===void 0),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;e===void 0&&(e=this.gl.drawingBufferWidth),n===void 0&&(n=this.gl.drawingBufferHeight),e!==this.width&&n!==this.height&&yr.log(2,"Resizing framebuffer ".concat(this.id," to ").concat(e,"x").concat(n))();for(const i in this.attachments)this.attachments[i].resize({width:e,height:n});return this.width=e,this.height=n,this}attach(t){let{clearAttachments:e=!1,resizeAttachments:n=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i={};e&&Object.keys(this.attachments).forEach(a=>{i[a]=null}),Object.assign(i,t);const s=this.gl.bindFramebuffer(36160,this.handle);for(const a in i){ar(a!==void 0,"Misspelled framebuffer binding point?");const o=Number(a),A=i[o];let f=A;if(!f)this._unattach(o);else if(f instanceof Jd)this._attachRenderbuffer({attachment:o,renderbuffer:f});else if(Array.isArray(A)){const[m,_=0,x=0]=A;f=m,this._attachTexture({attachment:o,texture:m,layer:_,level:x})}else this._attachTexture({attachment:o,texture:f,layer:0,level:0});n&&f&&f.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(36160,s||null),Object.assign(this.attachments,t),Object.keys(this.attachments).filter(a=>!this.attachments[a]).forEach(a=>{delete this.attachments[a]})}checkStatus(){const t=this.getStatus();if(t!==36053)throw new Error(k7(t));return this}getStatus(){const{gl:t}=this,e=t.bindFramebuffer(36160,this.handle),n=t.checkFramebufferStatus(36160);return t.bindFramebuffer(36160,e||null),n}clear(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{color:e,depth:n,stencil:i,drawBuffers:s=[]}=t,a=this.gl.bindFramebuffer(36160,this.handle);return(e||n||i)&&hb(this.gl,{color:e,depth:n,stencil:i}),s.forEach((o,A)=>{L7(this.gl,{drawBuffer:A,value:o})}),this.gl.bindFramebuffer(36160,a||null),this}readPixels(){return yr.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")(),null}readPixelsToBuffer(){return yr.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")(),null}copyToDataUrl(){return yr.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")(),null}copyToImage(){return yr.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")(),null}copyToTexture(){return yr.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}blit(){return yr.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")(),null}invalidate(t){let{attachments:e=[],x:n=0,y:i=0,width:s,height:a}=t;const o=Ro(this.gl),A=o.bindFramebuffer(36008,this.handle);return n===0&&i===0&&s===void 0&&a===void 0?o.invalidateFramebuffer(36008,e):o.invalidateFramebuffer(36008,e,n,i,s,a),o.bindFramebuffer(36008,A),this}getAttachmentParameter(t,e,n){let i=this._getAttachmentParameterFallback(e);return i===null&&(this.gl.bindFramebuffer(36160,this.handle),i=this.gl.getFramebufferAttachmentParameter(36160,t,e),this.gl.bindFramebuffer(36160,null)),n&&i>1e3&&(i=FA(this.gl,i)),i}getAttachmentParameters(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:36064,e=arguments.length>1?arguments[1]:void 0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.constructor.ATTACHMENT_PARAMETERS||[];const i={};for(const s of n){const a=e?FA(this.gl,s):s;i[a]=this.getAttachmentParameter(t,s,e)}return i}getParameters(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;const e=Object.keys(this.attachments),n={};for(const i of e){const s=Number(i),a=t?FA(this.gl,s):s;n[a]=this.getAttachmentParameters(s,t)}return n}show(){return typeof window<"u"&&window.open(d5(this),"luma-debug-texture"),this}log(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(t>yr.level||typeof window>"u")return this;e=e||"Framebuffer ".concat(this.id);const n=d5(this,{targetMaxHeight:100});return yr.image({logLevel:t,message:e,image:n},e)(),this}bind(){let{target:t=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(t,this.handle),this}unbind(){let{target:t=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(t,null),this}_createDefaultAttachments(t,e,n,i,s){let a=null;return t&&(a=a||{},a[36064]=new Fa(this.gl,{id:"".concat(this.id,"-color0"),pixels:null,format:6408,type:5121,width:i,height:s,mipmaps:!1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.ownResources.push(a[36064])),e&&n?(a=a||{},a[33306]=new Jd(this.gl,{id:"".concat(this.id,"-depth-stencil"),format:35056,width:i,height:111}),this.ownResources.push(a[33306])):e?(a=a||{},a[36096]=new Jd(this.gl,{id:"".concat(this.id,"-depth"),format:33189,width:i,height:s}),this.ownResources.push(a[36096])):n&&ar(!1),a}_unattach(t){const e=this.attachments[t];e&&(e instanceof Jd?this.gl.framebufferRenderbuffer(36160,t,36161,null):this.gl.framebufferTexture2D(36160,t,3553,null,0),delete this.attachments[t])}_attachRenderbuffer(t){let{attachment:e=36064,renderbuffer:n}=t;const{gl:i}=this;i.framebufferRenderbuffer(36160,e,36161,n.handle),this.attachments[e]=n}_attachTexture(t){let{attachment:e=36064,texture:n,layer:i,level:s}=t;const{gl:a}=this;switch(a.bindTexture(n.target,n.handle),n.target){case 35866:case 32879:Ro(a).framebufferTextureLayer(36160,e,n.target,s,i);break;case 34067:const A=N7(i);a.framebufferTexture2D(36160,e,A,n.handle,s);break;case 3553:a.framebufferTexture2D(36160,e,3553,n.handle,s);break;default:ar(!1,"Illegal texture type")}a.bindTexture(n.target,null),this.attachments[e]=n}_setReadBuffer(t){const e=fz(this.gl);e?e.readBuffer(t):ar(t===36064||t===1029,m5),this.readBuffer=t}_setDrawBuffers(t){const{gl:e}=this,n=Ro(e);if(n)n.drawBuffers(t);else{const i=e.getExtension("WEBGL_draw_buffers");i?i.drawBuffersWEBGL(t):ar(t.length===1&&(t[0]===36064||t[0]===1029),m5)}this.drawBuffers=t}_getAttachmentParameterFallback(t){const e=O7(this.gl);switch(t){case 36052:return e.WEBGL2?null:0;case 33298:case 33299:case 33300:case 33301:case 33302:case 33303:return e.WEBGL2?null:8;case 33297:return e.WEBGL2?null:5125;case 33296:return!e.WEBGL2&&!e.EXT_sRGB?9729:null;default:return null}}_createHandle(){return this.gl.createFramebuffer()}_deleteHandle(){this.gl.deleteFramebuffer(this.handle)}_bindHandle(t){return this.gl.bindFramebuffer(36160,t)}}function N7(r){return r<34069?r+34069:r}function k7(r){return(xs.STATUS||{})[r]||"Framebuffer error ".concat(r)}const Q7=[36049,36048,33296,33298,33299,33300,33301,33302,33303];xs.ATTACHMENT_PARAMETERS=Q7;function H7(r,t){ar(r instanceof Fa||r instanceof o5||r instanceof C7);const e=r.constructor,{gl:n,width:i,height:s,format:a,type:o,dataFormat:A,border:f,mipmaps:m}=r,_=Object.assign({width:i,height:s,format:a,type:o,dataFormat:A,border:f,mipmaps:m},t);return new e(n,_)}function z7(r,t){const{gl:e,width:n,height:i,id:s}=r;return new xs(e,Object.assign({},t,{id:"framebuffer-for-".concat(s),width:n,height:i,attachments:{36064:r}}))}function w0(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"unnamed";const e=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/,n=r.match(e);return n?n[1]:t}const G7=35632,V7=35633;function j7(r){switch(r){case G7:return"fragment";case V7:return"vertex";default:return"unknown type"}}function q7(r,t,e,n){const i=r.split(/\r?\n/),s={},a={},o=n||w0(t)||"(unnamed)",A="".concat(j7(e)," shader ").concat(o);for(let m=0;m<i.length;m++){const _=i[m];if(_.length<=1)continue;const x=_.split(":"),B=x[0],P=parseInt(x[2],10);if(isNaN(P))throw new Error("GLSL compilation error in ".concat(A,": ").concat(r));B!=="WARNING"?s[P]=_:a[P]=_}const f=K7(t);return{shaderName:A,errors:y5(s,f),warnings:y5(a,f)}}function y5(r,t){let e="";for(let n=0;n<t.length;n++){const i=t[n];if(!(!r[n+3]&&!r[n+2]&&!r[n+1])&&(e+="".concat(i,`
`),r[n+1])){const s=r[n+1],a=s.split(":",3),o=a[0],A=parseInt(a[1],10)||0,f=s.substring(a.join(":").length+1).trim();e+=_5("^^^ ".concat(o,": ").concat(f,`

`),A)}}return e}function K7(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:": ";const n=r.split(/\r?\n/),i=String(n.length+t-1).length;return n.map((s,a)=>{const o=String(a+t),A=o.length;return _5(o,i-A)+e+s})}function _5(r,t){let e="";for(let n=0;n<t;++n)e+=" ";return"".concat(e).concat(r)}function v5(r){let t=100;const e=r.match(/[^\s]+/g);if(e.length>=2&&e[0]==="#version"){const n=parseInt(e[1],10);Number.isFinite(n)&&(t=n)}return t}const $7="Shader: GLSL source code must be a JavaScript string";class eg extends Fu{get[Symbol.toStringTag](){return"Shader"}static getTypeName(t){switch(t){case 35633:return"vertex-shader";case 35632:return"fragment-shader";default:return ar(!1),"unknown"}}constructor(t,e){v0(t),ar(typeof e.source=="string",$7);const n=w0(e.source,null)||e.id||Lu("unnamed ".concat(eg.getTypeName(e.shaderType)));super(t,{id:n}),this.shaderType=e.shaderType,this.source=e.source,this.initialize(e)}initialize(t){let{source:e}=t;const n=w0(e,null);n&&(this.id=Lu(n)),this._compile(e)}getParameter(t){return this.gl.getShaderParameter(this.handle,t)}toString(){return"".concat(eg.getTypeName(this.shaderType),":").concat(this.id)}getName(){return w0(this.source)||"unnamed-shader"}getSource(){return this.gl.getShaderSource(this.handle)}getTranslatedSource(){const t=this.gl.getExtension("WEBGL_debug_shaders");return t?t.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL_debug_shaders not implemented"}_compile(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.source;if(t.startsWith("#version ")||(t=`#version 100
`.concat(t)),this.source=t,this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle),!this.getParameter(35713)){const n=this.gl.getShaderInfoLog(this.handle),{shaderName:i,errors:s,warnings:a}=q7(n,this.source,this.shaderType,this.id);throw yr.error("GLSL compilation errors in ".concat(i,`
`).concat(s))(),yr.warn("GLSL compilation warnings in ".concat(i,`
`).concat(a))(),new Error("GLSL compilation errors in ".concat(i))}}_deleteHandle(){this.gl.deleteShader(this.handle)}_getOptsFromHandle(){return{type:this.getParameter(35663),source:this.getSource()}}}class fb extends eg{get[Symbol.toStringTag](){return"VertexShader"}constructor(t,e){typeof e=="string"&&(e={source:e}),super(t,Object.assign({},e,{shaderType:35633}))}_createHandle(){return this.gl.createShader(35633)}}class pb extends eg{get[Symbol.toStringTag](){return"FragmentShader"}constructor(t,e){typeof e=="string"&&(e={source:e}),super(t,Object.assign({},e,{shaderType:35632}))}_createHandle(){return this.gl.createShader(35632)}}const W7={5126:bi.bind(null,"uniform1fv",Pa,1,uo),35664:bi.bind(null,"uniform2fv",Pa,2,uo),35665:bi.bind(null,"uniform3fv",Pa,3,uo),35666:bi.bind(null,"uniform4fv",Pa,4,uo),5124:bi.bind(null,"uniform1iv",PA,1,uo),35667:bi.bind(null,"uniform2iv",PA,2,uo),35668:bi.bind(null,"uniform3iv",PA,3,uo),35669:bi.bind(null,"uniform4iv",PA,4,uo),35670:bi.bind(null,"uniform1iv",PA,1,uo),35671:bi.bind(null,"uniform2iv",PA,2,uo),35672:bi.bind(null,"uniform3iv",PA,3,uo),35673:bi.bind(null,"uniform4iv",PA,4,uo),35674:bi.bind(null,"uniformMatrix2fv",Pa,4,Pu),35675:bi.bind(null,"uniformMatrix3fv",Pa,9,Pu),35676:bi.bind(null,"uniformMatrix4fv",Pa,16,Pu),35678:$s,35680:$s,5125:bi.bind(null,"uniform1uiv",x0,1,uo),36294:bi.bind(null,"uniform2uiv",x0,2,uo),36295:bi.bind(null,"uniform3uiv",x0,3,uo),36296:bi.bind(null,"uniform4uiv",x0,4,uo),35685:bi.bind(null,"uniformMatrix2x3fv",Pa,6,Pu),35686:bi.bind(null,"uniformMatrix2x4fv",Pa,8,Pu),35687:bi.bind(null,"uniformMatrix3x2fv",Pa,6,Pu),35688:bi.bind(null,"uniformMatrix3x4fv",Pa,12,Pu),35689:bi.bind(null,"uniformMatrix4x2fv",Pa,8,Pu),35690:bi.bind(null,"uniformMatrix4x3fv",Pa,12,Pu),35678:$s,35680:$s,35679:$s,35682:$s,36289:$s,36292:$s,36293:$s,36298:$s,36299:$s,36300:$s,36303:$s,36306:$s,36307:$s,36308:$s,36311:$s},X7={},J7={},Y7={},b5=[0];function gb(r,t,e,n){t===1&&typeof r=="boolean"&&(r=r?1:0),Number.isFinite(r)&&(b5[0]=r,r=b5);const i=r.length;if(i%t&&yr.warn("Uniform size should be multiples of ".concat(t),r)(),r instanceof e)return r;let s=n[i];s||(s=new e(i),n[i]=s);for(let a=0;a<i;a++)s[a]=r[a];return s}function Pa(r,t){return gb(r,t,Float32Array,X7)}function PA(r,t){return gb(r,t,Int32Array,J7)}function x0(r,t){return gb(r,t,Uint32Array,Y7)}function w5(r,t,e){const n=W7[e.type];if(!n)throw new Error("Unknown GLSL uniform type ".concat(e.type));return n().bind(null,r,t)}function Z7(r){if(r[r.length-1]!=="]")return{name:r,length:1,isArray:!1};const t=/([^[]*)(\[[0-9]+\])?/,e=r.match(t);if(!e||e.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(r));return{name:e[1],length:e[2]||1,isArray:!!e[2]}}function t9(r,t,e){for(const n in r){const i=r[n];if((!e||!!e[n])&&!e9(i))throw t=t?"".concat(t," "):"",console.error("".concat(t," Bad uniform ").concat(n),i),new Error("".concat(t," Bad uniform ").concat(n))}return!0}function e9(r){return Array.isArray(r)||ArrayBuffer.isView(r)?n9(r):isFinite(r)||r===!0||r===!1||r instanceof Xd||r instanceof Jd?!0:r instanceof xs?!!r.texture:!1}function r9(r,t,e){if(Array.isArray(e)||ArrayBuffer.isView(e))if(r[t]){const n=r[t];for(let i=0,s=e.length;i<s;++i)n[i]=e[i]}else r[t]=e.slice();else r[t]=e}function n9(r){if(r.length===0)return!1;const t=Math.min(r.length,16);for(let e=0;e<t;++e)if(!Number.isFinite(r[e]))return!1;return!0}function $s(){let r=null;return(t,e,n)=>{const i=r!==n;return i&&(t.uniform1i(e,n),r=n),i}}function bi(r,t,e,n){let i=null,s=null;return(a,o,A)=>{const f=t(A,e),m=f.length;let _=!1;if(i===null)i=new Float32Array(m),s=m,_=!0;else{ar(s===m,"Uniform length cannot change.");for(let x=0;x<m;++x)if(f[x]!==i[x]){_=!0;break}}return _&&(n(a,r,o,f),i.set(f)),_}}function uo(r,t,e,n){r[t](e,n)}function Pu(r,t,e,n){r[t](e,!1,n)}const i9=5120,s9=5121,o9=5122,a9=5123,x5=0,B0=1,c9=2,l9=3,C0=4,u9=5,A9=6,Bs=5126,h9=35664,d9=35665,f9=35666,rg=5124,p9=35667,g9=35668,m9=35669,ng=5125,y9=36294,_9=36295,v9=36296,b9=35670,w9=35671,x9=35672,B9=35673,C9=35674,E9=35675,S9=35676,T9=35685,I9=35686,L9=35687,F9=35688,P9=35689,M9=35690,mb={[Bs]:[Bs,1,"float"],[h9]:[Bs,2,"vec2"],[d9]:[Bs,3,"vec3"],[f9]:[Bs,4,"vec4"],[rg]:[rg,1,"int"],[p9]:[rg,2,"ivec2"],[g9]:[rg,3,"ivec3"],[m9]:[rg,4,"ivec4"],[ng]:[ng,1,"uint"],[y9]:[ng,2,"uvec2"],[_9]:[ng,3,"uvec3"],[v9]:[ng,4,"uvec4"],[b9]:[Bs,1,"bool"],[w9]:[Bs,2,"bvec2"],[x9]:[Bs,3,"bvec3"],[B9]:[Bs,4,"bvec4"],[C9]:[Bs,8,"mat2"],[T9]:[Bs,8,"mat2x3"],[I9]:[Bs,8,"mat2x4"],[E9]:[Bs,12,"mat3"],[L9]:[Bs,12,"mat3x2"],[F9]:[Bs,12,"mat3x4"],[S9]:[Bs,16,"mat4"],[P9]:[Bs,16,"mat4x2"],[M9]:[Bs,16,"mat4x3"]};function U9(r){switch(r){case x5:return x5;case B0:return B0;case l9:return B0;case c9:return B0;case C0:return C0;case u9:return C0;case A9:return C0;default:return ar(!1),0}}function B5(r){const t=mb[r];if(!t)return null;const[e,n]=t;return{type:e,components:n}}function C5(r,t){switch(r){case i9:case s9:case o9:case a9:r=Bs;break}for(const e in mb){const[n,i,s]=mb[e];if(n===r&&i===t)return{glType:e,name:s}}return null}class R9{constructor(t){this.id=t.id,this.attributeInfos=[],this.attributeInfosByName={},this.attributeInfosByLocation=[],this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(t),this._readVaryingsFromProgram(t)}getAttributeInfo(t){const e=Number(t);return Number.isFinite(e)?this.attributeInfosByLocation[e]:this.attributeInfosByName[t]||null}getAttributeLocation(t){const e=this.getAttributeInfo(t);return e?e.location:-1}getAttributeAccessor(t){const e=this.getAttributeInfo(t);return e?e.accessor:null}getVaryingInfo(t){const e=Number(t);return Number.isFinite(e)?this.varyingInfos[e]:this.varyingInfosByName[t]||null}getVaryingIndex(t){const e=this.getVaryingInfo();return e?e.location:-1}getVaryingAccessor(t){const e=this.getVaryingInfo();return e?e.accessor:null}_readAttributesFromProgram(t){const{gl:e}=t,n=e.getProgramParameter(t.handle,35721);for(let i=0;i<n;i++){const{name:s,type:a,size:o}=e.getActiveAttrib(t.handle,i),A=e.getAttribLocation(t.handle,s);A>=0&&this._addAttribute(A,s,a,o)}this.attributeInfos.sort((i,s)=>i.location-s.location)}_readVaryingsFromProgram(t){const{gl:e}=t;if(!gn(e))return;const n=e.getProgramParameter(t.handle,35971);for(let i=0;i<n;i++){const{name:s,type:a,size:o}=e.getTransformFeedbackVarying(t.handle,i);this._addVarying(i,s,a,o)}this.varyingInfos.sort((i,s)=>i.location-s.location)}_addAttribute(t,e,n,i){const{type:s,components:a}=B5(n),o={type:s,size:i*a};this._inferProperties(t,e,o);const A={location:t,name:e,accessor:new la(o)};this.attributeInfos.push(A),this.attributeInfosByLocation[t]=A,this.attributeInfosByName[A.name]=A}_inferProperties(t,e,n){/instance/i.test(e)&&(n.divisor=1)}_addVarying(t,e,n,i){const{type:s,components:a}=B5(n),o=new la({type:s,size:i*a}),A={location:t,name:e,accessor:o};this.varyingInfos.push(A),this.varyingInfosByName[A.name]=A}}const E5=4,O9=35981,D9=["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"];class S5 extends Fu{get[Symbol.toStringTag](){return"Program"}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(t,e),this.stubRemovedMethods("Program","v6.0",D9),this._isCached=!1,this.initialize(e),Object.seal(this),this._setId(e.id)}initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{hash:e,vs:n,fs:i,varyings:s,bufferMode:a=O9}=t;return this.hash=e||"",this.vs=typeof n=="string"?new fb(this.gl,{id:"".concat(t.id,"-vs"),source:n}):n,this.fs=typeof i=="string"?new pb(this.gl,{id:"".concat(t.id,"-fs"),source:i}):i,ar(this.vs instanceof fb),ar(this.fs instanceof pb),this.uniforms={},this._textureUniforms={},s&&s.length>0&&(Ro(this.gl),this.varyings=s,this.gl2.transformFeedbackVaryings(this.handle,s,a)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new R9(this),this.setProps(t)}delete(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isCached?this:super.delete(t)}setProps(t){return"uniforms"in t&&this.setUniforms(t.uniforms),this}draw(t){let{logPriority:e,drawMode:n=4,vertexCount:i,offset:s=0,start:a,end:o,isIndexed:A=!1,indexType:f=5123,instanceCount:m=0,isInstanced:_=m>0,vertexArray:x=null,transformFeedback:B,framebuffer:P,parameters:M={},uniforms:k,samplers:Q}=t;if((k||Q)&&(yr.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(k||{})),yr.priority>=e){const q=P?P.id:"default",J="mode=".concat(FA(this.gl,n)," verts=").concat(i," ")+"instances=".concat(m," indexType=").concat(FA(this.gl,f)," ")+"isInstanced=".concat(_," isIndexed=").concat(A," ")+"Framebuffer=".concat(q);yr.log(e,J)()}return ar(x),this.gl.useProgram(this.handle),!this._areTexturesRenderable()||i===0||_&&m===0?!1:(x.bindForDraw(i,m,()=>{if(P!==void 0&&(M=Object.assign({},M,{framebuffer:P})),B){const q=U9(n);B.begin(q)}this._bindTextures(),Qc(this.gl,M,()=>{A&&_?this.gl2.drawElementsInstanced(n,i,f,s,m):A&&gn(this.gl)&&!isNaN(a)&&!isNaN(o)?this.gl2.drawRangeElements(n,a,o,i,f,s):A?this.gl.drawElements(n,i,f,s):_?this.gl2.drawArraysInstanced(n,s,i,m):this.gl.drawArrays(n,s,i)}),B&&B.end()}),!0)}setUniforms(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};yr.priority>=2&&t9(t,this.id,this._uniformSetters),this.gl.useProgram(this.handle);for(const e in t){const n=t[e],i=this._uniformSetters[e];if(i){let s=n,a=!1;if(s instanceof xs&&(s=s.texture),s instanceof Xd)if(a=this.uniforms[e]!==n,a){i.textureIndex===void 0&&(i.textureIndex=this._textureIndexCounter++);const o=s,{textureIndex:A}=i;o.bind(A),s=A,this._textureUniforms[e]=o}else s=i.textureIndex;else this._textureUniforms[e]&&delete this._textureUniforms[e];(i(s)||a)&&r9(this.uniforms,e,n)}}return this}_areTexturesRenderable(){let t=!0;for(const e in this._textureUniforms){const n=this._textureUniforms[e];n.update(),t=t&&n.loaded}return t}_bindTextures(){for(const t in this._textureUniforms){const e=this._uniformSetters[t].textureIndex;this._textureUniforms[t].bind(e)}}_createHandle(){return this.gl.createProgram()}_deleteHandle(){this.gl.deleteProgram(this.handle)}_getOptionsFromHandle(t){const e=this.gl.getAttachedShaders(t),n={};for(const i of e)switch(this.gl.getShaderParameter(this.handle,35663)){case 35633:n.vs=new fb({handle:i});break;case 35632:n.fs=new pb({handle:i});break}return n}_getParameter(t){return this.gl.getProgramParameter(this.handle,t)}_setId(t){if(!t){const e=this._getName();this.id=Lu(e)}}_getName(){let t=this.vs.getName()||this.fs.getName();return t=t.replace(/shader/i,""),t=t?"".concat(t,"-program"):"program",t}_compileAndLink(){const{gl:t}=this;if(t.attachShader(this.handle,this.vs.handle),t.attachShader(this.handle,this.fs.handle),yr.time(E5,"linkProgram for ".concat(this._getName()))(),t.linkProgram(this.handle),yr.timeEnd(E5,"linkProgram for ".concat(this._getName()))(),t.debug||yr.level>0){if(!t.getProgramParameter(this.handle,35714))throw new Error("Error linking: ".concat(t.getProgramInfoLog(this.handle)));if(t.validateProgram(this.handle),!t.getProgramParameter(this.handle,35715))throw new Error("Error validating: ".concat(t.getProgramInfoLog(this.handle)))}}_readUniformLocationsFromLinkedProgram(){const{gl:t}=this;this._uniformSetters={},this._uniformCount=this._getParameter(35718);for(let e=0;e<this._uniformCount;e++){const n=this.gl.getActiveUniform(this.handle,e),{name:i}=Z7(n.name);let s=t.getUniformLocation(this.handle,i);if(this._uniformSetters[i]=w5(t,s,n),n.size>1)for(let a=0;a<n.size;a++)s=t.getUniformLocation(this.handle,"".concat(i,"[").concat(a,"]")),this._uniformSetters["".concat(i,"[").concat(a,"]")]=w5(t,s,n)}this._textureIndexCounter=0}getActiveUniforms(t,e){return this.gl2.getActiveUniforms(this.handle,t,e)}getUniformBlockIndex(t){return this.gl2.getUniformBlockIndex(this.handle,t)}getActiveUniformBlockParameter(t,e){return this.gl2.getActiveUniformBlockParameter(this.handle,t,e)}uniformBlockBinding(t,e){this.gl2.uniformBlockBinding(this.handle,t,e)}}const N9=34918,k9=34919,Q9=35007,H9=36795,z9=35976,G9=35887,V9=36202;class E0 extends Fu{get[Symbol.toStringTag](){return"Query"}static isSupported(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const n=gn(t),i=p5(t,mi.TIMER_QUERY);let s=n||i;for(const a of e)switch(a){case"queries":s=s&&n;break;case"timers":s=s&&i;break;default:ar(!1)}return s}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(t,e),this.target=null,this._queryPending=!1,this._pollingPromise=null,Object.seal(this)}beginTimeElapsedQuery(){return this.begin(Q9)}beginOcclusionQuery(){let{conservative:t=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.begin(t?V9:G9)}beginTransformFeedbackQuery(){return this.begin(z9)}begin(t){return this._queryPending?this:(this.target=t,this.gl2.beginQuery(this.target,this.handle),this)}end(){return this._queryPending?this:(this.target&&(this.gl2.endQuery(this.target),this.target=null,this._queryPending=!0),this)}isResultAvailable(){if(!this._queryPending)return!1;const t=this.gl2.getQueryParameter(this.handle,k9);return t&&(this._queryPending=!1),t}isTimerDisjoint(){return this.gl2.getParameter(H9)}getResult(){return this.gl2.getQueryParameter(this.handle,N9)}getTimerMilliseconds(){return this.getResult()/1e6}createPoll(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Number.POSITIVE_INFINITY;if(this._pollingPromise)return this._pollingPromise;let e=0;return this._pollingPromise=new Promise((n,i)=>{const s=()=>{this.isResultAvailable()?(n(this.getResult()),this._pollingPromise=null):e++>t?(i("Timed out"),this._pollingPromise=null):requestAnimationFrame(s)};requestAnimationFrame(s)}),this._pollingPromise}_createHandle(){return E0.isSupported(this.gl)?this.gl2.createQuery():null}_deleteHandle(){this.gl2.deleteQuery(this.handle)}}class T5 extends Fu{get[Symbol.toStringTag](){return"TransformFeedback"}static isSupported(t){return gn(t)}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Ro(t),super(t,e),this.initialize(e),this.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal(this)}initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,$d(this.buffers)||this.bind(()=>this._unbindBuffers()),this.setProps(t),this}setProps(t){"program"in t&&(this.configuration=t.program&&t.program.configuration),"configuration"in t&&(this.configuration=t.configuration),"bindOnUse"in t&&(t=t.bindOnUse),"buffers"in t&&this.setBuffers(t.buffers)}setBuffers(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.bind(()=>{for(const e in t)this.setBuffer(e,t[e])}),this}setBuffer(t,e){const n=this._getVaryingIndex(t),{buffer:i,byteSize:s,byteOffset:a}=this._getBufferParams(e);return n<0?(this.unused[t]=i,yr.warn("".concat(this.id," unused varying buffer ").concat(t))(),this):(this.buffers[n]=e,this.bindOnUse||this._bindBuffer(n,i,a,s),this)}begin(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.gl.bindTransformFeedback(36386,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(t),this}end(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null),this}_getBufferParams(t){let e,n,i;return t instanceof ni?i=t:(i=t.buffer,n=t.byteSize,e=t.byteOffset),(e!==void 0||n!==void 0)&&(e=e||0,n=n||i.byteLength-e),{buffer:i,byteOffset:e,byteSize:n}}_getVaryingInfo(t){return this.configuration&&this.configuration.getVaryingInfo(t)}_getVaryingIndex(t){if(this.configuration)return this.configuration.getVaryingInfo(t).location;const e=Number(t);return Number.isFinite(e)?e:-1}_bindBuffers(){if(this.bindOnUse)for(const t in this.buffers){const{buffer:e,byteSize:n,byteOffset:i}=this._getBufferParams(this.buffers[t]);this._bindBuffer(t,e,i,n)}}_unbindBuffers(){if(this.bindOnUse)for(const t in this.buffers)this._bindBuffer(t,null)}_bindBuffer(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0;const s=e&&e.handle;return!s||i===void 0?this.gl.bindBufferBase(35982,t,s):this.gl.bindBufferRange(35982,t,s,n,i),this}_createHandle(){return this.gl.createTransformFeedback()}_deleteHandle(){this.gl.deleteTransformFeedback(this.handle)}_bindHandle(t){this.gl.bindTransformFeedback(36386,this.handle)}}let S0=null;function j9(r){return(!S0||S0.byteLength<r)&&(S0=new ArrayBuffer(r)),S0}function q9(r,t){const e=j9(r.BYTES_PER_ELEMENT*t);return new r(e,0,t)}function K9(r){let{target:t,source:e,start:n=0,count:i=1}=r;const s=e.length,a=i*s;let o=0;for(let A=n;o<s;o++)t[A++]=e[o];for(;o<a;)o<a-o?(t.copyWithin(n+o,n,n+o),o*=2):(t.copyWithin(n+o,n,n+a-o),o=a);return t}const $9="elements must be GL.ELEMENT_ARRAY_BUFFER";class Ma extends Fu{get[Symbol.toStringTag](){return"VertexArrayObject"}static isSupported(t){return(arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}).constantAttributeZero?gn(t)||TT()==="Chrome":!0}static getDefaultArray(t){return t.luma=t.luma||{},t.luma.defaultVertexArray||(t.luma.defaultVertexArray=new Ma(t,{handle:null,isDefaultArray:!0})),t.luma.defaultVertexArray}static getMaxAttributes(t){return Ma.MAX_ATTRIBUTES=Ma.MAX_ATTRIBUTES||t.getParameter(34921),Ma.MAX_ATTRIBUTES}static setConstant(t,e,n){switch(n.constructor){case Float32Array:Ma._setConstantFloatArray(t,e,n);break;case Int32Array:Ma._setConstantIntArray(t,e,n);break;case Uint32Array:Ma._setConstantUintArray(t,e,n);break;default:ar(!1)}}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=e.id||e.program&&e.program.id;super(t,Object.assign({},e,{id:n})),this.buffer=null,this.bufferValue=null,this.isDefaultArray=e.isDefaultArray||!1,this.gl2=t,this.initialize(e),Object.seal(this)}delete(){return super.delete(),this.buffer&&this.buffer.delete(),this}get MAX_ATTRIBUTES(){return Ma.getMaxAttributes(this.gl)}initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.setProps(t)}setProps(t){return this}setElementBuffer(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return ar(!t||t.target===34963,$9),this.bind(()=>{this.gl.bindBuffer(34963,t?t.handle:null)}),this}setBuffer(t,e,n){if(e.target===34963)return this.setElementBuffer(e,n);const{size:i,type:s,stride:a,offset:o,normalized:A,integer:f,divisor:m}=n,{gl:_,gl2:x}=this;return t=Number(t),this.bind(()=>{_.bindBuffer(34962,e.handle),f?(ar(gn(_)),x.vertexAttribIPointer(t,i,s,a,o)):_.vertexAttribPointer(t,i,s,A,a,o),_.enableVertexAttribArray(t),x.vertexAttribDivisor(t,m||0)}),this}enable(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return!e&&t===0&&!Ma.isSupported(this.gl,{constantAttributeZero:!0})||(t=Number(t),this.bind(()=>e?this.gl.enableVertexAttribArray(t):this.gl.disableVertexAttribArray(t))),this}getConstantBuffer(t,e){const n=this._normalizeConstantArrayValue(e),i=n.byteLength*t,s=n.length*t;let a=!this.buffer;if(this.buffer=this.buffer||new ni(this.gl,i),a=a||this.buffer.reallocate(i),a=a||!this._compareConstantArrayValues(n,this.bufferValue),a){const o=q9(e.constructor,s);K9({target:o,source:n,start:0,count:s}),this.buffer.subData(o),this.bufferValue=e}return this.buffer}_normalizeConstantArrayValue(t){return Array.isArray(t)?new Float32Array(t):t}_compareConstantArrayValues(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}static _setConstantFloatArray(t,e,n){switch(n.length){case 1:t.vertexAttrib1fv(e,n);break;case 2:t.vertexAttrib2fv(e,n);break;case 3:t.vertexAttrib3fv(e,n);break;case 4:t.vertexAttrib4fv(e,n);break;default:ar(!1)}}static _setConstantIntArray(t,e,n){switch(ar(gn(t)),n.length){case 1:t.vertexAttribI1iv(e,n);break;case 2:t.vertexAttribI2iv(e,n);break;case 3:t.vertexAttribI3iv(e,n);break;case 4:t.vertexAttribI4iv(e,n);break;default:ar(!1)}}static _setConstantUintArray(t,e,n){switch(ar(gn(t)),n.length){case 1:t.vertexAttribI1uiv(e,n);break;case 2:t.vertexAttribI2uiv(e,n);break;case 3:t.vertexAttribI3uiv(e,n);break;case 4:t.vertexAttribI4uiv(e,n);break;default:ar(!1)}}_createHandle(){return this.gl.createVertexArray()}_deleteHandle(t){return this.gl2.deleteVertexArray(t),[this.elements]}_bindHandle(t){this.gl2.bindVertexArray(t)}_getParameter(t,e){let{location:n}=e;return ar(Number.isFinite(n)),this.bind(()=>{switch(t){case 34373:return this.gl.getVertexAttribOffset(n,t);default:return this.gl.getVertexAttrib(n,t)}})}}const W9="VertexArray: attributes must be Buffers or constants (i.e. typed array)",X9=/^(.+)__LOCATION_([0-9]+)$/,J9=["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"];class Y9{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=e.id||e.program&&e.program.id;this.id=n,this.gl=t,this.configuration=null,this.elements=null,this.elementsAccessor=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.attributes={},this.vertexArrayObject=new Ma(t),t5(this,"VertexArray","v6.0",J9),this.initialize(e),Object.seal(this)}delete(){this.buffer&&this.buffer.delete(),this.vertexArrayObject.delete()}initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(t)}reset(){this.elements=null,this.elementsAccessor=null;const{MAX_ATTRIBUTES:t}=this.vertexArrayObject;return this.values=new Array(t).fill(null),this.accessors=new Array(t).fill(null),this.unused={},this.drawParams=null,this}setProps(t){return"program"in t&&(this.configuration=t.program&&t.program.configuration),"configuration"in t&&(this.configuration=t.configuration),"attributes"in t&&this.setAttributes(t.attributes),"elements"in t&&this.setElementBuffer(t.elements),"bindOnUse"in t&&(t=t.bindOnUse),this}clearDrawParams(){this.drawParams=null}getDrawParams(){return this.drawParams=this.drawParams||this._updateDrawParams(),this.drawParams}setAttributes(t){return Object.assign(this.attributes,t),this.vertexArrayObject.bind(()=>{for(const e in t){const n=t[e];this._setAttribute(e,n)}this.gl.bindBuffer(34962,null)}),this}setElementBuffer(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.elements=t,this.elementsAccessor=e,this.clearDrawParams(),this.vertexArrayObject.setElementBuffer(t,e),this}setBuffer(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e.target===34963)return this.setElementBuffer(e,n);const{location:i,accessor:s}=this._resolveLocationAndAccessor(t,e,e.accessor,n);return i>=0&&(this.values[i]=e,this.accessors[i]=s,this.clearDrawParams(),this.vertexArrayObject.setBuffer(i,e,s)),this}setConstant(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{location:i,accessor:s}=this._resolveLocationAndAccessor(t,e,Object.assign({size:e.length},n));return i>=0&&(e=this.vertexArrayObject._normalizeConstantArrayValue(e),this.values[i]=e,this.accessors[i]=s,this.clearDrawParams(),this.vertexArrayObject.enable(i,!1)),this}unbindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.vertexArrayObject.setElementBuffer(null),this.buffer=this.buffer||new ni(this.gl,{accessor:{size:4}});for(let t=0;t<this.vertexArrayObject.MAX_ATTRIBUTES;t++)this.values[t]instanceof ni&&(this.gl.disableVertexAttribArray(t),this.gl.bindBuffer(34962,this.buffer.handle),this.gl.vertexAttribPointer(t,1,5126,!1,0,0))}),this}bindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.setElementBuffer(this.elements);for(let t=0;t<this.vertexArrayObject.MAX_ATTRIBUTES;t++){const e=this.values[t];e instanceof ni&&this.setBuffer(t,e)}}),this}bindForDraw(t,e,n){let i;return this.vertexArrayObject.bind(()=>{this._setConstantAttributes(t,e),i=n()}),i}_resolveLocationAndAccessor(t,e,n,i){const s={location:-1,accessor:null},{location:a,name:o}=this._getAttributeIndex(t);if(!Number.isFinite(a)||a<0)return this.unused[t]=e,yr.once(3,()=>"unused value ".concat(t," in ").concat(this.id))(),s;const A=this._getAttributeInfo(o||a);if(!A)return s;const f=this.accessors[a]||{},m=la.resolve(A.accessor,f,n,i),{size:_,type:x}=m;return ar(Number.isFinite(_)&&Number.isFinite(x)),{location:a,accessor:m}}_getAttributeInfo(t){return this.configuration&&this.configuration.getAttributeInfo(t)}_getAttributeIndex(t){const e=Number(t);if(Number.isFinite(e))return{location:e};const n=X9.exec(t),i=n?n[1]:t,s=n?Number(n[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(i)+s,name:i}:{location:-1}}_setAttribute(t,e){if(e instanceof ni)this.setBuffer(t,e);else if(Array.isArray(e)&&e.length&&e[0]instanceof ni){const n=e[0],i=e[1];this.setBuffer(t,n,i)}else if(ArrayBuffer.isView(e)||Array.isArray(e)){const n=e;this.setConstant(t,n)}else if(e.buffer instanceof ni){const n=e;this.setBuffer(t,n.buffer,n)}else throw new Error(W9)}_setConstantAttributes(t,e){const n=Math.max(t|0,e|0);let i=this.values[0];ArrayBuffer.isView(i)&&this._setConstantAttributeZero(i,n);for(let s=1;s<this.vertexArrayObject.MAX_ATTRIBUTES;s++)i=this.values[s],ArrayBuffer.isView(i)&&this._setConstantAttribute(s,i)}_setConstantAttributeZero(t,e){if(Ma.isSupported(this.gl,{constantAttributeZero:!0})){this._setConstantAttribute(0,t);return}const n=this.vertexArrayObject.getConstantBuffer(e,t);this.vertexArrayObject.setBuffer(0,n,this.accessors[0])}_setConstantAttribute(t,e){Ma.setConstant(this.gl,t,e)}_updateDrawParams(){const t={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0};for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++)this._updateDrawParamsForLocation(t,e);return this.elements&&(t.elementCount=this.elements.getElementCount(this.elements.accessor),t.isIndexed=!0,t.indexType=this.elementsAccessor.type||this.elements.accessor.type,t.indexOffset=this.elementsAccessor.offset||0),t.indexCount===1/0&&(t.indexCount=0),t.vertexCount===1/0&&(t.vertexCount=0),t.instanceCount===1/0&&(t.instanceCount=0),t}_updateDrawParamsForLocation(t,e){const n=this.values[e],i=this.accessors[e];if(!n)return;const{divisor:s}=i,a=s>0;if(t.isInstanced=t.isInstanced||a,n instanceof ni){const o=n;if(a){const A=o.getVertexCount(i);t.instanceCount=Math.min(t.instanceCount,A)}else{const A=o.getVertexCount(i);t.vertexCount=Math.min(t.vertexCount,A)}}}setElements(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return yr.deprecated("setElements","setElementBuffer")(),this.setElementBuffer(t,e)}}function Z9(r,t){const{maxElts:e=16,size:n=1}=t;let i="[";for(let a=0;a<r.length&&a<e;++a)a>0&&(i+=",".concat(a%n===0?" ":"")),i+=ig(r[a],t);const s=r.length>e?"...":"]";return"".concat(i).concat(s)}function ig(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const e=1e-16,{isInteger:n=!1}=t;if(Array.isArray(r)||ArrayBuffer.isView(r))return Z9(r,t);if(!Number.isFinite(r))return String(r);if(Math.abs(r)<e)return n?"0":"0.";if(n||Math.abs(r)>100&&Math.abs(r)<1e4)return r.toFixed(0);const i=r.toPrecision(2);return i.indexOf(".0")===i.length-2?i.slice(0,-1):i}function I5(r){let{header:t="Uniforms",program:e,uniforms:n,undefinedOnly:i=!1}=r;ar(e);const s=".*_.*",a=".*Matrix",o=e._uniformSetters,A={},f=Object.keys(o).sort();let m=0;for(const B of f)!B.match(s)&&!B.match(a)&&yb({table:A,header:t,uniforms:n,uniformName:B,undefinedOnly:i})&&m++;for(const B of f)B.match(a)&&yb({table:A,header:t,uniforms:n,uniformName:B,undefinedOnly:i})&&m++;for(const B of f)A[B]||yb({table:A,header:t,uniforms:n,uniformName:B,undefinedOnly:i})&&m++;let _=0;const x={};if(!i)for(const B in n){const P=n[B];A[B]||(_++,x[B]={Type:"NOT USED: ".concat(P),[t]:ig(P)})}return{table:A,count:m,unusedTable:x,unusedCount:_}}function yb(r){let{table:t,header:e,uniforms:n,uniformName:i,undefinedOnly:s}=r;const a=n[i],o=tG(a);return!s||!o?(t[i]={[e]:o?ig(a):"N/A","Uniform Type":o?a:"NOT PROVIDED"},!0):!1}function tG(r){return r!=null}function eG(r){let{vertexArray:t,header:e="Attributes"}=r;if(!t.configuration)return{};const n={};t.elements&&(n.ELEMENT_ARRAY_BUFFER=L5(t,t.elements,null,e));const i=t.values;for(const s in i){const a=t._getAttributeInfo(s);if(a){let o="".concat(s,": ").concat(a.name);const A=t.accessors[a.location];A&&(o="".concat(s,": ").concat(rG(a.name,A))),n[o]=L5(t,i[s],A,e)}}return n}function L5(r,t,e,n){const{gl:i}=r;if(!t)return{[n]:"null","Format ":"N/A"};let s="NOT PROVIDED",a=1,o=0,A=0,f,m,_;if(e&&(s=e.type,a=e.size,s=String(s).replace("Array",""),f=s.indexOf("nt")!==-1),t instanceof ni){const x=t,{data:B,changed:P}=x.getDebugData();m=P?"*":"",_=B,A=x.byteLength,o=A/B.BYTES_PER_ELEMENT/a;let M;if(e){const k=e.divisor>0;M="".concat(k?"I ":"P "," ").concat(o," (x").concat(a,"=").concat(A," bytes ").concat(FA(i,s),")")}else f=!0,M="".concat(A," bytes");return{[n]:"".concat(m).concat(ig(_,{size:a,isInteger:f})),"Format ":M}}return _=t,a=t.length,s=String(t.constructor.name).replace("Array",""),f=s.indexOf("nt")!==-1,{[n]:"".concat(ig(_,{size:a,isInteger:f})," (constant)"),"Format ":"".concat(a,"x").concat(s," (constant)")}}function rG(r,t){const{type:e,size:n}=t,i=C5(e,n);return i?"".concat(r," (").concat(i.name,")"):r}function nG(r){const t={},e="Accessors for ".concat(r.id);for(const n of r.attributeInfos)if(n){const i=F5(n);t["in ".concat(i)]={[e]:JSON.stringify(n.accessor)}}for(const n of r.varyingInfos)if(n){const i=F5(n);t["out ".concat(i)]={[e]:JSON.stringify(n.accessor)}}return t}function F5(r){const{type:t,size:e}=r.accessor,n=C5(t,e);return n?"".concat(n.name," ").concat(r.name):r.name}const P5=Tu()&&typeof document<"u";let iG=0;class sG{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{onCreateContext:e=k=>XT(k),onAddHTML:n=null,onInitialize:i=()=>{},onRender:s=()=>{},onFinalize:a=()=>{},onError:o,gl:A=null,glOptions:f={},debug:m=!1,createFramebuffer:_=!1,autoResizeViewport:x=!0,autoResizeDrawingBuffer:B=!0,stats:P=Oh.get("animation-loop-".concat(iG++))}=t;let{useDevicePixels:M=!0}=t;"useDevicePixelRatio"in t&&(yr.deprecated("useDevicePixelRatio","useDevicePixels")(),M=t.useDevicePixelRatio),this.props={onCreateContext:e,onAddHTML:n,onInitialize:i,onRender:s,onFinalize:a,onError:o,gl:A,glOptions:f,debug:m,createFramebuffer:_},this.gl=A,this.needsRedraw=null,this.timeline=null,this.stats=P,this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.setProps({autoResizeViewport:x,autoResizeDrawingBuffer:B,useDevicePixels:M}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._pageLoadPromise=null,this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}delete(){this.stop(),this._setDisplay(null)}setNeedsRedraw(t){return ar(typeof t=="string"),this.needsRedraw=this.needsRedraw||t,this}setProps(t){return"autoResizeViewport"in t&&(this.autoResizeViewport=t.autoResizeViewport),"autoResizeDrawingBuffer"in t&&(this.autoResizeDrawingBuffer=t.autoResizeDrawingBuffer),"useDevicePixels"in t&&(this.useDevicePixels=t.useDevicePixels),this}start(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this._running)return this;this._running=!0;const e=this._getPageLoadPromise().then(()=>!this._running||this._initialized?null:(this._createWebGLContext(t),this._createFramebuffer(),this._startEventHandling(),this._initializeCallbackData(),this._updateCallbackData(),this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._gpuTimeQuery=E0.isSupported(this.gl,["timers"])?new E0(this.gl):null,this._initialized=!0,this.onInitialize(this.animationProps))).then(n=>{this._running&&(this._addCallbackData(n||{}),n!==!1&&this._startLoop())});return this.props.onError&&e.catch(this.props.onError),this}redraw(){return this.isContextLost()?this:(this._beginTimers(),this._setupFrame(),this._updateCallbackData(),this._renderFrame(this.animationProps),this._clearNeedsRedraw(),this.offScreen&&this.gl.commit&&this.gl.commit(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endTimers(),this)}stop(){return this._running&&(this._finalizeCallbackData(),this._cancelAnimationFrame(this._animationFrameId),this._nextFramePromise=null,this._resolveNextFrame=null,this._animationFrameId=null,this._running=!1),this}attachTimeline(t){return this.timeline=t,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(t=>{this._resolveNextFrame=t})),this._nextFramePromise}async toDataURL(){return this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.gl.canvas.toDataURL()}isContextLost(){return this.gl.isContextLost()}onCreateContext(){return this.props.onCreateContext(...arguments)}onInitialize(){return this.props.onInitialize(...arguments)}onRender(){return this.props.onRender(...arguments)}onFinalize(){return this.props.onFinalize(...arguments)}getHTMLControlValue(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const n=document.getElementById(t);return n?Number(n.value):e}setViewParameters(){return yr.removed("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this}_startLoop(){const t=()=>{this._running&&(this.redraw(),this._animationFrameId=this._requestAnimationFrame(t))};this._cancelAnimationFrame(this._animationFrameId),this._animationFrameId=this._requestAnimationFrame(t)}_getPageLoadPromise(){return this._pageLoadPromise||(this._pageLoadPromise=P5?new Promise((t,e)=>{if(P5&&document.readyState==="complete"){t(document);return}window.addEventListener("load",()=>{t(document)})}):Promise.resolve({})),this._pageLoadPromise}_setDisplay(t){this.display&&(this.display.delete(),this.display.animationLoop=null),t&&(t.animationLoop=this),this.display=t}_cancelAnimationFrame(t){return this.display&&this.display.cancelAnimationFrame?this.display.cancelAnimationFrame(t):h7(t)}_requestAnimationFrame(t){if(this._running)return this.display&&this.display.requestAnimationFrame?this.display.requestAnimationFrame(t):A7(t)}_renderFrame(){if(this.display){this.display._renderFrame(...arguments);return}this.onRender(...arguments)}_clearNeedsRedraw(){this.needsRedraw=null}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer()}_initializeCallbackData(){this.animationProps={gl:this.gl,stop:this.stop,canvas:this.gl.canvas,framebuffer:this.framebuffer,useDevicePixels:this.useDevicePixels,needsRedraw:null,startTime:Date.now(),engineTime:0,tick:0,tock:0,time:0,_timeline:this.timeline,_loop:this,_animationLoop:this,_mousePosition:null}}_updateCallbackData(){const{width:t,height:e,aspect:n}=this._getSizeAndAspect();(t!==this.animationProps.width||e!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),n!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=t,this.animationProps.height=e,this.animationProps.aspect=n,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime,this.animationProps._offScreen=this.offScreen}_finalizeCallbackData(){this.onFinalize(this.animationProps)}_addCallbackData(t){typeof t=="object"&&t!==null&&(this.animationProps=Object.assign({},this.animationProps,t))}_createWebGLContext(t){if(this.offScreen=t.canvas&&typeof OffscreenCanvas<"u"&&t.canvas instanceof OffscreenCanvas,t=Object.assign({},t,this.props.glOptions),this.gl=this.props.gl?ib(this.props.gl,t):this.onCreateContext(t),!_0(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");Yz(this.gl),this._createInfoDiv()}_createInfoDiv(){if(this.gl.canvas&&this.props.onAddHTML){const t=document.createElement("div");document.body.appendChild(t),t.style.position="relative";const e=document.createElement("div");e.style.position="absolute",e.style.left="10px",e.style.bottom="10px",e.style.width="300px",e.style.background="white",t.appendChild(this.gl.canvas),t.appendChild(e);const n=this.props.onAddHTML(e);n&&(e.innerHTML=n)}}_getSizeAndAspect(){const t=this.gl.drawingBufferWidth,e=this.gl.drawingBufferHeight;let n=1;const{canvas:i}=this.gl;return i&&i.clientHeight?n=i.clientWidth/i.clientHeight:t>0&&e>0&&(n=t/e),{width:t,height:e,aspect:n}}_resizeViewport(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.autoResizeDrawingBuffer&&n7(this.gl,{useDevicePixels:this.useDevicePixels})}_createFramebuffer(){this.props.createFramebuffer&&(this.framebuffer=new xs(this.gl))}_resizeFramebuffer(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}_beginTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this._gpuTimeQuery&&this._gpuTimeQuery.isResultAvailable()&&!this._gpuTimeQuery.isTimerDisjoint()&&this.stats.get("GPU Time").addTime(this._gpuTimeQuery.getTimerMilliseconds()),this._gpuTimeQuery&&this._gpuTimeQuery.beginTimeElapsedQuery(),this.cpuTime.timeStart()}_endTimers(){this.cpuTime.timeEnd(),this._gpuTimeQuery&&this._gpuTimeQuery.end()}_startEventHandling(){const{canvas:t}=this.gl;t&&(t.addEventListener("mousemove",this._onMousemove),t.addEventListener("mouseleave",this._onMouseleave))}_onMousemove(t){this.animationProps._mousePosition=[t.offsetX,t.offsetY]}_onMouseleave(t){this.animationProps._mousePosition=null}}const sg="vs",_b="fs";function Ua(r,t){if(!r)throw new Error(t||"shadertools: assertion failed.")}const vb={number:{validate(r,t){return Number.isFinite(r)&&(!("max"in t)||r<=t.max)&&(!("min"in t)||r>=t.min)}},array:{validate(r,t){return Array.isArray(r)||ArrayBuffer.isView(r)}}};function oG(r){const t={};for(const e in r){const n=r[e],i=aG(n);t[e]=i}return t}function aG(r){let t=M5(r);return t==="object"?r?"type"in r?Object.assign({},r,vb[r.type]):"value"in r?(t=M5(r.value),Object.assign({type:t},r,vb[t])):{type:"object",value:r}:{type:"object",value:null}:Object.assign({type:t,value:r},vb[t])}function M5(r){return Array.isArray(r)||ArrayBuffer.isView(r)?"array":typeof r}const cG="vs",lG="fs";class U5{constructor(t){let{name:e,vs:n,fs:i,dependencies:s=[],uniforms:a,getUniforms:o,deprecations:A=[],defines:f={},inject:m={},vertexShader:_,fragmentShader:x}=t;Ua(typeof e=="string"),this.name=e,this.vs=n||_,this.fs=i||x,this.getModuleUniforms=o,this.dependencies=s,this.deprecations=this._parseDeprecationDefinitions(A),this.defines=f,this.injections=uG(m),a&&(this.uniforms=oG(a))}getModuleSource(t){let e;switch(t){case cG:e=this.vs||"";break;case lG:e=this.fs||"";break;default:Ua(!1)}return"#define MODULE_".concat(this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_"),`
`).concat(e,"// END MODULE_").concat(this.name,`

`)}getUniforms(t,e){return this.getModuleUniforms?this.getModuleUniforms(t,e):this.uniforms?this._defaultGetUniforms(t):{}}getDefines(){return this.defines}checkDeprecations(t,e){this.deprecations.forEach(n=>{n.regex.test(t)&&(n.deprecated?e.deprecated(n.old,n.new)():e.removed(n.old,n.new)())})}_parseDeprecationDefinitions(t){return t.forEach(e=>{switch(e.type){case"function":e.regex=new RegExp("\\b".concat(e.old,"\\("));break;default:e.regex=new RegExp("".concat(e.type," ").concat(e.old,";"))}}),t}_defaultGetUniforms(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e={},n=this.uniforms;for(const i in n){const s=n[i];i in t&&!s.private?(s.validate&&Ua(s.validate(t[i],s),"".concat(this.name,": invalid ").concat(i)),e[i]=t[i]):e[i]=s.value}return e}}function uG(r){const t={vs:{},fs:{}};for(const e in r){let n=r[e];const i=e.slice(0,2);typeof n=="string"&&(n={order:0,injection:n}),t[i][e]=n}return t}function AG(r){return hG(O5(r))}function hG(r){const t={},e={};return R5({modules:r,level:0,moduleMap:t,moduleDepth:e}),Object.keys(e).sort((n,i)=>e[i]-e[n]).map(n=>t[n])}function R5(r){let{modules:t,level:e,moduleMap:n,moduleDepth:i}=r;if(e>=5)throw new Error("Possible loop in shader dependency graph");for(const s of t)n[s.name]=s,(i[s.name]===void 0||i[s.name]<e)&&(i[s.name]=e);for(const s of t)s.dependencies&&R5({modules:s.dependencies,level:e+1,moduleMap:n,moduleDepth:i})}function O5(r,t){return r.map(e=>(e instanceof U5||(Ua(typeof e!="string","Shader module use by name is deprecated. Import shader module '".concat(e,"' and use it directly.")),Ua(e.name,"shader module has no name"),e=new U5(e),e.dependencies=O5(e.dependencies)),e))}function dG(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=typeof window<"u"?window.navigator||{}:{},e=r.userAgent||t.userAgent||"",n=e.indexOf("MSIE ")!==-1,i=e.indexOf("Trident/")!==-1;return n||i}const fG=7936,pG=7937,gG=7938,mG=35724,bb={GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},Nh={};Object.keys(bb).forEach(r=>{Nh[r]=r});function yG(r){return typeof WebGL2RenderingContext<"u"&&r instanceof WebGL2RenderingContext?!0:!!(r&&r._version===2)}function _G(r){const t=r.getExtension("WEBGL_debug_renderer_info"),e=r.getParameter(t&&t.UNMASKED_VENDOR_WEBGL||fG),n=r.getParameter(t&&t.UNMASKED_RENDERER_WEBGL||pG);return{gpuVendor:vG(e,n),vendor:e,renderer:n,version:r.getParameter(gG),shadingLanguageVersion:r.getParameter(mG)}}function vG(r,t){return r.match(/NVIDIA/i)||t.match(/NVIDIA/i)?"NVIDIA":r.match(/INTEL/i)||t.match(/INTEL/i)?"INTEL":r.match(/AMD/i)||t.match(/AMD/i)||r.match(/ATI/i)||t.match(/ATI/i)?"AMD":"UNKNOWN GPU"}const wb={};function D5(r,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const n=bb[t];if(Ua(n,t),!dG(e))return!0;if(t in wb)return wb[t];const i=n[0],s=e.behavior||"enable",a="#extension GL_".concat(i," : ").concat(s,`
void main(void) {}`),o=r.createShader(35633);r.shaderSource(o,a),r.compileShader(o);const A=r.getShaderParameter(o,35713);return r.deleteShader(o),wb[t]=A,A}function bG(r,t){const e=bb[t];Ua(e,t);const n=yG(r)&&e[1]||e[0],i=typeof n=="string"?!!r.getExtension(n):n;return Ua(i===!1||i===!0),i}function T0(r,t){return t=Array.isArray(t)?t:[t],t.every(e=>bG(r,e))}function wG(r){switch(_G(r).gpuVendor.toLowerCase()){case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function xG(r,t,e){let n=`#if (__VERSION__ > 120)

# define FEATURE_GLSL_DERIVATIVES
# define FEATURE_GLSL_DRAW_BUFFERS
# define FEATURE_GLSL_FRAG_DEPTH
# define FEATURE_GLSL_TEXTURE_LOD

// DEPRECATED FLAGS, remove in v9
# define FRAG_DEPTH
# define DERIVATIVES
# define DRAW_BUFFERS
# define TEXTURE_LOD

#endif // __VERSION
`;return T0(r,Nh.GLSL_FRAG_DEPTH)&&(n+=`
// FRAG_DEPTH => gl_FragDepth is available
#ifdef GL_EXT_frag_depth
#extension GL_EXT_frag_depth : enable
# define FEATURE_GLSL_FRAG_DEPTH
# define FRAG_DEPTH
# define gl_FragDepth gl_FragDepthEXT
#endif
`),T0(r,Nh.GLSL_DERIVATIVES)&&D5(r,Nh.GLSL_DERIVATIVES)&&(n+=`
// DERIVATIVES => dxdF, dxdY and fwidth are available
#ifdef GL_OES_standard_derivatives
#extension GL_OES_standard_derivatives : enable
# define FEATURE_GLSL_DERIVATIVES
# define DERIVATIVES
#endif
`),T0(r,Nh.GLSL_FRAG_DATA)&&D5(r,Nh.GLSL_FRAG_DATA,{behavior:"require"})&&(n+=`
// DRAW_BUFFERS => gl_FragData[] is available
#ifdef GL_EXT_draw_buffers
#extension GL_EXT_draw_buffers : require
#define FEATURE_GLSL_DRAW_BUFFERS
#define DRAW_BUFFERS
#endif
`),T0(r,Nh.GLSL_TEXTURE_LOD)&&(n+=`// TEXTURE_LOD => texture2DLod etc are available
#ifdef GL_EXT_shader_texture_lod
#extension GL_EXT_shader_texture_lod : enable

# define FEATURE_GLSL_TEXTURE_LOD
# define TEXTURE_LOD

#endif
`),n}const BG=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,CG=`#ifdef MODULE_MATERIAL
  gl_FragColor = material_filterColor(gl_FragColor);
#endif

#ifdef MODULE_LIGHTING
  gl_FragColor = lighting_filterColor(gl_FragColor);
#endif

#ifdef MODULE_FOG
  gl_FragColor = fog_filterColor(gl_FragColor);
#endif

#ifdef MODULE_PICKING
  gl_FragColor = picking_filterHighlightColor(gl_FragColor);
  gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,EG={[sg]:BG,[_b]:CG},I0="__LUMA_INJECT_DECLARATIONS__",N5=/void\s+main\s*\([^)]*\)\s*\{\n?/,k5=/}\n?[^{}]*$/,xb=[];function Q5(r,t,e){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const i=t===sg;for(const s in e){const a=e[s];a.sort((A,f)=>A.order-f.order),xb.length=a.length;for(let A=0,f=a.length;A<f;++A)xb[A]=a[A].injection;const o="".concat(xb.join(`
`),`
`);switch(s){case"vs:#decl":i&&(r=r.replace(I0,o));break;case"vs:#main-start":i&&(r=r.replace(N5,A=>A+o));break;case"vs:#main-end":i&&(r=r.replace(k5,A=>o+A));break;case"fs:#decl":i||(r=r.replace(I0,o));break;case"fs:#main-start":i||(r=r.replace(N5,A=>A+o));break;case"fs:#main-end":i||(r=r.replace(k5,A=>o+A));break;default:r=r.replace(s,A=>A+o)}}return r=r.replace(I0,""),n&&(r=r.replace(/\}\s*$/,s=>s+EG[t])),r}function Bb(r){const t={};return Ua(Array.isArray(r)&&r.length>1),r.forEach(e=>{for(const n in e)t[n]=t[n]?"".concat(t[n],`
`).concat(e[n]):e[n]}),t}function Yd(r){return new RegExp("\\b".concat(r,"[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)"),"g")}const H5=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],SG=[...H5,[Yd("attribute"),"in $1"],[Yd("varying"),"out $1"]],TG=[...H5,[Yd("varying"),"in $1"]],z5=[[/^#version[ \t]+300[ \t]+es/,"#version 100"],[/\btexture(2D|2DProj|Cube)Lod\(/g,"texture$1LodEXT("],[/\btexture\(/g,"texture2D("],[/\btextureLod\(/g,"texture2DLodEXT("]],IG=[...z5,[Yd("in"),"attribute $1"],[Yd("out"),"varying $1"]],LG=[...z5,[Yd("in"),"varying $1"]],Cb="gl_FragColor",Eb=/\bout[ \t]+vec4[ \t]+(\w+)[ \t]*;\n?/,FG=/void\s+main\s*\([^)]*\)\s*\{\n?/;function PG(r,t,e){switch(t){case 300:return e?L0(r,SG):MG(r);case 100:return e?L0(r,IG):UG(r);default:throw new Error("unknown GLSL version ".concat(t))}}function L0(r,t){for(const[e,n]of t)r=r.replace(e,n);return r}function MG(r){r=L0(r,TG);const t=r.match(Eb);if(t){const e=t[1];r=r.replace(new RegExp("\\b".concat(Cb,"\\b"),"g"),e)}else{const e="fragmentColor";r=r.replace(FG,n=>"out vec4 ".concat(e,`;
`).concat(n)).replace(new RegExp("\\b".concat(Cb,"\\b"),"g"),e)}return r}function UG(r){r=L0(r,LG);const t=r.match(Eb);if(t){const e=t[1];r=r.replace(Eb,"").replace(new RegExp("\\b".concat(e,"\\b"),"g"),Cb)}return r}const RG=`

`.concat(I0,`

`),G5={[sg]:"vertex",[_b]:"fragment"},OG=`precision highp float;

`;function DG(r,t){const{vs:e,fs:n}=t,i=AG(t.modules||[]);return{gl:r,vs:V5(r,Object.assign({},t,{source:e,type:sg,modules:i})),fs:V5(r,Object.assign({},t,{source:n,type:_b,modules:i})),getUniforms:NG(i)}}function V5(r,t){let{id:e,source:n,type:i,modules:s,defines:a={},hookFunctions:o=[],inject:A={},transpileToGLSL100:f=!1,prologue:m=!0,log:_}=t;Ua(typeof n=="string","shader source must be a string");const x=i===sg,B=n.split(`
`);let P=100,M="",k=n;B[0].indexOf("#version ")===0?(P=300,M=B[0],k=B.slice(1).join(`
`)):M="#version ".concat(P);const Q={};s.forEach(mt=>{Object.assign(Q,mt.getDefines())}),Object.assign(Q,a);let q=m?"".concat(M,`
`).concat(QG({id:e,source:n,type:i}),`
`).concat(kG({type:i}),`
`).concat(wG(r),`
`).concat(xG(r),`
`).concat(HG(Q),`
`).concat(x?"":OG,`
`):"".concat(M,`
`);const J=GG(o),tt={},ft={},pt={};for(const mt in A){const dt=typeof A[mt]=="string"?{injection:A[mt],order:0}:A[mt],Rt=mt.match(/^(v|f)s:(#)?([\w-]+)$/);if(Rt){const Lt=Rt[2],st=Rt[3];Lt?st==="decl"?ft[mt]=[dt]:pt[mt]=[dt]:tt[mt]=[dt]}else pt[mt]=[dt]}for(const mt of s){_&&mt.checkDeprecations(k,_);const dt=mt.getModuleSource(i,P);q+=dt;const Rt=mt.injections[i];for(const Lt in Rt){const st=Lt.match(/^(v|f)s:#([\w-]+)$/);if(st){const wt=st[2]==="decl"?ft:pt;wt[Lt]=wt[Lt]||[],wt[Lt].push(Rt[Lt])}else tt[Lt]=tt[Lt]||[],tt[Lt].push(Rt[Lt])}}return q+=RG,q=Q5(q,i,ft),q+=zG(J[i],tt),q+=k,q=Q5(q,i,pt),q=PG(q,f?100:P,x),q}function NG(r){return function(e){const n={};for(const i of r){const s=i.getUniforms(e,n);Object.assign(n,s)}return n}}function kG(r){let{type:t}=r;return`
#define SHADER_TYPE_`.concat(G5[t].toUpperCase(),`
`)}function QG(r){let{id:t,source:e,type:n}=r;return t&&typeof t=="string"&&e.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME `.concat(t,"_").concat(G5[n],`

`):""}function HG(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=0,e="";for(const n in r){t===0&&(e+=`
// APPLICATION DEFINES
`),t++;const i=r[n];(i||Number.isFinite(i))&&(e+="#define ".concat(n.toUpperCase()," ").concat(r[n],`
`))}return t===0&&(e+=`
`),e}function zG(r,t){let e="";for(const n in r){const i=r[n];if(e+="void ".concat(i.signature,` {
`),i.header&&(e+="  ".concat(i.header)),t[n]){const s=t[n];s.sort((a,o)=>a.order-o.order);for(const a of s)e+="  ".concat(a.injection,`
`)}i.footer&&(e+="  ".concat(i.footer)),e+=`}
`}return e}function GG(r){const t={vs:{},fs:{}};return r.forEach(e=>{let n;typeof e!="string"?(n=e,e=n.hook):n={},e=e.trim();const[i,s]=e.split(":"),a=e.replace(/\(.+/,"");t[i][a]=Object.assign(n,{signature:s})}),t}const VG="void main() {gl_FragColor = vec4(0);}",j5=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,jG=`#version 300 es
`.concat(j5);function q5(r,t){t=Array.isArray(t)?t:[t];const e=r.replace(/^\s+/,"").split(/\s+/),[n,i,s]=e;if(!t.includes(n)||!i||!s)return null;const a=s.split(";")[0];return{qualifier:n,type:i,name:a}}function K5(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{version:t=100,input:e,inputType:n,output:i}=r;if(!e)return t===300?jG:t>300?"#version ".concat(t,`
`).concat(j5):VG;const s=$G(e,n);return t>=300?"#version ".concat(t," ").concat(t===300?"es":"",`
in `).concat(n," ").concat(e,`;
out vec4 `).concat(i,`;
void main() {
  `).concat(i," = ").concat(s,`;
}`):"varying ".concat(n," ").concat(e,`;
void main() {
  gl_FragColor = `).concat(s,`;
}`)}function qG(r){switch(r){case"float":return"x";case"vec2":return"xy";case"vec3":return"xyz";case"vec4":return"xyzw";default:return Ua(!1),null}}function KG(r){switch(r){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;default:return Ua(!1),null}}function $G(r,t){switch(t){case"float":return"vec4(".concat(r,", 0.0, 0.0, 1.0)");case"vec2":return"vec4(".concat(r,", 0.0, 1.0)");case"vec3":return"vec4(".concat(r,", 1.0)");case"vec4":return r;default:return Ua(!1),null}}const WG={name:"fp32",vs:`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,fs:null};function Hc(r,t){if(!r)throw new Error("math.gl assertion ".concat(t))}const XG=1/Math.PI*180,JG=1/180*Math.PI,Cs={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0};function YG(r){let{precision:t=Cs.precision}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return r=rV(r),"".concat(parseFloat(r.toPrecision(t)))}function MA(r){return Array.isArray(r)||ArrayBuffer.isView(r)&&!(r instanceof DataView)}function ZG(r){return eV(r)}function tV(r){return Mu(r)}function eV(r,t){return Sb(r,e=>e*JG,t)}function Mu(r,t){return Sb(r,e=>e*XG,t)}function Uu(r,t,e){return Sb(r,n=>Math.max(t,Math.min(e,n)))}function F0(r,t,e){return MA(r)?r.map((n,i)=>F0(n,t[i],e)):e*t+(1-e)*r}function zc(r,t,e){const n=Cs.EPSILON;e&&(Cs.EPSILON=e);try{if(r===t)return!0;if(MA(r)&&MA(t)){if(r.length!==t.length)return!1;for(let i=0;i<r.length;++i)if(!zc(r[i],t[i]))return!1;return!0}return r&&r.equals?r.equals(t):t&&t.equals?t.equals(r):typeof r=="number"&&typeof t=="number"?Math.abs(r-t)<=Cs.EPSILON*Math.max(1,Math.abs(r),Math.abs(t)):!1}finally{Cs.EPSILON=n}}function rV(r){return Math.round(r/Cs.EPSILON)*Cs.EPSILON}function nV(r){return r.clone?r.clone():new Array(r.length)}function Sb(r,t,e){if(MA(r)){const n=r;e=e||nV(n);for(let i=0;i<e.length&&i<n.length;++i)e[i]=t(r[i],i,e);return e}return t(r)}function iV(r){function t(){var e=Reflect.construct(r,Array.from(arguments));return Object.setPrototypeOf(e,Object.getPrototypeOf(this)),e}return t.prototype=Object.create(r.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r,t}class Tb extends iV(Array){clone(){return new this.constructor().copy(this)}fromArray(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;for(let n=0;n<this.ELEMENTS;++n)this[n]=t[n+e];return this.check()}toArray(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;for(let n=0;n<this.ELEMENTS;++n)t[e+n]=this[n];return t}from(t){return Array.isArray(t)?this.copy(t):this.fromObject(t)}to(t){return t===this?this:MA(t)?this.toArray(t):this.toObject(t)}toTarget(t){return t?this.to(t):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(Cs)}formatString(t){let e="";for(let n=0;n<this.ELEMENTS;++n)e+=(n>0?", ":"")+YG(this[n],t);return"".concat(t.printTypes?this.constructor.name:"","[").concat(e,"]")}equals(t){if(!t||this.length!==t.length)return!1;for(let e=0;e<this.ELEMENTS;++e)if(!zc(this[e],t[e]))return!1;return!0}exactEquals(t){if(!t||this.length!==t.length)return!1;for(let e=0;e<this.ELEMENTS;++e)if(this[e]!==t[e])return!1;return!0}negate(){for(let t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}lerp(t,e,n){if(n===void 0)return this.lerp(this,t,e);for(let i=0;i<this.ELEMENTS;++i){const s=t[i];this[i]=s+n*(e[i]-s)}return this.check()}min(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=Math.min(t[e],this[e]);return this.check()}max(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=Math.max(t[e],this[e]);return this.check()}clamp(t,e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],t[n]),e[n]);return this.check()}add(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(const i of e)for(let s=0;s<this.ELEMENTS;++s)this[s]+=i[s];return this.check()}subtract(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(const i of e)for(let s=0;s<this.ELEMENTS;++s)this[s]-=i[s];return this.check()}scale(t){if(typeof t=="number")for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;else for(let e=0;e<this.ELEMENTS&&e<t.length;++e)this[e]*=t[e];return this.check()}multiplyByScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}check(){if(Cs.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let t=this.length===this.ELEMENTS;for(let e=0;e<this.ELEMENTS;++e)t=t&&Number.isFinite(this[e]);return t}sub(t){return this.subtract(t)}setScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=t;return this.check()}addScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]+=t;return this.check()}subScalar(t){return this.addScalar(-t)}multiplyScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}divideScalar(t){return this.multiplyByScalar(1/t)}clampScalar(t,e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],t),e);return this.check()}get elements(){return this}}function sV(r,t){if(r.length!==t)return!1;for(let e=0;e<r.length;++e)if(!Number.isFinite(r[e]))return!1;return!0}function zn(r){if(!Number.isFinite(r))throw new Error("Invalid number ".concat(r));return r}function og(r,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";if(Cs.debug&&!sV(r,t))throw new Error("math.gl: ".concat(e," some fields set to invalid numbers'"));return r}class Ib extends Tb{get x(){return this[0]}set x(t){this[0]=zn(t)}get y(){return this[1]}set y(t){this[1]=zn(t)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let t=0;for(let e=0;e<this.ELEMENTS;++e)t+=this[e]*this[e];return t}magnitudeSquared(){return this.lengthSquared()}distance(t){return Math.sqrt(this.distanceSquared(t))}distanceSquared(t){let e=0;for(let n=0;n<this.ELEMENTS;++n){const i=this[n]-t[n];e+=i*i}return zn(e)}dot(t){let e=0;for(let n=0;n<this.ELEMENTS;++n)e+=this[n]*t[n];return zn(e)}normalize(){const t=this.magnitude();if(t!==0)for(let e=0;e<this.ELEMENTS;++e)this[e]/=t;return this.check()}multiply(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(const i of e)for(let s=0;s<this.ELEMENTS;++s)this[s]*=i[s];return this.check()}divide(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(const i of e)for(let s=0;s<this.ELEMENTS;++s)this[s]/=i[s];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(t){return this.distance(t)}distanceToSquared(t){return this.distanceSquared(t)}getComponent(t){return Hc(t>=0&&t<this.ELEMENTS,"index is out of range"),zn(this[t])}setComponent(t,e){return Hc(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=e,this.check()}addVectors(t,e){return this.copy(t).add(e)}subVectors(t,e){return this.copy(t).subtract(e)}multiplyVectors(t,e){return this.copy(t).multiply(e)}addScaledVector(t,e){return this.add(new this.constructor(t).multiplyScalar(e))}}var ag=1e-6,Gc=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var r=0,t=arguments.length;t--;)r+=arguments[t]*arguments[t];return Math.sqrt(r)});function oV(){var r=new Gc(2);return Gc!=Float32Array&&(r[0]=0,r[1]=0),r}function $5(r,t,e){return r[0]=t[0]+e[0],r[1]=t[1]+e[1],r}function aV(r,t){return r[0]=-t[0],r[1]=-t[1],r}function W5(r,t,e,n){var i=t[0],s=t[1];return r[0]=i+n*(e[0]-i),r[1]=s+n*(e[1]-s),r}function cV(r,t,e){var n=t[0],i=t[1];return r[0]=e[0]*n+e[2]*i,r[1]=e[1]*n+e[3]*i,r}function lV(r,t,e){var n=t[0],i=t[1];return r[0]=e[0]*n+e[2]*i+e[4],r[1]=e[1]*n+e[3]*i+e[5],r}function X5(r,t,e){var n=t[0],i=t[1];return r[0]=e[0]*n+e[3]*i+e[6],r[1]=e[1]*n+e[4]*i+e[7],r}function J5(r,t,e){var n=t[0],i=t[1];return r[0]=e[0]*n+e[4]*i+e[12],r[1]=e[1]*n+e[5]*i+e[13],r}(function(){var r=oV();return function(t,e,n,i,s,a){var o,A;for(e||(e=2),n||(n=0),i?A=Math.min(i*e+n,t.length):A=t.length,o=n;o<A;o+=e)r[0]=t[o],r[1]=t[o+1],s(r,r,a),t[o]=r[0],t[o+1]=r[1];return t}})();function Y5(r,t,e){const n=t[0],i=t[1],s=e[3]*n+e[7]*i||1;return r[0]=(e[0]*n+e[4]*i)/s,r[1]=(e[1]*n+e[5]*i)/s,r}function Z5(r,t,e){const n=t[0],i=t[1],s=t[2],a=e[3]*n+e[7]*i+e[11]*s||1;return r[0]=(e[0]*n+e[4]*i+e[8]*s)/a,r[1]=(e[1]*n+e[5]*i+e[9]*s)/a,r[2]=(e[2]*n+e[6]*i+e[10]*s)/a,r}function uV(r,t,e){const n=t[0],i=t[1];return r[0]=e[0]*n+e[2]*i,r[1]=e[1]*n+e[3]*i,r[2]=t[2],r}function AV(r,t,e){const n=t[0],i=t[1];return r[0]=e[0]*n+e[2]*i,r[1]=e[1]*n+e[3]*i,r[2]=t[2],r[3]=t[3],r}function t3(r,t,e){const n=t[0],i=t[1],s=t[2];return r[0]=e[0]*n+e[3]*i+e[6]*s,r[1]=e[1]*n+e[4]*i+e[7]*s,r[2]=e[2]*n+e[5]*i+e[8]*s,r[3]=t[3],r}class Lb extends Ib{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;super(2),MA(t)&&arguments.length===1?this.copy(t):(Cs.debug&&(zn(t),zn(e)),this[0]=t,this[1]=e)}set(t,e){return this[0]=t,this[1]=e,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this.check()}fromObject(t){return Cs.debug&&(zn(t.x),zn(t.y)),this[0]=t.x,this[1]=t.y,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return J5(this,this,t),this.check()}transformAsVector(t){return Y5(this,this,t),this.check()}transformByMatrix3(t){return X5(this,this,t),this.check()}transformByMatrix2x3(t){return lV(this,this,t),this.check()}transformByMatrix2(t){return cV(this,this,t),this.check()}}function e3(){var r=new Gc(3);return Gc!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function r3(r){var t=r[0],e=r[1],n=r[2];return Math.hypot(t,e,n)}function n3(r,t,e){var n=new Gc(3);return n[0]=r,n[1]=t,n[2]=e,n}function hV(r,t,e){return r[0]=t[0]-e[0],r[1]=t[1]-e[1],r[2]=t[2]-e[2],r}function dV(r,t){return r[0]=-t[0],r[1]=-t[1],r[2]=-t[2],r}function fV(r,t){var e=t[0],n=t[1],i=t[2],s=e*e+n*n+i*i;return s>0&&(s=1/Math.sqrt(s)),r[0]=t[0]*s,r[1]=t[1]*s,r[2]=t[2]*s,r}function Fb(r,t){return r[0]*t[0]+r[1]*t[1]+r[2]*t[2]}function P0(r,t,e){var n=t[0],i=t[1],s=t[2],a=e[0],o=e[1],A=e[2];return r[0]=i*A-s*o,r[1]=s*a-n*A,r[2]=n*o-i*a,r}function Pb(r,t,e){var n=t[0],i=t[1],s=t[2],a=e[3]*n+e[7]*i+e[11]*s+e[15];return a=a||1,r[0]=(e[0]*n+e[4]*i+e[8]*s+e[12])/a,r[1]=(e[1]*n+e[5]*i+e[9]*s+e[13])/a,r[2]=(e[2]*n+e[6]*i+e[10]*s+e[14])/a,r}function i3(r,t,e){var n=t[0],i=t[1],s=t[2];return r[0]=n*e[0]+i*e[3]+s*e[6],r[1]=n*e[1]+i*e[4]+s*e[7],r[2]=n*e[2]+i*e[5]+s*e[8],r}function s3(r,t,e){var n=e[0],i=e[1],s=e[2],a=e[3],o=t[0],A=t[1],f=t[2],m=i*f-s*A,_=s*o-n*f,x=n*A-i*o,B=i*x-s*_,P=s*m-n*x,M=n*_-i*m,k=a*2;return m*=k,_*=k,x*=k,B*=2,P*=2,M*=2,r[0]=o+m+B,r[1]=A+_+P,r[2]=f+x+M,r}function pV(r,t,e,n){var i=[],s=[];return i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],s[0]=i[0],s[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),s[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),r[0]=s[0]+e[0],r[1]=s[1]+e[1],r[2]=s[2]+e[2],r}function gV(r,t,e,n){var i=[],s=[];return i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],s[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),s[1]=i[1],s[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),r[0]=s[0]+e[0],r[1]=s[1]+e[1],r[2]=s[2]+e[2],r}function mV(r,t,e,n){var i=[],s=[];return i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],s[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),s[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),s[2]=i[2],r[0]=s[0]+e[0],r[1]=s[1]+e[1],r[2]=s[2]+e[2],r}function yV(r,t){var e=r[0],n=r[1],i=r[2],s=t[0],a=t[1],o=t[2],A=Math.sqrt(e*e+n*n+i*i),f=Math.sqrt(s*s+a*a+o*o),m=A*f,_=m&&Fb(r,t)/m;return Math.acos(Math.min(Math.max(_,-1),1))}var _V=hV,vV=r3;(function(){var r=e3();return function(t,e,n,i,s,a){var o,A;for(e||(e=3),n||(n=0),i?A=Math.min(i*e+n,t.length):A=t.length,o=n;o<A;o+=e)r[0]=t[o],r[1]=t[o+1],r[2]=t[o+2],s(r,r,a),t[o]=r[0],t[o+1]=r[1],t[o+2]=r[2];return t}})();const Mb=[0,0,0];let M0;class le extends Ib{static get ZERO(){return M0||(M0=new le(0,0,0),Object.freeze(M0)),M0}constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;super(-0,-0,-0),arguments.length===1&&MA(t)?this.copy(t):(Cs.debug&&(zn(t),zn(e),zn(n)),this[0]=t,this[1]=e,this[2]=n)}set(t,e,n){return this[0]=t,this[1]=e,this[2]=n,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.check()}fromObject(t){return Cs.debug&&(zn(t.x),zn(t.y),zn(t.z)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t}get ELEMENTS(){return 3}get z(){return this[2]}set z(t){this[2]=zn(t)}angle(t){return yV(this,t)}cross(t){return P0(this,this,t),this.check()}rotateX(t){let{radians:e,origin:n=Mb}=t;return pV(this,this,n,e),this.check()}rotateY(t){let{radians:e,origin:n=Mb}=t;return gV(this,this,n,e),this.check()}rotateZ(t){let{radians:e,origin:n=Mb}=t;return mV(this,this,n,e),this.check()}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return Pb(this,this,t),this.check()}transformAsVector(t){return Z5(this,this,t),this.check()}transformByMatrix3(t){return i3(this,this,t),this.check()}transformByMatrix2(t){return uV(this,this,t),this.check()}transformByQuaternion(t){return s3(this,this,t),this.check()}}let U0;class Ub extends Ib{static get ZERO(){return U0||(U0=new Ub(0,0,0,0),Object.freeze(U0)),U0}constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;super(-0,-0,-0,-0),MA(t)&&arguments.length===1?this.copy(t):(Cs.debug&&(zn(t),zn(e),zn(n),zn(i)),this[0]=t,this[1]=e,this[2]=n,this[3]=i)}set(t,e,n,i){return this[0]=t,this[1]=e,this[2]=n,this[3]=i,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}fromObject(t){return Cs.debug&&(zn(t.x),zn(t.y),zn(t.z),zn(t.w)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this[3]=t.w,this}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t.w=this[3],t}get ELEMENTS(){return 4}get z(){return this[2]}set z(t){this[2]=zn(t)}get w(){return this[3]}set w(t){this[3]=zn(t)}transform(t){return Pb(this,this,t),this.check()}transformByMatrix3(t){return t3(this,this,t),this.check()}transformByMatrix2(t){return AV(this,this,t),this.check()}transformByQuaternion(t){return s3(this,this,t),this.check()}applyMatrix4(t){return t.transform(this,this),this}}class o3 extends Tb{toString(){let t="[";if(Cs.printRowMajor){t+="row-major:";for(let e=0;e<this.RANK;++e)for(let n=0;n<this.RANK;++n)t+=" ".concat(this[n*this.RANK+e])}else{t+="column-major:";for(let e=0;e<this.ELEMENTS;++e)t+=" ".concat(this[e])}return t+="]",t}getElementIndex(t,e){return e*this.RANK+t}getElement(t,e){return this[e*this.RANK+t]}setElement(t,e,n){return this[e*this.RANK+t]=zn(n),this}getColumn(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Array(this.RANK).fill(-0);const n=t*this.RANK;for(let i=0;i<this.RANK;++i)e[i]=this[n+i];return e}setColumn(t,e){const n=t*this.RANK;for(let i=0;i<this.RANK;++i)this[n+i]=e[i];return this}}function bV(){var r=new Gc(9);return Gc!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r}function wV(r,t){if(r===t){var e=t[1],n=t[2],i=t[5];r[1]=t[3],r[2]=t[6],r[3]=e,r[5]=t[7],r[6]=n,r[7]=i}else r[0]=t[0],r[1]=t[3],r[2]=t[6],r[3]=t[1],r[4]=t[4],r[5]=t[7],r[6]=t[2],r[7]=t[5],r[8]=t[8];return r}function xV(r,t){var e=t[0],n=t[1],i=t[2],s=t[3],a=t[4],o=t[5],A=t[6],f=t[7],m=t[8],_=m*a-o*f,x=-m*s+o*A,B=f*s-a*A,P=e*_+n*x+i*B;return P?(P=1/P,r[0]=_*P,r[1]=(-m*n+i*f)*P,r[2]=(o*n-i*a)*P,r[3]=x*P,r[4]=(m*e-i*A)*P,r[5]=(-o*e+i*s)*P,r[6]=B*P,r[7]=(-f*e+n*A)*P,r[8]=(a*e-n*s)*P,r):null}function BV(r){var t=r[0],e=r[1],n=r[2],i=r[3],s=r[4],a=r[5],o=r[6],A=r[7],f=r[8];return t*(f*s-a*A)+e*(-f*i+a*o)+n*(A*i-s*o)}function a3(r,t,e){var n=t[0],i=t[1],s=t[2],a=t[3],o=t[4],A=t[5],f=t[6],m=t[7],_=t[8],x=e[0],B=e[1],P=e[2],M=e[3],k=e[4],Q=e[5],q=e[6],J=e[7],tt=e[8];return r[0]=x*n+B*a+P*f,r[1]=x*i+B*o+P*m,r[2]=x*s+B*A+P*_,r[3]=M*n+k*a+Q*f,r[4]=M*i+k*o+Q*m,r[5]=M*s+k*A+Q*_,r[6]=q*n+J*a+tt*f,r[7]=q*i+J*o+tt*m,r[8]=q*s+J*A+tt*_,r}function CV(r,t,e){var n=t[0],i=t[1],s=t[2],a=t[3],o=t[4],A=t[5],f=t[6],m=t[7],_=t[8],x=e[0],B=e[1];return r[0]=n,r[1]=i,r[2]=s,r[3]=a,r[4]=o,r[5]=A,r[6]=x*n+B*a+f,r[7]=x*i+B*o+m,r[8]=x*s+B*A+_,r}function EV(r,t,e){var n=t[0],i=t[1],s=t[2],a=t[3],o=t[4],A=t[5],f=t[6],m=t[7],_=t[8],x=Math.sin(e),B=Math.cos(e);return r[0]=B*n+x*a,r[1]=B*i+x*o,r[2]=B*s+x*A,r[3]=B*a-x*n,r[4]=B*o-x*i,r[5]=B*A-x*s,r[6]=f,r[7]=m,r[8]=_,r}function c3(r,t,e){var n=e[0],i=e[1];return r[0]=n*t[0],r[1]=n*t[1],r[2]=n*t[2],r[3]=i*t[3],r[4]=i*t[4],r[5]=i*t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r}function SV(r,t){var e=t[0],n=t[1],i=t[2],s=t[3],a=e+e,o=n+n,A=i+i,f=e*a,m=n*a,_=n*o,x=i*a,B=i*o,P=i*A,M=s*a,k=s*o,Q=s*A;return r[0]=1-_-P,r[3]=m-Q,r[6]=x+k,r[1]=m+Q,r[4]=1-f-P,r[7]=B-M,r[2]=x-k,r[5]=B+M,r[8]=1-f-_,r}var Rb;(function(r){r[r.COL0ROW0=0]="COL0ROW0",r[r.COL0ROW1=1]="COL0ROW1",r[r.COL0ROW2=2]="COL0ROW2",r[r.COL1ROW0=3]="COL1ROW0",r[r.COL1ROW1=4]="COL1ROW1",r[r.COL1ROW2=5]="COL1ROW2",r[r.COL2ROW0=6]="COL2ROW0",r[r.COL2ROW1=7]="COL2ROW1",r[r.COL2ROW2=8]="COL2ROW2"})(Rb||(Rb={}));const TV=Object.freeze([1,0,0,0,1,0,0,0,1]);class zi extends o3{static get IDENTITY(){return LV()}static get ZERO(){return IV()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return Rb}constructor(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(t)?this.copy(t):n.length>0?this.copy([t,...n]):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this.check()}identity(){return this.copy(TV)}fromObject(t){return this.check()}fromQuaternion(t){return SV(this,t),this.check()}set(t,e,n,i,s,a,o,A,f){return this[0]=t,this[1]=e,this[2]=n,this[3]=i,this[4]=s,this[5]=a,this[6]=o,this[7]=A,this[8]=f,this.check()}setRowMajor(t,e,n,i,s,a,o,A,f){return this[0]=t,this[1]=i,this[2]=o,this[3]=e,this[4]=s,this[5]=A,this[6]=n,this[7]=a,this[8]=f,this.check()}determinant(){return BV(this)}transpose(){return wV(this,this),this.check()}invert(){return xV(this,this),this.check()}multiplyLeft(t){return a3(this,t,this),this.check()}multiplyRight(t){return a3(this,this,t),this.check()}rotate(t){return EV(this,this,t),this.check()}scale(t){return Array.isArray(t)?c3(this,this,t):c3(this,this,[t,t]),this.check()}translate(t){return CV(this,this,t),this.check()}transform(t,e){let n;switch(t.length){case 2:n=X5(e||[-0,-0],t,this);break;case 3:n=i3(e||[-0,-0,-0],t,this);break;case 4:n=t3(e||[-0,-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return og(n,t.length),n}transformVector(t,e){return this.transform(t,e)}transformVector2(t,e){return this.transform(t,e)}transformVector3(t,e){return this.transform(t,e)}}let R0,O0;function IV(){return R0||(R0=new zi([0,0,0,0,0,0,0,0,0]),Object.freeze(R0)),R0}function LV(){return O0||(O0=new zi,Object.freeze(O0)),O0}function FV(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function PV(r,t){if(r===t){var e=t[1],n=t[2],i=t[3],s=t[6],a=t[7],o=t[11];r[1]=t[4],r[2]=t[8],r[3]=t[12],r[4]=e,r[6]=t[9],r[7]=t[13],r[8]=n,r[9]=s,r[11]=t[14],r[12]=i,r[13]=a,r[14]=o}else r[0]=t[0],r[1]=t[4],r[2]=t[8],r[3]=t[12],r[4]=t[1],r[5]=t[5],r[6]=t[9],r[7]=t[13],r[8]=t[2],r[9]=t[6],r[10]=t[10],r[11]=t[14],r[12]=t[3],r[13]=t[7],r[14]=t[11],r[15]=t[15];return r}function Ob(r,t){var e=t[0],n=t[1],i=t[2],s=t[3],a=t[4],o=t[5],A=t[6],f=t[7],m=t[8],_=t[9],x=t[10],B=t[11],P=t[12],M=t[13],k=t[14],Q=t[15],q=e*o-n*a,J=e*A-i*a,tt=e*f-s*a,ft=n*A-i*o,pt=n*f-s*o,mt=i*f-s*A,dt=m*M-_*P,Rt=m*k-x*P,Lt=m*Q-B*P,st=_*k-x*M,ct=_*Q-B*M,wt=x*Q-B*k,yt=q*wt-J*ct+tt*st+ft*Lt-pt*Rt+mt*dt;return yt?(yt=1/yt,r[0]=(o*wt-A*ct+f*st)*yt,r[1]=(i*ct-n*wt-s*st)*yt,r[2]=(M*mt-k*pt+Q*ft)*yt,r[3]=(x*pt-_*mt-B*ft)*yt,r[4]=(A*Lt-a*wt-f*Rt)*yt,r[5]=(e*wt-i*Lt+s*Rt)*yt,r[6]=(k*tt-P*mt-Q*J)*yt,r[7]=(m*mt-x*tt+B*J)*yt,r[8]=(a*ct-o*Lt+f*dt)*yt,r[9]=(n*Lt-e*ct-s*dt)*yt,r[10]=(P*pt-M*tt+Q*q)*yt,r[11]=(_*tt-m*pt-B*q)*yt,r[12]=(o*Rt-a*st-A*dt)*yt,r[13]=(e*st-n*Rt+i*dt)*yt,r[14]=(M*J-P*ft-k*q)*yt,r[15]=(m*ft-_*J+x*q)*yt,r):null}function MV(r){var t=r[0],e=r[1],n=r[2],i=r[3],s=r[4],a=r[5],o=r[6],A=r[7],f=r[8],m=r[9],_=r[10],x=r[11],B=r[12],P=r[13],M=r[14],k=r[15],Q=t*a-e*s,q=t*o-n*s,J=t*A-i*s,tt=e*o-n*a,ft=e*A-i*a,pt=n*A-i*o,mt=f*P-m*B,dt=f*M-_*B,Rt=f*k-x*B,Lt=m*M-_*P,st=m*k-x*P,ct=_*k-x*M;return Q*ct-q*st+J*Lt+tt*Rt-ft*dt+pt*mt}function kh(r,t,e){var n=t[0],i=t[1],s=t[2],a=t[3],o=t[4],A=t[5],f=t[6],m=t[7],_=t[8],x=t[9],B=t[10],P=t[11],M=t[12],k=t[13],Q=t[14],q=t[15],J=e[0],tt=e[1],ft=e[2],pt=e[3];return r[0]=J*n+tt*o+ft*_+pt*M,r[1]=J*i+tt*A+ft*x+pt*k,r[2]=J*s+tt*f+ft*B+pt*Q,r[3]=J*a+tt*m+ft*P+pt*q,J=e[4],tt=e[5],ft=e[6],pt=e[7],r[4]=J*n+tt*o+ft*_+pt*M,r[5]=J*i+tt*A+ft*x+pt*k,r[6]=J*s+tt*f+ft*B+pt*Q,r[7]=J*a+tt*m+ft*P+pt*q,J=e[8],tt=e[9],ft=e[10],pt=e[11],r[8]=J*n+tt*o+ft*_+pt*M,r[9]=J*i+tt*A+ft*x+pt*k,r[10]=J*s+tt*f+ft*B+pt*Q,r[11]=J*a+tt*m+ft*P+pt*q,J=e[12],tt=e[13],ft=e[14],pt=e[15],r[12]=J*n+tt*o+ft*_+pt*M,r[13]=J*i+tt*A+ft*x+pt*k,r[14]=J*s+tt*f+ft*B+pt*Q,r[15]=J*a+tt*m+ft*P+pt*q,r}function D0(r,t,e){var n=e[0],i=e[1],s=e[2],a,o,A,f,m,_,x,B,P,M,k,Q;return t===r?(r[12]=t[0]*n+t[4]*i+t[8]*s+t[12],r[13]=t[1]*n+t[5]*i+t[9]*s+t[13],r[14]=t[2]*n+t[6]*i+t[10]*s+t[14],r[15]=t[3]*n+t[7]*i+t[11]*s+t[15]):(a=t[0],o=t[1],A=t[2],f=t[3],m=t[4],_=t[5],x=t[6],B=t[7],P=t[8],M=t[9],k=t[10],Q=t[11],r[0]=a,r[1]=o,r[2]=A,r[3]=f,r[4]=m,r[5]=_,r[6]=x,r[7]=B,r[8]=P,r[9]=M,r[10]=k,r[11]=Q,r[12]=a*n+m*i+P*s+t[12],r[13]=o*n+_*i+M*s+t[13],r[14]=A*n+x*i+k*s+t[14],r[15]=f*n+B*i+Q*s+t[15]),r}function Db(r,t,e){var n=e[0],i=e[1],s=e[2];return r[0]=t[0]*n,r[1]=t[1]*n,r[2]=t[2]*n,r[3]=t[3]*n,r[4]=t[4]*i,r[5]=t[5]*i,r[6]=t[6]*i,r[7]=t[7]*i,r[8]=t[8]*s,r[9]=t[9]*s,r[10]=t[10]*s,r[11]=t[11]*s,r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r}function UV(r,t,e,n){var i=n[0],s=n[1],a=n[2],o=Math.hypot(i,s,a),A,f,m,_,x,B,P,M,k,Q,q,J,tt,ft,pt,mt,dt,Rt,Lt,st,ct,wt,yt,te;return o<ag?null:(o=1/o,i*=o,s*=o,a*=o,A=Math.sin(e),f=Math.cos(e),m=1-f,_=t[0],x=t[1],B=t[2],P=t[3],M=t[4],k=t[5],Q=t[6],q=t[7],J=t[8],tt=t[9],ft=t[10],pt=t[11],mt=i*i*m+f,dt=s*i*m+a*A,Rt=a*i*m-s*A,Lt=i*s*m-a*A,st=s*s*m+f,ct=a*s*m+i*A,wt=i*a*m+s*A,yt=s*a*m-i*A,te=a*a*m+f,r[0]=_*mt+M*dt+J*Rt,r[1]=x*mt+k*dt+tt*Rt,r[2]=B*mt+Q*dt+ft*Rt,r[3]=P*mt+q*dt+pt*Rt,r[4]=_*Lt+M*st+J*ct,r[5]=x*Lt+k*st+tt*ct,r[6]=B*Lt+Q*st+ft*ct,r[7]=P*Lt+q*st+pt*ct,r[8]=_*wt+M*yt+J*te,r[9]=x*wt+k*yt+tt*te,r[10]=B*wt+Q*yt+ft*te,r[11]=P*wt+q*yt+pt*te,t!==r&&(r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r)}function l3(r,t,e){var n=Math.sin(e),i=Math.cos(e),s=t[4],a=t[5],o=t[6],A=t[7],f=t[8],m=t[9],_=t[10],x=t[11];return t!==r&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[4]=s*i+f*n,r[5]=a*i+m*n,r[6]=o*i+_*n,r[7]=A*i+x*n,r[8]=f*i-s*n,r[9]=m*i-a*n,r[10]=_*i-o*n,r[11]=x*i-A*n,r}function RV(r,t,e){var n=Math.sin(e),i=Math.cos(e),s=t[0],a=t[1],o=t[2],A=t[3],f=t[8],m=t[9],_=t[10],x=t[11];return t!==r&&(r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[0]=s*i-f*n,r[1]=a*i-m*n,r[2]=o*i-_*n,r[3]=A*i-x*n,r[8]=s*n+f*i,r[9]=a*n+m*i,r[10]=o*n+_*i,r[11]=A*n+x*i,r}function u3(r,t,e){var n=Math.sin(e),i=Math.cos(e),s=t[0],a=t[1],o=t[2],A=t[3],f=t[4],m=t[5],_=t[6],x=t[7];return t!==r&&(r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[0]=s*i+f*n,r[1]=a*i+m*n,r[2]=o*i+_*n,r[3]=A*i+x*n,r[4]=f*i-s*n,r[5]=m*i-a*n,r[6]=_*i-o*n,r[7]=x*i-A*n,r}function OV(r,t){var e=t[0],n=t[1],i=t[2],s=t[4],a=t[5],o=t[6],A=t[8],f=t[9],m=t[10];return r[0]=Math.hypot(e,n,i),r[1]=Math.hypot(s,a,o),r[2]=Math.hypot(A,f,m),r}function DV(r,t){var e=t[0],n=t[1],i=t[2],s=t[3],a=e+e,o=n+n,A=i+i,f=e*a,m=n*a,_=n*o,x=i*a,B=i*o,P=i*A,M=s*a,k=s*o,Q=s*A;return r[0]=1-_-P,r[1]=m+Q,r[2]=x-k,r[3]=0,r[4]=m-Q,r[5]=1-f-P,r[6]=B+M,r[7]=0,r[8]=x+k,r[9]=B-M,r[10]=1-f-_,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function NV(r,t,e,n,i,s,a){var o=1/(e-t),A=1/(i-n),f=1/(s-a);return r[0]=s*2*o,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=s*2*A,r[6]=0,r[7]=0,r[8]=(e+t)*o,r[9]=(i+n)*A,r[10]=(a+s)*f,r[11]=-1,r[12]=0,r[13]=0,r[14]=a*s*2*f,r[15]=0,r}function kV(r,t,e,n,i){var s=1/Math.tan(t/2),a;return r[0]=s/e,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=s,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,i!=null&&i!==1/0?(a=1/(n-i),r[10]=(i+n)*a,r[14]=2*i*n*a):(r[10]=-1,r[14]=-2*n),r}var QV=kV;function HV(r,t,e,n,i,s,a){var o=1/(t-e),A=1/(n-i),f=1/(s-a);return r[0]=-2*o,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*A,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*f,r[11]=0,r[12]=(t+e)*o,r[13]=(i+n)*A,r[14]=(a+s)*f,r[15]=1,r}var zV=HV;function GV(r,t,e,n){var i,s,a,o,A,f,m,_,x,B,P=t[0],M=t[1],k=t[2],Q=n[0],q=n[1],J=n[2],tt=e[0],ft=e[1],pt=e[2];return Math.abs(P-tt)<ag&&Math.abs(M-ft)<ag&&Math.abs(k-pt)<ag?FV(r):(m=P-tt,_=M-ft,x=k-pt,B=1/Math.hypot(m,_,x),m*=B,_*=B,x*=B,i=q*x-J*_,s=J*m-Q*x,a=Q*_-q*m,B=Math.hypot(i,s,a),B?(B=1/B,i*=B,s*=B,a*=B):(i=0,s=0,a=0),o=_*a-x*s,A=x*i-m*a,f=m*s-_*i,B=Math.hypot(o,A,f),B?(B=1/B,o*=B,A*=B,f*=B):(o=0,A=0,f=0),r[0]=i,r[1]=o,r[2]=m,r[3]=0,r[4]=s,r[5]=A,r[6]=_,r[7]=0,r[8]=a,r[9]=f,r[10]=x,r[11]=0,r[12]=-(i*P+s*M+a*k),r[13]=-(o*P+A*M+f*k),r[14]=-(m*P+_*M+x*k),r[15]=1,r)}function VV(){var r=new Gc(4);return Gc!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0,r[3]=0),r}function jV(r,t,e){return r[0]=t[0]+e[0],r[1]=t[1]+e[1],r[2]=t[2]+e[2],r[3]=t[3]+e[3],r}function A3(r,t,e){return r[0]=t[0]*e,r[1]=t[1]*e,r[2]=t[2]*e,r[3]=t[3]*e,r}function qV(r){var t=r[0],e=r[1],n=r[2],i=r[3];return Math.hypot(t,e,n,i)}function KV(r){var t=r[0],e=r[1],n=r[2],i=r[3];return t*t+e*e+n*n+i*i}function $V(r,t){var e=t[0],n=t[1],i=t[2],s=t[3],a=e*e+n*n+i*i+s*s;return a>0&&(a=1/Math.sqrt(a)),r[0]=e*a,r[1]=n*a,r[2]=i*a,r[3]=s*a,r}function WV(r,t){return r[0]*t[0]+r[1]*t[1]+r[2]*t[2]+r[3]*t[3]}function XV(r,t,e,n){var i=t[0],s=t[1],a=t[2],o=t[3];return r[0]=i+n*(e[0]-i),r[1]=s+n*(e[1]-s),r[2]=a+n*(e[2]-a),r[3]=o+n*(e[3]-o),r}function cg(r,t,e){var n=t[0],i=t[1],s=t[2],a=t[3];return r[0]=e[0]*n+e[4]*i+e[8]*s+e[12]*a,r[1]=e[1]*n+e[5]*i+e[9]*s+e[13]*a,r[2]=e[2]*n+e[6]*i+e[10]*s+e[14]*a,r[3]=e[3]*n+e[7]*i+e[11]*s+e[15]*a,r}function JV(r,t,e){var n=t[0],i=t[1],s=t[2],a=e[0],o=e[1],A=e[2],f=e[3],m=f*n+o*s-A*i,_=f*i+A*n-a*s,x=f*s+a*i-o*n,B=-a*n-o*i-A*s;return r[0]=m*f+B*-a+_*-A-x*-o,r[1]=_*f+B*-o+x*-a-m*-A,r[2]=x*f+B*-A+m*-o-_*-a,r[3]=t[3],r}(function(){var r=VV();return function(t,e,n,i,s,a){var o,A;for(e||(e=4),n||(n=0),i?A=Math.min(i*e+n,t.length):A=t.length,o=n;o<A;o+=e)r[0]=t[o],r[1]=t[o+1],r[2]=t[o+2],r[3]=t[o+3],s(r,r,a),t[o]=r[0],t[o+1]=r[1],t[o+2]=r[2],t[o+3]=r[3];return t}})();var Nb;(function(r){r[r.COL0ROW0=0]="COL0ROW0",r[r.COL0ROW1=1]="COL0ROW1",r[r.COL0ROW2=2]="COL0ROW2",r[r.COL0ROW3=3]="COL0ROW3",r[r.COL1ROW0=4]="COL1ROW0",r[r.COL1ROW1=5]="COL1ROW1",r[r.COL1ROW2=6]="COL1ROW2",r[r.COL1ROW3=7]="COL1ROW3",r[r.COL2ROW0=8]="COL2ROW0",r[r.COL2ROW1=9]="COL2ROW1",r[r.COL2ROW2=10]="COL2ROW2",r[r.COL2ROW3=11]="COL2ROW3",r[r.COL3ROW0=12]="COL3ROW0",r[r.COL3ROW1=13]="COL3ROW1",r[r.COL3ROW2=14]="COL3ROW2",r[r.COL3ROW3=15]="COL3ROW3"})(Nb||(Nb={}));const YV=45*Math.PI/180,ZV=1,kb=.1,Qb=500,tj=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Bn extends o3{static get IDENTITY(){return rj()}static get ZERO(){return ej()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return Nb}constructor(t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(t)?this.copy(t):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this[9]=t[9],this[10]=t[10],this[11]=t[11],this[12]=t[12],this[13]=t[13],this[14]=t[14],this[15]=t[15],this.check()}set(t,e,n,i,s,a,o,A,f,m,_,x,B,P,M,k){return this[0]=t,this[1]=e,this[2]=n,this[3]=i,this[4]=s,this[5]=a,this[6]=o,this[7]=A,this[8]=f,this[9]=m,this[10]=_,this[11]=x,this[12]=B,this[13]=P,this[14]=M,this[15]=k,this.check()}setRowMajor(t,e,n,i,s,a,o,A,f,m,_,x,B,P,M,k){return this[0]=t,this[1]=s,this[2]=f,this[3]=B,this[4]=e,this[5]=a,this[6]=m,this[7]=P,this[8]=n,this[9]=o,this[10]=_,this[11]=M,this[12]=i,this[13]=A,this[14]=x,this[15]=k,this.check()}toRowMajor(t){return t[0]=this[0],t[1]=this[4],t[2]=this[8],t[3]=this[12],t[4]=this[1],t[5]=this[5],t[6]=this[9],t[7]=this[13],t[8]=this[2],t[9]=this[6],t[10]=this[10],t[11]=this[14],t[12]=this[3],t[13]=this[7],t[14]=this[11],t[15]=this[15],t}identity(){return this.copy(tj)}fromObject(t){return this.check()}fromQuaternion(t){return DV(this,t),this.check()}frustum(t){const{left:e,right:n,bottom:i,top:s,near:a=kb,far:o=Qb}=t;return o===1/0?nj(this,e,n,i,s,a):NV(this,e,n,i,s,a,o),this.check()}lookAt(t){const{eye:e,center:n=[0,0,0],up:i=[0,1,0]}=t;return GV(this,e,n,i),this.check()}ortho(t){const{left:e,right:n,bottom:i,top:s,near:a=kb,far:o=Qb}=t;return zV(this,e,n,i,s,a,o),this.check()}orthographic(t){const{fovy:e=YV,aspect:n=ZV,focalDistance:i=1,near:s=kb,far:a=Qb}=t;h3(e);const o=e/2,A=i*Math.tan(o),f=A*n;return this.ortho({left:-f,right:f,bottom:-A,top:A,near:s,far:a})}perspective(t){const{fovy:e=45*Math.PI/180,aspect:n=1,near:i=.1,far:s=500}=t;return h3(e),QV(this,e,n,i,s),this.check()}determinant(){return MV(this)}getScale(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[-0,-0,-0];return t[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),t[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),t[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),t}getTranslation(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[-0,-0,-0];return t[0]=this[12],t[1]=this[13],t[2]=this[14],t}getRotation(t,e){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],e=e||[-0,-0,-0];const n=this.getScale(e),i=1/n[0],s=1/n[1],a=1/n[2];return t[0]=this[0]*i,t[1]=this[1]*s,t[2]=this[2]*a,t[3]=0,t[4]=this[4]*i,t[5]=this[5]*s,t[6]=this[6]*a,t[7]=0,t[8]=this[8]*i,t[9]=this[9]*s,t[10]=this[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}getRotationMatrix3(t,e){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0],e=e||[-0,-0,-0];const n=this.getScale(e),i=1/n[0],s=1/n[1],a=1/n[2];return t[0]=this[0]*i,t[1]=this[1]*s,t[2]=this[2]*a,t[3]=this[4]*i,t[4]=this[5]*s,t[5]=this[6]*a,t[6]=this[8]*i,t[7]=this[9]*s,t[8]=this[10]*a,t}transpose(){return PV(this,this),this.check()}invert(){return Ob(this,this),this.check()}multiplyLeft(t){return kh(this,t,this),this.check()}multiplyRight(t){return kh(this,this,t),this.check()}rotateX(t){return l3(this,this,t),this.check()}rotateY(t){return RV(this,this,t),this.check()}rotateZ(t){return u3(this,this,t),this.check()}rotateXYZ(t){return this.rotateX(t[0]).rotateY(t[1]).rotateZ(t[2])}rotateAxis(t,e){return UV(this,this,t,e),this.check()}scale(t){return Db(this,this,Array.isArray(t)?t:[t,t,t]),this.check()}translate(t){return D0(this,this,t),this.check()}transform(t,e){return t.length===4?(e=cg(e||[-0,-0,-0,-0],t,this),og(e,4),e):this.transformAsPoint(t,e)}transformAsPoint(t,e){const{length:n}=t;let i;switch(n){case 2:i=J5(e||[-0,-0],t,this);break;case 3:i=Pb(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return og(i,t.length),i}transformAsVector(t,e){let n;switch(t.length){case 2:n=Y5(e||[-0,-0],t,this);break;case 3:n=Z5(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return og(n,t.length),n}transformPoint(t,e){return this.transformAsPoint(t,e)}transformVector(t,e){return this.transformAsPoint(t,e)}transformDirection(t,e){return this.transformAsVector(t,e)}makeRotationX(t){return this.identity().rotateX(t)}makeTranslation(t,e,n){return this.identity().translate([t,e,n])}}let N0,k0;function ej(){return N0||(N0=new Bn([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(N0)),N0}function rj(){return k0||(k0=new Bn,Object.freeze(k0)),k0}function h3(r){if(r>Math.PI*2)throw Error("expected radians")}function nj(r,t,e,n,i,s){const a=2*s/(e-t),o=2*s/(i-n),A=(e+t)/(e-t),f=(i+n)/(i-n),m=-1,_=-1,x=-2*s;return r[0]=a,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=o,r[6]=0,r[7]=0,r[8]=A,r[9]=f,r[10]=m,r[11]=_,r[12]=0,r[13]=0,r[14]=x,r[15]=0,r}function d3(){var r=new Gc(4);return Gc!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function ij(r){return r[0]=0,r[1]=0,r[2]=0,r[3]=1,r}function f3(r,t,e){e=e*.5;var n=Math.sin(e);return r[0]=n*t[0],r[1]=n*t[1],r[2]=n*t[2],r[3]=Math.cos(e),r}function p3(r,t,e){var n=t[0],i=t[1],s=t[2],a=t[3],o=e[0],A=e[1],f=e[2],m=e[3];return r[0]=n*m+a*o+i*f-s*A,r[1]=i*m+a*A+s*o-n*f,r[2]=s*m+a*f+n*A-i*o,r[3]=a*m-n*o-i*A-s*f,r}function sj(r,t,e){e*=.5;var n=t[0],i=t[1],s=t[2],a=t[3],o=Math.sin(e),A=Math.cos(e);return r[0]=n*A+a*o,r[1]=i*A+s*o,r[2]=s*A-i*o,r[3]=a*A-n*o,r}function oj(r,t,e){e*=.5;var n=t[0],i=t[1],s=t[2],a=t[3],o=Math.sin(e),A=Math.cos(e);return r[0]=n*A-s*o,r[1]=i*A+a*o,r[2]=s*A+n*o,r[3]=a*A-i*o,r}function aj(r,t,e){e*=.5;var n=t[0],i=t[1],s=t[2],a=t[3],o=Math.sin(e),A=Math.cos(e);return r[0]=n*A+i*o,r[1]=i*A-n*o,r[2]=s*A+a*o,r[3]=a*A-s*o,r}function cj(r,t){var e=t[0],n=t[1],i=t[2];return r[0]=e,r[1]=n,r[2]=i,r[3]=Math.sqrt(Math.abs(1-e*e-n*n-i*i)),r}function Q0(r,t,e,n){var i=t[0],s=t[1],a=t[2],o=t[3],A=e[0],f=e[1],m=e[2],_=e[3],x,B,P,M,k;return B=i*A+s*f+a*m+o*_,B<0&&(B=-B,A=-A,f=-f,m=-m,_=-_),1-B>ag?(x=Math.acos(B),P=Math.sin(x),M=Math.sin((1-n)*x)/P,k=Math.sin(n*x)/P):(M=1-n,k=n),r[0]=M*i+k*A,r[1]=M*s+k*f,r[2]=M*a+k*m,r[3]=M*o+k*_,r}function lj(r,t){var e=t[0],n=t[1],i=t[2],s=t[3],a=e*e+n*n+i*i+s*s,o=a?1/a:0;return r[0]=-e*o,r[1]=-n*o,r[2]=-i*o,r[3]=s*o,r}function uj(r,t){return r[0]=-t[0],r[1]=-t[1],r[2]=-t[2],r[3]=t[3],r}function g3(r,t){var e=t[0]+t[4]+t[8],n;if(e>0)n=Math.sqrt(e+1),r[3]=.5*n,n=.5/n,r[0]=(t[5]-t[7])*n,r[1]=(t[6]-t[2])*n,r[2]=(t[1]-t[3])*n;else{var i=0;t[4]>t[0]&&(i=1),t[8]>t[i*3+i]&&(i=2);var s=(i+1)%3,a=(i+2)%3;n=Math.sqrt(t[i*3+i]-t[s*3+s]-t[a*3+a]+1),r[i]=.5*n,n=.5/n,r[3]=(t[s*3+a]-t[a*3+s])*n,r[s]=(t[s*3+i]+t[i*3+s])*n,r[a]=(t[a*3+i]+t[i*3+a])*n}return r}var Aj=jV,hj=A3,dj=WV,fj=XV,pj=qV,gj=KV,m3=$V,mj=function(){var r=e3(),t=n3(1,0,0),e=n3(0,1,0);return function(n,i,s){var a=Fb(i,s);return a<-.999999?(P0(r,t,i),vV(r)<1e-6&&P0(r,e,i),fV(r,r),f3(n,r,Math.PI),n):a>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(P0(r,i,s),n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=1+a,m3(n,n))}}();(function(){var r=d3(),t=d3();return function(e,n,i,s,a,o){return Q0(r,n,a,o),Q0(t,i,s,o),Q0(e,r,t,2*o*(1-o)),e}})(),function(){var r=bV();return function(t,e,n,i){return r[0]=n[0],r[3]=n[1],r[6]=n[2],r[1]=i[0],r[4]=i[1],r[7]=i[2],r[2]=-e[0],r[5]=-e[1],r[8]=-e[2],m3(t,g3(t,r))}}();const yj=[0,0,0,1];class lg extends Tb{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;super(-0,-0,-0,-0),Array.isArray(t)&&arguments.length===1?this.copy(t):this.set(t,e,n,i)}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}set(t,e,n,i){return this[0]=t,this[1]=e,this[2]=n,this[3]=i,this.check()}fromObject(t){return this[0]=t.x,this[1]=t.y,this[2]=t.z,this[3]=t.w,this.check()}fromMatrix3(t){return g3(this,t),this.check()}fromAxisRotation(t,e){return f3(this,t,e),this.check()}identity(){return ij(this),this.check()}setAxisAngle(t,e){return this.fromAxisRotation(t,e)}get ELEMENTS(){return 4}get x(){return this[0]}set x(t){this[0]=zn(t)}get y(){return this[1]}set y(t){this[1]=zn(t)}get z(){return this[2]}set z(t){this[2]=zn(t)}get w(){return this[3]}set w(t){this[3]=zn(t)}len(){return pj(this)}lengthSquared(){return gj(this)}dot(t){return dj(this,t)}rotationTo(t,e){return mj(this,t,e),this.check()}add(t){return Aj(this,this,t),this.check()}calculateW(){return cj(this,this),this.check()}conjugate(){return uj(this,this),this.check()}invert(){return lj(this,this),this.check()}lerp(t,e,n){return n===void 0?this.lerp(this,t,e):(fj(this,t,e,n),this.check())}multiplyRight(t){return p3(this,this,t),this.check()}multiplyLeft(t){return p3(this,t,this),this.check()}normalize(){const t=this.len(),e=t>0?1/t:0;return this[0]=this[0]*e,this[1]=this[1]*e,this[2]=this[2]*e,this[3]=this[3]*e,t===0&&(this[3]=1),this.check()}rotateX(t){return sj(this,this,t),this.check()}rotateY(t){return oj(this,this,t),this.check()}rotateZ(t){return aj(this,this,t),this.check()}scale(t){return hj(this,this,t),this.check()}slerp(t,e,n){let i,s,a;switch(arguments.length){case 1:({start:i=yj,target:s,ratio:a}=t);break;case 2:i=this,s=t,a=e;break;default:i=t,s=e,a=n}return Q0(this,i,s,a),this.check()}transformVector4(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Ub;return JV(e,t,this),og(e,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(t,e){return this.setAxisAngle(t,e)}premultiply(t){return this.multiplyLeft(t)}multiply(t){return this.multiplyRight(t)}}const ug={EPSILON1:.1,EPSILON2:.01,EPSILON3:.001,EPSILON4:1e-4,EPSILON5:1e-5,EPSILON6:1e-6,EPSILON7:1e-7,EPSILON8:1e-8,EPSILON9:1e-9,EPSILON10:1e-10,EPSILON11:1e-11,EPSILON12:1e-12,EPSILON13:1e-13,EPSILON14:1e-14,EPSILON15:1e-15,EPSILON16:1e-16,EPSILON17:1e-17,EPSILON18:1e-18,EPSILON19:1e-19,EPSILON20:1e-20,PI_OVER_TWO:Math.PI/2,PI_OVER_FOUR:Math.PI/4,PI_OVER_SIX:Math.PI/6,TWO_PI:Math.PI*2},y3=`#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))

struct AmbientLight {
 vec3 color;
};

struct PointLight {
 vec3 color;
 vec3 position;
 vec3 attenuation;
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform AmbientLight lighting_uAmbientLight;
uniform PointLight lighting_uPointLight[MAX_LIGHTS];
uniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];
uniform int lighting_uPointLightCount;
uniform int lighting_uDirectionalLightCount;

uniform bool lighting_uEnabled;

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

#endif
`,_j={lightSources:{}};function Hb(){let{color:r=[0,0,0],intensity:t=1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return r.map(e=>e*t/255)}function vj(r){let{ambientLight:t,pointLights:e=[],directionalLights:n=[]}=r;const i={};return t?i["lighting_uAmbientLight.color"]=Hb(t):i["lighting_uAmbientLight.color"]=[0,0,0],e.forEach((s,a)=>{i["lighting_uPointLight[".concat(a,"].color")]=Hb(s),i["lighting_uPointLight[".concat(a,"].position")]=s.position,i["lighting_uPointLight[".concat(a,"].attenuation")]=s.attenuation||[1,0,0]}),i.lighting_uPointLightCount=e.length,n.forEach((s,a)=>{i["lighting_uDirectionalLight[".concat(a,"].color")]=Hb(s),i["lighting_uDirectionalLight[".concat(a,"].direction")]=s.direction}),i.lighting_uDirectionalLightCount=n.length,i}function _3(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:_j;if("lightSources"in r){const{ambientLight:t,pointLights:e,directionalLights:n}=r.lightSources||{};return t||e&&e.length>0||n&&n.length>0?Object.assign({},vj({ambientLight:t,pointLights:e,directionalLights:n}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in r){const t={pointLights:[],directionalLights:[]};for(const e of r.lights||[])switch(e.type){case"ambient":t.ambientLight=e;break;case"directional":t.directionalLights.push(e);break;case"point":t.pointLights.push(e);break}return _3({lightSources:t})}return{}}const zb={name:"lights",vs:y3,fs:y3,getUniforms:_3,defines:{MAX_LIGHTS:3}},bj={pickingSelectedColor:null,pickingHighlightColor:new Uint8Array([0,255,255,255]),pickingActive:!1,pickingAttribute:!1};function wj(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:bj;const t={};if(r.pickingSelectedColor!==void 0)if(!r.pickingSelectedColor)t.picking_uSelectedColorValid=0;else{const e=r.pickingSelectedColor.slice(0,3);t.picking_uSelectedColorValid=1,t.picking_uSelectedColor=e}if(r.pickingHighlightColor){const e=Array.from(r.pickingHighlightColor,n=>n/255);Number.isFinite(e[3])||(e[3]=1),t.picking_uHighlightColor=e}return r.pickingActive!==void 0&&(t.picking_uActive=!!r.pickingActive,t.picking_uAttribute=!!r.pickingAttribute),t}const xj={name:"picking",vs:`uniform bool picking_uActive;
uniform bool picking_uAttribute;
uniform vec3 picking_uSelectedColor;
uniform bool picking_uSelectedColorValid;

out vec4 picking_vRGBcolor_Avalid;

const float COLOR_SCALE = 1. / 255.;

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.001;
}

bool isVertexPicked(vec3 vertexColor) {
  return
    picking_uSelectedColorValid &&
    !picking_isColorValid(abs(vertexColor - picking_uSelectedColor));
}

void picking_setPickingColor(vec3 pickingColor) {
  if (picking_uActive) {
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!picking_uAttribute) {
      picking_vRGBcolor_Avalid.rgb = pickingColor * COLOR_SCALE;
    }
  } else {
    picking_vRGBcolor_Avalid.a = float(isVertexPicked(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.r = value;
  }
}
void picking_setPickingAttribute(vec2 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}
void picking_setPickingAttribute(vec3 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,fs:`uniform bool picking_uActive;
uniform vec3 picking_uSelectedColor;
uniform vec4 picking_uHighlightColor;

in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
  if (picking_uActive) {
    return color;
  }
  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    float highLightAlpha = picking_uHighlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking_uHighlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}
vec4 picking_filterPickingColor(vec4 color) {
  if (picking_uActive) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}
vec4 picking_filterColor(vec4 color) {
  vec4 highightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highightColor);
}

`,getUniforms:wj},v3=`
uniform float lighting_uAmbient;
uniform float lighting_uDiffuse;
uniform float lighting_uShininess;
uniform vec3  lighting_uSpecularColor;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
    vec3 halfway_direction = normalize(light_direction + view_direction);
    float lambertian = dot(light_direction, normal_worldspace);
    float specular = 0.0;
    if (lambertian > 0.0) {
      float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
      specular = pow(specular_angle, lighting_uShininess);
    }
    lambertian = max(lambertian, 0.0);
    return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);
    lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}

vec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = vec3(0, 0, 0);
  vec3 surfaceColor = vec3(0, 0, 0);

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}
`,Bj={};function Cj(r){const{ambient:t=.35,diffuse:e=.6,shininess:n=32,specularColor:i=[30,30,30]}=r;return{lighting_uAmbient:t,lighting_uDiffuse:e,lighting_uShininess:n,lighting_uSpecularColor:i.map(s=>s/255)}}function b3(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Bj;if(!("material"in r))return{};const{material:t}=r;return t?Cj(t):{lighting_uEnabled:!1}}const Ej={name:"gouraud-lighting",dependencies:[zb],vs:v3,defines:{LIGHTING_VERTEX:1},getUniforms:b3},Sj={name:"phong-lighting",dependencies:[zb],fs:v3,defines:{LIGHTING_FRAGMENT:1},getUniforms:b3},Gb={name:"pbr",vs:`uniform mat4 u_MVPMatrix;
uniform mat4 u_ModelMatrix;
uniform mat4 u_NormalMatrix;

varying vec3 pbr_vPosition;
varying vec2 pbr_vUV;

#ifdef HAS_NORMALS
# ifdef HAS_TANGENTS
varying mat3 pbr_vTBN;
# else
varying vec3 pbr_vNormal;
# endif
#endif

void pbr_setPositionNormalTangentUV(vec4 position, vec4 normal, vec4 tangent, vec2 uv)
{
  vec4 pos = u_ModelMatrix * position;
  pbr_vPosition = vec3(pos.xyz) / pos.w;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
  vec3 normalW = normalize(vec3(u_NormalMatrix * vec4(normal.xyz, 0.0)));
  vec3 tangentW = normalize(vec3(u_ModelMatrix * vec4(tangent.xyz, 0.0)));
  vec3 bitangentW = cross(normalW, tangentW) * tangent.w;
  pbr_vTBN = mat3(tangentW, bitangentW, normalW);
#else
  pbr_vNormal = normalize(vec3(u_ModelMatrix * vec4(normal.xyz, 0.0)));
#endif
#endif

#ifdef HAS_UV
  pbr_vUV = uv;
#else
  pbr_vUV = vec2(0.,0.);
#endif
}
`,fs:`#if defined(USE_TEX_LOD) && !defined(FEATURE_GLSL_TEXTURE_LOD)
# error PBR fragment shader: Texture LOD is not available
#endif

#if !defined(HAS_TANGENTS) && !defined(FEATURE_GLSL_DERIVATIVES)
# error PBR fragment shader: Derivatives are not available
#endif


#if (__VERSION__ < 300)
  #define SMART_FOR(INIT, WEBGL1COND, WEBGL2COND, INCR) for (INIT; WEBGL1COND; INCR)
#else
  #define SMART_FOR(INIT, WEBGL1COND, WEBGL2COND, INCR) for (INIT; WEBGL2COND; INCR)
#endif

precision highp float;

uniform bool pbr_uUnlit;

#ifdef USE_IBL
uniform samplerCube u_DiffuseEnvSampler;
uniform samplerCube u_SpecularEnvSampler;
uniform sampler2D u_brdfLUT;
uniform vec2 u_ScaleIBLAmbient;
#endif

#ifdef HAS_BASECOLORMAP
uniform sampler2D u_BaseColorSampler;
#endif
#ifdef HAS_NORMALMAP
uniform sampler2D u_NormalSampler;
uniform float u_NormalScale;
#endif
#ifdef HAS_EMISSIVEMAP
uniform sampler2D u_EmissiveSampler;
uniform vec3 u_EmissiveFactor;
#endif
#ifdef HAS_METALROUGHNESSMAP
uniform sampler2D u_MetallicRoughnessSampler;
#endif
#ifdef HAS_OCCLUSIONMAP
uniform sampler2D u_OcclusionSampler;
uniform float u_OcclusionStrength;
#endif

#ifdef ALPHA_CUTOFF
uniform float u_AlphaCutoff;
#endif

uniform vec2 u_MetallicRoughnessValues;
uniform vec4 u_BaseColorFactor;

uniform vec3 u_Camera;
#ifdef PBR_DEBUG
uniform vec4 u_ScaleDiffBaseMR;
uniform vec4 u_ScaleFGDSpec;
#endif

varying vec3 pbr_vPosition;

varying vec2 pbr_vUV;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
varying mat3 pbr_vTBN;
#else
varying vec3 pbr_vNormal;
#endif
#endif


struct PBRInfo
{
  float NdotL;
  float NdotV;
  float NdotH;
  float LdotH;
  float VdotH;
  float perceptualRoughness;
  float metalness;
  vec3 reflectance0;
  vec3 reflectance90;
  float alphaRoughness;
  vec3 diffuseColor;
  vec3 specularColor;
  vec3 n;
  vec3 v;
};

const float M_PI = 3.141592653589793;
const float c_MinRoughness = 0.04;

vec4 SRGBtoLINEAR(vec4 srgbIn)
{
#ifdef MANUAL_SRGB
#ifdef SRGB_FAST_APPROXIMATION
  vec3 linOut = pow(srgbIn.xyz,vec3(2.2));
#else
  vec3 bLess = step(vec3(0.04045),srgbIn.xyz);
  vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );
#endif
  return vec4(linOut,srgbIn.w);;
#else
  return srgbIn;
#endif
}

vec3 getNormal()
{
#ifndef HAS_TANGENTS
  vec3 pos_dx = dFdx(pbr_vPosition);
  vec3 pos_dy = dFdy(pbr_vPosition);
  vec3 tex_dx = dFdx(vec3(pbr_vUV, 0.0));
  vec3 tex_dy = dFdy(vec3(pbr_vUV, 0.0));
  vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);

#ifdef HAS_NORMALS
  vec3 ng = normalize(pbr_vNormal);
#else
  vec3 ng = cross(pos_dx, pos_dy);
#endif

  t = normalize(t - ng * dot(ng, t));
  vec3 b = normalize(cross(ng, t));
  mat3 tbn = mat3(t, b, ng);
#else
  mat3 tbn = pbr_vTBN;
#endif

#ifdef HAS_NORMALMAP
  vec3 n = texture2D(u_NormalSampler, pbr_vUV).rgb;
  n = normalize(tbn * ((2.0 * n - 1.0) * vec3(u_NormalScale, u_NormalScale, 1.0)));
#else
  vec3 n = normalize(tbn[2].xyz);
#endif

  return n;
}


#ifdef USE_IBL
vec3 getIBLContribution(PBRInfo pbrInputs, vec3 n, vec3 reflection)
{
  float mipCount = 9.0;
  float lod = (pbrInputs.perceptualRoughness * mipCount);
  vec3 brdf = SRGBtoLINEAR(texture2D(u_brdfLUT,
    vec2(pbrInputs.NdotV, 1.0 - pbrInputs.perceptualRoughness))).rgb;
  vec3 diffuseLight = SRGBtoLINEAR(textureCube(u_DiffuseEnvSampler, n)).rgb;

#ifdef USE_TEX_LOD
  vec3 specularLight = SRGBtoLINEAR(textureCubeLod(u_SpecularEnvSampler, reflection, lod)).rgb;
#else
  vec3 specularLight = SRGBtoLINEAR(textureCube(u_SpecularEnvSampler, reflection)).rgb;
#endif

  vec3 diffuse = diffuseLight * pbrInputs.diffuseColor;
  vec3 specular = specularLight * (pbrInputs.specularColor * brdf.x + brdf.y);
  diffuse *= u_ScaleIBLAmbient.x;
  specular *= u_ScaleIBLAmbient.y;

  return diffuse + specular;
}
#endif


vec3 diffuse(PBRInfo pbrInputs)
{
  return pbrInputs.diffuseColor / M_PI;
}

vec3 specularReflection(PBRInfo pbrInputs)
{
  return pbrInputs.reflectance0 +
    (pbrInputs.reflectance90 - pbrInputs.reflectance0) *
    pow(clamp(1.0 - pbrInputs.VdotH, 0.0, 1.0), 5.0);
}



float geometricOcclusion(PBRInfo pbrInputs)
{
  float NdotL = pbrInputs.NdotL;
  float NdotV = pbrInputs.NdotV;
  float r = pbrInputs.alphaRoughness;

  float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));
  float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));
  return attenuationL * attenuationV;
}





float microfacetDistribution(PBRInfo pbrInputs)
{
  float roughnessSq = pbrInputs.alphaRoughness * pbrInputs.alphaRoughness;
  float f = (pbrInputs.NdotH * roughnessSq - pbrInputs.NdotH) * pbrInputs.NdotH + 1.0;
  return roughnessSq / (M_PI * f * f);
}

void PBRInfo_setAmbientLight(inout PBRInfo pbrInputs) {
  pbrInputs.NdotL = 1.0;
  pbrInputs.NdotH = 0.0;
  pbrInputs.LdotH = 0.0;
  pbrInputs.VdotH = 1.0;
}

void PBRInfo_setDirectionalLight(inout PBRInfo pbrInputs, vec3 lightDirection) {
  vec3 n = pbrInputs.n;
  vec3 v = pbrInputs.v;
  vec3 l = normalize(lightDirection);
  vec3 h = normalize(l+v);

  pbrInputs.NdotL = clamp(dot(n, l), 0.001, 1.0);
  pbrInputs.NdotH = clamp(dot(n, h), 0.0, 1.0);
  pbrInputs.LdotH = clamp(dot(l, h), 0.0, 1.0);
  pbrInputs.VdotH = clamp(dot(v, h), 0.0, 1.0);
}

void PBRInfo_setPointLight(inout PBRInfo pbrInputs, PointLight pointLight) {
  vec3 light_direction = normalize(pointLight.position - pbr_vPosition);
  PBRInfo_setDirectionalLight(pbrInputs, light_direction);
}

vec3 calculateFinalColor(PBRInfo pbrInputs, vec3 lightColor) {
  vec3 F = specularReflection(pbrInputs);
  float G = geometricOcclusion(pbrInputs);
  float D = microfacetDistribution(pbrInputs);
  vec3 diffuseContrib = (1.0 - F) * diffuse(pbrInputs);
  vec3 specContrib = F * G * D / (4.0 * pbrInputs.NdotL * pbrInputs.NdotV);
  return pbrInputs.NdotL * lightColor * (diffuseContrib + specContrib);
}

vec4 pbr_filterColor(vec4 colorUnused)
{
#ifdef HAS_BASECOLORMAP
  vec4 baseColor = SRGBtoLINEAR(texture2D(u_BaseColorSampler, pbr_vUV)) * u_BaseColorFactor;
#else
  vec4 baseColor = u_BaseColorFactor;
#endif

#ifdef ALPHA_CUTOFF
  if (baseColor.a < u_AlphaCutoff) {
    discard;
  }
#endif

  vec3 color = vec3(0, 0, 0);

  if(pbr_uUnlit){
    color.rgb = baseColor.rgb;
  }
  else{


    float perceptualRoughness = u_MetallicRoughnessValues.y;
    float metallic = u_MetallicRoughnessValues.x;
#ifdef HAS_METALROUGHNESSMAP

    vec4 mrSample = texture2D(u_MetallicRoughnessSampler, pbr_vUV);
    perceptualRoughness = mrSample.g * perceptualRoughness;
    metallic = mrSample.b * metallic;
#endif
    perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);
    metallic = clamp(metallic, 0.0, 1.0);

    float alphaRoughness = perceptualRoughness * perceptualRoughness;

    vec3 f0 = vec3(0.04);
    vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);
    diffuseColor *= 1.0 - metallic;
    vec3 specularColor = mix(f0, baseColor.rgb, metallic);
    float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);



    float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);
    vec3 specularEnvironmentR0 = specularColor.rgb;
    vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;

    vec3 n = getNormal();
    vec3 v = normalize(u_Camera - pbr_vPosition);

    float NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);
    vec3 reflection = -normalize(reflect(v, n));

    PBRInfo pbrInputs = PBRInfo(
      0.0,
      NdotV,
      0.0,
      0.0,
      0.0,
      perceptualRoughness,
      metallic,
      specularEnvironmentR0,
      specularEnvironmentR90,
      alphaRoughness,
      diffuseColor,
      specularColor,
      n,
      v
    );

#ifdef USE_LIGHTS
    PBRInfo_setAmbientLight(pbrInputs);
    color += calculateFinalColor(pbrInputs, lighting_uAmbientLight.color);
    SMART_FOR(int i = 0, i < MAX_LIGHTS, i < lighting_uDirectionalLightCount, i++) {
      if (i < lighting_uDirectionalLightCount) {
        PBRInfo_setDirectionalLight(pbrInputs, lighting_uDirectionalLight[i].direction);
        color += calculateFinalColor(pbrInputs, lighting_uDirectionalLight[i].color);
      }
    }
    SMART_FOR(int i = 0, i < MAX_LIGHTS, i < lighting_uPointLightCount, i++) {
      if (i < lighting_uPointLightCount) {
        PBRInfo_setPointLight(pbrInputs, lighting_uPointLight[i]);
        float attenuation = getPointLightAttenuation(lighting_uPointLight[i], distance(lighting_uPointLight[i].position, pbr_vPosition));
        color += calculateFinalColor(pbrInputs, lighting_uPointLight[i].color / attenuation);
      }
    }
#endif
#ifdef USE_IBL
    color += getIBLContribution(pbrInputs, n, reflection);
#endif
#ifdef HAS_OCCLUSIONMAP
    float ao = texture2D(u_OcclusionSampler, pbr_vUV).r;
    color = mix(color, color * ao, u_OcclusionStrength);
#endif

#ifdef HAS_EMISSIVEMAP
    vec3 emissive = SRGBtoLINEAR(texture2D(u_EmissiveSampler, pbr_vUV)).rgb * u_EmissiveFactor;
    color += emissive;
#endif

#ifdef PBR_DEBUG





    color = mix(color, baseColor.rgb, u_ScaleDiffBaseMR.y);
    color = mix(color, vec3(metallic), u_ScaleDiffBaseMR.z);
    color = mix(color, vec3(perceptualRoughness), u_ScaleDiffBaseMR.w);
#endif

  }

  return vec4(pow(color,vec3(1.0/2.2)), baseColor.a);
}
`,defines:{LIGHTING_FRAGMENT:1},dependencies:[zb]},Tj={name:"transform",vs:`attribute float transform_elementID;
vec2 transform_getPixelSizeHalf(vec2 size) {
  return vec2(1.) / (2. * size);
}

vec2 transform_getPixelIndices(vec2 texSize, vec2 pixelSizeHalf) {
  float yIndex = floor((transform_elementID / texSize[0]) + pixelSizeHalf[1]);
  float xIndex = transform_elementID - (yIndex * texSize[0]);
  return vec2(xIndex, yIndex);
}
vec2 transform_getTexCoord(vec2 size) {
  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);
  vec2 indices = transform_getPixelIndices(size, pixelSizeHalf);
  vec2 coord = indices / size + pixelSizeHalf;
  return coord;
}
vec2 transform_getPos(vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec2 pos = (texCoord * (2.0, 2.0)) - (1., 1.);
  return pos;
}
vec4 transform_getInput(sampler2D texSampler, vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec4 textureColor = texture2D(texSampler, texCoord);
  return textureColor;
}
`,fs:null};class Ag{static getDefaultProgramManager(t){return t.luma=t.luma||{},t.luma.defaultProgramManager=t.luma.defaultProgramManager||new Ag(t),t.luma.defaultProgramManager}constructor(t){this.gl=t,this._programCache={},this._getUniforms={},this._registeredModules={},this._hookFunctions=[],this._defaultModules=[],this._hashes={},this._hashCounter=0,this.stateHash=0,this._useCounts={}}addDefaultModule(t){this._defaultModules.find(e=>e.name===t.name)||this._defaultModules.push(t),this.stateHash++}removeDefaultModule(t){const e=typeof t=="string"?t:t.name;this._defaultModules=this._defaultModules.filter(n=>n.name!==e),this.stateHash++}addShaderHook(t,e){e&&(t=Object.assign(e,{hook:t})),this._hookFunctions.push(t),this.stateHash++}get(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{vs:e="",fs:n="",defines:i={},inject:s={},varyings:a=[],bufferMode:o=35981,transpileToGLSL100:A=!1}=t,f=this._getModuleList(t.modules),m=this._getHash(e),_=this._getHash(n),x=f.map(J=>this._getHash(J.name)).sort(),B=a.map(J=>this._getHash(J)),P=Object.keys(i).sort(),M=Object.keys(s).sort(),k=[],Q=[];for(const J of P)k.push(this._getHash(J)),k.push(this._getHash(i[J]));for(const J of M)Q.push(this._getHash(J)),Q.push(this._getHash(s[J]));const q="".concat(m,"/").concat(_,"D").concat(k.join("/"),"M").concat(x.join("/"),"I").concat(Q.join("/"),"V").concat(B.join("/"),"H").concat(this.stateHash,"B").concat(o).concat(A?"T":"");if(!this._programCache[q]){const J=DG(this.gl,{vs:e,fs:n,modules:f,inject:s,defines:i,hookFunctions:this._hookFunctions,transpileToGLSL100:A});this._programCache[q]=new S5(this.gl,{hash:q,vs:J.vs,fs:J.fs,varyings:a,bufferMode:o}),this._getUniforms[q]=J.getUniforms||(tt=>{}),this._useCounts[q]=0}return this._useCounts[q]++,this._programCache[q]}getUniforms(t){return this._getUniforms[t.hash]||null}release(t){const e=t.hash;this._useCounts[e]--,this._useCounts[e]===0&&(this._programCache[e].delete(),delete this._programCache[e],delete this._getUniforms[e],delete this._useCounts[e])}_getHash(t){return this._hashes[t]===void 0&&(this._hashes[t]=this._hashCounter++),this._hashes[t]}_getModuleList(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const e=new Array(this._defaultModules.length+t.length),n={};let i=0;for(let s=0,a=this._defaultModules.length;s<a;++s){const o=this._defaultModules[s],A=o.name;e[i++]=o,n[A]=!0}for(let s=0,a=t.length;s<a;++s){const o=t[s],A=o.name;n[A]||(e[i++]=o,n[A]=!0)}return e.length=i,e}}const Ij={POSITION:"positions",NORMAL:"normals",COLOR_0:"colors",TEXCOORD_0:"texCoords",TEXCOORD_1:"texCoords1",TEXCOORD_2:"texCoords2"};function Lj(r,t,e){const n={};let i=t.indices;for(const s in t.attributes){const a=t.attributes[s],o=Fj(s,e);if(s==="indices")i=a;else if(a.constant)n[o]=a.value;else{const A=a.value,f={...a};delete f.value,n[o]=[new ni(r,A),f],Pj(s,f)}}if(i){const s=i.value||i;ar(s instanceof Uint16Array||s instanceof Uint32Array,'attribute array for "indices" must be of integer type');const a={size:1,isIndexed:i.isIndexed===void 0?!0:i.isIndexed};n.indices=[new ni(r,{data:s,target:34963}),a]}return n}function Fj(r,t){const{attributeMap:e=Ij}=t||{};return e&&e[r]||r}function Pj(r,t){let e;switch(r){case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":e="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":e="vectors";break}switch(e){case"vectors":t.size=t.size||3;break;case"uvs":t.size=t.size||2;break}ar(Number.isFinite(t.size),"attribute ".concat(r," needs size"))}const Zd=2,Mj=1e4,Uj="Model needs drawMode and vertexCount",w3=()=>{},Rj={};class tf{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{id:n=Lu("model")}=e;ar(_0(t)),this.id=n,this.gl=t,this.id=e.id||Lu("Model"),this.lastLogTime=0,this.animated=!1,this.initialize(e)}initialize(t){this.props={},this.programManager=t.programManager||Ag.getDefaultProgramManager(this.gl),this._programManagerState=-1,this._managedProgram=!1;const{program:e=null,vs:n,fs:i,modules:s,defines:a,inject:o,varyings:A,bufferMode:f,transpileToGLSL100:m}=t;this.programProps={program:e,vs:n,fs:i,modules:s,defines:a,inject:o,varyings:A,bufferMode:f,transpileToGLSL100:m},this.program=null,this.vertexArray=null,this._programDirty=!0,this.userData={},this.needsRedraw=!0,this._attributes={},this.attributes={},this.uniforms={},this.pickable=!0,this._checkProgram(),this.setUniforms(Object.assign({},this.getModuleUniforms(t.moduleSettings))),this.drawMode=t.drawMode!==void 0?t.drawMode:4,this.vertexCount=t.vertexCount||0,this.geometryBuffers={},this.isInstanced=t.isInstanced||t.instanced||t.instanceCount>0,this._setModelProps(t),this.geometry={},ar(this.drawMode!==void 0&&Number.isFinite(this.vertexCount),Uj)}setProps(t){this._setModelProps(t)}delete(){for(const t in this._attributes)this._attributes[t]!==this.attributes[t]&&this._attributes[t].delete();this._managedProgram&&(this.programManager.release(this.program),this._managedProgram=!1),this.vertexArray.delete(),this._deleteGeometryBuffers()}getDrawMode(){return this.drawMode}getVertexCount(){return this.vertexCount}getInstanceCount(){return this.instanceCount}getAttributes(){return this.attributes}getProgram(){return this.program}setProgram(t){const{program:e,vs:n,fs:i,modules:s,defines:a,inject:o,varyings:A,bufferMode:f,transpileToGLSL100:m}=t;this.programProps={program:e,vs:n,fs:i,modules:s,defines:a,inject:o,varyings:A,bufferMode:f,transpileToGLSL100:m},this._programDirty=!0}getUniforms(){return this.uniforms}setDrawMode(t){return this.drawMode=t,this}setVertexCount(t){return ar(Number.isFinite(t)),this.vertexCount=t,this}setInstanceCount(t){return ar(Number.isFinite(t)),this.instanceCount=t,this}setGeometry(t){return this.drawMode=t.drawMode,this.vertexCount=t.getVertexCount(),this._deleteGeometryBuffers(),this.geometryBuffers=Lj(this.gl,t),this.vertexArray.setAttributes(this.geometryBuffers),this}setAttributes(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if($d(t))return this;const e={};for(const n in t){const i=t[n];e[n]=i.getValue?i.getValue():i}return this.vertexArray.setAttributes(e),this}setUniforms(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Object.assign(this.uniforms,t),this}getModuleUniforms(t){this._checkProgram();const e=this.programManager.getUniforms(this.program);return e?e(t):{}}updateModuleSettings(t){const e=this.getModuleUniforms(t||{});return this.setUniforms(e)}clear(t){return hb(this.program.gl,t),this}draw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._checkProgram();const{moduleSettings:e=null,framebuffer:n,uniforms:i={},attributes:s={},transformFeedback:a=this.transformFeedback,parameters:o={},vertexArray:A=this.vertexArray}=t;this.setAttributes(s),this.updateModuleSettings(e),this.setUniforms(i);let f;yr.priority>=Zd&&(f=this._logDrawCallStart(Zd));const m=this.vertexArray.getDrawParams(),{isIndexed:_=m.isIndexed,indexType:x=m.indexType,indexOffset:B=m.indexOffset,vertexArrayInstanced:P=m.isInstanced}=this.props;P&&!this.isInstanced&&yr.warn("Found instanced attributes on non-instanced model",this.id)();const{isInstanced:M,instanceCount:k}=this,{onBeforeRender:Q=w3,onAfterRender:q=w3}=this.props;Q(),this.program.setUniforms(this.uniforms);const J=this.program.draw(Object.assign(Rj,t,{logPriority:f,uniforms:null,framebuffer:n,parameters:o,drawMode:this.getDrawMode(),vertexCount:this.getVertexCount(),vertexArray:A,transformFeedback:a,isIndexed:_,indexType:x,isInstanced:M,instanceCount:k,offset:_?B:0}));return q(),yr.priority>=Zd&&this._logDrawCallEnd(f,A,n),J}transform(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{discard:e=!0,feedbackBuffers:n,unbindModels:i=[]}=t;let{parameters:s}=t;n&&this._setFeedbackBuffers(n),e&&(s=Object.assign({},s,{35977:e})),i.forEach(a=>a.vertexArray.unbindBuffers());try{this.draw(Object.assign({},t,{parameters:s}))}finally{i.forEach(a=>a.vertexArray.bindBuffers())}return this}render(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return yr.warn("Model.render() is deprecated. Use Model.setUniforms() and Model.draw()")(),this.setUniforms(t).draw()}_setModelProps(t){Object.assign(this.props,t),"uniforms"in t&&this.setUniforms(t.uniforms),"pickable"in t&&(this.pickable=t.pickable),"instanceCount"in t&&(this.instanceCount=t.instanceCount),"geometry"in t&&this.setGeometry(t.geometry),"attributes"in t&&this.setAttributes(t.attributes),"_feedbackBuffers"in t&&this._setFeedbackBuffers(t._feedbackBuffers)}_checkProgram(){if(!(this._programDirty||this.programManager.stateHash!==this._programManagerState))return;let{program:e}=this.programProps;if(e)this._managedProgram=!1;else{const{vs:n,fs:i,modules:s,inject:a,defines:o,varyings:A,bufferMode:f,transpileToGLSL100:m}=this.programProps;e=this.programManager.get({vs:n,fs:i,modules:s,inject:a,defines:o,varyings:A,bufferMode:f,transpileToGLSL100:m}),this.program&&this._managedProgram&&this.programManager.release(this.program),this._programManagerState=this.programManager.stateHash,this._managedProgram=!0}ar(e instanceof S5,"Model needs a program"),this._programDirty=!1,e!==this.program&&(this.program=e,this.vertexArray?this.vertexArray.setProps({program:this.program,attributes:this.vertexArray.attributes}):this.vertexArray=new Y9(this.gl,{program:this.program}),this.setUniforms(Object.assign({},this.getModuleUniforms())))}_deleteGeometryBuffers(){for(const t in this.geometryBuffers){const e=this.geometryBuffers[t][0]||this.geometryBuffers[t];e instanceof ni&&e.delete()}}_setAnimationProps(t){this.animated&&ar(t,"Model.draw(): animated uniforms but no animationProps")}_setFeedbackBuffers(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if($d(t))return this;const{gl:e}=this.program;return this.transformFeedback=this.transformFeedback||new T5(e,{program:this.program}),this.transformFeedback.setBuffers(t),this}_logDrawCallStart(t){const e=t>3?0:Mj;if(!(Date.now()-this.lastLogTime<e))return this.lastLogTime=Date.now(),yr.group(Zd,">>> DRAWING MODEL ".concat(this.id),{collapsed:yr.level<=2})(),t}_logDrawCallEnd(t,e,n,i){if(t===void 0)return;const s=eG({vertexArray:e,header:"".concat(this.id," attributes"),attributes:this._attributes}),{table:a,unusedTable:o,unusedCount:A}=I5({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,n)}),{table:f,count:m}=I5({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,n),undefinedOnly:!0});m>0&&yr.log("MISSING UNIFORMS",Object.keys(f))(),A>0&&yr.log("UNUSED UNIFORMS",Object.keys(o))();const _=nG(this.vertexArray.configuration);yr.table(t,s)(),yr.table(t,a)(),yr.table(t+1,_)(),i&&i.log({logLevel:Zd,message:"Rendered to ".concat(i.id)}),yr.groupEnd(Zd)()}}class Oj{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=t,this.currentIndex=0,this.feedbackMap={},this.varyings=null,this.bindings=[],this.resources={},this._initialize(e),Object.seal(this)}setupResources(t){for(const e of this.bindings)this._setupTransformFeedback(e,t)}updateModelProps(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyings:e}=this;return e.length>0&&(t=Object.assign({},t,{varyings:e})),t}getDrawOptions(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=this.bindings[this.currentIndex],{sourceBuffers:n,transformFeedback:i}=e;return{attributes:Object.assign({},n,t.attributes),transformFeedback:i}}swap(){return this.feedbackMap?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(t)}getBuffer(t){const{feedbackBuffers:e}=this.bindings[this.currentIndex],n=t?e[t]:null;return n?n instanceof ni?n:n.buffer:null}getData(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyingName:e}=t,n=this.getBuffer(e);return n?n.getData():null}delete(){for(const t in this.resources)this.resources[t].delete()}_initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(t),this.varyings=t.varyings||Object.keys(this.bindings[this.currentIndex].feedbackBuffers),this.varyings.length>0&&ar(gn(this.gl))}_getFeedbackBuffers(t){const{sourceBuffers:e={}}=t,n={};if(this.bindings[this.currentIndex]&&Object.assign(n,this.bindings[this.currentIndex].feedbackBuffers),this.feedbackMap)for(const i in this.feedbackMap){const s=this.feedbackMap[i];i in e&&(n[s]=i)}Object.assign(n,t.feedbackBuffers);for(const i in n){const s=n[i];if(typeof s=="string"){const a=e[s],{byteLength:o,usage:A,accessor:f}=a;n[i]=this._createNewBuffer(i,{byteLength:o,usage:A,accessor:f})}}return n}_setupBuffers(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:e=null}=t;Object.assign(this.feedbackMap,t.feedbackMap);const n=this._getFeedbackBuffers(t);this._updateBindings({sourceBuffers:e,feedbackBuffers:n})}_setupTransformFeedback(t,e){let{model:n}=e;const{program:i}=n;t.transformFeedback=new T5(this.gl,{program:i,buffers:t.feedbackBuffers})}_updateBindings(t){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],t),this.feedbackMap){const{sourceBuffers:e,feedbackBuffers:n}=this._swapBuffers(this.bindings[this.currentIndex]),i=this._getNextIndex();this.bindings[i]=this._updateBinding(this.bindings[i],{sourceBuffers:e,feedbackBuffers:n})}}_updateBinding(t,e){return t?(Object.assign(t.sourceBuffers,e.sourceBuffers),Object.assign(t.feedbackBuffers,e.feedbackBuffers),t.transformFeedback&&t.transformFeedback.setBuffers(t.feedbackBuffers),t):{sourceBuffers:Object.assign({},e.sourceBuffers),feedbackBuffers:Object.assign({},e.feedbackBuffers)}}_swapBuffers(t){if(!this.feedbackMap)return null;const e=Object.assign({},t.sourceBuffers),n=Object.assign({},t.feedbackBuffers);for(const i in this.feedbackMap){const s=this.feedbackMap[i];e[i]=t.feedbackBuffers[s],n[s]=t.sourceBuffers[i],ar(n[s]instanceof ni)}return{sourceBuffers:e,feedbackBuffers:n}}_createNewBuffer(t,e){const n=new ni(this.gl,e);return this.resources[t]&&this.resources[t].delete(),this.resources[t]=n,n}_getNextIndex(){return(this.currentIndex+1)%2}}const Dj="transform_uSampler_",H0="transform_uSize_",x3="transform_position";function Nj(r){let{vs:t,sourceTextureMap:e,targetTextureVarying:n,targetTexture:i}=r,a=Object.keys(e).length,o=null;const A={};let f=t,m={};if(a>0||n){const _=f.split(`
`),x=_.slice();if(_.forEach((B,P,M)=>{if(a>0){const k=Gj(B,e);if(k){const{updatedLine:Q,inject:q}=k;x[P]=Q,m=Bb([m,q]),Object.assign(A,k.samplerTextureMap),a--}}n&&!o&&(o=zj(B,n))}),n){ar(i);const B="".concat(H0).concat(n),P="uniform vec2 ".concat(B,`;
`),M="     vec2 ".concat(x3," = transform_getPos(").concat(B,`);
     gl_Position = vec4(`).concat(x3,`, 0, 1.);
`);m=Bb([m,{"vs:#decl":P,"vs:#main-start":M}])}f=x.join(`
`)}return{vs:f,targetTextureType:o,inject:m,samplerTextureMap:A}}function kj(r){let{sourceTextureMap:t,targetTextureVarying:e,targetTexture:n}=r;const i={};let s,a;e&&({width:s,height:a}=n,i["".concat(H0).concat(e)]=[s,a]);for(const o in t)({width:s,height:a}=t[o]),i["".concat(H0).concat(o)]=[s,a];return i}function Qj(r){return q5(r,["attribute","in"])}function Hj(r){const t="".concat(Dj).concat(r),e="".concat(H0).concat(r),n="  uniform sampler2D ".concat(t,`;
  uniform vec2 `).concat(e,";");return{samplerName:t,sizeName:e,uniformDeclerations:n}}function zj(r,t){const e=q5(r,["varying","out"]);return e&&e.name===t?e.type:null}function Gj(r,t){const e={},n=Qj(r);if(!n)return null;const{type:i,name:s}=n;if(s&&t[s]){const a="// ".concat(r," => Replaced by Transform with a sampler"),{samplerName:o,sizeName:A,uniformDeclerations:f}=Hj(s),m=qG(i),_="  ".concat(i," ").concat(s," = transform_getInput(").concat(o,", ").concat(A,").").concat(m,`;
`);return e[o]=s,{updatedLine:a,inject:{"vs:#decl":f,"vs:#main-start":_},samplerTextureMap:e}}return null}const Vj={10241:9728,10240:9728,10242:33071,10243:33071},jj="transform_output";class qj{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=t,this.id=this.currentIndex=0,this._swapTexture=null,this.targetTextureVarying=null,this.targetTextureType=null,this.samplerTextureMap=null,this.bindings=[],this.resources={},this._initialize(e),Object.seal(this)}updateModelProps(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=this._processVertexShader(t);return Object.assign({},t,e)}getDrawOptions(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:e,sourceTextures:n,framebuffer:i,targetTexture:s}=this.bindings[this.currentIndex],a=Object.assign({},e,t.attributes),o=Object.assign({},t.uniforms),A=Object.assign({},t.parameters);let f=t.discard;if(this.hasSourceTextures||this.hasTargetTexture){a.transform_elementID=this.elementIDBuffer;for(const _ in this.samplerTextureMap){const x=this.samplerTextureMap[_];o[_]=n[x]}this._setSourceTextureParameters();const m=kj({sourceTextureMap:n,targetTextureVarying:this.targetTextureVarying,targetTexture:s});Object.assign(o,m)}return this.hasTargetTexture&&(f=!1,A.viewport=[0,0,i.width,i.height]),{attributes:a,framebuffer:i,uniforms:o,discard:f,parameters:A}}swap(){return this._swapTexture?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupTextures(t)}getTargetTexture(){const{targetTexture:t}=this.bindings[this.currentIndex];return t}getData(){let{packed:t=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{framebuffer:e}=this.bindings[this.currentIndex],n=b0(e);if(!t)return n;const i=n.constructor,s=KG(this.targetTextureType),a=new i(n.length*s/4);let o=0;for(let A=0;A<n.length;A+=4)for(let f=0;f<s;f++)a[o++]=n[A+f];return a}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}delete(){this.ownTexture&&this.ownTexture.delete(),this.elementIDBuffer&&this.elementIDBuffer.delete()}_initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{_targetTextureVarying:e,_swapTexture:n}=t;this._swapTexture=n,this.targetTextureVarying=e,this.hasTargetTexture=e,this._setupTextures(t)}_createTargetTexture(t){const{sourceTextures:e,textureOrReference:n}=t;if(n instanceof Fa)return n;const i=e[n];return i?(this._targetRefTexName=n,this._createNewTexture(i)):null}_setupTextures(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:e,_sourceTextures:n={},_targetTexture:i}=t,s=this._createTargetTexture({sourceTextures:n,textureOrReference:i});this.hasSourceTextures=this.hasSourceTextures||n&&Object.keys(n).length>0,this._updateBindings({sourceBuffers:e,sourceTextures:n,targetTexture:s}),"elementCount"in t&&this._updateElementIDBuffer(t.elementCount)}_updateElementIDBuffer(t){if(typeof t!="number"||this.elementCount>=t)return;const e=new Float32Array(t);e.forEach((n,i,s)=>{s[i]=i}),this.elementIDBuffer?this.elementIDBuffer.setData({data:e}):this.elementIDBuffer=new ni(this.gl,{data:e,accessor:{size:1}}),this.elementCount=t}_updateBindings(t){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],t),this._swapTexture){const{sourceTextures:e,targetTexture:n}=this._swapTextures(this.bindings[this.currentIndex]),i=this._getNextIndex();this.bindings[i]=this._updateBinding(this.bindings[i],{sourceTextures:e,targetTexture:n})}}_updateBinding(t,e){const{sourceBuffers:n,sourceTextures:i,targetTexture:s}=e;if(t||(t={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(t.sourceTextures,i),Object.assign(t.sourceBuffers,n),s){t.targetTexture=s;const{width:a,height:o}=s,{framebuffer:A}=t;A?(A.update({attachments:{36064:s},resizeAttachments:!1}),A.resize({width:a,height:o})):t.framebuffer=new xs(this.gl,{id:"transform-framebuffer",width:a,height:o,attachments:{36064:s}})}return t}_setSourceTextureParameters(){const t=this.currentIndex,{sourceTextures:e}=this.bindings[t];for(const n in e)e[n].setParameters(Vj)}_swapTextures(t){if(!this._swapTexture)return null;const e=Object.assign({},t.sourceTextures);e[this._swapTexture]=t.targetTexture;const n=t.sourceTextures[this._swapTexture];return{sourceTextures:e,targetTexture:n}}_createNewTexture(t){const e=H7(t,{parameters:{10241:9728,10240:9728,10242:33071,10243:33071},pixelStore:{37440:!1}});return this.ownTexture&&this.ownTexture.delete(),this.ownTexture=e,e}_getNextIndex(){return(this.currentIndex+1)%2}_processVertexShader(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceTextures:e,targetTexture:n}=this.bindings[this.currentIndex],{vs:i,uniforms:s,targetTextureType:a,inject:o,samplerTextureMap:A}=Nj({vs:t.vs,sourceTextureMap:e,targetTextureVarying:this.targetTextureVarying,targetTexture:n}),f=Bb([t.inject||{},o]);this.targetTextureType=a,this.samplerTextureMap=A;const m=t._fs||K5({version:v5(i),input:this.targetTextureVarying,inputType:a,output:jj}),_=this.hasSourceTextures||this.targetTextureVarying?[Tj].concat(t.modules||[]):t.modules;return{vs:i,fs:m,modules:_,uniforms:s,inject:f}}}class Vb{static isSupported(t){return gn(t)}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=t,this.model=null,this.elementCount=0,this.bufferTransform=null,this.textureTransform=null,this.elementIDBuffer=null,this._initialize(e),Object.seal(this)}delete(){const{model:t,bufferTransform:e,textureTransform:n}=this;t&&t.delete(),e&&e.delete(),n&&n.delete()}run(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{clearRenderTarget:e=!0}=t,n=this._updateDrawOptions(t);e&&n.framebuffer&&n.framebuffer.clear({color:!0}),this.model.transform(n)}swap(){let t=!1;const e=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const n of e)t=t||n.swap();ar(t,"Nothing to swap")}getBuffer(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return this.bufferTransform&&this.bufferTransform.getBuffer(t)}getData(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const n of e){const i=n.getData(t);if(i)return i}return null}getFramebuffer(){return this.textureTransform&&this.textureTransform.getFramebuffer()}update(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};"elementCount"in t&&this.model.setVertexCount(t.elementCount);const e=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const n of e)n.update(t)}_initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{gl:e}=this;this._buildResourceTransforms(e,t),t=this._updateModelProps(t),this.model=new tf(e,Object.assign({},t,{fs:t.fs||K5({version:v5(t.vs)}),id:t.id||"transform-model",drawMode:t.drawMode||0,vertexCount:t.elementCount})),this.bufferTransform&&this.bufferTransform.setupResources({model:this.model})}_updateModelProps(t){let e=Object.assign({},t);const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of n)e=i.updateModelProps(e);return e}_buildResourceTransforms(t,e){Kj(e)&&(this.bufferTransform=new Oj(t,e)),$j(e)&&(this.textureTransform=new qj(t,e)),ar(this.bufferTransform||this.textureTransform,"must provide source/feedback buffers or source/target textures")}_updateDrawOptions(t){let e=Object.assign({},t);const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of n)e=Object.assign(e,i.getDrawOptions(e));return e}}function Kj(r){return!!(!$d(r.feedbackBuffers)||!$d(r.feedbackMap)||r.varyings&&r.varyings.length>0)}function $j(r){return!!(!$d(r._sourceTextures)||r._targetTexture||r._targetTextureVarying)}const B3={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class hg{static get DRAW_MODE(){return B3}constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:e=Lu("geometry"),drawMode:n=B3.TRIANGLES,attributes:i={},indices:s=null,vertexCount:a=null}=t;this.id=e,this.drawMode=n|0,this.attributes={},this.userData={},this._setAttributes(i,s),this.vertexCount=a||this._calculateVertexCount(this.attributes,this.indices)}get mode(){return this.drawMode}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(t){return"Geometry ".concat(this.id," attribute ").concat(t)}_setAttributes(t,e){e&&(this.indices=ArrayBuffer.isView(e)?{value:e,size:1}:e);for(const n in t){let i=t[n];i=ArrayBuffer.isView(i)?{value:i}:i,ar(ArrayBuffer.isView(i.value),"".concat(this._print(n),": must be typed array or object with value as typed array")),(n==="POSITION"||n==="positions")&&!i.size&&(i.size=3),n==="indices"?(ar(!this.indices),this.indices=i):this.attributes[n]=i}return this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this}_calculateVertexCount(t,e){if(e)return e.value.length;let n=1/0;for(const i in t){const s=t[i],{value:a,size:o,constant:A}=s;!A&&a&&o>=1&&(n=Math.min(n,a.length/o))}return ar(Number.isFinite(n)),n}}let Wj=1,Xj=1;class C3{constructor(){this.time=0,this.channels=new Map,this.animations=new Map,this.playing=!1,this.lastEngineTime=-1}addChannel(t){const{delay:e=0,duration:n=Number.POSITIVE_INFINITY,rate:i=1,repeat:s=1}=t,a=Wj++,o={time:0,delay:e,duration:n,rate:i,repeat:s};return this._setChannelTime(o,this.time),this.channels.set(a,o),a}removeChannel(t){this.channels.delete(t);for(const[e,n]of this.animations)n.channel===t&&this.detachAnimation(e)}isFinished(t){const e=this.channels.get(t);return e===void 0?!1:this.time>=e.delay+e.duration*e.repeat}getTime(t){if(t===void 0)return this.time;const e=this.channels.get(t);return e===void 0?-1:e.time}setTime(t){this.time=Math.max(0,t);const e=this.channels.values();for(const i of e)this._setChannelTime(i,this.time);const n=this.animations.values();for(const i of n){const{animation:s,channel:a}=i;s.setTime(this.getTime(a))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(t,e){const n=Xj++;return this.animations.set(n,{animation:t,channel:e}),t.setTime(this.getTime(e)),n}detachAnimation(t){this.animations.delete(t)}update(t){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=t),this.setTime(this.time+(t-this.lastEngineTime)),this.lastEngineTime=t)}_setChannelTime(t,e){const n=e-t.delay,i=t.duration*t.repeat;n>=i?t.time=t.duration*t.rate:(t.time=Math.max(0,n)%t.duration,t.time*=t.rate)}}const Jj=[255,255,255],Yj=1;let Zj=0;class E3{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};$(this,"id",void 0),$(this,"color",void 0),$(this,"intensity",void 0),$(this,"type","ambient");const{color:e=Jj}=t,{intensity:n=Yj}=t;this.id=t.id||"ambient-".concat(Zj++),this.color=e,this.intensity=n}}const tq=[255,255,255],eq=1,rq=[0,0,-1];let nq=0;class S3{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};$(this,"id",void 0),$(this,"color",void 0),$(this,"intensity",void 0),$(this,"type","directional"),$(this,"direction",void 0),$(this,"shadow",void 0);const{color:e=tq}=t,{intensity:n=eq}=t,{direction:i=rq}=t,{_shadow:s=!1}=t;this.id=t.id||"directional-".concat(nq++),this.color=e,this.intensity=n,this.type="directional",this.direction=new le(i).normalize().toArray(),this.shadow=s}getProjectedLight(t){return this}}class iq{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{id:"pass"};$(this,"id",void 0),$(this,"gl",void 0),$(this,"props",void 0);const{id:n}=e;this.id=n,this.gl=t,this.props={...e}}setProps(t){Object.assign(this.props,t)}render(t){}cleanup(){}}class jb extends iq{constructor(){super(...arguments),$(this,"_lastRenderIndex",-1)}render(t){const e=this.gl;return Iu(e,{framebuffer:t.target}),this._drawLayers(t)}_drawLayers(t){const{target:e,moduleParameters:n,viewports:i,views:s,onViewportActive:a,clearStack:o=!0,clearCanvas:A=!0}=t;t.pass=t.pass||"unknown";const f=this.gl;A&&oq(f,e),o&&(this._lastRenderIndex=-1);const m=[];for(const _ of i){const x=s&&s[_.id];a==null||a(_);const B=this._getDrawLayerParams(_,t),P=_.subViewports||[_];for(const M of P){const k=this._drawLayersInViewport(f,{target:e,moduleParameters:n,viewport:M,view:x,pass:t.pass,layers:t.layers},B);m.push(k)}}return m}_getDrawLayerParams(t,e){let{layers:n,pass:i,isPicking:s=!1,layerFilter:a,cullRect:o,effects:A,moduleParameters:f}=e,m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const _=[],x=T3(this._lastRenderIndex+1),B={layer:n[0],viewport:t,isPicking:s,renderPass:i,cullRect:o},P={};for(let M=0;M<n.length;M++){const k=n[M],Q=this._shouldDrawLayer(k,B,a,P),q={shouldDrawLayer:Q};Q&&!m&&(q.layerRenderIndex=x(k,Q),q.moduleParameters=this._getModuleParameters(k,A,i,f),q.layerParameters=this.getLayerParameters(k,M,t)),_[M]=q}return _}_drawLayersInViewport(t,e,n){let{layers:i,moduleParameters:s,pass:a,target:o,viewport:A,view:f}=e;const m=sq(t,{moduleParameters:s,target:o,viewport:A});if(f&&f.props.clear){const x=f.props.clear===!0?{color:!0,depth:!0}:f.props.clear;Qc(t,{scissorTest:!0,scissor:m},()=>hb(t,x))}const _={totalCount:i.length,visibleCount:0,compositeCount:0,pickableCount:0};Iu(t,{viewport:m});for(let x=0;x<i.length;x++){const B=i[x],{shouldDrawLayer:P,layerRenderIndex:M,moduleParameters:k,layerParameters:Q}=n[x];if(P&&B.props.pickable&&_.pickableCount++,B.isComposite)_.compositeCount++;else if(P){_.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,M),k.viewport=A;try{B._drawLayer({moduleParameters:k,uniforms:{layerIndex:M},parameters:Q})}catch(q){B.raiseError(q,"drawing ".concat(B," to ").concat(a))}}}return _}shouldDrawLayer(t){return!0}getModuleParameters(t,e){return null}getLayerParameters(t,e,n){return t.props.parameters}_shouldDrawLayer(t,e,n,i){if(!(t.props.visible&&this.shouldDrawLayer(t)))return!1;e.layer=t;let a=t.parent;for(;a;){if(!a.props.visible||!a.filterSubLayer(e))return!1;e.layer=a,a=a.parent}if(n){const o=e.layer.id;if(o in i||(i[o]=n(e)),!i[o])return!1}return t.activateViewport(e.viewport),!0}_getModuleParameters(t,e,n,i){var s;const a=Object.assign(Object.create(((s=t.internalState)===null||s===void 0?void 0:s.propsInTransition)||t.props),{autoWrapLongitude:t.wrapLongitude,viewport:t.context.viewport,mousePosition:t.context.mousePosition,pickingActive:0,devicePixelRatio:Kd(this.gl)});if(e)for(const A of e){var o;Object.assign(a,(o=A.getModuleParameters)===null||o===void 0?void 0:o.call(A,t))}return Object.assign(a,this.getModuleParameters(t,e),i)}}function T3(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const e={},n=(i,s)=>{const a=i.props._offset,o=i.id,A=i.parent&&i.parent.id;let f;if(A&&!(A in t)&&n(i.parent,!1),A in e){const m=e[A]=e[A]||T3(t[A],t);f=m(i,s),e[o]=m}else Number.isFinite(a)?(f=a+(t[A]||0),e[o]=null):f=r;return s&&f>=r&&(r=f+1),t[o]=f,f};return n}function sq(r,t){let{moduleParameters:e,target:n,viewport:i}=t;const s=n&&n.id!=="default-framebuffer",a=e&&e.devicePixelRatio||Kd(r),o=s?n.height:r.drawingBufferHeight,A=i;return[A.x*a,o-(A.y+A.height)*a,A.width*a,A.height*a]}function oq(r,t){const e=t?t.width:r.drawingBufferWidth,n=t?t.height:r.drawingBufferHeight;Iu(r,{viewport:[0,0,e,n]}),r.clear(16640)}class aq extends jb{constructor(t,e){super(t,e),$(this,"shadowMap",void 0),$(this,"depthBuffer",void 0),$(this,"fbo",void 0),this.shadowMap=new Fa(t,{width:1,height:1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.depthBuffer=new Jd(t,{format:33189,width:1,height:1}),this.fbo=new xs(t,{id:"shadowmap",width:1,height:1,attachments:{36064:this.shadowMap,36096:this.depthBuffer}})}render(t){const e=this.fbo;Qc(this.gl,{depthRange:[0,1],depthTest:!0,blend:!1,clearColor:[1,1,1,1]},()=>{const n=t.viewports[0],i=Kd(this.gl),s=n.width*i,a=n.height*i;(s!==e.width||a!==e.height)&&e.resize({width:s,height:a}),super.render({...t,target:e,pass:"shadow"})})}shouldDrawLayer(t){return t.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.delete(),this.fbo=null),this.shadowMap&&(this.shadowMap.delete(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.delete(),this.depthBuffer=null)}}const I3="#define SMOOTH_EDGE_RADIUS 0.5",cq=`
`.concat(I3,`

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`),lq=`
`.concat(I3,`

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`),uq={name:"geometry",vs:cq,fs:lq},Aq=Object.keys(Tn).map(r=>"const int COORDINATE_SYSTEM_".concat(r," = ").concat(Tn[r],";")).join(""),hq=Object.keys(Ql).map(r=>"const int PROJECTION_MODE_".concat(r," = ").concat(Ql[r],";")).join(""),dq=Object.keys(Zv).map(r=>"const int UNIT_".concat(r.toUpperCase()," = ").concat(Zv[r],";")).join(""),fq="".concat(Aq,`
`).concat(hq,`
`).concat(dq,`

uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;

const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
  float y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

float project_size() {
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
    project_uPseudoMeters == false) {
    
    if (geometry.position.w == 0.0) {
      return project_size_at_latitude(geometry.worldPosition.y);
    }
  
    float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    float y2 = y * y;
    float y4 = y2 * y2;
    float y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

float project_size_at_latitude(float meters, float lat) {
  return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
  return meters * project_uCommonUnitsPerMeter.z * project_size();
}

vec2 project_size(vec2 meters) {
  return meters * project_uCommonUnitsPerMeter.xy * project_size();
}

vec3 project_size(vec3 meters) {
  return meters * project_uCommonUnitsPerMeter * project_size();
}

vec4 project_size(vec4 meters) {
  return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
  vec3 uz = normalize(up);
  vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
  vec3 uy = cross(uz, ux);
  return mat3(ux, uy, uz);
}

bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    transform = project_get_orientation_matrix(commonPosition);
    return true;
  }
  return false;
}
vec3 project_normal(vec3 vector) {
  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
  vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
  mat3 rotation;
  if (project_needs_rotation(geometry.position.xyz, rotation)) {
    n = rotation * n;
  }
  return n;
}

vec4 project_offset_(vec4 offset) {
  float dy = offset.y;
  vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
  return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
  float x = lnglat.x;
  if (project_uWrapLongitude) {
    x = mod(x + 180., 360.0) - 180.;
  }
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

vec3 project_globe_(vec3 lnglatz) {
  float lambda = radians(lnglatz.x);
  float phi = radians(lnglatz.y);
  float cosPhi = cos(phi);
  float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;

  return vec3(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
  vec4 position_world = project_uModelMatrix * position;
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_mercator_(position_world.xy),
        project_size_at_latitude(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world.xyz += project_uCoordinateOrigin;
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
        return vec4(
          project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
          project_size(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
    (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
    (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
     project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world.xyz -= project_uCoordinateOrigin;
  }
  return project_offset_(position_world) + project_offset_(project_uModelMatrix * vec4(position64Low, 0.0));
}

vec4 project_position(vec4 position) {
  return project_position(position, ZERO_64_LOW);
}

vec3 project_position(vec3 position, vec3 position64Low) {
  vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
  return projected_position.xyz;
}

vec3 project_position(vec3 position) {
  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

vec2 project_position(vec2 position) {
  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
  return offset * project_uFocalDistance;
}

float project_size_to_pixel(float meters) {
  return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
  if (unit == UNIT_METERS) return project_size_to_pixel(size);
  if (unit == UNIT_COMMON) return size * project_uScale;
  return size;
}
float project_pixel_size(float pixels) {
  return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
  return pixels / project_uScale;
}
`);function pq(r,t){if(r===t)return!0;if(Array.isArray(r)){const e=r.length;if(!t||t.length!==e)return!1;for(let n=0;n<e;n++)if(r[n]!==t[n])return!1;return!0}return!1}function dg(r){let t={},e;return n=>{for(const i in n)if(!pq(n[i],t[i])){e=r(n),t=n;break}return e}}const L3=[0,0,0,0],gq=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],F3=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],mq=[0,0,0],P3=[0,0,0],yq=dg(bq);function M3(r,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:P3;e.length<3&&(e=[e[0],e[1],0]);let n=e,i,s=!0;switch(t===Tn.LNGLAT_OFFSETS||t===Tn.METER_OFFSETS?i=e:i=r.isGeospatial?[Math.fround(r.longitude),Math.fround(r.latitude),0]:null,r.projectionMode){case Ql.WEB_MERCATOR:(t===Tn.LNGLAT||t===Tn.CARTESIAN)&&(i=[0,0,0],s=!1);break;case Ql.WEB_MERCATOR_AUTO_OFFSET:t===Tn.LNGLAT?n=i:t===Tn.CARTESIAN&&(n=[Math.fround(r.center[0]),Math.fround(r.center[1]),0],i=r.unprojectPosition(n),n[0]-=e[0],n[1]-=e[1],n[2]-=e[2]);break;case Ql.IDENTITY:n=r.position.map(Math.fround),n[2]=n[2]||0;break;case Ql.GLOBE:s=!1,i=null;break;default:s=!1}return{geospatialOrigin:i,shaderCoordinateOrigin:n,offsetMode:s}}function _q(r,t,e){const{viewMatrixUncentered:n,projectionMatrix:i}=r;let{viewMatrix:s,viewProjectionMatrix:a}=r,o=L3,A=L3,f=r.cameraPosition;const{geospatialOrigin:m,shaderCoordinateOrigin:_,offsetMode:x}=M3(r,t,e);return x&&(A=r.projectPosition(m||_),f=[f[0]-A[0],f[1]-A[1],f[2]-A[2]],A[3]=1,o=cg([],A,a),s=n||s,a=kh([],i,s),a=kh([],a,gq)),{viewMatrix:s,viewProjectionMatrix:a,projectionCenter:o,originCommon:A,cameraPosCommon:f,shaderCoordinateOrigin:_,geospatialOrigin:m}}function vq(r){let{viewport:t,devicePixelRatio:e=1,modelMatrix:n=null,coordinateSystem:i=Tn.DEFAULT,coordinateOrigin:s=P3,autoWrapLongitude:a=!1}=r;i===Tn.DEFAULT&&(i=t.isGeospatial?Tn.LNGLAT:Tn.CARTESIAN);const o=yq({viewport:t,devicePixelRatio:e,coordinateSystem:i,coordinateOrigin:s});return o.project_uWrapLongitude=a,o.project_uModelMatrix=n||F3,o}function bq(r){let{viewport:t,devicePixelRatio:e,coordinateSystem:n,coordinateOrigin:i}=r;const{projectionCenter:s,viewProjectionMatrix:a,originCommon:o,cameraPosCommon:A,shaderCoordinateOrigin:f,geospatialOrigin:m}=_q(t,n,i),_=t.getDistanceScales(),x=[t.width*e,t.height*e],B=cg([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,P={project_uCoordinateSystem:n,project_uProjectionMode:t.projectionMode,project_uCoordinateOrigin:f,project_uCommonOrigin:o.slice(0,3),project_uCenter:s,project_uPseudoMeters:!!t._pseudoMeters,project_uViewportSize:x,project_uDevicePixelRatio:e,project_uFocalDistance:B,project_uCommonUnitsPerMeter:_.unitsPerMeter,project_uCommonUnitsPerWorldUnit:_.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:mq,project_uScale:t.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:a,project_uModelMatrix:F3,project_uCameraPosition:A};if(m){const M=t.getDistanceScales(m);switch(n){case Tn.METER_OFFSETS:P.project_uCommonUnitsPerWorldUnit=M.unitsPerMeter,P.project_uCommonUnitsPerWorldUnit2=M.unitsPerMeter2;break;case Tn.LNGLAT:case Tn.LNGLAT_OFFSETS:t._pseudoMeters||(P.project_uCommonUnitsPerMeter=M.unitsPerMeter),P.project_uCommonUnitsPerWorldUnit=M.unitsPerDegree,P.project_uCommonUnitsPerWorldUnit2=M.unitsPerDegree2;break;case Tn.CARTESIAN:P.project_uCommonUnitsPerWorldUnit=[1,1,M.unitsPerMeter[2]],P.project_uCommonUnitsPerWorldUnit2=[0,0,M.unitsPerMeter2[2]];break}}return P}const wq={};function xq(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:wq;return"viewport"in r?vq(r):{}}const qb={name:"project",dependencies:[WG,uq],vs:fq,getUniforms:xq};function Bq(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function ef(r,t){const e=cg([],t,r);return A3(e,e,1/e[3]),e}function U3(r,t){const e=r%t;return e<0?t+e:e}function Kb(r,t,e){return r<t?t:r>e?e:r}function Cq(r){return Math.log(r)*Math.LOG2E}const $b=Math.log2||Cq;function Ru(r,t){if(!r)throw new Error(t||"@math.gl/web-mercator: assertion failed.")}const Vc=Math.PI,R3=Vc/4,ic=Vc/180,Wb=180/Vc,rf=512,z0=4003e4,G0=85.051129,Eq=1.5;function Sq(r){return $b(r)}function fg(r){const[t,e]=r;Ru(Number.isFinite(t)),Ru(Number.isFinite(e)&&e>=-90&&e<=90,"invalid latitude");const n=t*ic,i=e*ic,s=rf*(n+Vc)/(2*Vc),a=rf*(Vc+Math.log(Math.tan(R3+i*.5)))/(2*Vc);return[s,a]}function nf(r){const[t,e]=r,n=t/rf*(2*Vc)-Vc,i=2*(Math.atan(Math.exp(e/rf*(2*Vc)-Vc))-R3);return[n*Wb,i*Wb]}function Tq(r){const{latitude:t}=r;Ru(Number.isFinite(t));const e=Math.cos(t*ic);return Sq(z0*e)-9}function V0(r){const t=Math.cos(r*ic);return rf/z0/t}function Xb(r){const{latitude:t,longitude:e,highPrecision:n=!1}=r;Ru(Number.isFinite(t)&&Number.isFinite(e));const i=rf,s=Math.cos(t*ic),a=i/360,o=a/s,A=i/z0/s,f={unitsPerMeter:[A,A,A],metersPerUnit:[1/A,1/A,1/A],unitsPerDegree:[a,o,A],degreesPerUnit:[1/a,1/o,1/A]};if(n){const m=ic*Math.tan(t*ic)/s,_=a*m/2,x=i/z0*m,B=x/o*A;f.unitsPerDegree2=[0,_,x],f.unitsPerMeter2=[B,0,B]}return f}function O3(r,t){const[e,n,i]=r,[s,a,o]=t,{unitsPerMeter:A,unitsPerMeter2:f}=Xb({longitude:e,latitude:n,highPrecision:!0}),m=fg(r);m[0]+=s*(A[0]+f[0]*a),m[1]+=a*(A[1]+f[1]*a);const _=nf(m),x=(i||0)+(o||0);return Number.isFinite(i)||Number.isFinite(o)?[_[0],_[1],x]:_}function Iq(r){const{height:t,pitch:e,bearing:n,altitude:i,scale:s,center:a}=r,o=Bq();D0(o,o,[0,0,-i]),l3(o,o,-e*ic),u3(o,o,n*ic);const A=s/t;return Db(o,o,[A,A,A]),a&&D0(o,o,dV([],a)),o}function Lq(r){const{width:t,height:e,altitude:n,pitch:i=0,offset:s,center:a,scale:o,nearZMultiplier:A=1,farZMultiplier:f=1}=r;let{fovy:m=j0(Eq)}=r;n!==void 0&&(m=j0(n));const _=m*ic,x=i*ic,B=D3(m);let P=B;a&&(P+=a[2]*o/Math.cos(x)/e);const M=_*(.5+(s?s[1]:0)/e),k=Math.sin(M)*P/Math.sin(Kb(Math.PI/2-x-M,.01,Math.PI-.01)),Q=Math.sin(x)*k+P,q=P*10,J=Math.min(Q*f,q);return{fov:_,aspect:t/e,focalDistance:B,near:A,far:J}}function j0(r){return 2*Math.atan(.5/r)*Wb}function D3(r){return .5/Math.tan(.5*r*ic)}function N3(r,t){const[e,n,i=0]=r;return Ru(Number.isFinite(e)&&Number.isFinite(n)&&Number.isFinite(i)),ef(t,[e,n,i,1])}function Jb(r,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const[n,i,s]=r;if(Ru(Number.isFinite(n)&&Number.isFinite(i),"invalid pixel coordinate"),Number.isFinite(s))return ef(t,[n,i,s,1]);const a=ef(t,[n,i,0,1]),o=ef(t,[n,i,1,1]),A=a[2],f=o[2],m=A===f?0:((e||0)-A)/(f-A);return W5([],a,o,m)}function Fq(r){const{width:t,height:e,bounds:n,minExtent:i=0,maxZoom:s=24,offset:a=[0,0]}=r,[[o,A],[f,m]]=n,_=Pq(r.padding),x=fg([o,Kb(m,-G0,G0)]),B=fg([f,Kb(A,-G0,G0)]),P=[Math.max(Math.abs(B[0]-x[0]),i),Math.max(Math.abs(B[1]-x[1]),i)],M=[t-_.left-_.right-Math.abs(a[0])*2,e-_.top-_.bottom-Math.abs(a[1])*2];Ru(M[0]>0&&M[1]>0);const k=M[0]/P[0],Q=M[1]/P[1],q=(_.right-_.left)/2/k,J=(_.top-_.bottom)/2/Q,tt=[(B[0]+x[0])/2+q,(B[1]+x[1])/2+J],ft=nf(tt),pt=Math.min(s,$b(Math.abs(Math.min(k,Q))));return Ru(Number.isFinite(pt)),{longitude:ft[0],latitude:ft[1],zoom:pt}}function Pq(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return typeof r=="number"?{top:r,bottom:r,left:r,right:r}:(Ru(Number.isFinite(r.top)&&Number.isFinite(r.bottom)&&Number.isFinite(r.left)&&Number.isFinite(r.right)),r)}const k3=Math.PI/180;function Mq(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const{width:e,height:n,unproject:i}=r,s={targetZ:t},a=i([0,n],s),o=i([e,n],s);let A,f;const m=r.fovy?.5*r.fovy*k3:Math.atan(.5/r.altitude),_=(90-r.pitch)*k3;return m>_-.01?(A=Q3(r,0,t),f=Q3(r,e,t)):(A=i([0,0],s),f=i([e,0],s)),[a,o,f,A]}function Q3(r,t,e){const{pixelUnprojectionMatrix:n}=r,i=ef(n,[t,0,1,1]),s=ef(n,[t,r.height,1,1]),o=(e*r.distanceScales.unitsPerMeter[2]-i[2])/(s[2]-i[2]),A=W5([],i,s,o),f=nf(A);return f.push(e),f}const H3=512;function Uq(r){const{width:t,height:e,pitch:n=0}=r;let{longitude:i,latitude:s,zoom:a,bearing:o=0}=r;(i<-180||i>180)&&(i=U3(i+180,360)-180),(o<-180||o>180)&&(o=U3(o+180,360)-180);const A=$b(e/H3);if(a<=A)a=A,s=0;else{const f=e/2/Math.pow(2,a),m=nf([0,f])[1];if(s<m)s=m;else{const _=nf([0,H3-f])[1];s>_&&(s=_)}}return{width:t,height:e,longitude:i,latitude:s,zoom:a,pitch:n,bearing:o}}const Rq=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,Oq=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture2D(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,Dq=dg(zq),Nq=dg(Gq),kq=[0,0,0,1],Qq=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function Hq(r,t){const[e,n,i]=r,s=Jb([e,n,i],t);return Number.isFinite(i)?s:[s[0],s[1],0]}function zq(r){let{viewport:t,center:e}=r;return new Bn(t.viewProjectionMatrix).invert().transform(e)}function Gq(r){let{viewport:t,shadowMatrices:e}=r;const n=[],i=t.pixelUnprojectionMatrix,s=t.isGeospatial?void 0:1,a=[[0,0,s],[t.width,0,s],[0,t.height,s],[t.width,t.height,s],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(o=>Hq(o,i));for(const o of e){const A=o.clone().translate(new le(t.center).negate()),f=a.map(_=>A.transform(_)),m=new Bn().ortho({left:Math.min(...f.map(_=>_[0])),right:Math.max(...f.map(_=>_[0])),bottom:Math.min(...f.map(_=>_[1])),top:Math.max(...f.map(_=>_[1])),near:Math.min(...f.map(_=>-_[2])),far:Math.max(...f.map(_=>-_[2]))});n.push(m.multiplyRight(o))}return n}function Vq(r,t){const{shadowEnabled:e=!0}=r;if(!e||!r.shadowMatrices||!r.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1};const n={shadow_uDrawShadowMap:!!r.drawToShadowMap,shadow_uUseShadowMap:r.shadowMaps?r.shadowMaps.length>0:!1,shadow_uColor:r.shadowColor||kq,shadow_uLightId:r.shadowLightId||0,shadow_uLightCount:r.shadowMatrices.length},i=Dq({viewport:r.viewport,center:t.project_uCenter}),s=[],a=Nq({shadowMatrices:r.shadowMatrices,viewport:r.viewport}).slice();for(let o=0;o<r.shadowMatrices.length;o++){const A=a[o],f=A.clone().translate(new le(r.viewport.center).negate());t.project_uCoordinateSystem===Tn.LNGLAT&&t.project_uProjectionMode===Ql.WEB_MERCATOR?(a[o]=f,s[o]=i):(a[o]=A.clone().multiplyRight(Qq),s[o]=f.transform(i))}for(let o=0;o<a.length;o++)n["shadow_uViewProjectionMatrices[".concat(o,"]")]=a[o],n["shadow_uProjectCenters[".concat(o,"]")]=s[o],r.shadowMaps&&r.shadowMaps.length>0?n["shadow_uShadowMap".concat(o)]=r.shadowMaps[o]:n["shadow_uShadowMap".concat(o)]=r.dummyShadowMap;return n}const Yb={name:"shadow",dependencies:[qb],vs:Rq,fs:Oq,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return"viewport"in r&&(r.drawToShadowMap||r.shadowMaps&&r.shadowMaps.length>0)?Vq(r,t):{}}},jq={color:[255,255,255],intensity:1},z3=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],qq=[0,0,0,200/255];class Zb{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};$(this,"id","lighting-effect"),$(this,"props",void 0),$(this,"shadowColor",qq),$(this,"shadow",void 0),$(this,"ambientLight",void 0),$(this,"directionalLights",void 0),$(this,"pointLights",void 0),$(this,"shadowPasses",[]),$(this,"shadowMaps",[]),$(this,"dummyShadowMap",null),$(this,"programManager",void 0),$(this,"shadowMatrices",void 0),this.setProps(t)}setProps(t){this.ambientLight=null,this.directionalLights=[],this.pointLights=[];for(const e in t){const n=t[e];switch(n.type){case"ambient":this.ambientLight=n;break;case"directional":this.directionalLights.push(n);break;case"point":this.pointLights.push(n);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(e=>e.shadow),this.props=t}preRender(t,e){let{layers:n,layerFilter:i,viewports:s,onViewportActive:a,views:o}=e;if(this.shadow){this.shadowMatrices=this._calculateMatrices(),this.shadowPasses.length===0&&this._createShadowPasses(t),this.programManager||(this.programManager=Ag.getDefaultProgramManager(t),Yb&&this.programManager.addDefaultModule(Yb)),this.dummyShadowMap||(this.dummyShadowMap=new Fa(t,{width:1,height:1}));for(let A=0;A<this.shadowPasses.length;A++)this.shadowPasses[A].render({layers:n,layerFilter:i,viewports:s,onViewportActive:a,views:o,moduleParameters:{shadowLightId:A,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(t){const e=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return e.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(n=>n.getProjectedLight({layer:t})),pointLights:this.pointLights.map(n=>n.getProjectedLight({layer:t}))},e}cleanup(){for(const t of this.shadowPasses)t.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.delete(),this.dummyShadowMap=null),this.shadow&&this.programManager&&(this.programManager.removeDefaultModule(Yb),this.programManager=null)}_calculateMatrices(){const t=[];for(const e of this.directionalLights){const n=new Bn().lookAt({eye:new le(e.direction).negate()});t.push(n)}return t}_createShadowPasses(t){for(let e=0;e<this.directionalLights.length;e++){const n=new aq(t);this.shadowPasses[e]=n,this.shadowMaps[e]=n.shadowMap}}_applyDefaultLights(){const{ambientLight:t,pointLights:e,directionalLights:n}=this;!t&&e.length===0&&n.length===0&&(this.ambientLight=new E3(jq),this.directionalLights.push(new S3(z3[0]),new S3(z3[1])))}}class Kq{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};$(this,"_pool",[]),$(this,"opts",{overAlloc:2,poolSize:100}),this.setOptions(t)}setOptions(t){Object.assign(this.opts,t)}allocate(t,e,n){let{size:i=1,type:s,padding:a=0,copy:o=!1,initialize:A=!1,maxCount:f}=n;const m=s||t&&t.constructor||Float32Array,_=e*i+a;if(ArrayBuffer.isView(t)){if(_<=t.length)return t;if(_*t.BYTES_PER_ELEMENT<=t.buffer.byteLength)return new m(t.buffer,0,_)}let x=1/0;f&&(x=f*i+a);const B=this._allocate(m,_,A,x);return t&&o?B.set(t):A||B.fill(0,0,4),this._release(t),B}release(t){this._release(t)}_allocate(t,e,n,i){let s=Math.max(Math.ceil(e*this.opts.overAlloc),1);s>i&&(s=i);const a=this._pool,o=t.BYTES_PER_ELEMENT*s,A=a.findIndex(f=>f.byteLength>=o);if(A>=0){const f=new t(a.splice(A,1)[0],0,s);return n&&f.fill(0),f}return new t(s)}_release(t){if(!ArrayBuffer.isView(t))return;const e=this._pool,{buffer:n}=t,{byteLength:i}=n,s=e.findIndex(a=>a.byteLength>=i);s<0?e.push(n):(s>0||e.length<this.opts.poolSize)&&e.splice(s,0,n),e.length>this.opts.poolSize&&e.shift()}}const pg=new Kq;function gg(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function $q(r){return[r[12],r[13],r[14]]}function Wq(r){return{left:sf(r[3]+r[0],r[7]+r[4],r[11]+r[8],r[15]+r[12]),right:sf(r[3]-r[0],r[7]-r[4],r[11]-r[8],r[15]-r[12]),bottom:sf(r[3]+r[1],r[7]+r[5],r[11]+r[9],r[15]+r[13]),top:sf(r[3]-r[1],r[7]-r[5],r[11]-r[9],r[15]-r[13]),near:sf(r[3]+r[2],r[7]+r[6],r[11]+r[10],r[15]+r[14]),far:sf(r[3]-r[2],r[7]-r[6],r[11]-r[10],r[15]-r[14])}}const G3=new le;function sf(r,t,e,n){G3.set(r,t,e);const i=G3.len();return{distance:n/i,normal:new le(-r/i,-t/i,-e/i)}}function Xq(r){return r-Math.fround(r)}let mg;function tw(r,t){const{size:e=1,startIndex:n=0}=t,i=t.endIndex!==void 0?t.endIndex:r.length,s=(i-n)/e;mg=pg.allocate(mg,s,{type:Float32Array,size:e*2});let a=n,o=0;for(;a<i;){for(let A=0;A<e;A++){const f=r[a++];mg[o+A]=f,mg[o+A+e]=Xq(f)}o+=e*2}return mg.subarray(0,s*e*2)}function Jq(r){let t=null,e=!1;for(const n of r)n&&(t?(e||(t=[[t[0][0],t[0][1]],[t[1][0],t[1][1]]],e=!0),t[0][0]=Math.min(t[0][0],n[0][0]),t[0][1]=Math.min(t[0][1],n[0][1]),t[1][0]=Math.max(t[1][0],n[1][0]),t[1][1]=Math.max(t[1][1],n[1][1])):t=n);return t}const Yq=Math.PI/180,Zq=gg(),V3=[0,0,0],tK={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function eK(r){let{width:t,height:e,orthographic:n,fovyRadians:i,focalDistance:s,padding:a,near:o,far:A}=r;const f=t/e,m=n?new Bn().orthographic({fovy:i,aspect:f,focalDistance:s,near:o,far:A}):new Bn().perspective({fovy:i,aspect:f,near:o,far:A});if(a){const{left:_=0,right:x=0,top:B=0,bottom:P=0}=a,M=Uu((_+t-x)/2,0,t)-t/2,k=Uu((B+e-P)/2,0,e)-e/2;m[8]-=M*2/t,m[9]+=k*2/e}return m}class of{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};$(this,"id",void 0),$(this,"x",void 0),$(this,"y",void 0),$(this,"width",void 0),$(this,"height",void 0),$(this,"padding",void 0),$(this,"isGeospatial",void 0),$(this,"zoom",void 0),$(this,"focalDistance",void 0),$(this,"position",void 0),$(this,"modelMatrix",void 0),$(this,"distanceScales",void 0),$(this,"scale",void 0),$(this,"center",void 0),$(this,"cameraPosition",void 0),$(this,"projectionMatrix",void 0),$(this,"viewMatrix",void 0),$(this,"viewMatrixUncentered",void 0),$(this,"viewMatrixInverse",void 0),$(this,"viewProjectionMatrix",void 0),$(this,"pixelProjectionMatrix",void 0),$(this,"pixelUnprojectionMatrix",void 0),$(this,"resolution",void 0),$(this,"_frustumPlanes",{}),this.id=t.id||this.constructor.displayName||"viewport",this.x=t.x||0,this.y=t.y||0,this.width=t.width||1,this.height=t.height||1,this.zoom=t.zoom||0,this.padding=t.padding,this.distanceScales=t.distanceScales||tK,this.focalDistance=t.focalDistance||1,this.position=t.position||V3,this.modelMatrix=t.modelMatrix||null;const{longitude:e,latitude:n}=t;this.isGeospatial=Number.isFinite(n)&&Number.isFinite(e),this._initProps(t),this._initMatrices(t),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?Ql.WEB_MERCATOR:Ql.WEB_MERCATOR_AUTO_OFFSET:Ql.IDENTITY}equals(t){return t instanceof of?this===t?!0:t.width===this.width&&t.height===this.height&&t.scale===this.scale&&zc(t.projectionMatrix,this.projectionMatrix)&&zc(t.viewMatrix,this.viewMatrix):!1}project(t){let{topLeft:e=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=this.projectPosition(t),i=N3(n,this.pixelProjectionMatrix),[s,a]=i,o=e?a:this.height-a;return t.length===2?[s,o]:[s,o,i[2]]}unproject(t){let{topLeft:e=!0,targetZ:n}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const[i,s,a]=t,o=e?s:this.height-s,A=n&&n*this.distanceScales.unitsPerMeter[2],f=Jb([i,o,a],this.pixelUnprojectionMatrix,A),[m,_,x]=this.unprojectPosition(f);return Number.isFinite(a)?[m,_,x]:Number.isFinite(n)?[m,_,n]:[m,_]}projectPosition(t){const[e,n]=this.projectFlat(t),i=(t[2]||0)*this.distanceScales.unitsPerMeter[2];return[e,n,i]}unprojectPosition(t){const[e,n]=this.unprojectFlat(t),i=(t[2]||0)*this.distanceScales.metersPerUnit[2];return[e,n,i]}projectFlat(t){if(this.isGeospatial){const e=fg(t);return e[1]=Uu(e[1],-318,830),e}return t}unprojectFlat(t){return this.isGeospatial?nf(t):t}getBounds(){const e={targetZ:(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{}).z||0},n=this.unproject([0,0],e),i=this.unproject([this.width,0],e),s=this.unproject([0,this.height],e),a=this.unproject([this.width,this.height],e);return[Math.min(n[0],i[0],s[0],a[0]),Math.min(n[1],i[1],s[1],a[1]),Math.max(n[0],i[0],s[0],a[0]),Math.max(n[1],i[1],s[1],a[1])]}getDistanceScales(t){return t?Xb({longitude:t[0],latitude:t[1],highPrecision:!0}):this.distanceScales}containsPixel(t){let{x:e,y:n,width:i=1,height:s=1}=t;return e<this.x+this.width&&this.x<e+i&&n<this.y+this.height&&this.y<n+s}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,Wq(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(t,e){return null}_initProps(t){const e=t.longitude,n=t.latitude;this.isGeospatial&&(Number.isFinite(t.zoom)||(this.zoom=Tq({latitude:n})+Math.log2(this.focalDistance)),this.distanceScales=t.distanceScales||Xb({latitude:n,longitude:e}));const i=Math.pow(2,this.zoom);this.scale=i;const{position:s,modelMatrix:a}=t;let o=V3;if(s&&(o=a?new Bn(a).transformAsVector(s,[]):s),this.isGeospatial){const A=this.projectPosition([e,n,0]);this.center=new le(o).scale(this.distanceScales.unitsPerMeter).add(A)}else this.center=this.projectPosition(o)}_initMatrices(t){const{viewMatrix:e=Zq,projectionMatrix:n=null,orthographic:i=!1,fovyRadians:s,fovy:a=75,near:o=.1,far:A=1e3,padding:f=null,focalDistance:m=1}=t;this.viewMatrixUncentered=e,this.viewMatrix=new Bn().multiplyRight(e).translate(new le(this.center).negate()),this.projectionMatrix=n||eK({width:this.width,height:this.height,orthographic:i,fovyRadians:s||a*Yq,focalDistance:m,padding:f,near:o,far:A});const _=gg();kh(_,_,this.projectionMatrix),kh(_,_,this.viewMatrix),this.viewProjectionMatrix=_,this.viewMatrixInverse=Ob([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=$q(this.viewMatrixInverse);const x=gg(),B=gg();Db(x,x,[this.width/2,-this.height/2,1]),D0(x,x,[1,-1,0]),kh(B,x,this.viewProjectionMatrix),this.pixelProjectionMatrix=B,this.pixelUnprojectionMatrix=Ob(gg(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||Pn.warn("Pixel project matrix not invertible")()}}$(of,"displayName","Viewport");class Qh extends of{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{latitude:e=0,longitude:n=0,zoom:i=0,pitch:s=0,bearing:a=0,nearZMultiplier:o=.1,farZMultiplier:A=1.01,nearZ:f,farZ:m,orthographic:_=!1,projectionMatrix:x,repeat:B=!1,worldOffset:P=0,position:M,padding:k,legacyMeterSizes:Q=!1}=t;let{width:q,height:J,altitude:tt=1.5}=t;const ft=Math.pow(2,i);q=q||1,J=J||1;let pt,mt=null;if(x)tt=x[5]/2,pt=j0(tt);else{t.fovy?(pt=t.fovy,tt=D3(pt)):pt=j0(tt);let Rt;if(k){const{top:Lt=0,bottom:st=0}=k;Rt=[0,Uu((Lt+J-st)/2,0,J)-J/2]}mt=Lq({width:q,height:J,scale:ft,center:M&&[0,0,M[2]*V0(e)],offset:Rt,pitch:s,fovy:pt,nearZMultiplier:o,farZMultiplier:A}),Number.isFinite(f)&&(mt.near=f),Number.isFinite(m)&&(mt.far=m)}let dt=Iq({height:J,pitch:s,bearing:a,scale:ft,altitude:tt});P&&(dt=new Bn().translate([512*P,0,0]).multiplyLeft(dt)),super({...t,width:q,height:J,viewMatrix:dt,longitude:n,latitude:e,zoom:i,...mt,fovy:pt,focalDistance:tt}),$(this,"longitude",void 0),$(this,"latitude",void 0),$(this,"pitch",void 0),$(this,"bearing",void 0),$(this,"altitude",void 0),$(this,"fovy",void 0),$(this,"orthographic",void 0),$(this,"_subViewports",void 0),$(this,"_pseudoMeters",void 0),this.latitude=e,this.longitude=n,this.zoom=i,this.pitch=s,this.bearing=a,this.altitude=tt,this.fovy=pt,this.orthographic=_,this._subViewports=B?[]:null,this._pseudoMeters=Q,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const t=this.getBounds(),e=Math.floor((t[0]+180)/360),n=Math.ceil((t[2]-180)/360);for(let i=e;i<=n;i++){const s=i?new Qh({...this,worldOffset:i}):this;this._subViewports.push(s)}}return this._subViewports}projectPosition(t){if(this._pseudoMeters)return super.projectPosition(t);const[e,n]=this.projectFlat(t),i=(t[2]||0)*V0(t[1]);return[e,n,i]}unprojectPosition(t){if(this._pseudoMeters)return super.unprojectPosition(t);const[e,n]=this.unprojectFlat(t),i=(t[2]||0)/V0(n);return[e,n,i]}addMetersToLngLat(t,e){return O3(t,e)}panByPosition(t,e){const n=Jb(e,this.pixelUnprojectionMatrix),i=this.projectFlat(t),s=$5([],i,aV([],n)),a=$5([],this.center,s),[o,A]=this.unprojectFlat(a);return{longitude:o,latitude:A}}getBounds(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=Mq(this,t.z||0);return[Math.min(e[0][0],e[1][0],e[2][0],e[3][0]),Math.min(e[0][1],e[1][1],e[2][1],e[3][1]),Math.max(e[0][0],e[1][0],e[2][0],e[3][0]),Math.max(e[0][1],e[1][1],e[2][1],e[3][1])]}fitBounds(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{width:n,height:i}=this,{longitude:s,latitude:a,zoom:o}=Fq({width:n,height:i,bounds:t,...e});return new Qh({width:n,height:i,longitude:s,latitude:a,zoom:o})}}$(Qh,"displayName","WebMercatorViewport");const j3=[0,0,0];function ew(r,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const n=t.projectPosition(r);if(e&&t instanceof Qh){const[i,s,a=0]=r,o=t.getDistanceScales([i,s]);n[2]=a*o.unitsPerMeter[2]}return n}function rK(r){const{viewport:t,modelMatrix:e,coordinateOrigin:n}=r;let{coordinateSystem:i,fromCoordinateSystem:s,fromCoordinateOrigin:a}=r;return i===Tn.DEFAULT&&(i=t.isGeospatial?Tn.LNGLAT:Tn.CARTESIAN),s===void 0&&(s=i),a===void 0&&(a=n),{viewport:t,coordinateSystem:i,coordinateOrigin:n,modelMatrix:e,fromCoordinateSystem:s,fromCoordinateOrigin:a}}function q3(r,t){let{viewport:e,modelMatrix:n,coordinateSystem:i,coordinateOrigin:s,offsetMode:a}=t,[o,A,f=0]=r;switch(n&&([o,A,f]=cg([],[o,A,f,1],n)),i){case Tn.LNGLAT:return ew([o,A,f],e,a);case Tn.LNGLAT_OFFSETS:return ew([o+s[0],A+s[1],f+(s[2]||0)],e,a);case Tn.METER_OFFSETS:return ew(O3(s,[o,A,f]),e,a);case Tn.CARTESIAN:default:return e.isGeospatial?[o+s[0],A+s[1],f+s[2]]:e.projectPosition([o,A,f])}}function nK(r,t){const{viewport:e,coordinateSystem:n,coordinateOrigin:i,modelMatrix:s,fromCoordinateSystem:a,fromCoordinateOrigin:o}=rK(t),{autoOffset:A=!0}=t,{geospatialOrigin:f=j3,shaderCoordinateOrigin:m=j3,offsetMode:_=!1}=A?M3(e,n,i):{},x=q3(r,{viewport:e,modelMatrix:s,coordinateSystem:a,coordinateOrigin:o,offsetMode:_});if(_){const B=e.projectPosition(f||m);_V(x,x,B)}return x}const K3={blendFunc:[1,0,32771,0],blendEquation:32774};class $3 extends jb{constructor(){super(...arguments),$(this,"pickZ",void 0),$(this,"_colorEncoderState",null)}render(t){return"pickingFBO"in t?this._drawPickingBuffer(t):super.render(t)}_drawPickingBuffer(t){let{layers:e,layerFilter:n,views:i,viewports:s,onViewportActive:a,pickingFBO:o,deviceRect:{x:A,y:f,width:m,height:_},cullRect:x,effects:B,pass:P="picking",pickZ:M,moduleParameters:k}=t;const Q=this.gl;this.pickZ=M;const q=this._resetColorEncoder(M),J=Qc(Q,{scissorTest:!0,scissor:[A,f,m,_],clearColor:[0,0,0,0],depthMask:!0,depthTest:!0,depthRange:[0,1],colorMask:[!0,!0,!0,!0],...K3,blend:!M},()=>super.render({target:o,layers:e,layerFilter:n,views:i,viewports:s,onViewportActive:a,cullRect:x,effects:B==null?void 0:B.filter(ft=>ft.useInPicking),pass:P,isPicking:!0,moduleParameters:k}));return this._colorEncoderState=null,{decodePickingColor:q&&sK.bind(null,q),stats:J}}shouldDrawLayer(t){const{pickable:e,operation:n}=t.props;return e&&n.includes("draw")||n.includes("terrain")||n.includes("mask")}getModuleParameters(){return{pickingActive:1,pickingAttribute:this.pickZ,lightSources:{}}}getLayerParameters(t,e,n){const i={...t.props.parameters},{pickable:s,operation:a}=t.props;return this._colorEncoderState?s&&a.includes("draw")&&(Object.assign(i,K3),i.blend=!0,i.blendColor=iK(this._colorEncoderState,t,n)):i.blend=!1,a.includes("terrain")&&(i.blend=!1),i}_resetColorEncoder(t){return this._colorEncoderState=t?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function iK(r,t,e){const{byLayer:n,byAlpha:i}=r;let s,a=n.get(t);return a?(a.viewports.push(e),s=a.a):(s=n.size+1,s<=255?(a={a:s,layer:t,viewports:[e]},n.set(t,a),i[s]=a):(Pn.warn("Too many pickable layers, only picking the first 255")(),s=0)),[0,0,0,s/255]}function sK(r,t){const e=r.byAlpha[t[3]];return e&&{pickedLayer:e.layer,pickedViewports:e.viewports,pickedObjectIndex:e.layer.decodePickingColor(t)}}const af={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},q0=Symbol.for("component"),UA=Symbol.for("propTypes"),rw=Symbol.for("deprecatedProps"),cf=Symbol.for("asyncPropDefaults"),Hh=Symbol.for("asyncPropOriginal"),RA=Symbol.for("asyncPropResolved");function K0(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:()=>!0;return Array.isArray(r)?W3(r,t,[]):t(r)?[r]:[]}function W3(r,t,e){let n=-1;for(;++n<r.length;){const i=r[n];Array.isArray(i)?W3(i,t,e):t(i)&&e.push(i)}return e}function oK(r){let{target:t,source:e,start:n=0,count:i=1}=r;const s=e.length,a=i*s;let o=0;for(let A=n;o<s;o++)t[A++]=e[o];for(;o<a;)o<a-o?(t.copyWithin(n+o,n,n+o),o*=2):(t.copyWithin(n+o,n,n+a-o),o=a);return t}class aK{constructor(t,e,n){$(this,"id",void 0),$(this,"context",void 0),$(this,"isLoaded",void 0),$(this,"persistent",void 0),$(this,"_loadCount",0),$(this,"_subscribers",new Set),$(this,"_data",void 0),$(this,"_loader",void 0),$(this,"_error",void 0),$(this,"_content",void 0),this.id=t,this.context=n,this.setData(e)}subscribe(t){this._subscribers.add(t)}unsubscribe(t){this._subscribers.delete(t)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(t,e){if(t===this._data&&!e)return;this._data=t;const n=++this._loadCount;let i=t;typeof t=="string"&&(i=TA(t)),i instanceof Promise?(this.isLoaded=!1,this._loader=i.then(s=>{this._loadCount===n&&(this.isLoaded=!0,this._error=void 0,this._content=s)}).catch(s=>{this._loadCount===n&&(this.isLoaded=!0,this._error=s||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=t);for(const s of this._subscribers)s.onChange(this.getData())}}class cK{constructor(t){let{gl:e,protocol:n}=t;$(this,"protocol",void 0),$(this,"_context",void 0),$(this,"_resources",void 0),$(this,"_consumers",void 0),$(this,"_pruneRequest",void 0),this.protocol=n||"resource://",this._context={gl:e,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(t){return t.startsWith(this.protocol)?!0:t in this._resources}add(t){let{resourceId:e,data:n,forceUpdate:i=!1,persistent:s=!0}=t,a=this._resources[e];a?a.setData(n,i):(a=new aK(e,n,this._context),this._resources[e]=a),a.persistent=s}remove(t){const e=this._resources[t];e&&(e.delete(),delete this._resources[t])}unsubscribe(t){let{consumerId:e}=t;const n=this._consumers[e];if(n){for(const i in n){const s=n[i],a=this._resources[s.resourceId];a&&a.unsubscribe(s)}delete this._consumers[e],this.prune()}}subscribe(t){let{resourceId:e,onChange:n,consumerId:i,requestId:s="default"}=t;const{_resources:a,protocol:o}=this;e.startsWith(o)&&(e=e.replace(o,""),a[e]||this.add({resourceId:e,data:null,persistent:!1}));const A=a[e];if(this._track(i,s,A,n),A)return A.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const t in this._resources)this._resources[t].delete()}_track(t,e,n,i){const s=this._consumers,a=s[t]=s[t]||{},o=a[e]||{},A=o.resourceId&&this._resources[o.resourceId];A&&(A.unsubscribe(o),this.prune()),n&&(a[e]=o,o.onChange=i,o.resourceId=n.id,n.subscribe(o))}_prune(){this._pruneRequest=null;for(const t of Object.keys(this._resources)){const e=this._resources[t];!e.persistent&&!e.inUse()&&(e.delete(),delete this._resources[t])}}}const nw={name:"project32",dependencies:[qb],vs:`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`},iw={inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:#decl":`
uniform bool picking_uAttribute;
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}},...xj},lK=[qb],uK=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function AK(r){const t=Ag.getDefaultProgramManager(r);for(const e of lK)t.addDefaultModule(e);for(const e of uK)t.addShaderHook(e);return t}const hK="layerManager.setLayers",dK="layerManager.activateViewport";class fK{constructor(t){let{deck:e,stats:n,viewport:i,timeline:s}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};$(this,"layers",void 0),$(this,"context",void 0),$(this,"resourceManager",void 0),$(this,"_lastRenderedLayers",[]),$(this,"_needsRedraw",!1),$(this,"_needsUpdate",!1),$(this,"_nextLayers",null),$(this,"_debug",!1),$(this,"activateViewport",a=>{lo(dK,this,a),a&&(this.context.viewport=a)}),this.layers=[],this.resourceManager=new cK({gl:t,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,gl:t,deck:e,programManager:t&&AK(t),stats:n||new sb({id:"deck.gl"}),viewport:i||new of({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:s||new C3,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const t of this.layers)this._finalizeLayer(t)}needsRedraw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1},e=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);for(const n of this.layers){const i=n.getNeedsRedraw(t);e=e||i}return e}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._needsUpdate}setNeedsRedraw(t){this._needsRedraw=this._needsRedraw||t}setNeedsUpdate(t){this._needsUpdate=this._needsUpdate||t}getLayers(){let{layerIds:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t?this.layers.filter(e=>t.find(n=>e.id.indexOf(n)===0)):this.layers}setProps(t){"debug"in t&&(this._debug=t.debug),"userData"in t&&(this.context.userData=t.userData),"layers"in t&&(this._nextLayers=t.layers),"onError"in t&&(this.context.onError=t.onError)}setLayers(t,e){lo(hK,this,e,t),this._lastRenderedLayers=t;const n=K0(t,Boolean);for(const i of n)i.context=this.context;this._updateLayers(this.layers,n)}updateLayers(){const t=this.needsUpdate();t&&(this.setNeedsRedraw("updating layers: ".concat(t)),this.setLayers(this._nextLayers||this._lastRenderedLayers,t)),this._nextLayers=null}_handleError(t,e,n){n.raiseError(e,"".concat(t," of ").concat(n))}_updateLayers(t,e){const n={};for(const a of t)n[a.id]?Pn.warn("Multiple old layers with same id ".concat(a.id))():n[a.id]=a;const i=[];this._updateSublayersRecursively(e,n,i),this._finalizeOldLayers(n);let s=!1;for(const a of i)if(a.hasUniformTransition()){s="Uniform transition in ".concat(a);break}this._needsUpdate=s,this.layers=i}_updateSublayersRecursively(t,e,n){for(const i of t){i.context=this.context;const s=e[i.id];s===null&&Pn.warn("Multiple new layers with same id ".concat(i.id))(),e[i.id]=null;let a=null;try{this._debug&&s!==i&&i.validateProps(),s?(this._transferLayerState(s,i),this._updateLayer(i)):this._initializeLayer(i),n.push(i),a=i.isComposite?i.getSubLayers():null}catch(o){this._handleError("matching",o,i)}a&&this._updateSublayersRecursively(a,e,n)}}_finalizeOldLayers(t){for(const e in t){const n=t[e];n&&this._finalizeLayer(n)}}_initializeLayer(t){try{t._initialize(),t.lifecycle=af.INITIALIZED}catch(e){this._handleError("initialization",e,t)}}_transferLayerState(t,e){e._transferState(t),e.lifecycle=af.MATCHED,e!==t&&(t.lifecycle=af.AWAITING_GC)}_updateLayer(t){try{t._update()}catch(e){this._handleError("update",e,t)}}_finalizeLayer(t){this._needsRedraw=this._needsRedraw||"finalized ".concat(t),t.lifecycle=af.AWAITING_FINALIZATION;try{t._finalize(),t.lifecycle=af.FINALIZED}catch(e){this._handleError("finalization",e,t)}}}function zl(r,t,e){if(r===t)return!0;if(!e||!r||!t)return!1;if(Array.isArray(r)){if(!Array.isArray(t)||r.length!==t.length)return!1;for(let n=0;n<r.length;n++)if(!zl(r[n],t[n],e-1))return!1;return!0}if(Array.isArray(t))return!1;if(typeof r=="object"&&typeof t=="object"){const n=Object.keys(r),i=Object.keys(t);if(n.length!==i.length)return!1;for(const s of n)if(!t.hasOwnProperty(s)||!zl(r[s],t[s],e-1))return!1;return!0}return!1}class pK{constructor(t){$(this,"width",void 0),$(this,"height",void 0),$(this,"views",void 0),$(this,"viewState",void 0),$(this,"controllers",void 0),$(this,"timeline",void 0),$(this,"_viewports",void 0),$(this,"_viewportMap",void 0),$(this,"_isUpdating",void 0),$(this,"_needsRedraw",void 0),$(this,"_needsUpdate",void 0),$(this,"_eventManager",void 0),$(this,"_eventCallbacks",void 0),this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=t.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=t.eventManager,this._eventCallbacks={onViewStateChange:t.onViewStateChange,onInteractionStateChange:t.onInteractionStateChange},Object.seal(this),this.setProps(t)}finalize(){for(const t in this.controllers){const e=this.controllers[t];e&&e.finalize()}this.controllers={}}needsRedraw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};const e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}setNeedsUpdate(t){this._needsUpdate=this._needsUpdate||t,this._needsRedraw=this._needsRedraw||t}updateViewStates(){for(const t in this.controllers){const e=this.controllers[t];e&&e.updateTransition()}}getViewports(t){return t?this._viewports.filter(e=>e.containsPixel(t)):this._viewports}getViews(){const t={};return this.views.forEach(e=>{t[e.id]=e}),t}getView(t){return this.views.find(e=>e.id===t)}getViewState(t){const e=typeof t=="string"?this.getView(t):t,n=e&&this.viewState[e.getViewStateId()]||this.viewState;return e?e.filterViewState(n):n}getViewport(t){return this._viewportMap[t]}unproject(t,e){const n=this.getViewports(),i={x:t[0],y:t[1]};for(let s=n.length-1;s>=0;--s){const a=n[s];if(a.containsPixel(i)){const o=t.slice();return o[0]-=a.x,o[1]-=a.y,a.unproject(o,e)}}return null}setProps(t){t.views&&this._setViews(t.views),t.viewState&&this._setViewState(t.viewState),("width"in t||"height"in t)&&this._setSize(t.width,t.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(t,e){(t!==this.width||e!==this.height)&&(this.width=t,this.height=e,this.setNeedsUpdate("Size changed"))}_setViews(t){t=K0(t,Boolean),this._diffViews(t,this.views)&&this.setNeedsUpdate("views changed"),this.views=t}_setViewState(t){t?(!zl(t,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=t):Pn.warn("missing `viewState` or `initialViewState`")()}_onViewStateChange(t,e){this._eventCallbacks.onViewStateChange&&this._eventCallbacks.onViewStateChange({...e,viewId:t})}_createController(t,e){const n=e.type;return new n({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,e.id),onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:s=>{var a;return(a=this.getView(t.id))===null||a===void 0?void 0:a.makeViewport({viewState:s,width:this.width,height:this.height})}})}_updateController(t,e,n,i){const s=t.controller;if(s&&n){const a={...e,...s,id:t.id,x:n.x,y:n.y,width:n.width,height:n.height};return(!i||i.constructor!==s.type)&&(i=this._createController(t,a)),i&&i.setProps(a),i}return null}_rebuildViewports(){const{views:t}=this,e=this.controllers;this._viewports=[],this.controllers={};let n=!1;for(let i=t.length;i--;){const s=t[i],a=this.getViewState(s),o=s.makeViewport({viewState:a,width:this.width,height:this.height});let A=e[s.id];const f=!!s.controller;f&&!A&&(n=!0),(n||!f)&&A&&(A.finalize(),A=null),this.controllers[s.id]=this._updateController(s,a,o,A),o&&this._viewports.unshift(o)}for(const i in e){const s=e[i];s&&!this.controllers[i]&&s.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(t=>{t.id&&(this._viewportMap[t.id]=this._viewportMap[t.id]||t)})}_diffViews(t,e){return t.length!==e.length?!0:t.some((n,i)=>!t[i].equals(e[i]))}}const gK=/([0-9]+\.?[0-9]*)(%|px)/;function OA(r){switch(typeof r){case"number":return{position:r,relative:!1};case"string":const t=gK.exec(r);if(t&&t.length>=3){const e=t[2]==="%",n=parseFloat(t[1]);return{position:e?n/100:n,relative:e}}default:throw new Error("Could not parse position string ".concat(r))}}function DA(r,t){return r.relative?Math.round(r.position*t):r.position}function Ws(r,t){if(!r)throw new Error(t||"deck.gl: assertion failed.")}class mK{constructor(t){$(this,"id",void 0),$(this,"viewportInstance",void 0),$(this,"_x",void 0),$(this,"_y",void 0),$(this,"_width",void 0),$(this,"_height",void 0),$(this,"_padding",void 0),$(this,"props",void 0);const{id:e,x:n=0,y:i=0,width:s="100%",height:a="100%",padding:o=null,viewportInstance:A}=t||{};Ws(!A||A instanceof of),this.viewportInstance=A,this.id=e||this.constructor.displayName||"view",this.props={...t,id:this.id},this._x=OA(n),this._y=OA(i),this._width=OA(s),this._height=OA(a),this._padding=o&&{left:OA(o.left||0),right:OA(o.right||0),top:OA(o.top||0),bottom:OA(o.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(t){return this===t?!0:this.viewportInstance?t.viewportInstance?this.viewportInstance.equals(t.viewportInstance):!1:this.ViewportType===t.ViewportType&&zl(this.props,t.props,2)}makeViewport(t){let{width:e,height:n,viewState:i}=t;if(this.viewportInstance)return this.viewportInstance;i=this.filterViewState(i);const s=this.getDimensions({width:e,height:n});return!s.height||!s.width?null:new this.ViewportType({...i,...this.props,...s})}getViewStateId(){const{viewState:t}=this.props;return typeof t=="string"?t:(t==null?void 0:t.id)||this.id}filterViewState(t){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const e={...t};for(const n in this.props.viewState)n!=="id"&&(e[n]=this.props.viewState[n]);return e}return t}getDimensions(t){let{width:e,height:n}=t;const i={x:DA(this._x,e),y:DA(this._y,n),width:DA(this._width,e),height:DA(this._height,n)};return this._padding&&(i.padding={left:DA(this._padding.left,e),top:DA(this._padding.top,n),right:DA(this._padding.right,e),bottom:DA(this._padding.bottom,n)}),i}get controller(){const t=this.props.controller;return t?t===!0?{type:this.ControllerType}:typeof t=="function"?{type:t}:{type:this.ControllerType,...t}:null}}class yg{constructor(t){$(this,"_inProgress",void 0),$(this,"_handle",void 0),$(this,"_timeline",void 0),$(this,"time",void 0),$(this,"settings",void 0),this._inProgress=!1,this._handle=null,this._timeline=t,this.time=0,this.settings={duration:0}}get inProgress(){return this._inProgress}start(t){var e,n;this.cancel(),this.settings=t,this._inProgress=!0,(e=(n=this.settings).onStart)===null||e===void 0||e.call(n,this)}end(){if(this._inProgress){var t,e;this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(t=(e=this.settings).onEnd)===null||t===void 0||t.call(e,this)}}cancel(){if(this._inProgress){var t,e;(t=(e=this.settings).onInterrupt)===null||t===void 0||t.call(e,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1}}update(){var t,e;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:n,settings:i}=this;this._handle=n.addChannel({delay:n.getTime(),duration:i.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(t=(e=this.settings).onUpdate)===null||t===void 0||t.call(e,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const X3=()=>{},sw={BREAK:1,SNAP_TO_END:2,IGNORE:3},yK=r=>r,_K=sw.BREAK;class vK{constructor(t){$(this,"getControllerState",void 0),$(this,"props",void 0),$(this,"propsInTransition",void 0),$(this,"transition",void 0),$(this,"onViewStateChange",void 0),$(this,"onStateChange",void 0),$(this,"_onTransitionUpdate",e=>{const{time:n,settings:{interpolator:i,startProps:s,endProps:a,duration:o,easing:A}}=e,f=A(n/o),m=i.interpolateProps(s,a,f);this.propsInTransition=this.getControllerState({...this.props,...m}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})}),this.getControllerState=t.getControllerState,this.propsInTransition=null,this.transition=new yg(t.timeline),this.onViewStateChange=t.onViewStateChange||X3,this.onStateChange=t.onStateChange||X3}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(t){let e=!1;const n=this.props;if(this.props=t,!n||this._shouldIgnoreViewportChange(n,t))return!1;if(this._isTransitionEnabled(t)){let i=n;if(this.transition.inProgress){const{interruption:s,endProps:a}=this.transition.settings;i={...n,...s===sw.SNAP_TO_END?a:this.propsInTransition||n}}this._triggerTransition(i,t),e=!0}else this.transition.cancel();return e}updateTransition(){this.transition.update()}_isTransitionEnabled(t){const{transitionDuration:e,transitionInterpolator:n}=t;return(e>0||e==="auto")&&!!n}_isUpdateDueToCurrentTransition(t){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(t,this.propsInTransition):!1}_shouldIgnoreViewportChange(t,e){return this.transition.inProgress?this.transition.settings.interruption===sw.IGNORE||this._isUpdateDueToCurrentTransition(e):this._isTransitionEnabled(e)?e.transitionInterpolator.arePropsEqual(t,e):!0}_triggerTransition(t,e){const n=this.getControllerState(t),i=this.getControllerState(e).shortestPathFrom(n),s=e.transitionInterpolator,a=s.getDuration?s.getDuration(t,e):e.transitionDuration;if(a===0)return;const o=s.initializeProps(t,i);this.propsInTransition={};const A={duration:a,easing:e.transitionEasing||yK,interpolator:s,interruption:e.transitionInterruption||_K,startProps:o.start,endProps:o.end,onStart:e.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(e.onTransitionInterrupt),onEnd:this._onTransitionEnd(e.onTransitionEnd)};this.transition.start(A),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(t){return e=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),t==null||t(e)}}}class bK{constructor(t){$(this,"_propsToCompare",void 0),$(this,"_propsToExtract",void 0),$(this,"_requiredProps",void 0);const{compare:e,extract:n,required:i}=t;this._propsToCompare=e,this._propsToExtract=n||e,this._requiredProps=i}arePropsEqual(t,e){for(const n of this._propsToCompare)if(!(n in t)||!(n in e)||!zc(t[n],e[n]))return!1;return!0}initializeProps(t,e){const n={},i={};for(const s of this._propsToExtract)(s in t||s in e)&&(n[s]=t[s],i[s]=e[s]);return this._checkRequiredProps(n),this._checkRequiredProps(i),{start:n,end:i}}getDuration(t,e){return e.transitionDuration}_checkRequiredProps(t){this._requiredProps&&this._requiredProps.forEach(e=>{const n=t[e];Ws(Number.isFinite(n)||Array.isArray(n),"".concat(e," is required for transition"))})}}const wK=["longitude","latitude","zoom","bearing","pitch"],xK=["longitude","latitude","zoom"];class J3 extends bK{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=Array.isArray(t)?t:t.transitionProps,n=Array.isArray(t)?{}:t;n.transitionProps=Array.isArray(e)?{compare:e,required:e}:e||{compare:wK,required:xK},super(n.transitionProps),$(this,"opts",void 0),this.opts=n}initializeProps(t,e){const n=super.initializeProps(t,e),{makeViewport:i,around:s}=this.opts;if(i&&s){const a=i(t),o=i(e),A=a.unproject(s);n.start.around=s,Object.assign(n.end,{around:o.project(A),aroundPosition:A,width:e.width,height:e.height})}return n}interpolateProps(t,e,n){const i={};for(const s of this._propsToExtract)i[s]=F0(t[s]||0,e[s]||0,n);if(e.aroundPosition&&this.opts.makeViewport){const s=this.opts.makeViewport({...e,...i});Object.assign(i,s.panByPosition(e.aroundPosition,F0(t.around,e.around,n)))}return i}}const NA={transitionDuration:0},BK=300,$0=r=>1-(1-r)*(1-r),lf={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},zh={};class CK{constructor(t){$(this,"props",void 0),$(this,"state",{}),$(this,"transitionManager",void 0),$(this,"eventManager",void 0),$(this,"onViewStateChange",void 0),$(this,"onStateChange",void 0),$(this,"makeViewport",void 0),$(this,"_controllerState",void 0),$(this,"_events",{}),$(this,"_interactionState",{isDragging:!1}),$(this,"_customEvents",[]),$(this,"_eventStartBlocked",null),$(this,"_panMove",!1),$(this,"invertPan",!1),$(this,"dragMode","rotate"),$(this,"inertia",0),$(this,"scrollZoom",!0),$(this,"dragPan",!0),$(this,"dragRotate",!0),$(this,"doubleClickZoom",!0),$(this,"touchZoom",!0),$(this,"touchRotate",!1),$(this,"keyboard",!0),this.transitionManager=new vK({...t,getControllerState:e=>new this.ControllerState(e),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=t.eventManager,this.onViewStateChange=t.onViewStateChange||(()=>{}),this.onStateChange=t.onStateChange||(()=>{}),this.makeViewport=t.makeViewport}set events(t){this.toggleEvents(this._customEvents,!1),this.toggleEvents(t,!0),this._customEvents=t,this.props&&this.setProps(this.props)}finalize(){for(const e in this._events)if(this._events[e]){var t;(t=this.eventManager)===null||t===void 0||t.off(e,this.handleEvent)}this.transitionManager.finalize()}handleEvent(t){this._controllerState=void 0;const e=this._eventStartBlocked;switch(t.type){case"panstart":return e?!1:this._onPanStart(t);case"panmove":return this._onPan(t);case"panend":return this._onPanEnd(t);case"pinchstart":return e?!1:this._onPinchStart(t);case"pinchmove":return this._onPinch(t);case"pinchend":return this._onPinchEnd(t);case"tripanstart":return e?!1:this._onTriplePanStart(t);case"tripanmove":return this._onTriplePan(t);case"tripanend":return this._onTriplePanEnd(t);case"doubletap":return this._onDoubleTap(t);case"wheel":return this._onWheel(t);case"keydown":return this._onKeyDown(t);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(t){const{x:e,y:n}=this.props,{offsetCenter:i}=t;return[i.x-e,i.y-n]}isPointInBounds(t,e){const{width:n,height:i}=this.props;if(e&&e.handled)return!1;const s=t[0]>=0&&t[0]<=n&&t[1]>=0&&t[1]<=i;return s&&e&&e.stopPropagation(),s}isFunctionKeyPressed(t){const{srcEvent:e}=t;return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(t){const e=setTimeout(()=>{this._eventStartBlocked===e&&(this._eventStartBlocked=null)},t);this._eventStartBlocked=e}setProps(t){t.dragMode&&(this.dragMode=t.dragMode),this.props=t,"transitionInterpolator"in t||(t.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(t);const{inertia:e}=t;this.inertia=Number.isFinite(e)?e:e===!0?BK:0;const{scrollZoom:n=!0,dragPan:i=!0,dragRotate:s=!0,doubleClickZoom:a=!0,touchZoom:o=!0,touchRotate:A=!1,keyboard:f=!0}=t,m=!!this.onViewStateChange;this.toggleEvents(lf.WHEEL,m&&n),this.toggleEvents(lf.PAN,m),this.toggleEvents(lf.PINCH,m&&(o||A)),this.toggleEvents(lf.TRIPLE_PAN,m&&A),this.toggleEvents(lf.DOUBLE_TAP,m&&a),this.toggleEvents(lf.KEYBOARD,m&&f),this.scrollZoom=n,this.dragPan=i,this.dragRotate=s,this.doubleClickZoom=a,this.touchZoom=o,this.touchRotate=A,this.keyboard=f}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(t,e){this.eventManager&&t.forEach(n=>{this._events[n]!==e&&(this._events[n]=e,e?this.eventManager.on(n,this.handleEvent):this.eventManager.off(n,this.handleEvent))})}updateViewport(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const i={...t.getViewportProps(),...e},s=this.controllerState!==t;if(this.state=t.getState(),this._setInteractionState(n),s){const a=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:i,interactionState:this._interactionState,oldViewState:a})}}_onTransition(t){this.onViewStateChange({...t,interactionState:this._interactionState})}_setInteractionState(t){Object.assign(this._interactionState,t),this.onStateChange(this._interactionState)}_onPanStart(t){const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;let n=this.isFunctionKeyPressed(t)||t.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(n=!n);const i=this.controllerState[n?"panStart":"rotateStart"]({pos:e});return this._panMove=n,this.updateViewport(i,NA,{isDragging:!0}),!0}_onPan(t){return this.isDragging()?this._panMove?this._onPanMove(t):this._onPanRotate(t):!1}_onPanEnd(t){return this.isDragging()?this._panMove?this._onPanMoveEnd(t):this._onPanRotateEnd(t):!1}_onPanMove(t){if(!this.dragPan)return!1;const e=this.getCenter(t),n=this.controllerState.pan({pos:e});return this.updateViewport(n,NA,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(t){const{inertia:e}=this;if(this.dragPan&&e&&t.velocity){const n=this.getCenter(t),i=[n[0]+t.velocityX*e/2,n[1]+t.velocityY*e/2],s=this.controllerState.pan({pos:i}).panEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:e,transitionEasing:$0},{isDragging:!1,isPanning:!0})}else{const n=this.controllerState.panEnd();this.updateViewport(n,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(t){if(!this.dragRotate)return!1;const e=this.getCenter(t),n=this.controllerState.rotate({pos:e});return this.updateViewport(n,NA,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(t){const{inertia:e}=this;if(this.dragRotate&&e&&t.velocity){const n=this.getCenter(t),i=[n[0]+t.velocityX*e/2,n[1]+t.velocityY*e/2],s=this.controllerState.rotate({pos:i}).rotateEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:e,transitionEasing:$0},{isDragging:!1,isRotating:!0})}else{const n=this.controllerState.rotateEnd();this.updateViewport(n,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(t){if(!this.scrollZoom)return!1;const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;t.srcEvent.preventDefault();const{speed:n=.01,smooth:i=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:s}=t;let a=2/(1+Math.exp(-Math.abs(s*n)));s<0&&a!==0&&(a=1/a);const o=this.controllerState.zoom({pos:e,scale:a});return this.updateViewport(o,{...this._getTransitionProps({around:e}),transitionDuration:i?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(t){const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;const n=this.controllerState.rotateStart({pos:e});return this.updateViewport(n,NA,{isDragging:!0}),!0}_onTriplePan(t){if(!this.touchRotate||!this.isDragging())return!1;const e=this.getCenter(t);e[0]-=t.deltaX;const n=this.controllerState.rotate({pos:e});return this.updateViewport(n,NA,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(t){if(!this.isDragging())return!1;const{inertia:e}=this;if(this.touchRotate&&e&&t.velocityY){const n=this.getCenter(t),i=[n[0],n[1]+=t.velocityY*e/2],s=this.controllerState.rotate({pos:i});this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:e,transitionEasing:$0},{isDragging:!1,isRotating:!0}),this.blockEvents(e)}else{const n=this.controllerState.rotateEnd();this.updateViewport(n,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(t){const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;const n=this.controllerState.zoomStart({pos:e}).rotateStart({pos:e});return zh._startPinchRotation=t.rotation,zh._lastPinchEvent=t,this.updateViewport(n,NA,{isDragging:!0}),!0}_onPinch(t){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let e=this.controllerState;if(this.touchZoom){const{scale:n}=t,i=this.getCenter(t);e=e.zoom({pos:i,scale:n})}if(this.touchRotate){const{rotation:n}=t;e=e.rotate({deltaAngleX:zh._startPinchRotation-n})}return this.updateViewport(e,NA,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),zh._lastPinchEvent=t,!0}_onPinchEnd(t){if(!this.isDragging())return!1;const{inertia:e}=this,{_lastPinchEvent:n}=zh;if(this.touchZoom&&e&&n&&t.scale!==n.scale){const i=this.getCenter(t);let s=this.controllerState.rotateEnd();const a=Math.log2(t.scale),o=(a-Math.log2(n.scale))/(t.deltaTime-n.deltaTime),A=Math.pow(2,a+o*e/2);s=s.zoom({pos:i,scale:A}).zoomEnd(),this.updateViewport(s,{...this._getTransitionProps({around:i}),transitionDuration:e,transitionEasing:$0},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(e)}else{const i=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return zh._startPinchRotation=null,zh._lastPinchEvent=null,!0}_onDoubleTap(t){if(!this.doubleClickZoom)return!1;const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;const n=this.isFunctionKeyPressed(t),i=this.controllerState.zoom({pos:e,scale:n?.5:2});return this.updateViewport(i,this._getTransitionProps({around:e}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(t){if(!this.keyboard)return!1;const e=this.isFunctionKeyPressed(t),{zoomSpeed:n,moveSpeed:i,rotateSpeedX:s,rotateSpeedY:a}=this.keyboard===!0?{}:this.keyboard,{controllerState:o}=this;let A;const f={};switch(t.srcEvent.code){case"Minus":A=e?o.zoomOut(n).zoomOut(n):o.zoomOut(n),f.isZooming=!0;break;case"Equal":A=e?o.zoomIn(n).zoomIn(n):o.zoomIn(n),f.isZooming=!0;break;case"ArrowLeft":e?(A=o.rotateLeft(s),f.isRotating=!0):(A=o.moveLeft(i),f.isPanning=!0);break;case"ArrowRight":e?(A=o.rotateRight(s),f.isRotating=!0):(A=o.moveRight(i),f.isPanning=!0);break;case"ArrowUp":e?(A=o.rotateUp(a),f.isRotating=!0):(A=o.moveUp(i),f.isPanning=!0);break;case"ArrowDown":e?(A=o.rotateDown(a),f.isRotating=!0):(A=o.moveDown(i),f.isPanning=!0);break;default:return!1}return this.updateViewport(A,this._getTransitionProps(),f),!0}_getTransitionProps(t){const{transition:e}=this;return!e||!e.transitionInterpolator?NA:t?{...e,transitionInterpolator:new J3({...t,...e.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:e}}class EK{constructor(t,e){$(this,"_viewportProps",void 0),$(this,"_state",void 0),this._viewportProps=this.applyConstraints(t),this._state=e}getViewportProps(){return this._viewportProps}getState(){return this._state}}const Y3=5,SK=1.2;class TK extends EK{constructor(t){const{width:e,height:n,latitude:i,longitude:s,zoom:a,bearing:o=0,pitch:A=0,altitude:f=1.5,position:m=[0,0,0],maxZoom:_=20,minZoom:x=0,maxPitch:B=60,minPitch:P=0,startPanLngLat:M,startZoomLngLat:k,startRotatePos:Q,startBearing:q,startPitch:J,startZoom:tt,normalize:ft=!0}=t;Ws(Number.isFinite(s)),Ws(Number.isFinite(i)),Ws(Number.isFinite(a)),super({width:e,height:n,latitude:i,longitude:s,zoom:a,bearing:o,pitch:A,altitude:f,maxZoom:_,minZoom:x,maxPitch:B,minPitch:P,normalize:ft,position:m},{startPanLngLat:M,startZoomLngLat:k,startRotatePos:Q,startBearing:q,startPitch:J,startZoom:tt}),$(this,"makeViewport",void 0),this.makeViewport=t.makeViewport}panStart(t){let{pos:e}=t;return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan(t){let{pos:e,startPos:n}=t;const i=this.getState().startPanLngLat||this._unproject(n);if(!i)return this;const a=this.makeViewport(this.getViewportProps()).panByPosition(i,e);return this._getUpdatedState(a)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart(t){let{pos:e}=t;return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate(t){let{pos:e,deltaAngleX:n=0,deltaAngleY:i=0}=t;const{startRotatePos:s,startBearing:a,startPitch:o}=this.getState();if(!s||a===void 0||o===void 0)return this;let A;return e?A=this._getNewRotation(e,s,o,a):A={bearing:a+n,pitch:o+i},this._getUpdatedState(A)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart(t){let{pos:e}=t;return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom(t){let{pos:e,startPos:n,scale:i}=t,{startZoom:s,startZoomLngLat:a}=this.getState();if(a||(s=this.getViewportProps().zoom,a=this._unproject(n)||this._unproject(e)),!a)return this;const{maxZoom:o,minZoom:A}=this.getViewportProps();let f=s+Math.log2(i);f=Uu(f,A,o);const m=this.makeViewport({...this.getViewportProps(),zoom:f});return this._getUpdatedState({zoom:f,...m.panByPosition(a,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2;return this._zoomFromCenter(t)}zoomOut(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2;return this._zoomFromCenter(1/t)}moveLeft(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([t,0])}moveRight(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([-t,0])}moveUp(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([0,t])}moveDown(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([0,-t])}rotateLeft(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:15;return this._getUpdatedState({bearing:this.getViewportProps().bearing-t})}rotateRight(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:15;return this._getUpdatedState({bearing:this.getViewportProps().bearing+t})}rotateUp(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;return this._getUpdatedState({pitch:this.getViewportProps().pitch+t})}rotateDown(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;return this._getUpdatedState({pitch:this.getViewportProps().pitch-t})}shortestPathFrom(t){const e=t.getViewportProps(),n={...this.getViewportProps()},{bearing:i,longitude:s}=n;return Math.abs(i-e.bearing)>180&&(n.bearing=i<0?i+360:i-360),Math.abs(s-e.longitude)>180&&(n.longitude=s<0?s+360:s-360),n}applyConstraints(t){const{maxZoom:e,minZoom:n,zoom:i}=t;t.zoom=Uu(i,n,e);const{maxPitch:s,minPitch:a,pitch:o}=t;t.pitch=Uu(o,a,s);const{normalize:A=!0}=t;return A&&Object.assign(t,Uq(t)),t}_zoomFromCenter(t){const{width:e,height:n}=this.getViewportProps();return this.zoom({pos:[e/2,n/2],scale:t})}_panFromCenter(t){const{width:e,height:n}=this.getViewportProps();return this.pan({startPos:[e/2,n/2],pos:[e/2+t[0],n/2+t[1]]})}_getUpdatedState(t){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...t})}_unproject(t){const e=this.makeViewport(this.getViewportProps());return t&&e.unproject(t)}_getNewRotation(t,e,n,i){const s=t[0]-e[0],a=t[1]-e[1],o=t[1],A=e[1],{width:f,height:m}=this.getViewportProps(),_=s/f;let x=0;a>0?Math.abs(m-A)>Y3&&(x=a/(A-m)*SK):a<0&&A>Y3&&(x=1-o/A),x=Uu(x,-1,1);const{minPitch:B,maxPitch:P}=this.getViewportProps(),M=i+180*_;let k=n;return x>0?k=n+x*(P-n):x<0&&(k=n-x*(B-n)),{pitch:k,bearing:M}}}class IK extends CK{constructor(){super(...arguments),$(this,"ControllerState",TK),$(this,"transition",{transitionDuration:300,transitionInterpolator:new J3({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})}),$(this,"dragMode","pan")}setProps(t){t.position=t.position||[0,0,0];const e=this.props;super.setProps(t),(!e||e.height!==t.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...t,...this.state}))}}class ow extends mK{get ViewportType(){return Qh}get ControllerType(){return IK}}$(ow,"displayName","MapView");const LK=new Zb;function FK(r,t){var e,n;const i=(e=r.order)!==null&&e!==void 0?e:1/0,s=(n=t.order)!==null&&n!==void 0?n:1/0;return i-s}class PK{constructor(){$(this,"effects",void 0),$(this,"_resolvedEffects",[]),$(this,"_defaultEffects",[]),$(this,"_needsRedraw",void 0),this.effects=[],this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(t){const e=this._defaultEffects;if(!e.find(n=>n.id===t.id)){const n=e.findIndex(i=>FK(i,t)>0);n<0?e.push(t):e.splice(n,0,t),this._setEffects(this.effects)}}setProps(t){"effects"in t&&(zl(t.effects,this.effects,1)||this._setEffects(t.effects))}needsRedraw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};const e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}getEffects(){return this._resolvedEffects}_setEffects(t){const e={};for(const i of this.effects)e[i.id]=i;const n=[];for(const i of t){const s=e[i.id];s&&s!==i?s.setProps?(s.setProps(i.props),n.push(s)):(s.cleanup(),n.push(i)):n.push(i),delete e[i.id]}for(const i in e)e[i].cleanup();this.effects=n,this._resolvedEffects=n.concat(this._defaultEffects),t.some(i=>i instanceof Zb)||this._resolvedEffects.push(LK),this._needsRedraw="effects changed"}finalize(){for(const t of this._resolvedEffects)t.cleanup();this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class MK extends jb{shouldDrawLayer(t){const{operation:e}=t.props;return e.includes("draw")||e.includes("terrain")}}const UK="deckRenderer.renderLayers";class RK{constructor(t){$(this,"gl",void 0),$(this,"layerFilter",void 0),$(this,"drawPickingColors",void 0),$(this,"drawLayersPass",void 0),$(this,"pickLayersPass",void 0),$(this,"renderCount",void 0),$(this,"_needsRedraw",void 0),$(this,"renderBuffers",void 0),$(this,"lastPostProcessEffect",void 0),this.gl=t,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new MK(t),this.pickLayersPass=new $3(t),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(t){this.layerFilter!==t.layerFilter&&(this.layerFilter=t.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==t.drawPickingColors&&(this.drawPickingColors=t.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(t){if(!t.viewports.length)return;const e=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,n={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...t,target:t.target||xs.getDefaultFramebuffer(this.gl)};n.effects&&this._preRender(n.effects,n);const i=this.lastPostProcessEffect?this.renderBuffers[0]:n.target,s=e.render({...n,target:i});n.effects&&this._postRender(n.effects,n),this.renderCount++,lo(UK,this,s,t)}needsRedraw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};const e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}finalize(){const{renderBuffers:t}=this;for(const e of t)e.delete();t.length=0}_preRender(t,e){this.lastPostProcessEffect=null,e.preRenderStats=e.preRenderStats||{};for(const n of t)e.preRenderStats[n.id]=n.preRender(this.gl,e),n.postRender&&(this.lastPostProcessEffect=n.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:t}=this;t.length===0&&t.push(new xs(this.gl),new xs(this.gl));for(const e of t)e.resize()}_postRender(t,e){const{renderBuffers:n}=this,i={...e,inputBuffer:n[0],swapBuffer:n[1],target:null};for(const s of t)if(s.postRender){if(s.id===this.lastPostProcessEffect){i.target=e.target,s.postRender(this.gl,i);break}const a=s.postRender(this.gl,i);i.inputBuffer=a,i.swapBuffer=a===n[0]?n[1]:n[0]}}}const OK={pickedColor:null,pickedObjectIndex:-1};function DK(r){let{pickedColors:t,decodePickingColor:e,deviceX:n,deviceY:i,deviceRadius:s,deviceRect:a}=r;const{x:o,y:A,width:f,height:m}=a;let _=s*s,x=-1,B=0;for(let P=0;P<m;P++){const M=P+A-i,k=M*M;if(k>_)B+=4*f;else for(let Q=0;Q<f;Q++){if(t[B+3]-1>=0){const J=Q+o-n,tt=J*J+k;tt<=_&&(_=tt,x=B)}B+=4}}if(x>=0){const P=t.slice(x,x+4),M=e(P);if(M){const k=Math.floor(x/4/f),Q=x/4-k*f;return{...M,pickedColor:P,pickedX:o+Q,pickedY:A+k}}Pn.error("Picked non-existent layer. Is picking buffer corrupt?")()}return OK}function NK(r){let{pickedColors:t,decodePickingColor:e}=r;const n=new Map;if(t){for(let i=0;i<t.length;i+=4)if(t[i+3]-1>=0){const a=t.slice(i,i+4),o=a.join(",");if(!n.has(o)){const A=e(a);A?n.set(o,{...A,color:a}):Pn.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(n.values())}function Z3(r){let{pickInfo:t,viewports:e,pixelRatio:n,x:i,y:s,z:a}=r,o=e[0];e.length>1&&(o=QK((t==null?void 0:t.pickedViewports)||e,{x:i,y:s}));let A;if(o){const f=[i-o.x,s-o.y];a!==void 0&&(f[2]=a),A=o.unproject(f)}return{color:null,layer:null,viewport:o,index:-1,picked:!1,x:i,y:s,pixel:[i,s],coordinate:A,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:n}}function kK(r){const{pickInfo:t,lastPickedInfo:e,mode:n,layers:i}=r,{pickedColor:s,pickedLayer:a,pickedObjectIndex:o}=t,A=a?[a]:[];if(n==="hover"){const _=e.index,x=e.layerId,B=a?a.props.id:null;if(B!==x||o!==_){if(B!==x){const P=i.find(M=>M.props.id===x);P&&A.unshift(P)}e.layerId=B,e.index=o,e.info=null}}const f=Z3(r),m=new Map;return m.set(null,f),A.forEach(_=>{let x={...f};_===a&&(x.color=s,x.index=o,x.picked=!0),x=tI({layer:_,info:x,mode:n});const B=x.layer;_===a&&n==="hover"&&(e.info=x),m.set(B.id,x),n==="hover"&&B.updateAutoHighlight(x)}),m}function tI(r){let{layer:t,info:e,mode:n}=r;for(;t&&e;){const i=e.layer||null;e.sourceLayer=i,e.layer=t,e=t.getPickingInfo({info:e,mode:n,sourceLayer:i}),t=t.parent}return e}function QK(r,t){for(let e=r.length-1;e>=0;e--){const n=r[e];if(n.containsPixel(t))return n}return r[0]}class HK{constructor(t){$(this,"gl",void 0),$(this,"pickingFBO",void 0),$(this,"depthFBO",void 0),$(this,"pickLayersPass",void 0),$(this,"layerFilter",void 0),$(this,"lastPickedInfo",void 0),$(this,"_pickable",!0),this.gl=t,this.pickLayersPass=new $3(t),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(t){"layerFilter"in t&&(this.layerFilter=t.layerFilter),"_pickable"in t&&(this._pickable=t._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.delete(),this.depthFBO&&(this.depthFBO.color.delete(),this.depthFBO.delete())}pickObject(t){return this._pickClosestObject(t)}pickObjects(t){return this._pickVisibleObjects(t)}getLastPickedObject(t){let{x:e,y:n,layers:i,viewports:s}=t,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.lastPickedInfo.info;const o=a&&a.layer&&a.layer.id,A=a&&a.viewport&&a.viewport.id,f=o?i.find(B=>B.id===o):null,m=A&&s.find(B=>B.id===A)||s[0],_=m&&m.unproject([e-m.x,n-m.y]);return{...a,...{x:e,y:n,viewport:m,coordinate:_,layer:f}}}_resizeBuffer(){var t,e;const{gl:n}=this;if(!this.pickingFBO&&(this.pickingFBO=new xs(n),xs.isSupported(n,{colorBufferFloat:!0}))){const i=new xs(n);i.attach({36064:new Fa(n,{format:gn(n)?34836:6408,type:5126})}),this.depthFBO=i}(t=this.pickingFBO)===null||t===void 0||t.resize({width:n.canvas.width,height:n.canvas.height}),(e=this.depthFBO)===null||e===void 0||e.resize({width:n.canvas.width,height:n.canvas.height})}_getPickable(t){if(this._pickable===!1)return null;const e=t.filter(n=>this.pickLayersPass.shouldDrawLayer(n)&&!n.isComposite);return e.length?e:null}_pickClosestObject(t){let{layers:e,views:n,viewports:i,x:s,y:a,radius:o=0,depth:A=1,mode:f="query",unproject3D:m,onViewportActive:_,effects:x}=t;const B=this._getPickable(e),P=Kd(this.gl);if(!B)return{result:[],emptyInfo:Z3({viewports:i,x:s,y:a,pixelRatio:P})};this._resizeBuffer();const M=rb(this.gl,[s,a],!0),k=[M.x+Math.floor(M.width/2),M.y+Math.floor(M.height/2)],Q=Math.round(o*P),{width:q,height:J}=this.pickingFBO,tt=this._getPickingRect({deviceX:k[0],deviceY:k[1],deviceRadius:Q,deviceWidth:q,deviceHeight:J}),ft={x:s-o,y:a-o,width:o*2+1,height:o*2+1};let pt;const mt=[],dt=new Set;for(let Rt=0;Rt<A;Rt++){let Lt;if(tt){const ct=this._drawAndSample({layers:B,views:n,viewports:i,onViewportActive:_,deviceRect:tt,cullRect:ft,effects:x,pass:"picking:".concat(f)});Lt=DK({...ct,deviceX:k[0],deviceY:k[1],deviceRadius:Q,deviceRect:tt})}else Lt={pickedColor:null,pickedObjectIndex:-1};let st;if(Lt.pickedLayer&&m&&this.depthFBO){const{pickedColors:ct}=this._drawAndSample({layers:[Lt.pickedLayer],views:n,viewports:i,onViewportActive:_,deviceRect:{x:Lt.pickedX,y:Lt.pickedY,width:1,height:1},cullRect:ft,effects:x,pass:"picking:".concat(f,":z")},!0);ct[3]&&(st=ct[0])}Lt.pickedLayer&&Rt+1<A&&(dt.add(Lt.pickedLayer),Lt.pickedLayer.disablePickingIndex(Lt.pickedObjectIndex)),pt=kK({pickInfo:Lt,lastPickedInfo:this.lastPickedInfo,mode:f,layers:B,viewports:i,x:s,y:a,z:st,pixelRatio:P});for(const ct of pt.values())ct.layer&&mt.push(ct);if(!Lt.pickedColor)break}for(const Rt of dt)Rt.restorePickingColors();return{result:mt,emptyInfo:pt.get(null)}}_pickVisibleObjects(t){let{layers:e,views:n,viewports:i,x:s,y:a,width:o=1,height:A=1,mode:f="query",maxObjects:m=null,onViewportActive:_,effects:x}=t;const B=this._getPickable(e);if(!B)return[];this._resizeBuffer();const P=Kd(this.gl),M=rb(this.gl,[s,a],!0),k=M.x,Q=M.y+M.height,q=rb(this.gl,[s+o,a+A],!0),J=q.x+q.width,tt=q.y,ft={x:k,y:tt,width:J-k,height:Q-tt},pt=this._drawAndSample({layers:B,views:n,viewports:i,onViewportActive:_,deviceRect:ft,cullRect:{x:s,y:a,width:o,height:A},effects:x,pass:"picking:".concat(f)}),mt=NK(pt),dt=new Map,Rt=Number.isFinite(m);for(let st=0;st<mt.length;st++){var Lt;if(Rt&&m&&dt.size>=m)break;const ct=mt[st];let wt={color:ct.pickedColor,layer:null,index:ct.pickedObjectIndex,picked:!0,x:s,y:a,pixelRatio:P};wt=tI({layer:ct.pickedLayer,info:wt,mode:f});const yt=(Lt=wt.object)!==null&&Lt!==void 0?Lt:"".concat(wt.layer.id,"[").concat(wt.index,"]");dt.has(yt)||dt.set(yt,wt)}return Array.from(dt.values())}_drawAndSample(t){let{layers:e,views:n,viewports:i,onViewportActive:s,deviceRect:a,cullRect:o,effects:A,pass:f}=t,m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const _=m?this.depthFBO:this.pickingFBO,x={layers:e,layerFilter:this.layerFilter,views:n,viewports:i,onViewportActive:s,pickingFBO:_,deviceRect:a,cullRect:o,effects:A,pass:f,pickZ:m,preRenderStats:{}};for(const J of A)J.useInPicking&&(x.preRenderStats[J.id]=J.preRender(this.gl,x));const{decodePickingColor:B}=this.pickLayersPass.render(x),{x:P,y:M,width:k,height:Q}=a,q=new(m?Float32Array:Uint8Array)(k*Q*4);return b0(_,{sourceX:P,sourceY:M,sourceWidth:k,sourceHeight:Q,target:q}),{pickedColors:q,decodePickingColor:B}}_getPickingRect(t){let{deviceX:e,deviceY:n,deviceRadius:i,deviceWidth:s,deviceHeight:a}=t;const o=Math.max(0,e-i),A=Math.max(0,n-i),f=Math.min(s,e+i+1)-o,m=Math.min(a,n+i+1)-A;return f<=0||m<=0?null:{x:o,y:A,width:f,height:m}}}const zK={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class GK{constructor(t){$(this,"el",null),$(this,"isVisible",!1);const e=t.parentElement;e&&(this.el=document.createElement("div"),this.el.className="deck-tooltip",Object.assign(this.el.style,zK),e.appendChild(this.el))}setTooltip(t,e,n){const i=this.el;if(i){if(typeof t=="string")i.innerText=t;else if(t)t.text&&(i.innerText=t.text),t.html&&(i.innerHTML=t.html),t.className&&(i.className=t.className);else{this.isVisible=!1,i.style.display="none";return}this.isVisible=!0,i.style.display="block",i.style.transform="translate(".concat(e,"px, ").concat(n,"px)"),t&&typeof t=="object"&&"style"in t&&Object.assign(i.style,t.style)}}remove(){this.el&&(this.el.remove(),this.el=null)}}var eI={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(r){(function(t,e,n,i){var s=["","webkit","Moz","MS","ms","o"],a=e.createElement("div"),o="function",A=Math.round,f=Math.abs,m=Date.now;function _(At,xt,Qt){return setTimeout(J(At,Qt),xt)}function x(At,xt,Qt){return Array.isArray(At)?(B(At,Qt[xt],Qt),!0):!1}function B(At,xt,Qt){var he;if(At)if(At.forEach)At.forEach(xt,Qt);else if(At.length!==i)for(he=0;he<At.length;)xt.call(Qt,At[he],he,At),he++;else for(he in At)At.hasOwnProperty(he)&&xt.call(Qt,At[he],he,At)}function P(At,xt,Qt){var he="DEPRECATED METHOD: "+xt+`
`+Qt+` AT 
`;return function(){var Pe=new Error("get-stack-trace"),sr=Pe&&Pe.stack?Pe.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",zr=t.console&&(t.console.warn||t.console.log);return zr&&zr.call(t.console,he,sr),At.apply(this,arguments)}}var M;typeof Object.assign!="function"?M=function(xt){if(xt===i||xt===null)throw new TypeError("Cannot convert undefined or null to object");for(var Qt=Object(xt),he=1;he<arguments.length;he++){var Pe=arguments[he];if(Pe!==i&&Pe!==null)for(var sr in Pe)Pe.hasOwnProperty(sr)&&(Qt[sr]=Pe[sr])}return Qt}:M=Object.assign;var k=P(function(xt,Qt,he){for(var Pe=Object.keys(Qt),sr=0;sr<Pe.length;)(!he||he&&xt[Pe[sr]]===i)&&(xt[Pe[sr]]=Qt[Pe[sr]]),sr++;return xt},"extend","Use `assign`."),Q=P(function(xt,Qt){return k(xt,Qt,!0)},"merge","Use `assign`.");function q(At,xt,Qt){var he=xt.prototype,Pe;Pe=At.prototype=Object.create(he),Pe.constructor=At,Pe._super=he,Qt&&M(Pe,Qt)}function J(At,xt){return function(){return At.apply(xt,arguments)}}function tt(At,xt){return typeof At==o?At.apply(xt&&xt[0]||i,xt):At}function ft(At,xt){return At===i?xt:At}function pt(At,xt,Qt){B(Lt(xt),function(he){At.addEventListener(he,Qt,!1)})}function mt(At,xt,Qt){B(Lt(xt),function(he){At.removeEventListener(he,Qt,!1)})}function dt(At,xt){for(;At;){if(At==xt)return!0;At=At.parentNode}return!1}function Rt(At,xt){return At.indexOf(xt)>-1}function Lt(At){return At.trim().split(/\s+/g)}function st(At,xt,Qt){if(At.indexOf&&!Qt)return At.indexOf(xt);for(var he=0;he<At.length;){if(Qt&&At[he][Qt]==xt||!Qt&&At[he]===xt)return he;he++}return-1}function ct(At){return Array.prototype.slice.call(At,0)}function wt(At,xt,Qt){for(var he=[],Pe=[],sr=0;sr<At.length;){var zr=xt?At[sr][xt]:At[sr];st(Pe,zr)<0&&he.push(At[sr]),Pe[sr]=zr,sr++}return Qt&&(xt?he=he.sort(function(ti,Ai){return ti[xt]>Ai[xt]}):he=he.sort()),he}function yt(At,xt){for(var Qt,he,Pe=xt[0].toUpperCase()+xt.slice(1),sr=0;sr<s.length;){if(Qt=s[sr],he=Qt?Qt+Pe:xt,he in At)return he;sr++}return i}var te=1;function Zt(){return te++}function re(At){var xt=At.ownerDocument||At;return xt.defaultView||xt.parentWindow||t}var Xt=/mobile|tablet|ip(ad|hone|od)|android/i,ne="ontouchstart"in t,se=yt(t,"PointerEvent")!==i,we=ne&&Xt.test(navigator.userAgent),it="touch",vt="pen",Ft="mouse",Ot="kinect",$t=25,jt=1,ae=2,ie=4,Be=8,Ie=1,Qe=2,He=4,ze=8,ge=16,Ut=Qe|He,Jt=ze|ge,er=Ut|Jt,Se=["x","y"],_e=["clientX","clientY"];function xe(At,xt){var Qt=this;this.manager=At,this.callback=xt,this.element=At.element,this.target=At.options.inputTarget,this.domHandler=function(he){tt(At.options.enable,[At])&&Qt.handler(he)},this.init()}xe.prototype={handler:function(){},init:function(){this.evEl&&pt(this.element,this.evEl,this.domHandler),this.evTarget&&pt(this.target,this.evTarget,this.domHandler),this.evWin&&pt(re(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&mt(this.element,this.evEl,this.domHandler),this.evTarget&&mt(this.target,this.evTarget,this.domHandler),this.evWin&&mt(re(this.element),this.evWin,this.domHandler)}};function Ne(At){var xt,Qt=At.options.inputClass;return Qt?xt=Qt:se?xt=Z:we?xt=Yt:ne?xt=Ve:xt=Or,new xt(At,ir)}function ir(At,xt,Qt){var he=Qt.pointers.length,Pe=Qt.changedPointers.length,sr=xt&jt&&he-Pe===0,zr=xt&(ie|Be)&&he-Pe===0;Qt.isFirst=!!sr,Qt.isFinal=!!zr,sr&&(At.session={}),Qt.eventType=xt,Ar(At,Qt),At.emit("hammer.input",Qt),At.recognize(Qt),At.session.prevInput=Qt}function Ar(At,xt){var Qt=At.session,he=xt.pointers,Pe=he.length;Qt.firstInput||(Qt.firstInput=Nr(xt)),Pe>1&&!Qt.firstMultiple?Qt.firstMultiple=Nr(xt):Pe===1&&(Qt.firstMultiple=!1);var sr=Qt.firstInput,zr=Qt.firstMultiple,Wn=zr?zr.center:sr.center,ti=xt.center=Qr(he);xt.timeStamp=m(),xt.deltaTime=xt.timeStamp-sr.timeStamp,xt.angle=xn(Wn,ti),xt.distance=De(Wn,ti),Lr(Qt,xt),xt.offsetDirection=Ir(xt.deltaX,xt.deltaY);var Ai=fe(xt.deltaTime,xt.deltaX,xt.deltaY);xt.overallVelocityX=Ai.x,xt.overallVelocityY=Ai.y,xt.overallVelocity=f(Ai.x)>f(Ai.y)?Ai.x:Ai.y,xt.scale=zr?Te(zr.pointers,he):1,xt.rotation=zr?Pr(zr.pointers,he):0,xt.maxPointers=Qt.prevInput?xt.pointers.length>Qt.prevInput.maxPointers?xt.pointers.length:Qt.prevInput.maxPointers:xt.pointers.length,Tr(Qt,xt);var Hn=At.element;dt(xt.srcEvent.target,Hn)&&(Hn=xt.srcEvent.target),xt.target=Hn}function Lr(At,xt){var Qt=xt.center,he=At.offsetDelta||{},Pe=At.prevDelta||{},sr=At.prevInput||{};(xt.eventType===jt||sr.eventType===ie)&&(Pe=At.prevDelta={x:sr.deltaX||0,y:sr.deltaY||0},he=At.offsetDelta={x:Qt.x,y:Qt.y}),xt.deltaX=Pe.x+(Qt.x-he.x),xt.deltaY=Pe.y+(Qt.y-he.y)}function Tr(At,xt){var Qt=At.lastInterval||xt,he=xt.timeStamp-Qt.timeStamp,Pe,sr,zr,Wn;if(xt.eventType!=Be&&(he>$t||Qt.velocity===i)){var ti=xt.deltaX-Qt.deltaX,Ai=xt.deltaY-Qt.deltaY,Hn=fe(he,ti,Ai);sr=Hn.x,zr=Hn.y,Pe=f(Hn.x)>f(Hn.y)?Hn.x:Hn.y,Wn=Ir(ti,Ai),At.lastInterval=xt}else Pe=Qt.velocity,sr=Qt.velocityX,zr=Qt.velocityY,Wn=Qt.direction;xt.velocity=Pe,xt.velocityX=sr,xt.velocityY=zr,xt.direction=Wn}function Nr(At){for(var xt=[],Qt=0;Qt<At.pointers.length;)xt[Qt]={clientX:A(At.pointers[Qt].clientX),clientY:A(At.pointers[Qt].clientY)},Qt++;return{timeStamp:m(),pointers:xt,center:Qr(xt),deltaX:At.deltaX,deltaY:At.deltaY}}function Qr(At){var xt=At.length;if(xt===1)return{x:A(At[0].clientX),y:A(At[0].clientY)};for(var Qt=0,he=0,Pe=0;Pe<xt;)Qt+=At[Pe].clientX,he+=At[Pe].clientY,Pe++;return{x:A(Qt/xt),y:A(he/xt)}}function fe(At,xt,Qt){return{x:xt/At||0,y:Qt/At||0}}function Ir(At,xt){return At===xt?Ie:f(At)>=f(xt)?At<0?Qe:He:xt<0?ze:ge}function De(At,xt,Qt){Qt||(Qt=Se);var he=xt[Qt[0]]-At[Qt[0]],Pe=xt[Qt[1]]-At[Qt[1]];return Math.sqrt(he*he+Pe*Pe)}function xn(At,xt,Qt){Qt||(Qt=Se);var he=xt[Qt[0]]-At[Qt[0]],Pe=xt[Qt[1]]-At[Qt[1]];return Math.atan2(Pe,he)*180/Math.PI}function Pr(At,xt){return xn(xt[1],xt[0],_e)+xn(At[1],At[0],_e)}function Te(At,xt){return De(xt[0],xt[1],_e)/De(At[0],At[1],_e)}var Je={mousedown:jt,mousemove:ae,mouseup:ie},Ke="mousedown",Yr="mousemove mouseup";function Or(){this.evEl=Ke,this.evWin=Yr,this.pressed=!1,xe.apply(this,arguments)}q(Or,xe,{handler:function(xt){var Qt=Je[xt.type];Qt&jt&&xt.button===0&&(this.pressed=!0),Qt&ae&&xt.which!==1&&(Qt=ie),this.pressed&&(Qt&ie&&(this.pressed=!1),this.callback(this.manager,Qt,{pointers:[xt],changedPointers:[xt],pointerType:Ft,srcEvent:xt}))}});var gr={pointerdown:jt,pointermove:ae,pointerup:ie,pointercancel:Be,pointerout:Be},an={2:it,3:vt,4:Ft,5:Ot},$r="pointerdown",Ct="pointermove pointerup pointercancel";t.MSPointerEvent&&!t.PointerEvent&&($r="MSPointerDown",Ct="MSPointerMove MSPointerUp MSPointerCancel");function Z(){this.evEl=$r,this.evWin=Ct,xe.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}q(Z,xe,{handler:function(xt){var Qt=this.store,he=!1,Pe=xt.type.toLowerCase().replace("ms",""),sr=gr[Pe],zr=an[xt.pointerType]||xt.pointerType,Wn=zr==it,ti=st(Qt,xt.pointerId,"pointerId");sr&jt&&(xt.button===0||Wn)?ti<0&&(Qt.push(xt),ti=Qt.length-1):sr&(ie|Be)&&(he=!0),!(ti<0)&&(Qt[ti]=xt,this.callback(this.manager,sr,{pointers:Qt,changedPointers:[xt],pointerType:zr,srcEvent:xt}),he&&Qt.splice(ti,1))}});var Y={touchstart:jt,touchmove:ae,touchend:ie,touchcancel:Be},ot="touchstart",Et="touchstart touchmove touchend touchcancel";function kt(){this.evTarget=ot,this.evWin=Et,this.started=!1,xe.apply(this,arguments)}q(kt,xe,{handler:function(xt){var Qt=Y[xt.type];if(Qt===jt&&(this.started=!0),!!this.started){var he=zt.call(this,xt,Qt);Qt&(ie|Be)&&he[0].length-he[1].length===0&&(this.started=!1),this.callback(this.manager,Qt,{pointers:he[0],changedPointers:he[1],pointerType:it,srcEvent:xt})}}});function zt(At,xt){var Qt=ct(At.touches),he=ct(At.changedTouches);return xt&(ie|Be)&&(Qt=wt(Qt.concat(he),"identifier",!0)),[Qt,he]}var qt={touchstart:jt,touchmove:ae,touchend:ie,touchcancel:Be},St="touchstart touchmove touchend touchcancel";function Yt(){this.evTarget=St,this.targetIds={},xe.apply(this,arguments)}q(Yt,xe,{handler:function(xt){var Qt=qt[xt.type],he=me.call(this,xt,Qt);he&&this.callback(this.manager,Qt,{pointers:he[0],changedPointers:he[1],pointerType:it,srcEvent:xt})}});function me(At,xt){var Qt=ct(At.touches),he=this.targetIds;if(xt&(jt|ae)&&Qt.length===1)return he[Qt[0].identifier]=!0,[Qt,Qt];var Pe,sr,zr=ct(At.changedTouches),Wn=[],ti=this.target;if(sr=Qt.filter(function(Ai){return dt(Ai.target,ti)}),xt===jt)for(Pe=0;Pe<sr.length;)he[sr[Pe].identifier]=!0,Pe++;for(Pe=0;Pe<zr.length;)he[zr[Pe].identifier]&&Wn.push(zr[Pe]),xt&(ie|Be)&&delete he[zr[Pe].identifier],Pe++;if(Wn.length)return[wt(sr.concat(Wn),"identifier",!0),Wn]}var pe=2500,de=25;function Ve(){xe.apply(this,arguments);var At=J(this.handler,this);this.touch=new Yt(this.manager,At),this.mouse=new Or(this.manager,At),this.primaryTouch=null,this.lastTouches=[]}q(Ve,xe,{handler:function(xt,Qt,he){var Pe=he.pointerType==it,sr=he.pointerType==Ft;if(!(sr&&he.sourceCapabilities&&he.sourceCapabilities.firesTouchEvents)){if(Pe)Ye.call(this,Qt,he);else if(sr&&lr.call(this,he))return;this.callback(xt,Qt,he)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function Ye(At,xt){At&jt?(this.primaryTouch=xt.changedPointers[0].identifier,Er.call(this,xt)):At&(ie|Be)&&Er.call(this,xt)}function Er(At){var xt=At.changedPointers[0];if(xt.identifier===this.primaryTouch){var Qt={x:xt.clientX,y:xt.clientY};this.lastTouches.push(Qt);var he=this.lastTouches,Pe=function(){var sr=he.indexOf(Qt);sr>-1&&he.splice(sr,1)};setTimeout(Pe,pe)}}function lr(At){for(var xt=At.srcEvent.clientX,Qt=At.srcEvent.clientY,he=0;he<this.lastTouches.length;he++){var Pe=this.lastTouches[he],sr=Math.abs(xt-Pe.x),zr=Math.abs(Qt-Pe.y);if(sr<=de&&zr<=de)return!0}return!1}var Ur=yt(a.style,"touchAction"),kr=Ur!==i,Hr="compute",mn="auto",mr="manipulation",Wr="none",bn="pan-x",Qn="pan-y",Dt=nn();function Re(At,xt){this.manager=At,this.set(xt)}Re.prototype={set:function(At){At==Hr&&(At=this.compute()),kr&&this.manager.element.style&&Dt[At]&&(this.manager.element.style[Ur]=At),this.actions=At.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var At=[];return B(this.manager.recognizers,function(xt){tt(xt.options.enable,[xt])&&(At=At.concat(xt.getTouchAction()))}),Le(At.join(" "))},preventDefaults:function(At){var xt=At.srcEvent,Qt=At.offsetDirection;if(this.manager.session.prevented){xt.preventDefault();return}var he=this.actions,Pe=Rt(he,Wr)&&!Dt[Wr],sr=Rt(he,Qn)&&!Dt[Qn],zr=Rt(he,bn)&&!Dt[bn];if(Pe){var Wn=At.pointers.length===1,ti=At.distance<2,Ai=At.deltaTime<250;if(Wn&&ti&&Ai)return}if(!(zr&&sr)&&(Pe||sr&&Qt&Ut||zr&&Qt&Jt))return this.preventSrc(xt)},preventSrc:function(At){this.manager.session.prevented=!0,At.preventDefault()}};function Le(At){if(Rt(At,Wr))return Wr;var xt=Rt(At,bn),Qt=Rt(At,Qn);return xt&&Qt?Wr:xt||Qt?xt?bn:Qn:Rt(At,mr)?mr:mn}function nn(){if(!kr)return!1;var At={},xt=t.CSS&&t.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(Qt){At[Qt]=xt?t.CSS.supports("touch-action",Qt):!0}),At}var Un=1,Br=2,yn=4,xi=8,_n=xi,sn=16,Bi=32;function Yn(At){this.options=M({},this.defaults,At||{}),this.id=Zt(),this.manager=null,this.options.enable=ft(this.options.enable,!0),this.state=Un,this.simultaneous={},this.requireFail=[]}Yn.prototype={defaults:{},set:function(At){return M(this.options,At),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(At){if(x(At,"recognizeWith",this))return this;var xt=this.simultaneous;return At=Vo(At,this),xt[At.id]||(xt[At.id]=At,At.recognizeWith(this)),this},dropRecognizeWith:function(At){return x(At,"dropRecognizeWith",this)?this:(At=Vo(At,this),delete this.simultaneous[At.id],this)},requireFailure:function(At){if(x(At,"requireFailure",this))return this;var xt=this.requireFail;return At=Vo(At,this),st(xt,At)===-1&&(xt.push(At),At.requireFailure(this)),this},dropRequireFailure:function(At){if(x(At,"dropRequireFailure",this))return this;At=Vo(At,this);var xt=st(this.requireFail,At);return xt>-1&&this.requireFail.splice(xt,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(At){return!!this.simultaneous[At.id]},emit:function(At){var xt=this,Qt=this.state;function he(Pe){xt.manager.emit(Pe,At)}Qt<xi&&he(xt.options.event+cs(Qt)),he(xt.options.event),At.additionalEvent&&he(At.additionalEvent),Qt>=xi&&he(xt.options.event+cs(Qt))},tryEmit:function(At){if(this.canEmit())return this.emit(At);this.state=Bi},canEmit:function(){for(var At=0;At<this.requireFail.length;){if(!(this.requireFail[At].state&(Bi|Un)))return!1;At++}return!0},recognize:function(At){var xt=M({},At);if(!tt(this.options.enable,[this,xt])){this.reset(),this.state=Bi;return}this.state&(_n|sn|Bi)&&(this.state=Un),this.state=this.process(xt),this.state&(Br|yn|xi|sn)&&this.tryEmit(xt)},process:function(At){},getTouchAction:function(){},reset:function(){}};function cs(At){return At&sn?"cancel":At&xi?"end":At&yn?"move":At&Br?"start":""}function Ns(At){return At==ge?"down":At==ze?"up":At==Qe?"left":At==He?"right":""}function Vo(At,xt){var Qt=xt.manager;return Qt?Qt.get(At):At}function Dr(){Yn.apply(this,arguments)}q(Dr,Yn,{defaults:{pointers:1},attrTest:function(At){var xt=this.options.pointers;return xt===0||At.pointers.length===xt},process:function(At){var xt=this.state,Qt=At.eventType,he=xt&(Br|yn),Pe=this.attrTest(At);return he&&(Qt&Be||!Pe)?xt|sn:he||Pe?Qt&ie?xt|xi:xt&Br?xt|yn:Br:Bi}});function Zs(){Dr.apply(this,arguments),this.pX=null,this.pY=null}q(Zs,Dr,{defaults:{event:"pan",threshold:10,pointers:1,direction:er},getTouchAction:function(){var At=this.options.direction,xt=[];return At&Ut&&xt.push(Qn),At&Jt&&xt.push(bn),xt},directionTest:function(At){var xt=this.options,Qt=!0,he=At.distance,Pe=At.direction,sr=At.deltaX,zr=At.deltaY;return Pe&xt.direction||(xt.direction&Ut?(Pe=sr===0?Ie:sr<0?Qe:He,Qt=sr!=this.pX,he=Math.abs(At.deltaX)):(Pe=zr===0?Ie:zr<0?ze:ge,Qt=zr!=this.pY,he=Math.abs(At.deltaY))),At.direction=Pe,Qt&&he>xt.threshold&&Pe&xt.direction},attrTest:function(At){return Dr.prototype.attrTest.call(this,At)&&(this.state&Br||!(this.state&Br)&&this.directionTest(At))},emit:function(At){this.pX=At.deltaX,this.pY=At.deltaY;var xt=Ns(At.direction);xt&&(At.additionalEvent=this.options.event+xt),this._super.emit.call(this,At)}});function Ss(){Dr.apply(this,arguments)}q(Ss,Dr,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Wr]},attrTest:function(At){return this._super.attrTest.call(this,At)&&(Math.abs(At.scale-1)>this.options.threshold||this.state&Br)},emit:function(At){if(At.scale!==1){var xt=At.scale<1?"in":"out";At.additionalEvent=this.options.event+xt}this._super.emit.call(this,At)}});function In(){Yn.apply(this,arguments),this._timer=null,this._input=null}q(In,Yn,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[mn]},process:function(At){var xt=this.options,Qt=At.pointers.length===xt.pointers,he=At.distance<xt.threshold,Pe=At.deltaTime>xt.time;if(this._input=At,!he||!Qt||At.eventType&(ie|Be)&&!Pe)this.reset();else if(At.eventType&jt)this.reset(),this._timer=_(function(){this.state=_n,this.tryEmit()},xt.time,this);else if(At.eventType&ie)return _n;return Bi},reset:function(){clearTimeout(this._timer)},emit:function(At){this.state===_n&&(At&&At.eventType&ie?this.manager.emit(this.options.event+"up",At):(this._input.timeStamp=m(),this.manager.emit(this.options.event,this._input)))}});function wo(){Dr.apply(this,arguments)}q(wo,Dr,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Wr]},attrTest:function(At){return this._super.attrTest.call(this,At)&&(Math.abs(At.rotation)>this.options.threshold||this.state&Br)}});function Mi(){Dr.apply(this,arguments)}q(Mi,Dr,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Ut|Jt,pointers:1},getTouchAction:function(){return Zs.prototype.getTouchAction.call(this)},attrTest:function(At){var xt=this.options.direction,Qt;return xt&(Ut|Jt)?Qt=At.overallVelocity:xt&Ut?Qt=At.overallVelocityX:xt&Jt&&(Qt=At.overallVelocityY),this._super.attrTest.call(this,At)&&xt&At.offsetDirection&&At.distance>this.options.threshold&&At.maxPointers==this.options.pointers&&f(Qt)>this.options.velocity&&At.eventType&ie},emit:function(At){var xt=Ns(At.offsetDirection);xt&&this.manager.emit(this.options.event+xt,At),this.manager.emit(this.options.event,At)}});function Ui(){Yn.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}q(Ui,Yn,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[mr]},process:function(At){var xt=this.options,Qt=At.pointers.length===xt.pointers,he=At.distance<xt.threshold,Pe=At.deltaTime<xt.time;if(this.reset(),At.eventType&jt&&this.count===0)return this.failTimeout();if(he&&Pe&&Qt){if(At.eventType!=ie)return this.failTimeout();var sr=this.pTime?At.timeStamp-this.pTime<xt.interval:!0,zr=!this.pCenter||De(this.pCenter,At.center)<xt.posThreshold;this.pTime=At.timeStamp,this.pCenter=At.center,!zr||!sr?this.count=1:this.count+=1,this._input=At;var Wn=this.count%xt.taps;if(Wn===0)return this.hasRequireFailures()?(this._timer=_(function(){this.state=_n,this.tryEmit()},xt.interval,this),Br):_n}return Bi},failTimeout:function(){return this._timer=_(function(){this.state=Bi},this.options.interval,this),Bi},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==_n&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Zn(At,xt){return xt=xt||{},xt.recognizers=ft(xt.recognizers,Zn.defaults.preset),new jo(At,xt)}Zn.VERSION="2.0.7",Zn.defaults={domEvents:!1,touchAction:Hr,enable:!0,inputTarget:null,inputClass:null,preset:[[wo,{enable:!1}],[Ss,{enable:!1},["rotate"]],[Mi,{direction:Ut}],[Zs,{direction:Ut},["swipe"]],[Ui],[Ui,{event:"doubletap",taps:2},["tap"]],[In]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Li=1,cn=2;function jo(At,xt){this.options=M({},Zn.defaults,xt||{}),this.options.inputTarget=this.options.inputTarget||At,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=At,this.input=Ne(this),this.touchAction=new Re(this,this.options.touchAction),qo(this,!0),B(this.options.recognizers,function(Qt){var he=this.add(new Qt[0](Qt[1]));Qt[2]&&he.recognizeWith(Qt[2]),Qt[3]&&he.requireFailure(Qt[3])},this)}jo.prototype={set:function(At){return M(this.options,At),At.touchAction&&this.touchAction.update(),At.inputTarget&&(this.input.destroy(),this.input.target=At.inputTarget,this.input.init()),this},stop:function(At){this.session.stopped=At?cn:Li},recognize:function(At){var xt=this.session;if(!xt.stopped){this.touchAction.preventDefaults(At);var Qt,he=this.recognizers,Pe=xt.curRecognizer;(!Pe||Pe&&Pe.state&_n)&&(Pe=xt.curRecognizer=null);for(var sr=0;sr<he.length;)Qt=he[sr],xt.stopped!==cn&&(!Pe||Qt==Pe||Qt.canRecognizeWith(Pe))?Qt.recognize(At):Qt.reset(),!Pe&&Qt.state&(Br|yn|xi)&&(Pe=xt.curRecognizer=Qt),sr++}},get:function(At){if(At instanceof Yn)return At;for(var xt=this.recognizers,Qt=0;Qt<xt.length;Qt++)if(xt[Qt].options.event==At)return xt[Qt];return null},add:function(At){if(x(At,"add",this))return this;var xt=this.get(At.options.event);return xt&&this.remove(xt),this.recognizers.push(At),At.manager=this,this.touchAction.update(),At},remove:function(At){if(x(At,"remove",this))return this;if(At=this.get(At),At){var xt=this.recognizers,Qt=st(xt,At);Qt!==-1&&(xt.splice(Qt,1),this.touchAction.update())}return this},on:function(At,xt){if(At!==i&&xt!==i){var Qt=this.handlers;return B(Lt(At),function(he){Qt[he]=Qt[he]||[],Qt[he].push(xt)}),this}},off:function(At,xt){if(At!==i){var Qt=this.handlers;return B(Lt(At),function(he){xt?Qt[he]&&Qt[he].splice(st(Qt[he],xt),1):delete Qt[he]}),this}},emit:function(At,xt){this.options.domEvents&&to(At,xt);var Qt=this.handlers[At]&&this.handlers[At].slice();if(!(!Qt||!Qt.length)){xt.type=At,xt.preventDefault=function(){xt.srcEvent.preventDefault()};for(var he=0;he<Qt.length;)Qt[he](xt),he++}},destroy:function(){this.element&&qo(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function qo(At,xt){var Qt=At.element;if(Qt.style){var he;B(At.options.cssProps,function(Pe,sr){he=yt(Qt.style,sr),xt?(At.oldCssProps[he]=Qt.style[he],Qt.style[he]=Pe):Qt.style[he]=At.oldCssProps[he]||""}),xt||(At.oldCssProps={})}}function to(At,xt){var Qt=e.createEvent("Event");Qt.initEvent(At,!0,!0),Qt.gesture=xt,xt.target.dispatchEvent(Qt)}M(Zn,{INPUT_START:jt,INPUT_MOVE:ae,INPUT_END:ie,INPUT_CANCEL:Be,STATE_POSSIBLE:Un,STATE_BEGAN:Br,STATE_CHANGED:yn,STATE_ENDED:xi,STATE_RECOGNIZED:_n,STATE_CANCELLED:sn,STATE_FAILED:Bi,DIRECTION_NONE:Ie,DIRECTION_LEFT:Qe,DIRECTION_RIGHT:He,DIRECTION_UP:ze,DIRECTION_DOWN:ge,DIRECTION_HORIZONTAL:Ut,DIRECTION_VERTICAL:Jt,DIRECTION_ALL:er,Manager:jo,Input:xe,TouchAction:Re,TouchInput:Yt,MouseInput:Or,PointerEventInput:Z,TouchMouseInput:Ve,SingleTouchInput:kt,Recognizer:Yn,AttrRecognizer:Dr,Tap:Ui,Pan:Zs,Swipe:Mi,Pinch:Ss,Rotate:wo,Press:In,on:pt,off:mt,each:B,merge:Q,extend:k,assign:M,inherit:q,bindFn:J,prefixed:yt});var mc=typeof t<"u"?t:typeof self<"u"?self:{};mc.Hammer=Zn,typeof i=="function"&&i.amd?i(function(){return Zn}):r.exports?r.exports=Zn:t[n]=Zn})(window,document,"Hammer")})(eI);var _g=eI.exports;const Gl=Pp({__proto__:null,default:Mp(_g)},[_g]),rI=1,nI=2,aw=4,VK={mousedown:rI,mousemove:nI,mouseup:aw};function jK(r,t){for(let e=0;e<r.length;e++)if(t(r[e]))return!0;return!1}function qK(r){const t=r.prototype.handler;r.prototype.handler=function(n){const i=this.store;n.button>0&&n.type==="pointerdown"&&(jK(i,s=>s.pointerId===n.pointerId)||i.push(n)),t.call(this,n)}}function KK(r){r.prototype.handler=function(e){let n=VK[e.type];n&rI&&e.button>=0&&(this.pressed=!0),n&nI&&e.which===0&&(n=aw),this.pressed&&(n&aw&&(this.pressed=!1),this.callback(this.manager,n,{pointers:[e],changedPointers:[e],pointerType:"mouse",srcEvent:e}))}}qK(_g.PointerEventInput),KK(_g.MouseInput);const $K=_g.Manager;class W0{constructor(t,e,n){this.element=t,this.callback=e,this.options={enable:!0,...n}}}const WK=Gl?[[Gl.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[Gl.Rotate,{enable:!1}],[Gl.Pinch,{enable:!1}],[Gl.Swipe,{enable:!1}],[Gl.Pan,{threshold:0,enable:!1}],[Gl.Press,{enable:!1}],[Gl.Tap,{event:"doubletap",taps:2,enable:!1}],[Gl.Tap,{event:"anytap",enable:!1}],[Gl.Tap,{enable:!1}]]:null,iI={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},XK={doubletap:["tap"]},JK={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},cw={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},YK={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},sI={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},ZK=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",uf=typeof window<"u"?window:global;let lw=!1;try{const r={get passive(){return lw=!0,!0}};uf.addEventListener("test",null,r),uf.removeEventListener("test",null)}catch{lw=!1}const t$=ZK.indexOf("firefox")!==-1,{WHEEL_EVENTS:e$}=cw,oI="wheel",aI=4.000244140625,r$=40,n$=.25;class i$ extends W0{constructor(t,e,n){super(t,e,n),this.handleEvent=i=>{if(!this.options.enable)return;let s=i.deltaY;uf.WheelEvent&&(t$&&i.deltaMode===uf.WheelEvent.DOM_DELTA_PIXEL&&(s/=uf.devicePixelRatio),i.deltaMode===uf.WheelEvent.DOM_DELTA_LINE&&(s*=r$)),s!==0&&s%aI===0&&(s=Math.floor(s/aI)),i.shiftKey&&s&&(s=s*n$),this.callback({type:oI,center:{x:i.clientX,y:i.clientY},delta:-s,srcEvent:i,pointerType:"mouse",target:i.target})},this.events=(this.options.events||[]).concat(e$),this.events.forEach(i=>t.addEventListener(i,this.handleEvent,lw?{passive:!1}:!1))}destroy(){this.events.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,e){t===oI&&(this.options.enable=e)}}const{MOUSE_EVENTS:s$}=cw,cI="pointermove",lI="pointerover",uI="pointerout",AI="pointerenter",hI="pointerleave";class o$ extends W0{constructor(t,e,n){super(t,e,n),this.handleEvent=s=>{this.handleOverEvent(s),this.handleOutEvent(s),this.handleEnterEvent(s),this.handleLeaveEvent(s),this.handleMoveEvent(s)},this.pressed=!1;const{enable:i}=this.options;this.enableMoveEvent=i,this.enableLeaveEvent=i,this.enableEnterEvent=i,this.enableOutEvent=i,this.enableOverEvent=i,this.events=(this.options.events||[]).concat(s$),this.events.forEach(s=>t.addEventListener(s,this.handleEvent))}destroy(){this.events.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,e){t===cI&&(this.enableMoveEvent=e),t===lI&&(this.enableOverEvent=e),t===uI&&(this.enableOutEvent=e),t===AI&&(this.enableEnterEvent=e),t===hI&&(this.enableLeaveEvent=e)}handleOverEvent(t){this.enableOverEvent&&t.type==="mouseover"&&this._emit(lI,t)}handleOutEvent(t){this.enableOutEvent&&t.type==="mouseout"&&this._emit(uI,t)}handleEnterEvent(t){this.enableEnterEvent&&t.type==="mouseenter"&&this._emit(AI,t)}handleLeaveEvent(t){this.enableLeaveEvent&&t.type==="mouseleave"&&this._emit(hI,t)}handleMoveEvent(t){if(this.enableMoveEvent)switch(t.type){case"mousedown":t.button>=0&&(this.pressed=!0);break;case"mousemove":t.which===0&&(this.pressed=!1),this.pressed||this._emit(cI,t);break;case"mouseup":this.pressed=!1;break}}_emit(t,e){this.callback({type:t,center:{x:e.clientX,y:e.clientY},srcEvent:e,pointerType:"mouse",target:e.target})}}const{KEY_EVENTS:a$}=cw,dI="keydown",fI="keyup";class c$ extends W0{constructor(t,e,n){super(t,e,n),this.handleEvent=i=>{const s=i.target||i.srcElement;s.tagName==="INPUT"&&s.type==="text"||s.tagName==="TEXTAREA"||(this.enableDownEvent&&i.type==="keydown"&&this.callback({type:dI,srcEvent:i,key:i.key,target:i.target}),this.enableUpEvent&&i.type==="keyup"&&this.callback({type:fI,srcEvent:i,key:i.key,target:i.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(a$),t.tabIndex=this.options.tabIndex||0,t.style.outline="none",this.events.forEach(i=>t.addEventListener(i,this.handleEvent))}destroy(){this.events.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,e){t===dI&&(this.enableDownEvent=e),t===fI&&(this.enableUpEvent=e)}}const pI="contextmenu";class l$ extends W0{constructor(t,e,n){super(t,e,n),this.handleEvent=i=>{this.options.enable&&this.callback({type:pI,center:{x:i.clientX,y:i.clientY},srcEvent:i,pointerType:"mouse",target:i.target})},t.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(t,e){t===pI&&(this.options.enable=e)}}const uw=1,X0=2,Aw=4,u$={pointerdown:uw,pointermove:X0,pointerup:Aw,mousedown:uw,mousemove:X0,mouseup:Aw},A$=1,h$=2,d$=3,f$=0,p$=1,g$=2,m$=1,y$=2,_$=4;function v$(r){const t=u$[r.srcEvent.type];if(!t)return null;const{buttons:e,button:n,which:i}=r.srcEvent;let s=!1,a=!1,o=!1;return t===Aw||t===X0&&!Number.isFinite(e)?(s=i===A$,a=i===h$,o=i===d$):t===X0?(s=!!(e&m$),a=!!(e&_$),o=!!(e&y$)):t===uw&&(s=n===f$,a=n===p$,o=n===g$),{leftButton:s,middleButton:a,rightButton:o}}function b$(r,t){const e=r.center;if(!e)return null;const n=t.getBoundingClientRect(),i=n.width/t.offsetWidth||1,s=n.height/t.offsetHeight||1,a={x:(e.x-n.left-t.clientLeft)/i,y:(e.y-n.top-t.clientTop)/s};return{center:e,offsetCenter:a}}const hw={srcElement:"root",priority:0};class w${constructor(t){this.handleEvent=e=>{if(this.isEmpty())return;const n=this._normalizeEvent(e);let i=e.srcEvent.target;for(;i&&i!==n.rootElement;){if(this._emit(n,i),n.handled)return;i=i.parentNode}this._emit(n,"root")},this.eventManager=t,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(t,e,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;const{handlers:a,handlersByElement:o}=this;let A=hw;typeof n=="string"||n&&n.addEventListener?A={...hw,srcElement:n}:n&&(A={...hw,...n});let f=o.get(A.srcElement);f||(f=[],o.set(A.srcElement,f));const m={type:t,handler:e,srcElement:A.srcElement,priority:A.priority};i&&(m.once=!0),s&&(m.passive=!0),a.push(m),this._active=this._active||!m.passive;let _=f.length-1;for(;_>=0&&!(f[_].priority>=m.priority);)_--;f.splice(_+1,0,m)}remove(t,e){const{handlers:n,handlersByElement:i}=this;for(let s=n.length-1;s>=0;s--){const a=n[s];if(a.type===t&&a.handler===e){n.splice(s,1);const o=i.get(a.srcElement);o.splice(o.indexOf(a),1),o.length===0&&i.delete(a.srcElement)}}this._active=n.some(s=>!s.passive)}_emit(t,e){const n=this.handlersByElement.get(e);if(n){let i=!1;const s=()=>{t.handled=!0},a=()=>{t.handled=!0,i=!0},o=[];for(let A=0;A<n.length;A++){const{type:f,handler:m,once:_}=n[A];if(m({...t,type:f,stopPropagation:s,stopImmediatePropagation:a}),_&&o.push(n[A]),i)break}for(let A=0;A<o.length;A++){const{type:f,handler:m}=o[A];this.remove(f,m)}}}_normalizeEvent(t){const e=this.eventManager.getElement();return{...t,...v$(t),...b$(t,e),preventDefault:()=>{t.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:e}}}const x$={events:null,recognizers:null,recognizerOptions:{},Manager:$K,touchAction:"none",tabIndex:0};class B${constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,e=arguments.length>1?arguments[1]:void 0;this._onBasicInput=i=>{const{srcEvent:s}=i,a=JK[s.type];a&&this.manager.emit(a,i)},this._onOtherEvent=i=>{this.manager.emit(i.type,i)},this.options={...x$,...e},this.events=new Map,this.setElement(t);const{events:n}=this.options;n&&this.on(n)}getElement(){return this.element}setElement(t){if(this.element&&this.destroy(),this.element=t,!t)return;const{options:e}=this,n=e.Manager;this.manager=new n(t,{touchAction:e.touchAction,recognizers:e.recognizers||WK}).on("hammer.input",this._onBasicInput),e.recognizers||Object.keys(iI).forEach(i=>{const s=this.manager.get(i);s&&iI[i].forEach(a=>{s.recognizeWith(a)})});for(const i in e.recognizerOptions){const s=this.manager.get(i);if(s){const a=e.recognizerOptions[i];delete a.enable,s.set(a)}}this.wheelInput=new i$(t,this._onOtherEvent,{enable:!1}),this.moveInput=new o$(t,this._onOtherEvent,{enable:!1}),this.keyInput=new c$(t,this._onOtherEvent,{enable:!1,tabIndex:e.tabIndex}),this.contextmenuInput=new l$(t,this._onOtherEvent,{enable:!1});for(const[i,s]of this.events)s.isEmpty()||(this._toggleRecognizer(s.recognizerName,!0),this.manager.on(i,s.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(t,e,n){this._addEventHandler(t,e,n,!1)}once(t,e,n){this._addEventHandler(t,e,n,!0)}watch(t,e,n){this._addEventHandler(t,e,n,!1,!0)}off(t,e){this._removeEventHandler(t,e)}_toggleRecognizer(t,e){const{manager:n}=this;if(!n)return;const i=n.get(t);if(i&&i.options.enable!==e){i.set({enable:e});const s=XK[t];s&&!this.options.recognizers&&s.forEach(a=>{const o=n.get(a);e?(o.requireFailure(t),i.dropRequireFailure(a)):o.dropRequireFailure(t)})}this.wheelInput.enableEventType(t,e),this.moveInput.enableEventType(t,e),this.keyInput.enableEventType(t,e),this.contextmenuInput.enableEventType(t,e)}_addEventHandler(t,e,n,i,s){if(typeof t!="string"){n=e;for(const m in t)this._addEventHandler(m,t[m],n,i,s);return}const{manager:a,events:o}=this,A=sI[t]||t;let f=o.get(A);f||(f=new w$(this),o.set(A,f),f.recognizerName=YK[A]||A,a&&a.on(A,f.handleEvent)),f.add(t,e,n,i,s),f.isEmpty()||this._toggleRecognizer(f.recognizerName,!0)}_removeEventHandler(t,e){if(typeof t!="string"){for(const a in t)this._removeEventHandler(a,t[a]);return}const{events:n}=this,i=sI[t]||t,s=n.get(i);if(s&&(s.remove(t,e),s.isEmpty())){const{recognizerName:a}=s;let o=!1;for(const A of n.values())if(A.recognizerName===a&&!A.isEmpty()){o=!0;break}o||this._toggleRecognizer(a,!1)}}}function Gh(){}const gI={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,glOptions:{},parameters:{},parent:null,gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,onWebGLInitialized:Gh,onResize:Gh,onViewStateChange:Gh,onInteractionStateChange:Gh,onBeforeRender:Gh,onAfterRender:Gh,onLoad:Gh,onError:r=>Pn.error(r.message,r.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:r=>{let{isDragging:t}=r;return t?"grabbing":"grab"},getTooltip:null,debug:!1,drawPickingColors:!1};class dw{constructor(t){$(this,"props",void 0),$(this,"width",0),$(this,"height",0),$(this,"userData",{}),$(this,"canvas",null),$(this,"viewManager",null),$(this,"layerManager",null),$(this,"effectManager",null),$(this,"deckRenderer",null),$(this,"deckPicker",null),$(this,"eventManager",null),$(this,"tooltip",null),$(this,"metrics",void 0),$(this,"animationLoop",void 0),$(this,"stats",void 0),$(this,"viewState",void 0),$(this,"cursorState",void 0),$(this,"_needsRedraw",void 0),$(this,"_pickRequest",void 0),$(this,"_lastPointerDownInfo",null),$(this,"_metricsCounter",void 0),$(this,"_onPointerMove",e=>{const{_pickRequest:n}=this;if(e.type==="pointerleave")n.x=-1,n.y=-1,n.radius=0;else{if(e.leftButton||e.rightButton)return;{const i=e.offsetCenter;if(!i)return;n.x=i.x,n.y=i.y,n.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:n.x,y:n.y}),n.event=e}),$(this,"_onEvent",e=>{const n=UT[e.type],i=e.offsetCenter;if(!n||!i||!this.layerManager)return;const s=this.layerManager.getLayers(),a=this.deckPicker.getLastPickedObject({x:i.x,y:i.y,layers:s,viewports:this.getViewports(i)},this._lastPointerDownInfo),{layer:o}=a,A=o&&(o[n.handler]||o.props[n.handler]),f=this.props[n.handler];let m=!1;A&&(m=A.call(o,a,e)),!m&&f&&f(a,e)}),$(this,"_onPointerDown",e=>{const n=e.offsetCenter,i=this._pick("pickObject","pickObject Time",{x:n.x,y:n.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=i.result[0]||i.emptyInfo}),this.props={...gI,...t},t=this.props,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this.cursorState={isHovering:!1,isDragging:!1},t.viewState&&t.initialViewState&&Pn.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),TT()==="IE"&&Pn.warn("IE 11 is not supported")(),this.viewState=t.initialViewState,t.gl||typeof document<"u"&&(this.canvas=this._createCanvas(t)),this.animationLoop=this._createAnimationLoop(t),this.stats=new sb({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this.setProps(t),t._typedArrayManagerProps&&pg.setOptions(t._typedArrayManagerProps),this.animationLoop.start()}finalize(){var t,e,n,i,s,a,o,A;if((t=this.animationLoop)===null||t===void 0||t.stop(),this.animationLoop=null,this._lastPointerDownInfo=null,(e=this.layerManager)===null||e===void 0||e.finalize(),this.layerManager=null,(n=this.viewManager)===null||n===void 0||n.finalize(),this.viewManager=null,(i=this.effectManager)===null||i===void 0||i.finalize(),this.effectManager=null,(s=this.deckRenderer)===null||s===void 0||s.finalize(),this.deckRenderer=null,(a=this.deckPicker)===null||a===void 0||a.finalize(),this.deckPicker=null,(o=this.eventManager)===null||o===void 0||o.destroy(),this.eventManager=null,(A=this.tooltip)===null||A===void 0||A.remove(),this.tooltip=null,!this.props.canvas&&!this.props.gl&&this.canvas){var f;(f=this.canvas.parentElement)===null||f===void 0||f.removeChild(this.canvas),this.canvas=null}}setProps(t){this.stats.get("setProps Time").timeStart(),"onLayerHover"in t&&Pn.removed("onLayerHover","onHover")(),"onLayerClick"in t&&Pn.removed("onLayerClick","onClick")(),t.initialViewState&&!zl(this.props.initialViewState,t.initialViewState,3)&&(this.viewState=t.initialViewState),Object.assign(this.props,t),this._setCanvasSize(this.props);const e=Object.create(this.props);Object.assign(e,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop.setProps(e),this.layerManager&&(this.viewManager.setProps(e),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(e),this.effectManager.setProps(e),this.deckRenderer.setProps(e),this.deckPicker.setProps(e)),this.stats.get("setProps Time").timeEnd()}needsRedraw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let e=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);const n=this.viewManager.needsRedraw(t),i=this.layerManager.needsRedraw(t),s=this.effectManager.needsRedraw(t),a=this.deckRenderer.needsRedraw(t);return e=e||n||i||s||a,e}redraw(t){if(!this.layerManager)return;let e=this.needsRedraw({clearRedrawFlags:!0});e=t||e,e&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(e):this._drawLayers(e))}get isInitialized(){return this.viewManager!==null}getViews(){return Ws(this.viewManager),this.viewManager.views}getViewports(t){return Ws(this.viewManager),this.viewManager.getViewports(t)}getCanvas(){return this.canvas}pickObject(t){const e=this._pick("pickObject","pickObject Time",t).result;return e.length?e[0]:null}pickMultipleObjects(t){return t.depth=t.depth||10,this._pick("pickObject","pickMultipleObjects Time",t).result}pickObjects(t){return this._pick("pickObjects","pickObjects Time",t)}_addResources(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;for(const n in t)this.layerManager.resourceManager.add({resourceId:n,data:t[n],forceUpdate:e})}_removeResources(t){for(const e of t)this.layerManager.resourceManager.remove(e)}_addDefaultEffect(t){this.effectManager.addDefaultEffect(t)}_pick(t,e,n){Ws(this.deckPicker);const{stats:i}=this;i.get("Pick Count").incrementCount(),i.get(e).timeStart();const s=this.deckPicker[t]({layers:this.layerManager.getLayers(n),views:this.viewManager.getViews(),viewports:this.getViewports(n),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...n});return i.get(e).timeEnd(),s}_createCanvas(t){let e=t.canvas;return typeof e=="string"&&(e=document.getElementById(e),Ws(e)),e||(e=document.createElement("canvas"),e.id=t.id||"deckgl-overlay",(t.parent||document.body).appendChild(e)),Object.assign(e.style,t.style),e}_setCanvasSize(t){if(!this.canvas)return;const{width:e,height:n}=t;if(e||e===0){const s=Number.isFinite(e)?"".concat(e,"px"):e;this.canvas.style.width=s}if(n||n===0){var i;const s=Number.isFinite(n)?"".concat(n,"px"):n;this.canvas.style.position=((i=t.style)===null||i===void 0?void 0:i.position)||"absolute",this.canvas.style.height=s}}_updateCanvasSize(){var t,e;const{canvas:n}=this;if(!n)return;const i=(t=n.clientWidth)!==null&&t!==void 0?t:n.width,s=(e=n.clientHeight)!==null&&e!==void 0?e:n.height;if(i!==this.width||s!==this.height){var a,o;this.width=i,this.height=s,(a=this.viewManager)===null||a===void 0||a.setProps({width:i,height:s}),(o=this.layerManager)===null||o===void 0||o.activateViewport(this.getViewports()[0]),this.props.onResize({width:i,height:s})}}_createAnimationLoop(t){const{width:e,height:n,gl:i,glOptions:s,debug:a,onError:o,onBeforeRender:A,onAfterRender:f,useDevicePixels:m}=t;return new sG({width:e,height:n,useDevicePixels:m,autoResizeDrawingBuffer:!i,autoResizeViewport:!1,gl:i,onCreateContext:_=>XT({...s,..._,canvas:this.canvas,debug:a,onContextLost:()=>this._onContextLost()}),onInitialize:_=>this._setGLContext(_.gl),onRender:this._onRenderFrame.bind(this),onBeforeRender:A,onAfterRender:f,onError:o})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){let t=this.props.views||[new ow({id:"default-view"})];return t=Array.isArray(t)?t:[t],t.length&&this.props.controller&&(t[0].props.controller=this.props.controller),t}_onContextLost(){const{onError:t}=this.props;this.animationLoop&&t&&t(new Error("WebGL context is lost"))}_pickAndCallback(){const{_pickRequest:t}=this;if(t.event){const{result:n,emptyInfo:i}=this._pick("pickObject","pickObject Time",t);this.cursorState.isHovering=n.length>0;let s=i,a=!1;for(const o of n){var e;s=o,a=((e=o.layer)===null||e===void 0?void 0:e.onHover(o,t.event))||a}if(!a&&this.props.onHover&&this.props.onHover(s,t.event),this.props.getTooltip&&this.tooltip){const o=this.props.getTooltip(s);this.tooltip.setTooltip(o,s.x,s.y)}t.event=null}}_updateCursor(){const t=this.props.parent||this.canvas;t&&(t.style.cursor=this.props.getCursor(this.cursorState))}_setGLContext(t){if(this.layerManager)return;this.canvas||(this.canvas=t.canvas,ib(t,{enable:!0,copyState:!0})),this.tooltip=new GK(this.canvas),Iu(t,{blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onWebGLInitialized(t);const e=new C3;e.play(),this.animationLoop.attachTimeline(e),this.eventManager=new B$(this.props.parent||t.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const i in UT)this.eventManager.on(i,this._onEvent);this.viewManager=new pK({timeline:e,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const n=this.viewManager.getViewports()[0];this.layerManager=new fK(t,{deck:this,stats:this.stats,viewport:n,timeline:e}),this.effectManager=new PK,this.deckRenderer=new RK(t),this.deckPicker=new HK(t),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(t,e){const{gl:n}=this.layerManager.context;Iu(n,this.props.parameters),this.props.onBeforeRender({gl:n}),this.deckRenderer.renderLayers({target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...e}),this.props.onAfterRender({gl:n})}_onRenderFrame(t){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),Pn.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.tooltip.isVisible&&this.viewManager.needsRedraw()&&this.tooltip.setTooltip(null),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(t){const e=this.props.onViewStateChange(t)||t.viewState;this.viewState&&(this.viewState={...this.viewState,[t.viewId]:e},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(t){this.cursorState.isDragging=t.isDragging||!1,this.props.onInteractionStateChange(t)}_getFrameStats(){const{stats:t}=this;t.get("frameRate").timeEnd(),t.get("frameRate").timeStart();const e=this.animationLoop.stats;t.get("GPU Time").addTime(e.get("GPU Time").lastTiming),t.get("CPU Time").addTime(e.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:t,stats:e}=this;t.fps=e.get("frameRate").getHz(),t.setPropsTime=e.get("setProps Time").time,t.updateAttributesTime=e.get("Update Attributes").time,t.framesRedrawn=e.get("Redraw Count").count,t.pickTime=e.get("pickObject Time").time+e.get("pickMultipleObjects Time").time+e.get("pickObjects Time").time,t.pickCount=e.get("Pick Count").count,t.gpuTime=e.get("GPU Time").time,t.cpuTime=e.get("CPU Time").time,t.gpuTimePerFrame=e.get("GPU Time").getAverageTime(),t.cpuTimePerFrame=e.get("CPU Time").getAverageTime();const n=Oh.get("Memory Usage");t.bufferMemory=n.get("Buffer Memory").count,t.textureMemory=n.get("Texture Memory").count,t.renderbufferMemory=n.get("Renderbuffer Memory").count,t.gpuMemory=n.get("GPU Memory").count}}$(dw,"defaultProps",gI),$(dw,"VERSION",Az);class fw{constructor(t,e){$(this,"opts",void 0),$(this,"source",void 0),this.opts=e,this.source=t}get value(){return this.source.value}getValue(){const t=this.source.getBuffer(),e=this.getAccessor();if(t)return[t,e];const{value:n}=this.source,{size:i}=e;let s=n;if(n&&n.length!==i){s=new Float32Array(i);const a=e.elementOffset||0;for(let o=0;o<i;++o)s[o]=n[a+o]}return s}getAccessor(){return{...this.source.getAccessor(),...this.opts}}}function C$(r){switch(r){case 5126:return Float32Array;case 5130:return Float64Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return Uint8ClampedArray;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Unknown GL type")}}function J0(r){return r.stride||r.size*r.bytesPerElement}function mI(r,t){t.offset&&Pn.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const e=J0(r),n=t.vertexOffset!==void 0?t.vertexOffset:r.vertexOffset||0,i=t.elementOffset||0,s=n*e+i*r.bytesPerElement+(r.offset||0);return{...t,offset:s,stride:e}}function E$(r,t){const e=mI(r,t);return{high:e,low:{...e,offset:e.offset+r.size*4}}}class S${constructor(t,e,n){$(this,"gl",void 0),$(this,"id",void 0),$(this,"size",void 0),$(this,"settings",void 0),$(this,"value",void 0),$(this,"doublePrecision",void 0),$(this,"_buffer",void 0),$(this,"state",void 0),this.gl=t,this.id=e.id||"",this.size=e.size||1;const i=e.logicalType||e.type,s=i===5130;let{defaultValue:a}=e;a=Number.isFinite(a)?[a]:a||new Array(this.size).fill(0);let o;s?o=5126:!i&&e.isIndexed?o=t&&db(t,mi.ELEMENT_INDEX_UINT32)?5125:5123:o=i||5126;let A=C$(i||o||5126);this.doublePrecision=s,s&&e.fp64===!1&&(A=Float32Array),this.value=null,this.settings={...e,defaultType:A,defaultValue:a,logicalType:i,type:o,size:this.size,bytesPerElement:A.BYTES_PER_ELEMENT},this.state={...n,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1},this._buffer=null}get isConstant(){return this.state.constant}get buffer(){if(!this._buffer){const{isIndexed:t,type:e}=this.settings;this._buffer=new ni(this.gl,{id:this.id,target:t?34963:34962,accessor:{type:e}})}return this._buffer}get byteOffset(){const t=this.getAccessor();return t.vertexOffset?t.vertexOffset*J0(t):0}get numInstances(){return this.state.numInstances}set numInstances(t){this.state.numInstances=t}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),pg.release(this.state.allocatedValue)}getShaderAttributes(t,e){if(this.doublePrecision){const n={},i=this.value instanceof Float64Array,s=E$(this.getAccessor(),e||{});return n[t]=new fw(this,s.high),n["".concat(t,"64Low")]=i?new fw(this,s.low):new Float32Array(this.size),n}if(e){const n=mI(this.getAccessor(),e);return{[t]:new fw(this,n)}}return{[t]:this}}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(){return this.state.constant?this.value:[this.getBuffer(),this.getAccessor()]}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let t=null;if(this.state.constant&&this.value){const e=Array.from(this.value);t=[e,e]}else{const{value:e,numInstances:n,size:i}=this,s=n*i;if(e&&s&&e.length>=s){const a=new Array(i).fill(1/0),o=new Array(i).fill(-1/0);for(let A=0;A<s;)for(let f=0;f<i;f++){const m=e[A++];m<a[f]&&(a[f]=m),m>o[f]&&(o[f]=m)}t=[a,o]}}return this.state.bounds=t,t}setData(t){const{state:e}=this;let n;ArrayBuffer.isView(t)?n={value:t}:t instanceof ni?n={buffer:t}:n=t;const i={...this.settings,...n};if(e.bufferAccessor=i,e.bounds=null,n.constant){let s=n.value;if(s=this._normalizeValue(s,[],0),this.settings.normalized&&(s=this.normalizeConstant(s)),!(!e.constant||!this._areValuesEqual(s,this.value)))return!1;e.externalBuffer=null,e.constant=!0,this.value=s}else if(n.buffer){const s=n.buffer;e.externalBuffer=s,e.constant=!1,this.value=n.value||null;const a=n.value instanceof Float64Array;i.type=n.type||s.accessor.type,i.bytesPerElement=s.accessor.BYTES_PER_ELEMENT*(a?2:1),i.stride=J0(i)}else if(n.value){this._checkExternalBuffer(n);let s=n.value;e.externalBuffer=null,e.constant=!1,this.value=s,i.bytesPerElement=s.BYTES_PER_ELEMENT,i.stride=J0(i);const{buffer:a,byteOffset:o}=this;this.doublePrecision&&s instanceof Float64Array&&(s=tw(s,i));const A=s.byteLength+o+i.stride*2;a.byteLength<A&&a.reallocate(A),a.setAccessor(null),a.subData({data:s,offset:o}),i.type=n.type||a.accessor.type}return!0}updateSubBuffer(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.state.bounds=null;const e=this.value,{startOffset:n=0,endOffset:i}=t;this.buffer.subData({data:this.doublePrecision&&e instanceof Float64Array?tw(e,{size:this.size,startIndex:n,endIndex:i}):e.subarray(n,i),offset:n*e.BYTES_PER_ELEMENT+this.byteOffset})}allocate(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const{state:n}=this,i=n.allocatedValue,s=pg.allocate(i,t+1,{size:this.size,type:this.settings.defaultType,copy:e});this.value=s;const{buffer:a,byteOffset:o}=this;return a.byteLength<s.byteLength+o&&(a.reallocate(s.byteLength+o),e&&i&&a.subData({data:i instanceof Float64Array?tw(i,this):i,offset:o})),n.allocatedValue=s,n.constant=!1,n.externalBuffer=null,n.bufferAccessor=this.settings,!0}_checkExternalBuffer(t){const{value:e}=t;if(!ArrayBuffer.isView(e))throw new Error("Attribute ".concat(this.id," value is not TypedArray"));const n=this.settings.defaultType;let i=!1;if(this.doublePrecision&&(i=e.BYTES_PER_ELEMENT<4),i)throw new Error("Attribute ".concat(this.id," does not support ").concat(e.constructor.name));!(e instanceof n)&&this.settings.normalized&&!("normalized"in t)&&Pn.warn("Attribute ".concat(this.id," is normalized"))()}normalizeConstant(t){switch(this.settings.type){case 5120:return new Float32Array(t).map(e=>(e+128)/255*2-1);case 5122:return new Float32Array(t).map(e=>(e+32768)/65535*2-1);case 5121:return new Float32Array(t).map(e=>e/255);case 5123:return new Float32Array(t).map(e=>e/65535);default:return t}}_normalizeValue(t,e,n){const{defaultValue:i,size:s}=this.settings;if(Number.isFinite(t))return e[n]=t,e;if(!t){let a=s;for(;--a>=0;)e[n+a]=i[a];return e}switch(s){case 4:e[n+3]=Number.isFinite(t[3])?t[3]:i[3];case 3:e[n+2]=Number.isFinite(t[2])?t[2]:i[2];case 2:e[n+1]=Number.isFinite(t[1])?t[1]:i[1];case 1:e[n+0]=Number.isFinite(t[0])?t[0]:i[0];break;default:let a=s;for(;--a>=0;)e[n+a]=Number.isFinite(t[a])?t[a]:i[a]}return e}_areValuesEqual(t,e){if(!t||!e)return!1;const{size:n}=this;for(let i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}}const yI=[],_I=[];function vI(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1/0,n=yI;const i={index:-1,data:r,target:[]};return r?typeof r[Symbol.iterator]=="function"?n=r:r.length>0&&(_I.length=r.length,n=_I):n=yI,(t>0||Number.isFinite(e))&&(n=(Array.isArray(n)?n:Array.from(n)).slice(t,e),i.index=t-1),{iterable:n,objectInfo:i}}function bI(r){return r&&r[Symbol.asyncIterator]}function T$(r,t){const{size:e,stride:n,offset:i,startIndices:s,nested:a}=t,o=r.BYTES_PER_ELEMENT,A=n?n/o:e,f=i?i/o:0,m=Math.floor((r.length-f)/A);return(_,x)=>{let{index:B,target:P}=x;if(!s){const q=B*A+f;for(let J=0;J<e;J++)P[J]=r[q+J];return P}const M=s[B],k=s[B+1]||m;let Q;if(a){Q=new Array(k-M);for(let q=M;q<k;q++){const J=q*A+f;P=new Array(e);for(let tt=0;tt<e;tt++)P[tt]=r[J+tt];Q[q-M]=P}}else if(A===e)Q=r.subarray(M*e+f,k*e+f);else{Q=new r.constructor((k-M)*e);let q=0;for(let J=M;J<k;J++){const tt=J*A+f;for(let ft=0;ft<e;ft++)Q[q++]=r[tt+ft]}}return Q}}const I$=[],Y0=[[0,1/0]];function L$(r,t){if(r===Y0||(t[0]<0&&(t[0]=0),t[0]>=t[1]))return r;const e=[],n=r.length;let i=0;for(let s=0;s<n;s++){const a=r[s];a[1]<t[0]?(e.push(a),i=s+1):a[0]>t[1]?e.push(a):t=[Math.min(a[0],t[0]),Math.max(a[1],t[1])]}return e.splice(i,0,t),e}function pw(r){const{source:t,target:e,start:n=0,size:i,getData:s}=r,a=r.end||e.length,o=t.length,A=a-n;if(o>A){e.set(t.subarray(0,A),n);return}if(e.set(t,n),!s)return;let f=o;for(;f<A;){const m=s(f,t);for(let _=0;_<i;_++)e[n+f]=m[_]||0,f++}}function F$(r){let{source:t,target:e,size:n,getData:i,sourceStartIndices:s,targetStartIndices:a}=r;if(!Array.isArray(a))return pw({source:t,target:e,size:n,getData:i}),e;let o=0,A=0;const f=i&&((_,x)=>i(_+A,x)),m=Math.min(s.length,a.length);for(let _=1;_<m;_++){const x=s[_]*n,B=a[_]*n;pw({source:t.subarray(o,x),target:e,start:A,end:B,size:n,getData:f}),o=x,A=B}return A<e.length&&pw({source:[],target:e,start:A,size:n,getData:f}),e}const P$={interpolation:{duration:0,easing:r=>r},spring:{stiffness:.05,damping:.5}};function wI(r,t){if(!r)return null;Number.isFinite(r)&&(r={type:"interpolation",duration:r});const e=r.type||"interpolation";return{...P$[e],...t,...r,type:e}}function xI(r,t){const e=t.getBuffer();return e?[e,{divisor:0,size:t.size,normalized:t.settings.normalized}]:t.value}function BI(r){switch(r){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error('No defined attribute type for size "'.concat(r,'"'))}}function CI(r){r.push(r.shift())}function gw(r,t){const{doublePrecision:e,settings:n,value:i,size:s}=r,a=e&&i instanceof Float64Array?2:1;return(n.noAlloc?i.length:t*s)*a}function EI(r){let{buffer:t,numInstances:e,attribute:n,fromLength:i,fromStartIndices:s,getData:a=q=>q}=r;const o=n.doublePrecision&&n.value instanceof Float64Array?2:1,A=n.size*o,f=n.byteOffset,m=n.startIndices,_=s&&m,x=gw(n,e),B=n.isConstant;if(!_&&i>=x)return;const P=B?n.value:n.getBuffer().getData({srcByteOffset:f});if(n.settings.normalized&&!B){const q=a;a=(J,tt)=>n.normalizeConstant(q(J,tt))}const M=B?(q,J)=>a(P,J):(q,J)=>a(P.subarray(q,q+A),J),k=t.getData({length:i}),Q=new Float32Array(x);F$({source:k,target:Q,sourceStartIndices:s,targetStartIndices:m,size:A,getData:M}),t.byteLength<Q.byteLength+f&&t.reallocate(Q.byteLength+f),t.subData({data:Q,offset:f})}class mw extends S${constructor(t,e){super(t,e,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,updateRanges:Y0}),$(this,"constant",!1),this.settings.update=e.update||(e.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(t){this.state.startIndices=t}needsUpdate(){return this.state.needsUpdate}needsRedraw(){let{clearChangedFlags:t=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=this.state.needsRedraw;return this.state.needsRedraw=e&&!t,e}getUpdateTriggers(){const{accessor:t}=this.settings;return[this.id].concat(typeof t!="function"&&t||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(t){if(!t||!this.supportsTransition())return null;const{accessor:e}=this.settings,n=this.settings.transition,i=Array.isArray(e)?t[e.find(s=>t[s])]:t[e];return wI(i,n)}setNeedsUpdate(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.id,e=arguments.length>1?arguments[1]:void 0;if(this.state.needsUpdate=this.state.needsUpdate||t,this.setNeedsRedraw(t),e){const{startRow:n=0,endRow:i=1/0}=e;this.state.updateRanges=L$(this.state.updateRanges,[n,i])}else this.state.updateRanges=Y0}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=I$}setNeedsRedraw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.id;this.state.needsRedraw=this.state.needsRedraw||t}allocate(t){const{state:e,settings:n}=this;return n.noAlloc?!1:n.update?(super.allocate(t,e.updateRanges!==Y0),!0):!1}updateBuffer(t){let{numInstances:e,data:n,props:i,context:s}=t;if(!this.needsUpdate())return!1;const{state:{updateRanges:a},settings:{update:o,noAlloc:A}}=this;let f=!0;if(o){for(const[m,_]of a)o.call(s,this,{data:n,startRow:m,endRow:_,props:i,numInstances:e});if(this.value)if(this.constant||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[m,_]of a){const x=Number.isFinite(m)?this.getVertexOffset(m):0,B=Number.isFinite(_)?this.getVertexOffset(_):A||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:x,endOffset:B})}this._checkAttributeArray()}else f=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),f}setConstantValue(t){return t===void 0||typeof t=="function"?!1:(this.setData({constant:!0,value:t})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(t){const{state:e}=this;return t?(this.clearNeedsUpdate(),e.lastExternalBuffer===t||(e.lastExternalBuffer=t,this.setNeedsRedraw(),this.setData(t)),!0):(e.lastExternalBuffer=null,!1)}setBinaryValue(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const{state:n,settings:i}=this;if(!t)return n.binaryValue=null,n.binaryAccessor=null,!1;if(i.noAlloc)return!1;if(n.binaryValue===t)return this.clearNeedsUpdate(),!0;if(n.binaryValue=t,this.setNeedsRedraw(),i.transform||e!==this.startIndices){ArrayBuffer.isView(t)&&(t={value:t});const a=t;Ws(ArrayBuffer.isView(a.value),"invalid ".concat(i.accessor));const o=!!a.size&&a.size!==this.size;return n.binaryAccessor=T$(a.value,{size:a.size||this.size,stride:a.stride,offset:a.offset,startIndices:e,nested:o}),!1}return this.clearNeedsUpdate(),this.setData(t),!0}getVertexOffset(t){const{startIndices:e}=this;return(e?t<e.length?e[t]:this.numInstances:t)*this.size}getShaderAttributes(){const t=this.settings.shaderAttributes||{[this.id]:null},e={};for(const n in t)Object.assign(e,super.getShaderAttributes(n,t[n]));return e}_autoUpdater(t,e){let{data:n,startRow:i,endRow:s,props:a,numInstances:o}=e;if(t.constant)return;const{settings:A,state:f,value:m,size:_,startIndices:x}=t,{accessor:B,transform:P}=A,M=f.binaryAccessor||(typeof B=="function"?B:a[B]);Ws(typeof M=="function",'accessor "'.concat(B,'" is not a function'));let k=t.getVertexOffset(i);const{iterable:Q,objectInfo:q}=vI(n,i,s);for(const J of Q){q.index++;let tt=M(J,q);if(P&&(tt=P.call(this,tt)),x){const ft=(q.index<x.length-1?x[q.index+1]:o)-x[q.index];if(tt&&Array.isArray(tt[0])){let pt=k;for(const mt of tt)t._normalizeValue(mt,m,pt),pt+=_}else tt&&tt.length>_?m.set(tt,k):(t._normalizeValue(tt,q.target,0),oK({target:m,source:q.target,start:k,count:ft}));k+=ft*_}else t._normalizeValue(tt,m,k),k+=_}}_validateAttributeUpdaters(){const{settings:t}=this;if(!(t.noAlloc||typeof t.update=="function"))throw new Error("Attribute ".concat(this.id," missing update or accessor"))}_checkAttributeArray(){const{value:t}=this,e=Math.min(4,this.size);if(t&&t.length>=e){let n=!0;switch(e){case 4:n=n&&Number.isFinite(t[3]);case 3:n=n&&Number.isFinite(t[2]);case 2:n=n&&Number.isFinite(t[1]);case 1:n=n&&Number.isFinite(t[0]);break;default:n=!1}if(!n)throw new Error("Illegal attribute generated for ".concat(this.id))}}}class M${constructor(t){let{gl:e,attribute:n,timeline:i}=t;$(this,"gl",void 0),$(this,"type","interpolation"),$(this,"attributeInTransition",void 0),$(this,"settings",void 0),$(this,"attribute",void 0),$(this,"transition",void 0),$(this,"currentStartIndices",void 0),$(this,"currentLength",void 0),$(this,"transform",void 0),$(this,"buffers",void 0),this.gl=e,this.transition=new yg(i),this.attribute=n,this.attributeInTransition=new mw(e,n.settings),this.currentStartIndices=n.startIndices,this.currentLength=0,this.transform=R$(e,n);const s={byteLength:0,usage:35050};this.buffers=[new ni(e,s),new ni(e,s)]}get inProgress(){return this.transition.inProgress}start(t,e){if(t.duration<=0){this.transition.cancel();return}this.settings=t;const{gl:n,buffers:i,attribute:s}=this;CI(i);const a={numInstances:e,attribute:s,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:t.enter};for(const o of i)EI({buffer:o,...a});this.currentStartIndices=s.startIndices,this.currentLength=gw(s,e),this.attributeInTransition.setData({buffer:i[1],value:s.value}),this.transition.start(t),this.transform.update({elementCount:Math.floor(this.currentLength/s.size),sourceBuffers:{aFrom:i[0],aTo:xI(n,s)},feedbackBuffers:{vCurrent:i[1]}})}update(){const t=this.transition.update();if(t){const{duration:e,easing:n}=this.settings,{time:i}=this.transition;let s=i/e;n&&(s=n(s)),this.transform.run({uniforms:{time:s}})}return t}cancel(){this.transition.cancel(),this.transform.delete();for(const t of this.buffers)t.delete();this.buffers.length=0}}const U$=`
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
attribute ATTRIBUTE_TYPE aFrom;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`;function R$(r,t){const e=BI(t.size);return new Vb(r,{vs:U$,defines:{ATTRIBUTE_TYPE:e},varyings:["vCurrent"]})}class O${constructor(t){let{gl:e,attribute:n,timeline:i}=t;$(this,"gl",void 0),$(this,"type","spring"),$(this,"attributeInTransition",void 0),$(this,"settings",void 0),$(this,"attribute",void 0),$(this,"transition",void 0),$(this,"currentStartIndices",void 0),$(this,"currentLength",void 0),$(this,"texture",void 0),$(this,"framebuffer",void 0),$(this,"transform",void 0),$(this,"buffers",void 0),this.gl=e,this.type="spring",this.transition=new yg(i),this.attribute=n,this.attributeInTransition=new mw(e,{...n.settings,normalized:!1}),this.currentStartIndices=n.startIndices,this.currentLength=0,this.texture=N$(e),this.framebuffer=k$(e,this.texture),this.transform=D$(e,n,this.framebuffer);const s={byteLength:0,usage:35050};this.buffers=[new ni(e,s),new ni(e,s),new ni(e,s)]}get inProgress(){return this.transition.inProgress}start(t,e){const{gl:n,buffers:i,attribute:s}=this,a={numInstances:e,attribute:s,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:t.enter};for(const o of i)EI({buffer:o,...a});this.settings=t,this.currentStartIndices=s.startIndices,this.currentLength=gw(s,e),this.attributeInTransition.setData({buffer:i[1],value:s.value}),this.transition.start({...t,duration:1/0}),this.transform.update({elementCount:Math.floor(this.currentLength/s.size),sourceBuffers:{aTo:xI(n,s)}})}update(){const{buffers:t,transform:e,framebuffer:n,transition:i}=this;if(!i.update())return!1;const a=this.settings;return e.update({sourceBuffers:{aPrev:t[0],aCur:t[1]},feedbackBuffers:{vNext:t[2]}}),e.run({framebuffer:n,discard:!1,clearRenderTarget:!0,uniforms:{stiffness:a.stiffness,damping:a.damping},parameters:{depthTest:!1,blend:!0,viewport:[0,0,1,1],blendFunc:[1,1],blendEquation:[32776,32776]}}),CI(t),this.attributeInTransition.setData({buffer:t[1],value:this.attribute.value}),b0(n)[0]>0||i.end(),!0}cancel(){this.transition.cancel(),this.transform.delete();for(const t of this.buffers)t.delete();this.buffers.length=0,this.texture.delete(),this.framebuffer.delete()}}function D$(r,t,e){const n=BI(t.size);return new Vb(r,{framebuffer:e,vs:`
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
attribute ATTRIBUTE_TYPE aPrev;
attribute ATTRIBUTE_TYPE aCur;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vNext;
varying float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,fs:`
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

varying float vIsTransitioningFlag;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  gl_FragColor = vec4(1.0);
}`,defines:{ATTRIBUTE_TYPE:n},varyings:["vNext"]})}function N$(r){return new Fa(r,{data:new Uint8Array(4),format:6408,type:5121,border:0,mipmaps:!1,dataFormat:6408,width:1,height:1})}function k$(r,t){return new xs(r,{id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,attachments:{36064:t}})}const Q$={interpolation:M$,spring:O$};class H${constructor(t,e){let{id:n,timeline:i}=e;$(this,"id",void 0),$(this,"isSupported",void 0),$(this,"gl",void 0),$(this,"timeline",void 0),$(this,"transitions",void 0),$(this,"needsRedraw",void 0),$(this,"numInstances",void 0),this.id=n,this.gl=t,this.timeline=i,this.transitions={},this.needsRedraw=!1,this.numInstances=1,this.isSupported=Vb.isSupported(t)}finalize(){for(const t in this.transitions)this._removeTransition(t)}update(t){let{attributes:e,transitions:n,numInstances:i}=t;this.numInstances=i||1;for(const s in e){const a=e[s],o=a.getTransitionSetting(n);o&&this._updateAttribute(s,a,o)}for(const s in this.transitions){const a=e[s];(!a||!a.getTransitionSetting(n))&&this._removeTransition(s)}}hasAttribute(t){const e=this.transitions[t];return e&&e.inProgress}getAttributes(){const t={};for(const e in this.transitions){const n=this.transitions[e];n.inProgress&&(t[e]=n.attributeInTransition)}return t}run(){if(!this.isSupported||this.numInstances===0)return!1;for(const e in this.transitions)this.transitions[e].update()&&(this.needsRedraw=!0);const t=this.needsRedraw;return this.needsRedraw=!1,t}_removeTransition(t){this.transitions[t].cancel(),delete this.transitions[t]}_updateAttribute(t,e,n){const i=this.transitions[t];let s=!i||i.type!==n.type;if(s){if(!this.isSupported){Pn.warn("WebGL2 not supported by this browser. Transition for ".concat(t," is disabled."))();return}i&&this._removeTransition(t);const a=Q$[n.type];a?this.transitions[t]=new a({attribute:e,timeline:this.timeline,gl:this.gl}):(Pn.error("unsupported transition type '".concat(n.type,"'"))(),s=!1)}(s||e.needsRedraw())&&(this.needsRedraw=!0,this.transitions[t].start(n,this.numInstances))}}const SI="attributeManager.invalidate",z$="attributeManager.updateStart",G$="attributeManager.updateEnd",V$="attribute.updateStart",j$="attribute.allocate",q$="attribute.updateEnd";class K${constructor(t){let{id:e="attribute-manager",stats:n,timeline:i}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};$(this,"id",void 0),$(this,"gl",void 0),$(this,"attributes",void 0),$(this,"updateTriggers",void 0),$(this,"needsRedraw",void 0),$(this,"userData",void 0),$(this,"stats",void 0),$(this,"attributeTransitionManager",void 0),$(this,"mergeBoundsMemoized",dg(Jq)),this.id=e,this.gl=t,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=n,this.attributeTransitionManager=new H$(t,{id:"".concat(e,"-transitions"),timeline:i}),Object.seal(this)}finalize(){for(const t in this.attributes)this.attributes[t].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};const e=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!t.clearRedrawFlags,e&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(t){this._add(t)}addInstanced(t){this._add(t,{instanced:1})}remove(t){for(const e of t)this.attributes[e]!==void 0&&(this.attributes[e].delete(),delete this.attributes[e])}invalidate(t,e){const n=this._invalidateTrigger(t,e);lo(SI,this,t,n)}invalidateAll(t){for(const e in this.attributes)this.attributes[e].setNeedsUpdate(e,t);lo(SI,this,"all")}update(t){let{data:e,numInstances:n,startIndices:i=null,transitions:s,props:a={},buffers:o={},context:A={}}=t,f=!1;lo(z$,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const m in this.attributes){const _=this.attributes[m],x=_.settings.accessor;_.startIndices=i,_.numInstances=n,a[m]&&Pn.removed("props.".concat(m),"data.attributes.".concat(m))(),_.setExternalBuffer(o[m])||_.setBinaryValue(typeof x=="string"?o[x]:void 0,e.startIndices)||typeof x=="string"&&!o[x]&&_.setConstantValue(a[x])||_.needsUpdate()&&(f=!0,this._updateAttribute({attribute:_,numInstances:n,data:e,props:a,context:A})),this.needsRedraw=this.needsRedraw||_.needsRedraw()}f&&lo(G$,this,n),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:n,transitions:s})}updateTransition(){const{attributeTransitionManager:t}=this,e=t.run();return this.needsRedraw=this.needsRedraw||e,e}getAttributes(){return this.attributes}getBounds(t){const e=t.map(n=>{var i;return(i=this.attributes[n])===null||i===void 0?void 0:i.getBounds()});return this.mergeBoundsMemoized(e)}getChangedAttributes(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearChangedFlags:!1};const{attributes:e,attributeTransitionManager:n}=this,i={...n.getAttributes()};for(const s in e){const a=e[s];a.needsRedraw(t)&&!n.hasAttribute(s)&&(i[s]=a)}return i}getShaderAttributes(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};t||(t=this.getAttributes());const n={};for(const i in t)e[i]||Object.assign(n,t[i].getShaderAttributes());return n}_add(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};for(const n in t){const i=t[n];this.attributes[n]=this._createAttribute(n,i,e)}this._mapUpdateTriggersToAttributes()}_createAttribute(t,e,n){const i={...e,id:t,size:e.isIndexed&&1||e.size||1,divisor:n.instanced?1:e.divisor||0};return new mw(this.gl,i)}_mapUpdateTriggersToAttributes(){const t={};for(const e in this.attributes)this.attributes[e].getUpdateTriggers().forEach(i=>{t[i]||(t[i]=[]),t[i].push(e)});this.updateTriggers=t}_invalidateTrigger(t,e){const{attributes:n,updateTriggers:i}=this,s=i[t];return s&&s.forEach(a=>{const o=n[a];o&&o.setNeedsUpdate(o.id,e)}),s}_updateAttribute(t){const{attribute:e,numInstances:n}=t;if(lo(V$,e),e.constant){e.setConstantValue(e.value);return}e.allocate(n)&&lo(j$,e,n),e.updateBuffer(t)&&(this.needsRedraw=!0,lo(q$,e,n))}}class $$ extends yg{get value(){return this._value}_onUpdate(){const{time:t,settings:{fromValue:e,toValue:n,duration:i,easing:s}}=this,a=s(t/i);this._value=F0(e,n,a)}}const TI=1e-5;function II(r,t,e,n,i){const s=t-r,o=(e-t)*i,A=-s*n;return o+A+s+t}function W$(r,t,e,n,i){if(Array.isArray(e)){const s=[];for(let a=0;a<e.length;a++)s[a]=II(r[a],t[a],e[a],n,i);return s}return II(r,t,e,n,i)}function LI(r,t){if(Array.isArray(r)){let e=0;for(let n=0;n<r.length;n++){const i=r[n]-t[n];e+=i*i}return Math.sqrt(e)}return Math.abs(r-t)}class X$ extends yg{get value(){return this._currValue}_onUpdate(){const{fromValue:t,toValue:e,damping:n,stiffness:i}=this.settings,{_prevValue:s=t,_currValue:a=t}=this;let o=W$(s,a,e,n,i);const A=LI(o,e),f=LI(o,a);A<TI&&f<TI&&(o=e,this.end()),this._prevValue=a,this._currValue=o}}const J$={interpolation:$$,spring:X$};class Y${constructor(t){this.transitions=new Map,this.timeline=t}get active(){return this.transitions.size>0}add(t,e,n,i){const{transitions:s}=this;if(s.has(t)){const A=s.get(t),{value:f=A.settings.fromValue}=A;e=f,this.remove(t)}if(i=wI(i),!i)return;const a=J$[i.type];if(!a){Pn.error("unsupported transition type '".concat(i.type,"'"))();return}const o=new a(this.timeline);o.start({...i,fromValue:e,toValue:n}),s.set(t,o)}remove(t){const{transitions:e}=this;e.has(t)&&(e.get(t).cancel(),e.delete(t))}update(){const t={};for(const[e,n]of this.transitions)n.update(),t[e]=n.value,n.inProgress||this.remove(e);return t}clear(){for(const t of this.transitions.keys())this.remove(t)}}function Z$(r){const t=r[UA];for(const e in t){const n=t[e],{validate:i}=n;if(i&&!i(r[e],n))throw new Error("Invalid prop ".concat(e,": ").concat(r[e]))}}function tW(r,t){const e=FI({newProps:r,oldProps:t,propTypes:r[UA],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),n=rW(r,t);let i=!1;return n||(i=nW(r,t)),{dataChanged:n,propsChanged:e,updateTriggersChanged:i,extensionsChanged:iW(r,t),transitionsChanged:eW(r,t)}}function eW(r,t){if(!r.transitions)return!1;const e={},n=r[UA];let i=!1;for(const s in r.transitions){const a=n[s],o=a&&a.type;(o==="number"||o==="color"||o==="array")&&yw(r[s],t[s],a)&&(e[s]=!0,i=!0)}return i?e:!1}function FI(r){let{newProps:t,oldProps:e,ignoreProps:n={},propTypes:i={},triggerName:s="props"}=r;if(e===t)return!1;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return"".concat(s," changed shallowly");for(const a of Object.keys(t))if(!(a in n)){if(!(a in e))return"".concat(s,".").concat(a," added");const o=yw(t[a],e[a],i[a]);if(o)return"".concat(s,".").concat(a," ").concat(o)}for(const a of Object.keys(e))if(!(a in n)){if(!(a in t))return"".concat(s,".").concat(a," dropped");if(!Object.hasOwnProperty.call(t,a)){const o=yw(t[a],e[a],i[a]);if(o)return"".concat(s,".").concat(a," ").concat(o)}}return!1}function yw(r,t,e){let n=e&&e.equal;return n&&!n(r,t,e)||!n&&(n=r&&t&&r.equals,n&&!n.call(r,t))?"changed deeply":!n&&t!==r?"changed shallowly":null}function rW(r,t){if(t===null)return"oldProps is null, initial diff";let e=!1;const{dataComparator:n,_dataDiff:i}=r;return n?n(r.data,t.data)||(e="Data comparator detected a change"):r.data!==t.data&&(e="A new data container was supplied"),e&&i&&(e=i(r.data,t.data)||e),e}function nW(r,t){if(t===null)return{all:!0};if("all"in r.updateTriggers&&PI(r,t,"all"))return{all:!0};const e={};let n=!1;for(const i in r.updateTriggers)i!=="all"&&PI(r,t,i)&&(e[i]=!0,n=!0);return n?e:!1}function iW(r,t){if(t===null)return!0;const e=t.extensions,{extensions:n}=r;if(n===e)return!1;if(!e||!n||n.length!==e.length)return!0;for(let i=0;i<n.length;i++)if(!n[i].equals(e[i]))return!0;return!1}function PI(r,t,e){let n=r.updateTriggers[e];n=n??{};let i=t.updateTriggers[e];return i=i??{},FI({oldProps:i,newProps:n,triggerName:e})}const sW="count(): argument not an object",oW="count(): argument not a container";function aW(r){if(!lW(r))throw new Error(sW);if(typeof r.count=="function")return r.count();if(Number.isFinite(r.size))return r.size;if(Number.isFinite(r.length))return r.length;if(cW(r))return Object.keys(r).length;throw new Error(oW)}function cW(r){return r!==null&&typeof r=="object"&&r.constructor===Object}function lW(r){return r!==null&&typeof r=="object"}function uW(r,t){if(!t)return r;const e={...r,...t};if("defines"in t&&(e.defines={...r.defines,...t.defines}),"modules"in t&&(e.modules=(r.modules||[]).concat(t.modules),t.modules.some(n=>n.name==="project64"))){const n=e.modules.findIndex(i=>i.name==="project32");n>=0&&e.modules.splice(n,1)}if("inject"in t)if(!r.inject)e.inject=t.inject;else{const n={...r.inject};for(const i in t.inject)n[i]=(n[i]||"")+t.inject[i];e.inject=n}return e}const AW={10241:9987,10240:9729,10242:33071,10243:33071},_w={};function hW(r,t,e,n){if(e instanceof Fa)return e;e.constructor&&e.constructor.name!=="Object"&&(e={data:e});let i=null;e.compressed&&(i={10241:e.data.length>1?9985:9729});const s=new Fa(t,{...e,parameters:{...AW,...i,...n}});return _w[s.id]=r,s}function dW(r,t){!t||!(t instanceof Fa)||_w[t.id]===r&&(t.delete(),delete _w[t.id])}const fW={boolean:{validate(r,t){return!0},equal(r,t,e){return!!r==!!t}},number:{validate(r,t){return Number.isFinite(r)&&(!("max"in t)||r<=t.max)&&(!("min"in t)||r>=t.min)}},color:{validate(r,t){return t.optional&&!r||vw(r)&&(r.length===3||r.length===4)},equal(r,t,e){return zl(r,t,1)}},accessor:{validate(r,t){const e=Z0(r);return e==="function"||e===Z0(t.value)},equal(r,t,e){return typeof t=="function"?!0:zl(r,t,1)}},array:{validate(r,t){return t.optional&&!r||vw(r)},equal(r,t,e){const{compare:n}=e,i=Number.isInteger(n)?n:n?1:0;return n?zl(r,t,i):r===t}},object:{equal(r,t,e){if(e.ignore)return!0;const{compare:n}=e,i=Number.isInteger(n)?n:n?1:0;return n?zl(r,t,i):r===t}},function:{validate(r,t){return t.optional&&!r||typeof r=="function"},equal(r,t,e){return!e.compare&&e.ignore!==!1||r===t}},data:{transform:(r,t,e)=>{const{dataTransform:n}=e.props;return n&&r?n(r):r}},image:{transform:(r,t,e)=>{const n=e.context;return!n||!n.gl?null:hW(e.id,n.gl,r,{...t.parameters,...e.props.textureParameters})},release:(r,t,e)=>{dW(e.id,r)}}};function pW(r){const t={},e={},n={};for(const[i,s]of Object.entries(r)){const a=s==null?void 0:s.deprecatedFor;if(a)n[i]=Array.isArray(a)?a:[a];else{const o=gW(i,s);t[i]=o,e[i]=o.value}}return{propTypes:t,defaultProps:e,deprecatedProps:n}}function gW(r,t){switch(Z0(t)){case"object":return vg(r,t);case"array":return vg(r,{type:"array",value:t,compare:!1});case"boolean":return vg(r,{type:"boolean",value:t});case"number":return vg(r,{type:"number",value:t});case"function":return vg(r,{type:"function",value:t,compare:!0});default:return{name:r,type:"unknown",value:t}}}function vg(r,t){return"type"in t?{name:r,...fW[t.type],...t}:"value"in t?{name:r,type:Z0(t.value),...t}:{name:r,type:"object",value:t}}function vw(r){return Array.isArray(r)||ArrayBuffer.isView(r)}function Z0(r){return vw(r)?"array":r===null?"null":typeof r}function mW(r,t){let e;for(let s=t.length-1;s>=0;s--){const a=t[s];"extensions"in a&&(e=a.extensions)}const n=bw(r.constructor,e),i=Object.create(n);i[q0]=r,i[Hh]={},i[RA]={};for(let s=0;s<t.length;++s){const a=t[s];for(const o in a)i[o]=a[o]}return Object.freeze(i),i}const yW="_mergedDefaultProps";function bw(r,t){let e=yW;if(t)for(const i of t){const s=i.constructor;s&&(e+=":".concat(s.extensionName||s.name))}const n=MI(r,e);return n||(r[e]=_W(r,t||[]))}function _W(r,t){if(!r.prototype)return null;const n=Object.getPrototypeOf(r),i=bw(n),s=MI(r,"defaultProps")||{},a=pW(s),o=Object.assign(Object.create(null),i,a.defaultProps),A=Object.assign(Object.create(null),i==null?void 0:i[UA],a.propTypes),f=Object.assign(Object.create(null),i==null?void 0:i[rw],a.deprecatedProps);for(const m of t){const _=bw(m.constructor);_&&(Object.assign(o,_),Object.assign(A,_[UA]),Object.assign(f,_[rw]))}return vW(o,r),wW(o,A),bW(o,f),o[UA]=A,o[rw]=f,t.length===0&&!ww(r,"_propTypes")&&(r._propTypes=A),o}function vW(r,t){const e=BW(t);Object.defineProperties(r,{id:{writable:!0,value:e}})}function bW(r,t){for(const e in t)Object.defineProperty(r,e,{enumerable:!1,set(n){const i="".concat(this.id,": ").concat(e);for(const s of t[e])ww(this,s)||(this[s]=n);Pn.deprecated(i,t[e].join("/"))()}})}function wW(r,t){const e={},n={};for(const i in t){const s=t[i],{name:a,value:o}=s;s.async&&(e[a]=o,n[a]=xW(a))}r[cf]=e,r[Hh]={},Object.defineProperties(r,n)}function xW(r){return{enumerable:!0,set(t){typeof t=="string"||t instanceof Promise||bI(t)?this[Hh][r]=t:this[RA][r]=t},get(){if(this[RA]){if(r in this[RA])return this[RA][r]||this[cf][r];if(r in this[Hh]){const t=this[q0]&&this[q0].internalState;if(t&&t.hasAsyncProp(r))return t.getAsyncProp(r)||this[cf][r]}}return this[cf][r]}}}function ww(r,t){return Object.prototype.hasOwnProperty.call(r,t)}function MI(r,t){return ww(r,t)&&r[t]}function BW(r){const t=r.componentName;return t||Pn.warn("".concat(r.name,".componentName not specified"))(),t||r.name}let CW=0;class xw{constructor(){$(this,"id",void 0),$(this,"props",void 0),$(this,"count",void 0);for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this.props=mW(this,e),this.id=this.props.id,this.count=CW++}clone(t){const{props:e}=this,n={};for(const i in e[cf])i in e[RA]?n[i]=e[RA][i]:i in e[Hh]&&(n[i]=e[Hh][i]);return new this.constructor({...e,...n,...t})}}$(xw,"componentName","Component"),$(xw,"defaultProps",{});const EW=Object.freeze({});class SW{constructor(t){$(this,"component",void 0),$(this,"onAsyncPropUpdated",void 0),$(this,"asyncProps",void 0),$(this,"oldProps",void 0),$(this,"oldAsyncProps",void 0),this.component=t,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const t in this.asyncProps){const e=this.asyncProps[t];e&&e.type&&e.type.release&&e.type.release(e.resolvedValue,e.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||EW}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(t){return t in this.asyncProps}getAsyncProp(t){const e=this.asyncProps[t];return e&&e.resolvedValue}isAsyncPropLoading(t){if(t){const e=this.asyncProps[t];return!!(e&&e.pendingLoadCount>0&&e.pendingLoadCount!==e.resolvedLoadCount)}for(const e in this.asyncProps)if(this.isAsyncPropLoading(e))return!0;return!1}reloadAsyncProp(t,e){this._watchPromise(t,Promise.resolve(e))}setAsyncProps(t){this.component=t[q0]||this.component;const e=t[RA]||{},n=t[Hh]||t,i=t[cf]||{};for(const s in e){const a=e[s];this._createAsyncPropData(s,i[s]),this._updateAsyncProp(s,a),e[s]=this.getAsyncProp(s)}for(const s in n){const a=n[s];this._createAsyncPropData(s,i[s]),this._updateAsyncProp(s,a)}}_fetch(t,e){return null}_onResolve(t,e){}_onError(t,e){}_updateAsyncProp(t,e){if(this._didAsyncInputValueChange(t,e)){if(typeof e=="string"&&(e=this._fetch(t,e)),e instanceof Promise){this._watchPromise(t,e);return}if(bI(e)){this._resolveAsyncIterable(t,e);return}this._setPropValue(t,e)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const t in this.asyncProps)Object.defineProperty(this.oldAsyncProps,t,{enumerable:!0,value:this.oldProps[t]})}}_didAsyncInputValueChange(t,e){const n=this.asyncProps[t];return e===n.resolvedValue||e===n.lastValue?!1:(n.lastValue=e,!0)}_setPropValue(t,e){this._freezeAsyncOldProps();const n=this.asyncProps[t];n&&(e=this._postProcessValue(n,e),n.resolvedValue=e,n.pendingLoadCount++,n.resolvedLoadCount=n.pendingLoadCount)}_setAsyncPropValue(t,e,n){const i=this.asyncProps[t];i&&n>=i.resolvedLoadCount&&e!==void 0&&(this._freezeAsyncOldProps(),i.resolvedValue=e,i.resolvedLoadCount=n,this.onAsyncPropUpdated(t,e))}_watchPromise(t,e){const n=this.asyncProps[t];if(n){n.pendingLoadCount++;const i=n.pendingLoadCount;e.then(s=>{this.component&&(s=this._postProcessValue(n,s),this._setAsyncPropValue(t,s,i),this._onResolve(t,s))}).catch(s=>{this._onError(t,s)})}}async _resolveAsyncIterable(t,e){if(t!=="data"){this._setPropValue(t,e);return}const n=this.asyncProps[t];if(!n)return;n.pendingLoadCount++;const i=n.pendingLoadCount;let s=[],a=0;for await(const o of e){if(!this.component)return;const{dataTransform:A}=this.component.props;A?s=A(o,s):s=s.concat(o),Object.defineProperty(s,"__diff",{enumerable:!1,value:[{startRow:a,endRow:s.length}]}),a=s.length,this._setAsyncPropValue(t,s,i)}this._onResolve(t,s)}_postProcessValue(t,e){const n=t.type;return n&&this.component&&(n.release&&n.release(t.resolvedValue,n,this.component),n.transform)?n.transform(e,n,this.component):e}_createAsyncPropData(t,e){if(!this.asyncProps[t]){const i=this.component&&this.component.props[UA];this.asyncProps[t]={type:i&&i[t],lastValue:null,resolvedValue:e,pendingLoadCount:0,resolvedLoadCount:0}}}}class TW extends SW{constructor(t){let{attributeManager:e,layer:n}=t;super(n),$(this,"attributeManager",void 0),$(this,"needsRedraw",void 0),$(this,"needsUpdate",void 0),$(this,"subLayers",void 0),$(this,"usesPickingColorCache",void 0),$(this,"hasPickingBuffer",void 0),$(this,"changeFlags",void 0),$(this,"viewport",void 0),$(this,"uniformTransitions",void 0),$(this,"propsInTransition",void 0),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(t,e){const n=this.layer,i=n==null?void 0:n.props.fetch;return i?i(e,{propName:t,layer:n}):super._fetch(t,e)}_onResolve(t,e){const n=this.layer;if(n){const i=n.props.onDataLoad;t==="data"&&i&&i(e,{propName:t,layer:n})}}_onError(t,e){const n=this.layer;n&&n.raiseError(e,"loading ".concat(t," of ").concat(this.layer))}}const IW="layer.changeFlag",LW="layer.initialize",FW="layer.update",PW="layer.finalize",MW="layer.matched",UI=2**24-1,UW=Object.freeze([]),RW=dg(r=>{let{oldViewport:t,viewport:e}=r;return t.equals(e)});let Vl=new Uint8ClampedArray(0);const OW={data:{type:"data",value:UW,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:r=>r&&r.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(r,t)=>{let{propName:e,layer:n,loaders:i,loadOptions:s,signal:a}=t;const{resourceManager:o}=n.context;if(s=s||n.getLoadOptions(),i=i||n.props.loaders,a){var A;s={...s,fetch:{...(A=s)===null||A===void 0?void 0:A.fetch,signal:a}}}let f=o.contains(r);return!f&&!s&&(o.add({resourceId:r,data:TA(r,i),persistent:!1}),f=!0),f?o.subscribe({resourceId:r,onChange:m=>{var _;return(_=n.internalState)===null||_===void 0?void 0:_.reloadAsyncProp(e,m)},consumerId:n.id,requestId:e}):TA(r,i,s)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:Tn.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:r=>{let{layerIndex:t}=r;return[0,-t*100]}},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class Af extends xw{constructor(){super(...arguments),$(this,"internalState",null),$(this,"lifecycle",af.NO_STATE),$(this,"context",void 0),$(this,"state",void 0),$(this,"parent",null)}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let t=this;for(;t.parent;)t=t.parent;return t}toString(){const t=this.constructor.layerName||this.constructor.name;return"".concat(t,"({id: '").concat(this.props.id,"'})")}project(t){Ws(this.internalState);const e=this.internalState.viewport||this.context.viewport,n=q3(t,{viewport:e,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[i,s,a]=N3(n,e.pixelProjectionMatrix);return t.length===2?[i,s]:[i,s,a]}unproject(t){return Ws(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(t)}projectPosition(t,e){Ws(this.internalState);const n=this.internalState.viewport||this.context.viewport;return nK(t,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...e})}get isComposite(){return!1}setState(t){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,t),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){return this.state&&(this.state.models||this.state.model&&[this.state.model])||[]}setModuleParameters(t){for(const e of this.getModels())e.updateModuleSettings(t)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:t}=this.props;return t===Tn.DEFAULT||t===Tn.LNGLAT||t===Tn.CARTESIAN}onHover(t,e){return this.props.onHover&&this.props.onHover(t,e)||!1}onClick(t,e){return this.props.onClick&&this.props.onClick(t,e)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return e[0]=t+1&255,e[1]=t+1>>8&255,e[2]=t+1>>8>>8&255,e}decodePickingColor(t){Ws(t instanceof Uint8Array);const[e,n,i]=t;return e+n*256+i*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:aW(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var t;return(t=this.getAttributeManager())===null||t===void 0?void 0:t.getBounds(["positions","instancePositions"])}getShaders(t){for(const e of this.props.extensions)t=uW(t,e.getShaders.call(this,e));return t}shouldUpdateState(t){return t.changeFlags.propsOrDataChanged}updateState(t){const e=this.getAttributeManager(),{dataChanged:n}=t.changeFlags;if(n&&e)if(Array.isArray(n))for(const i of n)e.invalidateAll(i);else e.invalidateAll();if(e){const{props:i}=t,s=this.internalState.hasPickingBuffer,a=Number.isInteger(i.highlightedObjectIndex)||i.pickable||i.extensions.some(o=>o.getNeedsPickingBuffer.call(this,o));if(s!==a){this.internalState.hasPickingBuffer=a;const{pickingColors:o,instancePickingColors:A}=e.attributes,f=o||A;f&&(a&&f.constant&&(f.constant=!1,e.invalidate(f.id)),!f.value&&!a&&(f.constant=!0,f.value=[0,0,0]))}}}finalizeState(t){for(const n of this.getModels())n.delete();const e=this.getAttributeManager();e&&e.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(t){for(const e of this.getModels())e.draw(t)}getPickingInfo(t){let{info:e,mode:n,sourceLayer:i}=t;const{index:s}=e;return s>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[s]),e}raiseError(t,e){var n,i;if(e&&(t=new Error("".concat(e,": ").concat(t.message),{cause:t})),!((n=(i=this.props).onError)!==null&&n!==void 0&&n.call(i,t))){var s,a;(s=this.context)===null||s===void 0||(a=s.onError)===null||a===void 0||a.call(s,t,this)}}getNeedsRedraw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};return this._getNeedsRedraw(t)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var t;return((t=this.internalState)===null||t===void 0?void 0:t.uniformTransitions.active)||!1}activateViewport(t){if(!this.internalState)return;const e=this.internalState.viewport;this.internalState.viewport=t,(!e||!RW({oldViewport:e,viewport:t}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"all";const e=this.getAttributeManager();e&&(t==="all"?e.invalidateAll():e.invalidate(t))}updateAttributes(t){for(const e of this.getModels())this._setModelAttributes(e,t)}_updateAttributes(){const t=this.getAttributeManager();if(!t)return;const e=this.props,n=this.getNumInstances(),i=this.getStartIndices();t.update({data:e.data,numInstances:n,startIndices:i,props:e,transitions:e.transitions,buffers:e.data.attributes,context:this});const s=t.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(s)}_updateAttributeTransition(){const t=this.getAttributeManager();t&&t.updateTransition()}_updateUniformTransition(){const{uniformTransitions:t}=this.internalState;if(t.active){const e=t.update(),n=Object.create(this.props);for(const i in e)Object.defineProperty(n,i,{value:e[i]});return n}return this.props}calculateInstancePickingColors(t,e){let{numInstances:n}=e;if(t.constant)return;const i=Math.floor(Vl.length/3);if(this.internalState.usesPickingColorCache=!0,i<n){n>UI&&Pn.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),Vl=pg.allocate(Vl,n,{size:3,copy:!0,maxCount:Math.max(n,UI)});const s=Math.floor(Vl.length/3),a=[];for(let o=i;o<s;o++)this.encodePickingColor(o,a),Vl[o*3+0]=a[0],Vl[o*3+1]=a[1],Vl[o*3+2]=a[2]}t.value=Vl.subarray(0,n*3)}_setModelAttributes(t,e){const n=this.getAttributeManager(),i=t.userData.excludeAttributes||{},s=n.getShaderAttributes(e,i);t.setAttributes(s)}disablePickingIndex(t){const e=this.props.data;if(!("attributes"in e)){this._disablePickingIndex(t);return}const{pickingColors:n,instancePickingColors:i}=this.getAttributeManager().attributes,s=n||i,a=s&&e.attributes&&e.attributes[s.id];if(a&&a.value){const o=a.value,A=this.encodePickingColor(t);for(let f=0;f<e.length;f++){const m=s.getVertexOffset(f);o[m]===A[0]&&o[m+1]===A[1]&&o[m+2]===A[2]&&this._disablePickingIndex(f)}}else this._disablePickingIndex(t)}_disablePickingIndex(t){const{pickingColors:e,instancePickingColors:n}=this.getAttributeManager().attributes,i=e||n;if(!i)return;const s=i.getVertexOffset(t),a=i.getVertexOffset(t+1);i.buffer.subData({data:new Uint8Array(a-s),offset:s})}restorePickingColors(){const{pickingColors:t,instancePickingColors:e}=this.getAttributeManager().attributes,n=t||e;n&&(this.internalState.usesPickingColorCache&&n.value.buffer!==Vl.buffer&&(n.value=Vl.subarray(0,n.value.length)),n.updateSubBuffer({startOffset:0}))}_initialize(){Ws(!this.internalState),Ws(Number.isFinite(this.props.coordinateSystem)),lo(LW,this);const t=this._getAttributeManager();t&&t.addInstanced({instancePickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new TW({attributeManager:t,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(Pn.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),t)}),this.internalState.uniformTransitions=new Y$(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const e of this.props.extensions)e.initializeState.call(this,this.context,e);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(t){lo(MW,this,this===t);const{state:e,internalState:n}=t;this!==t&&(this.internalState=n,this.state=e,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const t=this.needsUpdate();if(lo(FW,this,t),!t)return;const e=this.props,n=this.context,i=this.internalState,s=n.viewport,a=this._updateUniformTransition();i.propsInTransition=a,n.viewport=i.viewport||s,this.props=a;try{const o=this._getUpdateParams(),A=this.getModels();if(n.gl)this.updateState(o);else try{this.updateState(o)}catch{}for(const m of this.props.extensions)m.updateState.call(this,o,m);const f=this.getModels()[0]!==A[0];this._postUpdate(o,f)}finally{n.viewport=s,this.props=e,this._clearChangeFlags(),i.needsUpdate=!1,i.resetOldProps()}}_finalize(){lo(PW,this),this.finalizeState(this.context);for(const t of this.props.extensions)t.finalizeState.call(this,this.context,t)}_drawLayer(t){let{moduleParameters:e=null,uniforms:n={},parameters:i={}}=t;this._updateAttributeTransition();const s=this.props,a=this.context;this.props=this.internalState.propsInTransition||s;const o=this.props.opacity;n.opacity=Math.pow(o,1/2.2);try{e&&this.setModuleParameters(e);const{getPolygonOffset:A}=this.props,f=A&&A(n)||[0,0];Iu(a.gl,{polygonOffset:f}),Qc(a.gl,i,()=>{const m={moduleParameters:e,uniforms:n,parameters:i,context:a};for(const _ of this.props.extensions)_.draw.call(this,m,_);this.draw(m)})}finally{this.props=s}}getChangeFlags(){var t;return(t=this.internalState)===null||t===void 0?void 0:t.changeFlags}setChangeFlags(t){if(!this.internalState)return;const{changeFlags:e}=this.internalState;for(const i in t)if(t[i]){let s=!1;switch(i){case"dataChanged":const a=t[i],o=e[i];a&&Array.isArray(o)&&(e.dataChanged=Array.isArray(a)?o.concat(a):a,s=!0);default:e[i]||(e[i]=t[i],s=!0)}s&&lo(IW,this,i,t)}const n=!!(e.dataChanged||e.updateTriggersChanged||e.propsChanged||e.extensionsChanged);e.propsOrDataChanged=n,e.somethingChanged=n||e.viewportChanged||e.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(t,e){const n=tW(t,e);if(n.updateTriggersChanged)for(const s in n.updateTriggersChanged)n.updateTriggersChanged[s]&&this.invalidateAttribute(s);if(n.transitionsChanged)for(const s in n.transitionsChanged){var i;this.internalState.uniformTransitions.add(s,e[s],t[s],(i=t.transitions)===null||i===void 0?void 0:i[s])}return this.setChangeFlags(n)}validateProps(){Z$(this.props)}updateAutoHighlight(t){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(t)}_updateAutoHighlight(t){const e={pickingSelectedColor:t.picked?t.color:null},{highlightColor:n}=this.props;t.picked&&typeof n=="function"&&(e.pickingHighlightColor=n(t)),this.setModuleParameters(e),this.setNeedsRedraw()}_getAttributeManager(){const t=this.context;return new K$(t.gl,{id:this.props.id,stats:t.stats,timeline:t.timeline})}_postUpdate(t,e){const{props:n,oldProps:i}=t;this.setNeedsRedraw(),this._updateAttributes();const{model:s}=this.state;s==null||s.setInstanceCount(this.getNumInstances());const{autoHighlight:a,highlightedObjectIndex:o,highlightColor:A}=n;if(e||i.autoHighlight!==a||i.highlightedObjectIndex!==o||i.highlightColor!==A){const f={};a||(f.pickingSelectedColor=null),Array.isArray(A)&&(f.pickingHighlightColor=A),(e||o!==i.highlightedObjectIndex)&&(f.pickingSelectedColor=Number.isFinite(o)&&o>=0?this.encodePickingColor(o):null),this.setModuleParameters(f)}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(t){if(!this.internalState)return!1;let e=!1;e=e||this.internalState.needsRedraw&&this.id;const n=this.getAttributeManager(),i=n?n.getNeedsRedraw(t):!1;if(e=e||i,e)for(const s of this.props.extensions)s.onNeedsRedraw.call(this,s);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!t.clearRedrawFlags,e}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}$(Af,"defaultProps",OW),$(Af,"layerName","Layer");const DW="compositeLayer.renderLayers";class RI extends Af{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(t=>t.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(t){}setState(t){super.setState(t),this.setNeedsUpdate()}getPickingInfo(t){let{info:e}=t;const{object:n}=e;return n&&n.__source&&n.__source.parent&&n.__source.parent.id===this.id&&(e.object=n.__source.object,e.index=n.__source.index),e}filterSubLayer(t){return!0}shouldRenderSubLayer(t,e){return e&&e.length}getSubLayerClass(t,e){const{_subLayerProps:n}=this.props;return n&&n[t]&&n[t].type||e}getSubLayerRow(t,e,n){return t.__source={parent:this,object:e,index:n},t}getSubLayerAccessor(t){if(typeof t=="function"){const e={index:-1,data:this.props.data,target:[]};return(n,i)=>n&&n.__source?(e.index=n.__source.index,t(n.__source.object,e)):t(n,i)}return t}getSubLayerProps(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};var e;const{opacity:n,pickable:i,visible:s,parameters:a,getPolygonOffset:o,highlightedObjectIndex:A,autoHighlight:f,highlightColor:m,coordinateSystem:_,coordinateOrigin:x,wrapLongitude:B,positionFormat:P,modelMatrix:M,extensions:k,fetch:Q,operation:q,_subLayerProps:J}=this.props,tt={id:"",updateTriggers:{},opacity:n,pickable:i,visible:s,parameters:a,getPolygonOffset:o,highlightedObjectIndex:A,autoHighlight:f,highlightColor:m,coordinateSystem:_,coordinateOrigin:x,wrapLongitude:B,positionFormat:P,modelMatrix:M,extensions:k,fetch:Q,operation:q},ft=J&&t.id&&J[t.id],pt=ft&&ft.updateTriggers,mt=t.id||"sublayer";if(ft){const dt=this.props[UA],Rt=t.type?t.type._propTypes:{};for(const Lt in ft){const st=Rt[Lt]||dt[Lt];st&&st.type==="accessor"&&(ft[Lt]=this.getSubLayerAccessor(ft[Lt]))}}Object.assign(tt,t,ft),tt.id="".concat(this.props.id,"-").concat(mt),tt.updateTriggers={all:(e=this.props.updateTriggers)===null||e===void 0?void 0:e.all,...t.updateTriggers,...pt};for(const dt of k){const Rt=dt.getSubLayerProps.call(this,dt);Rt&&Object.assign(tt,Rt,{updateTriggers:Object.assign(tt.updateTriggers,Rt.updateTriggers)})}return tt}_updateAutoHighlight(t){for(const e of this.getSubLayers())e.updateAutoHighlight(t)}_getAttributeManager(){return null}_postUpdate(t,e){let n=this.internalState.subLayers;const i=!n||this.needsUpdate();if(i){const s=this.renderLayers();n=K0(s,Boolean),this.internalState.subLayers=n}lo(DW,this,i,n);for(const s of n)s.parent=this}}$(RI,"layerName","CompositeLayer");const Bw=512,NW=Math.PI/180;function kW(r){let{map:t,gl:e,deck:n}=r;if(t.__deck)return t.__deck;const i=n==null?void 0:n.props._customRender,s=n==null?void 0:n.props.onLoad,a=HW({...n==null?void 0:n.props,_customRender:()=>{t.triggerRepaint(),i==null||i("")}});let o;return(!n||n.props.gl===e)&&(Object.assign(a,{gl:e,width:null,height:null,touchAction:"unset",viewState:Cw(t)}),n!=null&&n.isInitialized?OI(n,t):a.onLoad=()=>{s==null||s(),OI(o,t)}),n?(o=n,n.setProps(a),n.userData.isExternal=!0):(o=new dw(a),t.on("remove",()=>{QW(t)})),o.userData.mapboxLayers=new Set,t.__deck=o,t.on("render",()=>{o.isInitialized&&KW(o,t)}),o}function OI(r,t){const e=()=>{r.isInitialized?$W(r,t):t.off("move",e)};t.on("move",e)}function QW(r){var t;(t=r.__deck)===null||t===void 0||t.finalize(),r.__deck=null}function HW(r){return{...r,parameters:{depthMask:!0,depthTest:!0,blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthFunc:515,blendEquation:32774,...r.parameters},views:r.views||[new ow({id:"mapbox"})]}}function zW(r,t){r.userData.mapboxLayers.add(t),Ew(r)}function GW(r,t){r.userData.mapboxLayers.delete(t),Ew(r)}function VW(r,t){Ew(r)}function jW(r,t,e){let{currentViewport:n}=r.userData,i=!1;n||(n=DI(r,t,!0),r.userData.currentViewport=n,i=!0),r.isInitialized&&r._drawLayers("mapbox-repaint",{viewports:[n],layerFilter:s=>{let{layer:a}=s;return e.id===a.id||a.props.operation.includes("terrain")},clearStack:i,clearCanvas:!1})}function Cw(r){var t;const{lng:e,lat:n}=r.getCenter(),i={longitude:(e+540)%360-180,latitude:n,zoom:r.getZoom(),bearing:r.getBearing(),pitch:r.getPitch(),padding:r.getPadding(),repeat:r.getRenderWorldCopies()};return(t=r.getTerrain)!==null&&t!==void 0&&t.call(r)&&qW(r,i),i}function qW(r,t){if(r.getFreeCameraOptions){const{position:e}=r.getFreeCameraOptions();if(!e||e.z===void 0)return;const n=r.transform.height,{longitude:i,latitude:s,pitch:a}=t,o=e.x*Bw,A=(1-e.y)*Bw,f=e.z*Bw,m=fg([i,s]),_=o-m[0],x=A-m[1],B=Math.sqrt(_*_+x*x),P=a*NW,M=1.5*n,k=P<.001?M*Math.cos(P)/f:M*Math.sin(P)/B;t.zoom=Math.log2(k);const Q=M*Math.cos(P)/k,q=f-Q;t.position=[0,0,q/V0(s)]}else typeof r.transform.elevation=="number"&&(t.position=[0,0,r.transform.elevation])}function DI(r,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return new Qh({id:"mapbox",x:0,y:0,width:r.width,height:r.height,...Cw(t),nearZMultiplier:e?.02:.1,nearZ:t.transform._nearZ/t.transform.height,farZ:t.transform._farZ/t.transform.height})}function KW(r,t){const{mapboxLayers:e,isExternal:n}=r.userData;if(n){const i=Array.from(e,m=>m.id),a=K0(r.props.layers,Boolean).some(m=>m&&!i.includes(m.id));let o=r.getViewports();const A=o.findIndex(m=>m.id==="mapbox"),f=o.length>1||A<0;(a||f)&&(A>=0&&(o=o.slice(),o[A]=DI(r,t,!1)),r._drawLayers("mapbox-repaint",{viewports:o,layerFilter:m=>(!r.props.layerFilter||r.props.layerFilter(m))&&(m.viewport.id!=="mapbox"||!i.includes(m.layer.id)),clearCanvas:!1}))}r.userData.currentViewport=null}function $W(r,t){r.setProps({viewState:Cw(t)}),r.needsRedraw({clearRedrawFlags:!0})}function Ew(r){if(r.userData.isExternal)return;const t=[];r.userData.mapboxLayers.forEach(e=>{const n=e.props.type,i=new n(e.props);t.push(i)}),r.setProps({layers:t})}class WW{constructor(t){if($(this,"id",void 0),$(this,"type",void 0),$(this,"renderingMode",void 0),$(this,"map",void 0),$(this,"deck",void 0),$(this,"props",void 0),!t.id)throw new Error("Layer must have an unique id");this.id=t.id,this.type="custom",this.renderingMode=t.renderingMode||"3d",this.map=null,this.deck=null,this.props=t}onAdd(t,e){this.map=t,this.deck=kW({map:t,gl:e,deck:this.props.deck}),zW(this.deck,this)}onRemove(){this.deck&&GW(this.deck,this)}setProps(t){Object.assign(this.props,t,{id:this.id}),this.deck&&VW(this.deck)}render(){jW(this.deck,this.map,this)}}const XW=`#define SHADER_NAME point-cloud-layer-vertex-shader

attribute vec3 positions;
attribute vec3 instanceNormals;
attribute vec4 instanceColors;
attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute vec3 instancePickingColors;

uniform float opacity;
uniform float radiusPixels;
uniform int sizeUnits;

varying vec4 vColor;
varying vec2 unitPosition;

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.normal = project_normal(instanceNormals);
  unitPosition = positions.xy;
  geometry.uv = unitPosition;
  geometry.pickingColor = instancePickingColors;
  vec3 offset = vec3(positions.xy * project_size_to_pixel(radiusPixels, sizeUnits), 0.0);
  DECKGL_FILTER_SIZE(offset, geometry);

  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
  vColor = vec4(lightColor, instanceColors.a * opacity);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,JW=`#define SHADER_NAME point-cloud-layer-fragment-shader

precision highp float;

varying vec4 vColor;
varying vec2 unitPosition;

void main(void) {
  geometry.uv = unitPosition;

  float distToCenter = length(unitPosition);

  if (distToCenter > 1.0) {
    discard;
  }

  gl_FragColor = vColor;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,NI=[0,0,0,255],kI=[0,0,1],YW={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:r=>r.position},getNormal:{type:"accessor",value:kI},getColor:{type:"accessor",value:NI},material:!0,radiusPixels:{deprecatedFor:"pointSize"}};function ZW(r){const{header:t,attributes:e}=r;!t||!e||(r.length=t.vertexCount,e.POSITION&&(e.instancePositions=e.POSITION),e.NORMAL&&(e.instanceNormals=e.NORMAL),e.COLOR_0&&(e.instanceColors=e.COLOR_0))}class Sw extends Af{getShaders(){return super.getShaders({vs:XW,fs:JW,modules:[nw,Ej,iw]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:kI},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:NI}})}updateState(t){const{changeFlags:e,props:n}=t;if(super.updateState(t),e.extensionsChanged){var i;const{gl:s}=this.context;(i=this.state.model)===null||i===void 0||i.delete(),this.state.model=this._getModel(s),this.getAttributeManager().invalidateAll()}e.dataChanged&&ZW(n.data)}draw(t){let{uniforms:e}=t;const{pointSize:n,sizeUnits:i}=this.props;this.state.model.setUniforms(e).setUniforms({sizeUnits:Zv[i],radiusPixels:n}).draw()}_getModel(t){const e=[];for(let n=0;n<3;n++){const i=n/3*Math.PI*2;e.push(Math.cos(i)*2,Math.sin(i)*2,0)}return new tf(t,{...this.getShaders(),id:this.props.id,geometry:new hg({drawMode:4,attributes:{positions:new Float32Array(e)}}),isInstanced:!0})}}$(Sw,"layerName","PointCloudLayer"),$(Sw,"defaultProps",YW);const Ra={OUTSIDE:-1,INTERSECTING:0,INSIDE:1};new le,new le;const bg=new le,QI=new le;class wg{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,0],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;$(this,"center",void 0),$(this,"radius",void 0),this.radius=-0,this.center=new le,this.fromCenterRadius(t,e)}fromCenterRadius(t,e){return this.center.from(t),this.radius=e,this}fromCornerPoints(t,e){return e=bg.from(e),this.center=new le().from(t).add(e).scale(.5),this.radius=this.center.distance(e),this}equals(t){return this===t||!!t&&this.center.equals(t.center)&&this.radius===t.radius}clone(){return new wg(this.center,this.radius)}union(t){const e=this.center,n=this.radius,i=t.center,s=t.radius,a=bg.copy(i).subtract(e),o=a.magnitude();if(n>=o+s)return this.clone();if(s>=o+n)return t.clone();const A=(n+o+s)*.5;return QI.copy(a).scale((-n+A)/o).add(e),this.center.copy(QI),this.radius=A,this}expand(t){const n=bg.from(t).subtract(this.center).magnitude();return n>this.radius&&(this.radius=n),this}transform(t){this.center.transform(t);const e=OV(bg,t);return this.radius=Math.max(e[0],Math.max(e[1],e[2]))*this.radius,this}distanceSquaredTo(t){const e=this.distanceTo(t);return e*e}distanceTo(t){const n=bg.from(t).subtract(this.center);return Math.max(0,n.len()-this.radius)}intersectPlane(t){const e=this.center,n=this.radius,s=t.normal.dot(e)+t.distance;return s<-n?Ra.OUTSIDE:s<n?Ra.INTERSECTING:Ra.INSIDE}}const tX=new le,eX=new le,ty=new le,ey=new le,ry=new le,rX=new le,nX=new le,Ou={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class xg{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,0],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0,0,0,0,0,0,0];$(this,"center",void 0),$(this,"halfAxes",void 0),this.center=new le().from(t),this.halfAxes=new zi(e)}get halfSize(){const t=this.halfAxes.getColumn(0),e=this.halfAxes.getColumn(1),n=this.halfAxes.getColumn(2);return[new le(t).len(),new le(e).len(),new le(n).len()]}get quaternion(){const t=this.halfAxes.getColumn(0),e=this.halfAxes.getColumn(1),n=this.halfAxes.getColumn(2),i=new le(t).normalize(),s=new le(e).normalize(),a=new le(n).normalize();return new lg().fromMatrix3(new zi([...i,...s,...a]))}fromCenterHalfSizeQuaternion(t,e,n){const i=new lg(n),s=new zi().fromQuaternion(i);return s[0]=s[0]*e[0],s[1]=s[1]*e[0],s[2]=s[2]*e[0],s[3]=s[3]*e[1],s[4]=s[4]*e[1],s[5]=s[5]*e[1],s[6]=s[6]*e[2],s[7]=s[7]*e[2],s[8]=s[8]*e[2],this.center=new le().from(t),this.halfAxes=s,this}clone(){return new xg(this.center,this.halfAxes)}equals(t){return this===t||!!t&&this.center.equals(t.center)&&this.halfAxes.equals(t.halfAxes)}getBoundingSphere(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:new wg;const e=this.halfAxes,n=e.getColumn(0,ty),i=e.getColumn(1,ey),s=e.getColumn(2,ry),a=tX.copy(n).add(i).add(s);return t.center.copy(this.center),t.radius=a.magnitude(),t}intersectPlane(t){const e=this.center,n=t.normal,i=this.halfAxes,s=n.x,a=n.y,o=n.z,A=Math.abs(s*i[Ou.COLUMN0ROW0]+a*i[Ou.COLUMN0ROW1]+o*i[Ou.COLUMN0ROW2])+Math.abs(s*i[Ou.COLUMN1ROW0]+a*i[Ou.COLUMN1ROW1]+o*i[Ou.COLUMN1ROW2])+Math.abs(s*i[Ou.COLUMN2ROW0]+a*i[Ou.COLUMN2ROW1]+o*i[Ou.COLUMN2ROW2]),f=n.dot(e)+t.distance;return f<=-A?Ra.OUTSIDE:f>=A?Ra.INSIDE:Ra.INTERSECTING}distanceTo(t){return Math.sqrt(this.distanceSquaredTo(t))}distanceSquaredTo(t){const e=eX.from(t).subtract(this.center),n=this.halfAxes,i=n.getColumn(0,ty),s=n.getColumn(1,ey),a=n.getColumn(2,ry),o=i.magnitude(),A=s.magnitude(),f=a.magnitude();i.normalize(),s.normalize(),a.normalize();let m=0,_;return _=Math.abs(e.dot(i))-o,_>0&&(m+=_*_),_=Math.abs(e.dot(s))-A,_>0&&(m+=_*_),_=Math.abs(e.dot(a))-f,_>0&&(m+=_*_),m}computePlaneDistances(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[-0,-0],i=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY;const a=this.center,o=this.halfAxes,A=o.getColumn(0,ty),f=o.getColumn(1,ey),m=o.getColumn(2,ry),_=rX.copy(A).add(f).add(m).add(a),x=nX.copy(_).subtract(t);let B=e.dot(x);return i=Math.min(B,i),s=Math.max(B,s),_.copy(a).add(A).add(f).subtract(m),x.copy(_).subtract(t),B=e.dot(x),i=Math.min(B,i),s=Math.max(B,s),_.copy(a).add(A).subtract(f).add(m),x.copy(_).subtract(t),B=e.dot(x),i=Math.min(B,i),s=Math.max(B,s),_.copy(a).add(A).subtract(f).subtract(m),x.copy(_).subtract(t),B=e.dot(x),i=Math.min(B,i),s=Math.max(B,s),a.copy(_).subtract(A).add(f).add(m),x.copy(_).subtract(t),B=e.dot(x),i=Math.min(B,i),s=Math.max(B,s),a.copy(_).subtract(A).add(f).subtract(m),x.copy(_).subtract(t),B=e.dot(x),i=Math.min(B,i),s=Math.max(B,s),a.copy(_).subtract(A).subtract(f).add(m),x.copy(_).subtract(t),B=e.dot(x),i=Math.min(B,i),s=Math.max(B,s),a.copy(_).subtract(A).subtract(f).subtract(m),x.copy(_).subtract(t),B=e.dot(x),i=Math.min(B,i),s=Math.max(B,s),n[0]=i,n[1]=s,n}transform(t){this.center.transformAsPoint(t);const e=this.halfAxes.getColumn(0,ty);e.transformAsPoint(t);const n=this.halfAxes.getColumn(1,ey);n.transformAsPoint(t);const i=this.halfAxes.getColumn(2,ry);return i.transformAsPoint(t),this.halfAxes=new zi([...e,...n,...i]),this}getTransform(){throw new Error("not implemented")}}const HI=new le,zI=new le;class jc{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,1],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;$(this,"normal",void 0),$(this,"distance",void 0),this.normal=new le,this.distance=-0,this.fromNormalDistance(t,e)}fromNormalDistance(t,e){return Hc(Number.isFinite(e)),this.normal.from(t).normalize(),this.distance=e,this}fromPointNormal(t,e){t=HI.from(t),this.normal.from(e).normalize();const n=-this.normal.dot(t);return this.distance=n,this}fromCoefficients(t,e,n,i){return this.normal.set(t,e,n),Hc(zc(this.normal.len(),1)),this.distance=i,this}clone(){return new jc(this.normal,this.distance)}equals(t){return zc(this.distance,t.distance)&&zc(this.normal,t.normal)}getPointDistance(t){return this.normal.dot(t)+this.distance}transform(t){const e=zI.copy(this.normal).transformAsVector(t).normalize(),n=this.normal.scale(-this.distance).transform(t);return this.fromPointNormal(n,e)}projectPointOntoPlane(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];t=HI.from(t);const n=this.getPointDistance(t),i=zI.copy(this.normal).scale(n);return t.subtract(i).to(e)}}const GI=[new le([1,0,0]),new le([0,1,0]),new le([0,0,1])],VI=new le,iX=new le;new jc(new le(1,0,0),0);class sc{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];$(this,"planes",void 0),this.planes=t}fromBoundingSphere(t){this.planes.length=2*GI.length;const e=t.center,n=t.radius;let i=0;for(const s of GI){let a=this.planes[i],o=this.planes[i+1];a||(a=this.planes[i]=new jc),o||(o=this.planes[i+1]=new jc);const A=VI.copy(s).scale(-n).add(e);-s.dot(A),a.fromPointNormal(A,s);const f=VI.copy(s).scale(n).add(e),m=iX.copy(s).negate();-m.dot(f),o.fromPointNormal(f,m),i+=2}return this}computeVisibility(t){let e=Ra.INSIDE;for(const n of this.planes)switch(t.intersectPlane(n)){case Ra.OUTSIDE:return Ra.OUTSIDE;case Ra.INTERSECTING:e=Ra.INTERSECTING;break}return e}computeVisibilityWithPlaneMask(t,e){if(Hc(Number.isFinite(e),"parentPlaneMask is required."),e===sc.MASK_OUTSIDE||e===sc.MASK_INSIDE)return e;let n=sc.MASK_INSIDE;const i=this.planes;for(let s=0;s<this.planes.length;++s){const a=s<31?1<<s:0;if(s<31&&!(e&a))continue;const o=i[s],A=t.intersectPlane(o);if(A===Ra.OUTSIDE)return sc.MASK_OUTSIDE;A===Ra.INTERSECTING&&(n|=a)}return n}}$(sc,"MASK_OUTSIDE",4294967295),$(sc,"MASK_INSIDE",0),$(sc,"MASK_INDETERMINATE",2147483647),new le,new le,new le,new le,new le,new le,new le,new le,new le,new le,new le,new le,new le,new le,new le,new le,new le;const jl=new zi,sX=new zi,oX=new zi,ny=new zi,jI=new zi;function aX(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const e=ug.EPSILON20,n=10;let i=0,s=0;const a=sX,o=oX;a.identity(),o.copy(r);const A=e*cX(o);for(;s<n&&lX(o)>A;)uX(o,ny),jI.copy(ny).transpose(),o.multiplyRight(ny),o.multiplyLeft(jI),a.multiplyRight(ny),++i>2&&(++s,i=0);return t.unitary=a.toTarget(t.unitary),t.diagonal=o.toTarget(t.diagonal),t}function cX(r){let t=0;for(let e=0;e<9;++e){const n=r[e];t+=n*n}return Math.sqrt(t)}const Tw=[1,0,0],Iw=[2,2,1];function lX(r){let t=0;for(let e=0;e<3;++e){const n=r[jl.getElementIndex(Iw[e],Tw[e])];t+=2*n*n}return Math.sqrt(t)}function uX(r,t){const e=ug.EPSILON15;let n=0,i=1;for(let f=0;f<3;++f){const m=Math.abs(r[jl.getElementIndex(Iw[f],Tw[f])]);m>n&&(i=f,n=m)}const s=Tw[i],a=Iw[i];let o=1,A=0;if(Math.abs(r[jl.getElementIndex(a,s)])>e){const f=r[jl.getElementIndex(a,a)],m=r[jl.getElementIndex(s,s)],_=r[jl.getElementIndex(a,s)],x=(f-m)/2/_;let B;x<0?B=-1/(-x+Math.sqrt(1+x*x)):B=1/(x+Math.sqrt(1+x*x)),o=1/Math.sqrt(1+B*B),A=B*o}return zi.IDENTITY.to(t),t[jl.getElementIndex(s,s)]=t[jl.getElementIndex(a,a)]=o,t[jl.getElementIndex(a,s)]=A,t[jl.getElementIndex(s,a)]=-A,t}const kA=new le,AX=new le,hX=new le,dX=new le,fX=new le,pX=new zi,gX={diagonal:new zi,unitary:new zi};function mX(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new xg;if(!r||r.length===0)return t.halfAxes=new zi([0,0,0,0,0,0,0,0,0]),t.center=new le,t;const e=r.length,n=new le(0,0,0);for(const Rt of r)n.add(Rt);const i=1/e;n.multiplyByScalar(i);let s=0,a=0,o=0,A=0,f=0,m=0;for(const Rt of r){const Lt=kA.copy(Rt).subtract(n);s+=Lt.x*Lt.x,a+=Lt.x*Lt.y,o+=Lt.x*Lt.z,A+=Lt.y*Lt.y,f+=Lt.y*Lt.z,m+=Lt.z*Lt.z}s*=i,a*=i,o*=i,A*=i,f*=i,m*=i;const _=pX;_[0]=s,_[1]=a,_[2]=o,_[3]=a,_[4]=A,_[5]=f,_[6]=o,_[7]=f,_[8]=m;const{unitary:x}=aX(_,gX),B=t.halfAxes.copy(x);let P=B.getColumn(0,hX),M=B.getColumn(1,dX),k=B.getColumn(2,fX),Q=-Number.MAX_VALUE,q=-Number.MAX_VALUE,J=-Number.MAX_VALUE,tt=Number.MAX_VALUE,ft=Number.MAX_VALUE,pt=Number.MAX_VALUE;for(const Rt of r)kA.copy(Rt),Q=Math.max(kA.dot(P),Q),q=Math.max(kA.dot(M),q),J=Math.max(kA.dot(k),J),tt=Math.min(kA.dot(P),tt),ft=Math.min(kA.dot(M),ft),pt=Math.min(kA.dot(k),pt);P=P.multiplyByScalar(.5*(tt+Q)),M=M.multiplyByScalar(.5*(ft+q)),k=k.multiplyByScalar(.5*(pt+J)),t.center.copy(P).add(M).add(k);const mt=AX.set(Q-tt,q-ft,J-pt).multiplyByScalar(.5),dt=new zi([mt[0],0,0,0,mt[1],0,0,0,mt[2]]);return t.halfAxes.multiplyRight(dt),t}const Lw=Math.PI/180,iy=new Float32Array(16),qI=new Float32Array(12);function KI(r,t,e){const n=t[0]*Lw,i=t[1]*Lw,s=t[2]*Lw,a=Math.sin(s),o=Math.sin(n),A=Math.sin(i),f=Math.cos(s),m=Math.cos(n),_=Math.cos(i),x=e[0],B=e[1],P=e[2];r[0]=x*_*m,r[1]=x*A*m,r[2]=x*-o,r[3]=B*(-A*f+_*o*a),r[4]=B*(_*f+A*o*a),r[5]=B*m*a,r[6]=P*(A*a+_*o*f),r[7]=P*(-_*a+A*o*f),r[8]=P*m*f}function $I(r){return r[0]=r[0],r[1]=r[1],r[2]=r[2],r[3]=r[4],r[4]=r[5],r[5]=r[6],r[6]=r[8],r[7]=r[9],r[8]=r[10],r[9]=r[12],r[10]=r[13],r[11]=r[14],r.subarray(0,12)}const WI={size:12,accessor:["getOrientation","getScale","getTranslation","getTransformMatrix"],shaderAttributes:{instanceModelMatrix__LOCATION_0:{size:3,elementOffset:0},instanceModelMatrix__LOCATION_1:{size:3,elementOffset:3},instanceModelMatrix__LOCATION_2:{size:3,elementOffset:6},instanceTranslation:{size:3,elementOffset:9}},update(r,t){let{startRow:e,endRow:n}=t;const{data:i,getOrientation:s,getScale:a,getTranslation:o,getTransformMatrix:A}=this.props,f=Array.isArray(A),m=f&&A.length===16,_=Array.isArray(a),x=Array.isArray(s),B=Array.isArray(o),P=m||!f&&!!A(i[0]);P?r.constant=m:r.constant=x&&_&&B;const M=r.value;if(r.constant){let k;P?(iy.set(A),k=$I(iy)):(k=qI,KI(k,s,a),k.set(o,9)),r.value=new Float32Array(k)}else{let k=e*r.size;const{iterable:Q,objectInfo:q}=vI(i,e,n);for(const J of Q){q.index++;let tt;if(P)iy.set(m?A:A(J,q)),tt=$I(iy);else{tt=qI;const ft=x?s:s(J,q),pt=_?a:a(J,q);KI(tt,ft,pt),tt.set(B?o:o(J,q),9)}M[k++]=tt[0],M[k++]=tt[1],M[k++]=tt[2],M[k++]=tt[3],M[k++]=tt[4],M[k++]=tt[5],M[k++]=tt[6],M[k++]=tt[7],M[k++]=tt[8],M[k++]=tt[9],M[k++]=tt[10],M[k++]=tt[11]}}}};function XI(r,t){return t===Tn.CARTESIAN||t===Tn.METER_OFFSETS||t===Tn.DEFAULT&&!r.isGeospatial}const yX=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
uniform float sizeScale;
uniform bool composeModelMatrix;
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
in vec3 instanceTranslation;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = texCoords;
  geometry.pickingColor = instancePickingColors;

  vTexCoord = texCoords;
  cameraPosition = project_uCameraPosition;
  vColor = vec4(colors * instanceColors.rgb, instanceColors.a);

  vec3 pos = (instanceModelMatrix * positions) * sizeScale + instanceTranslation;

  if (composeModelMatrix) {
    DECKGL_FILTER_SIZE(pos, geometry);
    normals_commonspace = project_normal(instanceModelMatrix * normals);
    geometry.worldPosition += pos;
    gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), position_commonspace);
    geometry.position = position_commonspace;
  }
  else {
    pos = project_size(pos);
    DECKGL_FILTER_SIZE(pos, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, position_commonspace);
    geometry.position = position_commonspace;
    normals_commonspace = project_normal(instanceModelMatrix * normals);
  }

  geometry.normal = normals_commonspace;
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,_X=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs

precision highp float;

uniform bool hasTexture;
uniform sampler2D sampler;
uniform bool flatShading;
uniform float opacity;

in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;

out vec4 fragColor;

void main(void) {
  geometry.uv = vTexCoord;

  vec3 normal;
  if (flatShading) {
#ifdef DERIVATIVES_AVAILABLE
    normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
#else
    normal = vec3(0.0, 0.0, 1.0);
#endif
  } else {
    normal = normals_commonspace;
  }

  vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;
  DECKGL_FILTER_COLOR(color, geometry);

  vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
  fragColor = vec4(lightColor, color.a * opacity);
}
`;function JI(r){let t=1/0,e=1/0,n=1/0,i=-1/0,s=-1/0,a=-1/0;const o=r.POSITION?r.POSITION.value:[],A=o&&o.length;for(let f=0;f<A;f+=3){const m=o[f],_=o[f+1],x=o[f+2];t=m<t?m:t,e=_<e?_:e,n=x<n?x:n,i=m>i?m:i,s=_>s?_:s,a=x>a?x:a}return[[t,e,n],[i,s,a]]}function vX(r,t){if(!r)throw new Error(t||"loader assertion failed.")}class hf{constructor(t,e){$(this,"fields",void 0),$(this,"metadata",void 0),vX(Array.isArray(t)),bX(t),this.fields=t,this.metadata=e||new Map}compareTo(t){if(this.metadata!==t.metadata||this.fields.length!==t.fields.length)return!1;for(let e=0;e<this.fields.length;++e)if(!this.fields[e].compareTo(t.fields[e]))return!1;return!0}select(){const t=Object.create(null);for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];for(const a of n)t[a]=!0;const s=this.fields.filter(a=>t[a.name]);return new hf(s,this.metadata)}selectAt(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=e.map(s=>this.fields[s]).filter(Boolean);return new hf(i,this.metadata)}assign(t){let e,n=this.metadata;if(t instanceof hf){const a=t;e=a.fields,n=YI(YI(new Map,this.metadata),a.metadata)}else e=t;const i=Object.create(null);for(const a of this.fields)i[a.name]=a;for(const a of e)i[a.name]=a;const s=Object.values(i);return new hf(s,n)}}function bX(r){const t={};for(const e of r)t[e.name]&&console.warn("Schema: duplicated field name",e.name,e),t[e.name]=!0}function YI(r,t){return new Map([...r||new Map,...t||new Map])}class sy{constructor(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:new Map;$(this,"name",void 0),$(this,"type",void 0),$(this,"nullable",void 0),$(this,"metadata",void 0),this.name=t,this.type=e,this.nullable=n,this.metadata=i}get typeId(){return this.type&&this.type.typeId}clone(){return new sy(this.name,this.type,this.nullable,this.metadata)}compareTo(t){return this.name===t.name&&this.type===t.type&&this.nullable===t.nullable&&this.metadata===t.metadata}toString(){return"".concat(this.type).concat(this.nullable?", nullable":"").concat(this.metadata?", metadata: ".concat(this.metadata):"")}}let Gi=function(r){return r[r.NONE=0]="NONE",r[r.Null=1]="Null",r[r.Int=2]="Int",r[r.Float=3]="Float",r[r.Binary=4]="Binary",r[r.Utf8=5]="Utf8",r[r.Bool=6]="Bool",r[r.Decimal=7]="Decimal",r[r.Date=8]="Date",r[r.Time=9]="Time",r[r.Timestamp=10]="Timestamp",r[r.Interval=11]="Interval",r[r.List=12]="List",r[r.Struct=13]="Struct",r[r.Union=14]="Union",r[r.FixedSizeBinary=15]="FixedSizeBinary",r[r.FixedSizeList=16]="FixedSizeList",r[r.Map=17]="Map",r[r.Dictionary=-1]="Dictionary",r[r.Int8=-2]="Int8",r[r.Int16=-3]="Int16",r[r.Int32=-4]="Int32",r[r.Int64=-5]="Int64",r[r.Uint8=-6]="Uint8",r[r.Uint16=-7]="Uint16",r[r.Uint32=-8]="Uint32",r[r.Uint64=-9]="Uint64",r[r.Float16=-10]="Float16",r[r.Float32=-11]="Float32",r[r.Float64=-12]="Float64",r[r.DateDay=-13]="DateDay",r[r.DateMillisecond=-14]="DateMillisecond",r[r.TimestampSecond=-15]="TimestampSecond",r[r.TimestampMillisecond=-16]="TimestampMillisecond",r[r.TimestampMicrosecond=-17]="TimestampMicrosecond",r[r.TimestampNanosecond=-18]="TimestampNanosecond",r[r.TimeSecond=-19]="TimeSecond",r[r.TimeMillisecond=-20]="TimeMillisecond",r[r.TimeMicrosecond=-21]="TimeMicrosecond",r[r.TimeNanosecond=-22]="TimeNanosecond",r[r.DenseUnion=-23]="DenseUnion",r[r.SparseUnion=-24]="SparseUnion",r[r.IntervalDayTime=-25]="IntervalDayTime",r[r.IntervalYearMonth=-26]="IntervalYearMonth",r}({}),ZI,tL,eL;class Fw{static isNull(t){return t&&t.typeId===Gi.Null}static isInt(t){return t&&t.typeId===Gi.Int}static isFloat(t){return t&&t.typeId===Gi.Float}static isBinary(t){return t&&t.typeId===Gi.Binary}static isUtf8(t){return t&&t.typeId===Gi.Utf8}static isBool(t){return t&&t.typeId===Gi.Bool}static isDecimal(t){return t&&t.typeId===Gi.Decimal}static isDate(t){return t&&t.typeId===Gi.Date}static isTime(t){return t&&t.typeId===Gi.Time}static isTimestamp(t){return t&&t.typeId===Gi.Timestamp}static isInterval(t){return t&&t.typeId===Gi.Interval}static isList(t){return t&&t.typeId===Gi.List}static isStruct(t){return t&&t.typeId===Gi.Struct}static isUnion(t){return t&&t.typeId===Gi.Union}static isFixedSizeBinary(t){return t&&t.typeId===Gi.FixedSizeBinary}static isFixedSizeList(t){return t&&t.typeId===Gi.FixedSizeList}static isMap(t){return t&&t.typeId===Gi.Map}static isDictionary(t){return t&&t.typeId===Gi.Dictionary}get typeId(){return Gi.NONE}compareTo(t){return this===t}}ZI=Symbol.toStringTag;class df extends Fw{constructor(t,e){super(),$(this,"isSigned",void 0),$(this,"bitWidth",void 0),this.isSigned=t,this.bitWidth=e}get typeId(){return Gi.Int}get[ZI](){return"Int"}toString(){return"".concat(this.isSigned?"I":"Ui","nt").concat(this.bitWidth)}}class wX extends df{constructor(){super(!0,8)}}class xX extends df{constructor(){super(!0,16)}}class BX extends df{constructor(){super(!0,32)}}class CX extends df{constructor(){super(!1,8)}}class EX extends df{constructor(){super(!1,16)}}class SX extends df{constructor(){super(!1,32)}}const rL={HALF:16,SINGLE:32,DOUBLE:64};tL=Symbol.toStringTag;class nL extends Fw{constructor(t){super(),$(this,"precision",void 0),this.precision=t}get typeId(){return Gi.Float}get[tL](){return"Float"}toString(){return"Float".concat(this.precision)}}class TX extends nL{constructor(){super(rL.SINGLE)}}class IX extends nL{constructor(){super(rL.DOUBLE)}}eL=Symbol.toStringTag;class LX extends Fw{constructor(t,e){super(),$(this,"listSize",void 0),$(this,"children",void 0),this.listSize=t,this.children=[e]}get typeId(){return Gi.FixedSizeList}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get[eL](){return"FixedSizeList"}toString(){return"FixedSizeList[".concat(this.listSize,"]<").concat(this.valueType,">")}}function FX(r){switch(r.constructor){case Int8Array:return new wX;case Uint8Array:return new CX;case Int16Array:return new xX;case Uint16Array:return new EX;case Int32Array:return new BX;case Uint32Array:return new SX;case Float32Array:return new TX;case Float64Array:return new IX;default:throw new Error("array type not supported")}}function PX(r,t,e){const n=FX(t.value),i=e||MX(t);return new sy(r,new LX(t.size,new sy("value",n)),!1,i)}function MX(r){const t=new Map;return"byteOffset"in r&&t.set("byteOffset",r.byteOffset.toString(10)),"byteStride"in r&&t.set("byteStride",r.byteStride.toString(10)),"normalized"in r&&t.set("normalized",r.normalized.toString()),t}function iL(r,t){(r.COLOR_0||r.colors)&&t||(r.colors={constant:!0,value:new Float32Array([1,1,1])}),Pn.assert(r.positions||r.POSITION,'no "postions" or "POSITION" attribute in mesh')}function sL(r,t){if(r.attributes)return iL(r.attributes,t),r instanceof hg?r:new hg(r);if(r.positions||r.POSITION)return iL(r,t),new hg({attributes:r});throw Error("Invalid mesh")}const UX={mesh:{type:"object",value:null,async:!0},texture:{type:"image",value:null,async:!0},sizeScale:{type:"number",value:1,min:0},_useMeshColors:{type:"boolean",value:!1},_instanced:!0,wireframe:!1,material:!0,getPosition:{type:"accessor",value:r=>r.position},getColor:{type:"accessor",value:[0,0,0,255]},getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},textureParameters:{type:"object",ignore:!0}};class Pw extends Af{constructor(){super(...arguments),$(this,"state",void 0)}getShaders(){const t=!gn(this.context.gl),e={};return db(this.context.gl,mi.GLSL_DERIVATIVES)&&(e.DERIVATIVES_AVAILABLE=1),super.getShaders({vs:yX,fs:_X,modules:[nw,Sj,iw],transpileToGLSL100:t,defines:e})}getBounds(){var t;if(this.props._instanced)return super.getBounds();let e=this.state.positionBounds;if(e)return e;const{mesh:n}=this.props;if(!n)return null;if(e=(t=n.header)===null||t===void 0?void 0:t.boundingBox,!e){const{attributes:i}=sL(n,this.props._useMeshColors);i.POSITION=i.POSITION||i.positions,e=JI(i)}return this.state.positionBounds=e,e}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{transition:!0,type:5130,fp64:this.use64bitPositions(),size:3,accessor:"getPosition"},instanceColors:{type:5121,transition:!0,size:this.props.colorFormat.length,normalized:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceModelMatrix:WI}),this.setState({emptyTexture:new Fa(this.context.gl,{data:new Uint8Array(4),width:1,height:1})})}updateState(t){super.updateState(t);const{props:e,oldProps:n,changeFlags:i}=t;if(e.mesh!==n.mesh||i.extensionsChanged){var s;if(this.state.positionBounds=null,(s=this.state.model)===null||s===void 0||s.delete(),e.mesh){this.state.model=this.getModel(e.mesh);const a=e.mesh.attributes||e.mesh;this.setState({hasNormals:!!(a.NORMAL||a.normals)})}this.getAttributeManager().invalidateAll()}e.texture!==n.texture&&this.setTexture(e.texture),this.state.model&&this.state.model.setDrawMode(this.props.wireframe?3:4)}finalizeState(t){super.finalizeState(t),this.state.emptyTexture.delete()}draw(t){let{uniforms:e}=t;if(!this.state.model)return;const{viewport:n}=this.context,{sizeScale:i,coordinateSystem:s,_instanced:a}=this.props;this.state.model.setUniforms(e).setUniforms({sizeScale:i,composeModelMatrix:!a||XI(n,s),flatShading:!this.state.hasNormals}).draw()}get isLoaded(){var t;return((t=this.state)===null||t===void 0?void 0:t.model)&&super.isLoaded}getModel(t){const e=new tf(this.context.gl,{...this.getShaders(),id:this.props.id,geometry:sL(t,this.props._useMeshColors),isInstanced:!0}),{texture:n}=this.props,{emptyTexture:i}=this.state;return e.setUniforms({sampler:n||i,hasTexture:!!n}),e}setTexture(t){const{emptyTexture:e,model:n}=this.state;n&&n.setUniforms({sampler:t||e,hasTexture:!!t})}}$(Pw,"defaultProps",UX),$(Pw,"layerName","SimpleMeshLayer");class ff{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:e}=t;this.id=e||Lu(this.constructor.name),this.display=!0,this.position=new le,this.rotation=new le,this.scale=new le(1,1,1),this.matrix=new Bn,this.userData={},this.props={},this._setScenegraphNodeProps(t)}delete(){}setProps(t){return this._setScenegraphNodeProps(t),this}toString(){return"{type: ScenegraphNode, id: ".concat(this.id,")}")}getBounds(){return null}setPosition(t){return ar(t.length===3,"setPosition requires vector argument"),this.position=t,this}setRotation(t){return ar(t.length===3,"setRotation requires vector argument"),this.rotation=t,this}setScale(t){return ar(t.length===3,"setScale requires vector argument"),this.scale=t,this}setMatrix(t){(arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0)?this.matrix.copy(t):this.matrix=t}setMatrixComponents(t){let{position:e,rotation:n,scale:i,update:s=!0}=t;return e&&this.setPosition(e),n&&this.setRotation(n),i&&this.setScale(i),s&&this.updateMatrix(),this}updateMatrix(){const t=this.position,e=this.rotation,n=this.scale;return this.matrix.identity(),this.matrix.translate(t),this.matrix.rotateXYZ(e),this.matrix.scale(n),this}update(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{position:e,rotation:n,scale:i}=t;return e&&this.setPosition(e),n&&this.setRotation(n),i&&this.setScale(i),this.updateMatrix(),this}getCoordinateUniforms(t,e){ar(t),e=e||this.matrix;const n=new Bn(t).multiplyRight(e),i=n.invert(),s=i.transpose();return{viewMatrix:t,modelMatrix:e,objectMatrix:e,worldMatrix:n,worldInverseMatrix:i,worldInverseTransposeMatrix:s}}_setScenegraphNodeProps(t){"display"in t&&(this.display=t.display),"position"in t&&this.setPosition(t.position),"rotation"in t&&this.setRotation(t.rotation),"scale"in t&&this.setScale(t.scale),"matrix"in t&&this.setMatrix(t.matrix),Object.assign(this.props,t)}}class Bg extends ff{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};t=Array.isArray(t)?{children:t}:t;const{children:e=[]}=t;yr.assert(e.every(n=>n instanceof ff),"every child must an instance of ScenegraphNode"),super(t),this.children=e}add(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(const i of e)Array.isArray(i)?this.add(...i):this.children.push(i);return this}remove(t){const e=this.children,n=e.indexOf(t);return n>-1&&e.splice(n,1),this}removeAll(){return this.children=[],this}delete(){this.children.forEach(t=>t.delete()),this.removeAll(),super.delete()}getBounds(){const t=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]];return this.traverse((e,n)=>{let{worldMatrix:i}=n;const s=e.getBounds();if(!s)return;const[a,o]=s,A=new le(a).add(o).divide([2,2,2]);i.transformAsPoint(A,A);const f=new le(o).subtract(a).divide([2,2,2]);i.transformAsVector(f,f);for(let m=0;m<8;m++){const _=new le(m&1?-1:1,m&2?-1:1,m&4?-1:1).multiply(f).add(A);for(let x=0;x<3;x++)t[0][x]=Math.min(t[0][x],_[x]),t[1][x]=Math.max(t[1][x],_[x])}}),Number.isFinite(t[0][0])?t:null}traverse(t){let{worldMatrix:e=new Bn}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=new Bn(e).multiplyRight(this.matrix);for(const i of this.children)i instanceof Bg?i.traverse(t,{worldMatrix:n}):t(i,{worldMatrix:n})}}const RX={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},OX={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function oL(r){if(!r._animation){const t=OX[r.componentType],e=RX[r.type],n=e*r.count,{buffer:i,byteOffset:s}=r.bufferView.data,a=new t(i,s+(r.byteOffset||0),n);if(e===1)r._animation=Array.from(a);else{const o=[];for(let A=0;A<a.length;A+=e)o.push(Array.from(a.slice(A,A+e)));r._animation=o}}return r._animation}const DX=new Bn;function NX(r,t){if(t.matrix.identity(),r.translation&&t.matrix.translate(r.translation),r.rotation){const e=DX.fromQuaternion(r.rotation);t.matrix.multiplyRight(e)}r.scale&&t.matrix.scale(r.scale)}const Mw=new lg;function kX(r,t,e,n,i){if(t==="rotation"){Mw.slerp({start:e,target:n,ratio:i});for(let s=0;s<Mw.length;s++)r[t][s]=Mw[s]}else for(let s=0;s<e.length;s++)r[t][s]=i*n[s]+(1-i)*e[s]}function QX(r,t,e){let{p0:n,outTangent0:i,inTangent1:s,p1:a,tDiff:o,ratio:A}=e;for(let f=0;f<r[t].length;f++){const m=i[f]*o,_=s[f]*o;r[t][f]=(2*Math.pow(A,3)-3*Math.pow(A,2)+1)*n[f]+(Math.pow(A,3)-2*Math.pow(A,2)+A)*m+(-2*Math.pow(A,3)+3*Math.pow(A,2))*a[f]+(Math.pow(A,3)-Math.pow(A,2))*_}}function HX(r,t,e){for(let n=0;n<e.length;n++)r[t][n]=e[n]}function zX(r,t,e,n){let{input:i,interpolation:s,output:a}=t;const o=i[i.length-1],A=r%o,f=i.findIndex(B=>B>=A),m=Math.max(0,f-1);if(!Array.isArray(e[n]))switch(n){case"translation":e[n]=[0,0,0];break;case"rotation":e[n]=[0,0,0,1];break;case"scale":e[n]=[1,1,1];break;default:yr.warn("Bad animation path ".concat(n))()}ar(e[n].length===a[m].length);const _=i[m],x=i[f];switch(s){case"STEP":HX(e,n,a[m]);break;case"LINEAR":if(x>_){const B=(A-_)/(x-_);kX(e,n,a[m],a[f],B)}break;case"CUBICSPLINE":if(x>_){const B=(A-_)/(x-_),P=x-_,M=a[3*m+1],k=a[3*m+2],Q=a[3*f+0],q=a[3*f+1];QX(e,n,{p0:M,outTangent0:k,inTangent1:Q,p1:q,tDiff:P,ratio:B})}break;default:yr.warn("Interpolation ".concat(s," not supported"))();break}}class GX{constructor(t){this.startTime=0,this.playing=!0,this.speed=1,this.channels=[],Object.assign(this,t)}animate(t){if(!this.playing)return;const n=(t/1e3-this.startTime)*this.speed;this.channels.forEach(i=>{let{sampler:s,target:a,path:o}=i;zX(n,s,a,o),NX(a,a._node)})}}class VX{constructor(t){this.animations=t.animations.map((e,n)=>{const i=e.name||"Animation-".concat(n),s=e.samplers.map(o=>{let{input:A,interpolation:f="LINEAR",output:m}=o;return{input:oL(t.accessors[A]),interpolation:f,output:oL(t.accessors[m])}}),a=e.channels.map(o=>{let{sampler:A,target:f}=o;return{sampler:s[A],target:t.nodes[f.node],path:f.path}});return new GX({name:i,channels:a})})}animate(t){this.setTime(t)}setTime(t){this.animations.forEach(e=>e.animate(t))}getAnimations(){return this.animations}}class jX extends ff{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e),this.onBeforeRender=null,this.AfterRender=null,t instanceof tf?(this.model=t,this._setModelNodeProps(e)):this.model=new tf(t,e),this.bounds=null,this.managedResources=e.managedResources||[]}setProps(t){return super.setProps(t),this._setModelNodeProps(t),this}getBounds(){return this.bounds}delete(){this.model&&(this.model.delete(),this.model=null),this.managedResources.forEach(t=>t.delete()),this.managedResources=[]}draw(){return this.model.draw(...arguments)}setUniforms(){return this.model.setUniforms(...arguments),this}setAttributes(){return this.model.setAttributes(...arguments),this}updateModuleSettings(){return this.model.updateModuleSettings(...arguments),this}_setModelNodeProps(t){this.model.setProps(t)}}class aL{constructor(t,e){let{attributes:n,material:i,pbrDebug:s,imageBasedLightingEnvironment:a,lights:o,useTangents:A}=e;this.gl=t,this.defines={MANUAL_SRGB:1,SRGB_FAST_APPROXIMATION:1},db(t,mi.GLSL_TEXTURE_LOD)&&(this.defines.USE_TEX_LOD=1),this.uniforms={u_Camera:[0,0,0],u_MetallicRoughnessValues:[1,1]},this.parameters={},this.generatedTextures=[],a&&(this.uniforms.u_DiffuseEnvSampler=a.getDiffuseEnvSampler(),this.uniforms.u_SpecularEnvSampler=a.getSpecularEnvSampler(),this.uniforms.u_brdfLUT=a.getBrdfTexture(),this.uniforms.u_ScaleIBLAmbient=[1,1]),s&&(this.uniforms.u_ScaleDiffBaseMR=[0,0,0,0],this.uniforms.u_ScaleFGDSpec=[0,0,0,0]),this.defineIfPresent(n.NORMAL,"HAS_NORMALS"),this.defineIfPresent(n.TANGENT&&A,"HAS_TANGENTS"),this.defineIfPresent(n.TEXCOORD_0,"HAS_UV"),this.defineIfPresent(a,"USE_IBL"),this.defineIfPresent(o,"USE_LIGHTS"),this.defineIfPresent(s,"PBR_DEBUG"),i&&this.parseMaterial(i)}defineIfPresent(t,e){t&&(this.defines[e]=1)}parseTexture(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;const i=t.texture&&t.texture.sampler&&t.texture.sampler.parameters||{},s=t.texture.source.image;let a,o={};s.compressed?(a=s,o={[this.gl.TEXTURE_MIN_FILTER]:s.data.length>1?this.gl.LINEAR_MIPMAP_NEAREST:this.gl.LINEAR}):a={data:s};const A=new Fa(this.gl,{id:t.name||t.id,parameters:{...i,...o},pixelStore:{[this.gl.UNPACK_FLIP_Y_WEBGL]:!1},...a});this.uniforms[e]=A,this.defineIfPresent(n,n),this.generatedTextures.push(A)}parsePbrMetallicRoughness(t){t.baseColorTexture&&this.parseTexture(t.baseColorTexture,"u_BaseColorSampler","HAS_BASECOLORMAP"),this.uniforms.u_BaseColorFactor=t.baseColorFactor||[1,1,1,1],t.metallicRoughnessTexture&&this.parseTexture(t.metallicRoughnessTexture,"u_MetallicRoughnessSampler","HAS_METALROUGHNESSMAP");const{metallicFactor:e=1,roughnessFactor:n=1}=t;this.uniforms.u_MetallicRoughnessValues=[e,n]}parseMaterial(t){if(this.uniforms.pbr_uUnlit=!!t.unlit,t.pbrMetallicRoughness&&this.parsePbrMetallicRoughness(t.pbrMetallicRoughness),t.normalTexture){this.parseTexture(t.normalTexture,"u_NormalSampler","HAS_NORMALMAP");const{scale:e=1}=t.normalTexture;this.uniforms.u_NormalScale=e}if(t.occlusionTexture){this.parseTexture(t.occlusionTexture,"u_OcclusionSampler","HAS_OCCLUSIONMAP");const{strength:e=1}=t.occlusionTexture;this.uniforms.u_OcclusionStrength=e}if(t.emissiveTexture&&(this.parseTexture(t.emissiveTexture,"u_EmissiveSampler","HAS_EMISSIVEMAP"),this.uniforms.u_EmissiveFactor=t.emissiveFactor||[0,0,0]),t.alphaMode==="MASK"){const{alphaCutoff:e=.5}=t;this.defines.ALPHA_CUTOFF=1,this.uniforms.u_AlphaCutoff=e}else t.alphaMode==="BLEND"&&(yr.warn("BLEND alphaMode might not work well because it requires mesh sorting")(),Object.assign(this.parameters,{blend:!0,blendEquation:this.gl.FUNC_ADD,blendFunc:[this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA,this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA]}))}delete(){this.generatedTextures.forEach(t=>t.delete())}}const qX=`
#if (__VERSION__ < 300)
  #define _attr attribute
#else
  #define _attr in
#endif

  _attr vec4 POSITION;

  #ifdef HAS_NORMALS
    _attr vec4 NORMAL;
  #endif

  #ifdef HAS_TANGENTS
    _attr vec4 TANGENT;
  #endif

  #ifdef HAS_UV
    _attr vec2 TEXCOORD_0;
  #endif

  void main(void) {
    vec4 _NORMAL = vec4(0.);
    vec4 _TANGENT = vec4(0.);
    vec2 _TEXCOORD_0 = vec2(0.);

    #ifdef HAS_NORMALS
      _NORMAL = NORMAL;
    #endif

    #ifdef HAS_TANGENTS
      _TANGENT = TANGENT;
    #endif

    #ifdef HAS_UV
      _TEXCOORD_0 = TEXCOORD_0;
    #endif

    pbr_setPositionNormalTangentUV(POSITION, _NORMAL, _TANGENT, _TEXCOORD_0);
    gl_Position = u_MVPMatrix * POSITION;
  }
`,KX=`
#if (__VERSION__ < 300)
  #define fragmentColor gl_FragColor
#else
  out vec4 fragmentColor;
#endif

  void main(void) {
    fragmentColor = pbr_filterColor(vec4(0));
  }
`;function cL(r,t){return gn(r)?`#version 300 es
`.concat(t):t}function $X(r,t){const{id:e,drawMode:n,vertexCount:i,attributes:s,modelOptions:a}=t,o=new aL(r,t);yr.info(4,"createGLTFModel defines: ",o.defines)();const A=[];A.push(...o.generatedTextures),A.push(...Object.values(s).map(m=>m.buffer));const f=new jX(r,{id:e,drawMode:n,vertexCount:i,modules:[Gb],parameters:o.parameters,vs:cL(r,qX),fs:cL(r,KX),managedResources:A,...a,defines:{...o.defines,...a.defines}});return f.setProps({attributes:s}),f.setUniforms(o.uniforms),f}const WX={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},XX={modelOptions:{},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1};class JX{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=t,this.options=Object.assign({},XX,e)}instantiate(t){return this.gltf=t,(t.scenes||[]).map(n=>this.createScene(n))}createAnimator(){return Array.isArray(this.gltf.animations)?new VX(this.gltf):null}createScene(t){const n=(t.nodes||[]).map(s=>this.createNode(s));return new Bg({id:t.name||t.id,children:n})}createNode(t){if(!t._node){const n=(t.children||[]).map(s=>this.createNode(s));t.mesh&&n.push(this.createMesh(t.mesh));const i=new Bg({id:t.name||t.id,children:n});if(t.matrix)i.setMatrix(t.matrix);else{if(i.matrix.identity(),t.translation&&i.matrix.translate(t.translation),t.rotation){const s=new Bn().fromQuaternion(t.rotation);i.matrix.multiplyRight(s)}t.scale&&i.matrix.scale(t.scale)}t._node=i}return t._node}createMesh(t){if(!t._mesh){const n=(t.primitives||[]).map((s,a)=>this.createPrimitive(s,a,t)),i=new Bg({id:t.name||t.id,children:n});t._mesh=i}return t._mesh}getVertexCount(t){yr.warn("getVertexCount() not found")()}createPrimitive(t,e,n){const i=$X(this.gl,Object.assign({id:t.name||"".concat(n.name||n.id,"-primitive-").concat(e),drawMode:t.mode||4,vertexCount:t.indices?t.indices.count:this.getVertexCount(t.attributes),attributes:this.createAttributes(t.attributes,t.indices),material:t.material},this.options));return i.bounds=[t.attributes.POSITION.min,t.attributes.POSITION.max],i}createAttributes(t,e){const n={};return Object.keys(t).forEach(i=>{n[i]=this.createAccessor(t[i],this.createBuffer(t[i],this.gl.ARRAY_BUFFER))}),e&&(n.indices=this.createAccessor(e,this.createBuffer(e,this.gl.ELEMENT_ARRAY_BUFFER))),yr.info(4,"glTF Attributes",{attributes:t,indices:e,generated:n})(),n}createBuffer(t,e){t.bufferView||(t.bufferView={});const{bufferView:n}=t;return n.lumaBuffers||(n.lumaBuffers={}),n.lumaBuffers[e]||(n.lumaBuffers[e]=new ni(this.gl,{id:"from-".concat(n.id),data:n.data||t.value,target:e})),n.lumaBuffers[e]}createAccessor(t,e){return new la({buffer:e,offset:t.byteOffset||0,stride:t.bufferView.byteStride||0,type:t.componentType,size:WX[t.type]})}createSampler(t){return t}needsPOT(){return!1}}function YX(r,t,e){const n=new JX(r,e),i=n.instantiate(t),s=n.createAnimator();return{scenes:i,animator:s}}const ZX="3.4.14",tJ="3.4.14",lL="3.4.14",eJ="https://unpkg.com/@loaders.gl/textures@".concat(lL,"/dist/libs/basis_encoder.wasm"),rJ="https://unpkg.com/@loaders.gl/textures@".concat(lL,"/dist/libs/basis_encoder.js");let Uw;async function uL(r){const t=r.modules||{};return t.basis?t.basis:(Uw=Uw||nJ(r),await Uw)}async function nJ(r){let t=null,e=null;return[t,e]=await Promise.all([await Ph("basis_transcoder.js","textures",r),await Ph("basis_transcoder.wasm","textures",r)]),t=t||globalThis.BASIS,await iJ(t,e)}function iJ(r,t){const e={};return t&&(e.wasmBinary=t),new Promise(n=>{r(e).then(i=>{const{BasisFile:s,initializeBasis:a}=i;a(),n({BasisFile:s})})})}let Rw;async function AL(r){const t=r.modules||{};return t.basisEncoder?t.basisEncoder:(Rw=Rw||sJ(r),await Rw)}async function sJ(r){let t=null,e=null;return[t,e]=await Promise.all([await Ph(rJ,"textures",r),await Ph(eJ,"textures",r)]),t=t||globalThis.BASIS,await oJ(t,e)}function oJ(r,t){const e={};return t&&(e.wasmBinary=t),new Promise(n=>{r(e).then(i=>{const{BasisFile:s,KTX2File:a,initializeBasis:o,BasisEncoder:A}=i;o(),n({BasisFile:s,KTX2File:a,BasisEncoder:A})})})}const pf={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35987,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,COMPRESSED_RGBA_ASTC_4X4_KHR:37808,COMPRESSED_RGBA_ASTC_5X4_KHR:37809,COMPRESSED_RGBA_ASTC_5X5_KHR:37810,COMPRESSED_RGBA_ASTC_6X5_KHR:37811,COMPRESSED_RGBA_ASTC_6X6_KHR:37812,COMPRESSED_RGBA_ASTC_8X5_KHR:37813,COMPRESSED_RGBA_ASTC_8X6_KHR:37814,COMPRESSED_RGBA_ASTC_8X8_KHR:37815,COMPRESSED_RGBA_ASTC_10X5_KHR:37816,COMPRESSED_RGBA_ASTC_10X6_KHR:37817,COMPRESSED_RGBA_ASTC_10X8_KHR:37818,COMPRESSED_RGBA_ASTC_10X10_KHR:37819,COMPRESSED_RGBA_ASTC_12X10_KHR:37820,COMPRESSED_RGBA_ASTC_12X12_KHR:37821,COMPRESSED_SRGB8_ALPHA8_ASTC_4X4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5X4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5X5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6X5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6X6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8X5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8X6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8X8_KHR:37847,COMPRESSED_SRGB8_ALPHA8_ASTC_10X5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10X6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10X8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_10X10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_12X10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12X12_KHR:37853,COMPRESSED_RED_RGTC1_EXT:36283,COMPRESSED_SIGNED_RED_RGTC1_EXT:36284,COMPRESSED_RED_GREEN_RGTC2_EXT:36285,COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT:36286,COMPRESSED_SRGB_S3TC_DXT1_EXT:35916,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:35919},aJ=["","WEBKIT_","MOZ_"],hL={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let oy=null;function cJ(r){if(!oy){r=r||lJ()||void 0,oy=new Set;for(const t of aJ)for(const e in hL)if(r&&r.getExtension("".concat(t).concat(e))){const n=hL[e];oy.add(n)}}return oy}function lJ(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}var dL,fL,pL,gL,mL,yL,_L,vL;(function(r){r[r.NONE=0]="NONE",r[r.BASISLZ=1]="BASISLZ",r[r.ZSTD=2]="ZSTD",r[r.ZLIB=3]="ZLIB"})(dL||(dL={})),function(r){r[r.BASICFORMAT=0]="BASICFORMAT"}(fL||(fL={})),function(r){r[r.UNSPECIFIED=0]="UNSPECIFIED",r[r.ETC1S=163]="ETC1S",r[r.UASTC=166]="UASTC"}(pL||(pL={})),function(r){r[r.UNSPECIFIED=0]="UNSPECIFIED",r[r.SRGB=1]="SRGB"}(gL||(gL={})),function(r){r[r.UNSPECIFIED=0]="UNSPECIFIED",r[r.LINEAR=1]="LINEAR",r[r.SRGB=2]="SRGB",r[r.ITU=3]="ITU",r[r.NTSC=4]="NTSC",r[r.SLOG=5]="SLOG",r[r.SLOG2=6]="SLOG2"}(mL||(mL={})),function(r){r[r.ALPHA_STRAIGHT=0]="ALPHA_STRAIGHT",r[r.ALPHA_PREMULTIPLIED=1]="ALPHA_PREMULTIPLIED"}(yL||(yL={})),function(r){r[r.RGB=0]="RGB",r[r.RRR=3]="RRR",r[r.GGG=4]="GGG",r[r.AAA=15]="AAA"}(_L||(_L={})),function(r){r[r.RGB=0]="RGB",r[r.RGBA=3]="RGBA",r[r.RRR=4]="RRR",r[r.RRRG=5]="RRRG"}(vL||(vL={}));const Oa=[171,75,84,88,32,50,48,187,13,10,26,10];function uJ(r){const t=new Uint8Array(r);return!(t.byteLength<Oa.length||t[0]!==Oa[0]||t[1]!==Oa[1]||t[2]!==Oa[2]||t[3]!==Oa[3]||t[4]!==Oa[4]||t[5]!==Oa[5]||t[6]!==Oa[6]||t[7]!==Oa[7]||t[8]!==Oa[8]||t[9]!==Oa[9]||t[10]!==Oa[10]||t[11]!==Oa[11])}const AJ={etc1:{basisFormat:0,compressed:!0,format:pf.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:pf.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:pf.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:pf.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:pf.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:pf.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function hJ(r,t){if(t.basis.containerFormat==="auto"){if(uJ(r)){const n=await AL(t);return bL(n.KTX2File,r,t)}const{BasisFile:e}=await uL(t);return Ow(e,r,t)}switch(t.basis.module){case"encoder":const e=await AL(t);switch(t.basis.containerFormat){case"ktx2":return bL(e.KTX2File,r,t);case"basis":default:return Ow(e.BasisFile,r,t)}case"transcoder":default:const{BasisFile:n}=await uL(t);return Ow(n,r,t)}}function Ow(r,t,e){const n=new r(new Uint8Array(t));try{if(!n.startTranscoding())throw new Error("Failed to start basis transcoding");const i=n.getNumImages(),s=[];for(let a=0;a<i;a++){const o=n.getNumLevels(a),A=[];for(let f=0;f<o;f++)A.push(dJ(n,a,f,e));s.push(A)}return s}finally{n.close(),n.delete()}}function dJ(r,t,e,n){const i=r.getImageWidth(t,e),s=r.getImageHeight(t,e),a=r.getHasAlpha(),{compressed:o,format:A,basisFormat:f}=wL(n,a),m=r.getImageTranscodedSizeInBytes(t,e,f),_=new Uint8Array(m);if(!r.transcodeImage(_,t,e,f,0,0))throw new Error("failed to start Basis transcoding");return{width:i,height:s,data:_,compressed:o,format:A,hasAlpha:a}}function bL(r,t,e){const n=new r(new Uint8Array(t));try{if(!n.startTranscoding())throw new Error("failed to start KTX2 transcoding");const i=n.getLevels(),s=[];for(let a=0;a<i;a++){s.push(fJ(n,a,e));break}return[s]}finally{n.close(),n.delete()}}function fJ(r,t,e){const{alphaFlag:n,height:i,width:s}=r.getImageLevelInfo(t,0,0),{compressed:a,format:o,basisFormat:A}=wL(e,n),f=r.getImageTranscodedSizeInBytes(t,0,0,A),m=new Uint8Array(f);if(!r.transcodeImage(m,t,0,0,A,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:s,height:i,data:m,compressed:a,levelSize:f,hasAlpha:n,format:o}}function wL(r,t){let e=r&&r.basis&&r.basis.format;return e==="auto"&&(e=xL()),typeof e=="object"&&(e=t?e.alpha:e.noAlpha),e=e.toLowerCase(),AJ[e]}function xL(){const r=cJ();return r.has("astc")?"astc-4x4":r.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:r.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:r.has("etc1")?"etc1":r.has("etc2")?"etc2":"rgb565"}const pJ={...{name:"Basis",id:Eu?"basis":"basis-nodejs",module:"textures",version:tJ,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},parse:hJ};function Da(r,t){if(!r)throw new Error(t||"assert failed: gltf")}function BL(r,t){if(r.startsWith("data:")||r.startsWith("http:")||r.startsWith("https:"))return r;const n=t.baseUri||t.uri;if(!n)throw new Error("'baseUri' must be provided to resolve relative url ".concat(r));return n.substr(0,n.lastIndexOf("/")+1)+r}function gJ(r,t,e){const n=r.bufferViews[e];Da(n);const i=n.buffer,s=t[i];Da(s);const a=(n.byteOffset||0)+s.byteOffset;return new Uint8Array(s.arrayBuffer,a,n.byteLength)}const CL=["SCALAR","VEC2","VEC3","VEC4"],mJ=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],yJ=new Map(mJ),_J={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},vJ={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},bJ={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function EL(r){return CL[r-1]||CL[0]}function SL(r){const t=yJ.get(r.constructor);if(!t)throw new Error("Illegal typed array");return t}function Dw(r,t){const e=bJ[r.componentType],n=_J[r.type],i=vJ[r.componentType],s=r.count*n,a=r.count*n*i;return Da(a>=0&&a<=t.byteLength),{ArrayType:e,length:s,byteLength:a}}function TL(r){let{images:t,bufferViews:e}=r;t=t||[],e=e||[];const n=t.map(a=>a.bufferView);e=e.filter(a=>!n.includes(a));const i=e.reduce((a,o)=>a+o.byteLength,0),s=t.reduce((a,o)=>{const{width:A,height:f}=o.image;return a+A*f},0);return i+Math.ceil(4*s*1.33)}const wJ={asset:{version:"2.0",generator:"loaders.gl"},buffers:[]};class ua{constructor(t){$(this,"gltf",void 0),$(this,"sourceBuffers",void 0),$(this,"byteLength",void 0),this.gltf=t||{json:{...wJ},buffers:[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(t){return this.json[t]}getExtraData(t){return(this.json.extras||{})[t]}getExtension(t){const e=this.getUsedExtensions().find(i=>i===t),n=this.json.extensions||{};return e?n[t]||!0:null}getRequiredExtension(t){return this.getRequiredExtensions().find(n=>n===t)?this.getExtension(t):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(t,e){return(t.extensions||{})[e]}getScene(t){return this.getObject("scenes",t)}getNode(t){return this.getObject("nodes",t)}getSkin(t){return this.getObject("skins",t)}getMesh(t){return this.getObject("meshes",t)}getMaterial(t){return this.getObject("materials",t)}getAccessor(t){return this.getObject("accessors",t)}getTexture(t){return this.getObject("textures",t)}getSampler(t){return this.getObject("samplers",t)}getImage(t){return this.getObject("images",t)}getBufferView(t){return this.getObject("bufferViews",t)}getBuffer(t){return this.getObject("buffers",t)}getObject(t,e){if(typeof e=="object")return e;const n=this.json[t]&&this.json[t][e];if(!n)throw new Error("glTF file error: Could not find ".concat(t,"[").concat(e,"]"));return n}getTypedArrayForBufferView(t){t=this.getBufferView(t);const e=t.buffer,n=this.gltf.buffers[e];Da(n);const i=(t.byteOffset||0)+n.byteOffset;return new Uint8Array(n.arrayBuffer,i,t.byteLength)}getTypedArrayForAccessor(t){t=this.getAccessor(t);const e=this.getBufferView(t.bufferView),i=this.getBuffer(e.buffer).data,{ArrayType:s,length:a}=Dw(t,e),o=e.byteOffset+t.byteOffset;return new s(i,o,a)}getTypedArrayForImageData(t){t=this.getAccessor(t);const e=this.getBufferView(t.bufferView),i=this.getBuffer(e.buffer).data,s=e.byteOffset||0;return new Uint8Array(i,s,e.byteLength)}addApplicationData(t,e){return this.json[t]=e,this}addExtraData(t,e){return this.json.extras=this.json.extras||{},this.json.extras[t]=e,this}addObjectExtension(t,e,n){return t.extensions=t.extensions||{},t.extensions[e]=n,this.registerUsedExtension(e),this}setObjectExtension(t,e,n){const i=t.extensions||{};i[e]=n}removeObjectExtension(t,e){const n=t.extensions||{},i=n[e];return delete n[e],i}addExtension(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Da(e),this.json.extensions=this.json.extensions||{},this.json.extensions[t]=e,this.registerUsedExtension(t),e}addRequiredExtension(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Da(e),this.addExtension(t,e),this.registerRequiredExtension(t),e}registerUsedExtension(t){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(e=>e===t)||this.json.extensionsUsed.push(t)}registerRequiredExtension(t){this.registerUsedExtension(t),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(e=>e===t)||this.json.extensionsRequired.push(t)}removeExtension(t){if(!this.getExtension(t))return;this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,t),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,t),this.json.extensions&&delete this.json.extensions[t],Array.isArray(this.json.extensionsRemoved)||(this.json.extensionsRemoved=[]);const e=this.json.extensionsRemoved;e.includes(t)||e.push(t)}setDefaultScene(t){this.json.scene=t}addScene(t){const{nodeIndices:e}=t;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:e}),this.json.scenes.length-1}addNode(t){const{meshIndex:e,matrix:n}=t;this.json.nodes=this.json.nodes||[];const i={mesh:e};return n&&(i.matrix=n),this.json.nodes.push(i),this.json.nodes.length-1}addMesh(t){const{attributes:e,indices:n,material:i,mode:s=4}=t,o={primitives:[{attributes:this._addAttributes(e),mode:s}]};if(n){const A=this._addIndices(n);o.primitives[0].indices=A}return Number.isFinite(i)&&(o.primitives[0].material=i),this.json.meshes=this.json.meshes||[],this.json.meshes.push(o),this.json.meshes.length-1}addPointCloud(t){const n={primitives:[{attributes:this._addAttributes(t),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(n),this.json.meshes.length-1}addImage(t,e){const n=jv(t),i=e||(n==null?void 0:n.mimeType),a={bufferView:this.addBufferView(t),mimeType:i};return this.json.images=this.json.images||[],this.json.images.push(a),this.json.images.length-1}addBufferView(t){const e=t.byteLength;Da(Number.isFinite(e)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(t);const n={buffer:0,byteOffset:this.byteLength,byteLength:e};return this.byteLength+=Hp(e,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(n),this.json.bufferViews.length-1}addAccessor(t,e){const n={bufferView:t,type:EL(e.size),componentType:e.componentType,count:e.count,max:e.max,min:e.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(n),this.json.accessors.length-1}addBinaryBuffer(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{size:3};const n=this.addBufferView(t);let i={min:e.min,max:e.max};(!i.min||!i.max)&&(i=this._getAccessorMinMax(t,e.size));const s={size:e.size,componentType:SL(t),count:Math.round(t.length/e.size),min:i.min,max:i.max};return this.addAccessor(n,Object.assign(s,e))}addTexture(t){const{imageIndex:e}=t,n={source:e};return this.json.textures=this.json.textures||[],this.json.textures.push(n),this.json.textures.length-1}addMaterial(t){return this.json.materials=this.json.materials||[],this.json.materials.push(t),this.json.materials.length-1}createBinaryChunk(){var t,e;this.gltf.buffers=[];const n=this.byteLength,i=new ArrayBuffer(n),s=new Uint8Array(i);let a=0;for(const o of this.sourceBuffers||[])a=K8(o,s,a);(t=this.json)!==null&&t!==void 0&&(e=t.buffers)!==null&&e!==void 0&&e[0]?this.json.buffers[0].byteLength=n:this.json.buffers=[{byteLength:n}],this.gltf.binary=i,this.sourceBuffers=[i]}_removeStringFromArray(t,e){let n=!0;for(;n;){const i=t.indexOf(e);i>-1?t.splice(i,1):n=!1}}_addAttributes(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e={};for(const n in t){const i=t[n],s=this._getGltfAttributeName(n),a=this.addBinaryBuffer(i.value,i);e[s]=a}return e}_addIndices(t){return this.addBinaryBuffer(t,{size:1})}_getGltfAttributeName(t){switch(t.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return t}}_getAccessorMinMax(t,e){const n={min:null,max:null};if(t.length<e)return n;n.min=[],n.max=[];const i=t.subarray(0,e);for(const s of i)n.min.push(s),n.max.push(s);for(let s=e;s<t.length;s+=e)for(let a=0;a<e;a++)n.min[0+a]=Math.min(n.min[0+a],t[s+a]),n.max[0+a]=Math.max(n.max[0+a],t[s+a]);return n}}const xJ="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",BJ="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",CJ=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),EJ=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),SJ={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},TJ={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function IJ(r,t,e,n,i){let s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"NONE";const a=await LJ();MJ(a,a.exports[TJ[i]],r,t,e,n,a.exports[SJ[s||"NONE"]])}let Nw;async function LJ(){return Nw||(Nw=FJ()),Nw}async function FJ(){let r=xJ;WebAssembly.validate(CJ)&&(r=BJ,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const t=await WebAssembly.instantiate(PJ(r),{});return await t.instance.exports.__wasm_call_ctors(),t.instance}function PJ(r){const t=new Uint8Array(r.length);for(let n=0;n<r.length;++n){const i=r.charCodeAt(n);t[n]=i>96?i-71:i>64?i-65:i>47?i+4:i>46?63:62}let e=0;for(let n=0;n<r.length;++n)t[e++]=t[n]<60?EJ[t[n]]:(t[n]-60)*64+t[++n];return t.buffer.slice(0,e)}function MJ(r,t,e,n,i,s,a){const o=r.exports.sbrk,A=n+3&-4,f=o(A*i),m=o(s.length),_=new Uint8Array(r.exports.memory.buffer);_.set(s,m);const x=t(f,n,i,m,s.length);if(x===0&&a&&a(f,A,i),e.set(_.subarray(f,f+n*i)),o(f-o(0)),x!==0)throw new Error("Malformed buffer data: ".concat(x))}const kw="EXT_meshopt_compression",UJ=kw;async function RJ(r,t){var e;const n=new ua(r);if(!(t!=null&&(e=t.gltf)!==null&&e!==void 0&&e.decompressMeshes))return;const i=[];for(const s of r.json.bufferViews||[])i.push(OJ(n,s));await Promise.all(i),n.removeExtension(kw)}async function OJ(r,t){const e=r.getObjectExtension(t,kw);if(e){const{byteOffset:n=0,byteLength:i=0,byteStride:s,count:a,mode:o,filter:A="NONE",buffer:f}=e,m=r.gltf.buffers[f],_=new Uint8Array(m.arrayBuffer,m.byteOffset+n,i),x=new Uint8Array(r.gltf.buffers[t.buffer].arrayBuffer,t.byteOffset,t.byteLength);return await IJ(x,a,s,_,o,A),x}return null}const DJ=Object.freeze(Object.defineProperty({__proto__:null,decode:RJ,name:UJ},Symbol.toStringTag,{value:"Module"})),gf="EXT_texture_webp",NJ=gf;function kJ(r,t){const e=new ua(r);if(!GH("image/webp")){if(e.getRequiredExtensions().includes(gf))throw new Error("gltf: Required extension ".concat(gf," not supported by browser"));return}const{json:n}=e;for(const i of n.textures||[]){const s=e.getObjectExtension(i,gf);s&&(i.source=s.source),e.removeObjectExtension(i,gf)}e.removeExtension(gf)}const QJ=Object.freeze(Object.defineProperty({__proto__:null,name:NJ,preprocess:kJ},Symbol.toStringTag,{value:"Module"})),ay="KHR_texture_basisu",HJ=ay;function zJ(r,t){const e=new ua(r),{json:n}=e;for(const i of n.textures||[]){const s=e.getObjectExtension(i,ay);s&&(i.source=s.source),e.removeObjectExtension(i,ay)}e.removeExtension(ay)}const GJ=Object.freeze(Object.defineProperty({__proto__:null,name:HJ,preprocess:zJ},Symbol.toStringTag,{value:"Module"})),VJ={name:"Draco",id:Eu?"draco":"draco-nodejs",module:"draco",shapes:["mesh"],version:"3.4.14",worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};function jJ(r,t,e){const n=LL(t.metadata),i=[],s=qJ(t.attributes);for(const a in r){const o=r[a],A=IL(a,o,s[a]);i.push(A)}if(e){const a=IL("indices",e);i.push(a)}return new hf(i,n)}function qJ(r){const t={};for(const e in r){const n=r[e];t[n.name||"undefined"]=n}return t}function IL(r,t,e){const n=e?LL(e.metadata):void 0;return PX(r,t,n)}function LL(r){const t=new Map;for(const e in r)t.set("".concat(e,".string"),JSON.stringify(r[e]));return t}const FL={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},KJ={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},$J=4;class WJ{constructor(t){$(this,"draco",void 0),$(this,"decoder",void 0),$(this,"metadataQuerier",void 0),this.draco=t,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=new this.draco.DecoderBuffer;n.Init(new Int8Array(t),t.byteLength),this._disableAttributeTransforms(e);const i=this.decoder.GetEncodedGeometryType(n),s=i===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let a;switch(i){case this.draco.TRIANGULAR_MESH:a=this.decoder.DecodeBufferToMesh(n,s);break;case this.draco.POINT_CLOUD:a=this.decoder.DecodeBufferToPointCloud(n,s);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!a.ok()||!s.ptr){const x="DRACO decompression failed: ".concat(a.error_msg());throw new Error(x)}const o=this._getDracoLoaderData(s,i,e),A=this._getMeshData(s,o,e),f=JI(A.attributes),m=jJ(A.attributes,o,A.indices);return{loader:"draco",loaderData:o,header:{vertexCount:s.num_points(),boundingBox:f},...A,schema:m}}finally{this.draco.destroy(n),s&&this.draco.destroy(s)}}_getDracoLoaderData(t,e,n){const i=this._getTopLevelMetadata(t),s=this._getDracoAttributes(t,n);return{geometry_type:e,num_attributes:t.num_attributes(),num_points:t.num_points(),num_faces:t instanceof this.draco.Mesh?t.num_faces():0,metadata:i,attributes:s}}_getDracoAttributes(t,e){const n={};for(let i=0;i<t.num_attributes();i++){const s=this.decoder.GetAttribute(t,i),a=this._getAttributeMetadata(t,i);n[s.unique_id()]={unique_id:s.unique_id(),attribute_type:s.attribute_type(),data_type:s.data_type(),num_components:s.num_components(),byte_offset:s.byte_offset(),byte_stride:s.byte_stride(),normalized:s.normalized(),attribute_index:i,metadata:a};const o=this._getQuantizationTransform(s,e);o&&(n[s.unique_id()].quantization_transform=o);const A=this._getOctahedronTransform(s,e);A&&(n[s.unique_id()].octahedron_transform=A)}return n}_getMeshData(t,e,n){const i=this._getMeshAttributes(e,t,n);if(!i.POSITION)throw new Error("DRACO: No position attribute found.");if(t instanceof this.draco.Mesh)switch(n.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:i,indices:{value:this._getTriangleStripIndices(t),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:i,indices:{value:this._getTriangleListIndices(t),size:1}}}return{topology:"point-list",mode:0,attributes:i}}_getMeshAttributes(t,e,n){const i={};for(const s of Object.values(t.attributes)){const a=this._deduceAttributeName(s,n);s.name=a;const{value:o,size:A}=this._getAttributeValues(e,s);i[a]={value:o,size:A,byteOffset:s.byte_offset,byteStride:s.byte_stride,normalized:s.normalized}}return i}_getTriangleListIndices(t){const n=t.num_faces()*3,i=n*$J,s=this.draco._malloc(i);try{return this.decoder.GetTrianglesUInt32Array(t,i,s),new Uint32Array(this.draco.HEAPF32.buffer,s,n).slice()}finally{this.draco._free(s)}}_getTriangleStripIndices(t){const e=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(t,e),YJ(e)}finally{this.draco.destroy(e)}}_getAttributeValues(t,e){const n=KJ[e.data_type],i=e.num_components,a=t.num_points()*i,o=a*n.BYTES_PER_ELEMENT,A=XJ(this.draco,n);let f;const m=this.draco._malloc(o);try{const _=this.decoder.GetAttribute(t,e.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(t,_,A,o,m),f=new n(this.draco.HEAPF32.buffer,m,a).slice()}finally{this.draco._free(m)}return{value:f,size:i}}_deduceAttributeName(t,e){const n=t.unique_id;for(const[a,o]of Object.entries(e.extraAttributes||{}))if(o===n)return a;const i=t.attribute_type;for(const a in FL)if(this.draco[a]===i)return FL[a];const s=e.attributeNameEntry||"name";return t.metadata[s]?t.metadata[s].string:"CUSTOM_ATTRIBUTE_".concat(n)}_getTopLevelMetadata(t){const e=this.decoder.GetMetadata(t);return this._getDracoMetadata(e)}_getAttributeMetadata(t,e){const n=this.decoder.GetAttributeMetadata(t,e);return this._getDracoMetadata(n)}_getDracoMetadata(t){if(!t||!t.ptr)return{};const e={},n=this.metadataQuerier.NumEntries(t);for(let i=0;i<n;i++){const s=this.metadataQuerier.GetEntryName(t,i);e[s]=this._getDracoMetadataField(t,s)}return e}_getDracoMetadataField(t,e){const n=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(t,e,n);const i=JJ(n);return{int:this.metadataQuerier.GetIntEntry(t,e),string:this.metadataQuerier.GetStringEntry(t,e),double:this.metadataQuerier.GetDoubleEntry(t,e),intArray:i}}finally{this.draco.destroy(n)}}_disableAttributeTransforms(t){const{quantizedAttributes:e=[],octahedronAttributes:n=[]}=t,i=[...e,...n];for(const s of i)this.decoder.SkipAttributeTransform(this.draco[s])}_getQuantizationTransform(t,e){const{quantizedAttributes:n=[]}=e,i=t.attribute_type();if(n.map(a=>this.decoder[a]).includes(i)){const a=new this.draco.AttributeQuantizationTransform;try{if(a.InitFromAttribute(t))return{quantization_bits:a.quantization_bits(),range:a.range(),min_values:new Float32Array([1,2,3]).map(o=>a.min_value(o))}}finally{this.draco.destroy(a)}}return null}_getOctahedronTransform(t,e){const{octahedronAttributes:n=[]}=e,i=t.attribute_type();if(n.map(a=>this.decoder[a]).includes(i)){const a=new this.draco.AttributeQuantizationTransform;try{if(a.InitFromAttribute(t))return{quantization_bits:a.quantization_bits()}}finally{this.draco.destroy(a)}}return null}}function XJ(r,t){switch(t){case Float32Array:return r.DT_FLOAT32;case Int8Array:return r.DT_INT8;case Int16Array:return r.DT_INT16;case Int32Array:return r.DT_INT32;case Uint8Array:return r.DT_UINT8;case Uint16Array:return r.DT_UINT16;case Uint32Array:return r.DT_UINT32;default:return r.DT_INVALID}}function JJ(r){const t=r.size(),e=new Int32Array(t);for(let n=0;n<t;n++)e[n]=r.GetValue(n);return e}function YJ(r){const t=r.size(),e=new Int32Array(t);for(let n=0;n<t;n++)e[n]=r.GetValue(n);return e}const Qw="https://www.gstatic.com/draco/versioned/decoders/".concat("1.5.5"),ZJ="".concat(Qw,"/draco_decoder.js"),tY="".concat(Qw,"/draco_wasm_wrapper.js"),eY="".concat(Qw,"/draco_decoder.wasm");let Cg;async function rY(r){const t=r.modules||{};return t.draco3d?Cg=Cg||t.draco3d.createDecoderModule({}).then(e=>({draco:e})):Cg=Cg||nY(r),await Cg}async function nY(r){let t,e;switch(r.draco&&r.draco.decoderType){case"js":t=await Ph(ZJ,"draco",r);break;case"wasm":default:[t,e]=await Promise.all([await Ph(tY,"draco",r),await Ph(eY,"draco",r)])}return t=t||globalThis.DracoDecoderModule,await iY(t,e)}function iY(r,t){const e={};return t&&(e.wasmBinary=t),new Promise(n=>{r({...e,onModuleLoaded:i=>n({draco:i})})})}const PL={...VJ,parse:sY};async function sY(r,t){const{draco:e}=await rY(t),n=new WJ(e);try{return n.parseSync(r,t==null?void 0:t.draco)}finally{n.destroy()}}function oY(r){const t={};for(const e in r){const n=r[e];if(e!=="indices"){const i=ML(n);t[e]=i}}return t}function ML(r){const{buffer:t,size:e,count:n}=aY(r);return{value:t,size:e,byteOffset:0,count:n,type:EL(e),componentType:SL(t)}}function aY(r){let t=r,e=1,n=0;return r&&r.value&&(t=r.value,e=r.size||1),t&&(ArrayBuffer.isView(t)||(t=cY(t,Float32Array)),n=t.length/e),{buffer:t,size:e,count:n}}function cY(r,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return r?Array.isArray(r)?new t(r):e&&!(r instanceof t)?new t(r):r:null}const Vh="KHR_draco_mesh_compression",lY=Vh;function uY(r,t,e){const n=new ua(r);for(const i of UL(n))n.getObjectExtension(i,Vh)}async function AY(r,t,e){var n;if(!(t!=null&&(n=t.gltf)!==null&&n!==void 0&&n.decompressMeshes))return;const i=new ua(r),s=[];for(const a of UL(i))i.getObjectExtension(a,Vh)&&s.push(dY(i,a,t,e));await Promise.all(s),i.removeExtension(Vh)}function hY(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const e=new ua(r);for(const n of e.json.meshes||[])fY(n,t),e.addRequiredExtension(Vh)}async function dY(r,t,e,n){const i=r.getObjectExtension(t,Vh);if(!i)return;const s=r.getTypedArrayForBufferView(i.bufferView),a=Lv(s.buffer,s.byteOffset),{parse:o}=n,A={...e};delete A["3d-tiles"];const f=await o(a,PL,A,n),m=oY(f.attributes);for(const[_,x]of Object.entries(m))if(_ in t.attributes){const B=t.attributes[_],P=r.getAccessor(B);P!=null&&P.min&&P!==null&&P!==void 0&&P.max&&(x.min=P.min,x.max=P.max)}t.attributes=m,f.indices&&(t.indices=ML(f.indices)),pY(t)}function fY(r,t){var e;let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:4,i=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0;if(!i.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const a=i.DracoWriter.encodeSync({attributes:r}),o=s==null||(e=s.parseSync)===null||e===void 0?void 0:e.call(s,{attributes:r}),A=i._addFauxAttributes(o.attributes),f=i.addBufferView(a);return{primitives:[{attributes:A,mode:n,extensions:{[Vh]:{bufferView:f,attributes:A}}}]}}function pY(r){if(!r.attributes&&Object.keys(r.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*UL(r){for(const t of r.json.meshes||[])for(const e of t.primitives)yield e}const gY=Object.freeze(Object.defineProperty({__proto__:null,decode:AY,encode:hY,name:lY,preprocess:uY},Symbol.toStringTag,{value:"Module"})),mY={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},yY={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Hw="KHR_texture_transform",_Y=Hw,cy=new le,vY=new zi,bY=new zi;async function wY(r,t){if(!new ua(r).getExtension(Hw))return;const i=r.json.materials||[];for(let s=0;s<i.length;s++)xY(s,r)}function xY(r,t){var e,n,i;const s=[],a=(e=t.json.materials)===null||e===void 0?void 0:e[r],o=a==null||(n=a.pbrMetallicRoughness)===null||n===void 0?void 0:n.baseColorTexture;o&&Eg(t,r,o,s);const A=a==null?void 0:a.emissiveTexture;A&&Eg(t,r,A,s);const f=a==null?void 0:a.normalTexture;f&&Eg(t,r,f,s);const m=a==null?void 0:a.occlusionTexture;m&&Eg(t,r,m,s);const _=a==null||(i=a.pbrMetallicRoughness)===null||i===void 0?void 0:i.metallicRoughnessTexture;_&&Eg(t,r,_,s)}function Eg(r,t,e,n){const i=BY(e,n);if(!i)return;const s=r.json.meshes||[];for(const a of s)for(const o of a.primitives){const A=o.material;Number.isFinite(A)&&t===A&&CY(r,o,i)}}function BY(r,t){var e;const n=(e=r.extensions)===null||e===void 0?void 0:e[Hw],{texCoord:i=0}=r,{texCoord:s=i}=n;if(!(t.findIndex(o=>{let[A,f]=o;return A===i&&f===s})!==-1)){const o=TY(n);return i!==s&&(r.texCoord=s),t.push([i,s]),{originalTexCoord:i,texCoord:s,matrix:o}}return null}function CY(r,t,e){const{originalTexCoord:n,texCoord:i,matrix:s}=e,a=t.attributes["TEXCOORD_".concat(n)];if(Number.isFinite(a)){var o;const f=(o=r.json.accessors)===null||o===void 0?void 0:o[a];if(f&&f.bufferView){var A;const m=(A=r.json.bufferViews)===null||A===void 0?void 0:A[f.bufferView];if(m){const{arrayBuffer:_,byteOffset:x}=r.buffers[m.buffer],B=(x||0)+(f.byteOffset||0)+(m.byteOffset||0),{ArrayType:P,length:M}=Dw(f,m),k=yY[f.componentType],Q=mY[f.type],q=m.byteStride||k*Q,J=new Float32Array(M);for(let tt=0;tt<f.count;tt++){const ft=new P(_,B+tt*q,2);cy.set(ft[0],ft[1],1),cy.transformByMatrix3(s),J.set([cy[0],cy[1]],tt*Q)}n===i?EY(f,m,r.buffers,J):SY(i,f,t,r,J)}}}}function EY(r,t,e,n){r.componentType=5126,e.push({arrayBuffer:n.buffer,byteOffset:0,byteLength:n.buffer.byteLength}),t.buffer=e.length-1,t.byteLength=n.buffer.byteLength,t.byteOffset=0,delete t.byteStride}function SY(r,t,e,n,i){n.buffers.push({arrayBuffer:i.buffer,byteOffset:0,byteLength:i.buffer.byteLength});const s=n.json.bufferViews;if(!s)return;s.push({buffer:n.buffers.length-1,byteLength:i.buffer.byteLength,byteOffset:0});const a=n.json.accessors;a&&(a.push({bufferView:(s==null?void 0:s.length)-1,byteOffset:0,componentType:5126,count:t.count,type:"VEC2"}),e.attributes["TEXCOORD_".concat(r)]=a.length-1)}function TY(r){const{offset:t=[0,0],rotation:e=0,scale:n=[1,1]}=r,i=new zi().set(1,0,0,0,1,0,t[0],t[1],1),s=vY.set(Math.cos(e),Math.sin(e),0,-Math.sin(e),Math.cos(e),0,0,0,1),a=bY.set(n[0],0,0,0,n[1],0,0,0,1);return i.multiplyRight(s).multiplyRight(a)}const IY=Object.freeze(Object.defineProperty({__proto__:null,decode:wY,name:_Y},Symbol.toStringTag,{value:"Module"})),jh="KHR_lights_punctual",LY=jh;async function FY(r){const t=new ua(r),{json:e}=t,n=t.getExtension(jh);n&&(t.json.lights=n.lights,t.removeExtension(jh));for(const i of e.nodes||[]){const s=t.getObjectExtension(i,jh);s&&(i.light=s.light),t.removeObjectExtension(i,jh)}}async function PY(r){const t=new ua(r),{json:e}=t;if(e.lights){const n=t.addExtension(jh);Da(!n.lights),n.lights=e.lights,delete e.lights}if(t.json.lights){for(const n of t.json.lights){const i=n.node;t.addObjectExtension(i,jh,n)}delete t.json.lights}}const MY=Object.freeze(Object.defineProperty({__proto__:null,decode:FY,encode:PY,name:LY},Symbol.toStringTag,{value:"Module"})),Sg="KHR_materials_unlit",UY=Sg;async function RY(r){const t=new ua(r),{json:e}=t;for(const n of e.materials||[])n.extensions&&n.extensions.KHR_materials_unlit&&(n.unlit=!0),t.removeObjectExtension(n,Sg);t.removeExtension(Sg)}function OY(r){const t=new ua(r),{json:e}=t;if(t.materials)for(const n of e.materials||[])n.unlit&&(delete n.unlit,t.addObjectExtension(n,Sg,{}),t.addExtension(Sg))}const DY=Object.freeze(Object.defineProperty({__proto__:null,decode:RY,encode:OY,name:UY},Symbol.toStringTag,{value:"Module"})),Tg="KHR_techniques_webgl",NY=Tg;async function kY(r){const t=new ua(r),{json:e}=t,n=t.getExtension(Tg);if(n){const i=HY(n,t);for(const s of e.materials||[]){const a=t.getObjectExtension(s,Tg);a&&(s.technique=Object.assign({},a,i[a.technique]),s.technique.values=zY(s.technique,t)),t.removeObjectExtension(s,Tg)}t.removeExtension(Tg)}}async function QY(r,t){}function HY(r,t){const{programs:e=[],shaders:n=[],techniques:i=[]}=r,s=new TextDecoder;return n.forEach(a=>{if(Number.isFinite(a.bufferView))a.code=s.decode(t.getTypedArrayForBufferView(a.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),e.forEach(a=>{a.fragmentShader=n[a.fragmentShader],a.vertexShader=n[a.vertexShader]}),i.forEach(a=>{a.program=e[a.program]}),i}function zY(r,t){const e=Object.assign({},r.values);return Object.keys(r.uniforms||{}).forEach(n=>{r.uniforms[n].value&&!(n in e)&&(e[n]=r.uniforms[n].value)}),Object.keys(e).forEach(n=>{typeof e[n]=="object"&&e[n].index!==void 0&&(e[n].texture=t.getTexture(e[n].index))}),e}const GY=Object.freeze(Object.defineProperty({__proto__:null,decode:kY,encode:QY,name:NY},Symbol.toStringTag,{value:"Module"})),RL="EXT_feature_metadata",VY=RL;async function jY(r){const t=new ua(r);qY(t)}function qY(r){var t;const e=r.getExtension(RL),n=e==null||(t=e.schema)===null||t===void 0?void 0:t.classes,i=e==null?void 0:e.featureTables;if((e==null?void 0:e.featureTextures)&&console.warn('featureTextures is not yet supported in the "EXT_feature_metadata" extension.'),n&&i)for(const a in n){const o=n[a],A=WY(i,a);A&&KY(r,A,o)}}function KY(r,t,e){for(const i in e.properties){var n;const s=e.properties[i],a=t==null||(n=t.properties)===null||n===void 0?void 0:n[i],o=t.count;if(a){const A=$Y(r,s,o,a);a.data=A}}}function $Y(r,t,e,n){const i=n.bufferView;let s=r.getTypedArrayForBufferView(i);switch(t.type){case"STRING":{const a=n.stringOffsetBufferView,o=r.getTypedArrayForBufferView(a);s=XY(s,o,e);break}}return s}function WY(r,t){for(const e in r){const n=r[e];if(n.class===t)return n}return null}function XY(r,t,e){const n=[],i=new TextDecoder("utf8");let s=0;const a=4;for(let o=0;o<e;o++){const A=t[(o+1)*a]-t[o*a],f=r.subarray(s,A+s),m=i.decode(f);n.push(m),s+=A}return n}const OL=[DJ,QJ,GJ,gY,MY,DY,GY,IY,Object.freeze(Object.defineProperty({__proto__:null,decode:jY,name:VY},Symbol.toStringTag,{value:"Module"}))];function JY(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=arguments.length>2?arguments[2]:void 0;const n=OL.filter(s=>DL(s.name,t));for(const s of n){var i;(i=s.preprocess)===null||i===void 0||i.call(s,r,t,e)}}async function YY(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=arguments.length>2?arguments[2]:void 0;const n=OL.filter(s=>DL(s.name,t));for(const s of n){var i;await((i=s.decode)===null||i===void 0?void 0:i.call(s,r,t,e))}}function DL(r,t){var e;const n=(t==null||(e=t.gltf)===null||e===void 0?void 0:e.excludeExtensions)||{};return!(r in n&&!n[r])}const zw="KHR_binary_glTF";function ZY(r){const t=new ua(r),{json:e}=t;for(const n of e.images||[]){const i=t.getObjectExtension(n,zw);i&&Object.assign(n,i),t.removeObjectExtension(n,zw)}e.buffers&&e.buffers[0]&&delete e.buffers[0].uri,t.removeExtension(zw)}const NL={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},tZ={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class eZ{constructor(){$(this,"idToIndexMap",{animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}}),$(this,"json",void 0)}normalize(t,e){this.json=t.json;const n=t.json;switch(n.asset&&n.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn("glTF: Unknown version ".concat(n.asset.version));return}if(!e.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(n),this._convertTopLevelObjectsToArrays(n),ZY(t),this._convertObjectIdsToArrayIndices(n),this._updateObjects(n),this._updateMaterial(n)}_addAsset(t){t.asset=t.asset||{},t.asset.version="2.0",t.asset.generator=t.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(t){for(const e in NL)this._convertTopLevelObjectToArray(t,e)}_convertTopLevelObjectToArray(t,e){const n=t[e];if(!(!n||Array.isArray(n))){t[e]=[];for(const i in n){const s=n[i];s.id=s.id||i;const a=t[e].length;t[e].push(s),this.idToIndexMap[e][i]=a}}}_convertObjectIdsToArrayIndices(t){for(const e in NL)this._convertIdsToIndices(t,e);"scene"in t&&(t.scene=this._convertIdToIndex(t.scene,"scene"));for(const e of t.textures)this._convertTextureIds(e);for(const e of t.meshes)this._convertMeshIds(e);for(const e of t.nodes)this._convertNodeIds(e);for(const e of t.scenes)this._convertSceneIds(e)}_convertTextureIds(t){t.source&&(t.source=this._convertIdToIndex(t.source,"image"))}_convertMeshIds(t){for(const e of t.primitives){const{attributes:n,indices:i,material:s}=e;for(const a in n)n[a]=this._convertIdToIndex(n[a],"accessor");i&&(e.indices=this._convertIdToIndex(i,"accessor")),s&&(e.material=this._convertIdToIndex(s,"material"))}}_convertNodeIds(t){t.children&&(t.children=t.children.map(e=>this._convertIdToIndex(e,"node"))),t.meshes&&(t.meshes=t.meshes.map(e=>this._convertIdToIndex(e,"mesh")))}_convertSceneIds(t){t.nodes&&(t.nodes=t.nodes.map(e=>this._convertIdToIndex(e,"node")))}_convertIdsToIndices(t,e){t[e]||(console.warn("gltf v1: json doesn't contain attribute ".concat(e)),t[e]=[]);for(const n of t[e])for(const i in n){const s=n[i],a=this._convertIdToIndex(s,i);n[i]=a}}_convertIdToIndex(t,e){const n=tZ[e];if(n in this.idToIndexMap){const i=this.idToIndexMap[n][t];if(!Number.isFinite(i))throw new Error("gltf v1: failed to resolve ".concat(e," with id ").concat(t));return i}return t}_updateObjects(t){for(const e of this.json.buffers)delete e.type}_updateMaterial(t){for(const s of t.materials){var e,n,i;s.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const a=((e=s.values)===null||e===void 0?void 0:e.tex)||((n=s.values)===null||n===void 0?void 0:n.texture2d_0)||((i=s.values)===null||i===void 0?void 0:i.diffuseTex),o=t.textures.findIndex(A=>A.id===a);o!==-1&&(s.pbrMetallicRoughness.baseColorTexture={index:o})}}}function rZ(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new eZ().normalize(r,t)}const nZ={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},iZ={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},oc={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},sZ={magFilter:oc.TEXTURE_MAG_FILTER,minFilter:oc.TEXTURE_MIN_FILTER,wrapS:oc.TEXTURE_WRAP_S,wrapT:oc.TEXTURE_WRAP_T},oZ={[oc.TEXTURE_MAG_FILTER]:oc.LINEAR,[oc.TEXTURE_MIN_FILTER]:oc.NEAREST_MIPMAP_LINEAR,[oc.TEXTURE_WRAP_S]:oc.REPEAT,[oc.TEXTURE_WRAP_T]:oc.REPEAT};function aZ(r){return iZ[r]}function cZ(r){return nZ[r]}class lZ{constructor(){$(this,"baseUri",""),$(this,"json",{}),$(this,"buffers",[]),$(this,"images",[])}postProcess(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{json:n,buffers:i=[],images:s=[],baseUri:a=""}=t;return Da(n),this.baseUri=a,this.json=n,this.buffers=i,this.images=s,this._resolveTree(this.json,e),this.json}_resolveTree(t){t.bufferViews&&(t.bufferViews=t.bufferViews.map((e,n)=>this._resolveBufferView(e,n))),t.images&&(t.images=t.images.map((e,n)=>this._resolveImage(e,n))),t.samplers&&(t.samplers=t.samplers.map((e,n)=>this._resolveSampler(e,n))),t.textures&&(t.textures=t.textures.map((e,n)=>this._resolveTexture(e,n))),t.accessors&&(t.accessors=t.accessors.map((e,n)=>this._resolveAccessor(e,n))),t.materials&&(t.materials=t.materials.map((e,n)=>this._resolveMaterial(e,n))),t.meshes&&(t.meshes=t.meshes.map((e,n)=>this._resolveMesh(e,n))),t.nodes&&(t.nodes=t.nodes.map((e,n)=>this._resolveNode(e,n))),t.skins&&(t.skins=t.skins.map((e,n)=>this._resolveSkin(e,n))),t.scenes&&(t.scenes=t.scenes.map((e,n)=>this._resolveScene(e,n))),t.scene!==void 0&&(t.scene=t.scenes[this.json.scene])}getScene(t){return this._get("scenes",t)}getNode(t){return this._get("nodes",t)}getSkin(t){return this._get("skins",t)}getMesh(t){return this._get("meshes",t)}getMaterial(t){return this._get("materials",t)}getAccessor(t){return this._get("accessors",t)}getCamera(t){return null}getTexture(t){return this._get("textures",t)}getSampler(t){return this._get("samplers",t)}getImage(t){return this._get("images",t)}getBufferView(t){return this._get("bufferViews",t)}getBuffer(t){return this._get("buffers",t)}_get(t,e){if(typeof e=="object")return e;const n=this.json[t]&&this.json[t][e];return n||console.warn("glTF file error: Could not find ".concat(t,"[").concat(e,"]")),n}_resolveScene(t,e){return t.id=t.id||"scene-".concat(e),t.nodes=(t.nodes||[]).map(n=>this.getNode(n)),t}_resolveNode(t,e){return t.id=t.id||"node-".concat(e),t.children&&(t.children=t.children.map(n=>this.getNode(n))),t.mesh!==void 0?t.mesh=this.getMesh(t.mesh):t.meshes!==void 0&&t.meshes.length&&(t.mesh=t.meshes.reduce((n,i)=>{const s=this.getMesh(i);return n.id=s.id,n.primitives=n.primitives.concat(s.primitives),n},{primitives:[]})),t.camera!==void 0&&(t.camera=this.getCamera(t.camera)),t.skin!==void 0&&(t.skin=this.getSkin(t.skin)),t}_resolveSkin(t,e){return t.id=t.id||"skin-".concat(e),t.inverseBindMatrices=this.getAccessor(t.inverseBindMatrices),t}_resolveMesh(t,e){return t.id=t.id||"mesh-".concat(e),t.primitives&&(t.primitives=t.primitives.map(n=>{n={...n};const i=n.attributes;n.attributes={};for(const s in i)n.attributes[s]=this.getAccessor(i[s]);return n.indices!==void 0&&(n.indices=this.getAccessor(n.indices)),n.material!==void 0&&(n.material=this.getMaterial(n.material)),n})),t}_resolveMaterial(t,e){if(t.id=t.id||"material-".concat(e),t.normalTexture&&(t.normalTexture={...t.normalTexture},t.normalTexture.texture=this.getTexture(t.normalTexture.index)),t.occlusionTexture&&(t.occlustionTexture={...t.occlustionTexture},t.occlusionTexture.texture=this.getTexture(t.occlusionTexture.index)),t.emissiveTexture&&(t.emmisiveTexture={...t.emmisiveTexture},t.emissiveTexture.texture=this.getTexture(t.emissiveTexture.index)),t.emissiveFactor||(t.emissiveFactor=t.emmisiveTexture?[1,1,1]:[0,0,0]),t.pbrMetallicRoughness){t.pbrMetallicRoughness={...t.pbrMetallicRoughness};const n=t.pbrMetallicRoughness;n.baseColorTexture&&(n.baseColorTexture={...n.baseColorTexture},n.baseColorTexture.texture=this.getTexture(n.baseColorTexture.index)),n.metallicRoughnessTexture&&(n.metallicRoughnessTexture={...n.metallicRoughnessTexture},n.metallicRoughnessTexture.texture=this.getTexture(n.metallicRoughnessTexture.index))}return t}_resolveAccessor(t,e){if(t.id=t.id||"accessor-".concat(e),t.bufferView!==void 0&&(t.bufferView=this.getBufferView(t.bufferView)),t.bytesPerComponent=aZ(t.componentType),t.components=cZ(t.type),t.bytesPerElement=t.bytesPerComponent*t.components,t.bufferView){const n=t.bufferView.buffer,{ArrayType:i,byteLength:s}=Dw(t,t.bufferView),a=(t.bufferView.byteOffset||0)+(t.byteOffset||0)+n.byteOffset;let o=n.arrayBuffer.slice(a,a+s);t.bufferView.byteStride&&(o=this._getValueFromInterleavedBuffer(n,a,t.bufferView.byteStride,t.bytesPerElement,t.count)),t.value=new i(o)}return t}_getValueFromInterleavedBuffer(t,e,n,i,s){const a=new Uint8Array(s*i);for(let o=0;o<s;o++){const A=e+o*n;a.set(new Uint8Array(t.arrayBuffer.slice(A,A+i)),o*i)}return a.buffer}_resolveTexture(t,e){return t.id=t.id||"texture-".concat(e),t.sampler="sampler"in t?this.getSampler(t.sampler):oZ,t.source=this.getImage(t.source),t}_resolveSampler(t,e){t.id=t.id||"sampler-".concat(e),t.parameters={};for(const n in t){const i=this._enumSamplerParameter(n);i!==void 0&&(t.parameters[i]=t[n])}return t}_enumSamplerParameter(t){return sZ[t]}_resolveImage(t,e){t.id=t.id||"image-".concat(e),t.bufferView!==void 0&&(t.bufferView=this.getBufferView(t.bufferView));const n=this.images[e];return n&&(t.image=n),t}_resolveBufferView(t,e){const n=t.buffer,i={id:"bufferView-".concat(e),...t,buffer:this.buffers[n]},s=this.buffers[n].arrayBuffer;let a=this.buffers[n].byteOffset||0;return"byteOffset"in t&&(a+=t.byteOffset),i.data=new Uint8Array(s,a,t.byteLength),i}_resolveCamera(t,e){return t.id=t.id||"camera-".concat(e),t.perspective,t.orthographic,t}}function uZ(r,t){return new lZ().postProcess(r,t)}const kL=1735152710,Gw=12,ly=8,AZ=1313821514,hZ=5130562,dZ=0,fZ=1,pZ=0,mf=!0;function gZ(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return"".concat(String.fromCharCode(r.getUint8(t+0))).concat(String.fromCharCode(r.getUint8(t+1))).concat(String.fromCharCode(r.getUint8(t+2))).concat(String.fromCharCode(r.getUint8(t+3)))}function mZ(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const n=new DataView(r),{magic:i=kL}=e,s=n.getUint32(t,!1);return s===i||s===kL}function yZ(r,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const n=new DataView(t),i=gZ(n,e+0),s=n.getUint32(e+4,mf),a=n.getUint32(e+8,mf);switch(Object.assign(r,{header:{byteOffset:e,byteLength:a,hasBinChunk:!1},type:i,version:s,json:{},binChunks:[]}),e+=Gw,r.version){case 1:return _Z(r,n,e);case 2:return vZ(r,n,e,{});default:throw new Error("Invalid GLB version ".concat(r.version,". Only supports v1 and v2."))}}function _Z(r,t,e){li(r.header.byteLength>Gw+ly);const n=t.getUint32(e+0,mf),i=t.getUint32(e+4,mf);return e+=ly,li(i===pZ),Vw(r,t,e,n),e+=n,e+=jw(r,t,e,r.header.byteLength),e}function vZ(r,t,e,n){return li(r.header.byteLength>Gw+ly),bZ(r,t,e,n),e+r.header.byteLength}function bZ(r,t,e,n){for(;e+8<=r.header.byteLength;){const i=t.getUint32(e+0,mf),s=t.getUint32(e+4,mf);switch(e+=ly,s){case AZ:Vw(r,t,e,i);break;case hZ:jw(r,t,e,i);break;case dZ:n.strict||Vw(r,t,e,i);break;case fZ:n.strict||jw(r,t,e,i);break}e+=Hp(i,4)}return e}function Vw(r,t,e,n){const i=new Uint8Array(t.buffer,e,n),a=new TextDecoder("utf8").decode(i);return r.json=JSON.parse(a),Hp(n,4)}function jw(r,t,e,n){return r.header.hasBinChunk=!0,r.binChunks.push({byteOffset:e,byteLength:n,arrayBuffer:t.buffer}),Hp(n,4)}async function wZ(r,t){var e,n,i,s;let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,o=arguments.length>3?arguments[3]:void 0,A=arguments.length>4?arguments[4]:void 0;xZ(r,t,a,o),rZ(r,{normalize:o==null||(e=o.gltf)===null||e===void 0?void 0:e.normalize}),JY(r,o,A);const f=[];if(o!=null&&(n=o.gltf)!==null&&n!==void 0&&n.loadBuffers&&r.json.buffers&&await BZ(r,o,A),o!=null&&(i=o.gltf)!==null&&i!==void 0&&i.loadImages){const _=CZ(r,o,A);f.push(_)}const m=YY(r,o,A);return f.push(m),await Promise.all(f),o!=null&&(s=o.gltf)!==null&&s!==void 0&&s.postProcess?uZ(r,o):r}function xZ(r,t,e,n){if(n.uri&&(r.baseUri=n.uri),t instanceof ArrayBuffer&&!mZ(t,e,n)&&(t=new TextDecoder().decode(t)),typeof t=="string")r.json=V8(t);else if(t instanceof ArrayBuffer){const a={};e=yZ(a,t,e,n.glb),Da(a.type==="glTF","Invalid GLB magic string ".concat(a.type)),r._glb=a,r.json=a.json}else Da(!1,"GLTF: must be ArrayBuffer or string");const i=r.json.buffers||[];if(r.buffers=new Array(i.length).fill(null),r._glb&&r._glb.header.hasBinChunk){const{binChunks:a}=r._glb;r.buffers[0]={arrayBuffer:a[0].arrayBuffer,byteOffset:a[0].byteOffset,byteLength:a[0].byteLength}}const s=r.json.images||[];r.images=new Array(s.length).fill({})}async function BZ(r,t,e){const n=r.json.buffers||[];for(let a=0;a<n.length;++a){const o=n[a];if(o.uri){var i,s;const{fetch:A}=e;Da(A);const f=BL(o.uri,t),m=await(e==null||(i=e.fetch)===null||i===void 0?void 0:i.call(e,f)),_=await(m==null||(s=m.arrayBuffer)===null||s===void 0?void 0:s.call(m));r.buffers[a]={arrayBuffer:_,byteOffset:0,byteLength:_.byteLength},delete o.uri}else r.buffers[a]===null&&(r.buffers[a]={arrayBuffer:new ArrayBuffer(o.byteLength),byteOffset:0,byteLength:o.byteLength})}}async function CZ(r,t,e){const n=EZ(r),i=r.json.images||[],s=[];for(const a of n)s.push(SZ(r,i[a],a,t,e));return await Promise.all(s)}function EZ(r){const t=new Set,e=r.json.textures||[];for(const n of e)n.source!==void 0&&t.add(n.source);return Array.from(t).sort()}async function SZ(r,t,e,n,i){const{fetch:s,parse:a}=i;let o;if(t.uri&&!t.hasOwnProperty("bufferView")){const f=BL(t.uri,n);o=await(await s(f)).arrayBuffer(),t.bufferView={data:o}}if(Number.isFinite(t.bufferView)){const f=gJ(r.json,r.buffers,t.bufferView);o=Lv(f.buffer,f.byteOffset,f.byteLength)}Da(o,"glTF image has no data");let A=await a(o,[CT,pJ],{mimeType:t.mimeType,basis:n.basis||{format:xL()}},i);A&&A[0]&&(A={compressed:!0,mipmaps:!1,width:A[0].width,height:A[0].height,data:A[0]}),r.images=r.images||[],r.images[e]=A}const Ig={name:"glTF",id:"gltf",module:"gltf",version:ZX,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:TZ,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0,postProcess:!0},log:console},deprecatedOptions:{fetchImages:"gltf.loadImages",createImages:"gltf.loadImages",decompress:"gltf.decompressMeshes",postProcess:"gltf.postProcess",gltf:{decompress:"gltf.decompressMeshes"}}};async function TZ(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=arguments.length>2?arguments[2]:void 0;t={...Ig.options,...t},t.gltf={...Ig.options.gltf,...t.gltf};const{byteOffset:n=0}=t;return await wZ({},r,n,t,e)}async function IZ(r){const t=[];return r.scenes.forEach(e=>{e.traverse(n=>{Object.values(n.model.getUniforms()).forEach(i=>{i.loaded===!1&&t.push(i)})})}),await LZ(()=>t.some(e=>!e.loaded))}async function LZ(r){for(;r();)await new Promise(t=>requestAnimationFrame(t))}const FZ=`#version 300 es
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
in vec3 instanceTranslation;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform mat4 sceneModelMatrix;
uniform bool composeModelMatrix;
in vec4 POSITION;

#ifdef HAS_UV
  in vec2 TEXCOORD_0;
#endif

#ifdef MODULE_PBR
  #ifdef HAS_NORMALS
    in vec4 NORMAL;
  #endif
#endif
out vec4 vColor;
#ifndef MODULE_PBR
  #ifdef HAS_UV
    out vec2 vTEXCOORD_0;
  #endif
#endif
void main(void) {
  #if defined(HAS_UV) && !defined(MODULE_PBR)
    vTEXCOORD_0 = TEXCOORD_0;
    geometry.uv = vTEXCOORD_0;
  #endif

  geometry.worldPosition = instancePositions;
  geometry.pickingColor = instancePickingColors;

  vec3 normal = vec3(0.0, 0.0, 1.0);
  #ifdef MODULE_PBR
    #ifdef HAS_NORMALS
      normal = instanceModelMatrix * (sceneModelMatrix * vec4(NORMAL.xyz, 0.0)).xyz;
    #endif
  #endif

  float originalSize = project_size_to_pixel(sizeScale);
  float clampedSize = clamp(originalSize, sizeMinPixels, sizeMaxPixels);

  vec3 pos = (instanceModelMatrix * (sceneModelMatrix * POSITION).xyz) * sizeScale * (clampedSize / originalSize) + instanceTranslation;
  if(composeModelMatrix) {
    DECKGL_FILTER_SIZE(pos, geometry);
    geometry.normal = project_normal(normal);
    geometry.worldPosition += pos;
    gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
  }
  else {
    pos = project_size(pos);
    DECKGL_FILTER_SIZE(pos, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, geometry.position);
    geometry.normal = project_normal(normal);
  }
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  #ifdef MODULE_PBR
    pbr_vPosition = geometry.position.xyz;
    #ifdef HAS_NORMALS
      pbr_vNormal = geometry.normal;
    #endif

    #ifdef HAS_UV
      pbr_vUV = TEXCOORD_0;
    #else
      pbr_vUV = vec2(0., 0.);
    #endif
    geometry.uv = pbr_vUV;
  #endif

  vColor = instanceColors;
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,PZ=`#version 300 es
uniform float opacity;
in vec4 vColor;

out vec4 fragmentColor;
#ifndef MODULE_PBR
  #if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
    in vec2 vTEXCOORD_0;
    uniform sampler2D u_BaseColorSampler;
  #endif
#endif

void main(void) {
  #ifdef MODULE_PBR
    fragmentColor = vColor * pbr_filterColor(vec4(0));
    geometry.uv = pbr_vUV;
  #else
    #if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
      fragmentColor = vColor * texture2D(u_BaseColorSampler, vTEXCOORD_0);
      geometry.uv = vTEXCOORD_0;
    #else
      fragmentColor = vColor;
    #endif
  #endif

  fragmentColor.a *= opacity;
  DECKGL_FILTER_COLOR(fragmentColor, geometry);
}
`,QL=[255,255,255,255],MZ={scenegraph:{type:"object",value:null,async:!0},getScene:r=>r&&r.scenes?typeof r.scene=="object"?r.scene:r.scenes[r.scene||0]:r,getAnimator:r=>r&&r.animator,_animations:null,sizeScale:{type:"number",value:1,min:0},sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},getPosition:{type:"accessor",value:r=>r.position},getColor:{type:"accessor",value:QL},_lighting:"flat",_imageBasedLightingEnvironment:null,getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},loaders:[Ig]};class qw extends Af{constructor(){super(...arguments),$(this,"state",void 0)}getShaders(){const t=[nw,iw];return this.props._lighting==="pbr"&&t.push(Gb),super.getShaders({vs:FZ,fs:PZ,modules:t})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),accessor:"getPosition",transition:!0},instanceColors:{type:5121,size:this.props.colorFormat.length,accessor:"getColor",normalized:!0,defaultValue:QL,transition:!0},instanceModelMatrix:WI})}updateState(t){super.updateState(t);const{props:e,oldProps:n}=t;e.scenegraph!==n.scenegraph?this._updateScenegraph():e._animations!==n._animations&&this._applyAnimationsProp(this.state.scenegraph,this.state.animator,e._animations)}finalizeState(t){super.finalizeState(t),this._deleteScenegraph()}get isLoaded(){var t;return((t=this.state)===null||t===void 0?void 0:t.scenegraph)&&super.isLoaded}_updateScenegraph(){const t=this.props,{gl:e}=this.context;let n=null;if(t.scenegraph instanceof ff)n={scenes:[t.scenegraph]};else if(t.scenegraph&&!t.scenegraph.gltf){const o=t.scenegraph,A=YX(e,o,this._getModelOptions());n={gltf:o,...A},IZ(A).then(()=>this.setNeedsRedraw())}else t.scenegraph&&(Pn.deprecated("ScenegraphLayer.props.scenegraph","Use GLTFLoader instead of GLTFScenegraphLoader")(),n=t.scenegraph);const i={layer:this,gl:e},s=t.getScene(n,i),a=t.getAnimator(n,i);s instanceof ff?(this._deleteScenegraph(),this._applyAllAttributes(s),this._applyAnimationsProp(s,a,t._animations),this.setState({scenegraph:s,animator:a})):s!==null&&Pn.warn("invalid scenegraph:",s)()}_applyAllAttributes(t){if(this.state.attributesAvailable){const e=this.getAttributeManager().getAttributes();t.traverse(n=>{this._setModelAttributes(n.model,e)})}}_applyAnimationsProp(t,e,n){if(!t||!e||!n)return;const i=e.getAnimations();Object.keys(n).sort().forEach(s=>{const a=n[s];if(s==="*")i.forEach(o=>{Object.assign(o,a)});else if(Number.isFinite(Number(s))){const o=Number(s);o>=0&&o<i.length?Object.assign(i[o],a):Pn.warn("animation ".concat(s," not found"))()}else{const o=i.find(A=>{let{name:f}=A;return f===s});o?Object.assign(o,a):Pn.warn("animation ".concat(s," not found"))()}})}_deleteScenegraph(){const{scenegraph:t}=this.state;t instanceof ff&&t.delete()}_getModelOptions(){const{_imageBasedLightingEnvironment:t}=this.props;let e=null;return t&&(typeof t=="function"?e=t({gl:this.context.gl,layer:this}):e=t),{gl:this.context.gl,waitForFullLoad:!0,imageBasedLightingEnvironment:e,modelOptions:{isInstanced:!0,transpileToGLSL100:!gn(this.context.gl),...this.getShaders()},useTangents:!1}}updateAttributes(t){this.setState({attributesAvailable:!0}),this.state.scenegraph&&this.state.scenegraph.traverse(e=>{this._setModelAttributes(e.model,t)})}draw(t){let{moduleParameters:e=null,parameters:n={},context:i}=t;if(!this.state.scenegraph)return;this.props._animations&&this.state.animator&&(this.state.animator.animate(i.timeline.getTime()),this.setNeedsRedraw());const{viewport:s}=this.context,{sizeScale:a,sizeMinPixels:o,sizeMaxPixels:A,opacity:f,coordinateSystem:m}=this.props,_=this.getNumInstances();this.state.scenegraph.traverse((x,B)=>{let{worldMatrix:P}=B;x.model.setInstanceCount(_),x.updateModuleSettings(e),x.draw({parameters:n,uniforms:{sizeScale:a,opacity:f,sizeMinPixels:o,sizeMaxPixels:A,composeModelMatrix:XI(s,m),sceneModelMatrix:P,u_Camera:x.model.getUniforms().project_uCameraPosition}})})}}$(qw,"defaultProps",MZ),$(qw,"layerName","ScenegraphLayer");const UZ=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
uniform float sizeScale;
uniform bool composeModelMatrix;
uniform bool pickFeatureIds;
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec4 uvRegions;
in vec3 featureIdsPickingColors;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;

vec2 applyUVRegion(vec2 uv) {
  #ifdef HAS_UV_REGIONS
    return fract(uv) * (uvRegions.zw - uvRegions.xy) + uvRegions.xy;
  #else
    return uv;
  #endif
}

void main(void) {
  vec2 uv = applyUVRegion(texCoords);
  geometry.uv = uv;

  if (pickFeatureIds) {
    geometry.pickingColor = featureIdsPickingColors;
  } else {
    geometry.pickingColor = instancePickingColors;
  }

  vTexCoord = uv;
  cameraPosition = project_uCameraPosition;
  vColor = vec4(colors * instanceColors.rgb, instanceColors.a);

  vec3 pos = (instanceModelMatrix * positions) * sizeScale;
  vec3 projectedPosition = project_position(positions);
  position_commonspace = vec4(projectedPosition, 1.0);
  gl_Position = project_common_position_to_clipspace(position_commonspace);

  geometry.position = position_commonspace;
  normals_commonspace = project_normal(instanceModelMatrix * normals);
  geometry.normal = normals_commonspace;

  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  #ifdef MODULE_PBR
    pbr_vPosition = geometry.position.xyz;
    #ifdef HAS_NORMALS
      pbr_vNormal = geometry.normal;
    #endif

    #ifdef HAS_UV
      pbr_vUV = uv;
    #else
      pbr_vUV = vec2(0., 0.);
    #endif
    geometry.uv = pbr_vUV;
  #endif

  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,RZ=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs

precision highp float;

uniform bool hasTexture;
uniform sampler2D sampler;
uniform bool flatShading;
uniform float opacity;

in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;

out vec4 fragColor;

void main(void) {
  
#ifdef MODULE_PBR

  fragColor = vColor * pbr_filterColor(vec4(0));
  geometry.uv = pbr_vUV;
  fragColor.a *= opacity;

#else

  geometry.uv = vTexCoord;

  vec3 normal;
  if (flatShading) {
#ifdef DERIVATIVES_AVAILABLE
    normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
#else
    normal = vec3(0.0, 0.0, 1.0);
#endif
  } else {
    normal = normals_commonspace;
  }

  vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;
  vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
  fragColor = vec4(lightColor, color.a * opacity);

#endif

  DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;function OZ(r){r.COLOR_0||r.colors||(r.colors={constant:!0,value:new Float32Array([1,1,1])})}const DZ={pbrMaterial:{type:"object",value:null},featureIds:{type:"array",value:null,optional:!0}};class Kw extends Pw{getShaders(){const t=super.getShaders();return t.modules.push(Gb),{...t,vs:UZ,fs:RZ}}initializeState(){const{featureIds:t}=this.props;super.initializeState();const e=this.getAttributeManager();t&&e.add({featureIdsPickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateFeatureIdsPickingColors}})}updateState(t){super.updateState(t);const{props:e,oldProps:n}=t;e.pbrMaterial!==n.pbrMaterial&&this.updatePbrMaterialUniforms(e.pbrMaterial)}draw(t){const{featureIds:e}=this.props;this.state.model&&(this.state.model.setUniforms({u_Camera:this.state.model.getUniforms().project_uCameraPosition,pickFeatureIds:!!e}),super.draw(t))}getModel(t){const{id:e,pbrMaterial:n}=this.props,i=this.parseMaterial(n,t);this.setState({materialParser:i});const s=this.getShaders();return OZ(t.attributes),new tf(this.context.gl,{...this.getShaders(),id:e,geometry:t,defines:{...s.defines,...i==null?void 0:i.defines,HAS_UV_REGIONS:t.attributes.uvRegions},parameters:i==null?void 0:i.parameters,isInstanced:!0})}updatePbrMaterialUniforms(t){const{model:e}=this.state;if(e){const{mesh:n}=this.props,i=this.parseMaterial(t,n);this.setState({materialParser:i}),e.setUniforms(i.uniforms)}}parseMaterial(t,e){var n;const i=!!(t.pbrMetallicRoughness&&t.pbrMetallicRoughness.baseColorTexture);return(n=this.state.materialParser)===null||n===void 0||n.delete(),new aL(this.context.gl,{attributes:{NORMAL:e.attributes.normals,TEXCOORD_0:e.attributes.texCoords},material:{unlit:i,...t},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1})}calculateFeatureIdsPickingColors(t){const e=this.props.featureIds,n=new Uint8ClampedArray(e.length*t.size),i=[];for(let s=0;s<e.length;s++)this.encodePickingColor(e[s],i),n[s*3]=i[0],n[s*3+1]=i[1],n[s*3+2]=i[2];t.value=n}finalizeState(t){var e;super.finalizeState(t),(e=this.state.materialParser)===null||e===void 0||e.delete(),this.setState({materialParser:null})}}$(Kw,"layerName","MeshLayer"),$(Kw,"defaultProps",DZ);const NZ=6378137,kZ=6378137,QZ=6356752314245179e-9;function uy(r){return r}new le;function HZ(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:uy;return"longitude"in r?(t[0]=e(r.longitude),t[1]=e(r.latitude),t[2]=r.height):"x"in r?(t[0]=e(r.x),t[1]=e(r.y),t[2]=r.z):(t[0]=e(r[0]),t[1]=e(r[1]),t[2]=r[2]),t}function zZ(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return HZ(r,t,Cs._cartographicRadians?uy:ZG)}function GZ(r,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:uy;return"longitude"in t?(t.longitude=e(r[0]),t.latitude=e(r[1]),t.height=r[2]):"x"in t?(t.x=e(r[0]),t.y=e(r[1]),t.z=r[2]):(t[0]=e(r[0]),t[1]=e(r[1]),t[2]=r[2]),t}function VZ(r,t){return GZ(r,t,Cs._cartographicRadians?uy:tV)}const yf=new le,jZ=new le,qZ=new le;function KZ(r,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];const{oneOverRadii:n,oneOverRadiiSquared:i,centerToleranceSquared:s}=t;yf.from(r);const a=yf.x,o=yf.y,A=yf.z,f=n.x,m=n.y,_=n.z,x=a*a*f*f,B=o*o*m*m,P=A*A*_*_,M=x+B+P,k=Math.sqrt(1/M);if(!Number.isFinite(k))return;const Q=jZ;if(Q.copy(r).scale(k),M<s)return Q.to(e);const q=i.x,J=i.y,tt=i.z,ft=qZ;ft.set(Q.x*q*2,Q.y*J*2,Q.z*tt*2);let pt=(1-k)*yf.len()/(.5*ft.len()),mt=0,dt,Rt,Lt,st;do{pt-=mt,dt=1/(1+pt*q),Rt=1/(1+pt*J),Lt=1/(1+pt*tt);const ct=dt*dt,wt=Rt*Rt,yt=Lt*Lt,te=ct*dt,Zt=wt*Rt,re=yt*Lt;st=x*ct+B*wt+P*yt-1;const ne=-2*(x*te*q+B*Zt*J+P*re*tt);mt=st/ne}while(Math.abs(st)>ug.EPSILON12);return yf.scale([dt,Rt,Lt]).to(e)}const HL=1e-14,$Z=new le,zL={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},$w={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},Lg={east:new le,north:new le,up:new le,west:new le,south:new le,down:new le},WZ=new le,XZ=new le,JZ=new le;function VL(r,t,e,n,i,s){const a=zL[t]&&zL[t][e];Hc(a&&(!n||n===a));let o,A,f;const m=$Z.copy(i);if(zc(m.x,0,HL)&&zc(m.y,0,HL)){const x=Math.sign(m.z);o=WZ.fromArray($w[t]),t!=="east"&&t!=="west"&&o.scale(x),A=XZ.fromArray($w[e]),e!=="east"&&e!=="west"&&A.scale(x),f=JZ.fromArray($w[n]),n!=="east"&&n!=="west"&&f.scale(x)}else{const{up:x,east:B,north:P}=Lg;B.set(-m.y,m.x,0).normalize(),r.geodeticSurfaceNormal(m,x),P.copy(x).cross(B);const{down:M,west:k,south:Q}=Lg;M.copy(x).scale(-1),k.copy(B).scale(-1),Q.copy(P).scale(-1),o=Lg[t],A=Lg[e],f=Lg[n]}return s[0]=o.x,s[1]=o.y,s[2]=o.z,s[3]=0,s[4]=A.x,s[5]=A.y,s[6]=A.z,s[7]=0,s[8]=f.x,s[9]=f.y,s[10]=f.z,s[11]=0,s[12]=m.x,s[13]=m.y,s[14]=m.z,s[15]=1,s}const Ay=new le,jL=new le,YZ=new le,qc=new le,ZZ=new le,hy=new le;class Pi{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;$(this,"radii",void 0),$(this,"radiiSquared",void 0),$(this,"radiiToTheFourth",void 0),$(this,"oneOverRadii",void 0),$(this,"oneOverRadiiSquared",void 0),$(this,"minimumRadius",void 0),$(this,"maximumRadius",void 0),$(this,"centerToleranceSquared",ug.EPSILON1),$(this,"squaredXOverSquaredZ",void 0),Hc(t>=0),Hc(e>=0),Hc(n>=0),this.radii=new le(t,e,n),this.radiiSquared=new le(t*t,e*e,n*n),this.radiiToTheFourth=new le(t*t*t*t,e*e*e*e,n*n*n*n),this.oneOverRadii=new le(t===0?0:1/t,e===0?0:1/e,n===0?0:1/n),this.oneOverRadiiSquared=new le(t===0?0:1/(t*t),e===0?0:1/(e*e),n===0?0:1/(n*n)),this.minimumRadius=Math.min(t,e,n),this.maximumRadius=Math.max(t,e,n),this.radiiSquared.z!==0&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}equals(t){return this===t||!!(t&&this.radii.equals(t.radii))}toString(){return this.radii.toString()}cartographicToCartesian(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];const n=jL,i=YZ,[,,s]=t;this.geodeticSurfaceNormalCartographic(t,n),i.copy(this.radiiSquared).scale(n);const a=Math.sqrt(n.dot(i));return i.scale(1/a),n.scale(s),i.add(n),i.to(e)}cartesianToCartographic(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];hy.from(t);const n=this.scaleToGeodeticSurface(hy,qc);if(!n)return;const i=this.geodeticSurfaceNormal(n,jL),s=ZZ;s.copy(hy).subtract(n);const a=Math.atan2(i.y,i.x),o=Math.asin(i.z),A=Math.sign(Fb(s,hy))*r3(s);return VZ([a,o,A],e)}eastNorthUpToFixedFrame(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Bn;return VL(this,"east","north","up",t,e)}localFrameToFixedFrame(t,e,n,i){let s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:new Bn;return VL(this,t,e,n,i,s)}geocentricSurfaceNormal(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return Ay.from(t).normalize().to(e)}geodeticSurfaceNormalCartographic(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];const n=zZ(t),i=n[0],s=n[1],a=Math.cos(s);return Ay.set(a*Math.cos(i),a*Math.sin(i),Math.sin(s)).normalize(),Ay.to(e)}geodeticSurfaceNormal(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return Ay.from(t).scale(this.oneOverRadiiSquared).normalize().to(e)}scaleToGeodeticSurface(t,e){return KZ(t,this,e)}scaleToGeocentricSurface(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];qc.from(t);const n=qc.x,i=qc.y,s=qc.z,a=this.oneOverRadiiSquared,o=1/Math.sqrt(n*n*a.x+i*i*a.y+s*s*a.z);return qc.multiplyScalar(o).to(e)}transformPositionToScaledSpace(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return qc.from(t).scale(this.oneOverRadii).to(e)}transformPositionFromScaledSpace(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return qc.from(t).scale(this.radii).to(e)}getSurfaceNormalIntersectionWithZAxis(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[0,0,0];Hc(zc(this.radii.x,this.radii.y,ug.EPSILON15)),Hc(this.radii.z>0),qc.from(t);const i=qc.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(i)>=this.radii.z-e))return qc.set(0,0,i).to(n)}}$(Pi,"WGS84",new Pi(NZ,kZ,QZ));function qL(){let r;if(typeof window<"u"&&window.performance)r=window.performance.now();else if(typeof process<"u"&&process.hrtime){const t=process.hrtime();r=t[0]*1e3+t[1]/1e6}else r=Date.now();return r}class KL{constructor(t,e){this.name=void 0,this.type=void 0,this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=t,this.type=e,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(t){return this.sampleSize=t,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(t){return this._count+=t,this._samples++,this._checkSampling(),this}subtractCount(t){return this._count-=t,this._samples++,this._checkSampling(),this}addTime(t){return this._time+=t,this.lastTiming=t,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=qL(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(qL()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class ttt{constructor(t){this.id=void 0,this.stats={},this.id=t.id,this.stats={},this._initializeStats(t.stats),Object.seal(this)}get(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:t,type:e})}get size(){return Object.keys(this.stats).length}reset(){for(const t of Object.values(this.stats))t.reset();return this}forEach(t){for(const e of Object.values(this.stats))t(e)}getTable(){const t={};return this.forEach(e=>{t[e.name]={time:e.time||0,count:e.count||0,average:e.getAverageTime()||0,hz:e.getHz()||0}}),t}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(e=>this._getOrCreate(e))}_getOrCreate(t){const{name:e,type:n}=t;let i=this.stats[e];return i||(t instanceof KL?i=t:i=new KL(e,n),this.stats[e]=i),i}}class ett{constructor(t,e,n){$(this,"item",void 0),$(this,"previous",void 0),$(this,"next",void 0),this.item=t,this.previous=e,this.next=n}}class rtt{constructor(){$(this,"head",null),$(this,"tail",null),$(this,"_length",0)}get length(){return this._length}add(t){const e=new ett(t,this.tail,null);return this.tail?(this.tail.next=e,this.tail=e):(this.head=e,this.tail=e),++this._length,e}remove(t){t&&(t.previous&&t.next?(t.previous.next=t.next,t.next.previous=t.previous):t.previous?(t.previous.next=null,this.tail=t.previous):t.next?(t.next.previous=null,this.head=t.next):(this.head=null,this.tail=null),t.next=null,t.previous=null,--this._length)}splice(t,e){t!==e&&(this.remove(e),this._insert(t,e))}_insert(t,e){const n=t.next;t.next=e,this.tail===t?this.tail=e:n.previous=e,e.next=n,e.previous=t,++this._length}}class ntt{constructor(){$(this,"_list",void 0),$(this,"_sentinel",void 0),$(this,"_trimTiles",void 0),this._list=new rtt,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(t){const e=t._cacheNode;e&&this._list.splice(this._sentinel,e)}add(t,e,n){e._cacheNode||(e._cacheNode=this._list.add(e),n&&n(t,e))}unloadTile(t,e,n){const i=e._cacheNode;i&&(this._list.remove(i),e._cacheNode=null,n&&n(t,e))}unloadTiles(t,e){const n=this._trimTiles;this._trimTiles=!1;const i=this._list,s=t.maximumMemoryUsage*1024*1024,a=this._sentinel;let o=i.head;for(;o!==a&&(t.gpuMemoryUsageInBytes>s||n);){const A=o.item;o=o.next,this.unloadTile(t,A,e)}}trim(){this._trimTiles=!0}}function itt(r,t){li(r),li(t);const{rtcCenter:e,gltfUpAxis:n}=t,{computedTransform:i,boundingVolume:{center:s}}=r;let a=new Bn(i);switch(e&&a.translate(e),n){case"Z":break;case"Y":const _=new Bn().rotateX(Math.PI/2);a=a.multiplyRight(_);break;case"X":const x=new Bn().rotateY(-Math.PI/2);a=a.multiplyRight(x);break}t.isQuantized&&a.translate(t.quantizedVolumeOffset).scale(t.quantizedVolumeScale);const o=new le(s);t.cartesianModelMatrix=a,t.cartesianOrigin=o;const A=Pi.WGS84.cartesianToCartographic(o,new le),m=Pi.WGS84.eastNorthUpToFixedFrame(o).invert();t.cartographicModelMatrix=m.multiplyRight(a),t.cartographicOrigin=A,t.coordinateSystem||(t.modelMatrix=t.cartographicModelMatrix)}const $L=new le,Ww=new le,Xw=new sc([new jc,new jc,new jc,new jc,new jc,new jc]);function stt(r,t){const{cameraDirection:e,cameraUp:n,height:i}=r,{metersPerUnit:s}=r.distanceScales,a=dy(r,r.center),o=Pi.WGS84.eastNorthUpToFixedFrame(a),A=r.unprojectPosition(r.cameraPosition),f=Pi.WGS84.cartographicToCartesian(A,new le),m=new le(o.transformAsVector(new le(e).scale(s))).normalize(),_=new le(o.transformAsVector(new le(n).scale(s))).normalize();att(r);const x=r.constructor,{longitude:B,latitude:P,width:M,bearing:k,zoom:Q}=r,q=new x({longitude:B,latitude:P,height:i,width:M,bearing:k,zoom:Q,pitch:0});return{camera:{position:f,direction:m,up:_},viewport:r,topDownViewport:q,height:i,cullingVolume:Xw,frameNumber:t,sseDenominator:1.15}}function ott(r,t,e){if(e===0||r.length<=e)return[r,[]];const n=[],{longitude:i,latitude:s}=t.viewport;for(const[f,m]of r.entries()){const[_,x]=m.header.mbs,B=Math.abs(i-_),P=Math.abs(s-x),M=Math.sqrt(P*P+B*B);n.push([f,M])}const a=n.sort((f,m)=>f[1]-m[1]),o=[];for(let f=0;f<e;f++)o.push(r[a[f][0]]);const A=[];for(let f=e;f<a.length;f++)A.push(r[a[f][0]]);return[o,A]}function att(r){const t=r.getFrustumPlanes(),e=WL(t.near,r.cameraPosition),n=dy(r,e),i=dy(r,r.cameraPosition,Ww);let s=0;Xw.planes[s++].fromPointNormal(n,$L.copy(n).subtract(i));for(const a in t){if(a==="near")continue;const o=t[a],A=WL(o,e,Ww),f=dy(r,A,Ww);Xw.planes[s++].fromPointNormal(f,$L.copy(n).subtract(f))}}function WL(r,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new le;const n=r.normal.dot(t);return e.copy(r.normal).scale(r.distance-n).add(t),e}function dy(r,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new le;const n=r.unprojectPosition(t);return Pi.WGS84.cartographicToCartesian(n,e)}const ctt=6378137,ltt=6378137,Jw=6356752314245179e-9,XL=new le;function utt(r,t){if(r instanceof xg){const{halfAxes:e}=r,n=htt(e);return Math.log2(Jw/(n+t[2]))}else if(r instanceof wg){const{radius:e}=r;return Math.log2(Jw/(e+t[2]))}else if(r.width&&r.height){const{width:e,height:n}=r,i=Math.log2(ctt/e),s=Math.log2(ltt/n);return(i+s)/2}return 1}function JL(r,t,e){const n=Pi.WGS84.cartographicToCartesian([r.xmax,r.ymax,r.zmax],new le),i=Math.sqrt(Math.pow(n[0]-e[0],2)+Math.pow(n[1]-e[1],2)+Math.pow(n[2]-e[2],2));return Math.log2(Jw/(i+t[2]))}function Att(r,t,e){const[n,i,s,a]=r;return JL({xmin:n,xmax:s,ymin:i,ymax:a,zmin:0,zmax:0},t,e)}function htt(r){r.getColumn(0,XL);const t=r.getColumn(1),e=r.getColumn(2);return XL.add(t).add(e).len()}const Na={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5},Du={ADD:1,REPLACE:2},_f={EMPTY:"empty",SCENEGRAPH:"scenegraph",POINTCLOUD:"pointcloud",MESH:"mesh"},ac={I3S:"I3S",TILES3D:"TILES3D"},fy={GEOMETRIC_ERROR:"geometricError",MAX_SCREEN_THRESHOLD:"maxScreenThreshold"},dtt={NOT_COMPUTED:-1,USE_OPTIMIZATION:1,SKIP_OPTIMIZATION:0};function YL(r){return r!=null}const Ao=new le,py=new le,ftt=new le,ptt=new le;function Yw(r,t,e){if(li(r,"3D Tile: boundingVolume must be defined"),r.box)return mtt(r.box,t,e);if(r.region){const[n,i,s,a,o,A]=r.region,f=Pi.WGS84.cartographicToCartesian([Mu(n),Mu(a),o],ftt),m=Pi.WGS84.cartographicToCartesian([Mu(s),Mu(i),A],ptt),_=new le().addVectors(f,m).multiplyScalar(.5),x=new le().subVectors(f,m).len()/2;return ZL([_[0],_[1],_[2],x],new Bn)}if(r.sphere)return ZL(r.sphere,t,e);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function gtt(r,t){if(r.box)return ytt(t);if(r.region){const[e,n,i,s,a,o]=r.region;return[[Mu(e),Mu(n),a],[Mu(i),Mu(s),o]]}if(r.sphere)return _tt(t);throw new Error("Unkown boundingVolume type")}function mtt(r,t,e){const n=new le(r[0],r[1],r[2]);t.transform(n,n);let i=[];if(r.length===10){const f=r.slice(3,6),m=new lg;m.fromArray(r,6);const _=new le([1,0,0]),x=new le([0,1,0]),B=new le([0,0,1]);_.transformByQuaternion(m),_.scale(f[0]),x.transformByQuaternion(m),x.scale(f[1]),B.transformByQuaternion(m),B.scale(f[2]),i=[..._.toArray(),...x.toArray(),...B.toArray()]}else i=[...r.slice(3,6),...r.slice(6,9),...r.slice(9,12)];const s=t.transformAsVector(i.slice(0,3)),a=t.transformAsVector(i.slice(3,6)),o=t.transformAsVector(i.slice(6,9)),A=new zi([s[0],s[1],s[2],a[0],a[1],a[2],o[0],o[1],o[2]]);return YL(e)?(e.center=n,e.halfAxes=A,e):new xg(n,A)}function ZL(r,t,e){const n=new le(r[0],r[1],r[2]);t.transform(n,n);const i=t.getScale(py),s=Math.max(Math.max(i[0],i[1]),i[2]),a=r[3]*s;return YL(e)?(e.center=n,e.radius=a,e):new wg(n,a)}function ytt(r){const t=tF(),{halfAxes:e}=r,n=new le(e.getColumn(0)),i=new le(e.getColumn(1)),s=new le(e.getColumn(2));for(let a=0;a<2;a++){for(let o=0;o<2;o++){for(let A=0;A<2;A++)Ao.copy(r.center),Ao.add(n),Ao.add(i),Ao.add(s),eF(t,Ao),s.negate();i.negate()}n.negate()}return t}function _tt(r){const t=tF(),{center:e,radius:n}=r,i=Pi.WGS84.scaleToGeodeticSurface(e,Ao);let s;i?s=Pi.WGS84.geodeticSurfaceNormal(i):s=new le(0,0,1);let a=new le(s[2],-s[1],0);a.len()>0?a.normalize():a=new le(0,1,0);const o=a.clone().cross(s);for(const A of[a,o,s]){py.copy(A).scale(n);for(let f=0;f<2;f++)Ao.copy(e),Ao.add(py),eF(t,Ao),py.negate()}return t}function tF(){return[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]]}function eF(r,t){Pi.WGS84.cartesianToCartographic(t,Ao),r[0][0]=Math.min(r[0][0],Ao[0]),r[0][1]=Math.min(r[0][1],Ao[1]),r[0][2]=Math.min(r[0][2],Ao[2]),r[1][0]=Math.max(r[1][0],Ao[0]),r[1][1]=Math.max(r[1][1],Ao[1]),r[1][2]=Math.max(r[1][2],Ao[2])}new le,new le,new Bn,new le,new le,new le;function vtt(r,t){const e=r*t;return 1-Math.exp(-(e*e))}function btt(r,t){if(r.dynamicScreenSpaceError&&r.dynamicScreenSpaceErrorComputedDensity){const e=r.dynamicScreenSpaceErrorComputedDensity,n=r.dynamicScreenSpaceErrorFactor;return vtt(t,e)*n}return 0}function wtt(r,t,e){const n=r.tileset,i=r.parent&&r.parent.lodMetricValue||r.lodMetricValue,s=e?i:r.lodMetricValue;if(s===0)return 0;const a=Math.max(r._distanceToCamera,1e-7),{height:o,sseDenominator:A}=t,{viewDistanceScale:f}=n.options;let m=s*o*(f||1)/(a*A);return m-=btt(n,a),m}const Zw=new le,rF=new le,QA=new le,nF=new le,xtt=new le,t2=new Bn,iF=new Bn;function Btt(r,t){if(r.lodMetricValue===0||isNaN(r.lodMetricValue))return"DIG";const e=2*sF(r,t);return e<2?"OUT":!r.header.children||e<=r.lodMetricValue?"DRAW":r.header.children?"DIG":"OUT"}function sF(r,t){const{topDownViewport:e}=t,n=r.header.mbs[1],i=r.header.mbs[0],s=r.header.mbs[2],a=r.header.mbs[3],o=[...r.boundingVolume.center],A=e.unprojectPosition(e.cameraPosition);Pi.WGS84.cartographicToCartesian(A,Zw),rF.copy(Zw).subtract(o).normalize(),Pi.WGS84.eastNorthUpToFixedFrame(o,t2),iF.copy(t2).invert(),QA.copy(Zw).transform(iF);const f=Math.sqrt(QA[0]*QA[0]+QA[1]*QA[1]),m=f*f/QA[2];nF.copy([QA[0],QA[1],m]);const x=nF.transform(t2).subtract(o).normalize(),P=rF.cross(x).normalize().scale(a).add(o),M=Pi.WGS84.cartesianToCartographic(P),k=e.project([i,n,s]),Q=e.project(M);return xtt.copy(k).subtract(Q).magnitude()}function Ctt(r){return{assetGltfUpAxis:r.asset&&r.asset.gltfUpAxis||"Y"}}class oF{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;$(this,"_map",new Map),$(this,"_array",void 0),$(this,"_length",void 0),this._array=new Array(t),this._length=t}get length(){return this._length}set length(t){this._length=t,t>this._array.length&&(this._array.length=t)}get values(){return this._array}get(t){return li(t<this._array.length),this._array[t]}set(t,e){li(t>=0),t>=this.length&&(this.length=t+1),this._map.has(this._array[t])&&this._map.delete(this._array[t]),this._array[t]=e,this._map.set(e,t)}delete(t){const e=this._map.get(t);e>=0&&(this._array.splice(e,1),this._map.delete(t),this.length--)}peek(){return this._array[this._length-1]}push(t){if(!this._map.has(t)){const e=this.length++;this._array[e]=t,this._map.set(t,e)}}pop(){const t=this._array[--this.length];return this._map.delete(t),t}reserve(t){li(t>=0),t>this._array.length&&(this._array.length=t)}resize(t){li(t>=0),this.length=t}trim(t){t==null&&(t=this.length),this._array.length=t}reset(){this._array=[],this._map=new Map,this._length=0}find(t){return this._map.has(t)}}const Ett={loadSiblings:!1,skipLevelOfDetail:!1,maximumScreenSpaceError:2,updateTransforms:!0,onTraversalEnd:()=>{},viewportTraversersMap:{},basePath:""};class gy{traversalFinished(t){return!0}constructor(t){$(this,"options",void 0),$(this,"root",null),$(this,"selectedTiles",{}),$(this,"requestedTiles",{}),$(this,"emptyTiles",{}),$(this,"lastUpdate",new Date().getTime()),$(this,"updateDebounceTime",1e3),$(this,"_traversalStack",new oF),$(this,"_emptyTraversalStack",new oF),$(this,"_frameNumber",null),this.options={...Ett,...t}}traverse(t,e,n){this.root=t,this.options={...this.options,...n},this.reset(),this.updateTile(t,e),this._frameNumber=e.frameNumber,this.executeTraversal(t,e)}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}executeTraversal(t,e){const n=this._traversalStack;for(t._selectionDepth=1,n.push(t);n.length>0;){const s=n.pop();let a=!1;this.canTraverse(s,e)&&(this.updateChildTiles(s,e),a=this.updateAndPushChildren(s,e,n,s.hasRenderContent?s._selectionDepth+1:s._selectionDepth));const o=s.parent,A=!!(!o||o._shouldRefine),f=!a;s.hasRenderContent?s.refine===Du.ADD?(this.loadTile(s,e),this.selectTile(s,e)):s.refine===Du.REPLACE&&(this.loadTile(s,e),f&&this.selectTile(s,e)):(this.emptyTiles[s.id]=s,this.loadTile(s,e),f&&this.selectTile(s,e)),this.touchTile(s,e),s._shouldRefine=a&&A}const i=new Date().getTime();(this.traversalFinished(e)||i-this.lastUpdate>this.updateDebounceTime)&&(this.lastUpdate=i,this.options.onTraversalEnd(e))}updateChildTiles(t,e){const n=t.children;for(const i of n)this.updateTile(i,e)}updateAndPushChildren(t,e,n,i){const{loadSiblings:s,skipLevelOfDetail:a}=this.options,o=t.children;o.sort(this.compareDistanceToCamera.bind(this));const A=t.refine===Du.REPLACE&&t.hasRenderContent&&!a;let f=!1,m=!0;for(const _ of o)if(_._selectionDepth=i,_.isVisibleAndInRequestVolume?(n.find(_)&&n.delete(_),n.push(_),f=!0):(A||s)&&(this.loadTile(_,e),this.touchTile(_,e)),A){let x;if(_._inRequestVolume?_.hasRenderContent?x=_.contentAvailable:x=this.executeEmptyTraversal(_,e):x=!1,m=m&&x,!m)return!1}return f||(m=!1),m}updateTile(t,e){this.updateTileVisibility(t,e)}selectTile(t,e){this.shouldSelectTile(t)&&(t._selectedFrame=e.frameNumber,this.selectedTiles[t.id]=t)}loadTile(t,e){this.shouldLoadTile(t)&&(t._requestedFrame=e.frameNumber,t._priority=t._getPriority(),this.requestedTiles[t.id]=t)}touchTile(t,e){t.tileset._cache.touch(t),t._touchedFrame=e.frameNumber}canTraverse(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;return t.hasChildren?t.hasTilesetContent?!t.contentExpired:!i&&!t.isVisibleAndInRequestVolume?!1:this.shouldRefine(t,e,n):!1}shouldLoadTile(t){return t.hasUnloadedContent||t.contentExpired}shouldSelectTile(t){return t.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=t._screenSpaceError;return n&&(i=t.getScreenSpaceError(e,!0)),i>this.options.maximumScreenSpaceError}updateTileVisibility(t,e){const n=[];if(this.options.viewportTraversersMap)for(const i in this.options.viewportTraversersMap)this.options.viewportTraversersMap[i]===e.viewport.id&&n.push(i);else n.push(e.viewport.id);t.updateVisibility(e,n)}compareDistanceToCamera(t,e){return t._distanceToCamera-e._distanceToCamera}anyChildrenVisible(t,e){let n=!1;for(const i of t.children)i.updateVisibility(e),n=n||i.isVisibleAndInRequestVolume;return n}executeEmptyTraversal(t,e){let n=!0;const i=this._emptyTraversalStack;for(i.push(t);i.length>0&&n;){const s=i.pop();if(this.updateTile(s,e),s.isVisibleAndInRequestVolume||this.loadTile(s,e),this.touchTile(s,e),!s.hasRenderContent&&this.canTraverse(s,e,!1,!0)){const o=s.children;for(const A of o)i.find(A)&&i.delete(A),i.push(A)}else!s.contentAvailable&&!s.hasEmptyContent&&(n=!1)}return n}}const aF=new le;function Stt(r){return r!=null}class e2{constructor(t,e,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"";$(this,"tileset",void 0),$(this,"header",void 0),$(this,"id",void 0),$(this,"url",void 0),$(this,"parent",void 0),$(this,"refine",void 0),$(this,"type",void 0),$(this,"contentUrl",void 0),$(this,"lodMetricType","geometricError"),$(this,"lodMetricValue",0),$(this,"boundingVolume",null),$(this,"content",null),$(this,"contentState",Na.UNLOADED),$(this,"gpuMemoryUsageInBytes",0),$(this,"children",[]),$(this,"depth",0),$(this,"viewportIds",[]),$(this,"transform",new Bn),$(this,"extensions",null),$(this,"implicitTiling",null),$(this,"userData",{}),$(this,"computedTransform",void 0),$(this,"hasEmptyContent",!1),$(this,"hasTilesetContent",!1),$(this,"traverser",new gy({})),$(this,"_cacheNode",null),$(this,"_frameNumber",null),$(this,"_expireDate",null),$(this,"_expiredContent",null),$(this,"_boundingBox",void 0),$(this,"_distanceToCamera",0),$(this,"_screenSpaceError",0),$(this,"_visibilityPlaneMask",void 0),$(this,"_visible",void 0),$(this,"_contentBoundingVolume",void 0),$(this,"_viewerRequestVolume",void 0),$(this,"_initialTransform",new Bn),$(this,"_priority",0),$(this,"_selectedFrame",0),$(this,"_requestedFrame",0),$(this,"_selectionDepth",0),$(this,"_touchedFrame",0),$(this,"_centerZDepth",0),$(this,"_shouldRefine",!1),$(this,"_stackLength",0),$(this,"_visitedFrame",0),$(this,"_inRequestVolume",!1),$(this,"_lodJudge",null),this.header=e,this.tileset=t,this.id=i||e.id,this.url=e.url,this.parent=n,this.refine=this._getRefine(e.refine),this.type=e.type,this.contentUrl=e.contentUrl,this._initializeLodMetric(e),this._initializeTransforms(e),this._initializeBoundingVolumes(e),this._initializeContent(e),this._initializeRenderingState(e),Object.seal(this)}destroy(){this.header=null}isDestroyed(){return this.header===null}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return this.contentState===Na.READY||this.hasEmptyContent}get contentAvailable(){return!!(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return this.contentState===Na.UNLOADED}get contentExpired(){return this.contentState===Na.EXPIRED}get contentFailed(){return this.contentState===Na.FAILED}get distanceToCamera(){return this._distanceToCamera}get screenSpaceError(){return this._screenSpaceError}get boundingBox(){return this._boundingBox||(this._boundingBox=gtt(this.header.boundingVolume,this.boundingVolume)),this._boundingBox}getScreenSpaceError(t,e){switch(this.tileset.type){case ac.I3S:return sF(this,t);case ac.TILES3D:return wtt(this,t,e);default:throw new Error("Unsupported tileset type")}}unselect(){this._selectedFrame=0}_getGpuMemoryUsageInBytes(){return this.content.gpuMemoryUsageInBytes||this.content.byteLength||0}_getPriority(){const t=this.tileset._traverser,{skipLevelOfDetail:e}=t.options,n=this.refine===Du.ADD||e;if(n&&!this.isVisible&&this._visible!==void 0||this.tileset._frameNumber-this._touchedFrame>=1||this.contentState===Na.UNLOADED)return-1;const i=this.parent,a=i&&(!n||this._screenSpaceError===0||i.hasTilesetContent)?i._screenSpaceError:this._screenSpaceError,o=t.root?t.root._screenSpaceError:0;return Math.max(o-a,0)}async loadContent(){if(this.hasEmptyContent)return!1;if(this.content)return!0;this.contentExpired&&(this._expireDate=null),this.contentState=Na.LOADING;const e=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));if(!e)return this.contentState=Na.UNLOADED,!1;try{const n=this.tileset.getTileUrl(this.contentUrl),i=this.tileset.loader,s={...this.tileset.loadOptions,[i.id]:{...this.tileset.loadOptions[i.id],isTileset:this.type==="json",...this._getLoaderSpecificOptions(i.id)}};return this.content=await TA(n,i,s),this.tileset.options.contentLoader&&await this.tileset.options.contentLoader(this),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=Na.READY,this._onContentLoaded(),!0}catch(n){throw this.contentState=Na.FAILED,n}finally{e.done()}}unloadContent(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=Na.UNLOADED,!0}updateVisibility(t,e){if(this._frameNumber===t.frameNumber)return;const n=this.parent,i=n?n._visibilityPlaneMask:sc.MASK_INDETERMINATE;if(this.tileset._traverser.options.updateTransforms){const s=n?n.computedTransform:this.tileset.modelMatrix;this._updateTransform(s)}this._distanceToCamera=this.distanceToTile(t),this._screenSpaceError=this.getScreenSpaceError(t,!1),this._visibilityPlaneMask=this.visibility(t,i),this._visible=this._visibilityPlaneMask!==sc.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(t),this._frameNumber=t.frameNumber,this.viewportIds=e}visibility(t,e){const{cullingVolume:n}=t,{boundingVolume:i}=this;return n.computeVisibilityWithPlaneMask(i,e)}contentVisibility(){return!0}distanceToTile(t){const e=this.boundingVolume;return Math.sqrt(Math.max(e.distanceSquaredTo(t.camera.position),0))}cameraSpaceZDepth(t){let{camera:e}=t;const n=this.boundingVolume;return aF.subVectors(n.center,e.position),e.direction.dot(aF)}insideViewerRequestVolume(t){const e=this._viewerRequestVolume;return!e||e.distanceSquaredTo(t.camera.position)<=0}updateExpiration(){if(Stt(this._expireDate)&&this.contentReady&&!this.hasEmptyContent){const t=Date.now();Date.lessThan(this._expireDate,t)&&(this.contentState=Na.EXPIRED,this._expiredContent=this.content)}}get extras(){return this.header.extras}_initializeLodMetric(t){"lodMetricType"in t?this.lodMetricType=t.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in t?this.lodMetricValue=t.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}_initializeTransforms(t){this.transform=t.transform?new Bn(t.transform):new Bn;const e=this.parent,n=this.tileset,i=e&&e.computedTransform?e.computedTransform.clone():n.modelMatrix.clone();this.computedTransform=new Bn(i).multiplyRight(this.transform);const s=e&&e._initialTransform?e._initialTransform.clone():new Bn;this._initialTransform=new Bn(s).multiplyRight(this.transform)}_initializeBoundingVolumes(t){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(t)}_initializeContent(t){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=Na.UNLOADED,this.hasTilesetContent=!1,t.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}_initializeRenderingState(t){this.depth=t.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=sc.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}_getRefine(t){return t||this.parent&&this.parent.refine||Du.REPLACE}_isTileset(){return this.contentUrl.indexOf(".json")!==-1}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0;break}this._isTileset()?this.hasTilesetContent=!0:this.gpuMemoryUsageInBytes=this._getGpuMemoryUsageInBytes()}_updateBoundingVolume(t){this.boundingVolume=Yw(t.boundingVolume,this.computedTransform,this.boundingVolume);const e=t.content;e&&(e.boundingVolume&&(this._contentBoundingVolume=Yw(e.boundingVolume,this.computedTransform,this._contentBoundingVolume)),t.viewerRequestVolume&&(this._viewerRequestVolume=Yw(t.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}_updateTransform(){const e=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:new Bn).clone().multiplyRight(this.transform);e.equals(this.computedTransform)||(this.computedTransform=e,this._updateBoundingVolume(this.header))}_getLoaderSpecificOptions(t){switch(t){case"i3s":return{...this.tileset.options.i3s,_tileOptions:{attributeUrls:this.header.attributeUrls,textureUrl:this.header.textureUrl,textureFormat:this.header.textureFormat,textureLoaderOptions:this.header.textureLoaderOptions,materialDefinition:this.header.materialDefinition,isDracoGeometry:this.header.isDracoGeometry,mbs:this.header.mbs},_tilesetOptions:{store:this.tileset.tileset.store,attributeStorageInfo:this.tileset.tileset.attributeStorageInfo,fields:this.tileset.tileset.fields},isTileHeader:!1};case"3d-tiles":case"cesium-ion":default:return Ctt(this.tileset.tileset)}}}class Ttt extends gy{compareDistanceToCamera(t,e){return e._distanceToCamera===0&&t._distanceToCamera===0?e._centerZDepth-t._centerZDepth:e._distanceToCamera-t._distanceToCamera}updateTileVisibility(t,e){if(super.updateTileVisibility(t,e),!t.isVisibleAndInRequestVolume)return;const n=t.children.length>0;if(t.hasTilesetContent&&n){const a=t.children[0];this.updateTileVisibility(a,e),t._visible=a._visible;return}if(this.meetsScreenSpaceErrorEarly(t,e)){t._visible=!1;return}const i=t.refine===Du.REPLACE,s=t._optimChildrenWithinParent===dtt.USE_OPTIMIZATION;if(i&&s&&n&&!this.anyChildrenVisible(t,e)){t._visible=!1;return}}meetsScreenSpaceErrorEarly(t,e){const{parent:n}=t;return!n||n.hasTilesetContent||n.refine!==Du.ADD?!1:!this.shouldRefine(t,e,!0)}}class Itt{constructor(){$(this,"frameNumberMap",new Map)}register(t,e){const n=this.frameNumberMap.get(t)||new Map,i=n.get(e)||0;n.set(e,i+1),this.frameNumberMap.set(t,n)}deregister(t,e){const n=this.frameNumberMap.get(t);if(!n)return;const i=n.get(e)||1;n.set(e,i-1)}isZero(t,e){var n;return(((n=this.frameNumberMap.get(t))===null||n===void 0?void 0:n.get(e))||0)===0}}const r2={REQUESTED:"REQUESTED",COMPLETED:"COMPLETED",ERROR:"ERROR"};class Ltt{constructor(){$(this,"_statusMap",void 0),$(this,"pendingTilesRegister",new Itt),this._statusMap={}}add(t,e,n,i){if(!this._statusMap[e]){const{frameNumber:s,viewport:{id:a}}=i;this._statusMap[e]={request:t,callback:n,key:e,frameState:i,status:r2.REQUESTED},this.pendingTilesRegister.register(a,s),t().then(o=>{this._statusMap[e].status=r2.COMPLETED;const{frameNumber:A,viewport:{id:f}}=this._statusMap[e].frameState;this.pendingTilesRegister.deregister(f,A),this._statusMap[e].callback(o,i)}).catch(o=>{this._statusMap[e].status=r2.ERROR;const{frameNumber:A,viewport:{id:f}}=this._statusMap[e].frameState;this.pendingTilesRegister.deregister(f,A),n(o)})}}update(t,e){if(this._statusMap[t]){const{frameNumber:n,viewport:{id:i}}=this._statusMap[t].frameState;this.pendingTilesRegister.deregister(i,n);const{frameNumber:s,viewport:{id:a}}=e;this.pendingTilesRegister.register(a,s),this._statusMap[t].frameState=e}}find(t){return this._statusMap[t]}hasPendingTiles(t,e){return!this.pendingTilesRegister.isZero(t,e)}}class Ftt extends gy{constructor(t){super(t),$(this,"_tileManager",void 0),this._tileManager=new Ltt}traversalFinished(t){return!this._tileManager.hasPendingTiles(t.viewport.id,this._frameNumber||0)}shouldRefine(t,e){return t._lodJudge=Btt(t,e),t._lodJudge==="DIG"}updateChildTiles(t,e){const n=t.header.children||[],i=t.children,s=t.tileset;for(const a of n){const o="".concat(a.id,"-").concat(e.viewport.id),A=i&&i.find(f=>f.id===o);if(A)A&&this.updateTile(A,e);else{let f=()=>this._loadTile(a.id,s);this._tileManager.find(o)?this._tileManager.update(o,e):(s.tileset.nodePages&&(f=()=>s.tileset.nodePagesTile.formTileFromNodePages(a.id)),this._tileManager.add(f,o,_=>this._onTileLoad(_,t,o),e))}}return!1}async _loadTile(t,e){const{loader:n}=e,i=e.getTileUrl("".concat(e.url,"/nodes/").concat(t)),s={...e.loadOptions,i3s:{...e.loadOptions.i3s,isTileHeader:!0}};return await TA(i,n,s)}_onTileLoad(t,e,n){const i=new e2(e.tileset,t,e,n);e.children.push(i);const s=this._tileManager.find(i.id).frameState;this.updateTile(i,s),this._frameNumber===s.frameNumber&&(this.traversalFinished(s)||new Date().getTime()-this.lastUpdate>this.updateDebounceTime)&&this.executeTraversal(i,s)}}const Ptt={description:"",ellipsoid:Pi.WGS84,modelMatrix:new Bn,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,maximumTilesSelected:0,debounceTime:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{},onTraversalComplete:r=>r,contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},my="Tiles In Tileset(s)",n2="Tiles In Memory",cF="Tiles In View",lF="Tiles To Render",uF="Tiles Loaded",i2="Tiles Loading",AF="Tiles Unloaded",hF="Failed Tile Loads",dF="Points/Vertices",s2="Tile Memory Use";class Mtt{constructor(t,e){$(this,"options",void 0),$(this,"loadOptions",void 0),$(this,"type",void 0),$(this,"tileset",void 0),$(this,"loader",void 0),$(this,"url",void 0),$(this,"basePath",void 0),$(this,"modelMatrix",void 0),$(this,"ellipsoid",void 0),$(this,"lodMetricType",void 0),$(this,"lodMetricValue",void 0),$(this,"refine",void 0),$(this,"root",null),$(this,"roots",{}),$(this,"asset",{}),$(this,"description",""),$(this,"properties",void 0),$(this,"extras",null),$(this,"attributions",{}),$(this,"credits",{}),$(this,"stats",void 0),$(this,"contentFormats",{draco:!1,meshopt:!1,dds:!1,ktx2:!1}),$(this,"cartographicCenter",null),$(this,"cartesianCenter",null),$(this,"zoom",1),$(this,"boundingVolume",null),$(this,"dynamicScreenSpaceErrorComputedDensity",0),$(this,"maximumMemoryUsage",32),$(this,"gpuMemoryUsageInBytes",0),$(this,"_frameNumber",0),$(this,"_queryParams",{}),$(this,"_extensionsUsed",[]),$(this,"_tiles",{}),$(this,"_pendingCount",0),$(this,"selectedTiles",[]),$(this,"traverseCounter",0),$(this,"geometricError",0),$(this,"lastUpdatedVieports",null),$(this,"_requestedTiles",[]),$(this,"_emptyTiles",[]),$(this,"frameStateData",{}),$(this,"_traverser",void 0),$(this,"_cache",new ntt),$(this,"_requestScheduler",void 0),$(this,"updatePromise",null),$(this,"tilesetInitializationPromise",void 0),this.options={...Ptt,...e},this.tileset=t,this.loader=t.loader,this.type=t.type,this.url=t.url,this.basePath=t.basePath||Fv(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=t.lodMetricType,this.lodMetricValue=t.lodMetricValue,this.refine=t.root.refine,this.loadOptions=this.options.loadOptions||{},this._traverser=this._initializeTraverser(),this._requestScheduler=new rQ({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this.stats=new ttt({id:this.url}),this._initializeStats(),this.tilesetInitializationPromise=this._initializeTileSet(t)}destroy(){this._destroy()}isLoaded(){return this._pendingCount===0&&this._frameNumber!==0&&this._requestedTiles.length===0}get tiles(){return Object.values(this._tiles)}get frameNumber(){return this._frameNumber}get queryParams(){return new URLSearchParams(this._queryParams).toString()}setProps(t){this.options={...this.options,...t}}setOptions(t){this.options={...this.options,...t}}getTileUrl(t){return t.startsWith("data:")?t:"".concat(t).concat(t.includes("?")?"&":"?").concat(this.queryParams)}hasExtension(t){return this._extensionsUsed.indexOf(t)>-1}update(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;this.tilesetInitializationPromise.then(()=>{!t&&this.lastUpdatedVieports?t=this.lastUpdatedVieports:this.lastUpdatedVieports=t,t&&this.doUpdate(t)})}async selectTiles(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return await this.tilesetInitializationPromise,t&&(this.lastUpdatedVieports=t),this.updatePromise||(this.updatePromise=new Promise(e=>{setTimeout(()=>{this.lastUpdatedVieports&&this.doUpdate(this.lastUpdatedVieports),e(this._frameNumber),this.updatePromise=null},this.options.debounceTime)})),this.updatePromise}doUpdate(t){if("loadTiles"in this.options&&!this.options.loadTiles||this.traverseCounter>0)return;const e=t instanceof Array?t:[t];this._cache.reset(),this._frameNumber++,this.traverseCounter=e.length;const n=[];for(const i of e){const s=i.id;this._needTraverse(s)?n.push(s):this.traverseCounter--}for(const i of e){const s=i.id;if(this.roots[s]||(this.roots[s]=this._initializeTileHeaders(this.tileset,null)),!n.includes(s))continue;const a=stt(i,this._frameNumber);this._traverser.traverse(this.roots[s],a,this.options)}}_needTraverse(t){let e=t;return this.options.viewportTraversersMap&&(e=this.options.viewportTraversersMap[t]),e===t}_onTraversalEnd(t){const e=t.viewport.id;this.frameStateData[e]||(this.frameStateData[e]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});const n=this.frameStateData[e],i=Object.values(this._traverser.selectedTiles),[s,a]=ott(i,t,this.options.maximumTilesSelected);n.selectedTiles=s;for(const o of a)o.unselect();n._requestedTiles=Object.values(this._traverser.requestedTiles),n._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,!(this.traverseCounter>0)&&this._updateTiles()}_updateTiles(){this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[];for(const t in this.frameStateData){const e=this.frameStateData[t];this.selectedTiles=this.selectedTiles.concat(e.selectedTiles),this._requestedTiles=this._requestedTiles.concat(e._requestedTiles),this._emptyTiles=this._emptyTiles.concat(e._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);for(const t of this.selectedTiles)this._tiles[t.id]=t;this._loadTiles(),this._unloadTiles(),this._updateStats()}_tilesChanged(t,e){if(t.length!==e.length)return!0;const n=new Set(t.map(a=>a.id)),i=new Set(e.map(a=>a.id));let s=t.filter(a=>!i.has(a.id)).length>0;return s=s||e.filter(a=>!n.has(a.id)).length>0,s}_loadTiles(){for(const t of this._requestedTiles)t.contentUnloaded&&this._loadTile(t)}_unloadTiles(){this._cache.unloadTiles(this,(t,e)=>t._unloadTile(e))}_updateStats(){let t=0,e=0;for(const n of this.selectedTiles)n.contentAvailable&&n.content&&(t++,n.content.pointCount?e+=n.content.pointCount:e+=n.content.vertexCount);this.stats.get(cF).count=this.selectedTiles.length,this.stats.get(lF).count=t,this.stats.get(dF).count=e}async _initializeTileSet(t){this.type===ac.I3S&&(this.calculateViewPropsI3S(),t.root=await t.root),this.root=this._initializeTileHeaders(t,null),this.type===ac.TILES3D&&(this._initializeTiles3DTileset(t),this.calculateViewPropsTiles3D()),this.type===ac.I3S&&this._initializeI3STileset()}calculateViewPropsI3S(){var t;const e=this.tileset.fullExtent;if(e){const{xmin:i,xmax:s,ymin:a,ymax:o,zmin:A,zmax:f}=e;this.cartographicCenter=new le(i+(s-i)/2,a+(o-a)/2,A+(f-A)/2),this.cartesianCenter=Pi.WGS84.cartographicToCartesian(this.cartographicCenter,new le),this.zoom=JL(e,this.cartographicCenter,this.cartesianCenter);return}const n=(t=this.tileset.store)===null||t===void 0?void 0:t.extent;if(n){const[i,s,a,o]=n;this.cartographicCenter=new le(i+(a-i)/2,s+(o-s)/2,0),this.cartesianCenter=Pi.WGS84.cartographicToCartesian(this.cartographicCenter,new le),this.zoom=Att(n,this.cartographicCenter,this.cartesianCenter);return}console.warn("Extent is not defined in the tileset header"),this.cartographicCenter=new le,this.zoom=1}calculateViewPropsTiles3D(){const t=this.root,{center:e}=t.boundingVolume;if(!e){console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new le,this.zoom=1;return}e[0]!==0||e[1]!==0||e[2]!==0?this.cartographicCenter=Pi.WGS84.cartesianToCartographic(e,new le):this.cartographicCenter=new le(0,0,-Pi.WGS84.radii[0]),this.cartesianCenter=e,this.zoom=utt(t.boundingVolume,this.cartographicCenter)}_initializeStats(){this.stats.get(my),this.stats.get(i2),this.stats.get(n2),this.stats.get(cF),this.stats.get(lF),this.stats.get(uF),this.stats.get(AF),this.stats.get(hF),this.stats.get(dF),this.stats.get(s2,"memory")}_initializeTileHeaders(t,e){const n=new e2(this,t.root,e);if(e&&(e.children.push(n),n.depth=e.depth+1),this.type===ac.TILES3D){const s=[];for(s.push(n);s.length>0;){const a=s.pop();this.stats.get(my).incrementCount();const o=a.header.children||[];for(const A of o){var i;const f=new e2(this,A,a);if((i=f.contentUrl)!==null&&i!==void 0&&i.includes("?session=")){const _=new URL(f.contentUrl).searchParams.get("session");_&&(this._queryParams.session=_)}a.children.push(f),f.depth=a.depth+1,s.push(f)}}}return n}_initializeTraverser(){let t;switch(this.type){case ac.TILES3D:t=Ttt;break;case ac.I3S:t=Ftt;break;default:t=gy}return new t({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(t){this._destroySubtree(t)}async _loadTile(t){let e;try{this._onStartTileLoading(),e=await t.loadContent()}catch(n){this._onTileLoadError(t,n instanceof Error?n:new Error("load failed"))}finally{this._onEndTileLoading(),this._onTileLoad(t,e)}}_onTileLoadError(t,e){this.stats.get(hF).incrementCount();const n=e.message||e.toString(),i=t.url;console.error("A 3D tile failed to load: ".concat(t.url," ").concat(n)),this.options.onTileError(t,n,i)}_onTileLoad(t,e){if(e){if(this.type===ac.I3S){var n,i;const s=((n=this.tileset)===null||n===void 0||(i=n.nodePagesTile)===null||i===void 0?void 0:i.nodesInNodePages)||0;this.stats.get(my).reset(),this.stats.get(my).addCount(s)}t&&t.content&&itt(t,t.content),this.updateContentTypes(t),this._addTileToCache(t),this.options.onTileLoad(t)}}updateContentTypes(t){if(this.type===ac.I3S)switch(t.header.isDracoGeometry&&(this.contentFormats.draco=!0),t.header.textureFormat){case"dds":this.contentFormats.dds=!0;break;case"ktx2":this.contentFormats.ktx2=!0;break}else if(this.type===ac.TILES3D){var e;const{extensionsRemoved:n=[]}=((e=t.content)===null||e===void 0?void 0:e.gltf)||{};n.includes("KHR_draco_mesh_compression")&&(this.contentFormats.draco=!0),n.includes("EXT_meshopt_compression")&&(this.contentFormats.meshopt=!0),n.includes("KHR_texture_basisu")&&(this.contentFormats.ktx2=!0)}}_onStartTileLoading(){this._pendingCount++,this.stats.get(i2).incrementCount()}_onEndTileLoading(){this._pendingCount--,this.stats.get(i2).decrementCount()}_addTileToCache(t){this._cache.add(this,t,e=>e._updateCacheStats(t))}_updateCacheStats(t){this.stats.get(uF).incrementCount(),this.stats.get(n2).incrementCount(),this.gpuMemoryUsageInBytes+=t.gpuMemoryUsageInBytes||0,this.stats.get(s2).count=this.gpuMemoryUsageInBytes}_unloadTile(t){this.gpuMemoryUsageInBytes-=t.gpuMemoryUsageInBytes||0,this.stats.get(n2).decrementCount(),this.stats.get(AF).incrementCount(),this.stats.get(s2).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(t),t.unloadContent()}_destroy(){const t=[];for(this.root&&t.push(this.root);t.length>0;){const e=t.pop();for(const n of e.children)t.push(n);this._destroyTile(e)}this.root=null}_destroySubtree(t){const e=t,n=[];for(n.push(e);n.length>0;){t=n.pop();for(const i of t.children)n.push(i);t!==e&&this._destroyTile(t)}e.children=[]}_destroyTile(t){this._cache.unloadTile(this,t),this._unloadTile(t),t.destroy()}_initializeTiles3DTileset(t){if(t.queryString){const e=new URLSearchParams(t.queryString),n=Object.fromEntries(e.entries());this._queryParams={...this._queryParams,...n}}if(this.asset=t.asset,!this.asset)throw new Error("Tileset must have an asset property.");if(this.asset.version!=="0.0"&&this.asset.version!=="1.0")throw new Error("The tileset must be 3D Tiles version 0.0 or 1.0.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=t.properties,this.geometricError=t.geometricError,this._extensionsUsed=t.extensionsUsed||[],this.extras=t.extras}_initializeI3STileset(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}}const fF="3.4.14",Fg={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GEOMETRY:"geom",VECTOR:"vect",GLTF:"glTF"};function pF(r,t,e){li(r instanceof ArrayBuffer);const n=new TextDecoder("utf8"),i=new Uint8Array(r,t,e);return n.decode(i)}function Utt(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const e=new DataView(r);return"".concat(String.fromCharCode(e.getUint8(t+0))).concat(String.fromCharCode(e.getUint8(t+1))).concat(String.fromCharCode(e.getUint8(t+2))).concat(String.fromCharCode(e.getUint8(t+3)))}const Rtt={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},ms={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},Rn={...Rtt,...ms},o2={[ms.DOUBLE]:Float64Array,[ms.FLOAT]:Float32Array,[ms.UNSIGNED_SHORT]:Uint16Array,[ms.UNSIGNED_INT]:Uint32Array,[ms.UNSIGNED_BYTE]:Uint8Array,[ms.BYTE]:Int8Array,[ms.SHORT]:Int16Array,[ms.INT]:Int32Array},Ott={DOUBLE:ms.DOUBLE,FLOAT:ms.FLOAT,UNSIGNED_SHORT:ms.UNSIGNED_SHORT,UNSIGNED_INT:ms.UNSIGNED_INT,UNSIGNED_BYTE:ms.UNSIGNED_BYTE,BYTE:ms.BYTE,SHORT:ms.SHORT,INT:ms.INT},a2="Failed to convert GL type";class ql{static fromTypedArray(t){t=ArrayBuffer.isView(t)?t.constructor:t;for(const e in o2)if(o2[e]===t)return e;throw new Error(a2)}static fromName(t){const e=Ott[t];if(!e)throw new Error(a2);return e}static getArrayType(t){switch(t){case ms.UNSIGNED_SHORT_5_6_5:case ms.UNSIGNED_SHORT_4_4_4_4:case ms.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:const e=o2[t];if(!e)throw new Error(a2);return e}}static getByteSize(t){return ql.getArrayType(t).BYTES_PER_ELEMENT}static validate(t){return!!ql.getArrayType(t)}static createTypedArray(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0;i===void 0&&(i=(e.byteLength-n)/ql.getByteSize(t));const s=ql.getArrayType(t);return new s(e,n,i)}}function Dtt(r,t){if(!r)throw new Error("math.gl assertion failed. ".concat(t))}function Ntt(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];const e=r>>11&31,n=r>>5&63,i=r&31;return t[0]=e<<3,t[1]=n<<2,t[2]=i<<3,t}new Lb,new le,new Lb,new Lb;function gF(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:255;return Uu(r,0,t)/t*2-1}function mF(r){return r<0?-1:1}function ktt(r,t,e,n){if(Dtt(n),r<0||r>e||t<0||t>e)throw new Error("x and y must be unsigned normalized integers between 0 and ".concat(e));if(n.x=gF(r,e),n.y=gF(t,e),n.z=1-(Math.abs(n.x)+Math.abs(n.y)),n.z<0){const i=n.x;n.x=(1-Math.abs(n.y))*mF(i),n.y=(1-Math.abs(i))*mF(n.y)}return n.normalize()}function Qtt(r,t,e){return ktt(r,t,255,e)}class c2{constructor(t,e){$(this,"json",void 0),$(this,"buffer",void 0),$(this,"featuresLength",0),$(this,"_cachedTypedArrays",{}),this.json=t,this.buffer=e}getExtension(t){return this.json.extensions&&this.json.extensions[t]}hasProperty(t){return!!this.json[t]}getGlobalProperty(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Rn.UNSIGNED_INT,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const i=this.json[t];return i&&Number.isFinite(i.byteOffset)?this._getTypedArrayFromBinary(t,e,n,1,i.byteOffset):i}getPropertyArray(t,e,n){const i=this.json[t];return i&&Number.isFinite(i.byteOffset)?("componentType"in i&&(e=ql.fromName(i.componentType)),this._getTypedArrayFromBinary(t,e,n,this.featuresLength,i.byteOffset)):this._getTypedArrayFromArray(t,e,i)}getProperty(t,e,n,i,s){const a=this.json[t];if(!a)return a;const o=this.getPropertyArray(t,e,n);if(n===1)return o[i];for(let A=0;A<n;++A)s[A]=o[n*i+A];return s}_getTypedArrayFromBinary(t,e,n,i,s){const a=this._cachedTypedArrays;let o=a[t];return o||(o=ql.createTypedArray(e,this.buffer.buffer,this.buffer.byteOffset+s,i*n),a[t]=o),o}_getTypedArrayFromArray(t,e,n){const i=this._cachedTypedArrays;let s=i[t];return s||(s=ql.createTypedArray(e,n),i[t]=s),s}}const Htt={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ztt={SCALAR:(r,t)=>r[t],VEC2:(r,t)=>[r[2*t+0],r[2*t+1]],VEC3:(r,t)=>[r[3*t+0],r[3*t+1],r[3*t+2]],VEC4:(r,t)=>[r[4*t+0],r[4*t+1],r[4*t+2],r[4*t+3]],MAT2:(r,t)=>[r[4*t+0],r[4*t+1],r[4*t+2],r[4*t+3]],MAT3:(r,t)=>[r[9*t+0],r[9*t+1],r[9*t+2],r[9*t+3],r[9*t+4],r[9*t+5],r[9*t+6],r[9*t+7],r[9*t+8]],MAT4:(r,t)=>[r[16*t+0],r[16*t+1],r[16*t+2],r[16*t+3],r[16*t+4],r[16*t+5],r[16*t+6],r[16*t+7],r[16*t+8],r[16*t+9],r[16*t+10],r[16*t+11],r[16*t+12],r[16*t+13],r[16*t+14],r[16*t+15]]},Gtt={SCALAR:(r,t,e)=>{t[e]=r},VEC2:(r,t,e)=>{t[2*e+0]=r[0],t[2*e+1]=r[1]},VEC3:(r,t,e)=>{t[3*e+0]=r[0],t[3*e+1]=r[1],t[3*e+2]=r[2]},VEC4:(r,t,e)=>{t[4*e+0]=r[0],t[4*e+1]=r[1],t[4*e+2]=r[2],t[4*e+3]=r[3]},MAT2:(r,t,e)=>{t[4*e+0]=r[0],t[4*e+1]=r[1],t[4*e+2]=r[2],t[4*e+3]=r[3]},MAT3:(r,t,e)=>{t[9*e+0]=r[0],t[9*e+1]=r[1],t[9*e+2]=r[2],t[9*e+3]=r[3],t[9*e+4]=r[4],t[9*e+5]=r[5],t[9*e+6]=r[6],t[9*e+7]=r[7],t[9*e+8]=r[8],t[9*e+9]=r[9]},MAT4:(r,t,e)=>{t[16*e+0]=r[0],t[16*e+1]=r[1],t[16*e+2]=r[2],t[16*e+3]=r[3],t[16*e+4]=r[4],t[16*e+5]=r[5],t[16*e+6]=r[6],t[16*e+7]=r[7],t[16*e+8]=r[8],t[16*e+9]=r[9],t[16*e+10]=r[10],t[16*e+11]=r[11],t[16*e+12]=r[12],t[16*e+13]=r[13],t[16*e+14]=r[14],t[16*e+15]=r[15]}};function Vtt(r,t,e,n){const{componentType:i}=r;li(r.componentType);const s=typeof i=="string"?ql.fromName(i):i,a=Htt[r.type],o=ztt[r.type],A=Gtt[r.type];return e+=r.byteOffset,{values:ql.createTypedArray(s,t,e,a*n),type:s,size:a,unpacker:o,packer:A}}const Kl=r=>r!==void 0;function jtt(r,t,e){if(!t)return null;let n=r.getExtension("3DTILES_batch_table_hierarchy");const i=t.HIERARCHY;return i&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),t.extensions=t.extensions||{},t.extensions["3DTILES_batch_table_hierarchy"]=i,n=i),n?qtt(n,e):null}function qtt(r,t){let e,n,i;const s=r.instancesLength,a=r.classes;let o=r.classIds,A=r.parentCounts,f=r.parentIds,m=s;Kl(o.byteOffset)&&(o.componentType=defaultValue(o.componentType,GL.UNSIGNED_SHORT),o.type=AttributeType.SCALAR,i=getBinaryAccessor(o),o=i.createArrayBufferView(t.buffer,t.byteOffset+o.byteOffset,s));let _;if(Kl(A))for(Kl(A.byteOffset)&&(A.componentType=defaultValue(A.componentType,GL.UNSIGNED_SHORT),A.type=AttributeType.SCALAR,i=getBinaryAccessor(A),A=i.createArrayBufferView(t.buffer,t.byteOffset+A.byteOffset,s)),_=new Uint16Array(s),m=0,e=0;e<s;++e)_[e]=m,m+=A[e];Kl(f)&&Kl(f.byteOffset)&&(f.componentType=defaultValue(f.componentType,GL.UNSIGNED_SHORT),f.type=AttributeType.SCALAR,i=getBinaryAccessor(f),f=i.createArrayBufferView(t.buffer,t.byteOffset+f.byteOffset,m));const x=a.length;for(e=0;e<x;++e){const k=a[e].length,Q=a[e].instances,q=getBinaryProperties(k,Q,t);a[e].instances=combine(q,Q)}const B=new Array(x).fill(0),P=new Uint16Array(s);for(e=0;e<s;++e)n=o[e],P[e]=B[n],++B[n];const M={classes:a,classIds:o,classIndexes:P,parentCounts:A,parentIndexes:_,parentIds:f};return Wtt(M),M}function Pg(r,t,e){if(!r)return;const n=r.parentCounts;return r.parentIds?e(r,t):n>0?Ktt(r,t,e):$tt(r,t,e)}function Ktt(r,t,e){const n=r.classIds,i=r.parentCounts,s=r.parentIds,a=r.parentIndexes,o=n.length,A=scratchVisited;A.length=Math.max(A.length,o);const f=++marker,m=scratchStack;for(m.length=0,m.push(t);m.length>0;){if(t=m.pop(),A[t]===f)continue;A[t]=f;const _=e(r,t);if(Kl(_))return _;const x=i[t],B=a[t];for(let P=0;P<x;++P){const M=s[B+P];M!==t&&m.push(M)}}return null}function $tt(r,t,e){let n=!0;for(;n;){const i=e(r,t);if(Kl(i))return i;const s=r.parentIds[t];n=s!==t,t=s}throw new Error("traverseHierarchySingleParent")}function Wtt(r){const e=r.classIds.length;for(let n=0;n<e;++n)yF(r,n,stack)}function yF(r,t,e){const n=r.parentCounts,i=r.parentIds,s=r.parentIndexes,o=r.classIds.length;if(!Kl(i))return;assert(t<o,"Parent index ".concat(t," exceeds the total number of instances: ").concat(o)),assert(e.indexOf(t)===-1,"Circular dependency detected in the batch table hierarchy."),e.push(t);const A=Kl(n)?n[t]:1,f=Kl(n)?s[t]:t;for(let m=0;m<A;++m){const _=i[f+m];_!==t&&yF(r,_,e)}e.pop(t)}function Aa(r){return r!=null}const yy=(r,t)=>r,Xtt={HIERARCHY:!0,extensions:!0,extras:!0};class _F{constructor(t,e,n){var i;let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};$(this,"json",void 0),$(this,"binary",void 0),$(this,"featureCount",void 0),$(this,"_extensions",void 0),$(this,"_properties",void 0),$(this,"_binaryProperties",void 0),$(this,"_hierarchy",void 0),li(n>=0),this.json=t||{},this.binary=e,this.featureCount=n,this._extensions=((i=this.json)===null||i===void 0?void 0:i.extensions)||{},this._properties={};for(const a in this.json)Xtt[a]||(this._properties[a]=this.json[a]);this._binaryProperties=this._initializeBinaryProperties(),s["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=jtt(this,this.json,this.binary))}getExtension(t){return this.json&&this.json.extensions&&this.json.extensions[t]}memorySizeInBytes(){return 0}isClass(t,e){if(this._checkBatchId(t),li(typeof e=="string",e),this._hierarchy){const n=Pg(this._hierarchy,t,(i,s)=>{const a=i.classIds[s];return i.classes[a].name===e});return Aa(n)}return!1}isExactClass(t,e){return li(typeof e=="string",e),this.getExactClassName(t)===e}getExactClassName(t){if(this._checkBatchId(t),this._hierarchy){const e=this._hierarchy.classIds[t];return this._hierarchy.classes[e].name}}hasProperty(t,e){return this._checkBatchId(t),li(typeof e=="string",e),Aa(this._properties[e])||this._hasPropertyInHierarchy(t,e)}getPropertyNames(t,e){this._checkBatchId(t),e=Aa(e)?e:[],e.length=0;const n=Object.keys(this._properties);return e.push(...n),this._hierarchy&&this._getPropertyNamesInHierarchy(t,e),e}getProperty(t,e){if(this._checkBatchId(t),li(typeof e=="string",e),this._binaryProperties){const i=this._binaryProperties[e];if(Aa(i))return this._getBinaryProperty(i,t)}const n=this._properties[e];if(Aa(n))return yy(n[t]);if(this._hierarchy){const i=this._getHierarchyProperty(t,e);if(Aa(i))return i}}setProperty(t,e,n){const i=this.featureCount;if(this._checkBatchId(t),li(typeof e=="string",e),this._binaryProperties){const a=this._binaryProperties[e];if(a){this._setBinaryProperty(a,t,n);return}}if(this._hierarchy&&this._setHierarchyProperty(this,t,e,n))return;let s=this._properties[e];Aa(s)||(this._properties[e]=new Array(i),s=this._properties[e]),s[t]=yy(n)}_checkBatchId(t){if(!(t>=0&&t<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(t,e){return t.unpack(t.typedArray,e)}_setBinaryProperty(t,e,n){t.pack(n,t.typedArray,e)}_initializeBinaryProperties(){let t=null;for(const e in this._properties){const n=this._properties[e],i=this._initializeBinaryProperty(e,n);i&&(t=t||{},t[e]=i)}return t}_initializeBinaryProperty(t,e){if("byteOffset"in e){const n=e;li(this.binary,"Property ".concat(t," requires a batch table binary.")),li(n.type,"Property ".concat(t," requires a type."));const i=Vtt(n,this.binary.buffer,this.binary.byteOffset|0,this.featureCount);return{typedArray:i.values,componentCount:i.size,unpack:i.unpacker,pack:i.packer}}return null}_hasPropertyInHierarchy(t,e){if(!this._hierarchy)return!1;const n=Pg(this._hierarchy,t,(i,s)=>{const a=i.classIds[s],o=i.classes[a].instances;return Aa(o[e])});return Aa(n)}_getPropertyNamesInHierarchy(t,e){Pg(this._hierarchy,t,(n,i)=>{const s=n.classIds[i],a=n.classes[s].instances;for(const o in a)a.hasOwnProperty(o)&&e.indexOf(o)===-1&&e.push(o)})}_getHierarchyProperty(t,e){return Pg(this._hierarchy,t,(n,i)=>{const s=n.classIds[i],a=n.classes[s],o=n.classIndexes[i],A=a.instances[e];return Aa(A)?Aa(A.typedArray)?this._getBinaryProperty(A,o):yy(A[o]):null})}_setHierarchyProperty(t,e,n,i){const s=Pg(this._hierarchy,e,(a,o)=>{const A=a.classIds[o],f=a.classes[A],m=a.classIndexes[o],_=f.instances[n];return Aa(_)?(li(o===e,'Inherited property "'.concat(n,'" is read-only.')),Aa(_.typedArray)?this._setBinaryProperty(_,m,i):_[m]=yy(i),!0):!1});return Aa(s)}}const l2=4;function _y(r,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const n=new DataView(t);if(r.magic=n.getUint32(e,!0),e+=l2,r.version=n.getUint32(e,!0),e+=l2,r.byteLength=n.getUint32(e,!0),e+=l2,r.version!==1)throw new Error("3D Tile Version ".concat(r.version," not supported"));return e}const vf=4,vF="b3dm tile in legacy format.";function u2(r,t,e){const n=new DataView(t);let i;r.header=r.header||{};let s=n.getUint32(e,!0);e+=vf;let a=n.getUint32(e,!0);e+=vf;let o=n.getUint32(e,!0);e+=vf;let A=n.getUint32(e,!0);return e+=vf,o>=570425344?(e-=vf*2,i=s,o=a,A=0,s=0,a=0,console.warn(vF)):A>=570425344&&(e-=vf,i=o,o=s,A=a,s=0,a=0,console.warn(vF)),r.header.featureTableJsonByteLength=s,r.header.featureTableBinaryByteLength=a,r.header.batchTableJsonByteLength=o,r.header.batchTableBinaryByteLength=A,r.header.batchLength=i,e}function A2(r,t,e,n){return e=Jtt(r,t,e),e=Ytt(r,t,e),e}function Jtt(r,t,e,n){const{featureTableJsonByteLength:i,featureTableBinaryByteLength:s,batchLength:a}=r.header;if(r.featureTableJson={BATCH_LENGTH:a||0},i>0){const o=pF(t,e,i);r.featureTableJson=JSON.parse(o)}return e+=i,r.featureTableBinary=new Uint8Array(t,e,s),e+=s,e}function Ytt(r,t,e,n){const{batchTableJsonByteLength:i,batchTableBinaryByteLength:s}=r.header;if(i>0){const a=pF(t,e,i);r.batchTableJson=JSON.parse(a),e+=i,s>0&&(r.batchTableBinary=new Uint8Array(t,e,s),r.batchTableBinary=new Uint8Array(r.batchTableBinary),e+=s)}return e}function bF(r,t,e){if(!t&&(!r||!r.batchIds||!e))return null;const{batchIds:n,isRGB565:i,pointCount:s}=r;if(n&&e){const a=new Uint8ClampedArray(s*3);for(let o=0;o<s;o++){const A=n[o],m=e.getProperty(A,"dimensions").map(_=>_*255);a[o*3]=m[0],a[o*3+1]=m[1],a[o*3+2]=m[2]}return{type:Rn.UNSIGNED_BYTE,value:a,size:3,normalized:!0}}if(i){const a=new Uint8ClampedArray(s*3);for(let o=0;o<s;o++){const A=Ntt(t[o]);a[o*3]=A[0],a[o*3+1]=A[1],a[o*3+2]=A[2]}return{type:Rn.UNSIGNED_BYTE,value:a,size:3,normalized:!0}}return t&&t.length===s*3?{type:Rn.UNSIGNED_BYTE,value:t,size:3,normalized:!0}:{type:Rn.UNSIGNED_BYTE,value:t,size:4,normalized:!0}}const wF=new le;function Ztt(r,t){if(!t)return null;if(r.isOctEncoded16P){const e=new Float32Array(r.pointsLength*3);for(let n=0;n<r.pointsLength;n++)Qtt(t[n*2],t[n*2+1],wF),wF.toArray(e,n*3);return{type:Rn.FLOAT,size:2,value:e}}return{type:Rn.FLOAT,size:2,value:t}}function tet(r,t,e){return r.isQuantized?e["3d-tiles"]&&e["3d-tiles"].decodeQuantizedPositions?(r.isQuantized=!1,eet(r,t)):{type:Rn.UNSIGNED_SHORT,value:t,size:3,normalized:!0}:t}function eet(r,t){const e=new le,n=new Float32Array(r.pointCount*3);for(let i=0;i<r.pointCount;i++)e.set(t[i*3],t[i*3+1],t[i*3+2]).scale(1/r.quantizedRange).multiply(r.quantizedVolumeScale).add(r.quantizedVolumeOffset).toArray(n,i*3);return n}async function ret(r,t,e,n,i){e=_y(r,t,e),e=u2(r,t,e),e=A2(r,t,e),net(r);const{featureTable:s,batchTable:a}=iet(r);return await uet(r,s,a,n,i),set(r,s,n),oet(r,s,a),aet(r,s),e}function net(r){r.attributes={positions:null,colors:null,normals:null,batchIds:null},r.isQuantized=!1,r.isTranslucent=!1,r.isRGB565=!1,r.isOctEncoded16P=!1}function iet(r){const t=new c2(r.featureTableJson,r.featureTableBinary),e=t.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(e))throw new Error("POINTS_LENGTH must be defined");t.featuresLength=e,r.featuresLength=e,r.pointsLength=e,r.pointCount=e,r.rtcCenter=t.getGlobalProperty("RTC_CENTER",Rn.FLOAT,3);const n=cet(r,t);return{featureTable:t,batchTable:n}}function set(r,t,e){if(!r.attributes.positions){if(t.hasProperty("POSITION"))r.attributes.positions=t.getPropertyArray("POSITION",Rn.FLOAT,3);else if(t.hasProperty("POSITION_QUANTIZED")){const n=t.getPropertyArray("POSITION_QUANTIZED",Rn.UNSIGNED_SHORT,3);if(r.isQuantized=!0,r.quantizedRange=65535,r.quantizedVolumeScale=t.getGlobalProperty("QUANTIZED_VOLUME_SCALE",Rn.FLOAT,3),!r.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(r.quantizedVolumeOffset=t.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",Rn.FLOAT,3),!r.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");r.attributes.positions=tet(r,n,e)}}if(!r.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}function oet(r,t,e){if(!r.attributes.colors){let n=null;t.hasProperty("RGBA")?(n=t.getPropertyArray("RGBA",Rn.UNSIGNED_BYTE,4),r.isTranslucent=!0):t.hasProperty("RGB")?n=t.getPropertyArray("RGB",Rn.UNSIGNED_BYTE,3):t.hasProperty("RGB565")&&(n=t.getPropertyArray("RGB565",Rn.UNSIGNED_SHORT,1),r.isRGB565=!0),r.attributes.colors=bF(r,n,e)}t.hasProperty("CONSTANT_RGBA")&&(r.constantRGBA=t.getGlobalProperty("CONSTANT_RGBA",Rn.UNSIGNED_BYTE,4))}function aet(r,t){if(!r.attributes.normals){let e=null;t.hasProperty("NORMAL")?e=t.getPropertyArray("NORMAL",Rn.FLOAT,3):t.hasProperty("NORMAL_OCT16P")&&(e=t.getPropertyArray("NORMAL_OCT16P",Rn.UNSIGNED_BYTE,2),r.isOctEncoded16P=!0),r.attributes.normals=Ztt(r,e)}}function cet(r,t){let e=null;if(!r.batchIds&&t.hasProperty("BATCH_ID")&&(r.batchIds=t.getPropertyArray("BATCH_ID",Rn.UNSIGNED_SHORT,1),r.batchIds)){const n=t.getGlobalProperty("BATCH_LENGTH");if(!n)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");const{batchTableJson:i,batchTableBinary:s}=r;e=new _F(i,s,n)}return e}async function uet(r,t,e,n,i){let s,a,o;const A=r.batchTableJson&&r.batchTableJson.extensions&&r.batchTableJson.extensions["3DTILES_draco_point_compression"];A&&(o=A.properties);const f=t.getExtension("3DTILES_draco_point_compression");if(f){a=f.properties;const _=f.byteOffset,x=f.byteLength;if(!a||!Number.isFinite(_)||!x)throw new Error("Draco properties, byteOffset, and byteLength must be defined");s=r.featureTableBinary.slice(_,_+x),r.hasPositions=Number.isFinite(a.POSITION),r.hasColors=Number.isFinite(a.RGB)||Number.isFinite(a.RGBA),r.hasNormals=Number.isFinite(a.NORMAL),r.hasBatchIds=Number.isFinite(a.BATCH_ID),r.isTranslucent=Number.isFinite(a.RGBA)}if(!s)return!0;const m={buffer:s,properties:{...a,...o},featureTableProperties:a,batchTableProperties:o,dequantizeInShader:!1};return await Aet(r,m,n,i)}async function Aet(r,t,e,n){const{parse:i}=n,s={...e,draco:{...e.draco,extraAttributes:t.batchTableProperties||{}}};delete s["3d-tiles"];const a=await i(t.buffer,PL,s),o=a.attributes.POSITION&&a.attributes.POSITION.value,A=a.attributes.COLOR_0&&a.attributes.COLOR_0.value,f=a.attributes.NORMAL&&a.attributes.NORMAL.value,m=a.attributes.BATCH_ID&&a.attributes.BATCH_ID.value,_=o&&a.attributes.POSITION.value.quantization,x=f&&a.attributes.NORMAL.value.quantization;if(_){const P=a.POSITION.data.quantization,M=P.range;r.quantizedVolumeScale=new le(M,M,M),r.quantizedVolumeOffset=new le(P.minValues),r.quantizedRange=(1<<P.quantizationBits)-1,r.isQuantizedDraco=!0}x&&(r.octEncodedRange=(1<<a.NORMAL.data.quantization.quantizationBits)-1,r.isOctEncodedDraco=!0);const B={};if(t.batchTableProperties)for(const P of Object.keys(t.batchTableProperties))a.attributes[P]&&a.attributes[P].value&&(B[P.toLowerCase()]=a.attributes[P].value);r.attributes={positions:o,colors:bF(r,A,void 0),normals:f,batchIds:m,...B}}const h2={URI:0,EMBEDDED:1};function xF(r,t,e,n){r.rotateYtoZ=!0;const i=r.byteOffset+r.byteLength-e;if(i===0)throw new Error("glTF byte length must be greater than 0.");return r.gltfUpAxis=n["3d-tiles"]&&n["3d-tiles"].assetGltfUpAxis?n["3d-tiles"].assetGltfUpAxis:"Y",r.gltfArrayBuffer=Lv(t,e,i),r.gltfByteOffset=0,r.gltfByteLength=i,e%4===0||console.warn("".concat(r.type,": embedded glb is not aligned to a 4-byte boundary.")),r.byteOffset+r.byteLength}async function BF(r,t,e,n){const i=e["3d-tiles"]||{};if(het(r,t),i.loadGLTF){const{parse:s,fetch:a}=n;r.gltfUrl&&(r.gltfArrayBuffer=await a(r.gltfUrl,e),r.gltfByteOffset=0),r.gltfArrayBuffer&&(r.gltf=await s(r.gltfArrayBuffer,Ig,e,n),r.gpuMemoryUsageInBytes=TL(r.gltf),delete r.gltfArrayBuffer,delete r.gltfByteOffset,delete r.gltfByteLength)}}function het(r,t,e){switch(t){case h2.URI:const n=new Uint8Array(r.gltfArrayBuffer,r.gltfByteOffset),s=new TextDecoder().decode(n);r.gltfUrl=s.replace(/[\s\0]+$/,""),delete r.gltfArrayBuffer,delete r.gltfByteOffset,delete r.gltfByteLength;break;case h2.EMBEDDED:break;default:throw new Error("b3dm: Illegal glTF format field")}}async function det(r,t,e,n,i){var s;e=fet(r,t,e,n),await BF(r,h2.EMBEDDED,n,i);const a=r==null||(s=r.gltf)===null||s===void 0?void 0:s.extensions;return a&&a.CESIUM_RTC&&(r.rtcCenter=a.CESIUM_RTC.center),e}function fet(r,t,e,n,i){e=_y(r,t,e),e=u2(r,t,e),e=A2(r,t,e),e=xF(r,t,e,n);const s=new c2(r.featureTableJson,r.featureTableBinary);return r.rtcCenter=s.getGlobalProperty("RTC_CENTER",Rn.FLOAT,3),e}async function pet(r,t,e,n,i){return e=get(r,t,e,n),await BF(r,r.gltfFormat,n,i),e}function get(r,t,e,n,i){if(e=_y(r,t,e),r.version!==1)throw new Error("Instanced 3D Model version ".concat(r.version," is not supported"));e=u2(r,t,e);const s=new DataView(t);if(r.gltfFormat=s.getUint32(e,!0),e+=4,e=A2(r,t,e),e=xF(r,t,e,n),r.featureTableJsonByteLength===0)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");const a=new c2(r.featureTableJson,r.featureTableBinary),o=a.getGlobalProperty("INSTANCES_LENGTH");if(a.featuresLength=o,!Number.isFinite(o))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");r.eastNorthUp=a.getGlobalProperty("EAST_NORTH_UP"),r.rtcCenter=a.getGlobalProperty("RTC_CENTER",Rn.FLOAT,3);const A=new _F(r.batchTableJson,r.batchTableBinary,o);return met(r,a,A,o),e}function met(r,t,e,n){const s={instances:new Array(n),batchTable:r._batchTable,cull:!1,url:void 0,gltf:void 0,basePath:void 0,incrementallyLoadTextures:!1,forwardAxis:[1,0,0]}.instances,a=new le;new le,new le,new le;const o=new zi,A=new lg,f=new le,m={},_=new Bn,x=[],B=[],P=new le,M=new le;for(let k=0;k<n;k++){let Q;if(t.hasProperty("POSITION"))Q=t.getProperty("POSITION",Rn.FLOAT,3,k,a);else if(t.hasProperty("POSITION_QUANTIZED")){Q=t.getProperty("POSITION_QUANTIZED",Rn.UNSIGNED_SHORT,3,k,a);const mt=t.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",Rn.FLOAT,3,P);if(!mt)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const dt=t.getGlobalProperty("QUANTIZED_VOLUME_SCALE",Rn.FLOAT,3,M);if(!dt)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const Rt=65535;for(let Lt=0;Lt<3;Lt++)Q[Lt]=Q[Lt]/Rt*dt[Lt]+mt[Lt]}if(!Q)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");if(a.copy(Q),m.translation=a,r.normalUp=t.getProperty("NORMAL_UP",Rn.FLOAT,3,k,x),r.normalRight=t.getProperty("NORMAL_RIGHT",Rn.FLOAT,3,k,B),r.normalUp){if(!r.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");r.hasCustomOrientation=!0}else{if(r.octNormalUp=t.getProperty("NORMAL_UP_OCT32P",Rn.UNSIGNED_SHORT,2,x),r.octNormalRight=t.getProperty("NORMAL_RIGHT_OCT32P",Rn.UNSIGNED_SHORT,2,B),r.octNormalUp)throw r.octNormalRight?new Error("i3dm: oct-encoded orientation not implemented"):new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");r.eastNorthUp?(Pi.WGS84.eastNorthUpToFixedFrame(a,_),_.getRotationMatrix3(o)):o.identity()}A.fromMatrix3(o),m.rotation=A,f.set(1,1,1);const q=t.getProperty("SCALE",Rn.FLOAT,1,k);Number.isFinite(q)&&f.multiplyByScalar(q);const J=t.getProperty("SCALE_NON_UNIFORM",Rn.FLOAT,3,k,x);J&&f.scale(J),m.scale=f;let tt=t.getProperty("BATCH_ID",Rn.UNSIGNED_SHORT,1,k);tt===void 0&&(tt=k);const ft=new Bn().fromQuaternion(m.rotation);_.identity(),_.translate(m.translation),_.multiplyRight(ft),_.scale(m.scale);const pt=_.clone();s[k]={modelMatrix:pt,batchId:tt}}r.instances=s}async function yet(r,t,e,n,i,s){e=_y(r,t,e);const a=new DataView(t);for(r.tilesLength=a.getUint32(e,!0),e+=4,r.tiles=[];r.tiles.length<r.tilesLength&&r.byteLength-e>12;){const o={};r.tiles.push(o),e=await s(t,e,n,i,o)}return e}async function _et(r,t,e,n){r.rotateYtoZ=!0,r.gltfUpAxis=e["3d-tiles"]&&e["3d-tiles"].assetGltfUpAxis?e["3d-tiles"].assetGltfUpAxis:"Y";const{parse:i}=n;r.gltf=await i(t,Ig,e,n),r.gpuMemoryUsageInBytes=TL(r.gltf)}async function CF(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,e=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};switch(i.byteOffset=t,i.type=Utt(r,t),i.type){case Fg.COMPOSITE:return await yet(i,r,t,e,n,CF);case Fg.BATCHED_3D_MODEL:return await det(i,r,t,e,n);case Fg.GLTF:return await _et(i,r,e,n);case Fg.INSTANCED_3D_MODEL:return await pet(i,r,t,e,n);case Fg.POINT_CLOUD:return await ret(i,r,t,e,n);default:throw new Error("3DTileLoader: unknown type ".concat(i.type))}}const vet=1952609651,bet=1;async function wet(r,t,e){if(new Uint32Array(r.slice(0,4))[0]!==vet)throw new Error("Wrong subtree file magic number");if(new Uint32Array(r.slice(4,8))[0]!==bet)throw new Error("Wrong subtree file verson, must be 1");const s=EF(r.slice(8,16)),a=new Uint8Array(r,24,s),A=new TextDecoder("utf8").decode(a),f=JSON.parse(A),m=EF(r.slice(16,24));let _=new ArrayBuffer(0);return m&&(_=r.slice(24+s)),"bufferView"in f.tileAvailability&&(f.tileAvailability.explicitBitstream=await d2(f,"tileAvailability",_,e)),"bufferView"in f.contentAvailability&&(f.contentAvailability.explicitBitstream=await d2(f,"contentAvailability",_,e)),"bufferView"in f.childSubtreeAvailability&&(f.childSubtreeAvailability.explicitBitstream=await d2(f,"childSubtreeAvailability",_,e)),f}function xet(r,t){if(t.startsWith("http")){const s=new URL(r,t);return decodeURI(s.toString())}const n="http://".concat(t),i=new URL(r,n);return"/".concat(i.host).concat(i.pathname)}async function d2(r,t,e,n){const i=r[t].bufferView,s=r.bufferViews[i],a=r.buffers[s.buffer];if(!(n!=null&&n.url)||!n.fetch)throw new Error("Url is not provided");if(!n.fetch)throw new Error("fetch is not provided");if(a.uri){const o=xet(a.uri,n==null?void 0:n.url),f=await(await n.fetch(o)).arrayBuffer();return new Uint8Array(f,s.byteOffset,s.byteLength)}return new Uint8Array(e,s.byteOffset,s.byteLength)}function EF(r){const t=new DataView(r),e=t.getUint32(0,!0),n=t.getUint32(4,!0);return e+2**32*n}const SF={id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:fF,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:wet,options:{}};/**
 * @license
 * Copyright 2009 The Closure Library Authors
 * Copyright 2020 Daniel Wirtz / The long.js Authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * SPDX-License-Identifier: Apache-2.0
 */var cc=null;try{cc=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function Jn(r,t,e){this.low=r|0,this.high=t|0,this.unsigned=!!e}Jn.prototype.__isLong__,Object.defineProperty(Jn.prototype,"__isLong__",{value:!0});function ho(r){return(r&&r.__isLong__)===!0}function TF(r){var t=Math.clz32(r&-r);return r?31-t:t}Jn.isLong=ho;var IF={},LF={};function qh(r,t){var e,n,i;return t?(r>>>=0,(i=0<=r&&r<256)&&(n=LF[r],n)?n:(e=Nn(r,0,!0),i&&(LF[r]=e),e)):(r|=0,(i=-128<=r&&r<128)&&(n=IF[r],n)?n:(e=Nn(r,r<0?-1:0,!1),i&&(IF[r]=e),e))}Jn.fromInt=qh;function lc(r,t){if(isNaN(r))return t?Nu:$c;if(t){if(r<0)return Nu;if(r>=PF)return DF}else{if(r<=-MF)return ha;if(r+1>=MF)return OF}return r<0?lc(-r,t).neg():Nn(r%bf|0,r/bf|0,t)}Jn.fromNumber=lc;function Nn(r,t,e){return new Jn(r,t,e)}Jn.fromBits=Nn;var vy=Math.pow;function f2(r,t,e){if(r.length===0)throw Error("empty string");if(typeof t=="number"?(e=t,t=!1):t=!!t,r==="NaN"||r==="Infinity"||r==="+Infinity"||r==="-Infinity")return t?Nu:$c;if(e=e||10,e<2||36<e)throw RangeError("radix");var n;if((n=r.indexOf("-"))>0)throw Error("interior hyphen");if(n===0)return f2(r.substring(1),t,e).neg();for(var i=lc(vy(e,8)),s=$c,a=0;a<r.length;a+=8){var o=Math.min(8,r.length-a),A=parseInt(r.substring(a,a+o),e);if(o<8){var f=lc(vy(e,o));s=s.mul(f).add(lc(A))}else s=s.mul(i),s=s.add(lc(A))}return s.unsigned=t,s}Jn.fromString=f2;function Kc(r,t){return typeof r=="number"?lc(r,t):typeof r=="string"?f2(r,t):Nn(r.low,r.high,typeof t=="boolean"?t:r.unsigned)}Jn.fromValue=Kc;var FF=65536,Bet=1<<24,bf=FF*FF,PF=bf*bf,MF=PF/2,UF=qh(Bet),$c=qh(0);Jn.ZERO=$c;var Nu=qh(0,!0);Jn.UZERO=Nu;var wf=qh(1);Jn.ONE=wf;var RF=qh(1,!0);Jn.UONE=RF;var p2=qh(-1);Jn.NEG_ONE=p2;var OF=Nn(-1,2147483647,!1);Jn.MAX_VALUE=OF;var DF=Nn(-1,-1,!0);Jn.MAX_UNSIGNED_VALUE=DF;var ha=Nn(0,-2147483648,!1);Jn.MIN_VALUE=ha;var Ge=Jn.prototype;Ge.toInt=function(){return this.unsigned?this.low>>>0:this.low},Ge.toNumber=function(){return this.unsigned?(this.high>>>0)*bf+(this.low>>>0):this.high*bf+(this.low>>>0)},Ge.toString=function(t){if(t=t||10,t<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(ha)){var e=lc(t),n=this.div(e),i=n.mul(e).sub(this);return n.toString(t)+i.toInt().toString(t)}else return"-"+this.neg().toString(t);for(var s=lc(vy(t,6),this.unsigned),a=this,o="";;){var A=a.div(s),f=a.sub(A.mul(s)).toInt()>>>0,m=f.toString(t);if(a=A,a.isZero())return m+o;for(;m.length<6;)m="0"+m;o=""+m+o}},Ge.getHighBits=function(){return this.high},Ge.getHighBitsUnsigned=function(){return this.high>>>0},Ge.getLowBits=function(){return this.low},Ge.getLowBitsUnsigned=function(){return this.low>>>0},Ge.getNumBitsAbs=function(){if(this.isNegative())return this.eq(ha)?64:this.neg().getNumBitsAbs();for(var t=this.high!=0?this.high:this.low,e=31;e>0&&!(t&1<<e);e--);return this.high!=0?e+33:e+1},Ge.isZero=function(){return this.high===0&&this.low===0},Ge.eqz=Ge.isZero,Ge.isNegative=function(){return!this.unsigned&&this.high<0},Ge.isPositive=function(){return this.unsigned||this.high>=0},Ge.isOdd=function(){return(this.low&1)===1},Ge.isEven=function(){return(this.low&1)===0},Ge.equals=function(t){return ho(t)||(t=Kc(t)),this.unsigned!==t.unsigned&&this.high>>>31===1&&t.high>>>31===1?!1:this.high===t.high&&this.low===t.low},Ge.eq=Ge.equals,Ge.notEquals=function(t){return!this.eq(t)},Ge.neq=Ge.notEquals,Ge.ne=Ge.notEquals,Ge.lessThan=function(t){return this.comp(t)<0},Ge.lt=Ge.lessThan,Ge.lessThanOrEqual=function(t){return this.comp(t)<=0},Ge.lte=Ge.lessThanOrEqual,Ge.le=Ge.lessThanOrEqual,Ge.greaterThan=function(t){return this.comp(t)>0},Ge.gt=Ge.greaterThan,Ge.greaterThanOrEqual=function(t){return this.comp(t)>=0},Ge.gte=Ge.greaterThanOrEqual,Ge.ge=Ge.greaterThanOrEqual,Ge.compare=function(t){if(ho(t)||(t=Kc(t)),this.eq(t))return 0;var e=this.isNegative(),n=t.isNegative();return e&&!n?-1:!e&&n?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},Ge.comp=Ge.compare,Ge.negate=function(){return!this.unsigned&&this.eq(ha)?ha:this.not().add(wf)},Ge.neg=Ge.negate,Ge.add=function(t){ho(t)||(t=Kc(t));var e=this.high>>>16,n=this.high&65535,i=this.low>>>16,s=this.low&65535,a=t.high>>>16,o=t.high&65535,A=t.low>>>16,f=t.low&65535,m=0,_=0,x=0,B=0;return B+=s+f,x+=B>>>16,B&=65535,x+=i+A,_+=x>>>16,x&=65535,_+=n+o,m+=_>>>16,_&=65535,m+=e+a,m&=65535,Nn(x<<16|B,m<<16|_,this.unsigned)},Ge.subtract=function(t){return ho(t)||(t=Kc(t)),this.add(t.neg())},Ge.sub=Ge.subtract,Ge.multiply=function(t){if(this.isZero())return this;if(ho(t)||(t=Kc(t)),cc){var e=cc.mul(this.low,this.high,t.low,t.high);return Nn(e,cc.get_high(),this.unsigned)}if(t.isZero())return this.unsigned?Nu:$c;if(this.eq(ha))return t.isOdd()?ha:$c;if(t.eq(ha))return this.isOdd()?ha:$c;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(UF)&&t.lt(UF))return lc(this.toNumber()*t.toNumber(),this.unsigned);var n=this.high>>>16,i=this.high&65535,s=this.low>>>16,a=this.low&65535,o=t.high>>>16,A=t.high&65535,f=t.low>>>16,m=t.low&65535,_=0,x=0,B=0,P=0;return P+=a*m,B+=P>>>16,P&=65535,B+=s*m,x+=B>>>16,B&=65535,B+=a*f,x+=B>>>16,B&=65535,x+=i*m,_+=x>>>16,x&=65535,x+=s*f,_+=x>>>16,x&=65535,x+=a*A,_+=x>>>16,x&=65535,_+=n*m+i*f+s*A+a*o,_&=65535,Nn(B<<16|P,_<<16|x,this.unsigned)},Ge.mul=Ge.multiply,Ge.divide=function(t){if(ho(t)||(t=Kc(t)),t.isZero())throw Error("division by zero");if(cc){if(!this.unsigned&&this.high===-2147483648&&t.low===-1&&t.high===-1)return this;var e=(this.unsigned?cc.div_u:cc.div_s)(this.low,this.high,t.low,t.high);return Nn(e,cc.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Nu:$c;var n,i,s;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return Nu;if(t.gt(this.shru(1)))return RF;s=Nu}else{if(this.eq(ha)){if(t.eq(wf)||t.eq(p2))return ha;if(t.eq(ha))return wf;var a=this.shr(1);return n=a.div(t).shl(1),n.eq($c)?t.isNegative()?wf:p2:(i=this.sub(t.mul(n)),s=n.add(i.div(t)),s)}else if(t.eq(ha))return this.unsigned?Nu:$c;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();s=$c}for(i=this;i.gte(t);){n=Math.max(1,Math.floor(i.toNumber()/t.toNumber()));for(var o=Math.ceil(Math.log(n)/Math.LN2),A=o<=48?1:vy(2,o-48),f=lc(n),m=f.mul(t);m.isNegative()||m.gt(i);)n-=A,f=lc(n,this.unsigned),m=f.mul(t);f.isZero()&&(f=wf),s=s.add(f),i=i.sub(m)}return s},Ge.div=Ge.divide,Ge.modulo=function(t){if(ho(t)||(t=Kc(t)),cc){var e=(this.unsigned?cc.rem_u:cc.rem_s)(this.low,this.high,t.low,t.high);return Nn(e,cc.get_high(),this.unsigned)}return this.sub(this.div(t).mul(t))},Ge.mod=Ge.modulo,Ge.rem=Ge.modulo,Ge.not=function(){return Nn(~this.low,~this.high,this.unsigned)},Ge.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},Ge.clz=Ge.countLeadingZeros,Ge.countTrailingZeros=function(){return this.low?TF(this.low):TF(this.high)+32},Ge.ctz=Ge.countTrailingZeros,Ge.and=function(t){return ho(t)||(t=Kc(t)),Nn(this.low&t.low,this.high&t.high,this.unsigned)},Ge.or=function(t){return ho(t)||(t=Kc(t)),Nn(this.low|t.low,this.high|t.high,this.unsigned)},Ge.xor=function(t){return ho(t)||(t=Kc(t)),Nn(this.low^t.low,this.high^t.high,this.unsigned)},Ge.shiftLeft=function(t){return ho(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?Nn(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):Nn(0,this.low<<t-32,this.unsigned)},Ge.shl=Ge.shiftLeft,Ge.shiftRight=function(t){return ho(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?Nn(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):Nn(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},Ge.shr=Ge.shiftRight,Ge.shiftRightUnsigned=function(t){return ho(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?Nn(this.low>>>t|this.high<<32-t,this.high>>>t,this.unsigned):t===32?Nn(this.high,0,this.unsigned):Nn(this.high>>>t-32,0,this.unsigned)},Ge.shru=Ge.shiftRightUnsigned,Ge.shr_u=Ge.shiftRightUnsigned,Ge.rotateLeft=function(t){var e;return ho(t)&&(t=t.toInt()),(t&=63)===0?this:t===32?Nn(this.high,this.low,this.unsigned):t<32?(e=32-t,Nn(this.low<<t|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned)):(t-=32,e=32-t,Nn(this.high<<t|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned))},Ge.rotl=Ge.rotateLeft,Ge.rotateRight=function(t){var e;return ho(t)&&(t=t.toInt()),(t&=63)===0?this:t===32?Nn(this.high,this.low,this.unsigned):t<32?(e=32-t,Nn(this.high<<e|this.low>>>t,this.low<<e|this.high>>>t,this.unsigned)):(t-=32,e=32-t,Nn(this.low<<e|this.high>>>t,this.high<<e|this.low>>>t,this.unsigned))},Ge.rotr=Ge.rotateRight,Ge.toSigned=function(){return this.unsigned?Nn(this.low,this.high,!1):this},Ge.toUnsigned=function(){return this.unsigned?this:Nn(this.low,this.high,!0)},Ge.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},Ge.toBytesLE=function(){var t=this.high,e=this.low;return[e&255,e>>>8&255,e>>>16&255,e>>>24,t&255,t>>>8&255,t>>>16&255,t>>>24]},Ge.toBytesBE=function(){var t=this.high,e=this.low;return[t>>>24,t>>>16&255,t>>>8&255,t&255,e>>>24,e>>>16&255,e>>>8&255,e&255]},Jn.fromBytes=function(t,e,n){return n?Jn.fromBytesLE(t,e):Jn.fromBytesBE(t,e)},Jn.fromBytesLE=function(t,e){return new Jn(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,e)},Jn.fromBytesBE=function(t,e){return new Jn(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],e)};const Cet=16;function NF(r){r==="X"&&(r="");const t=r.padEnd(Cet,"0");return Jn.fromString(t,!0,16)}function Eet(r){if(r.isZero())return"X";let t=r.countTrailingZeros();const e=t%4;t=(t-e)/4;const n=t;t*=4;const s=r.shiftRightUnsigned(t).toString(16).replace(/0+$/,"");return Array(17-n-s.length).join("0")+s}function Tet(r,t){const e=Iet(r).shiftRightUnsigned(2);return r.add(Jn.fromNumber(2*t+1-4).multiply(e))}function Iet(r){return r.and(r.not().add(1))}const Let=3,Fet=2*30+1,kF=180/Math.PI;function Pet(r){if(r.length===0)throw new Error("Invalid Hilbert quad key ".concat(r));const t=r.split("/"),e=parseInt(t[0],10),n=t[1],i=n.length;let s=0;const a=[0,0];for(let o=i-1;o>=0;o--){s=i-o;const A=n[o];let f=0,m=0;A==="1"?m=1:A==="2"?(f=1,m=1):A==="3"&&(f=1);const _=Math.pow(2,s-1);Uet(_,a,f,m),a[0]+=_*f,a[1]+=_*m}if(e%2===1){const o=a[0];a[0]=a[1],a[1]=o}return{face:e,ij:a,level:s}}function Met(r){if(r.isZero())return"";let t=r.toString(2);for(;t.length<Let+Fet;)t="0"+t;const e=t.lastIndexOf("1"),n=t.substring(0,3),i=t.substring(3,e),s=i.length/2,a=Jn.fromString(n,!0,2).toString(10);let o="";if(s!==0)for(o=Jn.fromString(i,!0,2).toString(4);o.length<s;)o="0"+o;return"".concat(a,"/").concat(o)}function QF(r,t,e){const n=1<<t;return[(r[0]+e[0])/n,(r[1]+e[1])/n]}function HF(r){return r>=.5?1/3*(4*r*r-1):1/3*(1-4*(1-r)*(1-r))}function zF(r){return[HF(r[0]),HF(r[1])]}function GF(r,t){let[e,n]=t;switch(r){case 0:return[1,e,n];case 1:return[-e,1,n];case 2:return[-e,-n,1];case 3:return[-1,-n,-e];case 4:return[n,-1,-e];case 5:return[n,e,-1];default:throw new Error("Invalid face")}}function VF(r){let[t,e,n]=r;const i=Math.atan2(n,Math.sqrt(t*t+e*e));return[Math.atan2(e,t)*kF,i*kF]}function Uet(r,t,e,n){if(n===0){e===1&&(t[0]=r-1-t[0],t[1]=r-1-t[1]);const i=t[0];t[0]=t[1],t[1]=i}}function Ret(r){const t=QF(r.ij,r.level,[.5,.5]),e=zF(t),n=GF(r.face,e);return VF(n)}const Oet=100;function jF(r){const{face:t,ij:e,level:n}=r,i=[[0,0],[0,1],[1,1],[1,0],[0,0]],s=Math.max(1,Math.ceil(Oet*Math.pow(2,-n))),a=new Float64Array(4*s*2+2);let o=0,A=0;for(let f=0;f<4;f++){const m=i[f].slice(0),_=i[f+1],x=(_[0]-m[0])/s,B=(_[1]-m[1])/s;for(let P=0;P<s;P++){m[0]+=x,m[1]+=B;const M=QF(e,n,m),k=zF(M),Q=GF(t,k),q=VF(Q);Math.abs(q[1])>89.999&&(q[0]=A);const J=q[0]-A;q[0]+=J>180?-360:J<-180?360:0,a[o++]=q[0],a[o++]=q[1],A=q[0]}}return a[o++]=a[0],a[o++]=a[1],a}function g2(r){const t=Det(r);return Pet(t)}function Det(r){if(r.indexOf("/")>0)return r;const t=NF(r);return Met(t)}function Net(r){const t=g2(r);return Ret(t)}function ket(r){let t;if(r.face===2||r.face===5){let e=null,n=0;for(let i=0;i<4;i++){const s="".concat(r.face,"/").concat(i),a=g2(s),o=jF(a);(typeof e>"u"||e===null)&&(e=new Float64Array(4*o.length)),e.set(o,n),n+=o.length}t=qF(e)}else{const e=jF(r);t=qF(e)}return t}function qF(r){if(r.length%2!==0)throw new Error("Invalid corners");const t=[],e=[];for(let n=0;n<r.length;n+=2)t.push(r[n]),e.push(r[n+1]);return t.sort((n,i)=>n-i),e.sort((n,i)=>n-i),{west:t[0],east:t[t.length-1],north:e[e.length-1],south:e[0]}}function Qet(r,t){const e=(t==null?void 0:t.minimumHeight)||0,n=(t==null?void 0:t.maximumHeight)||0,i=g2(r),s=ket(i),a=s.west,o=s.south,A=s.east,f=s.north,m=[];return m.push(new le(a,f,e)),m.push(new le(A,f,e)),m.push(new le(A,o,e)),m.push(new le(a,o,e)),m.push(new le(a,f,n)),m.push(new le(A,f,n)),m.push(new le(A,o,n)),m.push(new le(a,o,n)),m}function KF(r){const t=r.token,e={minimumHeight:r.minimumHeight,maximumHeight:r.maximumHeight},n=Qet(t,e),i=Net(t),s=i[0],a=i[1],o=Pi.WGS84.cartographicToCartesian([s,a,e.maximumHeight]),A=new le(o[0],o[1],o[2]);n.push(A);const f=mX(n);return[...f.center,...f.halfAxes]}const Het={QUADTREE:4,OCTREE:8};function zet(r,t,e){if(r!=null&&r.box){const n=NF(r.s2VolumeInfo.token),i=Tet(n,t),s=Eet(i),a={...r.s2VolumeInfo};switch(a.token=s,e){case"OCTREE":const f=r.s2VolumeInfo,m=f.maximumHeight-f.minimumHeight,_=m/2,x=f.minimumHeight+m/2;f.minimumHeight=x-_,f.maximumHeight=x+_;break}return{box:KF(a),s2VolumeInfo:a}}}async function $F(r){const{options:t,parentData:e={mortonIndex:0,x:0,y:0,z:0},childIndex:n=0,globalData:i={level:0,mortonIndex:0,x:0,y:0,z:0},s2VolumeBox:s}=r;let{subtree:a,level:o=0}=r;const{subdivisionScheme:A,subtreeLevels:f,maximumLevel:m,contentUrlTemplate:_,subtreesUriTemplate:x,basePath:B}=t,P={children:[],lodMetricValue:0,contentUrl:""},M=Het[A],k=n&1,Q=n>>1&1,q=n>>2&1,J=(M**o-1)/(M-1);let tt=Kh(e.mortonIndex,n),ft=J+tt,pt=Kh(e.x,k),mt=Kh(e.y,Q),dt=Kh(e.z,q),Rt=!1;o+1>f&&(Rt=m2(a.childSubtreeAvailability,tt));const Lt=Kh(i.x,pt),st=Kh(i.y,mt),ct=Kh(i.z,dt),wt=o+i.level;if(Rt){const Xt="".concat(B,"/").concat(x),ne=y2(Xt,wt,Lt,st,ct);a=await TA(ne,SF),i.mortonIndex=tt,i.x=pt,i.y=mt,i.z=dt,i.level=o,tt=0,ft=0,pt=0,mt=0,dt=0,o=0}if(!m2(a.tileAvailability,ft)||o>m)return P;m2(a.contentAvailability,ft)&&(P.contentUrl=y2(_,wt,Lt,st,ct));const Zt=o+1,re={mortonIndex:tt,x:pt,y:mt,z:dt};for(let Xt=0;Xt<M;Xt++){const ne=zet(s,Xt,A),se=await $F({subtree:a,options:t,parentData:re,childIndex:Xt,level:Zt,globalData:i,s2VolumeBox:ne});if(se.contentUrl||se.children.length){const we=wt+1,vt=Get(se,we,{childTileX:pt,childTileY:mt,childTileZ:dt},t,s);P.children.push(vt)}}return P}function m2(r,t){return"constant"in r?!!r.constant:r.explicitBitstream?qet(t,r.explicitBitstream):!1}function Get(r,t,e,n,i){const{basePath:s,refine:a,getRefine:o,lodMetricType:A,getTileType:f,rootLodMetricValue:m,rootBoundingVolume:_}=n,x=r.contentUrl&&r.contentUrl.replace("".concat(s,"/"),""),B=m/2**t,P=i!=null&&i.box?{box:i.box}:_,M=Vet(t,P,e);return{children:r.children,contentUrl:r.contentUrl,content:{uri:x},id:r.contentUrl,refine:o(a),type:f(r),lodMetricType:A,lodMetricValue:B,geometricError:B,transform:r.transform,boundingVolume:M}}function Vet(r,t,e){if(t.region){const{childTileX:n,childTileY:i,childTileZ:s}=e,[a,o,A,f,m,_]=t.region,x=2**r,B=(A-a)/x,P=(f-o)/x,M=(_-m)/x,[k,Q]=[a+B*n,a+B*(n+1)],[q,J]=[o+P*i,o+P*(i+1)],[tt,ft]=[m+M*s,m+M*(s+1)];return{region:[k,q,Q,J,tt,ft]}}if(t.box)return t;throw new Error("Unsupported bounding volume type ".concat(t))}function Kh(r,t){return parseInt(r.toString(2)+t.toString(2),2)}function y2(r,t,e,n,i){const s=jet({level:t,x:e,y:n,z:i});return r.replace(/{level}|{x}|{y}|{z}/gi,a=>s[a])}function jet(r){const t={};for(const e in r)t["{".concat(e,"}")]=r[e];return t}function qet(r,t){const e=Math.floor(r/8),n=r%8;return(t[e]>>n&1)===1}function _2(r){if(!r.contentUrl)return _f.EMPTY;const e=r.contentUrl.split("?")[0].split(".").pop();switch(e){case"pnts":return _f.POINTCLOUD;case"i3dm":case"b3dm":case"glb":case"gltf":return _f.SCENEGRAPH;default:return e}}function v2(r){switch(r){case"REPLACE":case"replace":return Du.REPLACE;case"ADD":case"add":return Du.ADD;default:return r}}function b2(r,t){if(/^[a-z][0-9a-z+.-]*:/i.test(t)){const n=new URL(r,"".concat(t,"/"));return decodeURI(n.toString())}else if(r.startsWith("/"))return r;return"".concat(t,"/").concat(r)}function WF(r,t){if(!r)return null;if(r.content){const e=r.content.uri||r.content.url;r.contentUrl=b2(e,t.basePath)}return r.id=r.contentUrl,r.lodMetricType=fy.GEOMETRIC_ERROR,r.lodMetricValue=r.geometricError,r.transformMatrix=r.transform,r.type=_2(r),r.refine=v2(r.refine),r}async function Ket(r,t){const e=r.basePath;let n;const i=JF(r==null?void 0:r.root);i&&r.root?n=await XF(r.root,r,i,t):n=WF(r.root,r);const s=[];for(s.push(n);s.length>0;){const o=(s.pop()||{}).children||[];for(let A of o){const f=JF(A);f?A=await XF(A,r,f,t):WF(A,{basePath:e}),s.push(A)}}return n}async function XF(r,t,e,n){var i,s;const a=t.basePath,{subdivisionScheme:o,maximumLevel:A,subtreeLevels:f,subtrees:{uri:m}}=e,_=y2(m,0,0,0,0),x=b2(_,a),B=await TA(x,SF,n),P=b2(r.content.uri,a),M=t==null||(i=t.root)===null||i===void 0?void 0:i.refine,k=r.geometricError,Q=(s=r.boundingVolume.extensions)===null||s===void 0?void 0:s["3DTILES_bounding_volume_S2"];if(Q){const ft={box:KF(Q),s2VolumeInfo:Q};r.boundingVolume=ft}const q=r.boundingVolume,J={contentUrlTemplate:P,subtreesUriTemplate:m,subdivisionScheme:o,subtreeLevels:f,maximumLevel:A,refine:M,basePath:a,lodMetricType:fy.GEOMETRIC_ERROR,rootLodMetricValue:k,rootBoundingVolume:q,getTileType:_2,getRefine:v2};return await $et(r,B,J)}async function $et(r,t,e){if(!r)return null;r.lodMetricType=fy.GEOMETRIC_ERROR,r.lodMetricValue=r.geometricError,r.transformMatrix=r.transform;const{children:n,contentUrl:i}=await $F({subtree:t,options:e,s2VolumeBox:r});return i&&(r.contentUrl=i,r.content={uri:i.replace("".concat(e.basePath,"/"),"")}),r.refine=v2(r.refine),r.type=_2(r),r.children=n,r.id=r.contentUrl,r}function JF(r){var t;return(r==null||(t=r.extensions)===null||t===void 0?void 0:t["3DTILES_implicit_tiling"])||(r==null?void 0:r.implicitTiling)}const w2={id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:fF,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:Yet,options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}};function Wet(r){return Fv(r.url)}async function Xet(r,t,e){const n={content:{featureIds:null}};return await CF(r,0,t,e,n.content),n.content}async function Jet(r,t,e){var n;const i=JSON.parse(new TextDecoder().decode(r));return i.loader=t.loader||w2,i.url=e.url,i.queryString=e.queryString,i.basePath=Wet(i),i.root=await Ket(i,t),i.type=ac.TILES3D,i.lodMetricType=fy.GEOMETRIC_ERROR,i.lodMetricValue=((n=i.root)===null||n===void 0?void 0:n.lodMetricValue)||0,i}async function Yet(r,t,e){const n=t["3d-tiles"]||{};let i;return n.isTileset==="auto"?i=e.url&&e.url.indexOf(".json")!==-1:i=n.isTileset,i?r=await Jet(r,t,e):r=await Xet(r,t,e),r}const YF=[0],Zet={getPointColor:{type:"accessor",value:[0,0,0,255]},pointSize:1,data:"",loader:w2,onTilesetLoad:{type:"function",value:r=>{}},onTileLoad:{type:"function",value:r=>{}},onTileUnload:{type:"function",value:r=>{}},onTileError:{type:"function",value:(r,t,e)=>{}},_getMeshColor:{type:"function",value:r=>[255,255,255]}};class x2 extends RI{constructor(){super(...arguments),$(this,"state",void 0)}initializeState(){"onTileLoadFail"in this.props&&Pn.removed("onTileLoadFail","onTileError")(),this.state={layerMap:{},tileset3d:null,activeViewports:{},lastUpdatedViewports:null}}get isLoaded(){var t,e;return!!(!((t=this.state)===null||t===void 0||(e=t.tileset3d)===null||e===void 0)&&e.isLoaded()&&super.isLoaded)}shouldUpdateState(t){let{changeFlags:e}=t;return e.somethingChanged}updateState(t){let{props:e,oldProps:n,changeFlags:i}=t;if(e.data&&e.data!==n.data&&this._loadTileset(e.data),i.viewportChanged){const{activeViewports:s}=this.state;Object.keys(s).length&&(this._updateTileset(s),this.state.lastUpdatedViewports=s,this.state.activeViewports={})}if(i.propsChanged){const{layerMap:s}=this.state;for(const a in s)s[a].needsUpdate=!0}}activateViewport(t){const{activeViewports:e,lastUpdatedViewports:n}=this.state;this.internalState.viewport=t,e[t.id]=t;const i=n==null?void 0:n[t.id];(!i||!t.equals(i))&&(this.setChangeFlags({viewportChanged:!0}),this.setNeedsUpdate())}getPickingInfo(t){let{info:e,sourceLayer:n}=t;const i=n&&n.props.tile;return e.picked&&(e.object=i),e.sourceTile=i,e}filterSubLayer(t){let{layer:e,viewport:n}=t;const{tile:i}=e.props,{id:s}=n;return i.selected&&i.viewportIds.includes(s)}_updateAutoHighlight(t){const e=t.sourceTile,n=this.state.layerMap[e==null?void 0:e.id];n&&n.layer&&n.layer.updateAutoHighlight(t)}async _loadTileset(t){const{loadOptions:e={}}=this.props;let n=this.props.loader||this.props.loaders;Array.isArray(n)&&(n=n[0]);const i={loadOptions:{...e}};let s=t;if(n.preload){const A=await n.preload(t,e);A.url&&(s=A.url),A.headers&&(i.loadOptions.fetch={...i.loadOptions.fetch,headers:A.headers}),Object.assign(i,A)}const a=await TA(s,n,i.loadOptions),o=new Mtt(a,{onTileLoad:this._onTileLoad.bind(this),onTileUnload:this._onTileUnload.bind(this),onTileError:this.props.onTileError,...i});this.setState({tileset3d:o,layerMap:{}}),this._updateTileset(this.state.activeViewports),this.props.onTilesetLoad(o)}_onTileLoad(t){const{lastUpdatedViewports:e}=this.state;this.props.onTileLoad(t),this._updateTileset(e),this.setNeedsUpdate()}_onTileUnload(t){delete this.state.layerMap[t.id],this.props.onTileUnload(t)}_updateTileset(t){if(!t)return;const{tileset3d:e}=this.state,{timeline:n}=this.context,i=Object.keys(t).length;!n||!i||!e||e.selectTiles(Object.values(t)).then(s=>{this.state.frameNumber!==s&&this.setState({frameNumber:s})})}_getSubLayer(t,e){if(!t.content)return null;switch(t.type){case _f.POINTCLOUD:return this._makePointCloudLayer(t,e);case _f.SCENEGRAPH:return this._make3DModelLayer(t);case _f.MESH:return this._makeSimpleMeshLayer(t,e);default:throw new Error("Tile3DLayer: Failed to render layer of type ".concat(t.content.type))}}_makePointCloudLayer(t,e){const{attributes:n,pointCount:i,constantRGBA:s,cartographicOrigin:a,modelMatrix:o}=t.content,{positions:A,normals:f,colors:m}=n;if(!A)return null;const _=e&&e.props.data||{header:{vertexCount:i},attributes:{POSITION:A,NORMAL:f,COLOR_0:m}},{pointSize:x,getPointColor:B}=this.props,P=this.getSubLayerClass("pointcloud",Sw);return new P({pointSize:x},this.getSubLayerProps({id:"pointcloud"}),{id:"".concat(this.id,"-pointcloud-").concat(t.id),tile:t,data:_,coordinateSystem:Tn.METER_OFFSETS,coordinateOrigin:a,modelMatrix:o,getColor:s||B,_offset:0})}_make3DModelLayer(t){const{gltf:e,instances:n,cartographicOrigin:i,modelMatrix:s}=t.content,a=this.getSubLayerClass("scenegraph",qw);return new a({_lighting:"pbr"},this.getSubLayerProps({id:"scenegraph"}),{id:"".concat(this.id,"-scenegraph-").concat(t.id),tile:t,data:n||YF,scenegraph:e,coordinateSystem:Tn.METER_OFFSETS,coordinateOrigin:i,modelMatrix:s,getTransformMatrix:o=>o.modelMatrix,getPosition:[0,0,0],_offset:0})}_makeSimpleMeshLayer(t,e){const n=t.content,{attributes:i,indices:s,modelMatrix:a,cartographicOrigin:o,coordinateSystem:A=Tn.METER_OFFSETS,material:f,featureIds:m}=n,{_getMeshColor:_}=this.props,x=e&&e.props.mesh||new hg({drawMode:4,attributes:trt(i),indices:s}),B=this.getSubLayerClass("mesh",Kw);return new B(this.getSubLayerProps({id:"mesh"}),{id:"".concat(this.id,"-mesh-").concat(t.id),tile:t,mesh:x,data:YF,getColor:_(t),pbrMaterial:f,modelMatrix:a,coordinateOrigin:o,coordinateSystem:A,featureIds:m,_offset:0})}renderLayers(){const{tileset3d:t,layerMap:e}=this.state;return t?t.tiles.map(n=>{const i=e[n.id]=e[n.id]||{tile:n};let{layer:s}=i;return n.selected&&(s?i.needsUpdate&&(s=this._getSubLayer(n,s),i.needsUpdate=!1):s=this._getSubLayer(n)),i.layer=s,s}).filter(Boolean):null}}$(x2,"defaultProps",Zet),$(x2,"layerName","Tile3DLayer");function trt(r){const t={};return t.positions={...r.positions,value:new Float32Array(r.positions.value)},r.normals&&(t.normals=r.normals),r.texCoords&&(t.texCoords=r.texCoords),r.colors&&(t.colors=r.colors),r.uvRegions&&(t.uvRegions=r.uvRegions),t}var ert=Object.defineProperty,rrt=(r,t,e)=>t in r?ert(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,qn=(r,t,e)=>(rrt(r,typeof t!="symbol"?t+"":t,e),e);let nrt=class{constructor(t){qn(this,"map"),qn(this,"width"),qn(this,"height"),qn(this,"svgCanvas"),qn(this,"xLine"),qn(this,"yLine"),qn(this,"color","#535353"),this.map=t,this.mapResize=this.mapResize.bind(this)}create(){this.updateValues(),this.map!==void 0?(this.map.on("resize",this.mapResize),this.createCanvas(this.map.getCanvasContainer())):console.error("map object is null")}updateValues(){var t,e;this.width=(t=this.map)==null?void 0:t.getCanvas().clientWidth,this.height=(e=this.map)==null?void 0:e.getCanvas().clientHeight}mapResize(){this.updateValues(),this.updateCanvas()}updateCanvas(){if(this.svgCanvas!==void 0&&this.yLine!==void 0&&this.xLine!==void 0&&this.width!==void 0&&this.height!==void 0){this.svgCanvas.setAttribute("width",`${this.width}px`),this.svgCanvas.setAttribute("height",`${this.height}px`);const t=this.width/2,e=this.height/2;this.yLine.setAttribute("x1",`${t}px`),this.yLine.setAttribute("y1","0px"),this.yLine.setAttribute("x2",`${t}px`),this.yLine.setAttribute("y2",`${this.height}px`),this.xLine.setAttribute("x1","0px"),this.xLine.setAttribute("y1",`${e}px`),this.xLine.setAttribute("x2",`${this.width}px`),this.xLine.setAttribute("y2",`${e}px`)}else console.error("element value is null")}createCanvas(t){if(this.width!==void 0&&this.height!==void 0){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.style.position="relative",e.setAttribute("width",`${this.width}px`),e.setAttribute("height",`${this.height}px`);const n=this.width/2,i=this.height/2;this.yLine=e.appendChild(this.createLine(n,0,n,this.height,this.color,"2px")),this.xLine=e.appendChild(this.createLine(0,i,this.width,i,this.color,"2px")),t==null||t.appendChild(e),this.svgCanvas=e}}createLine(t,e,n,i,s,a){const o=document.createElementNS("http://www.w3.org/2000/svg","line");return o.setAttribute("x1",t),o.setAttribute("y1",e),o.setAttribute("x2",n),o.setAttribute("y2",i),o.setAttribute("stroke-dasharray","5,5"),o.setAttribute("stroke",s),o.setAttribute("stroke-width",a),o}destroy(){this.xLine!==void 0&&(this.xLine.remove(),this.xLine=void 0),this.yLine!==void 0&&(this.yLine.remove(),this.yLine=void 0),this.svgCanvas!==void 0&&(this.svgCanvas.remove(),this.svgCanvas=void 0),this.map!==void 0&&(this.map.off("resize",this.mapResize),this.map=void 0)}};const B2={72:72,96:96,200:200,300:300,400:400},ku={JPEG:"jpg",PNG:"png",PDF:"pdf",SVG:"svg"},Mg={Landscape:"landscape",Portrait:"portrait"},$h={LETTER:[279,216],A2:[594,420],A3:[420,297],A4:[297,210],A5:[210,148],A6:[148,105],B2:[707,500],B3:[500,353],B4:[353,250],B5:[250,176],B6:[176,125]},xf={in:"in",mm:"mm"};let irt=class{constructor(t){qn(this,"map"),qn(this,"width"),qn(this,"height"),qn(this,"unit"),qn(this,"svgCanvas"),qn(this,"svgPath");var e,n,i;if(this.map=t,this.map===void 0)return;this.mapResize=this.mapResize.bind(this),this.map.on("resize",this.mapResize);const s=(e=this.map)==null?void 0:e.getCanvas().clientWidth,a=(n=this.map)==null?void 0:n.getCanvas().clientHeight,o=document.createElementNS("http://www.w3.org/2000/svg","svg");o.style.position="absolute",o.style.top="0px",o.style.left="0px",o.setAttribute("width",`${s}px`),o.setAttribute("height",`${a}px`);const A=document.createElementNS("http://www.w3.org/2000/svg","path");A.setAttribute("style","fill:#888888;stroke-width:0"),A.setAttribute("fill-opacity","0.5"),o.append(A),(i=this.map)==null||i.getCanvasContainer().appendChild(o),this.svgCanvas=o,this.svgPath=A}mapResize(){this.generateCutOut()}updateArea(t,e){this.width=t,this.height=e,this.unit=xf.mm,this.generateCutOut()}generateCutOut(){var t,e;if(this.map===void 0||this.svgCanvas===void 0||this.svgPath===void 0)return;const n=this.toPixels(this.width),i=this.toPixels(this.height),s=(t=this.map)==null?void 0:t.getCanvas().clientWidth,a=(e=this.map)==null?void 0:e.getCanvas().clientHeight,o=s/2-n/2,A=o+n,f=a/2-i/2,m=f+i;this.svgCanvas.setAttribute("width",`${s}px`),this.svgCanvas.setAttribute("height",`${a}px`),this.svgPath.setAttribute("d",`M 0 0 L ${s} 0 L ${s} ${a} L 0 ${a} M ${o} ${f} L ${o} ${m} L ${A} ${m} L ${A} ${f}`)}destroy(){this.svgCanvas!==void 0&&(this.svgCanvas.remove(),this.svgCanvas=void 0),this.map!==void 0&&(this.map=void 0)}toPixels(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:96;return this.unit===xf.mm&&(e/=25.4),e*t}};const ZF={PageSize:"Page Size",PageOrientation:"Page Orientation",Format:"Format",DPI:"DPI",Generate:"Generate",LanguageName:"English"},srt={PageSize:"Taille de page",PageOrientation:"Orientation de la page",Format:"Format",DPI:"DPI",Generate:"Gnrer",LanguageName:"French"},ort={PageSize:"Sivukoko",PageOrientation:"Sivun suunta",Format:"Muoto",DPI:"DPI",Generate:"Generoi",LanguageName:"Finish"},art={PageSize:"Papierformat",PageOrientation:"Papierausrichtung",Format:"Dateiformat",DPI:"Druckauflsung",Generate:"Erstellen",LanguageName:"German"},crt={PageSize:"Sidstorlek",PageOrientation:"Sidorientering",Format:"Format",DPI:"DPI",Generate:"Generera",LanguageName:"Swedish"},lrt={PageSize:"Tamao de pgina",PageOrientation:"Orientacin de pgina",Format:"Formato",DPI:"DPI",Generate:"Generar",LanguageName:"Spanish"},urt={PageSize:"Kch thc trang",PageOrientation:"Loi trang",Format:"nh dng",DPI:"Mt  im nh (DPI)",Generate:"To",LanguageName:"Vietnam"},Art={PageSize:" ",PageOrientation:" ",Format:"",DPI:"DPI",Generate:"",LanguageName:"Ukranian"},hrt={PageSize:"",PageOrientation:"",Format:"",DPI:"",Generate:"",LanguageName:"Chinese simplified"},drt={PageSize:"",PageOrientation:"",Format:"",DPI:"",Generate:"",LanguageName:"Chinese traditional"},frt={PageSize:"",PageOrientation:"",Format:"",DPI:"DPI",Generate:"",LanguageName:"Japanese"},prt=r=>{switch(r){case"de":return art;case"en":return ZF;case"fr":return srt;case"fi":return ort;case"sv":return crt;case"es":return lrt;case"vi":return urt;case"uk":return Art;case"zhHans":return hrt;case"zhHant":return drt;case"ja":return frt;default:return ZF}};(function(r){var t={};function e(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return r[n].call(i.exports,i,i.exports,e),i.l=!0,i.exports}e.m=r,e.c=t,e.d=function(n,i,s){e.o(n,i)||Object.defineProperty(n,i,{enumerable:!0,get:s})},e.r=function(n){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},e.t=function(n,i){if(1&i&&(n=e(n)),8&i||4&i&&typeof n=="object"&&n&&n.__esModule)return n;var s=Object.create(null);if(e.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:n}),2&i&&typeof n!="string")for(var a in n)e.d(s,a,(function(o){return n[o]}).bind(null,a));return s},e.n=function(n){var i=n&&n.__esModule?function(){return n.default}:function(){return n};return e.d(i,"a",i),i},e.o=function(n,i){return Object.prototype.hasOwnProperty.call(n,i)},e.p="",e(e.s=0)})([function(r,t,e){r.exports=e(1)},function(r,t){function e(i,s){for(var a=0;a<s.length;a++){var o=s[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(i,o.key,o)}}var n=function(){function i(){(function(o,A){if(!(o instanceof A))throw new TypeError("Cannot call a class as a function")})(this,i),this.options={overlayBackgroundColor:"#666666",overlayOpacity:.6,spinnerIcon:"ball-circus",spinnerColor:"#000",spinnerSize:"3x",overlayIDName:"overlay",spinnerIDName:"spinner",offsetY:0,offsetX:0,lockScroll:!1,containerID:null,spinnerZIndex:99999,overlayZIndex:99998},this.stylesheetBaseURL="https://cdn.jsdelivr.net/npm/load-awesome@1.1.0/css/",this.spinner=null,this.spinnerStylesheetURL=null,this.numberOfEmptyDivForSpinner={"ball-8bits":16,"ball-atom":4,"ball-beat":3,"ball-circus":5,"ball-climbing-dot":1,"ball-clip-rotate":1,"ball-clip-rotate-multiple":2,"ball-clip-rotate-pulse":2,"ball-elastic-dots":5,"ball-fall":3,"ball-fussion":4,"ball-grid-beat":9,"ball-grid-pulse":9,"ball-newton-cradle":4,"ball-pulse":3,"ball-pulse-rise":5,"ball-pulse-sync":3,"ball-rotate":1,"ball-running-dots":5,"ball-scale":1,"ball-scale-multiple":3,"ball-scale-pulse":2,"ball-scale-ripple":1,"ball-scale-ripple-multiple":3,"ball-spin":8,"ball-spin-clockwise":8,"ball-spin-clockwise-fade":8,"ball-spin-clockwise-fade-rotating":8,"ball-spin-fade":8,"ball-spin-fade-rotating":8,"ball-spin-rotate":2,"ball-square-clockwise-spin":8,"ball-square-spin":8,"ball-triangle-path":3,"ball-zig-zag":2,"ball-zig-zag-deflect":2,cog:1,"cube-transition":2,fire:3,"line-scale":5,"line-scale-party":5,"line-scale-pulse-out":5,"line-scale-pulse-out-rapid":5,"line-spin-clockwise-fade":8,"line-spin-clockwise-fade-rotating":8,"line-spin-fade":8,"line-spin-fade-rotating":8,pacman:6,"square-jelly-box":2,"square-loader":1,"square-spin":1,timer:1,"triangle-skew-spin":1}}var s,a;return s=i,(a=[{key:"show",value:function(o){this.setOptions(o),this.addSpinnerStylesheet(),this.generateSpinnerElement(),this.options.lockScroll&&(document.body.style.overflow="hidden",document.documentElement.style.overflow="hidden"),this.generateAndAddOverlayElement()}},{key:"hide",value:function(){this.options.lockScroll&&(document.body.style.overflow="",document.documentElement.style.overflow="");var o=document.getElementById("loading-overlay-stylesheet");o&&(o.disabled=!0,o.parentNode.removeChild(o),document.getElementById(this.options.overlayIDName).remove(),document.getElementById(this.options.spinnerIDName).remove())}},{key:"setOptions",value:function(o){if(o!==void 0)for(var A in o)this.options[A]=o[A]}},{key:"generateAndAddOverlayElement",value:function(){var o="50%";this.options.offsetX!==0&&(o="calc(50% + "+this.options.offsetX+")");var A="50%";if(this.options.offsetY!==0&&(A="calc(50% + "+this.options.offsetY+")"),this.options.containerID&&document.body.contains(document.getElementById(this.options.containerID))){var f='<div id="'.concat(this.options.overlayIDName,'" style="display: block !important; position: absolute; top: 0; left: 0; overflow: auto; opacity: ').concat(this.options.overlayOpacity,"; background: ").concat(this.options.overlayBackgroundColor,'; z-index: 50; width: 100%; height: 100%;"></div><div id="').concat(this.options.spinnerIDName,'" style="display: block !important; position: absolute; top: ').concat(A,"; left: ").concat(o,'; -webkit-transform: translate(-50%); -ms-transform: translate(-50%); transform: translate(-50%); z-index: 9999;">').concat(this.spinner,"</div>"),m=document.getElementById(this.options.containerID);return m.style.position="relative",void m.insertAdjacentHTML("beforeend",f)}var _='<div id="'.concat(this.options.overlayIDName,'" style="display: block !important; position: fixed; top: 0; left: 0; overflow: auto; opacity: ').concat(this.options.overlayOpacity,"; background: ").concat(this.options.overlayBackgroundColor,"; z-index: ").concat(this.options.overlayZIndex,'; width: 100%; height: 100%;"></div><div id="').concat(this.options.spinnerIDName,'" style="display: block !important; position: fixed; top: ').concat(A,"; left: ").concat(o,"; -webkit-transform: translate(-50%); -ms-transform: translate(-50%); transform: translate(-50%); z-index: ").concat(this.options.spinnerZIndex,';">').concat(this.spinner,"</div>");document.body.insertAdjacentHTML("beforeend",_)}},{key:"generateSpinnerElement",value:function(){var o=this,A=Object.keys(this.numberOfEmptyDivForSpinner).find(function(m){return m===o.options.spinnerIcon}),f=this.generateEmptyDivElement(this.numberOfEmptyDivForSpinner[A]);this.spinner='<div style="color: '.concat(this.options.spinnerColor,'" class="la-').concat(this.options.spinnerIcon," la-").concat(this.options.spinnerSize,'">').concat(f,"</div>")}},{key:"addSpinnerStylesheet",value:function(){this.setSpinnerStylesheetURL();var o=document.createElement("link");o.setAttribute("id","loading-overlay-stylesheet"),o.setAttribute("rel","stylesheet"),o.setAttribute("type","text/css"),o.setAttribute("href",this.spinnerStylesheetURL),document.getElementsByTagName("head")[0].appendChild(o)}},{key:"setSpinnerStylesheetURL",value:function(){this.spinnerStylesheetURL=this.stylesheetBaseURL+this.options.spinnerIcon+".min.css"}},{key:"generateEmptyDivElement",value:function(o){for(var A="",f=1;f<=o;f++)A+="<div></div>";return A}}])&&e(s.prototype,a),i}();window.JsLoadingOverlay=new n,r.exports=JsLoadingOverlay}]);function kn(r){"@babel/helpers - typeof";return kn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},kn(r)}var Oo=Uint8Array,Do=Uint16Array,Ug=Uint32Array,by=new Oo([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),wy=new Oo([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),C2=new Oo([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),t4=function(r,t){for(var e=new Do(31),n=0;n<31;++n)e[n]=t+=1<<r[n-1];for(var i=new Ug(e[30]),n=1;n<30;++n)for(var s=e[n];s<e[n+1];++s)i[s]=s-e[n]<<5|n;return[e,i]},e4=t4(by,2),r4=e4[0],E2=e4[1];r4[28]=258,E2[258]=28;for(var n4=t4(wy,0),grt=n4[0],i4=n4[1],S2=new Do(32768),wi=0;wi<32768;++wi){var HA=(wi&43690)>>>1|(wi&21845)<<1;HA=(HA&52428)>>>2|(HA&13107)<<2,HA=(HA&61680)>>>4|(HA&3855)<<4,S2[wi]=((HA&65280)>>>8|(HA&255)<<8)>>>1}for(var $l=function(r,t,e){for(var n=r.length,i=0,s=new Do(t);i<n;++i)++s[r[i]-1];var a=new Do(t);for(i=0;i<t;++i)a[i]=a[i-1]+s[i-1]<<1;var o;if(e){o=new Do(1<<t);var A=15-t;for(i=0;i<n;++i)if(r[i])for(var f=i<<4|r[i],m=t-r[i],_=a[r[i]-1]++<<m,x=_|(1<<m)-1;_<=x;++_)o[S2[_]>>>A]=f}else for(o=new Do(n),i=0;i<n;++i)o[i]=S2[a[r[i]-1]++]>>>15-r[i];return o},zA=new Oo(288),wi=0;wi<144;++wi)zA[wi]=8;for(var wi=144;wi<256;++wi)zA[wi]=9;for(var wi=256;wi<280;++wi)zA[wi]=7;for(var wi=280;wi<288;++wi)zA[wi]=8;for(var Rg=new Oo(32),wi=0;wi<32;++wi)Rg[wi]=5;var mrt=$l(zA,9,0),yrt=$l(zA,9,1),_rt=$l(Rg,5,0),vrt=$l(Rg,5,1),T2=function(r){for(var t=r[0],e=1;e<r.length;++e)r[e]>t&&(t=r[e]);return t},Wc=function(r,t,e){var n=t/8>>0;return(r[n]|r[n+1]<<8)>>>(t&7)&e},I2=function(r,t){var e=t/8>>0;return(r[e]|r[e+1]<<8|r[e+2]<<16)>>>(t&7)},L2=function(r){return(r/8>>0)+(r&7&&1)},s4=function(r,t,e){(t==null||t<0)&&(t=0),(e==null||e>r.length)&&(e=r.length);var n=new(r instanceof Do?Do:r instanceof Ug?Ug:Oo)(e-t);return n.set(r.subarray(t,e)),n},brt=function(r,t,e){var n=r.length,i=!t||e,s=!e||e.i;e||(e={}),t||(t=new Oo(n*3));var a=function($t){var jt=t.length;if($t>jt){var ae=new Oo(Math.max(jt*2,$t));ae.set(t),t=ae}},o=e.f||0,A=e.p||0,f=e.b||0,m=e.l,_=e.d,x=e.m,B=e.n,P=n*8;do{if(!m){e.f=o=Wc(r,A,1);var M=Wc(r,A+1,3);if(A+=3,M)if(M==1)m=yrt,_=vrt,x=9,B=5;else if(M==2){var k=Wc(r,A,31)+257,Q=Wc(r,A+10,15)+4,q=k+Wc(r,A+5,31)+1;A+=14;for(var J=new Oo(q),tt=new Oo(19),ft=0;ft<Q;++ft)tt[C2[ft]]=Wc(r,A+ft*3,7);A+=Q*3;var pt=T2(tt),mt=(1<<pt)-1;if(!s&&A+q*(pt+7)>P)break;for(var dt=$l(tt,pt,1),ft=0;ft<q;){var Rt=dt[Wc(r,A,mt)];A+=Rt&15;var Lt=Rt>>>4;if(Lt<16)J[ft++]=Lt;else{var st=0,ct=0;for(Lt==16?(ct=3+Wc(r,A,3),A+=2,st=J[ft-1]):Lt==17?(ct=3+Wc(r,A,7),A+=3):Lt==18&&(ct=11+Wc(r,A,127),A+=7);ct--;)J[ft++]=st}}var wt=J.subarray(0,k),yt=J.subarray(k);x=T2(wt),B=T2(yt),m=$l(wt,x,1),_=$l(yt,B,1)}else throw"invalid block type";else{var Lt=L2(A)+4,te=r[Lt-4]|r[Lt-3]<<8,Zt=Lt+te;if(Zt>n){if(s)throw"unexpected EOF";break}i&&a(f+te),t.set(r.subarray(Lt,Zt),f),e.b=f+=te,e.p=A=Zt*8;continue}if(A>P)throw"unexpected EOF"}i&&a(f+131072);for(var re=(1<<x)-1,Xt=(1<<B)-1,ne=x+B+18;s||A+ne<P;){var st=m[I2(r,A)&re],se=st>>>4;if(A+=st&15,A>P)throw"unexpected EOF";if(!st)throw"invalid length/literal";if(se<256)t[f++]=se;else if(se==256){m=null;break}else{var we=se-254;if(se>264){var ft=se-257,it=by[ft];we=Wc(r,A,(1<<it)-1)+r4[ft],A+=it}var vt=_[I2(r,A)&Xt],Ft=vt>>>4;if(!vt)throw"invalid distance";A+=vt&15;var yt=grt[Ft];if(Ft>3){var it=wy[Ft];yt+=I2(r,A)&(1<<it)-1,A+=it}if(A>P)throw"unexpected EOF";i&&a(f+131072);for(var Ot=f+we;f<Ot;f+=4)t[f]=t[f-yt],t[f+1]=t[f+1-yt],t[f+2]=t[f+2-yt],t[f+3]=t[f+3-yt];f=Ot}}e.l=m,e.p=A,e.b=f,m&&(o=1,e.m=x,e.d=_,e.n=B)}while(!o);return f==t.length?t:s4(t,0,f)},Qu=function(r,t,e){e<<=t&7;var n=t/8>>0;r[n]|=e,r[n+1]|=e>>>8},Og=function(r,t,e){e<<=t&7;var n=t/8>>0;r[n]|=e,r[n+1]|=e>>>8,r[n+2]|=e>>>16},F2=function(r,t){for(var e=[],n=0;n<r.length;++n)r[n]&&e.push({s:n,f:r[n]});var i=e.length,s=e.slice();if(!i)return[new Oo(0),0];if(i==1){var a=new Oo(e[0].s+1);return a[e[0].s]=1,[a,1]}e.sort(function(ft,pt){return ft.f-pt.f}),e.push({s:-1,f:25001});var o=e[0],A=e[1],f=0,m=1,_=2;for(e[0]={s:-1,f:o.f+A.f,l:o,r:A};m!=i-1;)o=e[e[f].f<e[_].f?f++:_++],A=e[f!=m&&e[f].f<e[_].f?f++:_++],e[m++]={s:-1,f:o.f+A.f,l:o,r:A};for(var x=s[0].s,n=1;n<i;++n)s[n].s>x&&(x=s[n].s);var B=new Do(x+1),P=P2(e[m-1],B,0);if(P>t){var n=0,M=0,k=P-t,Q=1<<k;for(s.sort(function(pt,mt){return B[mt.s]-B[pt.s]||pt.f-mt.f});n<i;++n){var q=s[n].s;if(B[q]>t)M+=Q-(1<<P-B[q]),B[q]=t;else break}for(M>>>=k;M>0;){var J=s[n].s;B[J]<t?M-=1<<t-B[J]++-1:++n}for(;n>=0&&M;--n){var tt=s[n].s;B[tt]==t&&(--B[tt],++M)}P=t}return[new Oo(B),P]},P2=function(r,t,e){return r.s==-1?Math.max(P2(r.l,t,e+1),P2(r.r,t,e+1)):t[r.s]=e},o4=function(r){for(var t=r.length;t&&!r[--t];);for(var e=new Do(++t),n=0,i=r[0],s=1,a=function(A){e[n++]=A},o=1;o<=t;++o)if(r[o]==i&&o!=t)++s;else{if(!i&&s>2){for(;s>138;s-=138)a(32754);s>2&&(a(s>10?s-11<<5|28690:s-3<<5|12305),s=0)}else if(s>3){for(a(i),--s;s>6;s-=6)a(8304);s>2&&(a(s-3<<5|8208),s=0)}for(;s--;)a(i);s=1,i=r[o]}return[e.subarray(0,n),t]},Dg=function(r,t){for(var e=0,n=0;n<t.length;++n)e+=r[n]*t[n];return e},xy=function(r,t,e){var n=e.length,i=L2(t+2);r[i]=n&255,r[i+1]=n>>>8,r[i+2]=r[i]^255,r[i+3]=r[i+1]^255;for(var s=0;s<n;++s)r[i+s+4]=e[s];return(i+4+n)*8},a4=function(r,t,e,n,i,s,a,o,A,f,m){Qu(t,m++,e),++i[256];for(var _=F2(i,15),x=_[0],B=_[1],P=F2(s,15),M=P[0],k=P[1],Q=o4(x),q=Q[0],J=Q[1],tt=o4(M),ft=tt[0],pt=tt[1],mt=new Do(19),dt=0;dt<q.length;++dt)mt[q[dt]&31]++;for(var dt=0;dt<ft.length;++dt)mt[ft[dt]&31]++;for(var Rt=F2(mt,7),Lt=Rt[0],st=Rt[1],ct=19;ct>4&&!Lt[C2[ct-1]];--ct);var wt=f+5<<3,yt=Dg(i,zA)+Dg(s,Rg)+a,te=Dg(i,x)+Dg(s,M)+a+14+3*ct+Dg(mt,Lt)+(2*mt[16]+3*mt[17]+7*mt[18]);if(wt<=yt&&wt<=te)return xy(t,m,r.subarray(A,A+f));var Zt,re,Xt,ne;if(Qu(t,m,1+(te<yt)),m+=2,te<yt){Zt=$l(x,B,0),re=x,Xt=$l(M,k,0),ne=M;var se=$l(Lt,st,0);Qu(t,m,J-257),Qu(t,m+5,pt-1),Qu(t,m+10,ct-4),m+=14;for(var dt=0;dt<ct;++dt)Qu(t,m+3*dt,Lt[C2[dt]]);m+=3*ct;for(var we=[q,ft],it=0;it<2;++it)for(var vt=we[it],dt=0;dt<vt.length;++dt){var Ft=vt[dt]&31;Qu(t,m,se[Ft]),m+=Lt[Ft],Ft>15&&(Qu(t,m,vt[dt]>>>5&127),m+=vt[dt]>>>12)}}else Zt=mrt,re=zA,Xt=_rt,ne=Rg;for(var dt=0;dt<o;++dt)if(n[dt]>255){var Ft=n[dt]>>>18&31;Og(t,m,Zt[Ft+257]),m+=re[Ft+257],Ft>7&&(Qu(t,m,n[dt]>>>23&31),m+=by[Ft]);var Ot=n[dt]&31;Og(t,m,Xt[Ot]),m+=ne[Ot],Ot>3&&(Og(t,m,n[dt]>>>5&8191),m+=wy[Ot])}else Og(t,m,Zt[n[dt]]),m+=re[n[dt]];return Og(t,m,Zt[256]),m+re[256]},wrt=new Ug([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),xrt=new Oo(0),Brt=function(r,t,e,n,i,s){var a=r.length,o=new Oo(n+a+5*(1+Math.floor(a/7e3))+i),A=o.subarray(n,o.length-i),f=0;if(!t||a<8)for(var m=0;m<=a;m+=65535){var _=m+65535;_<a?f=xy(A,f,r.subarray(m,_)):(A[m]=s,f=xy(A,f,r.subarray(m,a)))}else{for(var x=wrt[t-1],B=x>>>13,P=x&8191,M=(1<<e)-1,k=new Do(32768),Q=new Do(M+1),q=Math.ceil(e/3),J=2*q,tt=function(ze){return(r[ze]^r[ze+1]<<q^r[ze+2]<<J)&M},ft=new Ug(25e3),pt=new Do(288),mt=new Do(32),dt=0,Rt=0,m=0,Lt=0,st=0,ct=0;m<a;++m){var wt=tt(m),yt=m&32767,te=Q[wt];if(k[yt]=te,Q[wt]=yt,st<=m){var Zt=a-m;if((dt>7e3||Lt>24576)&&Zt>423){f=a4(r,A,0,ft,pt,mt,Rt,Lt,ct,m-ct,f),Lt=dt=Rt=0,ct=m;for(var re=0;re<286;++re)pt[re]=0;for(var re=0;re<30;++re)mt[re]=0}var Xt=2,ne=0,se=P,we=yt-te&32767;if(Zt>2&&wt==tt(m-we))for(var it=Math.min(B,Zt)-1,vt=Math.min(32767,m),Ft=Math.min(258,Zt);we<=vt&&--se&&yt!=te;){if(r[m+Xt]==r[m+Xt-we]){for(var Ot=0;Ot<Ft&&r[m+Ot]==r[m+Ot-we];++Ot);if(Ot>Xt){if(Xt=Ot,ne=we,Ot>it)break;for(var $t=Math.min(we,Ot-2),jt=0,re=0;re<$t;++re){var ae=m-we+re+32768&32767,ie=k[ae],Be=ae-ie+32768&32767;Be>jt&&(jt=Be,te=ae)}}}yt=te,te=k[yt],we+=yt-te+32768&32767}if(ne){ft[Lt++]=268435456|E2[Xt]<<18|i4[ne];var Ie=E2[Xt]&31,Qe=i4[ne]&31;Rt+=by[Ie]+wy[Qe],++pt[257+Ie],++mt[Qe],st=m+Xt,++dt}else ft[Lt++]=r[m],++pt[r[m]]}}f=a4(r,A,s,ft,pt,mt,Rt,Lt,ct,m-ct,f),s||(f=xy(A,f,xrt))}return s4(o,0,n+L2(f)+i)},Crt=function(){var r=1,t=0;return{p:function(e){for(var n=r,i=t,s=e.length,a=0;a!=s;){for(var o=Math.min(a+5552,s);a<o;++a)n+=e[a],i+=n;n%=65521,i%=65521}r=n,t=i},d:function(){return(r>>>8<<16|(t&255)<<8|t>>>8)+((r&255)<<23)*2}}},Ert=function(r,t,e,n,i){return Brt(r,t.level==null?6:t.level,t.mem==null?Math.ceil(Math.max(8,Math.min(13,Math.log(r.length)))*1.5):12+t.mem,e,n,!i)},Srt=function(r,t,e){for(;e;++t)r[t]=e,e>>>=8},Trt=function(r,t){var e=t.level,n=e==0?0:e<6?1:e==9?3:2;r[0]=120,r[1]=n<<6|(n?32-2*n:1)},Irt=function(r){if((r[0]&15)!=8||r[0]>>>4>7||(r[0]<<8|r[1])%31)throw"invalid zlib data";if(r[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function M2(r,t){t===void 0&&(t={});var e=Crt();e.p(r);var n=Ert(r,t,2,4);return Trt(n,t),Srt(n,n.length-4,e.d()),n}function Lrt(r,t){return brt((Irt(r),r.subarray(2,-4)),t)}/** @license
*
* jsPDF - PDF Document creation from JavaScript
* Version 2.5.1 Built on 2022-01-28T15:37:57.791Z
*                      CommitID 00000000
*
* Copyright (c) 2010-2021 James Hall <james@parall.ax>, https://github.com/MrRio/jsPDF
*               2015-2021 yWorks GmbH, http://www.yworks.com
*               2015-2021 Lukas Hollnder <lukas.hollaender@yworks.com>, https://github.com/HackbrettXXX
*               2016-2018 Aras Abbasi <aras.abbasi@gmail.com>
*               2010 Aaron Spike, https://github.com/acspike
*               2012 Willow Systems Corporation, https://github.com/willowsystems
*               2012 Pablo Hess, https://github.com/pablohess
*               2012 Florian Jenett, https://github.com/fjenett
*               2013 Warren Weckesser, https://github.com/warrenweckesser
*               2013 Youssef Beddad, https://github.com/lifof
*               2013 Lee Driscoll, https://github.com/lsdriscoll
*               2013 Stefan Slonevskiy, https://github.com/stefslon
*               2013 Jeremy Morel, https://github.com/jmorel
*               2013 Christoph Hartmann, https://github.com/chris-rock
*               2014 Juan Pablo Gaviria, https://github.com/juanpgaviria
*               2014 James Makes, https://github.com/dollaruw
*               2014 Diego Casorran, https://github.com/diegocr
*               2014 Steven Spungin, https://github.com/Flamenco
*               2014 Kenneth Glassey, https://github.com/Gavvers
*
* Permission is hereby granted, free of charge, to any person obtaining
* a copy of this software and associated documentation files (the
* "Software"), to deal in the Software without restriction, including
* without limitation the rights to use, copy, modify, merge, publish,
* distribute, sublicense, and/or sell copies of the Software, and to
* permit persons to whom the Software is furnished to do so, subject to
* the following conditions:
*
* The above copyright notice and this permission notice shall be
* included in all copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
* MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
* LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
* OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
* WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
*
* Contributor(s):
*    siefkenj, ahwolf, rickygu, Midnith, saintclair, eaparango,
*    kim3er, mfo, alnorth, Flamenco
*/var jr=function(){return typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:this}();function U2(){jr.console&&typeof jr.console.log=="function"&&jr.console.log.apply(jr.console,arguments)}var ui={log:U2,warn:function(r){jr.console&&(typeof jr.console.warn=="function"?jr.console.warn.apply(jr.console,arguments):U2.call(null,arguments))},error:function(r){jr.console&&(typeof jr.console.error=="function"?jr.console.error.apply(jr.console,arguments):U2(r))}};function R2(r,t,e){var n=new XMLHttpRequest;n.open("GET",r),n.responseType="blob",n.onload=function(){Wh(n.response,t,e)},n.onerror=function(){ui.error("could not download file")},n.send()}function c4(r){var t=new XMLHttpRequest;t.open("HEAD",r,!1);try{t.send()}catch{}return t.status>=200&&t.status<=299}function By(r){try{r.dispatchEvent(new MouseEvent("click"))}catch{var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),r.dispatchEvent(t)}}var Ng,O2,Wh=jr.saveAs||((typeof window>"u"?"undefined":kn(window))!=="object"||window!==jr?function(){}:typeof HTMLAnchorElement<"u"&&"download"in HTMLAnchorElement.prototype?function(r,t,e){var n=jr.URL||jr.webkitURL,i=document.createElement("a");t=t||r.name||"download",i.download=t,i.rel="noopener",typeof r=="string"?(i.href=r,i.origin!==location.origin?c4(i.href)?R2(r,t,e):By(i,i.target="_blank"):By(i)):(i.href=n.createObjectURL(r),setTimeout(function(){n.revokeObjectURL(i.href)},4e4),setTimeout(function(){By(i)},0))}:"msSaveOrOpenBlob"in navigator?function(r,t,e){if(t=t||r.name||"download",typeof r=="string")if(c4(r))R2(r,t,e);else{var n=document.createElement("a");n.href=r,n.target="_blank",setTimeout(function(){By(n)})}else navigator.msSaveOrOpenBlob(function(i,s){return s===void 0?s={autoBom:!1}:kn(s)!=="object"&&(ui.warn("Deprecated: Expected third argument to be a object"),s={autoBom:!s}),s.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(i.type)?new Blob(["\uFEFF",i],{type:i.type}):i}(r,e),t)}:function(r,t,e,n){if((n=n||open("","_blank"))&&(n.document.title=n.document.body.innerText="downloading..."),typeof r=="string")return R2(r,t,e);var i=r.type==="application/octet-stream",s=/constructor/i.test(jr.HTMLElement)||jr.safari,a=/CriOS\/[\d]+/.test(navigator.userAgent);if((a||i&&s)&&(typeof FileReader>"u"?"undefined":kn(FileReader))==="object"){var o=new FileReader;o.onloadend=function(){var m=o.result;m=a?m:m.replace(/^data:[^;]*;/,"data:attachment/file;"),n?n.location.href=m:location=m,n=null},o.readAsDataURL(r)}else{var A=jr.URL||jr.webkitURL,f=A.createObjectURL(r);n?n.location=f:location.href=f,n=null,setTimeout(function(){A.revokeObjectURL(f)},4e4)}});/**
* A class to parse color values
* @author Stoyan Stefanov <sstoo@gmail.com>
* {@link   http://www.phpied.com/rgb-color-parser-in-javascript/}
* @license Use it if you like it
*/function l4(r){var t;r=r||"",this.ok=!1,r.charAt(0)=="#"&&(r=r.substr(1,6)),r={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"}[r=(r=r.replace(/ /g,"")).toLowerCase()]||r;for(var e=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(o){return[parseInt(o[1]),parseInt(o[2]),parseInt(o[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(o){return[parseInt(o[1],16),parseInt(o[2],16),parseInt(o[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(o){return[parseInt(o[1]+o[1],16),parseInt(o[2]+o[2],16),parseInt(o[3]+o[3],16)]}}],n=0;n<e.length;n++){var i=e[n].re,s=e[n].process,a=i.exec(r);a&&(t=s(a),this.r=t[0],this.g=t[1],this.b=t[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var o=this.r.toString(16),A=this.g.toString(16),f=this.b.toString(16);return o.length==1&&(o="0"+o),A.length==1&&(A="0"+A),f.length==1&&(f="0"+f),"#"+o+A+f}}/**
* @license
* Joseph Myers does not specify a particular license for his work.
*
* Author: Joseph Myers
* Accessed from: http://www.myersdaily.org/joseph/javascript/md5.js
*
* Modified by: Owen Leong
*/function D2(r,t){var e=r[0],n=r[1],i=r[2],s=r[3];e=fo(e,n,i,s,t[0],7,-680876936),s=fo(s,e,n,i,t[1],12,-389564586),i=fo(i,s,e,n,t[2],17,606105819),n=fo(n,i,s,e,t[3],22,-1044525330),e=fo(e,n,i,s,t[4],7,-176418897),s=fo(s,e,n,i,t[5],12,1200080426),i=fo(i,s,e,n,t[6],17,-1473231341),n=fo(n,i,s,e,t[7],22,-45705983),e=fo(e,n,i,s,t[8],7,1770035416),s=fo(s,e,n,i,t[9],12,-1958414417),i=fo(i,s,e,n,t[10],17,-42063),n=fo(n,i,s,e,t[11],22,-1990404162),e=fo(e,n,i,s,t[12],7,1804603682),s=fo(s,e,n,i,t[13],12,-40341101),i=fo(i,s,e,n,t[14],17,-1502002290),e=po(e,n=fo(n,i,s,e,t[15],22,1236535329),i,s,t[1],5,-165796510),s=po(s,e,n,i,t[6],9,-1069501632),i=po(i,s,e,n,t[11],14,643717713),n=po(n,i,s,e,t[0],20,-373897302),e=po(e,n,i,s,t[5],5,-701558691),s=po(s,e,n,i,t[10],9,38016083),i=po(i,s,e,n,t[15],14,-660478335),n=po(n,i,s,e,t[4],20,-405537848),e=po(e,n,i,s,t[9],5,568446438),s=po(s,e,n,i,t[14],9,-1019803690),i=po(i,s,e,n,t[3],14,-187363961),n=po(n,i,s,e,t[8],20,1163531501),e=po(e,n,i,s,t[13],5,-1444681467),s=po(s,e,n,i,t[2],9,-51403784),i=po(i,s,e,n,t[7],14,1735328473),e=go(e,n=po(n,i,s,e,t[12],20,-1926607734),i,s,t[5],4,-378558),s=go(s,e,n,i,t[8],11,-2022574463),i=go(i,s,e,n,t[11],16,1839030562),n=go(n,i,s,e,t[14],23,-35309556),e=go(e,n,i,s,t[1],4,-1530992060),s=go(s,e,n,i,t[4],11,1272893353),i=go(i,s,e,n,t[7],16,-155497632),n=go(n,i,s,e,t[10],23,-1094730640),e=go(e,n,i,s,t[13],4,681279174),s=go(s,e,n,i,t[0],11,-358537222),i=go(i,s,e,n,t[3],16,-722521979),n=go(n,i,s,e,t[6],23,76029189),e=go(e,n,i,s,t[9],4,-640364487),s=go(s,e,n,i,t[12],11,-421815835),i=go(i,s,e,n,t[15],16,530742520),e=mo(e,n=go(n,i,s,e,t[2],23,-995338651),i,s,t[0],6,-198630844),s=mo(s,e,n,i,t[7],10,1126891415),i=mo(i,s,e,n,t[14],15,-1416354905),n=mo(n,i,s,e,t[5],21,-57434055),e=mo(e,n,i,s,t[12],6,1700485571),s=mo(s,e,n,i,t[3],10,-1894986606),i=mo(i,s,e,n,t[10],15,-1051523),n=mo(n,i,s,e,t[1],21,-2054922799),e=mo(e,n,i,s,t[8],6,1873313359),s=mo(s,e,n,i,t[15],10,-30611744),i=mo(i,s,e,n,t[6],15,-1560198380),n=mo(n,i,s,e,t[13],21,1309151649),e=mo(e,n,i,s,t[4],6,-145523070),s=mo(s,e,n,i,t[11],10,-1120210379),i=mo(i,s,e,n,t[2],15,718787259),n=mo(n,i,s,e,t[9],21,-343485551),r[0]=GA(e,r[0]),r[1]=GA(n,r[1]),r[2]=GA(i,r[2]),r[3]=GA(s,r[3])}function Cy(r,t,e,n,i,s){return t=GA(GA(t,r),GA(n,s)),GA(t<<i|t>>>32-i,e)}function fo(r,t,e,n,i,s,a){return Cy(t&e|~t&n,r,t,i,s,a)}function po(r,t,e,n,i,s,a){return Cy(t&n|e&~n,r,t,i,s,a)}function go(r,t,e,n,i,s,a){return Cy(t^e^n,r,t,i,s,a)}function mo(r,t,e,n,i,s,a){return Cy(e^(t|~n),r,t,i,s,a)}function u4(r){var t,e=r.length,n=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=r.length;t+=64)D2(n,Frt(r.substring(t-64,t)));r=r.substring(t-64);var i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<r.length;t++)i[t>>2]|=r.charCodeAt(t)<<(t%4<<3);if(i[t>>2]|=128<<(t%4<<3),t>55)for(D2(n,i),t=0;t<16;t++)i[t]=0;return i[14]=8*e,D2(n,i),n}function Frt(r){var t,e=[];for(t=0;t<64;t+=4)e[t>>2]=r.charCodeAt(t)+(r.charCodeAt(t+1)<<8)+(r.charCodeAt(t+2)<<16)+(r.charCodeAt(t+3)<<24);return e}Ng=jr.atob.bind(jr),O2=jr.btoa.bind(jr);var A4="0123456789abcdef".split("");function Prt(r){for(var t="",e=0;e<4;e++)t+=A4[r>>8*e+4&15]+A4[r>>8*e&15];return t}function Mrt(r){return String.fromCharCode((255&r)>>0,(65280&r)>>8,(16711680&r)>>16,(4278190080&r)>>24)}function N2(r){return u4(r).map(Mrt).join("")}var Urt=function(r){for(var t=0;t<r.length;t++)r[t]=Prt(r[t]);return r.join("")}(u4("hello"))!="5d41402abc4b2a76b9719d911017c592";function GA(r,t){if(Urt){var e=(65535&r)+(65535&t);return(r>>16)+(t>>16)+(e>>16)<<16|65535&e}return r+t&4294967295}/**
* @license
* FPDF is released under a permissive license: there is no usage restriction.
* You may embed it freely in your application (commercial or not), with or
* without modifications.
*
* Reference: http://www.fpdf.org/en/script/script37.php
*/function k2(r,t){var e,n,i,s;if(r!==e){for(var a=(i=r,s=1+(256/r.length>>0),new Array(s+1).join(i)),o=[],A=0;A<256;A++)o[A]=A;var f=0;for(A=0;A<256;A++){var m=o[A];f=(f+m+a.charCodeAt(A))%256,o[A]=o[f],o[f]=m}e=r,n=o}else o=n;var _=t.length,x=0,B=0,P="";for(A=0;A<_;A++)B=(B+(m=o[x=(x+1)%256]))%256,o[x]=o[B],o[B]=m,a=o[(o[x]+o[B])%256],P+=String.fromCharCode(t.charCodeAt(A)^a);return P}/**
* @license
* Licensed under the MIT License.
* http://opensource.org/licenses/mit-license
* Author: Owen Leong (@owenl131)
* Date: 15 Oct 2020
* References:
* https://www.cs.cmu.edu/~dst/Adobe/Gallery/anon21jul01-pdf-encryption.txt
* https://github.com/foliojs/pdfkit/blob/master/lib/security.js
* http://www.fpdf.org/en/script/script37.php
*/var h4={print:4,modify:8,copy:16,"annot-forms":32};function Bf(r,t,e,n){this.v=1,this.r=2;var i=192;r.forEach(function(o){if(h4.perm!==void 0)throw new Error("Invalid permission: "+o);i+=h4[o]}),this.padding="(N^NuAd\0NV\b..\0h>/\fdSiz";var s=(t+this.padding).substr(0,32),a=(e+this.padding).substr(0,32);this.O=this.processOwnerPassword(s,a),this.P=-(1+(255^i)),this.encryptionKey=N2(s+this.O+this.lsbFirstWord(this.P)+this.hexToBytes(n)).substr(0,5),this.U=k2(this.encryptionKey,this.padding)}function Cf(r){if(/[^\u0000-\u00ff]/.test(r))throw new Error("Invalid PDF Name Object: "+r+", Only accept ASCII characters.");for(var t="",e=r.length,n=0;n<e;n++){var i=r.charCodeAt(n);i<33||i===35||i===37||i===40||i===41||i===47||i===60||i===62||i===91||i===93||i===123||i===125||i>126?t+="#"+("0"+i.toString(16)).slice(-2):t+=r[n]}return t}function d4(r){if(kn(r)!=="object")throw new Error("Invalid Context passed to initialize PubSub (jsPDF-module)");var t={};this.subscribe=function(e,n,i){if(i=i||!1,typeof e!="string"||typeof n!="function"||typeof i!="boolean")throw new Error("Invalid arguments passed to PubSub.subscribe (jsPDF-module)");t.hasOwnProperty(e)||(t[e]={});var s=Math.random().toString(35);return t[e][s]=[n,!!i],s},this.unsubscribe=function(e){for(var n in t)if(t[n][e])return delete t[n][e],Object.keys(t[n]).length===0&&delete t[n],!0;return!1},this.publish=function(e){if(t.hasOwnProperty(e)){var n=Array.prototype.slice.call(arguments,1),i=[];for(var s in t[e]){var a=t[e][s];try{a[0].apply(r,n)}catch(o){jr.console&&ui.error("jsPDF PubSub Error",o.message,o)}a[1]&&i.push(s)}i.length&&i.forEach(this.unsubscribe)}},this.getTopics=function(){return t}}function Ey(r){if(!(this instanceof Ey))return new Ey(r);var t="opacity,stroke-opacity".split(",");for(var e in r)r.hasOwnProperty(e)&&t.indexOf(e)>=0&&(this[e]=r[e]);this.id="",this.objectNumber=-1}function f4(r,t){this.gState=r,this.matrix=t,this.id="",this.objectNumber=-1}function Xh(r,t,e,n,i){if(!(this instanceof Xh))return new Xh(r,t,e,n,i);this.type=r==="axial"?2:3,this.coords=t,this.colors=e,f4.call(this,n,i)}function Ef(r,t,e,n,i){if(!(this instanceof Ef))return new Ef(r,t,e,n,i);this.boundingBox=r,this.xStep=t,this.yStep=e,this.stream="",this.cloneIndex=0,f4.call(this,n,i)}function qr(r){var t,e=typeof arguments[0]=="string"?arguments[0]:"p",n=arguments[1],i=arguments[2],s=arguments[3],a=[],o=1,A=16,f="S",m=null;kn(r=r||{})==="object"&&(e=r.orientation,n=r.unit||n,i=r.format||i,s=r.compress||r.compressPdf||s,(m=r.encryption||null)!==null&&(m.userPassword=m.userPassword||"",m.ownerPassword=m.ownerPassword||"",m.userPermissions=m.userPermissions||[]),o=typeof r.userUnit=="number"?Math.abs(r.userUnit):1,r.precision!==void 0&&(t=r.precision),r.floatPrecision!==void 0&&(A=r.floatPrecision),f=r.defaultPathOperation||"S"),a=r.filters||(s===!0?["FlateEncode"]:a),n=n||"mm",e=(""+(e||"P")).toLowerCase();var _=r.putOnlyUsedFonts||!1,x={},B={internal:{},__private__:{}};B.__private__.PubSub=d4;var P="1.3",M=B.__private__.getPdfVersion=function(){return P};B.__private__.setPdfVersion=function(N){P=N};var k={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};B.__private__.getPageFormats=function(){return k};var Q=B.__private__.getPageFormat=function(N){return k[N]};i=i||"a4";var q={COMPAT:"compat",ADVANCED:"advanced"},J=q.COMPAT;function tt(){this.saveGraphicsState(),Ut(new St(De,0,0,-De,0,va()*De).toString()+" cm"),this.setFontSize(this.getFontSize()/De),f="n",J=q.ADVANCED}function ft(){this.restoreGraphicsState(),f="S",J=q.COMPAT}var pt=B.__private__.combineFontStyleAndFontWeight=function(N,et){if(N=="bold"&&et=="normal"||N=="bold"&&et==400||N=="normal"&&et=="italic"||N=="bold"&&et=="italic")throw new Error("Invalid Combination of fontweight and fontstyle");return et&&(N=et==400||et==="normal"?N==="italic"?"italic":"normal":et!=700&&et!=="bold"||N!=="normal"?(et==700?"bold":et)+""+N:"bold"),N};B.advancedAPI=function(N){var et=J===q.COMPAT;return et&&tt.call(this),typeof N!="function"||(N(this),et&&ft.call(this)),this},B.compatAPI=function(N){var et=J===q.ADVANCED;return et&&ft.call(this),typeof N!="function"||(N(this),et&&tt.call(this)),this},B.isAdvancedAPI=function(){return J===q.ADVANCED};var mt,dt=function(N){if(J!==q.ADVANCED)throw new Error(N+" is only available in 'advanced' API mode. You need to call advancedAPI() first.")},Rt=B.roundToPrecision=B.__private__.roundToPrecision=function(N,et){var Pt=t||et;if(isNaN(N)||isNaN(Pt))throw new Error("Invalid argument passed to jsPDF.roundToPrecision");return N.toFixed(Pt).replace(/0+$/,"")};mt=B.hpf=B.__private__.hpf=typeof A=="number"?function(N){if(isNaN(N))throw new Error("Invalid argument passed to jsPDF.hpf");return Rt(N,A)}:A==="smart"?function(N){if(isNaN(N))throw new Error("Invalid argument passed to jsPDF.hpf");return Rt(N,N>-1&&N<1?16:5)}:function(N){if(isNaN(N))throw new Error("Invalid argument passed to jsPDF.hpf");return Rt(N,16)};var Lt=B.f2=B.__private__.f2=function(N){if(isNaN(N))throw new Error("Invalid argument passed to jsPDF.f2");return Rt(N,2)},st=B.__private__.f3=function(N){if(isNaN(N))throw new Error("Invalid argument passed to jsPDF.f3");return Rt(N,3)},ct=B.scale=B.__private__.scale=function(N){if(isNaN(N))throw new Error("Invalid argument passed to jsPDF.scale");return J===q.COMPAT?N*De:J===q.ADVANCED?N:void 0},wt=function(N){return J===q.COMPAT?va()-N:J===q.ADVANCED?N:void 0},yt=function(N){return ct(wt(N))};B.__private__.setPrecision=B.setPrecision=function(N){typeof parseInt(N,10)=="number"&&(t=parseInt(N,10))};var te,Zt="00000000000000000000000000000000",re=B.__private__.getFileId=function(){return Zt},Xt=B.__private__.setFileId=function(N){return Zt=N!==void 0&&/^[a-fA-F0-9]{32}$/.test(N)?N.toUpperCase():Zt.split("").map(function(){return"ABCDEF0123456789".charAt(Math.floor(16*Math.random()))}).join(""),m!==null&&(Hn=new Bf(m.userPermissions,m.userPassword,m.ownerPassword,Zt)),Zt};B.setFileId=function(N){return Xt(N),this},B.getFileId=function(){return re()};var ne=B.__private__.convertDateToPDFDate=function(N){var et=N.getTimezoneOffset(),Pt=et<0?"+":"-",Vt=Math.floor(Math.abs(et/60)),oe=Math.abs(et%60),ce=[Pt,Ft(Vt),"'",Ft(oe),"'"].join("");return["D:",N.getFullYear(),Ft(N.getMonth()+1),Ft(N.getDate()),Ft(N.getHours()),Ft(N.getMinutes()),Ft(N.getSeconds()),ce].join("")},se=B.__private__.convertPDFDateToDate=function(N){var et=parseInt(N.substr(2,4),10),Pt=parseInt(N.substr(6,2),10)-1,Vt=parseInt(N.substr(8,2),10),oe=parseInt(N.substr(10,2),10),ce=parseInt(N.substr(12,2),10),Me=parseInt(N.substr(14,2),10);return new Date(et,Pt,Vt,oe,ce,Me,0)},we=B.__private__.setCreationDate=function(N){var et;if(N===void 0&&(N=new Date),N instanceof Date)et=ne(N);else{if(!/^D:(20[0-2][0-9]|203[0-7]|19[7-9][0-9])(0[0-9]|1[0-2])([0-2][0-9]|3[0-1])(0[0-9]|1[0-9]|2[0-3])(0[0-9]|[1-5][0-9])(0[0-9]|[1-5][0-9])(\+0[0-9]|\+1[0-4]|-0[0-9]|-1[0-1])'(0[0-9]|[1-5][0-9])'?$/.test(N))throw new Error("Invalid argument passed to jsPDF.setCreationDate");et=N}return te=et},it=B.__private__.getCreationDate=function(N){var et=te;return N==="jsDate"&&(et=se(te)),et};B.setCreationDate=function(N){return we(N),this},B.getCreationDate=function(N){return it(N)};var vt,Ft=B.__private__.padd2=function(N){return("0"+parseInt(N)).slice(-2)},Ot=B.__private__.padd2Hex=function(N){return("00"+(N=N.toString())).substr(N.length)},$t=0,jt=[],ae=[],ie=0,Be=[],Ie=[],Qe=!1,He=ae,ze=function(){$t=0,ie=0,ae=[],jt=[],Be=[],lr=Ve(),Ur=Ve()};B.__private__.setCustomOutputDestination=function(N){Qe=!0,He=N};var ge=function(N){Qe||(He=N)};B.__private__.resetCustomOutputDestination=function(){Qe=!1,He=ae};var Ut=B.__private__.out=function(N){return N=N.toString(),ie+=N.length+1,He.push(N),He},Jt=B.__private__.write=function(N){return Ut(arguments.length===1?N.toString():Array.prototype.join.call(arguments," "))},er=B.__private__.getArrayBuffer=function(N){for(var et=N.length,Pt=new ArrayBuffer(et),Vt=new Uint8Array(Pt);et--;)Vt[et]=N.charCodeAt(et);return Pt},Se=[["Helvetica","helvetica","normal","WinAnsiEncoding"],["Helvetica-Bold","helvetica","bold","WinAnsiEncoding"],["Helvetica-Oblique","helvetica","italic","WinAnsiEncoding"],["Helvetica-BoldOblique","helvetica","bolditalic","WinAnsiEncoding"],["Courier","courier","normal","WinAnsiEncoding"],["Courier-Bold","courier","bold","WinAnsiEncoding"],["Courier-Oblique","courier","italic","WinAnsiEncoding"],["Courier-BoldOblique","courier","bolditalic","WinAnsiEncoding"],["Times-Roman","times","normal","WinAnsiEncoding"],["Times-Bold","times","bold","WinAnsiEncoding"],["Times-Italic","times","italic","WinAnsiEncoding"],["Times-BoldItalic","times","bolditalic","WinAnsiEncoding"],["ZapfDingbats","zapfdingbats","normal",null],["Symbol","symbol","normal",null]];B.__private__.getStandardFonts=function(){return Se};var _e=r.fontSize||16;B.__private__.setFontSize=B.setFontSize=function(N){return _e=J===q.ADVANCED?N/De:N,this};var xe,Ne=B.__private__.getFontSize=B.getFontSize=function(){return J===q.COMPAT?_e:_e*De},ir=r.R2L||!1;B.__private__.setR2L=B.setR2L=function(N){return ir=N,this},B.__private__.getR2L=B.getR2L=function(){return ir};var Ar,Lr=B.__private__.setZoomMode=function(N){var et=[void 0,null,"fullwidth","fullheight","fullpage","original"];if(/^(?:\d+\.\d*|\d*\.\d+|\d+)%$/.test(N))xe=N;else if(isNaN(N)){if(et.indexOf(N)===-1)throw new Error('zoom must be Integer (e.g. 2), a percentage Value (e.g. 300%) or fullwidth, fullheight, fullpage, original. "'+N+'" is not recognized.');xe=N}else xe=parseInt(N,10)};B.__private__.getZoomMode=function(){return xe};var Tr,Nr=B.__private__.setPageMode=function(N){if([void 0,null,"UseNone","UseOutlines","UseThumbs","FullScreen"].indexOf(N)==-1)throw new Error('Page mode must be one of UseNone, UseOutlines, UseThumbs, or FullScreen. "'+N+'" is not recognized.');Ar=N};B.__private__.getPageMode=function(){return Ar};var Qr=B.__private__.setLayoutMode=function(N){if([void 0,null,"continuous","single","twoleft","tworight","two"].indexOf(N)==-1)throw new Error('Layout mode must be one of continuous, single, twoleft, tworight. "'+N+'" is not recognized.');Tr=N};B.__private__.getLayoutMode=function(){return Tr},B.__private__.setDisplayMode=B.setDisplayMode=function(N,et,Pt){return Lr(N),Qr(et),Nr(Pt),this};var fe={title:"",subject:"",author:"",keywords:"",creator:""};B.__private__.getDocumentProperty=function(N){if(Object.keys(fe).indexOf(N)===-1)throw new Error("Invalid argument passed to jsPDF.getDocumentProperty");return fe[N]},B.__private__.getDocumentProperties=function(){return fe},B.__private__.setDocumentProperties=B.setProperties=B.setDocumentProperties=function(N){for(var et in fe)fe.hasOwnProperty(et)&&N[et]&&(fe[et]=N[et]);return this},B.__private__.setDocumentProperty=function(N,et){if(Object.keys(fe).indexOf(N)===-1)throw new Error("Invalid arguments passed to jsPDF.setDocumentProperty");return fe[N]=et};var Ir,De,xn,Pr,Te,Je={},Ke={},Yr=[],Or={},gr={},an={},$r={},Ct=null,Z=0,Y=[],ot=new d4(B),Et=r.hotfixes||[],kt={},zt={},qt=[],St=function N(et,Pt,Vt,oe,ce,Me){if(!(this instanceof N))return new N(et,Pt,Vt,oe,ce,Me);isNaN(et)&&(et=1),isNaN(Pt)&&(Pt=0),isNaN(Vt)&&(Vt=0),isNaN(oe)&&(oe=1),isNaN(ce)&&(ce=0),isNaN(Me)&&(Me=0),this._matrix=[et,Pt,Vt,oe,ce,Me]};Object.defineProperty(St.prototype,"sx",{get:function(){return this._matrix[0]},set:function(N){this._matrix[0]=N}}),Object.defineProperty(St.prototype,"shy",{get:function(){return this._matrix[1]},set:function(N){this._matrix[1]=N}}),Object.defineProperty(St.prototype,"shx",{get:function(){return this._matrix[2]},set:function(N){this._matrix[2]=N}}),Object.defineProperty(St.prototype,"sy",{get:function(){return this._matrix[3]},set:function(N){this._matrix[3]=N}}),Object.defineProperty(St.prototype,"tx",{get:function(){return this._matrix[4]},set:function(N){this._matrix[4]=N}}),Object.defineProperty(St.prototype,"ty",{get:function(){return this._matrix[5]},set:function(N){this._matrix[5]=N}}),Object.defineProperty(St.prototype,"a",{get:function(){return this._matrix[0]},set:function(N){this._matrix[0]=N}}),Object.defineProperty(St.prototype,"b",{get:function(){return this._matrix[1]},set:function(N){this._matrix[1]=N}}),Object.defineProperty(St.prototype,"c",{get:function(){return this._matrix[2]},set:function(N){this._matrix[2]=N}}),Object.defineProperty(St.prototype,"d",{get:function(){return this._matrix[3]},set:function(N){this._matrix[3]=N}}),Object.defineProperty(St.prototype,"e",{get:function(){return this._matrix[4]},set:function(N){this._matrix[4]=N}}),Object.defineProperty(St.prototype,"f",{get:function(){return this._matrix[5]},set:function(N){this._matrix[5]=N}}),Object.defineProperty(St.prototype,"rotation",{get:function(){return Math.atan2(this.shx,this.sx)}}),Object.defineProperty(St.prototype,"scaleX",{get:function(){return this.decompose().scale.sx}}),Object.defineProperty(St.prototype,"scaleY",{get:function(){return this.decompose().scale.sy}}),Object.defineProperty(St.prototype,"isIdentity",{get:function(){return this.sx===1&&this.shy===0&&this.shx===0&&this.sy===1&&this.tx===0&&this.ty===0}}),St.prototype.join=function(N){return[this.sx,this.shy,this.shx,this.sy,this.tx,this.ty].map(mt).join(N)},St.prototype.multiply=function(N){var et=N.sx*this.sx+N.shy*this.shx,Pt=N.sx*this.shy+N.shy*this.sy,Vt=N.shx*this.sx+N.sy*this.shx,oe=N.shx*this.shy+N.sy*this.sy,ce=N.tx*this.sx+N.ty*this.shx+this.tx,Me=N.tx*this.shy+N.ty*this.sy+this.ty;return new St(et,Pt,Vt,oe,ce,Me)},St.prototype.decompose=function(){var N=this.sx,et=this.shy,Pt=this.shx,Vt=this.sy,oe=this.tx,ce=this.ty,Me=Math.sqrt(N*N+et*et),cr=(N/=Me)*Pt+(et/=Me)*Vt;Pt-=N*cr,Vt-=et*cr;var Mr=Math.sqrt(Pt*Pt+Vt*Vt);return cr/=Mr,N*(Vt/=Mr)<et*(Pt/=Mr)&&(N=-N,et=-et,cr=-cr,Me=-Me),{scale:new St(Me,0,0,Mr,0,0),translate:new St(1,0,0,1,oe,ce),rotate:new St(N,et,-et,N,0,0),skew:new St(1,0,cr,1,0,0)}},St.prototype.toString=function(N){return this.join(" ")},St.prototype.inversed=function(){var N=this.sx,et=this.shy,Pt=this.shx,Vt=this.sy,oe=this.tx,ce=this.ty,Me=1/(N*Vt-et*Pt),cr=Vt*Me,Mr=-et*Me,Gr=-Pt*Me,vr=N*Me;return new St(cr,Mr,Gr,vr,-cr*oe-Gr*ce,-Mr*oe-vr*ce)},St.prototype.applyToPoint=function(N){var et=N.x*this.sx+N.y*this.shx+this.tx,Pt=N.x*this.shy+N.y*this.sy+this.ty;return new lu(et,Pt)},St.prototype.applyToRectangle=function(N){var et=this.applyToPoint(N),Pt=this.applyToPoint(new lu(N.x+N.w,N.y+N.h));return new gl(et.x,et.y,Pt.x-et.x,Pt.y-et.y)},St.prototype.clone=function(){var N=this.sx,et=this.shy,Pt=this.shx,Vt=this.sy,oe=this.tx,ce=this.ty;return new St(N,et,Pt,Vt,oe,ce)},B.Matrix=St;var Yt=B.matrixMult=function(N,et){return et.multiply(N)},me=new St(1,0,0,1,0,0);B.unitMatrix=B.identityMatrix=me;var pe=function(N,et){if(!gr[N]){var Pt=(et instanceof Xh?"Sh":"P")+(Object.keys(Or).length+1).toString(10);et.id=Pt,gr[N]=Pt,Or[Pt]=et,ot.publish("addPattern",et)}};B.ShadingPattern=Xh,B.TilingPattern=Ef,B.addShadingPattern=function(N,et){return dt("addShadingPattern()"),pe(N,et),this},B.beginTilingPattern=function(N){dt("beginTilingPattern()"),uu(N.boundingBox[0],N.boundingBox[1],N.boundingBox[2]-N.boundingBox[0],N.boundingBox[3]-N.boundingBox[1],N.matrix)},B.endTilingPattern=function(N,et){dt("endTilingPattern()"),et.stream=Ie[vt].join(`
`),pe(N,et),ot.publish("endTilingPattern",et),qt.pop().restore()};var de=B.__private__.newObject=function(){var N=Ve();return Ye(N,!0),N},Ve=B.__private__.newObjectDeferred=function(){return $t++,jt[$t]=function(){return ie},$t},Ye=function(N,et){return et=typeof et=="boolean"&&et,jt[N]=ie,et&&Ut(N+" 0 obj"),N},Er=B.__private__.newAdditionalObject=function(){var N={objId:Ve(),content:""};return Be.push(N),N},lr=Ve(),Ur=Ve(),kr=B.__private__.decodeColorString=function(N){var et=N.split(" ");if(et.length!==2||et[1]!=="g"&&et[1]!=="G")et.length===5&&(et[4]==="k"||et[4]==="K")&&(et=[(1-et[0])*(1-et[3]),(1-et[1])*(1-et[3]),(1-et[2])*(1-et[3]),"r"]);else{var Pt=parseFloat(et[0]);et=[Pt,Pt,Pt,"r"]}for(var Vt="#",oe=0;oe<3;oe++)Vt+=("0"+Math.floor(255*parseFloat(et[oe])).toString(16)).slice(-2);return Vt},Hr=B.__private__.encodeColorString=function(N){var et;typeof N=="string"&&(N={ch1:N});var Pt=N.ch1,Vt=N.ch2,oe=N.ch3,ce=N.ch4,Me=N.pdfColorType==="draw"?["G","RG","K"]:["g","rg","k"];if(typeof Pt=="string"&&Pt.charAt(0)!=="#"){var cr=new l4(Pt);if(cr.ok)Pt=cr.toHex();else if(!/^\d*\.?\d*$/.test(Pt))throw new Error('Invalid color "'+Pt+'" passed to jsPDF.encodeColorString.')}if(typeof Pt=="string"&&/^#[0-9A-Fa-f]{3}$/.test(Pt)&&(Pt="#"+Pt[1]+Pt[1]+Pt[2]+Pt[2]+Pt[3]+Pt[3]),typeof Pt=="string"&&/^#[0-9A-Fa-f]{6}$/.test(Pt)){var Mr=parseInt(Pt.substr(1),16);Pt=Mr>>16&255,Vt=Mr>>8&255,oe=255&Mr}if(Vt===void 0||ce===void 0&&Pt===Vt&&Vt===oe)if(typeof Pt=="string")et=Pt+" "+Me[0];else switch(N.precision){case 2:et=Lt(Pt/255)+" "+Me[0];break;case 3:default:et=st(Pt/255)+" "+Me[0]}else if(ce===void 0||kn(ce)==="object"){if(ce&&!isNaN(ce.a)&&ce.a===0)return et=["1.","1.","1.",Me[1]].join(" ");if(typeof Pt=="string")et=[Pt,Vt,oe,Me[1]].join(" ");else switch(N.precision){case 2:et=[Lt(Pt/255),Lt(Vt/255),Lt(oe/255),Me[1]].join(" ");break;default:case 3:et=[st(Pt/255),st(Vt/255),st(oe/255),Me[1]].join(" ")}}else if(typeof Pt=="string")et=[Pt,Vt,oe,ce,Me[2]].join(" ");else switch(N.precision){case 2:et=[Lt(Pt),Lt(Vt),Lt(oe),Lt(ce),Me[2]].join(" ");break;case 3:default:et=[st(Pt),st(Vt),st(oe),st(ce),Me[2]].join(" ")}return et},mn=B.__private__.getFilters=function(){return a},mr=B.__private__.putStream=function(N){var et=(N=N||{}).data||"",Pt=N.filters||mn(),Vt=N.alreadyAppliedFilters||[],oe=N.addLength1||!1,ce=et.length,Me=N.objectId,cr=function(Xr){return Xr};if(m!==null&&Me===void 0)throw new Error("ObjectId must be passed to putStream for file encryption");m!==null&&(cr=Hn.encryptor(Me,0));var Mr={};Pt===!0&&(Pt=["FlateEncode"]);var Gr=N.additionalKeyValues||[],vr=(Mr=qr.API.processDataByFilters!==void 0?qr.API.processDataByFilters(et,Pt):{data:et,reverseChain:[]}).reverseChain+(Array.isArray(Vt)?Vt.join(" "):Vt.toString());if(Mr.data.length!==0&&(Gr.push({key:"Length",value:Mr.data.length}),oe===!0&&Gr.push({key:"Length1",value:ce})),vr.length!=0)if(vr.split("/").length-1==1)Gr.push({key:"Filter",value:vr});else{Gr.push({key:"Filter",value:"["+vr+"]"});for(var wn=0;wn<Gr.length;wn+=1)if(Gr[wn].key==="DecodeParms"){for(var br=[],hi=0;hi<Mr.reverseChain.split("/").length-1;hi+=1)br.push("null");br.push(Gr[wn].value),Gr[wn].value="["+br.join(" ")+"]"}}Ut("<<");for(var Kr=0;Kr<Gr.length;Kr++)Ut("/"+Gr[Kr].key+" "+Gr[Kr].value);Ut(">>"),Mr.data.length!==0&&(Ut("stream"),Ut(cr(Mr.data)),Ut("endstream"))},Wr=B.__private__.putPage=function(N){var et=N.number,Pt=N.data,Vt=N.objId,oe=N.contentsObjId;Ye(Vt,!0),Ut("<</Type /Page"),Ut("/Parent "+N.rootDictionaryObjId+" 0 R"),Ut("/Resources "+N.resourceDictionaryObjId+" 0 R"),Ut("/MediaBox ["+parseFloat(mt(N.mediaBox.bottomLeftX))+" "+parseFloat(mt(N.mediaBox.bottomLeftY))+" "+mt(N.mediaBox.topRightX)+" "+mt(N.mediaBox.topRightY)+"]"),N.cropBox!==null&&Ut("/CropBox ["+mt(N.cropBox.bottomLeftX)+" "+mt(N.cropBox.bottomLeftY)+" "+mt(N.cropBox.topRightX)+" "+mt(N.cropBox.topRightY)+"]"),N.bleedBox!==null&&Ut("/BleedBox ["+mt(N.bleedBox.bottomLeftX)+" "+mt(N.bleedBox.bottomLeftY)+" "+mt(N.bleedBox.topRightX)+" "+mt(N.bleedBox.topRightY)+"]"),N.trimBox!==null&&Ut("/TrimBox ["+mt(N.trimBox.bottomLeftX)+" "+mt(N.trimBox.bottomLeftY)+" "+mt(N.trimBox.topRightX)+" "+mt(N.trimBox.topRightY)+"]"),N.artBox!==null&&Ut("/ArtBox ["+mt(N.artBox.bottomLeftX)+" "+mt(N.artBox.bottomLeftY)+" "+mt(N.artBox.topRightX)+" "+mt(N.artBox.topRightY)+"]"),typeof N.userUnit=="number"&&N.userUnit!==1&&Ut("/UserUnit "+N.userUnit),ot.publish("putPage",{objId:Vt,pageContext:Y[et],pageNumber:et,page:Pt}),Ut("/Contents "+oe+" 0 R"),Ut(">>"),Ut("endobj");var ce=Pt.join(`
`);return J===q.ADVANCED&&(ce+=`
Q`),Ye(oe,!0),mr({data:ce,filters:mn(),objectId:oe}),Ut("endobj"),Vt},bn=B.__private__.putPages=function(){var N,et,Pt=[];for(N=1;N<=Z;N++)Y[N].objId=Ve(),Y[N].contentsObjId=Ve();for(N=1;N<=Z;N++)Pt.push(Wr({number:N,data:Ie[N],objId:Y[N].objId,contentsObjId:Y[N].contentsObjId,mediaBox:Y[N].mediaBox,cropBox:Y[N].cropBox,bleedBox:Y[N].bleedBox,trimBox:Y[N].trimBox,artBox:Y[N].artBox,userUnit:Y[N].userUnit,rootDictionaryObjId:lr,resourceDictionaryObjId:Ur}));Ye(lr,!0),Ut("<</Type /Pages");var Vt="/Kids [";for(et=0;et<Z;et++)Vt+=Pt[et]+" 0 R ";Ut(Vt+"]"),Ut("/Count "+Z),Ut(">>"),Ut("endobj"),ot.publish("postPutPages")},Qn=function(N){ot.publish("putFont",{font:N,out:Ut,newObject:de,putStream:mr}),N.isAlreadyPutted!==!0&&(N.objectNumber=de(),Ut("<<"),Ut("/Type /Font"),Ut("/BaseFont /"+Cf(N.postScriptName)),Ut("/Subtype /Type1"),typeof N.encoding=="string"&&Ut("/Encoding /"+N.encoding),Ut("/FirstChar 32"),Ut("/LastChar 255"),Ut(">>"),Ut("endobj"))},Dt=function(){for(var N in Je)Je.hasOwnProperty(N)&&(_===!1||_===!0&&x.hasOwnProperty(N))&&Qn(Je[N])},Re=function(N){N.objectNumber=de();var et=[];et.push({key:"Type",value:"/XObject"}),et.push({key:"Subtype",value:"/Form"}),et.push({key:"BBox",value:"["+[mt(N.x),mt(N.y),mt(N.x+N.width),mt(N.y+N.height)].join(" ")+"]"}),et.push({key:"Matrix",value:"["+N.matrix.toString()+"]"});var Pt=N.pages[1].join(`
`);mr({data:Pt,additionalKeyValues:et,objectId:N.objectNumber}),Ut("endobj")},Le=function(){for(var N in kt)kt.hasOwnProperty(N)&&Re(kt[N])},nn=function(N,et){var Pt,Vt=[],oe=1/(et-1);for(Pt=0;Pt<1;Pt+=oe)Vt.push(Pt);if(Vt.push(1),N[0].offset!=0){var ce={offset:0,color:N[0].color};N.unshift(ce)}if(N[N.length-1].offset!=1){var Me={offset:1,color:N[N.length-1].color};N.push(Me)}for(var cr="",Mr=0,Gr=0;Gr<Vt.length;Gr++){for(Pt=Vt[Gr];Pt>N[Mr+1].offset;)Mr++;var vr=N[Mr].offset,wn=(Pt-vr)/(N[Mr+1].offset-vr),br=N[Mr].color,hi=N[Mr+1].color;cr+=Ot(Math.round((1-wn)*br[0]+wn*hi[0]).toString(16))+Ot(Math.round((1-wn)*br[1]+wn*hi[1]).toString(16))+Ot(Math.round((1-wn)*br[2]+wn*hi[2]).toString(16))}return cr.trim()},Un=function(N,et){et||(et=21);var Pt=de(),Vt=nn(N.colors,et),oe=[];oe.push({key:"FunctionType",value:"0"}),oe.push({key:"Domain",value:"[0.0 1.0]"}),oe.push({key:"Size",value:"["+et+"]"}),oe.push({key:"BitsPerSample",value:"8"}),oe.push({key:"Range",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),oe.push({key:"Decode",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),mr({data:Vt,additionalKeyValues:oe,alreadyAppliedFilters:["/ASCIIHexDecode"],objectId:Pt}),Ut("endobj"),N.objectNumber=de(),Ut("<< /ShadingType "+N.type),Ut("/ColorSpace /DeviceRGB");var ce="/Coords ["+mt(parseFloat(N.coords[0]))+" "+mt(parseFloat(N.coords[1]))+" ";N.type===2?ce+=mt(parseFloat(N.coords[2]))+" "+mt(parseFloat(N.coords[3])):ce+=mt(parseFloat(N.coords[2]))+" "+mt(parseFloat(N.coords[3]))+" "+mt(parseFloat(N.coords[4]))+" "+mt(parseFloat(N.coords[5])),Ut(ce+="]"),N.matrix&&Ut("/Matrix ["+N.matrix.toString()+"]"),Ut("/Function "+Pt+" 0 R"),Ut("/Extend [true true]"),Ut(">>"),Ut("endobj")},Br=function(N,et){var Pt=Ve(),Vt=de();et.push({resourcesOid:Pt,objectOid:Vt}),N.objectNumber=Vt;var oe=[];oe.push({key:"Type",value:"/Pattern"}),oe.push({key:"PatternType",value:"1"}),oe.push({key:"PaintType",value:"1"}),oe.push({key:"TilingType",value:"1"}),oe.push({key:"BBox",value:"["+N.boundingBox.map(mt).join(" ")+"]"}),oe.push({key:"XStep",value:mt(N.xStep)}),oe.push({key:"YStep",value:mt(N.yStep)}),oe.push({key:"Resources",value:Pt+" 0 R"}),N.matrix&&oe.push({key:"Matrix",value:"["+N.matrix.toString()+"]"}),mr({data:N.stream,additionalKeyValues:oe,objectId:N.objectNumber}),Ut("endobj")},yn=function(N){var et;for(et in Or)Or.hasOwnProperty(et)&&(Or[et]instanceof Xh?Un(Or[et]):Or[et]instanceof Ef&&Br(Or[et],N))},xi=function(N){for(var et in N.objectNumber=de(),Ut("<<"),N)switch(et){case"opacity":Ut("/ca "+Lt(N[et]));break;case"stroke-opacity":Ut("/CA "+Lt(N[et]))}Ut(">>"),Ut("endobj")},_n=function(){var N;for(N in an)an.hasOwnProperty(N)&&xi(an[N])},sn=function(){for(var N in Ut("/XObject <<"),kt)kt.hasOwnProperty(N)&&kt[N].objectNumber>=0&&Ut("/"+N+" "+kt[N].objectNumber+" 0 R");ot.publish("putXobjectDict"),Ut(">>")},Bi=function(){Hn.oid=de(),Ut("<<"),Ut("/Filter /Standard"),Ut("/V "+Hn.v),Ut("/R "+Hn.r),Ut("/U <"+Hn.toHexString(Hn.U)+">"),Ut("/O <"+Hn.toHexString(Hn.O)+">"),Ut("/P "+Hn.P),Ut(">>"),Ut("endobj")},Yn=function(){for(var N in Ut("/Font <<"),Je)Je.hasOwnProperty(N)&&(_===!1||_===!0&&x.hasOwnProperty(N))&&Ut("/"+N+" "+Je[N].objectNumber+" 0 R");Ut(">>")},cs=function(){if(Object.keys(Or).length>0){for(var N in Ut("/Shading <<"),Or)Or.hasOwnProperty(N)&&Or[N]instanceof Xh&&Or[N].objectNumber>=0&&Ut("/"+N+" "+Or[N].objectNumber+" 0 R");ot.publish("putShadingPatternDict"),Ut(">>")}},Ns=function(N){if(Object.keys(Or).length>0){for(var et in Ut("/Pattern <<"),Or)Or.hasOwnProperty(et)&&Or[et]instanceof B.TilingPattern&&Or[et].objectNumber>=0&&Or[et].objectNumber<N&&Ut("/"+et+" "+Or[et].objectNumber+" 0 R");ot.publish("putTilingPatternDict"),Ut(">>")}},Vo=function(){if(Object.keys(an).length>0){var N;for(N in Ut("/ExtGState <<"),an)an.hasOwnProperty(N)&&an[N].objectNumber>=0&&Ut("/"+N+" "+an[N].objectNumber+" 0 R");ot.publish("putGStateDict"),Ut(">>")}},Dr=function(N){Ye(N.resourcesOid,!0),Ut("<<"),Ut("/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]"),Yn(),cs(),Ns(N.objectOid),Vo(),sn(),Ut(">>"),Ut("endobj")},Zs=function(){var N=[];Dt(),_n(),Le(),yn(N),ot.publish("putResources"),N.forEach(Dr),Dr({resourcesOid:Ur,objectOid:Number.MAX_SAFE_INTEGER}),ot.publish("postPutResources")},Ss=function(){ot.publish("putAdditionalObjects");for(var N=0;N<Be.length;N++){var et=Be[N];Ye(et.objId,!0),Ut(et.content),Ut("endobj")}ot.publish("postPutAdditionalObjects")},In=function(N){Ke[N.fontName]=Ke[N.fontName]||{},Ke[N.fontName][N.fontStyle]=N.id},wo=function(N,et,Pt,Vt,oe){var ce={id:"F"+(Object.keys(Je).length+1).toString(10),postScriptName:N,fontName:et,fontStyle:Pt,encoding:Vt,isStandardFont:oe||!1,metadata:{}};return ot.publish("addFont",{font:ce,instance:this}),Je[ce.id]=ce,In(ce),ce.id},Mi=function(N){for(var et=0,Pt=Se.length;et<Pt;et++){var Vt=wo.call(this,N[et][0],N[et][1],N[et][2],Se[et][3],!0);_===!1&&(x[Vt]=!0);var oe=N[et][0].split("-");In({id:Vt,fontName:oe[0],fontStyle:oe[1]||""})}ot.publish("addFonts",{fonts:Je,dictionary:Ke})},Ui=function(N){return N.foo=function(){try{return N.apply(this,arguments)}catch(Vt){var et=Vt.stack||"";~et.indexOf(" at ")&&(et=et.split(" at ")[1]);var Pt="Error in function "+et.split(`
`)[0].split("<")[0]+": "+Vt.message;if(!jr.console)throw new Error(Pt);jr.console.error(Pt,Vt),jr.alert&&alert(Pt)}},N.foo.bar=N,N.foo},Zn=function(N,et){var Pt,Vt,oe,ce,Me,cr,Mr,Gr,vr;if(oe=(et=et||{}).sourceEncoding||"Unicode",Me=et.outputEncoding,(et.autoencode||Me)&&Je[Ir].metadata&&Je[Ir].metadata[oe]&&Je[Ir].metadata[oe].encoding&&(ce=Je[Ir].metadata[oe].encoding,!Me&&Je[Ir].encoding&&(Me=Je[Ir].encoding),!Me&&ce.codePages&&(Me=ce.codePages[0]),typeof Me=="string"&&(Me=ce[Me]),Me)){for(Mr=!1,cr=[],Pt=0,Vt=N.length;Pt<Vt;Pt++)(Gr=Me[N.charCodeAt(Pt)])?cr.push(String.fromCharCode(Gr)):cr.push(N[Pt]),cr[Pt].charCodeAt(0)>>8&&(Mr=!0);N=cr.join("")}for(Pt=N.length;Mr===void 0&&Pt!==0;)N.charCodeAt(Pt-1)>>8&&(Mr=!0),Pt--;if(!Mr)return N;for(cr=et.noBOM?[]:[254,255],Pt=0,Vt=N.length;Pt<Vt;Pt++){if((vr=(Gr=N.charCodeAt(Pt))>>8)>>8)throw new Error("Character at position "+Pt+" of string '"+N+"' exceeds 16bits. Cannot be encoded into UCS-2 BE");cr.push(vr),cr.push(Gr-(vr<<8))}return String.fromCharCode.apply(void 0,cr)},Li=B.__private__.pdfEscape=B.pdfEscape=function(N,et){return Zn(N,et).replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},cn=B.__private__.beginPage=function(N){Ie[++Z]=[],Y[Z]={objId:0,contentsObjId:0,userUnit:Number(o),artBox:null,bleedBox:null,cropBox:null,trimBox:null,mediaBox:{bottomLeftX:0,bottomLeftY:0,topRightX:Number(N[0]),topRightY:Number(N[1])}},to(Z),ge(Ie[vt])},jo=function(N,et){var Pt,Vt,oe;switch(e=et||e,typeof N=="string"&&(Pt=Q(N.toLowerCase()),Array.isArray(Pt)&&(Vt=Pt[0],oe=Pt[1])),Array.isArray(N)&&(Vt=N[0]*De,oe=N[1]*De),isNaN(Vt)&&(Vt=i[0],oe=i[1]),(Vt>14400||oe>14400)&&(ui.warn("A page in a PDF can not be wider or taller than 14400 userUnit. jsPDF limits the width/height to 14400"),Vt=Math.min(14400,Vt),oe=Math.min(14400,oe)),i=[Vt,oe],e.substr(0,1)){case"l":oe>Vt&&(i=[oe,Vt]);break;case"p":Vt>oe&&(i=[oe,Vt])}cn(i),ln(Ri),Ut(ks),rA!==0&&Ut(rA+" J"),nA!==0&&Ut(nA+" j"),ot.publish("addPage",{pageNumber:Z})},qo=function(N){N>0&&N<=Z&&(Ie.splice(N,1),Y.splice(N,1),Z--,vt>Z&&(vt=Z),this.setPage(vt))},to=function(N){N>0&&N<=Z&&(vt=N)},mc=B.__private__.getNumberOfPages=B.getNumberOfPages=function(){return Ie.length-1},At=function(N,et,Pt){var Vt,oe=void 0;return Pt=Pt||{},N=N!==void 0?N:Je[Ir].fontName,et=et!==void 0?et:Je[Ir].fontStyle,Vt=N.toLowerCase(),Ke[Vt]!==void 0&&Ke[Vt][et]!==void 0?oe=Ke[Vt][et]:Ke[N]!==void 0&&Ke[N][et]!==void 0?oe=Ke[N][et]:Pt.disableWarning===!1&&ui.warn("Unable to look up font label for font '"+N+"', '"+et+"'. Refer to getFontList() for available fonts."),oe||Pt.noFallback||(oe=Ke.times[et])==null&&(oe=Ke.times.normal),oe},xt=B.__private__.putInfo=function(){var N=de(),et=function(Vt){return Vt};for(var Pt in m!==null&&(et=Hn.encryptor(N,0)),Ut("<<"),Ut("/Producer ("+Li(et("jsPDF "+qr.version))+")"),fe)fe.hasOwnProperty(Pt)&&fe[Pt]&&Ut("/"+Pt.substr(0,1).toUpperCase()+Pt.substr(1)+" ("+Li(et(fe[Pt]))+")");Ut("/CreationDate ("+Li(et(te))+")"),Ut(">>"),Ut("endobj")},Qt=B.__private__.putCatalog=function(N){var et=(N=N||{}).rootDictionaryObjId||lr;switch(de(),Ut("<<"),Ut("/Type /Catalog"),Ut("/Pages "+et+" 0 R"),xe||(xe="fullwidth"),xe){case"fullwidth":Ut("/OpenAction [3 0 R /FitH null]");break;case"fullheight":Ut("/OpenAction [3 0 R /FitV null]");break;case"fullpage":Ut("/OpenAction [3 0 R /Fit]");break;case"original":Ut("/OpenAction [3 0 R /XYZ null null 1]");break;default:var Pt=""+xe;Pt.substr(Pt.length-1)==="%"&&(xe=parseInt(xe)/100),typeof xe=="number"&&Ut("/OpenAction [3 0 R /XYZ null null "+Lt(xe)+"]")}switch(Tr||(Tr="continuous"),Tr){case"continuous":Ut("/PageLayout /OneColumn");break;case"single":Ut("/PageLayout /SinglePage");break;case"two":case"twoleft":Ut("/PageLayout /TwoColumnLeft");break;case"tworight":Ut("/PageLayout /TwoColumnRight")}Ar&&Ut("/PageMode /"+Ar),ot.publish("putCatalog"),Ut(">>"),Ut("endobj")},he=B.__private__.putTrailer=function(){Ut("trailer"),Ut("<<"),Ut("/Size "+($t+1)),Ut("/Root "+$t+" 0 R"),Ut("/Info "+($t-1)+" 0 R"),m!==null&&Ut("/Encrypt "+Hn.oid+" 0 R"),Ut("/ID [ <"+Zt+"> <"+Zt+"> ]"),Ut(">>")},Pe=B.__private__.putHeader=function(){Ut("%PDF-"+P),Ut("%")},sr=B.__private__.putXRef=function(){var N="0000000000";Ut("xref"),Ut("0 "+($t+1)),Ut("0000000000 65535 f ");for(var et=1;et<=$t;et++)typeof jt[et]=="function"?Ut((N+jt[et]()).slice(-10)+" 00000 n "):jt[et]!==void 0?Ut((N+jt[et]).slice(-10)+" 00000 n "):Ut("0000000000 00000 n ")},zr=B.__private__.buildDocument=function(){ze(),ge(ae),ot.publish("buildDocument"),Pe(),bn(),Ss(),Zs(),m!==null&&Bi(),xt(),Qt();var N=ie;return sr(),he(),Ut("startxref"),Ut(""+N),Ut("%%EOF"),ge(Ie[vt]),ae.join(`
`)},Wn=B.__private__.getBlob=function(N){return new Blob([er(N)],{type:"application/pdf"})},ti=B.output=B.__private__.output=Ui(function(N,et){switch(typeof(et=et||{})=="string"?et={filename:et}:et.filename=et.filename||"generated.pdf",N){case void 0:return zr();case"save":B.save(et.filename);break;case"arraybuffer":return er(zr());case"blob":return Wn(zr());case"bloburi":case"bloburl":if(jr.URL!==void 0&&typeof jr.URL.createObjectURL=="function")return jr.URL&&jr.URL.createObjectURL(Wn(zr()))||void 0;ui.warn("bloburl is not supported by your system, because URL.createObjectURL is not supported by your browser.");break;case"datauristring":case"dataurlstring":var Pt="",Vt=zr();try{Pt=O2(Vt)}catch{Pt=O2(unescape(encodeURIComponent(Vt)))}return"data:application/pdf;filename="+et.filename+";base64,"+Pt;case"pdfobjectnewwindow":if(Object.prototype.toString.call(jr)==="[object Window]"){var oe="https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.1.1/pdfobject.min.js",ce=' integrity="sha512-4ze/a9/4jqu+tX9dfOqJYSvyYd5M6qum/3HpCLr+/Jqf0whc37VUbkpNGHR7/8pSnCFw47T1fmIpwBV7UySh3g==" crossorigin="anonymous"';et.pdfObjectUrl&&(oe=et.pdfObjectUrl,ce="");var Me='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><script src="'+oe+'"'+ce+'><\/script><script >PDFObject.embed("'+this.output("dataurlstring")+'", '+JSON.stringify(et)+");<\/script></body></html>",cr=jr.open();return cr!==null&&cr.document.write(Me),cr}throw new Error("The option pdfobjectnewwindow just works in a browser-environment.");case"pdfjsnewwindow":if(Object.prototype.toString.call(jr)==="[object Window]"){var Mr='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe id="pdfViewer" src="'+(et.pdfJsUrl||"examples/PDF.js/web/viewer.html")+"?file=&downloadName="+et.filename+'" width="500px" height="400px" /></body></html>',Gr=jr.open();if(Gr!==null){Gr.document.write(Mr);var vr=this;Gr.document.documentElement.querySelector("#pdfViewer").onload=function(){Gr.document.title=et.filename,Gr.document.documentElement.querySelector("#pdfViewer").contentWindow.PDFViewerApplication.open(vr.output("bloburl"))}}return Gr}throw new Error("The option pdfjsnewwindow just works in a browser-environment.");case"dataurlnewwindow":if(Object.prototype.toString.call(jr)!=="[object Window]")throw new Error("The option dataurlnewwindow just works in a browser-environment.");var wn='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe src="'+this.output("datauristring",et)+'"></iframe></body></html>',br=jr.open();if(br!==null&&(br.document.write(wn),br.document.title=et.filename),br||typeof safari>"u")return br;break;case"datauri":case"dataurl":return jr.document.location.href=this.output("datauristring",et);default:return null}}),Ai=function(N){return Array.isArray(Et)===!0&&Et.indexOf(N)>-1};switch(n){case"pt":De=1;break;case"mm":De=72/25.4;break;case"cm":De=72/2.54;break;case"in":De=72;break;case"px":De=Ai("px_scaling")==1?.75:96/72;break;case"pc":case"em":De=12;break;case"ex":De=6;break;default:if(typeof n!="number")throw new Error("Invalid unit: "+n);De=n}var Hn=null;we(),Xt();var ah=function(N){return m!==null?Hn.encryptor(N,0):function(et){return et}},ul=B.__private__.getPageInfo=B.getPageInfo=function(N){if(isNaN(N)||N%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfo");return{objId:Y[N].objId,pageNumber:N,pageContext:Y[N]}},Vr=B.__private__.getPageInfoByObjId=function(N){if(isNaN(N)||N%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfoByObjId");for(var et in Y)if(Y[et].objId===N)break;return ul(et)},za=B.__private__.getCurrentPageInfo=B.getCurrentPageInfo=function(){return{objId:Y[vt].objId,pageNumber:vt,pageContext:Y[vt]}};B.addPage=function(){return jo.apply(this,arguments),this},B.setPage=function(){return to.apply(this,arguments),ge.call(this,Ie[vt]),this},B.insertPage=function(N){return this.addPage(),this.movePage(vt,N),this},B.movePage=function(N,et){var Pt,Vt;if(N>et){Pt=Ie[N],Vt=Y[N];for(var oe=N;oe>et;oe--)Ie[oe]=Ie[oe-1],Y[oe]=Y[oe-1];Ie[et]=Pt,Y[et]=Vt,this.setPage(et)}else if(N<et){Pt=Ie[N],Vt=Y[N];for(var ce=N;ce<et;ce++)Ie[ce]=Ie[ce+1],Y[ce]=Y[ce+1];Ie[et]=Pt,Y[et]=Vt,this.setPage(et)}return this},B.deletePage=function(){return qo.apply(this,arguments),this},B.__private__.text=B.text=function(N,et,Pt,Vt,oe){var ce,Me,cr,Mr,Gr,vr,wn,br,hi,Kr=(Vt=Vt||{}).scope||this;if(typeof N=="number"&&typeof et=="number"&&(typeof Pt=="string"||Array.isArray(Pt))){var Xr=Pt;Pt=et,et=N,N=Xr}if(arguments[3]instanceof St?(dt("The transform parameter of text() with a Matrix value"),hi=oe):(cr=arguments[4],Mr=arguments[5],kn(wn=arguments[3])==="object"&&wn!==null||(typeof cr=="string"&&(Mr=cr,cr=null),typeof wn=="string"&&(Mr=wn,wn=null),typeof wn=="number"&&(cr=wn,wn=null),Vt={flags:wn,angle:cr,align:Mr})),isNaN(et)||isNaN(Pt)||N==null)throw new Error("Invalid arguments passed to jsPDF.text");if(N.length===0)return Kr;var oi="",Qs=!1,Hs=typeof Vt.lineHeightFactor=="number"?Vt.lineHeightFactor:ya,ba=Kr.internal.scaleFactor;function ml(vn){return vn=vn.split("	").join(Array(Vt.TabLen||9).join(" ")),Li(vn,wn)}function Cc(vn){for(var Ln,Fn=vn.concat(),ei=[],$a=Fn.length;$a--;)typeof(Ln=Fn.shift())=="string"?ei.push(Ln):Array.isArray(vn)&&(Ln.length===1||Ln[1]===void 0&&Ln[2]===void 0)?ei.push(Ln[0]):ei.push([Ln[0],Ln[1],Ln[2]]);return ei}function Ec(vn,Ln){var Fn;if(typeof vn=="string")Fn=Ln(vn)[0];else if(Array.isArray(vn)){for(var ei,$a,Ca=vn.concat(),pu=[],Wa=Ca.length;Wa--;)typeof(ei=Ca.shift())=="string"?pu.push(Ln(ei)[0]):Array.isArray(ei)&&typeof ei[0]=="string"&&($a=Ln(ei[0],ei[1],ei[2]),pu.push([$a[0],$a[1],$a[2]]));Fn=pu}return Fn}var yl=!1,Sc=!0;if(typeof N=="string")yl=!0;else if(Array.isArray(N)){var hu=N.concat();Me=[];for(var ja,ls=hu.length;ls--;)(typeof(ja=hu.shift())!="string"||Array.isArray(ja)&&typeof ja[0]!="string")&&(Sc=!1);yl=Sc}if(yl===!1)throw new Error('Type of text must be string or Array. "'+N+'" is not recognized.');typeof N=="string"&&(N=N.match(/[\r?\n]/)?N.split(/\r\n|\r|\n/g):[N]);var Tc=_e/Kr.internal.scaleFactor,_l=Tc*(Hs-1);switch(Vt.baseline){case"bottom":Pt-=_l;break;case"top":Pt+=Tc-_l;break;case"hanging":Pt+=Tc-2*_l;break;case"middle":Pt+=Tc/2-_l}if((vr=Vt.maxWidth||0)>0&&(typeof N=="string"?N=Kr.splitTextToSize(N,vr):Object.prototype.toString.call(N)==="[object Array]"&&(N=N.reduce(function(vn,Ln){return vn.concat(Kr.splitTextToSize(Ln,vr))},[]))),ce={text:N,x:et,y:Pt,options:Vt,mutex:{pdfEscape:Li,activeFontKey:Ir,fonts:Je,activeFontSize:_e}},ot.publish("preProcessText",ce),N=ce.text,cr=(Vt=ce.options).angle,!(hi instanceof St)&&cr&&typeof cr=="number"){cr*=Math.PI/180,Vt.rotationDirection===0&&(cr=-cr),J===q.ADVANCED&&(cr=-cr);var vl=Math.cos(cr),Ic=Math.sin(cr);hi=new St(vl,Ic,-Ic,vl,0,0)}else cr&&cr instanceof St&&(hi=cr);J!==q.ADVANCED||hi||(hi=me),(Gr=Vt.charSpace||cu)!==void 0&&(oi+=mt(ct(Gr))+` Tc
`,this.setCharSpace(this.getCharSpace()||0)),(br=Vt.horizontalScale)!==void 0&&(oi+=mt(100*br)+` Tz
`),Vt.lang;var ws=-1,bd=Vt.renderingMode!==void 0?Vt.renderingMode:Vt.stroke,du=Kr.internal.getCurrentPageInfo().pageContext;switch(bd){case 0:case!1:case"fill":ws=0;break;case 1:case!0:case"stroke":ws=1;break;case 2:case"fillThenStroke":ws=2;break;case 3:case"invisible":ws=3;break;case 4:case"fillAndAddForClipping":ws=4;break;case 5:case"strokeAndAddPathForClipping":ws=5;break;case 6:case"fillThenStrokeAndAddToPathForClipping":ws=6;break;case 7:case"addToPathForClipping":ws=7}var Xn=du.usedRenderingMode!==void 0?du.usedRenderingMode:-1;ws!==-1?oi+=ws+` Tr
`:Xn!==-1&&(oi+=`0 Tr
`),ws!==-1&&(du.usedRenderingMode=ws),Mr=Vt.align||"left";var Ki,Oi=_e*Hs,sA=Kr.internal.pageSize.getWidth(),fu=Je[Ir];Gr=Vt.charSpace||cu,vr=Vt.maxWidth||0,wn=Object.assign({autoencode:!0,noBOM:!0},Vt.flags);var qa=[];if(Object.prototype.toString.call(N)==="[object Array]"){var Di;Me=Cc(N),Mr!=="left"&&(Ki=Me.map(function(vn){return Kr.getStringUnitWidth(vn,{font:fu,charSpace:Gr,fontSize:_e,doKerning:!1})*_e/ba}));var $i,eo=0;if(Mr==="right"){et-=Ki[0],N=[],ls=Me.length;for(var xo=0;xo<ls;xo++)xo===0?($i=Ko(et),Di=$o(Pt)):($i=ct(eo-Ki[xo]),Di=-Oi),N.push([Me[xo],$i,Di]),eo=Ki[xo]}else if(Mr==="center"){et-=Ki[0]/2,N=[],ls=Me.length;for(var Bo=0;Bo<ls;Bo++)Bo===0?($i=Ko(et),Di=$o(Pt)):($i=ct((eo-Ki[Bo])/2),Di=-Oi),N.push([Me[Bo],$i,Di]),eo=Ki[Bo]}else if(Mr==="left"){N=[],ls=Me.length;for(var Lc=0;Lc<ls;Lc++)N.push(Me[Lc])}else{if(Mr!=="justify")throw new Error('Unrecognized alignment option, use "left", "center", "right" or "justify".');N=[],ls=Me.length,vr=vr!==0?vr:sA;for(var ro=0;ro<ls;ro++)Di=ro===0?$o(Pt):-Oi,$i=ro===0?Ko(et):0,ro<ls-1?qa.push(mt(ct((vr-Ki[ro])/(Me[ro].split(" ").length-1)))):qa.push(0),N.push([Me[ro],$i,Di])}}var wa=typeof Vt.R2L=="boolean"?Vt.R2L:ir;wa===!0&&(N=Ec(N,function(vn,Ln,Fn){return[vn.split("").reverse().join(""),Ln,Fn]})),ce={text:N,x:et,y:Pt,options:Vt,mutex:{pdfEscape:Li,activeFontKey:Ir,fonts:Je,activeFontSize:_e}},ot.publish("postProcessText",ce),N=ce.text,Qs=ce.mutex.isHex||!1;var Jo=Je[Ir].encoding;Jo!=="WinAnsiEncoding"&&Jo!=="StandardEncoding"||(N=Ec(N,function(vn,Ln,Fn){return[ml(vn),Ln,Fn]})),Me=Cc(N),N=[];for(var Ka,Co,xa,Fc=0,Ba=1,Yo=Array.isArray(Me[0])?Ba:Fc,Ei="",zs=function(vn,Ln,Fn){var ei="";return Fn instanceof St?(Fn=typeof Vt.angle=="number"?Yt(Fn,new St(1,0,0,1,vn,Ln)):Yt(new St(1,0,0,1,vn,Ln),Fn),J===q.ADVANCED&&(Fn=Yt(new St(1,0,0,-1,0,0),Fn)),ei=Fn.join(" ")+` Tm
`):ei=mt(vn)+" "+mt(Ln)+` Td
`,ei},Gs=0;Gs<Me.length;Gs++){switch(Ei="",Yo){case Ba:xa=(Qs?"<":"(")+Me[Gs][0]+(Qs?">":")"),Ka=parseFloat(Me[Gs][1]),Co=parseFloat(Me[Gs][2]);break;case Fc:xa=(Qs?"<":"(")+Me[Gs]+(Qs?">":")"),Ka=Ko(et),Co=$o(Pt)}qa!==void 0&&qa[Gs]!==void 0&&(Ei=qa[Gs]+` Tw
`),Gs===0?N.push(Ei+zs(Ka,Co,hi)+xa):Yo===Fc?N.push(Ei+xa):Yo===Ba&&N.push(Ei+zs(Ka,Co,hi)+xa)}N=Yo===Fc?N.join(` Tj
T* `):N.join(` Tj
`),N+=` Tj
`;var Ni=`BT
/`;return Ni+=Ir+" "+_e+` Tf
`,Ni+=mt(_e*Hs)+` TL
`,Ni+=bc+`
`,Ni+=oi,Ni+=N,Ut(Ni+="ET"),x[Ir]=!0,Kr};var su=B.__private__.clip=B.clip=function(N){return Ut(N==="evenodd"?"W*":"W"),this};B.clipEvenOdd=function(){return su("evenodd")},B.__private__.discardPath=B.discardPath=function(){return Ut("n"),this};var vi=B.__private__.isValidStyle=function(N){var et=!1;return[void 0,null,"S","D","F","DF","FD","f","f*","B","B*","n"].indexOf(N)!==-1&&(et=!0),et};B.__private__.setDefaultPathOperation=B.setDefaultPathOperation=function(N){return vi(N)&&(f=N),this};var yc=B.__private__.getStyle=B.getStyle=function(N){var et=f;switch(N){case"D":case"S":et="S";break;case"F":et="f";break;case"FD":case"DF":et="B";break;case"f":case"f*":case"B":case"B*":et=N}return et},Al=B.close=function(){return Ut("h"),this};B.stroke=function(){return Ut("S"),this},B.fill=function(N){return ma("f",N),this},B.fillEvenOdd=function(N){return ma("f*",N),this},B.fillStroke=function(N){return ma("B",N),this},B.fillStrokeEvenOdd=function(N){return ma("B*",N),this};var ma=function(N,et){kn(et)==="object"?dl(et,N):Ut(N)},Ga=function(N){N===null||J===q.ADVANCED&&N===void 0||(N=yc(N),Ut(N))};function hl(N,et,Pt,Vt,oe){var ce=new Ef(et||this.boundingBox,Pt||this.xStep,Vt||this.yStep,this.gState,oe||this.matrix);ce.stream=this.stream;var Me=N+"$$"+this.cloneIndex+++"$$";return pe(Me,ce),ce}var dl=function(N,et){var Pt=gr[N.key],Vt=Or[Pt];if(Vt instanceof Xh)Ut("q"),Ut(_d(et)),Vt.gState&&B.setGState(Vt.gState),Ut(N.matrix.toString()+" cm"),Ut("/"+Pt+" sh"),Ut("Q");else if(Vt instanceof Ef){var oe=new St(1,0,0,-1,0,va());N.matrix&&(oe=oe.multiply(N.matrix||me),Pt=hl.call(Vt,N.key,N.boundingBox,N.xStep,N.yStep,oe).id),Ut("q"),Ut("/Pattern cs"),Ut("/"+Pt+" scn"),Vt.gState&&B.setGState(Vt.gState),Ut(et),Ut("Q")}},_d=function(N){switch(N){case"f":case"F":return"W n";case"f*":return"W* n";case"B":return"W S";case"B*":return"W* S";case"S":return"W S";case"n":return"W n"}},tA=B.moveTo=function(N,et){return Ut(mt(ct(N))+" "+mt(yt(et))+" m"),this},_c=B.lineTo=function(N,et){return Ut(mt(ct(N))+" "+mt(yt(et))+" l"),this},vc=B.curveTo=function(N,et,Pt,Vt,oe,ce){return Ut([mt(ct(N)),mt(yt(et)),mt(ct(Pt)),mt(yt(Vt)),mt(ct(oe)),mt(yt(ce)),"c"].join(" ")),this};B.__private__.line=B.line=function(N,et,Pt,Vt,oe){if(isNaN(N)||isNaN(et)||isNaN(Pt)||isNaN(Vt)||!vi(oe))throw new Error("Invalid arguments passed to jsPDF.line");return J===q.COMPAT?this.lines([[Pt-N,Vt-et]],N,et,[1,1],oe||"S"):this.lines([[Pt-N,Vt-et]],N,et,[1,1]).stroke()},B.__private__.lines=B.lines=function(N,et,Pt,Vt,oe,ce){var Me,cr,Mr,Gr,vr,wn,br,hi,Kr,Xr,oi,Qs;if(typeof N=="number"&&(Qs=Pt,Pt=et,et=N,N=Qs),Vt=Vt||[1,1],ce=ce||!1,isNaN(et)||isNaN(Pt)||!Array.isArray(N)||!Array.isArray(Vt)||!vi(oe)||typeof ce!="boolean")throw new Error("Invalid arguments passed to jsPDF.lines");for(tA(et,Pt),Me=Vt[0],cr=Vt[1],Gr=N.length,Xr=et,oi=Pt,Mr=0;Mr<Gr;Mr++)(vr=N[Mr]).length===2?(Xr=vr[0]*Me+Xr,oi=vr[1]*cr+oi,_c(Xr,oi)):(wn=vr[0]*Me+Xr,br=vr[1]*cr+oi,hi=vr[2]*Me+Xr,Kr=vr[3]*cr+oi,Xr=vr[4]*Me+Xr,oi=vr[5]*cr+oi,vc(wn,br,hi,Kr,Xr,oi));return ce&&Al(),Ga(oe),this},B.path=function(N){for(var et=0;et<N.length;et++){var Pt=N[et],Vt=Pt.c;switch(Pt.op){case"m":tA(Vt[0],Vt[1]);break;case"l":_c(Vt[0],Vt[1]);break;case"c":vc.apply(this,Vt);break;case"h":Al()}}return this},B.__private__.rect=B.rect=function(N,et,Pt,Vt,oe){if(isNaN(N)||isNaN(et)||isNaN(Pt)||isNaN(Vt)||!vi(oe))throw new Error("Invalid arguments passed to jsPDF.rect");return J===q.COMPAT&&(Vt=-Vt),Ut([mt(ct(N)),mt(yt(et)),mt(ct(Pt)),mt(ct(Vt)),"re"].join(" ")),Ga(oe),this},B.__private__.triangle=B.triangle=function(N,et,Pt,Vt,oe,ce,Me){if(isNaN(N)||isNaN(et)||isNaN(Pt)||isNaN(Vt)||isNaN(oe)||isNaN(ce)||!vi(Me))throw new Error("Invalid arguments passed to jsPDF.triangle");return this.lines([[Pt-N,Vt-et],[oe-Pt,ce-Vt],[N-oe,et-ce]],N,et,[1,1],Me,!0),this},B.__private__.roundedRect=B.roundedRect=function(N,et,Pt,Vt,oe,ce,Me){if(isNaN(N)||isNaN(et)||isNaN(Pt)||isNaN(Vt)||isNaN(oe)||isNaN(ce)||!vi(Me))throw new Error("Invalid arguments passed to jsPDF.roundedRect");var cr=4/3*(Math.SQRT2-1);return oe=Math.min(oe,.5*Pt),ce=Math.min(ce,.5*Vt),this.lines([[Pt-2*oe,0],[oe*cr,0,oe,ce-ce*cr,oe,ce],[0,Vt-2*ce],[0,ce*cr,-oe*cr,ce,-oe,ce],[2*oe-Pt,0],[-oe*cr,0,-oe,-ce*cr,-oe,-ce],[0,2*ce-Vt],[0,-ce*cr,oe*cr,-ce,oe,-ce]],N+oe,et,[1,1],Me,!0),this},B.__private__.ellipse=B.ellipse=function(N,et,Pt,Vt,oe){if(isNaN(N)||isNaN(et)||isNaN(Pt)||isNaN(Vt)||!vi(oe))throw new Error("Invalid arguments passed to jsPDF.ellipse");var ce=4/3*(Math.SQRT2-1)*Pt,Me=4/3*(Math.SQRT2-1)*Vt;return tA(N+Pt,et),vc(N+Pt,et-Me,N+ce,et-Vt,N,et-Vt),vc(N-ce,et-Vt,N-Pt,et-Me,N-Pt,et),vc(N-Pt,et+Me,N-ce,et+Vt,N,et+Vt),vc(N+ce,et+Vt,N+Pt,et+Me,N+Pt,et),Ga(oe),this},B.__private__.circle=B.circle=function(N,et,Pt,Vt){if(isNaN(N)||isNaN(et)||isNaN(Pt)||!vi(Vt))throw new Error("Invalid arguments passed to jsPDF.circle");return this.ellipse(N,et,Pt,Pt,Vt)},B.setFont=function(N,et,Pt){return Pt&&(et=pt(et,Pt)),Ir=At(N,et,{disableWarning:!1}),this};var Va=B.__private__.getFont=B.getFont=function(){return Je[At.apply(B,arguments)]};B.__private__.getFontList=B.getFontList=function(){var N,et,Pt={};for(N in Ke)if(Ke.hasOwnProperty(N))for(et in Pt[N]=[],Ke[N])Ke[N].hasOwnProperty(et)&&Pt[N].push(et);return Pt},B.addFont=function(N,et,Pt,Vt,oe){var ce=["StandardEncoding","MacRomanEncoding","Identity-H","WinAnsiEncoding"];return arguments[3]&&ce.indexOf(arguments[3])!==-1?oe=arguments[3]:arguments[3]&&ce.indexOf(arguments[3])==-1&&(Pt=pt(Pt,Vt)),oe=oe||"Identity-H",wo.call(this,N,et,Pt,oe)};var ya,Ri=r.lineWidth||.200025,Ci=B.__private__.getLineWidth=B.getLineWidth=function(){return Ri},ln=B.__private__.setLineWidth=B.setLineWidth=function(N){return Ri=N,Ut(mt(ct(N))+" w"),this};B.__private__.setLineDash=qr.API.setLineDash=qr.API.setLineDashPattern=function(N,et){if(N=N||[],et=et||0,isNaN(et)||!Array.isArray(N))throw new Error("Invalid arguments passed to jsPDF.setLineDash");return N=N.map(function(Pt){return mt(ct(Pt))}).join(" "),et=mt(ct(et)),Ut("["+N+"] "+et+" d"),this};var fl=B.__private__.getLineHeight=B.getLineHeight=function(){return _e*ya};B.__private__.getLineHeight=B.getLineHeight=function(){return _e*ya};var pl=B.__private__.setLineHeightFactor=B.setLineHeightFactor=function(N){return typeof(N=N||1.15)=="number"&&(ya=N),this},ou=B.__private__.getLineHeightFactor=B.getLineHeightFactor=function(){return ya};pl(r.lineHeight);var Ko=B.__private__.getHorizontalCoordinate=function(N){return ct(N)},$o=B.__private__.getVerticalCoordinate=function(N){return J===q.ADVANCED?N:Y[vt].mediaBox.topRightY-Y[vt].mediaBox.bottomLeftY-ct(N)},eA=B.__private__.getHorizontalCoordinateString=B.getHorizontalCoordinateString=function(N){return mt(Ko(N))},_a=B.__private__.getVerticalCoordinateString=B.getVerticalCoordinateString=function(N){return mt($o(N))},ks=r.strokeColor||"0 G";B.__private__.getStrokeColor=B.getDrawColor=function(){return kr(ks)},B.__private__.setStrokeColor=B.setDrawColor=function(N,et,Pt,Vt){return ks=Hr({ch1:N,ch2:et,ch3:Pt,ch4:Vt,pdfColorType:"draw",precision:2}),Ut(ks),this};var au=r.fillColor||"0 g";B.__private__.getFillColor=B.getFillColor=function(){return kr(au)},B.__private__.setFillColor=B.setFillColor=function(N,et,Pt,Vt){return au=Hr({ch1:N,ch2:et,ch3:Pt,ch4:Vt,pdfColorType:"fill",precision:2}),Ut(au),this};var bc=r.textColor||"0 g",wc=B.__private__.getTextColor=B.getTextColor=function(){return kr(bc)};B.__private__.setTextColor=B.setTextColor=function(N,et,Pt,Vt){return bc=Hr({ch1:N,ch2:et,ch3:Pt,ch4:Vt,pdfColorType:"text",precision:3}),this};var cu=r.charSpace,vd=B.__private__.getCharSpace=B.getCharSpace=function(){return parseFloat(cu||0)};B.__private__.setCharSpace=B.setCharSpace=function(N){if(isNaN(N))throw new Error("Invalid argument passed to jsPDF.setCharSpace");return cu=N,this};var rA=0;B.CapJoinStyles={0:0,butt:0,but:0,miter:0,1:1,round:1,rounded:1,circle:1,2:2,projecting:2,project:2,square:2,bevel:2},B.__private__.setLineCap=B.setLineCap=function(N){var et=B.CapJoinStyles[N];if(et===void 0)throw new Error("Line cap style of '"+N+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return rA=et,Ut(et+" J"),this};var nA=0;B.__private__.setLineJoin=B.setLineJoin=function(N){var et=B.CapJoinStyles[N];if(et===void 0)throw new Error("Line join style of '"+N+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return nA=et,Ut(et+" j"),this},B.__private__.setLineMiterLimit=B.__private__.setMiterLimit=B.setLineMiterLimit=B.setMiterLimit=function(N){if(N=N||0,isNaN(N))throw new Error("Invalid argument passed to jsPDF.setLineMiterLimit");return Ut(mt(ct(N))+" M"),this},B.GState=Ey,B.setGState=function(N){(N=typeof N=="string"?an[$r[N]]:ch(null,N)).equals(Ct)||(Ut("/"+N.id+" gs"),Ct=N)};var ch=function(N,et){if(!N||!$r[N]){var Pt=!1;for(var Vt in an)if(an.hasOwnProperty(Vt)&&an[Vt].equals(et)){Pt=!0;break}if(Pt)et=an[Vt];else{var oe="GS"+(Object.keys(an).length+1).toString(10);an[oe]=et,et.id=oe}return N&&($r[N]=et.id),ot.publish("addGState",et),et}};B.addGState=function(N,et){return ch(N,et),this},B.saveGraphicsState=function(){return Ut("q"),Yr.push({key:Ir,size:_e,color:bc}),this},B.restoreGraphicsState=function(){Ut("Q");var N=Yr.pop();return Ir=N.key,_e=N.size,bc=N.color,Ct=null,this},B.setCurrentTransformationMatrix=function(N){return Ut(N.toString()+" cm"),this},B.comment=function(N){return Ut("#"+N),this};var lu=function(N,et){var Pt=N||0;Object.defineProperty(this,"x",{enumerable:!0,get:function(){return Pt},set:function(ce){isNaN(ce)||(Pt=parseFloat(ce))}});var Vt=et||0;Object.defineProperty(this,"y",{enumerable:!0,get:function(){return Vt},set:function(ce){isNaN(ce)||(Vt=parseFloat(ce))}});var oe="pt";return Object.defineProperty(this,"type",{enumerable:!0,get:function(){return oe},set:function(ce){oe=ce.toString()}}),this},gl=function(N,et,Pt,Vt){lu.call(this,N,et),this.type="rect";var oe=Pt||0;Object.defineProperty(this,"w",{enumerable:!0,get:function(){return oe},set:function(Me){isNaN(Me)||(oe=parseFloat(Me))}});var ce=Vt||0;return Object.defineProperty(this,"h",{enumerable:!0,get:function(){return ce},set:function(Me){isNaN(Me)||(ce=parseFloat(Me))}}),this},xc=function(){this.page=Z,this.currentPage=vt,this.pages=Ie.slice(0),this.pagesContext=Y.slice(0),this.x=xn,this.y=Pr,this.matrix=Te,this.width=Bc(vt),this.height=va(vt),this.outputDestination=He,this.id="",this.objectNumber=-1};xc.prototype.restore=function(){Z=this.page,vt=this.currentPage,Y=this.pagesContext,Ie=this.pages,xn=this.x,Pr=this.y,Te=this.matrix,Au(vt,this.width),Xo(vt,this.height),He=this.outputDestination};var uu=function(N,et,Pt,Vt,oe){qt.push(new xc),Z=vt=0,Ie=[],xn=N,Pr=et,Te=oe,cn([Pt,Vt])},iA=function(N){if(zt[N])qt.pop().restore();else{var et=new xc,Pt="Xo"+(Object.keys(kt).length+1).toString(10);et.id=Pt,zt[N]=Pt,kt[Pt]=et,ot.publish("addFormObject",et),qt.pop().restore()}};for(var Wo in B.beginFormObject=function(N,et,Pt,Vt,oe){return uu(N,et,Pt,Vt,oe),this},B.endFormObject=function(N){return iA(N),this},B.doFormObject=function(N,et){var Pt=kt[zt[N]];return Ut("q"),Ut(et.toString()+" cm"),Ut("/"+Pt.id+" Do"),Ut("Q"),this},B.getFormObject=function(N){var et=kt[zt[N]];return{x:et.x,y:et.y,width:et.width,height:et.height,matrix:et.matrix}},B.save=function(N,et){return N=N||"generated.pdf",(et=et||{}).returnPromise=et.returnPromise||!1,et.returnPromise===!1?(Wh(Wn(zr()),N),typeof Wh.unload=="function"&&jr.setTimeout&&setTimeout(Wh.unload,911),this):new Promise(function(Pt,Vt){try{var oe=Wh(Wn(zr()),N);typeof Wh.unload=="function"&&jr.setTimeout&&setTimeout(Wh.unload,911),Pt(oe)}catch(ce){Vt(ce.message)}})},qr.API)qr.API.hasOwnProperty(Wo)&&(Wo==="events"&&qr.API.events.length?function(N,et){var Pt,Vt,oe;for(oe=et.length-1;oe!==-1;oe--)Pt=et[oe][0],Vt=et[oe][1],N.subscribe.apply(N,[Pt].concat(typeof Vt=="function"?[Vt]:Vt))}(ot,qr.API.events):B[Wo]=qr.API[Wo]);var Bc=B.getPageWidth=function(N){return(Y[N=N||vt].mediaBox.topRightX-Y[N].mediaBox.bottomLeftX)/De},Au=B.setPageWidth=function(N,et){Y[N].mediaBox.topRightX=et*De+Y[N].mediaBox.bottomLeftX},va=B.getPageHeight=function(N){return(Y[N=N||vt].mediaBox.topRightY-Y[N].mediaBox.bottomLeftY)/De},Xo=B.setPageHeight=function(N,et){Y[N].mediaBox.topRightY=et*De+Y[N].mediaBox.bottomLeftY};return B.internal={pdfEscape:Li,getStyle:yc,getFont:Va,getFontSize:Ne,getCharSpace:vd,getTextColor:wc,getLineHeight:fl,getLineHeightFactor:ou,getLineWidth:Ci,write:Jt,getHorizontalCoordinate:Ko,getVerticalCoordinate:$o,getCoordinateString:eA,getVerticalCoordinateString:_a,collections:{},newObject:de,newAdditionalObject:Er,newObjectDeferred:Ve,newObjectDeferredBegin:Ye,getFilters:mn,putStream:mr,events:ot,scaleFactor:De,pageSize:{getWidth:function(){return Bc(vt)},setWidth:function(N){Au(vt,N)},getHeight:function(){return va(vt)},setHeight:function(N){Xo(vt,N)}},encryptionOptions:m,encryption:Hn,getEncryptor:ah,output:ti,getNumberOfPages:mc,pages:Ie,out:Ut,f2:Lt,f3:st,getPageInfo:ul,getPageInfoByObjId:Vr,getCurrentPageInfo:za,getPDFVersion:M,Point:lu,Rectangle:gl,Matrix:St,hasHotfix:Ai},Object.defineProperty(B.internal.pageSize,"width",{get:function(){return Bc(vt)},set:function(N){Au(vt,N)},enumerable:!0,configurable:!0}),Object.defineProperty(B.internal.pageSize,"height",{get:function(){return va(vt)},set:function(N){Xo(vt,N)},enumerable:!0,configurable:!0}),Mi.call(B,Se),Ir="F1",jo(i,e),ot.publish("initialized"),B}Bf.prototype.lsbFirstWord=function(r){return String.fromCharCode(r>>0&255,r>>8&255,r>>16&255,r>>24&255)},Bf.prototype.toHexString=function(r){return r.split("").map(function(t){return("0"+(255&t.charCodeAt(0)).toString(16)).slice(-2)}).join("")},Bf.prototype.hexToBytes=function(r){for(var t=[],e=0;e<r.length;e+=2)t.push(String.fromCharCode(parseInt(r.substr(e,2),16)));return t.join("")},Bf.prototype.processOwnerPassword=function(r,t){return k2(N2(t).substr(0,5),r)},Bf.prototype.encryptor=function(r,t){var e=N2(this.encryptionKey+String.fromCharCode(255&r,r>>8&255,r>>16&255,255&t,t>>8&255)).substr(0,10);return function(n){return k2(e,n)}},Ey.prototype.equals=function(r){var t,e="id,objectNumber,equals";if(!r||kn(r)!==kn(this))return!1;var n=0;for(t in this)if(!(e.indexOf(t)>=0)){if(this.hasOwnProperty(t)&&!r.hasOwnProperty(t)||this[t]!==r[t])return!1;n++}for(t in r)r.hasOwnProperty(t)&&e.indexOf(t)<0&&n--;return n===0},qr.API={events:[]},qr.version="2.5.1";var Vi=qr.API,Q2=1,Jh=function(r){return r.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},Sf=function(r){return r.replace(/\\\\/g,"\\").replace(/\\\(/g,"(").replace(/\\\)/g,")")},Zr=function(r){return r.toFixed(2)},VA=function(r){return r.toFixed(5)};Vi.__acroform__={};var da=function(r,t){r.prototype=Object.create(t.prototype),r.prototype.constructor=r},p4=function(r){return r*Q2},Wl=function(r){var t=new m4,e=_r.internal.getHeight(r)||0,n=_r.internal.getWidth(r)||0;return t.BBox=[0,0,Number(Zr(n)),Number(Zr(e))],t},Rrt=Vi.__acroform__.setBit=function(r,t){if(r=r||0,t=t||0,isNaN(r)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBit");return r|=1<<t},Ort=Vi.__acroform__.clearBit=function(r,t){if(r=r||0,t=t||0,isNaN(r)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBit");return r&=~(1<<t)},Drt=Vi.__acroform__.getBit=function(r,t){if(isNaN(r)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBit");return r&1<<t?1:0},Zi=Vi.__acroform__.getBitForPdf=function(r,t){if(isNaN(r)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBitForPdf");return Drt(r,t-1)},ts=Vi.__acroform__.setBitForPdf=function(r,t){if(isNaN(r)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBitForPdf");return Rrt(r,t-1)},es=Vi.__acroform__.clearBitForPdf=function(r,t){if(isNaN(r)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBitForPdf");return Ort(r,t-1)},Nrt=Vi.__acroform__.calculateCoordinates=function(r,t){var e=t.internal.getHorizontalCoordinate,n=t.internal.getVerticalCoordinate,i=r[0],s=r[1],a=r[2],o=r[3],A={};return A.lowerLeft_X=e(i)||0,A.lowerLeft_Y=n(s+o)||0,A.upperRight_X=e(i+a)||0,A.upperRight_Y=n(s)||0,[Number(Zr(A.lowerLeft_X)),Number(Zr(A.lowerLeft_Y)),Number(Zr(A.upperRight_X)),Number(Zr(A.upperRight_Y))]},krt=function(r){if(r.appearanceStreamContent)return r.appearanceStreamContent;if(r.V||r.DV){var t=[],e=r._V||r.DV,n=H2(r,e),i=r.scope.internal.getFont(r.fontName,r.fontStyle).id;t.push("/Tx BMC"),t.push("q"),t.push("BT"),t.push(r.scope.__private__.encodeColorString(r.color)),t.push("/"+i+" "+Zr(n.fontSize)+" Tf"),t.push("1 0 0 1 0 0 Tm"),t.push(n.text),t.push("ET"),t.push("Q"),t.push("EMC");var s=Wl(r);return s.scope=r.scope,s.stream=t.join(`
`),s}},H2=function(r,t){var e=r.fontSize===0?r.maxFontSize:r.fontSize,n={text:"",fontSize:""},i=(t=(t=t.substr(0,1)=="("?t.substr(1):t).substr(t.length-1)==")"?t.substr(0,t.length-1):t).split(" ");i=r.multiline?i.map(function(st){return st.split(`
`)}):i.map(function(st){return[st]});var s=e,a=_r.internal.getHeight(r)||0;a=a<0?-a:a;var o=_r.internal.getWidth(r)||0;o=o<0?-o:o;var A=function(st,ct,wt){if(st+1<i.length){var yt=ct+" "+i[st+1][0];return Sy(yt,r,wt).width<=o-4}return!1};s++;t:for(;s>0;){t="",s--;var f,m,_=Sy("3",r,s).height,x=r.multiline?a-s:(a-_)/2,B=x+=2,P=0,M=0,k=0;if(s<=0){t=`(...) Tj
`,t+="% Width of Text: "+Sy(t,r,s=12).width+", FieldWidth:"+o+`
`;break}for(var Q="",q=0,J=0;J<i.length;J++)if(i.hasOwnProperty(J)){var tt=!1;if(i[J].length!==1&&k!==i[J].length-1){if((_+2)*(q+2)+2>a)continue t;Q+=i[J][k],tt=!0,M=J,J--}else{Q=(Q+=i[J][k]+" ").substr(Q.length-1)==" "?Q.substr(0,Q.length-1):Q;var ft=parseInt(J),pt=A(ft,Q,s),mt=J>=i.length-1;if(pt&&!mt){Q+=" ",k=0;continue}if(pt||mt){if(mt)M=ft;else if(r.multiline&&(_+2)*(q+2)+2>a)continue t}else{if(!r.multiline||(_+2)*(q+2)+2>a)continue t;M=ft}}for(var dt="",Rt=P;Rt<=M;Rt++){var Lt=i[Rt];if(r.multiline){if(Rt===M){dt+=Lt[k]+" ",k=(k+1)%Lt.length;continue}if(Rt===P){dt+=Lt[Lt.length-1]+" ";continue}}dt+=Lt[0]+" "}switch(dt=dt.substr(dt.length-1)==" "?dt.substr(0,dt.length-1):dt,m=Sy(dt,r,s).width,r.textAlign){case"right":f=o-m-2;break;case"center":f=(o-m)/2;break;case"left":default:f=2}t+=Zr(f)+" "+Zr(B)+` Td
`,t+="("+Jh(dt)+`) Tj
`,t+=-Zr(f)+` 0 Td
`,B=-(s+2),m=0,P=tt?M:M+1,q++,Q=""}break}return n.text=t,n.fontSize=s,n},Sy=function(r,t,e){var n=t.scope.internal.getFont(t.fontName,t.fontStyle),i=t.scope.getStringUnitWidth(r,{font:n,fontSize:parseFloat(e),charSpace:0})*parseFloat(e);return{height:t.scope.getStringUnitWidth("3",{font:n,fontSize:parseFloat(e),charSpace:0})*parseFloat(e)*1.5,width:i}},Qrt={fields:[],xForms:[],acroFormDictionaryRoot:null,printedOut:!1,internal:null,isInitialized:!1},Hrt=function(r,t){var e={type:"reference",object:r};t.internal.getPageInfo(r.page).pageContext.annotations.find(function(n){return n.type===e.type&&n.object===e.object})===void 0&&t.internal.getPageInfo(r.page).pageContext.annotations.push(e)},zrt=function(r,t){for(var e in r)if(r.hasOwnProperty(e)){var n=e,i=r[e];t.internal.newObjectDeferredBegin(i.objId,!0),kn(i)==="object"&&typeof i.putStream=="function"&&i.putStream(),delete r[n]}},Grt=function(r,t){if(t.scope=r,r.internal!==void 0&&(r.internal.acroformPlugin===void 0||r.internal.acroformPlugin.isInitialized===!1)){if(Xc.FieldNum=0,r.internal.acroformPlugin=JSON.parse(JSON.stringify(Qrt)),r.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("Exception while creating AcroformDictionary");Q2=r.internal.scaleFactor,r.internal.acroformPlugin.acroFormDictionaryRoot=new y4,r.internal.acroformPlugin.acroFormDictionaryRoot.scope=r,r.internal.acroformPlugin.acroFormDictionaryRoot._eventID=r.internal.events.subscribe("postPutResources",function(){(function(e){e.internal.events.unsubscribe(e.internal.acroformPlugin.acroFormDictionaryRoot._eventID),delete e.internal.acroformPlugin.acroFormDictionaryRoot._eventID,e.internal.acroformPlugin.printedOut=!0})(r)}),r.internal.events.subscribe("buildDocument",function(){(function(e){e.internal.acroformPlugin.acroFormDictionaryRoot.objId=void 0;var n=e.internal.acroformPlugin.acroFormDictionaryRoot.Fields;for(var i in n)if(n.hasOwnProperty(i)){var s=n[i];s.objId=void 0,s.hasAnnotation&&Hrt(s,e)}})(r)}),r.internal.events.subscribe("putCatalog",function(){(function(e){if(e.internal.acroformPlugin.acroFormDictionaryRoot===void 0)throw new Error("putCatalogCallback: Root missing.");e.internal.write("/AcroForm "+e.internal.acroformPlugin.acroFormDictionaryRoot.objId+" 0 R")})(r)}),r.internal.events.subscribe("postPutPages",function(e){(function(n,i){var s=!n;for(var a in n||(i.internal.newObjectDeferredBegin(i.internal.acroformPlugin.acroFormDictionaryRoot.objId,!0),i.internal.acroformPlugin.acroFormDictionaryRoot.putStream()),n=n||i.internal.acroformPlugin.acroFormDictionaryRoot.Kids)if(n.hasOwnProperty(a)){var o=n[a],A=[],f=o.Rect;if(o.Rect&&(o.Rect=Nrt(o.Rect,i)),i.internal.newObjectDeferredBegin(o.objId,!0),o.DA=_r.createDefaultAppearanceStream(o),kn(o)==="object"&&typeof o.getKeyValueListForStream=="function"&&(A=o.getKeyValueListForStream()),o.Rect=f,o.hasAppearanceStream&&!o.appearanceStreamContent){var m=krt(o);A.push({key:"AP",value:"<</N "+m+">>"}),i.internal.acroformPlugin.xForms.push(m)}if(o.appearanceStreamContent){var _="";for(var x in o.appearanceStreamContent)if(o.appearanceStreamContent.hasOwnProperty(x)){var B=o.appearanceStreamContent[x];if(_+="/"+x+" ",_+="<<",Object.keys(B).length>=1||Array.isArray(B)){for(var a in B)if(B.hasOwnProperty(a)){var P=B[a];typeof P=="function"&&(P=P.call(i,o)),_+="/"+a+" "+P+" ",i.internal.acroformPlugin.xForms.indexOf(P)>=0||i.internal.acroformPlugin.xForms.push(P)}}else typeof(P=B)=="function"&&(P=P.call(i,o)),_+="/"+a+" "+P,i.internal.acroformPlugin.xForms.indexOf(P)>=0||i.internal.acroformPlugin.xForms.push(P);_+=">>"}A.push({key:"AP",value:`<<
`+_+">>"})}i.internal.putStream({additionalKeyValues:A,objectId:o.objId}),i.internal.out("endobj")}s&&zrt(i.internal.acroformPlugin.xForms,i)})(e,r)}),r.internal.acroformPlugin.isInitialized=!0}},g4=Vi.__acroform__.arrayToPdfArray=function(r,t,e){var n=function(a){return a};if(Array.isArray(r)){for(var i="[",s=0;s<r.length;s++)switch(s!==0&&(i+=" "),kn(r[s])){case"boolean":case"number":case"object":i+=r[s].toString();break;case"string":r[s].substr(0,1)!=="/"?(t!==void 0&&e&&(n=e.internal.getEncryptor(t)),i+="("+Jh(n(r[s].toString()))+")"):i+=r[s].toString()}return i+="]"}throw new Error("Invalid argument passed to jsPDF.__acroform__.arrayToPdfArray")},z2=function(r,t,e){var n=function(i){return i};return t!==void 0&&e&&(n=e.internal.getEncryptor(t)),(r=r||"").toString(),r="("+Jh(n(r))+")"},Xl=function(){this._objId=void 0,this._scope=void 0,Object.defineProperty(this,"objId",{get:function(){if(this._objId===void 0){if(this.scope===void 0)return;this._objId=this.scope.internal.newObjectDeferred()}return this._objId},set:function(r){this._objId=r}}),Object.defineProperty(this,"scope",{value:this._scope,writable:!0})};Xl.prototype.toString=function(){return this.objId+" 0 R"},Xl.prototype.putStream=function(){var r=this.getKeyValueListForStream();this.scope.internal.putStream({data:this.stream,additionalKeyValues:r,objectId:this.objId}),this.scope.internal.out("endobj")},Xl.prototype.getKeyValueListForStream=function(){var r=[],t=Object.getOwnPropertyNames(this).filter(function(s){return s!="content"&&s!="appearanceStreamContent"&&s!="scope"&&s!="objId"&&s.substring(0,1)!="_"});for(var e in t)if(Object.getOwnPropertyDescriptor(this,t[e]).configurable===!1){var n=t[e],i=this[n];i&&(Array.isArray(i)?r.push({key:n,value:g4(i,this.objId,this.scope)}):i instanceof Xl?(i.scope=this.scope,r.push({key:n,value:i.objId+" 0 R"})):typeof i!="function"&&r.push({key:n,value:i}))}return r};var m4=function(){Xl.call(this),Object.defineProperty(this,"Type",{value:"/XObject",configurable:!1,writable:!0}),Object.defineProperty(this,"Subtype",{value:"/Form",configurable:!1,writable:!0}),Object.defineProperty(this,"FormType",{value:1,configurable:!1,writable:!0});var r,t=[];Object.defineProperty(this,"BBox",{configurable:!1,get:function(){return t},set:function(e){t=e}}),Object.defineProperty(this,"Resources",{value:"2 0 R",configurable:!1,writable:!0}),Object.defineProperty(this,"stream",{enumerable:!1,configurable:!0,set:function(e){r=e.trim()},get:function(){return r||null}})};da(m4,Xl);var y4=function(){Xl.call(this);var r,t=[];Object.defineProperty(this,"Kids",{enumerable:!1,configurable:!0,get:function(){return t.length>0?t:void 0}}),Object.defineProperty(this,"Fields",{enumerable:!1,configurable:!1,get:function(){return t}}),Object.defineProperty(this,"DA",{enumerable:!1,configurable:!1,get:function(){if(r){var e=function(n){return n};return this.scope&&(e=this.scope.internal.getEncryptor(this.objId)),"("+Jh(e(r))+")"}},set:function(e){r=e}})};da(y4,Xl);var Xc=function r(){Xl.call(this);var t=4;Object.defineProperty(this,"F",{enumerable:!1,configurable:!1,get:function(){return t},set:function(Q){if(isNaN(Q))throw new Error('Invalid value "'+Q+'" for attribute F supplied.');t=Q}}),Object.defineProperty(this,"showWhenPrinted",{enumerable:!0,configurable:!0,get:function(){return!!Zi(t,3)},set:function(Q){Q?this.F=ts(t,3):this.F=es(t,3)}});var e=0;Object.defineProperty(this,"Ff",{enumerable:!1,configurable:!1,get:function(){return e},set:function(Q){if(isNaN(Q))throw new Error('Invalid value "'+Q+'" for attribute Ff supplied.');e=Q}});var n=[];Object.defineProperty(this,"Rect",{enumerable:!1,configurable:!1,get:function(){if(n.length!==0)return n},set:function(Q){n=Q!==void 0?Q:[]}}),Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[0])?0:n[0]},set:function(Q){n[0]=Q}}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[1])?0:n[1]},set:function(Q){n[1]=Q}}),Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[2])?0:n[2]},set:function(Q){n[2]=Q}}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[3])?0:n[3]},set:function(Q){n[3]=Q}});var i="";Object.defineProperty(this,"FT",{enumerable:!0,configurable:!1,get:function(){return i},set:function(Q){switch(Q){case"/Btn":case"/Tx":case"/Ch":case"/Sig":i=Q;break;default:throw new Error('Invalid value "'+Q+'" for attribute FT supplied.')}}});var s=null;Object.defineProperty(this,"T",{enumerable:!0,configurable:!1,get:function(){if(!s||s.length<1){if(this instanceof Ly)return;s="FieldObject"+r.FieldNum++}var Q=function(q){return q};return this.scope&&(Q=this.scope.internal.getEncryptor(this.objId)),"("+Jh(Q(s))+")"},set:function(Q){s=Q.toString()}}),Object.defineProperty(this,"fieldName",{configurable:!0,enumerable:!0,get:function(){return s},set:function(Q){s=Q}});var a="helvetica";Object.defineProperty(this,"fontName",{enumerable:!0,configurable:!0,get:function(){return a},set:function(Q){a=Q}});var o="normal";Object.defineProperty(this,"fontStyle",{enumerable:!0,configurable:!0,get:function(){return o},set:function(Q){o=Q}});var A=0;Object.defineProperty(this,"fontSize",{enumerable:!0,configurable:!0,get:function(){return A},set:function(Q){A=Q}});var f=void 0;Object.defineProperty(this,"maxFontSize",{enumerable:!0,configurable:!0,get:function(){return f===void 0?50/Q2:f},set:function(Q){f=Q}});var m="black";Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,get:function(){return m},set:function(Q){m=Q}});var _="/F1 0 Tf 0 g";Object.defineProperty(this,"DA",{enumerable:!0,configurable:!1,get:function(){if(!(!_||this instanceof Ly||this instanceof Yh))return z2(_,this.objId,this.scope)},set:function(Q){Q=Q.toString(),_=Q}});var x=null;Object.defineProperty(this,"DV",{enumerable:!1,configurable:!1,get:function(){if(x)return this instanceof Rs?x:z2(x,this.objId,this.scope)},set:function(Q){Q=Q.toString(),x=this instanceof Rs?Q:Q.substr(0,1)==="("?Sf(Q.substr(1,Q.length-2)):Sf(Q)}}),Object.defineProperty(this,"defaultValue",{enumerable:!0,configurable:!0,get:function(){return this instanceof Rs?Sf(x.substr(1,x.length-1)):x},set:function(Q){Q=Q.toString(),x=this instanceof Rs?"/"+Q:Q}});var B=null;Object.defineProperty(this,"_V",{enumerable:!1,configurable:!1,get:function(){if(B)return B},set:function(Q){this.V=Q}}),Object.defineProperty(this,"V",{enumerable:!1,configurable:!1,get:function(){if(B)return this instanceof Rs?B:z2(B,this.objId,this.scope)},set:function(Q){Q=Q.toString(),B=this instanceof Rs?Q:Q.substr(0,1)==="("?Sf(Q.substr(1,Q.length-2)):Sf(Q)}}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,get:function(){return this instanceof Rs?Sf(B.substr(1,B.length-1)):B},set:function(Q){Q=Q.toString(),B=this instanceof Rs?"/"+Q:Q}}),Object.defineProperty(this,"hasAnnotation",{enumerable:!0,configurable:!0,get:function(){return this.Rect}}),Object.defineProperty(this,"Type",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Annot":null}}),Object.defineProperty(this,"Subtype",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Widget":null}});var P,M=!1;Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return M},set:function(Q){Q=!!Q,M=Q}}),Object.defineProperty(this,"page",{enumerable:!0,configurable:!0,get:function(){if(P)return P},set:function(Q){P=Q}}),Object.defineProperty(this,"readOnly",{enumerable:!0,configurable:!0,get:function(){return!!Zi(this.Ff,1)},set:function(Q){Q?this.Ff=ts(this.Ff,1):this.Ff=es(this.Ff,1)}}),Object.defineProperty(this,"required",{enumerable:!0,configurable:!0,get:function(){return!!Zi(this.Ff,2)},set:function(Q){Q?this.Ff=ts(this.Ff,2):this.Ff=es(this.Ff,2)}}),Object.defineProperty(this,"noExport",{enumerable:!0,configurable:!0,get:function(){return!!Zi(this.Ff,3)},set:function(Q){Q?this.Ff=ts(this.Ff,3):this.Ff=es(this.Ff,3)}});var k=null;Object.defineProperty(this,"Q",{enumerable:!0,configurable:!1,get:function(){if(k!==null)return k},set:function(Q){if([0,1,2].indexOf(Q)===-1)throw new Error('Invalid value "'+Q+'" for attribute Q supplied.');k=Q}}),Object.defineProperty(this,"textAlign",{get:function(){var Q;switch(k){case 0:default:Q="left";break;case 1:Q="center";break;case 2:Q="right"}return Q},configurable:!0,enumerable:!0,set:function(Q){switch(Q){case"right":case 2:k=2;break;case"center":case 1:k=1;break;case"left":case 0:default:k=0}}})};da(Xc,Xl);var Tf=function(){Xc.call(this),this.FT="/Ch",this.V="()",this.fontName="zapfdingbats";var r=0;Object.defineProperty(this,"TI",{enumerable:!0,configurable:!1,get:function(){return r},set:function(e){r=e}}),Object.defineProperty(this,"topIndex",{enumerable:!0,configurable:!0,get:function(){return r},set:function(e){r=e}});var t=[];Object.defineProperty(this,"Opt",{enumerable:!0,configurable:!1,get:function(){return g4(t,this.objId,this.scope)},set:function(e){var n,i;i=[],typeof(n=e)=="string"&&(i=function(s,a,o){o||(o=1);for(var A,f=[];A=a.exec(s);)f.push(A[o]);return f}(n,/\((.*?)\)/g)),t=i}}),this.getOptions=function(){return t},this.setOptions=function(e){t=e,this.sort&&t.sort()},this.addOption=function(e){e=(e=e||"").toString(),t.push(e),this.sort&&t.sort()},this.removeOption=function(e,n){for(n=n||!1,e=(e=e||"").toString();t.indexOf(e)!==-1&&(t.splice(t.indexOf(e),1),n!==!1););},Object.defineProperty(this,"combo",{enumerable:!0,configurable:!0,get:function(){return!!Zi(this.Ff,18)},set:function(e){e?this.Ff=ts(this.Ff,18):this.Ff=es(this.Ff,18)}}),Object.defineProperty(this,"edit",{enumerable:!0,configurable:!0,get:function(){return!!Zi(this.Ff,19)},set:function(e){this.combo===!0&&(e?this.Ff=ts(this.Ff,19):this.Ff=es(this.Ff,19))}}),Object.defineProperty(this,"sort",{enumerable:!0,configurable:!0,get:function(){return!!Zi(this.Ff,20)},set:function(e){e?(this.Ff=ts(this.Ff,20),t.sort()):this.Ff=es(this.Ff,20)}}),Object.defineProperty(this,"multiSelect",{enumerable:!0,configurable:!0,get:function(){return!!Zi(this.Ff,22)},set:function(e){e?this.Ff=ts(this.Ff,22):this.Ff=es(this.Ff,22)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!Zi(this.Ff,23)},set:function(e){e?this.Ff=ts(this.Ff,23):this.Ff=es(this.Ff,23)}}),Object.defineProperty(this,"commitOnSelChange",{enumerable:!0,configurable:!0,get:function(){return!!Zi(this.Ff,27)},set:function(e){e?this.Ff=ts(this.Ff,27):this.Ff=es(this.Ff,27)}}),this.hasAppearanceStream=!1};da(Tf,Xc);var If=function(){Tf.call(this),this.fontName="helvetica",this.combo=!1};da(If,Tf);var Lf=function(){If.call(this),this.combo=!0};da(Lf,If);var Ty=function(){Lf.call(this),this.edit=!0};da(Ty,Lf);var Rs=function(){Xc.call(this),this.FT="/Btn",Object.defineProperty(this,"noToggleToOff",{enumerable:!0,configurable:!0,get:function(){return!!Zi(this.Ff,15)},set:function(e){e?this.Ff=ts(this.Ff,15):this.Ff=es(this.Ff,15)}}),Object.defineProperty(this,"radio",{enumerable:!0,configurable:!0,get:function(){return!!Zi(this.Ff,16)},set:function(e){e?this.Ff=ts(this.Ff,16):this.Ff=es(this.Ff,16)}}),Object.defineProperty(this,"pushButton",{enumerable:!0,configurable:!0,get:function(){return!!Zi(this.Ff,17)},set:function(e){e?this.Ff=ts(this.Ff,17):this.Ff=es(this.Ff,17)}}),Object.defineProperty(this,"radioIsUnison",{enumerable:!0,configurable:!0,get:function(){return!!Zi(this.Ff,26)},set:function(e){e?this.Ff=ts(this.Ff,26):this.Ff=es(this.Ff,26)}});var r,t={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var e=function(s){return s};if(this.scope&&(e=this.scope.internal.getEncryptor(this.objId)),Object.keys(t).length!==0){var n,i=[];for(n in i.push("<<"),t)i.push("/"+n+" ("+Jh(e(t[n]))+")");return i.push(">>"),i.join(`
`)}},set:function(e){kn(e)==="object"&&(t=e)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return t.CA||""},set:function(e){typeof e=="string"&&(t.CA=e)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return r},set:function(e){r=e}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return r.substr(1,r.length-1)},set:function(e){r="/"+e}})};da(Rs,Xc);var Iy=function(){Rs.call(this),this.pushButton=!0};da(Iy,Rs);var Ff=function(){Rs.call(this),this.radio=!0,this.pushButton=!1;var r=[];Object.defineProperty(this,"Kids",{enumerable:!0,configurable:!1,get:function(){return r},set:function(t){r=t!==void 0?t:[]}})};da(Ff,Rs);var Ly=function(){var r,t;Xc.call(this),Object.defineProperty(this,"Parent",{enumerable:!1,configurable:!1,get:function(){return r},set:function(i){r=i}}),Object.defineProperty(this,"optionName",{enumerable:!1,configurable:!0,get:function(){return t},set:function(i){t=i}});var e,n={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var i=function(o){return o};this.scope&&(i=this.scope.internal.getEncryptor(this.objId));var s,a=[];for(s in a.push("<<"),n)a.push("/"+s+" ("+Jh(i(n[s]))+")");return a.push(">>"),a.join(`
`)},set:function(i){kn(i)==="object"&&(n=i)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return n.CA||""},set:function(i){typeof i=="string"&&(n.CA=i)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return e},set:function(i){e=i}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return e.substr(1,e.length-1)},set:function(i){e="/"+i}}),this.caption="l",this.appearanceState="Off",this._AppearanceType=_r.RadioButton.Circle,this.appearanceStreamContent=this._AppearanceType.createAppearanceStream(this.optionName)};da(Ly,Xc),Ff.prototype.setAppearance=function(r){if(!("createAppearanceStream"in r)||!("getCA"in r))throw new Error("Couldn't assign Appearance to RadioButton. Appearance was Invalid!");for(var t in this.Kids)if(this.Kids.hasOwnProperty(t)){var e=this.Kids[t];e.appearanceStreamContent=r.createAppearanceStream(e.optionName),e.caption=r.getCA()}},Ff.prototype.createOption=function(r){var t=new Ly;return t.Parent=this,t.optionName=r,this.Kids.push(t),Vrt.call(this.scope,t),t};var Fy=function(){Rs.call(this),this.fontName="zapfdingbats",this.caption="3",this.appearanceState="On",this.value="On",this.textAlign="center",this.appearanceStreamContent=_r.CheckBox.createAppearanceStream()};da(Fy,Rs);var Yh=function(){Xc.call(this),this.FT="/Tx",Object.defineProperty(this,"multiline",{enumerable:!0,configurable:!0,get:function(){return!!Zi(this.Ff,13)},set:function(t){t?this.Ff=ts(this.Ff,13):this.Ff=es(this.Ff,13)}}),Object.defineProperty(this,"fileSelect",{enumerable:!0,configurable:!0,get:function(){return!!Zi(this.Ff,21)},set:function(t){t?this.Ff=ts(this.Ff,21):this.Ff=es(this.Ff,21)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!Zi(this.Ff,23)},set:function(t){t?this.Ff=ts(this.Ff,23):this.Ff=es(this.Ff,23)}}),Object.defineProperty(this,"doNotScroll",{enumerable:!0,configurable:!0,get:function(){return!!Zi(this.Ff,24)},set:function(t){t?this.Ff=ts(this.Ff,24):this.Ff=es(this.Ff,24)}}),Object.defineProperty(this,"comb",{enumerable:!0,configurable:!0,get:function(){return!!Zi(this.Ff,25)},set:function(t){t?this.Ff=ts(this.Ff,25):this.Ff=es(this.Ff,25)}}),Object.defineProperty(this,"richText",{enumerable:!0,configurable:!0,get:function(){return!!Zi(this.Ff,26)},set:function(t){t?this.Ff=ts(this.Ff,26):this.Ff=es(this.Ff,26)}});var r=null;Object.defineProperty(this,"MaxLen",{enumerable:!0,configurable:!1,get:function(){return r},set:function(t){r=t}}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,get:function(){return r},set:function(t){Number.isInteger(t)&&(r=t)}}),Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return this.V||this.DV}})};da(Yh,Xc);var Py=function(){Yh.call(this),Object.defineProperty(this,"password",{enumerable:!0,configurable:!0,get:function(){return!!Zi(this.Ff,14)},set:function(r){r?this.Ff=ts(this.Ff,14):this.Ff=es(this.Ff,14)}}),this.password=!0};da(Py,Yh);var _r={CheckBox:{createAppearanceStream:function(){return{N:{On:_r.CheckBox.YesNormal},D:{On:_r.CheckBox.YesPushDown,Off:_r.CheckBox.OffPushDown}}},YesPushDown:function(r){var t=Wl(r);t.scope=r.scope;var e=[],n=r.scope.internal.getFont(r.fontName,r.fontStyle).id,i=r.scope.__private__.encodeColorString(r.color),s=H2(r,r.caption);return e.push("0.749023 g"),e.push("0 0 "+Zr(_r.internal.getWidth(r))+" "+Zr(_r.internal.getHeight(r))+" re"),e.push("f"),e.push("BMC"),e.push("q"),e.push("0 0 1 rg"),e.push("/"+n+" "+Zr(s.fontSize)+" Tf "+i),e.push("BT"),e.push(s.text),e.push("ET"),e.push("Q"),e.push("EMC"),t.stream=e.join(`
`),t},YesNormal:function(r){var t=Wl(r);t.scope=r.scope;var e=r.scope.internal.getFont(r.fontName,r.fontStyle).id,n=r.scope.__private__.encodeColorString(r.color),i=[],s=_r.internal.getHeight(r),a=_r.internal.getWidth(r),o=H2(r,r.caption);return i.push("1 g"),i.push("0 0 "+Zr(a)+" "+Zr(s)+" re"),i.push("f"),i.push("q"),i.push("0 0 1 rg"),i.push("0 0 "+Zr(a-1)+" "+Zr(s-1)+" re"),i.push("W"),i.push("n"),i.push("0 g"),i.push("BT"),i.push("/"+e+" "+Zr(o.fontSize)+" Tf "+n),i.push(o.text),i.push("ET"),i.push("Q"),t.stream=i.join(`
`),t},OffPushDown:function(r){var t=Wl(r);t.scope=r.scope;var e=[];return e.push("0.749023 g"),e.push("0 0 "+Zr(_r.internal.getWidth(r))+" "+Zr(_r.internal.getHeight(r))+" re"),e.push("f"),t.stream=e.join(`
`),t}},RadioButton:{Circle:{createAppearanceStream:function(r){var t={D:{Off:_r.RadioButton.Circle.OffPushDown},N:{}};return t.N[r]=_r.RadioButton.Circle.YesNormal,t.D[r]=_r.RadioButton.Circle.YesPushDown,t},getCA:function(){return"l"},YesNormal:function(r){var t=Wl(r);t.scope=r.scope;var e=[],n=_r.internal.getWidth(r)<=_r.internal.getHeight(r)?_r.internal.getWidth(r)/4:_r.internal.getHeight(r)/4;n=Number((.9*n).toFixed(5));var i=_r.internal.Bezier_C,s=Number((n*i).toFixed(5));return e.push("q"),e.push("1 0 0 1 "+VA(_r.internal.getWidth(r)/2)+" "+VA(_r.internal.getHeight(r)/2)+" cm"),e.push(n+" 0 m"),e.push(n+" "+s+" "+s+" "+n+" 0 "+n+" c"),e.push("-"+s+" "+n+" -"+n+" "+s+" -"+n+" 0 c"),e.push("-"+n+" -"+s+" -"+s+" -"+n+" 0 -"+n+" c"),e.push(s+" -"+n+" "+n+" -"+s+" "+n+" 0 c"),e.push("f"),e.push("Q"),t.stream=e.join(`
`),t},YesPushDown:function(r){var t=Wl(r);t.scope=r.scope;var e=[],n=_r.internal.getWidth(r)<=_r.internal.getHeight(r)?_r.internal.getWidth(r)/4:_r.internal.getHeight(r)/4;n=Number((.9*n).toFixed(5));var i=Number((2*n).toFixed(5)),s=Number((i*_r.internal.Bezier_C).toFixed(5)),a=Number((n*_r.internal.Bezier_C).toFixed(5));return e.push("0.749023 g"),e.push("q"),e.push("1 0 0 1 "+VA(_r.internal.getWidth(r)/2)+" "+VA(_r.internal.getHeight(r)/2)+" cm"),e.push(i+" 0 m"),e.push(i+" "+s+" "+s+" "+i+" 0 "+i+" c"),e.push("-"+s+" "+i+" -"+i+" "+s+" -"+i+" 0 c"),e.push("-"+i+" -"+s+" -"+s+" -"+i+" 0 -"+i+" c"),e.push(s+" -"+i+" "+i+" -"+s+" "+i+" 0 c"),e.push("f"),e.push("Q"),e.push("0 g"),e.push("q"),e.push("1 0 0 1 "+VA(_r.internal.getWidth(r)/2)+" "+VA(_r.internal.getHeight(r)/2)+" cm"),e.push(n+" 0 m"),e.push(n+" "+a+" "+a+" "+n+" 0 "+n+" c"),e.push("-"+a+" "+n+" -"+n+" "+a+" -"+n+" 0 c"),e.push("-"+n+" -"+a+" -"+a+" -"+n+" 0 -"+n+" c"),e.push(a+" -"+n+" "+n+" -"+a+" "+n+" 0 c"),e.push("f"),e.push("Q"),t.stream=e.join(`
`),t},OffPushDown:function(r){var t=Wl(r);t.scope=r.scope;var e=[],n=_r.internal.getWidth(r)<=_r.internal.getHeight(r)?_r.internal.getWidth(r)/4:_r.internal.getHeight(r)/4;n=Number((.9*n).toFixed(5));var i=Number((2*n).toFixed(5)),s=Number((i*_r.internal.Bezier_C).toFixed(5));return e.push("0.749023 g"),e.push("q"),e.push("1 0 0 1 "+VA(_r.internal.getWidth(r)/2)+" "+VA(_r.internal.getHeight(r)/2)+" cm"),e.push(i+" 0 m"),e.push(i+" "+s+" "+s+" "+i+" 0 "+i+" c"),e.push("-"+s+" "+i+" -"+i+" "+s+" -"+i+" 0 c"),e.push("-"+i+" -"+s+" -"+s+" -"+i+" 0 -"+i+" c"),e.push(s+" -"+i+" "+i+" -"+s+" "+i+" 0 c"),e.push("f"),e.push("Q"),t.stream=e.join(`
`),t}},Cross:{createAppearanceStream:function(r){var t={D:{Off:_r.RadioButton.Cross.OffPushDown},N:{}};return t.N[r]=_r.RadioButton.Cross.YesNormal,t.D[r]=_r.RadioButton.Cross.YesPushDown,t},getCA:function(){return"8"},YesNormal:function(r){var t=Wl(r);t.scope=r.scope;var e=[],n=_r.internal.calculateCross(r);return e.push("q"),e.push("1 1 "+Zr(_r.internal.getWidth(r)-2)+" "+Zr(_r.internal.getHeight(r)-2)+" re"),e.push("W"),e.push("n"),e.push(Zr(n.x1.x)+" "+Zr(n.x1.y)+" m"),e.push(Zr(n.x2.x)+" "+Zr(n.x2.y)+" l"),e.push(Zr(n.x4.x)+" "+Zr(n.x4.y)+" m"),e.push(Zr(n.x3.x)+" "+Zr(n.x3.y)+" l"),e.push("s"),e.push("Q"),t.stream=e.join(`
`),t},YesPushDown:function(r){var t=Wl(r);t.scope=r.scope;var e=_r.internal.calculateCross(r),n=[];return n.push("0.749023 g"),n.push("0 0 "+Zr(_r.internal.getWidth(r))+" "+Zr(_r.internal.getHeight(r))+" re"),n.push("f"),n.push("q"),n.push("1 1 "+Zr(_r.internal.getWidth(r)-2)+" "+Zr(_r.internal.getHeight(r)-2)+" re"),n.push("W"),n.push("n"),n.push(Zr(e.x1.x)+" "+Zr(e.x1.y)+" m"),n.push(Zr(e.x2.x)+" "+Zr(e.x2.y)+" l"),n.push(Zr(e.x4.x)+" "+Zr(e.x4.y)+" m"),n.push(Zr(e.x3.x)+" "+Zr(e.x3.y)+" l"),n.push("s"),n.push("Q"),t.stream=n.join(`
`),t},OffPushDown:function(r){var t=Wl(r);t.scope=r.scope;var e=[];return e.push("0.749023 g"),e.push("0 0 "+Zr(_r.internal.getWidth(r))+" "+Zr(_r.internal.getHeight(r))+" re"),e.push("f"),t.stream=e.join(`
`),t}}},createDefaultAppearanceStream:function(r){var t=r.scope.internal.getFont(r.fontName,r.fontStyle).id,e=r.scope.__private__.encodeColorString(r.color);return"/"+t+" "+r.fontSize+" Tf "+e}};_r.internal={Bezier_C:.551915024494,calculateCross:function(r){var t=_r.internal.getWidth(r),e=_r.internal.getHeight(r),n=Math.min(t,e);return{x1:{x:(t-n)/2,y:(e-n)/2+n},x2:{x:(t-n)/2+n,y:(e-n)/2},x3:{x:(t-n)/2,y:(e-n)/2},x4:{x:(t-n)/2+n,y:(e-n)/2+n}}}},_r.internal.getWidth=function(r){var t=0;return kn(r)==="object"&&(t=p4(r.Rect[2])),t},_r.internal.getHeight=function(r){var t=0;return kn(r)==="object"&&(t=p4(r.Rect[3])),t};var Vrt=Vi.addField=function(r){if(Grt(this,r),!(r instanceof Xc))throw new Error("Invalid argument passed to jsPDF.addField.");var t;return(t=r).scope.internal.acroformPlugin.printedOut&&(t.scope.internal.acroformPlugin.printedOut=!1,t.scope.internal.acroformPlugin.acroFormDictionaryRoot=null),t.scope.internal.acroformPlugin.acroFormDictionaryRoot.Fields.push(t),r.page=r.scope.internal.getCurrentPageInfo().pageNumber,this};Vi.AcroFormChoiceField=Tf,Vi.AcroFormListBox=If,Vi.AcroFormComboBox=Lf,Vi.AcroFormEditBox=Ty,Vi.AcroFormButton=Rs,Vi.AcroFormPushButton=Iy,Vi.AcroFormRadioButton=Ff,Vi.AcroFormCheckBox=Fy,Vi.AcroFormTextField=Yh,Vi.AcroFormPasswordField=Py,Vi.AcroFormAppearance=_r,Vi.AcroForm={ChoiceField:Tf,ListBox:If,ComboBox:Lf,EditBox:Ty,Button:Rs,PushButton:Iy,RadioButton:Ff,CheckBox:Fy,TextField:Yh,PasswordField:Py,Appearance:_r},qr.AcroForm={ChoiceField:Tf,ListBox:If,ComboBox:Lf,EditBox:Ty,Button:Rs,PushButton:Iy,RadioButton:Ff,CheckBox:Fy,TextField:Yh,PasswordField:Py,Appearance:_r};function _4(r){return r.reduce(function(t,e,n){return t[e]=n,t},{})}(function(r){r.__addimage__={};var t="UNKNOWN",e={PNG:[[137,80,78,71]],TIFF:[[77,77,0,42],[73,73,42,0]],JPEG:[[255,216,255,224,void 0,void 0,74,70,73,70,0],[255,216,255,225,void 0,void 0,69,120,105,102,0,0],[255,216,255,219],[255,216,255,238]],JPEG2000:[[0,0,0,12,106,80,32,32]],GIF87a:[[71,73,70,56,55,97]],GIF89a:[[71,73,70,56,57,97]],WEBP:[[82,73,70,70,void 0,void 0,void 0,void 0,87,69,66,80]],BMP:[[66,77],[66,65],[67,73],[67,80],[73,67],[80,84]]},n=r.__addimage__.getImageFileTypeByImageData=function(st,ct){var wt,yt,te,Zt,re,Xt=t;if((ct=ct||t)==="RGBA"||st.data!==void 0&&st.data instanceof Uint8ClampedArray&&"height"in st&&"width"in st)return"RGBA";if(pt(st))for(re in e)for(te=e[re],wt=0;wt<te.length;wt+=1){for(Zt=!0,yt=0;yt<te[wt].length;yt+=1)if(te[wt][yt]!==void 0&&te[wt][yt]!==st[yt]){Zt=!1;break}if(Zt===!0){Xt=re;break}}else for(re in e)for(te=e[re],wt=0;wt<te.length;wt+=1){for(Zt=!0,yt=0;yt<te[wt].length;yt+=1)if(te[wt][yt]!==void 0&&te[wt][yt]!==st.charCodeAt(yt)){Zt=!1;break}if(Zt===!0){Xt=re;break}}return Xt===t&&ct!==t&&(Xt=ct),Xt},i=function st(ct){for(var wt=this.internal.write,yt=this.internal.putStream,te=(0,this.internal.getFilters)();te.indexOf("FlateEncode")!==-1;)te.splice(te.indexOf("FlateEncode"),1);ct.objectId=this.internal.newObject();var Zt=[];if(Zt.push({key:"Type",value:"/XObject"}),Zt.push({key:"Subtype",value:"/Image"}),Zt.push({key:"Width",value:ct.width}),Zt.push({key:"Height",value:ct.height}),ct.colorSpace===k.INDEXED?Zt.push({key:"ColorSpace",value:"[/Indexed /DeviceRGB "+(ct.palette.length/3-1)+" "+("sMask"in ct&&ct.sMask!==void 0?ct.objectId+2:ct.objectId+1)+" 0 R]"}):(Zt.push({key:"ColorSpace",value:"/"+ct.colorSpace}),ct.colorSpace===k.DEVICE_CMYK&&Zt.push({key:"Decode",value:"[1 0 1 0 1 0 1 0]"})),Zt.push({key:"BitsPerComponent",value:ct.bitsPerComponent}),"decodeParameters"in ct&&ct.decodeParameters!==void 0&&Zt.push({key:"DecodeParms",value:"<<"+ct.decodeParameters+">>"}),"transparency"in ct&&Array.isArray(ct.transparency)){for(var re="",Xt=0,ne=ct.transparency.length;Xt<ne;Xt++)re+=ct.transparency[Xt]+" "+ct.transparency[Xt]+" ";Zt.push({key:"Mask",value:"["+re+"]"})}ct.sMask!==void 0&&Zt.push({key:"SMask",value:ct.objectId+1+" 0 R"});var se=ct.filter!==void 0?["/"+ct.filter]:void 0;if(yt({data:ct.data,additionalKeyValues:Zt,alreadyAppliedFilters:se,objectId:ct.objectId}),wt("endobj"),"sMask"in ct&&ct.sMask!==void 0){var we="/Predictor "+ct.predictor+" /Colors 1 /BitsPerComponent "+ct.bitsPerComponent+" /Columns "+ct.width,it={width:ct.width,height:ct.height,colorSpace:"DeviceGray",bitsPerComponent:ct.bitsPerComponent,decodeParameters:we,data:ct.sMask};"filter"in ct&&(it.filter=ct.filter),st.call(this,it)}if(ct.colorSpace===k.INDEXED){var vt=this.internal.newObject();yt({data:dt(new Uint8Array(ct.palette)),objectId:vt}),wt("endobj")}},s=function(){var st=this.internal.collections.addImage_images;for(var ct in st)i.call(this,st[ct])},a=function(){var st,ct=this.internal.collections.addImage_images,wt=this.internal.write;for(var yt in ct)wt("/I"+(st=ct[yt]).index,st.objectId,"0","R")},o=function(){this.internal.collections.addImage_images||(this.internal.collections.addImage_images={},this.internal.events.subscribe("putResources",s),this.internal.events.subscribe("putXobjectDict",a))},A=function(){var st=this.internal.collections.addImage_images;return o.call(this),st},f=function(){return Object.keys(this.internal.collections.addImage_images).length},m=function(st){return typeof r["process"+st.toUpperCase()]=="function"},_=function(st){return kn(st)==="object"&&st.nodeType===1},x=function(st,ct){if(st.nodeName==="IMG"&&st.hasAttribute("src")){var wt=""+st.getAttribute("src");if(wt.indexOf("data:image/")===0)return Ng(unescape(wt).split("base64,").pop());var yt=r.loadFile(wt,!0);if(yt!==void 0)return yt}if(st.nodeName==="CANVAS"){if(st.width===0||st.height===0)throw new Error("Given canvas must have data. Canvas width: "+st.width+", height: "+st.height);var te;switch(ct){case"PNG":te="image/png";break;case"WEBP":te="image/webp";break;case"JPEG":case"JPG":default:te="image/jpeg"}return Ng(st.toDataURL(te,1).split("base64,").pop())}},B=function(st){var ct=this.internal.collections.addImage_images;if(ct){for(var wt in ct)if(st===ct[wt].alias)return ct[wt]}},P=function(st,ct,wt){return st||ct||(st=-96,ct=-96),st<0&&(st=-1*wt.width*72/st/this.internal.scaleFactor),ct<0&&(ct=-1*wt.height*72/ct/this.internal.scaleFactor),st===0&&(st=ct*wt.width/wt.height),ct===0&&(ct=st*wt.height/wt.width),[st,ct]},M=function(st,ct,wt,yt,te,Zt){var re=P.call(this,wt,yt,te),Xt=this.internal.getCoordinateString,ne=this.internal.getVerticalCoordinateString,se=A.call(this);if(wt=re[0],yt=re[1],se[te.index]=te,Zt){Zt*=Math.PI/180;var we=Math.cos(Zt),it=Math.sin(Zt),vt=function(Ot){return Ot.toFixed(4)},Ft=[vt(we),vt(it),vt(-1*it),vt(we),0,0,"cm"]}this.internal.write("q"),Zt?(this.internal.write([1,"0","0",1,Xt(st),ne(ct+yt),"cm"].join(" ")),this.internal.write(Ft.join(" ")),this.internal.write([Xt(wt),"0","0",Xt(yt),"0","0","cm"].join(" "))):this.internal.write([Xt(wt),"0","0",Xt(yt),Xt(st),ne(ct+yt),"cm"].join(" ")),this.isAdvancedAPI()&&this.internal.write([1,0,0,-1,0,0,"cm"].join(" ")),this.internal.write("/I"+te.index+" Do"),this.internal.write("Q")},k=r.color_spaces={DEVICE_RGB:"DeviceRGB",DEVICE_GRAY:"DeviceGray",DEVICE_CMYK:"DeviceCMYK",CAL_GREY:"CalGray",CAL_RGB:"CalRGB",LAB:"Lab",ICC_BASED:"ICCBased",INDEXED:"Indexed",PATTERN:"Pattern",SEPARATION:"Separation",DEVICE_N:"DeviceN"};r.decode={DCT_DECODE:"DCTDecode",FLATE_DECODE:"FlateDecode",LZW_DECODE:"LZWDecode",JPX_DECODE:"JPXDecode",JBIG2_DECODE:"JBIG2Decode",ASCII85_DECODE:"ASCII85Decode",ASCII_HEX_DECODE:"ASCIIHexDecode",RUN_LENGTH_DECODE:"RunLengthDecode",CCITT_FAX_DECODE:"CCITTFaxDecode"};var Q=r.image_compression={NONE:"NONE",FAST:"FAST",MEDIUM:"MEDIUM",SLOW:"SLOW"},q=r.__addimage__.sHashCode=function(st){var ct,wt,yt=0;if(typeof st=="string")for(wt=st.length,ct=0;ct<wt;ct++)yt=(yt<<5)-yt+st.charCodeAt(ct),yt|=0;else if(pt(st))for(wt=st.byteLength/2,ct=0;ct<wt;ct++)yt=(yt<<5)-yt+st[ct],yt|=0;return yt},J=r.__addimage__.validateStringAsBase64=function(st){(st=st||"").toString().trim();var ct=!0;return st.length===0&&(ct=!1),st.length%4!=0&&(ct=!1),/^[A-Za-z0-9+/]+$/.test(st.substr(0,st.length-2))===!1&&(ct=!1),/^[A-Za-z0-9/][A-Za-z0-9+/]|[A-Za-z0-9+/]=|==$/.test(st.substr(-2))===!1&&(ct=!1),ct},tt=r.__addimage__.extractImageFromDataUrl=function(st){var ct=(st=st||"").split("base64,"),wt=null;if(ct.length===2){var yt=/^data:(\w*\/\w*);*(charset=(?!charset=)[\w=-]*)*;*$/.exec(ct[0]);Array.isArray(yt)&&(wt={mimeType:yt[1],charset:yt[2],data:ct[1]})}return wt},ft=r.__addimage__.supportsArrayBuffer=function(){return typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"};r.__addimage__.isArrayBuffer=function(st){return ft()&&st instanceof ArrayBuffer};var pt=r.__addimage__.isArrayBufferView=function(st){return ft()&&typeof Uint32Array<"u"&&(st instanceof Int8Array||st instanceof Uint8Array||typeof Uint8ClampedArray<"u"&&st instanceof Uint8ClampedArray||st instanceof Int16Array||st instanceof Uint16Array||st instanceof Int32Array||st instanceof Uint32Array||st instanceof Float32Array||st instanceof Float64Array)},mt=r.__addimage__.binaryStringToUint8Array=function(st){for(var ct=st.length,wt=new Uint8Array(ct),yt=0;yt<ct;yt++)wt[yt]=st.charCodeAt(yt);return wt},dt=r.__addimage__.arrayBufferToBinaryString=function(st){for(var ct="",wt=pt(st)?st:new Uint8Array(st),yt=0;yt<wt.length;yt+=8192)ct+=String.fromCharCode.apply(null,wt.subarray(yt,yt+8192));return ct};r.addImage=function(){var st,ct,wt,yt,te,Zt,re,Xt,ne;if(typeof arguments[1]=="number"?(ct=t,wt=arguments[1],yt=arguments[2],te=arguments[3],Zt=arguments[4],re=arguments[5],Xt=arguments[6],ne=arguments[7]):(ct=arguments[1],wt=arguments[2],yt=arguments[3],te=arguments[4],Zt=arguments[5],re=arguments[6],Xt=arguments[7],ne=arguments[8]),kn(st=arguments[0])==="object"&&!_(st)&&"imageData"in st){var se=st;st=se.imageData,ct=se.format||ct||t,wt=se.x||wt||0,yt=se.y||yt||0,te=se.w||se.width||te,Zt=se.h||se.height||Zt,re=se.alias||re,Xt=se.compression||Xt,ne=se.rotation||se.angle||ne}var we=this.internal.getFilters();if(Xt===void 0&&we.indexOf("FlateEncode")!==-1&&(Xt="SLOW"),isNaN(wt)||isNaN(yt))throw new Error("Invalid coordinates passed to jsPDF.addImage");o.call(this);var it=Rt.call(this,st,ct,re,Xt);return M.call(this,wt,yt,te,Zt,it,ne),this};var Rt=function(st,ct,wt,yt){var te,Zt,re;if(typeof st=="string"&&n(st)===t){st=unescape(st);var Xt=Lt(st,!1);(Xt!==""||(Xt=r.loadFile(st,!0))!==void 0)&&(st=Xt)}if(_(st)&&(st=x(st,ct)),ct=n(st,ct),!m(ct))throw new Error("addImage does not support files of type '"+ct+"', please ensure that a plugin for '"+ct+"' support is added.");if(((re=wt)==null||re.length===0)&&(wt=function(ne){return typeof ne=="string"||pt(ne)?q(ne):pt(ne.data)?q(ne.data):null}(st)),(te=B.call(this,wt))||(ft()&&(st instanceof Uint8Array||ct==="RGBA"||(Zt=st,st=mt(st))),te=this["process"+ct.toUpperCase()](st,f.call(this),wt,function(ne){return ne&&typeof ne=="string"&&(ne=ne.toUpperCase()),ne in r.image_compression?ne:Q.NONE}(yt),Zt)),!te)throw new Error("An unknown error occurred whilst processing the image.");return te},Lt=r.__addimage__.convertBase64ToBinaryString=function(st,ct){var wt;ct=typeof ct!="boolean"||ct;var yt,te="";if(typeof st=="string"){yt=(wt=tt(st))!==null?wt.data:st;try{te=Ng(yt)}catch(Zt){if(ct)throw J(yt)?new Error("atob-Error in jsPDF.convertBase64ToBinaryString "+Zt.message):new Error("Supplied Data is not a valid base64-String jsPDF.convertBase64ToBinaryString ")}}return te};r.getImageProperties=function(st){var ct,wt,yt="";if(_(st)&&(st=x(st)),typeof st=="string"&&n(st)===t&&((yt=Lt(st,!1))===""&&(yt=r.loadFile(st)||""),st=yt),wt=n(st),!m(wt))throw new Error("addImage does not support files of type '"+wt+"', please ensure that a plugin for '"+wt+"' support is added.");if(!ft()||st instanceof Uint8Array||(st=mt(st)),!(ct=this["process"+wt.toUpperCase()](st)))throw new Error("An unknown error occurred whilst processing the image");return ct.fileType=wt,ct}})(qr.API),function(r){var t=function(e){if(e!==void 0&&e!="")return!0};qr.API.events.push(["addPage",function(e){this.internal.getPageInfo(e.pageNumber).pageContext.annotations=[]}]),r.events.push(["putPage",function(e){for(var n,i,s,a=this.internal.getCoordinateString,o=this.internal.getVerticalCoordinateString,A=this.internal.getPageInfoByObjId(e.objId),f=e.pageContext.annotations,m=!1,_=0;_<f.length&&!m;_++)switch((n=f[_]).type){case"link":(t(n.options.url)||t(n.options.pageNumber))&&(m=!0);break;case"reference":case"text":case"freetext":m=!0}if(m!=0){this.internal.write("/Annots [");for(var x=0;x<f.length;x++){n=f[x];var B=this.internal.pdfEscape,P=this.internal.getEncryptor(e.objId);switch(n.type){case"reference":this.internal.write(" "+n.object.objId+" 0 R ");break;case"text":var M=this.internal.newAdditionalObject(),k=this.internal.newAdditionalObject(),Q=this.internal.getEncryptor(M.objId),q=n.title||"Note";s="<</Type /Annot /Subtype /Text "+(i="/Rect ["+a(n.bounds.x)+" "+o(n.bounds.y+n.bounds.h)+" "+a(n.bounds.x+n.bounds.w)+" "+o(n.bounds.y)+"] ")+"/Contents ("+B(Q(n.contents))+")",s+=" /Popup "+k.objId+" 0 R",s+=" /P "+A.objId+" 0 R",s+=" /T ("+B(Q(q))+") >>",M.content=s;var J=M.objId+" 0 R";s="<</Type /Annot /Subtype /Popup "+(i="/Rect ["+a(n.bounds.x+30)+" "+o(n.bounds.y+n.bounds.h)+" "+a(n.bounds.x+n.bounds.w+30)+" "+o(n.bounds.y)+"] ")+" /Parent "+J,n.open&&(s+=" /Open true"),s+=" >>",k.content=s,this.internal.write(M.objId,"0 R",k.objId,"0 R");break;case"freetext":i="/Rect ["+a(n.bounds.x)+" "+o(n.bounds.y)+" "+a(n.bounds.x+n.bounds.w)+" "+o(n.bounds.y+n.bounds.h)+"] ";var tt=n.color||"#000000";s="<</Type /Annot /Subtype /FreeText "+i+"/Contents ("+B(P(n.contents))+")",s+=" /DS(font: Helvetica,sans-serif 12.0pt; text-align:left; color:#"+tt+")",s+=" /Border [0 0 0]",s+=" >>",this.internal.write(s);break;case"link":if(n.options.name){var ft=this.annotations._nameMap[n.options.name];n.options.pageNumber=ft.page,n.options.top=ft.y}else n.options.top||(n.options.top=0);if(i="/Rect ["+n.finalBounds.x+" "+n.finalBounds.y+" "+n.finalBounds.w+" "+n.finalBounds.h+"] ",s="",n.options.url)s="<</Type /Annot /Subtype /Link "+i+"/Border [0 0 0] /A <</S /URI /URI ("+B(P(n.options.url))+") >>";else if(n.options.pageNumber)switch(s="<</Type /Annot /Subtype /Link "+i+"/Border [0 0 0] /Dest ["+this.internal.getPageInfo(n.options.pageNumber).objId+" 0 R",n.options.magFactor=n.options.magFactor||"XYZ",n.options.magFactor){case"Fit":s+=" /Fit]";break;case"FitH":s+=" /FitH "+n.options.top+"]";break;case"FitV":n.options.left=n.options.left||0,s+=" /FitV "+n.options.left+"]";break;case"XYZ":default:var pt=o(n.options.top);n.options.left=n.options.left||0,n.options.zoom===void 0&&(n.options.zoom=0),s+=" /XYZ "+n.options.left+" "+pt+" "+n.options.zoom+"]"}s!=""&&(s+=" >>",this.internal.write(s))}}this.internal.write("]")}}]),r.createAnnotation=function(e){var n=this.internal.getCurrentPageInfo();switch(e.type){case"link":this.link(e.bounds.x,e.bounds.y,e.bounds.w,e.bounds.h,e);break;case"text":case"freetext":n.pageContext.annotations.push(e)}},r.link=function(e,n,i,s,a){var o=this.internal.getCurrentPageInfo(),A=this.internal.getCoordinateString,f=this.internal.getVerticalCoordinateString;o.pageContext.annotations.push({finalBounds:{x:A(e),y:f(n),w:A(e+i),h:f(n+s)},options:a,type:"link"})},r.textWithLink=function(e,n,i,s){var a,o,A=this.getTextWidth(e),f=this.internal.getLineHeight()/this.internal.scaleFactor;if(s.maxWidth!==void 0){o=s.maxWidth;var m=this.splitTextToSize(e,o).length;a=Math.ceil(f*m)}else o=A,a=f;return this.text(e,n,i,s),i+=.2*f,s.align==="center"&&(n-=A/2),s.align==="right"&&(n-=A),this.link(n,i-f,o,a,s),A},r.getTextWidth=function(e){var n=this.internal.getFontSize();return this.getStringUnitWidth(e)*n/this.internal.scaleFactor}}(qr.API),function(r){var t={1569:[65152],1570:[65153,65154],1571:[65155,65156],1572:[65157,65158],1573:[65159,65160],1574:[65161,65162,65163,65164],1575:[65165,65166],1576:[65167,65168,65169,65170],1577:[65171,65172],1578:[65173,65174,65175,65176],1579:[65177,65178,65179,65180],1580:[65181,65182,65183,65184],1581:[65185,65186,65187,65188],1582:[65189,65190,65191,65192],1583:[65193,65194],1584:[65195,65196],1585:[65197,65198],1586:[65199,65200],1587:[65201,65202,65203,65204],1588:[65205,65206,65207,65208],1589:[65209,65210,65211,65212],1590:[65213,65214,65215,65216],1591:[65217,65218,65219,65220],1592:[65221,65222,65223,65224],1593:[65225,65226,65227,65228],1594:[65229,65230,65231,65232],1601:[65233,65234,65235,65236],1602:[65237,65238,65239,65240],1603:[65241,65242,65243,65244],1604:[65245,65246,65247,65248],1605:[65249,65250,65251,65252],1606:[65253,65254,65255,65256],1607:[65257,65258,65259,65260],1608:[65261,65262],1609:[65263,65264,64488,64489],1610:[65265,65266,65267,65268],1649:[64336,64337],1655:[64477],1657:[64358,64359,64360,64361],1658:[64350,64351,64352,64353],1659:[64338,64339,64340,64341],1662:[64342,64343,64344,64345],1663:[64354,64355,64356,64357],1664:[64346,64347,64348,64349],1667:[64374,64375,64376,64377],1668:[64370,64371,64372,64373],1670:[64378,64379,64380,64381],1671:[64382,64383,64384,64385],1672:[64392,64393],1676:[64388,64389],1677:[64386,64387],1678:[64390,64391],1681:[64396,64397],1688:[64394,64395],1700:[64362,64363,64364,64365],1702:[64366,64367,64368,64369],1705:[64398,64399,64400,64401],1709:[64467,64468,64469,64470],1711:[64402,64403,64404,64405],1713:[64410,64411,64412,64413],1715:[64406,64407,64408,64409],1722:[64414,64415],1723:[64416,64417,64418,64419],1726:[64426,64427,64428,64429],1728:[64420,64421],1729:[64422,64423,64424,64425],1733:[64480,64481],1734:[64473,64474],1735:[64471,64472],1736:[64475,64476],1737:[64482,64483],1739:[64478,64479],1740:[64508,64509,64510,64511],1744:[64484,64485,64486,64487],1746:[64430,64431],1747:[64432,64433]},e={65247:{65154:65269,65156:65271,65160:65273,65166:65275},65248:{65154:65270,65156:65272,65160:65274,65166:65276},65165:{65247:{65248:{65258:65010}}},1617:{1612:64606,1613:64607,1614:64608,1615:64609,1616:64610}},n={1612:64606,1613:64607,1614:64608,1615:64609,1616:64610},i=[1570,1571,1573,1575];r.__arabicParser__={};var s=r.__arabicParser__.isInArabicSubstitutionA=function(M){return t[M.charCodeAt(0)]!==void 0},a=r.__arabicParser__.isArabicLetter=function(M){return typeof M=="string"&&/^[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]+$/.test(M)},o=r.__arabicParser__.isArabicEndLetter=function(M){return a(M)&&s(M)&&t[M.charCodeAt(0)].length<=2},A=r.__arabicParser__.isArabicAlfLetter=function(M){return a(M)&&i.indexOf(M.charCodeAt(0))>=0};r.__arabicParser__.arabicLetterHasIsolatedForm=function(M){return a(M)&&s(M)&&t[M.charCodeAt(0)].length>=1};var f=r.__arabicParser__.arabicLetterHasFinalForm=function(M){return a(M)&&s(M)&&t[M.charCodeAt(0)].length>=2};r.__arabicParser__.arabicLetterHasInitialForm=function(M){return a(M)&&s(M)&&t[M.charCodeAt(0)].length>=3};var m=r.__arabicParser__.arabicLetterHasMedialForm=function(M){return a(M)&&s(M)&&t[M.charCodeAt(0)].length==4},_=r.__arabicParser__.resolveLigatures=function(M){var k=0,Q=e,q="",J=0;for(k=0;k<M.length;k+=1)Q[M.charCodeAt(k)]!==void 0?(J++,typeof(Q=Q[M.charCodeAt(k)])=="number"&&(q+=String.fromCharCode(Q),Q=e,J=0),k===M.length-1&&(Q=e,q+=M.charAt(k-(J-1)),k-=J-1,J=0)):(Q=e,q+=M.charAt(k-J),k-=J,J=0);return q};r.__arabicParser__.isArabicDiacritic=function(M){return M!==void 0&&n[M.charCodeAt(0)]!==void 0};var x=r.__arabicParser__.getCorrectForm=function(M,k,Q){return a(M)?s(M)===!1?-1:!f(M)||!a(k)&&!a(Q)||!a(Q)&&o(k)||o(M)&&!a(k)||o(M)&&A(k)||o(M)&&o(k)?0:m(M)&&a(k)&&!o(k)&&a(Q)&&f(Q)?3:o(M)||!a(Q)?1:2:-1},B=function(M){var k=0,Q=0,q=0,J="",tt="",ft="",pt=(M=M||"").split("\\s+"),mt=[];for(k=0;k<pt.length;k+=1){for(mt.push(""),Q=0;Q<pt[k].length;Q+=1)J=pt[k][Q],tt=pt[k][Q-1],ft=pt[k][Q+1],a(J)?(q=x(J,tt,ft),mt[k]+=q!==-1?String.fromCharCode(t[J.charCodeAt(0)][q]):J):mt[k]+=J;mt[k]=_(mt[k])}return mt.join(" ")},P=r.__arabicParser__.processArabic=r.processArabic=function(){var M,k=typeof arguments[0]=="string"?arguments[0]:arguments[0].text,Q=[];if(Array.isArray(k)){var q=0;for(Q=[],q=0;q<k.length;q+=1)Array.isArray(k[q])?Q.push([B(k[q][0]),k[q][1],k[q][2]]):Q.push([B(k[q])]);M=Q}else M=B(k);return typeof arguments[0]=="string"?M:(arguments[0].text=M,arguments[0])};r.events.push(["preProcessText",P])}(qr.API),qr.API.autoPrint=function(r){var t;switch((r=r||{}).variant=r.variant||"non-conform",r.variant){case"javascript":this.addJS("print({});");break;case"non-conform":default:this.internal.events.subscribe("postPutResources",function(){t=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /Named"),this.internal.out("/Type /Action"),this.internal.out("/N /Print"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){this.internal.out("/OpenAction "+t+" 0 R")})}return this},function(r){var t=function(){var e=void 0;Object.defineProperty(this,"pdf",{get:function(){return e},set:function(o){e=o}});var n=150;Object.defineProperty(this,"width",{get:function(){return n},set:function(o){n=isNaN(o)||Number.isInteger(o)===!1||o<0?150:o,this.getContext("2d").pageWrapXEnabled&&(this.getContext("2d").pageWrapX=n+1)}});var i=300;Object.defineProperty(this,"height",{get:function(){return i},set:function(o){i=isNaN(o)||Number.isInteger(o)===!1||o<0?300:o,this.getContext("2d").pageWrapYEnabled&&(this.getContext("2d").pageWrapY=i+1)}});var s=[];Object.defineProperty(this,"childNodes",{get:function(){return s},set:function(o){s=o}});var a={};Object.defineProperty(this,"style",{get:function(){return a},set:function(o){a=o}}),Object.defineProperty(this,"parentNode",{})};t.prototype.getContext=function(e,n){var i;if((e=e||"2d")!=="2d")return null;for(i in n)this.pdf.context2d.hasOwnProperty(i)&&(this.pdf.context2d[i]=n[i]);return this.pdf.context2d._canvas=this,this.pdf.context2d},t.prototype.toDataURL=function(){throw new Error("toDataURL is not implemented.")},r.events.push(["initialized",function(){this.canvas=new t,this.canvas.pdf=this}])}(qr.API),function(r){var t={left:0,top:0,bottom:0,right:0},e=!1,n=function(){this.internal.__cell__===void 0&&(this.internal.__cell__={},this.internal.__cell__.padding=3,this.internal.__cell__.headerFunction=void 0,this.internal.__cell__.margins=Object.assign({},t),this.internal.__cell__.margins.width=this.getPageWidth(),i.call(this))},i=function(){this.internal.__cell__.lastCell=new s,this.internal.__cell__.pages=1},s=function(){var A=arguments[0];Object.defineProperty(this,"x",{enumerable:!0,get:function(){return A},set:function(M){A=M}});var f=arguments[1];Object.defineProperty(this,"y",{enumerable:!0,get:function(){return f},set:function(M){f=M}});var m=arguments[2];Object.defineProperty(this,"width",{enumerable:!0,get:function(){return m},set:function(M){m=M}});var _=arguments[3];Object.defineProperty(this,"height",{enumerable:!0,get:function(){return _},set:function(M){_=M}});var x=arguments[4];Object.defineProperty(this,"text",{enumerable:!0,get:function(){return x},set:function(M){x=M}});var B=arguments[5];Object.defineProperty(this,"lineNumber",{enumerable:!0,get:function(){return B},set:function(M){B=M}});var P=arguments[6];return Object.defineProperty(this,"align",{enumerable:!0,get:function(){return P},set:function(M){P=M}}),this};s.prototype.clone=function(){return new s(this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align)},s.prototype.toArray=function(){return[this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align]},r.setHeaderFunction=function(A){return n.call(this),this.internal.__cell__.headerFunction=typeof A=="function"?A:void 0,this},r.getTextDimensions=function(A,f){n.call(this);var m=(f=f||{}).fontSize||this.getFontSize(),_=f.font||this.getFont(),x=f.scaleFactor||this.internal.scaleFactor,B=0,P=0,M=0,k=this;if(!Array.isArray(A)&&typeof A!="string"){if(typeof A!="number")throw new Error("getTextDimensions expects text-parameter to be of type String or type Number or an Array of Strings.");A=String(A)}var Q=f.maxWidth;Q>0?typeof A=="string"?A=this.splitTextToSize(A,Q):Object.prototype.toString.call(A)==="[object Array]"&&(A=A.reduce(function(J,tt){return J.concat(k.splitTextToSize(tt,Q))},[])):A=Array.isArray(A)?A:[A];for(var q=0;q<A.length;q++)B<(M=this.getStringUnitWidth(A[q],{font:_})*m)&&(B=M);return B!==0&&(P=A.length),{w:B/=x,h:Math.max((P*m*this.getLineHeightFactor()-m*(this.getLineHeightFactor()-1))/x,0)}},r.cellAddPage=function(){n.call(this),this.addPage();var A=this.internal.__cell__.margins||t;return this.internal.__cell__.lastCell=new s(A.left,A.top,void 0,void 0),this.internal.__cell__.pages+=1,this};var a=r.cell=function(){var A;A=arguments[0]instanceof s?arguments[0]:new s(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]),n.call(this);var f=this.internal.__cell__.lastCell,m=this.internal.__cell__.padding,_=this.internal.__cell__.margins||t,x=this.internal.__cell__.tableHeaderRow,B=this.internal.__cell__.printHeaders;return f.lineNumber!==void 0&&(f.lineNumber===A.lineNumber?(A.x=(f.x||0)+(f.width||0),A.y=f.y||0):f.y+f.height+A.height+_.bottom>this.getPageHeight()?(this.cellAddPage(),A.y=_.top,B&&x&&(this.printHeaderRow(A.lineNumber,!0),A.y+=x[0].height)):A.y=f.y+f.height||A.y),A.text[0]!==void 0&&(this.rect(A.x,A.y,A.width,A.height,e===!0?"FD":void 0),A.align==="right"?this.text(A.text,A.x+A.width-m,A.y+m,{align:"right",baseline:"top"}):A.align==="center"?this.text(A.text,A.x+A.width/2,A.y+m,{align:"center",baseline:"top",maxWidth:A.width-m-m}):this.text(A.text,A.x+m,A.y+m,{align:"left",baseline:"top",maxWidth:A.width-m-m})),this.internal.__cell__.lastCell=A,this};r.table=function(A,f,m,_,x){if(n.call(this),!m)throw new Error("No data for PDF table.");var B,P,M,k,Q=[],q=[],J=[],tt={},ft={},pt=[],mt=[],dt=(x=x||{}).autoSize||!1,Rt=x.printHeaders!==!1,Lt=x.css&&x.css["font-size"]!==void 0?16*x.css["font-size"]:x.fontSize||12,st=x.margins||Object.assign({width:this.getPageWidth()},t),ct=typeof x.padding=="number"?x.padding:3,wt=x.headerBackgroundColor||"#c8c8c8",yt=x.headerTextColor||"#000";if(i.call(this),this.internal.__cell__.printHeaders=Rt,this.internal.__cell__.margins=st,this.internal.__cell__.table_font_size=Lt,this.internal.__cell__.padding=ct,this.internal.__cell__.headerBackgroundColor=wt,this.internal.__cell__.headerTextColor=yt,this.setFontSize(Lt),_==null)q=Q=Object.keys(m[0]),J=Q.map(function(){return"left"});else if(Array.isArray(_)&&kn(_[0])==="object")for(Q=_.map(function(se){return se.name}),q=_.map(function(se){return se.prompt||se.name||""}),J=_.map(function(se){return se.align||"left"}),B=0;B<_.length;B+=1)ft[_[B].name]=_[B].width*(19.049976/25.4);else Array.isArray(_)&&typeof _[0]=="string"&&(q=Q=_,J=Q.map(function(){return"left"}));if(dt||Array.isArray(_)&&typeof _[0]=="string")for(B=0;B<Q.length;B+=1){for(tt[k=Q[B]]=m.map(function(se){return se[k]}),this.setFont(void 0,"bold"),pt.push(this.getTextDimensions(q[B],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w),P=tt[k],this.setFont(void 0,"normal"),M=0;M<P.length;M+=1)pt.push(this.getTextDimensions(P[M],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w);ft[k]=Math.max.apply(null,pt)+ct+ct,pt=[]}if(Rt){var te={};for(B=0;B<Q.length;B+=1)te[Q[B]]={},te[Q[B]].text=q[B],te[Q[B]].align=J[B];var Zt=o.call(this,te,ft);mt=Q.map(function(se){return new s(A,f,ft[se],Zt,te[se].text,void 0,te[se].align)}),this.setTableHeaderRow(mt),this.printHeaderRow(1,!1)}var re=_.reduce(function(se,we){return se[we.name]=we.align,se},{});for(B=0;B<m.length;B+=1){"rowStart"in x&&x.rowStart instanceof Function&&x.rowStart({row:B,data:m[B]},this);var Xt=o.call(this,m[B],ft);for(M=0;M<Q.length;M+=1){var ne=m[B][Q[M]];"cellStart"in x&&x.cellStart instanceof Function&&x.cellStart({row:B,col:M,data:ne},this),a.call(this,new s(A,f,ft[Q[M]],Xt,ne,B+2,re[Q[M]]))}}return this.internal.__cell__.table_x=A,this.internal.__cell__.table_y=f,this};var o=function(A,f){var m=this.internal.__cell__.padding,_=this.internal.__cell__.table_font_size,x=this.internal.scaleFactor;return Object.keys(A).map(function(B){var P=A[B];return this.splitTextToSize(P.hasOwnProperty("text")?P.text:P,f[B]-m-m)},this).map(function(B){return this.getLineHeightFactor()*B.length*_/x+m+m},this).reduce(function(B,P){return Math.max(B,P)},0)};r.setTableHeaderRow=function(A){n.call(this),this.internal.__cell__.tableHeaderRow=A},r.printHeaderRow=function(A,f){if(n.call(this),!this.internal.__cell__.tableHeaderRow)throw new Error("Property tableHeaderRow does not exist.");var m;if(e=!0,typeof this.internal.__cell__.headerFunction=="function"){var _=this.internal.__cell__.headerFunction(this,this.internal.__cell__.pages);this.internal.__cell__.lastCell=new s(_[0],_[1],_[2],_[3],void 0,-1)}this.setFont(void 0,"bold");for(var x=[],B=0;B<this.internal.__cell__.tableHeaderRow.length;B+=1){m=this.internal.__cell__.tableHeaderRow[B].clone(),f&&(m.y=this.internal.__cell__.margins.top||0,x.push(m)),m.lineNumber=A;var P=this.getTextColor();this.setTextColor(this.internal.__cell__.headerTextColor),this.setFillColor(this.internal.__cell__.headerBackgroundColor),a.call(this,m),this.setTextColor(P)}x.length>0&&this.setTableHeaderRow(x),this.setFont(void 0,"normal"),e=!1}}(qr.API);var v4={italic:["italic","oblique","normal"],oblique:["oblique","italic","normal"],normal:["normal","oblique","italic"]},b4=["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded"],G2=_4(b4),w4=[100,200,300,400,500,600,700,800,900],jrt=_4(w4);function V2(r){var t=r.family.replace(/"|'/g,"").toLowerCase(),e=function(s){return v4[s=s||"normal"]?s:"normal"}(r.style),n=function(s){if(!s)return 400;if(typeof s=="number")return s>=100&&s<=900&&s%100==0?s:400;if(/^\d00$/.test(s))return parseInt(s);switch(s){case"bold":return 700;case"normal":default:return 400}}(r.weight),i=function(s){return typeof G2[s=s||"normal"]=="number"?s:"normal"}(r.stretch);return{family:t,style:e,weight:n,stretch:i,src:r.src||[],ref:r.ref||{name:t,style:[i,e,n].join(" ")}}}function x4(r,t,e,n){var i;for(i=e;i>=0&&i<t.length;i+=n)if(r[t[i]])return r[t[i]];for(i=e;i>=0&&i<t.length;i-=n)if(r[t[i]])return r[t[i]]}var qrt={"sans-serif":"helvetica",fixed:"courier",monospace:"courier",terminal:"courier",cursive:"times",fantasy:"times",serif:"times"},B4={caption:"times",icon:"times",menu:"times","message-box":"times","small-caption":"times","status-bar":"times"};function C4(r){return[r.stretch,r.style,r.weight,r.family].join(" ")}function Krt(r,t,e){for(var n=(e=e||{}).defaultFontFamily||"times",i=Object.assign({},qrt,e.genericFontFamilies||{}),s=null,a=null,o=0;o<t.length;++o)if(i[(s=V2(t[o])).family]&&(s.family=i[s.family]),r.hasOwnProperty(s.family)){a=r[s.family];break}if(!(a=a||r[n]))throw new Error("Could not find a font-family for the rule '"+C4(s)+"' and default family '"+n+"'.");if(a=function(A,f){if(f[A])return f[A];var m=G2[A],_=m<=G2.normal?-1:1,x=x4(f,b4,m,_);if(!x)throw new Error("Could not find a matching font-stretch value for "+A);return x}(s.stretch,a),a=function(A,f){if(f[A])return f[A];for(var m=v4[A],_=0;_<m.length;++_)if(f[m[_]])return f[m[_]];throw new Error("Could not find a matching font-style for "+A)}(s.style,a),!(a=function(A,f){if(f[A])return f[A];if(A===400&&f[500])return f[500];if(A===500&&f[400])return f[400];var m=jrt[A],_=x4(f,w4,m,A<400?-1:1);if(!_)throw new Error("Could not find a matching font-weight for value "+A);return _}(s.weight,a)))throw new Error("Failed to resolve a font for the rule '"+C4(s)+"'.");return a}function E4(r){return r.trimLeft()}function $rt(r,t){for(var e=0;e<r.length;){if(r.charAt(e)===t)return[r.substring(0,e),r.substring(e+1)];e+=1}return null}function Wrt(r){var t=r.match(/^(-[a-z_]|[a-z_])[a-z0-9_-]*/i);return t===null?null:[t[0],r.substring(t[0].length)]}var My,S4,T4,I4=["times"];(function(r){var t,e,n,i,s,a,o,A,f,m=function(it){return it=it||{},this.isStrokeTransparent=it.isStrokeTransparent||!1,this.strokeOpacity=it.strokeOpacity||1,this.strokeStyle=it.strokeStyle||"#000000",this.fillStyle=it.fillStyle||"#000000",this.isFillTransparent=it.isFillTransparent||!1,this.fillOpacity=it.fillOpacity||1,this.font=it.font||"10px sans-serif",this.textBaseline=it.textBaseline||"alphabetic",this.textAlign=it.textAlign||"left",this.lineWidth=it.lineWidth||1,this.lineJoin=it.lineJoin||"miter",this.lineCap=it.lineCap||"butt",this.path=it.path||[],this.transform=it.transform!==void 0?it.transform.clone():new A,this.globalCompositeOperation=it.globalCompositeOperation||"normal",this.globalAlpha=it.globalAlpha||1,this.clip_path=it.clip_path||[],this.currentPoint=it.currentPoint||new a,this.miterLimit=it.miterLimit||10,this.lastPoint=it.lastPoint||new a,this.lineDashOffset=it.lineDashOffset||0,this.lineDash=it.lineDash||[],this.margin=it.margin||[0,0,0,0],this.prevPageLastElemOffset=it.prevPageLastElemOffset||0,this.ignoreClearRect=typeof it.ignoreClearRect!="boolean"||it.ignoreClearRect,this};r.events.push(["initialized",function(){this.context2d=new _(this),t=this.internal.f2,e=this.internal.getCoordinateString,n=this.internal.getVerticalCoordinateString,i=this.internal.getHorizontalCoordinate,s=this.internal.getVerticalCoordinate,a=this.internal.Point,o=this.internal.Rectangle,A=this.internal.Matrix,f=new m}]);var _=function(it){Object.defineProperty(this,"canvas",{get:function(){return{parentNode:!1,style:!1}}});var vt=it;Object.defineProperty(this,"pdf",{get:function(){return vt}});var Ft=!1;Object.defineProperty(this,"pageWrapXEnabled",{get:function(){return Ft},set:function(ge){Ft=!!ge}});var Ot=!1;Object.defineProperty(this,"pageWrapYEnabled",{get:function(){return Ot},set:function(ge){Ot=!!ge}});var $t=0;Object.defineProperty(this,"posX",{get:function(){return $t},set:function(ge){isNaN(ge)||($t=ge)}});var jt=0;Object.defineProperty(this,"posY",{get:function(){return jt},set:function(ge){isNaN(ge)||(jt=ge)}}),Object.defineProperty(this,"margin",{get:function(){return f.margin},set:function(ge){var Ut;typeof ge=="number"?Ut=[ge,ge,ge,ge]:((Ut=new Array(4))[0]=ge[0],Ut[1]=ge.length>=2?ge[1]:Ut[0],Ut[2]=ge.length>=3?ge[2]:Ut[0],Ut[3]=ge.length>=4?ge[3]:Ut[1]),f.margin=Ut}});var ae=!1;Object.defineProperty(this,"autoPaging",{get:function(){return ae},set:function(ge){ae=ge}});var ie=0;Object.defineProperty(this,"lastBreak",{get:function(){return ie},set:function(ge){ie=ge}});var Be=[];Object.defineProperty(this,"pageBreaks",{get:function(){return Be},set:function(ge){Be=ge}}),Object.defineProperty(this,"ctx",{get:function(){return f},set:function(ge){ge instanceof m&&(f=ge)}}),Object.defineProperty(this,"path",{get:function(){return f.path},set:function(ge){f.path=ge}});var Ie=[];Object.defineProperty(this,"ctxStack",{get:function(){return Ie},set:function(ge){Ie=ge}}),Object.defineProperty(this,"fillStyle",{get:function(){return this.ctx.fillStyle},set:function(ge){var Ut;Ut=x(ge),this.ctx.fillStyle=Ut.style,this.ctx.isFillTransparent=Ut.a===0,this.ctx.fillOpacity=Ut.a,this.pdf.setFillColor(Ut.r,Ut.g,Ut.b,{a:Ut.a}),this.pdf.setTextColor(Ut.r,Ut.g,Ut.b,{a:Ut.a})}}),Object.defineProperty(this,"strokeStyle",{get:function(){return this.ctx.strokeStyle},set:function(ge){var Ut=x(ge);this.ctx.strokeStyle=Ut.style,this.ctx.isStrokeTransparent=Ut.a===0,this.ctx.strokeOpacity=Ut.a,Ut.a===0?this.pdf.setDrawColor(255,255,255):(Ut.a,this.pdf.setDrawColor(Ut.r,Ut.g,Ut.b))}}),Object.defineProperty(this,"lineCap",{get:function(){return this.ctx.lineCap},set:function(ge){["butt","round","square"].indexOf(ge)!==-1&&(this.ctx.lineCap=ge,this.pdf.setLineCap(ge))}}),Object.defineProperty(this,"lineWidth",{get:function(){return this.ctx.lineWidth},set:function(ge){isNaN(ge)||(this.ctx.lineWidth=ge,this.pdf.setLineWidth(ge))}}),Object.defineProperty(this,"lineJoin",{get:function(){return this.ctx.lineJoin},set:function(ge){["bevel","round","miter"].indexOf(ge)!==-1&&(this.ctx.lineJoin=ge,this.pdf.setLineJoin(ge))}}),Object.defineProperty(this,"miterLimit",{get:function(){return this.ctx.miterLimit},set:function(ge){isNaN(ge)||(this.ctx.miterLimit=ge,this.pdf.setMiterLimit(ge))}}),Object.defineProperty(this,"textBaseline",{get:function(){return this.ctx.textBaseline},set:function(ge){this.ctx.textBaseline=ge}}),Object.defineProperty(this,"textAlign",{get:function(){return this.ctx.textAlign},set:function(ge){["right","end","center","left","start"].indexOf(ge)!==-1&&(this.ctx.textAlign=ge)}});var Qe=null;function He(ge,Ut){if(Qe===null){var Jt=function(er){var Se=[];return Object.keys(er).forEach(function(_e){er[_e].forEach(function(xe){var Ne=null;switch(xe){case"bold":Ne={family:_e,weight:"bold"};break;case"italic":Ne={family:_e,style:"italic"};break;case"bolditalic":Ne={family:_e,weight:"bold",style:"italic"};break;case"":case"normal":Ne={family:_e}}Ne!==null&&(Ne.ref={name:_e,style:xe},Se.push(Ne))})}),Se}(ge.getFontList());Qe=function(er){for(var Se={},_e=0;_e<er.length;++_e){var xe=V2(er[_e]),Ne=xe.family,ir=xe.stretch,Ar=xe.style,Lr=xe.weight;Se[Ne]=Se[Ne]||{},Se[Ne][ir]=Se[Ne][ir]||{},Se[Ne][ir][Ar]=Se[Ne][ir][Ar]||{},Se[Ne][ir][Ar][Lr]=xe}return Se}(Jt.concat(Ut))}return Qe}var ze=null;Object.defineProperty(this,"fontFaces",{get:function(){return ze},set:function(ge){Qe=null,ze=ge}}),Object.defineProperty(this,"font",{get:function(){return this.ctx.font},set:function(ge){var Ut;if(this.ctx.font=ge,(Ut=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-_,\"\'\sa-z]+?)\s*$/i.exec(ge))!==null){var Jt=Ut[1],er=(Ut[2],Ut[3]),Se=Ut[4],_e=(Ut[5],Ut[6]),xe=/^([.\d]+)((?:%|in|[cem]m|ex|p[ctx]))$/i.exec(Se)[2];Se=Math.floor(xe==="px"?parseFloat(Se)*this.pdf.internal.scaleFactor:xe==="em"?parseFloat(Se)*this.pdf.getFontSize():parseFloat(Se)*this.pdf.internal.scaleFactor),this.pdf.setFontSize(Se);var Ne=function(fe){var Ir,De,xn=[],Pr=fe.trim();if(Pr==="")return I4;if(Pr in B4)return[B4[Pr]];for(;Pr!=="";){switch(De=null,Ir=(Pr=E4(Pr)).charAt(0)){case'"':case"'":De=$rt(Pr.substring(1),Ir);break;default:De=Wrt(Pr)}if(De===null||(xn.push(De[0]),(Pr=E4(De[1]))!==""&&Pr.charAt(0)!==","))return I4;Pr=Pr.replace(/^,/,"")}return xn}(_e);if(this.fontFaces){var ir=Krt(He(this.pdf,this.fontFaces),Ne.map(function(fe){return{family:fe,stretch:"normal",weight:er,style:Jt}}));this.pdf.setFont(ir.ref.name,ir.ref.style)}else{var Ar="";(er==="bold"||parseInt(er,10)>=700||Jt==="bold")&&(Ar="bold"),Jt==="italic"&&(Ar+="italic"),Ar.length===0&&(Ar="normal");for(var Lr="",Tr={arial:"Helvetica",Arial:"Helvetica",verdana:"Helvetica",Verdana:"Helvetica",helvetica:"Helvetica",Helvetica:"Helvetica","sans-serif":"Helvetica",fixed:"Courier",monospace:"Courier",terminal:"Courier",cursive:"Times",fantasy:"Times",serif:"Times"},Nr=0;Nr<Ne.length;Nr++){if(this.pdf.internal.getFont(Ne[Nr],Ar,{noFallback:!0,disableWarning:!0})!==void 0){Lr=Ne[Nr];break}if(Ar==="bolditalic"&&this.pdf.internal.getFont(Ne[Nr],"bold",{noFallback:!0,disableWarning:!0})!==void 0)Lr=Ne[Nr],Ar="bold";else if(this.pdf.internal.getFont(Ne[Nr],"normal",{noFallback:!0,disableWarning:!0})!==void 0){Lr=Ne[Nr],Ar="normal";break}}if(Lr===""){for(var Qr=0;Qr<Ne.length;Qr++)if(Tr[Ne[Qr]]){Lr=Tr[Ne[Qr]];break}}Lr=Lr===""?"Times":Lr,this.pdf.setFont(Lr,Ar)}}}}),Object.defineProperty(this,"globalCompositeOperation",{get:function(){return this.ctx.globalCompositeOperation},set:function(ge){this.ctx.globalCompositeOperation=ge}}),Object.defineProperty(this,"globalAlpha",{get:function(){return this.ctx.globalAlpha},set:function(ge){this.ctx.globalAlpha=ge}}),Object.defineProperty(this,"lineDashOffset",{get:function(){return this.ctx.lineDashOffset},set:function(ge){this.ctx.lineDashOffset=ge,we.call(this)}}),Object.defineProperty(this,"lineDash",{get:function(){return this.ctx.lineDash},set:function(ge){this.ctx.lineDash=ge,we.call(this)}}),Object.defineProperty(this,"ignoreClearRect",{get:function(){return this.ctx.ignoreClearRect},set:function(ge){this.ctx.ignoreClearRect=!!ge}})};_.prototype.setLineDash=function(it){this.lineDash=it},_.prototype.getLineDash=function(){return this.lineDash.length%2?this.lineDash.concat(this.lineDash):this.lineDash.slice()},_.prototype.fill=function(){tt.call(this,"fill",!1)},_.prototype.stroke=function(){tt.call(this,"stroke",!1)},_.prototype.beginPath=function(){this.path=[{type:"begin"}]},_.prototype.moveTo=function(it,vt){if(isNaN(it)||isNaN(vt))throw ui.error("jsPDF.context2d.moveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.moveTo");var Ft=this.ctx.transform.applyToPoint(new a(it,vt));this.path.push({type:"mt",x:Ft.x,y:Ft.y}),this.ctx.lastPoint=new a(it,vt)},_.prototype.closePath=function(){var it=new a(0,0),vt=0;for(vt=this.path.length-1;vt!==-1;vt--)if(this.path[vt].type==="begin"&&kn(this.path[vt+1])==="object"&&typeof this.path[vt+1].x=="number"){it=new a(this.path[vt+1].x,this.path[vt+1].y);break}this.path.push({type:"close"}),this.ctx.lastPoint=new a(it.x,it.y)},_.prototype.lineTo=function(it,vt){if(isNaN(it)||isNaN(vt))throw ui.error("jsPDF.context2d.lineTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.lineTo");var Ft=this.ctx.transform.applyToPoint(new a(it,vt));this.path.push({type:"lt",x:Ft.x,y:Ft.y}),this.ctx.lastPoint=new a(Ft.x,Ft.y)},_.prototype.clip=function(){this.ctx.clip_path=JSON.parse(JSON.stringify(this.path)),tt.call(this,null,!0)},_.prototype.quadraticCurveTo=function(it,vt,Ft,Ot){if(isNaN(Ft)||isNaN(Ot)||isNaN(it)||isNaN(vt))throw ui.error("jsPDF.context2d.quadraticCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.quadraticCurveTo");var $t=this.ctx.transform.applyToPoint(new a(Ft,Ot)),jt=this.ctx.transform.applyToPoint(new a(it,vt));this.path.push({type:"qct",x1:jt.x,y1:jt.y,x:$t.x,y:$t.y}),this.ctx.lastPoint=new a($t.x,$t.y)},_.prototype.bezierCurveTo=function(it,vt,Ft,Ot,$t,jt){if(isNaN($t)||isNaN(jt)||isNaN(it)||isNaN(vt)||isNaN(Ft)||isNaN(Ot))throw ui.error("jsPDF.context2d.bezierCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.bezierCurveTo");var ae=this.ctx.transform.applyToPoint(new a($t,jt)),ie=this.ctx.transform.applyToPoint(new a(it,vt)),Be=this.ctx.transform.applyToPoint(new a(Ft,Ot));this.path.push({type:"bct",x1:ie.x,y1:ie.y,x2:Be.x,y2:Be.y,x:ae.x,y:ae.y}),this.ctx.lastPoint=new a(ae.x,ae.y)},_.prototype.arc=function(it,vt,Ft,Ot,$t,jt){if(isNaN(it)||isNaN(vt)||isNaN(Ft)||isNaN(Ot)||isNaN($t))throw ui.error("jsPDF.context2d.arc: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.arc");if(jt=!!jt,!this.ctx.transform.isIdentity){var ae=this.ctx.transform.applyToPoint(new a(it,vt));it=ae.x,vt=ae.y;var ie=this.ctx.transform.applyToPoint(new a(0,Ft)),Be=this.ctx.transform.applyToPoint(new a(0,0));Ft=Math.sqrt(Math.pow(ie.x-Be.x,2)+Math.pow(ie.y-Be.y,2))}Math.abs($t-Ot)>=2*Math.PI&&(Ot=0,$t=2*Math.PI),this.path.push({type:"arc",x:it,y:vt,radius:Ft,startAngle:Ot,endAngle:$t,counterclockwise:jt})},_.prototype.arcTo=function(it,vt,Ft,Ot,$t){throw new Error("arcTo not implemented.")},_.prototype.rect=function(it,vt,Ft,Ot){if(isNaN(it)||isNaN(vt)||isNaN(Ft)||isNaN(Ot))throw ui.error("jsPDF.context2d.rect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rect");this.moveTo(it,vt),this.lineTo(it+Ft,vt),this.lineTo(it+Ft,vt+Ot),this.lineTo(it,vt+Ot),this.lineTo(it,vt),this.lineTo(it+Ft,vt),this.lineTo(it,vt)},_.prototype.fillRect=function(it,vt,Ft,Ot){if(isNaN(it)||isNaN(vt)||isNaN(Ft)||isNaN(Ot))throw ui.error("jsPDF.context2d.fillRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillRect");if(!B.call(this)){var $t={};this.lineCap!=="butt"&&($t.lineCap=this.lineCap,this.lineCap="butt"),this.lineJoin!=="miter"&&($t.lineJoin=this.lineJoin,this.lineJoin="miter"),this.beginPath(),this.rect(it,vt,Ft,Ot),this.fill(),$t.hasOwnProperty("lineCap")&&(this.lineCap=$t.lineCap),$t.hasOwnProperty("lineJoin")&&(this.lineJoin=$t.lineJoin)}},_.prototype.strokeRect=function(it,vt,Ft,Ot){if(isNaN(it)||isNaN(vt)||isNaN(Ft)||isNaN(Ot))throw ui.error("jsPDF.context2d.strokeRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeRect");P.call(this)||(this.beginPath(),this.rect(it,vt,Ft,Ot),this.stroke())},_.prototype.clearRect=function(it,vt,Ft,Ot){if(isNaN(it)||isNaN(vt)||isNaN(Ft)||isNaN(Ot))throw ui.error("jsPDF.context2d.clearRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.clearRect");this.ignoreClearRect||(this.fillStyle="#ffffff",this.fillRect(it,vt,Ft,Ot))},_.prototype.save=function(it){it=typeof it!="boolean"||it;for(var vt=this.pdf.internal.getCurrentPageInfo().pageNumber,Ft=0;Ft<this.pdf.internal.getNumberOfPages();Ft++)this.pdf.setPage(Ft+1),this.pdf.internal.out("q");if(this.pdf.setPage(vt),it){this.ctx.fontSize=this.pdf.internal.getFontSize();var Ot=new m(this.ctx);this.ctxStack.push(this.ctx),this.ctx=Ot}},_.prototype.restore=function(it){it=typeof it!="boolean"||it;for(var vt=this.pdf.internal.getCurrentPageInfo().pageNumber,Ft=0;Ft<this.pdf.internal.getNumberOfPages();Ft++)this.pdf.setPage(Ft+1),this.pdf.internal.out("Q");this.pdf.setPage(vt),it&&this.ctxStack.length!==0&&(this.ctx=this.ctxStack.pop(),this.fillStyle=this.ctx.fillStyle,this.strokeStyle=this.ctx.strokeStyle,this.font=this.ctx.font,this.lineCap=this.ctx.lineCap,this.lineWidth=this.ctx.lineWidth,this.lineJoin=this.ctx.lineJoin,this.lineDash=this.ctx.lineDash,this.lineDashOffset=this.ctx.lineDashOffset)},_.prototype.toDataURL=function(){throw new Error("toDataUrl not implemented.")};var x=function(it){var vt,Ft,Ot,$t;if(it.isCanvasGradient===!0&&(it=it.getColor()),!it)return{r:0,g:0,b:0,a:0,style:it};if(/transparent|rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*0+\s*\)/.test(it))vt=0,Ft=0,Ot=0,$t=0;else{var jt=/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/.exec(it);if(jt!==null)vt=parseInt(jt[1]),Ft=parseInt(jt[2]),Ot=parseInt(jt[3]),$t=1;else if((jt=/rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.]+)\s*\)/.exec(it))!==null)vt=parseInt(jt[1]),Ft=parseInt(jt[2]),Ot=parseInt(jt[3]),$t=parseFloat(jt[4]);else{if($t=1,typeof it=="string"&&it.charAt(0)!=="#"){var ae=new l4(it);it=ae.ok?ae.toHex():"#000000"}it.length===4?(vt=it.substring(1,2),vt+=vt,Ft=it.substring(2,3),Ft+=Ft,Ot=it.substring(3,4),Ot+=Ot):(vt=it.substring(1,3),Ft=it.substring(3,5),Ot=it.substring(5,7)),vt=parseInt(vt,16),Ft=parseInt(Ft,16),Ot=parseInt(Ot,16)}}return{r:vt,g:Ft,b:Ot,a:$t,style:it}},B=function(){return this.ctx.isFillTransparent||this.globalAlpha==0},P=function(){return!!(this.ctx.isStrokeTransparent||this.globalAlpha==0)};_.prototype.fillText=function(it,vt,Ft,Ot){if(isNaN(vt)||isNaN(Ft)||typeof it!="string")throw ui.error("jsPDF.context2d.fillText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillText");if(Ot=isNaN(Ot)?void 0:Ot,!B.call(this)){var $t=Xt(this.ctx.transform.rotation),jt=this.ctx.transform.scaleX;ct.call(this,{text:it,x:vt,y:Ft,scale:jt,angle:$t,align:this.textAlign,maxWidth:Ot})}},_.prototype.strokeText=function(it,vt,Ft,Ot){if(isNaN(vt)||isNaN(Ft)||typeof it!="string")throw ui.error("jsPDF.context2d.strokeText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeText");if(!P.call(this)){Ot=isNaN(Ot)?void 0:Ot;var $t=Xt(this.ctx.transform.rotation),jt=this.ctx.transform.scaleX;ct.call(this,{text:it,x:vt,y:Ft,scale:jt,renderingMode:"stroke",angle:$t,align:this.textAlign,maxWidth:Ot})}},_.prototype.measureText=function(it){if(typeof it!="string")throw ui.error("jsPDF.context2d.measureText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.measureText");var vt=this.pdf,Ft=this.pdf.internal.scaleFactor,Ot=vt.internal.getFontSize(),$t=vt.getStringUnitWidth(it)*Ot/vt.internal.scaleFactor,jt=function(ae){var ie=(ae=ae||{}).width||0;return Object.defineProperty(this,"width",{get:function(){return ie}}),this};return new jt({width:$t*=Math.round(96*Ft/72*1e4)/1e4})},_.prototype.scale=function(it,vt){if(isNaN(it)||isNaN(vt))throw ui.error("jsPDF.context2d.scale: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.scale");var Ft=new A(it,0,0,vt,0,0);this.ctx.transform=this.ctx.transform.multiply(Ft)},_.prototype.rotate=function(it){if(isNaN(it))throw ui.error("jsPDF.context2d.rotate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rotate");var vt=new A(Math.cos(it),Math.sin(it),-Math.sin(it),Math.cos(it),0,0);this.ctx.transform=this.ctx.transform.multiply(vt)},_.prototype.translate=function(it,vt){if(isNaN(it)||isNaN(vt))throw ui.error("jsPDF.context2d.translate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.translate");var Ft=new A(1,0,0,1,it,vt);this.ctx.transform=this.ctx.transform.multiply(Ft)},_.prototype.transform=function(it,vt,Ft,Ot,$t,jt){if(isNaN(it)||isNaN(vt)||isNaN(Ft)||isNaN(Ot)||isNaN($t)||isNaN(jt))throw ui.error("jsPDF.context2d.transform: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.transform");var ae=new A(it,vt,Ft,Ot,$t,jt);this.ctx.transform=this.ctx.transform.multiply(ae)},_.prototype.setTransform=function(it,vt,Ft,Ot,$t,jt){it=isNaN(it)?1:it,vt=isNaN(vt)?0:vt,Ft=isNaN(Ft)?0:Ft,Ot=isNaN(Ot)?1:Ot,$t=isNaN($t)?0:$t,jt=isNaN(jt)?0:jt,this.ctx.transform=new A(it,vt,Ft,Ot,$t,jt)};var M=function(){return this.margin[0]>0||this.margin[1]>0||this.margin[2]>0||this.margin[3]>0};_.prototype.drawImage=function(it,vt,Ft,Ot,$t,jt,ae,ie,Be){var Ie=this.pdf.getImageProperties(it),Qe=1,He=1,ze=1,ge=1;Ot!==void 0&&ie!==void 0&&(ze=ie/Ot,ge=Be/$t,Qe=Ie.width/Ot*ie/Ot,He=Ie.height/$t*Be/$t),jt===void 0&&(jt=vt,ae=Ft,vt=0,Ft=0),Ot!==void 0&&ie===void 0&&(ie=Ot,Be=$t),Ot===void 0&&ie===void 0&&(ie=Ie.width,Be=Ie.height);for(var Ut,Jt=this.ctx.transform.decompose(),er=Xt(Jt.rotate.shx),Se=new A,_e=(Se=(Se=(Se=Se.multiply(Jt.translate)).multiply(Jt.skew)).multiply(Jt.scale)).applyToRectangle(new o(jt-vt*ze,ae-Ft*ge,Ot*Qe,$t*He)),xe=k.call(this,_e),Ne=[],ir=0;ir<xe.length;ir+=1)Ne.indexOf(xe[ir])===-1&&Ne.push(xe[ir]);if(J(Ne),this.autoPaging)for(var Ar=Ne[0],Lr=Ne[Ne.length-1],Tr=Ar;Tr<Lr+1;Tr++){this.pdf.setPage(Tr);var Nr=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],Qr=Tr===1?this.posY+this.margin[0]:this.margin[0],fe=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Ir=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],De=Tr===1?0:fe+(Tr-2)*Ir;if(this.ctx.clip_path.length!==0){var xn=this.path;Ut=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=q(Ut,this.posX+this.margin[3],-De+Qr+this.ctx.prevPageLastElemOffset),ft.call(this,"fill",!0),this.path=xn}var Pr=JSON.parse(JSON.stringify(_e));Pr=q([Pr],this.posX+this.margin[3],-De+Qr+this.ctx.prevPageLastElemOffset)[0];var Te=(Tr>Ar||Tr<Lr)&&M.call(this);Te&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Nr,Ir,null).clip().discardPath()),this.pdf.addImage(it,"JPEG",Pr.x,Pr.y,Pr.w,Pr.h,null,null,er),Te&&this.pdf.restoreGraphicsState()}else this.pdf.addImage(it,"JPEG",_e.x,_e.y,_e.w,_e.h,null,null,er)};var k=function(it,vt,Ft){var Ot=[];vt=vt||this.pdf.internal.pageSize.width,Ft=Ft||this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2];var $t=this.posY+this.ctx.prevPageLastElemOffset;switch(it.type){default:case"mt":case"lt":Ot.push(Math.floor((it.y+$t)/Ft)+1);break;case"arc":Ot.push(Math.floor((it.y+$t-it.radius)/Ft)+1),Ot.push(Math.floor((it.y+$t+it.radius)/Ft)+1);break;case"qct":var jt=ne(this.ctx.lastPoint.x,this.ctx.lastPoint.y,it.x1,it.y1,it.x,it.y);Ot.push(Math.floor((jt.y+$t)/Ft)+1),Ot.push(Math.floor((jt.y+jt.h+$t)/Ft)+1);break;case"bct":var ae=se(this.ctx.lastPoint.x,this.ctx.lastPoint.y,it.x1,it.y1,it.x2,it.y2,it.x,it.y);Ot.push(Math.floor((ae.y+$t)/Ft)+1),Ot.push(Math.floor((ae.y+ae.h+$t)/Ft)+1);break;case"rect":Ot.push(Math.floor((it.y+$t)/Ft)+1),Ot.push(Math.floor((it.y+it.h+$t)/Ft)+1)}for(var ie=0;ie<Ot.length;ie+=1)for(;this.pdf.internal.getNumberOfPages()<Ot[ie];)Q.call(this);return Ot},Q=function(){var it=this.fillStyle,vt=this.strokeStyle,Ft=this.font,Ot=this.lineCap,$t=this.lineWidth,jt=this.lineJoin;this.pdf.addPage(),this.fillStyle=it,this.strokeStyle=vt,this.font=Ft,this.lineCap=Ot,this.lineWidth=$t,this.lineJoin=jt},q=function(it,vt,Ft){for(var Ot=0;Ot<it.length;Ot++)switch(it[Ot].type){case"bct":it[Ot].x2+=vt,it[Ot].y2+=Ft;case"qct":it[Ot].x1+=vt,it[Ot].y1+=Ft;case"mt":case"lt":case"arc":default:it[Ot].x+=vt,it[Ot].y+=Ft}return it},J=function(it){return it.sort(function(vt,Ft){return vt-Ft})},tt=function(it,vt){for(var Ft,Ot,$t=this.fillStyle,jt=this.strokeStyle,ae=this.lineCap,ie=this.lineWidth,Be=Math.abs(ie*this.ctx.transform.scaleX),Ie=this.lineJoin,Qe=JSON.parse(JSON.stringify(this.path)),He=JSON.parse(JSON.stringify(this.path)),ze=[],ge=0;ge<He.length;ge++)if(He[ge].x!==void 0)for(var Ut=k.call(this,He[ge]),Jt=0;Jt<Ut.length;Jt+=1)ze.indexOf(Ut[Jt])===-1&&ze.push(Ut[Jt]);for(var er=0;er<ze.length;er++)for(;this.pdf.internal.getNumberOfPages()<ze[er];)Q.call(this);if(J(ze),this.autoPaging)for(var Se=ze[0],_e=ze[ze.length-1],xe=Se;xe<_e+1;xe++){this.pdf.setPage(xe),this.fillStyle=$t,this.strokeStyle=jt,this.lineCap=ae,this.lineWidth=Be,this.lineJoin=Ie;var Ne=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],ir=xe===1?this.posY+this.margin[0]:this.margin[0],Ar=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Lr=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],Tr=xe===1?0:Ar+(xe-2)*Lr;if(this.ctx.clip_path.length!==0){var Nr=this.path;Ft=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=q(Ft,this.posX+this.margin[3],-Tr+ir+this.ctx.prevPageLastElemOffset),ft.call(this,it,!0),this.path=Nr}if(Ot=JSON.parse(JSON.stringify(Qe)),this.path=q(Ot,this.posX+this.margin[3],-Tr+ir+this.ctx.prevPageLastElemOffset),vt===!1||xe===0){var Qr=(xe>Se||xe<_e)&&M.call(this);Qr&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Ne,Lr,null).clip().discardPath()),ft.call(this,it,vt),Qr&&this.pdf.restoreGraphicsState()}this.lineWidth=ie}else this.lineWidth=Be,ft.call(this,it,vt),this.lineWidth=ie;this.path=Qe},ft=function(it,vt){if((it!=="stroke"||vt||!P.call(this))&&(it==="stroke"||vt||!B.call(this))){for(var Ft,Ot,$t=[],jt=this.path,ae=0;ae<jt.length;ae++){var ie=jt[ae];switch(ie.type){case"begin":$t.push({begin:!0});break;case"close":$t.push({close:!0});break;case"mt":$t.push({start:ie,deltas:[],abs:[]});break;case"lt":var Be=$t.length;if(jt[ae-1]&&!isNaN(jt[ae-1].x)&&(Ft=[ie.x-jt[ae-1].x,ie.y-jt[ae-1].y],Be>0)){for(;Be>=0;Be--)if($t[Be-1].close!==!0&&$t[Be-1].begin!==!0){$t[Be-1].deltas.push(Ft),$t[Be-1].abs.push(ie);break}}break;case"bct":Ft=[ie.x1-jt[ae-1].x,ie.y1-jt[ae-1].y,ie.x2-jt[ae-1].x,ie.y2-jt[ae-1].y,ie.x-jt[ae-1].x,ie.y-jt[ae-1].y],$t[$t.length-1].deltas.push(Ft);break;case"qct":var Ie=jt[ae-1].x+2/3*(ie.x1-jt[ae-1].x),Qe=jt[ae-1].y+2/3*(ie.y1-jt[ae-1].y),He=ie.x+2/3*(ie.x1-ie.x),ze=ie.y+2/3*(ie.y1-ie.y),ge=ie.x,Ut=ie.y;Ft=[Ie-jt[ae-1].x,Qe-jt[ae-1].y,He-jt[ae-1].x,ze-jt[ae-1].y,ge-jt[ae-1].x,Ut-jt[ae-1].y],$t[$t.length-1].deltas.push(Ft);break;case"arc":$t.push({deltas:[],abs:[],arc:!0}),Array.isArray($t[$t.length-1].abs)&&$t[$t.length-1].abs.push(ie)}}Ot=vt?null:it==="stroke"?"stroke":"fill";for(var Jt=!1,er=0;er<$t.length;er++)if($t[er].arc)for(var Se=$t[er].abs,_e=0;_e<Se.length;_e++){var xe=Se[_e];xe.type==="arc"?dt.call(this,xe.x,xe.y,xe.radius,xe.startAngle,xe.endAngle,xe.counterclockwise,void 0,vt,!Jt):wt.call(this,xe.x,xe.y),Jt=!0}else if($t[er].close===!0)this.pdf.internal.out("h"),Jt=!1;else if($t[er].begin!==!0){var Ne=$t[er].start.x,ir=$t[er].start.y;yt.call(this,$t[er].deltas,Ne,ir),Jt=!0}Ot&&Rt.call(this,Ot),vt&&Lt.call(this)}},pt=function(it){var vt=this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor,Ft=vt*(this.pdf.internal.getLineHeightFactor()-1);switch(this.ctx.textBaseline){case"bottom":return it-Ft;case"top":return it+vt-Ft;case"hanging":return it+vt-2*Ft;case"middle":return it+vt/2-Ft;case"ideographic":return it;case"alphabetic":default:return it}},mt=function(it){return it+this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor*(this.pdf.internal.getLineHeightFactor()-1)};_.prototype.createLinearGradient=function(){var it=function(){};return it.colorStops=[],it.addColorStop=function(vt,Ft){this.colorStops.push([vt,Ft])},it.getColor=function(){return this.colorStops.length===0?"#000000":this.colorStops[0][1]},it.isCanvasGradient=!0,it},_.prototype.createPattern=function(){return this.createLinearGradient()},_.prototype.createRadialGradient=function(){return this.createLinearGradient()};var dt=function(it,vt,Ft,Ot,$t,jt,ae,ie,Be){for(var Ie=Zt.call(this,Ft,Ot,$t,jt),Qe=0;Qe<Ie.length;Qe++){var He=Ie[Qe];Qe===0&&(Be?st.call(this,He.x1+it,He.y1+vt):wt.call(this,He.x1+it,He.y1+vt)),te.call(this,it,vt,He.x2,He.y2,He.x3,He.y3,He.x4,He.y4)}ie?Lt.call(this):Rt.call(this,ae)},Rt=function(it){switch(it){case"stroke":this.pdf.internal.out("S");break;case"fill":this.pdf.internal.out("f")}},Lt=function(){this.pdf.clip(),this.pdf.discardPath()},st=function(it,vt){this.pdf.internal.out(e(it)+" "+n(vt)+" m")},ct=function(it){var vt;switch(it.align){case"right":case"end":vt="right";break;case"center":vt="center";break;case"left":case"start":default:vt="left"}var Ft=this.pdf.getTextDimensions(it.text),Ot=pt.call(this,it.y),$t=mt.call(this,Ot)-Ft.h,jt=this.ctx.transform.applyToPoint(new a(it.x,Ot)),ae=this.ctx.transform.decompose(),ie=new A;ie=(ie=(ie=ie.multiply(ae.translate)).multiply(ae.skew)).multiply(ae.scale);for(var Be,Ie,Qe,He=this.ctx.transform.applyToRectangle(new o(it.x,Ot,Ft.w,Ft.h)),ze=ie.applyToRectangle(new o(it.x,$t,Ft.w,Ft.h)),ge=k.call(this,ze),Ut=[],Jt=0;Jt<ge.length;Jt+=1)Ut.indexOf(ge[Jt])===-1&&Ut.push(ge[Jt]);if(J(Ut),this.autoPaging)for(var er=Ut[0],Se=Ut[Ut.length-1],_e=er;_e<Se+1;_e++){this.pdf.setPage(_e);var xe=_e===1?this.posY+this.margin[0]:this.margin[0],Ne=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],ir=this.pdf.internal.pageSize.height-this.margin[2],Ar=ir-this.margin[0],Lr=this.pdf.internal.pageSize.width-this.margin[1],Tr=Lr-this.margin[3],Nr=_e===1?0:Ne+(_e-2)*Ar;if(this.ctx.clip_path.length!==0){var Qr=this.path;Be=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=q(Be,this.posX+this.margin[3],-1*Nr+xe),ft.call(this,"fill",!0),this.path=Qr}var fe=q([JSON.parse(JSON.stringify(ze))],this.posX+this.margin[3],-Nr+xe+this.ctx.prevPageLastElemOffset)[0];it.scale>=.01&&(Ie=this.pdf.internal.getFontSize(),this.pdf.setFontSize(Ie*it.scale),Qe=this.lineWidth,this.lineWidth=Qe*it.scale);var Ir=this.autoPaging!=="text";if(Ir||fe.y+fe.h<=ir){if(Ir||fe.y>=xe&&fe.x<=Lr){var De=Ir?it.text:this.pdf.splitTextToSize(it.text,it.maxWidth||Lr-fe.x)[0],xn=q([JSON.parse(JSON.stringify(He))],this.posX+this.margin[3],-Nr+xe+this.ctx.prevPageLastElemOffset)[0],Pr=Ir&&(_e>er||_e<Se)&&M.call(this);Pr&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Tr,Ar,null).clip().discardPath()),this.pdf.text(De,xn.x,xn.y,{angle:it.angle,align:vt,renderingMode:it.renderingMode}),Pr&&this.pdf.restoreGraphicsState()}}else fe.y<ir&&(this.ctx.prevPageLastElemOffset+=ir-fe.y);it.scale>=.01&&(this.pdf.setFontSize(Ie),this.lineWidth=Qe)}else it.scale>=.01&&(Ie=this.pdf.internal.getFontSize(),this.pdf.setFontSize(Ie*it.scale),Qe=this.lineWidth,this.lineWidth=Qe*it.scale),this.pdf.text(it.text,jt.x+this.posX,jt.y+this.posY,{angle:it.angle,align:vt,renderingMode:it.renderingMode,maxWidth:it.maxWidth}),it.scale>=.01&&(this.pdf.setFontSize(Ie),this.lineWidth=Qe)},wt=function(it,vt,Ft,Ot){Ft=Ft||0,Ot=Ot||0,this.pdf.internal.out(e(it+Ft)+" "+n(vt+Ot)+" l")},yt=function(it,vt,Ft){return this.pdf.lines(it,vt,Ft,null,null)},te=function(it,vt,Ft,Ot,$t,jt,ae,ie){this.pdf.internal.out([t(i(Ft+it)),t(s(Ot+vt)),t(i($t+it)),t(s(jt+vt)),t(i(ae+it)),t(s(ie+vt)),"c"].join(" "))},Zt=function(it,vt,Ft,Ot){for(var $t=2*Math.PI,jt=Math.PI/2;vt>Ft;)vt-=$t;var ae=Math.abs(Ft-vt);ae<$t&&Ot&&(ae=$t-ae);for(var ie=[],Be=Ot?-1:1,Ie=vt;ae>1e-5;){var Qe=Ie+Be*Math.min(ae,jt);ie.push(re.call(this,it,Ie,Qe)),ae-=Math.abs(Qe-Ie),Ie=Qe}return ie},re=function(it,vt,Ft){var Ot=(Ft-vt)/2,$t=it*Math.cos(Ot),jt=it*Math.sin(Ot),ae=$t,ie=-jt,Be=ae*ae+ie*ie,Ie=Be+ae*$t+ie*jt,Qe=4/3*(Math.sqrt(2*Be*Ie)-Ie)/(ae*jt-ie*$t),He=ae-Qe*ie,ze=ie+Qe*ae,ge=He,Ut=-ze,Jt=Ot+vt,er=Math.cos(Jt),Se=Math.sin(Jt);return{x1:it*Math.cos(vt),y1:it*Math.sin(vt),x2:He*er-ze*Se,y2:He*Se+ze*er,x3:ge*er-Ut*Se,y3:ge*Se+Ut*er,x4:it*Math.cos(Ft),y4:it*Math.sin(Ft)}},Xt=function(it){return 180*it/Math.PI},ne=function(it,vt,Ft,Ot,$t,jt){var ae=it+.5*(Ft-it),ie=vt+.5*(Ot-vt),Be=$t+.5*(Ft-$t),Ie=jt+.5*(Ot-jt),Qe=Math.min(it,$t,ae,Be),He=Math.max(it,$t,ae,Be),ze=Math.min(vt,jt,ie,Ie),ge=Math.max(vt,jt,ie,Ie);return new o(Qe,ze,He-Qe,ge-ze)},se=function(it,vt,Ft,Ot,$t,jt,ae,ie){var Be,Ie,Qe,He,ze,ge,Ut,Jt,er,Se,_e,xe,Ne,ir,Ar=Ft-it,Lr=Ot-vt,Tr=$t-Ft,Nr=jt-Ot,Qr=ae-$t,fe=ie-jt;for(Ie=0;Ie<41;Ie++)er=(Ut=(Qe=it+(Be=Ie/40)*Ar)+Be*((ze=Ft+Be*Tr)-Qe))+Be*(ze+Be*($t+Be*Qr-ze)-Ut),Se=(Jt=(He=vt+Be*Lr)+Be*((ge=Ot+Be*Nr)-He))+Be*(ge+Be*(jt+Be*fe-ge)-Jt),Ie==0?(_e=er,xe=Se,Ne=er,ir=Se):(_e=Math.min(_e,er),xe=Math.min(xe,Se),Ne=Math.max(Ne,er),ir=Math.max(ir,Se));return new o(Math.round(_e),Math.round(xe),Math.round(Ne-_e),Math.round(ir-xe))},we=function(){if(this.prevLineDash||this.ctx.lineDash.length||this.ctx.lineDashOffset){var it,vt,Ft=(it=this.ctx.lineDash,vt=this.ctx.lineDashOffset,JSON.stringify({lineDash:it,lineDashOffset:vt}));this.prevLineDash!==Ft&&(this.pdf.setLineDash(this.ctx.lineDash,this.ctx.lineDashOffset),this.prevLineDash=Ft)}}})(qr.API),function(r){var t=function(s){var a,o,A,f,m,_,x,B,P,M;for(o=[],A=0,f=(s+=a="\0\0\0\0".slice(s.length%4||4)).length;f>A;A+=4)(m=(s.charCodeAt(A)<<24)+(s.charCodeAt(A+1)<<16)+(s.charCodeAt(A+2)<<8)+s.charCodeAt(A+3))!==0?(_=(m=((m=((m=((m=(m-(M=m%85))/85)-(P=m%85))/85)-(B=m%85))/85)-(x=m%85))/85)%85,o.push(_+33,x+33,B+33,P+33,M+33)):o.push(122);return function(k,Q){for(var q=Q;q>0;q--)k.pop()}(o,a.length),String.fromCharCode.apply(String,o)+"~>"},e=function(s){var a,o,A,f,m,_=String,x="length",B=255,P="charCodeAt",M="slice",k="replace";for(s[M](-2),s=s[M](0,-2)[k](/\s/g,"")[k]("z","!!!!!"),A=[],f=0,m=(s+=a="uuuuu"[M](s[x]%5||5))[x];m>f;f+=5)o=52200625*(s[P](f)-33)+614125*(s[P](f+1)-33)+7225*(s[P](f+2)-33)+85*(s[P](f+3)-33)+(s[P](f+4)-33),A.push(B&o>>24,B&o>>16,B&o>>8,B&o);return function(Q,q){for(var J=q;J>0;J--)Q.pop()}(A,a[x]),_.fromCharCode.apply(_,A)},n=function(s){var a=new RegExp(/^([0-9A-Fa-f]{2})+$/);if((s=s.replace(/\s/g,"")).indexOf(">")!==-1&&(s=s.substr(0,s.indexOf(">"))),s.length%2&&(s+="0"),a.test(s)===!1)return"";for(var o="",A=0;A<s.length;A+=2)o+=String.fromCharCode("0x"+(s[A]+s[A+1]));return o},i=function(s){for(var a=new Uint8Array(s.length),o=s.length;o--;)a[o]=s.charCodeAt(o);return s=(a=M2(a)).reduce(function(A,f){return A+String.fromCharCode(f)},"")};r.processDataByFilters=function(s,a){var o=0,A=s||"",f=[];for(typeof(a=a||[])=="string"&&(a=[a]),o=0;o<a.length;o+=1)switch(a[o]){case"ASCII85Decode":case"/ASCII85Decode":A=e(A),f.push("/ASCII85Encode");break;case"ASCII85Encode":case"/ASCII85Encode":A=t(A),f.push("/ASCII85Decode");break;case"ASCIIHexDecode":case"/ASCIIHexDecode":A=n(A),f.push("/ASCIIHexEncode");break;case"ASCIIHexEncode":case"/ASCIIHexEncode":A=A.split("").map(function(m){return("0"+m.charCodeAt().toString(16)).slice(-2)}).join("")+">",f.push("/ASCIIHexDecode");break;case"FlateEncode":case"/FlateEncode":A=i(A),f.push("/FlateDecode");break;default:throw new Error('The filter: "'+a[o]+'" is not implemented')}return{data:A,reverseChain:f.reverse().join(" ")}}}(qr.API),function(r){r.loadFile=function(t,e,n){return function(i,s,a){s=s!==!1,a=typeof a=="function"?a:function(){};var o=void 0;try{o=function(A,f,m){var _=new XMLHttpRequest,x=0,B=function(P){var M=P.length,k=[],Q=String.fromCharCode;for(x=0;x<M;x+=1)k.push(Q(255&P.charCodeAt(x)));return k.join("")};if(_.open("GET",A,!f),_.overrideMimeType("text/plain; charset=x-user-defined"),f===!1&&(_.onload=function(){_.status===200?m(B(this.responseText)):m(void 0)}),_.send(null),f&&_.status===200)return B(_.responseText)}(i,s,a)}catch{}return o}(t,e,n)},r.loadImageFile=r.loadFile}(qr.API),function(r){function t(){return(jr.html2canvas?Promise.resolve(jr.html2canvas):Promise.resolve().then(()=>nAt)).catch(function(a){return Promise.reject(new Error("Could not load html2canvas: "+a))}).then(function(a){return a.default?a.default:a})}function e(){return(jr.DOMPurify?Promise.resolve(jr.DOMPurify):Promise.resolve().then(()=>MAt)).catch(function(a){return Promise.reject(new Error("Could not load dompurify: "+a))}).then(function(a){return a.default?a.default:a})}var n=function(a){var o=kn(a);return o==="undefined"?"undefined":o==="string"||a instanceof String?"string":o==="number"||a instanceof Number?"number":o==="function"||a instanceof Function?"function":a&&a.constructor===Array?"array":a&&a.nodeType===1?"element":o==="object"?"object":"unknown"},i=function(a,o){var A=document.createElement(a);for(var f in o.className&&(A.className=o.className),o.innerHTML&&o.dompurify&&(A.innerHTML=o.dompurify.sanitize(o.innerHTML)),o.style)A.style[f]=o.style[f];return A},s=function a(o){var A=Object.assign(a.convert(Promise.resolve()),JSON.parse(JSON.stringify(a.template))),f=a.convert(Promise.resolve(),A);return f=(f=f.setProgress(1,a,1,[a])).set(o)};(s.prototype=Object.create(Promise.prototype)).constructor=s,s.convert=function(a,o){return a.__proto__=o||s.prototype,a},s.template={prop:{src:null,container:null,overlay:null,canvas:null,img:null,pdf:null,pageSize:null,callback:function(){}},progress:{val:0,state:null,n:0,stack:[]},opt:{filename:"file.pdf",margin:[0,0,0,0],enableLinks:!0,x:0,y:0,html2canvas:{},jsPDF:{},backgroundColor:"transparent"}},s.prototype.from=function(a,o){return this.then(function(){switch(o=o||function(A){switch(n(A)){case"string":return"string";case"element":return A.nodeName.toLowerCase()==="canvas"?"canvas":"element";default:return"unknown"}}(a)){case"string":return this.then(e).then(function(A){return this.set({src:i("div",{innerHTML:a,dompurify:A})})});case"element":return this.set({src:a});case"canvas":return this.set({canvas:a});case"img":return this.set({img:a});default:return this.error("Unknown source type.")}})},s.prototype.to=function(a){switch(a){case"container":return this.toContainer();case"canvas":return this.toCanvas();case"img":return this.toImg();case"pdf":return this.toPdf();default:return this.error("Invalid target.")}},s.prototype.toContainer=function(){return this.thenList([function(){return this.prop.src||this.error("Cannot duplicate - no source HTML.")},function(){return this.prop.pageSize||this.setPageSize()}]).then(function(){var a={position:"relative",display:"inline-block",width:(typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?Math.max(this.prop.src.clientWidth,this.prop.src.scrollWidth,this.prop.src.offsetWidth):this.opt.windowWidth)+"px",left:0,right:0,top:0,margin:"auto",backgroundColor:this.opt.backgroundColor},o=function A(f,m){for(var _=f.nodeType===3?document.createTextNode(f.nodeValue):f.cloneNode(!1),x=f.firstChild;x;x=x.nextSibling)m!==!0&&x.nodeType===1&&x.nodeName==="SCRIPT"||_.appendChild(A(x,m));return f.nodeType===1&&(f.nodeName==="CANVAS"?(_.width=f.width,_.height=f.height,_.getContext("2d").drawImage(f,0,0)):f.nodeName!=="TEXTAREA"&&f.nodeName!=="SELECT"||(_.value=f.value),_.addEventListener("load",function(){_.scrollTop=f.scrollTop,_.scrollLeft=f.scrollLeft},!0)),_}(this.prop.src,this.opt.html2canvas.javascriptEnabled);o.tagName==="BODY"&&(a.height=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)+"px"),this.prop.overlay=i("div",{className:"html2pdf__overlay",style:{position:"fixed",overflow:"hidden",zIndex:1e3,left:"-100000px",right:0,bottom:0,top:0}}),this.prop.container=i("div",{className:"html2pdf__container",style:a}),this.prop.container.appendChild(o),this.prop.container.firstChild.appendChild(i("div",{style:{clear:"both",border:"0 none transparent",margin:0,padding:0,height:0}})),this.prop.container.style.float="none",this.prop.overlay.appendChild(this.prop.container),document.body.appendChild(this.prop.overlay),this.prop.container.firstChild.style.position="relative",this.prop.container.height=Math.max(this.prop.container.firstChild.clientHeight,this.prop.container.firstChild.scrollHeight,this.prop.container.firstChild.offsetHeight)+"px"})},s.prototype.toCanvas=function(){var a=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(a).then(t).then(function(o){var A=Object.assign({},this.opt.html2canvas);return delete A.onrendered,o(this.prop.container,A)}).then(function(o){(this.opt.html2canvas.onrendered||function(){})(o),this.prop.canvas=o,document.body.removeChild(this.prop.overlay)})},s.prototype.toContext2d=function(){var a=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(a).then(t).then(function(o){var A=this.opt.jsPDF,f=this.opt.fontFaces,m=typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?1:this.opt.width/this.opt.windowWidth,_=Object.assign({async:!0,allowTaint:!0,scale:m,scrollX:this.opt.scrollX||0,scrollY:this.opt.scrollY||0,backgroundColor:"#ffffff",imageTimeout:15e3,logging:!0,proxy:null,removeContainer:!0,foreignObjectRendering:!1,useCORS:!1},this.opt.html2canvas);if(delete _.onrendered,A.context2d.autoPaging=this.opt.autoPaging===void 0||this.opt.autoPaging,A.context2d.posX=this.opt.x,A.context2d.posY=this.opt.y,A.context2d.margin=this.opt.margin,A.context2d.fontFaces=f,f)for(var x=0;x<f.length;++x){var B=f[x],P=B.src.find(function(M){return M.format==="truetype"});P&&A.addFont(P.url,B.ref.name,B.ref.style)}return _.windowHeight=_.windowHeight||0,_.windowHeight=_.windowHeight==0?Math.max(this.prop.container.clientHeight,this.prop.container.scrollHeight,this.prop.container.offsetHeight):_.windowHeight,A.context2d.save(!0),o(this.prop.container,_)}).then(function(o){this.opt.jsPDF.context2d.restore(!0),(this.opt.html2canvas.onrendered||function(){})(o),this.prop.canvas=o,document.body.removeChild(this.prop.overlay)})},s.prototype.toImg=function(){return this.thenList([function(){return this.prop.canvas||this.toCanvas()}]).then(function(){var a=this.prop.canvas.toDataURL("image/"+this.opt.image.type,this.opt.image.quality);this.prop.img=document.createElement("img"),this.prop.img.src=a})},s.prototype.toPdf=function(){return this.thenList([function(){return this.toContext2d()}]).then(function(){this.prop.pdf=this.prop.pdf||this.opt.jsPDF})},s.prototype.output=function(a,o,A){return(A=A||"pdf").toLowerCase()==="img"||A.toLowerCase()==="image"?this.outputImg(a,o):this.outputPdf(a,o)},s.prototype.outputPdf=function(a,o){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){return this.prop.pdf.output(a,o)})},s.prototype.outputImg=function(a){return this.thenList([function(){return this.prop.img||this.toImg()}]).then(function(){switch(a){case void 0:case"img":return this.prop.img;case"datauristring":case"dataurlstring":return this.prop.img.src;case"datauri":case"dataurl":return document.location.href=this.prop.img.src;default:throw'Image output type "'+a+'" is not supported.'}})},s.prototype.save=function(a){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).set(a?{filename:a}:null).then(function(){this.prop.pdf.save(this.opt.filename)})},s.prototype.doCallback=function(){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){this.prop.callback(this.prop.pdf)})},s.prototype.set=function(a){if(n(a)!=="object")return this;var o=Object.keys(a||{}).map(function(A){if(A in s.template.prop)return function(){this.prop[A]=a[A]};switch(A){case"margin":return this.setMargin.bind(this,a.margin);case"jsPDF":return function(){return this.opt.jsPDF=a.jsPDF,this.setPageSize()};case"pageSize":return this.setPageSize.bind(this,a.pageSize);default:return function(){this.opt[A]=a[A]}}},this);return this.then(function(){return this.thenList(o)})},s.prototype.get=function(a,o){return this.then(function(){var A=a in s.template.prop?this.prop[a]:this.opt[a];return o?o(A):A})},s.prototype.setMargin=function(a){return this.then(function(){switch(n(a)){case"number":a=[a,a,a,a];case"array":if(a.length===2&&(a=[a[0],a[1],a[0],a[1]]),a.length===4)break;default:return this.error("Invalid margin array.")}this.opt.margin=a}).then(this.setPageSize)},s.prototype.setPageSize=function(a){function o(A,f){return Math.floor(A*f/72*96)}return this.then(function(){(a=a||qr.getPageSize(this.opt.jsPDF)).hasOwnProperty("inner")||(a.inner={width:a.width-this.opt.margin[1]-this.opt.margin[3],height:a.height-this.opt.margin[0]-this.opt.margin[2]},a.inner.px={width:o(a.inner.width,a.k),height:o(a.inner.height,a.k)},a.inner.ratio=a.inner.height/a.inner.width),this.prop.pageSize=a})},s.prototype.setProgress=function(a,o,A,f){return a!=null&&(this.progress.val=a),o!=null&&(this.progress.state=o),A!=null&&(this.progress.n=A),f!=null&&(this.progress.stack=f),this.progress.ratio=this.progress.val/this.progress.state,this},s.prototype.updateProgress=function(a,o,A,f){return this.setProgress(a?this.progress.val+a:null,o||null,A?this.progress.n+A:null,f?this.progress.stack.concat(f):null)},s.prototype.then=function(a,o){var A=this;return this.thenCore(a,o,function(f,m){return A.updateProgress(null,null,1,[f]),Promise.prototype.then.call(this,function(_){return A.updateProgress(null,f),_}).then(f,m).then(function(_){return A.updateProgress(1),_})})},s.prototype.thenCore=function(a,o,A){A=A||Promise.prototype.then,a&&(a=a.bind(this)),o&&(o=o.bind(this));var f=Promise.toString().indexOf("[native code]")!==-1&&Promise.name==="Promise"?this:s.convert(Object.assign({},this),Promise.prototype),m=A.call(f,a,o);return s.convert(m,this.__proto__)},s.prototype.thenExternal=function(a,o){return Promise.prototype.then.call(this,a,o)},s.prototype.thenList=function(a){var o=this;return a.forEach(function(A){o=o.thenCore(A)}),o},s.prototype.catch=function(a){a&&(a=a.bind(this));var o=Promise.prototype.catch.call(this,a);return s.convert(o,this)},s.prototype.catchExternal=function(a){return Promise.prototype.catch.call(this,a)},s.prototype.error=function(a){return this.then(function(){throw new Error(a)})},s.prototype.using=s.prototype.set,s.prototype.saveAs=s.prototype.save,s.prototype.export=s.prototype.output,s.prototype.run=s.prototype.then,qr.getPageSize=function(a,o,A){if(kn(a)==="object"){var f=a;a=f.orientation,o=f.unit||o,A=f.format||A}o=o||"mm",A=A||"a4",a=(""+(a||"P")).toLowerCase();var m,_=(""+A).toLowerCase(),x={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};switch(o){case"pt":m=1;break;case"mm":m=72/25.4;break;case"cm":m=72/2.54;break;case"in":m=72;break;case"px":m=.75;break;case"pc":case"em":m=12;break;case"ex":m=6;break;default:throw"Invalid unit: "+o}var B,P=0,M=0;if(x.hasOwnProperty(_))P=x[_][1]/m,M=x[_][0]/m;else try{P=A[1],M=A[0]}catch{throw new Error("Invalid format: "+A)}if(a==="p"||a==="portrait")a="p",M>P&&(B=M,M=P,P=B);else{if(a!=="l"&&a!=="landscape")throw"Invalid orientation: "+a;a="l",P>M&&(B=M,M=P,P=B)}return{width:M,height:P,unit:o,k:m,orientation:a}},r.html=function(a,o){(o=o||{}).callback=o.callback||function(){},o.html2canvas=o.html2canvas||{},o.html2canvas.canvas=o.html2canvas.canvas||this.canvas,o.jsPDF=o.jsPDF||this,o.fontFaces=o.fontFaces?o.fontFaces.map(V2):null;var A=new s(o);return o.worker?A:A.from(a).doCallback()}}(qr.API),qr.API.addJS=function(r){return T4=r,this.internal.events.subscribe("postPutResources",function(){My=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/Names [(EmbeddedJS) "+(My+1)+" 0 R]"),this.internal.out(">>"),this.internal.out("endobj"),S4=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /JavaScript"),this.internal.out("/JS ("+T4+")"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){My!==void 0&&S4!==void 0&&this.internal.out("/Names <</JavaScript "+My+" 0 R>>")}),this},function(r){var t;r.events.push(["postPutResources",function(){var e=this,n=/^(\d+) 0 obj$/;if(this.outline.root.children.length>0)for(var i=e.outline.render().split(/\r\n/),s=0;s<i.length;s++){var a=i[s],o=n.exec(a);if(o!=null){var A=o[1];e.internal.newObjectDeferredBegin(A,!1)}e.internal.write(a)}if(this.outline.createNamedDestinations){var f=this.internal.pages.length,m=[];for(s=0;s<f;s++){var _=e.internal.newObject();m.push(_);var x=e.internal.getPageInfo(s+1);e.internal.write("<< /D["+x.objId+" 0 R /XYZ null null null]>> endobj")}var B=e.internal.newObject();for(e.internal.write("<< /Names [ "),s=0;s<m.length;s++)e.internal.write("(page_"+(s+1)+")"+m[s]+" 0 R");e.internal.write(" ] >>","endobj"),t=e.internal.newObject(),e.internal.write("<< /Dests "+B+" 0 R"),e.internal.write(">>","endobj")}}]),r.events.push(["putCatalog",function(){this.outline.root.children.length>0&&(this.internal.write("/Outlines",this.outline.makeRef(this.outline.root)),this.outline.createNamedDestinations&&this.internal.write("/Names "+t+" 0 R"))}]),r.events.push(["initialized",function(){var e=this;e.outline={createNamedDestinations:!1,root:{children:[]}},e.outline.add=function(n,i,s){var a={title:i,options:s,children:[]};return n==null&&(n=this.root),n.children.push(a),a},e.outline.render=function(){return this.ctx={},this.ctx.val="",this.ctx.pdf=e,this.genIds_r(this.root),this.renderRoot(this.root),this.renderItems(this.root),this.ctx.val},e.outline.genIds_r=function(n){n.id=e.internal.newObjectDeferred();for(var i=0;i<n.children.length;i++)this.genIds_r(n.children[i])},e.outline.renderRoot=function(n){this.objStart(n),this.line("/Type /Outlines"),n.children.length>0&&(this.line("/First "+this.makeRef(n.children[0])),this.line("/Last "+this.makeRef(n.children[n.children.length-1]))),this.line("/Count "+this.count_r({count:0},n)),this.objEnd()},e.outline.renderItems=function(n){for(var i=this.ctx.pdf.internal.getVerticalCoordinateString,s=0;s<n.children.length;s++){var a=n.children[s];this.objStart(a),this.line("/Title "+this.makeString(a.title)),this.line("/Parent "+this.makeRef(n)),s>0&&this.line("/Prev "+this.makeRef(n.children[s-1])),s<n.children.length-1&&this.line("/Next "+this.makeRef(n.children[s+1])),a.children.length>0&&(this.line("/First "+this.makeRef(a.children[0])),this.line("/Last "+this.makeRef(a.children[a.children.length-1])));var o=this.count=this.count_r({count:0},a);if(o>0&&this.line("/Count "+o),a.options&&a.options.pageNumber){var A=e.internal.getPageInfo(a.options.pageNumber);this.line("/Dest ["+A.objId+" 0 R /XYZ 0 "+i(0)+" 0]")}this.objEnd()}for(var f=0;f<n.children.length;f++)this.renderItems(n.children[f])},e.outline.line=function(n){this.ctx.val+=n+`\r
`},e.outline.makeRef=function(n){return n.id+" 0 R"},e.outline.makeString=function(n){return"("+e.internal.pdfEscape(n)+")"},e.outline.objStart=function(n){this.ctx.val+=`\r
`+n.id+` 0 obj\r
<<\r
`},e.outline.objEnd=function(){this.ctx.val+=`>> \r
endobj\r
`},e.outline.count_r=function(n,i){for(var s=0;s<i.children.length;s++)n.count++,this.count_r(n,i.children[s]);return n.count}}])}(qr.API),function(r){var t=[192,193,194,195,196,197,198,199];r.processJPEG=function(e,n,i,s,a,o){var A,f=this.decode.DCT_DECODE,m=null;if(typeof e=="string"||this.__addimage__.isArrayBuffer(e)||this.__addimage__.isArrayBufferView(e)){switch(e=a||e,e=this.__addimage__.isArrayBuffer(e)?new Uint8Array(e):e,(A=function(_){for(var x,B=256*_.charCodeAt(4)+_.charCodeAt(5),P=_.length,M={width:0,height:0,numcomponents:1},k=4;k<P;k+=2){if(k+=B,t.indexOf(_.charCodeAt(k+1))!==-1){x=256*_.charCodeAt(k+5)+_.charCodeAt(k+6),M={width:256*_.charCodeAt(k+7)+_.charCodeAt(k+8),height:x,numcomponents:_.charCodeAt(k+9)};break}B=256*_.charCodeAt(k+2)+_.charCodeAt(k+3)}return M}(e=this.__addimage__.isArrayBufferView(e)?this.__addimage__.arrayBufferToBinaryString(e):e)).numcomponents){case 1:o=this.color_spaces.DEVICE_GRAY;break;case 4:o=this.color_spaces.DEVICE_CMYK;break;case 3:o=this.color_spaces.DEVICE_RGB}m={data:e,width:A.width,height:A.height,colorSpace:o,bitsPerComponent:8,filter:f,index:n,alias:i}}return m}}(qr.API);var Pf,Uy,L4,F4,P4,Xrt=function(){var r,t,e;function n(s){var a,o,A,f,m,_,x,B,P,M,k,Q,q,J;for(this.data=s,this.pos=8,this.palette=[],this.imgData=[],this.transparency={},this.animation=null,this.text={},_=null;;){switch(a=this.readUInt32(),P=(function(){var tt,ft;for(ft=[],tt=0;tt<4;++tt)ft.push(String.fromCharCode(this.data[this.pos++]));return ft}).call(this).join("")){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(a);break;case"fcTL":_&&this.animation.frames.push(_),this.pos+=4,_={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()},m=this.readUInt16(),f=this.readUInt16()||100,_.delay=1e3*m/f,_.disposeOp=this.data[this.pos++],_.blendOp=this.data[this.pos++],_.data=[];break;case"IDAT":case"fdAT":for(P==="fdAT"&&(this.pos+=4,a-=4),s=(_!=null?_.data:void 0)||this.imgData,Q=0;0<=a?Q<a:Q>a;0<=a?++Q:--Q)s.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:if(A=this.palette.length/3,this.transparency.indexed=this.read(a),this.transparency.indexed.length>A)throw new Error("More transparent colors than palette size");if((M=A-this.transparency.indexed.length)>0)for(q=0;0<=M?q<M:q>M;0<=M?++q:--q)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(a)[0];break;case 2:this.transparency.rgb=this.read(a)}break;case"tEXt":x=(k=this.read(a)).indexOf(0),B=String.fromCharCode.apply(String,k.slice(0,x)),this.text[B]=String.fromCharCode.apply(String,k.slice(x+1));break;case"IEND":return _&&this.animation.frames.push(_),this.colors=(function(){switch(this.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}).call(this),this.hasAlphaChannel=(J=this.colorType)===4||J===6,o=this.colors+(this.hasAlphaChannel?1:0),this.pixelBitlength=this.bits*o,this.colorSpace=(function(){switch(this.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}).call(this),void(this.imgData=new Uint8Array(this.imgData));default:this.pos+=a}if(this.pos+=4,this.pos>this.data.length)throw new Error("Incomplete or corrupt PNG file")}}n.prototype.read=function(s){var a,o;for(o=[],a=0;0<=s?a<s:a>s;0<=s?++a:--a)o.push(this.data[this.pos++]);return o},n.prototype.readUInt32=function(){return this.data[this.pos++]<<24|this.data[this.pos++]<<16|this.data[this.pos++]<<8|this.data[this.pos++]},n.prototype.readUInt16=function(){return this.data[this.pos++]<<8|this.data[this.pos++]},n.prototype.decodePixels=function(s){var a=this.pixelBitlength/8,o=new Uint8Array(this.width*this.height*a),A=0,f=this;if(s==null&&(s=this.imgData),s.length===0)return new Uint8Array(0);function m(_,x,B,P){var M,k,Q,q,J,tt,ft,pt,mt,dt,Rt,Lt,st,ct,wt,yt,te,Zt,re,Xt,ne,se=Math.ceil((f.width-_)/B),we=Math.ceil((f.height-x)/P),it=f.width==se&&f.height==we;for(ct=a*se,Lt=it?o:new Uint8Array(ct*we),tt=s.length,st=0,k=0;st<we&&A<tt;){switch(s[A++]){case 0:for(q=te=0;te<ct;q=te+=1)Lt[k++]=s[A++];break;case 1:for(q=Zt=0;Zt<ct;q=Zt+=1)M=s[A++],J=q<a?0:Lt[k-a],Lt[k++]=(M+J)%256;break;case 2:for(q=re=0;re<ct;q=re+=1)M=s[A++],Q=(q-q%a)/a,wt=st&&Lt[(st-1)*ct+Q*a+q%a],Lt[k++]=(wt+M)%256;break;case 3:for(q=Xt=0;Xt<ct;q=Xt+=1)M=s[A++],Q=(q-q%a)/a,J=q<a?0:Lt[k-a],wt=st&&Lt[(st-1)*ct+Q*a+q%a],Lt[k++]=(M+Math.floor((J+wt)/2))%256;break;case 4:for(q=ne=0;ne<ct;q=ne+=1)M=s[A++],Q=(q-q%a)/a,J=q<a?0:Lt[k-a],st===0?wt=yt=0:(wt=Lt[(st-1)*ct+Q*a+q%a],yt=Q&&Lt[(st-1)*ct+(Q-1)*a+q%a]),ft=J+wt-yt,pt=Math.abs(ft-J),dt=Math.abs(ft-wt),Rt=Math.abs(ft-yt),mt=pt<=dt&&pt<=Rt?J:dt<=Rt?wt:yt,Lt[k++]=(M+mt)%256;break;default:throw new Error("Invalid filter algorithm: "+s[A-1])}if(!it){var vt=((x+st*P)*f.width+_)*a,Ft=st*ct;for(q=0;q<se;q+=1){for(var Ot=0;Ot<a;Ot+=1)o[vt++]=Lt[Ft++];vt+=(B-1)*a}}st++}}return s=Lrt(s),f.interlaceMethod==1?(m(0,0,8,8),m(4,0,8,8),m(0,4,4,8),m(2,0,4,4),m(0,2,2,4),m(1,0,2,2),m(0,1,1,2)):m(0,0,1,1),o},n.prototype.decodePalette=function(){var s,a,o,A,f,m,_,x,B;for(o=this.palette,m=this.transparency.indexed||[],f=new Uint8Array((m.length||0)+o.length),A=0,s=0,a=_=0,x=o.length;_<x;a=_+=3)f[A++]=o[a],f[A++]=o[a+1],f[A++]=o[a+2],f[A++]=(B=m[s++])!=null?B:255;return f},n.prototype.copyToImageData=function(s,a){var o,A,f,m,_,x,B,P,M,k,Q;if(A=this.colors,M=null,o=this.hasAlphaChannel,this.palette.length&&(M=(Q=this._decodedPalette)!=null?Q:this._decodedPalette=this.decodePalette(),A=4,o=!0),P=(f=s.data||s).length,_=M||a,m=x=0,A===1)for(;m<P;)B=M?4*a[m/4]:x,k=_[B++],f[m++]=k,f[m++]=k,f[m++]=k,f[m++]=o?_[B++]:255,x=B;else for(;m<P;)B=M?4*a[m/4]:x,f[m++]=_[B++],f[m++]=_[B++],f[m++]=_[B++],f[m++]=o?_[B++]:255,x=B},n.prototype.decode=function(){var s;return s=new Uint8Array(this.width*this.height*4),this.copyToImageData(s,this.decodePixels()),s};var i=function(){if(Object.prototype.toString.call(jr)==="[object Window]"){try{t=jr.document.createElement("canvas"),e=t.getContext("2d")}catch{return!1}return!0}return!1};return i(),r=function(s){var a;if(i()===!0)return e.width=s.width,e.height=s.height,e.clearRect(0,0,s.width,s.height),e.putImageData(s,0,0),(a=new Image).src=t.toDataURL(),a;throw new Error("This method requires a Browser with Canvas-capability.")},n.prototype.decodeFrames=function(s){var a,o,A,f,m,_,x,B;if(this.animation){for(B=[],o=m=0,_=(x=this.animation.frames).length;m<_;o=++m)a=x[o],A=s.createImageData(a.width,a.height),f=this.decodePixels(new Uint8Array(a.data)),this.copyToImageData(A,f),a.imageData=A,B.push(a.image=r(A));return B}},n.prototype.renderFrame=function(s,a){var o,A,f;return o=(A=this.animation.frames)[a],f=A[a-1],a===0&&s.clearRect(0,0,this.width,this.height),(f!=null?f.disposeOp:void 0)===1?s.clearRect(f.xOffset,f.yOffset,f.width,f.height):(f!=null?f.disposeOp:void 0)===2&&s.putImageData(f.imageData,f.xOffset,f.yOffset),o.blendOp===0&&s.clearRect(o.xOffset,o.yOffset,o.width,o.height),s.drawImage(o.image,o.xOffset,o.yOffset)},n.prototype.animate=function(s){var a,o,A,f,m,_,x=this;return o=0,_=this.animation,f=_.numFrames,A=_.frames,m=_.numPlays,(a=function(){var B,P;if(B=o++%f,P=A[B],x.renderFrame(s,B),f>1&&o/f<m)return x.animation._timeout=setTimeout(a,P.delay)})()},n.prototype.stopAnimation=function(){var s;return clearTimeout((s=this.animation)!=null?s._timeout:void 0)},n.prototype.render=function(s){var a,o;return s._png&&s._png.stopAnimation(),s._png=this,s.width=this.width,s.height=this.height,a=s.getContext("2d"),this.animation?(this.decodeFrames(a),this.animate(a)):(o=a.createImageData(this.width,this.height),this.copyToImageData(o,this.decodePixels()),a.putImageData(o,0,0))},n}();/**
* @license
*
* Copyright (c) 2014 James Robb, https://github.com/jamesbrobb
*
* Permission is hereby granted, free of charge, to any person obtaining
* a copy of this software and associated documentation files (the
* "Software"), to deal in the Software without restriction, including
* without limitation the rights to use, copy, modify, merge, publish,
* distribute, sublicense, and/or sell copies of the Software, and to
* permit persons to whom the Software is furnished to do so, subject to
* the following conditions:
*
* The above copyright notice and this permission notice shall be
* included in all copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
* MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
* LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
* OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
* WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
* ====================================================================
*//**
* @license
* (c) Dean McNamee <dean@gmail.com>, 2013.
*
* https://github.com/deanm/omggif
*
* Permission is hereby granted, free of charge, to any person obtaining a copy
* of this software and associated documentation files (the "Software"), to
* deal in the Software without restriction, including without limitation the
* rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
* sell copies of the Software, and to permit persons to whom the Software is
* furnished to do so, subject to the following conditions:
*
* The above copyright notice and this permission notice shall be included in
* all copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
* FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
* AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
* LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
* FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
* IN THE SOFTWARE.
*
* omggif is a JavaScript implementation of a GIF 89a encoder and decoder,
* including animation and compression.  It does not rely on any specific
* underlying system, so should run in the browser, Node, or Plask.
*/function Jrt(r){var t=0;if(r[t++]!==71||r[t++]!==73||r[t++]!==70||r[t++]!==56||(r[t++]+1&253)!=56||r[t++]!==97)throw new Error("Invalid GIF 87a/89a header.");var e=r[t++]|r[t++]<<8,n=r[t++]|r[t++]<<8,i=r[t++],s=i>>7,a=1<<(7&i)+1;r[t++],r[t++];var o=null,A=null;s&&(o=t,A=a,t+=3*a);var f=!0,m=[],_=0,x=null,B=0,P=null;for(this.width=e,this.height=n;f&&t<r.length;)switch(r[t++]){case 33:switch(r[t++]){case 255:if(r[t]!==11||r[t+1]==78&&r[t+2]==69&&r[t+3]==84&&r[t+4]==83&&r[t+5]==67&&r[t+6]==65&&r[t+7]==80&&r[t+8]==69&&r[t+9]==50&&r[t+10]==46&&r[t+11]==48&&r[t+12]==3&&r[t+13]==1&&r[t+16]==0)t+=14,P=r[t++]|r[t++]<<8,t++;else for(t+=12;;){if(!((st=r[t++])>=0))throw Error("Invalid block size");if(st===0)break;t+=st}break;case 249:if(r[t++]!==4||r[t+4]!==0)throw new Error("Invalid graphics extension block.");var M=r[t++];_=r[t++]|r[t++]<<8,x=r[t++],!(1&M)&&(x=null),B=M>>2&7,t++;break;case 254:for(;;){if(!((st=r[t++])>=0))throw Error("Invalid block size");if(st===0)break;t+=st}break;default:throw new Error("Unknown graphic control label: 0x"+r[t-1].toString(16))}break;case 44:var k=r[t++]|r[t++]<<8,Q=r[t++]|r[t++]<<8,q=r[t++]|r[t++]<<8,J=r[t++]|r[t++]<<8,tt=r[t++],ft=tt>>6&1,pt=1<<(7&tt)+1,mt=o,dt=A,Rt=!1;tt>>7&&(Rt=!0,mt=t,dt=pt,t+=3*pt);var Lt=t;for(t++;;){var st;if(!((st=r[t++])>=0))throw Error("Invalid block size");if(st===0)break;t+=st}m.push({x:k,y:Q,width:q,height:J,has_local_palette:Rt,palette_offset:mt,palette_size:dt,data_offset:Lt,data_length:t-Lt,transparent_index:x,interlaced:!!ft,delay:_,disposal:B});break;case 59:f=!1;break;default:throw new Error("Unknown gif block: 0x"+r[t-1].toString(16))}this.numFrames=function(){return m.length},this.loopCount=function(){return P},this.frameInfo=function(ct){if(ct<0||ct>=m.length)throw new Error("Frame index out of range.");return m[ct]},this.decodeAndBlitFrameBGRA=function(ct,wt){var yt=this.frameInfo(ct),te=yt.width*yt.height,Zt=new Uint8Array(te);M4(r,yt.data_offset,Zt,te);var re=yt.palette_offset,Xt=yt.transparent_index;Xt===null&&(Xt=256);var ne=yt.width,se=e-ne,we=ne,it=4*(yt.y*e+yt.x),vt=4*((yt.y+yt.height)*e+yt.x),Ft=it,Ot=4*se;yt.interlaced===!0&&(Ot+=4*e*7);for(var $t=8,jt=0,ae=Zt.length;jt<ae;++jt){var ie=Zt[jt];if(we===0&&(we=ne,(Ft+=Ot)>=vt&&(Ot=4*se+4*e*($t-1),Ft=it+(ne+se)*($t<<1),$t>>=1)),ie===Xt)Ft+=4;else{var Be=r[re+3*ie],Ie=r[re+3*ie+1],Qe=r[re+3*ie+2];wt[Ft++]=Qe,wt[Ft++]=Ie,wt[Ft++]=Be,wt[Ft++]=255}--we}},this.decodeAndBlitFrameRGBA=function(ct,wt){var yt=this.frameInfo(ct),te=yt.width*yt.height,Zt=new Uint8Array(te);M4(r,yt.data_offset,Zt,te);var re=yt.palette_offset,Xt=yt.transparent_index;Xt===null&&(Xt=256);var ne=yt.width,se=e-ne,we=ne,it=4*(yt.y*e+yt.x),vt=4*((yt.y+yt.height)*e+yt.x),Ft=it,Ot=4*se;yt.interlaced===!0&&(Ot+=4*e*7);for(var $t=8,jt=0,ae=Zt.length;jt<ae;++jt){var ie=Zt[jt];if(we===0&&(we=ne,(Ft+=Ot)>=vt&&(Ot=4*se+4*e*($t-1),Ft=it+(ne+se)*($t<<1),$t>>=1)),ie===Xt)Ft+=4;else{var Be=r[re+3*ie],Ie=r[re+3*ie+1],Qe=r[re+3*ie+2];wt[Ft++]=Be,wt[Ft++]=Ie,wt[Ft++]=Qe,wt[Ft++]=255}--we}}}function M4(r,t,e,n){for(var i=r[t++],s=1<<i,a=s+1,o=a+1,A=i+1,f=(1<<A)-1,m=0,_=0,x=0,B=r[t++],P=new Int32Array(4096),M=null;;){for(;m<16&&B!==0;)_|=r[t++]<<m,m+=8,B===1?B=r[t++]:--B;if(m<A)break;var k=_&f;if(_>>=A,m-=A,k!==s){if(k===a)break;for(var Q=k<o?k:M,q=0,J=Q;J>s;)J=P[J]>>8,++q;var tt=J;if(x+q+(Q!==k?1:0)>n)return void ui.log("Warning, gif stream longer than expected.");e[x++]=tt;var ft=x+=q;for(Q!==k&&(e[x++]=tt),J=Q;q--;)J=P[J],e[--ft]=255&J,J>>=8;M!==null&&o<4096&&(P[o++]=M<<8|tt,o>=f+1&&A<12&&(++A,f=f<<1|1)),M=k}else o=a+1,f=(1<<(A=i+1))-1,M=null}return x!==n&&ui.log("Warning, gif stream shorter than expected."),e}/**
	 * @license
	  Copyright (c) 2008, Adobe Systems Incorporated
	  All rights reserved.

	  Redistribution and use in source and binary forms, with or without 
	  modification, are permitted provided that the following conditions are
	  met:

	  * Redistributions of source code must retain the above copyright notice, 
	    this list of conditions and the following disclaimer.
	  
	  * Redistributions in binary form must reproduce the above copyright
	    notice, this list of conditions and the following disclaimer in the 
	    documentation and/or other materials provided with the distribution.
	  
	  * Neither the name of Adobe Systems Incorporated nor the names of its 
	    contributors may be used to endorse or promote products derived from 
	    this software without specific prior written permission.

	  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS
	  IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
	  THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
	  PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR 
	  CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
	  EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
	  PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
	  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
	  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
	  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
	  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
	*/function j2(r){var t,e,n,i,s,a=Math.floor,o=new Array(64),A=new Array(64),f=new Array(64),m=new Array(64),_=new Array(65535),x=new Array(65535),B=new Array(64),P=new Array(64),M=[],k=0,Q=7,q=new Array(64),J=new Array(64),tt=new Array(64),ft=new Array(256),pt=new Array(2048),mt=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],dt=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],Rt=[0,1,2,3,4,5,6,7,8,9,10,11],Lt=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],st=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],ct=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],wt=[0,1,2,3,4,5,6,7,8,9,10,11],yt=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],te=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function Zt(it,vt){for(var Ft=0,Ot=0,$t=new Array,jt=1;jt<=16;jt++){for(var ae=1;ae<=it[jt];ae++)$t[vt[Ot]]=[],$t[vt[Ot]][0]=Ft,$t[vt[Ot]][1]=jt,Ot++,Ft++;Ft*=2}return $t}function re(it){for(var vt=it[0],Ft=it[1]-1;Ft>=0;)vt&1<<Ft&&(k|=1<<Q),Ft--,--Q<0&&(k==255?(Xt(255),Xt(0)):Xt(k),Q=7,k=0)}function Xt(it){M.push(it)}function ne(it){Xt(it>>8&255),Xt(255&it)}function se(it,vt,Ft,Ot,$t){for(var jt,ae=$t[0],ie=$t[240],Be=function(Se,_e){var xe,Ne,ir,Ar,Lr,Tr,Nr,Qr,fe,Ir,De=0;for(fe=0;fe<8;++fe){xe=Se[De],Ne=Se[De+1],ir=Se[De+2],Ar=Se[De+3],Lr=Se[De+4],Tr=Se[De+5],Nr=Se[De+6];var xn=xe+(Qr=Se[De+7]),Pr=xe-Qr,Te=Ne+Nr,Je=Ne-Nr,Ke=ir+Tr,Yr=ir-Tr,Or=Ar+Lr,gr=Ar-Lr,an=xn+Or,$r=xn-Or,Ct=Te+Ke,Z=Te-Ke;Se[De]=an+Ct,Se[De+4]=an-Ct;var Y=.707106781*(Z+$r);Se[De+2]=$r+Y,Se[De+6]=$r-Y;var ot=.382683433*((an=gr+Yr)-(Z=Je+Pr)),Et=.5411961*an+ot,kt=1.306562965*Z+ot,zt=.707106781*(Ct=Yr+Je),qt=Pr+zt,St=Pr-zt;Se[De+5]=St+Et,Se[De+3]=St-Et,Se[De+1]=qt+kt,Se[De+7]=qt-kt,De+=8}for(De=0,fe=0;fe<8;++fe){xe=Se[De],Ne=Se[De+8],ir=Se[De+16],Ar=Se[De+24],Lr=Se[De+32],Tr=Se[De+40],Nr=Se[De+48];var Yt=xe+(Qr=Se[De+56]),me=xe-Qr,pe=Ne+Nr,de=Ne-Nr,Ve=ir+Tr,Ye=ir-Tr,Er=Ar+Lr,lr=Ar-Lr,Ur=Yt+Er,kr=Yt-Er,Hr=pe+Ve,mn=pe-Ve;Se[De]=Ur+Hr,Se[De+32]=Ur-Hr;var mr=.707106781*(mn+kr);Se[De+16]=kr+mr,Se[De+48]=kr-mr;var Wr=.382683433*((Ur=lr+Ye)-(mn=de+me)),bn=.5411961*Ur+Wr,Qn=1.306562965*mn+Wr,Dt=.707106781*(Hr=Ye+de),Re=me+Dt,Le=me-Dt;Se[De+40]=Le+bn,Se[De+24]=Le-bn,Se[De+8]=Re+Qn,Se[De+56]=Re-Qn,De++}for(fe=0;fe<64;++fe)Ir=Se[fe]*_e[fe],B[fe]=Ir>0?Ir+.5|0:Ir-.5|0;return B}(it,vt),Ie=0;Ie<64;++Ie)P[mt[Ie]]=Be[Ie];var Qe=P[0]-Ft;Ft=P[0],Qe==0?re(Ot[0]):(re(Ot[x[jt=32767+Qe]]),re(_[jt]));for(var He=63;He>0&&P[He]==0;)He--;if(He==0)return re(ae),Ft;for(var ze,ge=1;ge<=He;){for(var Ut=ge;P[ge]==0&&ge<=He;)++ge;var Jt=ge-Ut;if(Jt>=16){ze=Jt>>4;for(var er=1;er<=ze;++er)re(ie);Jt&=15}jt=32767+P[ge],re($t[(Jt<<4)+x[jt]]),re(_[jt]),ge++}return He!=63&&re(ae),Ft}function we(it){it=Math.min(Math.max(it,1),100),s!=it&&(function(vt){for(var Ft=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],Ot=0;Ot<64;Ot++){var $t=a((Ft[Ot]*vt+50)/100);$t=Math.min(Math.max($t,1),255),o[mt[Ot]]=$t}for(var jt=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],ae=0;ae<64;ae++){var ie=a((jt[ae]*vt+50)/100);ie=Math.min(Math.max(ie,1),255),A[mt[ae]]=ie}for(var Be=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],Ie=0,Qe=0;Qe<8;Qe++)for(var He=0;He<8;He++)f[Ie]=1/(o[mt[Ie]]*Be[Qe]*Be[He]*8),m[Ie]=1/(A[mt[Ie]]*Be[Qe]*Be[He]*8),Ie++}(it<50?Math.floor(5e3/it):Math.floor(200-2*it)),s=it)}this.encode=function(it,vt){vt&&we(vt),M=new Array,k=0,Q=7,ne(65496),ne(65504),ne(16),Xt(74),Xt(70),Xt(73),Xt(70),Xt(0),Xt(1),Xt(1),Xt(0),ne(1),ne(1),Xt(0),Xt(0),function(){ne(65499),ne(132),Xt(0);for(var Ne=0;Ne<64;Ne++)Xt(o[Ne]);Xt(1);for(var ir=0;ir<64;ir++)Xt(A[ir])}(),function(Ne,ir){ne(65472),ne(17),Xt(8),ne(ir),ne(Ne),Xt(3),Xt(1),Xt(17),Xt(0),Xt(2),Xt(17),Xt(1),Xt(3),Xt(17),Xt(1)}(it.width,it.height),function(){ne(65476),ne(418),Xt(0);for(var Ne=0;Ne<16;Ne++)Xt(dt[Ne+1]);for(var ir=0;ir<=11;ir++)Xt(Rt[ir]);Xt(16);for(var Ar=0;Ar<16;Ar++)Xt(Lt[Ar+1]);for(var Lr=0;Lr<=161;Lr++)Xt(st[Lr]);Xt(1);for(var Tr=0;Tr<16;Tr++)Xt(ct[Tr+1]);for(var Nr=0;Nr<=11;Nr++)Xt(wt[Nr]);Xt(17);for(var Qr=0;Qr<16;Qr++)Xt(yt[Qr+1]);for(var fe=0;fe<=161;fe++)Xt(te[fe])}(),ne(65498),ne(12),Xt(3),Xt(1),Xt(0),Xt(2),Xt(17),Xt(3),Xt(17),Xt(0),Xt(63),Xt(0);var Ft=0,Ot=0,$t=0;k=0,Q=7,this.encode.displayName="_encode_";for(var jt,ae,ie,Be,Ie,Qe,He,ze,ge,Ut=it.data,Jt=it.width,er=it.height,Se=4*Jt,_e=0;_e<er;){for(jt=0;jt<Se;){for(Ie=Se*_e+jt,He=-1,ze=0,ge=0;ge<64;ge++)Qe=Ie+(ze=ge>>3)*Se+(He=4*(7&ge)),_e+ze>=er&&(Qe-=Se*(_e+1+ze-er)),jt+He>=Se&&(Qe-=jt+He-Se+4),ae=Ut[Qe++],ie=Ut[Qe++],Be=Ut[Qe++],q[ge]=(pt[ae]+pt[ie+256>>0]+pt[Be+512>>0]>>16)-128,J[ge]=(pt[ae+768>>0]+pt[ie+1024>>0]+pt[Be+1280>>0]>>16)-128,tt[ge]=(pt[ae+1280>>0]+pt[ie+1536>>0]+pt[Be+1792>>0]>>16)-128;Ft=se(q,f,Ft,t,n),Ot=se(J,m,Ot,e,i),$t=se(tt,m,$t,e,i),jt+=32}_e+=8}if(Q>=0){var xe=[];xe[1]=Q+1,xe[0]=(1<<Q+1)-1,re(xe)}return ne(65497),new Uint8Array(M)},r=r||50,function(){for(var it=String.fromCharCode,vt=0;vt<256;vt++)ft[vt]=it(vt)}(),t=Zt(dt,Rt),e=Zt(ct,wt),n=Zt(Lt,st),i=Zt(yt,te),function(){for(var it=1,vt=2,Ft=1;Ft<=15;Ft++){for(var Ot=it;Ot<vt;Ot++)x[32767+Ot]=Ft,_[32767+Ot]=[],_[32767+Ot][1]=Ft,_[32767+Ot][0]=Ot;for(var $t=-(vt-1);$t<=-it;$t++)x[32767+$t]=Ft,_[32767+$t]=[],_[32767+$t][1]=Ft,_[32767+$t][0]=vt-1+$t;it<<=1,vt<<=1}}(),function(){for(var it=0;it<256;it++)pt[it]=19595*it,pt[it+256>>0]=38470*it,pt[it+512>>0]=7471*it+32768,pt[it+768>>0]=-11059*it,pt[it+1024>>0]=-21709*it,pt[it+1280>>0]=32768*it+8421375,pt[it+1536>>0]=-27439*it,pt[it+1792>>0]=-5329*it}(),we(r)}/**
* @license
* Copyright (c) 2017 Aras Abbasi
*
* Licensed under the MIT License.
* http://opensource.org/licenses/mit-license
*/function Jc(r,t){if(this.pos=0,this.buffer=r,this.datav=new DataView(r.buffer),this.is_with_alpha=!!t,this.bottom_up=!0,this.flag=String.fromCharCode(this.buffer[0])+String.fromCharCode(this.buffer[1]),this.pos+=2,["BM","BA","CI","CP","IC","PT"].indexOf(this.flag)===-1)throw new Error("Invalid BMP File");this.parseHeader(),this.parseBGR()}function U4(r){function t(dt){if(!dt)throw Error("assert :P")}function e(dt,Rt,Lt){for(var st=0;4>st;st++)if(dt[Rt+st]!=Lt.charCodeAt(st))return!0;return!1}function n(dt,Rt,Lt,st,ct){for(var wt=0;wt<ct;wt++)dt[Rt+wt]=Lt[st+wt]}function i(dt,Rt,Lt,st){for(var ct=0;ct<st;ct++)dt[Rt+ct]=Lt}function s(dt){return new Int32Array(dt)}function a(dt,Rt){for(var Lt=[],st=0;st<dt;st++)Lt.push(new Rt);return Lt}function o(dt,Rt){var Lt=[];return function st(ct,wt,yt){for(var te=yt[wt],Zt=0;Zt<te&&(ct.push(yt.length>wt+1?[]:new Rt),!(yt.length<wt+1));Zt++)st(ct[Zt],wt+1,yt)}(Lt,0,dt),Lt}var A=function(){var dt=this;function Rt(g,w){for(var T=1<<w-1>>>0;g&T;)T>>>=1;return T?(g&T-1)+T:g}function Lt(g,w,T,L,D){t(!(L%T));do g[w+(L-=T)]=D;while(0<L)}function st(g,w,T,L,D){if(t(2328>=D),512>=D)var H=s(512);else if((H=s(D))==null)return 0;return function(z,j,V,W,lt,rt){var ht,gt,Mt=j,Tt=1<<V,_t=s(16),bt=s(16);for(t(lt!=0),t(W!=null),t(z!=null),t(0<V),gt=0;gt<lt;++gt){if(15<W[gt])return 0;++_t[W[gt]]}if(_t[0]==lt)return 0;for(bt[1]=0,ht=1;15>ht;++ht){if(_t[ht]>1<<ht)return 0;bt[ht+1]=bt[ht]+_t[ht]}for(gt=0;gt<lt;++gt)ht=W[gt],0<W[gt]&&(rt[bt[ht]++]=gt);if(bt[15]==1)return(W=new ct).g=0,W.value=rt[0],Lt(z,Mt,1,Tt,W),Tt;var Gt,Wt=-1,ue=Tt-1,Ae=0,ye=1,Oe=1,Ce=1<<V;for(gt=0,ht=1,lt=2;ht<=V;++ht,lt<<=1){if(ye+=Oe<<=1,0>(Oe-=_t[ht]))return 0;for(;0<_t[ht];--_t[ht])(W=new ct).g=ht,W.value=rt[gt++],Lt(z,Mt+Ae,lt,Ce,W),Ae=Rt(Ae,ht)}for(ht=V+1,lt=2;15>=ht;++ht,lt<<=1){if(ye+=Oe<<=1,0>(Oe-=_t[ht]))return 0;for(;0<_t[ht];--_t[ht]){if(W=new ct,(Ae&ue)!=Wt){for(Mt+=Ce,Gt=1<<(Wt=ht)-V;15>Wt&&!(0>=(Gt-=_t[Wt]));)++Wt,Gt<<=1;Tt+=Ce=1<<(Gt=Wt-V),z[j+(Wt=Ae&ue)].g=Gt+V,z[j+Wt].value=Mt-j-Wt}W.g=ht-V,W.value=rt[gt++],Lt(z,Mt+(Ae>>V),lt,Ce,W),Ae=Rt(Ae,ht)}}return ye!=2*bt[15]-1?0:Tt}(g,w,T,L,D,H)}function ct(){this.value=this.g=0}function wt(){this.value=this.g=0}function yt(){this.G=a(5,ct),this.H=s(5),this.jc=this.Qb=this.qb=this.nd=0,this.pd=a(ls,wt)}function te(g,w,T,L){t(g!=null),t(w!=null),t(2147483648>L),g.Ca=254,g.I=0,g.b=-8,g.Ka=0,g.oa=w,g.pa=T,g.Jd=w,g.Yc=T+L,g.Zc=4<=L?T+L-4+1:T,jt(g)}function Zt(g,w){for(var T=0;0<w--;)T|=ie(g,128)<<w;return T}function re(g,w){var T=Zt(g,w);return ae(g)?-T:T}function Xt(g,w,T,L){var D,H=0;for(t(g!=null),t(w!=null),t(4294967288>L),g.Sb=L,g.Ra=0,g.u=0,g.h=0,4<L&&(L=4),D=0;D<L;++D)H+=w[T+D]<<8*D;g.Ra=H,g.bb=L,g.oa=w,g.pa=T}function ne(g){for(;8<=g.u&&g.bb<g.Sb;)g.Ra>>>=8,g.Ra+=g.oa[g.pa+g.bb]<<vl-8>>>0,++g.bb,g.u-=8;Ft(g)&&(g.h=1,g.u=0)}function se(g,w){if(t(0<=w),!g.h&&w<=_l){var T=vt(g)&Tc[w];return g.u+=w,ne(g),T}return g.h=1,g.u=0}function we(){this.b=this.Ca=this.I=0,this.oa=[],this.pa=0,this.Jd=[],this.Yc=0,this.Zc=[],this.Ka=0}function it(){this.Ra=0,this.oa=[],this.h=this.u=this.bb=this.Sb=this.pa=0}function vt(g){return g.Ra>>>(g.u&vl-1)>>>0}function Ft(g){return t(g.bb<=g.Sb),g.h||g.bb==g.Sb&&g.u>vl}function Ot(g,w){g.u=w,g.h=Ft(g)}function $t(g){g.u>=Ic&&(t(g.u>=Ic),ne(g))}function jt(g){t(g!=null&&g.oa!=null),g.pa<g.Zc?(g.I=(g.oa[g.pa++]|g.I<<8)>>>0,g.b+=8):(t(g!=null&&g.oa!=null),g.pa<g.Yc?(g.b+=8,g.I=g.oa[g.pa++]|g.I<<8):g.Ka?g.b=0:(g.I<<=8,g.b+=8,g.Ka=1))}function ae(g){return Zt(g,1)}function ie(g,w){var T=g.Ca;0>g.b&&jt(g);var L=g.b,D=T*w>>>8,H=(g.I>>>L>D)+0;for(H?(T-=D,g.I-=D+1<<L>>>0):T=D+1,L=T,D=0;256<=L;)D+=8,L>>=8;return L=7^D+ws[L],g.b-=L,g.Ca=(T<<L)-1,H}function Be(g,w,T){g[w+0]=T>>24&255,g[w+1]=T>>16&255,g[w+2]=T>>8&255,g[w+3]=T>>0&255}function Ie(g,w){return g[w+0]<<0|g[w+1]<<8}function Qe(g,w){return Ie(g,w)|g[w+2]<<16}function He(g,w){return Ie(g,w)|Ie(g,w+2)<<16}function ze(g,w){var T=1<<w;return t(g!=null),t(0<w),g.X=s(T),g.X==null?0:(g.Mb=32-w,g.Xa=w,1)}function ge(g,w){t(g!=null),t(w!=null),t(g.Xa==w.Xa),n(w.X,0,g.X,0,1<<w.Xa)}function Ut(){this.X=[],this.Xa=this.Mb=0}function Jt(g,w,T,L){t(T!=null),t(L!=null);var D=T[0],H=L[0];return D==0&&(D=(g*H+w/2)/w),H==0&&(H=(w*D+g/2)/g),0>=D||0>=H?0:(T[0]=D,L[0]=H,1)}function er(g,w){return g+(1<<w)-1>>>w}function Se(g,w){return((4278255360&g)+(4278255360&w)>>>0&4278255360)+((16711935&g)+(16711935&w)>>>0&16711935)>>>0}function _e(g,w){dt[w]=function(T,L,D,H,z,j,V){var W;for(W=0;W<z;++W){var lt=dt[g](j[V+W-1],D,H+W);j[V+W]=Se(T[L+W],lt)}}}function xe(){this.ud=this.hd=this.jd=0}function Ne(g,w){return((4278124286&(g^w))>>>1)+(g&w)>>>0}function ir(g){return 0<=g&&256>g?g:0>g?0:255<g?255:void 0}function Ar(g,w){return ir(g+(g-w+.5>>1))}function Lr(g,w,T){return Math.abs(w-T)-Math.abs(g-T)}function Tr(g,w,T,L,D,H,z){for(L=H[z-1],T=0;T<D;++T)H[z+T]=L=Se(g[w+T],L)}function Nr(g,w,T,L,D){var H;for(H=0;H<T;++H){var z=g[w+H],j=z>>8&255,V=16711935&(V=(V=16711935&z)+((j<<16)+j));L[D+H]=(4278255360&z)+V>>>0}}function Qr(g,w){w.jd=g>>0&255,w.hd=g>>8&255,w.ud=g>>16&255}function fe(g,w,T,L,D,H){var z;for(z=0;z<L;++z){var j=w[T+z],V=j>>>8,W=j,lt=255&(lt=(lt=j>>>16)+((g.jd<<24>>24)*(V<<24>>24)>>>5));W=255&(W=(W=W+((g.hd<<24>>24)*(V<<24>>24)>>>5))+((g.ud<<24>>24)*(lt<<24>>24)>>>5)),D[H+z]=(4278255360&j)+(lt<<16)+W}}function Ir(g,w,T,L,D){dt[w]=function(H,z,j,V,W,lt,rt,ht,gt){for(V=rt;V<ht;++V)for(rt=0;rt<gt;++rt)W[lt++]=D(j[L(H[z++])])},dt[g]=function(H,z,j,V,W,lt,rt){var ht=8>>H.b,gt=H.Ea,Mt=H.K[0],Tt=H.w;if(8>ht)for(H=(1<<H.b)-1,Tt=(1<<ht)-1;z<j;++z){var _t,bt=0;for(_t=0;_t<gt;++_t)_t&H||(bt=L(V[W++])),lt[rt++]=D(Mt[bt&Tt]),bt>>=ht}else dt["VP8LMapColor"+T](V,W,Mt,Tt,lt,rt,z,j,gt)}}function De(g,w,T,L,D){for(T=w+T;w<T;){var H=g[w++];L[D++]=H>>16&255,L[D++]=H>>8&255,L[D++]=H>>0&255}}function xn(g,w,T,L,D){for(T=w+T;w<T;){var H=g[w++];L[D++]=H>>16&255,L[D++]=H>>8&255,L[D++]=H>>0&255,L[D++]=H>>24&255}}function Pr(g,w,T,L,D){for(T=w+T;w<T;){var H=(z=g[w++])>>16&240|z>>12&15,z=z>>0&240|z>>28&15;L[D++]=H,L[D++]=z}}function Te(g,w,T,L,D){for(T=w+T;w<T;){var H=(z=g[w++])>>16&248|z>>13&7,z=z>>5&224|z>>3&31;L[D++]=H,L[D++]=z}}function Je(g,w,T,L,D){for(T=w+T;w<T;){var H=g[w++];L[D++]=H>>0&255,L[D++]=H>>8&255,L[D++]=H>>16&255}}function Ke(g,w,T,L,D,H){if(H==0)for(T=w+T;w<T;)Be(L,((H=g[w++])[0]>>24|H[1]>>8&65280|H[2]<<8&16711680|H[3]<<24)>>>0),D+=32;else n(L,D,g,w,T)}function Yr(g,w){dt[w][0]=dt[g+"0"],dt[w][1]=dt[g+"1"],dt[w][2]=dt[g+"2"],dt[w][3]=dt[g+"3"],dt[w][4]=dt[g+"4"],dt[w][5]=dt[g+"5"],dt[w][6]=dt[g+"6"],dt[w][7]=dt[g+"7"],dt[w][8]=dt[g+"8"],dt[w][9]=dt[g+"9"],dt[w][10]=dt[g+"10"],dt[w][11]=dt[g+"11"],dt[w][12]=dt[g+"12"],dt[w][13]=dt[g+"13"],dt[w][14]=dt[g+"0"],dt[w][15]=dt[g+"0"]}function Or(g){return g==Gn||g==Cl||g==El||g==lA}function gr(){this.eb=[],this.size=this.A=this.fb=0}function an(){this.y=[],this.f=[],this.ea=[],this.F=[],this.Tc=this.Ed=this.Cd=this.Fd=this.lb=this.Db=this.Ab=this.fa=this.J=this.W=this.N=this.O=0}function $r(){this.Rd=this.height=this.width=this.S=0,this.f={},this.f.RGBA=new gr,this.f.kb=new an,this.sd=null}function Ct(){this.width=[0],this.height=[0],this.Pd=[0],this.Qd=[0],this.format=[0]}function Z(){this.Id=this.fd=this.Md=this.hb=this.ib=this.da=this.bd=this.cd=this.j=this.v=this.Da=this.Sd=this.ob=0}function Y(g){return alert("todo:WebPSamplerProcessPlane"),g.T}function ot(g,w){var T=g.T,L=w.ba.f.RGBA,D=L.eb,H=L.fb+g.ka*L.A,z=Ts[w.ba.S],j=g.y,V=g.O,W=g.f,lt=g.N,rt=g.ea,ht=g.W,gt=w.cc,Mt=w.dc,Tt=w.Mc,_t=w.Nc,bt=g.ka,Gt=g.ka+g.T,Wt=g.U,ue=Wt+1>>1;for(bt==0?z(j,V,null,null,W,lt,rt,ht,W,lt,rt,ht,D,H,null,null,Wt):(z(w.ec,w.fc,j,V,gt,Mt,Tt,_t,W,lt,rt,ht,D,H-L.A,D,H,Wt),++T);bt+2<Gt;bt+=2)gt=W,Mt=lt,Tt=rt,_t=ht,lt+=g.Rc,ht+=g.Rc,H+=2*L.A,z(j,(V+=2*g.fa)-g.fa,j,V,gt,Mt,Tt,_t,W,lt,rt,ht,D,H-L.A,D,H,Wt);return V+=g.fa,g.j+Gt<g.o?(n(w.ec,w.fc,j,V,Wt),n(w.cc,w.dc,W,lt,ue),n(w.Mc,w.Nc,rt,ht,ue),T--):1&Gt||z(j,V,null,null,W,lt,rt,ht,W,lt,rt,ht,D,H+L.A,null,null,Wt),T}function Et(g,w,T){var L=g.F,D=[g.J];if(L!=null){var H=g.U,z=w.ba.S,j=z==cA||z==El;w=w.ba.f.RGBA;var V=[0],W=g.ka;V[0]=g.T,g.Kb&&(W==0?--V[0]:(--W,D[0]-=g.width),g.j+g.ka+g.T==g.o&&(V[0]=g.o-g.j-W));var lt=w.eb;W=w.fb+W*w.A,g=Wa(L,D[0],g.width,H,V,lt,W+(j?0:3),w.A),t(T==V),g&&Or(z)&&Ca(lt,W,j,H,V,w.A)}return 0}function kt(g){var w=g.ma,T=w.ba.S,L=11>T,D=T==xl||T==Bl||T==cA||T==wd||T==12||Or(T);if(w.memory=null,w.Ib=null,w.Jb=null,w.Nd=null,!Sc(w.Oa,g,D?11:12))return 0;if(D&&Or(T)&&Me(),g.da)alert("todo:use_scaling");else{if(L){if(w.Ib=Y,g.Kb){if(T=g.U+1>>1,w.memory=s(g.U+2*T),w.memory==null)return 0;w.ec=w.memory,w.fc=0,w.cc=w.ec,w.dc=w.fc+g.U,w.Mc=w.cc,w.Nc=w.dc+T,w.Ib=ot,Me()}}else alert("todo:EmitYUV");D&&(w.Jb=Et,L&&oe())}if(L&&!dh){for(g=0;256>g;++g)Id[g]=89858*(g-128)+Ja>>Tl,C[g]=-22014*(g-128)+Ja,mp[g]=-45773*(g-128),fh[g]=113618*(g-128)+Ja>>Tl;for(g=na;g<yu;++g)w=76283*(g-16)+Ja>>Tl,l[g-na]=Hs(w,255),d[g-na]=Hs(w+8>>4,15);dh=1}return 1}function zt(g){var w=g.ma,T=g.U,L=g.T;return t(!(1&g.ka)),0>=T||0>=L?0:(T=w.Ib(g,w),w.Jb!=null&&w.Jb(g,w,T),w.Dc+=T,1)}function qt(g){g.ma.memory=null}function St(g,w,T,L){return se(g,8)!=47?0:(w[0]=se(g,14)+1,T[0]=se(g,14)+1,L[0]=se(g,1),se(g,3)!=0?0:!g.h)}function Yt(g,w){if(4>g)return g+1;var T=g-2>>1;return(2+(1&g)<<T)+se(w,T)+1}function me(g,w){return 120<w?w-120:1<=(T=((T=dr[w-1])>>4)*g+(8-(15&T)))?T:1;var T}function pe(g,w,T){var L=vt(T),D=g[w+=255&L].g-8;return 0<D&&(Ot(T,T.u+8),L=vt(T),w+=g[w].value,w+=L&(1<<D)-1),Ot(T,T.u+g[w].g),g[w].value}function de(g,w,T){return T.g+=g.g,T.value+=g.value<<w>>>0,t(8>=T.g),g.g}function Ve(g,w,T){var L=g.xc;return t((w=L==0?0:g.vc[g.md*(T>>L)+(w>>L)])<g.Wb),g.Ya[w]}function Ye(g,w,T,L){var D=g.ab,H=g.c*w,z=g.C;w=z+w;var j=T,V=L;for(L=g.Ta,T=g.Ua;0<D--;){var W=g.gc[D],lt=z,rt=w,ht=j,gt=V,Mt=(V=L,j=T,W.Ea);switch(t(lt<rt),t(rt<=W.nc),W.hc){case 2:Xn(ht,gt,(rt-lt)*Mt,V,j);break;case 0:var Tt=lt,_t=rt,bt=V,Gt=j,Wt=(Ce=W).Ea;Tt==0&&(bd(ht,gt,null,null,1,bt,Gt),Tr(ht,gt+1,0,0,Wt-1,bt,Gt+1),gt+=Wt,Gt+=Wt,++Tt);for(var ue=1<<Ce.b,Ae=ue-1,ye=er(Wt,Ce.b),Oe=Ce.K,Ce=Ce.w+(Tt>>Ce.b)*ye;Tt<_t;){var We=Oe,nr=Ce,rr=1;for(du(ht,gt,bt,Gt-Wt,1,bt,Gt);rr<Wt;){var Sr=(rr&~Ae)+ue;Sr>Wt&&(Sr=Wt),(0,qa[We[nr++]>>8&15])(ht,gt+ +rr,bt,Gt+rr-Wt,Sr-rr,bt,Gt+rr),rr=Sr}gt+=Wt,Gt+=Wt,++Tt&Ae||(Ce+=ye)}rt!=W.nc&&n(V,j-Mt,V,j+(rt-lt-1)*Mt,Mt);break;case 1:for(Mt=ht,_t=gt,Wt=(ht=W.Ea)-(Gt=ht&~(bt=(gt=1<<W.b)-1)),Tt=er(ht,W.b),ue=W.K,W=W.w+(lt>>W.b)*Tt;lt<rt;){for(Ae=ue,ye=W,Oe=new xe,Ce=_t+Gt,We=_t+ht;_t<Ce;)Qr(Ae[ye++],Oe),Di(Oe,Mt,_t,gt,V,j),_t+=gt,j+=gt;_t<We&&(Qr(Ae[ye++],Oe),Di(Oe,Mt,_t,Wt,V,j),_t+=Wt,j+=Wt),++lt&bt||(W+=Tt)}break;case 3:if(ht==V&&gt==j&&0<W.b){for(_t=V,ht=Mt=j+(rt-lt)*Mt-(Gt=(rt-lt)*er(W.Ea,W.b)),gt=V,bt=j,Tt=[],Gt=(Wt=Gt)-1;0<=Gt;--Gt)Tt[Gt]=gt[bt+Gt];for(Gt=Wt-1;0<=Gt;--Gt)_t[ht+Gt]=Tt[Gt];Ki(W,lt,rt,V,Mt,V,j)}else Ki(W,lt,rt,ht,gt,V,j)}j=L,V=T}V!=T&&n(L,T,j,V,H)}function Er(g,w){var T=g.V,L=g.Ba+g.c*g.C,D=w-g.C;if(t(w<=g.l.o),t(16>=D),0<D){var H=g.l,z=g.Ta,j=g.Ua,V=H.width;if(Ye(g,D,T,L),D=j=[j],t((T=g.C)<(L=w)),t(H.v<H.va),L>H.o&&(L=H.o),T<H.j){var W=H.j-T;T=H.j,D[0]+=W*V}if(T>=L?T=0:(D[0]+=4*H.v,H.ka=T-H.j,H.U=H.va-H.v,H.T=L-T,T=1),T){if(j=j[0],11>(T=g.ca).S){var lt=T.f.RGBA,rt=(L=T.S,D=H.U,H=H.T,W=lt.eb,lt.A),ht=H;for(lt=lt.fb+g.Ma*lt.A;0<ht--;){var gt=z,Mt=j,Tt=D,_t=W,bt=lt;switch(L){case aA:$i(gt,Mt,Tt,_t,bt);break;case xl:eo(gt,Mt,Tt,_t,bt);break;case Gn:eo(gt,Mt,Tt,_t,bt),Ca(_t,bt,0,Tt,1,0);break;case uh:Lc(gt,Mt,Tt,_t,bt);break;case Bl:Ke(gt,Mt,Tt,_t,bt,1);break;case Cl:Ke(gt,Mt,Tt,_t,bt,1),Ca(_t,bt,0,Tt,1,0);break;case cA:Ke(gt,Mt,Tt,_t,bt,0);break;case El:Ke(gt,Mt,Tt,_t,bt,0),Ca(_t,bt,1,Tt,1,0);break;case wd:xo(gt,Mt,Tt,_t,bt);break;case lA:xo(gt,Mt,Tt,_t,bt),pu(_t,bt,Tt,1,0);break;case Xa:Bo(gt,Mt,Tt,_t,bt);break;default:t(0)}j+=V,lt+=rt}g.Ma+=H}else alert("todo:EmitRescaledRowsYUVA");t(g.Ma<=T.height)}}g.C=w,t(g.C<=g.i)}function lr(g){var w;if(0<g.ua)return 0;for(w=0;w<g.Wb;++w){var T=g.Ya[w].G,L=g.Ya[w].H;if(0<T[1][L[1]+0].g||0<T[2][L[2]+0].g||0<T[3][L[3]+0].g)return 0}return 1}function Ur(g,w,T,L,D,H){if(g.Z!=0){var z=g.qd,j=g.rd;for(t(So[g.Z]!=null);w<T;++w)So[g.Z](z,j,L,D,L,D,H),z=L,j=D,D+=H;g.qd=z,g.rd=j}}function kr(g,w){var T=g.l.ma,L=T.Z==0||T.Z==1?g.l.j:g.C;if(L=g.C<L?L:g.C,t(w<=g.l.o),w>L){var D=g.l.width,H=T.ca,z=T.tb+D*L,j=g.V,V=g.Ba+g.c*L,W=g.gc;t(g.ab==1),t(W[0].hc==3),sA(W[0],L,w,j,V,H,z),Ur(T,L,w,H,z,D)}g.C=g.Ma=w}function Hr(g,w,T,L,D,H,z){var j=g.$/L,V=g.$%L,W=g.m,lt=g.s,rt=T+g.$,ht=rt;D=T+L*D;var gt=T+L*H,Mt=280+lt.ua,Tt=g.Pb?j:16777216,_t=0<lt.ua?lt.Wa:null,bt=lt.wc,Gt=rt<gt?Ve(lt,V,j):null;t(g.C<H),t(gt<=D);var Wt=!1;t:for(;;){for(;Wt||rt<gt;){var ue=0;if(j>=Tt){var Ae=rt-T;t((Tt=g).Pb),Tt.wd=Tt.m,Tt.xd=Ae,0<Tt.s.ua&&ge(Tt.s.Wa,Tt.s.vb),Tt=j+Ah}if(V&bt||(Gt=Ve(lt,V,j)),t(Gt!=null),Gt.Qb&&(w[rt]=Gt.qb,Wt=!0),!Wt)if($t(W),Gt.jc){ue=W,Ae=w;var ye=rt,Oe=Gt.pd[vt(ue)&ls-1];t(Gt.jc),256>Oe.g?(Ot(ue,ue.u+Oe.g),Ae[ye]=Oe.value,ue=0):(Ot(ue,ue.u+Oe.g-256),t(256<=Oe.value),ue=Oe.value),ue==0&&(Wt=!0)}else ue=pe(Gt.G[0],Gt.H[0],W);if(W.h)break;if(Wt||256>ue){if(!Wt)if(Gt.nd)w[rt]=(Gt.qb|ue<<8)>>>0;else{if($t(W),Wt=pe(Gt.G[1],Gt.H[1],W),$t(W),Ae=pe(Gt.G[2],Gt.H[2],W),ye=pe(Gt.G[3],Gt.H[3],W),W.h)break;w[rt]=(ye<<24|Wt<<16|ue<<8|Ae)>>>0}if(Wt=!1,++rt,++V>=L&&(V=0,++j,z!=null&&j<=H&&!(j%16)&&z(g,j),_t!=null))for(;ht<rt;)ue=w[ht++],_t.X[(506832829*ue&4294967295)>>>_t.Mb]=ue}else if(280>ue){if(ue=Yt(ue-256,W),Ae=pe(Gt.G[4],Gt.H[4],W),$t(W),Ae=me(L,Ae=Yt(Ae,W)),W.h)break;if(rt-T<Ae||D-rt<ue)break t;for(ye=0;ye<ue;++ye)w[rt+ye]=w[rt+ye-Ae];for(rt+=ue,V+=ue;V>=L;)V-=L,++j,z!=null&&j<=H&&!(j%16)&&z(g,j);if(t(rt<=D),V&bt&&(Gt=Ve(lt,V,j)),_t!=null)for(;ht<rt;)ue=w[ht++],_t.X[(506832829*ue&4294967295)>>>_t.Mb]=ue}else{if(!(ue<Mt))break t;for(Wt=ue-280,t(_t!=null);ht<rt;)ue=w[ht++],_t.X[(506832829*ue&4294967295)>>>_t.Mb]=ue;ue=rt,t(!(Wt>>>(Ae=_t).Xa)),w[ue]=Ae.X[Wt],Wt=!0}Wt||t(W.h==Ft(W))}if(g.Pb&&W.h&&rt<D)t(g.m.h),g.a=5,g.m=g.wd,g.$=g.xd,0<g.s.ua&&ge(g.s.vb,g.s.Wa);else{if(W.h)break t;z!=null&&z(g,j>H?H:j),g.a=0,g.$=rt-T}return 1}return g.a=3,0}function mn(g){t(g!=null),g.vc=null,g.yc=null,g.Ya=null;var w=g.Wa;w!=null&&(w.X=null),g.vb=null,t(g!=null)}function mr(){var g=new iA;return g==null?null:(g.a=0,g.xb=hh,Yr("Predictor","VP8LPredictors"),Yr("Predictor","VP8LPredictors_C"),Yr("PredictorAdd","VP8LPredictorsAdd"),Yr("PredictorAdd","VP8LPredictorsAdd_C"),Xn=Nr,Di=fe,$i=De,eo=xn,xo=Pr,Bo=Te,Lc=Je,dt.VP8LMapColor32b=Oi,dt.VP8LMapColor8b=fu,g)}function Wr(g,w,T,L,D){var H=1,z=[g],j=[w],V=L.m,W=L.s,lt=null,rt=0;t:for(;;){if(T)for(;H&&se(V,1);){var ht=z,gt=j,Mt=L,Tt=1,_t=Mt.m,bt=Mt.gc[Mt.ab],Gt=se(_t,2);if(Mt.Oc&1<<Gt)H=0;else{switch(Mt.Oc|=1<<Gt,bt.hc=Gt,bt.Ea=ht[0],bt.nc=gt[0],bt.K=[null],++Mt.ab,t(4>=Mt.ab),Gt){case 0:case 1:bt.b=se(_t,3)+2,Tt=Wr(er(bt.Ea,bt.b),er(bt.nc,bt.b),0,Mt,bt.K),bt.K=bt.K[0];break;case 3:var Wt,ue=se(_t,8)+1,Ae=16<ue?0:4<ue?1:2<ue?2:3;if(ht[0]=er(bt.Ea,Ae),bt.b=Ae,Wt=Tt=Wr(ue,1,0,Mt,bt.K)){var ye,Oe=ue,Ce=bt,We=1<<(8>>Ce.b),nr=s(We);if(nr==null)Wt=0;else{var rr=Ce.K[0],Sr=Ce.w;for(nr[0]=Ce.K[0][0],ye=1;ye<1*Oe;++ye)nr[ye]=Se(rr[Sr+ye],nr[ye-1]);for(;ye<4*We;++ye)nr[ye]=0;Ce.K[0]=null,Ce.K[0]=nr,Wt=1}}Tt=Wt;break;case 2:break;default:t(0)}H=Tt}}if(z=z[0],j=j[0],H&&se(V,1)&&!(H=1<=(rt=se(V,4))&&11>=rt)){L.a=3;break t}var Fr;if(Fr=H)e:{var tn,xr,Jr,Cn=L,En=z,fi=j,dn=rt,us=T,Fi=Cn.m,Vn=Cn.s,fn=[null],on=1,pn=0,Ti=wr[dn];r:for(;;){if(us&&se(Fi,1)){var un=se(Fi,3)+2,Sn=er(En,un),Ji=er(fi,un),ri=Sn*Ji;if(!Wr(Sn,Ji,0,Cn,fn))break r;for(fn=fn[0],Vn.xc=un,tn=0;tn<ri;++tn){var Dn=fn[tn]>>8&65535;fn[tn]=Dn,Dn>=on&&(on=Dn+1)}}if(Fi.h)break r;for(xr=0;5>xr;++xr){var ai=xd[xr];!xr&&0<dn&&(ai+=1<<dn),pn<ai&&(pn=ai)}var ph=a(on*Ti,ct),Pc=on,Mc=a(Pc,yt);if(Mc==null)var Ll=null;else t(65536>=Pc),Ll=Mc;var To=s(pn);if(Ll==null||To==null||ph==null){Cn.a=1;break r}var _u=ph;for(tn=Jr=0;tn<on;++tn){var Io=Ll[tn],Uc=Io.G,Rc=Io.H,mA=0,vu=1,yp=0;for(xr=0;5>xr;++xr){ai=xd[xr],Uc[xr]=_u,Rc[xr]=Jr,!xr&&0<dn&&(ai+=1<<dn);i:{var Ld,_p=ai,Fl=Cn,Fd=To,Pd=_u,vp=Jr,gh=0,Pl=Fl.m,Q_=se(Pl,1);if(i(Fd,0,0,_p),Q_){var QE=se(Pl,1)+1,Vs=se(Pl,1),yA=se(Pl,Vs==0?1:8);Fd[yA]=1,QE==2&&(Fd[yA=se(Pl,8)]=1);var mh=1}else{var Rm=s(19),yh=se(Pl,4)+4;if(19<yh){Fl.a=3;var bp=0;break i}for(Ld=0;Ld<yh;++Ld)Rm[uA[Ld]]=se(Pl,3);var _h=void 0,Md=void 0,Om=Fl,H_=Rm,Ud=_p,z_=Fd,Rd=0,Ml=Om.m,wp=8,vh=a(128,ct);n:for(;st(vh,0,7,H_,19);){if(se(Ml,1)){var ia=2+2*se(Ml,3);if((_h=2+se(Ml,ia))>Ud)break n}else _h=Ud;for(Md=0;Md<Ud&&_h--;){$t(Ml);var Dm=vh[0+(127&vt(Ml))];Ot(Ml,Ml.u+Dm.g);var bh=Dm.value;if(16>bh)z_[Md++]=bh,bh!=0&&(wp=bh);else{var G_=bh==16,V_=bh-16,HE=pp[V_],j_=se(Ml,fp[V_])+HE;if(Md+j_>Ud)break n;for(var zE=G_?wp:0;0<j_--;)z_[Md++]=zE}}Rd=1;break n}Rd||(Om.a=3),mh=Rd}(mh=mh&&!Pl.h)&&(gh=st(Pd,vp,8,Fd,_p)),mh&&gh!=0?bp=gh:(Fl.a=3,bp=0)}if(bp==0)break r;if(vu&&ta[xr]==1&&(vu=_u[Jr].g==0),mA+=_u[Jr].g,Jr+=bp,3>=xr){var _A,wh=To[0];for(_A=1;_A<ai;++_A)To[_A]>wh&&(wh=To[_A]);yp+=wh}}if(Io.nd=vu,Io.Qb=0,vu&&(Io.qb=(Uc[3][Rc[3]+0].value<<24|Uc[1][Rc[1]+0].value<<16|Uc[2][Rc[2]+0].value)>>>0,mA==0&&256>Uc[0][Rc[0]+0].value&&(Io.Qb=1,Io.qb+=Uc[0][Rc[0]+0].value<<8)),Io.jc=!Io.Qb&&6>yp,Io.jc){var Od,io=Io;for(Od=0;Od<ls;++Od){var Sa=Od,bu=io.pd[Sa],xp=io.G[0][io.H[0]+Sa];256<=xp.value?(bu.g=xp.g+256,bu.value=xp.value):(bu.g=0,bu.value=0,Sa>>=de(xp,8,bu),Sa>>=de(io.G[1][io.H[1]+Sa],16,bu),Sa>>=de(io.G[2][io.H[2]+Sa],0,bu),de(io.G[3][io.H[3]+Sa],24,bu))}}}Vn.vc=fn,Vn.Wb=on,Vn.Ya=Ll,Vn.yc=ph,Fr=1;break e}Fr=0}if(!(H=Fr)){L.a=3;break t}if(0<rt){if(W.ua=1<<rt,!ze(W.Wa,rt)){L.a=1,H=0;break t}}else W.ua=0;var Nm=L,q_=z,GE=j,km=Nm.s,Qm=km.xc;if(Nm.c=q_,Nm.i=GE,km.md=er(q_,Qm),km.wc=Qm==0?-1:(1<<Qm)-1,T){L.xb=Ed;break t}if((lt=s(z*j))==null){L.a=1,H=0;break t}H=(H=Hr(L,lt,0,z,j,j,null))&&!V.h;break t}return H?(D!=null?D[0]=lt:(t(lt==null),t(T)),L.$=0,T||mn(W)):mn(W),H}function bn(g,w){var T=g.c*g.i,L=T+w+16*w;return t(g.c<=w),g.V=s(L),g.V==null?(g.Ta=null,g.Ua=0,g.a=1,0):(g.Ta=g.V,g.Ua=g.Ba+T+w,1)}function Qn(g,w){var T=g.C,L=w-T,D=g.V,H=g.Ba+g.c*T;for(t(w<=g.l.o);0<L;){var z=16<L?16:L,j=g.l.ma,V=g.l.width,W=V*z,lt=j.ca,rt=j.tb+V*T,ht=g.Ta,gt=g.Ua;Ye(g,z,D,H),gu(ht,gt,lt,rt,W),Ur(j,T,T+z,lt,rt,V),L-=z,D+=z*g.c,T+=z}t(T==w),g.C=g.Ma=w}function Dt(){this.ub=this.yd=this.td=this.Rb=0}function Re(){this.Kd=this.Ld=this.Ud=this.Td=this.i=this.c=0}function Le(){this.Fb=this.Bb=this.Cb=0,this.Zb=s(4),this.Lb=s(4)}function nn(){this.Yb=function(){var g=[];return function w(T,L,D){for(var H=D[L],z=0;z<H&&(T.push(D.length>L+1?[]:0),!(D.length<L+1));z++)w(T[z],L+1,D)}(g,0,[3,11]),g}()}function Un(){this.jb=s(3),this.Wc=o([4,8],nn),this.Xc=o([4,17],nn)}function Br(){this.Pc=this.wb=this.Tb=this.zd=0,this.vd=new s(4),this.od=new s(4)}function yn(){this.ld=this.La=this.dd=this.tc=0}function xi(){this.Na=this.la=0}function _n(){this.Sc=[0,0],this.Eb=[0,0],this.Qc=[0,0],this.ia=this.lc=0}function sn(){this.ad=s(384),this.Za=0,this.Ob=s(16),this.$b=this.Ad=this.ia=this.Gc=this.Hc=this.Dd=0}function Bi(){this.uc=this.M=this.Nb=0,this.wa=Array(new yn),this.Y=0,this.ya=Array(new sn),this.aa=0,this.l=new Ns}function Yn(){this.y=s(16),this.f=s(8),this.ea=s(8)}function cs(){this.cb=this.a=0,this.sc="",this.m=new we,this.Od=new Dt,this.Kc=new Re,this.ed=new Br,this.Qa=new Le,this.Ic=this.$c=this.Aa=0,this.D=new Bi,this.Xb=this.Va=this.Hb=this.zb=this.yb=this.Ub=this.za=0,this.Jc=a(8,we),this.ia=0,this.pb=a(4,_n),this.Pa=new Un,this.Bd=this.kc=0,this.Ac=[],this.Bc=0,this.zc=[0,0,0,0],this.Gd=Array(new Yn),this.Hd=0,this.rb=Array(new xi),this.sb=0,this.wa=Array(new yn),this.Y=0,this.oc=[],this.pc=0,this.sa=[],this.ta=0,this.qa=[],this.ra=0,this.Ha=[],this.B=this.R=this.Ia=0,this.Ec=[],this.M=this.ja=this.Vb=this.Fc=0,this.ya=Array(new sn),this.L=this.aa=0,this.gd=o([4,2],yn),this.ga=null,this.Fa=[],this.Cc=this.qc=this.P=0,this.Gb=[],this.Uc=0,this.mb=[],this.nb=0,this.rc=[],this.Ga=this.Vc=0}function Ns(){this.T=this.U=this.ka=this.height=this.width=0,this.y=[],this.f=[],this.ea=[],this.Rc=this.fa=this.W=this.N=this.O=0,this.ma="void",this.put="VP8IoPutHook",this.ac="VP8IoSetupHook",this.bc="VP8IoTeardownHook",this.ha=this.Kb=0,this.data=[],this.hb=this.ib=this.da=this.o=this.j=this.va=this.v=this.Da=this.ob=this.w=0,this.F=[],this.J=0}function Vo(){var g=new cs;return g!=null&&(g.a=0,g.sc="OK",g.cb=0,g.Xb=0,Xi||(Xi=In)),g}function Dr(g,w,T){return g.a==0&&(g.a=w,g.sc=T,g.cb=0),0}function Zs(g,w,T){return 3<=T&&g[w+0]==157&&g[w+1]==1&&g[w+2]==42}function Ss(g,w){if(g==null)return 0;if(g.a=0,g.sc="OK",w==null)return Dr(g,2,"null VP8Io passed to VP8GetHeaders()");var T=w.data,L=w.w,D=w.ha;if(4>D)return Dr(g,7,"Truncated header.");var H=T[L+0]|T[L+1]<<8|T[L+2]<<16,z=g.Od;if(z.Rb=!(1&H),z.td=H>>1&7,z.yd=H>>4&1,z.ub=H>>5,3<z.td)return Dr(g,3,"Incorrect keyframe parameters.");if(!z.yd)return Dr(g,4,"Frame not displayable.");L+=3,D-=3;var j=g.Kc;if(z.Rb){if(7>D)return Dr(g,7,"cannot parse picture header");if(!Zs(T,L,D))return Dr(g,3,"Bad code word");j.c=16383&(T[L+4]<<8|T[L+3]),j.Td=T[L+4]>>6,j.i=16383&(T[L+6]<<8|T[L+5]),j.Ud=T[L+6]>>6,L+=7,D-=7,g.za=j.c+15>>4,g.Ub=j.i+15>>4,w.width=j.c,w.height=j.i,w.Da=0,w.j=0,w.v=0,w.va=w.width,w.o=w.height,w.da=0,w.ib=w.width,w.hb=w.height,w.U=w.width,w.T=w.height,i((H=g.Pa).jb,0,255,H.jb.length),t((H=g.Qa)!=null),H.Cb=0,H.Bb=0,H.Fb=1,i(H.Zb,0,0,H.Zb.length),i(H.Lb,0,0,H.Lb)}if(z.ub>D)return Dr(g,7,"bad partition length");te(H=g.m,T,L,z.ub),L+=z.ub,D-=z.ub,z.Rb&&(j.Ld=ae(H),j.Kd=ae(H)),j=g.Qa;var V,W=g.Pa;if(t(H!=null),t(j!=null),j.Cb=ae(H),j.Cb){if(j.Bb=ae(H),ae(H)){for(j.Fb=ae(H),V=0;4>V;++V)j.Zb[V]=ae(H)?re(H,7):0;for(V=0;4>V;++V)j.Lb[V]=ae(H)?re(H,6):0}if(j.Bb)for(V=0;3>V;++V)W.jb[V]=ae(H)?Zt(H,8):255}else j.Bb=0;if(H.Ka)return Dr(g,3,"cannot parse segment header");if((j=g.ed).zd=ae(H),j.Tb=Zt(H,6),j.wb=Zt(H,3),j.Pc=ae(H),j.Pc&&ae(H)){for(W=0;4>W;++W)ae(H)&&(j.vd[W]=re(H,6));for(W=0;4>W;++W)ae(H)&&(j.od[W]=re(H,6))}if(g.L=j.Tb==0?0:j.zd?1:2,H.Ka)return Dr(g,3,"cannot parse filter header");var lt=D;if(D=V=L,L=V+lt,j=lt,g.Xb=(1<<Zt(g.m,2))-1,lt<3*(W=g.Xb))T=7;else{for(V+=3*W,j-=3*W,lt=0;lt<W;++lt){var rt=T[D+0]|T[D+1]<<8|T[D+2]<<16;rt>j&&(rt=j),te(g.Jc[+lt],T,V,rt),V+=rt,j-=rt,D+=3}te(g.Jc[+W],T,V,j),T=V<L?0:5}if(T!=0)return Dr(g,T,"cannot parse partitions");for(T=Zt(V=g.m,7),D=ae(V)?re(V,4):0,L=ae(V)?re(V,4):0,j=ae(V)?re(V,4):0,W=ae(V)?re(V,4):0,V=ae(V)?re(V,4):0,lt=g.Qa,rt=0;4>rt;++rt){if(lt.Cb){var ht=lt.Zb[rt];lt.Fb||(ht+=T)}else{if(0<rt){g.pb[rt]=g.pb[0];continue}ht=T}var gt=g.pb[rt];gt.Sc[0]=Sl[Hs(ht+D,127)],gt.Sc[1]=AA[Hs(ht+0,127)],gt.Eb[0]=2*Sl[Hs(ht+L,127)],gt.Eb[1]=101581*AA[Hs(ht+j,127)]>>16,8>gt.Eb[1]&&(gt.Eb[1]=8),gt.Qc[0]=Sl[Hs(ht+W,117)],gt.Qc[1]=AA[Hs(ht+V,127)],gt.lc=ht+V}if(!z.Rb)return Dr(g,4,"Not a key frame.");for(ae(H),z=g.Pa,T=0;4>T;++T){for(D=0;8>D;++D)for(L=0;3>L;++L)for(j=0;11>j;++j)W=ie(H,Si[T][D][L][j])?Zt(H,8):hA[T][D][L][j],z.Wc[T][D].Yb[L][j]=W;for(D=0;17>D;++D)z.Xc[T][D]=z.Wc[T][gp[D]]}return g.kc=ae(H),g.kc&&(g.Bd=Zt(H,8)),g.cb=1}function In(g,w,T,L,D,H,z){var j=w[D].Yb[T];for(T=0;16>D;++D){if(!ie(g,j[T+0]))return D;for(;!ie(g,j[T+1]);)if(j=w[++D].Yb[0],T=0,D==16)return 16;var V=w[D+1].Yb;if(ie(g,j[T+2])){var W=g,lt=0;if(ie(W,(ht=j)[(rt=T)+3]))if(ie(W,ht[rt+6])){for(j=0,rt=2*(lt=ie(W,ht[rt+8]))+(ht=ie(W,ht[rt+9+lt])),lt=0,ht=Bd[rt];ht[j];++j)lt+=lt+ie(W,ht[j]);lt+=3+(8<<rt)}else ie(W,ht[rt+7])?(lt=7+2*ie(W,165),lt+=ie(W,145)):lt=5+ie(W,159);else lt=ie(W,ht[rt+4])?3+ie(W,ht[rt+5]):2;j=V[2]}else lt=1,j=V[1];V=z+ea[D],0>(W=g).b&&jt(W);var rt,ht=W.b,gt=(rt=W.Ca>>1)-(W.I>>ht)>>31;--W.b,W.Ca+=gt,W.Ca|=1,W.I-=(rt+1&gt)<<ht,H[V]=((lt^gt)-gt)*L[(0<D)+0]}return 16}function wo(g){var w=g.rb[g.sb-1];w.la=0,w.Na=0,i(g.zc,0,0,g.zc.length),g.ja=0}function Mi(g,w){if(g==null)return 0;if(w==null)return Dr(g,2,"NULL VP8Io parameter in VP8Decode().");if(!g.cb&&!Ss(g,w))return 0;if(t(g.cb),w.ac==null||w.ac(w)){w.ob&&(g.L=0);var T=v[g.L];if(g.L==2?(g.yb=0,g.zb=0):(g.yb=w.v-T>>4,g.zb=w.j-T>>4,0>g.yb&&(g.yb=0),0>g.zb&&(g.zb=0)),g.Va=w.o+15+T>>4,g.Hb=w.va+15+T>>4,g.Hb>g.za&&(g.Hb=g.za),g.Va>g.Ub&&(g.Va=g.Ub),0<g.L){var L=g.ed;for(T=0;4>T;++T){var D;if(g.Qa.Cb){var H=g.Qa.Lb[T];g.Qa.Fb||(H+=L.Tb)}else H=L.Tb;for(D=0;1>=D;++D){var z=g.gd[T][D],j=H;if(L.Pc&&(j+=L.vd[0],D&&(j+=L.od[0])),0<(j=0>j?0:63<j?63:j)){var V=j;0<L.wb&&(V=4<L.wb?V>>2:V>>1)>9-L.wb&&(V=9-L.wb),1>V&&(V=1),z.dd=V,z.tc=2*j+V,z.ld=40<=j?2:15<=j?1:0}else z.tc=0;z.La=D}}}T=0}else Dr(g,6,"Frame setup failed"),T=g.a;if(T=T==0){if(T){g.$c=0,0<g.Aa||(g.Ic=U);t:{T=g.Ic,L=4*(V=g.za);var W=32*V,lt=V+1,rt=0<g.L?V*(0<g.Aa?2:1):0,ht=(g.Aa==2?2:1)*V;if((z=L+832+(D=3*(16*T+v[g.L])/2*W)+(H=g.Fa!=null&&0<g.Fa.length?g.Kc.c*g.Kc.i:0))!=z)T=0;else{if(z>g.Vb){if(g.Vb=0,g.Ec=s(z),g.Fc=0,g.Ec==null){T=Dr(g,1,"no memory during frame initialization.");break t}g.Vb=z}z=g.Ec,j=g.Fc,g.Ac=z,g.Bc=j,j+=L,g.Gd=a(W,Yn),g.Hd=0,g.rb=a(lt+1,xi),g.sb=1,g.wa=rt?a(rt,yn):null,g.Y=0,g.D.Nb=0,g.D.wa=g.wa,g.D.Y=g.Y,0<g.Aa&&(g.D.Y+=V),t(!0),g.oc=z,g.pc=j,j+=832,g.ya=a(ht,sn),g.aa=0,g.D.ya=g.ya,g.D.aa=g.aa,g.Aa==2&&(g.D.aa+=V),g.R=16*V,g.B=8*V,V=(W=v[g.L])*g.R,W=W/2*g.B,g.sa=z,g.ta=j+V,g.qa=g.sa,g.ra=g.ta+16*T*g.R+W,g.Ha=g.qa,g.Ia=g.ra+8*T*g.B+W,g.$c=0,j+=D,g.mb=H?z:null,g.nb=H?j:null,t(j+H<=g.Fc+g.Vb),wo(g),i(g.Ac,g.Bc,0,L),T=1}}if(T){if(w.ka=0,w.y=g.sa,w.O=g.ta,w.f=g.qa,w.N=g.ra,w.ea=g.Ha,w.Vd=g.Ia,w.fa=g.R,w.Rc=g.B,w.F=null,w.J=0,!wl){for(T=-255;255>=T;++T)Zo[255+T]=0>T?-T:T;for(T=-1020;1020>=T;++T)tr[1020+T]=-128>T?-128:127<T?127:T;for(T=-112;112>=T;++T)oA[112+T]=-16>T?-16:15<T?15:T;for(T=-255;510>=T;++T)bl[255+T]=0>T?0:255<T?255:T;wl=1}ro=xt,wa=qo,Ka=to,Co=mc,xa=At,Jo=jo,Fc=au,Ba=bc,Yo=vd,Ei=rA,zs=wc,Gs=cu,Ni=nA,vn=ch,Ln=ou,Fn=Ko,ei=$o,$a=eA,ki[0]=vi,ki[1]=he,ki[2]=za,ki[3]=su,ki[4]=yc,ki[5]=ma,ki[6]=Al,ki[7]=Ga,ki[8]=dl,ki[9]=hl,Eo[0]=Ai,Eo[1]=sr,Eo[2]=zr,Eo[3]=Wn,Eo[4]=Hn,Eo[5]=ah,Eo[6]=ul,ra[0]=vc,ra[1]=Pe,ra[2]=_d,ra[3]=tA,ra[4]=ya,ra[5]=Va,ra[6]=Ri,T=1}else T=0}T&&(T=function(gt,Mt){for(gt.M=0;gt.M<gt.Va;++gt.M){var Tt,_t=gt.Jc[gt.M&gt.Xb],bt=gt.m,Gt=gt;for(Tt=0;Tt<Gt.za;++Tt){var Wt=bt,ue=Gt,Ae=ue.Ac,ye=ue.Bc+4*Tt,Oe=ue.zc,Ce=ue.ya[ue.aa+Tt];if(ue.Qa.Bb?Ce.$b=ie(Wt,ue.Pa.jb[0])?2+ie(Wt,ue.Pa.jb[2]):ie(Wt,ue.Pa.jb[1]):Ce.$b=0,ue.kc&&(Ce.Ad=ie(Wt,ue.Bd)),Ce.Za=!ie(Wt,145)+0,Ce.Za){var We=Ce.Ob,nr=0;for(ue=0;4>ue;++ue){var rr,Sr=Oe[0+ue];for(rr=0;4>rr;++rr){Sr=di[Ae[ye+rr]][Sr];for(var Fr=Cd[ie(Wt,Sr[0])];0<Fr;)Fr=Cd[2*Fr+ie(Wt,Sr[Fr])];Sr=-Fr,Ae[ye+rr]=Sr}n(We,nr,Ae,ye,4),nr+=4,Oe[0+ue]=Sr}}else Sr=ie(Wt,156)?ie(Wt,128)?1:3:ie(Wt,163)?2:0,Ce.Ob[0]=Sr,i(Ae,ye,Sr,4),i(Oe,0,Sr,4);Ce.Dd=ie(Wt,142)?ie(Wt,114)?ie(Wt,183)?1:3:2:0}if(Gt.m.Ka)return Dr(gt,7,"Premature end-of-partition0 encountered.");for(;gt.ja<gt.za;++gt.ja){if(Gt=_t,Wt=(bt=gt).rb[bt.sb-1],Ae=bt.rb[bt.sb+bt.ja],Tt=bt.ya[bt.aa+bt.ja],ye=bt.kc?Tt.Ad:0)Wt.la=Ae.la=0,Tt.Za||(Wt.Na=Ae.Na=0),Tt.Hc=0,Tt.Gc=0,Tt.ia=0;else{var tn,xr;if(Wt=Ae,Ae=Gt,ye=bt.Pa.Xc,Oe=bt.ya[bt.aa+bt.ja],Ce=bt.pb[Oe.$b],ue=Oe.ad,We=0,nr=bt.rb[bt.sb-1],Sr=rr=0,i(ue,We,0,384),Oe.Za)var Jr=0,Cn=ye[3];else{Fr=s(16);var En=Wt.Na+nr.Na;if(En=Xi(Ae,ye[1],En,Ce.Eb,0,Fr,0),Wt.Na=nr.Na=(0<En)+0,1<En)ro(Fr,0,ue,We);else{var fi=Fr[0]+3>>3;for(Fr=0;256>Fr;Fr+=16)ue[We+Fr]=fi}Jr=1,Cn=ye[0]}var dn=15&Wt.la,us=15&nr.la;for(Fr=0;4>Fr;++Fr){var Fi=1&us;for(fi=xr=0;4>fi;++fi)dn=dn>>1|(Fi=(En=Xi(Ae,Cn,En=Fi+(1&dn),Ce.Sc,Jr,ue,We))>Jr)<<7,xr=xr<<2|(3<En?3:1<En?2:ue[We+0]!=0),We+=16;dn>>=4,us=us>>1|Fi<<7,rr=(rr<<8|xr)>>>0}for(Cn=dn,Jr=us>>4,tn=0;4>tn;tn+=2){for(xr=0,dn=Wt.la>>4+tn,us=nr.la>>4+tn,Fr=0;2>Fr;++Fr){for(Fi=1&us,fi=0;2>fi;++fi)En=Fi+(1&dn),dn=dn>>1|(Fi=0<(En=Xi(Ae,ye[2],En,Ce.Qc,0,ue,We)))<<3,xr=xr<<2|(3<En?3:1<En?2:ue[We+0]!=0),We+=16;dn>>=2,us=us>>1|Fi<<5}Sr|=xr<<4*tn,Cn|=dn<<4<<tn,Jr|=(240&us)<<tn}Wt.la=Cn,nr.la=Jr,Oe.Hc=rr,Oe.Gc=Sr,Oe.ia=43690&Sr?0:Ce.ia,ye=!(rr|Sr)}if(0<bt.L&&(bt.wa[bt.Y+bt.ja]=bt.gd[Tt.$b][Tt.Za],bt.wa[bt.Y+bt.ja].La|=!ye),Gt.Ka)return Dr(gt,7,"Premature end-of-file encountered.")}if(wo(gt),bt=Mt,Gt=1,Tt=(_t=gt).D,Wt=0<_t.L&&_t.M>=_t.zb&&_t.M<=_t.Va,_t.Aa==0)t:{if(Tt.M=_t.M,Tt.uc=Wt,Ec(_t,Tt),Gt=1,Tt=(xr=_t.D).Nb,Wt=(Sr=v[_t.L])*_t.R,Ae=Sr/2*_t.B,Fr=16*Tt*_t.R,fi=8*Tt*_t.B,ye=_t.sa,Oe=_t.ta-Wt+Fr,Ce=_t.qa,ue=_t.ra-Ae+fi,We=_t.Ha,nr=_t.Ia-Ae+fi,us=(dn=xr.M)==0,rr=dn>=_t.Va-1,_t.Aa==2&&Ec(_t,xr),xr.uc)for(Fi=(En=_t).D.M,t(En.D.uc),xr=En.yb;xr<En.Hb;++xr){Jr=xr,Cn=Fi;var Vn=(fn=(ai=En).D).Nb;tn=ai.R;var fn=fn.wa[fn.Y+Jr],on=ai.sa,pn=ai.ta+16*Vn*tn+16*Jr,Ti=fn.dd,un=fn.tc;if(un!=0)if(t(3<=un),ai.L==1)0<Jr&&Fn(on,pn,tn,un+4),fn.La&&$a(on,pn,tn,un),0<Cn&&Ln(on,pn,tn,un+4),fn.La&&ei(on,pn,tn,un);else{var Sn=ai.B,Ji=ai.qa,ri=ai.ra+8*Vn*Sn+8*Jr,Dn=ai.Ha,ai=ai.Ia+8*Vn*Sn+8*Jr;Vn=fn.ld,0<Jr&&(Ba(on,pn,tn,un+4,Ti,Vn),Ei(Ji,ri,Dn,ai,Sn,un+4,Ti,Vn)),fn.La&&(Gs(on,pn,tn,un,Ti,Vn),vn(Ji,ri,Dn,ai,Sn,un,Ti,Vn)),0<Cn&&(Fc(on,pn,tn,un+4,Ti,Vn),Yo(Ji,ri,Dn,ai,Sn,un+4,Ti,Vn)),fn.La&&(zs(on,pn,tn,un,Ti,Vn),Ni(Ji,ri,Dn,ai,Sn,un,Ti,Vn))}}if(_t.ia&&alert("todo:DitherRow"),bt.put!=null){if(xr=16*dn,dn=16*(dn+1),us?(bt.y=_t.sa,bt.O=_t.ta+Fr,bt.f=_t.qa,bt.N=_t.ra+fi,bt.ea=_t.Ha,bt.W=_t.Ia+fi):(xr-=Sr,bt.y=ye,bt.O=Oe,bt.f=Ce,bt.N=ue,bt.ea=We,bt.W=nr),rr||(dn-=Sr),dn>bt.o&&(dn=bt.o),bt.F=null,bt.J=null,_t.Fa!=null&&0<_t.Fa.length&&xr<dn&&(bt.J=Xo(_t,bt,xr,dn-xr),bt.F=_t.mb,bt.F==null&&bt.F.length==0)){Gt=Dr(_t,3,"Could not decode alpha data.");break t}xr<bt.j&&(Sr=bt.j-xr,xr=bt.j,t(!(1&Sr)),bt.O+=_t.R*Sr,bt.N+=_t.B*(Sr>>1),bt.W+=_t.B*(Sr>>1),bt.F!=null&&(bt.J+=bt.width*Sr)),xr<dn&&(bt.O+=bt.v,bt.N+=bt.v>>1,bt.W+=bt.v>>1,bt.F!=null&&(bt.J+=bt.v),bt.ka=xr-bt.j,bt.U=bt.va-bt.v,bt.T=dn-xr,Gt=bt.put(bt))}Tt+1!=_t.Ic||rr||(n(_t.sa,_t.ta-Wt,ye,Oe+16*_t.R,Wt),n(_t.qa,_t.ra-Ae,Ce,ue+8*_t.B,Ae),n(_t.Ha,_t.Ia-Ae,We,nr+8*_t.B,Ae))}if(!Gt)return Dr(gt,6,"Output aborted.")}return 1}(g,w)),w.bc!=null&&w.bc(w),T&=1}return T?(g.cb=0,T):0}function Ui(g,w,T,L,D){D=g[w+T+32*L]+(D>>3),g[w+T+32*L]=-256&D?0>D?0:255:D}function Zn(g,w,T,L,D,H){Ui(g,w,0,T,L+D),Ui(g,w,1,T,L+H),Ui(g,w,2,T,L-H),Ui(g,w,3,T,L-D)}function Li(g){return(20091*g>>16)+g}function cn(g,w,T,L){var D,H=0,z=s(16);for(D=0;4>D;++D){var j=g[w+0]+g[w+8],V=g[w+0]-g[w+8],W=(35468*g[w+4]>>16)-Li(g[w+12]),lt=Li(g[w+4])+(35468*g[w+12]>>16);z[H+0]=j+lt,z[H+1]=V+W,z[H+2]=V-W,z[H+3]=j-lt,H+=4,w++}for(D=H=0;4>D;++D)j=(g=z[H+0]+4)+z[H+8],V=g-z[H+8],W=(35468*z[H+4]>>16)-Li(z[H+12]),Ui(T,L,0,0,j+(lt=Li(z[H+4])+(35468*z[H+12]>>16))),Ui(T,L,1,0,V+W),Ui(T,L,2,0,V-W),Ui(T,L,3,0,j-lt),H++,L+=32}function jo(g,w,T,L){var D=g[w+0]+4,H=35468*g[w+4]>>16,z=Li(g[w+4]),j=35468*g[w+1]>>16;Zn(T,L,0,D+z,g=Li(g[w+1]),j),Zn(T,L,1,D+H,g,j),Zn(T,L,2,D-H,g,j),Zn(T,L,3,D-z,g,j)}function qo(g,w,T,L,D){cn(g,w,T,L),D&&cn(g,w+16,T,L+4)}function to(g,w,T,L){wa(g,w+0,T,L,1),wa(g,w+32,T,L+128,1)}function mc(g,w,T,L){var D;for(g=g[w+0]+4,D=0;4>D;++D)for(w=0;4>w;++w)Ui(T,L,w,D,g)}function At(g,w,T,L){g[w+0]&&Co(g,w+0,T,L),g[w+16]&&Co(g,w+16,T,L+4),g[w+32]&&Co(g,w+32,T,L+128),g[w+48]&&Co(g,w+48,T,L+128+4)}function xt(g,w,T,L){var D,H=s(16);for(D=0;4>D;++D){var z=g[w+0+D]+g[w+12+D],j=g[w+4+D]+g[w+8+D],V=g[w+4+D]-g[w+8+D],W=g[w+0+D]-g[w+12+D];H[0+D]=z+j,H[8+D]=z-j,H[4+D]=W+V,H[12+D]=W-V}for(D=0;4>D;++D)z=(g=H[0+4*D]+3)+H[3+4*D],j=H[1+4*D]+H[2+4*D],V=H[1+4*D]-H[2+4*D],W=g-H[3+4*D],T[L+0]=z+j>>3,T[L+16]=W+V>>3,T[L+32]=z-j>>3,T[L+48]=W-V>>3,L+=64}function Qt(g,w,T){var L,D=w-32,H=Wi,z=255-g[D-1];for(L=0;L<T;++L){var j,V=H,W=z+g[w-1];for(j=0;j<T;++j)g[w+j]=V[W+g[D+j]];w+=32}}function he(g,w){Qt(g,w,4)}function Pe(g,w){Qt(g,w,8)}function sr(g,w){Qt(g,w,16)}function zr(g,w){var T;for(T=0;16>T;++T)n(g,w+32*T,g,w-32,16)}function Wn(g,w){var T;for(T=16;0<T;--T)i(g,w,g[w-1],16),w+=32}function ti(g,w,T){var L;for(L=0;16>L;++L)i(w,T+32*L,g,16)}function Ai(g,w){var T,L=16;for(T=0;16>T;++T)L+=g[w-1+32*T]+g[w+T-32];ti(L>>5,g,w)}function Hn(g,w){var T,L=8;for(T=0;16>T;++T)L+=g[w-1+32*T];ti(L>>4,g,w)}function ah(g,w){var T,L=8;for(T=0;16>T;++T)L+=g[w+T-32];ti(L>>4,g,w)}function ul(g,w){ti(128,g,w)}function Vr(g,w,T){return g+2*w+T+2>>2}function za(g,w){var T,L=w-32;for(L=new Uint8Array([Vr(g[L-1],g[L+0],g[L+1]),Vr(g[L+0],g[L+1],g[L+2]),Vr(g[L+1],g[L+2],g[L+3]),Vr(g[L+2],g[L+3],g[L+4])]),T=0;4>T;++T)n(g,w+32*T,L,0,L.length)}function su(g,w){var T=g[w-1],L=g[w-1+32],D=g[w-1+64],H=g[w-1+96];Be(g,w+0,16843009*Vr(g[w-1-32],T,L)),Be(g,w+32,16843009*Vr(T,L,D)),Be(g,w+64,16843009*Vr(L,D,H)),Be(g,w+96,16843009*Vr(D,H,H))}function vi(g,w){var T,L=4;for(T=0;4>T;++T)L+=g[w+T-32]+g[w-1+32*T];for(L>>=3,T=0;4>T;++T)i(g,w+32*T,L,4)}function yc(g,w){var T=g[w-1+0],L=g[w-1+32],D=g[w-1+64],H=g[w-1-32],z=g[w+0-32],j=g[w+1-32],V=g[w+2-32],W=g[w+3-32];g[w+0+96]=Vr(L,D,g[w-1+96]),g[w+1+96]=g[w+0+64]=Vr(T,L,D),g[w+2+96]=g[w+1+64]=g[w+0+32]=Vr(H,T,L),g[w+3+96]=g[w+2+64]=g[w+1+32]=g[w+0+0]=Vr(z,H,T),g[w+3+64]=g[w+2+32]=g[w+1+0]=Vr(j,z,H),g[w+3+32]=g[w+2+0]=Vr(V,j,z),g[w+3+0]=Vr(W,V,j)}function Al(g,w){var T=g[w+1-32],L=g[w+2-32],D=g[w+3-32],H=g[w+4-32],z=g[w+5-32],j=g[w+6-32],V=g[w+7-32];g[w+0+0]=Vr(g[w+0-32],T,L),g[w+1+0]=g[w+0+32]=Vr(T,L,D),g[w+2+0]=g[w+1+32]=g[w+0+64]=Vr(L,D,H),g[w+3+0]=g[w+2+32]=g[w+1+64]=g[w+0+96]=Vr(D,H,z),g[w+3+32]=g[w+2+64]=g[w+1+96]=Vr(H,z,j),g[w+3+64]=g[w+2+96]=Vr(z,j,V),g[w+3+96]=Vr(j,V,V)}function ma(g,w){var T=g[w-1+0],L=g[w-1+32],D=g[w-1+64],H=g[w-1-32],z=g[w+0-32],j=g[w+1-32],V=g[w+2-32],W=g[w+3-32];g[w+0+0]=g[w+1+64]=H+z+1>>1,g[w+1+0]=g[w+2+64]=z+j+1>>1,g[w+2+0]=g[w+3+64]=j+V+1>>1,g[w+3+0]=V+W+1>>1,g[w+0+96]=Vr(D,L,T),g[w+0+64]=Vr(L,T,H),g[w+0+32]=g[w+1+96]=Vr(T,H,z),g[w+1+32]=g[w+2+96]=Vr(H,z,j),g[w+2+32]=g[w+3+96]=Vr(z,j,V),g[w+3+32]=Vr(j,V,W)}function Ga(g,w){var T=g[w+0-32],L=g[w+1-32],D=g[w+2-32],H=g[w+3-32],z=g[w+4-32],j=g[w+5-32],V=g[w+6-32],W=g[w+7-32];g[w+0+0]=T+L+1>>1,g[w+1+0]=g[w+0+64]=L+D+1>>1,g[w+2+0]=g[w+1+64]=D+H+1>>1,g[w+3+0]=g[w+2+64]=H+z+1>>1,g[w+0+32]=Vr(T,L,D),g[w+1+32]=g[w+0+96]=Vr(L,D,H),g[w+2+32]=g[w+1+96]=Vr(D,H,z),g[w+3+32]=g[w+2+96]=Vr(H,z,j),g[w+3+64]=Vr(z,j,V),g[w+3+96]=Vr(j,V,W)}function hl(g,w){var T=g[w-1+0],L=g[w-1+32],D=g[w-1+64],H=g[w-1+96];g[w+0+0]=T+L+1>>1,g[w+2+0]=g[w+0+32]=L+D+1>>1,g[w+2+32]=g[w+0+64]=D+H+1>>1,g[w+1+0]=Vr(T,L,D),g[w+3+0]=g[w+1+32]=Vr(L,D,H),g[w+3+32]=g[w+1+64]=Vr(D,H,H),g[w+3+64]=g[w+2+64]=g[w+0+96]=g[w+1+96]=g[w+2+96]=g[w+3+96]=H}function dl(g,w){var T=g[w-1+0],L=g[w-1+32],D=g[w-1+64],H=g[w-1+96],z=g[w-1-32],j=g[w+0-32],V=g[w+1-32],W=g[w+2-32];g[w+0+0]=g[w+2+32]=T+z+1>>1,g[w+0+32]=g[w+2+64]=L+T+1>>1,g[w+0+64]=g[w+2+96]=D+L+1>>1,g[w+0+96]=H+D+1>>1,g[w+3+0]=Vr(j,V,W),g[w+2+0]=Vr(z,j,V),g[w+1+0]=g[w+3+32]=Vr(T,z,j),g[w+1+32]=g[w+3+64]=Vr(L,T,z),g[w+1+64]=g[w+3+96]=Vr(D,L,T),g[w+1+96]=Vr(H,D,L)}function _d(g,w){var T;for(T=0;8>T;++T)n(g,w+32*T,g,w-32,8)}function tA(g,w){var T;for(T=0;8>T;++T)i(g,w,g[w-1],8),w+=32}function _c(g,w,T){var L;for(L=0;8>L;++L)i(w,T+32*L,g,8)}function vc(g,w){var T,L=8;for(T=0;8>T;++T)L+=g[w+T-32]+g[w-1+32*T];_c(L>>4,g,w)}function Va(g,w){var T,L=4;for(T=0;8>T;++T)L+=g[w+T-32];_c(L>>3,g,w)}function ya(g,w){var T,L=4;for(T=0;8>T;++T)L+=g[w-1+32*T];_c(L>>3,g,w)}function Ri(g,w){_c(128,g,w)}function Ci(g,w,T){var L=g[w-T],D=g[w+0],H=3*(D-L)+lh[1020+g[w-2*T]-g[w+T]],z=qe[112+(H+4>>3)];g[w-T]=Wi[255+L+qe[112+(H+3>>3)]],g[w+0]=Wi[255+D-z]}function ln(g,w,T,L){var D=g[w+0],H=g[w+T];return no[255+g[w-2*T]-g[w-T]]>L||no[255+H-D]>L}function fl(g,w,T,L){return 4*no[255+g[w-T]-g[w+0]]+no[255+g[w-2*T]-g[w+T]]<=L}function pl(g,w,T,L,D){var H=g[w-3*T],z=g[w-2*T],j=g[w-T],V=g[w+0],W=g[w+T],lt=g[w+2*T],rt=g[w+3*T];return 4*no[255+j-V]+no[255+z-W]>L?0:no[255+g[w-4*T]-H]<=D&&no[255+H-z]<=D&&no[255+z-j]<=D&&no[255+rt-lt]<=D&&no[255+lt-W]<=D&&no[255+W-V]<=D}function ou(g,w,T,L){var D=2*L+1;for(L=0;16>L;++L)fl(g,w+L,T,D)&&Ci(g,w+L,T)}function Ko(g,w,T,L){var D=2*L+1;for(L=0;16>L;++L)fl(g,w+L*T,1,D)&&Ci(g,w+L*T,1)}function $o(g,w,T,L){var D;for(D=3;0<D;--D)ou(g,w+=4*T,T,L)}function eA(g,w,T,L){var D;for(D=3;0<D;--D)Ko(g,w+=4,T,L)}function _a(g,w,T,L,D,H,z,j){for(H=2*H+1;0<D--;){if(pl(g,w,T,H,z))if(ln(g,w,T,j))Ci(g,w,T);else{var V=g,W=w,lt=T,rt=V[W-2*lt],ht=V[W-lt],gt=V[W+0],Mt=V[W+lt],Tt=V[W+2*lt],_t=27*(Gt=lh[1020+3*(gt-ht)+lh[1020+rt-Mt]])+63>>7,bt=18*Gt+63>>7,Gt=9*Gt+63>>7;V[W-3*lt]=Wi[255+V[W-3*lt]+Gt],V[W-2*lt]=Wi[255+rt+bt],V[W-lt]=Wi[255+ht+_t],V[W+0]=Wi[255+gt-_t],V[W+lt]=Wi[255+Mt-bt],V[W+2*lt]=Wi[255+Tt-Gt]}w+=L}}function ks(g,w,T,L,D,H,z,j){for(H=2*H+1;0<D--;){if(pl(g,w,T,H,z))if(ln(g,w,T,j))Ci(g,w,T);else{var V=g,W=w,lt=T,rt=V[W-lt],ht=V[W+0],gt=V[W+lt],Mt=qe[112+((Tt=3*(ht-rt))+4>>3)],Tt=qe[112+(Tt+3>>3)],_t=Mt+1>>1;V[W-2*lt]=Wi[255+V[W-2*lt]+_t],V[W-lt]=Wi[255+rt+Tt],V[W+0]=Wi[255+ht-Mt],V[W+lt]=Wi[255+gt-_t]}w+=L}}function au(g,w,T,L,D,H){_a(g,w,T,1,16,L,D,H)}function bc(g,w,T,L,D,H){_a(g,w,1,T,16,L,D,H)}function wc(g,w,T,L,D,H){var z;for(z=3;0<z;--z)ks(g,w+=4*T,T,1,16,L,D,H)}function cu(g,w,T,L,D,H){var z;for(z=3;0<z;--z)ks(g,w+=4,1,T,16,L,D,H)}function vd(g,w,T,L,D,H,z,j){_a(g,w,D,1,8,H,z,j),_a(T,L,D,1,8,H,z,j)}function rA(g,w,T,L,D,H,z,j){_a(g,w,1,D,8,H,z,j),_a(T,L,1,D,8,H,z,j)}function nA(g,w,T,L,D,H,z,j){ks(g,w+4*D,D,1,8,H,z,j),ks(T,L+4*D,D,1,8,H,z,j)}function ch(g,w,T,L,D,H,z,j){ks(g,w+4,1,D,8,H,z,j),ks(T,L+4,1,D,8,H,z,j)}function lu(){this.ba=new $r,this.ec=[],this.cc=[],this.Mc=[],this.Dc=this.Nc=this.dc=this.fc=0,this.Oa=new Z,this.memory=0,this.Ib="OutputFunc",this.Jb="OutputAlphaFunc",this.Nd="OutputRowFunc"}function gl(){this.data=[],this.offset=this.kd=this.ha=this.w=0,this.na=[],this.xa=this.gb=this.Ja=this.Sa=this.P=0}function xc(){this.nc=this.Ea=this.b=this.hc=0,this.K=[],this.w=0}function uu(){this.ua=0,this.Wa=new Ut,this.vb=new Ut,this.md=this.xc=this.wc=0,this.vc=[],this.Wb=0,this.Ya=new yt,this.yc=new ct}function iA(){this.xb=this.a=0,this.l=new Ns,this.ca=new $r,this.V=[],this.Ba=0,this.Ta=[],this.Ua=0,this.m=new it,this.Pb=0,this.wd=new it,this.Ma=this.$=this.C=this.i=this.c=this.xd=0,this.s=new uu,this.ab=0,this.gc=a(4,xc),this.Oc=0}function Wo(){this.Lc=this.Z=this.$a=this.i=this.c=0,this.l=new Ns,this.ic=0,this.ca=[],this.tb=0,this.qd=null,this.rd=0}function Bc(g,w,T,L,D,H,z){for(g=g==null?0:g[w+0],w=0;w<z;++w)D[H+w]=g+T[L+w]&255,g=D[H+w]}function Au(g,w,T,L,D,H,z){var j;if(g==null)Bc(null,null,T,L,D,H,z);else for(j=0;j<z;++j)D[H+j]=g[w+j]+T[L+j]&255}function va(g,w,T,L,D,H,z){if(g==null)Bc(null,null,T,L,D,H,z);else{var j,V=g[w+0],W=V,lt=V;for(j=0;j<z;++j)W=lt+(V=g[w+j])-W,lt=T[L+j]+(-256&W?0>W?0:255:W)&255,W=V,D[H+j]=lt}}function Xo(g,w,T,L){var D=w.width,H=w.o;if(t(g!=null&&w!=null),0>T||0>=L||T+L>H)return null;if(!g.Cc){if(g.ga==null){var z;if(g.ga=new Wo,(z=g.ga==null)||(z=w.width*w.o,t(g.Gb.length==0),g.Gb=s(z),g.Uc=0,g.Gb==null?z=0:(g.mb=g.Gb,g.nb=g.Uc,g.rc=null,z=1),z=!z),!z){z=g.ga;var j=g.Fa,V=g.P,W=g.qc,lt=g.mb,rt=g.nb,ht=V+1,gt=W-1,Mt=z.l;if(t(j!=null&&lt!=null&&w!=null),So[0]=null,So[1]=Bc,So[2]=Au,So[3]=va,z.ca=lt,z.tb=rt,z.c=w.width,z.i=w.height,t(0<z.c&&0<z.i),1>=W)w=0;else if(z.$a=j[V+0]>>0&3,z.Z=j[V+0]>>2&3,z.Lc=j[V+0]>>4&3,V=j[V+0]>>6&3,0>z.$a||1<z.$a||4<=z.Z||1<z.Lc||V)w=0;else if(Mt.put=zt,Mt.ac=kt,Mt.bc=qt,Mt.ma=z,Mt.width=w.width,Mt.height=w.height,Mt.Da=w.Da,Mt.v=w.v,Mt.va=w.va,Mt.j=w.j,Mt.o=w.o,z.$a)t:{t(z.$a==1),w=mr();e:for(;;){if(w==null){w=0;break t}if(t(z!=null),z.mc=w,w.c=z.c,w.i=z.i,w.l=z.l,w.l.ma=z,w.l.width=z.c,w.l.height=z.i,w.a=0,Xt(w.m,j,ht,gt),!Wr(z.c,z.i,1,w,null)||(w.ab==1&&w.gc[0].hc==3&&lr(w.s)?(z.ic=1,j=w.c*w.i,w.Ta=null,w.Ua=0,w.V=s(j),w.Ba=0,w.V==null?(w.a=1,w=0):w=1):(z.ic=0,w=bn(w,z.c)),!w))break e;w=1;break t}z.mc=null,w=0}else w=gt>=z.c*z.i;z=!w}if(z)return null;g.ga.Lc!=1?g.Ga=0:L=H-T}t(g.ga!=null),t(T+L<=H);t:{if(w=(j=g.ga).c,H=j.l.o,j.$a==0){if(ht=g.rc,gt=g.Vc,Mt=g.Fa,V=g.P+1+T*w,W=g.mb,lt=g.nb+T*w,t(V<=g.P+g.qc),j.Z!=0)for(t(So[j.Z]!=null),z=0;z<L;++z)So[j.Z](ht,gt,Mt,V,W,lt,w),ht=W,gt=lt,lt+=w,V+=w;else for(z=0;z<L;++z)n(W,lt,Mt,V,w),ht=W,gt=lt,lt+=w,V+=w;g.rc=ht,g.Vc=gt}else{if(t(j.mc!=null),w=T+L,t((z=j.mc)!=null),t(w<=z.i),z.C>=w)w=1;else if(j.ic||oe(),j.ic){j=z.V,ht=z.Ba,gt=z.c;var Tt=z.i,_t=(Mt=1,V=z.$/gt,W=z.$%gt,lt=z.m,rt=z.s,z.$),bt=gt*Tt,Gt=gt*w,Wt=rt.wc,ue=_t<Gt?Ve(rt,W,V):null;t(_t<=bt),t(w<=Tt),t(lr(rt));e:for(;;){for(;!lt.h&&_t<Gt;){if(W&Wt||(ue=Ve(rt,W,V)),t(ue!=null),$t(lt),256>(Tt=pe(ue.G[0],ue.H[0],lt)))j[ht+_t]=Tt,++_t,++W>=gt&&(W=0,++V<=w&&!(V%16)&&kr(z,V));else{if(!(280>Tt)){Mt=0;break e}Tt=Yt(Tt-256,lt);var Ae,ye=pe(ue.G[4],ue.H[4],lt);if($t(lt),!(_t>=(ye=me(gt,ye=Yt(ye,lt)))&&bt-_t>=Tt)){Mt=0;break e}for(Ae=0;Ae<Tt;++Ae)j[ht+_t+Ae]=j[ht+_t+Ae-ye];for(_t+=Tt,W+=Tt;W>=gt;)W-=gt,++V<=w&&!(V%16)&&kr(z,V);_t<Gt&&W&Wt&&(ue=Ve(rt,W,V))}t(lt.h==Ft(lt))}kr(z,V>w?w:V);break e}!Mt||lt.h&&_t<bt?(Mt=0,z.a=lt.h?5:3):z.$=_t,w=Mt}else w=Hr(z,z.V,z.Ba,z.c,z.i,w,Qn);if(!w){L=0;break t}}T+L>=H&&(g.Cc=1),L=1}if(!L)return null;if(g.Cc&&((L=g.ga)!=null&&(L.mc=null),g.ga=null,0<g.Ga))return alert("todo:WebPDequantizeLevels"),null}return g.nb+T*D}function N(g,w,T,L,D,H){for(;0<D--;){var z,j=g,V=w+(T?1:0),W=g,lt=w+(T?0:3);for(z=0;z<L;++z){var rt=W[lt+4*z];rt!=255&&(rt*=32897,j[V+4*z+0]=j[V+4*z+0]*rt>>23,j[V+4*z+1]=j[V+4*z+1]*rt>>23,j[V+4*z+2]=j[V+4*z+2]*rt>>23)}w+=H}}function et(g,w,T,L,D){for(;0<L--;){var H;for(H=0;H<T;++H){var z=g[w+2*H+0],j=15&(W=g[w+2*H+1]),V=4369*j,W=(240&W|W>>4)*V>>16;g[w+2*H+0]=(240&z|z>>4)*V>>16&240|(15&z|z<<4)*V>>16>>4&15,g[w+2*H+1]=240&W|j}w+=D}}function Pt(g,w,T,L,D,H,z,j){var V,W,lt=255;for(W=0;W<D;++W){for(V=0;V<L;++V){var rt=g[w+V];H[z+4*V]=rt,lt&=rt}w+=T,z+=j}return lt!=255}function Vt(g,w,T,L,D){var H;for(H=0;H<D;++H)T[L+H]=g[w+H]>>8}function oe(){Ca=N,pu=et,Wa=Pt,gu=Vt}function ce(g,w,T){dt[g]=function(L,D,H,z,j,V,W,lt,rt,ht,gt,Mt,Tt,_t,bt,Gt,Wt){var ue,Ae=Wt-1>>1,ye=j[V+0]|W[lt+0]<<16,Oe=rt[ht+0]|gt[Mt+0]<<16;t(L!=null);var Ce=3*ye+Oe+131074>>2;for(w(L[D+0],255&Ce,Ce>>16,Tt,_t),H!=null&&(Ce=3*Oe+ye+131074>>2,w(H[z+0],255&Ce,Ce>>16,bt,Gt)),ue=1;ue<=Ae;++ue){var We=j[V+ue]|W[lt+ue]<<16,nr=rt[ht+ue]|gt[Mt+ue]<<16,rr=ye+We+Oe+nr+524296,Sr=rr+2*(We+Oe)>>3;Ce=Sr+ye>>1,ye=(rr=rr+2*(ye+nr)>>3)+We>>1,w(L[D+2*ue-1],255&Ce,Ce>>16,Tt,_t+(2*ue-1)*T),w(L[D+2*ue-0],255&ye,ye>>16,Tt,_t+(2*ue-0)*T),H!=null&&(Ce=rr+Oe>>1,ye=Sr+nr>>1,w(H[z+2*ue-1],255&Ce,Ce>>16,bt,Gt+(2*ue-1)*T),w(H[z+2*ue+0],255&ye,ye>>16,bt,Gt+(2*ue+0)*T)),ye=We,Oe=nr}1&Wt||(Ce=3*ye+Oe+131074>>2,w(L[D+Wt-1],255&Ce,Ce>>16,Tt,_t+(Wt-1)*T),H!=null&&(Ce=3*Oe+ye+131074>>2,w(H[z+Wt-1],255&Ce,Ce>>16,bt,Gt+(Wt-1)*T)))}}function Me(){Ts[aA]=Sd,Ts[xl]=Ea,Ts[uh]=Td,Ts[Bl]=dA,Ts[cA]=mu,Ts[wd]=fA,Ts[Xa]=pA,Ts[Gn]=Ea,Ts[Cl]=dA,Ts[El]=mu,Ts[lA]=fA}function cr(g){return g&~Il?0>g?0:255:g>>gA}function Mr(g,w){return cr((19077*g>>8)+(26149*w>>8)-14234)}function Gr(g,w,T){return cr((19077*g>>8)-(6419*w>>8)-(13320*T>>8)+8708)}function vr(g,w){return cr((19077*g>>8)+(33050*w>>8)-17685)}function wn(g,w,T,L,D){L[D+0]=Mr(g,T),L[D+1]=Gr(g,w,T),L[D+2]=vr(g,w)}function br(g,w,T,L,D){L[D+0]=vr(g,w),L[D+1]=Gr(g,w,T),L[D+2]=Mr(g,T)}function hi(g,w,T,L,D){var H=Gr(g,w,T);w=H<<3&224|vr(g,w)>>3,L[D+0]=248&Mr(g,T)|H>>5,L[D+1]=w}function Kr(g,w,T,L,D){var H=240&vr(g,w)|15;L[D+0]=240&Mr(g,T)|Gr(g,w,T)>>4,L[D+1]=H}function Xr(g,w,T,L,D){L[D+0]=255,wn(g,w,T,L,D+1)}function oi(g,w,T,L,D){br(g,w,T,L,D),L[D+3]=255}function Qs(g,w,T,L,D){wn(g,w,T,L,D),L[D+3]=255}function Hs(g,w){return 0>g?0:g>w?w:g}function ba(g,w,T){dt[g]=function(L,D,H,z,j,V,W,lt,rt){for(var ht=lt+(-2&rt)*T;lt!=ht;)w(L[D+0],H[z+0],j[V+0],W,lt),w(L[D+1],H[z+0],j[V+0],W,lt+T),D+=2,++z,++V,lt+=2*T;1&rt&&w(L[D+0],H[z+0],j[V+0],W,lt)}}function ml(g,w,T){return T==0?g==0?w==0?6:5:w==0?4:0:T}function Cc(g,w,T,L,D){switch(g>>>30){case 3:wa(w,T,L,D,0);break;case 2:Jo(w,T,L,D);break;case 1:Co(w,T,L,D)}}function Ec(g,w){var T,L,D=w.M,H=w.Nb,z=g.oc,j=g.pc+40,V=g.oc,W=g.pc+584,lt=g.oc,rt=g.pc+600;for(T=0;16>T;++T)z[j+32*T-1]=129;for(T=0;8>T;++T)V[W+32*T-1]=129,lt[rt+32*T-1]=129;for(0<D?z[j-1-32]=V[W-1-32]=lt[rt-1-32]=129:(i(z,j-32-1,127,21),i(V,W-32-1,127,9),i(lt,rt-32-1,127,9)),L=0;L<g.za;++L){var ht=w.ya[w.aa+L];if(0<L){for(T=-1;16>T;++T)n(z,j+32*T-4,z,j+32*T+12,4);for(T=-1;8>T;++T)n(V,W+32*T-4,V,W+32*T+4,4),n(lt,rt+32*T-4,lt,rt+32*T+4,4)}var gt=g.Gd,Mt=g.Hd+L,Tt=ht.ad,_t=ht.Hc;if(0<D&&(n(z,j-32,gt[Mt].y,0,16),n(V,W-32,gt[Mt].f,0,8),n(lt,rt-32,gt[Mt].ea,0,8)),ht.Za){var bt=z,Gt=j-32+16;for(0<D&&(L>=g.za-1?i(bt,Gt,gt[Mt].y[15],4):n(bt,Gt,gt[Mt+1].y,0,4)),T=0;4>T;T++)bt[Gt+128+T]=bt[Gt+256+T]=bt[Gt+384+T]=bt[Gt+0+T];for(T=0;16>T;++T,_t<<=2)bt=z,Gt=j+y[T],ki[ht.Ob[T]](bt,Gt),Cc(_t,Tt,16*+T,bt,Gt)}else if(bt=ml(L,D,ht.Ob[0]),Eo[bt](z,j),_t!=0)for(T=0;16>T;++T,_t<<=2)Cc(_t,Tt,16*+T,z,j+y[T]);for(T=ht.Gc,bt=ml(L,D,ht.Dd),ra[bt](V,W),ra[bt](lt,rt),_t=Tt,bt=V,Gt=W,255&(ht=T>>0)&&(170&ht?Ka(_t,256,bt,Gt):xa(_t,256,bt,Gt)),ht=lt,_t=rt,255&(T>>=8)&&(170&T?Ka(Tt,320,ht,_t):xa(Tt,320,ht,_t)),D<g.Ub-1&&(n(gt[Mt].y,0,z,j+480,16),n(gt[Mt].f,0,V,W+224,8),n(gt[Mt].ea,0,lt,rt+224,8)),T=8*H*g.B,gt=g.sa,Mt=g.ta+16*L+16*H*g.R,Tt=g.qa,ht=g.ra+8*L+T,_t=g.Ha,bt=g.Ia+8*L+T,T=0;16>T;++T)n(gt,Mt+T*g.R,z,j+32*T,16);for(T=0;8>T;++T)n(Tt,ht+T*g.B,V,W+32*T,8),n(_t,bt+T*g.B,lt,rt+32*T,8)}}function yl(g,w,T,L,D,H,z,j,V){var W=[0],lt=[0],rt=0,ht=V!=null?V.kd:0,gt=V??new gl;if(g==null||12>T)return 7;gt.data=g,gt.w=w,gt.ha=T,w=[w],T=[T],gt.gb=[gt.gb];t:{var Mt=w,Tt=T,_t=gt.gb;if(t(g!=null),t(Tt!=null),t(_t!=null),_t[0]=0,12<=Tt[0]&&!e(g,Mt[0],"RIFF")){if(e(g,Mt[0]+8,"WEBP")){_t=3;break t}var bt=He(g,Mt[0]+4);if(12>bt||4294967286<bt){_t=3;break t}if(ht&&bt>Tt[0]-8){_t=7;break t}_t[0]=bt,Mt[0]+=12,Tt[0]-=12}_t=0}if(_t!=0)return _t;for(bt=0<gt.gb[0],T=T[0];;){t:{var Gt=g;Tt=w,_t=T;var Wt=W,ue=lt,Ae=Mt=[0];if((Ce=rt=[rt])[0]=0,8>_t[0])_t=7;else{if(!e(Gt,Tt[0],"VP8X")){if(He(Gt,Tt[0]+4)!=10){_t=3;break t}if(18>_t[0]){_t=7;break t}var ye=He(Gt,Tt[0]+8),Oe=1+Qe(Gt,Tt[0]+12);if(2147483648<=Oe*(Gt=1+Qe(Gt,Tt[0]+15))){_t=3;break t}Ae!=null&&(Ae[0]=ye),Wt!=null&&(Wt[0]=Oe),ue!=null&&(ue[0]=Gt),Tt[0]+=18,_t[0]-=18,Ce[0]=1}_t=0}}if(rt=rt[0],Mt=Mt[0],_t!=0)return _t;if(Tt=!!(2&Mt),!bt&&rt)return 3;if(H!=null&&(H[0]=!!(16&Mt)),z!=null&&(z[0]=Tt),j!=null&&(j[0]=0),z=W[0],Mt=lt[0],rt&&Tt&&V==null){_t=0;break}if(4>T){_t=7;break}if(bt&&rt||!bt&&!rt&&!e(g,w[0],"ALPH")){T=[T],gt.na=[gt.na],gt.P=[gt.P],gt.Sa=[gt.Sa];t:{ye=g,_t=w,bt=T;var Ce=gt.gb;Wt=gt.na,ue=gt.P,Ae=gt.Sa,Oe=22,t(ye!=null),t(bt!=null),Gt=_t[0];var We=bt[0];for(t(Wt!=null),t(Ae!=null),Wt[0]=null,ue[0]=null,Ae[0]=0;;){if(_t[0]=Gt,bt[0]=We,8>We){_t=7;break t}var nr=He(ye,Gt+4);if(4294967286<nr){_t=3;break t}var rr=8+nr+1&-2;if(Oe+=rr,0<Ce&&Oe>Ce){_t=3;break t}if(!e(ye,Gt,"VP8 ")||!e(ye,Gt,"VP8L")){_t=0;break t}if(We[0]<rr){_t=7;break t}e(ye,Gt,"ALPH")||(Wt[0]=ye,ue[0]=Gt+8,Ae[0]=nr),Gt+=rr,We-=rr}}if(T=T[0],gt.na=gt.na[0],gt.P=gt.P[0],gt.Sa=gt.Sa[0],_t!=0)break}T=[T],gt.Ja=[gt.Ja],gt.xa=[gt.xa];t:if(Ce=g,_t=w,bt=T,Wt=gt.gb[0],ue=gt.Ja,Ae=gt.xa,ye=_t[0],Gt=!e(Ce,ye,"VP8 "),Oe=!e(Ce,ye,"VP8L"),t(Ce!=null),t(bt!=null),t(ue!=null),t(Ae!=null),8>bt[0])_t=7;else{if(Gt||Oe){if(Ce=He(Ce,ye+4),12<=Wt&&Ce>Wt-12){_t=3;break t}if(ht&&Ce>bt[0]-8){_t=7;break t}ue[0]=Ce,_t[0]+=8,bt[0]-=8,Ae[0]=Oe}else Ae[0]=5<=bt[0]&&Ce[ye+0]==47&&!(Ce[ye+4]>>5),ue[0]=bt[0];_t=0}if(T=T[0],gt.Ja=gt.Ja[0],gt.xa=gt.xa[0],w=w[0],_t!=0)break;if(4294967286<gt.Ja)return 3;if(j==null||Tt||(j[0]=gt.xa?2:1),z=[z],Mt=[Mt],gt.xa){if(5>T){_t=7;break}j=z,ht=Mt,Tt=H,g==null||5>T?g=0:5<=T&&g[w+0]==47&&!(g[w+4]>>5)?(bt=[0],Ce=[0],Wt=[0],Xt(ue=new it,g,w,T),St(ue,bt,Ce,Wt)?(j!=null&&(j[0]=bt[0]),ht!=null&&(ht[0]=Ce[0]),Tt!=null&&(Tt[0]=Wt[0]),g=1):g=0):g=0}else{if(10>T){_t=7;break}j=Mt,g==null||10>T||!Zs(g,w+3,T-3)?g=0:(ht=g[w+0]|g[w+1]<<8|g[w+2]<<16,Tt=16383&(g[w+7]<<8|g[w+6]),g=16383&(g[w+9]<<8|g[w+8]),1&ht||3<(ht>>1&7)||!(ht>>4&1)||ht>>5>=gt.Ja||!Tt||!g?g=0:(z&&(z[0]=Tt),j&&(j[0]=g),g=1))}if(!g||(z=z[0],Mt=Mt[0],rt&&(W[0]!=z||lt[0]!=Mt)))return 3;V!=null&&(V[0]=gt,V.offset=w-V.w,t(4294967286>w-V.w),t(V.offset==V.ha-T));break}return _t==0||_t==7&&rt&&V==null?(H!=null&&(H[0]|=gt.na!=null&&0<gt.na.length),L!=null&&(L[0]=z),D!=null&&(D[0]=Mt),0):_t}function Sc(g,w,T){var L=w.width,D=w.height,H=0,z=0,j=L,V=D;if(w.Da=g!=null&&0<g.Da,w.Da&&(j=g.cd,V=g.bd,H=g.v,z=g.j,11>T||(H&=-2,z&=-2),0>H||0>z||0>=j||0>=V||H+j>L||z+V>D))return 0;if(w.v=H,w.j=z,w.va=H+j,w.o=z+V,w.U=j,w.T=V,w.da=g!=null&&0<g.da,w.da){if(!Jt(j,V,T=[g.ib],H=[g.hb]))return 0;w.ib=T[0],w.hb=H[0]}return w.ob=g!=null&&g.ob,w.Kb=g==null||!g.Sd,w.da&&(w.ob=w.ib<3*L/4&&w.hb<3*D/4,w.Kb=0),1}function hu(g){if(g==null)return 2;if(11>g.S){var w=g.f.RGBA;w.fb+=(g.height-1)*w.A,w.A=-w.A}else w=g.f.kb,g=g.height,w.O+=(g-1)*w.fa,w.fa=-w.fa,w.N+=(g-1>>1)*w.Ab,w.Ab=-w.Ab,w.W+=(g-1>>1)*w.Db,w.Db=-w.Db,w.F!=null&&(w.J+=(g-1)*w.lb,w.lb=-w.lb);return 0}function ja(g,w,T,L){if(L==null||0>=g||0>=w)return 2;if(T!=null){if(T.Da){var D=T.cd,H=T.bd,z=-2&T.v,j=-2&T.j;if(0>z||0>j||0>=D||0>=H||z+D>g||j+H>w)return 2;g=D,w=H}if(T.da){if(!Jt(g,w,D=[T.ib],H=[T.hb]))return 2;g=D[0],w=H[0]}}L.width=g,L.height=w;t:{var V=L.width,W=L.height;if(g=L.S,0>=V||0>=W||!(g>=aA&&13>g))g=2;else{if(0>=L.Rd&&L.sd==null){z=H=D=w=0;var lt=(j=V*R[g])*W;if(11>g||(H=(W+1)/2*(w=(V+1)/2),g==12&&(z=(D=V)*W)),(W=s(lt+2*H+z))==null){g=1;break t}L.sd=W,11>g?((V=L.f.RGBA).eb=W,V.fb=0,V.A=j,V.size=lt):((V=L.f.kb).y=W,V.O=0,V.fa=j,V.Fd=lt,V.f=W,V.N=0+lt,V.Ab=w,V.Cd=H,V.ea=W,V.W=0+lt+H,V.Db=w,V.Ed=H,g==12&&(V.F=W,V.J=0+lt+2*H),V.Tc=z,V.lb=D)}if(w=1,D=L.S,H=L.width,z=L.height,D>=aA&&13>D)if(11>D)g=L.f.RGBA,w&=(j=Math.abs(g.A))*(z-1)+H<=g.size,w&=j>=H*R[D],w&=g.eb!=null;else{g=L.f.kb,j=(H+1)/2,lt=(z+1)/2,V=Math.abs(g.fa),W=Math.abs(g.Ab);var rt=Math.abs(g.Db),ht=Math.abs(g.lb),gt=ht*(z-1)+H;w&=V*(z-1)+H<=g.Fd,w&=W*(lt-1)+j<=g.Cd,w=(w&=rt*(lt-1)+j<=g.Ed)&V>=H&W>=j&rt>=j,w&=g.y!=null,w&=g.f!=null,w&=g.ea!=null,D==12&&(w&=ht>=H,w&=gt<=g.Tc,w&=g.F!=null)}else w=0;g=w?0:2}}return g!=0||T!=null&&T.fd&&(g=hu(L)),g}var ls=64,Tc=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215],_l=24,vl=32,Ic=8,ws=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];_e("Predictor0","PredictorAdd0"),dt.Predictor0=function(){return 4278190080},dt.Predictor1=function(g){return g},dt.Predictor2=function(g,w,T){return w[T+0]},dt.Predictor3=function(g,w,T){return w[T+1]},dt.Predictor4=function(g,w,T){return w[T-1]},dt.Predictor5=function(g,w,T){return Ne(Ne(g,w[T+1]),w[T+0])},dt.Predictor6=function(g,w,T){return Ne(g,w[T-1])},dt.Predictor7=function(g,w,T){return Ne(g,w[T+0])},dt.Predictor8=function(g,w,T){return Ne(w[T-1],w[T+0])},dt.Predictor9=function(g,w,T){return Ne(w[T+0],w[T+1])},dt.Predictor10=function(g,w,T){return Ne(Ne(g,w[T-1]),Ne(w[T+0],w[T+1]))},dt.Predictor11=function(g,w,T){var L=w[T+0];return 0>=Lr(L>>24&255,g>>24&255,(w=w[T-1])>>24&255)+Lr(L>>16&255,g>>16&255,w>>16&255)+Lr(L>>8&255,g>>8&255,w>>8&255)+Lr(255&L,255&g,255&w)?L:g},dt.Predictor12=function(g,w,T){var L=w[T+0];return(ir((g>>24&255)+(L>>24&255)-((w=w[T-1])>>24&255))<<24|ir((g>>16&255)+(L>>16&255)-(w>>16&255))<<16|ir((g>>8&255)+(L>>8&255)-(w>>8&255))<<8|ir((255&g)+(255&L)-(255&w)))>>>0},dt.Predictor13=function(g,w,T){var L=w[T-1];return(Ar((g=Ne(g,w[T+0]))>>24&255,L>>24&255)<<24|Ar(g>>16&255,L>>16&255)<<16|Ar(g>>8&255,L>>8&255)<<8|Ar(g>>0&255,L>>0&255))>>>0};var bd=dt.PredictorAdd0;dt.PredictorAdd1=Tr,_e("Predictor2","PredictorAdd2"),_e("Predictor3","PredictorAdd3"),_e("Predictor4","PredictorAdd4"),_e("Predictor5","PredictorAdd5"),_e("Predictor6","PredictorAdd6"),_e("Predictor7","PredictorAdd7"),_e("Predictor8","PredictorAdd8"),_e("Predictor9","PredictorAdd9"),_e("Predictor10","PredictorAdd10"),_e("Predictor11","PredictorAdd11"),_e("Predictor12","PredictorAdd12"),_e("Predictor13","PredictorAdd13");var du=dt.PredictorAdd2;Ir("ColorIndexInverseTransform","MapARGB","32b",function(g){return g>>8&255},function(g){return g}),Ir("VP8LColorIndexInverseTransformAlpha","MapAlpha","8b",function(g){return g},function(g){return g>>8&255});var Xn,Ki=dt.ColorIndexInverseTransform,Oi=dt.MapARGB,sA=dt.VP8LColorIndexInverseTransformAlpha,fu=dt.MapAlpha,qa=dt.VP8LPredictorsAdd=[];qa.length=16,(dt.VP8LPredictors=[]).length=16,(dt.VP8LPredictorsAdd_C=[]).length=16,(dt.VP8LPredictors_C=[]).length=16;var Di,$i,eo,xo,Bo,Lc,ro,wa,Jo,Ka,Co,xa,Fc,Ba,Yo,Ei,zs,Gs,Ni,vn,Ln,Fn,ei,$a,Ca,pu,Wa,gu,Zo=s(511),tr=s(2041),oA=s(225),bl=s(767),wl=0,lh=tr,qe=oA,Wi=bl,no=Zo,aA=0,xl=1,uh=2,Bl=3,cA=4,wd=5,Xa=6,Gn=7,Cl=8,El=9,lA=10,fp=[2,3,7],pp=[3,3,11],xd=[280,256,256,256,40],ta=[0,1,1,1,0],uA=[17,18,0,1,2,3,4,5,16,6,7,8,9,10,11,12,13,14,15],dr=[24,7,23,25,40,6,39,41,22,26,38,42,56,5,55,57,21,27,54,58,37,43,72,4,71,73,20,28,53,59,70,74,36,44,88,69,75,52,60,3,87,89,19,29,86,90,35,45,68,76,85,91,51,61,104,2,103,105,18,30,102,106,34,46,84,92,67,77,101,107,50,62,120,1,119,121,83,93,17,31,100,108,66,78,118,122,33,47,117,123,49,63,99,109,82,94,0,116,124,65,79,16,32,98,110,48,115,125,81,95,64,114,126,97,111,80,113,127,96,112],wr=[2954,2956,2958,2962,2970,2986,3018,3082,3212,3468,3980,5004],Ah=8,Sl=[4,5,6,7,8,9,10,10,11,12,13,14,15,16,17,17,18,19,20,20,21,21,22,22,23,23,24,25,25,26,27,28,29,30,31,32,33,34,35,36,37,37,38,39,40,41,42,43,44,45,46,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,76,77,78,79,80,81,82,83,84,85,86,87,88,89,91,93,95,96,98,100,101,102,104,106,108,110,112,114,116,118,122,124,126,128,130,132,134,136,138,140,143,145,148,151,154,157],AA=[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,119,122,125,128,131,134,137,140,143,146,149,152,155,158,161,164,167,170,173,177,181,185,189,193,197,201,205,209,213,217,221,225,229,234,239,245,249,254,259,264,269,274,279,284],Xi=null,Bd=[[173,148,140,0],[176,155,140,135,0],[180,157,141,134,130,0],[254,254,243,230,196,177,153,140,133,130,129,0]],ea=[0,1,4,8,5,2,3,6,9,12,13,10,7,11,14,15],Cd=[-0,1,-1,2,-2,3,4,6,-3,5,-4,-5,-6,7,-7,8,-8,-9],hA=[[[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]],[[253,136,254,255,228,219,128,128,128,128,128],[189,129,242,255,227,213,255,219,128,128,128],[106,126,227,252,214,209,255,255,128,128,128]],[[1,98,248,255,236,226,255,255,128,128,128],[181,133,238,254,221,234,255,154,128,128,128],[78,134,202,247,198,180,255,219,128,128,128]],[[1,185,249,255,243,255,128,128,128,128,128],[184,150,247,255,236,224,128,128,128,128,128],[77,110,216,255,236,230,128,128,128,128,128]],[[1,101,251,255,241,255,128,128,128,128,128],[170,139,241,252,236,209,255,255,128,128,128],[37,116,196,243,228,255,255,255,128,128,128]],[[1,204,254,255,245,255,128,128,128,128,128],[207,160,250,255,238,128,128,128,128,128,128],[102,103,231,255,211,171,128,128,128,128,128]],[[1,152,252,255,240,255,128,128,128,128,128],[177,135,243,255,234,225,128,128,128,128,128],[80,129,211,255,194,224,128,128,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[246,1,255,128,128,128,128,128,128,128,128],[255,128,128,128,128,128,128,128,128,128,128]]],[[[198,35,237,223,193,187,162,160,145,155,62],[131,45,198,221,172,176,220,157,252,221,1],[68,47,146,208,149,167,221,162,255,223,128]],[[1,149,241,255,221,224,255,255,128,128,128],[184,141,234,253,222,220,255,199,128,128,128],[81,99,181,242,176,190,249,202,255,255,128]],[[1,129,232,253,214,197,242,196,255,255,128],[99,121,210,250,201,198,255,202,128,128,128],[23,91,163,242,170,187,247,210,255,255,128]],[[1,200,246,255,234,255,128,128,128,128,128],[109,178,241,255,231,245,255,255,128,128,128],[44,130,201,253,205,192,255,255,128,128,128]],[[1,132,239,251,219,209,255,165,128,128,128],[94,136,225,251,218,190,255,255,128,128,128],[22,100,174,245,186,161,255,199,128,128,128]],[[1,182,249,255,232,235,128,128,128,128,128],[124,143,241,255,227,234,128,128,128,128,128],[35,77,181,251,193,211,255,205,128,128,128]],[[1,157,247,255,236,231,255,255,128,128,128],[121,141,235,255,225,227,255,255,128,128,128],[45,99,188,251,195,217,255,224,128,128,128]],[[1,1,251,255,213,255,128,128,128,128,128],[203,1,248,255,255,128,128,128,128,128,128],[137,1,177,255,224,255,128,128,128,128,128]]],[[[253,9,248,251,207,208,255,192,128,128,128],[175,13,224,243,193,185,249,198,255,255,128],[73,17,171,221,161,179,236,167,255,234,128]],[[1,95,247,253,212,183,255,255,128,128,128],[239,90,244,250,211,209,255,255,128,128,128],[155,77,195,248,188,195,255,255,128,128,128]],[[1,24,239,251,218,219,255,205,128,128,128],[201,51,219,255,196,186,128,128,128,128,128],[69,46,190,239,201,218,255,228,128,128,128]],[[1,191,251,255,255,128,128,128,128,128,128],[223,165,249,255,213,255,128,128,128,128,128],[141,124,248,255,255,128,128,128,128,128,128]],[[1,16,248,255,255,128,128,128,128,128,128],[190,36,230,255,236,255,128,128,128,128,128],[149,1,255,128,128,128,128,128,128,128,128]],[[1,226,255,128,128,128,128,128,128,128,128],[247,192,255,128,128,128,128,128,128,128,128],[240,128,255,128,128,128,128,128,128,128,128]],[[1,134,252,255,255,128,128,128,128,128,128],[213,62,250,255,255,128,128,128,128,128,128],[55,93,255,128,128,128,128,128,128,128,128]],[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]]],[[[202,24,213,235,186,191,220,160,240,175,255],[126,38,182,232,169,184,228,174,255,187,128],[61,46,138,219,151,178,240,170,255,216,128]],[[1,112,230,250,199,191,247,159,255,255,128],[166,109,228,252,211,215,255,174,128,128,128],[39,77,162,232,172,180,245,178,255,255,128]],[[1,52,220,246,198,199,249,220,255,255,128],[124,74,191,243,183,193,250,221,255,255,128],[24,71,130,219,154,170,243,182,255,255,128]],[[1,182,225,249,219,240,255,224,128,128,128],[149,150,226,252,216,205,255,171,128,128,128],[28,108,170,242,183,194,254,223,255,255,128]],[[1,81,230,252,204,203,255,192,128,128,128],[123,102,209,247,188,196,255,233,128,128,128],[20,95,153,243,164,173,255,203,128,128,128]],[[1,222,248,255,216,213,128,128,128,128,128],[168,175,246,252,235,205,255,255,128,128,128],[47,116,215,255,211,212,255,255,128,128,128]],[[1,121,236,253,212,214,255,255,128,128,128],[141,84,213,252,201,202,255,219,128,128,128],[42,80,160,240,162,185,255,205,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[244,1,255,128,128,128,128,128,128,128,128],[238,1,255,128,128,128,128,128,128,128,128]]]],di=[[[231,120,48,89,115,113,120,152,112],[152,179,64,126,170,118,46,70,95],[175,69,143,80,85,82,72,155,103],[56,58,10,171,218,189,17,13,152],[114,26,17,163,44,195,21,10,173],[121,24,80,195,26,62,44,64,85],[144,71,10,38,171,213,144,34,26],[170,46,55,19,136,160,33,206,71],[63,20,8,114,114,208,12,9,226],[81,40,11,96,182,84,29,16,36]],[[134,183,89,137,98,101,106,165,148],[72,187,100,130,157,111,32,75,80],[66,102,167,99,74,62,40,234,128],[41,53,9,178,241,141,26,8,107],[74,43,26,146,73,166,49,23,157],[65,38,105,160,51,52,31,115,128],[104,79,12,27,217,255,87,17,7],[87,68,71,44,114,51,15,186,23],[47,41,14,110,182,183,21,17,194],[66,45,25,102,197,189,23,18,22]],[[88,88,147,150,42,46,45,196,205],[43,97,183,117,85,38,35,179,61],[39,53,200,87,26,21,43,232,171],[56,34,51,104,114,102,29,93,77],[39,28,85,171,58,165,90,98,64],[34,22,116,206,23,34,43,166,73],[107,54,32,26,51,1,81,43,31],[68,25,106,22,64,171,36,225,114],[34,19,21,102,132,188,16,76,124],[62,18,78,95,85,57,50,48,51]],[[193,101,35,159,215,111,89,46,111],[60,148,31,172,219,228,21,18,111],[112,113,77,85,179,255,38,120,114],[40,42,1,196,245,209,10,25,109],[88,43,29,140,166,213,37,43,154],[61,63,30,155,67,45,68,1,209],[100,80,8,43,154,1,51,26,71],[142,78,78,16,255,128,34,197,171],[41,40,5,102,211,183,4,1,221],[51,50,17,168,209,192,23,25,82]],[[138,31,36,171,27,166,38,44,229],[67,87,58,169,82,115,26,59,179],[63,59,90,180,59,166,93,73,154],[40,40,21,116,143,209,34,39,175],[47,15,16,183,34,223,49,45,183],[46,17,33,183,6,98,15,32,183],[57,46,22,24,128,1,54,17,37],[65,32,73,115,28,128,23,128,205],[40,3,9,115,51,192,18,6,223],[87,37,9,115,59,77,64,21,47]],[[104,55,44,218,9,54,53,130,226],[64,90,70,205,40,41,23,26,57],[54,57,112,184,5,41,38,166,213],[30,34,26,133,152,116,10,32,134],[39,19,53,221,26,114,32,73,255],[31,9,65,234,2,15,1,118,73],[75,32,12,51,192,255,160,43,51],[88,31,35,67,102,85,55,186,85],[56,21,23,111,59,205,45,37,192],[55,38,70,124,73,102,1,34,98]],[[125,98,42,88,104,85,117,175,82],[95,84,53,89,128,100,113,101,45],[75,79,123,47,51,128,81,171,1],[57,17,5,71,102,57,53,41,49],[38,33,13,121,57,73,26,1,85],[41,10,67,138,77,110,90,47,114],[115,21,2,10,102,255,166,23,6],[101,29,16,10,85,128,101,196,26],[57,18,10,102,102,213,34,20,43],[117,20,15,36,163,128,68,1,26]],[[102,61,71,37,34,53,31,243,192],[69,60,71,38,73,119,28,222,37],[68,45,128,34,1,47,11,245,171],[62,17,19,70,146,85,55,62,70],[37,43,37,154,100,163,85,160,1],[63,9,92,136,28,64,32,201,85],[75,15,9,9,64,255,184,119,16],[86,6,28,5,64,255,25,248,1],[56,8,17,132,137,255,55,116,128],[58,15,20,82,135,57,26,121,40]],[[164,50,31,137,154,133,25,35,218],[51,103,44,131,131,123,31,6,158],[86,40,64,135,148,224,45,183,128],[22,26,17,131,240,154,14,1,209],[45,16,21,91,64,222,7,1,197],[56,21,39,155,60,138,23,102,213],[83,12,13,54,192,255,68,47,28],[85,26,85,85,128,128,32,146,171],[18,11,7,63,144,171,4,4,246],[35,27,10,146,174,171,12,26,128]],[[190,80,35,99,180,80,126,54,45],[85,126,47,87,176,51,41,20,32],[101,75,128,139,118,146,116,128,85],[56,41,15,176,236,85,37,9,62],[71,30,17,119,118,255,17,18,138],[101,38,60,138,55,70,43,26,142],[146,36,19,30,171,255,97,27,20],[138,45,61,62,219,1,81,188,64],[32,41,20,117,151,142,20,21,163],[112,19,12,61,195,128,48,4,24]]],Si=[[[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[176,246,255,255,255,255,255,255,255,255,255],[223,241,252,255,255,255,255,255,255,255,255],[249,253,253,255,255,255,255,255,255,255,255]],[[255,244,252,255,255,255,255,255,255,255,255],[234,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255]],[[255,246,254,255,255,255,255,255,255,255,255],[239,253,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[251,255,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[251,254,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,254,253,255,254,255,255,255,255,255,255],[250,255,254,255,254,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[217,255,255,255,255,255,255,255,255,255,255],[225,252,241,253,255,255,254,255,255,255,255],[234,250,241,250,253,255,253,254,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[223,254,254,255,255,255,255,255,255,255,255],[238,253,254,254,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[249,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,255,255,255,255,255,255,255,255,255],[247,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[252,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[186,251,250,255,255,255,255,255,255,255,255],[234,251,244,254,255,255,255,255,255,255,255],[251,251,243,253,254,255,254,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[236,253,254,255,255,255,255,255,255,255,255],[251,253,253,254,254,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[254,254,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[254,254,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[248,255,255,255,255,255,255,255,255,255,255],[250,254,252,254,255,255,255,255,255,255,255],[248,254,249,253,255,255,255,255,255,255,255]],[[255,253,253,255,255,255,255,255,255,255,255],[246,253,253,255,255,255,255,255,255,255,255],[252,254,251,254,254,255,255,255,255,255,255]],[[255,254,252,255,255,255,255,255,255,255,255],[248,254,253,255,255,255,255,255,255,255,255],[253,255,254,254,255,255,255,255,255,255,255]],[[255,251,254,255,255,255,255,255,255,255,255],[245,251,254,255,255,255,255,255,255,255,255],[253,253,254,255,255,255,255,255,255,255,255]],[[255,251,253,255,255,255,255,255,255,255,255],[252,253,254,255,255,255,255,255,255,255,255],[255,254,255,255,255,255,255,255,255,255,255]],[[255,252,255,255,255,255,255,255,255,255,255],[249,255,254,255,255,255,255,255,255,255,255],[255,255,254,255,255,255,255,255,255,255,255]],[[255,255,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]]],gp=[0,1,2,3,6,4,5,6,6,6,6,6,6,6,6,7,0],Eo=[],ki=[],ra=[],Ed=1,hh=2,So=[],Ts=[];ce("UpsampleRgbLinePair",wn,3),ce("UpsampleBgrLinePair",br,3),ce("UpsampleRgbaLinePair",Qs,4),ce("UpsampleBgraLinePair",oi,4),ce("UpsampleArgbLinePair",Xr,4),ce("UpsampleRgba4444LinePair",Kr,2),ce("UpsampleRgb565LinePair",hi,2);var Sd=dt.UpsampleRgbLinePair,Td=dt.UpsampleBgrLinePair,Ea=dt.UpsampleRgbaLinePair,dA=dt.UpsampleBgraLinePair,mu=dt.UpsampleArgbLinePair,fA=dt.UpsampleRgba4444LinePair,pA=dt.UpsampleRgb565LinePair,Tl=16,Ja=1<<Tl-1,na=-227,yu=482,gA=6,Il=(256<<gA)-1,dh=0,Id=s(256),fh=s(256),mp=s(256),C=s(256),l=s(yu-na),d=s(yu-na);ba("YuvToRgbRow",wn,3),ba("YuvToBgrRow",br,3),ba("YuvToRgbaRow",Qs,4),ba("YuvToBgraRow",oi,4),ba("YuvToArgbRow",Xr,4),ba("YuvToRgba4444Row",Kr,2),ba("YuvToRgb565Row",hi,2);var y=[0,4,8,12,128,132,136,140,256,260,264,268,384,388,392,396],v=[0,2,8],E=[8,7,6,4,4,2,2,2,1,1,1,1],U=1;this.WebPDecodeRGBA=function(g,w,T,L,D){var H=xl,z=new lu,j=new $r;z.ba=j,j.S=H,j.width=[j.width],j.height=[j.height];var V=j.width,W=j.height,lt=new Ct;if(lt==null||g==null)var rt=2;else t(lt!=null),rt=yl(g,w,T,lt.width,lt.height,lt.Pd,lt.Qd,lt.format,null);if(rt!=0?V=0:(V!=null&&(V[0]=lt.width[0]),W!=null&&(W[0]=lt.height[0]),V=1),V){j.width=j.width[0],j.height=j.height[0],L!=null&&(L[0]=j.width),D!=null&&(D[0]=j.height);t:{if(L=new Ns,(D=new gl).data=g,D.w=w,D.ha=T,D.kd=1,w=[0],t(D!=null),((g=yl(D.data,D.w,D.ha,null,null,null,w,null,D))==0||g==7)&&w[0]&&(g=4),(w=g)==0){if(t(z!=null),L.data=D.data,L.w=D.w+D.offset,L.ha=D.ha-D.offset,L.put=zt,L.ac=kt,L.bc=qt,L.ma=z,D.xa){if((g=mr())==null){z=1;break t}if(function(ht,gt){var Mt=[0],Tt=[0],_t=[0];e:for(;;){if(ht==null)return 0;if(gt==null)return ht.a=2,0;if(ht.l=gt,ht.a=0,Xt(ht.m,gt.data,gt.w,gt.ha),!St(ht.m,Mt,Tt,_t)){ht.a=3;break e}if(ht.xb=hh,gt.width=Mt[0],gt.height=Tt[0],!Wr(Mt[0],Tt[0],1,ht,null))break e;return 1}return t(ht.a!=0),0}(g,L)){if(L=(w=ja(L.width,L.height,z.Oa,z.ba))==0){e:{L=g;r:for(;;){if(L==null){L=0;break e}if(t(L.s.yc!=null),t(L.s.Ya!=null),t(0<L.s.Wb),t((T=L.l)!=null),t((D=T.ma)!=null),L.xb!=0){if(L.ca=D.ba,L.tb=D.tb,t(L.ca!=null),!Sc(D.Oa,T,Bl)){L.a=2;break r}if(!bn(L,T.width)||T.da)break r;if((T.da||Or(L.ca.S))&&oe(),11>L.ca.S||(alert("todo:WebPInitConvertARGBToYUV"),L.ca.f.kb.F!=null&&oe()),L.Pb&&0<L.s.ua&&L.s.vb.X==null&&!ze(L.s.vb,L.s.Wa.Xa)){L.a=1;break r}L.xb=0}if(!Hr(L,L.V,L.Ba,L.c,L.i,T.o,Er))break r;D.Dc=L.Ma,L=1;break e}t(L.a!=0),L=0}L=!L}L&&(w=g.a)}else w=g.a}else{if((g=new Vo)==null){z=1;break t}if(g.Fa=D.na,g.P=D.P,g.qc=D.Sa,Ss(g,L)){if((w=ja(L.width,L.height,z.Oa,z.ba))==0){if(g.Aa=0,T=z.Oa,t((D=g)!=null),T!=null){if(0<(V=0>(V=T.Md)?0:100<V?255:255*V/100)){for(W=lt=0;4>W;++W)12>(rt=D.pb[W]).lc&&(rt.ia=V*E[0>rt.lc?0:rt.lc]>>3),lt|=rt.ia;lt&&(alert("todo:VP8InitRandom"),D.ia=1)}D.Ga=T.Id,100<D.Ga?D.Ga=100:0>D.Ga&&(D.Ga=0)}Mi(g,L)||(w=g.a)}}else w=g.a}w==0&&z.Oa!=null&&z.Oa.fd&&(w=hu(z.ba))}z=w}H=z!=0?null:11>H?j.f.RGBA.eb:j.f.kb.y}else H=null;return H};var R=[3,4,3,4,4,2,2,4,4,4,2,1,1]};function f(dt,Rt){for(var Lt="",st=0;st<4;st++)Lt+=String.fromCharCode(dt[Rt++]);return Lt}function m(dt,Rt){return(dt[Rt+0]<<0|dt[Rt+1]<<8|dt[Rt+2]<<16)>>>0}function _(dt,Rt){return(dt[Rt+0]<<0|dt[Rt+1]<<8|dt[Rt+2]<<16|dt[Rt+3]<<24)>>>0}new A;var x=[0],B=[0],P=[],M=new A,k=r,Q=function(dt,Rt){var Lt={},st=0,ct=!1,wt=0,yt=0;if(Lt.frames=[],!function(vt,Ft,Ot,$t){for(var jt=0;jt<$t;jt++)if(vt[Ft+jt]!=Ot.charCodeAt(jt))return!0;return!1}(dt,Rt,"RIFF",4)){var te,Zt;for(_(dt,Rt+=4),Rt+=8;Rt<dt.length;){var re=f(dt,Rt),Xt=_(dt,Rt+=4);Rt+=4;var ne=Xt+(1&Xt);switch(re){case"VP8 ":case"VP8L":Lt.frames[st]===void 0&&(Lt.frames[st]={}),(it=Lt.frames[st]).src_off=ct?yt:Rt-8,it.src_size=wt+Xt+8,st++,ct&&(ct=!1,wt=0,yt=0);break;case"VP8X":(it=Lt.header={}).feature_flags=dt[Rt];var se=Rt+4;it.canvas_width=1+m(dt,se),se+=3,it.canvas_height=1+m(dt,se),se+=3;break;case"ALPH":ct=!0,wt=ne+8,yt=Rt-8;break;case"ANIM":(it=Lt.header).bgcolor=_(dt,Rt),se=Rt+4,it.loop_count=(te=dt)[(Zt=se)+0]<<0|te[Zt+1]<<8,se+=2;break;case"ANMF":var we,it;(it=Lt.frames[st]={}).offset_x=2*m(dt,Rt),Rt+=3,it.offset_y=2*m(dt,Rt),Rt+=3,it.width=1+m(dt,Rt),Rt+=3,it.height=1+m(dt,Rt),Rt+=3,it.duration=m(dt,Rt),Rt+=3,we=dt[Rt++],it.dispose=1&we,it.blend=we>>1&1}re!="ANMF"&&(Rt+=ne)}return Lt}}(k,0);Q.response=k,Q.rgbaoutput=!0,Q.dataurl=!1;var q=Q.header?Q.header:null,J=Q.frames?Q.frames:null;if(q){q.loop_counter=q.loop_count,x=[q.canvas_height],B=[q.canvas_width];for(var tt=0;tt<J.length&&J[tt].blend!=0;tt++);}var ft=J[0],pt=M.WebPDecodeRGBA(k,ft.src_off,ft.src_size,B,x);ft.rgba=pt,ft.imgwidth=B[0],ft.imgheight=x[0];for(var mt=0;mt<B[0]*x[0]*4;mt++)P[mt]=pt[mt];return this.width=B,this.height=x,this.data=P,this}(function(r){var t=function(){return typeof M2=="function"},e=function(x,B,P,M){var k=4,Q=a;switch(M){case r.image_compression.FAST:k=1,Q=s;break;case r.image_compression.MEDIUM:k=6,Q=o;break;case r.image_compression.SLOW:k=9,Q=A}x=n(x,B,P,Q);var q=M2(x,{level:k});return r.__addimage__.arrayBufferToBinaryString(q)},n=function(x,B,P,M){for(var k,Q,q,J=x.length/B,tt=new Uint8Array(x.length+J),ft=m(),pt=0;pt<J;pt+=1){if(q=pt*B,k=x.subarray(q,q+B),M)tt.set(M(k,P,Q),q+pt);else{for(var mt,dt=ft.length,Rt=[];mt<dt;mt+=1)Rt[mt]=ft[mt](k,P,Q);var Lt=_(Rt.concat());tt.set(Rt[Lt],q+pt)}Q=k}return tt},i=function(x){var B=Array.apply([],x);return B.unshift(0),B},s=function(x,B){var P,M=[],k=x.length;M[0]=1;for(var Q=0;Q<k;Q+=1)P=x[Q-B]||0,M[Q+1]=x[Q]-P+256&255;return M},a=function(x,B,P){var M,k=[],Q=x.length;k[0]=2;for(var q=0;q<Q;q+=1)M=P&&P[q]||0,k[q+1]=x[q]-M+256&255;return k},o=function(x,B,P){var M,k,Q=[],q=x.length;Q[0]=3;for(var J=0;J<q;J+=1)M=x[J-B]||0,k=P&&P[J]||0,Q[J+1]=x[J]+256-(M+k>>>1)&255;return Q},A=function(x,B,P){var M,k,Q,q,J=[],tt=x.length;J[0]=4;for(var ft=0;ft<tt;ft+=1)M=x[ft-B]||0,k=P&&P[ft]||0,Q=P&&P[ft-B]||0,q=f(M,k,Q),J[ft+1]=x[ft]-q+256&255;return J},f=function(x,B,P){if(x===B&&B===P)return x;var M=Math.abs(B-P),k=Math.abs(x-P),Q=Math.abs(x+B-P-P);return M<=k&&M<=Q?x:k<=Q?B:P},m=function(){return[i,s,a,o,A]},_=function(x){var B=x.map(function(P){return P.reduce(function(M,k){return M+Math.abs(k)},0)});return B.indexOf(Math.min.apply(null,B))};r.processPNG=function(x,B,P,M){var k,Q,q,J,tt,ft,pt,mt,dt,Rt,Lt,st,ct,wt,yt,te=this.decode.FLATE_DECODE,Zt="";if(this.__addimage__.isArrayBuffer(x)&&(x=new Uint8Array(x)),this.__addimage__.isArrayBufferView(x)){if(x=(q=new Xrt(x)).imgData,Q=q.bits,k=q.colorSpace,tt=q.colors,[4,6].indexOf(q.colorType)!==-1){if(q.bits===8){dt=(mt=q.pixelBitlength==32?new Uint32Array(q.decodePixels().buffer):q.pixelBitlength==16?new Uint16Array(q.decodePixels().buffer):new Uint8Array(q.decodePixels().buffer)).length,Lt=new Uint8Array(dt*q.colors),Rt=new Uint8Array(dt);var re,Xt=q.pixelBitlength-q.bits;for(wt=0,yt=0;wt<dt;wt++){for(ct=mt[wt],re=0;re<Xt;)Lt[yt++]=ct>>>re&255,re+=q.bits;Rt[wt]=ct>>>re&255}}if(q.bits===16){dt=(mt=new Uint32Array(q.decodePixels().buffer)).length,Lt=new Uint8Array(dt*(32/q.pixelBitlength)*q.colors),Rt=new Uint8Array(dt*(32/q.pixelBitlength)),st=q.colors>1,wt=0,yt=0;for(var ne=0;wt<dt;)ct=mt[wt++],Lt[yt++]=ct>>>0&255,st&&(Lt[yt++]=ct>>>16&255,ct=mt[wt++],Lt[yt++]=ct>>>0&255),Rt[ne++]=ct>>>16&255;Q=8}M!==r.image_compression.NONE&&t()?(x=e(Lt,q.width*q.colors,q.colors,M),pt=e(Rt,q.width,1,M)):(x=Lt,pt=Rt,te=void 0)}if(q.colorType===3&&(k=this.color_spaces.INDEXED,ft=q.palette,q.transparency.indexed)){var se=q.transparency.indexed,we=0;for(wt=0,dt=se.length;wt<dt;++wt)we+=se[wt];if((we/=255)===dt-1&&se.indexOf(0)!==-1)J=[se.indexOf(0)];else if(we!==dt){for(mt=q.decodePixels(),Rt=new Uint8Array(mt.length),wt=0,dt=mt.length;wt<dt;wt++)Rt[wt]=se[mt[wt]];pt=e(Rt,q.width,1)}}var it=function(vt){var Ft;switch(vt){case r.image_compression.FAST:Ft=11;break;case r.image_compression.MEDIUM:Ft=13;break;case r.image_compression.SLOW:Ft=14;break;default:Ft=12}return Ft}(M);return te===this.decode.FLATE_DECODE&&(Zt="/Predictor "+it+" "),Zt+="/Colors "+tt+" /BitsPerComponent "+Q+" /Columns "+q.width,(this.__addimage__.isArrayBuffer(x)||this.__addimage__.isArrayBufferView(x))&&(x=this.__addimage__.arrayBufferToBinaryString(x)),(pt&&this.__addimage__.isArrayBuffer(pt)||this.__addimage__.isArrayBufferView(pt))&&(pt=this.__addimage__.arrayBufferToBinaryString(pt)),{alias:P,data:x,index:B,filter:te,decodeParameters:Zt,transparency:J,palette:ft,sMask:pt,predictor:it,width:q.width,height:q.height,bitsPerComponent:Q,colorSpace:k}}}})(qr.API),function(r){r.processGIF89A=function(t,e,n,i){var s=new Jrt(t),a=s.width,o=s.height,A=[];s.decodeAndBlitFrameRGBA(0,A);var f={data:A,width:a,height:o},m=new j2(100).encode(f,100);return r.processJPEG.call(this,m,e,n,i)},r.processGIF87A=r.processGIF89A}(qr.API),Jc.prototype.parseHeader=function(){if(this.fileSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.datav.getUint32(this.pos,!0),this.pos+=4,this.offset=this.datav.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.width=this.datav.getUint32(this.pos,!0),this.pos+=4,this.height=this.datav.getInt32(this.pos,!0),this.pos+=4,this.planes=this.datav.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.datav.getUint16(this.pos,!0),this.pos+=2,this.compress=this.datav.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.hr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.vr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.colors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.bitPP===16&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){var r=this.colors===0?1<<this.bitPP:this.colors;this.palette=new Array(r);for(var t=0;t<r;t++){var e=this.datav.getUint8(this.pos++,!0),n=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0);this.palette[t]={red:i,green:n,blue:e,quad:s}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)},Jc.prototype.parseBGR=function(){this.pos=this.offset;try{var r="bit"+this.bitPP,t=this.width*this.height*4;this.data=new Uint8Array(t),this[r]()}catch(e){ui.log("bit decode error:"+e)}},Jc.prototype.bit1=function(){var r,t=Math.ceil(this.width/8),e=t%4;for(r=this.height-1;r>=0;r--){for(var n=this.bottom_up?r:this.height-1-r,i=0;i<t;i++)for(var s=this.datav.getUint8(this.pos++,!0),a=n*this.width*4+8*i*4,o=0;o<8&&8*i+o<this.width;o++){var A=this.palette[s>>7-o&1];this.data[a+4*o]=A.blue,this.data[a+4*o+1]=A.green,this.data[a+4*o+2]=A.red,this.data[a+4*o+3]=255}e!==0&&(this.pos+=4-e)}},Jc.prototype.bit4=function(){for(var r=Math.ceil(this.width/2),t=r%4,e=this.height-1;e>=0;e--){for(var n=this.bottom_up?e:this.height-1-e,i=0;i<r;i++){var s=this.datav.getUint8(this.pos++,!0),a=n*this.width*4+2*i*4,o=s>>4,A=15&s,f=this.palette[o];if(this.data[a]=f.blue,this.data[a+1]=f.green,this.data[a+2]=f.red,this.data[a+3]=255,2*i+1>=this.width)break;f=this.palette[A],this.data[a+4]=f.blue,this.data[a+4+1]=f.green,this.data[a+4+2]=f.red,this.data[a+4+3]=255}t!==0&&(this.pos+=4-t)}},Jc.prototype.bit8=function(){for(var r=this.width%4,t=this.height-1;t>=0;t--){for(var e=this.bottom_up?t:this.height-1-t,n=0;n<this.width;n++){var i=this.datav.getUint8(this.pos++,!0),s=e*this.width*4+4*n;if(i<this.palette.length){var a=this.palette[i];this.data[s]=a.red,this.data[s+1]=a.green,this.data[s+2]=a.blue,this.data[s+3]=255}else this.data[s]=255,this.data[s+1]=255,this.data[s+2]=255,this.data[s+3]=255}r!==0&&(this.pos+=4-r)}},Jc.prototype.bit15=function(){for(var r=this.width%3,t=parseInt("11111",2),e=this.height-1;e>=0;e--){for(var n=this.bottom_up?e:this.height-1-e,i=0;i<this.width;i++){var s=this.datav.getUint16(this.pos,!0);this.pos+=2;var a=(s&t)/t*255|0,o=(s>>5&t)/t*255|0,A=(s>>10&t)/t*255|0,f=s>>15?255:0,m=n*this.width*4+4*i;this.data[m]=A,this.data[m+1]=o,this.data[m+2]=a,this.data[m+3]=f}this.pos+=r}},Jc.prototype.bit16=function(){for(var r=this.width%3,t=parseInt("11111",2),e=parseInt("111111",2),n=this.height-1;n>=0;n--){for(var i=this.bottom_up?n:this.height-1-n,s=0;s<this.width;s++){var a=this.datav.getUint16(this.pos,!0);this.pos+=2;var o=(a&t)/t*255|0,A=(a>>5&e)/e*255|0,f=(a>>11)/t*255|0,m=i*this.width*4+4*s;this.data[m]=f,this.data[m+1]=A,this.data[m+2]=o,this.data[m+3]=255}this.pos+=r}},Jc.prototype.bit24=function(){for(var r=this.height-1;r>=0;r--){for(var t=this.bottom_up?r:this.height-1-r,e=0;e<this.width;e++){var n=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0),a=t*this.width*4+4*e;this.data[a]=s,this.data[a+1]=i,this.data[a+2]=n,this.data[a+3]=255}this.pos+=this.width%4}},Jc.prototype.bit32=function(){for(var r=this.height-1;r>=0;r--)for(var t=this.bottom_up?r:this.height-1-r,e=0;e<this.width;e++){var n=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0),o=t*this.width*4+4*e;this.data[o]=s,this.data[o+1]=i,this.data[o+2]=n,this.data[o+3]=a}},Jc.prototype.getData=function(){return this.data},function(r){r.processBMP=function(t,e,n,i){var s=new Jc(t,!1),a=s.width,o=s.height,A={data:s.getData(),width:a,height:o},f=new j2(100).encode(A,100);return r.processJPEG.call(this,f,e,n,i)}}(qr.API),U4.prototype.getData=function(){return this.data},function(r){r.processWEBP=function(t,e,n,i){var s=new U4(t),a=s.width,o=s.height,A={data:s.getData(),width:a,height:o},f=new j2(100).encode(A,100);return r.processJPEG.call(this,f,e,n,i)}}(qr.API),qr.API.processRGBA=function(r,t,e){for(var n=r.data,i=n.length,s=new Uint8Array(i/4*3),a=new Uint8Array(i/4),o=0,A=0,f=0;f<i;f+=4){var m=n[f],_=n[f+1],x=n[f+2],B=n[f+3];s[o++]=m,s[o++]=_,s[o++]=x,a[A++]=B}var P=this.__addimage__.arrayBufferToBinaryString(s);return{alpha:this.__addimage__.arrayBufferToBinaryString(a),data:P,index:t,alias:e,colorSpace:"DeviceRGB",bitsPerComponent:8,width:r.width,height:r.height}},qr.API.setLanguage=function(r){return this.internal.languageSettings===void 0&&(this.internal.languageSettings={},this.internal.languageSettings.isSubscribed=!1),{af:"Afrikaans",sq:"Albanian",ar:"Arabic (Standard)","ar-DZ":"Arabic (Algeria)","ar-BH":"Arabic (Bahrain)","ar-EG":"Arabic (Egypt)","ar-IQ":"Arabic (Iraq)","ar-JO":"Arabic (Jordan)","ar-KW":"Arabic (Kuwait)","ar-LB":"Arabic (Lebanon)","ar-LY":"Arabic (Libya)","ar-MA":"Arabic (Morocco)","ar-OM":"Arabic (Oman)","ar-QA":"Arabic (Qatar)","ar-SA":"Arabic (Saudi Arabia)","ar-SY":"Arabic (Syria)","ar-TN":"Arabic (Tunisia)","ar-AE":"Arabic (U.A.E.)","ar-YE":"Arabic (Yemen)",an:"Aragonese",hy:"Armenian",as:"Assamese",ast:"Asturian",az:"Azerbaijani",eu:"Basque",be:"Belarusian",bn:"Bengali",bs:"Bosnian",br:"Breton",bg:"Bulgarian",my:"Burmese",ca:"Catalan",ch:"Chamorro",ce:"Chechen",zh:"Chinese","zh-HK":"Chinese (Hong Kong)","zh-CN":"Chinese (PRC)","zh-SG":"Chinese (Singapore)","zh-TW":"Chinese (Taiwan)",cv:"Chuvash",co:"Corsican",cr:"Cree",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch (Standard)","nl-BE":"Dutch (Belgian)",en:"English","en-AU":"English (Australia)","en-BZ":"English (Belize)","en-CA":"English (Canada)","en-IE":"English (Ireland)","en-JM":"English (Jamaica)","en-NZ":"English (New Zealand)","en-PH":"English (Philippines)","en-ZA":"English (South Africa)","en-TT":"English (Trinidad & Tobago)","en-GB":"English (United Kingdom)","en-US":"English (United States)","en-ZW":"English (Zimbabwe)",eo:"Esperanto",et:"Estonian",fo:"Faeroese",fj:"Fijian",fi:"Finnish",fr:"French (Standard)","fr-BE":"French (Belgium)","fr-CA":"French (Canada)","fr-FR":"French (France)","fr-LU":"French (Luxembourg)","fr-MC":"French (Monaco)","fr-CH":"French (Switzerland)",fy:"Frisian",fur:"Friulian",gd:"Gaelic (Scots)","gd-IE":"Gaelic (Irish)",gl:"Galacian",ka:"Georgian",de:"German (Standard)","de-AT":"German (Austria)","de-DE":"German (Germany)","de-LI":"German (Liechtenstein)","de-LU":"German (Luxembourg)","de-CH":"German (Switzerland)",el:"Greek",gu:"Gujurati",ht:"Haitian",he:"Hebrew",hi:"Hindi",hu:"Hungarian",is:"Icelandic",id:"Indonesian",iu:"Inuktitut",ga:"Irish",it:"Italian (Standard)","it-CH":"Italian (Switzerland)",ja:"Japanese",kn:"Kannada",ks:"Kashmiri",kk:"Kazakh",km:"Khmer",ky:"Kirghiz",tlh:"Klingon",ko:"Korean","ko-KP":"Korean (North Korea)","ko-KR":"Korean (South Korea)",la:"Latin",lv:"Latvian",lt:"Lithuanian",lb:"Luxembourgish",mk:"North Macedonia",ms:"Malay",ml:"Malayalam",mt:"Maltese",mi:"Maori",mr:"Marathi",mo:"Moldavian",nv:"Navajo",ng:"Ndonga",ne:"Nepali",no:"Norwegian",nb:"Norwegian (Bokmal)",nn:"Norwegian (Nynorsk)",oc:"Occitan",or:"Oriya",om:"Oromo",fa:"Persian","fa-IR":"Persian/Iran",pl:"Polish",pt:"Portuguese","pt-BR":"Portuguese (Brazil)",pa:"Punjabi","pa-IN":"Punjabi (India)","pa-PK":"Punjabi (Pakistan)",qu:"Quechua",rm:"Rhaeto-Romanic",ro:"Romanian","ro-MO":"Romanian (Moldavia)",ru:"Russian","ru-MO":"Russian (Moldavia)",sz:"Sami (Lappish)",sg:"Sango",sa:"Sanskrit",sc:"Sardinian",sd:"Sindhi",si:"Singhalese",sr:"Serbian",sk:"Slovak",sl:"Slovenian",so:"Somani",sb:"Sorbian",es:"Spanish","es-AR":"Spanish (Argentina)","es-BO":"Spanish (Bolivia)","es-CL":"Spanish (Chile)","es-CO":"Spanish (Colombia)","es-CR":"Spanish (Costa Rica)","es-DO":"Spanish (Dominican Republic)","es-EC":"Spanish (Ecuador)","es-SV":"Spanish (El Salvador)","es-GT":"Spanish (Guatemala)","es-HN":"Spanish (Honduras)","es-MX":"Spanish (Mexico)","es-NI":"Spanish (Nicaragua)","es-PA":"Spanish (Panama)","es-PY":"Spanish (Paraguay)","es-PE":"Spanish (Peru)","es-PR":"Spanish (Puerto Rico)","es-ES":"Spanish (Spain)","es-UY":"Spanish (Uruguay)","es-VE":"Spanish (Venezuela)",sx:"Sutu",sw:"Swahili",sv:"Swedish","sv-FI":"Swedish (Finland)","sv-SV":"Swedish (Sweden)",ta:"Tamil",tt:"Tatar",te:"Teluga",th:"Thai",tig:"Tigre",ts:"Tsonga",tn:"Tswana",tr:"Turkish",tk:"Turkmen",uk:"Ukrainian",hsb:"Upper Sorbian",ur:"Urdu",ve:"Venda",vi:"Vietnamese",vo:"Volapuk",wa:"Walloon",cy:"Welsh",xh:"Xhosa",ji:"Yiddish",zu:"Zulu"}[r]!==void 0&&(this.internal.languageSettings.languageCode=r,this.internal.languageSettings.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){this.internal.write("/Lang ("+this.internal.languageSettings.languageCode+")")}),this.internal.languageSettings.isSubscribed=!0)),this},Pf=qr.API,Uy=Pf.getCharWidthsArray=function(r,t){var e,n,i=(t=t||{}).font||this.internal.getFont(),s=t.fontSize||this.internal.getFontSize(),a=t.charSpace||this.internal.getCharSpace(),o=t.widths?t.widths:i.metadata.Unicode.widths,A=o.fof?o.fof:1,f=t.kerning?t.kerning:i.metadata.Unicode.kerning,m=f.fof?f.fof:1,_=t.doKerning!==!1,x=0,B=r.length,P=0,M=o[0]||A,k=[];for(e=0;e<B;e++)n=r.charCodeAt(e),typeof i.metadata.widthOfString=="function"?k.push((i.metadata.widthOfGlyph(i.metadata.characterToGlyph(n))+a*(1e3/s)||0)/1e3):(x=_&&kn(f[n])==="object"&&!isNaN(parseInt(f[n][P],10))?f[n][P]/m:0,k.push((o[n]||M)/A+x)),P=n;return k},L4=Pf.getStringUnitWidth=function(r,t){var e=(t=t||{}).fontSize||this.internal.getFontSize(),n=t.font||this.internal.getFont(),i=t.charSpace||this.internal.getCharSpace();return Pf.processArabic&&(r=Pf.processArabic(r)),typeof n.metadata.widthOfString=="function"?n.metadata.widthOfString(r,e,i)/e:Uy.apply(this,arguments).reduce(function(s,a){return s+a},0)},F4=function(r,t,e,n){for(var i=[],s=0,a=r.length,o=0;s!==a&&o+t[s]<e;)o+=t[s],s++;i.push(r.slice(0,s));var A=s;for(o=0;s!==a;)o+t[s]>n&&(i.push(r.slice(A,s)),o=0,A=s),o+=t[s],s++;return A!==s&&i.push(r.slice(A,s)),i},P4=function(r,t,e){e||(e={});var n,i,s,a,o,A,f,m=[],_=[m],x=e.textIndent||0,B=0,P=0,M=r.split(" "),k=Uy.apply(this,[" ",e])[0];if(A=e.lineIndent===-1?M[0].length+2:e.lineIndent||0){var Q=Array(A).join(" "),q=[];M.map(function(tt){(tt=tt.split(/\s*\n/)).length>1?q=q.concat(tt.map(function(ft,pt){return(pt&&ft.length?`
`:"")+ft})):q.push(tt[0])}),M=q,A=L4.apply(this,[Q,e])}for(s=0,a=M.length;s<a;s++){var J=0;if(n=M[s],A&&n[0]==`
`&&(n=n.substr(1),J=1),x+B+(P=(i=Uy.apply(this,[n,e])).reduce(function(tt,ft){return tt+ft},0))>t||J){if(P>t){for(o=F4.apply(this,[n,i,t-(x+B),t]),m.push(o.shift()),m=[o.pop()];o.length;)_.push([o.shift()]);P=i.slice(n.length-(m[0]?m[0].length:0)).reduce(function(tt,ft){return tt+ft},0)}else m=[n];_.push(m),x=P+A,B=k}else m.push(n),x+=B+P,B=k}return f=A?function(tt,ft){return(ft?Q:"")+tt.join(" ")}:function(tt){return tt.join(" ")},_.map(f)},Pf.splitTextToSize=function(r,t,e){var n,i=(e=e||{}).fontSize||this.internal.getFontSize(),s=(function(m){if(m.widths&&m.kerning)return{widths:m.widths,kerning:m.kerning};var _=this.internal.getFont(m.fontName,m.fontStyle);return _.metadata.Unicode?{widths:_.metadata.Unicode.widths||{0:1},kerning:_.metadata.Unicode.kerning||{}}:{font:_.metadata,fontSize:this.internal.getFontSize(),charSpace:this.internal.getCharSpace()}}).call(this,e);n=Array.isArray(r)?r:String(r).split(/\r?\n/);var a=1*this.internal.scaleFactor*t/i;s.textIndent=e.textIndent?1*e.textIndent*this.internal.scaleFactor/i:0,s.lineIndent=e.lineIndent;var o,A,f=[];for(o=0,A=n.length;o<A;o++)f=f.concat(P4.apply(this,[n[o],a,s]));return f},function(r){r.__fontmetrics__=r.__fontmetrics__||{};for(var t="klmnopqrstuvwxyz",e={},n={},i=0;i<t.length;i++)e[t[i]]="0123456789abcdef"[i],n["0123456789abcdef"[i]]=t[i];var s=function(_){return"0x"+parseInt(_,10).toString(16)},a=r.__fontmetrics__.compress=function(_){var x,B,P,M,k=["{"];for(var Q in _){if(x=_[Q],isNaN(parseInt(Q,10))?B="'"+Q+"'":(Q=parseInt(Q,10),B=(B=s(Q).slice(2)).slice(0,-1)+n[B.slice(-1)]),typeof x=="number")x<0?(P=s(x).slice(3),M="-"):(P=s(x).slice(2),M=""),P=M+P.slice(0,-1)+n[P.slice(-1)];else{if(kn(x)!=="object")throw new Error("Don't know what to do with value type "+kn(x)+".");P=a(x)}k.push(B+P)}return k.push("}"),k.join("")},o=r.__fontmetrics__.uncompress=function(_){if(typeof _!="string")throw new Error("Invalid argument passed to uncompress.");for(var x,B,P,M,k={},Q=1,q=k,J=[],tt="",ft="",pt=_.length-1,mt=1;mt<pt;mt+=1)(M=_[mt])=="'"?x?(P=x.join(""),x=void 0):x=[]:x?x.push(M):M=="{"?(J.push([q,P]),q={},P=void 0):M=="}"?((B=J.pop())[0][B[1]]=q,P=void 0,q=B[0]):M=="-"?Q=-1:P===void 0?e.hasOwnProperty(M)?(tt+=e[M],P=parseInt(tt,16)*Q,Q=1,tt=""):tt+=M:e.hasOwnProperty(M)?(ft+=e[M],q[P]=parseInt(ft,16)*Q,Q=1,P=void 0,ft=""):ft+=M;return k},A={codePages:["WinAnsiEncoding"],WinAnsiEncoding:o("{19m8n201n9q201o9r201s9l201t9m201u8m201w9n201x9o201y8o202k8q202l8r202m9p202q8p20aw8k203k8t203t8v203u9v2cq8s212m9t15m8w15n9w2dw9s16k8u16l9u17s9z17x8y17y9y}")},f={Unicode:{Courier:A,"Courier-Bold":A,"Courier-BoldOblique":A,"Courier-Oblique":A,Helvetica:A,"Helvetica-Bold":A,"Helvetica-BoldOblique":A,"Helvetica-Oblique":A,"Times-Roman":A,"Times-Bold":A,"Times-BoldItalic":A,"Times-Italic":A}},m={Unicode:{"Courier-Oblique":o("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-BoldItalic":o("{'widths'{k3o2q4ycx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2r202m2n2n3m2o3m2p5n202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5n4l4m4m4m4n4m4o4s4p4m4q4m4r4s4s4y4t2r4u3m4v4m4w3x4x5t4y4s4z4s5k3x5l4s5m4m5n3r5o3x5p4s5q4m5r5t5s4m5t3x5u3x5v2l5w1w5x2l5y3t5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q2l6r3m6s3r6t1w6u1w6v3m6w1w6x4y6y3r6z3m7k3m7l3m7m2r7n2r7o1w7p3r7q2w7r4m7s3m7t2w7u2r7v2n7w1q7x2n7y3t202l3mcl4mal2ram3man3mao3map3mar3mas2lat4uau1uav3maw3way4uaz2lbk2sbl3t'fof'6obo2lbp3tbq3mbr1tbs2lbu1ybv3mbz3mck4m202k3mcm4mcn4mco4mcp4mcq5ycr4mcs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz2w203k6o212m6o2dw2l2cq2l3t3m3u2l17s3x19m3m}'kerning'{cl{4qu5kt5qt5rs17ss5ts}201s{201ss}201t{cks4lscmscnscoscpscls2wu2yu201ts}201x{2wu2yu}2k{201ts}2w{4qx5kx5ou5qx5rs17su5tu}2x{17su5tu5ou}2y{4qx5kx5ou5qx5rs17ss5ts}'fof'-6ofn{17sw5tw5ou5qw5rs}7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qs}3v{17su5tu5os5qs}7p{17su5tu}ck{4qu5kt5qt5rs17ss5ts}4l{4qu5kt5qt5rs17ss5ts}cm{4qu5kt5qt5rs17ss5ts}cn{4qu5kt5qt5rs17ss5ts}co{4qu5kt5qt5rs17ss5ts}cp{4qu5kt5qt5rs17ss5ts}6l{4qu5ou5qw5rt17su5tu}5q{ckuclucmucnucoucpu4lu}5r{ckuclucmucnucoucpu4lu}7q{cksclscmscnscoscps4ls}6p{4qu5ou5qw5rt17sw5tw}ek{4qu5ou5qw5rt17su5tu}el{4qu5ou5qw5rt17su5tu}em{4qu5ou5qw5rt17su5tu}en{4qu5ou5qw5rt17su5tu}eo{4qu5ou5qw5rt17su5tu}ep{4qu5ou5qw5rt17su5tu}es{17ss5ts5qs4qu}et{4qu5ou5qw5rt17sw5tw}eu{4qu5ou5qw5rt17ss5ts}ev{17ss5ts5qs4qu}6z{17sw5tw5ou5qw5rs}fm{17sw5tw5ou5qw5rs}7n{201ts}fo{17sw5tw5ou5qw5rs}fp{17sw5tw5ou5qw5rs}fq{17sw5tw5ou5qw5rs}7r{cksclscmscnscoscps4ls}fs{17sw5tw5ou5qw5rs}ft{17su5tu}fu{17su5tu}fv{17su5tu}fw{17su5tu}fz{cksclscmscnscoscps4ls}}}"),"Helvetica-Bold":o("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),Courier:o("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-BoldOblique":o("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Bold":o("{'widths'{k3q2q5ncx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2l202m2n2n3m2o3m2p6o202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5x4l4s4m4m4n4s4o4s4p4m4q3x4r4y4s4y4t2r4u3m4v4y4w4m4x5y4y4s4z4y5k3x5l4y5m4s5n3r5o4m5p4s5q4s5r6o5s4s5t4s5u4m5v2l5w1w5x2l5y3u5z3m6k2l6l3m6m3r6n2w6o3r6p2w6q2l6r3m6s3r6t1w6u2l6v3r6w1w6x5n6y3r6z3m7k3r7l3r7m2w7n2r7o2l7p3r7q3m7r4s7s3m7t3m7u2w7v2r7w1q7x2r7y3o202l3mcl4sal2lam3man3mao3map3mar3mas2lat4uau1yav3maw3tay4uaz2lbk2sbl3t'fof'6obo2lbp3rbr1tbs2lbu2lbv3mbz3mck4s202k3mcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3rek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3m3u2l17s4s19m3m}'kerning'{cl{4qt5ks5ot5qy5rw17sv5tv}201t{cks4lscmscnscoscpscls4wv}2k{201ts}2w{4qu5ku7mu5os5qx5ru17su5tu}2x{17su5tu5ou5qs}2y{4qv5kv7mu5ot5qz5ru17su5tu}'fof'-6o7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qu}3v{17su5tu5os5qu}fu{17su5tu5ou5qu}7p{17su5tu5ou5qu}ck{4qt5ks5ot5qy5rw17sv5tv}4l{4qt5ks5ot5qy5rw17sv5tv}cm{4qt5ks5ot5qy5rw17sv5tv}cn{4qt5ks5ot5qy5rw17sv5tv}co{4qt5ks5ot5qy5rw17sv5tv}cp{4qt5ks5ot5qy5rw17sv5tv}6l{17st5tt5ou5qu}17s{ckuclucmucnucoucpu4lu4wu}5o{ckuclucmucnucoucpu4lu4wu}5q{ckzclzcmzcnzcozcpz4lz4wu}5r{ckxclxcmxcnxcoxcpx4lx4wu}5t{ckuclucmucnucoucpu4lu4wu}7q{ckuclucmucnucoucpu4lu}6p{17sw5tw5ou5qu}ek{17st5tt5qu}el{17st5tt5ou5qu}em{17st5tt5qu}en{17st5tt5qu}eo{17st5tt5qu}ep{17st5tt5ou5qu}es{17ss5ts5qu}et{17sw5tw5ou5qu}eu{17sw5tw5ou5qu}ev{17ss5ts5qu}6z{17sw5tw5ou5qu5rs}fm{17sw5tw5ou5qu5rs}fn{17sw5tw5ou5qu5rs}fo{17sw5tw5ou5qu5rs}fp{17sw5tw5ou5qu5rs}fq{17sw5tw5ou5qu5rs}7r{cktcltcmtcntcotcpt4lt5os}fs{17sw5tw5ou5qu5rs}ft{17su5tu5ou5qu}7m{5os}fv{17su5tu5ou5qu}fw{17su5tu5ou5qu}fz{cksclscmscnscoscps4ls}}}"),Symbol:o("{'widths'{k3uaw4r19m3m2k1t2l2l202m2y2n3m2p5n202q6o3k3m2s2l2t2l2v3r2w1t3m3m2y1t2z1wbk2sbl3r'fof'6o3n3m3o3m3p3m3q3m3r3m3s3m3t3m3u1w3v1w3w3r3x3r3y3r3z2wbp3t3l3m5v2l5x2l5z3m2q4yfr3r7v3k7w1o7x3k}'kerning'{'fof'-6o}}"),Helvetica:o("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}"),"Helvetica-BoldOblique":o("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),ZapfDingbats:o("{'widths'{k4u2k1w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-Bold":o("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Italic":o("{'widths'{k3n2q4ycx2l201n3m201o5t201s2l201t2l201u2l201w3r201x3r201y3r2k1t2l2l202m2n2n3m2o3m2p5n202q5t2r1p2s2l2t2l2u3m2v4n2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w4n3x4n3y4n3z3m4k5w4l3x4m3x4n4m4o4s4p3x4q3x4r4s4s4s4t2l4u2w4v4m4w3r4x5n4y4m4z4s5k3x5l4s5m3x5n3m5o3r5p4s5q3x5r5n5s3x5t3r5u3r5v2r5w1w5x2r5y2u5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q1w6r3m6s3m6t1w6u1w6v2w6w1w6x4s6y3m6z3m7k3m7l3m7m2r7n2r7o1w7p3m7q2w7r4m7s2w7t2w7u2r7v2s7w1v7x2s7y3q202l3mcl3xal2ram3man3mao3map3mar3mas2lat4wau1vav3maw4nay4waz2lbk2sbl4n'fof'6obo2lbp3mbq3obr1tbs2lbu1zbv3mbz3mck3x202k3mcm3xcn3xco3xcp3xcq5tcr4mcs3xct3xcu3xcv3xcw2l2m2ucy2lcz2ldl4mdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr4nfs3mft3mfu3mfv3mfw3mfz2w203k6o212m6m2dw2l2cq2l3t3m3u2l17s3r19m3m}'kerning'{cl{5kt4qw}201s{201sw}201t{201tw2wy2yy6q-t}201x{2wy2yy}2k{201tw}2w{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}2x{17ss5ts5os}2y{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}'fof'-6o6t{17ss5ts5qs}7t{5os}3v{5qs}7p{17su5tu5qs}ck{5kt4qw}4l{5kt4qw}cm{5kt4qw}cn{5kt4qw}co{5kt4qw}cp{5kt4qw}6l{4qs5ks5ou5qw5ru17su5tu}17s{2ks}5q{ckvclvcmvcnvcovcpv4lv}5r{ckuclucmucnucoucpu4lu}5t{2ks}6p{4qs5ks5ou5qw5ru17su5tu}ek{4qs5ks5ou5qw5ru17su5tu}el{4qs5ks5ou5qw5ru17su5tu}em{4qs5ks5ou5qw5ru17su5tu}en{4qs5ks5ou5qw5ru17su5tu}eo{4qs5ks5ou5qw5ru17su5tu}ep{4qs5ks5ou5qw5ru17su5tu}es{5ks5qs4qs}et{4qs5ks5ou5qw5ru17su5tu}eu{4qs5ks5qw5ru17su5tu}ev{5ks5qs4qs}ex{17ss5ts5qs}6z{4qv5ks5ou5qw5ru17su5tu}fm{4qv5ks5ou5qw5ru17su5tu}fn{4qv5ks5ou5qw5ru17su5tu}fo{4qv5ks5ou5qw5ru17su5tu}fp{4qv5ks5ou5qw5ru17su5tu}fq{4qv5ks5ou5qw5ru17su5tu}7r{5os}fs{4qv5ks5ou5qw5ru17su5tu}ft{17su5tu5qs}fu{17su5tu5qs}fv{17su5tu5qs}fw{17su5tu5qs}}}"),"Times-Roman":o("{'widths'{k3n2q4ycx2l201n3m201o6o201s2l201t2l201u2l201w2w201x2w201y2w2k1t2l2l202m2n2n3m2o3m2p5n202q6o2r1m2s2l2t2l2u3m2v3s2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v1w3w3s3x3s3y3s3z2w4k5w4l4s4m4m4n4m4o4s4p3x4q3r4r4s4s4s4t2l4u2r4v4s4w3x4x5t4y4s4z4s5k3r5l4s5m4m5n3r5o3x5p4s5q4s5r5y5s4s5t4s5u3x5v2l5w1w5x2l5y2z5z3m6k2l6l2w6m3m6n2w6o3m6p2w6q2l6r3m6s3m6t1w6u1w6v3m6w1w6x4y6y3m6z3m7k3m7l3m7m2l7n2r7o1w7p3m7q3m7r4s7s3m7t3m7u2w7v3k7w1o7x3k7y3q202l3mcl4sal2lam3man3mao3map3mar3mas2lat4wau1vav3maw3say4waz2lbk2sbl3s'fof'6obo2lbp3mbq2xbr1tbs2lbu1zbv3mbz2wck4s202k3mcm4scn4sco4scp4scq5tcr4mcs3xct3xcu3xcv3xcw2l2m2tcy2lcz2ldl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek2wel2wem2wen2weo2wep2weq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr3sfs3mft3mfu3mfv3mfw3mfz3m203k6o212m6m2dw2l2cq2l3t3m3u1w17s4s19m3m}'kerning'{cl{4qs5ku17sw5ou5qy5rw201ss5tw201ws}201s{201ss}201t{ckw4lwcmwcnwcowcpwclw4wu201ts}2k{201ts}2w{4qs5kw5os5qx5ru17sx5tx}2x{17sw5tw5ou5qu}2y{4qs5kw5os5qx5ru17sx5tx}'fof'-6o7t{ckuclucmucnucoucpu4lu5os5rs}3u{17su5tu5qs}3v{17su5tu5qs}7p{17sw5tw5qs}ck{4qs5ku17sw5ou5qy5rw201ss5tw201ws}4l{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cm{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cn{4qs5ku17sw5ou5qy5rw201ss5tw201ws}co{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cp{4qs5ku17sw5ou5qy5rw201ss5tw201ws}6l{17su5tu5os5qw5rs}17s{2ktclvcmvcnvcovcpv4lv4wuckv}5o{ckwclwcmwcnwcowcpw4lw4wu}5q{ckyclycmycnycoycpy4ly4wu5ms}5r{cktcltcmtcntcotcpt4lt4ws}5t{2ktclvcmvcnvcovcpv4lv4wuckv}7q{cksclscmscnscoscps4ls}6p{17su5tu5qw5rs}ek{5qs5rs}el{17su5tu5os5qw5rs}em{17su5tu5os5qs5rs}en{17su5qs5rs}eo{5qs5rs}ep{17su5tu5os5qw5rs}es{5qs}et{17su5tu5qw5rs}eu{17su5tu5qs5rs}ev{5qs}6z{17sv5tv5os5qx5rs}fm{5os5qt5rs}fn{17sv5tv5os5qx5rs}fo{17sv5tv5os5qx5rs}fp{5os5qt5rs}fq{5os5qt5rs}7r{ckuclucmucnucoucpu4lu5os}fs{17sv5tv5os5qx5rs}ft{17ss5ts5qs}fu{17sw5tw5qs}fv{17sw5tw5qs}fw{17ss5ts5qs}fz{ckuclucmucnucoucpu4lu5os5rs}}}"),"Helvetica-Oblique":o("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}")}};r.events.push(["addFont",function(_){var x=_.font,B=m.Unicode[x.postScriptName];B&&(x.metadata.Unicode={},x.metadata.Unicode.widths=B.widths,x.metadata.Unicode.kerning=B.kerning);var P=f.Unicode[x.postScriptName];P&&(x.metadata.Unicode.encoding=P,x.encoding=P.codePages[0])}])}(qr.API),function(r){var t=function(e){for(var n=e.length,i=new Uint8Array(n),s=0;s<n;s++)i[s]=e.charCodeAt(s);return i};r.API.events.push(["addFont",function(e){var n=void 0,i=e.font,s=e.instance;if(!i.isStandardFont){if(s===void 0)throw new Error("Font does not exist in vFS, import fonts or remove declaration doc.addFont('"+i.postScriptName+"').");if(typeof(n=s.existsFileInVFS(i.postScriptName)===!1?s.loadFile(i.postScriptName):s.getFileFromVFS(i.postScriptName))!="string")throw new Error("Font is not stored as string-data in vFS, import fonts or remove declaration doc.addFont('"+i.postScriptName+"').");(function(a,o){o=/^\x00\x01\x00\x00/.test(o)?t(o):t(Ng(o)),a.metadata=r.API.TTFFont.open(o),a.metadata.Unicode=a.metadata.Unicode||{encoding:{},kerning:{},widths:[]},a.metadata.glyIdsUsed=[0]})(i,n)}}])}(qr),function(r){function t(){return(jr.canvg?Promise.resolve(jr.canvg):Promise.resolve().then(()=>Sbt)).catch(function(e){return Promise.reject(new Error("Could not load canvg: "+e))}).then(function(e){return e.default?e.default:e})}qr.API.addSvgAsImage=function(e,n,i,s,a,o,A,f){if(isNaN(n)||isNaN(i))throw ui.error("jsPDF.addSvgAsImage: Invalid coordinates",arguments),new Error("Invalid coordinates passed to jsPDF.addSvgAsImage");if(isNaN(s)||isNaN(a))throw ui.error("jsPDF.addSvgAsImage: Invalid measurements",arguments),new Error("Invalid measurements (width and/or height) passed to jsPDF.addSvgAsImage");var m=document.createElement("canvas");m.width=s,m.height=a;var _=m.getContext("2d");_.fillStyle="#fff",_.fillRect(0,0,m.width,m.height);var x={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0},B=this;return t().then(function(P){return P.fromString(_,e,x)},function(){return Promise.reject(new Error("Could not load canvg."))}).then(function(P){return P.render(x)}).then(function(){B.addImage(m.toDataURL("image/jpeg",1),n,i,s,a,A,f)})}}(),qr.API.putTotalPages=function(r){var t,e=0;parseInt(this.internal.getFont().id.substr(1),10)<15?(t=new RegExp(r,"g"),e=this.internal.getNumberOfPages()):(t=new RegExp(this.pdfEscape16(r,this.internal.getFont()),"g"),e=this.pdfEscape16(this.internal.getNumberOfPages()+"",this.internal.getFont()));for(var n=1;n<=this.internal.getNumberOfPages();n++)for(var i=0;i<this.internal.pages[n].length;i++)this.internal.pages[n][i]=this.internal.pages[n][i].replace(t,e);return this},qr.API.viewerPreferences=function(r,t){var e;r=r||{},t=t||!1;var n,i,s,a={HideToolbar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideMenubar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideWindowUI:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},FitWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},CenterWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},DisplayDocTitle:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.4},NonFullScreenPageMode:{defaultValue:"UseNone",value:"UseNone",type:"name",explicitSet:!1,valueSet:["UseNone","UseOutlines","UseThumbs","UseOC"],pdfVersion:1.3},Direction:{defaultValue:"L2R",value:"L2R",type:"name",explicitSet:!1,valueSet:["L2R","R2L"],pdfVersion:1.3},ViewArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},ViewClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintScaling:{defaultValue:"AppDefault",value:"AppDefault",type:"name",explicitSet:!1,valueSet:["AppDefault","None"],pdfVersion:1.6},Duplex:{defaultValue:"",value:"none",type:"name",explicitSet:!1,valueSet:["Simplex","DuplexFlipShortEdge","DuplexFlipLongEdge","none"],pdfVersion:1.7},PickTrayByPDFSize:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.7},PrintPageRange:{defaultValue:"",value:"",type:"array",explicitSet:!1,valueSet:null,pdfVersion:1.7},NumCopies:{defaultValue:1,value:1,type:"integer",explicitSet:!1,valueSet:null,pdfVersion:1.7}},o=Object.keys(a),A=[],f=0,m=0,_=0;function x(P,M){var k,Q=!1;for(k=0;k<P.length;k+=1)P[k]===M&&(Q=!0);return Q}if(this.internal.viewerpreferences===void 0&&(this.internal.viewerpreferences={},this.internal.viewerpreferences.configuration=JSON.parse(JSON.stringify(a)),this.internal.viewerpreferences.isSubscribed=!1),e=this.internal.viewerpreferences.configuration,r==="reset"||t===!0){var B=o.length;for(_=0;_<B;_+=1)e[o[_]].value=e[o[_]].defaultValue,e[o[_]].explicitSet=!1}if(kn(r)==="object"){for(i in r)if(s=r[i],x(o,i)&&s!==void 0){if(e[i].type==="boolean"&&typeof s=="boolean")e[i].value=s;else if(e[i].type==="name"&&x(e[i].valueSet,s))e[i].value=s;else if(e[i].type==="integer"&&Number.isInteger(s))e[i].value=s;else if(e[i].type==="array"){for(f=0;f<s.length;f+=1)if(n=!0,s[f].length===1&&typeof s[f][0]=="number")A.push(String(s[f]-1));else if(s[f].length>1){for(m=0;m<s[f].length;m+=1)typeof s[f][m]!="number"&&(n=!1);n===!0&&A.push([s[f][0]-1,s[f][1]-1].join(" "))}e[i].value="["+A.join(" ")+"]"}else e[i].value=e[i].defaultValue;e[i].explicitSet=!0}}return this.internal.viewerpreferences.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){var P,M=[];for(P in e)e[P].explicitSet===!0&&(e[P].type==="name"?M.push("/"+P+" /"+e[P].value):M.push("/"+P+" "+e[P].value));M.length!==0&&this.internal.write(`/ViewerPreferences
<<
`+M.join(`
`)+`
>>`)}),this.internal.viewerpreferences.isSubscribed=!0),this.internal.viewerpreferences.configuration=e,this},function(r){var t=function(){var n='<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description rdf:about="" xmlns:jspdf="'+this.internal.__metadata__.namespaceuri+'"><jspdf:metadata>',i=unescape(encodeURIComponent('<x:xmpmeta xmlns:x="adobe:ns:meta/">')),s=unescape(encodeURIComponent(n)),a=unescape(encodeURIComponent(this.internal.__metadata__.metadata)),o=unescape(encodeURIComponent("</jspdf:metadata></rdf:Description></rdf:RDF>")),A=unescape(encodeURIComponent("</x:xmpmeta>")),f=s.length+a.length+o.length+i.length+A.length;this.internal.__metadata__.metadata_object_number=this.internal.newObject(),this.internal.write("<< /Type /Metadata /Subtype /XML /Length "+f+" >>"),this.internal.write("stream"),this.internal.write(i+s+a+o+A),this.internal.write("endstream"),this.internal.write("endobj")},e=function(){this.internal.__metadata__.metadata_object_number&&this.internal.write("/Metadata "+this.internal.__metadata__.metadata_object_number+" 0 R")};r.addMetadata=function(n,i){return this.internal.__metadata__===void 0&&(this.internal.__metadata__={metadata:n,namespaceuri:i||"http://jspdf.default.namespaceuri/"},this.internal.events.subscribe("putCatalog",e),this.internal.events.subscribe("postPutResources",t)),this}}(qr.API),function(r){var t=r.API,e=t.pdfEscape16=function(s,a){for(var o,A=a.metadata.Unicode.widths,f=["","0","00","000","0000"],m=[""],_=0,x=s.length;_<x;++_){if(o=a.metadata.characterToGlyph(s.charCodeAt(_)),a.metadata.glyIdsUsed.push(o),a.metadata.toUnicode[o]=s.charCodeAt(_),A.indexOf(o)==-1&&(A.push(o),A.push([parseInt(a.metadata.widthOfGlyph(o),10)])),o=="0")return m.join("");o=o.toString(16),m.push(f[4-o.length],o)}return m.join("")},n=function(s){var a,o,A,f,m,_,x;for(m=`/CIDInit /ProcSet findresource begin
12 dict begin
begincmap
/CIDSystemInfo <<
  /Registry (Adobe)
  /Ordering (UCS)
  /Supplement 0
>> def
/CMapName /Adobe-Identity-UCS def
/CMapType 2 def
1 begincodespacerange
<0000><ffff>
endcodespacerange`,A=[],_=0,x=(o=Object.keys(s).sort(function(B,P){return B-P})).length;_<x;_++)a=o[_],A.length>=100&&(m+=`
`+A.length+` beginbfchar
`+A.join(`
`)+`
endbfchar`,A=[]),s[a]!==void 0&&s[a]!==null&&typeof s[a].toString=="function"&&(f=("0000"+s[a].toString(16)).slice(-4),a=("0000"+(+a).toString(16)).slice(-4),A.push("<"+a+"><"+f+">"));return A.length&&(m+=`
`+A.length+` beginbfchar
`+A.join(`
`)+`
endbfchar
`),m+=`endcmap
CMapName currentdict /CMap defineresource pop
end
end`};t.events.push(["putFont",function(s){(function(a){var o=a.font,A=a.out,f=a.newObject,m=a.putStream;if(o.metadata instanceof r.API.TTFFont&&o.encoding==="Identity-H"){for(var _=o.metadata.Unicode.widths,x=o.metadata.subset.encode(o.metadata.glyIdsUsed,1),B="",P=0;P<x.length;P++)B+=String.fromCharCode(x[P]);var M=f();m({data:B,addLength1:!0,objectId:M}),A("endobj");var k=f();m({data:n(o.metadata.toUnicode),addLength1:!0,objectId:k}),A("endobj");var Q=f();A("<<"),A("/Type /FontDescriptor"),A("/FontName /"+Cf(o.fontName)),A("/FontFile2 "+M+" 0 R"),A("/FontBBox "+r.API.PDFObject.convert(o.metadata.bbox)),A("/Flags "+o.metadata.flags),A("/StemV "+o.metadata.stemV),A("/ItalicAngle "+o.metadata.italicAngle),A("/Ascent "+o.metadata.ascender),A("/Descent "+o.metadata.decender),A("/CapHeight "+o.metadata.capHeight),A(">>"),A("endobj");var q=f();A("<<"),A("/Type /Font"),A("/BaseFont /"+Cf(o.fontName)),A("/FontDescriptor "+Q+" 0 R"),A("/W "+r.API.PDFObject.convert(_)),A("/CIDToGIDMap /Identity"),A("/DW 1000"),A("/Subtype /CIDFontType2"),A("/CIDSystemInfo"),A("<<"),A("/Supplement 0"),A("/Registry (Adobe)"),A("/Ordering ("+o.encoding+")"),A(">>"),A(">>"),A("endobj"),o.objectNumber=f(),A("<<"),A("/Type /Font"),A("/Subtype /Type0"),A("/ToUnicode "+k+" 0 R"),A("/BaseFont /"+Cf(o.fontName)),A("/Encoding /"+o.encoding),A("/DescendantFonts ["+q+" 0 R]"),A(">>"),A("endobj"),o.isAlreadyPutted=!0}})(s)}]),t.events.push(["putFont",function(s){(function(a){var o=a.font,A=a.out,f=a.newObject,m=a.putStream;if(o.metadata instanceof r.API.TTFFont&&o.encoding==="WinAnsiEncoding"){for(var _=o.metadata.rawData,x="",B=0;B<_.length;B++)x+=String.fromCharCode(_[B]);var P=f();m({data:x,addLength1:!0,objectId:P}),A("endobj");var M=f();m({data:n(o.metadata.toUnicode),addLength1:!0,objectId:M}),A("endobj");var k=f();A("<<"),A("/Descent "+o.metadata.decender),A("/CapHeight "+o.metadata.capHeight),A("/StemV "+o.metadata.stemV),A("/Type /FontDescriptor"),A("/FontFile2 "+P+" 0 R"),A("/Flags 96"),A("/FontBBox "+r.API.PDFObject.convert(o.metadata.bbox)),A("/FontName /"+Cf(o.fontName)),A("/ItalicAngle "+o.metadata.italicAngle),A("/Ascent "+o.metadata.ascender),A(">>"),A("endobj"),o.objectNumber=f();for(var Q=0;Q<o.metadata.hmtx.widths.length;Q++)o.metadata.hmtx.widths[Q]=parseInt(o.metadata.hmtx.widths[Q]*(1e3/o.metadata.head.unitsPerEm));A("<</Subtype/TrueType/Type/Font/ToUnicode "+M+" 0 R/BaseFont/"+Cf(o.fontName)+"/FontDescriptor "+k+" 0 R/Encoding/"+o.encoding+" /FirstChar 29 /LastChar 255 /Widths "+r.API.PDFObject.convert(o.metadata.hmtx.widths)+">>"),A("endobj"),o.isAlreadyPutted=!0}})(s)}]);var i=function(s){var a,o=s.text||"",A=s.x,f=s.y,m=s.options||{},_=s.mutex||{},x=_.pdfEscape,B=_.activeFontKey,P=_.fonts,M=B,k="",Q=0,q="",J=P[M].encoding;if(P[M].encoding!=="Identity-H")return{text:o,x:A,y:f,options:m,mutex:_};for(q=o,M=B,Array.isArray(o)&&(q=o[0]),Q=0;Q<q.length;Q+=1)P[M].metadata.hasOwnProperty("cmap")&&(a=P[M].metadata.cmap.unicode.codeMap[q[Q].charCodeAt(0)]),a||q[Q].charCodeAt(0)<256&&P[M].metadata.hasOwnProperty("Unicode")?k+=q[Q]:k+="";var tt="";return parseInt(M.slice(1))<14||J==="WinAnsiEncoding"?tt=x(k,M).split("").map(function(ft){return ft.charCodeAt(0).toString(16)}).join(""):J==="Identity-H"&&(tt=e(k,P[M])),_.isHex=!0,{text:tt,x:A,y:f,options:m,mutex:_}};t.events.push(["postProcessText",function(s){var a=s.text||"",o=[],A={text:a,x:s.x,y:s.y,options:s.options,mutex:s.mutex};if(Array.isArray(a)){var f=0;for(f=0;f<a.length;f+=1)Array.isArray(a[f])&&a[f].length===3?o.push([i(Object.assign({},A,{text:a[f][0]})).text,a[f][1],a[f][2]]):o.push(i(Object.assign({},A,{text:a[f]})).text);s.text=o}else s.text=i(Object.assign({},A,{text:a})).text}])}(qr),function(r){var t=function(){return this.internal.vFS===void 0&&(this.internal.vFS={}),!0};r.existsFileInVFS=function(e){return t.call(this),this.internal.vFS[e]!==void 0},r.addFileToVFS=function(e,n){return t.call(this),this.internal.vFS[e]=n,this},r.getFileFromVFS=function(e){return t.call(this),this.internal.vFS[e]!==void 0?this.internal.vFS[e]:null}}(qr.API),function(r){r.__bidiEngine__=r.prototype.__bidiEngine__=function(n){var i,s,a,o,A,f,m,_=t,x=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],B=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],P={L:0,R:1,EN:2,AN:3,N:4,B:5,S:6},M={0:0,5:1,6:2,7:3,32:4,251:5,254:6,255:7},k=["(",")","(","<",">","<","[","]","[","{","}","{","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],Q=new RegExp(/^([1-4|9]|1[0-9]|2[0-9]|3[0168]|4[04589]|5[012]|7[78]|159|16[0-9]|17[0-2]|21[569]|22[03489]|250)$/),q=!1,J=0;this.__bidiEngine__={};var tt=function(st){var ct=st.charCodeAt(),wt=ct>>8,yt=M[wt];return yt!==void 0?_[256*yt+(255&ct)]:wt===252||wt===253?"AL":Q.test(wt)?"L":wt===8?"R":"N"},ft=function(st){for(var ct,wt=0;wt<st.length;wt++){if((ct=tt(st.charAt(wt)))==="L")return!1;if(ct==="R")return!0}return!1},pt=function(st,ct,wt,yt){var te,Zt,re,Xt,ne=ct[yt];switch(ne){case"L":case"R":q=!1;break;case"N":case"AN":break;case"EN":q&&(ne="AN");break;case"AL":q=!0,ne="R";break;case"WS":ne="N";break;case"CS":yt<1||yt+1>=ct.length||(te=wt[yt-1])!=="EN"&&te!=="AN"||(Zt=ct[yt+1])!=="EN"&&Zt!=="AN"?ne="N":q&&(Zt="AN"),ne=Zt===te?Zt:"N";break;case"ES":ne=(te=yt>0?wt[yt-1]:"B")==="EN"&&yt+1<ct.length&&ct[yt+1]==="EN"?"EN":"N";break;case"ET":if(yt>0&&wt[yt-1]==="EN"){ne="EN";break}if(q){ne="N";break}for(re=yt+1,Xt=ct.length;re<Xt&&ct[re]==="ET";)re++;ne=re<Xt&&ct[re]==="EN"?"EN":"N";break;case"NSM":if(a&&!o){for(Xt=ct.length,re=yt+1;re<Xt&&ct[re]==="NSM";)re++;if(re<Xt){var se=st[yt],we=se>=1425&&se<=2303||se===64286;if(te=ct[re],we&&(te==="R"||te==="AL")){ne="R";break}}}ne=yt<1||(te=ct[yt-1])==="B"?"N":wt[yt-1];break;case"B":q=!1,i=!0,ne=J;break;case"S":s=!0,ne="N";break;case"LRE":case"RLE":case"LRO":case"RLO":case"PDF":q=!1;break;case"BN":ne="N"}return ne},mt=function(st,ct,wt){var yt=st.split("");return wt&&dt(yt,wt,{hiLevel:J}),yt.reverse(),ct&&ct.reverse(),yt.join("")},dt=function(st,ct,wt){var yt,te,Zt,re,Xt,ne=-1,se=st.length,we=0,it=[],vt=J?B:x,Ft=[];for(q=!1,i=!1,s=!1,te=0;te<se;te++)Ft[te]=tt(st[te]);for(Zt=0;Zt<se;Zt++){if(Xt=we,it[Zt]=pt(st,Ft,it,Zt),yt=240&(we=vt[Xt][P[it[Zt]]]),we&=15,ct[Zt]=re=vt[we][5],yt>0)if(yt===16){for(te=ne;te<Zt;te++)ct[te]=1;ne=-1}else ne=-1;if(vt[we][6])ne===-1&&(ne=Zt);else if(ne>-1){for(te=ne;te<Zt;te++)ct[te]=re;ne=-1}Ft[Zt]==="B"&&(ct[Zt]=0),wt.hiLevel|=re}s&&function(Ot,$t,jt){for(var ae=0;ae<jt;ae++)if(Ot[ae]==="S"){$t[ae]=J;for(var ie=ae-1;ie>=0&&Ot[ie]==="WS";ie--)$t[ie]=J}}(Ft,ct,se)},Rt=function(st,ct,wt,yt,te){if(!(te.hiLevel<st)){if(st===1&&J===1&&!i)return ct.reverse(),void(wt&&wt.reverse());for(var Zt,re,Xt,ne,se=ct.length,we=0;we<se;){if(yt[we]>=st){for(Xt=we+1;Xt<se&&yt[Xt]>=st;)Xt++;for(ne=we,re=Xt-1;ne<re;ne++,re--)Zt=ct[ne],ct[ne]=ct[re],ct[re]=Zt,wt&&(Zt=wt[ne],wt[ne]=wt[re],wt[re]=Zt);we=Xt}we++}}},Lt=function(st,ct,wt){var yt=st.split(""),te={hiLevel:J};return wt||(wt=[]),dt(yt,wt,te),function(Zt,re,Xt){if(Xt.hiLevel!==0&&m)for(var ne,se=0;se<Zt.length;se++)re[se]===1&&(ne=k.indexOf(Zt[se]))>=0&&(Zt[se]=k[ne+1])}(yt,wt,te),Rt(2,yt,ct,wt,te),Rt(1,yt,ct,wt,te),yt.join("")};return this.__bidiEngine__.doBidiReorder=function(st,ct,wt){if(function(te,Zt){if(Zt)for(var re=0;re<te.length;re++)Zt[re]=re;o===void 0&&(o=ft(te)),f===void 0&&(f=ft(te))}(st,ct),a||!A||f)if(a&&A&&o^f)J=o?1:0,st=mt(st,ct,wt);else if(!a&&A&&f)J=o?1:0,st=Lt(st,ct,wt),st=mt(st,ct);else if(!a||o||A||f){if(a&&!A&&o^f)st=mt(st,ct),o?(J=0,st=Lt(st,ct,wt)):(J=1,st=Lt(st,ct,wt),st=mt(st,ct));else if(a&&o&&!A&&f)J=1,st=Lt(st,ct,wt),st=mt(st,ct);else if(!a&&!A&&o^f){var yt=m;o?(J=1,st=Lt(st,ct,wt),J=0,m=!1,st=Lt(st,ct,wt),m=yt):(J=0,st=Lt(st,ct,wt),st=mt(st,ct),J=1,m=!1,st=Lt(st,ct,wt),m=yt,st=mt(st,ct))}}else J=0,st=Lt(st,ct,wt);else J=o?1:0,st=Lt(st,ct,wt);return st},this.__bidiEngine__.setOptions=function(st){st&&(a=st.isInputVisual,A=st.isOutputVisual,o=st.isInputRtl,f=st.isOutputRtl,m=st.isSymmetricSwapping)},this.__bidiEngine__.setOptions(n),this.__bidiEngine__};var t=["BN","BN","BN","BN","BN","BN","BN","BN","BN","S","B","S","WS","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","B","B","B","S","WS","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","BN","BN","BN","BN","BN","BN","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","CS","N","ET","ET","ET","ET","N","N","N","N","L","N","N","BN","N","N","ET","ET","EN","EN","N","L","N","N","N","EN","L","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","N","N","N","N","N","ET","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","NSM","R","NSM","NSM","R","NSM","NSM","R","NSM","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","N","N","N","N","N","R","R","R","R","R","N","N","N","N","N","N","N","N","N","N","N","AN","AN","AN","AN","AN","AN","N","N","AL","ET","ET","AL","CS","AL","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","AN","AN","AN","AN","AN","AN","AN","AN","AN","ET","AN","AN","AL","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","N","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","NSM","NSM","N","NSM","NSM","NSM","NSM","AL","AL","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","R","N","N","N","N","R","N","N","N","N","N","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","BN","BN","BN","L","R","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","B","LRE","RLE","PDF","LRO","RLO","CS","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","BN","BN","BN","BN","BN","N","LRI","RLI","FSI","PDI","BN","BN","BN","BN","BN","BN","EN","L","N","N","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","L","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","N","N","N","N","N","R","NSM","R","R","R","R","R","R","R","R","R","R","ES","R","R","R","R","R","R","R","R","R","R","R","R","R","N","R","R","R","R","R","N","R","N","R","R","N","R","R","N","R","R","R","R","R","R","R","R","R","R","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","CS","N","N","CS","N","N","N","N","N","N","N","N","N","ET","N","N","ES","ES","N","N","N","N","N","ET","ET","N","N","N","N","N","AL","AL","AL","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","BN","N","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","N","N","N","ET","ET","N","N","N","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N"],e=new r.__bidiEngine__({isInputVisual:!0});r.API.events.push(["postProcessText",function(n){var i=n.text,s=(n.x,n.y,n.options||{}),a=(n.mutex,s.lang,[]);if(s.isInputVisual=typeof s.isInputVisual!="boolean"||s.isInputVisual,e.setOptions(s),Object.prototype.toString.call(i)==="[object Array]"){var o=0;for(a=[],o=0;o<i.length;o+=1)Object.prototype.toString.call(i[o])==="[object Array]"?a.push([e.doBidiReorder(i[o][0]),i[o][1],i[o][2]]):a.push([e.doBidiReorder(i[o])]);n.text=a}else n.text=e.doBidiReorder(i);e.setOptions({isInputVisual:!0})}])}(qr),qr.API.TTFFont=function(){function r(t){var e;if(this.rawData=t,e=this.contents=new jA(t),this.contents.pos=4,e.readString(4)==="ttcf")throw new Error("TTCF not supported.");e.pos=0,this.parse(),this.subset=new hnt(this),this.registerTTF()}return r.open=function(t){return new r(t)},r.prototype.parse=function(){return this.directory=new Yrt(this.contents),this.head=new tnt(this),this.name=new snt(this),this.cmap=new O4(this),this.toUnicode={},this.hhea=new ent(this),this.maxp=new ont(this),this.hmtx=new ant(this),this.post=new nnt(this),this.os2=new rnt(this),this.loca=new Ant(this),this.glyf=new cnt(this),this.ascender=this.os2.exists&&this.os2.ascender||this.hhea.ascender,this.decender=this.os2.exists&&this.os2.decender||this.hhea.decender,this.lineGap=this.os2.exists&&this.os2.lineGap||this.hhea.lineGap,this.bbox=[this.head.xMin,this.head.yMin,this.head.xMax,this.head.yMax]},r.prototype.registerTTF=function(){var t,e,n,i,s;if(this.scaleFactor=1e3/this.head.unitsPerEm,this.bbox=(function(){var a,o,A,f;for(f=[],a=0,o=(A=this.bbox).length;a<o;a++)t=A[a],f.push(Math.round(t*this.scaleFactor));return f}).call(this),this.stemV=0,this.post.exists?(n=255&(i=this.post.italic_angle),32768&(e=i>>16)&&(e=-(1+(65535^e))),this.italicAngle=+(e+"."+n)):this.italicAngle=0,this.ascender=Math.round(this.ascender*this.scaleFactor),this.decender=Math.round(this.decender*this.scaleFactor),this.lineGap=Math.round(this.lineGap*this.scaleFactor),this.capHeight=this.os2.exists&&this.os2.capHeight||this.ascender,this.xHeight=this.os2.exists&&this.os2.xHeight||0,this.familyClass=(this.os2.exists&&this.os2.familyClass||0)>>8,this.isSerif=(s=this.familyClass)===1||s===2||s===3||s===4||s===5||s===7,this.isScript=this.familyClass===10,this.flags=0,this.post.isFixedPitch&&(this.flags|=1),this.isSerif&&(this.flags|=2),this.isScript&&(this.flags|=8),this.italicAngle!==0&&(this.flags|=64),this.flags|=32,!this.cmap.unicode)throw new Error("No unicode cmap for font")},r.prototype.characterToGlyph=function(t){var e;return((e=this.cmap.unicode)!=null?e.codeMap[t]:void 0)||0},r.prototype.widthOfGlyph=function(t){var e;return e=1e3/this.head.unitsPerEm,this.hmtx.forGlyph(t).advance*e},r.prototype.widthOfString=function(t,e,n){var i,s,a,o;for(a=0,s=0,o=(t=""+t).length;0<=o?s<o:s>o;s=0<=o?++s:--s)i=t.charCodeAt(s),a+=this.widthOfGlyph(this.characterToGlyph(i))+n*(1e3/e)||0;return a*(e/1e3)},r.prototype.lineHeight=function(t,e){var n;return e==null&&(e=!1),n=e?this.lineGap:0,(this.ascender+n-this.decender)/1e3*t},r}();var Yc,jA=function(){function r(t){this.data=t??[],this.pos=0,this.length=this.data.length}return r.prototype.readByte=function(){return this.data[this.pos++]},r.prototype.writeByte=function(t){return this.data[this.pos++]=t},r.prototype.readUInt32=function(){return 16777216*this.readByte()+(this.readByte()<<16)+(this.readByte()<<8)+this.readByte()},r.prototype.writeUInt32=function(t){return this.writeByte(t>>>24&255),this.writeByte(t>>16&255),this.writeByte(t>>8&255),this.writeByte(255&t)},r.prototype.readInt32=function(){var t;return(t=this.readUInt32())>=2147483648?t-4294967296:t},r.prototype.writeInt32=function(t){return t<0&&(t+=4294967296),this.writeUInt32(t)},r.prototype.readUInt16=function(){return this.readByte()<<8|this.readByte()},r.prototype.writeUInt16=function(t){return this.writeByte(t>>8&255),this.writeByte(255&t)},r.prototype.readInt16=function(){var t;return(t=this.readUInt16())>=32768?t-65536:t},r.prototype.writeInt16=function(t){return t<0&&(t+=65536),this.writeUInt16(t)},r.prototype.readString=function(t){var e,n;for(n=[],e=0;0<=t?e<t:e>t;e=0<=t?++e:--e)n[e]=String.fromCharCode(this.readByte());return n.join("")},r.prototype.writeString=function(t){var e,n,i;for(i=[],e=0,n=t.length;0<=n?e<n:e>n;e=0<=n?++e:--e)i.push(this.writeByte(t.charCodeAt(e)));return i},r.prototype.readShort=function(){return this.readInt16()},r.prototype.writeShort=function(t){return this.writeInt16(t)},r.prototype.readLongLong=function(){var t,e,n,i,s,a,o,A;return t=this.readByte(),e=this.readByte(),n=this.readByte(),i=this.readByte(),s=this.readByte(),a=this.readByte(),o=this.readByte(),A=this.readByte(),128&t?-1*(72057594037927940*(255^t)+281474976710656*(255^e)+1099511627776*(255^n)+4294967296*(255^i)+16777216*(255^s)+65536*(255^a)+256*(255^o)+(255^A)+1):72057594037927940*t+281474976710656*e+1099511627776*n+4294967296*i+16777216*s+65536*a+256*o+A},r.prototype.writeLongLong=function(t){var e,n;return e=Math.floor(t/4294967296),n=4294967295&t,this.writeByte(e>>24&255),this.writeByte(e>>16&255),this.writeByte(e>>8&255),this.writeByte(255&e),this.writeByte(n>>24&255),this.writeByte(n>>16&255),this.writeByte(n>>8&255),this.writeByte(255&n)},r.prototype.readInt=function(){return this.readInt32()},r.prototype.writeInt=function(t){return this.writeInt32(t)},r.prototype.read=function(t){var e,n;for(e=[],n=0;0<=t?n<t:n>t;n=0<=t?++n:--n)e.push(this.readByte());return e},r.prototype.write=function(t){var e,n,i,s;for(s=[],n=0,i=t.length;n<i;n++)e=t[n],s.push(this.writeByte(e));return s},r}(),Yrt=function(){var r;function t(e){var n,i,s;for(this.scalarType=e.readInt(),this.tableCount=e.readShort(),this.searchRange=e.readShort(),this.entrySelector=e.readShort(),this.rangeShift=e.readShort(),this.tables={},i=0,s=this.tableCount;0<=s?i<s:i>s;i=0<=s?++i:--i)n={tag:e.readString(4),checksum:e.readInt(),offset:e.readInt(),length:e.readInt()},this.tables[n.tag]=n}return t.prototype.encode=function(e){var n,i,s,a,o,A,f,m,_,x,B,P,M;for(M in B=Object.keys(e).length,A=Math.log(2),_=16*Math.floor(Math.log(B)/A),a=Math.floor(_/A),m=16*B-_,(i=new jA).writeInt(this.scalarType),i.writeShort(B),i.writeShort(_),i.writeShort(a),i.writeShort(m),s=16*B,f=i.pos+s,o=null,P=[],e)for(x=e[M],i.writeString(M),i.writeInt(r(x)),i.writeInt(f),i.writeInt(x.length),P=P.concat(x),M==="head"&&(o=f),f+=x.length;f%4;)P.push(0),f++;return i.write(P),n=2981146554-r(i.data),i.pos=o+8,i.writeUInt32(n),i.data},r=function(e){var n,i,s,a;for(e=D4.call(e);e.length%4;)e.push(0);for(s=new jA(e),i=0,n=0,a=e.length;n<a;n=n+=4)i+=s.readUInt32();return 4294967295&i},t}(),Zrt={}.hasOwnProperty,Jl=function(r,t){for(var e in t)Zrt.call(t,e)&&(r[e]=t[e]);function n(){this.constructor=r}return n.prototype=t.prototype,r.prototype=new n,r.__super__=t.prototype,r};Yc=function(){function r(t){var e;this.file=t,e=this.file.directory.tables[this.tag],this.exists=!!e,e&&(this.offset=e.offset,this.length=e.length,this.parse(this.file.contents))}return r.prototype.parse=function(){},r.prototype.encode=function(){},r.prototype.raw=function(){return this.exists?(this.file.contents.pos=this.offset,this.file.contents.read(this.length)):null},r}();var tnt=function(r){function t(){return t.__super__.constructor.apply(this,arguments)}return Jl(t,Yc),t.prototype.tag="head",t.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.revision=e.readInt(),this.checkSumAdjustment=e.readInt(),this.magicNumber=e.readInt(),this.flags=e.readShort(),this.unitsPerEm=e.readShort(),this.created=e.readLongLong(),this.modified=e.readLongLong(),this.xMin=e.readShort(),this.yMin=e.readShort(),this.xMax=e.readShort(),this.yMax=e.readShort(),this.macStyle=e.readShort(),this.lowestRecPPEM=e.readShort(),this.fontDirectionHint=e.readShort(),this.indexToLocFormat=e.readShort(),this.glyphDataFormat=e.readShort()},t.prototype.encode=function(e){var n;return(n=new jA).writeInt(this.version),n.writeInt(this.revision),n.writeInt(this.checkSumAdjustment),n.writeInt(this.magicNumber),n.writeShort(this.flags),n.writeShort(this.unitsPerEm),n.writeLongLong(this.created),n.writeLongLong(this.modified),n.writeShort(this.xMin),n.writeShort(this.yMin),n.writeShort(this.xMax),n.writeShort(this.yMax),n.writeShort(this.macStyle),n.writeShort(this.lowestRecPPEM),n.writeShort(this.fontDirectionHint),n.writeShort(e),n.writeShort(this.glyphDataFormat),n.data},t}(),R4=function(){function r(t,e){var n,i,s,a,o,A,f,m,_,x,B,P,M,k,Q,q,J;switch(this.platformID=t.readUInt16(),this.encodingID=t.readShort(),this.offset=e+t.readInt(),_=t.pos,t.pos=this.offset,this.format=t.readUInt16(),this.length=t.readUInt16(),this.language=t.readUInt16(),this.isUnicode=this.platformID===3&&this.encodingID===1&&this.format===4||this.platformID===0&&this.format===4,this.codeMap={},this.format){case 0:for(A=0;A<256;++A)this.codeMap[A]=t.readByte();break;case 4:for(B=t.readUInt16(),x=B/2,t.pos+=6,s=function(){var tt,ft;for(ft=[],A=tt=0;0<=x?tt<x:tt>x;A=0<=x?++tt:--tt)ft.push(t.readUInt16());return ft}(),t.pos+=2,M=function(){var tt,ft;for(ft=[],A=tt=0;0<=x?tt<x:tt>x;A=0<=x?++tt:--tt)ft.push(t.readUInt16());return ft}(),f=function(){var tt,ft;for(ft=[],A=tt=0;0<=x?tt<x:tt>x;A=0<=x?++tt:--tt)ft.push(t.readUInt16());return ft}(),m=function(){var tt,ft;for(ft=[],A=tt=0;0<=x?tt<x:tt>x;A=0<=x?++tt:--tt)ft.push(t.readUInt16());return ft}(),i=(this.length-t.pos+this.offset)/2,o=function(){var tt,ft;for(ft=[],A=tt=0;0<=i?tt<i:tt>i;A=0<=i?++tt:--tt)ft.push(t.readUInt16());return ft}(),A=Q=0,J=s.length;Q<J;A=++Q)for(k=s[A],n=q=P=M[A];P<=k?q<=k:q>=k;n=P<=k?++q:--q)m[A]===0?a=n+f[A]:(a=o[m[A]/2+(n-P)-(x-A)]||0)!==0&&(a+=f[A]),this.codeMap[n]=65535&a}t.pos=_}return r.encode=function(t,e){var n,i,s,a,o,A,f,m,_,x,B,P,M,k,Q,q,J,tt,ft,pt,mt,dt,Rt,Lt,st,ct,wt,yt,te,Zt,re,Xt,ne,se,we,it,vt,Ft,Ot,$t,jt,ae,ie,Be,Ie,Qe;switch(yt=new jA,a=Object.keys(t).sort(function(He,ze){return He-ze}),e){case"macroman":for(M=0,k=function(){var He=[];for(P=0;P<256;++P)He.push(0);return He}(),q={0:0},s={},te=0,ne=a.length;te<ne;te++)q[ie=t[i=a[te]]]==null&&(q[ie]=++M),s[i]={old:t[i],new:q[t[i]]},k[i]=q[t[i]];return yt.writeUInt16(1),yt.writeUInt16(0),yt.writeUInt32(12),yt.writeUInt16(0),yt.writeUInt16(262),yt.writeUInt16(0),yt.write(k),{charMap:s,subtable:yt.data,maxGlyphID:M+1};case"unicode":for(ct=[],_=[],J=0,q={},n={},Q=f=null,Zt=0,se=a.length;Zt<se;Zt++)q[ft=t[i=a[Zt]]]==null&&(q[ft]=++J),n[i]={old:ft,new:q[ft]},o=q[ft]-i,Q!=null&&o===f||(Q&&_.push(Q),ct.push(i),f=o),Q=i;for(Q&&_.push(Q),_.push(65535),ct.push(65535),Lt=2*(Rt=ct.length),dt=2*Math.pow(Math.log(Rt)/Math.LN2,2),x=Math.log(dt/2)/Math.LN2,mt=2*Rt-dt,A=[],pt=[],B=[],P=re=0,we=ct.length;re<we;P=++re){if(st=ct[P],m=_[P],st===65535){A.push(0),pt.push(0);break}if(st-(wt=n[st].new)>=32768)for(A.push(0),pt.push(2*(B.length+Rt-P)),i=Xt=st;st<=m?Xt<=m:Xt>=m;i=st<=m?++Xt:--Xt)B.push(n[i].new);else A.push(wt-st),pt.push(0)}for(yt.writeUInt16(3),yt.writeUInt16(1),yt.writeUInt32(12),yt.writeUInt16(4),yt.writeUInt16(16+8*Rt+2*B.length),yt.writeUInt16(0),yt.writeUInt16(Lt),yt.writeUInt16(dt),yt.writeUInt16(x),yt.writeUInt16(mt),jt=0,it=_.length;jt<it;jt++)i=_[jt],yt.writeUInt16(i);for(yt.writeUInt16(0),ae=0,vt=ct.length;ae<vt;ae++)i=ct[ae],yt.writeUInt16(i);for(Be=0,Ft=A.length;Be<Ft;Be++)o=A[Be],yt.writeUInt16(o);for(Ie=0,Ot=pt.length;Ie<Ot;Ie++)tt=pt[Ie],yt.writeUInt16(tt);for(Qe=0,$t=B.length;Qe<$t;Qe++)M=B[Qe],yt.writeUInt16(M);return{charMap:n,subtable:yt.data,maxGlyphID:J+1}}},r}(),O4=function(r){function t(){return t.__super__.constructor.apply(this,arguments)}return Jl(t,Yc),t.prototype.tag="cmap",t.prototype.parse=function(e){var n,i,s;for(e.pos=this.offset,this.version=e.readUInt16(),s=e.readUInt16(),this.tables=[],this.unicode=null,i=0;0<=s?i<s:i>s;i=0<=s?++i:--i)n=new R4(e,this.offset),this.tables.push(n),n.isUnicode&&this.unicode==null&&(this.unicode=n);return!0},t.encode=function(e,n){var i,s;return n==null&&(n="macroman"),i=R4.encode(e,n),(s=new jA).writeUInt16(0),s.writeUInt16(1),i.table=s.data.concat(i.subtable),i},t}(),ent=function(r){function t(){return t.__super__.constructor.apply(this,arguments)}return Jl(t,Yc),t.prototype.tag="hhea",t.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.ascender=e.readShort(),this.decender=e.readShort(),this.lineGap=e.readShort(),this.advanceWidthMax=e.readShort(),this.minLeftSideBearing=e.readShort(),this.minRightSideBearing=e.readShort(),this.xMaxExtent=e.readShort(),this.caretSlopeRise=e.readShort(),this.caretSlopeRun=e.readShort(),this.caretOffset=e.readShort(),e.pos+=8,this.metricDataFormat=e.readShort(),this.numberOfMetrics=e.readUInt16()},t}(),rnt=function(r){function t(){return t.__super__.constructor.apply(this,arguments)}return Jl(t,Yc),t.prototype.tag="OS/2",t.prototype.parse=function(e){if(e.pos=this.offset,this.version=e.readUInt16(),this.averageCharWidth=e.readShort(),this.weightClass=e.readUInt16(),this.widthClass=e.readUInt16(),this.type=e.readShort(),this.ySubscriptXSize=e.readShort(),this.ySubscriptYSize=e.readShort(),this.ySubscriptXOffset=e.readShort(),this.ySubscriptYOffset=e.readShort(),this.ySuperscriptXSize=e.readShort(),this.ySuperscriptYSize=e.readShort(),this.ySuperscriptXOffset=e.readShort(),this.ySuperscriptYOffset=e.readShort(),this.yStrikeoutSize=e.readShort(),this.yStrikeoutPosition=e.readShort(),this.familyClass=e.readShort(),this.panose=function(){var n,i;for(i=[],n=0;n<10;++n)i.push(e.readByte());return i}(),this.charRange=function(){var n,i;for(i=[],n=0;n<4;++n)i.push(e.readInt());return i}(),this.vendorID=e.readString(4),this.selection=e.readShort(),this.firstCharIndex=e.readShort(),this.lastCharIndex=e.readShort(),this.version>0&&(this.ascent=e.readShort(),this.descent=e.readShort(),this.lineGap=e.readShort(),this.winAscent=e.readShort(),this.winDescent=e.readShort(),this.codePageRange=function(){var n,i;for(i=[],n=0;n<2;n=++n)i.push(e.readInt());return i}(),this.version>1))return this.xHeight=e.readShort(),this.capHeight=e.readShort(),this.defaultChar=e.readShort(),this.breakChar=e.readShort(),this.maxContext=e.readShort()},t}(),nnt=function(r){function t(){return t.__super__.constructor.apply(this,arguments)}return Jl(t,Yc),t.prototype.tag="post",t.prototype.parse=function(e){var n,i,s;switch(e.pos=this.offset,this.format=e.readInt(),this.italicAngle=e.readInt(),this.underlinePosition=e.readShort(),this.underlineThickness=e.readShort(),this.isFixedPitch=e.readInt(),this.minMemType42=e.readInt(),this.maxMemType42=e.readInt(),this.minMemType1=e.readInt(),this.maxMemType1=e.readInt(),this.format){case 65536:break;case 131072:var a;for(i=e.readUInt16(),this.glyphNameIndex=[],a=0;0<=i?a<i:a>i;a=0<=i?++a:--a)this.glyphNameIndex.push(e.readUInt16());for(this.names=[],s=[];e.pos<this.offset+this.length;)n=e.readByte(),s.push(this.names.push(e.readString(n)));return s;case 151552:return i=e.readUInt16(),this.offsets=e.read(i);case 196608:break;case 262144:return this.map=(function(){var o,A,f;for(f=[],a=o=0,A=this.file.maxp.numGlyphs;0<=A?o<A:o>A;a=0<=A?++o:--o)f.push(e.readUInt32());return f}).call(this)}},t}(),int=function(r,t){this.raw=r,this.length=r.length,this.platformID=t.platformID,this.encodingID=t.encodingID,this.languageID=t.languageID},snt=function(r){function t(){return t.__super__.constructor.apply(this,arguments)}return Jl(t,Yc),t.prototype.tag="name",t.prototype.parse=function(e){var n,i,s,a,o,A,f,m,_,x,B;for(e.pos=this.offset,e.readShort(),n=e.readShort(),A=e.readShort(),i=[],a=0;0<=n?a<n:a>n;a=0<=n?++a:--a)i.push({platformID:e.readShort(),encodingID:e.readShort(),languageID:e.readShort(),nameID:e.readShort(),length:e.readShort(),offset:this.offset+A+e.readShort()});for(f={},a=_=0,x=i.length;_<x;a=++_)s=i[a],e.pos=s.offset,m=e.readString(s.length),o=new int(m,s),f[B=s.nameID]==null&&(f[B]=[]),f[s.nameID].push(o);this.strings=f,this.copyright=f[0],this.fontFamily=f[1],this.fontSubfamily=f[2],this.uniqueSubfamily=f[3],this.fontName=f[4],this.version=f[5];try{this.postscriptName=f[6][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}catch{this.postscriptName=f[4][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}return this.trademark=f[7],this.manufacturer=f[8],this.designer=f[9],this.description=f[10],this.vendorUrl=f[11],this.designerUrl=f[12],this.license=f[13],this.licenseUrl=f[14],this.preferredFamily=f[15],this.preferredSubfamily=f[17],this.compatibleFull=f[18],this.sampleText=f[19]},t}(),ont=function(r){function t(){return t.__super__.constructor.apply(this,arguments)}return Jl(t,Yc),t.prototype.tag="maxp",t.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.numGlyphs=e.readUInt16(),this.maxPoints=e.readUInt16(),this.maxContours=e.readUInt16(),this.maxCompositePoints=e.readUInt16(),this.maxComponentContours=e.readUInt16(),this.maxZones=e.readUInt16(),this.maxTwilightPoints=e.readUInt16(),this.maxStorage=e.readUInt16(),this.maxFunctionDefs=e.readUInt16(),this.maxInstructionDefs=e.readUInt16(),this.maxStackElements=e.readUInt16(),this.maxSizeOfInstructions=e.readUInt16(),this.maxComponentElements=e.readUInt16(),this.maxComponentDepth=e.readUInt16()},t}(),ant=function(r){function t(){return t.__super__.constructor.apply(this,arguments)}return Jl(t,Yc),t.prototype.tag="hmtx",t.prototype.parse=function(e){var n,i,s,a,o,A,f;for(e.pos=this.offset,this.metrics=[],n=0,A=this.file.hhea.numberOfMetrics;0<=A?n<A:n>A;n=0<=A?++n:--n)this.metrics.push({advance:e.readUInt16(),lsb:e.readInt16()});for(s=this.file.maxp.numGlyphs-this.file.hhea.numberOfMetrics,this.leftSideBearings=function(){var m,_;for(_=[],n=m=0;0<=s?m<s:m>s;n=0<=s?++m:--m)_.push(e.readInt16());return _}(),this.widths=(function(){var m,_,x,B;for(B=[],m=0,_=(x=this.metrics).length;m<_;m++)a=x[m],B.push(a.advance);return B}).call(this),i=this.widths[this.widths.length-1],f=[],n=o=0;0<=s?o<s:o>s;n=0<=s?++o:--o)f.push(this.widths.push(i));return f},t.prototype.forGlyph=function(e){return e in this.metrics?this.metrics[e]:{advance:this.metrics[this.metrics.length-1].advance,lsb:this.leftSideBearings[e-this.metrics.length]}},t}(),D4=[].slice,cnt=function(r){function t(){return t.__super__.constructor.apply(this,arguments)}return Jl(t,Yc),t.prototype.tag="glyf",t.prototype.parse=function(){return this.cache={}},t.prototype.glyphFor=function(e){var n,i,s,a,o,A,f,m,_,x;return e in this.cache?this.cache[e]:(a=this.file.loca,n=this.file.contents,i=a.indexOf(e),(s=a.lengthOf(e))===0?this.cache[e]=null:(n.pos=this.offset+i,o=(A=new jA(n.read(s))).readShort(),m=A.readShort(),x=A.readShort(),f=A.readShort(),_=A.readShort(),this.cache[e]=o===-1?new unt(A,m,x,f,_):new lnt(A,o,m,x,f,_),this.cache[e]))},t.prototype.encode=function(e,n,i){var s,a,o,A,f;for(o=[],a=[],A=0,f=n.length;A<f;A++)s=e[n[A]],a.push(o.length),s&&(o=o.concat(s.encode(i)));return a.push(o.length),{table:o,offsets:a}},t}(),lnt=function(){function r(t,e,n,i,s,a){this.raw=t,this.numberOfContours=e,this.xMin=n,this.yMin=i,this.xMax=s,this.yMax=a,this.compound=!1}return r.prototype.encode=function(){return this.raw.data},r}(),unt=function(){function r(t,e,n,i,s){var a,o;for(this.raw=t,this.xMin=e,this.yMin=n,this.xMax=i,this.yMax=s,this.compound=!0,this.glyphIDs=[],this.glyphOffsets=[],a=this.raw;o=a.readShort(),this.glyphOffsets.push(a.pos),this.glyphIDs.push(a.readUInt16()),32&o;)a.pos+=1&o?4:2,128&o?a.pos+=8:64&o?a.pos+=4:8&o&&(a.pos+=2)}return r.prototype.encode=function(){var t,e,n;for(e=new jA(D4.call(this.raw.data)),t=0,n=this.glyphIDs.length;t<n;++t)e.pos=this.glyphOffsets[t];return e.data},r}(),Ant=function(r){function t(){return t.__super__.constructor.apply(this,arguments)}return Jl(t,Yc),t.prototype.tag="loca",t.prototype.parse=function(e){var n,i;return e.pos=this.offset,n=this.file.head.indexToLocFormat,this.offsets=n===0?(function(){var s,a;for(a=[],i=0,s=this.length;i<s;i+=2)a.push(2*e.readUInt16());return a}).call(this):(function(){var s,a;for(a=[],i=0,s=this.length;i<s;i+=4)a.push(e.readUInt32());return a}).call(this)},t.prototype.indexOf=function(e){return this.offsets[e]},t.prototype.lengthOf=function(e){return this.offsets[e+1]-this.offsets[e]},t.prototype.encode=function(e,n){for(var i=new Uint32Array(this.offsets.length),s=0,a=0,o=0;o<i.length;++o)if(i[o]=s,a<n.length&&n[a]==o){++a,i[o]=s;var A=this.offsets[o],f=this.offsets[o+1]-A;f>0&&(s+=f)}for(var m=new Array(4*i.length),_=0;_<i.length;++_)m[4*_+3]=255&i[_],m[4*_+2]=(65280&i[_])>>8,m[4*_+1]=(16711680&i[_])>>16,m[4*_]=(4278190080&i[_])>>24;return m},t}(),hnt=function(){function r(t){this.font=t,this.subset={},this.unicodes={},this.next=33}return r.prototype.generateCmap=function(){var t,e,n,i,s;for(e in i=this.font.cmap.tables[0].codeMap,t={},s=this.subset)n=s[e],t[e]=i[n];return t},r.prototype.glyphsFor=function(t){var e,n,i,s,a,o,A;for(i={},a=0,o=t.length;a<o;a++)i[s=t[a]]=this.font.glyf.glyphFor(s);for(s in e=[],i)(n=i[s])!=null&&n.compound&&e.push.apply(e,n.glyphIDs);if(e.length>0)for(s in A=this.glyphsFor(e))n=A[s],i[s]=n;return i},r.prototype.encode=function(t,e){var n,i,s,a,o,A,f,m,_,x,B,P,M,k,Q;for(i in n=O4.encode(this.generateCmap(),"unicode"),a=this.glyphsFor(t),B={0:0},Q=n.charMap)B[(A=Q[i]).old]=A.new;for(P in x=n.maxGlyphID,a)P in B||(B[P]=x++);return m=function(q){var J,tt;for(J in tt={},q)tt[q[J]]=J;return tt}(B),_=Object.keys(m).sort(function(q,J){return q-J}),M=function(){var q,J,tt;for(tt=[],q=0,J=_.length;q<J;q++)o=_[q],tt.push(m[o]);return tt}(),s=this.font.glyf.encode(a,M,B),f=this.font.loca.encode(s.offsets,M),k={cmap:this.font.cmap.raw(),glyf:s.table,loca:f,hmtx:this.font.hmtx.raw(),hhea:this.font.hhea.raw(),maxp:this.font.maxp.raw(),post:this.font.post.raw(),name:this.font.name.raw(),head:this.font.head.encode(e)},this.font.os2.exists&&(k["OS/2"]=this.font.os2.raw()),this.font.directory.encode(k)},r}();qr.API.PDFObject=function(){var r;function t(){}return r=function(e,n){return(Array(n+1).join("0")+e).slice(-n)},t.convert=function(e){var n,i,s,a;if(Array.isArray(e))return"["+function(){var o,A,f;for(f=[],o=0,A=e.length;o<A;o++)n=e[o],f.push(t.convert(n));return f}().join(" ")+"]";if(typeof e=="string")return"/"+e;if(e!=null&&e.isString)return"("+e+")";if(e instanceof Date)return"(D:"+r(e.getUTCFullYear(),4)+r(e.getUTCMonth(),2)+r(e.getUTCDate(),2)+r(e.getUTCHours(),2)+r(e.getUTCMinutes(),2)+r(e.getUTCSeconds(),2)+"Z)";if({}.toString.call(e)==="[object Object]"){for(i in s=["<<"],e)a=e[i],s.push("/"+i+" "+t.convert(a));return s.push(">>"),s.join(`
`)}return""+e},t}();const q2={"circle-radius":8,"circle-color":"red","circle-stroke-width":1,"circle-stroke-color":"black"};let dnt=class{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:$h.A4,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:300,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:ku.PNG,s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:xf.mm,a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"map",o=arguments.length>6&&arguments[6]!==void 0?arguments[6]:"maplibregl-marker",A=arguments.length>7&&arguments[7]!==void 0?arguments[7]:q2;qn(this,"map"),qn(this,"width"),qn(this,"height"),qn(this,"dpi"),qn(this,"format"),qn(this,"unit"),qn(this,"fileName"),qn(this,"markerClassName"),qn(this,"markerCirclePaint"),this.map=t,this.width=e[0],this.height=e[1],this.dpi=n,this.format=i,this.unit=s,this.fileName=a,this.markerClassName=o,this.markerCirclePaint=A}renderMapPost(t){return t}getMarkers(){return this.map.getCanvasContainer().getElementsByClassName(this.markerClassName)}renderMarkers(t){const e=this.getMarkers();for(let n=0;n<e.length;n++){const i=e.item(n);if(!i)continue;const s=i.getAttribute("style");if(!s)continue;const a=/translate\(([^,]+)px,\s*([^,]+)px\)/,o=s.match(a);if(!o)continue;const A=parseInt(o[1]),f=parseInt(o[2]),m=this.map.unproject([A,f]),_=`point${n}`;t.addSource(_,{type:"geojson",data:{type:"Point",coordinates:[m.lng,m.lat]}}),t.addLayer({id:_,source:_,type:"circle",paint:this.markerCirclePaint})}return t}generate(){const t=this;JsLoadingOverlay.show({overlayBackgroundColor:"#5D5959",overlayOpacity:"0.6",spinnerIcon:"ball-spin",spinnerColor:"#2400FD",spinnerSize:"2x",overlayIDName:"overlay",spinnerIDName:"spinner",offsetX:0,offsetY:0,containerID:null,lockScroll:!1,overlayZIndex:9998,spinnerZIndex:9999});const e=window.devicePixelRatio;Object.defineProperty(window,"devicePixelRatio",{get(){return t.dpi/96}});const n=document.createElement("div");n.className="hidden-map",document.body.appendChild(n);const i=document.createElement("div");i.style.width=this.toPixels(this.width),i.style.height=this.toPixels(this.height),n.appendChild(i);const s=this.map.getStyle();if(s&&s.sources){const o=s.sources;Object.keys(o).forEach(A=>{const f=o[A];Object.keys(f).forEach(m=>{f[m]||delete f[m]})})}let a=this.getRenderedMap(i,s);a.once("idle",()=>{a=this.renderMapPost(a),this.getMarkers().length===0?this.exportImage(a,n,e):(a=this.renderMarkers(a),a.once("idle",()=>{this.exportImage(a,n,e)}))})}exportImage(t,e,n){var i;const s=t.getCanvas(),a=`${this.fileName}.${this.format}`;switch(this.format){case ku.PNG:this.toPNG(s,a);break;case ku.JPEG:this.toJPEG(s,a);break;case ku.PDF:this.toPDF(t,a);break;case ku.SVG:this.toSVG(s,a);break;default:console.error(`Invalid file format: ${this.format}`);break}t.remove(),(i=e.parentNode)==null||i.removeChild(e),Object.defineProperty(window,"devicePixelRatio",{get(){return n}}),e.remove(),JsLoadingOverlay.hide()}toPNG(t,e){const n=document.createElement("a");n.href=t.toDataURL(),n.download=e,n.click(),n.remove()}toJPEG(t,e){const n=t.toDataURL("image/jpeg",.85),i=document.createElement("a");i.href=n,i.download=e,i.click(),i.remove()}toPDF(t,e){const n=t.getCanvas(),i=new qr({orientation:this.width>this.height?"l":"p",unit:this.unit,compress:!0,format:[this.width,this.height]});i.addImage(n.toDataURL("image/png"),"png",0,0,this.width,this.height,void 0,"FAST");const{lng:s,lat:a}=t.getCenter();i.setProperties({title:t.getStyle().name,subject:`center: [${s}, ${a}], zoom: ${t.getZoom()}`,creator:"Mapbox GL Export Plugin",author:"(c)Mapbox, (c)OpenStreetMap"}),i.save(e)}toSVG(t,e){const n=t.toDataURL("image/png"),i=Number(this.toPixels(this.width,this.dpi).replace("px","")),s=Number(this.toPixels(this.height,this.dpi).replace("px","")),a=`
    <svg xmlns="http://www.w3.org/2000/svg" 
      xmlns:xlink="http://www.w3.org/1999/xlink" 
      version="1.1" 
      width="${i}" 
      height="${s}" 
      viewBox="0 0 ${i} ${s}" 
      xml:space="preserve">
        <image style="stroke: none; stroke-width: 0; stroke-dasharray: none; stroke-linecap: butt; stroke-dashoffset: 0; stroke-linejoin: miter; stroke-miterlimit: 4; fill: rgb(0,0,0); fill-rule: nonzero; opacity: 1;"  
      xlink:href="${n}" width="${i}" height="${s}"></image>
    </svg>`,o=document.createElement("a");o.href=`data:application/xml,${encodeURIComponent(a)}`,o.download=e,o.click(),o.remove()}toPixels(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:96;return this.unit===xf.mm&&(e/=25.4),`${e*t}px`}},fnt=class extends dnt{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:$h.A4,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:300,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:ku.PNG,s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:xf.mm,a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"map",o=arguments.length>6&&arguments[6]!==void 0?arguments[6]:q2;super(t,e,n,i,s,a,"maplibregl-marker",o)}getRenderedMap(t,e){const n=new ES.Map({container:t,style:e,center:this.map.getCenter(),zoom:this.map.getZoom(),bearing:this.map.getBearing(),pitch:this.map.getPitch(),interactive:!1,preserveDrawingBuffer:!0,fadeDuration:0,attributionControl:!1,transformRequest:this.map._requestManager._transformRequestFn});this.map.getTerrain()&&(n.setMaxPitch(85),n.setPitch(this.map.getPitch()));const i=(this.map.style.imageManager||{}).images||[];return Object.keys(i).forEach(s=>{n.addImage(s,i[s].data)}),n}renderMapPost(t){const e=this.map.getTerrain();return e&&t.setTerrain({source:e.source,exaggeration:e.exaggeration}),t}},pnt=class{constructor(t){qn(this,"controlContainer"),qn(this,"exportContainer"),qn(this,"crosshair"),qn(this,"printableArea"),qn(this,"map"),qn(this,"exportButton"),qn(this,"options",{PageSize:$h.A4,PageOrientation:Mg.Landscape,Format:ku.PDF,DPI:B2[300],Crosshair:!1,PrintableArea:!1,Local:"en",AllowedSizes:Object.keys($h),Filename:"map",markerCirclePaint:q2}),qn(this,"MAPLIB_CSS_PREFIX","maplibregl"),t&&(this.options=Object.assign(this.options,t)),this.onDocumentClick=this.onDocumentClick.bind(this)}getDefaultPosition(){return"top-right"}getTranslation(){const t=this.options.Local??"en";return prt(t)}onAdd(t){var e;this.map=t,this.controlContainer=document.createElement("div"),this.controlContainer.classList.add(`${this.MAPLIB_CSS_PREFIX}-ctrl`),this.controlContainer.classList.add(`${this.MAPLIB_CSS_PREFIX}-ctrl-group`),this.exportContainer=document.createElement("div"),this.exportContainer.classList.add(`${this.MAPLIB_CSS_PREFIX}-export-list`),this.exportButton=document.createElement("button"),this.exportButton.classList.add(`${this.MAPLIB_CSS_PREFIX}-ctrl-icon`),this.exportButton.classList.add(`${this.MAPLIB_CSS_PREFIX}-export-control`),this.exportButton.type="button",this.exportButton.addEventListener("click",()=>{this.exportButton.style.display="none",this.exportContainer.style.display="block",this.toggleCrosshair(!0),this.togglePrintableArea(!0)}),document.addEventListener("click",this.onDocumentClick),this.controlContainer.appendChild(this.exportButton),this.controlContainer.appendChild(this.exportContainer);const n=document.createElement("TABLE");n.className="print-table";const i={};(e=this.options.AllowedSizes)==null||e.forEach(m=>{$h[m]&&(i[m]=$h[m])});const s=this.createSelection(i,this.getTranslation().PageSize,"page-size",this.options.PageSize,(m,_)=>JSON.stringify(m[_]));n.appendChild(s);const a=this.createSelection(Mg,this.getTranslation().PageOrientation,"page-orientation",this.options.PageOrientation,(m,_)=>m[_]);n.appendChild(a);const o=this.createSelection(ku,this.getTranslation().Format,"format-type",this.options.Format,(m,_)=>m[_]);n.appendChild(o);const A=this.createSelection(B2,this.getTranslation().DPI,"dpi-type",this.options.DPI,(m,_)=>m[_]);n.appendChild(A),this.exportContainer.appendChild(n);const f=document.createElement("button");return f.type="button",f.textContent=this.getTranslation().Generate,f.classList.add("generate-button"),f.addEventListener("click",()=>{const m=document.getElementById("mapbox-gl-export-page-size"),_=document.getElementById("mapbox-gl-export-page-orientation"),x=document.getElementById("mapbox-gl-export-format-type"),B=document.getElementById("mapbox-gl-export-dpi-type"),P=_.value;let M=JSON.parse(m.value);P===Mg.Portrait&&(M=M.reverse()),this.generateMap(t,M,Number(B.value),x.value,xf.mm,this.options.Filename)}),this.exportContainer.appendChild(f),this.controlContainer}generateMap(t,e,n,i,s,a){new fnt(t,e,n,i,s,a,this.options.markerCirclePaint).generate()}createSelection(t,e,n,i,s){const a=document.createElement("label");a.textContent=e;const o=document.createElement("select");o.setAttribute("id",`mapbox-gl-export-${n}`),o.style.width="100%",Object.keys(t).forEach(_=>{const x=document.createElement("option");x.setAttribute("value",s(t,_)),x.appendChild(document.createTextNode(_)),x.setAttribute("name",n),i===t[_]&&(x.selected=!0),o.appendChild(x)}),o.addEventListener("change",()=>{this.updatePrintableArea()});const A=document.createElement("TR"),f=document.createElement("TD"),m=document.createElement("TD");return f.appendChild(a),m.appendChild(o),A.appendChild(f),A.appendChild(m),A}onRemove(){!this.controlContainer||!this.controlContainer.parentNode||!this.map||!this.exportButton||(this.exportButton.removeEventListener("click",this.onDocumentClick),this.controlContainer.parentNode.removeChild(this.controlContainer),document.removeEventListener("click",this.onDocumentClick),this.crosshair!==void 0&&(this.crosshair.destroy(),this.crosshair=void 0),this.printableArea!==void 0&&(this.printableArea.destroy(),this.printableArea=void 0),this.map=void 0)}onDocumentClick(t){this.controlContainer&&!this.controlContainer.contains(t.target)&&this.exportContainer&&this.exportButton&&(this.exportContainer.style.display="none",this.exportButton.style.display="block",this.toggleCrosshair(!1),this.togglePrintableArea(!1))}toggleCrosshair(t){this.options.Crosshair===!0&&(t===!1?this.crosshair!==void 0&&(this.crosshair.destroy(),this.crosshair=void 0):(this.crosshair=new nrt(this.map),this.crosshair.create()))}togglePrintableArea(t){this.options.PrintableArea===!0&&(t===!1?this.printableArea!==void 0&&(this.printableArea.destroy(),this.printableArea=void 0):(this.printableArea=new irt(this.map),this.updatePrintableArea()))}updatePrintableArea(){if(this.printableArea===void 0)return;const t=document.getElementById("mapbox-gl-export-page-size"),e=document.getElementById("mapbox-gl-export-page-orientation").value;let n=JSON.parse(t.value);e===Mg.Portrait&&(n=n.reverse()),this.printableArea.updateArea(n[0],n[1])}};var N4=mnt,gnt=Object.prototype.hasOwnProperty;function mnt(){for(var r={},t=0;t<arguments.length;t++){var e=arguments[t];for(var n in e)gnt.call(e,n)&&(r[n]=e[n])}return r}var k4={exports:{}};(function(r,t){(function(){var e={};r.exports=e,e.simpleFilter=function(n,i){return i.filter(function(s){return e.test(n,s)})},e.test=function(n,i){return e.match(n,i)!==null},e.match=function(n,i,s){s=s||{};var a=0,o=[],A=i.length,f=0,m=0,_=s.pre||"",x=s.post||"",B=s.caseSensitive&&i||i.toLowerCase(),P;n=s.caseSensitive&&n||n.toLowerCase();for(var M=0;M<A;M++)P=i[M],B[M]===n[a]?(P=_+P+x,a+=1,m+=1+m):m=0,f+=m,o[o.length]=P;return a===n.length?(f=B===n?1/0:f,{rendered:o.join(""),score:f}):null},e.filter=function(n,i,s){return!i||i.length===0?[]:typeof n!="string"?i:(s=s||{},i.reduce(function(a,o,A,f){var m=o;s.extract&&(m=s.extract(o));var _=e.match(n,m,s);return _!=null&&(a[a.length]={string:_.rendered,score:_.score,index:A,original:o}),a},[]).sort(function(a,o){var A=o.score-a.score;return A||a.index-o.index}))}})()})(k4);var ynt=k4.exports,fa=function(r){return this.component=r,this.items=[],this.active=r.options.noInitialSelection?-1:0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,r.el.parentNode.insertBefore(this.wrapper,r.el.nextSibling),this};fa.prototype.show=function(){this.element.style.display="block"},fa.prototype.hide=function(){this.element.style.display="none"},fa.prototype.add=function(r){this.items.push(r)},fa.prototype.clear=function(){this.items=[],this.active=this.component.options.noInitialSelection?-1:0},fa.prototype.isEmpty=function(){return!this.items.length},fa.prototype.isVisible=function(){return this.element.style.display==="block"},fa.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var r=0;r<this.items.length;r++)this.drawItem(this.items[r],this.active===r);this.show()},fa.prototype.drawItem=function(r,t){var e=document.createElement("li"),n=document.createElement("a");t&&(e.className+=" active"),n.innerHTML=r.string,e.appendChild(n),this.element.appendChild(e),e.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),e.addEventListener("mouseup",(function(){this.handleMouseUp.call(this,r)}).bind(this))},fa.prototype.handleMouseUp=function(r){this.selectingListItem=!1,this.component.value(r.original),this.clear(),this.draw()},fa.prototype.move=function(r){this.active=r,this.draw()},fa.prototype.previous=function(){this.move(this.active<=0?this.items.length-1:this.active-1)},fa.prototype.next=function(){this.move(this.active>=this.items.length-1?0:this.active+1)},fa.prototype.drawError=function(r){var t=document.createElement("li");t.innerHTML=r,this.element.appendChild(t),this.show()};var _nt=fa,vnt=N4,bnt=ynt,wnt=_nt,yo=function(r,t,e){return e=e||{},this.options=vnt({minLength:2,limit:5,filter:!0,hideOnBlur:!0,noInitialSelection:!0},e),this.el=r,this.data=t||[],this.list=new wnt(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",(function(n){this.handleKeyUp(n.keyCode,n)}).bind(this),!1),this.el.addEventListener("keydown",(function(n){this.handleKeyDown(n)}).bind(this)),this.el.addEventListener("focus",(function(){this.handleFocus()}).bind(this)),this.el.addEventListener("blur",(function(){this.handleBlur()}).bind(this)),this.el.addEventListener("paste",(function(n){this.handlePaste(n)}).bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};yo.prototype.handleKeyUp=function(r,t){if(!(r===40||r===38||r===27||r===9)){if(r===13){this.list.items[this.list.active]&&(this.list.handleMouseUp(this.list.items[this.list.active]),t.stopPropagation());return}this.handleInputChange(this.el.value)}},yo.prototype.handleKeyDown=function(r){switch(r.keyCode){case 13:this.list.active>=0&&(this.list.selectingListItem=!0);break;case 9:this.list.isEmpty()||(this.list.isVisible()&&r.preventDefault(),this.value(this.list.active>=0?this.list.items[this.list.active].original:null),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}},yo.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()},yo.prototype.handlePaste=function(r){if(r.clipboardData)this.handleInputChange(r.clipboardData.getData("Text"));else{var t=this;setTimeout(function(){t.handleInputChange(r.target.value)},100)}},yo.prototype.handleInputChange=function(r){if(this.query=this.normalize(r),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates((function(t){for(var e=0;e<t.length&&(this.list.add(t[e]),e!==this.options.limit-1);e++);this.list.draw()}).bind(this))},yo.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1},yo.prototype.update=function(r){this.data=r,this.handleKeyUp()},yo.prototype.clear=function(){this.data=[],this.list.clear()},yo.prototype.normalize=function(r){return r=r.toLowerCase(),r},yo.prototype.match=function(r,t){return r.indexOf(t)>-1},yo.prototype.value=function(r){if(this.selected=r,this.el.value=this.getItemValue(r||{place_name:this.query}),document.createEvent){var t=document.createEvent("HTMLEvents");t.initEvent("change",!0,!1),this.el.dispatchEvent(t)}else this.el.fireEvent("onchange")},yo.prototype.getCandidates=function(r){var t={pre:"<strong>",post:"</strong>",extract:(function(n){return this.getItemValue(n)}).bind(this)},e;this.options.filter?(e=bnt.filter(this.query,this.data,t),e=e.map((function(n){return{original:n.original,string:this.render(n.original,n.string)}}).bind(this))):e=this.data.map((function(n){var i=this.render(n);return{original:n,string:i}}).bind(this)),r(e)},yo.prototype.getItemValue=function(r){return r},yo.prototype.render=function(r,t){if(t)return t;for(var e=r.original?this.getItemValue(r.original):this.getItemValue(r),n=this.normalize(e),i=n.lastIndexOf(this.query);i>-1;){var s=i+this.query.length;e=e.slice(0,i)+"<strong>"+e.slice(i,s)+"</strong>"+e.slice(s),i=n.slice(0,i).lastIndexOf(this.query)}return e},yo.prototype.renderError=function(r){this.list.drawError(r)};var xnt=yo,Q4=xnt,Bnt=Q4;typeof window<"u"&&(window.Suggestions=Q4);var Cnt="Expected a function",H4=NaN,Ent="[object Symbol]",Snt=/^\s+|\s+$/g,Tnt=/^[-+]0x[0-9a-f]+$/i,Int=/^0b[01]+$/i,Lnt=/^0o[0-7]+$/i,Fnt=parseInt,Pnt=typeof kd=="object"&&kd&&kd.Object===Object&&kd,Mnt=typeof self=="object"&&self&&self.Object===Object&&self,Unt=Pnt||Mnt||Function("return this")(),Rnt=Object.prototype,Ont=Rnt.toString,Dnt=Math.max,Nnt=Math.min,K2=function(){return Unt.Date.now()};function knt(r,t,e){var n,i,s,a,o,A,f=0,m=!1,_=!1,x=!0;if(typeof r!="function")throw new TypeError(Cnt);t=z4(t)||0,$2(e)&&(m=!!e.leading,_="maxWait"in e,s=_?Dnt(z4(e.maxWait)||0,t):s,x="trailing"in e?!!e.trailing:x);function B(pt){var mt=n,dt=i;return n=i=void 0,f=pt,a=r.apply(dt,mt),a}function P(pt){return f=pt,o=setTimeout(Q,t),m?B(pt):a}function M(pt){var mt=pt-A,dt=pt-f,Rt=t-mt;return _?Nnt(Rt,s-dt):Rt}function k(pt){var mt=pt-A,dt=pt-f;return A===void 0||mt>=t||mt<0||_&&dt>=s}function Q(){var pt=K2();if(k(pt))return q(pt);o=setTimeout(Q,M(pt))}function q(pt){return o=void 0,x&&n?B(pt):(n=i=void 0,a)}function J(){o!==void 0&&clearTimeout(o),f=0,n=A=i=o=void 0}function tt(){return o===void 0?a:q(K2())}function ft(){var pt=K2(),mt=k(pt);if(n=arguments,i=this,A=pt,mt){if(o===void 0)return P(A);if(_)return o=setTimeout(Q,t),B(A)}return o===void 0&&(o=setTimeout(Q,t)),a}return ft.cancel=J,ft.flush=tt,ft}function $2(r){var t=typeof r;return!!r&&(t=="object"||t=="function")}function Qnt(r){return!!r&&typeof r=="object"}function Hnt(r){return typeof r=="symbol"||Qnt(r)&&Ont.call(r)==Ent}function z4(r){if(typeof r=="number")return r;if(Hnt(r))return H4;if($2(r)){var t=typeof r.valueOf=="function"?r.valueOf():r;r=$2(t)?t+"":t}if(typeof r!="string")return r===0?r:+r;r=r.replace(Snt,"");var e=Int.test(r);return e||Lnt.test(r)?Fnt(r.slice(2),e?2:8):Tnt.test(r)?H4:+r}var znt=knt,W2={exports:{}},Mf=typeof Reflect=="object"?Reflect:null,G4=Mf&&typeof Mf.apply=="function"?Mf.apply:function(t,e,n){return Function.prototype.apply.call(t,e,n)},Ry;Mf&&typeof Mf.ownKeys=="function"?Ry=Mf.ownKeys:Object.getOwnPropertySymbols?Ry=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:Ry=function(t){return Object.getOwnPropertyNames(t)};function Gnt(r){console&&console.warn&&console.warn(r)}var V4=Number.isNaN||function(t){return t!==t};function ii(){ii.init.call(this)}W2.exports=ii,W2.exports.once=Knt,ii.EventEmitter=ii,ii.prototype._events=void 0,ii.prototype._eventsCount=0,ii.prototype._maxListeners=void 0;var j4=10;function Oy(r){if(typeof r!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof r)}Object.defineProperty(ii,"defaultMaxListeners",{enumerable:!0,get:function(){return j4},set:function(r){if(typeof r!="number"||r<0||V4(r))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+r+".");j4=r}}),ii.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},ii.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||V4(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function q4(r){return r._maxListeners===void 0?ii.defaultMaxListeners:r._maxListeners}ii.prototype.getMaxListeners=function(){return q4(this)},ii.prototype.emit=function(t){for(var e=[],n=1;n<arguments.length;n++)e.push(arguments[n]);var i=t==="error",s=this._events;if(s!==void 0)i=i&&s.error===void 0;else if(!i)return!1;if(i){var a;if(e.length>0&&(a=e[0]),a instanceof Error)throw a;var o=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw o.context=a,o}var A=s[t];if(A===void 0)return!1;if(typeof A=="function")G4(A,this,e);else for(var f=A.length,m=J4(A,f),n=0;n<f;++n)G4(m[n],this,e);return!0};function K4(r,t,e,n){var i,s,a;if(Oy(e),s=r._events,s===void 0?(s=r._events=Object.create(null),r._eventsCount=0):(s.newListener!==void 0&&(r.emit("newListener",t,e.listener?e.listener:e),s=r._events),a=s[t]),a===void 0)a=s[t]=e,++r._eventsCount;else if(typeof a=="function"?a=s[t]=n?[e,a]:[a,e]:n?a.unshift(e):a.push(e),i=q4(r),i>0&&a.length>i&&!a.warned){a.warned=!0;var o=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");o.name="MaxListenersExceededWarning",o.emitter=r,o.type=t,o.count=a.length,Gnt(o)}return r}ii.prototype.addListener=function(t,e){return K4(this,t,e,!1)},ii.prototype.on=ii.prototype.addListener,ii.prototype.prependListener=function(t,e){return K4(this,t,e,!0)};function Vnt(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function $4(r,t,e){var n={fired:!1,wrapFn:void 0,target:r,type:t,listener:e},i=Vnt.bind(n);return i.listener=e,n.wrapFn=i,i}ii.prototype.once=function(t,e){return Oy(e),this.on(t,$4(this,t,e)),this},ii.prototype.prependOnceListener=function(t,e){return Oy(e),this.prependListener(t,$4(this,t,e)),this},ii.prototype.removeListener=function(t,e){var n,i,s,a,o;if(Oy(e),i=this._events,i===void 0)return this;if(n=i[t],n===void 0)return this;if(n===e||n.listener===e)--this._eventsCount===0?this._events=Object.create(null):(delete i[t],i.removeListener&&this.emit("removeListener",t,n.listener||e));else if(typeof n!="function"){for(s=-1,a=n.length-1;a>=0;a--)if(n[a]===e||n[a].listener===e){o=n[a].listener,s=a;break}if(s<0)return this;s===0?n.shift():jnt(n,s),n.length===1&&(i[t]=n[0]),i.removeListener!==void 0&&this.emit("removeListener",t,o||e)}return this},ii.prototype.off=ii.prototype.removeListener,ii.prototype.removeAllListeners=function(t){var e,n,i;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[t]),this;if(arguments.length===0){var s=Object.keys(n),a;for(i=0;i<s.length;++i)a=s[i],a!=="removeListener"&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(e=n[t],typeof e=="function")this.removeListener(t,e);else if(e!==void 0)for(i=e.length-1;i>=0;i--)this.removeListener(t,e[i]);return this};function W4(r,t,e){var n=r._events;if(n===void 0)return[];var i=n[t];return i===void 0?[]:typeof i=="function"?e?[i.listener||i]:[i]:e?qnt(i):J4(i,i.length)}ii.prototype.listeners=function(t){return W4(this,t,!0)},ii.prototype.rawListeners=function(t){return W4(this,t,!1)},ii.listenerCount=function(r,t){return typeof r.listenerCount=="function"?r.listenerCount(t):X4.call(r,t)},ii.prototype.listenerCount=X4;function X4(r){var t=this._events;if(t!==void 0){var e=t[r];if(typeof e=="function")return 1;if(e!==void 0)return e.length}return 0}ii.prototype.eventNames=function(){return this._eventsCount>0?Ry(this._events):[]};function J4(r,t){for(var e=new Array(t),n=0;n<t;++n)e[n]=r[n];return e}function jnt(r,t){for(;t+1<r.length;t++)r[t]=r[t+1];r.pop()}function qnt(r){for(var t=new Array(r.length),e=0;e<t.length;++e)t[e]=r[e].listener||r[e];return t}function Knt(r,t){return new Promise(function(e,n){function i(a){r.removeListener(t,s),n(a)}function s(){typeof r.removeListener=="function"&&r.removeListener("error",i),e([].slice.call(arguments))}Y4(r,t,s,{once:!0}),t!=="error"&&$nt(r,i,{once:!0})})}function $nt(r,t,e){typeof r.on=="function"&&Y4(r,"error",t,e)}function Y4(r,t,e,n){if(typeof r.on=="function")n.once?r.once(t,e):r.on(t,e);else if(typeof r.addEventListener=="function")r.addEventListener(t,function i(s){n.once&&r.removeEventListener(t,i),e(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof r)}var Z4=W2.exports,Wnt={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}},Xnt={de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"",ja:"",lv:"Meklt",pt:"Procurar",sr:"",zh:"",cs:"Vyhledvn",hu:"Keress",ka:"",nb:"Ske",sk:"Vyhadvanie",th:"",fi:"Hae",is:"Leita",ko:"",pl:"Szukaj",sl:"Iskanje",fa:"",ru:""},Jnt={placeholder:Xnt},tP={exports:{}};(function(r){(function(t,e,n){r.exports?r.exports=n():t[e]=n()})(kd,"subtag",function(){var t="",e=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function n(A){return A.match(e)||[]}function i(A){return n(A).filter(function(f,m){return f&&m})}function s(A){return A=n(A),{language:A[1]||t,extlang:A[2]||t,script:A[3]||t,region:A[4]||t}}function a(A,f,m){Object.defineProperty(A,f,{value:m,enumerable:!0})}function o(A,f,m){function _(x){return n(x)[A]||t}a(_,"pattern",f),a(s,m,_)}return o(1,/^[a-zA-Z]{2,3}$/,"language"),o(2,/^[a-zA-Z]{3}$/,"extlang"),o(3,/^[a-zA-Z]{4}$/,"script"),o(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),a(s,"split",i),s})})(tP);var Ynt=tP.exports,Znt=Bnt,tit=znt,ka=N4,eit=Z4.EventEmitter,eP=Wnt,rit=Jnt,nit=Ynt;function rP(r,t){this._eventEmitter=new eit,this.options=ka({},this.options,t),this.inputString="",this.fresh=!0,this.lastSelected=null,this.geocoderApi=r}rP.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,showResultsWhileTyping:!1,minLength:2,reverseGeocode:!1,limit:5,enableEventLogging:!0,marker:!0,popup:!1,maplibregl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,getItemValue:function(r){return r.text!==void 0?r.text:r.place_name},render:function(r){if(r.geometry){var o=r.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--result maplibregl-ctrl-geocoder--result"><svg class="mapboxgl-ctrl-geocoder--result-icon maplibre-ctrl-geocoder--result-icon" viewBox="0 0 24 32" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 0C5.36571 0 0 5.38676 0 12.0471C0 21.0824 12 32 12 32C12 32 24 21.0824 24 12.0471C24 5.38676 18.6343 0 12 0ZM12 16.3496C9.63428 16.3496 7.71429 14.4221 7.71429 12.0471C7.71429 9.67207 9.63428 7.74454 12 7.74454C14.3657 7.74454 16.2857 9.67207 16.2857 12.0471C16.2857 14.4221 14.3657 16.3496 12 16.3496Z" fill="#687078"/></svg><div><div class="mapboxgl-ctrl-geocoder--result-title maplibregl-ctrl-geocoder--result-title">'+o[0]+'</div><div class="mapboxgl-ctrl-geocoder--result-address maplibregl-ctrl-geocoder--result-address">'+o.splice(1,o.length).join(",")+"</div></div></div>"}else{var t=r.text,e=t.toLowerCase().indexOf(this.query.toLowerCase()),n=this.query.length,i=t.substring(0,e),s=t.substring(e,e+n),a=t.substring(e+n);return'<div class="mapboxgl-ctrl-geocoder--suggestion maplibregl-ctrl-geocoder--suggestion"><svg class="mapboxgl-ctrl-geocoder--suggestion-icon maplibre-ctrl-geocoder--suggestion-icon" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><path d="M22.8702 20.1258H21.4248L20.9125 19.6318C22.7055 17.546 23.785 14.8382 23.785 11.8925C23.785 5.32419 18.4608 0 11.8925 0C5.32419 0 0 5.32419 0 11.8925C0 18.4608 5.32419 23.785 11.8925 23.785C14.8382 23.785 17.546 22.7055 19.6318 20.9125L20.1258 21.4248V22.8702L29.2739 32L32 29.2739L22.8702 20.1258ZM11.8925 20.1258C7.33676 20.1258 3.65923 16.4483 3.65923 11.8925C3.65923 7.33676 7.33676 3.65923 11.8925 3.65923C16.4483 3.65923 20.1258 7.33676 20.1258 11.8925C20.1258 16.4483 16.4483 20.1258 11.8925 20.1258Z" fill="#687078"/></svg><div class="mapboxgl-ctrl-geocoder--suggestion-info maplibregl-ctrl-geocoder--suggestion-info"><div class="mapboxgl-ctrl-geocoder--suggestion-title maplibregl-ctrl-geocoder--suggestion-title">'+i+'<span class="mapboxgl-ctrl-geocoder--suggestion-match maplibregl-ctrl-geocoder--suggestion-match">'+s+"</span>"+a+"</div></div></div>"}},popupRender:function(r){var t=r.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion maplibre-ctrl-geocoder--suggestion popup-suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title maplibre-ctrl-geocoder--suggestion-title popup-suggestion-title">'+t[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address maplibre-ctrl-geocoder--suggestion-address popup-suggestion-address">'+t.splice(1,t.length).join(",")+"</div></div>"},showResultMarkers:!0,debounceSearch:200},addTo:function(r){function t(n,i){if(!document.body.contains(i))throw new Error("Element provided to #addTo() exists, but is not in the DOM");var s=n.onAdd();i.appendChild(s)}if(r._controlContainer)r.addControl(this);else if(r instanceof HTMLElement)t(this,r);else if(typeof r=="string"){var e=document.querySelectorAll(r);if(e.length===0)throw new Error("Element ",r,"not found.");if(e.length>1)throw new Error("Geocoder can only be added to a single html element");t(this,e[0])}else throw new Error("Error: addTo must be a maplibre-gl-js map, an html element, or a CSS selector query for a single html element")},onAdd:function(r){if(r&&typeof r!="string"&&(this._map=r),this.setLanguage(),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this);var t=this.container=document.createElement("div");t.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl maplibregl-ctrl-geocoder maplibregl-ctrl";var e=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input maplibregl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",tit(this._onKeyDown,this.options.debounceSearch)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton);var n=document.createElement("div");n.classList.add("mapboxgl-ctrl-geocoder--pin-right","maplibregl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button maplibregl-ctrl-geocoder--button";var i=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');return this._clearEl.appendChild(i),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),n.appendChild(this._clearEl),n.appendChild(this._loadingEl),t.appendChild(e),t.appendChild(this._inputEl),t.appendChild(n),this._typeahead=new Znt(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit,noInitialSelection:!0}),this.setRenderFunction(this.options.render),this._typeahead.getItemValue=this.options.getItemValue,this.mapMarker=null,this.resultMarkers=[],this._handleMarker=this._handleMarker.bind(this),this._handleResultMarkers=this._handleResultMarkers.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._maplibregl=this.options.maplibregl,!this._maplibregl&&this.options.marker&&(console.error("No maplibregl detected in options. Map markers are disabled. Please set options.maplibregl."),this.options.marker=!1)),t},createIcon:function(r,t){var e=document.createElementNS("http://www.w3.org/2000/svg","svg");if(e.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+r+" maplibregl-ctrl-geocoder--icon maplibregl-ctrl-geocoder--icon-"+r),e.setAttribute("viewBox","0 0 18 18"),e.setAttribute("xml:space","preserve"),e.setAttribute("width",18),e.setAttribute("height",18),"innerHTML"in e)e.innerHTML=t;else{var n=document.createElement("div");n.innerHTML="<svg>"+t.valueOf().toString()+"</svg>";var i=n.firstChild,s=i.firstChild;e.appendChild(s)}return e},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_onPaste:function(r){var t=(r.clipboardData||window.clipboardData).getData("text");t.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(t)},_onKeyDown:function(r){var t=27,e=9;if(r.keyCode===t&&this.options.clearAndBlurOnEsc)return this._clear(r),this._inputEl.blur();var n=r.target&&r.target.shadowRoot?r.target.shadowRoot.activeElement:r.target,i=n?n.value:"";if(!i)return this.fresh=!0,r.keyCode!==e&&this.clear(r),this._clearEl.style.display="none";if(!(r.metaKey||[e,t,37,39,38,40].indexOf(r.keyCode)!==-1)){if(r.keyCode===13)if(!this.options.showResultsWhileTyping)this._typeahead.selected||this._geocode(n.value);else{this._typeahead.selected==null&&this.geocoderApi.getSuggestions?this._geocode(n.value,!0):this._typeahead.selected==null&&this.options.showResultMarkers&&this._fitBoundsForMarkers();return}n.value.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(n.value)}},_showButton:function(){this._inputEl.value.length>0&&(this._clearEl.style.display="block")},_hideButton:function(){this._typeahead.selected&&(this._clearEl.style.display="none")},_onBlur:function(r){this.options.clearOnBlur&&this._clearOnBlur(r),this.options.collapsed&&this._collapse()},_onChange:function(){var r=this._typeahead.selected;if(r&&!r.geometry)r.placeId?this._geocode(r.placeId,!0,!0):this._geocode(r.text,!0);else if(r&&JSON.stringify(r)!==this.lastSelected){if(this._clearEl.style.display="none",this.options.flyTo){var t;if(this._removeResultMarkers(),r.properties&&eP[r.properties.short_code])t=ka({},this.options.flyTo),this._map&&this._map.fitBounds(eP[r.properties.short_code].bbox,t);else if(r.bbox){var e=r.bbox;t=ka({},this.options.flyTo),this._map&&this._map.fitBounds([[e[0],e[1]],[e[2],e[3]]],t)}else{var n={zoom:this.options.zoom};t=ka({},n,this.options.flyTo),r.center?t.center=r.center:r.geometry&&r.geometry.type&&r.geometry.type==="Point"&&r.geometry.coordinates&&(t.center=r.geometry.coordinates),this._map&&this._map.flyTo(t)}}this.options.marker&&this._maplibregl&&this._handleMarker(r),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(r),this._typeahead.selected=null,this._eventEmitter.emit("result",{result:r})}},_getConfigForRequest:function(){var r=["bbox","limit","proximity","countries","types","language","reverseMode"],t=this,e=r.reduce(function(n,i){return t.options[i]&&(["countries","types","language"].indexOf(i)>-1?n[i]=t.options[i].split(/[\s,]+/):n[i]=t.options[i],i==="proximity"&&t.options[i]&&typeof t.options[i].longitude=="number"&&typeof t.options[i].latitude=="number"&&(n[i]=[t.options[i].longitude,t.options[i].latitude])),n},{});return e},_geocode:function(r,t,e){this._loadingEl.style.display="block",this._eventEmitter.emit("loading",{query:r}),this.inputString=r;var n=null,i=this._getConfigForRequest(),s;if(this.options.localGeocoderOnly)s=Promise.resolve();else if(this.options.reverseGeocode&&/(-?\d+\.?\d*)[, ]+(-?\d+\.?\d*)[ ]*$/.test(r)){var a=r.split(/[\s(,)?]+/).map(function(f){return parseFloat(f,10)}).reverse();i.types&&i.types[0],i=ka(i,{query:a,limit:1}),"proximity"in i&&delete i.proximity,s=this.geocoderApi.reverseGeocode(i)}else i=ka(i,{query:r}),this.geocoderApi.getSuggestions?t?this.geocoderApi.searchByPlaceId&&e?s=this.geocoderApi.searchByPlaceId(i):s=this.geocoderApi.forwardGeocode(i):s=this.geocoderApi.getSuggestions(i):s=this.geocoderApi.forwardGeocode(i);var o=[];this.options.localGeocoder&&(o=this.options.localGeocoder(r),o||(o=[]));var A=[];return s.catch((function(f){n=f}).bind(this)).then((function(f){this._loadingEl.style.display="none";var m={};return f?m=f:m={type:"FeatureCollection",features:[]},m.config=i,this.fresh&&(this.fresh=!1),m.features=m.features?o.concat(m.features):o,this.options.externalGeocoder?(A=this.options.externalGeocoder(r,m.features,i)||[],A.then(function(_){return m.features=m.features?_.concat(m.features):_,m},function(){return m})):m}).bind(this)).then((function(f){if(n)throw n;this.options.filter&&f.features.length&&(f.features=f.features.filter(this.options.filter));var m=[];f.suggestions?m=f.suggestions:f.place?m=[f.place]:m=f.features,m.length?(this._clearEl.style.display="block",this._typeahead.update(m),(!this.options.showResultsWhileTyping||t)&&this.options.showResultMarkers&&(f.features.length>0||f.place)&&this._fitBoundsForMarkers(),this._eventEmitter.emit("results",f)):(this._clearEl.style.display="none",this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",f))}).bind(this)).catch((function(f){this._loadingEl.style.display="none",o.length&&this.options.localGeocoder||A.length&&this.options.externalGeocoder?(this._clearEl.style.display="block",this._typeahead.update(o)):(this._clearEl.style.display="none",this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:o}),this._eventEmitter.emit("error",{error:f})}).bind(this)),s},_clear:function(r){r&&r.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._clearEl.style.display="none",this._removeMarker(),this._removeResultMarkers(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(r){this._clear(r),this._inputEl.focus()},_clearOnBlur:function(r){var t=this;r.relatedTarget&&t._clear(r)},_onQueryResult:function(r){var t=r;if(t.features.length){var e=t.features[0];this._typeahead.selected=e,this._inputEl.value=e.place_name,this._onChange()}},_updateProximity:function(){if(this._map)if(this._map.getZoom()>9){var r=this._map.getCenter().wrap();this.setProximity({longitude:r.lng,latitude:r.lat})}else this.setProximity(null)},_collapse:function(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed","maplibregl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed","maplibregl-ctrl-geocoder--collapsed")},query:function(r){return this._geocode(r).then(this._onQueryResult),this},_renderError:function(){var r="<div class='mapbox-gl-geocoder--error maplibre-gl-geocoder--error'>There was an error reaching the server</div>";this._renderMessage(r)},_renderNoResults:function(){var r="<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results maplibre-gl-geocoder--error maplibre-gl-geocoder--no-results'>No results found</div>";this._renderMessage(r)},_renderMessage:function(r){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(r)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var r=this.options.language.split(",")[0],t=nit.language(r),e=rit.placeholder[t];if(e)return e}return"Search"},_fitBoundsForMarkers:function(){if(!(this._typeahead.data.length<1)){var r=this._typeahead.data.filter(function(i){return typeof i!="string"}).slice(0,this.options.limit);if(this._clearEl.style.display="none",this.options.flyTo&&this._maplibregl&&this._map){var t={padding:100},e=ka({},t,this.options.flyTo),n=new this._maplibregl.LngLatBounds;r.forEach(function(i){n.extend(i.geometry.coordinates)}),this._map.fitBounds(n.toArray(),e)}return r.length>0&&this._maplibregl&&this._handleResultMarkers(r),this}},setInput:function(r){return this._inputEl.value=r,this._typeahead.selected=null,this._typeahead.clear(),r.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(r),this},setProximity:function(r){return this.options.proximity=r,this},getProximity:function(){return this.options.proximity},setRenderFunction:function(r){return r&&typeof r=="function"&&(this._typeahead.render=r),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(r){var t=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=r||this.options.language||t,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(r){return this.options.zoom=r,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(r){return this.options.flyTo=r,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(r){return this.placeholder=r||this._getPlaceholderText(),this._inputEl.placeholder=this.placeholder,this._inputEl.setAttribute("aria-label",this.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(r){return this.options.bbox=r,this},getCountries:function(){return this.options.countries},setCountries:function(r){return this.options.countries=r,this},getTypes:function(){return this.options.types},setTypes:function(r){return this.options.types=r,this},getMinLength:function(){return this.options.minLength},setMinLength:function(r){return this.options.minLength=r,this._typeahead&&(this._typeahead.options.minLength=r),this},getLimit:function(){return this.options.limit},setLimit:function(r){return this.options.limit=r,this._typeahead&&(this._typeahead.options.limit=r),this},getFilter:function(){return this.options.filter},setFilter:function(r){return this.options.filter=r,this},setGeocoderApi:function(r){return this.geocoderApi=r,this},getGeocoderApi:function(){return this.geocoderApi},_handleMarker:function(r){if(this._map){this._removeMarker();var t={color:"#4668F2"},e=ka({},t,this.options.marker);this.mapMarker=new this._maplibregl.Marker(e);var n;if(this.options.popup){var i={},s=ka({},i,this.options.popup);n=new this._maplibregl.Popup(s).setHTML(this.options.popupRender(r))}return r.center?(this.mapMarker.setLngLat(r.center).addTo(this._map),this.options.popup&&this.mapMarker.setPopup(n)):r.geometry&&r.geometry.type&&r.geometry.type==="Point"&&r.geometry.coordinates&&(this.mapMarker.setLngLat(r.geometry.coordinates).addTo(this._map),this.options.popup&&this.mapMarker.setPopup(n)),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},_handleResultMarkers:function(r){if(this._map){this._removeResultMarkers();var t={color:"#4668F2"},e=ka({},t,this.options.showResultMarkers);return r.forEach((function(n){if(this.options.showResultMarkers&&this.options.showResultMarkers.element){var i=this.options.showResultMarkers.element.cloneNode(!0);e=ka(e,{element:i})}var s=new this._maplibregl.Marker(ka({},e,{element:i})),a;if(this.options.popup){var o={},A=ka({},o,this.options.popup);a=new this._maplibregl.Popup(A).setHTML(this.options.popupRender(n))}n.center?(s.setLngLat(n.center).addTo(this._map),this.options.popup&&s.setPopup(a)):n.geometry&&n.geometry.type&&n.geometry.type==="Point"&&n.geometry.coordinates&&(s.setLngLat(n.geometry.coordinates).addTo(this._map),this.options.popup&&s.setPopup(a)),this.resultMarkers.push(s)}).bind(this)),this}},_removeResultMarkers:function(){this.resultMarkers&&this.resultMarkers.length>0&&(this.resultMarkers.forEach(function(r){r.remove()}),this.resultMarkers=[])},on:function(r,t){return this._eventEmitter.on(r,t),this},off:function(r,t){return this._eventEmitter.removeListener(r,t),this}};var iit=rP;const sit=Mp(iit),X2={defaultOptions:{limitsUrl:"https://tilemaps.icgc.cat/vt/limits-tilejsonV3.json",geocoder:{peliasUrl1:"https://eines.icgc.cat/geocodificador/autocompletar?text=",peliasUrl2:"&layers=topo1%2Ctopo2%2Caddress&size=5"},mapOptions:{container:"map",center:{0:1.537786,1:41.837539},zoom:7.5,bearing:0,pitch:0,hash:!1,style:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_base_gris.json",maxZoom:18,maxPitch:85},logoIcgcOptions:{logoUrlColor:"https://tilemaps.icgc.cat/cdn/logos/icgc_logo_color.png",logoUrlWhite:"https://tilemaps.icgc.cat/cdn/logos/icgc_logo_blanc.svg",logoLink:"https://www.icgc.cat",logoTitle:"Institut Cartogrfic i Geolgic de Catalunya",logoWidth:100},logoGencatOptions:{logoUrlColor:"https://tilemaps.icgc.cat/cdn/logos/gencat_logo_color.png",logoUrlWhite:"https://tilemaps.icgc.cat/cdn/logos/gencat_logo_blanc.png",logoLink:"https://web.gencat.cat/",logoTitle:"Generalitat de Catalunya",logoWidth:100},map3dOptions:{spaceErrorFactor:2,exaggeration:1,zfactor:48,minZoomRange:15.5,maxZoomRange:22,urlTilesetCities:"https://tilemaps.icgc.cat/vector/3dtiles/ciutats/v1/tilesetV1.0.json",layerIdOrder:"place-isolated",sourceLayerFilterId:"place",minZoomFilter:14,layerId3d:"edificisMapboxLayer",terrainSource:"ICGC5M",style3dName:"orto3d",imageIcon:"https://tilemaps.icgc.cat/cdn/images/stick.png"},baseStyles:[{key:"TOPO",url:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_estandard.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_mapa_estandard.png"},{key:"ORTO",url:"https://geoserveis.icgc.cat/contextmaps/icgc_orto_estandard.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_orto_hibrida.png"},{key:"ORTO3D",url:"https://tilemaps.icgc.cat/cdn/styles/icgc_orto_3d.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_orto_hibrida.png"},{key:"ADMIN",url:"https://geoserveis.icgc.cat/contextmaps/icgc_delimitacio_limits_administratius.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_delimitacio_limits_administratius.png"},{key:"DARK",url:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_base_fosc.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_mapa_base_fosc.png"},{key:"LIGHT",url:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_base_gris.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_mapa_base_gris.png"},{key:"GEOLOGY",url:"https://geoserveis.icgc.cat/contextmaps/icgc_geologic_informacio.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_geologic_informacio.png"}],urlTerrainICGC:[{name:"ICGC5M",url:"https://tilemaps.icgc.cat/tileserver/tileserver/terreny-5m-30m-rgb-extent/{z}/{x}/{y}.png"},{name:"WORLD30M",url:"https://s3.amazonaws.com/elevation-tiles-prod/terrarium/{z}/{x}/{y}.png",encoding:"terrarium"}],ortoLayersICGC:[{name:"ortofotoColorProvisional",key:"ortofoto_color_provisional",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_provisional"},{name:"ortofotoColor2022",key:"ortofoto_color_2022",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2022"},{name:"ortofotoColor2021",key:"ortofoto_color_2021",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2021"},{name:"ortofotoColor2020",key:"ortofoto_color_2020",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2020"},{name:"ortofotoColor2019",key:"ortofoto_color_2019",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2019"},{name:"ortofotoColor2018",key:"ortofoto_color_2018",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2018"},{name:"ortofotoColor2017",key:"ortofoto_color_2017",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2017"},{name:"ortofotoColor2016",key:"ortofoto_color_2016",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2016"},{name:"ortofotoColor2015",key:"ortofoto_color_2015",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2015"},{name:"ortofotoColor2014",key:"ortofoto_color_2014",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2014"},{name:"ortofotoColor2013",key:"ortofoto_color_2013",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2013"},{name:"ortofotoColor2012",key:"ortofoto_color_2012",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2012"},{name:"ortofotoColor2011",key:"ortofoto_color_2011",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2011"},{name:"ortofotoColor2010",key:"ortofoto_color_2010",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2010"},{name:"ortofotoColor2009",key:"ortofoto_color_2009",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2009"},{name:"ortofotoColor2008",key:"ortofoto_color_2008",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2008"},{name:"ortofotoColor20062007",key:"ortofoto_color_2006-2007",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2006-2007"},{name:"ortofotoColor20042005",key:"ortofoto_color_2004-2005",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2004-2005"},{name:"ortofotoColor20002003",key:"ortofoto_color_2000-2003",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2000-2003"},{name:"ortofotoBlancINegre1998",key:"ortofoto_blanc_i_negre_1998",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1998"},{name:"ortofotoBlancINegre19941997",key:"ortofoto_blanc_i_negre_1994-1997",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1994-1997"},{name:"ortofotoColor1993",key:"ortofoto_color_1993",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_1993"},{name:"ortofotoBlancINegre19831992",key:"ortofoto_blanc_i_negre_1983-1992",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1983-1992"},{name:"ortofotoBlancINegre19701977",key:"ortofoto_blanc_i_negre_1970-1977",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1970-1977"},{name:"ortofotoBlancINegre1956",key:"ortofoto_blanc_i_negre_1956",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1956"},{name:"ortofotoBlancINegre1945",key:"ortofoto_blanc_i_negre_1945",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1945"},{name:"ortofotoColorSerieAnual",key:"ortofoto_color_serie_anual",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_serie_anual"},{name:"ortofotoInfraroigProvisional",key:"ortofoto_infraroig_provisional",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_provisional"},{name:"ortofotoInfraroig2022",key:"ortofoto_infraroig_2022",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2022"},{name:"ortofotoInfraroig2021",key:"ortofoto_infraroig_2021",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2021"},{name:"ortofotoInfraroig2020",key:"ortofoto_infraroig_2020",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2020"},{name:"ortofotoInfraroig2019",key:"ortofoto_infraroig_2019",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2019"},{name:"ortofotoInfraroig2018",key:"ortofoto_infraroig_2018",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2018"},{name:"ortofotoInfraroig2017",key:"ortofoto_infraroig_2017",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2017"},{name:"ortofotoInfraroig2016",key:"ortofoto_infraroig_2016",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2016"},{name:"ortofotoInfraroig2015",key:"ortofoto_infraroig_2015",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2015"},{name:"ortofotoInfraroig2014",key:"ortofoto_infraroig_2014",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2014"},{name:"ortofotoInfraroig2013",key:"ortofoto_infraroig_2013",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2013"},{name:"ortofotoInfraroig2012",key:"ortofoto_infraroig_2012",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2012"},{name:"ortofotoInfraroig2011",key:"ortofoto_infraroig_2011",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2011"},{name:"ortofotoInfraroig2010",key:"ortofoto_infraroig_2010",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2010"},{name:"ortofotoInfraroig2009",key:"ortofoto_infraroig_2009",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2009"},{name:"ortofotoInfraroig2008",key:"ortofoto_infraroig_2008",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2008"},{name:"ortofotoInfraroig20062007",key:"ortofoto_infraroig_2006-2007",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2006-2007"},{name:"ortofotoInfraroig19961997",key:"ortofoto_infraroig_1996-1997",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_1996-1997"},{name:"ortofotoInfraroigSerieAnual",key:"ortofoto_infraroig_serie_anual",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_serie_anual"}],vectorLayersICGC:[{name:"agrupacionsCensals2015",key:"agrupacions_censals_2015"},{name:"agrupacionsCensals2016",key:"agrupacions_censals_2016"},{name:"agrupacionsCensals2017",key:"agrupacions_censals_2017"},{name:"agrupacionsCensals2018",key:"agrupacions_censals_2018"},{name:"agrupacionsCensals2019",key:"agrupacions_censals_2019"},{name:"agrupacionsCensals2020",key:"agrupacions_censals_2020"},{name:"agrupacionsCensals2021",key:"agrupacions_censals_2021"},{name:"agrupacionsCensalsVigent",key:"agrupacions_censals_vigent"},{name:"agrupacionsCensalsVigentText",key:"agrupacions_censals_vigent_text"},{name:"areesBasiquesPolicials2019",key:"arees_basiques_policials_2019"},{name:"areesBasiquesPolicials2020",key:"arees_basiques_policials_2020"},{name:"areesBasiquesPolicials2022",key:"arees_basiques_policials_2022"},{name:"areesBasiquesPolicialsVigent",key:"arees_basiques_policials_vigent"},{name:"areesBasiquesPolicialsVigentText",key:"arees_basiques_policials_vigent_text"},{name:"areesBasiquesSalutVigent",key:"arees_basiques_salut_vigent"},{name:"areesBasiquesServeisSocialsVigent",key:"arees_basiques_serveis_socials_vigent"},{name:"areesBasiquesServeisSocialsVigentText",key:"arees_basiques_serveis_socials_vigent_text"},{name:"areesGestioAssistencialVigent",key:"arees_gestio_assistencial_vigent"},{name:"areesHidrogeologiquesAquifersVigent",key:"arees_hidrogeologiques_aquifers_vigent"},{name:"catalunyaVigent",key:"catalunya_vigent"},{name:"catalunyaVigentText",key:"catalunya_vigent_text"},{name:"comarques2022",key:"comarques_2022"},{name:"comarquesVigent",key:"comarques_vigent"},{name:"comarquesVigentText",key:"comarques_vigent_text"},{name:"districtesCensals2015",key:"districtes_censals_2015"},{name:"districtesCensals2016",key:"districtes_censals_2016"},{name:"districtesCensals2017",key:"districtes_censals_2017"},{name:"districtesCensals2018",key:"districtes_censals_2018"},{name:"districtesCensals2019",key:"districtes_censals_2019"},{name:"districtesCensals2020",key:"districtes_censals_2020"},{name:"districtesCensals2021",key:"districtes_censals_2021"},{name:"districtesCensals2022",key:"districtes_censals_2022"},{name:"districtesCensalsVigent",key:"districtes_censals_vigent"},{name:"districtesCensalsVigentText",key:"districtes_censals_vigent_text"},{name:"incendisForestalsVigent",key:"incendis_forestals_vigent"},{name:"incendisForestalsVigentText",key:"incendis_forestals_vigent_text"},{name:"municipis2022",key:"municipis_2022"},{name:"municipis2022Text",key:"municipis_2022_text"},{name:"municipisVigent",key:"municipis_vigent"},{name:"municipisVigentText",key:"municipis_vigent_text"},{name:"partitsJudicialsVigent",key:"partits_judicials_vigent"},{name:"partitsJudicialsVigentText",key:"partits_judicials_vigent_text"},{name:"plaTerritorial2015",key:"pla_territorial_2015"},{name:"plaTerritorialVigent",key:"pla_territorial_vigent"},{name:"plaTerritorialVigentText",key:"pla_territorial_vigent_text"},{name:"provinciesVigent",key:"provincies_vigent"},{name:"provinciesVigentText",key:"provincies_vigent_text"},{name:"regionsPolicialsVigent",key:"regions_policials_vigent"},{name:"regionsPolicialsVigentText",key:"regions_policials_vigent_text"},{name:"regionsSanitariesVigent",key:"regions_sanitaries_vigent"},{name:"regionsSanitariesVigentText",key:"regions_sanitaries_vigent_text"},{name:"seccionsCensals2015",key:"seccions_censals_2015"},{name:"seccionsCensals2016",key:"seccions_censals_2016"},{name:"seccionsCensals2017",key:"seccions_censals_2017"},{name:"seccionsCensals2018",key:"seccions_censals_2018"},{name:"seccionsCensals2019",key:"seccions_censals_2019"},{name:"seccionsCensals2020",key:"seccions_censals_2020"},{name:"seccionsCensals2021",key:"seccions_censals_2021"},{name:"seccionsCensals2022",key:"seccions_censals_2022"},{name:"seccionsCensalsVigent",key:"seccions_censals_vigent"},{name:"seccionsCensalsVigentText",key:"seccions_censals_vigent_text"},{name:"sectorsSanitarisVigent",key:"sectors_sanitaris_vigent"},{name:"vegueriesVigent",key:"vegueries_vigent"},{name:"vegueriesVigentText",key:"vegueries_vigent_text"}],vectorLayers:[{key:"cobertes2018",url:"https://tilemaps.icgc.cat/tileserver/cobertes_tilejson.json",legend:"https://tilemaps.icgc.cat/cdn/images/llegendaCobertesSol2018.jpg"}],wmsLayers:[{key:"espaisInteresGeologic",layer:"",url:"https://geoserveis.icgc.cat/servei/catalunya/espais-interes-geologic/wms/service?&service=WMS&request=GetMap&layers=espais-interes-geologic&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}"},{key:"gravimetriaBouguer500000",layer:"",url:"https://geoserveis.icgc.cat/servei/catalunya/gravimetria/wms/service?&service=WMS&request=GetMap&layers=anomalia_bouguer_500000&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}"},{key:"cobertesSol2018",layer:"",url:"https://geoserveis.icgc.cat/servei/catalunya/cobertes-sol/wms/service?&service=WMS&request=GetMap&layers=cobertes_2018&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}"},{key:"administratiu",layer:"",url:"http://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/administratiu/MON3857NW/{z}/{x}/{y}.png"},{key:"simplificat",layer:"",url:"http://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/simplificat/MON3857NW/{z}/{x}/{y}.png"},{key:"cims",layer:"",url:"https://geoserveis.icgc.cat/icc_100cims/wms/service?REQUEST=GetMap&SERVICE=WMS&VERSION=1.1.1&LAYERS=0&STYLES=&FORMAT=image/png&BGCOLOR=0xFFFFFF&TRANSPARENT=TRUE&SRS=EPSG:25831&BBOX=137118.923076923,4488408.75,650959.076923077,4749634.75&WIDTH=895&HEIGHT=455"},{key:"cobertesSol",layer:"",url:"http://geoserveis.icgc.cat/servei/catalunya/cobertes-sol/wms?REQUEST=GetMap&SERVICE=WMS&VERSION=1.3.0&LAYERS=cobertes_2009&STYLES=&FORMAT=image/png&BGCOLOR=0xFFFFFF&TRANSPARENT=TRUE&CRS=EPSG:25831&BBOX=374110.828167253,4639230.79853085,452621.120632226,4703578.45000215&WIDTH=1020&HEIGHT=836"}],fgbLayers:[{name:"agrupacionsCensalsVigent",key:"agrupacions_censals_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_vigent.fgb"},{name:"agrupacionsCensalsVigentText",key:"agrupacions_censals_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_vigent_text.fgb"},{name:"areesBasiquesPolicialsVigent",key:"arees_basiques_policials_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_vigent.fgb"},{name:"areesBasiquesPolicialsVigentText",key:"arees_basiques_policials_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_vigent_text.fgb"},{name:"areesBasiquesSalutVigent",key:"arees_basiques_salut_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_salut_vigent.fgb"},{name:"areesBasiquesServeisSocialsVigent",key:"arees_basiques_serveis_socials_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_serveis_socials_vigent.fgb"},{name:"areesBasiquesServeisSocialsVigentText",key:"arees_basiques_serveis_socials_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_serveis_socials_vigent_text.fgb"},{name:"areesGestioAssistencialVigent",key:"arees_gestio_assistencial_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_gestio_assistencial_vigent.fgb"},{name:"areesHidrogeologiquesAquifersVigent",key:"arees_hidrogeologiques_aquifers_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_hidrogeologiques_aquifers_vigent.fgb"},{name:"catalunyaVigent",key:"catalunya_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/catalunya_vigent.fgb"},{name:"catalunyaVigentText",key:"catalunya_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/catalunya_vigent_text.fgb"},{name:"comarquesVigent",key:"comarques_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/comarques_vigent.fgb"},{name:"comarquesVigentText",key:"comarques_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/comarques_vigent_text.fgb"},{name:"districtesCensalsVigent",key:"districtes_censals_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_vigent.fgb"},{name:"districtesCensalsVigentText",key:"districtes_censals_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_vigent_text.fgb"},{name:"incendisForestalsVigent",key:"incendis_forestals_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/incendis_forestals_vigent.fgb"},{name:"incendisForestalsVigentText",key:"incendis_forestals_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/incendis_forestals_vigent_text.fgb"},{name:"municipisVigent",key:"municipis_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/municipis_vigent.fgb"},{name:"municipisVigentText",key:"municipis_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/municipis_vigent_text.fgb"},{name:"partitsJudicialsVigent",key:"partits_judicials_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/partits_judicials_vigent.fgb"},{name:"partitsJudicialsVigentText",key:"partits_judicials_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/partits_judicials_vigent_text.fgb"},{name:"plaTerritorialVigent",key:"pla_territorial_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/pla_territorial_vigent.fgb"},{name:"plaTerritorialVigentText",key:"pla_territorial_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/pla_territorial_vigent_text.fgb"},{name:"provinciesVigent",key:"provincies_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/provincies_vigent.fgb"},{name:"provinciesVigentText",key:"provincies_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/provincies_vigent_text.fgb"},{name:"regionsPolicialsVigent",key:"regions_policials_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/regions_policials_vigent.fgb"},{name:"regionsPolicialsVigentText",key:"regions_policials_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/regions_policials_vigent_text.fgb"},{name:"regionsSanitariesVigent",key:"regions_sanitaries_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/regions_sanitaries_vigent.fgb"},{name:"regionsSanitariesVigentText",key:"regions_sanitaries_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/regions_sanitaries_vigent_text.fgb"},{name:"seccionsCensalsVigent",key:"seccions_censals_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_vigent.fgb"},{name:"seccionsCensalsVigentText",key:"seccions_censals_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_vigent_text.fgb"},{name:"sectorsSanitarisVigent",key:"sectors_sanitaris_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/sectors_sanitaris_vigent.fgb"},{name:"vegueriesVigent",key:"vegueries_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/vegueries_vigent.fgb"},{name:"vegueriesVigentText",key:"vegueries_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/vegueries_vigent_text.fgb"}]},Styles:{TOPO:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_estandard.json",ORTO:"https://geoserveis.icgc.cat/contextmaps/icgc_orto_estandard.json",ORTO3D:"https://tilemaps.icgc.cat/cdn/styles/icgc_orto_3d.json",ADMIN:"https://geoserveis.icgc.cat/contextmaps/icgc_delimitacio_limits_administratius.json",DARK:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_base_fosc.json",LIGHT:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_base_gris.json",GEOLOGY:"https://geoserveis.icgc.cat/contextmaps/icgc_geologic_informacio.json"},Terrains:{ICGC5M:"https://tilemaps.icgc.cat/tileserver/tileserver/terreny-5m-30m-rgb-extent/{z}/{x}/{y}.png",WORLD30M:"https://s3.amazonaws.com/elevation-tiles-prod/terrarium/{z}/{x}/{y}.png"},Layers:{Orto:{ortofotoColorProvisional:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_provisional",ortofotoColor2022:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2022",ortofotoColor2021:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2021",ortofotoColor2020:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2020",ortofotoColor2019:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2019",ortofotoColor2018:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2018",ortofotoColor2017:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2017",ortofotoColor2016:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2016",ortofotoColor2015:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2015",ortofotoColor2014:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2014",ortofotoColor2013:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2013",ortofotoColor2012:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2012",ortofotoColor2011:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2011",ortofotoColor2010:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2010",ortofotoColor2009:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2009",ortofotoColor2008:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2008",ortofotoColor20062007:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2006-2007",ortofotoColor20042005:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2004-2005",ortofotoColor20002003:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2000-2003",ortofotoBlancINegre1998:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1998",ortofotoBlancINegre19941997:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1994-1997",ortofotoColor1993:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_1993",ortofotoBlancINegre19831992:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1983-1992",ortofotoBlancINegre19701977:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1970-1977",ortofotoBlancINegre1956:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1956",ortofotoBlancINegre1945:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1945",ortofotoColorSerieAnual:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_serie_anual",ortofotoInfraroigProvisional:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_provisional",ortofotoInfraroig2022:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2022",ortofotoInfraroig2021:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2021",ortofotoInfraroig2020:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2020",ortofotoInfraroig2019:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2019",ortofotoInfraroig2018:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2018",ortofotoInfraroig2017:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2017",ortofotoInfraroig2016:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2016",ortofotoInfraroig2015:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2015",ortofotoInfraroig2014:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2014",ortofotoInfraroig2013:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2013",ortofotoInfraroig2012:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2012",ortofotoInfraroig2011:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2011",ortofotoInfraroig2010:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2010",ortofotoInfraroig2009:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2009",ortofotoInfraroig2008:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2008",ortofotoInfraroig20062007:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2006-2007",ortofotoInfraroig19961997:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_1996-1997",ortofotoInfraroigSerieAnual:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_serie_anual"},VectorAdmin:{agrupacionsCensals2015:"agrupacions_censals_2015",agrupacionsCensals2016:"agrupacions_censals_2016",agrupacionsCensals2017:"agrupacions_censals_2017",agrupacionsCensals2018:"agrupacions_censals_2018",agrupacionsCensals2019:"agrupacions_censals_2019",agrupacionsCensals2020:"agrupacions_censals_2020",agrupacionsCensals2021:"agrupacions_censals_2021",agrupacionsCensalsVigent:"agrupacions_censals_vigent",agrupacionsCensalsVigentText:"agrupacions_censals_vigent_text",areesBasiquesPolicials2019:"arees_basiques_policials_2019",areesBasiquesPolicials2020:"arees_basiques_policials_2020",areesBasiquesPolicials2022:"arees_basiques_policials_2022",areesBasiquesPolicialsVigent:"arees_basiques_policials_vigent",areesBasiquesPolicialsVigentText:"arees_basiques_policials_vigent_text",areesBasiquesSalutVigent:"arees_basiques_salut_vigent",areesBasiquesServeisSocialsVigent:"arees_basiques_serveis_socials_vigent",areesBasiquesServeisSocialsVigentText:"arees_basiques_serveis_socials_vigent_text",areesGestioAssistencialVigent:"arees_gestio_assistencial_vigent",areesHidrogeologiquesAquifersVigent:"arees_hidrogeologiques_aquifers_vigent",catalunyaVigent:"catalunya_vigent",catalunyaVigentText:"catalunya_vigent_text",comarques2022:"comarques_2022",comarquesVigent:"comarques_vigent",comarquesVigentText:"comarques_vigent_text",districtesCensals2015:"districtes_censals_2015",districtesCensals2016:"districtes_censals_2016",districtesCensals2017:"districtes_censals_2017",districtesCensals2018:"districtes_censals_2018",districtesCensals2019:"districtes_censals_2019",districtesCensals2020:"districtes_censals_2020",districtesCensals2021:"districtes_censals_2021",districtesCensals2022:"districtes_censals_2022",districtesCensalsVigent:"districtes_censals_vigent",districtesCensalsVigentText:"districtes_censals_vigent_text",incendisForestalsVigent:"incendis_forestals_vigent",incendisForestalsVigentText:"incendis_forestals_vigent_text",municipis2022:"municipis_2022",municipis2022Text:"municipis_2022_text",municipisVigent:"municipis_vigent",municipisVigentText:"municipis_vigent_text",partitsJudicialsVigent:"partits_judicials_vigent",partitsJudicialsVigentText:"partits_judicials_vigent_text",plaTerritorial2015:"pla_territorial_2015",plaTerritorialVigent:"pla_territorial_vigent",plaTerritorialVigentText:"pla_territorial_vigent_text",provinciesVigent:"provincies_vigent",provinciesVigentText:"provincies_vigent_text",regionsPolicialsVigent:"regions_policials_vigent",regionsPolicialsVigentText:"regions_policials_vigent_text",regionsSanitariesVigent:"regions_sanitaries_vigent",regionsSanitariesVigentText:"regions_sanitaries_vigent_text",seccionsCensals2015:"seccions_censals_2015",seccionsCensals2016:"seccions_censals_2016",seccionsCensals2017:"seccions_censals_2017",seccionsCensals2018:"seccions_censals_2018",seccionsCensals2019:"seccions_censals_2019",seccionsCensals2020:"seccions_censals_2020",seccionsCensals2021:"seccions_censals_2021",seccionsCensals2022:"seccions_censals_2022",seccionsCensalsVigent:"seccions_censals_vigent",seccionsCensalsVigentText:"seccions_censals_vigent_text",sectorsSanitarisVigent:"sectors_sanitaris_vigent",vegueriesVigent:"vegueries_vigent",vegueriesVigentText:"vegueries_vigent_text"},FGBAdmin:{agrupacionsCensalsVigent:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_vigent.fgb",agrupacionsCensalsVigentText:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_vigent_text.fgb",areesBasiquesPolicialsVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_vigent.fgb",areesBasiquesPolicialsVigentText:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_vigent_text.fgb",areesBasiquesSalutVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_salut_vigent.fgb",areesBasiquesServeisSocialsVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_serveis_socials_vigent.fgb",areesBasiquesServeisSocialsVigentText:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_serveis_socials_vigent_text.fgb",areesGestioAssistencialVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_gestio_assistencial_vigent.fgb",areesHidrogeologiquesAquifersVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_hidrogeologiques_aquifers_vigent.fgb",catalunyaVigent:"https://tilemaps.icgc.cat/vector/fgb/catalunya_vigent.fgb",catalunyaVigentText:"https://tilemaps.icgc.cat/vector/fgb/catalunya_vigent_text.fgb",comarquesVigent:"https://tilemaps.icgc.cat/vector/fgb/comarques_vigent.fgb",comarquesVigentText:"https://tilemaps.icgc.cat/vector/fgb/comarques_vigent_text.fgb",districtesCensalsVigent:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_vigent.fgb",districtesCensalsVigentText:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_vigent_text.fgb",incendisForestalsVigent:"https://tilemaps.icgc.cat/vector/fgb/incendis_forestals_vigent.fgb",incendisForestalsVigentText:"https://tilemaps.icgc.cat/vector/fgb/incendis_forestals_vigent_text.fgb",municipisVigent:"https://tilemaps.icgc.cat/vector/fgb/municipis_vigent.fgb",municipisVigentText:"https://tilemaps.icgc.cat/vector/fgb/municipis_vigent_text.fgb",partitsJudicialsVigent:"https://tilemaps.icgc.cat/vector/fgb/partits_judicials_vigent.fgb",partitsJudicialsVigentText:"https://tilemaps.icgc.cat/vector/fgb/partits_judicials_vigent_text.fgb",plaTerritorialVigent:"https://tilemaps.icgc.cat/vector/fgb/pla_territorial_vigent.fgb",plaTerritorialVigentText:"https://tilemaps.icgc.cat/vector/fgb/pla_territorial_vigent_text.fgb",provinciesVigent:"https://tilemaps.icgc.cat/vector/fgb/provincies_vigent.fgb",provinciesVigentText:"https://tilemaps.icgc.cat/vector/fgb/provincies_vigent_text.fgb",regionsPolicialsVigent:"https://tilemaps.icgc.cat/vector/fgb/regions_policials_vigent.fgb",regionsPolicialsVigentText:"https://tilemaps.icgc.cat/vector/fgb/regions_policials_vigent_text.fgb",regionsSanitariesVigent:"https://tilemaps.icgc.cat/vector/fgb/regions_sanitaries_vigent.fgb",regionsSanitariesVigentText:"https://tilemaps.icgc.cat/vector/fgb/regions_sanitaries_vigent_text.fgb",seccionsCensalsVigent:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_vigent.fgb",seccionsCensalsVigentText:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_vigent_text.fgb",sectorsSanitarisVigent:"https://tilemaps.icgc.cat/vector/fgb/sectors_sanitaris_vigent.fgb",vegueriesVigent:"https://tilemaps.icgc.cat/vector/fgb/vegueries_vigent.fgb",vegueriesVigentText:"https://tilemaps.icgc.cat/vector/fgb/vegueries_vigent_text.fgb"},Vector:{cobertes2018:"https://tilemaps.icgc.cat/tileserver/cobertes_tilejson.json"},WMS:{espaisInteresGeologic:"https://geoserveis.icgc.cat/servei/catalunya/espais-interes-geologic/wms/service?&service=WMS&request=GetMap&layers=espais-interes-geologic&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}",gravimetriaBouguer500000:"https://geoserveis.icgc.cat/servei/catalunya/gravimetria/wms/service?&service=WMS&request=GetMap&layers=anomalia_bouguer_500000&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}",cobertesSol2018:"https://geoserveis.icgc.cat/servei/catalunya/cobertes-sol/wms/service?&service=WMS&request=GetMap&layers=cobertes_2018&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}",administratiu:"http://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/administratiu/MON3857NW/{z}/{x}/{y}.png",simplificat:"http://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/simplificat/MON3857NW/{z}/{x}/{y}.png",cims:"https://geoserveis.icgc.cat/icc_100cims/wms/service?REQUEST=GetMap&SERVICE=WMS&VERSION=1.1.1&LAYERS=0&STYLES=&FORMAT=image/png&BGCOLOR=0xFFFFFF&TRANSPARENT=TRUE&SRS=EPSG:25831&BBOX=137118.923076923,4488408.75,650959.076923077,4749634.75&WIDTH=895&HEIGHT=455",cobertesSol:"http://geoserveis.icgc.cat/servei/catalunya/cobertes-sol/wms?REQUEST=GetMap&SERVICE=WMS&VERSION=1.3.0&LAYERS=cobertes_2009&STYLES=&FORMAT=image/png&BGCOLOR=0xFFFFFF&TRANSPARENT=TRUE&CRS=EPSG:25831&BBOX=374110.828167253,4639230.79853085,452621.120632226,4703578.45000215&WIDTH=1020&HEIGHT=836"}}};class oit{constructor(t){this.options=t||{}}onAdd(t){let e=X2.defaultOptions;return this._map=t,this._img1=document.createElement("img"),this._img1.className="maplibregl-ctrl",this._img1.src=this.options.color?e.logoIcgcOptions.logoUrlColor:e.logoIcgcOptions.logoUrlWhite,this._img1.width=e.logoIcgcOptions.logoWidth,this._img1.title=e.logoIcgcOptions.logoTitle,this.link1=document.createElement("a"),this.link1.href=e.logoIcgcOptions.logoLink,this.link1.target="_blank",this.link1.appendChild(this._img1),this._container1=document.createElement("div"),this._container1.className="maplibregl-ctrl",this._container1.style.width=`${e.logoIcgcOptions.logoWidth}px`,this._container1.appendChild(this.link1),this._img2=document.createElement("img"),this._img2.className="maplibregl-ctrl",this._img2.src=this.options.color?e.logoGencatOptions.logoUrlColor:e.logoGencatOptions.logoUrlWhite,this._img2.width=e.logoGencatOptions.logoWidth,this._img2.title=e.logoGencatOptions.logoTitle,this.link2=document.createElement("a"),this.link2.href=e.logoGencatOptions.logoLink,this.link2.target="_blank",this.link2.appendChild(this._img2),this._container2=document.createElement("div"),this._container2.className="maplibregl-ctrl",this._container2.style.width=`${e.logoGencatOptions.logoWidth}px`,this._container2.appendChild(this.link2),this._mainContainer=document.createElement("div"),this._mainContainer.className="divLogos",this._mainContainer.style="display: flex",this._mainContainer.appendChild(this._container1),this._mainContainer.appendChild(this._container2),this._mainContainer}}class ait{constructor(t){this.options=t||{}}onAdd(t){this._map=t,this._img1=document.createElement("img"),this._img1.src=this.options.name,this._img1.width=150,this._img1.title=300,this.controlContainer=document.createElement("div"),this.controlContainer.classList.add("maplibregl-ctrl"),this.controlContainer.classList.add("maplibregl-ctrl-group"),this.legendContainer=document.createElement("div"),this.legendContainer.classList.add("maplibregl-legend-list"),this.legendButton=document.createElement("button"),this.legendButton.classList.add("maplibregl-ctrl-icon"),this.legendButton.classList.add("maplibregl-legend-switcher"),this.legendButton.addEventListener("click",()=>{this.legendButton.style.display="none",this.legendContainer.style.display="block"}),document.addEventListener("click",this.onDocumentClick),this.controlContainer.appendChild(this.legendButton),this.controlContainer.appendChild(this.legendContainer),this.closeButton=document.createElement("button"),this.closeButton.textContent="x",this.closeButton.classList.add("maplibregl-legend-close-button"),this.closeButton.addEventListener("click",()=>{this.legendButton.style.display="block",this.legendContainer.style.display="none"}),this.legendContainer.appendChild(this.closeButton);const e=document.createElement("label");return e.classList.add("maplibregl-legend-title-label"),e.textContent=this.options.idLayer||"Llegenda",this.legendContainer.appendChild(e),this.legendContainer.appendChild(document.createElement("br")),this.legendContainer.appendChild(this._img1),this.controlContainer}}var Uf=nP.prototype,J2="WGS 84";function nP(r){r!==void 0&&(J2=r),this.setEllipsoid(J2)}Uf.convertLatLngToUtm=function(r,t,e){var n;if(this.status)return"No ecclipsoid data associated with unknown datum: "+J2;if(!Number.isInteger(e))return"Precision is not integer number.";r=parseFloat(r),t=parseFloat(t);var i=t,s=this.toRadians(r),a=this.toRadians(i);i>=8&&i<=13&&r>54.5&&r<58||r>=56&&r<64&&i>=3&&i<12?n=32:(n=(i+180)/6+1,r>=72&&r<84&&(i>=0&&i<9?n=31:i>=9&&i<21?n=33:i>=21&&i<33?n=35:i>=33&&i<42&&(n=37))),n=parseInt(n);var o=(n-1)*6-180+3,A=this.toRadians(o),f=this.getUtmLetterDesignator(r),m=this.eccSquared/(1-this.eccSquared),_=this.a/Math.sqrt(1-this.eccSquared*Math.sin(s)*Math.sin(s)),x=Math.tan(s)*Math.tan(s),B=m*Math.cos(s)*Math.cos(s),P=Math.cos(s)*(a-A),M=this.a*((1-this.eccSquared/4-3*this.eccSquared*this.eccSquared/64-5*this.eccSquared*this.eccSquared*this.eccSquared/256)*s-(3*this.eccSquared/8+3*this.eccSquared*this.eccSquared/32+45*this.eccSquared*this.eccSquared*this.eccSquared/1024)*Math.sin(2*s)+(15*this.eccSquared*this.eccSquared/256+45*this.eccSquared*this.eccSquared*this.eccSquared/1024)*Math.sin(4*s)-35*this.eccSquared*this.eccSquared*this.eccSquared/3072*Math.sin(6*s)),k=parseFloat(.9996*_*(P+(1-x+B)*P*P*P/6+(5-18*x+x*x+72*B-58*m)*P*P*P*P*P/120)+5e5),Q=parseFloat(.9996*(M+_*Math.tan(s)*(P*P/2+(5-x+9*B+4*B*B)*P*P*P*P/24+(61-58*x+x*x+600*B-330*m)*P*P*P*P*P*P/720)));return r<0&&(Q+=1e7),Q=iP(Q,e),k=iP(k,e),{Easting:k,Northing:Q,ZoneNumber:parseInt(n),ZoneLetter:f}},Uf.convertUtmToLatLng=function(r,t,e,n){var i=(1-Math.sqrt(1-this.eccSquared))/(1+Math.sqrt(1-this.eccSquared)),s=r-5e5,a=t,o=e,A=n;if(r===void 0)return"Please pass the UTMEasting!";if(t===void 0)return"Please pass the UTMNorthing!";if(e===void 0)return"Please pass the UTMZoneNumber!";if(n===void 0)return"Please pass the UTMZoneLetter!";["N","P","Q","R","S","T","U","V","W","X","Y","Z"].indexOf(A)!==-1||(a-=1e7);var f=(o-1)*6-180+3,m=this.eccSquared/(1-this.eccSquared),_=a/.9996,x=_/(this.a*(1-this.eccSquared/4-3*this.eccSquared*this.eccSquared/64-5*this.eccSquared*this.eccSquared*this.eccSquared/256)),B=x+(3*i/2-27*i*i*i/32)*Math.sin(2*x)+(21*i*i/16-55*i*i*i*i/32)*Math.sin(4*x)+151*i*i*i/96*Math.sin(6*x);this.toDegrees(B);var P=this.a/Math.sqrt(1-this.eccSquared*Math.sin(B)*Math.sin(B)),M=Math.tan(B)*Math.tan(B),k=m*Math.cos(B)*Math.cos(B),Q=this.a*(1-this.eccSquared)/Math.pow(1-this.eccSquared*Math.sin(B)*Math.sin(B),1.5),q=s/(P*.9996),J=B-P*Math.tan(B)/Q*(q*q/2-(5+3*M+10*k-4*k*k-9*m)*q*q*q*q/24+(61+90*M+298*k+45*M*M-252*m-3*k*k)*q*q*q*q*q*q/720);J=this.toDegrees(J);var tt=(q-(1+2*M+k)*q*q*q/6+(5-2*k+28*M-3*k*k+8*m+24*M*M)*q*q*q*q*q/120)/Math.cos(B);return tt=f+this.toDegrees(tt),{lat:J,lng:tt}},Uf.getUtmLetterDesignator=function(r){return r=parseFloat(r),84>=r&&r>=72?"X":72>r&&r>=64?"W":64>r&&r>=56?"V":56>r&&r>=48?"U":48>r&&r>=40?"T":40>r&&r>=32?"S":32>r&&r>=24?"R":24>r&&r>=16?"Q":16>r&&r>=8?"P":8>r&&r>=0?"N":0>r&&r>=-8?"M":-8>r&&r>=-16?"L":-16>r&&r>=-24?"K":-24>r&&r>=-32?"J":-32>r&&r>=-40?"H":-40>r&&r>=-48?"G":-48>r&&r>=-56?"F":-56>r&&r>=-64?"E":-64>r&&r>=-72?"D":-72>r&&r>=-80?"C":"Z"},Uf.setEllipsoid=function(r){switch(r){case"Airy":this.a=6377563,this.eccSquared=.00667054;break;case"Australian National":this.a=6378160,this.eccSquared=.006694542;break;case"Bessel 1841":this.a=6377397,this.eccSquared=.006674372;break;case"Bessel 1841 Nambia":this.a=6377484,this.eccSquared=.006674372;break;case"Clarke 1866":this.a=6378206,this.eccSquared=.006768658;break;case"Clarke 1880":this.a=6378249,this.eccSquared=.006803511;break;case"Everest":this.a=6377276,this.eccSquared=.006637847;break;case"Fischer 1960 Mercury":this.a=6378166,this.eccSquared=.006693422;break;case"Fischer 1968":this.a=6378150,this.eccSquared=.006693422;break;case"GRS 1967":this.a=6378160,this.eccSquared=.006694605;break;case"GRS 1980":this.a=6378137,this.eccSquared=.00669438;break;case"Helmert 1906":this.a=6378200,this.eccSquared=.006693422;break;case"Hough":this.a=6378270,this.eccSquared=.00672267;break;case"International":this.a=6378388,this.eccSquared=.00672267;break;case"Krassovsky":this.a=6378245,this.eccSquared=.006693422;break;case"Modified Airy":this.a=6377340,this.eccSquared=.00667054;break;case"Modified Everest":this.a=6377304,this.eccSquared=.006637847;break;case"Modified Fischer 1960":this.a=6378155,this.eccSquared=.006693422;break;case"South American 1969":this.a=6378160,this.eccSquared=.006694542;break;case"WGS 60":this.a=6378165,this.eccSquared=.006693422;break;case"WGS 66":this.a=6378145,this.eccSquared=.006694542;break;case"WGS 72":this.a=6378135,this.eccSquared=.006694318;break;case"ED50":this.a=6378388,this.eccSquared=.00672267;break;case"WGS 84":case"EUREF89":case"ETRS89":this.a=6378137,this.eccSquared=.00669438;break;default:this.status=!0}},Uf.toDegrees=function(r){return r/Math.PI*180},Uf.toRadians=function(r){return r*Math.PI/180};function iP(r,t){var e=Math.pow(10,t);return Math.round(r*e)/e}var cit=nP;const lit=Mp(cit);class uit{constructor(t){this.options=t||{},this.options.utm=this.options.hasOwnProperty("utm")?this.options.utm:!0,this.options.lonlat=this.options.hasOwnProperty("lonlat")?this.options.lonlat:!0}onAdd(t){const e=new lit;return this._map=t,this._container=document.createElement("div"),this._container.className="maplibregl-ctrl coordControl",this._container.style.width=`${this.options.width||"225px"}`,this._map.on("mousemove",n=>{const i=n.lngLat.lat,s=n.lngLat.lng;let a="",o="";const A=e.convertLatLngToUtm(i,s,2),f=i>0?"N":"S";this.options.utm&&(a=`ETRS89 UTM ${A.ZoneNumber}${f} X:<b> ${A.Easting}</b> Y:<b> ${A.Northing}</b> <br>`),this.options.lonlat&&(o=`WGS 84 Lon:<b> ${s.toFixed(5)}</b>  Lat:<b> ${i.toFixed(5)}</b>`);const m=`${a}${o}`;this._container.innerHTML=m}),this._container}_lookUTM31(t,e){var n=0,i=0,s=6,a=84;return t>=n&&t<=s&&e>=i&&e<=a}onRemove(){this._container.parentNode.removeChild(this._container),this._map=void 0}}function sP(r,t){return function(){return r.apply(t,arguments)}}const{toString:Ait}=Object.prototype,{getPrototypeOf:Y2}=Object,Dy=(r=>t=>{const e=Ait.call(t);return r[e]||(r[e]=e.slice(8,-1).toLowerCase())})(Object.create(null)),Yl=r=>(r=r.toLowerCase(),t=>Dy(t)===r),Ny=r=>t=>typeof t===r,{isArray:Rf}=Array,kg=Ny("undefined");function hit(r){return r!==null&&!kg(r)&&r.constructor!==null&&!kg(r.constructor)&&uc(r.constructor.isBuffer)&&r.constructor.isBuffer(r)}const oP=Yl("ArrayBuffer");function dit(r){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(r):t=r&&r.buffer&&oP(r.buffer),t}const fit=Ny("string"),uc=Ny("function"),aP=Ny("number"),ky=r=>r!==null&&typeof r=="object",pit=r=>r===!0||r===!1,Qy=r=>{if(Dy(r)!=="object")return!1;const t=Y2(r);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)},git=Yl("Date"),mit=Yl("File"),yit=Yl("Blob"),_it=Yl("FileList"),vit=r=>ky(r)&&uc(r.pipe),bit=r=>{let t;return r&&(typeof FormData=="function"&&r instanceof FormData||uc(r.append)&&((t=Dy(r))==="formdata"||t==="object"&&uc(r.toString)&&r.toString()==="[object FormData]"))},wit=Yl("URLSearchParams"),xit=r=>r.trim?r.trim():r.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Qg(r,t){let{allOwnKeys:e=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(r===null||typeof r>"u")return;let n,i;if(typeof r!="object"&&(r=[r]),Rf(r))for(n=0,i=r.length;n<i;n++)t.call(null,r[n],n,r);else{const s=e?Object.getOwnPropertyNames(r):Object.keys(r),a=s.length;let o;for(n=0;n<a;n++)o=s[n],t.call(null,r[o],o,r)}}function cP(r,t){t=t.toLowerCase();const e=Object.keys(r);let n=e.length,i;for(;n-- >0;)if(i=e[n],t===i.toLowerCase())return i;return null}const lP=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,uP=r=>!kg(r)&&r!==lP;function Z2(){const{caseless:r}=uP(this)&&this||{},t={},e=(n,i)=>{const s=r&&cP(t,i)||i;Qy(t[s])&&Qy(n)?t[s]=Z2(t[s],n):Qy(n)?t[s]=Z2({},n):Rf(n)?t[s]=n.slice():t[s]=n};for(let n=0,i=arguments.length;n<i;n++)arguments[n]&&Qg(arguments[n],e);return t}const Bit=function(r,t,e){let{allOwnKeys:n}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return Qg(t,(i,s)=>{e&&uc(i)?r[s]=sP(i,e):r[s]=i},{allOwnKeys:n}),r},Cit=r=>(r.charCodeAt(0)===65279&&(r=r.slice(1)),r),Eit=(r,t,e,n)=>{r.prototype=Object.create(t.prototype,n),r.prototype.constructor=r,Object.defineProperty(r,"super",{value:t.prototype}),e&&Object.assign(r.prototype,e)},Sit=(r,t,e,n)=>{let i,s,a;const o={};if(t=t||{},r==null)return t;do{for(i=Object.getOwnPropertyNames(r),s=i.length;s-- >0;)a=i[s],(!n||n(a,r,t))&&!o[a]&&(t[a]=r[a],o[a]=!0);r=e!==!1&&Y2(r)}while(r&&(!e||e(r,t))&&r!==Object.prototype);return t},Tit=(r,t,e)=>{r=String(r),(e===void 0||e>r.length)&&(e=r.length),e-=t.length;const n=r.indexOf(t,e);return n!==-1&&n===e},Iit=r=>{if(!r)return null;if(Rf(r))return r;let t=r.length;if(!aP(t))return null;const e=new Array(t);for(;t-- >0;)e[t]=r[t];return e},Lit=(r=>t=>r&&t instanceof r)(typeof Uint8Array<"u"&&Y2(Uint8Array)),Fit=(r,t)=>{const n=(r&&r[Symbol.iterator]).call(r);let i;for(;(i=n.next())&&!i.done;){const s=i.value;t.call(r,s[0],s[1])}},Pit=(r,t)=>{let e;const n=[];for(;(e=r.exec(t))!==null;)n.push(e);return n},Mit=Yl("HTMLFormElement"),Uit=r=>r.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,n,i){return n.toUpperCase()+i}),AP=(r=>{let{hasOwnProperty:t}=r;return(e,n)=>t.call(e,n)})(Object.prototype),Rit=Yl("RegExp"),hP=(r,t)=>{const e=Object.getOwnPropertyDescriptors(r),n={};Qg(e,(i,s)=>{let a;(a=t(i,s,r))!==!1&&(n[s]=a||i)}),Object.defineProperties(r,n)},Oit=r=>{hP(r,(t,e)=>{if(uc(r)&&["arguments","caller","callee"].indexOf(e)!==-1)return!1;const n=r[e];if(uc(n)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+e+"'")})}})},Dit=(r,t)=>{const e={},n=i=>{i.forEach(s=>{e[s]=!0})};return Rf(r)?n(r):n(String(r).split(t)),e},Nit=()=>{},kit=(r,t)=>(r=+r,Number.isFinite(r)?r:t),tx="abcdefghijklmnopqrstuvwxyz",dP="0123456789",fP={DIGIT:dP,ALPHA:tx,ALPHA_DIGIT:tx+tx.toUpperCase()+dP},Qit=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:fP.ALPHA_DIGIT,e="";const{length:n}=t;for(;r--;)e+=t[Math.random()*n|0];return e};function Hit(r){return!!(r&&uc(r.append)&&r[Symbol.toStringTag]==="FormData"&&r[Symbol.iterator])}const zit=r=>{const t=new Array(10),e=(n,i)=>{if(ky(n)){if(t.indexOf(n)>=0)return;if(!("toJSON"in n)){t[i]=n;const s=Rf(n)?[]:{};return Qg(n,(a,o)=>{const A=e(a,i+1);!kg(A)&&(s[o]=A)}),t[i]=void 0,s}}return n};return e(r,0)},Git=Yl("AsyncFunction"),Ee={isArray:Rf,isArrayBuffer:oP,isBuffer:hit,isFormData:bit,isArrayBufferView:dit,isString:fit,isNumber:aP,isBoolean:pit,isObject:ky,isPlainObject:Qy,isUndefined:kg,isDate:git,isFile:mit,isBlob:yit,isRegExp:Rit,isFunction:uc,isStream:vit,isURLSearchParams:wit,isTypedArray:Lit,isFileList:_it,forEach:Qg,merge:Z2,extend:Bit,trim:xit,stripBOM:Cit,inherits:Eit,toFlatObject:Sit,kindOf:Dy,kindOfTest:Yl,endsWith:Tit,toArray:Iit,forEachEntry:Fit,matchAll:Pit,isHTMLForm:Mit,hasOwnProperty:AP,hasOwnProp:AP,reduceDescriptors:hP,freezeMethods:Oit,toObjectSet:Dit,toCamelCase:Uit,noop:Nit,toFiniteNumber:kit,findKey:cP,global:lP,isContextDefined:uP,ALPHABET:fP,generateString:Qit,isSpecCompliantForm:Hit,toJSONObject:zit,isAsyncFn:Git,isThenable:r=>r&&(ky(r)||uc(r))&&uc(r.then)&&uc(r.catch)};function Mn(r,t,e,n,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=r,this.name="AxiosError",t&&(this.code=t),e&&(this.config=e),n&&(this.request=n),i&&(this.response=i)}Ee.inherits(Mn,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Ee.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const pP=Mn.prototype,gP={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(r=>{gP[r]={value:r}}),Object.defineProperties(Mn,gP),Object.defineProperty(pP,"isAxiosError",{value:!0}),Mn.from=(r,t,e,n,i,s)=>{const a=Object.create(pP);return Ee.toFlatObject(r,a,function(A){return A!==Error.prototype},o=>o!=="isAxiosError"),Mn.call(a,r.message,t,e,n,i),a.cause=r,a.name=r.name,s&&Object.assign(a,s),a};const Vit=null;function ex(r){return Ee.isPlainObject(r)||Ee.isArray(r)}function mP(r){return Ee.endsWith(r,"[]")?r.slice(0,-2):r}function yP(r,t,e){return r?r.concat(t).map(function(i,s){return i=mP(i),!e&&s?"["+i+"]":i}).join(e?".":""):t}function jit(r){return Ee.isArray(r)&&!r.some(ex)}const qit=Ee.toFlatObject(Ee,{},null,function(t){return/^is[A-Z]/.test(t)});function Hy(r,t,e){if(!Ee.isObject(r))throw new TypeError("target must be an object");t=t||new FormData,e=Ee.toFlatObject(e,{metaTokens:!0,dots:!1,indexes:!1},!1,function(M,k){return!Ee.isUndefined(k[M])});const n=e.metaTokens,i=e.visitor||m,s=e.dots,a=e.indexes,A=(e.Blob||typeof Blob<"u"&&Blob)&&Ee.isSpecCompliantForm(t);if(!Ee.isFunction(i))throw new TypeError("visitor must be a function");function f(P){if(P===null)return"";if(Ee.isDate(P))return P.toISOString();if(!A&&Ee.isBlob(P))throw new Mn("Blob is not supported. Use a Buffer instead.");return Ee.isArrayBuffer(P)||Ee.isTypedArray(P)?A&&typeof Blob=="function"?new Blob([P]):Buffer.from(P):P}function m(P,M,k){let Q=P;if(P&&!k&&typeof P=="object"){if(Ee.endsWith(M,"{}"))M=n?M:M.slice(0,-2),P=JSON.stringify(P);else if(Ee.isArray(P)&&jit(P)||(Ee.isFileList(P)||Ee.endsWith(M,"[]"))&&(Q=Ee.toArray(P)))return M=mP(M),Q.forEach(function(J,tt){!(Ee.isUndefined(J)||J===null)&&t.append(a===!0?yP([M],tt,s):a===null?M:M+"[]",f(J))}),!1}return ex(P)?!0:(t.append(yP(k,M,s),f(P)),!1)}const _=[],x=Object.assign(qit,{defaultVisitor:m,convertValue:f,isVisitable:ex});function B(P,M){if(!Ee.isUndefined(P)){if(_.indexOf(P)!==-1)throw Error("Circular reference detected in "+M.join("."));_.push(P),Ee.forEach(P,function(Q,q){(!(Ee.isUndefined(Q)||Q===null)&&i.call(t,Q,Ee.isString(q)?q.trim():q,M,x))===!0&&B(Q,M?M.concat(q):[q])}),_.pop()}}if(!Ee.isObject(r))throw new TypeError("data must be an object");return B(r),t}function _P(r){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(r).replace(/[!'()~]|%20|%00/g,function(n){return t[n]})}function rx(r,t){this._pairs=[],r&&Hy(r,this,t)}const vP=rx.prototype;vP.append=function(t,e){this._pairs.push([t,e])},vP.toString=function(t){const e=t?function(n){return t.call(this,n,_P)}:_P;return this._pairs.map(function(i){return e(i[0])+"="+e(i[1])},"").join("&")};function Kit(r){return encodeURIComponent(r).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function bP(r,t,e){if(!t)return r;const n=e&&e.encode||Kit,i=e&&e.serialize;let s;if(i?s=i(t,e):s=Ee.isURLSearchParams(t)?t.toString():new rx(t,e).toString(n),s){const a=r.indexOf("#");a!==-1&&(r=r.slice(0,a)),r+=(r.indexOf("?")===-1?"?":"&")+s}return r}class wP{constructor(){this.handlers=[]}use(t,e,n){return this.handlers.push({fulfilled:t,rejected:e,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){Ee.forEach(this.handlers,function(n){n!==null&&t(n)})}}const xP={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},$it={isBrowser:!0,classes:{URLSearchParams:typeof URLSearchParams<"u"?URLSearchParams:rx,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]},BP=typeof window<"u"&&typeof document<"u",Wit=(r=>BP&&["ReactNative","NativeScript","NS"].indexOf(r)<0)(typeof navigator<"u"&&navigator.product),Xit=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Zl={...Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:BP,hasStandardBrowserEnv:Wit,hasStandardBrowserWebWorkerEnv:Xit},Symbol.toStringTag,{value:"Module"})),...$it};function Jit(r,t){return Hy(r,new Zl.classes.URLSearchParams,Object.assign({visitor:function(e,n,i,s){return Zl.isNode&&Ee.isBuffer(e)?(this.append(n,e.toString("base64")),!1):s.defaultVisitor.apply(this,arguments)}},t))}function Yit(r){return Ee.matchAll(/\w+|\[(\w*)]/g,r).map(t=>t[0]==="[]"?"":t[1]||t[0])}function Zit(r){const t={},e=Object.keys(r);let n;const i=e.length;let s;for(n=0;n<i;n++)s=e[n],t[s]=r[s];return t}function CP(r){function t(e,n,i,s){let a=e[s++];if(a==="__proto__")return!0;const o=Number.isFinite(+a),A=s>=e.length;return a=!a&&Ee.isArray(i)?i.length:a,A?(Ee.hasOwnProp(i,a)?i[a]=[i[a],n]:i[a]=n,!o):((!i[a]||!Ee.isObject(i[a]))&&(i[a]=[]),t(e,n,i[a],s)&&Ee.isArray(i[a])&&(i[a]=Zit(i[a])),!o)}if(Ee.isFormData(r)&&Ee.isFunction(r.entries)){const e={};return Ee.forEachEntry(r,(n,i)=>{t(Yit(n),i,e,0)}),e}return null}function tst(r,t,e){if(Ee.isString(r))try{return(t||JSON.parse)(r),Ee.trim(r)}catch(n){if(n.name!=="SyntaxError")throw n}return(e||JSON.stringify)(r)}const nx={transitional:xP,adapter:["xhr","http"],transformRequest:[function(t,e){const n=e.getContentType()||"",i=n.indexOf("application/json")>-1,s=Ee.isObject(t);if(s&&Ee.isHTMLForm(t)&&(t=new FormData(t)),Ee.isFormData(t))return i?JSON.stringify(CP(t)):t;if(Ee.isArrayBuffer(t)||Ee.isBuffer(t)||Ee.isStream(t)||Ee.isFile(t)||Ee.isBlob(t))return t;if(Ee.isArrayBufferView(t))return t.buffer;if(Ee.isURLSearchParams(t))return e.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let o;if(s){if(n.indexOf("application/x-www-form-urlencoded")>-1)return Jit(t,this.formSerializer).toString();if((o=Ee.isFileList(t))||n.indexOf("multipart/form-data")>-1){const A=this.env&&this.env.FormData;return Hy(o?{"files[]":t}:t,A&&new A,this.formSerializer)}}return s||i?(e.setContentType("application/json",!1),tst(t)):t}],transformResponse:[function(t){const e=this.transitional||nx.transitional,n=e&&e.forcedJSONParsing,i=this.responseType==="json";if(t&&Ee.isString(t)&&(n&&!this.responseType||i)){const a=!(e&&e.silentJSONParsing)&&i;try{return JSON.parse(t)}catch(o){if(a)throw o.name==="SyntaxError"?Mn.from(o,Mn.ERR_BAD_RESPONSE,this,null,this.response):o}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Zl.classes.FormData,Blob:Zl.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Ee.forEach(["delete","get","head","post","put","patch"],r=>{nx.headers[r]={}});const ix=nx,est=Ee.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),rst=r=>{const t={};let e,n,i;return r&&r.split(`
`).forEach(function(a){i=a.indexOf(":"),e=a.substring(0,i).trim().toLowerCase(),n=a.substring(i+1).trim(),!(!e||t[e]&&est[e])&&(e==="set-cookie"?t[e]?t[e].push(n):t[e]=[n]:t[e]=t[e]?t[e]+", "+n:n)}),t},EP=Symbol("internals");function Hg(r){return r&&String(r).trim().toLowerCase()}function zy(r){return r===!1||r==null?r:Ee.isArray(r)?r.map(zy):String(r)}function nst(r){const t=Object.create(null),e=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=e.exec(r);)t[n[1]]=n[2];return t}const ist=r=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(r.trim());function sx(r,t,e,n,i){if(Ee.isFunction(n))return n.call(this,t,e);if(i&&(t=e),!!Ee.isString(t)){if(Ee.isString(n))return t.indexOf(n)!==-1;if(Ee.isRegExp(n))return n.test(t)}}function sst(r){return r.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,e,n)=>e.toUpperCase()+n)}function ost(r,t){const e=Ee.toCamelCase(" "+t);["get","set","has"].forEach(n=>{Object.defineProperty(r,n+e,{value:function(i,s,a){return this[n].call(this,t,i,s,a)},configurable:!0})})}class Gy{constructor(t){t&&this.set(t)}set(t,e,n){const i=this;function s(o,A,f){const m=Hg(A);if(!m)throw new Error("header name must be a non-empty string");const _=Ee.findKey(i,m);(!_||i[_]===void 0||f===!0||f===void 0&&i[_]!==!1)&&(i[_||A]=zy(o))}const a=(o,A)=>Ee.forEach(o,(f,m)=>s(f,m,A));return Ee.isPlainObject(t)||t instanceof this.constructor?a(t,e):Ee.isString(t)&&(t=t.trim())&&!ist(t)?a(rst(t),e):t!=null&&s(e,t,n),this}get(t,e){if(t=Hg(t),t){const n=Ee.findKey(this,t);if(n){const i=this[n];if(!e)return i;if(e===!0)return nst(i);if(Ee.isFunction(e))return e.call(this,i,n);if(Ee.isRegExp(e))return e.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,e){if(t=Hg(t),t){const n=Ee.findKey(this,t);return!!(n&&this[n]!==void 0&&(!e||sx(this,this[n],n,e)))}return!1}delete(t,e){const n=this;let i=!1;function s(a){if(a=Hg(a),a){const o=Ee.findKey(n,a);o&&(!e||sx(n,n[o],o,e))&&(delete n[o],i=!0)}}return Ee.isArray(t)?t.forEach(s):s(t),i}clear(t){const e=Object.keys(this);let n=e.length,i=!1;for(;n--;){const s=e[n];(!t||sx(this,this[s],s,t,!0))&&(delete this[s],i=!0)}return i}normalize(t){const e=this,n={};return Ee.forEach(this,(i,s)=>{const a=Ee.findKey(n,s);if(a){e[a]=zy(i),delete e[s];return}const o=t?sst(s):String(s).trim();o!==s&&delete e[s],e[o]=zy(i),n[o]=!0}),this}concat(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.constructor.concat(this,...e)}toJSON(t){const e=Object.create(null);return Ee.forEach(this,(n,i)=>{n!=null&&n!==!1&&(e[i]=t&&Ee.isArray(n)?n.join(", "):n)}),e}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(t=>{let[e,n]=t;return e+": "+n}).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t){const e=new this(t);for(var n=arguments.length,i=new Array(n>1?n-1:0),s=1;s<n;s++)i[s-1]=arguments[s];return i.forEach(a=>e.set(a)),e}static accessor(t){const n=(this[EP]=this[EP]={accessors:{}}).accessors,i=this.prototype;function s(a){const o=Hg(a);n[o]||(ost(i,a),n[o]=!0)}return Ee.isArray(t)?t.forEach(s):s(t),this}}Gy.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),Ee.reduceDescriptors(Gy.prototype,(r,t)=>{let{value:e}=r,n=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(i){this[n]=i}}}),Ee.freezeMethods(Gy);const Hu=Gy;function ox(r,t){const e=this||ix,n=t||e,i=Hu.from(n.headers);let s=n.data;return Ee.forEach(r,function(o){s=o.call(e,s,i.normalize(),t?t.status:void 0)}),i.normalize(),s}function SP(r){return!!(r&&r.__CANCEL__)}function zg(r,t,e){Mn.call(this,r??"canceled",Mn.ERR_CANCELED,t,e),this.name="CanceledError"}Ee.inherits(zg,Mn,{__CANCEL__:!0});function ast(r,t,e){const n=e.config.validateStatus;!e.status||!n||n(e.status)?r(e):t(new Mn("Request failed with status code "+e.status,[Mn.ERR_BAD_REQUEST,Mn.ERR_BAD_RESPONSE][Math.floor(e.status/100)-4],e.config,e.request,e))}const cst=Zl.hasStandardBrowserEnv?{write(r,t,e,n,i,s){const a=[r+"="+encodeURIComponent(t)];Ee.isNumber(e)&&a.push("expires="+new Date(e).toGMTString()),Ee.isString(n)&&a.push("path="+n),Ee.isString(i)&&a.push("domain="+i),s===!0&&a.push("secure"),document.cookie=a.join("; ")},read(r){const t=document.cookie.match(new RegExp("(^|;\\s*)("+r+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(r){this.write(r,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function lst(r){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(r)}function ust(r,t){return t?r.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):r}function TP(r,t){return r&&!lst(t)?ust(r,t):t}const Ast=Zl.hasStandardBrowserEnv?function(){const t=/(msie|trident)/i.test(navigator.userAgent),e=document.createElement("a");let n;function i(s){let a=s;return t&&(e.setAttribute("href",a),a=e.href),e.setAttribute("href",a),{href:e.href,protocol:e.protocol?e.protocol.replace(/:$/,""):"",host:e.host,search:e.search?e.search.replace(/^\?/,""):"",hash:e.hash?e.hash.replace(/^#/,""):"",hostname:e.hostname,port:e.port,pathname:e.pathname.charAt(0)==="/"?e.pathname:"/"+e.pathname}}return n=i(window.location.href),function(a){const o=Ee.isString(a)?i(a):a;return o.protocol===n.protocol&&o.host===n.host}}():function(){return function(){return!0}}();function hst(r){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(r);return t&&t[1]||""}function dst(r,t){r=r||10;const e=new Array(r),n=new Array(r);let i=0,s=0,a;return t=t!==void 0?t:1e3,function(A){const f=Date.now(),m=n[s];a||(a=f),e[i]=A,n[i]=f;let _=s,x=0;for(;_!==i;)x+=e[_++],_=_%r;if(i=(i+1)%r,i===s&&(s=(s+1)%r),f-a<t)return;const B=m&&f-m;return B?Math.round(x*1e3/B):void 0}}function IP(r,t){let e=0;const n=dst(50,250);return i=>{const s=i.loaded,a=i.lengthComputable?i.total:void 0,o=s-e,A=n(o),f=s<=a;e=s;const m={loaded:s,total:a,progress:a?s/a:void 0,bytes:o,rate:A||void 0,estimated:A&&a&&f?(a-s)/A:void 0,event:i};m[t?"download":"upload"]=!0,r(m)}}const ax={http:Vit,xhr:typeof XMLHttpRequest<"u"&&function(r){return new Promise(function(e,n){let i=r.data;const s=Hu.from(r.headers).normalize();let{responseType:a,withXSRFToken:o}=r,A;function f(){r.cancelToken&&r.cancelToken.unsubscribe(A),r.signal&&r.signal.removeEventListener("abort",A)}let m;if(Ee.isFormData(i)){if(Zl.hasStandardBrowserEnv||Zl.hasStandardBrowserWebWorkerEnv)s.setContentType(!1);else if((m=s.getContentType())!==!1){const[M,...k]=m?m.split(";").map(Q=>Q.trim()).filter(Boolean):[];s.setContentType([M||"multipart/form-data",...k].join("; "))}}let _=new XMLHttpRequest;if(r.auth){const M=r.auth.username||"",k=r.auth.password?unescape(encodeURIComponent(r.auth.password)):"";s.set("Authorization","Basic "+btoa(M+":"+k))}const x=TP(r.baseURL,r.url);_.open(r.method.toUpperCase(),bP(x,r.params,r.paramsSerializer),!0),_.timeout=r.timeout;function B(){if(!_)return;const M=Hu.from("getAllResponseHeaders"in _&&_.getAllResponseHeaders()),Q={data:!a||a==="text"||a==="json"?_.responseText:_.response,status:_.status,statusText:_.statusText,headers:M,config:r,request:_};ast(function(J){e(J),f()},function(J){n(J),f()},Q),_=null}if("onloadend"in _?_.onloadend=B:_.onreadystatechange=function(){!_||_.readyState!==4||_.status===0&&!(_.responseURL&&_.responseURL.indexOf("file:")===0)||setTimeout(B)},_.onabort=function(){_&&(n(new Mn("Request aborted",Mn.ECONNABORTED,r,_)),_=null)},_.onerror=function(){n(new Mn("Network Error",Mn.ERR_NETWORK,r,_)),_=null},_.ontimeout=function(){let k=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const Q=r.transitional||xP;r.timeoutErrorMessage&&(k=r.timeoutErrorMessage),n(new Mn(k,Q.clarifyTimeoutError?Mn.ETIMEDOUT:Mn.ECONNABORTED,r,_)),_=null},Zl.hasStandardBrowserEnv&&(o&&Ee.isFunction(o)&&(o=o(r)),o||o!==!1&&Ast(x))){const M=r.xsrfHeaderName&&r.xsrfCookieName&&cst.read(r.xsrfCookieName);M&&s.set(r.xsrfHeaderName,M)}i===void 0&&s.setContentType(null),"setRequestHeader"in _&&Ee.forEach(s.toJSON(),function(k,Q){_.setRequestHeader(Q,k)}),Ee.isUndefined(r.withCredentials)||(_.withCredentials=!!r.withCredentials),a&&a!=="json"&&(_.responseType=r.responseType),typeof r.onDownloadProgress=="function"&&_.addEventListener("progress",IP(r.onDownloadProgress,!0)),typeof r.onUploadProgress=="function"&&_.upload&&_.upload.addEventListener("progress",IP(r.onUploadProgress)),(r.cancelToken||r.signal)&&(A=M=>{_&&(n(!M||M.type?new zg(null,r,_):M),_.abort(),_=null)},r.cancelToken&&r.cancelToken.subscribe(A),r.signal&&(r.signal.aborted?A():r.signal.addEventListener("abort",A)));const P=hst(x);if(P&&Zl.protocols.indexOf(P)===-1){n(new Mn("Unsupported protocol "+P+":",Mn.ERR_BAD_REQUEST,r));return}_.send(i||null)})}};Ee.forEach(ax,(r,t)=>{if(r){try{Object.defineProperty(r,"name",{value:t})}catch{}Object.defineProperty(r,"adapterName",{value:t})}});const LP=r=>`- ${r}`,fst=r=>Ee.isFunction(r)||r===null||r===!1,FP={getAdapter:r=>{r=Ee.isArray(r)?r:[r];const{length:t}=r;let e,n;const i={};for(let s=0;s<t;s++){e=r[s];let a;if(n=e,!fst(e)&&(n=ax[(a=String(e)).toLowerCase()],n===void 0))throw new Mn(`Unknown adapter '${a}'`);if(n)break;i[a||"#"+s]=n}if(!n){const s=Object.entries(i).map(o=>{let[A,f]=o;return`adapter ${A} `+(f===!1?"is not supported by the environment":"is not available in the build")});let a=t?s.length>1?`since :
`+s.map(LP).join(`
`):" "+LP(s[0]):"as no adapter specified";throw new Mn("There is no suitable adapter to dispatch the request "+a,"ERR_NOT_SUPPORT")}return n},adapters:ax};function cx(r){if(r.cancelToken&&r.cancelToken.throwIfRequested(),r.signal&&r.signal.aborted)throw new zg(null,r)}function PP(r){return cx(r),r.headers=Hu.from(r.headers),r.data=ox.call(r,r.transformRequest),["post","put","patch"].indexOf(r.method)!==-1&&r.headers.setContentType("application/x-www-form-urlencoded",!1),FP.getAdapter(r.adapter||ix.adapter)(r).then(function(n){return cx(r),n.data=ox.call(r,r.transformResponse,n),n.headers=Hu.from(n.headers),n},function(n){return SP(n)||(cx(r),n&&n.response&&(n.response.data=ox.call(r,r.transformResponse,n.response),n.response.headers=Hu.from(n.response.headers))),Promise.reject(n)})}const MP=r=>r instanceof Hu?r.toJSON():r;function Of(r,t){t=t||{};const e={};function n(f,m,_){return Ee.isPlainObject(f)&&Ee.isPlainObject(m)?Ee.merge.call({caseless:_},f,m):Ee.isPlainObject(m)?Ee.merge({},m):Ee.isArray(m)?m.slice():m}function i(f,m,_){if(Ee.isUndefined(m)){if(!Ee.isUndefined(f))return n(void 0,f,_)}else return n(f,m,_)}function s(f,m){if(!Ee.isUndefined(m))return n(void 0,m)}function a(f,m){if(Ee.isUndefined(m)){if(!Ee.isUndefined(f))return n(void 0,f)}else return n(void 0,m)}function o(f,m,_){if(_ in t)return n(f,m);if(_ in r)return n(void 0,f)}const A={url:s,method:s,data:s,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:o,headers:(f,m)=>i(MP(f),MP(m),!0)};return Ee.forEach(Object.keys(Object.assign({},r,t)),function(m){const _=A[m]||i,x=_(r[m],t[m],m);Ee.isUndefined(x)&&_!==o||(e[m]=x)}),e}const UP="1.6.7",lx={};["object","boolean","number","function","string","symbol"].forEach((r,t)=>{lx[r]=function(n){return typeof n===r||"a"+(t<1?"n ":" ")+r}});const RP={};lx.transitional=function(t,e,n){function i(s,a){return"[Axios v"+UP+"] Transitional option '"+s+"'"+a+(n?". "+n:"")}return(s,a,o)=>{if(t===!1)throw new Mn(i(a," has been removed"+(e?" in "+e:"")),Mn.ERR_DEPRECATED);return e&&!RP[a]&&(RP[a]=!0,console.warn(i(a," has been deprecated since v"+e+" and will be removed in the near future"))),t?t(s,a,o):!0}};function pst(r,t,e){if(typeof r!="object")throw new Mn("options must be an object",Mn.ERR_BAD_OPTION_VALUE);const n=Object.keys(r);let i=n.length;for(;i-- >0;){const s=n[i],a=t[s];if(a){const o=r[s],A=o===void 0||a(o,s,r);if(A!==!0)throw new Mn("option "+s+" must be "+A,Mn.ERR_BAD_OPTION_VALUE);continue}if(e!==!0)throw new Mn("Unknown option "+s,Mn.ERR_BAD_OPTION)}}const ux={assertOptions:pst,validators:lx},qA=ux.validators;class Vy{constructor(t){this.defaults=t,this.interceptors={request:new wP,response:new wP}}async request(t,e){try{return await this._request(t,e)}catch(n){if(n instanceof Error){let i;Error.captureStackTrace?Error.captureStackTrace(i={}):i=new Error;const s=i.stack?i.stack.replace(/^.+\n/,""):"";n.stack?s&&!String(n.stack).endsWith(s.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+s):n.stack=s}throw n}}_request(t,e){typeof t=="string"?(e=e||{},e.url=t):e=t||{},e=Of(this.defaults,e);const{transitional:n,paramsSerializer:i,headers:s}=e;n!==void 0&&ux.assertOptions(n,{silentJSONParsing:qA.transitional(qA.boolean),forcedJSONParsing:qA.transitional(qA.boolean),clarifyTimeoutError:qA.transitional(qA.boolean)},!1),i!=null&&(Ee.isFunction(i)?e.paramsSerializer={serialize:i}:ux.assertOptions(i,{encode:qA.function,serialize:qA.function},!0)),e.method=(e.method||this.defaults.method||"get").toLowerCase();let a=s&&Ee.merge(s.common,s[e.method]);s&&Ee.forEach(["delete","get","head","post","put","patch","common"],P=>{delete s[P]}),e.headers=Hu.concat(a,s);const o=[];let A=!0;this.interceptors.request.forEach(function(M){typeof M.runWhen=="function"&&M.runWhen(e)===!1||(A=A&&M.synchronous,o.unshift(M.fulfilled,M.rejected))});const f=[];this.interceptors.response.forEach(function(M){f.push(M.fulfilled,M.rejected)});let m,_=0,x;if(!A){const P=[PP.bind(this),void 0];for(P.unshift.apply(P,o),P.push.apply(P,f),x=P.length,m=Promise.resolve(e);_<x;)m=m.then(P[_++],P[_++]);return m}x=o.length;let B=e;for(_=0;_<x;){const P=o[_++],M=o[_++];try{B=P(B)}catch(k){M.call(this,k);break}}try{m=PP.call(this,B)}catch(P){return Promise.reject(P)}for(_=0,x=f.length;_<x;)m=m.then(f[_++],f[_++]);return m}getUri(t){t=Of(this.defaults,t);const e=TP(t.baseURL,t.url);return bP(e,t.params,t.paramsSerializer)}}Ee.forEach(["delete","get","head","options"],function(t){Vy.prototype[t]=function(e,n){return this.request(Of(n||{},{method:t,url:e,data:(n||{}).data}))}}),Ee.forEach(["post","put","patch"],function(t){function e(n){return function(s,a,o){return this.request(Of(o||{},{method:t,headers:n?{"Content-Type":"multipart/form-data"}:{},url:s,data:a}))}}Vy.prototype[t]=e(),Vy.prototype[t+"Form"]=e(!0)});const jy=Vy;class Ax{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let e;this.promise=new Promise(function(s){e=s});const n=this;this.promise.then(i=>{if(!n._listeners)return;let s=n._listeners.length;for(;s-- >0;)n._listeners[s](i);n._listeners=null}),this.promise.then=i=>{let s;const a=new Promise(o=>{n.subscribe(o),s=o}).then(i);return a.cancel=function(){n.unsubscribe(s)},a},t(function(s,a,o){n.reason||(n.reason=new zg(s,a,o),e(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const e=this._listeners.indexOf(t);e!==-1&&this._listeners.splice(e,1)}static source(){let t;return{token:new Ax(function(i){t=i}),cancel:t}}}const gst=Ax;function mst(r){return function(e){return r.apply(null,e)}}function yst(r){return Ee.isObject(r)&&r.isAxiosError===!0}const hx={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(hx).forEach(r=>{let[t,e]=r;hx[e]=t});const _st=hx;function OP(r){const t=new jy(r),e=sP(jy.prototype.request,t);return Ee.extend(e,jy.prototype,t,{allOwnKeys:!0}),Ee.extend(e,t,null,{allOwnKeys:!0}),e.create=function(i){return OP(Of(r,i))},e}const ys=OP(ix);ys.Axios=jy,ys.CanceledError=zg,ys.CancelToken=gst,ys.isCancel=SP,ys.VERSION=UP,ys.toFormData=Hy,ys.AxiosError=Mn,ys.Cancel=ys.CanceledError,ys.all=function(t){return Promise.all(t)},ys.spread=mst,ys.isAxiosError=yst,ys.mergeConfig=Of,ys.AxiosHeaders=Hu,ys.formToJSON=r=>CP(Ee.isHTMLForm(r)?new FormData(r):r),ys.getAdapter=FP.getAdapter,ys.HttpStatusCode=_st,ys.default=ys;const vst="https://tilemaps.icgc.cat/cdn/configs/mapicgc-config.json",bst=5e3;async function wst(){try{const r=await ys.get(vst,{timeout:bst});return r.data?r.data:(console.log("Resposta sense dades:",r),X2)}catch(r){return r.response?(console.error("Error de resposta:",r.response.data),console.error("Codi d'estat:",r.response.status)):r.request?console.error("No s'ha rebut resposta del servidor:",r.request):console.error("Error:",r.message),X2}}const DP=wst(),xst={cobertesSol:{"fill-opacity":["interpolate",["exponential",.5],["zoom"],13.5,1,18,.4],"fill-outline-color":"rgba(0,0, 0, 0)","fill-color":["interpolate",["cubic-bezier",.5,1,1,1],["get","nivell_2"],0,"#ffffff",111,"#ffff00",112,"#ccff33",113,"#af5b15",114,"#808000",115,"#cdcd00",116,"#ffffcc",221,"#33cc33",222,"#66ff33",223,"#689018",224,"#967d5f",225,"#19e61e",226,"#b4ff9b",227,"#aaa500",228,"#c3c3a0",229,"#00ff9b",230,"#ff9632",231,"#282828",232,"#79797a",233,"#f5df78",234,"#3296ff",341,"#ff007d",342,"#ff53cd",343,"#ffa4e2",344,"#ffc8e2",345,"#ffb4b4",346,"#0f3700",347,"#730055",348,"#6200c4",349,"#4a9595",350,"#ff00f0",351,"#adaaca",352,"#ffe6e6",353,"#67629a",354,"#4a466e",355,"#2f2d46",461,"#6f6fff",462,"#0000dc",463,"#000064",464,"#185f94",465,"#12466d",466,"#000080"]}},Bst="lines",qy="labels";let Zh,Gg,ji,On,Cst=class{constructor(t){DP.then(e=>{Zh={...e.Styles},ji={...e.Layers},Gg={...e.Terrains},On={...e.defaultOptions},this.initTheMap(t)}).catch(e=>{console.info("Configuracio per defecte",e),Zh={...mapicgcConfig.Styles},ji={...mapicgcConfig.Layers},Gg={...mapicgcConfig.Terrains},On={...mapicgcConfig.defaultOptions},this.initTheMap(t)})}initTheMap(t){if(!t)t=On.mapOptions;else for(const e in On.mapOptions){let n=[On.mapOptions.center[0],On.mapOptions.center[1]];On.mapOptions.center=n,t.hasOwnProperty(e)||(t[e]=On.mapOptions[e])}t.maxPitch=85,t.maplibreLogo=!1,t.attributionControl=!1,this.map=new Ls.Map(t),this.map.options=t,this.map.addControl(new Ls.AttributionControl({compact:!0})),this.map.on("load",async()=>{const e=this.map.getStyle().name,n=this.map.options.style;if(window.document.querySelector(".maplibregl-compact-show")){var i=window.document.querySelector(".maplibregl-compact-show");i.classList.remove("maplibregl-compact-show")}this.map.addControl(new oit({color:n.indexOf("orto")===-1,defaultOptions:On}),"bottom-left"),this._dealOrto3dStyle(e)})}addGeocoderICGC(t){try{t===void 0&&(t="top-right");let e={collapsed:!0,marker:!0,popup:!0,showResultMarkers:!0,maplibregl:Ls,showResultsWhileTyping:!0,minLength:2};const n={forwardGeocode:async s=>{const a=[];try{const o=On.geocoder.peliasUrl1+encodeURIComponent(s.query)+On.geocoder.peliasUrl2,f=await(await fetch(o)).json();for(const m of f.features){const _=m.geometry.coordinates,x={type:"Feature",geometry:{type:"Point",coordinates:_},place_name:m.properties.label,properties:m.properties,text:m.properties.label,place_type:["place"],center:_};a.push(x)}}catch(o){console.error(`Failed to forwardGeocode with error: ${o}`)}return{features:a}}};this.map.addControl(new sit(n,e),t);let i=document.getElementsByClassName("maplibregl-ctrl-geocoder--input");i[0].attributes[2].nodeValue="Cerca...",i[0].addEventListener("input",function(s){s.target.value.length>3})}catch(e){console.error(`Error adding ICGC geocoder: ${e.message}`)}}getStyle(){try{return this.map.getStyle()}catch(t){console.error(`Error getting style: ${t.message}`)}}async loadImage(t){try{return this.map.loadImage(t)}catch(e){console.error(`Error getting loadImage: ${e.message}`)}}addImage(t,e){try{return this.map.addImage(t,e)}catch(n){console.error(`Error getting addImage: ${n.message}`)}}getConfigStyles(){try{let t=[];for(const e of Zh)t.push(e.name);return t}catch(t){console.error(`Error retrieving base styles: ${t.message}`)}}getConfigWMSLayers(){try{let t=[];for(const e in ji.WMS)ji.WMS.hasOwnProperty(e)&&t.push(e);return t}catch(t){console.error(`Error retrieving WMS layers: ${t.message}`)}}getConfigOrtoLayers(){try{let t=[];for(const e in ji.Orto)ji.Orto.hasOwnProperty(e)&&t.push(e);return t}catch(t){console.error(`Error retrieving orto image layers: ${t.message}`)}}getConfigVectorLayers(){try{let t=[];for(const e in ji.Vector)ji.Vector.hasOwnProperty(e)&&t.push(e);return t}catch(t){console.error(`Error retrieving vector layers: ${t.message}`)}}getConfigVectorAdminLayers(){try{let t=[];for(const e in ji.VectorAdmin)ji.VectorAdmin.hasOwnProperty(e)&&t.push(e);return t}catch(t){console.error(`Error retrieving vectorAdmin layers: ${t.message}`)}}getConfigFGBAdminLayers(){try{let t=[];for(const e in ji.FGBAdmin)ji.FGBAdmin.hasOwnProperty(e)&&t.push(e);return t}catch(t){console.error(`Error retrieving FGBAdmin layers: ${t.message}`)}}async fetchData(t,e,n){try{(!n||n===void 0)&&(n={type:"line",layout:{visibility:"visible"},paint:{"line-color":"grey","line-width":2},layerPosition:"top"});let i=n.layerPosition;if(t.includes(".fgb"))this.addFGBLayerICGC(t,e,n);else{const a=await(await fetch(t)).json();let o=e,A=this._dealOrderLayer(i),f=a.features[0].geometry.type;f.includes("ine")&&(n!==void 0?this.map.addLayer({id:o,type:"line",source:{type:"geojson",data:a},layout:n.layout||{},paint:n.paint||{}},A):this.map.addLayer({id:o,type:"line",source:{type:"geojson",data:a},layout:{visibility:"visible"},paint:{"line-color":"black","line-width":2,"line-opacity":1}},A)),f.includes("olygon")&&(n!==void 0?this.map.addLayer({id:o,type:"fill",source:{type:"geojson",data:a},layout:n.layout,paint:n.paint},A):this.map.addLayer({id:o,type:"fill",source:{type:"geojson",data:a},layout:{visibility:"visible"},paint:{"fill-color":"blue","fill-opacity":.6}},A)),f.includes("oint")&&(n!==void 0?this.map.addLayer({id:o,type:"circle",source:{type:"geojson",data:a},layout:n.layout,paint:n.paint},A):this.map.addLayer({id:o,type:"circle",source:{type:"geojson",data:a},layout:{visibility:"visible"},paint:{"circle-color":"red","circle-opacity":.85}},A))}}catch(i){console.error(`Error fetching data: ${i.message}`)}}async fetchDataAndMenu(t,e,n,i){try{let s;i!==null?s=i.layerPosition:s=qy;let a,o=document.getElementById("map");if(document.getElementById("menu-group")?a=document.getElementById("menu-group"):(a=document.createElement("nav"),a.id="menu-group",a.classList.add="filter-group",o.appendChild(a)),a!==null){let A="visible",f=this._dealOrderLayer(s),m;if(t.includes(".fgb")){let x=this._getKeyByUrlFGB(t);x===null&&(x="userFGB");const B=await fetch(t),P={type:"FeatureCollection",features:[]};for await(const k of OS(B.body))P.features.push(k);m=P;let M=e;if(this.map.addSource(M,{type:"geojson",data:P}),t.includes("text"))i!==void 0?this.map.addLayer({id:e,type:"symbol",source:M,layout:i.layout,paint:i.paint},f):this.map.addLayer({id:e,type:"symbol",source:M,layout:{"text-letter-spacing":.1,"text-size":{base:1.2,stops:[[8,0],[12,14],[15,15]]},"text-font":["FiraSans-Regular"],"text-field":["get","NOM_AC"],"text-transform":"none","text-max-width":25,visibility:A,"text-justify":"right","text-anchor":"top","text-allow-overlap":!1,"symbol-spacing":2,"text-line-height":1},paint:{"text-halo-blur":.5,"text-color":"rgba(90, 7, 7, 1)","text-halo-width":2,"text-halo-color":"rgba(255, 255, 255,0.8)"}},f);else{let k=e+"Text";this.map.addLayer({id:k,type:"symbol",source:M,layout:{"text-letter-spacing":.1,"text-size":{base:1.2,stops:[[8,0],[12,14],[15,15]]},"text-font":["FiraSans-Regular"],"text-field":["get","NOM_AC"],"text-transform":"none","text-max-width":25,visibility:A,"text-justify":"right","text-anchor":"top","text-allow-overlap":!1,"symbol-spacing":2,"text-line-height":1},paint:{"text-halo-blur":.5,"text-color":"rgba(90, 7, 7, 1)","text-halo-width":2,"text-halo-color":"rgba(255, 255, 255,0.8)"}},f)}}else m=await(await fetch(t)).json();if(n!=="all"){const x=document.createElement("div");x.id="titleDivMenu",x.textContent=e,a.appendChild(x);const B=document.createElement("div");B.id="titleDivMenuSub",B.textContent=` ${n}`,a.appendChild(B)}let _;if(i.type?_=i.type:_=m.features[0].geometry.type,n==="all")_.includes("ine")&&(i!==void 0?this.map.addLayer({id:e,type:"line",source:{type:"geojson",data:m},layout:i.layout,paint:i.paint},f):this.map.addLayer({id:e,type:"line",source:{type:"geojson",data:m},layout:{visibility:"visible"},paint:{"line-color":"black","line-width":2,"line-opacity":1}},f)),_.includes("olygon")&&(i!==void 0?this.map.addLayer({id:e,type:"fill",source:{type:"geojson",data:m},layout:i.layout,paint:i.paint},f):this.map.addLayer({id:e,type:"fill",source:{type:"geojson",data:m},layout:{visibility:"visible"},paint:{"fill-color":"#0000FF","fill-opacity":0}},f)),_.includes("oint")&&(i!==void 0?this.map.addLayer({id:e,type:"circle",source:{type:"geojson",data:m},layout:i.layout,paint:i.paint},f):this.map.addLayer({id:e,type:"circle",source:{type:"geojson",data:m},layout:{visibility:"visible"},paint:{"circle-color":"red","circle-opacity":.85}},f)),_.includes("ymbol")&&(i!==void 0?this.map.addLayer({id:e,type:"symbol",source:{type:"geojson",data:m},layout:i.layout,paint:i.paint},f):this.map.addLayer({id:e,type:"symbol",source:{type:"geojson",data:m},layout:{visibility:"visible"},paint:{"text-halo-blur":.5,"text-color":"rgba(90, 7, 7, 1)","text-halo-width":2,"text-halo-color":"rgba(255, 255, 255,0.8)"}},f)),this.addMenuItem(e);else{let x=n;const B={};m.features.forEach(P=>{const M=P.properties[x],k=M+"-userFieldFilter-"+e;M!==null&&(B[k]||(_.includes("ine")&&(i!==void 0?this.map.addLayer({id:k,type:"line",source:{type:"geojson",data:m},layout:i.layout,paint:i.paint,filter:["==",`${x}`,M]},f):this.map.addLayer({id:k,type:"line",source:{type:"geojson",data:m},layout:{visibility:"visible"},filter:["==",`${x}`,M],paint:{"line-color":"black","line-width":2,"line-opacity":1}},f)),_.includes("olygon")&&(i!==void 0?this.map.addLayer({id:k,type:"fill",source:{type:"geojson",data:m},filter:["==",`${x}`,M],layout:i.layout,paint:i.paint},f):this.map.addLayer({id:k,type:"fill",source:{type:"geojson",data:m},layout:{visibility:"visible"},filter:["==",`${x}`,M],paint:{"fill-color":"blue","fill-opacity":.6}},f)),_.includes("oint")&&(i!==void 0?this.map.addLayer({id:k,type:"circle",source:{type:"geojson",data:m},filter:["==",`${x}`,M],layout:i.layout,paint:i.paint},f):this.map.addLayer({id:k,type:"circle",source:{type:"geojson",data:m},layout:{visibility:"visible"},filter:["==",`${x}`,M],paint:{"circle-color":"red","circle-opacity":.85}},f)),B[k]=!0,this.addMenuItem(k)))})}}}catch(s){console.error(`Error fetching data: ${s.message}`)}}on(t,e){setTimeout(()=>{try{this.map.on(t,e)}catch(n){console.error(`Error adding event ON listener: ${n.message}`)}},500)}getSource(t){try{return this.map.getSource(t)}catch(e){console.error(`Error getting source: ${e.message}`)}}addSource(t,e){try{this.map.addSource(t,e)}catch(n){console.error(`Error adding source: ${n.message}`)}}setStyle(t,e){try{e!==void 0?this.map.setStyle(t,e):this.map.setStyle(t),this.map.on("styledata",()=>{if(window.document.querySelector(".maplibregl-compact-show")){var n=window.document.querySelector(".maplibregl-compact-show");n.classList.remove("maplibregl-compact-show")}this._dealOrto3dStyle(this.map.getStyle().name)})}catch(n){console.error(`Error setting style: ${n.message}`)}}getLayer(t){try{return this.map.getLayer(t)}catch(e){console.error(`Error getting layer: ${e.message}`)}}setFilter(t,e,n){try{return this.map.setFilter(t,e,n)}catch(i){console.error(`Error setting filter: ${i.message}`)}}jumpTo(t){try{this.map.jumpTo(t)}catch(e){console.error(`Error jumping to ${t}: ${e.message}`)}}setLayoutProperty(t,e,n){try{this.map.setLayoutProperty(t,e,n)}catch(i){console.error(`Error setting layout property: ${i.message}`)}}setPaintProperty(t,e,n){try{this.map.setPaintProperty(t,e,n)}catch(i){console.error(`Error setting paint property: ${i.message}`)}}addControl(t,e){try{e===void 0&&(e="top-right"),this.map.addControl(t,e)}catch(n){console.error(`Error adding control: ${n.message}`)}}getZoom(){try{return this.map.getZoom()}catch(t){console.error(`Error getting zoom level: ${t.message}`)}}addMouseCoordControl(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"bottom-left";try{this.map.addControl(new uit(t),e)}catch(n){console.error(`Error adding mouse coordinate control: ${n.message}`)}}addGeolocateControl(t,e){try{e===void 0&&(e="top-right"),t===void 0?this.map.addControl(new Ls.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0}),e):this.map.addControl(new Ls.GeolocateControl(t),e)}catch(n){console.error(`Error adding geolocate control: ${n.message}`)}}addFullscreenControl(t,e){try{e===void 0&&(e="top-right"),t===void 0?this.map.addControl(new Ls.FullscreenControl({container:HTMLElement}),e):this.map.addControl(new Ls.FullscreenControl(t),e)}catch(n){console.error(`Error adding fullscreen control: ${n.message}`)}}getBounds(){try{return this.map.getBounds()}catch(t){console.error(`Error getting bounds: ${t.message}`)}}getCenter(){try{return this.map.getCenter()}catch(t){console.error(`Error getting center: ${t.message}`)}}setTerrain(t){try{return this.map.setTerrain(t)}catch(e){console.error(`Error setting terrain: ${e.message}`)}}setLayerZoomRange(t,e,n){try{return this.map.setLayerZoomRange(t,e,n)}catch(i){console.error(`Error setting terrain: ${i.message}`)}}getCanvas(){try{return this.map.getCanvas()}catch(t){console.error(`Error getting canvas: ${t.message}`)}}setCenter(t){try{return this.map.setCenter(t)}catch(e){console.error(`Error setting center: ${e.message}`)}}addLayer(t,e){try{this.map.addLayer(t,e)}catch(n){console.error(`Error adding layer: ${n.message}`)}}addLayerGeoJSON(t,e){try{let n=this._dealOrderLayer(e);this.map.addSource(`${t.id}`,{type:"geojson",data:t.data}),this.map.addLayer({id:`${t.id}-layerIcgcMap`,type:t.layerType,source:`${t.id}`,layout:t.layout,paint:t.paint},n)}catch(n){console.error(`Error adding GeoJSON layer: ${n.message}`)}}addLayerWMS(t,e,n){try{let i=this._dealOrderLayer(n.layerPosition);n?(this.map.addSource(`${e}`,{type:"raster",tiles:[t],tileSize:256},i),this.map.addLayer({id:e,type:"raster",source:e,layout:n.layout,paint:n.paint},i)):(this.map.addSource(`${e}`,{type:"raster",tiles:[t],tileSize:256},i),this.map.addLayer({id:e,type:"raster",source:e,paint:{}},i))}catch(i){console.error(`Error adding WMS layer: ${i.message}`)}}removeControl(t){try{this.map.removeControl(t)}catch(e){console.error(`Error removing control: ${e.message}`)}}removeLayer(t){try{this.map.removeLayer(t)}catch(e){console.error(`Error removing layer: ${e.message}`)}}removeSource(t){try{this.map.removeSource(t)}catch(e){console.error(`Error removing source: ${e.message}`)}}addLogo(t){try{const e=document.createElement("img");e.src=t.url,e.style.height=t.height;const n=document.getElementById("logos"),i=document.createElement("a");i.id=t.id,i.href=t.href,i.target="_blank",i.style.position="relative",i.style.bottom="1px",i.appendChild(e),n.appendChild(i)}catch(e){console.error(`Error adding logo: ${e.message}`)}}addBasemapsICGC(t){try{const e=a=>{this.map.setStyle(a)};let n=document.getElementById("map"),i;i=document.createElement("div"),i.id="basemap-group",i.classList.add="filter-group",n.appendChild(i);const s=document.getElementById("basemap-group");for(const a of t)for(const o of Object.keys(On.baseStyles)){const A=On.baseStyles[o];if(a===A.url){const f=document.createElement("div");f.className="basemap-item",f.title=A.key,f.style.backgroundImage=`url('${A.image}')`,s.appendChild(f),f.addEventListener("click",()=>e(A.url))}}}catch(e){console.error(`Error adding basemaps: ${e.message}`)}}addBasemaps(t){try{const e=i=>{map.setStyle(i.url)},n=document.getElementById("basemap-group");t.forEach(i=>{const s=document.createElement("div");s.className="basemap-item",s.title=i.label,s.style.backgroundImage=`url('${i.image}')`,n.appendChild(s),s.addEventListener("click",()=>e(i))})}catch(e){console.error(`Error adding basemaps: ${e.message}`)}}addFeatureQuery(t,e,n){try{let i;this.map.on("mouseenter",t,()=>{this.map.getCanvas().style.cursor="pointer"}),this.map.on("mouseleave",t,()=>{this.map.getCanvas().style.cursor=""}),this.map.on("click",s=>{let a=this.map.queryRenderedFeatures(s.point);if(a&&a[0].source.includes(t)){let o=[s.lngLat.lng,s.lngLat.lat];if(e!==void 0&&e.length>0&&e!=="all"){if(e!==null){let A="";e.forEach(f=>{let m=a[0].properties[f];A=A+`<h4>${m}</h4>`}),i=A,map.addPopup(o,i,n)}}else{let A="";for(const f in a[0].properties)A+="<b>"+f+"</b>:"+a[0].properties[f]+"<br>";i=A,map.addPopup(o,i,n)}}})}catch(i){console.error(`Error adding feature query: ${i.message}`)}}addScaleControl(t,e){try{var n=new Ls.ScaleControl(t);this.map.addControl(n,e)}catch(i){console.error(`Error adding scale: ${i.message}`)}}addExportControl(t,e){try{typeof t=="string"&&(e=t,t=void 0),t===void 0&&(t={PageSize:$h.A4,PageOrientation:Mg.Landscape,Format:ku.PNG,DPI:B2[300],Crosshair:!0,PrintableArea:!0},e="top-right"),this.map.addControl(new pnt(t),e)}catch(n){console.error(`Error adding export control: ${n.message}`)}}addPopup(t,e){try{new Ls.Popup().setLngLat(t).setHTML(e).addTo(this.map)}catch{}}addMarker(t){try{let e,n;return t.text===void 0?e=new Ls.Marker(t.options).setLngLat(t.coord).addTo(this.map):(n=new Ls.Popup({offset:t.textOffset}).setText(t.text),e=new Ls.Marker().setLngLat(t.coord).setPopup(n).addTo(this.map)),e}catch(e){return console.error(`Error adding marker: ${e.message}`),null}}addPopup(t,e,n){try{return n.image===void 0?new Ls.Popup().setLngLat(t).setHTML(`
        <div class="popupBody">
          <div class="popupTop">
          ${n.title}
          </div>
          <div class="popupBottom">
          <div class="popupBottomUp">
 ${e}
          </div>
          <div class="popupBottomDown">
          </div>
          </div>
        </div>
      `).addTo(this.map):new Ls.Popup().setLngLat(t).setHTML(`
        <div class="popupBody">
          <div class="popupTop">
          ${n.title}
          </div>
          <div class="popupBottom">
          <div class="popupBottomUp">
          ${e}
          </div>
          <div class="popupBottomDown">
             <img style="  padding: 8px;  width: 50%;" src=${n.image} />
          </div>
          </div>
        </div>
      `).addTo(this.map)}catch(i){return console.error(`Error adding popup: ${i.message}`),null}}addFullScreen(t){try{t===void 0&&(t="top-right"),this.map.addControl(new Ls.FullscreenControl,t)}catch(e){console.error(`Error adding fullscreen control: ${e.message}`)}}addMenuItem(t){try{let e;if(t.includes("-userFieldFilter-")?e=t.split("-userFieldFilter-")[0]:e=t,t.length>0){const n=document.getElementById("menu-group"),i=document.createElement("input");i.type="checkbox",i.id=t,i.checked=!0,n.appendChild(i);const s=document.createElement("label");s.setAttribute("for",t),s.textContent=e,n.appendChild(s),i.addEventListener("change",a=>{this.map.setLayoutProperty(t,"visibility",a.target.checked?"visible":"none")})}}catch(e){console.error(`Error adding menu item: ${e.message}`)}}addLayerTree(t){try{let e=t.features;const n=document.getElementById("filter-group");this.map.addSource(`${t.id}`,{type:t.type,data:e}),e.features.forEach(i=>{const s=i.properties.icon,a=`poi-${s}`;if(!this.map.getLayer(a)){this.map.addLayer({id:a,type:"circle",source:`${t.id}`,paint:{"circle-radius":6,"circle-color":"#B42222"},filter:["==","icon",s]},this._firstSymbolLayer());const o=document.createElement("input");o.type="checkbox",o.id=a,o.checked=!0,n.appendChild(o);const A=document.createElement("label");A.setAttribute("for",a),A.textContent=s,n.appendChild(A),o.addEventListener("change",f=>{this.map.setLayoutProperty(a,"visibility",f.target.checked?"visible":"none")})}})}catch(e){console.error(`Error adding layer tree: ${e.message}`)}}createNavigationControl(t,e){try{e===void 0&&(e="top-right"),this.map.addControl(new Ls.NavigationControl(t),e)}catch(n){return console.error(`Error creating navigation control: ${n.message}`),null}}addNavigationControl(t,e){try{e===void 0&&(e="top-right"),this.map.addControl(new Ls.NavigationControl(t),e)}catch(n){console.error(`Error adding navigation control: ${n.message}`)}}addAttributionControl(t,e){try{this.map.addControl(new Ls.AttributionControl(t),e)}catch(n){console.error(`Error adding attribution control: ${n.message}`)}}addImageLayerICGC(t,e,n){try{let i=null,s,a;n?(a=n,s=n.layerPosition):a={type:"raster",layout:{visibility:"visible"},paint:{"raster-opacity":1},layerPosition:qy},i=this._findImageType(t,ji.Orto,ji.VectorAdmin,ji.WMS,ji.Vector),i||console.log(" %c The layer: %c%s%c does not exist in the ICGC DB. Consult the documentation.","font-weight: bold; font-style: italic;","font-weight: normal; font-style: normal; color: red;",t,"font-weight: bold; font-style: italic;");let o={id:e,tiles:t};this.addLayerWMS(t,e,a)}catch(i){console.error(`Error adding ICGC image layer: ${i.message}`)}}async addVectorLayerICGC(t,e,n){try{let{type:i="line",layerPosition:s=qy,layoutOptions:a={visibility:"visible"},paintOption:o}=n||{},A=this._dealOrderLayer(s);if(!t){console.log(" %c The layer: %c%s%c does not exist in the ICGC DB. Consult the documentation.","font-weight: bold; font-style: italic;","font-weight: normal; font-style: normal; color: red;",t,"font-weight: bold; font-style: italic;");return}if(t.includes("https")){let f=this._getKeyByUrlVector(t);this.map.addSource(f,{type:"vector",url:t});let m={id:f,type:"fill",source:f,"source-layer":"cobertes",maxzoom:18,layout:n.layout,paint:xst.cobertesSol};if(f==="cobertes2018"&&this.map.addLayer(m,A),a.visibility==="visible"){let _=this._getLegendByName(f);map.addLegend(f,_)}}else{let f=e;this.map.addSource(f,{type:"vector",url:On.limitsUrl});let m={id:e,type:i,source:f,"source-layer":t,layout:n.layout,paint:n.paint||{}};i==="fill"||i==="polygon"?m.paint=o||{"fill-color":"#0000FF","fill-opacity":0}:i==="line"&&(m.paint=o||{"line-color":"#4832a8","line-opacity":1,"line-width":1}),this.map.addLayer(m,A)}}catch(i){console.error(`Error adding ICGC vector layer: ${i.message}`)}}async addFGBLayerICGC(t,e,n){try{n||(n.layout={visibility:!0},n.paint={"line-color":"#4832a8","line-opacity":1,"line-width":1},n.type="lines",n.layerPosition="labels");let i=this._dealOrderLayer(n.layerPosition);const s=await fetch(t),a={type:"FeatureCollection",features:[]};for await(const A of OS(s.body))a.features.push(A);let o=e;this.map.addSource(o,{type:"geojson",data:a}),t.includes("text")?this.map.addLayer({id:e,type:"symbol",source:o,layout:{"text-letter-spacing":.1,"text-size":{base:1.2,stops:[[8,0],[12,14],[15,15]]},"text-font":["FiraSans-Regular"],"text-field":["get","NOM_AC"],"text-transform":"none","text-max-width":25,visibility:n.layout.visibility,"text-justify":"right","text-anchor":"top","text-allow-overlap":!1,"symbol-spacing":2,"text-line-height":1},paint:{"text-halo-blur":.5,"text-color":"rgba(90, 7, 7, 1)","text-halo-width":2,"text-halo-color":"rgba(255, 255, 255,0.8)"}},i):this.map.addLayer({id:e,type:n.type,source:o,layout:n.layout,paint:n.paint},i)}catch(i){console.error(`Error adding ICGC FGB layer: ${i.message}`)}}addTerrainICGC(t,e){try{let n;for(const s in Gg)if(Gg.hasOwnProperty(s)){const a=Gg[s];a===t&&(n=a)}let i=n;this.getSource("terrainICGC")!==void 0&&(this.getStyle().layers.forEach(a=>{a.source==="terrainICGC"&&this.removeLayer(a.id)}),this.removeSource("terrainICGC")),this.getSource("terrainICGC")===void 0&&(t.includes("terrarium")?this.map.addSource("terrainICGC",{type:"raster-dem",tiles:[i],tileSize:512,encoding:"terrarium",maxzoom:16}):this.map.addSource("terrainICGC",{type:"raster-dem",tiles:[i],tileSize:512,maxzoom:16})),this.map.setTerrain({source:"terrainICGC",exaggeration:1.5}),e==null||this.map.addControl(new y8({pitch:90,bearing:null,minpitchzoom:null}),e)}catch(n){console.error(`Error adding 3D terrain: ${n.message}`)}}addLegend(t,e){try{this.map.addControl(new ait({url:t,idLayer:e}))}catch(n){console.error(`Error adding legend: ${n.message}`)}}_findImageType(t,e,n,i,s){const a=[e,n,i,s];for(const o of a)for(const[A,f]of Object.entries(o))if(f===t)return A;return null}_getKeyByUrlFGB(t){for(const e in ji.FGBAdmin)if(ji.FGBAdmin.hasOwnProperty(e)&&ji.FGBAdmin[e]===t)return e;return null}_getLegendByName(t){for(const e in On.vectorLayers){const n=On.vectorLayers[e];if(n.key===t)return n.legend}return null}_getKeyByUrlVector(t){for(const e in ji.Vector)if(ji.Vector.hasOwnProperty(e)&&ji.Vector[e]===t)return e;return null}async _raiseText3DStyle(){try{const t=await this.map.loadImage(On.map3dOptions.imageIcon);this.map.addImage("stick",t.data),this.map.getStyle().layers.forEach(e=>{if(e["source-layer"]===On.map3dOptions.sourceLayerFilterId&&e.minzoom>=On.map3dOptions.minZoomFilter&&t){const n=e.id;this.map.setLayoutProperty(n,"icon-image","stick"),this.map.setLayoutProperty(n,"text-offset",[0,-9]),this.map.setLayoutProperty(n,"symbol-placement","point"),this.map.setLayoutProperty(n,"symbol-avoid-edges",!1),this.map.setLayoutProperty(n,"text-allow-overlap",!0),this.map.setLayoutProperty(n,"text-ignore-placement",!1),this.map.setLayoutProperty(n,"text-pitch-alignment","auto"),this.map.setLayoutProperty(n,"text-rotation-alignment","auto"),this.map.setLayoutProperty(n,"text-justify","center"),this.map.setLayoutProperty(n,"text-anchor","bottom"),this.map.setLayoutProperty(n,"icon-anchor","bottom"),this.map.setPaintProperty(n,"text-color","#ffffff"),this.map.setPaintProperty(n,"text-halo-color","#000000"),this.map.setPaintProperty(n,"text-halo-width",2)}})}catch(t){return console.error(`Error dealing orto 3D: ${t.message}`),null}}_dealStyleMaps(t){try{if(t&&t.indexOf("icgc.cat")!=-1){for(const e in Zh)if(Zh.hasOwnProperty(e)){const n=Zh[e];if(e===t)return n}return Zh[0]}else return t}catch(e){return console.error(`Error dealing with map styles: ${e.message}`),null}}_dealOrto3dStyle(t){try{if(t=="orto3d"){this.map.setMaxZoom(18.8),this.map.easeTo({pitch:45});const e=new E3({intensity:4}),n=new Zb({ambientLight:e});this.map.setTerrain({source:On.map3dOptions.terrainSource,exaggeration:On.map3dOptions.exaggeration});const i=this._createCitiesMapboxLayer();this.map.getLayer(On.map3dOptions.layerId3d)||(this.map.addLayer(i,On.map3dOptions.layerIdOrder),this.map.setLayerZoomRange(On.map3dOptions.layerId3d,On.map3dOptions.minZoomRange,On.map3dOptions.maxZoomRange),i.deck.setProps({effects:[n]}),this._raiseText3DStyle())}else this.map.getLayer(On.map3dOptions.layerId3d)&&(this.map.removeLayer(On.map3dOptions.layerId3d),this.map.setTerrain(null))}catch(e){return console.error(`Error dealing orto 3D: ${e.message}`),null}}_dealOrderLayer(t){return t===qy?this._firstSymbolLayer():t===Bst?this._firstLineLayer():""}_firstSymbolLayer(){try{const t=this.map.getStyle().layers;let e;for(let n=0;n<t.length;n++)if(t[n].type==="symbol"){e=t[n].id;break}return e}catch(t){console.error(`Error getting first symbol layer: ${t.message}`)}}_firstLineLayer(){try{const t=this.map.getStyle().layers;let e;for(let n=0;n<t.length;n++)if(t[n].type==="line"){e=t[n].id;break}return e}catch(t){console.error(`Error getting first symbol layer: ${t.message}`)}}_createCitiesMapboxLayer(){try{return new WW({id:On.map3dOptions.layerId3d,type:x2,data:On.map3dOptions.urlTilesetCities,loader:w2,loadOptions:{tileset:{viewDistanceScale:1,updateTransforms:!0,maximumScreenSpaceError:On.map3dOptions.spaceErrorFactor}},onTilesetLoad:e=>{e.options.maximumScreenSpaceError=On.map3dOptions.spaceErrorFactor},onTileLoad:e=>{e.content.cartographicOrigin.z-=On.map3dOptions.zfactor},operation:"terrain+draw"})}catch(t){return console.error(`Error adding MapboxLayer: ${t.message}`),null}}};var NP={exports:{}};function Est(r,t){var e=r.getCenter(),n=r.getZoom(),i=r.getBearing(),s=r.getPitch();t.forEach(function(a){a.jumpTo({center:e,zoom:n,bearing:i,pitch:s})})}function Sst(){var r,t=arguments.length;if(t===1)r=arguments[0];else{r=[];for(var e=0;e<t;e++)r.push(arguments[e])}var n=[];r.forEach(function(o,A){n[A]=a.bind(null,o,r.filter(function(f,m){return m!==A}))});function i(){r.forEach(function(o,A){o.on("move",n[A])})}function s(){r.forEach(function(o,A){o.off("move",n[A])})}function a(o,A){s(),Est(o,A),i()}return i(),function(){s(),n=[],r=[]}}var Tst=Sst;(function(r){var t=Tst,e=Z4.EventEmitter;function n(i,s,a,o){if(this.options=o||{},this._mapA=i,this._mapB=s,this._horizontal=this.options.orientation==="horizontal",this._onDown=this._onDown.bind(this),this._onMove=this._onMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._ev=new e,this._swiper=document.createElement("div"),this._swiper.className=this._horizontal?"compare-swiper-horizontal":"compare-swiper-vertical",this._controlContainer=document.createElement("div"),this._controlContainer.className=this._horizontal?"maplibregl-compare maplibregl-compare-horizontal":"maplibregl-compare",this._controlContainer.className=this._controlContainer.className,this._controlContainer.appendChild(this._swiper),typeof a=="string"&&document.body.querySelectorAll){var A=document.body.querySelectorAll(a)[0];if(!A)throw new Error("Cannot find element with specified container selector.");A.appendChild(this._controlContainer)}else if(a instanceof Element&&a.appendChild)a.appendChild(this._controlContainer);else throw new Error("Invalid container specified. Must be CSS selector or HTML element.");this._bounds=s.getContainer().getBoundingClientRect();var f=(this._horizontal?this._bounds.height:this._bounds.width)/2;this._setPosition(f),this._clearSync=t(i,s),this._onResize=(function(){this._bounds=s.getContainer().getBoundingClientRect(),this.currentPosition&&this._setPosition(this.currentPosition)}).bind(this),s.on("resize",this._onResize),this.options&&this.options.mousemove&&(i.getContainer().addEventListener("mousemove",this._onMove),s.getContainer().addEventListener("mousemove",this._onMove)),this._swiper.addEventListener("mousedown",this._onDown),this._swiper.addEventListener("touchstart",this._onDown)}n.prototype={_setPointerEvents:function(i){this._controlContainer.style.pointerEvents=i,this._swiper.style.pointerEvents=i},_onDown:function(i){i.touches?(document.addEventListener("touchmove",this._onMove),document.addEventListener("touchend",this._onTouchEnd)):(document.addEventListener("mousemove",this._onMove),document.addEventListener("mouseup",this._onMouseUp))},_setPosition:function(i){i=Math.min(i,this._horizontal?this._bounds.height:this._bounds.width);var s=this._horizontal?"translate(0, "+i+"px)":"translate("+i+"px, 0)";this._controlContainer.style.transform=s,this._controlContainer.style.WebkitTransform=s;var a=this._horizontal?"rect(0, 999em, "+i+"px, 0)":"rect(0, "+i+"px, "+this._bounds.height+"px, 0)",o=this._horizontal?"rect("+i+"px, 999em, "+this._bounds.height+"px,0)":"rect(0, 999em, "+this._bounds.height+"px,"+i+"px)";this._mapA.getContainer().style.clip=a,this._mapB.getContainer().style.clip=o,this.currentPosition=i},_onMove:function(i){this.options&&this.options.mousemove&&this._setPointerEvents(i.touches?"auto":"none"),this._horizontal?this._setPosition(this._getY(i)):this._setPosition(this._getX(i))},_onMouseUp:function(){document.removeEventListener("mousemove",this._onMove),document.removeEventListener("mouseup",this._onMouseUp),this.fire("slideend",{currentPosition:this.currentPosition})},_onTouchEnd:function(){document.removeEventListener("touchmove",this._onMove),document.removeEventListener("touchend",this._onTouchEnd),this.fire("slideend",{currentPosition:this.currentPosition})},_getX:function(i){i=i.touches?i.touches[0]:i;var s=i.clientX-this._bounds.left;return s<0&&(s=0),s>this._bounds.width&&(s=this._bounds.width),s},_getY:function(i){i=i.touches?i.touches[0]:i;var s=i.clientY-this._bounds.top;return s<0&&(s=0),s>this._bounds.height&&(s=this._bounds.height),s},setSlider:function(i){this._setPosition(i)},on:function(i,s){return this._ev.on(i,s),this},fire:function(i,s){return this._ev.emit(i,s),this},off:function(i,s){return this._ev.removeListener(i,s),this},remove:function(){this._clearSync(),this._mapB.off("resize",this._onResize);var i=this._mapA.getContainer();i&&(i.style.clip=null,i.removeEventListener("mousemove",this._onMove));var s=this._mapB.getContainer();s&&(s.style.clip=null,s.removeEventListener("mousemove",this._onMove)),this._swiper.removeEventListener("mousedown",this._onDown),this._swiper.removeEventListener("touchstart",this._onDown),this._controlContainer.remove()}},window.maplibregl?maplibregl.Compare=n:r.exports=n})(NP);var Ist=NP.exports;const Lst=Mp(Ist);class Fst{constructor(t,e,n,i){const s=this;setTimeout(function(){s.mapCompare=new Lst(t.map,e.map,n,{})},1e3)}}/*!
 * html2canvas 1.4.1 <https://html2canvas.hertzen.com>
 * Copyright (c) 2022 Niklas von Hertzen <https://hertzen.com>
 * Released under MIT License
 *//*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var dx=function(r,t){return dx=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])},dx(r,t)};function Zc(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");dx(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var fx=function(){return fx=Object.assign||function(r){for(var t,e=1,n=arguments.length;e<n;e++){t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=t[i])}return r},fx.apply(this,arguments)};function No(r,t,e,n){function i(s){return s instanceof e?s:new e(function(a){a(s)})}return new(e||(e=Promise))(function(s,a){function o(m){try{f(n.next(m))}catch(_){a(_)}}function A(m){try{f(n.throw(m))}catch(_){a(_)}}function f(m){m.done?s(m.value):i(m.value).then(o,A)}f((n=n.apply(r,t||[])).next())})}function _o(r,t){var e={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,i,s,a;return a={next:o(0),throw:o(1),return:o(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function o(f){return function(m){return A([f,m])}}function A(f){if(n)throw new TypeError("Generator is already executing.");for(;e;)try{if(n=1,i&&(s=f[0]&2?i.return:f[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,f[1])).done)return s;switch(i=0,s&&(f=[f[0]&2,s.value]),f[0]){case 0:case 1:s=f;break;case 4:return e.label++,{value:f[1],done:!1};case 5:e.label++,i=f[1],f=[0];continue;case 7:f=e.ops.pop(),e.trys.pop();continue;default:if(s=e.trys,!(s=s.length>0&&s[s.length-1])&&(f[0]===6||f[0]===2)){e=0;continue}if(f[0]===3&&(!s||f[1]>s[0]&&f[1]<s[3])){e.label=f[1];break}if(f[0]===6&&e.label<s[1]){e.label=s[1],s=f;break}if(s&&e.label<s[2]){e.label=s[2],e.ops.push(f);break}s[2]&&e.ops.pop(),e.trys.pop();continue}f=t.call(r,e)}catch(m){f=[6,m],i=0}finally{n=s=0}if(f[0]&5)throw f[1];return{value:f[0]?f[1]:void 0,done:!0}}}function Ky(r,t,e){if(e||arguments.length===2)for(var n=0,i=t.length,s;n<i;n++)(s||!(n in t))&&(s||(s=Array.prototype.slice.call(t,0,n)),s[n]=t[n]);return r.concat(s||t)}for(var zu=function(){function r(t,e,n,i){this.left=t,this.top=e,this.width=n,this.height=i}return r.prototype.add=function(t,e,n,i){return new r(this.left+t,this.top+e,this.width+n,this.height+i)},r.fromClientRect=function(t,e){return new r(e.left+t.windowBounds.left,e.top+t.windowBounds.top,e.width,e.height)},r.fromDOMRectList=function(t,e){var n=Array.from(e).find(function(i){return i.width!==0});return n?new r(n.left+t.windowBounds.left,n.top+t.windowBounds.top,n.width,n.height):r.EMPTY},r.EMPTY=new r(0,0,0,0),r}(),$y=function(r,t){return zu.fromClientRect(r,t.getBoundingClientRect())},Pst=function(r){var t=r.body,e=r.documentElement;if(!t||!e)throw new Error("Unable to get document size");var n=Math.max(Math.max(t.scrollWidth,e.scrollWidth),Math.max(t.offsetWidth,e.offsetWidth),Math.max(t.clientWidth,e.clientWidth)),i=Math.max(Math.max(t.scrollHeight,e.scrollHeight),Math.max(t.offsetHeight,e.offsetHeight),Math.max(t.clientHeight,e.clientHeight));return new zu(0,0,n,i)},Wy=function(r){for(var t=[],e=0,n=r.length;e<n;){var i=r.charCodeAt(e++);if(i>=55296&&i<=56319&&e<n){var s=r.charCodeAt(e++);(s&64512)===56320?t.push(((i&1023)<<10)+(s&1023)+65536):(t.push(i),e--)}else t.push(i)}return t},rs=function(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];if(String.fromCodePoint)return String.fromCodePoint.apply(String,r);var e=r.length;if(!e)return"";for(var n=[],i=-1,s="";++i<e;){var a=r[i];a<=65535?n.push(a):(a-=65536,n.push((a>>10)+55296,a%1024+56320)),(i+1===e||n.length>16384)&&(s+=String.fromCharCode.apply(String,n),n.length=0)}return s},kP="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Mst=typeof Uint8Array>"u"?[]:new Uint8Array(256),Xy=0;Xy<kP.length;Xy++)Mst[kP.charCodeAt(Xy)]=Xy;for(var QP="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Vg=typeof Uint8Array>"u"?[]:new Uint8Array(256),Jy=0;Jy<QP.length;Jy++)Vg[QP.charCodeAt(Jy)]=Jy;for(var Ust=function(r){var t=r.length*.75,e=r.length,n,i=0,s,a,o,A;r[r.length-1]==="="&&(t--,r[r.length-2]==="="&&t--);var f=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"&&typeof Uint8Array.prototype.slice<"u"?new ArrayBuffer(t):new Array(t),m=Array.isArray(f)?f:new Uint8Array(f);for(n=0;n<e;n+=4)s=Vg[r.charCodeAt(n)],a=Vg[r.charCodeAt(n+1)],o=Vg[r.charCodeAt(n+2)],A=Vg[r.charCodeAt(n+3)],m[i++]=s<<2|a>>4,m[i++]=(a&15)<<4|o>>2,m[i++]=(o&3)<<6|A&63;return f},Rst=function(r){for(var t=r.length,e=[],n=0;n<t;n+=2)e.push(r[n+1]<<8|r[n]);return e},Ost=function(r){for(var t=r.length,e=[],n=0;n<t;n+=4)e.push(r[n+3]<<24|r[n+2]<<16|r[n+1]<<8|r[n]);return e},td=5,px=11,gx=2,Dst=px-td,HP=65536>>td,Nst=1<<td,mx=Nst-1,kst=1024>>td,Qst=HP+kst,Hst=Qst,zst=32,Gst=Hst+zst,Vst=65536>>px,jst=1<<Dst,qst=jst-1,zP=function(r,t,e){return r.slice?r.slice(t,e):new Uint16Array(Array.prototype.slice.call(r,t,e))},Kst=function(r,t,e){return r.slice?r.slice(t,e):new Uint32Array(Array.prototype.slice.call(r,t,e))},$st=function(r,t){var e=Ust(r),n=Array.isArray(e)?Ost(e):new Uint32Array(e),i=Array.isArray(e)?Rst(e):new Uint16Array(e),s=24,a=zP(i,s/2,n[4]/2),o=n[5]===2?zP(i,(s+n[4])/2):Kst(n,Math.ceil((s+n[4])/4));return new Wst(n[0],n[1],n[2],n[3],a,o)},Wst=function(){function r(t,e,n,i,s,a){this.initialValue=t,this.errorValue=e,this.highStart=n,this.highValueIndex=i,this.index=s,this.data=a}return r.prototype.get=function(t){var e;if(t>=0){if(t<55296||t>56319&&t<=65535)return e=this.index[t>>td],e=(e<<gx)+(t&mx),this.data[e];if(t<=65535)return e=this.index[HP+(t-55296>>td)],e=(e<<gx)+(t&mx),this.data[e];if(t<this.highStart)return e=Gst-Vst+(t>>px),e=this.index[e],e+=t>>td&qst,e=this.index[e],e=(e<<gx)+(t&mx),this.data[e];if(t<=1114111)return this.data[this.highValueIndex]}return this.errorValue},r}(),GP="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Xst=typeof Uint8Array>"u"?[]:new Uint8Array(256),Yy=0;Yy<GP.length;Yy++)Xst[GP.charCodeAt(Yy)]=Yy;var Jst="KwAAAAAAAAAACA4AUD0AADAgAAACAAAAAAAIABAAGABAAEgAUABYAGAAaABgAGgAYgBqAF8AZwBgAGgAcQB5AHUAfQCFAI0AlQCdAKIAqgCyALoAYABoAGAAaABgAGgAwgDKAGAAaADGAM4A0wDbAOEA6QDxAPkAAQEJAQ8BFwF1AH0AHAEkASwBNAE6AUIBQQFJAVEBWQFhAWgBcAF4ATAAgAGGAY4BlQGXAZ8BpwGvAbUBvQHFAc0B0wHbAeMB6wHxAfkBAQIJAvEBEQIZAiECKQIxAjgCQAJGAk4CVgJeAmQCbAJ0AnwCgQKJApECmQKgAqgCsAK4ArwCxAIwAMwC0wLbAjAA4wLrAvMC+AIAAwcDDwMwABcDHQMlAy0DNQN1AD0DQQNJA0kDSQNRA1EDVwNZA1kDdQB1AGEDdQBpA20DdQN1AHsDdQCBA4kDkQN1AHUAmQOhA3UAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AKYDrgN1AHUAtgO+A8YDzgPWAxcD3gPjA+sD8wN1AHUA+wMDBAkEdQANBBUEHQQlBCoEFwMyBDgEYABABBcDSARQBFgEYARoBDAAcAQzAXgEgASIBJAEdQCXBHUAnwSnBK4EtgS6BMIEyAR1AHUAdQB1AHUAdQCVANAEYABgAGAAYABgAGAAYABgANgEYADcBOQEYADsBPQE/AQEBQwFFAUcBSQFLAU0BWQEPAVEBUsFUwVbBWAAYgVgAGoFcgV6BYIFigWRBWAAmQWfBaYFYABgAGAAYABgAKoFYACxBbAFuQW6BcEFwQXHBcEFwQXPBdMF2wXjBeoF8gX6BQIGCgYSBhoGIgYqBjIGOgZgAD4GRgZMBmAAUwZaBmAAYABgAGAAYABgAGAAYABgAGAAYABgAGIGYABpBnAGYABgAGAAYABgAGAAYABgAGAAYAB4Bn8GhQZgAGAAYAB1AHcDFQSLBmAAYABgAJMGdQA9A3UAmwajBqsGqwaVALMGuwbDBjAAywbSBtIG1QbSBtIG0gbSBtIG0gbdBuMG6wbzBvsGAwcLBxMHAwcbByMHJwcsBywHMQcsB9IGOAdAB0gHTgfSBkgHVgfSBtIG0gbSBtIG0gbSBtIG0gbSBiwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdgAGAALAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdbB2MHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB2kH0gZwB64EdQB1AHUAdQB1AHUAdQB1AHUHfQdgAIUHjQd1AHUAlQedB2AAYAClB6sHYACzB7YHvgfGB3UAzgfWBzMB3gfmB1EB7gf1B/0HlQENAQUIDQh1ABUIHQglCBcDLQg1CD0IRQhNCEEDUwh1AHUAdQBbCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIcAh3CHoIMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIgggwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAALAcsBywHLAcsBywHLAcsBywHLAcsB4oILAcsB44I0gaWCJ4Ipgh1AHUAqgiyCHUAdQB1AHUAdQB1AHUAdQB1AHUAtwh8AXUAvwh1AMUIyQjRCNkI4AjoCHUAdQB1AO4I9gj+CAYJDgkTCS0HGwkjCYIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiAAIAAAAFAAYABgAGIAXwBgAHEAdQBFAJUAogCyAKAAYABgAEIA4ABGANMA4QDxAMEBDwE1AFwBLAE6AQEBUQF4QkhCmEKoQrhCgAHIQsAB0MLAAcABwAHAAeDC6ABoAHDCwMMAAcABwAHAAdDDGMMAAcAB6MM4wwjDWMNow3jDaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAEjDqABWw6bDqABpg6gAaABoAHcDvwOPA+gAaABfA/8DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DpcPAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcAB9cPKwkyCToJMAB1AHUAdQBCCUoJTQl1AFUJXAljCWcJawkwADAAMAAwAHMJdQB2CX4JdQCECYoJjgmWCXUAngkwAGAAYABxAHUApgn3A64JtAl1ALkJdQDACTAAMAAwADAAdQB1AHUAdQB1AHUAdQB1AHUAowYNBMUIMAAwADAAMADICcsJ0wnZCRUE4QkwAOkJ8An4CTAAMAB1AAAKvwh1AAgKDwoXCh8KdQAwACcKLgp1ADYKqAmICT4KRgowADAAdQB1AE4KMAB1AFYKdQBeCnUAZQowADAAMAAwADAAMAAwADAAMAAVBHUAbQowADAAdQC5CXUKMAAwAHwBxAijBogEMgF9CoQKiASMCpQKmgqIBKIKqgquCogEDQG2Cr4KxgrLCjAAMADTCtsKCgHjCusK8Qr5CgELMAAwADAAMAB1AIsECQsRC3UANAEZCzAAMAAwADAAMAB1ACELKQswAHUANAExCzkLdQBBC0kLMABRC1kLMAAwADAAMAAwADAAdQBhCzAAMAAwAGAAYABpC3ELdwt/CzAAMACHC4sLkwubC58Lpwt1AK4Ltgt1APsDMAAwADAAMAAwADAAMAAwAL4LwwvLC9IL1wvdCzAAMADlC+kL8Qv5C/8LSQswADAAMAAwADAAMAAwADAAMAAHDDAAMAAwADAAMAAODBYMHgx1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1ACYMMAAwADAAdQB1AHUALgx1AHUAdQB1AHUAdQA2DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AD4MdQBGDHUAdQB1AHUAdQB1AEkMdQB1AHUAdQB1AFAMMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQBYDHUAdQB1AF8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUA+wMVBGcMMAAwAHwBbwx1AHcMfwyHDI8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAYABgAJcMMAAwADAAdQB1AJ8MlQClDDAAMACtDCwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB7UMLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AA0EMAC9DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAsBywHLAcsBywHLAcsBywHLQcwAMEMyAwsBywHLAcsBywHLAcsBywHLAcsBywHzAwwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1ANQM2QzhDDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMABgAGAAYABgAGAAYABgAOkMYADxDGAA+AwADQYNYABhCWAAYAAODTAAMAAwADAAFg1gAGAAHg37AzAAMAAwADAAYABgACYNYAAsDTQNPA1gAEMNPg1LDWAAYABgAGAAYABgAGAAYABgAGAAUg1aDYsGVglhDV0NcQBnDW0NdQ15DWAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAlQCBDZUAiA2PDZcNMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAnw2nDTAAMAAwADAAMAAwAHUArw23DTAAMAAwADAAMAAwADAAMAAwADAAMAB1AL8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQDHDTAAYABgAM8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA1w11ANwNMAAwAD0B5A0wADAAMAAwADAAMADsDfQN/A0EDgwOFA4wABsOMAAwADAAMAAwADAAMAAwANIG0gbSBtIG0gbSBtIG0gYjDigOwQUuDsEFMw7SBjoO0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGQg5KDlIOVg7SBtIGXg5lDm0OdQ7SBtIGfQ6EDooOjQ6UDtIGmg6hDtIG0gaoDqwO0ga0DrwO0gZgAGAAYADEDmAAYAAkBtIGzA5gANIOYADaDokO0gbSBt8O5w7SBu8O0gb1DvwO0gZgAGAAxA7SBtIG0gbSBtIGYABgAGAAYAAED2AAsAUMD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHJA8sBywHLAcsBywHLAccDywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywPLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAc0D9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHPA/SBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gYUD0QPlQCVAJUAMAAwADAAMACVAJUAlQCVAJUAlQCVAEwPMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA//8EAAQABAAEAAQABAAEAAQABAANAAMAAQABAAIABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQACgATABcAHgAbABoAHgAXABYAEgAeABsAGAAPABgAHABLAEsASwBLAEsASwBLAEsASwBLABgAGAAeAB4AHgATAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABYAGwASAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWAA0AEQAeAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAFAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJABYAGgAbABsAGwAeAB0AHQAeAE8AFwAeAA0AHgAeABoAGwBPAE8ADgBQAB0AHQAdAE8ATwAXAE8ATwBPABYAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAFAATwBAAE8ATwBPAEAATwBQAFAATwBQAB4AHgAeAB4AHgAeAB0AHQAdAB0AHgAdAB4ADgBQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgBQAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAkACQAJAAkACQAJAAkABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAFAAHgAeAB4AKwArAFAAUABQAFAAGABQACsAKwArACsAHgAeAFAAHgBQAFAAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUAAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAYAA0AKwArAB4AHgAbACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAB4ABAAEAB4ABAAEABMABAArACsAKwArACsAKwArACsAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAKwArACsAKwBWAFYAVgBWAB4AHgArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AGgAaABoAGAAYAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQAEwAEACsAEwATAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABLAEsASwBLAEsASwBLAEsASwBLABoAGQAZAB4AUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABMAUAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABABQAFAABAAEAB4ABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUAAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAFAABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQAUABQAB4AHgAYABMAUAArACsABAAbABsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAFAABAAEAAQABAAEAFAABAAEAAQAUAAEAAQABAAEAAQAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArACsAHgArAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAUAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEAA0ADQBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUAArACsAKwBQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABABQACsAKwArACsAKwArACsAKwAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUAAaABoAUABQAFAAUABQAEwAHgAbAFAAHgAEACsAKwAEAAQABAArAFAAUABQAFAAUABQACsAKwArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQACsAUABQACsAKwAEACsABAAEAAQABAAEACsAKwArACsABAAEACsAKwAEAAQABAArACsAKwAEACsAKwArACsAKwArACsAUABQAFAAUAArAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLAAQABABQAFAAUAAEAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAArACsAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AGwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAKwArACsAKwArAAQABAAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAAQAUAArAFAAUABQAFAAUABQACsAKwArAFAAUABQACsAUABQAFAAUAArACsAKwBQAFAAKwBQACsAUABQACsAKwArAFAAUAArACsAKwBQAFAAUAArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArAAQABAAEAAQABAArACsAKwAEAAQABAArAAQABAAEAAQAKwArAFAAKwArACsAKwArACsABAArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAHgAeAB4AHgAeAB4AGwAeACsAKwArACsAKwAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAUABQAFAAKwArACsAKwArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwAOAFAAUABQAFAAUABQAFAAHgBQAAQABAAEAA4AUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAKwArAAQAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAKwArACsAKwArACsAUAArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAFAABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQABABQAB4AKwArACsAKwBQAFAAUAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQABoAUABQAFAAUABQAFAAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQACsAUAArACsAUABQAFAAUABQAFAAUAArACsAKwAEACsAKwArACsABAAEAAQABAAEAAQAKwAEACsABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArAAQABAAeACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAXAAqACoAKgAqACoAKgAqACsAKwArACsAGwBcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAeAEsASwBLAEsASwBLAEsASwBLAEsADQANACsAKwArACsAKwBcAFwAKwBcACsAXABcAFwAXABcACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAXAArAFwAXABcAFwAXABcAFwAXABcAFwAKgBcAFwAKgAqACoAKgAqACoAKgAqACoAXAArACsAXABcAFwAXABcACsAXAArACoAKgAqACoAKgAqACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwBcAFwAXABcAFAADgAOAA4ADgAeAA4ADgAJAA4ADgANAAkAEwATABMAEwATAAkAHgATAB4AHgAeAAQABAAeAB4AHgAeAB4AHgBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQAFAADQAEAB4ABAAeAAQAFgARABYAEQAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAAQABAAEAAQADQAEAAQAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAA0ADQAeAB4AHgAeAB4AHgAEAB4AHgAeAB4AHgAeACsAHgAeAA4ADgANAA4AHgAeAB4AHgAeAAkACQArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgBcAEsASwBLAEsASwBLAEsASwBLAEsADQANAB4AHgAeAB4AXABcAFwAXABcAFwAKgAqACoAKgBcAFwAXABcACoAKgAqAFwAKgAqACoAXABcACoAKgAqACoAKgAqACoAXABcAFwAKgAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqAFwAKgBLAEsASwBLAEsASwBLAEsASwBLACoAKgAqACoAKgAqAFAAUABQAFAAUABQACsAUAArACsAKwArACsAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAKwBQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsABAAEAAQAHgANAB4AHgAeAB4AHgAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUAArACsADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWABEAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQANAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAANAA0AKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUAArAAQABAArACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqAA0ADQAVAFwADQAeAA0AGwBcACoAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwAeAB4AEwATAA0ADQAOAB4AEwATAB4ABAAEAAQACQArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAHgArACsAKwATABMASwBLAEsASwBLAEsASwBLAEsASwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAXABcAFwAXABcACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAXAArACsAKwAqACoAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsAHgAeAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKwAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKwArAAQASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACoAKgAqACoAKgAqACoAXAAqACoAKgAqACoAKgArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABABQAFAAUABQAFAAUABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwANAA0AHgANAA0ADQANAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwAeAB4AHgAeAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArAA0ADQANAA0ADQBLAEsASwBLAEsASwBLAEsASwBLACsAKwArAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUAAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAAQAUABQAFAAUABQAFAABABQAFAABAAEAAQAUAArACsAKwArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQACsAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAFAAUABQACsAHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQACsAKwAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQACsAHgAeAB4AHgAeAB4AHgAOAB4AKwANAA0ADQANAA0ADQANAAkADQANAA0ACAAEAAsABAAEAA0ACQANAA0ADAAdAB0AHgAXABcAFgAXABcAFwAWABcAHQAdAB4AHgAUABQAFAANAAEAAQAEAAQABAAEAAQACQAaABoAGgAaABoAGgAaABoAHgAXABcAHQAVABUAHgAeAB4AHgAeAB4AGAAWABEAFQAVABUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ADQAeAA0ADQANAA0AHgANAA0ADQAHAB4AHgAeAB4AKwAEAAQABAAEAAQABAAEAAQABAAEAFAAUAArACsATwBQAFAAUABQAFAAHgAeAB4AFgARAE8AUABPAE8ATwBPAFAAUABQAFAAUAAeAB4AHgAWABEAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArABsAGwAbABsAGwAbABsAGgAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGgAbABsAGwAbABoAGwAbABoAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAHgAeAFAAGgAeAB0AHgBQAB4AGgAeAB4AHgAeAB4AHgAeAB4AHgBPAB4AUAAbAB4AHgBQAFAAUABQAFAAHgAeAB4AHQAdAB4AUAAeAFAAHgBQAB4AUABPAFAAUAAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgBQAFAAUABQAE8ATwBQAFAAUABQAFAATwBQAFAATwBQAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAUABQAFAATwBPAE8ATwBPAE8ATwBPAE8ATwBQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABPAB4AHgArACsAKwArAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHQAdAB4AHgAeAB0AHQAeAB4AHQAeAB4AHgAdAB4AHQAbABsAHgAdAB4AHgAeAB4AHQAeAB4AHQAdAB0AHQAeAB4AHQAeAB0AHgAdAB0AHQAdAB0AHQAeAB0AHgAeAB4AHgAeAB0AHQAdAB0AHgAeAB4AHgAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHgAeAB0AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAeAB0AHQAdAB0AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAdAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAWABEAHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAWABEAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AHQAdAB0AHgAeAB0AHgAeAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlAB4AHQAdAB4AHgAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AJQAlAB0AHQAlAB4AJQAlACUAIAAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAdAB0AHQAeAB0AJQAdAB0AHgAdAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAdAB0AHQAdACUAHgAlACUAJQAdACUAJQAdAB0AHQAlACUAHQAdACUAHQAdACUAJQAlAB4AHQAeAB4AHgAeAB0AHQAlAB0AHQAdAB0AHQAdACUAJQAlACUAJQAdACUAJQAgACUAHQAdACUAJQAlACUAJQAlACUAJQAeAB4AHgAlACUAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AFwAXABcAFwAXABcAHgATABMAJQAeAB4AHgAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARABYAEQAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAEAAQABAAeAB4AKwArACsAKwArABMADQANAA0AUAATAA0AUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUAANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAA0ADQANAA0ADQANAA0ADQAeAA0AFgANAB4AHgAXABcAHgAeABcAFwAWABEAFgARABYAEQAWABEADQANAA0ADQATAFAADQANAB4ADQANAB4AHgAeAB4AHgAMAAwADQANAA0AHgANAA0AFgANAA0ADQANAA0ADQANAA0AHgANAB4ADQANAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArAA0AEQARACUAJQBHAFcAVwAWABEAFgARABYAEQAWABEAFgARACUAJQAWABEAFgARABYAEQAWABEAFQAWABEAEQAlAFcAVwBXAFcAVwBXAFcAVwBXAAQABAAEAAQABAAEACUAVwBXAFcAVwA2ACUAJQBXAFcAVwBHAEcAJQAlACUAKwBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBRAFcAUQBXAFEAVwBXAFcAVwBXAFcAUQBXAFcAVwBXAFcAVwBRAFEAKwArAAQABAAVABUARwBHAFcAFQBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBRAFcAVwBXAFcAVwBXAFEAUQBXAFcAVwBXABUAUQBHAEcAVwArACsAKwArACsAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwAlACUAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACsAKwArACsAKwArACsAKwArACsAKwArAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBPAE8ATwBPAE8ATwBPAE8AJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADQATAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABLAEsASwBLAEsASwBLAEsASwBLAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAABAAEAAQABAAeAAQABAAEAAQABAAEAAQABAAEAAQAHgBQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAeAA0ADQANAA0ADQArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAAQAUABQAFAABABQAFAAUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAeAB4AHgAeAAQAKwArACsAUABQAFAAUABQAFAAHgAeABoAHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADgAOABMAEwArACsAKwArACsAKwArACsABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwANAA0ASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUAAeAB4AHgBQAA4AUABQAAQAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArAB4AWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYACsAKwArAAQAHgAeAB4AHgAeAB4ADQANAA0AHgAeAB4AHgArAFAASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArAB4AHgBcAFwAXABcAFwAKgBcAFwAXABcAFwAXABcAFwAXABcAEsASwBLAEsASwBLAEsASwBLAEsAXABcAFwAXABcACsAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAFAAUABQAAQAUABQAFAAUABQAFAAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAHgANAA0ADQBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAXAAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAKgAqACoAXABcACoAKgBcAFwAXABcAFwAKgAqAFwAKgBcACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcACoAKgBQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAA0ADQBQAFAAUAAEAAQAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQADQAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAVABVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBUAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVACsAKwArACsAKwArACsAKwArACsAKwArAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAKwArACsAKwBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAKwArACsAKwAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAKwArACsAKwArAFYABABWAFYAVgBWAFYAVgBWAFYAVgBWAB4AVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgArAFYAVgBWAFYAVgArAFYAKwBWAFYAKwBWAFYAKwBWAFYAVgBWAFYAVgBWAFYAVgBWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAEQAWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAaAB4AKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAGAARABEAGAAYABMAEwAWABEAFAArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACUAJQAlACUAJQAWABEAFgARABYAEQAWABEAFgARABYAEQAlACUAFgARACUAJQAlACUAJQAlACUAEQAlABEAKwAVABUAEwATACUAFgARABYAEQAWABEAJQAlACUAJQAlACUAJQAlACsAJQAbABoAJQArACsAKwArAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAcAKwATACUAJQAbABoAJQAlABYAEQAlACUAEQAlABEAJQBXAFcAVwBXAFcAVwBXAFcAVwBXABUAFQAlACUAJQATACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXABYAJQARACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAWACUAEQAlABYAEQARABYAEQARABUAVwBRAFEAUQBRAFEAUQBRAFEAUQBRAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcARwArACsAVwBXAFcAVwBXAFcAKwArAFcAVwBXAFcAVwBXACsAKwBXAFcAVwBXAFcAVwArACsAVwBXAFcAKwArACsAGgAbACUAJQAlABsAGwArAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAAQAB0AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsADQANAA0AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAA0AUABQAFAAUAArACsAKwArAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwArAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwBQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAUABQAFAAUABQAAQABAAEACsABAAEACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAKwBQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAA0ADQANAA0ADQANAA0ADQAeACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAArACsAKwArAFAAUABQAFAAUAANAA0ADQANAA0ADQAUACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsADQANAA0ADQANAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArAAQABAANACsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAB4AHgAeAB4AHgArACsAKwArACsAKwAEAAQABAAEAAQABAAEAA0ADQAeAB4AHgAeAB4AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsASwBLAEsASwBLAEsASwBLAEsASwANAA0ADQANAFAABAAEAFAAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAeAA4AUAArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAADQANAB4ADQAEAAQABAAEAB4ABAAEAEsASwBLAEsASwBLAEsASwBLAEsAUAAOAFAADQANAA0AKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAANAA0AHgANAA0AHgAEACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAA0AKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsABAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsABAAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAUAArACsAKwArACsAKwAEACsAKwArACsAKwBQAFAAUABQAFAABAAEACsAKwAEAAQABAAEAAQABAAEACsAKwArAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAQABABQAFAAUABQAA0ADQANAA0AHgBLAEsASwBLAEsASwBLAEsASwBLAA0ADQArAB4ABABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUAAeAFAAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABAAEAAQADgANAA0AEwATAB4AHgAeAA0ADQANAA0ADQANAA0ADQANAA0ADQANAA0ADQANAFAAUABQAFAABAAEACsAKwAEAA0ADQAeAFAAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKwArACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBcAFwADQANAA0AKgBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAKwArAFAAKwArAFAAUABQAFAAUABQAFAAUAArAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQAKwAEAAQAKwArAAQABAAEAAQAUAAEAFAABAAEAA0ADQANACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABABQAA4AUAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAFAABAAEAAQABAAOAB4ADQANAA0ADQAOAB4ABAArACsAKwArACsAKwArACsAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAA0ADQANAFAADgAOAA4ADQANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAAQABAAEAFAADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAOABMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAArACsAKwAEACsABAAEACsABAAEAAQABAAEAAQABABQAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAaABoAGgAaAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABIAEgAQwBDAEMAUABQAFAAUABDAFAAUABQAEgAQwBIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABDAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAJAAkACQAJAAkACQAJABYAEQArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwANAA0AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAANACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAA0ADQANAB4AHgAeAB4AHgAeAFAAUABQAFAADQAeACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAA0AHgAeACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAARwBHABUARwAJACsAKwArACsAKwArACsAKwArACsAKwAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUQBRAFEAKwArACsAKwArACsAKwArACsAKwArACsAKwBRAFEAUQBRACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAHgAEAAQADQAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQABAAEAAQABAAeAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQAHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAKwArAFAAKwArAFAAUAArACsAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUAArAFAAUABQAFAAUABQAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAHgAeAFAAUABQAFAAUAArAFAAKwArACsAUABQAFAAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeACsAKwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4ABAAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAHgAeAA0ADQANAA0AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArAAQABAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwBQAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArABsAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAB4AHgAeAB4ABAAEAAQABAAEAAQABABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArABYAFgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAGgBQAFAAUAAaAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUAArACsAKwArACsAKwBQACsAKwArACsAUAArAFAAKwBQACsAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUAArAFAAKwBQACsAUAArAFAAUAArAFAAKwArAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAKwBQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8AJQAlACUAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB4AHgAeACUAJQAlAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAlACUAJQAlACUAHgAlACUAJQAlACUAIAAgACAAJQAlACAAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACEAIQAhACEAIQAlACUAIAAgACUAJQAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAIAAlACUAJQAlACAAIAAgACUAIAAgACAAJQAlACUAJQAlACUAJQAgACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAlAB4AJQAeACUAJQAlACUAJQAgACUAJQAlACUAHgAlAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACAAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABcAFwAXABUAFQAVAB4AHgAeAB4AJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAgACUAJQAgACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAIAAgACUAJQAgACAAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACAAIAAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACAAIAAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAA==",VP=50,Yst=1,jP=2,qP=3,Zst=4,tot=5,KP=7,$P=8,WP=9,KA=10,yx=11,XP=12,_x=13,eot=14,jg=15,vx=16,Zy=17,qg=18,rot=19,JP=20,bx=21,Kg=22,wx=23,Df=24,Qa=25,$g=26,Wg=27,Nf=28,not=29,kf=30,iot=31,t1=32,e1=33,xx=34,Bx=35,Cx=36,Xg=37,Ex=38,r1=39,n1=40,Sx=41,YP=42,sot=43,oot=[9001,65288],ZP="!",ko="",i1="",Tx=$st(Jst),Gu=[kf,Cx],Ix=[Yst,jP,qP,tot],tM=[KA,$P],eM=[Wg,$g],aot=Ix.concat(tM),rM=[Ex,r1,n1,xx,Bx],cot=[jg,_x],lot=function(r,t){t===void 0&&(t="strict");var e=[],n=[],i=[];return r.forEach(function(s,a){var o=Tx.get(s);if(o>VP?(i.push(!0),o-=VP):i.push(!1),["normal","auto","loose"].indexOf(t)!==-1&&[8208,8211,12316,12448].indexOf(s)!==-1)return n.push(a),e.push(vx);if(o===Zst||o===yx){if(a===0)return n.push(a),e.push(kf);var A=e[a-1];return aot.indexOf(A)===-1?(n.push(n[a-1]),e.push(A)):(n.push(a),e.push(kf))}if(n.push(a),o===iot)return e.push(t==="strict"?bx:Xg);if(o===YP||o===not)return e.push(kf);if(o===sot)return s>=131072&&s<=196605||s>=196608&&s<=262141?e.push(Xg):e.push(kf);e.push(o)}),[n,e,i]},Lx=function(r,t,e,n){var i=n[e];if(Array.isArray(r)?r.indexOf(i)!==-1:r===i)for(var s=e;s<=n.length;){s++;var a=n[s];if(a===t)return!0;if(a!==KA)break}if(i===KA)for(var s=e;s>0;){s--;var o=n[s];if(Array.isArray(r)?r.indexOf(o)!==-1:r===o)for(var A=e;A<=n.length;){A++;var a=n[A];if(a===t)return!0;if(a!==KA)break}if(o!==KA)break}return!1},nM=function(r,t){for(var e=r;e>=0;){var n=t[e];if(n===KA)e--;else return n}return 0},uot=function(r,t,e,n,i){if(e[n]===0)return ko;var s=n-1;if(Array.isArray(i)&&i[s]===!0)return ko;var a=s-1,o=s+1,A=t[s],f=a>=0?t[a]:0,m=t[o];if(A===jP&&m===qP)return ko;if(Ix.indexOf(A)!==-1)return ZP;if(Ix.indexOf(m)!==-1||tM.indexOf(m)!==-1)return ko;if(nM(s,t)===$P)return i1;if(Tx.get(r[s])===yx||(A===t1||A===e1)&&Tx.get(r[o])===yx||A===KP||m===KP||A===WP||[KA,_x,jg].indexOf(A)===-1&&m===WP||[Zy,qg,rot,Df,Nf].indexOf(m)!==-1||nM(s,t)===Kg||Lx(wx,Kg,s,t)||Lx([Zy,qg],bx,s,t)||Lx(XP,XP,s,t))return ko;if(A===KA)return i1;if(A===wx||m===wx)return ko;if(m===vx||A===vx)return i1;if([_x,jg,bx].indexOf(m)!==-1||A===eot||f===Cx&&cot.indexOf(A)!==-1||A===Nf&&m===Cx||m===JP||Gu.indexOf(m)!==-1&&A===Qa||Gu.indexOf(A)!==-1&&m===Qa||A===Wg&&[Xg,t1,e1].indexOf(m)!==-1||[Xg,t1,e1].indexOf(A)!==-1&&m===$g||Gu.indexOf(A)!==-1&&eM.indexOf(m)!==-1||eM.indexOf(A)!==-1&&Gu.indexOf(m)!==-1||[Wg,$g].indexOf(A)!==-1&&(m===Qa||[Kg,jg].indexOf(m)!==-1&&t[o+1]===Qa)||[Kg,jg].indexOf(A)!==-1&&m===Qa||A===Qa&&[Qa,Nf,Df].indexOf(m)!==-1)return ko;if([Qa,Nf,Df,Zy,qg].indexOf(m)!==-1)for(var _=s;_>=0;){var x=t[_];if(x===Qa)return ko;if([Nf,Df].indexOf(x)!==-1)_--;else break}if([Wg,$g].indexOf(m)!==-1)for(var _=[Zy,qg].indexOf(A)!==-1?a:s;_>=0;){var x=t[_];if(x===Qa)return ko;if([Nf,Df].indexOf(x)!==-1)_--;else break}if(Ex===A&&[Ex,r1,xx,Bx].indexOf(m)!==-1||[r1,xx].indexOf(A)!==-1&&[r1,n1].indexOf(m)!==-1||[n1,Bx].indexOf(A)!==-1&&m===n1||rM.indexOf(A)!==-1&&[JP,$g].indexOf(m)!==-1||rM.indexOf(m)!==-1&&A===Wg||Gu.indexOf(A)!==-1&&Gu.indexOf(m)!==-1||A===Df&&Gu.indexOf(m)!==-1||Gu.concat(Qa).indexOf(A)!==-1&&m===Kg&&oot.indexOf(r[o])===-1||Gu.concat(Qa).indexOf(m)!==-1&&A===qg)return ko;if(A===Sx&&m===Sx){for(var B=e[s],P=1;B>0&&(B--,t[B]===Sx);)P++;if(P%2!==0)return ko}return A===t1&&m===e1?ko:i1},Aot=function(r,t){t||(t={lineBreak:"normal",wordBreak:"normal"});var e=lot(r,t.lineBreak),n=e[0],i=e[1],s=e[2];(t.wordBreak==="break-all"||t.wordBreak==="break-word")&&(i=i.map(function(o){return[Qa,kf,YP].indexOf(o)!==-1?Xg:o}));var a=t.wordBreak==="keep-all"?s.map(function(o,A){return o&&r[A]>=19968&&r[A]<=40959}):void 0;return[n,i,a]},hot=function(){function r(t,e,n,i){this.codePoints=t,this.required=e===ZP,this.start=n,this.end=i}return r.prototype.slice=function(){return rs.apply(void 0,this.codePoints.slice(this.start,this.end))},r}(),dot=function(r,t){var e=Wy(r),n=Aot(e,t),i=n[0],s=n[1],a=n[2],o=e.length,A=0,f=0;return{next:function(){if(f>=o)return{done:!0,value:null};for(var m=ko;f<o&&(m=uot(e,s,i,++f,a))===ko;);if(m!==ko||f===o){var _=new hot(e,m,A,f);return A=f,{value:_,done:!1}}return{done:!0,value:null}}}},fot=1,pot=2,Jg=4,iM=8,s1=10,sM=47,Yg=92,got=9,mot=32,o1=34,Zg=61,yot=35,_ot=36,vot=37,a1=39,c1=40,tm=41,bot=95,pa=45,wot=33,xot=60,Bot=62,Cot=64,Eot=91,Sot=93,Tot=61,Iot=123,l1=63,Lot=125,oM=124,Fot=126,Pot=128,aM=65533,Fx=42,ed=43,Mot=44,Uot=58,Rot=59,em=46,Oot=0,Dot=8,Not=11,kot=14,Qot=31,Hot=127,tu=-1,cM=48,lM=97,uM=101,zot=102,Got=117,Vot=122,AM=65,hM=69,dM=70,jot=85,qot=90,Qo=function(r){return r>=cM&&r<=57},Kot=function(r){return r>=55296&&r<=57343},Qf=function(r){return Qo(r)||r>=AM&&r<=dM||r>=lM&&r<=zot},$ot=function(r){return r>=lM&&r<=Vot},Wot=function(r){return r>=AM&&r<=qot},Xot=function(r){return $ot(r)||Wot(r)},Jot=function(r){return r>=Pot},u1=function(r){return r===s1||r===got||r===mot},A1=function(r){return Xot(r)||Jot(r)||r===bot},fM=function(r){return A1(r)||Qo(r)||r===pa},Yot=function(r){return r>=Oot&&r<=Dot||r===Not||r>=kot&&r<=Qot||r===Hot},$A=function(r,t){return r!==Yg?!1:t!==s1},h1=function(r,t,e){return r===pa?A1(t)||$A(t,e):A1(r)?!0:!!(r===Yg&&$A(r,t))},Px=function(r,t,e){return r===ed||r===pa?Qo(t)?!0:t===em&&Qo(e):Qo(r===em?t:r)},Zot=function(r){var t=0,e=1;(r[t]===ed||r[t]===pa)&&(r[t]===pa&&(e=-1),t++);for(var n=[];Qo(r[t]);)n.push(r[t++]);var i=n.length?parseInt(rs.apply(void 0,n),10):0;r[t]===em&&t++;for(var s=[];Qo(r[t]);)s.push(r[t++]);var a=s.length,o=a?parseInt(rs.apply(void 0,s),10):0;(r[t]===hM||r[t]===uM)&&t++;var A=1;(r[t]===ed||r[t]===pa)&&(r[t]===pa&&(A=-1),t++);for(var f=[];Qo(r[t]);)f.push(r[t++]);var m=f.length?parseInt(rs.apply(void 0,f),10):0;return e*(i+o*Math.pow(10,-a))*Math.pow(10,A*m)},tat={type:2},eat={type:3},rat={type:4},nat={type:13},iat={type:8},sat={type:21},oat={type:9},aat={type:10},cat={type:11},lat={type:12},uat={type:14},d1={type:23},Aat={type:1},hat={type:25},dat={type:24},fat={type:26},pat={type:27},gat={type:28},mat={type:29},yat={type:31},Mx={type:32},pM=function(){function r(){this._value=[]}return r.prototype.write=function(t){this._value=this._value.concat(Wy(t))},r.prototype.read=function(){for(var t=[],e=this.consumeToken();e!==Mx;)t.push(e),e=this.consumeToken();return t},r.prototype.consumeToken=function(){var t=this.consumeCodePoint();switch(t){case o1:return this.consumeStringToken(o1);case yot:var e=this.peekCodePoint(0),n=this.peekCodePoint(1),i=this.peekCodePoint(2);if(fM(e)||$A(n,i)){var s=h1(e,n,i)?pot:fot,a=this.consumeName();return{type:5,value:a,flags:s}}break;case _ot:if(this.peekCodePoint(0)===Zg)return this.consumeCodePoint(),nat;break;case a1:return this.consumeStringToken(a1);case c1:return tat;case tm:return eat;case Fx:if(this.peekCodePoint(0)===Zg)return this.consumeCodePoint(),uat;break;case ed:if(Px(t,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(t),this.consumeNumericToken();break;case Mot:return rat;case pa:var o=t,A=this.peekCodePoint(0),f=this.peekCodePoint(1);if(Px(o,A,f))return this.reconsumeCodePoint(t),this.consumeNumericToken();if(h1(o,A,f))return this.reconsumeCodePoint(t),this.consumeIdentLikeToken();if(A===pa&&f===Bot)return this.consumeCodePoint(),this.consumeCodePoint(),dat;break;case em:if(Px(t,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(t),this.consumeNumericToken();break;case sM:if(this.peekCodePoint(0)===Fx)for(this.consumeCodePoint();;){var m=this.consumeCodePoint();if(m===Fx&&(m=this.consumeCodePoint(),m===sM))return this.consumeToken();if(m===tu)return this.consumeToken()}break;case Uot:return fat;case Rot:return pat;case xot:if(this.peekCodePoint(0)===wot&&this.peekCodePoint(1)===pa&&this.peekCodePoint(2)===pa)return this.consumeCodePoint(),this.consumeCodePoint(),hat;break;case Cot:var _=this.peekCodePoint(0),x=this.peekCodePoint(1),B=this.peekCodePoint(2);if(h1(_,x,B)){var a=this.consumeName();return{type:7,value:a}}break;case Eot:return gat;case Yg:if($A(t,this.peekCodePoint(0)))return this.reconsumeCodePoint(t),this.consumeIdentLikeToken();break;case Sot:return mat;case Tot:if(this.peekCodePoint(0)===Zg)return this.consumeCodePoint(),iat;break;case Iot:return cat;case Lot:return lat;case Got:case jot:var P=this.peekCodePoint(0),M=this.peekCodePoint(1);return P===ed&&(Qf(M)||M===l1)&&(this.consumeCodePoint(),this.consumeUnicodeRangeToken()),this.reconsumeCodePoint(t),this.consumeIdentLikeToken();case oM:if(this.peekCodePoint(0)===Zg)return this.consumeCodePoint(),oat;if(this.peekCodePoint(0)===oM)return this.consumeCodePoint(),sat;break;case Fot:if(this.peekCodePoint(0)===Zg)return this.consumeCodePoint(),aat;break;case tu:return Mx}return u1(t)?(this.consumeWhiteSpace(),yat):Qo(t)?(this.reconsumeCodePoint(t),this.consumeNumericToken()):A1(t)?(this.reconsumeCodePoint(t),this.consumeIdentLikeToken()):{type:6,value:rs(t)}},r.prototype.consumeCodePoint=function(){var t=this._value.shift();return typeof t>"u"?-1:t},r.prototype.reconsumeCodePoint=function(t){this._value.unshift(t)},r.prototype.peekCodePoint=function(t){return t>=this._value.length?-1:this._value[t]},r.prototype.consumeUnicodeRangeToken=function(){for(var t=[],e=this.consumeCodePoint();Qf(e)&&t.length<6;)t.push(e),e=this.consumeCodePoint();for(var n=!1;e===l1&&t.length<6;)t.push(e),e=this.consumeCodePoint(),n=!0;if(n){var i=parseInt(rs.apply(void 0,t.map(function(A){return A===l1?cM:A})),16),s=parseInt(rs.apply(void 0,t.map(function(A){return A===l1?dM:A})),16);return{type:30,start:i,end:s}}var a=parseInt(rs.apply(void 0,t),16);if(this.peekCodePoint(0)===pa&&Qf(this.peekCodePoint(1))){this.consumeCodePoint(),e=this.consumeCodePoint();for(var o=[];Qf(e)&&o.length<6;)o.push(e),e=this.consumeCodePoint();var s=parseInt(rs.apply(void 0,o),16);return{type:30,start:a,end:s}}else return{type:30,start:a,end:a}},r.prototype.consumeIdentLikeToken=function(){var t=this.consumeName();return t.toLowerCase()==="url"&&this.peekCodePoint(0)===c1?(this.consumeCodePoint(),this.consumeUrlToken()):this.peekCodePoint(0)===c1?(this.consumeCodePoint(),{type:19,value:t}):{type:20,value:t}},r.prototype.consumeUrlToken=function(){var t=[];if(this.consumeWhiteSpace(),this.peekCodePoint(0)===tu)return{type:22,value:""};var e=this.peekCodePoint(0);if(e===a1||e===o1){var n=this.consumeStringToken(this.consumeCodePoint());return n.type===0&&(this.consumeWhiteSpace(),this.peekCodePoint(0)===tu||this.peekCodePoint(0)===tm)?(this.consumeCodePoint(),{type:22,value:n.value}):(this.consumeBadUrlRemnants(),d1)}for(;;){var i=this.consumeCodePoint();if(i===tu||i===tm)return{type:22,value:rs.apply(void 0,t)};if(u1(i))return this.consumeWhiteSpace(),this.peekCodePoint(0)===tu||this.peekCodePoint(0)===tm?(this.consumeCodePoint(),{type:22,value:rs.apply(void 0,t)}):(this.consumeBadUrlRemnants(),d1);if(i===o1||i===a1||i===c1||Yot(i))return this.consumeBadUrlRemnants(),d1;if(i===Yg)if($A(i,this.peekCodePoint(0)))t.push(this.consumeEscapedCodePoint());else return this.consumeBadUrlRemnants(),d1;else t.push(i)}},r.prototype.consumeWhiteSpace=function(){for(;u1(this.peekCodePoint(0));)this.consumeCodePoint()},r.prototype.consumeBadUrlRemnants=function(){for(;;){var t=this.consumeCodePoint();if(t===tm||t===tu)return;$A(t,this.peekCodePoint(0))&&this.consumeEscapedCodePoint()}},r.prototype.consumeStringSlice=function(t){for(var e=5e4,n="";t>0;){var i=Math.min(e,t);n+=rs.apply(void 0,this._value.splice(0,i)),t-=i}return this._value.shift(),n},r.prototype.consumeStringToken=function(t){var e="",n=0;do{var i=this._value[n];if(i===tu||i===void 0||i===t)return e+=this.consumeStringSlice(n),{type:0,value:e};if(i===s1)return this._value.splice(0,n),Aat;if(i===Yg){var s=this._value[n+1];s!==tu&&s!==void 0&&(s===s1?(e+=this.consumeStringSlice(n),n=-1,this._value.shift()):$A(i,s)&&(e+=this.consumeStringSlice(n),e+=rs(this.consumeEscapedCodePoint()),n=-1))}n++}while(!0)},r.prototype.consumeNumber=function(){var t=[],e=Jg,n=this.peekCodePoint(0);for((n===ed||n===pa)&&t.push(this.consumeCodePoint());Qo(this.peekCodePoint(0));)t.push(this.consumeCodePoint());n=this.peekCodePoint(0);var i=this.peekCodePoint(1);if(n===em&&Qo(i))for(t.push(this.consumeCodePoint(),this.consumeCodePoint()),e=iM;Qo(this.peekCodePoint(0));)t.push(this.consumeCodePoint());n=this.peekCodePoint(0),i=this.peekCodePoint(1);var s=this.peekCodePoint(2);if((n===hM||n===uM)&&((i===ed||i===pa)&&Qo(s)||Qo(i)))for(t.push(this.consumeCodePoint(),this.consumeCodePoint()),e=iM;Qo(this.peekCodePoint(0));)t.push(this.consumeCodePoint());return[Zot(t),e]},r.prototype.consumeNumericToken=function(){var t=this.consumeNumber(),e=t[0],n=t[1],i=this.peekCodePoint(0),s=this.peekCodePoint(1),a=this.peekCodePoint(2);if(h1(i,s,a)){var o=this.consumeName();return{type:15,number:e,flags:n,unit:o}}return i===vot?(this.consumeCodePoint(),{type:16,number:e,flags:n}):{type:17,number:e,flags:n}},r.prototype.consumeEscapedCodePoint=function(){var t=this.consumeCodePoint();if(Qf(t)){for(var e=rs(t);Qf(this.peekCodePoint(0))&&e.length<6;)e+=rs(this.consumeCodePoint());u1(this.peekCodePoint(0))&&this.consumeCodePoint();var n=parseInt(e,16);return n===0||Kot(n)||n>1114111?aM:n}return t===tu?aM:t},r.prototype.consumeName=function(){for(var t="";;){var e=this.consumeCodePoint();if(fM(e))t+=rs(e);else if($A(e,this.peekCodePoint(0)))t+=rs(this.consumeEscapedCodePoint());else return this.reconsumeCodePoint(e),t}},r}(),gM=function(){function r(t){this._tokens=t}return r.create=function(t){var e=new pM;return e.write(t),new r(e.read())},r.parseValue=function(t){return r.create(t).parseComponentValue()},r.parseValues=function(t){return r.create(t).parseComponentValues()},r.prototype.parseComponentValue=function(){for(var t=this.consumeToken();t.type===31;)t=this.consumeToken();if(t.type===32)throw new SyntaxError("Error parsing CSS component value, unexpected EOF");this.reconsumeToken(t);var e=this.consumeComponentValue();do t=this.consumeToken();while(t.type===31);if(t.type===32)return e;throw new SyntaxError("Error parsing CSS component value, multiple values found when expecting only one")},r.prototype.parseComponentValues=function(){for(var t=[];;){var e=this.consumeComponentValue();if(e.type===32)return t;t.push(e),t.push()}},r.prototype.consumeComponentValue=function(){var t=this.consumeToken();switch(t.type){case 11:case 28:case 2:return this.consumeSimpleBlock(t.type);case 19:return this.consumeFunction(t)}return t},r.prototype.consumeSimpleBlock=function(t){for(var e={type:t,values:[]},n=this.consumeToken();;){if(n.type===32||vat(n,t))return e;this.reconsumeToken(n),e.values.push(this.consumeComponentValue()),n=this.consumeToken()}},r.prototype.consumeFunction=function(t){for(var e={name:t.value,values:[],type:18};;){var n=this.consumeToken();if(n.type===32||n.type===3)return e;this.reconsumeToken(n),e.values.push(this.consumeComponentValue())}},r.prototype.consumeToken=function(){var t=this._tokens.shift();return typeof t>"u"?Mx:t},r.prototype.reconsumeToken=function(t){this._tokens.unshift(t)},r}(),rm=function(r){return r.type===15},Hf=function(r){return r.type===17},si=function(r){return r.type===20},_at=function(r){return r.type===0},Ux=function(r,t){return si(r)&&r.value===t},mM=function(r){return r.type!==31},zf=function(r){return r.type!==31&&r.type!==4},eu=function(r){var t=[],e=[];return r.forEach(function(n){if(n.type===4){if(e.length===0)throw new Error("Error parsing function args, zero tokens for arg");t.push(e),e=[];return}n.type!==31&&e.push(n)}),e.length&&t.push(e),t},vat=function(r,t){return t===11&&r.type===12||t===28&&r.type===29?!0:t===2&&r.type===3},WA=function(r){return r.type===17||r.type===15},_s=function(r){return r.type===16||WA(r)},yM=function(r){return r.length>1?[r[0],r[1]]:[r[0]]},Xs={type:17,number:0,flags:Jg},Rx={type:16,number:50,flags:Jg},XA={type:16,number:100,flags:Jg},nm=function(r,t,e){var n=r[0],i=r[1];return[yi(n,t),yi(typeof i<"u"?i:n,e)]},yi=function(r,t){if(r.type===16)return r.number/100*t;if(rm(r))switch(r.unit){case"rem":case"em":return 16*r.number;case"px":default:return r.number}return r.number},_M="deg",vM="grad",bM="rad",wM="turn",f1={name:"angle",parse:function(r,t){if(t.type===15)switch(t.unit){case _M:return Math.PI*t.number/180;case vM:return Math.PI/200*t.number;case bM:return t.number;case wM:return Math.PI*2*t.number}throw new Error("Unsupported angle type")}},xM=function(r){return r.type===15&&(r.unit===_M||r.unit===vM||r.unit===bM||r.unit===wM)},BM=function(r){var t=r.filter(si).map(function(e){return e.value}).join(" ");switch(t){case"to bottom right":case"to right bottom":case"left top":case"top left":return[Xs,Xs];case"to top":case"bottom":return Ac(0);case"to bottom left":case"to left bottom":case"right top":case"top right":return[Xs,XA];case"to right":case"left":return Ac(90);case"to top left":case"to left top":case"right bottom":case"bottom right":return[XA,XA];case"to bottom":case"top":return Ac(180);case"to top right":case"to right top":case"left bottom":case"bottom left":return[XA,Xs];case"to left":case"right":return Ac(270)}return 0},Ac=function(r){return Math.PI*r/180},JA={name:"color",parse:function(r,t){if(t.type===18){var e=bat[t.name];if(typeof e>"u")throw new Error('Attempting to parse an unsupported color function "'+t.name+'"');return e(r,t.values)}if(t.type===5){if(t.value.length===3){var n=t.value.substring(0,1),i=t.value.substring(1,2),s=t.value.substring(2,3);return ZA(parseInt(n+n,16),parseInt(i+i,16),parseInt(s+s,16),1)}if(t.value.length===4){var n=t.value.substring(0,1),i=t.value.substring(1,2),s=t.value.substring(2,3),a=t.value.substring(3,4);return ZA(parseInt(n+n,16),parseInt(i+i,16),parseInt(s+s,16),parseInt(a+a,16)/255)}if(t.value.length===6){var n=t.value.substring(0,2),i=t.value.substring(2,4),s=t.value.substring(4,6);return ZA(parseInt(n,16),parseInt(i,16),parseInt(s,16),1)}if(t.value.length===8){var n=t.value.substring(0,2),i=t.value.substring(2,4),s=t.value.substring(4,6),a=t.value.substring(6,8);return ZA(parseInt(n,16),parseInt(i,16),parseInt(s,16),parseInt(a,16)/255)}}if(t.type===20){var o=Vu[t.value.toUpperCase()];if(typeof o<"u")return o}return Vu.TRANSPARENT}},YA=function(r){return(255&r)===0},Os=function(r){var t=255&r,e=255&r>>8,n=255&r>>16,i=255&r>>24;return t<255?"rgba("+i+","+n+","+e+","+t/255+")":"rgb("+i+","+n+","+e+")"},ZA=function(r,t,e,n){return(r<<24|t<<16|e<<8|Math.round(n*255)<<0)>>>0},CM=function(r,t){if(r.type===17)return r.number;if(r.type===16){var e=t===3?1:255;return t===3?r.number/100*e:Math.round(r.number/100*e)}return 0},EM=function(r,t){var e=t.filter(zf);if(e.length===3){var n=e.map(CM),i=n[0],s=n[1],a=n[2];return ZA(i,s,a,1)}if(e.length===4){var o=e.map(CM),i=o[0],s=o[1],a=o[2],A=o[3];return ZA(i,s,a,A)}return 0};function Ox(r,t,e){return e<0&&(e+=1),e>=1&&(e-=1),e<1/6?(t-r)*e*6+r:e<1/2?t:e<2/3?(t-r)*6*(2/3-e)+r:r}var SM=function(r,t){var e=t.filter(zf),n=e[0],i=e[1],s=e[2],a=e[3],o=(n.type===17?Ac(n.number):f1.parse(r,n))/(Math.PI*2),A=_s(i)?i.number/100:0,f=_s(s)?s.number/100:0,m=typeof a<"u"&&_s(a)?yi(a,1):1;if(A===0)return ZA(f*255,f*255,f*255,1);var _=f<=.5?f*(A+1):f+A-f*A,x=f*2-_,B=Ox(x,_,o+1/3),P=Ox(x,_,o),M=Ox(x,_,o-1/3);return ZA(B*255,P*255,M*255,m)},bat={hsl:SM,hsla:SM,rgb:EM,rgba:EM},im=function(r,t){return JA.parse(r,gM.create(t).parseComponentValue())},Vu={ALICEBLUE:4042850303,ANTIQUEWHITE:4209760255,AQUA:16777215,AQUAMARINE:2147472639,AZURE:4043309055,BEIGE:4126530815,BISQUE:4293182719,BLACK:255,BLANCHEDALMOND:4293643775,BLUE:65535,BLUEVIOLET:2318131967,BROWN:2771004159,BURLYWOOD:3736635391,CADETBLUE:1604231423,CHARTREUSE:2147418367,CHOCOLATE:3530104575,CORAL:4286533887,CORNFLOWERBLUE:1687547391,CORNSILK:4294499583,CRIMSON:3692313855,CYAN:16777215,DARKBLUE:35839,DARKCYAN:9145343,DARKGOLDENROD:3095837695,DARKGRAY:2846468607,DARKGREEN:6553855,DARKGREY:2846468607,DARKKHAKI:3182914559,DARKMAGENTA:2332068863,DARKOLIVEGREEN:1433087999,DARKORANGE:4287365375,DARKORCHID:2570243327,DARKRED:2332033279,DARKSALMON:3918953215,DARKSEAGREEN:2411499519,DARKSLATEBLUE:1211993087,DARKSLATEGRAY:793726975,DARKSLATEGREY:793726975,DARKTURQUOISE:13554175,DARKVIOLET:2483082239,DEEPPINK:4279538687,DEEPSKYBLUE:12582911,DIMGRAY:1768516095,DIMGREY:1768516095,DODGERBLUE:512819199,FIREBRICK:2988581631,FLORALWHITE:4294635775,FORESTGREEN:579543807,FUCHSIA:4278255615,GAINSBORO:3705462015,GHOSTWHITE:4177068031,GOLD:4292280575,GOLDENROD:3668254975,GRAY:2155905279,GREEN:8388863,GREENYELLOW:2919182335,GREY:2155905279,HONEYDEW:4043305215,HOTPINK:4285117695,INDIANRED:3445382399,INDIGO:1258324735,IVORY:4294963455,KHAKI:4041641215,LAVENDER:3873897215,LAVENDERBLUSH:4293981695,LAWNGREEN:2096890111,LEMONCHIFFON:4294626815,LIGHTBLUE:2916673279,LIGHTCORAL:4034953471,LIGHTCYAN:3774873599,LIGHTGOLDENRODYELLOW:4210742015,LIGHTGRAY:3553874943,LIGHTGREEN:2431553791,LIGHTGREY:3553874943,LIGHTPINK:4290167295,LIGHTSALMON:4288707327,LIGHTSEAGREEN:548580095,LIGHTSKYBLUE:2278488831,LIGHTSLATEGRAY:2005441023,LIGHTSLATEGREY:2005441023,LIGHTSTEELBLUE:2965692159,LIGHTYELLOW:4294959359,LIME:16711935,LIMEGREEN:852308735,LINEN:4210091775,MAGENTA:4278255615,MAROON:2147483903,MEDIUMAQUAMARINE:1724754687,MEDIUMBLUE:52735,MEDIUMORCHID:3126187007,MEDIUMPURPLE:2473647103,MEDIUMSEAGREEN:1018393087,MEDIUMSLATEBLUE:2070474495,MEDIUMSPRINGGREEN:16423679,MEDIUMTURQUOISE:1221709055,MEDIUMVIOLETRED:3340076543,MIDNIGHTBLUE:421097727,MINTCREAM:4127193855,MISTYROSE:4293190143,MOCCASIN:4293178879,NAVAJOWHITE:4292783615,NAVY:33023,OLDLACE:4260751103,OLIVE:2155872511,OLIVEDRAB:1804477439,ORANGE:4289003775,ORANGERED:4282712319,ORCHID:3664828159,PALEGOLDENROD:4008225535,PALEGREEN:2566625535,PALETURQUOISE:2951671551,PALEVIOLETRED:3681588223,PAPAYAWHIP:4293907967,PEACHPUFF:4292524543,PERU:3448061951,PINK:4290825215,PLUM:3718307327,POWDERBLUE:2967529215,PURPLE:2147516671,REBECCAPURPLE:1714657791,RED:4278190335,ROSYBROWN:3163525119,ROYALBLUE:1097458175,SADDLEBROWN:2336560127,SALMON:4202722047,SANDYBROWN:4104413439,SEAGREEN:780883967,SEASHELL:4294307583,SIENNA:2689740287,SILVER:3233857791,SKYBLUE:2278484991,SLATEBLUE:1784335871,SLATEGRAY:1887473919,SLATEGREY:1887473919,SNOW:4294638335,SPRINGGREEN:16744447,STEELBLUE:1182971135,TAN:3535047935,TEAL:8421631,THISTLE:3636451583,TOMATO:4284696575,TRANSPARENT:0,TURQUOISE:1088475391,VIOLET:4001558271,WHEAT:4125012991,WHITE:4294967295,WHITESMOKE:4126537215,YELLOW:4294902015,YELLOWGREEN:2597139199},wat={name:"background-clip",initialValue:"border-box",prefix:!1,type:1,parse:function(r,t){return t.map(function(e){if(si(e))switch(e.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},xat={name:"background-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},p1=function(r,t){var e=JA.parse(r,t[0]),n=t[1];return n&&_s(n)?{color:e,stop:n}:{color:e,stop:null}},TM=function(r,t){var e=r[0],n=r[r.length-1];e.stop===null&&(e.stop=Xs),n.stop===null&&(n.stop=XA);for(var i=[],s=0,a=0;a<r.length;a++){var o=r[a].stop;if(o!==null){var A=yi(o,t);A>s?i.push(A):i.push(s),s=A}else i.push(null)}for(var f=null,a=0;a<i.length;a++){var m=i[a];if(m===null)f===null&&(f=a);else if(f!==null){for(var _=a-f,x=i[f-1],B=(m-x)/(_+1),P=1;P<=_;P++)i[f+P-1]=B*P;f=null}}return r.map(function(M,k){var Q=M.color;return{color:Q,stop:Math.max(Math.min(1,i[k]/t),0)}})},Bat=function(r,t,e){var n=t/2,i=e/2,s=yi(r[0],t)-n,a=i-yi(r[1],e);return(Math.atan2(a,s)+Math.PI*2)%(Math.PI*2)},Cat=function(r,t,e){var n=typeof r=="number"?r:Bat(r,t,e),i=Math.abs(t*Math.sin(n))+Math.abs(e*Math.cos(n)),s=t/2,a=e/2,o=i/2,A=Math.sin(n-Math.PI/2)*o,f=Math.cos(n-Math.PI/2)*o;return[i,s-f,s+f,a-A,a+A]},tl=function(r,t){return Math.sqrt(r*r+t*t)},IM=function(r,t,e,n,i){var s=[[0,0],[0,t],[r,0],[r,t]];return s.reduce(function(a,o){var A=o[0],f=o[1],m=tl(e-A,n-f);return(i?m<a.optimumDistance:m>a.optimumDistance)?{optimumCorner:o,optimumDistance:m}:a},{optimumDistance:i?1/0:-1/0,optimumCorner:null}).optimumCorner},Eat=function(r,t,e,n,i){var s=0,a=0;switch(r.size){case 0:r.shape===0?s=a=Math.min(Math.abs(t),Math.abs(t-n),Math.abs(e),Math.abs(e-i)):r.shape===1&&(s=Math.min(Math.abs(t),Math.abs(t-n)),a=Math.min(Math.abs(e),Math.abs(e-i)));break;case 2:if(r.shape===0)s=a=Math.min(tl(t,e),tl(t,e-i),tl(t-n,e),tl(t-n,e-i));else if(r.shape===1){var o=Math.min(Math.abs(e),Math.abs(e-i))/Math.min(Math.abs(t),Math.abs(t-n)),A=IM(n,i,t,e,!0),f=A[0],m=A[1];s=tl(f-t,(m-e)/o),a=o*s}break;case 1:r.shape===0?s=a=Math.max(Math.abs(t),Math.abs(t-n),Math.abs(e),Math.abs(e-i)):r.shape===1&&(s=Math.max(Math.abs(t),Math.abs(t-n)),a=Math.max(Math.abs(e),Math.abs(e-i)));break;case 3:if(r.shape===0)s=a=Math.max(tl(t,e),tl(t,e-i),tl(t-n,e),tl(t-n,e-i));else if(r.shape===1){var o=Math.max(Math.abs(e),Math.abs(e-i))/Math.max(Math.abs(t),Math.abs(t-n)),_=IM(n,i,t,e,!1),f=_[0],m=_[1];s=tl(f-t,(m-e)/o),a=o*s}break}return Array.isArray(r.size)&&(s=yi(r.size[0],n),a=r.size.length===2?yi(r.size[1],i):s),[s,a]},Sat=function(r,t){var e=Ac(180),n=[];return eu(t).forEach(function(i,s){if(s===0){var a=i[0];if(a.type===20&&a.value==="to"){e=BM(i);return}else if(xM(a)){e=f1.parse(r,a);return}}var o=p1(r,i);n.push(o)}),{angle:e,stops:n,type:1}},g1=function(r,t){var e=Ac(180),n=[];return eu(t).forEach(function(i,s){if(s===0){var a=i[0];if(a.type===20&&["top","left","right","bottom"].indexOf(a.value)!==-1){e=BM(i);return}else if(xM(a)){e=(f1.parse(r,a)+Ac(270))%Ac(360);return}}var o=p1(r,i);n.push(o)}),{angle:e,stops:n,type:1}},Tat=function(r,t){var e=Ac(180),n=[],i=1,s=0,a=3,o=[];return eu(t).forEach(function(A,f){var m=A[0];if(f===0){if(si(m)&&m.value==="linear"){i=1;return}else if(si(m)&&m.value==="radial"){i=2;return}}if(m.type===18){if(m.name==="from"){var _=JA.parse(r,m.values[0]);n.push({stop:Xs,color:_})}else if(m.name==="to"){var _=JA.parse(r,m.values[0]);n.push({stop:XA,color:_})}else if(m.name==="color-stop"){var x=m.values.filter(zf);if(x.length===2){var _=JA.parse(r,x[1]),B=x[0];Hf(B)&&n.push({stop:{type:16,number:B.number*100,flags:B.flags},color:_})}}}}),i===1?{angle:(e+Ac(180))%Ac(360),stops:n,type:i}:{size:a,shape:s,stops:n,position:o,type:i}},LM="closest-side",FM="farthest-side",PM="closest-corner",MM="farthest-corner",UM="circle",RM="ellipse",OM="cover",DM="contain",Iat=function(r,t){var e=0,n=3,i=[],s=[];return eu(t).forEach(function(a,o){var A=!0;if(o===0){var f=!1;A=a.reduce(function(_,x){if(f)if(si(x))switch(x.value){case"center":return s.push(Rx),_;case"top":case"left":return s.push(Xs),_;case"right":case"bottom":return s.push(XA),_}else(_s(x)||WA(x))&&s.push(x);else if(si(x))switch(x.value){case UM:return e=0,!1;case RM:return e=1,!1;case"at":return f=!0,!1;case LM:return n=0,!1;case OM:case FM:return n=1,!1;case DM:case PM:return n=2,!1;case MM:return n=3,!1}else if(WA(x)||_s(x))return Array.isArray(n)||(n=[]),n.push(x),!1;return _},A)}if(A){var m=p1(r,a);i.push(m)}}),{size:n,shape:e,stops:i,position:s,type:2}},m1=function(r,t){var e=0,n=3,i=[],s=[];return eu(t).forEach(function(a,o){var A=!0;if(o===0?A=a.reduce(function(m,_){if(si(_))switch(_.value){case"center":return s.push(Rx),!1;case"top":case"left":return s.push(Xs),!1;case"right":case"bottom":return s.push(XA),!1}else if(_s(_)||WA(_))return s.push(_),!1;return m},A):o===1&&(A=a.reduce(function(m,_){if(si(_))switch(_.value){case UM:return e=0,!1;case RM:return e=1,!1;case DM:case LM:return n=0,!1;case FM:return n=1,!1;case PM:return n=2,!1;case OM:case MM:return n=3,!1}else if(WA(_)||_s(_))return Array.isArray(n)||(n=[]),n.push(_),!1;return m},A)),A){var f=p1(r,a);i.push(f)}}),{size:n,shape:e,stops:i,position:s,type:2}},Lat=function(r){return r.type===1},Fat=function(r){return r.type===2},Dx={name:"image",parse:function(r,t){if(t.type===22){var e={url:t.value,type:0};return r.cache.addImage(t.value),e}if(t.type===18){var n=NM[t.name];if(typeof n>"u")throw new Error('Attempting to parse an unsupported image function "'+t.name+'"');return n(r,t.values)}throw new Error("Unsupported image type "+t.type)}};function Pat(r){return!(r.type===20&&r.value==="none")&&(r.type!==18||!!NM[r.name])}var NM={"linear-gradient":Sat,"-moz-linear-gradient":g1,"-ms-linear-gradient":g1,"-o-linear-gradient":g1,"-webkit-linear-gradient":g1,"radial-gradient":Iat,"-moz-radial-gradient":m1,"-ms-radial-gradient":m1,"-o-radial-gradient":m1,"-webkit-radial-gradient":m1,"-webkit-gradient":Tat},Mat={name:"background-image",initialValue:"none",type:1,prefix:!1,parse:function(r,t){if(t.length===0)return[];var e=t[0];return e.type===20&&e.value==="none"?[]:t.filter(function(n){return zf(n)&&Pat(n)}).map(function(n){return Dx.parse(r,n)})}},Uat={name:"background-origin",initialValue:"border-box",prefix:!1,type:1,parse:function(r,t){return t.map(function(e){if(si(e))switch(e.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},Rat={name:"background-position",initialValue:"0% 0%",type:1,prefix:!1,parse:function(r,t){return eu(t).map(function(e){return e.filter(_s)}).map(yM)}},Oat={name:"background-repeat",initialValue:"repeat",prefix:!1,type:1,parse:function(r,t){return eu(t).map(function(e){return e.filter(si).map(function(n){return n.value}).join(" ")}).map(Dat)}},Dat=function(r){switch(r){case"no-repeat":return 1;case"repeat-x":case"repeat no-repeat":return 2;case"repeat-y":case"no-repeat repeat":return 3;case"repeat":default:return 0}},Gf;(function(r){r.AUTO="auto",r.CONTAIN="contain",r.COVER="cover"})(Gf||(Gf={}));var Nat={name:"background-size",initialValue:"0",prefix:!1,type:1,parse:function(r,t){return eu(t).map(function(e){return e.filter(kat)})}},kat=function(r){return si(r)||_s(r)},y1=function(r){return{name:"border-"+r+"-color",initialValue:"transparent",prefix:!1,type:3,format:"color"}},Qat=y1("top"),Hat=y1("right"),zat=y1("bottom"),Gat=y1("left"),_1=function(r){return{name:"border-radius-"+r,initialValue:"0 0",prefix:!1,type:1,parse:function(t,e){return yM(e.filter(_s))}}},Vat=_1("top-left"),jat=_1("top-right"),qat=_1("bottom-right"),Kat=_1("bottom-left"),v1=function(r){return{name:"border-"+r+"-style",initialValue:"solid",prefix:!1,type:2,parse:function(t,e){switch(e){case"none":return 0;case"dashed":return 2;case"dotted":return 3;case"double":return 4}return 1}}},$at=v1("top"),Wat=v1("right"),Xat=v1("bottom"),Jat=v1("left"),b1=function(r){return{name:"border-"+r+"-width",initialValue:"0",type:0,prefix:!1,parse:function(t,e){return rm(e)?e.number:0}}},Yat=b1("top"),Zat=b1("right"),tct=b1("bottom"),ect=b1("left"),rct={name:"color",initialValue:"transparent",prefix:!1,type:3,format:"color"},nct={name:"direction",initialValue:"ltr",prefix:!1,type:2,parse:function(r,t){switch(t){case"rtl":return 1;case"ltr":default:return 0}}},ict={name:"display",initialValue:"inline-block",prefix:!1,type:1,parse:function(r,t){return t.filter(si).reduce(function(e,n){return e|sct(n.value)},0)}},sct=function(r){switch(r){case"block":case"-webkit-box":return 2;case"inline":return 4;case"run-in":return 8;case"flow":return 16;case"flow-root":return 32;case"table":return 64;case"flex":case"-webkit-flex":return 128;case"grid":case"-ms-grid":return 256;case"ruby":return 512;case"subgrid":return 1024;case"list-item":return 2048;case"table-row-group":return 4096;case"table-header-group":return 8192;case"table-footer-group":return 16384;case"table-row":return 32768;case"table-cell":return 65536;case"table-column-group":return 131072;case"table-column":return 262144;case"table-caption":return 524288;case"ruby-base":return 1048576;case"ruby-text":return 2097152;case"ruby-base-container":return 4194304;case"ruby-text-container":return 8388608;case"contents":return 16777216;case"inline-block":return 33554432;case"inline-list-item":return 67108864;case"inline-table":return 134217728;case"inline-flex":return 268435456;case"inline-grid":return 536870912}return 0},oct={name:"float",initialValue:"none",prefix:!1,type:2,parse:function(r,t){switch(t){case"left":return 1;case"right":return 2;case"inline-start":return 3;case"inline-end":return 4}return 0}},act={name:"letter-spacing",initialValue:"0",prefix:!1,type:0,parse:function(r,t){return t.type===20&&t.value==="normal"?0:t.type===17||t.type===15?t.number:0}},w1;(function(r){r.NORMAL="normal",r.STRICT="strict"})(w1||(w1={}));var cct={name:"line-break",initialValue:"normal",prefix:!1,type:2,parse:function(r,t){switch(t){case"strict":return w1.STRICT;case"normal":default:return w1.NORMAL}}},lct={name:"line-height",initialValue:"normal",prefix:!1,type:4},kM=function(r,t){return si(r)&&r.value==="normal"?1.2*t:r.type===17?t*r.number:_s(r)?yi(r,t):t},uct={name:"list-style-image",initialValue:"none",type:0,prefix:!1,parse:function(r,t){return t.type===20&&t.value==="none"?null:Dx.parse(r,t)}},Act={name:"list-style-position",initialValue:"outside",prefix:!1,type:2,parse:function(r,t){switch(t){case"inside":return 0;case"outside":default:return 1}}},Nx={name:"list-style-type",initialValue:"none",prefix:!1,type:2,parse:function(r,t){switch(t){case"disc":return 0;case"circle":return 1;case"square":return 2;case"decimal":return 3;case"cjk-decimal":return 4;case"decimal-leading-zero":return 5;case"lower-roman":return 6;case"upper-roman":return 7;case"lower-greek":return 8;case"lower-alpha":return 9;case"upper-alpha":return 10;case"arabic-indic":return 11;case"armenian":return 12;case"bengali":return 13;case"cambodian":return 14;case"cjk-earthly-branch":return 15;case"cjk-heavenly-stem":return 16;case"cjk-ideographic":return 17;case"devanagari":return 18;case"ethiopic-numeric":return 19;case"georgian":return 20;case"gujarati":return 21;case"gurmukhi":return 22;case"hebrew":return 22;case"hiragana":return 23;case"hiragana-iroha":return 24;case"japanese-formal":return 25;case"japanese-informal":return 26;case"kannada":return 27;case"katakana":return 28;case"katakana-iroha":return 29;case"khmer":return 30;case"korean-hangul-formal":return 31;case"korean-hanja-formal":return 32;case"korean-hanja-informal":return 33;case"lao":return 34;case"lower-armenian":return 35;case"malayalam":return 36;case"mongolian":return 37;case"myanmar":return 38;case"oriya":return 39;case"persian":return 40;case"simp-chinese-formal":return 41;case"simp-chinese-informal":return 42;case"tamil":return 43;case"telugu":return 44;case"thai":return 45;case"tibetan":return 46;case"trad-chinese-formal":return 47;case"trad-chinese-informal":return 48;case"upper-armenian":return 49;case"disclosure-open":return 50;case"disclosure-closed":return 51;case"none":default:return-1}}},x1=function(r){return{name:"margin-"+r,initialValue:"0",prefix:!1,type:4}},hct=x1("top"),dct=x1("right"),fct=x1("bottom"),pct=x1("left"),gct={name:"overflow",initialValue:"visible",prefix:!1,type:1,parse:function(r,t){return t.filter(si).map(function(e){switch(e.value){case"hidden":return 1;case"scroll":return 2;case"clip":return 3;case"auto":return 4;case"visible":default:return 0}})}},mct={name:"overflow-wrap",initialValue:"normal",prefix:!1,type:2,parse:function(r,t){switch(t){case"break-word":return"break-word";case"normal":default:return"normal"}}},B1=function(r){return{name:"padding-"+r,initialValue:"0",prefix:!1,type:3,format:"length-percentage"}},yct=B1("top"),_ct=B1("right"),vct=B1("bottom"),bct=B1("left"),wct={name:"text-align",initialValue:"left",prefix:!1,type:2,parse:function(r,t){switch(t){case"right":return 2;case"center":case"justify":return 1;case"left":default:return 0}}},xct={name:"position",initialValue:"static",prefix:!1,type:2,parse:function(r,t){switch(t){case"relative":return 1;case"absolute":return 2;case"fixed":return 3;case"sticky":return 4}return 0}},Bct={name:"text-shadow",initialValue:"none",type:1,prefix:!1,parse:function(r,t){return t.length===1&&Ux(t[0],"none")?[]:eu(t).map(function(e){for(var n={color:Vu.TRANSPARENT,offsetX:Xs,offsetY:Xs,blur:Xs},i=0,s=0;s<e.length;s++){var a=e[s];WA(a)?(i===0?n.offsetX=a:i===1?n.offsetY=a:n.blur=a,i++):n.color=JA.parse(r,a)}return n})}},Cct={name:"text-transform",initialValue:"none",prefix:!1,type:2,parse:function(r,t){switch(t){case"uppercase":return 2;case"lowercase":return 1;case"capitalize":return 3}return 0}},Ect={name:"transform",initialValue:"none",prefix:!0,type:0,parse:function(r,t){if(t.type===20&&t.value==="none")return null;if(t.type===18){var e=Ict[t.name];if(typeof e>"u")throw new Error('Attempting to parse an unsupported transform function "'+t.name+'"');return e(t.values)}return null}},Sct=function(r){var t=r.filter(function(e){return e.type===17}).map(function(e){return e.number});return t.length===6?t:null},Tct=function(r){var t=r.filter(function(A){return A.type===17}).map(function(A){return A.number}),e=t[0],n=t[1];t[2],t[3];var i=t[4],s=t[5];t[6],t[7],t[8],t[9],t[10],t[11];var a=t[12],o=t[13];return t[14],t[15],t.length===16?[e,n,i,s,a,o]:null},Ict={matrix:Sct,matrix3d:Tct},QM={type:16,number:50,flags:Jg},Lct=[QM,QM],Fct={name:"transform-origin",initialValue:"50% 50%",prefix:!0,type:1,parse:function(r,t){var e=t.filter(_s);return e.length!==2?Lct:[e[0],e[1]]}},Pct={name:"visible",initialValue:"none",prefix:!1,type:2,parse:function(r,t){switch(t){case"hidden":return 1;case"collapse":return 2;case"visible":default:return 0}}},sm;(function(r){r.NORMAL="normal",r.BREAK_ALL="break-all",r.KEEP_ALL="keep-all"})(sm||(sm={}));for(var Mct={name:"word-break",initialValue:"normal",prefix:!1,type:2,parse:function(r,t){switch(t){case"break-all":return sm.BREAK_ALL;case"keep-all":return sm.KEEP_ALL;case"normal":default:return sm.NORMAL}}},Uct={name:"z-index",initialValue:"auto",prefix:!1,type:0,parse:function(r,t){if(t.type===20)return{auto:!0,order:0};if(Hf(t))return{auto:!1,order:t.number};throw new Error("Invalid z-index number parsed")}},HM={name:"time",parse:function(r,t){if(t.type===15)switch(t.unit.toLowerCase()){case"s":return 1e3*t.number;case"ms":return t.number}throw new Error("Unsupported time type")}},Rct={name:"opacity",initialValue:"1",type:0,prefix:!1,parse:function(r,t){return Hf(t)?t.number:1}},Oct={name:"text-decoration-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},Dct={name:"text-decoration-line",initialValue:"none",prefix:!1,type:1,parse:function(r,t){return t.filter(si).map(function(e){switch(e.value){case"underline":return 1;case"overline":return 2;case"line-through":return 3;case"none":return 4}return 0}).filter(function(e){return e!==0})}},Nct={name:"font-family",initialValue:"",prefix:!1,type:1,parse:function(r,t){var e=[],n=[];return t.forEach(function(i){switch(i.type){case 20:case 0:e.push(i.value);break;case 17:e.push(i.number.toString());break;case 4:n.push(e.join(" ")),e.length=0;break}}),e.length&&n.push(e.join(" ")),n.map(function(i){return i.indexOf(" ")===-1?i:"'"+i+"'"})}},kct={name:"font-size",initialValue:"0",prefix:!1,type:3,format:"length"},Qct={name:"font-weight",initialValue:"normal",type:0,prefix:!1,parse:function(r,t){if(Hf(t))return t.number;if(si(t))switch(t.value){case"bold":return 700;case"normal":default:return 400}return 400}},Hct={name:"font-variant",initialValue:"none",type:1,prefix:!1,parse:function(r,t){return t.filter(si).map(function(e){return e.value})}},zct={name:"font-style",initialValue:"normal",prefix:!1,type:2,parse:function(r,t){switch(t){case"oblique":return"oblique";case"italic":return"italic";case"normal":default:return"normal"}}},Es=function(r,t){return(r&t)!==0},Gct={name:"content",initialValue:"none",type:1,prefix:!1,parse:function(r,t){if(t.length===0)return[];var e=t[0];return e.type===20&&e.value==="none"?[]:t}},Vct={name:"counter-increment",initialValue:"none",prefix:!0,type:1,parse:function(r,t){if(t.length===0)return null;var e=t[0];if(e.type===20&&e.value==="none")return null;for(var n=[],i=t.filter(mM),s=0;s<i.length;s++){var a=i[s],o=i[s+1];if(a.type===20){var A=o&&Hf(o)?o.number:1;n.push({counter:a.value,increment:A})}}return n}},jct={name:"counter-reset",initialValue:"none",prefix:!0,type:1,parse:function(r,t){if(t.length===0)return[];for(var e=[],n=t.filter(mM),i=0;i<n.length;i++){var s=n[i],a=n[i+1];if(si(s)&&s.value!=="none"){var o=a&&Hf(a)?a.number:0;e.push({counter:s.value,reset:o})}}return e}},qct={name:"duration",initialValue:"0s",prefix:!1,type:1,parse:function(r,t){return t.filter(rm).map(function(e){return HM.parse(r,e)})}},Kct={name:"quotes",initialValue:"none",prefix:!0,type:1,parse:function(r,t){if(t.length===0)return null;var e=t[0];if(e.type===20&&e.value==="none")return null;var n=[],i=t.filter(_at);if(i.length%2!==0)return null;for(var s=0;s<i.length;s+=2){var a=i[s].value,o=i[s+1].value;n.push({open:a,close:o})}return n}},zM=function(r,t,e){if(!r)return"";var n=r[Math.min(t,r.length-1)];return n?e?n.open:n.close:""},$ct={name:"box-shadow",initialValue:"none",type:1,prefix:!1,parse:function(r,t){return t.length===1&&Ux(t[0],"none")?[]:eu(t).map(function(e){for(var n={color:255,offsetX:Xs,offsetY:Xs,blur:Xs,spread:Xs,inset:!1},i=0,s=0;s<e.length;s++){var a=e[s];Ux(a,"inset")?n.inset=!0:WA(a)?(i===0?n.offsetX=a:i===1?n.offsetY=a:i===2?n.blur=a:n.spread=a,i++):n.color=JA.parse(r,a)}return n})}},Wct={name:"paint-order",initialValue:"normal",prefix:!1,type:1,parse:function(r,t){var e=[0,1,2],n=[];return t.filter(si).forEach(function(i){switch(i.value){case"stroke":n.push(1);break;case"fill":n.push(0);break;case"markers":n.push(2);break}}),e.forEach(function(i){n.indexOf(i)===-1&&n.push(i)}),n}},Xct={name:"-webkit-text-stroke-color",initialValue:"currentcolor",prefix:!1,type:3,format:"color"},Jct={name:"-webkit-text-stroke-width",initialValue:"0",type:0,prefix:!1,parse:function(r,t){return rm(t)?t.number:0}},Yct=function(){function r(t,e){var n,i;this.animationDuration=fr(t,qct,e.animationDuration),this.backgroundClip=fr(t,wat,e.backgroundClip),this.backgroundColor=fr(t,xat,e.backgroundColor),this.backgroundImage=fr(t,Mat,e.backgroundImage),this.backgroundOrigin=fr(t,Uat,e.backgroundOrigin),this.backgroundPosition=fr(t,Rat,e.backgroundPosition),this.backgroundRepeat=fr(t,Oat,e.backgroundRepeat),this.backgroundSize=fr(t,Nat,e.backgroundSize),this.borderTopColor=fr(t,Qat,e.borderTopColor),this.borderRightColor=fr(t,Hat,e.borderRightColor),this.borderBottomColor=fr(t,zat,e.borderBottomColor),this.borderLeftColor=fr(t,Gat,e.borderLeftColor),this.borderTopLeftRadius=fr(t,Vat,e.borderTopLeftRadius),this.borderTopRightRadius=fr(t,jat,e.borderTopRightRadius),this.borderBottomRightRadius=fr(t,qat,e.borderBottomRightRadius),this.borderBottomLeftRadius=fr(t,Kat,e.borderBottomLeftRadius),this.borderTopStyle=fr(t,$at,e.borderTopStyle),this.borderRightStyle=fr(t,Wat,e.borderRightStyle),this.borderBottomStyle=fr(t,Xat,e.borderBottomStyle),this.borderLeftStyle=fr(t,Jat,e.borderLeftStyle),this.borderTopWidth=fr(t,Yat,e.borderTopWidth),this.borderRightWidth=fr(t,Zat,e.borderRightWidth),this.borderBottomWidth=fr(t,tct,e.borderBottomWidth),this.borderLeftWidth=fr(t,ect,e.borderLeftWidth),this.boxShadow=fr(t,$ct,e.boxShadow),this.color=fr(t,rct,e.color),this.direction=fr(t,nct,e.direction),this.display=fr(t,ict,e.display),this.float=fr(t,oct,e.cssFloat),this.fontFamily=fr(t,Nct,e.fontFamily),this.fontSize=fr(t,kct,e.fontSize),this.fontStyle=fr(t,zct,e.fontStyle),this.fontVariant=fr(t,Hct,e.fontVariant),this.fontWeight=fr(t,Qct,e.fontWeight),this.letterSpacing=fr(t,act,e.letterSpacing),this.lineBreak=fr(t,cct,e.lineBreak),this.lineHeight=fr(t,lct,e.lineHeight),this.listStyleImage=fr(t,uct,e.listStyleImage),this.listStylePosition=fr(t,Act,e.listStylePosition),this.listStyleType=fr(t,Nx,e.listStyleType),this.marginTop=fr(t,hct,e.marginTop),this.marginRight=fr(t,dct,e.marginRight),this.marginBottom=fr(t,fct,e.marginBottom),this.marginLeft=fr(t,pct,e.marginLeft),this.opacity=fr(t,Rct,e.opacity);var s=fr(t,gct,e.overflow);this.overflowX=s[0],this.overflowY=s[s.length>1?1:0],this.overflowWrap=fr(t,mct,e.overflowWrap),this.paddingTop=fr(t,yct,e.paddingTop),this.paddingRight=fr(t,_ct,e.paddingRight),this.paddingBottom=fr(t,vct,e.paddingBottom),this.paddingLeft=fr(t,bct,e.paddingLeft),this.paintOrder=fr(t,Wct,e.paintOrder),this.position=fr(t,xct,e.position),this.textAlign=fr(t,wct,e.textAlign),this.textDecorationColor=fr(t,Oct,(n=e.textDecorationColor)!==null&&n!==void 0?n:e.color),this.textDecorationLine=fr(t,Dct,(i=e.textDecorationLine)!==null&&i!==void 0?i:e.textDecoration),this.textShadow=fr(t,Bct,e.textShadow),this.textTransform=fr(t,Cct,e.textTransform),this.transform=fr(t,Ect,e.transform),this.transformOrigin=fr(t,Fct,e.transformOrigin),this.visibility=fr(t,Pct,e.visibility),this.webkitTextStrokeColor=fr(t,Xct,e.webkitTextStrokeColor),this.webkitTextStrokeWidth=fr(t,Jct,e.webkitTextStrokeWidth),this.wordBreak=fr(t,Mct,e.wordBreak),this.zIndex=fr(t,Uct,e.zIndex)}return r.prototype.isVisible=function(){return this.display>0&&this.opacity>0&&this.visibility===0},r.prototype.isTransparent=function(){return YA(this.backgroundColor)},r.prototype.isTransformed=function(){return this.transform!==null},r.prototype.isPositioned=function(){return this.position!==0},r.prototype.isPositionedWithZIndex=function(){return this.isPositioned()&&!this.zIndex.auto},r.prototype.isFloating=function(){return this.float!==0},r.prototype.isInlineLevel=function(){return Es(this.display,4)||Es(this.display,33554432)||Es(this.display,268435456)||Es(this.display,536870912)||Es(this.display,67108864)||Es(this.display,134217728)},r}(),Zct=function(){function r(t,e){this.content=fr(t,Gct,e.content),this.quotes=fr(t,Kct,e.quotes)}return r}(),GM=function(){function r(t,e){this.counterIncrement=fr(t,Vct,e.counterIncrement),this.counterReset=fr(t,jct,e.counterReset)}return r}(),fr=function(r,t,e){var n=new pM,i=e!==null&&typeof e<"u"?e.toString():t.initialValue;n.write(i);var s=new gM(n.read());switch(t.type){case 2:var a=s.parseComponentValue();return t.parse(r,si(a)?a.value:t.initialValue);case 0:return t.parse(r,s.parseComponentValue());case 1:return t.parse(r,s.parseComponentValues());case 4:return s.parseComponentValue();case 3:switch(t.format){case"angle":return f1.parse(r,s.parseComponentValue());case"color":return JA.parse(r,s.parseComponentValue());case"image":return Dx.parse(r,s.parseComponentValue());case"length":var o=s.parseComponentValue();return WA(o)?o:Xs;case"length-percentage":var A=s.parseComponentValue();return _s(A)?A:Xs;case"time":return HM.parse(r,s.parseComponentValue())}break}},tlt="data-html2canvas-debug",elt=function(r){var t=r.getAttribute(tlt);switch(t){case"all":return 1;case"clone":return 2;case"parse":return 3;case"render":return 4;default:return 0}},kx=function(r,t){var e=elt(r);return e===1||t===e},ru=function(){function r(t,e){if(this.context=t,this.textNodes=[],this.elements=[],this.flags=0,kx(e,3))debugger;this.styles=new Yct(t,window.getComputedStyle(e,null)),Yx(e)&&(this.styles.animationDuration.some(function(n){return n>0})&&(e.style.animationDuration="0s"),this.styles.transform!==null&&(e.style.transform="none")),this.bounds=$y(this.context,e),kx(e,4)&&(this.flags|=16)}return r}(),rlt="AAAAAAAAAAAAEA4AGBkAAFAaAAACAAAAAAAIABAAGAAwADgACAAQAAgAEAAIABAACAAQAAgAEAAIABAACAAQAAgAEAAIABAAQABIAEQATAAIABAACAAQAAgAEAAIABAAVABcAAgAEAAIABAACAAQAGAAaABwAHgAgACIAI4AlgAIABAAmwCjAKgAsAC2AL4AvQDFAMoA0gBPAVYBWgEIAAgACACMANoAYgFkAWwBdAF8AX0BhQGNAZUBlgGeAaMBlQGWAasBswF8AbsBwwF0AcsBYwHTAQgA2wG/AOMBdAF8AekB8QF0AfkB+wHiAHQBfAEIAAMC5gQIAAsCEgIIAAgAFgIeAggAIgIpAggAMQI5AkACygEIAAgASAJQAlgCYAIIAAgACAAKBQoFCgUTBRMFGQUrBSsFCAAIAAgACAAIAAgACAAIAAgACABdAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABoAmgCrwGvAQgAbgJ2AggAHgEIAAgACADnAXsCCAAIAAgAgwIIAAgACAAIAAgACACKAggAkQKZAggAPADJAAgAoQKkAqwCsgK6AsICCADJAggA0AIIAAgACAAIANYC3gIIAAgACAAIAAgACABAAOYCCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAkASoB+QIEAAgACAA8AEMCCABCBQgACABJBVAFCAAIAAgACAAIAAgACAAIAAgACABTBVoFCAAIAFoFCABfBWUFCAAIAAgACAAIAAgAbQUIAAgACAAIAAgACABzBXsFfQWFBYoFigWKBZEFigWKBYoFmAWfBaYFrgWxBbkFCAAIAAgACAAIAAgACAAIAAgACAAIAMEFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAMgFCADQBQgACAAIAAgACAAIAAgACAAIAAgACAAIAO4CCAAIAAgAiQAIAAgACABAAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAD0AggACAD8AggACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIANYFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAMDvwAIAAgAJAIIAAgACAAIAAgACAAIAAgACwMTAwgACAB9BOsEGwMjAwgAKwMyAwsFYgE3A/MEPwMIAEUDTQNRAwgAWQOsAGEDCAAIAAgACAAIAAgACABpAzQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFIQUoBSwFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABtAwgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABMAEwACAAIAAgACAAIABgACAAIAAgACAC/AAgACAAyAQgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACAAIAAwAAgACAAIAAgACAAIAAgACAAIAAAARABIAAgACAAIABQASAAIAAgAIABwAEAAjgCIABsAqAC2AL0AigDQAtwC+IJIQqVAZUBWQqVAZUBlQGVAZUBlQGrC5UBlQGVAZUBlQGVAZUBlQGVAXsKlQGVAbAK6wsrDGUMpQzlDJUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAfAKAAuZA64AtwCJALoC6ADwAAgAuACgA/oEpgO6AqsD+AAIAAgAswMIAAgACAAIAIkAuwP5AfsBwwPLAwgACAAIAAgACADRA9kDCAAIAOED6QMIAAgACAAIAAgACADuA/YDCAAIAP4DyQAIAAgABgQIAAgAXQAOBAgACAAIAAgACAAIABMECAAIAAgACAAIAAgACAD8AAQBCAAIAAgAGgQiBCoECAExBAgAEAEIAAgACAAIAAgACAAIAAgACAAIAAgACAA4BAgACABABEYECAAIAAgATAQYAQgAVAQIAAgACAAIAAgACAAIAAgACAAIAFoECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAOQEIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAB+BAcACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAEABhgSMBAgACAAIAAgAlAQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAwAEAAQABAADAAMAAwADAAQABAAEAAQABAAEAAQABHATAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAdQMIAAgACAAIAAgACAAIAMkACAAIAAgAfQMIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACFA4kDCAAIAAgACAAIAOcBCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAIcDCAAIAAgACAAIAAgACAAIAAgACAAIAJEDCAAIAAgACADFAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABgBAgAZgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAbAQCBXIECAAIAHkECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABAAJwEQACjBKoEsgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAC6BMIECAAIAAgACAAIAAgACABmBAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAxwQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAGYECAAIAAgAzgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBd0FXwUIAOIF6gXxBYoF3gT5BQAGCAaKBYoFigWKBYoFigWKBYoFigWKBYoFigXWBIoFigWKBYoFigWKBYoFigWKBYsFEAaKBYoFigWKBYoFigWKBRQGCACKBYoFigWKBQgACAAIANEECAAIABgGigUgBggAJgYIAC4GMwaKBYoF0wQ3Bj4GigWKBYoFigWKBYoFigWKBYoFigWKBYoFigUIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWLBf///////wQABAAEAAQABAAEAAQABAAEAAQAAwAEAAQAAgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAQADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUAAAAFAAUAAAAFAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAQAAAAUABQAFAAUABQAFAAAAAAAFAAUAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAFAAUAAQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAAABwAHAAcAAAAHAAcABwAFAAEAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAcABwAFAAUAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAQABAAAAAAAAAAAAAAAFAAUABQAFAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAHAAcAAAAHAAcAAAAAAAUABQAHAAUAAQAHAAEABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwABAAUABQAFAAUAAAAAAAAAAAAAAAEAAQABAAEAAQABAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABQANAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAABQAHAAUABQAFAAAAAAAAAAcABQAFAAUABQAFAAQABAAEAAQABAAEAAQABAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUAAAAFAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAUAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAcABwAFAAcABwAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUABwAHAAUABQAFAAUAAAAAAAcABwAAAAAABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAAAAAAAAAAABQAFAAAAAAAFAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAFAAUABQAFAAUAAAAFAAUABwAAAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABwAFAAUABQAFAAAAAAAHAAcAAAAAAAcABwAFAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAAAAAAAAAHAAcABwAAAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAUABQAFAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAHAAcABQAHAAcAAAAFAAcABwAAAAcABwAFAAUAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAFAAcABwAFAAUABQAAAAUAAAAHAAcABwAHAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAHAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUAAAAFAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAUAAAAFAAUAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABwAFAAUABQAFAAUABQAAAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABQAFAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAFAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAHAAUABQAFAAUABQAFAAUABwAHAAcABwAHAAcABwAHAAUABwAHAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABwAHAAcABwAFAAUABwAHAAcAAAAAAAAAAAAHAAcABQAHAAcABwAHAAcABwAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAUABQAFAAUABQAFAAUAAAAFAAAABQAAAAAABQAFAAUABQAFAAUABQAFAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAUABQAFAAUABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABwAFAAcABwAHAAcABwAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAUABQAFAAUABwAHAAUABQAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABQAFAAcABwAHAAUABwAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAcABQAFAAUABQAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAAAAAABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAAAAAAAAAFAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAUABQAHAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAFAAUABQAFAAcABwAFAAUABwAHAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAcABwAFAAUABwAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABQAAAAAABQAFAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAcABwAAAAAAAAAAAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAcABwAFAAcABwAAAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAFAAUABQAAAAUABQAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABwAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAHAAcABQAHAAUABQAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAAABwAHAAAAAAAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAFAAUABwAFAAcABwAFAAcABQAFAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAAAAAABwAHAAcABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAFAAcABwAFAAUABQAFAAUABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAUABQAFAAcABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABQAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAAAAAAFAAUABwAHAAcABwAFAAAAAAAAAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAHAAUABQAFAAUABQAFAAUABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAABQAAAAUABQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAHAAcAAAAFAAUAAAAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABQAFAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAABQAFAAUABQAFAAUABQAAAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAFAAUABQAFAAUADgAOAA4ADgAOAA4ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAMAAwADAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkAAAAAAAAAAAAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAAAAAAAAAAAAsADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwACwAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAADgAOAA4AAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAAAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4AAAAOAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAAAAAAAAAAAA4AAAAOAAAAAAAAAAAADgAOAA4AAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAA=",VM="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",om=typeof Uint8Array>"u"?[]:new Uint8Array(256),C1=0;C1<VM.length;C1++)om[VM.charCodeAt(C1)]=C1;for(var nlt=function(r){var t=r.length*.75,e=r.length,n,i=0,s,a,o,A;r[r.length-1]==="="&&(t--,r[r.length-2]==="="&&t--);var f=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"&&typeof Uint8Array.prototype.slice<"u"?new ArrayBuffer(t):new Array(t),m=Array.isArray(f)?f:new Uint8Array(f);for(n=0;n<e;n+=4)s=om[r.charCodeAt(n)],a=om[r.charCodeAt(n+1)],o=om[r.charCodeAt(n+2)],A=om[r.charCodeAt(n+3)],m[i++]=s<<2|a>>4,m[i++]=(a&15)<<4|o>>2,m[i++]=(o&3)<<6|A&63;return f},ilt=function(r){for(var t=r.length,e=[],n=0;n<t;n+=2)e.push(r[n+1]<<8|r[n]);return e},slt=function(r){for(var t=r.length,e=[],n=0;n<t;n+=4)e.push(r[n+3]<<24|r[n+2]<<16|r[n+1]<<8|r[n]);return e},rd=5,Qx=11,Hx=2,olt=Qx-rd,jM=65536>>rd,alt=1<<rd,zx=alt-1,clt=1024>>rd,llt=jM+clt,ult=llt,Alt=32,hlt=ult+Alt,dlt=65536>>Qx,flt=1<<olt,plt=flt-1,qM=function(r,t,e){return r.slice?r.slice(t,e):new Uint16Array(Array.prototype.slice.call(r,t,e))},glt=function(r,t,e){return r.slice?r.slice(t,e):new Uint32Array(Array.prototype.slice.call(r,t,e))},mlt=function(r,t){var e=nlt(r),n=Array.isArray(e)?slt(e):new Uint32Array(e),i=Array.isArray(e)?ilt(e):new Uint16Array(e),s=24,a=qM(i,s/2,n[4]/2),o=n[5]===2?qM(i,(s+n[4])/2):glt(n,Math.ceil((s+n[4])/4));return new ylt(n[0],n[1],n[2],n[3],a,o)},ylt=function(){function r(t,e,n,i,s,a){this.initialValue=t,this.errorValue=e,this.highStart=n,this.highValueIndex=i,this.index=s,this.data=a}return r.prototype.get=function(t){var e;if(t>=0){if(t<55296||t>56319&&t<=65535)return e=this.index[t>>rd],e=(e<<Hx)+(t&zx),this.data[e];if(t<=65535)return e=this.index[jM+(t-55296>>rd)],e=(e<<Hx)+(t&zx),this.data[e];if(t<this.highStart)return e=hlt-dlt+(t>>Qx),e=this.index[e],e+=t>>rd&plt,e=this.index[e],e=(e<<Hx)+(t&zx),this.data[e];if(t<=1114111)return this.data[this.highValueIndex]}return this.errorValue},r}(),KM="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",_lt=typeof Uint8Array>"u"?[]:new Uint8Array(256),E1=0;E1<KM.length;E1++)_lt[KM.charCodeAt(E1)]=E1;var vlt=1,Gx=2,Vx=3,$M=4,WM=5,blt=7,XM=8,jx=9,qx=10,JM=11,YM=12,ZM=13,tU=14,Kx=15,wlt=function(r){for(var t=[],e=0,n=r.length;e<n;){var i=r.charCodeAt(e++);if(i>=55296&&i<=56319&&e<n){var s=r.charCodeAt(e++);(s&64512)===56320?t.push(((i&1023)<<10)+(s&1023)+65536):(t.push(i),e--)}else t.push(i)}return t},xlt=function(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];if(String.fromCodePoint)return String.fromCodePoint.apply(String,r);var e=r.length;if(!e)return"";for(var n=[],i=-1,s="";++i<e;){var a=r[i];a<=65535?n.push(a):(a-=65536,n.push((a>>10)+55296,a%1024+56320)),(i+1===e||n.length>16384)&&(s+=String.fromCharCode.apply(String,n),n.length=0)}return s},Blt=mlt(rlt),nd="",eU="",Clt=function(r){return Blt.get(r)},Elt=function(r,t,e){var n=e-2,i=t[n],s=t[e-1],a=t[e];if(s===Gx&&a===Vx)return nd;if(s===Gx||s===Vx||s===$M||a===Gx||a===Vx||a===$M)return eU;if(s===XM&&[XM,jx,JM,YM].indexOf(a)!==-1||(s===JM||s===jx)&&(a===jx||a===qx)||(s===YM||s===qx)&&a===qx||a===ZM||a===WM||a===blt||s===vlt)return nd;if(s===ZM&&a===tU){for(;i===WM;)i=t[--n];if(i===tU)return nd}if(s===Kx&&a===Kx){for(var o=0;i===Kx;)o++,i=t[--n];if(o%2===0)return nd}return eU},Slt=function(r){var t=wlt(r),e=t.length,n=0,i=0,s=t.map(Clt);return{next:function(){if(n>=e)return{done:!0,value:null};for(var a=nd;n<e&&(a=Elt(t,s,++n))===nd;);if(a!==nd||n===e){var o=xlt.apply(null,t.slice(i,n));return i=n,{value:o,done:!1}}return{done:!0,value:null}}}},Tlt=function(r){for(var t=Slt(r),e=[],n;!(n=t.next()).done;)n.value&&e.push(n.value.slice());return e},Ilt=function(r){var t=123;if(r.createRange){var e=r.createRange();if(e.getBoundingClientRect){var n=r.createElement("boundtest");n.style.height=t+"px",n.style.display="block",r.body.appendChild(n),e.selectNode(n);var i=e.getBoundingClientRect(),s=Math.round(i.height);if(r.body.removeChild(n),s===t)return!0}}return!1},Llt=function(r){var t=r.createElement("boundtest");t.style.width="50px",t.style.display="block",t.style.fontSize="12px",t.style.letterSpacing="0px",t.style.wordSpacing="0px",r.body.appendChild(t);var e=r.createRange();t.innerHTML=typeof"".repeat=="function"?"&#128104;".repeat(10):"";var n=t.firstChild,i=Wy(n.data).map(function(A){return rs(A)}),s=0,a={},o=i.every(function(A,f){e.setStart(n,s),e.setEnd(n,s+A.length);var m=e.getBoundingClientRect();s+=A.length;var _=m.x>a.x||m.y>a.y;return a=m,f===0?!0:_});return r.body.removeChild(t),o},Flt=function(){return typeof new Image().crossOrigin<"u"},Plt=function(){return typeof new XMLHttpRequest().responseType=="string"},Mlt=function(r){var t=new Image,e=r.createElement("canvas"),n=e.getContext("2d");if(!n)return!1;t.src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>";try{n.drawImage(t,0,0),e.toDataURL()}catch{return!1}return!0},rU=function(r){return r[0]===0&&r[1]===255&&r[2]===0&&r[3]===255},Ult=function(r){var t=r.createElement("canvas"),e=100;t.width=e,t.height=e;var n=t.getContext("2d");if(!n)return Promise.reject(!1);n.fillStyle="rgb(0, 255, 0)",n.fillRect(0,0,e,e);var i=new Image,s=t.toDataURL();i.src=s;var a=$x(e,e,0,0,i);return n.fillStyle="red",n.fillRect(0,0,e,e),nU(a).then(function(o){n.drawImage(o,0,0);var A=n.getImageData(0,0,e,e).data;n.fillStyle="red",n.fillRect(0,0,e,e);var f=r.createElement("div");return f.style.backgroundImage="url("+s+")",f.style.height=e+"px",rU(A)?nU($x(e,e,0,0,f)):Promise.reject(!1)}).then(function(o){return n.drawImage(o,0,0),rU(n.getImageData(0,0,e,e).data)}).catch(function(){return!1})},$x=function(r,t,e,n,i){var s="http://www.w3.org/2000/svg",a=document.createElementNS(s,"svg"),o=document.createElementNS(s,"foreignObject");return a.setAttributeNS(null,"width",r.toString()),a.setAttributeNS(null,"height",t.toString()),o.setAttributeNS(null,"width","100%"),o.setAttributeNS(null,"height","100%"),o.setAttributeNS(null,"x",e.toString()),o.setAttributeNS(null,"y",n.toString()),o.setAttributeNS(null,"externalResourcesRequired","true"),a.appendChild(o),o.appendChild(i),a},nU=function(r){return new Promise(function(t,e){var n=new Image;n.onload=function(){return t(n)},n.onerror=e,n.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(new XMLSerializer().serializeToString(r))})},Js={get SUPPORT_RANGE_BOUNDS(){var r=Ilt(document);return Object.defineProperty(Js,"SUPPORT_RANGE_BOUNDS",{value:r}),r},get SUPPORT_WORD_BREAKING(){var r=Js.SUPPORT_RANGE_BOUNDS&&Llt(document);return Object.defineProperty(Js,"SUPPORT_WORD_BREAKING",{value:r}),r},get SUPPORT_SVG_DRAWING(){var r=Mlt(document);return Object.defineProperty(Js,"SUPPORT_SVG_DRAWING",{value:r}),r},get SUPPORT_FOREIGNOBJECT_DRAWING(){var r=typeof Array.from=="function"&&typeof window.fetch=="function"?Ult(document):Promise.resolve(!1);return Object.defineProperty(Js,"SUPPORT_FOREIGNOBJECT_DRAWING",{value:r}),r},get SUPPORT_CORS_IMAGES(){var r=Flt();return Object.defineProperty(Js,"SUPPORT_CORS_IMAGES",{value:r}),r},get SUPPORT_RESPONSE_TYPE(){var r=Plt();return Object.defineProperty(Js,"SUPPORT_RESPONSE_TYPE",{value:r}),r},get SUPPORT_CORS_XHR(){var r="withCredentials"in new XMLHttpRequest;return Object.defineProperty(Js,"SUPPORT_CORS_XHR",{value:r}),r},get SUPPORT_NATIVE_TEXT_SEGMENTATION(){var r=!!(typeof Intl<"u"&&Intl.Segmenter);return Object.defineProperty(Js,"SUPPORT_NATIVE_TEXT_SEGMENTATION",{value:r}),r}},am=function(){function r(t,e){this.text=t,this.bounds=e}return r}(),Rlt=function(r,t,e,n){var i=Nlt(t,e),s=[],a=0;return i.forEach(function(o){if(e.textDecorationLine.length||o.trim().length>0)if(Js.SUPPORT_RANGE_BOUNDS){var A=iU(n,a,o.length).getClientRects();if(A.length>1){var f=Wx(o),m=0;f.forEach(function(x){s.push(new am(x,zu.fromDOMRectList(r,iU(n,m+a,x.length).getClientRects()))),m+=x.length})}else s.push(new am(o,zu.fromDOMRectList(r,A)))}else{var _=n.splitText(o.length);s.push(new am(o,Olt(r,n))),n=_}else Js.SUPPORT_RANGE_BOUNDS||(n=n.splitText(o.length));a+=o.length}),s},Olt=function(r,t){var e=t.ownerDocument;if(e){var n=e.createElement("html2canvaswrapper");n.appendChild(t.cloneNode(!0));var i=t.parentNode;if(i){i.replaceChild(n,t);var s=$y(r,n);return n.firstChild&&i.replaceChild(n.firstChild,n),s}}return zu.EMPTY},iU=function(r,t,e){var n=r.ownerDocument;if(!n)throw new Error("Node has no owner document");var i=n.createRange();return i.setStart(r,t),i.setEnd(r,t+e),i},Wx=function(r){if(Js.SUPPORT_NATIVE_TEXT_SEGMENTATION){var t=new Intl.Segmenter(void 0,{granularity:"grapheme"});return Array.from(t.segment(r)).map(function(e){return e.segment})}return Tlt(r)},Dlt=function(r,t){if(Js.SUPPORT_NATIVE_TEXT_SEGMENTATION){var e=new Intl.Segmenter(void 0,{granularity:"word"});return Array.from(e.segment(r)).map(function(n){return n.segment})}return Qlt(r,t)},Nlt=function(r,t){return t.letterSpacing!==0?Wx(r):Dlt(r,t)},klt=[32,160,4961,65792,65793,4153,4241],Qlt=function(r,t){for(var e=dot(r,{lineBreak:t.lineBreak,wordBreak:t.overflowWrap==="break-word"?"break-word":t.wordBreak}),n=[],i,s=function(){if(i.value){var a=i.value.slice(),o=Wy(a),A="";o.forEach(function(f){klt.indexOf(f)===-1?A+=rs(f):(A.length&&n.push(A),n.push(rs(f)),A="")}),A.length&&n.push(A)}};!(i=e.next()).done;)s();return n},Hlt=function(){function r(t,e,n){this.text=zlt(e.data,n.textTransform),this.textBounds=Rlt(t,this.text,n,e)}return r}(),zlt=function(r,t){switch(t){case 1:return r.toLowerCase();case 3:return r.replace(Glt,Vlt);case 2:return r.toUpperCase();default:return r}},Glt=/(^|\s|:|-|\(|\))([a-z])/g,Vlt=function(r,t,e){return r.length>0?t+e.toUpperCase():r},sU=function(r){Zc(t,r);function t(e,n){var i=r.call(this,e,n)||this;return i.src=n.currentSrc||n.src,i.intrinsicWidth=n.naturalWidth,i.intrinsicHeight=n.naturalHeight,i.context.cache.addImage(i.src),i}return t}(ru),oU=function(r){Zc(t,r);function t(e,n){var i=r.call(this,e,n)||this;return i.canvas=n,i.intrinsicWidth=n.width,i.intrinsicHeight=n.height,i}return t}(ru),aU=function(r){Zc(t,r);function t(e,n){var i=r.call(this,e,n)||this,s=new XMLSerializer,a=$y(e,n);return n.setAttribute("width",a.width+"px"),n.setAttribute("height",a.height+"px"),i.svg="data:image/svg+xml,"+encodeURIComponent(s.serializeToString(n)),i.intrinsicWidth=n.width.baseVal.value,i.intrinsicHeight=n.height.baseVal.value,i.context.cache.addImage(i.svg),i}return t}(ru),cU=function(r){Zc(t,r);function t(e,n){var i=r.call(this,e,n)||this;return i.value=n.value,i}return t}(ru),Xx=function(r){Zc(t,r);function t(e,n){var i=r.call(this,e,n)||this;return i.start=n.start,i.reversed=typeof n.reversed=="boolean"&&n.reversed===!0,i}return t}(ru),jlt=[{type:15,flags:0,unit:"px",number:3}],qlt=[{type:16,flags:0,number:50}],Klt=function(r){return r.width>r.height?new zu(r.left+(r.width-r.height)/2,r.top,r.height,r.height):r.width<r.height?new zu(r.left,r.top+(r.height-r.width)/2,r.width,r.width):r},$lt=function(r){var t=r.type===Wlt?new Array(r.value.length+1).join(""):r.value;return t.length===0?r.placeholder||"":t},S1="checkbox",T1="radio",Wlt="password",lU=707406591,Jx=function(r){Zc(t,r);function t(e,n){var i=r.call(this,e,n)||this;switch(i.type=n.type.toLowerCase(),i.checked=n.checked,i.value=$lt(n),(i.type===S1||i.type===T1)&&(i.styles.backgroundColor=3739148031,i.styles.borderTopColor=i.styles.borderRightColor=i.styles.borderBottomColor=i.styles.borderLeftColor=2779096575,i.styles.borderTopWidth=i.styles.borderRightWidth=i.styles.borderBottomWidth=i.styles.borderLeftWidth=1,i.styles.borderTopStyle=i.styles.borderRightStyle=i.styles.borderBottomStyle=i.styles.borderLeftStyle=1,i.styles.backgroundClip=[0],i.styles.backgroundOrigin=[0],i.bounds=Klt(i.bounds)),i.type){case S1:i.styles.borderTopRightRadius=i.styles.borderTopLeftRadius=i.styles.borderBottomRightRadius=i.styles.borderBottomLeftRadius=jlt;break;case T1:i.styles.borderTopRightRadius=i.styles.borderTopLeftRadius=i.styles.borderBottomRightRadius=i.styles.borderBottomLeftRadius=qlt;break}return i}return t}(ru),uU=function(r){Zc(t,r);function t(e,n){var i=r.call(this,e,n)||this,s=n.options[n.selectedIndex||0];return i.value=s&&s.text||"",i}return t}(ru),AU=function(r){Zc(t,r);function t(e,n){var i=r.call(this,e,n)||this;return i.value=n.value,i}return t}(ru),hU=function(r){Zc(t,r);function t(e,n){var i=r.call(this,e,n)||this;i.src=n.src,i.width=parseInt(n.width,10)||0,i.height=parseInt(n.height,10)||0,i.backgroundColor=i.styles.backgroundColor;try{if(n.contentWindow&&n.contentWindow.document&&n.contentWindow.document.documentElement){i.tree=fU(e,n.contentWindow.document.documentElement);var s=n.contentWindow.document.documentElement?im(e,getComputedStyle(n.contentWindow.document.documentElement).backgroundColor):Vu.TRANSPARENT,a=n.contentWindow.document.body?im(e,getComputedStyle(n.contentWindow.document.body).backgroundColor):Vu.TRANSPARENT;i.backgroundColor=YA(s)?YA(a)?i.styles.backgroundColor:a:s}}catch{}return i}return t}(ru),Xlt=["OL","UL","MENU"],I1=function(r,t,e,n){for(var i=t.firstChild,s=void 0;i;i=s)if(s=i.nextSibling,pU(i)&&i.data.trim().length>0)e.textNodes.push(new Hlt(r,i,e.styles));else if(Vf(i))if(bU(i)&&i.assignedNodes)i.assignedNodes().forEach(function(o){return I1(r,o,e,n)});else{var a=dU(r,i);a.styles.isVisible()&&(Jlt(i,a,n)?a.flags|=4:Ylt(a.styles)&&(a.flags|=2),Xlt.indexOf(i.tagName)!==-1&&(a.flags|=8),e.elements.push(a),i.slot,i.shadowRoot?I1(r,i.shadowRoot,a,n):!F1(i)&&!gU(i)&&!P1(i)&&I1(r,i,a,n))}},dU=function(r,t){return tB(t)?new sU(r,t):mU(t)?new oU(r,t):gU(t)?new aU(r,t):Zlt(t)?new cU(r,t):tut(t)?new Xx(r,t):eut(t)?new Jx(r,t):P1(t)?new uU(r,t):F1(t)?new AU(r,t):_U(t)?new hU(r,t):new ru(r,t)},fU=function(r,t){var e=dU(r,t);return e.flags|=4,I1(r,t,e,e),e},Jlt=function(r,t,e){return t.styles.isPositionedWithZIndex()||t.styles.opacity<1||t.styles.isTransformed()||Zx(r)&&e.styles.isTransparent()},Ylt=function(r){return r.isPositioned()||r.isFloating()},pU=function(r){return r.nodeType===Node.TEXT_NODE},Vf=function(r){return r.nodeType===Node.ELEMENT_NODE},Yx=function(r){return Vf(r)&&typeof r.style<"u"&&!L1(r)},L1=function(r){return typeof r.className=="object"},Zlt=function(r){return r.tagName==="LI"},tut=function(r){return r.tagName==="OL"},eut=function(r){return r.tagName==="INPUT"},rut=function(r){return r.tagName==="HTML"},gU=function(r){return r.tagName==="svg"},Zx=function(r){return r.tagName==="BODY"},mU=function(r){return r.tagName==="CANVAS"},yU=function(r){return r.tagName==="VIDEO"},tB=function(r){return r.tagName==="IMG"},_U=function(r){return r.tagName==="IFRAME"},vU=function(r){return r.tagName==="STYLE"},nut=function(r){return r.tagName==="SCRIPT"},F1=function(r){return r.tagName==="TEXTAREA"},P1=function(r){return r.tagName==="SELECT"},bU=function(r){return r.tagName==="SLOT"},wU=function(r){return r.tagName.indexOf("-")>0},iut=function(){function r(){this.counters={}}return r.prototype.getCounterValue=function(t){var e=this.counters[t];return e&&e.length?e[e.length-1]:1},r.prototype.getCounterValues=function(t){var e=this.counters[t];return e||[]},r.prototype.pop=function(t){var e=this;t.forEach(function(n){return e.counters[n].pop()})},r.prototype.parse=function(t){var e=this,n=t.counterIncrement,i=t.counterReset,s=!0;n!==null&&n.forEach(function(o){var A=e.counters[o.counter];A&&o.increment!==0&&(s=!1,A.length||A.push(1),A[Math.max(0,A.length-1)]+=o.increment)});var a=[];return s&&i.forEach(function(o){var A=e.counters[o.counter];a.push(o.counter),A||(A=e.counters[o.counter]=[]),A.push(o.reset)}),a},r}(),xU={integers:[1e3,900,500,400,100,90,50,40,10,9,5,4,1],values:["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"]},BU={integers:[9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},sut={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,400,300,200,100,90,80,70,60,50,40,30,20,19,18,17,16,15,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},out={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},jf=function(r,t,e,n,i,s){return r<t||r>e?lm(r,i,s.length>0):n.integers.reduce(function(a,o,A){for(;r>=o;)r-=o,a+=n.values[A];return a},"")+s},CU=function(r,t,e,n){var i="";do e||r--,i=n(r)+i,r/=t;while(r*t>=t);return i},ns=function(r,t,e,n,i){var s=e-t+1;return(r<0?"-":"")+(CU(Math.abs(r),s,n,function(a){return rs(Math.floor(a%s)+t)})+i)},id=function(r,t,e){e===void 0&&(e=". ");var n=t.length;return CU(Math.abs(r),n,!1,function(i){return t[Math.floor(i%n)]})+e},qf=1,th=2,eh=4,cm=8,ju=function(r,t,e,n,i,s){if(r<-9999||r>9999)return lm(r,4,i.length>0);var a=Math.abs(r),o=i;if(a===0)return t[0]+o;for(var A=0;a>0&&A<=4;A++){var f=a%10;f===0&&Es(s,qf)&&o!==""?o=t[f]+o:f>1||f===1&&A===0||f===1&&A===1&&Es(s,th)||f===1&&A===1&&Es(s,eh)&&r>100||f===1&&A>1&&Es(s,cm)?o=t[f]+(A>0?e[A-1]:"")+o:f===1&&A>0&&(o=e[A-1]+o),a=Math.floor(a/10)}return(r<0?n:"")+o},EU="",SU="",TU="",eB="",lm=function(r,t,e){var n=e?". ":"",i=e?"":"",s=e?", ":"",a=e?" ":"";switch(t){case 0:return""+a;case 1:return""+a;case 2:return""+a;case 5:var o=ns(r,48,57,!0,n);return o.length<4?"0"+o:o;case 4:return id(r,"",i);case 6:return jf(r,1,3999,xU,3,n).toLowerCase();case 7:return jf(r,1,3999,xU,3,n);case 8:return ns(r,945,969,!1,n);case 9:return ns(r,97,122,!1,n);case 10:return ns(r,65,90,!1,n);case 11:return ns(r,1632,1641,!0,n);case 12:case 49:return jf(r,1,9999,BU,3,n);case 35:return jf(r,1,9999,BU,3,n).toLowerCase();case 13:return ns(r,2534,2543,!0,n);case 14:case 30:return ns(r,6112,6121,!0,n);case 15:return id(r,"",i);case 16:return id(r,"",i);case 17:case 48:return ju(r,"",EU,"",i,th|eh|cm);case 47:return ju(r,"",SU,"",i,qf|th|eh|cm);case 42:return ju(r,"",EU,"",i,th|eh|cm);case 41:return ju(r,"",SU,"",i,qf|th|eh|cm);case 26:return ju(r,"","",TU,i,0);case 25:return ju(r,"","",TU,i,qf|th|eh);case 31:return ju(r,"","",eB,s,qf|th|eh);case 33:return ju(r,"","",eB,s,0);case 32:return ju(r,"","",eB,s,qf|th|eh);case 18:return ns(r,2406,2415,!0,n);case 20:return jf(r,1,19999,out,3,n);case 21:return ns(r,2790,2799,!0,n);case 22:return ns(r,2662,2671,!0,n);case 22:return jf(r,1,10999,sut,3,n);case 23:return id(r,"");case 24:return id(r,"");case 27:return ns(r,3302,3311,!0,n);case 28:return id(r,"",i);case 29:return id(r,"",i);case 34:return ns(r,3792,3801,!0,n);case 37:return ns(r,6160,6169,!0,n);case 38:return ns(r,4160,4169,!0,n);case 39:return ns(r,2918,2927,!0,n);case 40:return ns(r,1776,1785,!0,n);case 43:return ns(r,3046,3055,!0,n);case 44:return ns(r,3174,3183,!0,n);case 45:return ns(r,3664,3673,!0,n);case 46:return ns(r,3872,3881,!0,n);case 3:default:return ns(r,48,57,!0,n)}},IU="data-html2canvas-ignore",LU=function(){function r(t,e,n){if(this.context=t,this.options=n,this.scrolledElements=[],this.referenceElement=e,this.counters=new iut,this.quoteDepth=0,!e.ownerDocument)throw new Error("Cloned element does not have an owner document");this.documentElement=this.cloneNode(e.ownerDocument.documentElement,!1)}return r.prototype.toIFrame=function(t,e){var n=this,i=aut(t,e);if(!i.contentWindow)return Promise.reject("Unable to find iframe window");var s=t.defaultView.pageXOffset,a=t.defaultView.pageYOffset,o=i.contentWindow,A=o.document,f=uut(i).then(function(){return No(n,void 0,void 0,function(){var m,_;return _o(this,function(x){switch(x.label){case 0:return this.scrolledElements.forEach(fut),o&&(o.scrollTo(e.left,e.top),/(iPad|iPhone|iPod)/g.test(navigator.userAgent)&&(o.scrollY!==e.top||o.scrollX!==e.left)&&(this.context.logger.warn("Unable to restore scroll position for cloned document"),this.context.windowBounds=this.context.windowBounds.add(o.scrollX-e.left,o.scrollY-e.top,0,0))),m=this.options.onclone,_=this.clonedReferenceElement,typeof _>"u"?[2,Promise.reject("Error finding the "+this.referenceElement.nodeName+" in the cloned document")]:A.fonts&&A.fonts.ready?[4,A.fonts.ready]:[3,2];case 1:x.sent(),x.label=2;case 2:return/(AppleWebKit)/g.test(navigator.userAgent)?[4,lut(A)]:[3,4];case 3:x.sent(),x.label=4;case 4:return typeof m=="function"?[2,Promise.resolve().then(function(){return m(A,_)}).then(function(){return i})]:[2,i]}})})});return A.open(),A.write(hut(document.doctype)+"<html></html>"),dut(this.referenceElement.ownerDocument,s,a),A.replaceChild(A.adoptNode(this.documentElement),A.documentElement),A.close(),f},r.prototype.createElementClone=function(t){if(kx(t,2))debugger;if(mU(t))return this.createCanvasClone(t);if(yU(t))return this.createVideoClone(t);if(vU(t))return this.createStyleClone(t);var e=t.cloneNode(!1);return tB(e)&&(tB(t)&&t.currentSrc&&t.currentSrc!==t.src&&(e.src=t.currentSrc,e.srcset=""),e.loading==="lazy"&&(e.loading="eager")),wU(e)?this.createCustomElementClone(e):e},r.prototype.createCustomElementClone=function(t){var e=document.createElement("html2canvascustomelement");return rB(t.style,e),e},r.prototype.createStyleClone=function(t){try{var e=t.sheet;if(e&&e.cssRules){var n=[].slice.call(e.cssRules,0).reduce(function(s,a){return a&&typeof a.cssText=="string"?s+a.cssText:s},""),i=t.cloneNode(!1);return i.textContent=n,i}}catch(s){if(this.context.logger.error("Unable to access cssRules property",s),s.name!=="SecurityError")throw s}return t.cloneNode(!1)},r.prototype.createCanvasClone=function(t){var e;if(this.options.inlineImages&&t.ownerDocument){var n=t.ownerDocument.createElement("img");try{return n.src=t.toDataURL(),n}catch{this.context.logger.info("Unable to inline canvas contents, canvas is tainted",t)}}var i=t.cloneNode(!1);try{i.width=t.width,i.height=t.height;var s=t.getContext("2d"),a=i.getContext("2d");if(a)if(!this.options.allowTaint&&s)a.putImageData(s.getImageData(0,0,t.width,t.height),0,0);else{var o=(e=t.getContext("webgl2"))!==null&&e!==void 0?e:t.getContext("webgl");if(o){var A=o.getContextAttributes();(A==null?void 0:A.preserveDrawingBuffer)===!1&&this.context.logger.warn("Unable to clone WebGL context as it has preserveDrawingBuffer=false",t)}a.drawImage(t,0,0)}return i}catch{this.context.logger.info("Unable to clone canvas as it is tainted",t)}return i},r.prototype.createVideoClone=function(t){var e=t.ownerDocument.createElement("canvas");e.width=t.offsetWidth,e.height=t.offsetHeight;var n=e.getContext("2d");try{return n&&(n.drawImage(t,0,0,e.width,e.height),this.options.allowTaint||n.getImageData(0,0,e.width,e.height)),e}catch{this.context.logger.info("Unable to clone video as it is tainted",t)}var i=t.ownerDocument.createElement("canvas");return i.width=t.offsetWidth,i.height=t.offsetHeight,i},r.prototype.appendChildNode=function(t,e,n){(!Vf(e)||!nut(e)&&!e.hasAttribute(IU)&&(typeof this.options.ignoreElements!="function"||!this.options.ignoreElements(e)))&&(!this.options.copyStyles||!Vf(e)||!vU(e))&&t.appendChild(this.cloneNode(e,n))},r.prototype.cloneChildNodes=function(t,e,n){for(var i=this,s=t.shadowRoot?t.shadowRoot.firstChild:t.firstChild;s;s=s.nextSibling)if(Vf(s)&&bU(s)&&typeof s.assignedNodes=="function"){var a=s.assignedNodes();a.length&&a.forEach(function(o){return i.appendChildNode(e,o,n)})}else this.appendChildNode(e,s,n)},r.prototype.cloneNode=function(t,e){if(pU(t))return document.createTextNode(t.data);if(!t.ownerDocument)return t.cloneNode(!1);var n=t.ownerDocument.defaultView;if(n&&Vf(t)&&(Yx(t)||L1(t))){var i=this.createElementClone(t);i.style.transitionProperty="none";var s=n.getComputedStyle(t),a=n.getComputedStyle(t,":before"),o=n.getComputedStyle(t,":after");this.referenceElement===t&&Yx(i)&&(this.clonedReferenceElement=i),Zx(i)&&mut(i);var A=this.counters.parse(new GM(this.context,s)),f=this.resolvePseudoContent(t,i,a,um.BEFORE);wU(t)&&(e=!0),yU(t)||this.cloneChildNodes(t,i,e),f&&i.insertBefore(f,i.firstChild);var m=this.resolvePseudoContent(t,i,o,um.AFTER);return m&&i.appendChild(m),this.counters.pop(A),(s&&(this.options.copyStyles||L1(t))&&!_U(t)||e)&&rB(s,i),(t.scrollTop!==0||t.scrollLeft!==0)&&this.scrolledElements.push([i,t.scrollLeft,t.scrollTop]),(F1(t)||P1(t))&&(F1(i)||P1(i))&&(i.value=t.value),i}return t.cloneNode(!1)},r.prototype.resolvePseudoContent=function(t,e,n,i){var s=this;if(n){var a=n.content,o=e.ownerDocument;if(!(!o||!a||a==="none"||a==="-moz-alt-content"||n.display==="none")){this.counters.parse(new GM(this.context,n));var A=new Zct(this.context,n),f=o.createElement("html2canvaspseudoelement");rB(n,f),A.content.forEach(function(_){if(_.type===0)f.appendChild(o.createTextNode(_.value));else if(_.type===22){var x=o.createElement("img");x.src=_.value,x.style.opacity="1",f.appendChild(x)}else if(_.type===18){if(_.name==="attr"){var B=_.values.filter(si);B.length&&f.appendChild(o.createTextNode(t.getAttribute(B[0].value)||""))}else if(_.name==="counter"){var P=_.values.filter(zf),M=P[0],k=P[1];if(M&&si(M)){var Q=s.counters.getCounterValue(M.value),q=k&&si(k)?Nx.parse(s.context,k.value):3;f.appendChild(o.createTextNode(lm(Q,q,!1)))}}else if(_.name==="counters"){var J=_.values.filter(zf),M=J[0],tt=J[1],k=J[2];if(M&&si(M)){var ft=s.counters.getCounterValues(M.value),pt=k&&si(k)?Nx.parse(s.context,k.value):3,mt=tt&&tt.type===0?tt.value:"",dt=ft.map(function(st){return lm(st,pt,!1)}).join(mt);f.appendChild(o.createTextNode(dt))}}}else if(_.type===20)switch(_.value){case"open-quote":f.appendChild(o.createTextNode(zM(A.quotes,s.quoteDepth++,!0)));break;case"close-quote":f.appendChild(o.createTextNode(zM(A.quotes,--s.quoteDepth,!1)));break;default:f.appendChild(o.createTextNode(_.value))}}),f.className=nB+" "+iB;var m=i===um.BEFORE?" "+nB:" "+iB;return L1(e)?e.className.baseValue+=m:e.className+=m,f}}},r.destroy=function(t){return t.parentNode?(t.parentNode.removeChild(t),!0):!1},r}(),um;(function(r){r[r.BEFORE=0]="BEFORE",r[r.AFTER=1]="AFTER"})(um||(um={}));var aut=function(r,t){var e=r.createElement("iframe");return e.className="html2canvas-container",e.style.visibility="hidden",e.style.position="fixed",e.style.left="-10000px",e.style.top="0px",e.style.border="0",e.width=t.width.toString(),e.height=t.height.toString(),e.scrolling="no",e.setAttribute(IU,"true"),r.body.appendChild(e),e},cut=function(r){return new Promise(function(t){if(r.complete){t();return}if(!r.src){t();return}r.onload=t,r.onerror=t})},lut=function(r){return Promise.all([].slice.call(r.images,0).map(cut))},uut=function(r){return new Promise(function(t,e){var n=r.contentWindow;if(!n)return e("No window assigned for iframe");var i=n.document;n.onload=r.onload=function(){n.onload=r.onload=null;var s=setInterval(function(){i.body.childNodes.length>0&&i.readyState==="complete"&&(clearInterval(s),t(r))},50)}})},Aut=["all","d","content"],rB=function(r,t){for(var e=r.length-1;e>=0;e--){var n=r.item(e);Aut.indexOf(n)===-1&&t.style.setProperty(n,r.getPropertyValue(n))}return t},hut=function(r){var t="";return r&&(t+="<!DOCTYPE ",r.name&&(t+=r.name),r.internalSubset&&(t+=r.internalSubset),r.publicId&&(t+='"'+r.publicId+'"'),r.systemId&&(t+='"'+r.systemId+'"'),t+=">"),t},dut=function(r,t,e){r&&r.defaultView&&(t!==r.defaultView.pageXOffset||e!==r.defaultView.pageYOffset)&&r.defaultView.scrollTo(t,e)},fut=function(r){var t=r[0],e=r[1],n=r[2];t.scrollLeft=e,t.scrollTop=n},put=":before",gut=":after",nB="___html2canvas___pseudoelement_before",iB="___html2canvas___pseudoelement_after",FU=`{
    content: "" !important;
    display: none !important;
}`,mut=function(r){yut(r,"."+nB+put+FU+`
         .`+iB+gut+FU)},yut=function(r,t){var e=r.ownerDocument;if(e){var n=e.createElement("style");n.textContent=t,r.appendChild(n)}},PU=function(){function r(){}return r.getOrigin=function(t){var e=r._link;return e?(e.href=t,e.href=e.href,e.protocol+e.hostname+e.port):"about:blank"},r.isSameOrigin=function(t){return r.getOrigin(t)===r._origin},r.setContext=function(t){r._link=t.document.createElement("a"),r._origin=r.getOrigin(t.location.href)},r._origin="about:blank",r}(),_ut=function(){function r(t,e){this.context=t,this._options=e,this._cache={}}return r.prototype.addImage=function(t){var e=Promise.resolve();return this.has(t)||(oB(t)||xut(t))&&(this._cache[t]=this.loadImage(t)).catch(function(){}),e},r.prototype.match=function(t){return this._cache[t]},r.prototype.loadImage=function(t){return No(this,void 0,void 0,function(){var e,n,i,s,a=this;return _o(this,function(o){switch(o.label){case 0:return e=PU.isSameOrigin(t),n=!sB(t)&&this._options.useCORS===!0&&Js.SUPPORT_CORS_IMAGES&&!e,i=!sB(t)&&!e&&!oB(t)&&typeof this._options.proxy=="string"&&Js.SUPPORT_CORS_XHR&&!n,!e&&this._options.allowTaint===!1&&!sB(t)&&!oB(t)&&!i&&!n?[2]:(s=t,i?[4,this.proxy(s)]:[3,2]);case 1:s=o.sent(),o.label=2;case 2:return this.context.logger.debug("Added image "+t.substring(0,256)),[4,new Promise(function(A,f){var m=new Image;m.onload=function(){return A(m)},m.onerror=f,(But(s)||n)&&(m.crossOrigin="anonymous"),m.src=s,m.complete===!0&&setTimeout(function(){return A(m)},500),a._options.imageTimeout>0&&setTimeout(function(){return f("Timed out ("+a._options.imageTimeout+"ms) loading image")},a._options.imageTimeout)})];case 3:return[2,o.sent()]}})})},r.prototype.has=function(t){return typeof this._cache[t]<"u"},r.prototype.keys=function(){return Promise.resolve(Object.keys(this._cache))},r.prototype.proxy=function(t){var e=this,n=this._options.proxy;if(!n)throw new Error("No proxy defined");var i=t.substring(0,256);return new Promise(function(s,a){var o=Js.SUPPORT_RESPONSE_TYPE?"blob":"text",A=new XMLHttpRequest;A.onload=function(){if(A.status===200)if(o==="text")s(A.response);else{var _=new FileReader;_.addEventListener("load",function(){return s(_.result)},!1),_.addEventListener("error",function(x){return a(x)},!1),_.readAsDataURL(A.response)}else a("Failed to proxy resource "+i+" with status code "+A.status)},A.onerror=a;var f=n.indexOf("?")>-1?"&":"?";if(A.open("GET",""+n+f+"url="+encodeURIComponent(t)+"&responseType="+o),o!=="text"&&A instanceof XMLHttpRequest&&(A.responseType=o),e._options.imageTimeout){var m=e._options.imageTimeout;A.timeout=m,A.ontimeout=function(){return a("Timed out ("+m+"ms) proxying "+i)}}A.send()})},r}(),vut=/^data:image\/svg\+xml/i,but=/^data:image\/.*;base64,/i,wut=/^data:image\/.*/i,xut=function(r){return Js.SUPPORT_SVG_DRAWING||!Cut(r)},sB=function(r){return wut.test(r)},But=function(r){return but.test(r)},oB=function(r){return r.substr(0,4)==="blob"},Cut=function(r){return r.substr(-3).toLowerCase()==="svg"||vut.test(r)},ur=function(){function r(t,e){this.type=0,this.x=t,this.y=e}return r.prototype.add=function(t,e){return new r(this.x+t,this.y+e)},r}(),Kf=function(r,t,e){return new ur(r.x+(t.x-r.x)*e,r.y+(t.y-r.y)*e)},M1=function(){function r(t,e,n,i){this.type=1,this.start=t,this.startControl=e,this.endControl=n,this.end=i}return r.prototype.subdivide=function(t,e){var n=Kf(this.start,this.startControl,t),i=Kf(this.startControl,this.endControl,t),s=Kf(this.endControl,this.end,t),a=Kf(n,i,t),o=Kf(i,s,t),A=Kf(a,o,t);return e?new r(this.start,n,a,A):new r(A,o,s,this.end)},r.prototype.add=function(t,e){return new r(this.start.add(t,e),this.startControl.add(t,e),this.endControl.add(t,e),this.end.add(t,e))},r.prototype.reverse=function(){return new r(this.end,this.endControl,this.startControl,this.start)},r}(),hc=function(r){return r.type===1},Eut=function(){function r(t){var e=t.styles,n=t.bounds,i=nm(e.borderTopLeftRadius,n.width,n.height),s=i[0],a=i[1],o=nm(e.borderTopRightRadius,n.width,n.height),A=o[0],f=o[1],m=nm(e.borderBottomRightRadius,n.width,n.height),_=m[0],x=m[1],B=nm(e.borderBottomLeftRadius,n.width,n.height),P=B[0],M=B[1],k=[];k.push((s+A)/n.width),k.push((P+_)/n.width),k.push((a+M)/n.height),k.push((f+x)/n.height);var Q=Math.max.apply(Math,k);Q>1&&(s/=Q,a/=Q,A/=Q,f/=Q,_/=Q,x/=Q,P/=Q,M/=Q);var q=n.width-A,J=n.height-x,tt=n.width-_,ft=n.height-M,pt=e.borderTopWidth,mt=e.borderRightWidth,dt=e.borderBottomWidth,Rt=e.borderLeftWidth,Lt=yi(e.paddingTop,t.bounds.width),st=yi(e.paddingRight,t.bounds.width),ct=yi(e.paddingBottom,t.bounds.width),wt=yi(e.paddingLeft,t.bounds.width);this.topLeftBorderDoubleOuterBox=s>0||a>0?Ii(n.left+Rt/3,n.top+pt/3,s-Rt/3,a-pt/3,Kn.TOP_LEFT):new ur(n.left+Rt/3,n.top+pt/3),this.topRightBorderDoubleOuterBox=s>0||a>0?Ii(n.left+q,n.top+pt/3,A-mt/3,f-pt/3,Kn.TOP_RIGHT):new ur(n.left+n.width-mt/3,n.top+pt/3),this.bottomRightBorderDoubleOuterBox=_>0||x>0?Ii(n.left+tt,n.top+J,_-mt/3,x-dt/3,Kn.BOTTOM_RIGHT):new ur(n.left+n.width-mt/3,n.top+n.height-dt/3),this.bottomLeftBorderDoubleOuterBox=P>0||M>0?Ii(n.left+Rt/3,n.top+ft,P-Rt/3,M-dt/3,Kn.BOTTOM_LEFT):new ur(n.left+Rt/3,n.top+n.height-dt/3),this.topLeftBorderDoubleInnerBox=s>0||a>0?Ii(n.left+Rt*2/3,n.top+pt*2/3,s-Rt*2/3,a-pt*2/3,Kn.TOP_LEFT):new ur(n.left+Rt*2/3,n.top+pt*2/3),this.topRightBorderDoubleInnerBox=s>0||a>0?Ii(n.left+q,n.top+pt*2/3,A-mt*2/3,f-pt*2/3,Kn.TOP_RIGHT):new ur(n.left+n.width-mt*2/3,n.top+pt*2/3),this.bottomRightBorderDoubleInnerBox=_>0||x>0?Ii(n.left+tt,n.top+J,_-mt*2/3,x-dt*2/3,Kn.BOTTOM_RIGHT):new ur(n.left+n.width-mt*2/3,n.top+n.height-dt*2/3),this.bottomLeftBorderDoubleInnerBox=P>0||M>0?Ii(n.left+Rt*2/3,n.top+ft,P-Rt*2/3,M-dt*2/3,Kn.BOTTOM_LEFT):new ur(n.left+Rt*2/3,n.top+n.height-dt*2/3),this.topLeftBorderStroke=s>0||a>0?Ii(n.left+Rt/2,n.top+pt/2,s-Rt/2,a-pt/2,Kn.TOP_LEFT):new ur(n.left+Rt/2,n.top+pt/2),this.topRightBorderStroke=s>0||a>0?Ii(n.left+q,n.top+pt/2,A-mt/2,f-pt/2,Kn.TOP_RIGHT):new ur(n.left+n.width-mt/2,n.top+pt/2),this.bottomRightBorderStroke=_>0||x>0?Ii(n.left+tt,n.top+J,_-mt/2,x-dt/2,Kn.BOTTOM_RIGHT):new ur(n.left+n.width-mt/2,n.top+n.height-dt/2),this.bottomLeftBorderStroke=P>0||M>0?Ii(n.left+Rt/2,n.top+ft,P-Rt/2,M-dt/2,Kn.BOTTOM_LEFT):new ur(n.left+Rt/2,n.top+n.height-dt/2),this.topLeftBorderBox=s>0||a>0?Ii(n.left,n.top,s,a,Kn.TOP_LEFT):new ur(n.left,n.top),this.topRightBorderBox=A>0||f>0?Ii(n.left+q,n.top,A,f,Kn.TOP_RIGHT):new ur(n.left+n.width,n.top),this.bottomRightBorderBox=_>0||x>0?Ii(n.left+tt,n.top+J,_,x,Kn.BOTTOM_RIGHT):new ur(n.left+n.width,n.top+n.height),this.bottomLeftBorderBox=P>0||M>0?Ii(n.left,n.top+ft,P,M,Kn.BOTTOM_LEFT):new ur(n.left,n.top+n.height),this.topLeftPaddingBox=s>0||a>0?Ii(n.left+Rt,n.top+pt,Math.max(0,s-Rt),Math.max(0,a-pt),Kn.TOP_LEFT):new ur(n.left+Rt,n.top+pt),this.topRightPaddingBox=A>0||f>0?Ii(n.left+Math.min(q,n.width-mt),n.top+pt,q>n.width+mt?0:Math.max(0,A-mt),Math.max(0,f-pt),Kn.TOP_RIGHT):new ur(n.left+n.width-mt,n.top+pt),this.bottomRightPaddingBox=_>0||x>0?Ii(n.left+Math.min(tt,n.width-Rt),n.top+Math.min(J,n.height-dt),Math.max(0,_-mt),Math.max(0,x-dt),Kn.BOTTOM_RIGHT):new ur(n.left+n.width-mt,n.top+n.height-dt),this.bottomLeftPaddingBox=P>0||M>0?Ii(n.left+Rt,n.top+Math.min(ft,n.height-dt),Math.max(0,P-Rt),Math.max(0,M-dt),Kn.BOTTOM_LEFT):new ur(n.left+Rt,n.top+n.height-dt),this.topLeftContentBox=s>0||a>0?Ii(n.left+Rt+wt,n.top+pt+Lt,Math.max(0,s-(Rt+wt)),Math.max(0,a-(pt+Lt)),Kn.TOP_LEFT):new ur(n.left+Rt+wt,n.top+pt+Lt),this.topRightContentBox=A>0||f>0?Ii(n.left+Math.min(q,n.width+Rt+wt),n.top+pt+Lt,q>n.width+Rt+wt?0:A-Rt+wt,f-(pt+Lt),Kn.TOP_RIGHT):new ur(n.left+n.width-(mt+st),n.top+pt+Lt),this.bottomRightContentBox=_>0||x>0?Ii(n.left+Math.min(tt,n.width-(Rt+wt)),n.top+Math.min(J,n.height+pt+Lt),Math.max(0,_-(mt+st)),x-(dt+ct),Kn.BOTTOM_RIGHT):new ur(n.left+n.width-(mt+st),n.top+n.height-(dt+ct)),this.bottomLeftContentBox=P>0||M>0?Ii(n.left+Rt+wt,n.top+ft,Math.max(0,P-(Rt+wt)),M-(dt+ct),Kn.BOTTOM_LEFT):new ur(n.left+Rt+wt,n.top+n.height-(dt+ct))}return r}(),Kn;(function(r){r[r.TOP_LEFT=0]="TOP_LEFT",r[r.TOP_RIGHT=1]="TOP_RIGHT",r[r.BOTTOM_RIGHT=2]="BOTTOM_RIGHT",r[r.BOTTOM_LEFT=3]="BOTTOM_LEFT"})(Kn||(Kn={}));var Ii=function(r,t,e,n,i){var s=4*((Math.sqrt(2)-1)/3),a=e*s,o=n*s,A=r+e,f=t+n;switch(i){case Kn.TOP_LEFT:return new M1(new ur(r,f),new ur(r,f-o),new ur(A-a,t),new ur(A,t));case Kn.TOP_RIGHT:return new M1(new ur(r,t),new ur(r+a,t),new ur(A,f-o),new ur(A,f));case Kn.BOTTOM_RIGHT:return new M1(new ur(A,t),new ur(A,t+o),new ur(r+a,f),new ur(r,f));case Kn.BOTTOM_LEFT:default:return new M1(new ur(A,f),new ur(A-a,f),new ur(r,t+o),new ur(r,t))}},U1=function(r){return[r.topLeftBorderBox,r.topRightBorderBox,r.bottomRightBorderBox,r.bottomLeftBorderBox]},Sut=function(r){return[r.topLeftContentBox,r.topRightContentBox,r.bottomRightContentBox,r.bottomLeftContentBox]},R1=function(r){return[r.topLeftPaddingBox,r.topRightPaddingBox,r.bottomRightPaddingBox,r.bottomLeftPaddingBox]},Tut=function(){function r(t,e,n){this.offsetX=t,this.offsetY=e,this.matrix=n,this.type=0,this.target=6}return r}(),O1=function(){function r(t,e){this.path=t,this.target=e,this.type=1}return r}(),Iut=function(){function r(t){this.opacity=t,this.type=2,this.target=6}return r}(),Lut=function(r){return r.type===0},MU=function(r){return r.type===1},Fut=function(r){return r.type===2},UU=function(r,t){return r.length===t.length?r.some(function(e,n){return e===t[n]}):!1},Put=function(r,t,e,n,i){return r.map(function(s,a){switch(a){case 0:return s.add(t,e);case 1:return s.add(t+n,e);case 2:return s.add(t+n,e+i);case 3:return s.add(t,e+i)}return s})},RU=function(){function r(t){this.element=t,this.inlineLevel=[],this.nonInlineLevel=[],this.negativeZIndex=[],this.zeroOrAutoZIndexOrTransformedOrOpacity=[],this.positiveZIndex=[],this.nonPositionedFloats=[],this.nonPositionedInlineLevel=[]}return r}(),OU=function(){function r(t,e){if(this.container=t,this.parent=e,this.effects=[],this.curves=new Eut(this.container),this.container.styles.opacity<1&&this.effects.push(new Iut(this.container.styles.opacity)),this.container.styles.transform!==null){var n=this.container.bounds.left+this.container.styles.transformOrigin[0].number,i=this.container.bounds.top+this.container.styles.transformOrigin[1].number,s=this.container.styles.transform;this.effects.push(new Tut(n,i,s))}if(this.container.styles.overflowX!==0){var a=U1(this.curves),o=R1(this.curves);UU(a,o)?this.effects.push(new O1(a,6)):(this.effects.push(new O1(a,2)),this.effects.push(new O1(o,4)))}}return r.prototype.getEffects=function(t){for(var e=[2,3].indexOf(this.container.styles.position)===-1,n=this.parent,i=this.effects.slice(0);n;){var s=n.effects.filter(function(A){return!MU(A)});if(e||n.container.styles.position!==0||!n.parent){if(i.unshift.apply(i,s),e=[2,3].indexOf(n.container.styles.position)===-1,n.container.styles.overflowX!==0){var a=U1(n.curves),o=R1(n.curves);UU(a,o)||i.unshift(new O1(o,6))}}else i.unshift.apply(i,s);n=n.parent}return i.filter(function(A){return Es(A.target,t)})},r}(),aB=function(r,t,e,n){r.container.elements.forEach(function(i){var s=Es(i.flags,4),a=Es(i.flags,2),o=new OU(i,r);Es(i.styles.display,2048)&&n.push(o);var A=Es(i.flags,8)?[]:n;if(s||a){var f=s||i.styles.isPositioned()?e:t,m=new RU(o);if(i.styles.isPositioned()||i.styles.opacity<1||i.styles.isTransformed()){var _=i.styles.zIndex.order;if(_<0){var x=0;f.negativeZIndex.some(function(P,M){return _>P.element.container.styles.zIndex.order?(x=M,!1):x>0}),f.negativeZIndex.splice(x,0,m)}else if(_>0){var B=0;f.positiveZIndex.some(function(P,M){return _>=P.element.container.styles.zIndex.order?(B=M+1,!1):B>0}),f.positiveZIndex.splice(B,0,m)}else f.zeroOrAutoZIndexOrTransformedOrOpacity.push(m)}else i.styles.isFloating()?f.nonPositionedFloats.push(m):f.nonPositionedInlineLevel.push(m);aB(o,m,s?m:e,A)}else i.styles.isInlineLevel()?t.inlineLevel.push(o):t.nonInlineLevel.push(o),aB(o,t,e,A);Es(i.flags,8)&&DU(i,A)})},DU=function(r,t){for(var e=r instanceof Xx?r.start:1,n=r instanceof Xx?r.reversed:!1,i=0;i<t.length;i++){var s=t[i];s.container instanceof cU&&typeof s.container.value=="number"&&s.container.value!==0&&(e=s.container.value),s.listValue=lm(e,s.container.styles.listStyleType,!0),e+=n?-1:1}},Mut=function(r){var t=new OU(r,null),e=new RU(t),n=[];return aB(t,e,e,n),DU(t.container,n),e},NU=function(r,t){switch(t){case 0:return dc(r.topLeftBorderBox,r.topLeftPaddingBox,r.topRightBorderBox,r.topRightPaddingBox);case 1:return dc(r.topRightBorderBox,r.topRightPaddingBox,r.bottomRightBorderBox,r.bottomRightPaddingBox);case 2:return dc(r.bottomRightBorderBox,r.bottomRightPaddingBox,r.bottomLeftBorderBox,r.bottomLeftPaddingBox);case 3:default:return dc(r.bottomLeftBorderBox,r.bottomLeftPaddingBox,r.topLeftBorderBox,r.topLeftPaddingBox)}},Uut=function(r,t){switch(t){case 0:return dc(r.topLeftBorderBox,r.topLeftBorderDoubleOuterBox,r.topRightBorderBox,r.topRightBorderDoubleOuterBox);case 1:return dc(r.topRightBorderBox,r.topRightBorderDoubleOuterBox,r.bottomRightBorderBox,r.bottomRightBorderDoubleOuterBox);case 2:return dc(r.bottomRightBorderBox,r.bottomRightBorderDoubleOuterBox,r.bottomLeftBorderBox,r.bottomLeftBorderDoubleOuterBox);case 3:default:return dc(r.bottomLeftBorderBox,r.bottomLeftBorderDoubleOuterBox,r.topLeftBorderBox,r.topLeftBorderDoubleOuterBox)}},Rut=function(r,t){switch(t){case 0:return dc(r.topLeftBorderDoubleInnerBox,r.topLeftPaddingBox,r.topRightBorderDoubleInnerBox,r.topRightPaddingBox);case 1:return dc(r.topRightBorderDoubleInnerBox,r.topRightPaddingBox,r.bottomRightBorderDoubleInnerBox,r.bottomRightPaddingBox);case 2:return dc(r.bottomRightBorderDoubleInnerBox,r.bottomRightPaddingBox,r.bottomLeftBorderDoubleInnerBox,r.bottomLeftPaddingBox);case 3:default:return dc(r.bottomLeftBorderDoubleInnerBox,r.bottomLeftPaddingBox,r.topLeftBorderDoubleInnerBox,r.topLeftPaddingBox)}},Out=function(r,t){switch(t){case 0:return D1(r.topLeftBorderStroke,r.topRightBorderStroke);case 1:return D1(r.topRightBorderStroke,r.bottomRightBorderStroke);case 2:return D1(r.bottomRightBorderStroke,r.bottomLeftBorderStroke);case 3:default:return D1(r.bottomLeftBorderStroke,r.topLeftBorderStroke)}},D1=function(r,t){var e=[];return hc(r)?e.push(r.subdivide(.5,!1)):e.push(r),hc(t)?e.push(t.subdivide(.5,!0)):e.push(t),e},dc=function(r,t,e,n){var i=[];return hc(r)?i.push(r.subdivide(.5,!1)):i.push(r),hc(e)?i.push(e.subdivide(.5,!0)):i.push(e),hc(n)?i.push(n.subdivide(.5,!0).reverse()):i.push(n),hc(t)?i.push(t.subdivide(.5,!1).reverse()):i.push(t),i},kU=function(r){var t=r.bounds,e=r.styles;return t.add(e.borderLeftWidth,e.borderTopWidth,-(e.borderRightWidth+e.borderLeftWidth),-(e.borderTopWidth+e.borderBottomWidth))},N1=function(r){var t=r.styles,e=r.bounds,n=yi(t.paddingLeft,e.width),i=yi(t.paddingRight,e.width),s=yi(t.paddingTop,e.width),a=yi(t.paddingBottom,e.width);return e.add(n+t.borderLeftWidth,s+t.borderTopWidth,-(t.borderRightWidth+t.borderLeftWidth+n+i),-(t.borderTopWidth+t.borderBottomWidth+s+a))},Dut=function(r,t){return r===0?t.bounds:r===2?N1(t):kU(t)},Nut=function(r,t){return r===0?t.bounds:r===2?N1(t):kU(t)},cB=function(r,t,e){var n=Dut(Wf(r.styles.backgroundOrigin,t),r),i=Nut(Wf(r.styles.backgroundClip,t),r),s=kut(Wf(r.styles.backgroundSize,t),e,n),a=s[0],o=s[1],A=nm(Wf(r.styles.backgroundPosition,t),n.width-a,n.height-o),f=Qut(Wf(r.styles.backgroundRepeat,t),A,s,n,i),m=Math.round(n.left+A[0]),_=Math.round(n.top+A[1]);return[f,m,_,a,o]},$f=function(r){return si(r)&&r.value===Gf.AUTO},k1=function(r){return typeof r=="number"},kut=function(r,t,e){var n=t[0],i=t[1],s=t[2],a=r[0],o=r[1];if(!a)return[0,0];if(_s(a)&&o&&_s(o))return[yi(a,e.width),yi(o,e.height)];var A=k1(s);if(si(a)&&(a.value===Gf.CONTAIN||a.value===Gf.COVER)){if(k1(s)){var f=e.width/e.height;return f<s!=(a.value===Gf.COVER)?[e.width,e.width/s]:[e.height*s,e.height]}return[e.width,e.height]}var m=k1(n),_=k1(i),x=m||_;if($f(a)&&(!o||$f(o))){if(m&&_)return[n,i];if(!A&&!x)return[e.width,e.height];if(x&&A){var B=m?n:i*s,P=_?i:n/s;return[B,P]}var M=m?n:e.width,k=_?i:e.height;return[M,k]}if(A){var Q=0,q=0;return _s(a)?Q=yi(a,e.width):_s(o)&&(q=yi(o,e.height)),$f(a)?Q=q*s:(!o||$f(o))&&(q=Q/s),[Q,q]}var J=null,tt=null;if(_s(a)?J=yi(a,e.width):o&&_s(o)&&(tt=yi(o,e.height)),J!==null&&(!o||$f(o))&&(tt=m&&_?J/n*i:e.height),tt!==null&&$f(a)&&(J=m&&_?tt/i*n:e.width),J!==null&&tt!==null)return[J,tt];throw new Error("Unable to calculate background-size for element")},Wf=function(r,t){var e=r[t];return typeof e>"u"?r[0]:e},Qut=function(r,t,e,n,i){var s=t[0],a=t[1],o=e[0],A=e[1];switch(r){case 2:return[new ur(Math.round(n.left),Math.round(n.top+a)),new ur(Math.round(n.left+n.width),Math.round(n.top+a)),new ur(Math.round(n.left+n.width),Math.round(A+n.top+a)),new ur(Math.round(n.left),Math.round(A+n.top+a))];case 3:return[new ur(Math.round(n.left+s),Math.round(n.top)),new ur(Math.round(n.left+s+o),Math.round(n.top)),new ur(Math.round(n.left+s+o),Math.round(n.height+n.top)),new ur(Math.round(n.left+s),Math.round(n.height+n.top))];case 1:return[new ur(Math.round(n.left+s),Math.round(n.top+a)),new ur(Math.round(n.left+s+o),Math.round(n.top+a)),new ur(Math.round(n.left+s+o),Math.round(n.top+a+A)),new ur(Math.round(n.left+s),Math.round(n.top+a+A))];default:return[new ur(Math.round(i.left),Math.round(i.top)),new ur(Math.round(i.left+i.width),Math.round(i.top)),new ur(Math.round(i.left+i.width),Math.round(i.height+i.top)),new ur(Math.round(i.left),Math.round(i.height+i.top))]}},Hut="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",QU="Hidden Text",zut=function(){function r(t){this._data={},this._document=t}return r.prototype.parseMetrics=function(t,e){var n=this._document.createElement("div"),i=this._document.createElement("img"),s=this._document.createElement("span"),a=this._document.body;n.style.visibility="hidden",n.style.fontFamily=t,n.style.fontSize=e,n.style.margin="0",n.style.padding="0",n.style.whiteSpace="nowrap",a.appendChild(n),i.src=Hut,i.width=1,i.height=1,i.style.margin="0",i.style.padding="0",i.style.verticalAlign="baseline",s.style.fontFamily=t,s.style.fontSize=e,s.style.margin="0",s.style.padding="0",s.appendChild(this._document.createTextNode(QU)),n.appendChild(s),n.appendChild(i);var o=i.offsetTop-s.offsetTop+2;n.removeChild(s),n.appendChild(this._document.createTextNode(QU)),n.style.lineHeight="normal",i.style.verticalAlign="super";var A=i.offsetTop-n.offsetTop+2;return a.removeChild(n),{baseline:o,middle:A}},r.prototype.getMetrics=function(t,e){var n=t+" "+e;return typeof this._data[n]>"u"&&(this._data[n]=this.parseMetrics(t,e)),this._data[n]},r}(),HU=function(){function r(t,e){this.context=t,this.options=e}return r}(),Gut=1e4,Vut=function(r){Zc(t,r);function t(e,n){var i=r.call(this,e,n)||this;return i._activeEffects=[],i.canvas=n.canvas?n.canvas:document.createElement("canvas"),i.ctx=i.canvas.getContext("2d"),n.canvas||(i.canvas.width=Math.floor(n.width*n.scale),i.canvas.height=Math.floor(n.height*n.scale),i.canvas.style.width=n.width+"px",i.canvas.style.height=n.height+"px"),i.fontMetrics=new zut(document),i.ctx.scale(i.options.scale,i.options.scale),i.ctx.translate(-n.x,-n.y),i.ctx.textBaseline="bottom",i._activeEffects=[],i.context.logger.debug("Canvas renderer initialized ("+n.width+"x"+n.height+") with scale "+n.scale),i}return t.prototype.applyEffects=function(e){for(var n=this;this._activeEffects.length;)this.popEffect();e.forEach(function(i){return n.applyEffect(i)})},t.prototype.applyEffect=function(e){this.ctx.save(),Fut(e)&&(this.ctx.globalAlpha=e.opacity),Lut(e)&&(this.ctx.translate(e.offsetX,e.offsetY),this.ctx.transform(e.matrix[0],e.matrix[1],e.matrix[2],e.matrix[3],e.matrix[4],e.matrix[5]),this.ctx.translate(-e.offsetX,-e.offsetY)),MU(e)&&(this.path(e.path),this.ctx.clip()),this._activeEffects.push(e)},t.prototype.popEffect=function(){this._activeEffects.pop(),this.ctx.restore()},t.prototype.renderStack=function(e){return No(this,void 0,void 0,function(){var n;return _o(this,function(i){switch(i.label){case 0:return n=e.element.container.styles,n.isVisible()?[4,this.renderStackContent(e)]:[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}})})},t.prototype.renderNode=function(e){return No(this,void 0,void 0,function(){return _o(this,function(n){switch(n.label){case 0:if(Es(e.container.flags,16))debugger;return e.container.styles.isVisible()?[4,this.renderNodeBackgroundAndBorders(e)]:[3,3];case 1:return n.sent(),[4,this.renderNodeContent(e)];case 2:n.sent(),n.label=3;case 3:return[2]}})})},t.prototype.renderTextWithLetterSpacing=function(e,n,i){var s=this;if(n===0)this.ctx.fillText(e.text,e.bounds.left,e.bounds.top+i);else{var a=Wx(e.text);a.reduce(function(o,A){return s.ctx.fillText(A,o,e.bounds.top+i),o+s.ctx.measureText(A).width},e.bounds.left)}},t.prototype.createFontStyle=function(e){var n=e.fontVariant.filter(function(a){return a==="normal"||a==="small-caps"}).join(""),i=Wut(e.fontFamily).join(", "),s=rm(e.fontSize)?""+e.fontSize.number+e.fontSize.unit:e.fontSize.number+"px";return[[e.fontStyle,n,e.fontWeight,s,i].join(" "),i,s]},t.prototype.renderTextNode=function(e,n){return No(this,void 0,void 0,function(){var i,s,a,o,A,f,m,_,x=this;return _o(this,function(B){return i=this.createFontStyle(n),s=i[0],a=i[1],o=i[2],this.ctx.font=s,this.ctx.direction=n.direction===1?"rtl":"ltr",this.ctx.textAlign="left",this.ctx.textBaseline="alphabetic",A=this.fontMetrics.getMetrics(a,o),f=A.baseline,m=A.middle,_=n.paintOrder,e.textBounds.forEach(function(P){_.forEach(function(M){switch(M){case 0:x.ctx.fillStyle=Os(n.color),x.renderTextWithLetterSpacing(P,n.letterSpacing,f);var k=n.textShadow;k.length&&P.text.trim().length&&(k.slice(0).reverse().forEach(function(Q){x.ctx.shadowColor=Os(Q.color),x.ctx.shadowOffsetX=Q.offsetX.number*x.options.scale,x.ctx.shadowOffsetY=Q.offsetY.number*x.options.scale,x.ctx.shadowBlur=Q.blur.number,x.renderTextWithLetterSpacing(P,n.letterSpacing,f)}),x.ctx.shadowColor="",x.ctx.shadowOffsetX=0,x.ctx.shadowOffsetY=0,x.ctx.shadowBlur=0),n.textDecorationLine.length&&(x.ctx.fillStyle=Os(n.textDecorationColor||n.color),n.textDecorationLine.forEach(function(Q){switch(Q){case 1:x.ctx.fillRect(P.bounds.left,Math.round(P.bounds.top+f),P.bounds.width,1);break;case 2:x.ctx.fillRect(P.bounds.left,Math.round(P.bounds.top),P.bounds.width,1);break;case 3:x.ctx.fillRect(P.bounds.left,Math.ceil(P.bounds.top+m),P.bounds.width,1);break}}));break;case 1:n.webkitTextStrokeWidth&&P.text.trim().length&&(x.ctx.strokeStyle=Os(n.webkitTextStrokeColor),x.ctx.lineWidth=n.webkitTextStrokeWidth,x.ctx.lineJoin=window.chrome?"miter":"round",x.ctx.strokeText(P.text,P.bounds.left,P.bounds.top+f)),x.ctx.strokeStyle="",x.ctx.lineWidth=0,x.ctx.lineJoin="miter";break}})}),[2]})})},t.prototype.renderReplacedElement=function(e,n,i){if(i&&e.intrinsicWidth>0&&e.intrinsicHeight>0){var s=N1(e),a=R1(n);this.path(a),this.ctx.save(),this.ctx.clip(),this.ctx.drawImage(i,0,0,e.intrinsicWidth,e.intrinsicHeight,s.left,s.top,s.width,s.height),this.ctx.restore()}},t.prototype.renderNodeContent=function(e){return No(this,void 0,void 0,function(){var n,i,s,a,o,A,q,q,f,m,_,x,tt,B,P,ft,M,k,Q,q,J,tt,ft;return _o(this,function(pt){switch(pt.label){case 0:this.applyEffects(e.getEffects(4)),n=e.container,i=e.curves,s=n.styles,a=0,o=n.textNodes,pt.label=1;case 1:return a<o.length?(A=o[a],[4,this.renderTextNode(A,s)]):[3,4];case 2:pt.sent(),pt.label=3;case 3:return a++,[3,1];case 4:if(!(n instanceof sU))return[3,8];pt.label=5;case 5:return pt.trys.push([5,7,,8]),[4,this.context.cache.match(n.src)];case 6:return q=pt.sent(),this.renderReplacedElement(n,i,q),[3,8];case 7:return pt.sent(),this.context.logger.error("Error loading image "+n.src),[3,8];case 8:if(n instanceof oU&&this.renderReplacedElement(n,i,n.canvas),!(n instanceof aU))return[3,12];pt.label=9;case 9:return pt.trys.push([9,11,,12]),[4,this.context.cache.match(n.svg)];case 10:return q=pt.sent(),this.renderReplacedElement(n,i,q),[3,12];case 11:return pt.sent(),this.context.logger.error("Error loading svg "+n.svg.substring(0,255)),[3,12];case 12:return n instanceof hU&&n.tree?(f=new t(this.context,{scale:this.options.scale,backgroundColor:n.backgroundColor,x:0,y:0,width:n.width,height:n.height}),[4,f.render(n.tree)]):[3,14];case 13:m=pt.sent(),n.width&&n.height&&this.ctx.drawImage(m,0,0,n.width,n.height,n.bounds.left,n.bounds.top,n.bounds.width,n.bounds.height),pt.label=14;case 14:if(n instanceof Jx&&(_=Math.min(n.bounds.width,n.bounds.height),n.type===S1?n.checked&&(this.ctx.save(),this.path([new ur(n.bounds.left+_*.39363,n.bounds.top+_*.79),new ur(n.bounds.left+_*.16,n.bounds.top+_*.5549),new ur(n.bounds.left+_*.27347,n.bounds.top+_*.44071),new ur(n.bounds.left+_*.39694,n.bounds.top+_*.5649),new ur(n.bounds.left+_*.72983,n.bounds.top+_*.23),new ur(n.bounds.left+_*.84,n.bounds.top+_*.34085),new ur(n.bounds.left+_*.39363,n.bounds.top+_*.79)]),this.ctx.fillStyle=Os(lU),this.ctx.fill(),this.ctx.restore()):n.type===T1&&n.checked&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(n.bounds.left+_/2,n.bounds.top+_/2,_/4,0,Math.PI*2,!0),this.ctx.fillStyle=Os(lU),this.ctx.fill(),this.ctx.restore())),jut(n)&&n.value.length){switch(x=this.createFontStyle(s),tt=x[0],B=x[1],P=this.fontMetrics.getMetrics(tt,B).baseline,this.ctx.font=tt,this.ctx.fillStyle=Os(s.color),this.ctx.textBaseline="alphabetic",this.ctx.textAlign=Kut(n.styles.textAlign),ft=N1(n),M=0,n.styles.textAlign){case 1:M+=ft.width/2;break;case 2:M+=ft.width;break}k=ft.add(M,0,0,-ft.height/2+1),this.ctx.save(),this.path([new ur(ft.left,ft.top),new ur(ft.left+ft.width,ft.top),new ur(ft.left+ft.width,ft.top+ft.height),new ur(ft.left,ft.top+ft.height)]),this.ctx.clip(),this.renderTextWithLetterSpacing(new am(n.value,k),s.letterSpacing,P),this.ctx.restore(),this.ctx.textBaseline="alphabetic",this.ctx.textAlign="left"}if(!Es(n.styles.display,2048))return[3,20];if(n.styles.listStyleImage===null)return[3,19];if(Q=n.styles.listStyleImage,Q.type!==0)return[3,18];q=void 0,J=Q.url,pt.label=15;case 15:return pt.trys.push([15,17,,18]),[4,this.context.cache.match(J)];case 16:return q=pt.sent(),this.ctx.drawImage(q,n.bounds.left-(q.width+10),n.bounds.top),[3,18];case 17:return pt.sent(),this.context.logger.error("Error loading list-style-image "+J),[3,18];case 18:return[3,20];case 19:e.listValue&&n.styles.listStyleType!==-1&&(tt=this.createFontStyle(s)[0],this.ctx.font=tt,this.ctx.fillStyle=Os(s.color),this.ctx.textBaseline="middle",this.ctx.textAlign="right",ft=new zu(n.bounds.left,n.bounds.top+yi(n.styles.paddingTop,n.bounds.width),n.bounds.width,kM(s.lineHeight,s.fontSize.number)/2+1),this.renderTextWithLetterSpacing(new am(e.listValue,ft),s.letterSpacing,kM(s.lineHeight,s.fontSize.number)/2+2),this.ctx.textBaseline="bottom",this.ctx.textAlign="left"),pt.label=20;case 20:return[2]}})})},t.prototype.renderStackContent=function(e){return No(this,void 0,void 0,function(){var n,i,Q,s,a,Q,o,A,Q,f,m,Q,_,x,Q,B,P,Q,M,k,Q;return _o(this,function(q){switch(q.label){case 0:if(Es(e.element.container.flags,16))debugger;return[4,this.renderNodeBackgroundAndBorders(e.element)];case 1:q.sent(),n=0,i=e.negativeZIndex,q.label=2;case 2:return n<i.length?(Q=i[n],[4,this.renderStack(Q)]):[3,5];case 3:q.sent(),q.label=4;case 4:return n++,[3,2];case 5:return[4,this.renderNodeContent(e.element)];case 6:q.sent(),s=0,a=e.nonInlineLevel,q.label=7;case 7:return s<a.length?(Q=a[s],[4,this.renderNode(Q)]):[3,10];case 8:q.sent(),q.label=9;case 9:return s++,[3,7];case 10:o=0,A=e.nonPositionedFloats,q.label=11;case 11:return o<A.length?(Q=A[o],[4,this.renderStack(Q)]):[3,14];case 12:q.sent(),q.label=13;case 13:return o++,[3,11];case 14:f=0,m=e.nonPositionedInlineLevel,q.label=15;case 15:return f<m.length?(Q=m[f],[4,this.renderStack(Q)]):[3,18];case 16:q.sent(),q.label=17;case 17:return f++,[3,15];case 18:_=0,x=e.inlineLevel,q.label=19;case 19:return _<x.length?(Q=x[_],[4,this.renderNode(Q)]):[3,22];case 20:q.sent(),q.label=21;case 21:return _++,[3,19];case 22:B=0,P=e.zeroOrAutoZIndexOrTransformedOrOpacity,q.label=23;case 23:return B<P.length?(Q=P[B],[4,this.renderStack(Q)]):[3,26];case 24:q.sent(),q.label=25;case 25:return B++,[3,23];case 26:M=0,k=e.positiveZIndex,q.label=27;case 27:return M<k.length?(Q=k[M],[4,this.renderStack(Q)]):[3,30];case 28:q.sent(),q.label=29;case 29:return M++,[3,27];case 30:return[2]}})})},t.prototype.mask=function(e){this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.lineTo(this.canvas.width,0),this.ctx.lineTo(this.canvas.width,this.canvas.height),this.ctx.lineTo(0,this.canvas.height),this.ctx.lineTo(0,0),this.formatPath(e.slice(0).reverse()),this.ctx.closePath()},t.prototype.path=function(e){this.ctx.beginPath(),this.formatPath(e),this.ctx.closePath()},t.prototype.formatPath=function(e){var n=this;e.forEach(function(i,s){var a=hc(i)?i.start:i;s===0?n.ctx.moveTo(a.x,a.y):n.ctx.lineTo(a.x,a.y),hc(i)&&n.ctx.bezierCurveTo(i.startControl.x,i.startControl.y,i.endControl.x,i.endControl.y,i.end.x,i.end.y)})},t.prototype.renderRepeat=function(e,n,i,s){this.path(e),this.ctx.fillStyle=n,this.ctx.translate(i,s),this.ctx.fill(),this.ctx.translate(-i,-s)},t.prototype.resizeImage=function(e,n,i){var s;if(e.width===n&&e.height===i)return e;var a=(s=this.canvas.ownerDocument)!==null&&s!==void 0?s:document,o=a.createElement("canvas");o.width=Math.max(1,n),o.height=Math.max(1,i);var A=o.getContext("2d");return A.drawImage(e,0,0,e.width,e.height,0,0,n,i),o},t.prototype.renderBackgroundImage=function(e){return No(this,void 0,void 0,function(){var n,i,s,a,o,A;return _o(this,function(f){switch(f.label){case 0:n=e.styles.backgroundImage.length-1,i=function(m){var _,x,B,Lt,Zt,re,wt,yt,dt,P,Lt,Zt,re,wt,yt,M,k,Q,q,J,tt,ft,pt,mt,dt,Rt,Lt,st,ct,wt,yt,te,Zt,re,Xt,ne,se,we,it,vt,Ft,Ot;return _o(this,function($t){switch($t.label){case 0:if(m.type!==0)return[3,5];_=void 0,x=m.url,$t.label=1;case 1:return $t.trys.push([1,3,,4]),[4,s.context.cache.match(x)];case 2:return _=$t.sent(),[3,4];case 3:return $t.sent(),s.context.logger.error("Error loading background-image "+x),[3,4];case 4:return _&&(B=cB(e,n,[_.width,_.height,_.width/_.height]),Lt=B[0],Zt=B[1],re=B[2],wt=B[3],yt=B[4],dt=s.ctx.createPattern(s.resizeImage(_,wt,yt),"repeat"),s.renderRepeat(Lt,dt,Zt,re)),[3,6];case 5:Lat(m)?(P=cB(e,n,[null,null,null]),Lt=P[0],Zt=P[1],re=P[2],wt=P[3],yt=P[4],M=Cat(m.angle,wt,yt),k=M[0],Q=M[1],q=M[2],J=M[3],tt=M[4],ft=document.createElement("canvas"),ft.width=wt,ft.height=yt,pt=ft.getContext("2d"),mt=pt.createLinearGradient(Q,J,q,tt),TM(m.stops,k).forEach(function(jt){return mt.addColorStop(jt.stop,Os(jt.color))}),pt.fillStyle=mt,pt.fillRect(0,0,wt,yt),wt>0&&yt>0&&(dt=s.ctx.createPattern(ft,"repeat"),s.renderRepeat(Lt,dt,Zt,re))):Fat(m)&&(Rt=cB(e,n,[null,null,null]),Lt=Rt[0],st=Rt[1],ct=Rt[2],wt=Rt[3],yt=Rt[4],te=m.position.length===0?[Rx]:m.position,Zt=yi(te[0],wt),re=yi(te[te.length-1],yt),Xt=Eat(m,Zt,re,wt,yt),ne=Xt[0],se=Xt[1],ne>0&&se>0&&(we=s.ctx.createRadialGradient(st+Zt,ct+re,0,st+Zt,ct+re,ne),TM(m.stops,ne*2).forEach(function(jt){return we.addColorStop(jt.stop,Os(jt.color))}),s.path(Lt),s.ctx.fillStyle=we,ne!==se?(it=e.bounds.left+.5*e.bounds.width,vt=e.bounds.top+.5*e.bounds.height,Ft=se/ne,Ot=1/Ft,s.ctx.save(),s.ctx.translate(it,vt),s.ctx.transform(1,0,0,Ft,0,0),s.ctx.translate(-it,-vt),s.ctx.fillRect(st,Ot*(ct-vt)+vt,wt,yt*Ot),s.ctx.restore()):s.ctx.fill())),$t.label=6;case 6:return n--,[2]}})},s=this,a=0,o=e.styles.backgroundImage.slice(0).reverse(),f.label=1;case 1:return a<o.length?(A=o[a],[5,i(A)]):[3,4];case 2:f.sent(),f.label=3;case 3:return a++,[3,1];case 4:return[2]}})})},t.prototype.renderSolidBorder=function(e,n,i){return No(this,void 0,void 0,function(){return _o(this,function(s){return this.path(NU(i,n)),this.ctx.fillStyle=Os(e),this.ctx.fill(),[2]})})},t.prototype.renderDoubleBorder=function(e,n,i,s){return No(this,void 0,void 0,function(){var a,o;return _o(this,function(A){switch(A.label){case 0:return n<3?[4,this.renderSolidBorder(e,i,s)]:[3,2];case 1:return A.sent(),[2];case 2:return a=Uut(s,i),this.path(a),this.ctx.fillStyle=Os(e),this.ctx.fill(),o=Rut(s,i),this.path(o),this.ctx.fill(),[2]}})})},t.prototype.renderNodeBackgroundAndBorders=function(e){return No(this,void 0,void 0,function(){var n,i,s,a,o,A,f,m,_=this;return _o(this,function(x){switch(x.label){case 0:return this.applyEffects(e.getEffects(2)),n=e.container.styles,i=!YA(n.backgroundColor)||n.backgroundImage.length,s=[{style:n.borderTopStyle,color:n.borderTopColor,width:n.borderTopWidth},{style:n.borderRightStyle,color:n.borderRightColor,width:n.borderRightWidth},{style:n.borderBottomStyle,color:n.borderBottomColor,width:n.borderBottomWidth},{style:n.borderLeftStyle,color:n.borderLeftColor,width:n.borderLeftWidth}],a=qut(Wf(n.backgroundClip,0),e.curves),i||n.boxShadow.length?(this.ctx.save(),this.path(a),this.ctx.clip(),YA(n.backgroundColor)||(this.ctx.fillStyle=Os(n.backgroundColor),this.ctx.fill()),[4,this.renderBackgroundImage(e.container)]):[3,2];case 1:x.sent(),this.ctx.restore(),n.boxShadow.slice(0).reverse().forEach(function(B){_.ctx.save();var P=U1(e.curves),M=B.inset?0:Gut,k=Put(P,-M+(B.inset?1:-1)*B.spread.number,(B.inset?1:-1)*B.spread.number,B.spread.number*(B.inset?-2:2),B.spread.number*(B.inset?-2:2));B.inset?(_.path(P),_.ctx.clip(),_.mask(k)):(_.mask(P),_.ctx.clip(),_.path(k)),_.ctx.shadowOffsetX=B.offsetX.number+M,_.ctx.shadowOffsetY=B.offsetY.number,_.ctx.shadowColor=Os(B.color),_.ctx.shadowBlur=B.blur.number,_.ctx.fillStyle=B.inset?Os(B.color):"rgba(0,0,0,1)",_.ctx.fill(),_.ctx.restore()}),x.label=2;case 2:o=0,A=0,f=s,x.label=3;case 3:return A<f.length?(m=f[A],m.style!==0&&!YA(m.color)&&m.width>0?m.style!==2?[3,5]:[4,this.renderDashedDottedBorder(m.color,m.width,o,e.curves,2)]:[3,11]):[3,13];case 4:return x.sent(),[3,11];case 5:return m.style!==3?[3,7]:[4,this.renderDashedDottedBorder(m.color,m.width,o,e.curves,3)];case 6:return x.sent(),[3,11];case 7:return m.style!==4?[3,9]:[4,this.renderDoubleBorder(m.color,m.width,o,e.curves)];case 8:return x.sent(),[3,11];case 9:return[4,this.renderSolidBorder(m.color,o,e.curves)];case 10:x.sent(),x.label=11;case 11:o++,x.label=12;case 12:return A++,[3,3];case 13:return[2]}})})},t.prototype.renderDashedDottedBorder=function(e,n,i,s,a){return No(this,void 0,void 0,function(){var o,A,f,m,_,x,B,P,M,k,Q,q,J,tt,ft,pt,ft,pt;return _o(this,function(mt){return this.ctx.save(),o=Out(s,i),A=NU(s,i),a===2&&(this.path(A),this.ctx.clip()),hc(A[0])?(f=A[0].start.x,m=A[0].start.y):(f=A[0].x,m=A[0].y),hc(A[1])?(_=A[1].end.x,x=A[1].end.y):(_=A[1].x,x=A[1].y),i===0||i===2?B=Math.abs(f-_):B=Math.abs(m-x),this.ctx.beginPath(),a===3?this.formatPath(o):this.formatPath(A.slice(0,2)),P=n<3?n*3:n*2,M=n<3?n*2:n,a===3&&(P=n,M=n),k=!0,B<=P*2?k=!1:B<=P*2+M?(Q=B/(2*P+M),P*=Q,M*=Q):(q=Math.floor((B+M)/(P+M)),J=(B-q*P)/(q-1),tt=(B-(q+1)*P)/q,M=tt<=0||Math.abs(M-J)<Math.abs(M-tt)?J:tt),k&&(a===3?this.ctx.setLineDash([0,P+M]):this.ctx.setLineDash([P,M])),a===3?(this.ctx.lineCap="round",this.ctx.lineWidth=n):this.ctx.lineWidth=n*2+1.1,this.ctx.strokeStyle=Os(e),this.ctx.stroke(),this.ctx.setLineDash([]),a===2&&(hc(A[0])&&(ft=A[3],pt=A[0],this.ctx.beginPath(),this.formatPath([new ur(ft.end.x,ft.end.y),new ur(pt.start.x,pt.start.y)]),this.ctx.stroke()),hc(A[1])&&(ft=A[1],pt=A[2],this.ctx.beginPath(),this.formatPath([new ur(ft.end.x,ft.end.y),new ur(pt.start.x,pt.start.y)]),this.ctx.stroke())),this.ctx.restore(),[2]})})},t.prototype.render=function(e){return No(this,void 0,void 0,function(){var n;return _o(this,function(i){switch(i.label){case 0:return this.options.backgroundColor&&(this.ctx.fillStyle=Os(this.options.backgroundColor),this.ctx.fillRect(this.options.x,this.options.y,this.options.width,this.options.height)),n=Mut(e),[4,this.renderStack(n)];case 1:return i.sent(),this.applyEffects([]),[2,this.canvas]}})})},t}(HU),jut=function(r){return r instanceof AU||r instanceof uU?!0:r instanceof Jx&&r.type!==T1&&r.type!==S1},qut=function(r,t){switch(r){case 0:return U1(t);case 2:return Sut(t);case 1:default:return R1(t)}},Kut=function(r){switch(r){case 1:return"center";case 2:return"right";case 0:default:return"left"}},$ut=["-apple-system","system-ui"],Wut=function(r){return/iPhone OS 15_(0|1)/.test(window.navigator.userAgent)?r.filter(function(t){return $ut.indexOf(t)===-1}):r},Xut=function(r){Zc(t,r);function t(e,n){var i=r.call(this,e,n)||this;return i.canvas=n.canvas?n.canvas:document.createElement("canvas"),i.ctx=i.canvas.getContext("2d"),i.options=n,i.canvas.width=Math.floor(n.width*n.scale),i.canvas.height=Math.floor(n.height*n.scale),i.canvas.style.width=n.width+"px",i.canvas.style.height=n.height+"px",i.ctx.scale(i.options.scale,i.options.scale),i.ctx.translate(-n.x,-n.y),i.context.logger.debug("EXPERIMENTAL ForeignObject renderer initialized ("+n.width+"x"+n.height+" at "+n.x+","+n.y+") with scale "+n.scale),i}return t.prototype.render=function(e){return No(this,void 0,void 0,function(){var n,i;return _o(this,function(s){switch(s.label){case 0:return n=$x(this.options.width*this.options.scale,this.options.height*this.options.scale,this.options.scale,this.options.scale,e),[4,Jut(n)];case 1:return i=s.sent(),this.options.backgroundColor&&(this.ctx.fillStyle=Os(this.options.backgroundColor),this.ctx.fillRect(0,0,this.options.width*this.options.scale,this.options.height*this.options.scale)),this.ctx.drawImage(i,-this.options.x*this.options.scale,-this.options.y*this.options.scale),[2,this.canvas]}})})},t}(HU),Jut=function(r){return new Promise(function(t,e){var n=new Image;n.onload=function(){t(n)},n.onerror=e,n.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(new XMLSerializer().serializeToString(r))})},Yut=function(){function r(t){var e=t.id,n=t.enabled;this.id=e,this.enabled=n,this.start=Date.now()}return r.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.enabled&&(typeof window<"u"&&window.console&&typeof console.debug=="function"?console.debug.apply(console,Ky([this.id,this.getTime()+"ms"],t)):this.info.apply(this,t))},r.prototype.getTime=function(){return Date.now()-this.start},r.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.enabled&&typeof window<"u"&&window.console&&typeof console.info=="function"&&console.info.apply(console,Ky([this.id,this.getTime()+"ms"],t))},r.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.enabled&&(typeof window<"u"&&window.console&&typeof console.warn=="function"?console.warn.apply(console,Ky([this.id,this.getTime()+"ms"],t)):this.info.apply(this,t))},r.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.enabled&&(typeof window<"u"&&window.console&&typeof console.error=="function"?console.error.apply(console,Ky([this.id,this.getTime()+"ms"],t)):this.info.apply(this,t))},r.instances={},r}(),Zut=function(){function r(t,e){var n;this.windowBounds=e,this.instanceName="#"+r.instanceCount++,this.logger=new Yut({id:this.instanceName,enabled:t.logging}),this.cache=(n=t.cache)!==null&&n!==void 0?n:new _ut(this,t)}return r.instanceCount=1,r}(),tAt=function(r,t){return t===void 0&&(t={}),eAt(r,t)};typeof window<"u"&&PU.setContext(window);var eAt=function(r,t){return No(void 0,void 0,void 0,function(){var e,n,i,s,a,o,A,f,m,_,x,B,P,M,k,Q,q,J,tt,ft,mt,pt,mt,dt,Rt,Lt,st,ct,wt,yt,te,Zt,re,Xt,ne,se,we,it,vt,Ft;return _o(this,function(Ot){switch(Ot.label){case 0:if(!r||typeof r!="object")return[2,Promise.reject("Invalid element provided as first argument")];if(e=r.ownerDocument,!e)throw new Error("Element is not attached to a Document");if(n=e.defaultView,!n)throw new Error("Document is not attached to a Window");return i={allowTaint:(dt=t.allowTaint)!==null&&dt!==void 0?dt:!1,imageTimeout:(Rt=t.imageTimeout)!==null&&Rt!==void 0?Rt:15e3,proxy:t.proxy,useCORS:(Lt=t.useCORS)!==null&&Lt!==void 0?Lt:!1},s=fx({logging:(st=t.logging)!==null&&st!==void 0?st:!0,cache:t.cache},i),a={windowWidth:(ct=t.windowWidth)!==null&&ct!==void 0?ct:n.innerWidth,windowHeight:(wt=t.windowHeight)!==null&&wt!==void 0?wt:n.innerHeight,scrollX:(yt=t.scrollX)!==null&&yt!==void 0?yt:n.pageXOffset,scrollY:(te=t.scrollY)!==null&&te!==void 0?te:n.pageYOffset},o=new zu(a.scrollX,a.scrollY,a.windowWidth,a.windowHeight),A=new Zut(s,o),f=(Zt=t.foreignObjectRendering)!==null&&Zt!==void 0?Zt:!1,m={allowTaint:(re=t.allowTaint)!==null&&re!==void 0?re:!1,onclone:t.onclone,ignoreElements:t.ignoreElements,inlineImages:f,copyStyles:f},A.logger.debug("Starting document clone with size "+o.width+"x"+o.height+" scrolled to "+-o.left+","+-o.top),_=new LU(A,r,m),x=_.clonedReferenceElement,x?[4,_.toIFrame(e,o)]:[2,Promise.reject("Unable to find element in cloned iframe")];case 1:return B=Ot.sent(),P=Zx(x)||rut(x)?Pst(x.ownerDocument):$y(A,x),M=P.width,k=P.height,Q=P.left,q=P.top,J=rAt(A,x,t.backgroundColor),tt={canvas:t.canvas,backgroundColor:J,scale:(ne=(Xt=t.scale)!==null&&Xt!==void 0?Xt:n.devicePixelRatio)!==null&&ne!==void 0?ne:1,x:((se=t.x)!==null&&se!==void 0?se:0)+Q,y:((we=t.y)!==null&&we!==void 0?we:0)+q,width:(it=t.width)!==null&&it!==void 0?it:Math.ceil(M),height:(vt=t.height)!==null&&vt!==void 0?vt:Math.ceil(k)},f?(A.logger.debug("Document cloned, using foreign object rendering"),mt=new Xut(A,tt),[4,mt.render(x)]):[3,3];case 2:return ft=Ot.sent(),[3,5];case 3:return A.logger.debug("Document cloned, element located at "+Q+","+q+" with size "+M+"x"+k+" using computed rendering"),A.logger.debug("Starting DOM parsing"),pt=fU(A,x),J===pt.styles.backgroundColor&&(pt.styles.backgroundColor=Vu.TRANSPARENT),A.logger.debug("Starting renderer for element at "+tt.x+","+tt.y+" with size "+tt.width+"x"+tt.height),mt=new Vut(A,tt),[4,mt.render(pt)];case 4:ft=Ot.sent(),Ot.label=5;case 5:return(!((Ft=t.removeContainer)!==null&&Ft!==void 0)||Ft)&&(LU.destroy(B)||A.logger.error("Cannot detach cloned iframe as it is not in the DOM anymore")),A.logger.debug("Finished rendering"),[2,ft]}})})},rAt=function(r,t,e){var n=t.ownerDocument,i=n.documentElement?im(r,getComputedStyle(n.documentElement).backgroundColor):Vu.TRANSPARENT,s=n.body?im(r,getComputedStyle(n.body).backgroundColor):Vu.TRANSPARENT,a=typeof e=="string"?im(r,e):e===null?Vu.TRANSPARENT:4294967295;return t===n.documentElement?YA(i)?YA(s)?a:s:i:a};const nAt=Object.freeze(Object.defineProperty({__proto__:null,default:tAt},Symbol.toStringTag,{value:"Module"}));/*! @license DOMPurify 2.5.0 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/2.5.0/LICENSE */function rh(r){"@babel/helpers - typeof";return rh=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},rh(r)}function lB(r,t){return lB=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e},lB(r,t)}function iAt(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Q1(r,t,e){return iAt()?Q1=Reflect.construct:Q1=function(n,i,s){var a=[null];a.push.apply(a,i);var o=Function.bind.apply(n,a),A=new o;return s&&lB(A,s.prototype),A},Q1.apply(null,arguments)}function el(r){return sAt(r)||oAt(r)||aAt(r)||cAt()}function sAt(r){if(Array.isArray(r))return uB(r)}function oAt(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function aAt(r,t){if(r){if(typeof r=="string")return uB(r,t);var e=Object.prototype.toString.call(r).slice(8,-1);if(e==="Object"&&r.constructor&&(e=r.constructor.name),e==="Map"||e==="Set")return Array.from(r);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return uB(r,t)}}function uB(r,t){(t==null||t>r.length)&&(t=r.length);for(var e=0,n=new Array(t);e<t;e++)n[e]=r[e];return n}function cAt(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var lAt=Object.hasOwnProperty,zU=Object.setPrototypeOf,uAt=Object.isFrozen,AAt=Object.getPrototypeOf,hAt=Object.getOwnPropertyDescriptor,Ho=Object.freeze,fc=Object.seal,dAt=Object.create,GU=typeof Reflect<"u"&&Reflect,H1=GU.apply,AB=GU.construct;H1||(H1=function(r,t,e){return r.apply(t,e)}),Ho||(Ho=function(r){return r}),fc||(fc=function(r){return r}),AB||(AB=function(r,t){return Q1(r,el(t))});var fAt=pc(Array.prototype.forEach),VU=pc(Array.prototype.pop),Am=pc(Array.prototype.push),z1=pc(String.prototype.toLowerCase),hB=pc(String.prototype.toString),jU=pc(String.prototype.match),rl=pc(String.prototype.replace),pAt=pc(String.prototype.indexOf),gAt=pc(String.prototype.trim),vo=pc(RegExp.prototype.test),dB=mAt(TypeError);function pc(r){return function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return H1(r,t,n)}}function mAt(r){return function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return AB(r,e)}}function hn(r,t,e){var n;e=(n=e)!==null&&n!==void 0?n:z1,zU&&zU(r,null);for(var i=t.length;i--;){var s=t[i];if(typeof s=="string"){var a=e(s);a!==s&&(uAt(t)||(t[i]=a),s=a)}r[s]=!0}return r}function sd(r){var t=dAt(null),e;for(e in r)H1(lAt,r,[e])===!0&&(t[e]=r[e]);return t}function G1(r,t){for(;r!==null;){var e=hAt(r,t);if(e){if(e.get)return pc(e.get);if(typeof e.value=="function")return pc(e.value)}r=AAt(r)}function n(i){return console.warn("fallback value for",i),null}return n}var qU=Ho(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),fB=Ho(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),pB=Ho(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),yAt=Ho(["animate","color-profile","cursor","discard","fedropshadow","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),gB=Ho(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover"]),_At=Ho(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),KU=Ho(["#text"]),$U=Ho(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","xmlns","slot"]),mB=Ho(["accent-height","accumulate","additive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),WU=Ho(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),V1=Ho(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),vAt=fc(/\{\{[\w\W]*|[\w\W]*\}\}/gm),bAt=fc(/<%[\w\W]*|[\w\W]*%>/gm),wAt=fc(/\${[\w\W]*}/gm),xAt=fc(/^data-[\-\w.\u00B7-\uFFFF]/),BAt=fc(/^aria-[\-\w]+$/),CAt=fc(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),EAt=fc(/^(?:\w+script|data):/i),SAt=fc(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),TAt=fc(/^html$/i),IAt=fc(/^[a-z][.\w]*(-[.\w]+)+$/i),LAt=function(){return typeof window>"u"?null:window},FAt=function(r,t){if(rh(r)!=="object"||typeof r.createPolicy!="function")return null;var e=null,n="data-tt-policy-suffix";t.currentScript&&t.currentScript.hasAttribute(n)&&(e=t.currentScript.getAttribute(n));var i="dompurify"+(e?"#"+e:"");try{return r.createPolicy(i,{createHTML:function(s){return s},createScriptURL:function(s){return s}})}catch{return console.warn("TrustedTypes policy "+i+" could not be created."),null}};function XU(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:LAt(),t=function(Dt){return XU(Dt)};if(t.version="2.5.0",t.removed=[],!r||!r.document||r.document.nodeType!==9)return t.isSupported=!1,t;var e=r.document,n=r.document,i=r.DocumentFragment,s=r.HTMLTemplateElement,a=r.Node,o=r.Element,A=r.NodeFilter,f=r.NamedNodeMap,m=f===void 0?r.NamedNodeMap||r.MozNamedAttrMap:f,_=r.HTMLFormElement,x=r.DOMParser,B=r.trustedTypes,P=o.prototype,M=G1(P,"cloneNode"),k=G1(P,"nextSibling"),Q=G1(P,"childNodes"),q=G1(P,"parentNode");if(typeof s=="function"){var J=n.createElement("template");J.content&&J.content.ownerDocument&&(n=J.content.ownerDocument)}var tt=FAt(B,e),ft=tt?tt.createHTML(""):"",pt=n,mt=pt.implementation,dt=pt.createNodeIterator,Rt=pt.createDocumentFragment,Lt=pt.getElementsByTagName,st=e.importNode,ct={};try{ct=sd(n).documentMode?n.documentMode:{}}catch{}var wt={};t.isSupported=typeof q=="function"&&mt&&mt.createHTMLDocument!==void 0&&ct!==9;var yt=vAt,te=bAt,Zt=wAt,re=xAt,Xt=BAt,ne=EAt,se=SAt,we=IAt,it=CAt,vt=null,Ft=hn({},[].concat(el(qU),el(fB),el(pB),el(gB),el(KU))),Ot=null,$t=hn({},[].concat(el($U),el(mB),el(WU),el(V1))),jt=Object.seal(Object.create(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),ae=null,ie=null,Be=!0,Ie=!0,Qe=!1,He=!0,ze=!1,ge=!0,Ut=!1,Jt=!1,er=!1,Se=!1,_e=!1,xe=!1,Ne=!0,ir=!1,Ar="user-content-",Lr=!0,Tr=!1,Nr={},Qr=null,fe=hn({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]),Ir=null,De=hn({},["audio","video","img","source","image","track"]),xn=null,Pr=hn({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),Te="http://www.w3.org/1998/Math/MathML",Je="http://www.w3.org/2000/svg",Ke="http://www.w3.org/1999/xhtml",Yr=Ke,Or=!1,gr=null,an=hn({},[Te,Je,Ke],hB),$r,Ct=["application/xhtml+xml","text/html"],Z="text/html",Y,ot=null,Et=n.createElement("form"),kt=function(Dt){return Dt instanceof RegExp||Dt instanceof Function},zt=function(Dt){ot&&ot===Dt||((!Dt||rh(Dt)!=="object")&&(Dt={}),Dt=sd(Dt),$r=Ct.indexOf(Dt.PARSER_MEDIA_TYPE)===-1?$r=Z:$r=Dt.PARSER_MEDIA_TYPE,Y=$r==="application/xhtml+xml"?hB:z1,vt="ALLOWED_TAGS"in Dt?hn({},Dt.ALLOWED_TAGS,Y):Ft,Ot="ALLOWED_ATTR"in Dt?hn({},Dt.ALLOWED_ATTR,Y):$t,gr="ALLOWED_NAMESPACES"in Dt?hn({},Dt.ALLOWED_NAMESPACES,hB):an,xn="ADD_URI_SAFE_ATTR"in Dt?hn(sd(Pr),Dt.ADD_URI_SAFE_ATTR,Y):Pr,Ir="ADD_DATA_URI_TAGS"in Dt?hn(sd(De),Dt.ADD_DATA_URI_TAGS,Y):De,Qr="FORBID_CONTENTS"in Dt?hn({},Dt.FORBID_CONTENTS,Y):fe,ae="FORBID_TAGS"in Dt?hn({},Dt.FORBID_TAGS,Y):{},ie="FORBID_ATTR"in Dt?hn({},Dt.FORBID_ATTR,Y):{},Nr="USE_PROFILES"in Dt?Dt.USE_PROFILES:!1,Be=Dt.ALLOW_ARIA_ATTR!==!1,Ie=Dt.ALLOW_DATA_ATTR!==!1,Qe=Dt.ALLOW_UNKNOWN_PROTOCOLS||!1,He=Dt.ALLOW_SELF_CLOSE_IN_ATTR!==!1,ze=Dt.SAFE_FOR_TEMPLATES||!1,ge=Dt.SAFE_FOR_XML!==!1,Ut=Dt.WHOLE_DOCUMENT||!1,Se=Dt.RETURN_DOM||!1,_e=Dt.RETURN_DOM_FRAGMENT||!1,xe=Dt.RETURN_TRUSTED_TYPE||!1,er=Dt.FORCE_BODY||!1,Ne=Dt.SANITIZE_DOM!==!1,ir=Dt.SANITIZE_NAMED_PROPS||!1,Lr=Dt.KEEP_CONTENT!==!1,Tr=Dt.IN_PLACE||!1,it=Dt.ALLOWED_URI_REGEXP||it,Yr=Dt.NAMESPACE||Ke,jt=Dt.CUSTOM_ELEMENT_HANDLING||{},Dt.CUSTOM_ELEMENT_HANDLING&&kt(Dt.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(jt.tagNameCheck=Dt.CUSTOM_ELEMENT_HANDLING.tagNameCheck),Dt.CUSTOM_ELEMENT_HANDLING&&kt(Dt.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(jt.attributeNameCheck=Dt.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),Dt.CUSTOM_ELEMENT_HANDLING&&typeof Dt.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(jt.allowCustomizedBuiltInElements=Dt.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),ze&&(Ie=!1),_e&&(Se=!0),Nr&&(vt=hn({},el(KU)),Ot=[],Nr.html===!0&&(hn(vt,qU),hn(Ot,$U)),Nr.svg===!0&&(hn(vt,fB),hn(Ot,mB),hn(Ot,V1)),Nr.svgFilters===!0&&(hn(vt,pB),hn(Ot,mB),hn(Ot,V1)),Nr.mathMl===!0&&(hn(vt,gB),hn(Ot,WU),hn(Ot,V1))),Dt.ADD_TAGS&&(vt===Ft&&(vt=sd(vt)),hn(vt,Dt.ADD_TAGS,Y)),Dt.ADD_ATTR&&(Ot===$t&&(Ot=sd(Ot)),hn(Ot,Dt.ADD_ATTR,Y)),Dt.ADD_URI_SAFE_ATTR&&hn(xn,Dt.ADD_URI_SAFE_ATTR,Y),Dt.FORBID_CONTENTS&&(Qr===fe&&(Qr=sd(Qr)),hn(Qr,Dt.FORBID_CONTENTS,Y)),Lr&&(vt["#text"]=!0),Ut&&hn(vt,["html","head","body"]),vt.table&&(hn(vt,["tbody"]),delete ae.tbody),Ho&&Ho(Dt),ot=Dt)},qt=hn({},["mi","mo","mn","ms","mtext"]),St=hn({},["foreignobject","desc","title","annotation-xml"]),Yt=hn({},["title","style","font","a","script"]),me=hn({},fB);hn(me,pB),hn(me,yAt);var pe=hn({},gB);hn(pe,_At);var de=function(Dt){var Re=q(Dt);(!Re||!Re.tagName)&&(Re={namespaceURI:Yr,tagName:"template"});var Le=z1(Dt.tagName),nn=z1(Re.tagName);return gr[Dt.namespaceURI]?Dt.namespaceURI===Je?Re.namespaceURI===Ke?Le==="svg":Re.namespaceURI===Te?Le==="svg"&&(nn==="annotation-xml"||qt[nn]):!!me[Le]:Dt.namespaceURI===Te?Re.namespaceURI===Ke?Le==="math":Re.namespaceURI===Je?Le==="math"&&St[nn]:!!pe[Le]:Dt.namespaceURI===Ke?Re.namespaceURI===Je&&!St[nn]||Re.namespaceURI===Te&&!qt[nn]?!1:!pe[Le]&&(Yt[Le]||!me[Le]):!!($r==="application/xhtml+xml"&&gr[Dt.namespaceURI]):!1},Ve=function(Dt){Am(t.removed,{element:Dt});try{Dt.parentNode.removeChild(Dt)}catch{try{Dt.outerHTML=ft}catch{Dt.remove()}}},Ye=function(Dt,Re){try{Am(t.removed,{attribute:Re.getAttributeNode(Dt),from:Re})}catch{Am(t.removed,{attribute:null,from:Re})}if(Re.removeAttribute(Dt),Dt==="is"&&!Ot[Dt])if(Se||_e)try{Ve(Re)}catch{}else try{Re.setAttribute(Dt,"")}catch{}},Er=function(Dt){var Re,Le;if(er)Dt="<remove></remove>"+Dt;else{var nn=jU(Dt,/^[\r\n\t ]+/);Le=nn&&nn[0]}$r==="application/xhtml+xml"&&Yr===Ke&&(Dt='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+Dt+"</body></html>");var Un=tt?tt.createHTML(Dt):Dt;if(Yr===Ke)try{Re=new x().parseFromString(Un,$r)}catch{}if(!Re||!Re.documentElement){Re=mt.createDocument(Yr,"template",null);try{Re.documentElement.innerHTML=Or?ft:Un}catch{}}var Br=Re.body||Re.documentElement;return Dt&&Le&&Br.insertBefore(n.createTextNode(Le),Br.childNodes[0]||null),Yr===Ke?Lt.call(Re,Ut?"html":"body")[0]:Ut?Re.documentElement:Br},lr=function(Dt){return dt.call(Dt.ownerDocument||Dt,Dt,A.SHOW_ELEMENT|A.SHOW_COMMENT|A.SHOW_TEXT|A.SHOW_PROCESSING_INSTRUCTION|A.SHOW_CDATA_SECTION,null,!1)},Ur=function(Dt){return Dt instanceof _&&(typeof Dt.nodeName!="string"||typeof Dt.textContent!="string"||typeof Dt.removeChild!="function"||!(Dt.attributes instanceof m)||typeof Dt.removeAttribute!="function"||typeof Dt.setAttribute!="function"||typeof Dt.namespaceURI!="string"||typeof Dt.insertBefore!="function"||typeof Dt.hasChildNodes!="function")},kr=function(Dt){return rh(a)==="object"?Dt instanceof a:Dt&&rh(Dt)==="object"&&typeof Dt.nodeType=="number"&&typeof Dt.nodeName=="string"},Hr=function(Dt,Re,Le){wt[Dt]&&fAt(wt[Dt],function(nn){nn.call(t,Re,Le,ot)})},mn=function(Dt){var Re;if(Hr("beforeSanitizeElements",Dt,null),Ur(Dt)||vo(/[\u0080-\uFFFF]/,Dt.nodeName))return Ve(Dt),!0;var Le=Y(Dt.nodeName);if(Hr("uponSanitizeElement",Dt,{tagName:Le,allowedTags:vt}),Dt.hasChildNodes()&&!kr(Dt.firstElementChild)&&(!kr(Dt.content)||!kr(Dt.content.firstElementChild))&&vo(/<[/\w]/g,Dt.innerHTML)&&vo(/<[/\w]/g,Dt.textContent)||Le==="select"&&vo(/<template/i,Dt.innerHTML)||Dt.nodeType===7||ge&&Dt.nodeType===8&&vo(/<[/\w]/g,Dt.data))return Ve(Dt),!0;if(!vt[Le]||ae[Le]){if(!ae[Le]&&Wr(Le)&&(jt.tagNameCheck instanceof RegExp&&vo(jt.tagNameCheck,Le)||jt.tagNameCheck instanceof Function&&jt.tagNameCheck(Le)))return!1;if(Lr&&!Qr[Le]){var nn=q(Dt)||Dt.parentNode,Un=Q(Dt)||Dt.childNodes;if(Un&&nn)for(var Br=Un.length,yn=Br-1;yn>=0;--yn)nn.insertBefore(M(Un[yn],!0),k(Dt))}return Ve(Dt),!0}return Dt instanceof o&&!de(Dt)||(Le==="noscript"||Le==="noembed"||Le==="noframes")&&vo(/<\/no(script|embed|frames)/i,Dt.innerHTML)?(Ve(Dt),!0):(ze&&Dt.nodeType===3&&(Re=Dt.textContent,Re=rl(Re,yt," "),Re=rl(Re,te," "),Re=rl(Re,Zt," "),Dt.textContent!==Re&&(Am(t.removed,{element:Dt.cloneNode()}),Dt.textContent=Re)),Hr("afterSanitizeElements",Dt,null),!1)},mr=function(Dt,Re,Le){if(Ne&&(Re==="id"||Re==="name")&&(Le in n||Le in Et))return!1;if(!(Ie&&!ie[Re]&&vo(re,Re))&&!(Be&&vo(Xt,Re))){if(!Ot[Re]||ie[Re]){if(!(Wr(Dt)&&(jt.tagNameCheck instanceof RegExp&&vo(jt.tagNameCheck,Dt)||jt.tagNameCheck instanceof Function&&jt.tagNameCheck(Dt))&&(jt.attributeNameCheck instanceof RegExp&&vo(jt.attributeNameCheck,Re)||jt.attributeNameCheck instanceof Function&&jt.attributeNameCheck(Re))||Re==="is"&&jt.allowCustomizedBuiltInElements&&(jt.tagNameCheck instanceof RegExp&&vo(jt.tagNameCheck,Le)||jt.tagNameCheck instanceof Function&&jt.tagNameCheck(Le))))return!1}else if(!xn[Re]&&!vo(it,rl(Le,se,""))&&!((Re==="src"||Re==="xlink:href"||Re==="href")&&Dt!=="script"&&pAt(Le,"data:")===0&&Ir[Dt])&&!(Qe&&!vo(ne,rl(Le,se,"")))&&Le)return!1}return!0},Wr=function(Dt){return Dt!=="annotation-xml"&&jU(Dt,we)},bn=function(Dt){var Re,Le,nn,Un;Hr("beforeSanitizeAttributes",Dt,null);var Br=Dt.attributes;if(Br){var yn={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:Ot};for(Un=Br.length;Un--;){Re=Br[Un];var xi=Re,_n=xi.name,sn=xi.namespaceURI;if(Le=_n==="value"?Re.value:gAt(Re.value),nn=Y(_n),yn.attrName=nn,yn.attrValue=Le,yn.keepAttr=!0,yn.forceKeepAttr=void 0,Hr("uponSanitizeAttribute",Dt,yn),Le=yn.attrValue,!yn.forceKeepAttr&&(Ye(_n,Dt),!!yn.keepAttr)){if(!He&&vo(/\/>/i,Le)){Ye(_n,Dt);continue}ze&&(Le=rl(Le,yt," "),Le=rl(Le,te," "),Le=rl(Le,Zt," "));var Bi=Y(Dt.nodeName);if(mr(Bi,nn,Le)){if(ir&&(nn==="id"||nn==="name")&&(Ye(_n,Dt),Le=Ar+Le),tt&&rh(B)==="object"&&typeof B.getAttributeType=="function"&&!sn)switch(B.getAttributeType(Bi,nn)){case"TrustedHTML":{Le=tt.createHTML(Le);break}case"TrustedScriptURL":{Le=tt.createScriptURL(Le);break}}try{sn?Dt.setAttributeNS(sn,_n,Le):Dt.setAttribute(_n,Le),VU(t.removed)}catch{}}}}Hr("afterSanitizeAttributes",Dt,null)}},Qn=function Dt(Re){var Le,nn=lr(Re);for(Hr("beforeSanitizeShadowDOM",Re,null);Le=nn.nextNode();)Hr("uponSanitizeShadowNode",Le,null),!mn(Le)&&(Le.content instanceof i&&Dt(Le.content),bn(Le));Hr("afterSanitizeShadowDOM",Re,null)};return t.sanitize=function(Dt){var Re=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},Le,nn,Un,Br,yn;if(Or=!Dt,Or&&(Dt="<!-->"),typeof Dt!="string"&&!kr(Dt))if(typeof Dt.toString=="function"){if(Dt=Dt.toString(),typeof Dt!="string")throw dB("dirty is not a string, aborting")}else throw dB("toString is not a function");if(!t.isSupported){if(rh(r.toStaticHTML)==="object"||typeof r.toStaticHTML=="function"){if(typeof Dt=="string")return r.toStaticHTML(Dt);if(kr(Dt))return r.toStaticHTML(Dt.outerHTML)}return Dt}if(Jt||zt(Re),t.removed=[],typeof Dt=="string"&&(Tr=!1),Tr){if(Dt.nodeName){var xi=Y(Dt.nodeName);if(!vt[xi]||ae[xi])throw dB("root node is forbidden and cannot be sanitized in-place")}}else if(Dt instanceof a)Le=Er("<!---->"),nn=Le.ownerDocument.importNode(Dt,!0),nn.nodeType===1&&nn.nodeName==="BODY"||nn.nodeName==="HTML"?Le=nn:Le.appendChild(nn);else{if(!Se&&!ze&&!Ut&&Dt.indexOf("<")===-1)return tt&&xe?tt.createHTML(Dt):Dt;if(Le=Er(Dt),!Le)return Se?null:xe?ft:""}Le&&er&&Ve(Le.firstChild);for(var _n=lr(Tr?Dt:Le);Un=_n.nextNode();)Un.nodeType===3&&Un===Br||mn(Un)||(Un.content instanceof i&&Qn(Un.content),bn(Un),Br=Un);if(Br=null,Tr)return Dt;if(Se){if(_e)for(yn=Rt.call(Le.ownerDocument);Le.firstChild;)yn.appendChild(Le.firstChild);else yn=Le;return(Ot.shadowroot||Ot.shadowrootmod)&&(yn=st.call(e,yn,!0)),yn}var sn=Ut?Le.outerHTML:Le.innerHTML;return Ut&&vt["!doctype"]&&Le.ownerDocument&&Le.ownerDocument.doctype&&Le.ownerDocument.doctype.name&&vo(TAt,Le.ownerDocument.doctype.name)&&(sn="<!DOCTYPE "+Le.ownerDocument.doctype.name+`>
`+sn),ze&&(sn=rl(sn,yt," "),sn=rl(sn,te," "),sn=rl(sn,Zt," ")),tt&&xe?tt.createHTML(sn):sn},t.setConfig=function(Dt){zt(Dt),Jt=!0},t.clearConfig=function(){ot=null,Jt=!1},t.isValidAttribute=function(Dt,Re,Le){ot||zt({});var nn=Y(Dt),Un=Y(Re);return mr(nn,Un,Le)},t.addHook=function(Dt,Re){typeof Re=="function"&&(wt[Dt]=wt[Dt]||[],Am(wt[Dt],Re))},t.removeHook=function(Dt){if(wt[Dt])return VU(wt[Dt])},t.removeHooks=function(Dt){wt[Dt]&&(wt[Dt]=[])},t.removeAllHooks=function(){wt={}},t}var PAt=XU();const MAt=Object.freeze(Object.defineProperty({__proto__:null,default:PAt},Symbol.toStringTag,{value:"Module"}));var Xf=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function JU(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var hm=function(r){return r&&r.Math===Math&&r},is=hm(typeof globalThis=="object"&&globalThis)||hm(typeof window=="object"&&window)||hm(typeof self=="object"&&self)||hm(typeof Xf=="object"&&Xf)||hm(typeof Xf=="object"&&Xf)||function(){return this}()||Function("return this")(),dm={},ss=function(r){try{return!!r()}catch{return!0}},UAt=ss,nl=!UAt(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),RAt=ss,j1=!RAt(function(){var r=(function(){}).bind();return typeof r!="function"||r.hasOwnProperty("prototype")}),OAt=j1,q1=Function.prototype.call,Ys=OAt?q1.bind(q1):function(){return q1.apply(q1,arguments)},YU={},ZU={}.propertyIsEnumerable,tR=Object.getOwnPropertyDescriptor,DAt=tR&&!ZU.call({1:2},1);YU.f=DAt?function(r){var t=tR(this,r);return!!t&&t.enumerable}:ZU;var yB=function(r,t){return{enumerable:!(r&1),configurable:!(r&2),writable:!(r&4),value:t}},eR=j1,rR=Function.prototype,_B=rR.call,NAt=eR&&rR.bind.bind(_B,_B),os=eR?NAt:function(r){return function(){return _B.apply(r,arguments)}},nR=os,kAt=nR({}.toString),QAt=nR("".slice),od=function(r){return QAt(kAt(r),8,-1)},HAt=os,zAt=ss,GAt=od,vB=Object,VAt=HAt("".split),iR=zAt(function(){return!vB("z").propertyIsEnumerable(0)})?function(r){return GAt(r)==="String"?VAt(r,""):vB(r)}:vB,ad=function(r){return r==null},jAt=ad,qAt=TypeError,il=function(r){if(jAt(r))throw new qAt("Can't call method on "+r);return r},KAt=iR,$At=il,fm=function(r){return KAt($At(r))},bB=typeof document=="object"&&document.all,as=typeof bB>"u"&&bB!==void 0?function(r){return typeof r=="function"||r===bB}:function(r){return typeof r=="function"},WAt=as,sl=function(r){return typeof r=="object"?r!==null:WAt(r)},wB=is,XAt=as,JAt=function(r){return XAt(r)?r:void 0},cd=function(r,t){return arguments.length<2?JAt(wB[r]):wB[r]&&wB[r][t]},YAt=os,K1=YAt({}.isPrototypeOf),$1=typeof navigator<"u"&&String(navigator.userAgent)||"",sR=is,xB=$1,oR=sR.process,aR=sR.Deno,cR=oR&&oR.versions||aR&&aR.version,lR=cR&&cR.v8,ol,W1;lR&&(ol=lR.split("."),W1=ol[0]>0&&ol[0]<4?1:+(ol[0]+ol[1])),!W1&&xB&&(ol=xB.match(/Edge\/(\d+)/),(!ol||ol[1]>=74)&&(ol=xB.match(/Chrome\/(\d+)/),ol&&(W1=+ol[1])));var BB=W1,uR=BB,ZAt=ss,tht=is,eht=tht.String,AR=!!Object.getOwnPropertySymbols&&!ZAt(function(){var r=Symbol("symbol detection");return!eht(r)||!(Object(r)instanceof Symbol)||!Symbol.sham&&uR&&uR<41}),rht=AR,hR=rht&&!Symbol.sham&&typeof Symbol.iterator=="symbol",nht=cd,iht=as,sht=K1,oht=hR,aht=Object,dR=oht?function(r){return typeof r=="symbol"}:function(r){var t=nht("Symbol");return iht(t)&&sht(t.prototype,aht(r))},cht=String,X1=function(r){try{return cht(r)}catch{return"Object"}},lht=as,uht=X1,Aht=TypeError,qu=function(r){if(lht(r))return r;throw new Aht(uht(r)+" is not a function")},hht=qu,dht=ad,Jf=function(r,t){var e=r[t];return dht(e)?void 0:hht(e)},CB=Ys,EB=as,SB=sl,fht=TypeError,pht=function(r,t){var e,n;if(t==="string"&&EB(e=r.toString)&&!SB(n=CB(e,r))||EB(e=r.valueOf)&&!SB(n=CB(e,r))||t!=="string"&&EB(e=r.toString)&&!SB(n=CB(e,r)))return n;throw new fht("Can't convert object to primitive value")},fR={exports:{}},pR=is,ght=Object.defineProperty,TB=function(r,t){try{ght(pR,r,{value:t,configurable:!0,writable:!0})}catch{pR[r]=t}return t},mht=is,yht=TB,gR="__core-js_shared__",mR=fR.exports=mht[gR]||yht(gR,{});(mR.versions||(mR.versions=[])).push({version:"3.36.1",mode:"global",copyright:" 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.36.1/LICENSE",source:"https://github.com/zloirock/core-js"});var IB=fR.exports,yR=IB,LB=function(r,t){return yR[r]||(yR[r]=t||{})},_ht=il,vht=Object,J1=function(r){return vht(_ht(r))},bht=os,wht=J1,xht=bht({}.hasOwnProperty),al=Object.hasOwn||function(r,t){return xht(wht(r),t)},Bht=os,Cht=0,Eht=Math.random(),Sht=Bht(1 .toString),_R=function(r){return"Symbol("+(r===void 0?"":r)+")_"+Sht(++Cht+Eht,36)},Tht=is,Iht=LB,vR=al,Lht=_R,Fht=AR,Pht=hR,Yf=Tht.Symbol,FB=Iht("wks"),Mht=Pht?Yf.for||Yf:Yf&&Yf.withoutSetter||Lht,Ds=function(r){return vR(FB,r)||(FB[r]=Fht&&vR(Yf,r)?Yf[r]:Mht("Symbol."+r)),FB[r]},Uht=Ys,bR=sl,wR=dR,Rht=Jf,Oht=pht,Dht=Ds,Nht=TypeError,kht=Dht("toPrimitive"),Qht=function(r,t){if(!bR(r)||wR(r))return r;var e=Rht(r,kht),n;if(e){if(t===void 0&&(t="default"),n=Uht(e,r,t),!bR(n)||wR(n))return n;throw new Nht("Can't convert object to primitive value")}return t===void 0&&(t="number"),Oht(r,t)},Hht=Qht,zht=dR,xR=function(r){var t=Hht(r,"string");return zht(t)?t:t+""},Ght=is,BR=sl,PB=Ght.document,Vht=BR(PB)&&BR(PB.createElement),Y1=function(r){return Vht?PB.createElement(r):{}},jht=nl,qht=ss,Kht=Y1,CR=!jht&&!qht(function(){return Object.defineProperty(Kht("div"),"a",{get:function(){return 7}}).a!==7}),$ht=nl,Wht=Ys,Xht=YU,Jht=yB,Yht=fm,Zht=xR,tdt=al,edt=CR,ER=Object.getOwnPropertyDescriptor;dm.f=$ht?ER:function(r,t){if(r=Yht(r),t=Zht(t),edt)try{return ER(r,t)}catch{}if(tdt(r,t))return Jht(!Wht(Xht.f,r,t),r[t])};var Ku={},rdt=nl,ndt=ss,SR=rdt&&ndt(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),idt=sl,sdt=String,odt=TypeError,zo=function(r){if(idt(r))return r;throw new odt(sdt(r)+" is not an object")},adt=nl,cdt=CR,ldt=SR,Z1=zo,TR=xR,udt=TypeError,MB=Object.defineProperty,Adt=Object.getOwnPropertyDescriptor,UB="enumerable",RB="configurable",OB="writable";Ku.f=adt?ldt?function(r,t,e){if(Z1(r),t=TR(t),Z1(e),typeof r=="function"&&t==="prototype"&&"value"in e&&OB in e&&!e[OB]){var n=Adt(r,t);n&&n[OB]&&(r[t]=e.value,e={configurable:RB in e?e[RB]:n[RB],enumerable:UB in e?e[UB]:n[UB],writable:!1})}return MB(r,t,e)}:MB:function(r,t,e){if(Z1(r),t=TR(t),Z1(e),cdt)try{return MB(r,t,e)}catch{}if("get"in e||"set"in e)throw new udt("Accessors not supported");return"value"in e&&(r[t]=e.value),r};var hdt=nl,ddt=Ku,fdt=yB,pm=hdt?function(r,t,e){return ddt.f(r,t,fdt(1,e))}:function(r,t,e){return r[t]=e,r},IR={exports:{}},DB=nl,pdt=al,LR=Function.prototype,gdt=DB&&Object.getOwnPropertyDescriptor,NB=pdt(LR,"name"),mdt=NB&&(function(){}).name==="something",ydt=NB&&(!DB||DB&&gdt(LR,"name").configurable),t_={EXISTS:NB,PROPER:mdt,CONFIGURABLE:ydt},_dt=os,vdt=as,kB=IB,bdt=_dt(Function.toString);vdt(kB.inspectSource)||(kB.inspectSource=function(r){return bdt(r)});var QB=kB.inspectSource,wdt=is,xdt=as,FR=wdt.WeakMap,Bdt=xdt(FR)&&/native code/.test(String(FR)),Cdt=LB,Edt=_R,PR=Cdt("keys"),HB=function(r){return PR[r]||(PR[r]=Edt(r))},zB={},Sdt=Bdt,MR=is,Tdt=sl,Idt=pm,GB=al,VB=IB,Ldt=HB,Fdt=zB,UR="Object already initialized",jB=MR.TypeError,Pdt=MR.WeakMap,e_,gm,r_,Mdt=function(r){return r_(r)?gm(r):e_(r,{})},Udt=function(r){return function(t){var e;if(!Tdt(t)||(e=gm(t)).type!==r)throw new jB("Incompatible receiver, "+r+" required");return e}};if(Sdt||VB.state){var nu=VB.state||(VB.state=new Pdt);nu.get=nu.get,nu.has=nu.has,nu.set=nu.set,e_=function(r,t){if(nu.has(r))throw new jB(UR);return t.facade=r,nu.set(r,t),t},gm=function(r){return nu.get(r)||{}},r_=function(r){return nu.has(r)}}else{var Zf=Ldt("state");Fdt[Zf]=!0,e_=function(r,t){if(GB(r,Zf))throw new jB(UR);return t.facade=r,Idt(r,Zf,t),t},gm=function(r){return GB(r,Zf)?r[Zf]:{}},r_=function(r){return GB(r,Zf)}}var n_={set:e_,get:gm,has:r_,enforce:Mdt,getterFor:Udt},qB=os,Rdt=ss,Odt=as,i_=al,KB=nl,Ddt=t_.CONFIGURABLE,Ndt=QB,RR=n_,kdt=RR.enforce,Qdt=RR.get,OR=String,s_=Object.defineProperty,Hdt=qB("".slice),zdt=qB("".replace),Gdt=qB([].join),Vdt=KB&&!Rdt(function(){return s_(function(){},"length",{value:8}).length!==8}),jdt=String(String).split("String"),qdt=IR.exports=function(r,t,e){Hdt(OR(t),0,7)==="Symbol("&&(t="["+zdt(OR(t),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),e&&e.getter&&(t="get "+t),e&&e.setter&&(t="set "+t),(!i_(r,"name")||Ddt&&r.name!==t)&&(KB?s_(r,"name",{value:t,configurable:!0}):r.name=t),Vdt&&e&&i_(e,"arity")&&r.length!==e.arity&&s_(r,"length",{value:e.arity});try{e&&i_(e,"constructor")&&e.constructor?KB&&s_(r,"prototype",{writable:!1}):r.prototype&&(r.prototype=void 0)}catch{}var n=kdt(r);return i_(n,"source")||(n.source=Gdt(jdt,typeof t=="string"?t:"")),r};Function.prototype.toString=qdt(function(){return Odt(this)&&Qdt(this).source||Ndt(this)},"toString");var DR=IR.exports,Kdt=as,$dt=Ku,Wdt=DR,Xdt=TB,ld=function(r,t,e,n){n||(n={});var i=n.enumerable,s=n.name!==void 0?n.name:t;if(Kdt(e)&&Wdt(e,s,n),n.global)i?r[t]=e:Xdt(t,e);else{try{n.unsafe?r[t]&&(i=!0):delete r[t]}catch{}i?r[t]=e:$dt.f(r,t,{value:e,enumerable:!1,configurable:!n.nonConfigurable,writable:!n.nonWritable})}return r},NR={},Jdt=Math.ceil,Ydt=Math.floor,Zdt=Math.trunc||function(r){var t=+r;return(t>0?Ydt:Jdt)(t)},tft=Zdt,o_=function(r){var t=+r;return t!==t||t===0?0:tft(t)},eft=o_,rft=Math.max,nft=Math.min,ift=function(r,t){var e=eft(r);return e<0?rft(e+t,0):nft(e,t)},sft=o_,oft=Math.min,tp=function(r){var t=sft(r);return t>0?oft(t,9007199254740991):0},aft=tp,$B=function(r){return aft(r.length)},cft=fm,lft=ift,uft=$B,kR=function(r){return function(t,e,n){var i=cft(t),s=uft(i);if(s===0)return!r&&-1;var a=lft(n,s),o;if(r&&e!==e){for(;s>a;)if(o=i[a++],o!==o)return!0}else for(;s>a;a++)if((r||a in i)&&i[a]===e)return r||a||0;return!r&&-1}},QR={includes:kR(!0),indexOf:kR(!1)},Aft=os,WB=al,hft=fm,dft=QR.indexOf,fft=zB,HR=Aft([].push),zR=function(r,t){var e=hft(r),n=0,i=[],s;for(s in e)!WB(fft,s)&&WB(e,s)&&HR(i,s);for(;t.length>n;)WB(e,s=t[n++])&&(~dft(i,s)||HR(i,s));return i},XB=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],pft=zR,gft=XB,mft=gft.concat("length","prototype");NR.f=Object.getOwnPropertyNames||function(r){return pft(r,mft)};var GR={};GR.f=Object.getOwnPropertySymbols;var yft=cd,_ft=os,vft=NR,bft=GR,wft=zo,xft=_ft([].concat),Bft=yft("Reflect","ownKeys")||function(r){var t=vft.f(wft(r)),e=bft.f;return e?xft(t,e(r)):t},VR=al,Cft=Bft,Eft=dm,Sft=Ku,Tft=function(r,t,e){for(var n=Cft(t),i=Sft.f,s=Eft.f,a=0;a<n.length;a++){var o=n[a];!VR(r,o)&&!(e&&VR(e,o))&&i(r,o,s(t,o))}},Ift=ss,Lft=as,Fft=/#|\.prototype\./,mm=function(r,t){var e=Mft[Pft(r)];return e===Rft?!0:e===Uft?!1:Lft(t)?Ift(t):!!t},Pft=mm.normalize=function(r){return String(r).replace(Fft,".").toLowerCase()},Mft=mm.data={},Uft=mm.NATIVE="N",Rft=mm.POLYFILL="P",jR=mm,a_=is,Oft=dm.f,Dft=pm,Nft=ld,kft=TB,Qft=Tft,Hft=jR,Go=function(r,t){var e=r.target,n=r.global,i=r.stat,s,a,o,A,f,m;if(n?a=a_:i?a=a_[e]||kft(e,{}):a=a_[e]&&a_[e].prototype,a)for(o in t){if(f=t[o],r.dontCallGetSet?(m=Oft(a,o),A=m&&m.value):A=a[o],s=Hft(n?o:e+(i?".":"#")+o,r.forced),!s&&A!==void 0){if(typeof f==typeof A)continue;Qft(f,A)}(r.sham||A&&A.sham)&&Dft(f,"sham",!0),Nft(a,o,f,r)}},zft=is,Gft=od,ym=Gft(zft.process)==="process",Vft=os,jft=qu,qft=function(r,t,e){try{return Vft(jft(Object.getOwnPropertyDescriptor(r,t)[e]))}catch{}},Kft=sl,$ft=function(r){return Kft(r)||r===null},Wft=$ft,Xft=String,Jft=TypeError,Yft=function(r){if(Wft(r))return r;throw new Jft("Can't set "+Xft(r)+" as a prototype")},Zft=qft,tpt=sl,ept=il,rpt=Yft,qR=Object.setPrototypeOf||("__proto__"in{}?function(){var r=!1,t={},e;try{e=Zft(Object.prototype,"__proto__","set"),e(t,[]),r=t instanceof Array}catch{}return function(n,i){return ept(n),rpt(i),tpt(n)&&(r?e(n,i):n.__proto__=i),n}}():void 0),npt=Ku.f,ipt=al,spt=Ds,KR=spt("toStringTag"),c_=function(r,t,e){r&&!e&&(r=r.prototype),r&&!ipt(r,KR)&&npt(r,KR,{configurable:!0,value:t})},$R=DR,opt=Ku,apt=function(r,t,e){return e.get&&$R(e.get,t,{getter:!0}),e.set&&$R(e.set,t,{setter:!0}),opt.f(r,t,e)},cpt=cd,lpt=apt,upt=Ds,Apt=nl,WR=upt("species"),hpt=function(r){var t=cpt(r);Apt&&t&&!t[WR]&&lpt(t,WR,{configurable:!0,get:function(){return this}})},dpt=K1,fpt=TypeError,ppt=function(r,t){if(dpt(t,r))return r;throw new fpt("Incorrect invocation")},gpt=Ds,mpt=gpt("toStringTag"),XR={};XR[mpt]="z";var ypt=String(XR)==="[object z]",_pt=ypt,vpt=as,l_=od,bpt=Ds,wpt=bpt("toStringTag"),xpt=Object,Bpt=l_(function(){return arguments}())==="Arguments",Cpt=function(r,t){try{return r[t]}catch{}},JB=_pt?l_:function(r){var t,e,n;return r===void 0?"Undefined":r===null?"Null":typeof(e=Cpt(t=xpt(r),wpt))=="string"?e:Bpt?l_(t):(n=l_(t))==="Object"&&vpt(t.callee)?"Arguments":n},Ept=os,Spt=ss,JR=as,Tpt=JB,Ipt=cd,Lpt=QB,YR=function(){},ZR=Ipt("Reflect","construct"),YB=/^\s*(?:class|function)\b/,Fpt=Ept(YB.exec),Ppt=!YB.test(YR),_m=function(r){if(!JR(r))return!1;try{return ZR(YR,[],r),!0}catch{return!1}},tO=function(r){if(!JR(r))return!1;switch(Tpt(r)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Ppt||!!Fpt(YB,Lpt(r))}catch{return!0}};tO.sham=!0;var Mpt=!ZR||Spt(function(){var r;return _m(_m.call)||!_m(Object)||!_m(function(){r=!0})||r})?tO:_m,Upt=Mpt,Rpt=X1,Opt=TypeError,Dpt=function(r){if(Upt(r))return r;throw new Opt(Rpt(r)+" is not a constructor")},eO=zo,Npt=Dpt,kpt=ad,Qpt=Ds,Hpt=Qpt("species"),rO=function(r,t){var e=eO(r).constructor,n;return e===void 0||kpt(n=eO(e)[Hpt])?t:Npt(n)},zpt=j1,nO=Function.prototype,iO=nO.apply,sO=nO.call,oO=typeof Reflect=="object"&&Reflect.apply||(zpt?sO.bind(iO):function(){return sO.apply(iO,arguments)}),Gpt=od,Vpt=os,u_=function(r){if(Gpt(r)==="Function")return Vpt(r)},aO=u_,jpt=qu,qpt=j1,Kpt=aO(aO.bind),ZB=function(r,t){return jpt(r),t===void 0?r:qpt?Kpt(r,t):function(){return r.apply(t,arguments)}},$pt=cd,cO=$pt("document","documentElement"),Wpt=os,Xpt=Wpt([].slice),Jpt=TypeError,Ypt=function(r,t){if(r<t)throw new Jpt("Not enough arguments");return r},Zpt=$1,lO=/(?:ipad|iphone|ipod).*applewebkit/i.test(Zpt),Ha=is,tgt=oO,egt=ZB,uO=as,rgt=al,AO=ss,hO=cO,ngt=Xpt,dO=Y1,igt=Ypt,sgt=lO,ogt=ym,tC=Ha.setImmediate,eC=Ha.clearImmediate,agt=Ha.process,rC=Ha.Dispatch,cgt=Ha.Function,fO=Ha.MessageChannel,lgt=Ha.String,nC=0,vm={},pO="onreadystatechange",bm,ud,iC,sC;AO(function(){bm=Ha.location});var oC=function(r){if(rgt(vm,r)){var t=vm[r];delete vm[r],t()}},aC=function(r){return function(){oC(r)}},gO=function(r){oC(r.data)},mO=function(r){Ha.postMessage(lgt(r),bm.protocol+"//"+bm.host)};(!tC||!eC)&&(tC=function(r){igt(arguments.length,1);var t=uO(r)?r:cgt(r),e=ngt(arguments,1);return vm[++nC]=function(){tgt(t,void 0,e)},ud(nC),nC},eC=function(r){delete vm[r]},ogt?ud=function(r){agt.nextTick(aC(r))}:rC&&rC.now?ud=function(r){rC.now(aC(r))}:fO&&!sgt?(iC=new fO,sC=iC.port2,iC.port1.onmessage=gO,ud=egt(sC.postMessage,sC)):Ha.addEventListener&&uO(Ha.postMessage)&&!Ha.importScripts&&bm&&bm.protocol!=="file:"&&!AO(mO)?(ud=mO,Ha.addEventListener("message",gO,!1)):pO in dO("script")?ud=function(r){hO.appendChild(dO("script"))[pO]=function(){hO.removeChild(this),oC(r)}}:ud=function(r){setTimeout(aC(r),0)});var yO={set:tC,clear:eC},_O=is,ugt=nl,Agt=Object.getOwnPropertyDescriptor,hgt=function(r){if(!ugt)return _O[r];var t=Agt(_O,r);return t&&t.value},vO=function(){this.head=null,this.tail=null};vO.prototype={add:function(r){var t={item:r,next:null},e=this.tail;e?e.next=t:this.head=t,this.tail=t},get:function(){var r=this.head;if(r){var t=this.head=r.next;return t===null&&(this.tail=null),r.item}}};var bO=vO,dgt=$1,fgt=/ipad|iphone|ipod/i.test(dgt)&&typeof Pebble<"u",pgt=$1,ggt=/web0s(?!.*chrome)/i.test(pgt),ep=is,mgt=hgt,wO=ZB,cC=yO.set,ygt=bO,_gt=lO,vgt=fgt,bgt=ggt,lC=ym,xO=ep.MutationObserver||ep.WebKitMutationObserver,BO=ep.document,CO=ep.process,A_=ep.Promise,uC=mgt("queueMicrotask"),rp,AC,hC,h_,EO;if(!uC){var d_=new ygt,f_=function(){var r,t;for(lC&&(r=CO.domain)&&r.exit();t=d_.get();)try{t()}catch(e){throw d_.head&&rp(),e}r&&r.enter()};!_gt&&!lC&&!bgt&&xO&&BO?(AC=!0,hC=BO.createTextNode(""),new xO(f_).observe(hC,{characterData:!0}),rp=function(){hC.data=AC=!AC}):!vgt&&A_&&A_.resolve?(h_=A_.resolve(void 0),h_.constructor=A_,EO=wO(h_.then,h_),rp=function(){EO(f_)}):lC?rp=function(){CO.nextTick(f_)}:(cC=wO(cC,ep),rp=function(){cC(f_)}),uC=function(r){d_.head||rp(),d_.add(r)}}var wgt=uC,xgt=function(r,t){try{arguments.length===1?console.error(r):console.error(r,t)}catch{}},dC=function(r){try{return{error:!1,value:r()}}catch(t){return{error:!0,value:t}}},Bgt=is,p_=Bgt.Promise,SO=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",Cgt=SO,Egt=ym,Sgt=!Cgt&&!Egt&&typeof window=="object"&&typeof document=="object",Tgt=is,wm=p_,Igt=as,Lgt=jR,Fgt=QB,Pgt=Ds,Mgt=Sgt,Ugt=SO,fC=BB;wm&&wm.prototype;var Rgt=Pgt("species"),pC=!1,TO=Igt(Tgt.PromiseRejectionEvent),Ogt=Lgt("Promise",function(){var r=Fgt(wm),t=r!==String(wm);if(!t&&fC===66)return!0;if(!fC||fC<51||!/native code/.test(r)){var e=new wm(function(s){s(1)}),n=function(s){s(function(){},function(){})},i=e.constructor={};if(i[Rgt]=n,pC=e.then(function(){})instanceof n,!pC)return!0}return!t&&(Mgt||Ugt)&&!TO}),xm={CONSTRUCTOR:Ogt,REJECTION_EVENT:TO,SUBCLASSING:pC},np={},IO=qu,Dgt=TypeError,Ngt=function(r){var t,e;this.promise=new r(function(n,i){if(t!==void 0||e!==void 0)throw new Dgt("Bad Promise constructor");t=n,e=i}),this.resolve=IO(t),this.reject=IO(e)};np.f=function(r){return new Ngt(r)};var kgt=Go,g_=ym,nh=is,ip=Ys,LO=ld,FO=qR,Qgt=c_,Hgt=hpt,zgt=qu,m_=as,Ggt=sl,Vgt=ppt,jgt=rO,PO=yO.set,gC=wgt,qgt=xgt,Kgt=dC,$gt=bO,MO=n_,y_=p_,mC=xm,UO=np,__="Promise",RO=mC.CONSTRUCTOR,Wgt=mC.REJECTION_EVENT,Xgt=mC.SUBCLASSING,yC=MO.getterFor(__),Jgt=MO.set,sp=y_&&y_.prototype,Ad=y_,v_=sp,OO=nh.TypeError,_C=nh.document,vC=nh.process,bC=UO.f,Ygt=bC,Zgt=!!(_C&&_C.createEvent&&nh.dispatchEvent),DO="unhandledrejection",tmt="rejectionhandled",NO=0,kO=1,emt=2,wC=1,QO=2,b_,HO,rmt,zO,GO=function(r){var t;return Ggt(r)&&m_(t=r.then)?t:!1},VO=function(r,t){var e=t.value,n=t.state===kO,i=n?r.ok:r.fail,s=r.resolve,a=r.reject,o=r.domain,A,f,m;try{i?(n||(t.rejection===QO&&imt(t),t.rejection=wC),i===!0?A=e:(o&&o.enter(),A=i(e),o&&(o.exit(),m=!0)),A===r.promise?a(new OO("Promise-chain cycle")):(f=GO(A))?ip(f,A,s,a):s(A)):a(e)}catch(_){o&&!m&&o.exit(),a(_)}},jO=function(r,t){r.notified||(r.notified=!0,gC(function(){for(var e=r.reactions,n;n=e.get();)VO(n,r);r.notified=!1,t&&!r.rejection&&nmt(r)}))},qO=function(r,t,e){var n,i;Zgt?(n=_C.createEvent("Event"),n.promise=t,n.reason=e,n.initEvent(r,!1,!0),nh.dispatchEvent(n)):n={promise:t,reason:e},!Wgt&&(i=nh["on"+r])?i(n):r===DO&&qgt("Unhandled promise rejection",e)},nmt=function(r){ip(PO,nh,function(){var t=r.facade,e=r.value,n=KO(r),i;if(n&&(i=Kgt(function(){g_?vC.emit("unhandledRejection",e,t):qO(DO,t,e)}),r.rejection=g_||KO(r)?QO:wC,i.error))throw i.value})},KO=function(r){return r.rejection!==wC&&!r.parent},imt=function(r){ip(PO,nh,function(){var t=r.facade;g_?vC.emit("rejectionHandled",t):qO(tmt,t,r.value)})},op=function(r,t,e){return function(n){r(t,n,e)}},ap=function(r,t,e){r.done||(r.done=!0,e&&(r=e),r.value=t,r.state=emt,jO(r,!0))},xC=function(r,t,e){if(!r.done){r.done=!0,e&&(r=e);try{if(r.facade===t)throw new OO("Promise can't be resolved itself");var n=GO(t);n?gC(function(){var i={done:!1};try{ip(n,t,op(xC,i,r),op(ap,i,r))}catch(s){ap(i,s,r)}}):(r.value=t,r.state=kO,jO(r,!1))}catch(i){ap({done:!1},i,r)}}};if(RO&&(Ad=function(r){Vgt(this,v_),zgt(r),ip(b_,this);var t=yC(this);try{r(op(xC,t),op(ap,t))}catch(e){ap(t,e)}},v_=Ad.prototype,b_=function(r){Jgt(this,{type:__,done:!1,notified:!1,parent:!1,reactions:new $gt,rejection:!1,state:NO,value:void 0})},b_.prototype=LO(v_,"then",function(r,t){var e=yC(this),n=bC(jgt(this,Ad));return e.parent=!0,n.ok=m_(r)?r:!0,n.fail=m_(t)&&t,n.domain=g_?vC.domain:void 0,e.state===NO?e.reactions.add(n):gC(function(){VO(n,e)}),n.promise}),HO=function(){var r=new b_,t=yC(r);this.promise=r,this.resolve=op(xC,t),this.reject=op(ap,t)},UO.f=bC=function(r){return r===Ad||r===rmt?new HO(r):Ygt(r)},m_(y_)&&sp!==Object.prototype)){zO=sp.then,Xgt||LO(sp,"then",function(r,t){var e=this;return new Ad(function(n,i){ip(zO,e,n,i)}).then(r,t)},{unsafe:!0});try{delete sp.constructor}catch{}FO&&FO(sp,v_)}kgt({global:!0,constructor:!0,wrap:!0,forced:RO},{Promise:Ad}),Qgt(Ad,__,!1),Hgt(__);var Bm={},smt=Ds,omt=Bm,amt=smt("iterator"),cmt=Array.prototype,lmt=function(r){return r!==void 0&&(omt.Array===r||cmt[amt]===r)},umt=JB,$O=Jf,Amt=ad,hmt=Bm,dmt=Ds,fmt=dmt("iterator"),WO=function(r){if(!Amt(r))return $O(r,fmt)||$O(r,"@@iterator")||hmt[umt(r)]},pmt=Ys,gmt=qu,mmt=zo,ymt=X1,_mt=WO,vmt=TypeError,bmt=function(r,t){var e=arguments.length<2?_mt(r):t;if(gmt(e))return mmt(pmt(e,r));throw new vmt(ymt(r)+" is not iterable")},wmt=Ys,XO=zo,xmt=Jf,Bmt=function(r,t,e){var n,i;XO(r);try{if(n=xmt(r,"return"),!n){if(t==="throw")throw e;return e}n=wmt(n,r)}catch(s){i=!0,n=s}if(t==="throw")throw e;if(i)throw n;return XO(n),e},Cmt=ZB,Emt=Ys,Smt=zo,Tmt=X1,Imt=lmt,Lmt=$B,JO=K1,Fmt=bmt,Pmt=WO,YO=Bmt,Mmt=TypeError,w_=function(r,t){this.stopped=r,this.result=t},ZO=w_.prototype,tD=function(r,t,e){var n=e&&e.that,i=!!(e&&e.AS_ENTRIES),s=!!(e&&e.IS_RECORD),a=!!(e&&e.IS_ITERATOR),o=!!(e&&e.INTERRUPTED),A=Cmt(t,n),f,m,_,x,B,P,M,k=function(q){return f&&YO(f,"normal",q),new w_(!0,q)},Q=function(q){return i?(Smt(q),o?A(q[0],q[1],k):A(q[0],q[1])):o?A(q,k):A(q)};if(s)f=r.iterator;else if(a)f=r;else{if(m=Pmt(r),!m)throw new Mmt(Tmt(r)+" is not iterable");if(Imt(m)){for(_=0,x=Lmt(r);x>_;_++)if(B=Q(r[_]),B&&JO(ZO,B))return B;return new w_(!1)}f=Fmt(r,m)}for(P=s?r.next:f.next;!(M=Emt(P,f)).done;){try{B=Q(M.value)}catch(q){YO(f,"throw",q)}if(typeof B=="object"&&B&&JO(ZO,B))return B}return new w_(!1)},Umt=Ds,eD=Umt("iterator"),rD=!1;try{var Rmt=0,nD={next:function(){return{done:!!Rmt++}},return:function(){rD=!0}};nD[eD]=function(){return this},Array.from(nD,function(){throw 2})}catch{}var Omt=function(r,t){try{if(!t&&!rD)return!1}catch{return!1}var e=!1;try{var n={};n[eD]=function(){return{next:function(){return{done:e=!0}}}},r(n)}catch{}return e},Dmt=p_,Nmt=Omt,kmt=xm.CONSTRUCTOR,iD=kmt||!Nmt(function(r){Dmt.all(r).then(void 0,function(){})}),Qmt=Go,Hmt=Ys,zmt=qu,Gmt=np,Vmt=dC,jmt=tD,qmt=iD;Qmt({target:"Promise",stat:!0,forced:qmt},{all:function(r){var t=this,e=Gmt.f(t),n=e.resolve,i=e.reject,s=Vmt(function(){var a=zmt(t.resolve),o=[],A=0,f=1;jmt(r,function(m){var _=A++,x=!1;f++,Hmt(a,t,m).then(function(B){x||(x=!0,o[_]=B,--f||n(o))},i)}),--f||n(o)});return s.error&&i(s.value),e.promise}});var Kmt=Go,$mt=xm.CONSTRUCTOR,BC=p_,Wmt=cd,Xmt=as,Jmt=ld,sD=BC&&BC.prototype;if(Kmt({target:"Promise",proto:!0,forced:$mt,real:!0},{catch:function(r){return this.then(void 0,r)}}),Xmt(BC)){var oD=Wmt("Promise").prototype.catch;sD.catch!==oD&&Jmt(sD,"catch",oD,{unsafe:!0})}var Ymt=Go,Zmt=Ys,t0t=qu,e0t=np,r0t=dC,n0t=tD,i0t=iD;Ymt({target:"Promise",stat:!0,forced:i0t},{race:function(r){var t=this,e=e0t.f(t),n=e.reject,i=r0t(function(){var s=t0t(t.resolve);n0t(r,function(a){Zmt(s,t,a).then(e.resolve,n)})});return i.error&&n(i.value),e.promise}});var s0t=Go,o0t=np,a0t=xm.CONSTRUCTOR;s0t({target:"Promise",stat:!0,forced:a0t},{reject:function(r){var t=o0t.f(this),e=t.reject;return e(r),t.promise}});var c0t=zo,l0t=sl,u0t=np,A0t=function(r,t){if(c0t(r),l0t(t)&&t.constructor===r)return t;var e=u0t.f(r),n=e.resolve;return n(t),e.promise},h0t=Go,d0t=cd,f0t=xm.CONSTRUCTOR,p0t=A0t;d0t("Promise"),h0t({target:"Promise",stat:!0,forced:f0t},{resolve:function(r){return p0t(this,r)}});function aD(r,t,e,n,i,s,a){try{var o=r[s](a),A=o.value}catch(f){e(f);return}o.done?t(A):Promise.resolve(A).then(n,i)}function $u(r){return function(){var t=this,e=arguments;return new Promise(function(n,i){var s=r.apply(t,e);function a(A){aD(s,n,i,a,o,"next",A)}function o(A){aD(s,n,i,a,o,"throw",A)}a(void 0)})}}var g0t=JB,m0t=String,iu=function(r){if(g0t(r)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return m0t(r)},y0t=zo,cD=function(){var r=y0t(this),t="";return r.hasIndices&&(t+="d"),r.global&&(t+="g"),r.ignoreCase&&(t+="i"),r.multiline&&(t+="m"),r.dotAll&&(t+="s"),r.unicode&&(t+="u"),r.unicodeSets&&(t+="v"),r.sticky&&(t+="y"),t},CC=ss,_0t=is,EC=_0t.RegExp,SC=CC(function(){var r=EC("a","y");return r.lastIndex=2,r.exec("abcd")!==null}),v0t=SC||CC(function(){return!EC("a","y").sticky}),b0t=SC||CC(function(){var r=EC("^r","gy");return r.lastIndex=2,r.exec("str")!==null}),lD={BROKEN_CARET:b0t,MISSED_STICKY:v0t,UNSUPPORTED_Y:SC},uD={},w0t=zR,x0t=XB,B0t=Object.keys||function(r){return w0t(r,x0t)},C0t=nl,E0t=SR,S0t=Ku,T0t=zo,I0t=fm,L0t=B0t;uD.f=C0t&&!E0t?Object.defineProperties:function(r,t){T0t(r);for(var e=I0t(t),n=L0t(t),i=n.length,s=0,a;i>s;)S0t.f(r,a=n[s++],e[a]);return r};var F0t=zo,P0t=uD,AD=XB,M0t=zB,U0t=cO,R0t=Y1,O0t=HB,hD=">",dD="<",TC="prototype",IC="script",fD=O0t("IE_PROTO"),LC=function(){},pD=function(r){return dD+IC+hD+r+dD+"/"+IC+hD},gD=function(r){r.write(pD("")),r.close();var t=r.parentWindow.Object;return r=null,t},D0t=function(){var r=R0t("iframe"),t="java"+IC+":",e;return r.style.display="none",U0t.appendChild(r),r.src=String(t),e=r.contentWindow.document,e.open(),e.write(pD("document.F=Object")),e.close(),e.F},x_,B_=function(){try{x_=new ActiveXObject("htmlfile")}catch{}B_=typeof document<"u"?document.domain&&x_?gD(x_):D0t():gD(x_);for(var r=AD.length;r--;)delete B_[TC][AD[r]];return B_()};M0t[fD]=!0;var FC=Object.create||function(r,t){var e;return r!==null?(LC[TC]=F0t(r),e=new LC,LC[TC]=null,e[fD]=r):e=B_(),t===void 0?e:P0t.f(e,t)},N0t=ss,k0t=is,Q0t=k0t.RegExp,H0t=N0t(function(){var r=Q0t(".","s");return!(r.dotAll&&r.test(`
`)&&r.flags==="s")}),z0t=ss,G0t=is,V0t=G0t.RegExp,j0t=z0t(function(){var r=V0t("(?<a>b)","g");return r.exec("b").groups.a!=="b"||"b".replace(r,"$<a>c")!=="bc"}),cp=Ys,C_=os,q0t=iu,K0t=cD,$0t=lD,W0t=LB,X0t=FC,J0t=n_.get,Y0t=H0t,Z0t=j0t,tyt=W0t("native-string-replace",String.prototype.replace),E_=RegExp.prototype.exec,PC=E_,eyt=C_("".charAt),ryt=C_("".indexOf),nyt=C_("".replace),MC=C_("".slice),UC=function(){var r=/a/,t=/b*/g;return cp(E_,r,"a"),cp(E_,t,"a"),r.lastIndex!==0||t.lastIndex!==0}(),mD=$0t.BROKEN_CARET,RC=/()??/.exec("")[1]!==void 0,iyt=UC||RC||mD||Y0t||Z0t;iyt&&(PC=function(r){var t=this,e=J0t(t),n=q0t(r),i=e.raw,s,a,o,A,f,m,_;if(i)return i.lastIndex=t.lastIndex,s=cp(PC,i,n),t.lastIndex=i.lastIndex,s;var x=e.groups,B=mD&&t.sticky,P=cp(K0t,t),M=t.source,k=0,Q=n;if(B&&(P=nyt(P,"y",""),ryt(P,"g")===-1&&(P+="g"),Q=MC(n,t.lastIndex),t.lastIndex>0&&(!t.multiline||t.multiline&&eyt(n,t.lastIndex-1)!==`
`)&&(M="(?: "+M+")",Q=" "+Q,k++),a=new RegExp("^(?:"+M+")",P)),RC&&(a=new RegExp("^"+M+"$(?!\\s)",P)),UC&&(o=t.lastIndex),A=cp(E_,B?a:t,Q),B?A?(A.input=MC(A.input,k),A[0]=MC(A[0],k),A.index=t.lastIndex,t.lastIndex+=A[0].length):t.lastIndex=0:UC&&A&&(t.lastIndex=t.global?A.index+A[0].length:o),RC&&A&&A.length>1&&cp(tyt,A[0],a,function(){for(f=1;f<arguments.length-2;f++)arguments[f]===void 0&&(A[f]=void 0)}),A&&x)for(A.groups=m=X0t(null),f=0;f<x.length;f++)_=x[f],m[_[0]]=A[_[1]];return A});var OC=PC,syt=Go,yD=OC;syt({target:"RegExp",proto:!0,forced:/./.exec!==yD},{exec:yD});var _D=Ys,vD=ld,oyt=OC,bD=ss,wD=Ds,ayt=pm,cyt=wD("species"),DC=RegExp.prototype,NC=function(r,t,e,n){var i=wD(r),s=!bD(function(){var f={};return f[i]=function(){return 7},""[r](f)!==7}),a=s&&!bD(function(){var f=!1,m=/a/;return r==="split"&&(m={},m.constructor={},m.constructor[cyt]=function(){return m},m.flags="",m[i]=/./[i]),m.exec=function(){return f=!0,null},m[i](""),!f});if(!s||!a||e){var o=/./[i],A=t(i,""[r],function(f,m,_,x,B){var P=m.exec;return P===oyt||P===DC.exec?s&&!B?{done:!0,value:_D(o,m,_,x)}:{done:!0,value:_D(f,_,m,x)}:{done:!1}});vD(String.prototype,r,A[0]),vD(DC,i,A[1])}n&&ayt(DC[i],"sham",!0)},kC=os,lyt=o_,uyt=iu,Ayt=il,hyt=kC("".charAt),xD=kC("".charCodeAt),dyt=kC("".slice),BD=function(r){return function(t,e){var n=uyt(Ayt(t)),i=lyt(e),s=n.length,a,o;return i<0||i>=s?r?"":void 0:(a=xD(n,i),a<55296||a>56319||i+1===s||(o=xD(n,i+1))<56320||o>57343?r?hyt(n,i):a:r?dyt(n,i,i+2):(a-55296<<10)+(o-56320)+65536)}},fyt={codeAt:BD(!1),charAt:BD(!0)},pyt=fyt.charAt,QC=function(r,t,e){return t+(e?pyt(r,t).length:1)},CD=Ys,gyt=zo,myt=as,yyt=od,_yt=OC,vyt=TypeError,HC=function(r,t){var e=r.exec;if(myt(e)){var n=CD(e,r,t);return n!==null&&gyt(n),n}if(yyt(r)==="RegExp")return CD(_yt,r,t);throw new vyt("RegExp#exec called on incompatible receiver")},byt=Ys,wyt=NC,xyt=zo,Byt=ad,Cyt=tp,zC=iu,Eyt=il,Syt=Jf,Tyt=QC,ED=HC;wyt("match",function(r,t,e){return[function(n){var i=Eyt(this),s=Byt(n)?void 0:Syt(n,r);return s?byt(s,n,i):new RegExp(n)[r](zC(i))},function(n){var i=xyt(this),s=zC(n),a=e(t,i,s);if(a.done)return a.value;if(!i.global)return ED(i,s);var o=i.unicode;i.lastIndex=0;for(var A=[],f=0,m;(m=ED(i,s))!==null;){var _=zC(m[0]);A[f]=_,_===""&&(i.lastIndex=Tyt(s,Cyt(i.lastIndex),o)),f++}return f===0?null:A}]});var GC=os,Iyt=J1,Lyt=Math.floor,VC=GC("".charAt),Fyt=GC("".replace),jC=GC("".slice),Pyt=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,Myt=/\$([$&'`]|\d{1,2})/g,Uyt=function(r,t,e,n,i,s){var a=e+r.length,o=n.length,A=Myt;return i!==void 0&&(i=Iyt(i),A=Pyt),Fyt(s,A,function(f,m){var _;switch(VC(m,0)){case"$":return"$";case"&":return r;case"`":return jC(t,0,e);case"'":return jC(t,a);case"<":_=i[jC(m,1,-1)];break;default:var x=+m;if(x===0)return f;if(x>o){var B=Lyt(x/10);return B===0?f:B<=o?n[B-1]===void 0?VC(m,1):n[B-1]+VC(m,1):f}_=n[x-1]}return _===void 0?"":_})},Ryt=oO,SD=Ys,S_=os,Oyt=NC,Dyt=ss,Nyt=zo,kyt=as,Qyt=ad,Hyt=o_,zyt=tp,lp=iu,Gyt=il,Vyt=QC,jyt=Jf,qyt=Uyt,Kyt=HC,$yt=Ds,qC=$yt("replace"),Wyt=Math.max,Xyt=Math.min,Jyt=S_([].concat),KC=S_([].push),TD=S_("".indexOf),ID=S_("".slice),Yyt=function(r){return r===void 0?r:String(r)},Zyt=function(){return"a".replace(/./,"$0")==="$0"}(),LD=function(){return/./[qC]?/./[qC]("a","$0")==="":!1}(),t1t=!Dyt(function(){var r=/./;return r.exec=function(){var t=[];return t.groups={a:"7"},t},"".replace(r,"$<a>")!=="7"});Oyt("replace",function(r,t,e){var n=LD?"$":"$0";return[function(i,s){var a=Gyt(this),o=Qyt(i)?void 0:jyt(i,qC);return o?SD(o,i,a,s):SD(t,lp(a),i,s)},function(i,s){var a=Nyt(this),o=lp(i);if(typeof s=="string"&&TD(s,n)===-1&&TD(s,"$<")===-1){var A=e(t,a,o,s);if(A.done)return A.value}var f=kyt(s);f||(s=lp(s));var m=a.global,_;m&&(_=a.unicode,a.lastIndex=0);for(var x=[],B;B=Kyt(a,o),!(B===null||(KC(x,B),!m));){var P=lp(B[0]);P===""&&(a.lastIndex=Vyt(o,zyt(a.lastIndex),_))}for(var M="",k=0,Q=0;Q<x.length;Q++){B=x[Q];for(var q=lp(B[0]),J=Wyt(Xyt(Hyt(B.index),o.length),0),tt=[],ft,pt=1;pt<B.length;pt++)KC(tt,Yyt(B[pt]));var mt=B.groups;if(f){var dt=Jyt([q],tt,J,o);mt!==void 0&&KC(dt,mt),ft=lp(Ryt(s,void 0,dt))}else ft=qyt(q,o,J,tt,mt,s);J>=k&&(M+=ID(o,k,J)+ft,k=J+q.length)}return M+ID(o,k)}]},!t1t||!Zyt||LD);var e1t=sl,r1t=od,n1t=Ds,i1t=n1t("match"),s1t=function(r){var t;return e1t(r)&&((t=r[i1t])!==void 0?!!t:r1t(r)==="RegExp")},o1t=s1t,a1t=TypeError,$C=function(r){if(o1t(r))throw new a1t("The method doesn't accept regular expressions");return r},c1t=Ds,l1t=c1t("match"),WC=function(r){var t=/./;try{"/./"[r](t)}catch{try{return t[l1t]=!1,"/./"[r](t)}catch{}}return!1},u1t=Go,A1t=u_,h1t=dm.f,d1t=tp,FD=iu,f1t=$C,p1t=il,g1t=WC,m1t=A1t("".slice),y1t=Math.min,PD=g1t("startsWith"),_1t=!PD&&!!function(){var r=h1t(String.prototype,"startsWith");return r&&!r.writable}();u1t({target:"String",proto:!0,forced:!_1t&&!PD},{startsWith:function(r){var t=FD(p1t(this));f1t(r);var e=d1t(y1t(arguments.length>1?arguments[1]:void 0,t.length)),n=FD(r);return m1t(t,e,e+n.length)===n}});var v1t=Ds,b1t=FC,w1t=Ku.f,XC=v1t("unscopables"),JC=Array.prototype;JC[XC]===void 0&&w1t(JC,XC,{configurable:!0,value:b1t(null)});var x1t=function(r){JC[XC][r]=!0},B1t=ss,C1t=!B1t(function(){function r(){}return r.prototype.constructor=null,Object.getPrototypeOf(new r)!==r.prototype}),E1t=al,S1t=as,T1t=J1,I1t=HB,L1t=C1t,MD=I1t("IE_PROTO"),YC=Object,F1t=YC.prototype,UD=L1t?YC.getPrototypeOf:function(r){var t=T1t(r);if(E1t(t,MD))return t[MD];var e=t.constructor;return S1t(e)&&t instanceof e?e.prototype:t instanceof YC?F1t:null},P1t=ss,M1t=as,U1t=sl,RD=UD,R1t=ld,O1t=Ds,ZC=O1t("iterator"),OD=!1,hd,tE,eE;[].keys&&(eE=[].keys(),"next"in eE?(tE=RD(RD(eE)),tE!==Object.prototype&&(hd=tE)):OD=!0);var D1t=!U1t(hd)||P1t(function(){var r={};return hd[ZC].call(r)!==r});D1t&&(hd={}),M1t(hd[ZC])||R1t(hd,ZC,function(){return this});var DD={IteratorPrototype:hd,BUGGY_SAFARI_ITERATORS:OD},N1t=DD.IteratorPrototype,k1t=FC,Q1t=yB,H1t=c_,z1t=Bm,G1t=function(){return this},V1t=function(r,t,e,n){var i=t+" Iterator";return r.prototype=k1t(N1t,{next:Q1t(+!n,e)}),H1t(r,i,!1),z1t[i]=G1t,r},j1t=Go,q1t=Ys,ND=t_,K1t=as,$1t=V1t,kD=UD,QD=qR,W1t=c_,X1t=pm,rE=ld,J1t=Ds,Y1t=Bm,HD=DD,Z1t=ND.PROPER,t_t=ND.CONFIGURABLE,zD=HD.IteratorPrototype,T_=HD.BUGGY_SAFARI_ITERATORS,Cm=J1t("iterator"),GD="keys",Em="values",VD="entries",e_t=function(){return this},r_t=function(r,t,e,n,i,s,a){$1t(e,t,n);var o=function(Q){if(Q===i&&x)return x;if(!T_&&Q&&Q in m)return m[Q];switch(Q){case GD:return function(){return new e(this,Q)};case Em:return function(){return new e(this,Q)};case VD:return function(){return new e(this,Q)}}return function(){return new e(this)}},A=t+" Iterator",f=!1,m=r.prototype,_=m[Cm]||m["@@iterator"]||i&&m[i],x=!T_&&_||o(i),B=t==="Array"&&m.entries||_,P,M,k;if(B&&(P=kD(B.call(new r)),P!==Object.prototype&&P.next&&(kD(P)!==zD&&(QD?QD(P,zD):K1t(P[Cm])||rE(P,Cm,e_t)),W1t(P,A,!0))),Z1t&&i===Em&&_&&_.name!==Em&&(t_t?X1t(m,"name",Em):(f=!0,x=function(){return q1t(_,this)})),i)if(M={values:o(Em),keys:s?x:o(GD),entries:o(VD)},a)for(k in M)(T_||f||!(k in m))&&rE(m,k,M[k]);else j1t({target:t,proto:!0,forced:T_||f},M);return m[Cm]!==x&&rE(m,Cm,x,{name:i}),Y1t[t]=x,M},n_t=function(r,t){return{value:r,done:t}},i_t=fm,nE=x1t,jD=Bm,qD=n_,s_t=Ku.f,o_t=r_t,I_=n_t,a_t=nl,KD="Array Iterator",c_t=qD.set,l_t=qD.getterFor(KD),u_t=o_t(Array,"Array",function(r,t){c_t(this,{type:KD,target:i_t(r),index:0,kind:t})},function(){var r=l_t(this),t=r.target,e=r.index++;if(!t||e>=t.length)return r.target=void 0,I_(void 0,!0);switch(r.kind){case"keys":return I_(e,!1);case"values":return I_(t[e],!1)}return I_([e,t[e]],!1)},"values"),$D=jD.Arguments=jD.Array;if(nE("keys"),nE("values"),nE("entries"),a_t&&$D.name!=="values")try{s_t($D,"name",{value:"values"})}catch{}var A_t={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},h_t=Y1,iE=h_t("span").classList,WD=iE&&iE.constructor&&iE.constructor.prototype,d_t=WD===Object.prototype?void 0:WD,XD=is,JD=A_t,f_t=d_t,Sm=u_t,YD=pm,p_t=c_,g_t=Ds,sE=g_t("iterator"),oE=Sm.values,ZD=function(r,t){if(r){if(r[sE]!==oE)try{YD(r,sE,oE)}catch{r[sE]=oE}if(p_t(r,t,!0),JD[t]){for(var e in Sm)if(r[e]!==Sm[e])try{YD(r,e,Sm[e])}catch{r[e]=Sm[e]}}}};for(var aE in JD)ZD(XD[aE]&&XD[aE].prototype,aE);ZD(f_t,"DOMTokenList");function m_t(r,t){if(kn(r)!="object"||!r)return r;var e=r[Symbol.toPrimitive];if(e!==void 0){var n=e.call(r,t||"default");if(kn(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(r)}function y_t(r){var t=m_t(r,"string");return kn(t)=="symbol"?t:t+""}function cE(r,t,e){return t=y_t(t),t in r?Object.defineProperty(r,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):r[t]=e,r}var __t=qu,v_t=J1,b_t=iR,w_t=$B,t6=TypeError,e6="Reduce of empty array with no initial value",r6=function(r){return function(t,e,n,i){var s=v_t(t),a=b_t(s),o=w_t(s);if(__t(e),o===0&&n<2)throw new t6(e6);var A=r?o-1:0,f=r?-1:1;if(n<2)for(;;){if(A in a){i=a[A],A+=f;break}if(A+=f,r?A<0:o<=A)throw new t6(e6)}for(;r?A>=0:o>A;A+=f)A in a&&(i=e(i,a[A],A,s));return i}},x_t={left:r6(!1),right:r6(!0)},B_t=ss,n6=function(r,t){var e=[][r];return!!e&&B_t(function(){e.call(null,t||function(){return 1},1)})},C_t=Go,E_t=x_t.left,S_t=n6,i6=BB,T_t=ym,I_t=!T_t&&i6>79&&i6<83,L_t=I_t||!S_t("reduce");C_t({target:"Array",proto:!0,forced:L_t},{reduce:function(r){var t=arguments.length;return E_t(this,r,t,t>1?arguments[1]:void 0)}});var F_t=Go,P_t=u_,M_t=dm.f,U_t=tp,s6=iu,R_t=$C,O_t=il,D_t=WC,N_t=P_t("".slice),k_t=Math.min,o6=D_t("endsWith"),Q_t=!o6&&!!function(){var r=M_t(String.prototype,"endsWith");return r&&!r.writable}();F_t({target:"String",proto:!0,forced:!Q_t&&!o6},{endsWith:function(r){var t=s6(O_t(this));R_t(r);var e=arguments.length>1?arguments[1]:void 0,n=t.length,i=e===void 0?n:k_t(U_t(e),n),s=s6(r);return N_t(t,i-s.length,i)===s}});var lE=Ys,a6=os,H_t=NC,z_t=zo,G_t=ad,V_t=il,j_t=rO,q_t=QC,K_t=tp,c6=iu,$_t=Jf,l6=HC,W_t=lD,X_t=ss,up=W_t.UNSUPPORTED_Y,J_t=4294967295,Y_t=Math.min,uE=a6([].push),AE=a6("".slice),Z_t=!X_t(function(){var r=/(?:)/,t=r.exec;r.exec=function(){return t.apply(this,arguments)};var e="ab".split(r);return e.length!==2||e[0]!=="a"||e[1]!=="b"}),u6="abbc".split(/(b)*/)[1]==="c"||"test".split(/(?:)/,-1).length!==4||"ab".split(/(?:ab)*/).length!==2||".".split(/(.?)(.?)/).length!==4||".".split(/()()/).length>1||"".split(/.?/).length;H_t("split",function(r,t,e){var n="0".split(void 0,0).length?function(i,s){return i===void 0&&s===0?[]:lE(t,this,i,s)}:t;return[function(i,s){var a=V_t(this),o=G_t(i)?void 0:$_t(i,r);return o?lE(o,i,a,s):lE(n,c6(a),i,s)},function(i,s){var a=z_t(this),o=c6(i);if(!u6){var A=e(n,a,o,s,n!==t);if(A.done)return A.value}var f=j_t(a,RegExp),m=a.unicode,_=(a.ignoreCase?"i":"")+(a.multiline?"m":"")+(a.unicode?"u":"")+(up?"g":"y"),x=new f(up?"^(?:"+a.source+")":a,_),B=s===void 0?J_t:s>>>0;if(B===0)return[];if(o.length===0)return l6(x,o)===null?[o]:[];for(var P=0,M=0,k=[];M<o.length;){x.lastIndex=up?0:M;var Q=l6(x,up?AE(o,M):o),q;if(Q===null||(q=Y_t(K_t(x.lastIndex+(up?M:0)),o.length))===P)M=q_t(o,M,m);else{if(uE(k,AE(o,P,M)),k.length===B)return k;for(var J=1;J<=Q.length-1;J++)if(uE(k,Q[J]),k.length===B)return k;M=P=q}}return uE(k,AE(o,P)),k}]},u6||!Z_t,up);var L_={exports:{}},Tm={exports:{}};(function(){var r,t,e,n,i,s;typeof performance<"u"&&performance!==null&&performance.now?Tm.exports=function(){return performance.now()}:typeof process<"u"&&process!==null&&process.hrtime?(Tm.exports=function(){return(r()-i)/1e6},t=process.hrtime,r=function(){var a;return a=t(),a[0]*1e9+a[1]},n=r(),s=process.uptime()*1e9,i=n-s):Date.now?(Tm.exports=function(){return Date.now()-e},e=Date.now()):(Tm.exports=function(){return new Date().getTime()-e},e=new Date().getTime())}).call(Xf);for(var tvt=Tm.exports,evt=tvt,Wu=typeof window>"u"?Xf:window,F_=["moz","webkit"],Ap="AnimationFrame",hp=Wu["request"+Ap],Im=Wu["cancel"+Ap]||Wu["cancelRequest"+Ap],Lm=0;!hp&&Lm<F_.length;Lm++)hp=Wu[F_[Lm]+"Request"+Ap],Im=Wu[F_[Lm]+"Cancel"+Ap]||Wu[F_[Lm]+"CancelRequest"+Ap];if(!hp||!Im){var hE=0,A6=0,dd=[],rvt=1e3/60;hp=function(r){if(dd.length===0){var t=evt(),e=Math.max(0,rvt-(t-hE));hE=e+t,setTimeout(function(){var n=dd.slice(0);dd.length=0;for(var i=0;i<n.length;i++)if(!n[i].cancelled)try{n[i].callback(hE)}catch(s){setTimeout(function(){throw s},0)}},Math.round(e))}return dd.push({handle:++A6,callback:r,cancelled:!1}),A6},Im=function(r){for(var t=0;t<dd.length;t++)dd[t].handle===r&&(dd[t].cancelled=!0)}}L_.exports=function(r){return hp.call(Wu,r)},L_.exports.cancel=function(){Im.apply(Wu,arguments)},L_.exports.polyfill=function(r){r||(r=Wu),r.requestAnimationFrame=hp,r.cancelAnimationFrame=Im};var nvt=L_.exports;const dE=JU(nvt);var h6=`	
\v\f\r \u2028\u2029\uFEFF`,ivt=os,svt=il,ovt=iu,fE=h6,d6=ivt("".replace),avt=RegExp("^["+fE+"]+"),cvt=RegExp("(^|[^"+fE+"])["+fE+"]+$"),pE=function(r){return function(t){var e=ovt(svt(t));return r&1&&(e=d6(e,avt,"")),r&2&&(e=d6(e,cvt,"$1")),e}},lvt={start:pE(1),end:pE(2),trim:pE(3)},uvt=t_.PROPER,Avt=ss,f6=h6,p6="",hvt=function(r){return Avt(function(){return!!f6[r]()||p6[r]()!==p6||uvt&&f6[r].name!==r})},dvt=Go,fvt=lvt.trim,pvt=hvt;dvt({target:"String",proto:!0,forced:pvt("trim")},{trim:function(){return fvt(this)}});var gvt=function(r){this.ok=!1,this.alpha=1,r.charAt(0)=="#"&&(r=r.substr(1,6)),r=r.replace(/ /g,""),r=r.toLowerCase();var t={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};r=t[r]||r;for(var e=[{re:/^rgba\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3}),\s*((?:\d?\.)?\d)\)$/,example:["rgba(123, 234, 45, 0.8)","rgba(255,234,245,1.0)"],process:function(A){return[parseInt(A[1]),parseInt(A[2]),parseInt(A[3]),parseFloat(A[4])]}},{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(A){return[parseInt(A[1]),parseInt(A[2]),parseInt(A[3])]}},{re:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,example:["#00ff00","336699"],process:function(A){return[parseInt(A[1],16),parseInt(A[2],16),parseInt(A[3],16)]}},{re:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,example:["#fb0","f0f"],process:function(A){return[parseInt(A[1]+A[1],16),parseInt(A[2]+A[2],16),parseInt(A[3]+A[3],16)]}}],n=0;n<e.length;n++){var i=e[n].re,s=e[n].process,a=i.exec(r);if(a){var o=s(a);this.r=o[0],this.g=o[1],this.b=o[2],o.length>3&&(this.alpha=o[3]),this.ok=!0}}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.alpha=this.alpha<0?0:this.alpha>1||isNaN(this.alpha)?1:this.alpha,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toRGBA=function(){return"rgba("+this.r+", "+this.g+", "+this.b+", "+this.alpha+")"},this.toHex=function(){var A=this.r.toString(16),f=this.g.toString(16),m=this.b.toString(16);return A.length==1&&(A="0"+A),f.length==1&&(f="0"+f),m.length==1&&(m="0"+m),"#"+A+f+m},this.getHelpXML=function(){for(var A=new Array,f=0;f<e.length;f++)for(var m=e[f].example,_=0;_<m.length;_++)A[A.length]=m[_];for(var x in t)A[A.length]=x;var B=document.createElement("ul");B.setAttribute("id","rgbcolor-examples");for(var f=0;f<A.length;f++)try{var P=document.createElement("li"),M=new RGBColor(A[f]),k=document.createElement("div");k.style.cssText="margin: 3px; border: 1px solid black; background:"+M.toHex()+"; color:"+M.toHex(),k.appendChild(document.createTextNode("test"));var Q=document.createTextNode(" "+A[f]+" -> "+M.toRGB()+" -> "+M.toHex());P.appendChild(k),P.appendChild(Q),B.appendChild(P)}catch{}return B}};const gE=JU(gvt);var mvt=Go,yvt=u_,_vt=QR.indexOf,vvt=n6,mE=yvt([].indexOf),g6=!!mE&&1/mE([1],1,-0)<0,bvt=g6||!vvt("indexOf");mvt({target:"Array",proto:!0,forced:bvt},{indexOf:function(r){var t=arguments.length>1?arguments[1]:void 0;return g6?mE(this,r,t)||0:_vt(this,r,t)}});var wvt=Go,xvt=os,Bvt=$C,Cvt=il,m6=iu,Evt=WC,Svt=xvt("".indexOf);wvt({target:"String",proto:!0,forced:!Evt("includes")},{includes:function(r){return!!~Svt(m6(Cvt(this)),m6(Bvt(r)),arguments.length>1?arguments[1]:void 0)}});var Tvt=od,Ivt=Array.isArray||function(r){return Tvt(r)==="Array"},Lvt=Go,Fvt=os,Pvt=Ivt,Mvt=Fvt([].reverse),y6=[1,2];Lvt({target:"Array",proto:!0,forced:String(y6)===String(y6.reverse())},{reverse:function(){return Pvt(this)&&(this.length=this.length),Mvt(this)}});/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var _6=function(r,t){return(_6=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])})(r,t)};function v6(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}_6(r,t),r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}function Uvt(r){var t="";Array.isArray(r)||(r=[r]);for(var e=0;e<r.length;e++){var n=r[e];if(n.type===Ue.CLOSE_PATH)t+="z";else if(n.type===Ue.HORIZ_LINE_TO)t+=(n.relative?"h":"H")+n.x;else if(n.type===Ue.VERT_LINE_TO)t+=(n.relative?"v":"V")+n.y;else if(n.type===Ue.MOVE_TO)t+=(n.relative?"m":"M")+n.x+" "+n.y;else if(n.type===Ue.LINE_TO)t+=(n.relative?"l":"L")+n.x+" "+n.y;else if(n.type===Ue.CURVE_TO)t+=(n.relative?"c":"C")+n.x1+" "+n.y1+" "+n.x2+" "+n.y2+" "+n.x+" "+n.y;else if(n.type===Ue.SMOOTH_CURVE_TO)t+=(n.relative?"s":"S")+n.x2+" "+n.y2+" "+n.x+" "+n.y;else if(n.type===Ue.QUAD_TO)t+=(n.relative?"q":"Q")+n.x1+" "+n.y1+" "+n.x+" "+n.y;else if(n.type===Ue.SMOOTH_QUAD_TO)t+=(n.relative?"t":"T")+n.x+" "+n.y;else{if(n.type!==Ue.ARC)throw new Error('Unexpected command type "'+n.type+'" at index '+e+".");t+=(n.relative?"a":"A")+n.rX+" "+n.rY+" "+n.xRot+" "+ +n.lArcFlag+" "+ +n.sweepFlag+" "+n.x+" "+n.y}}return t}function yE(r,t){var e=r[0],n=r[1];return[e*Math.cos(t)-n*Math.sin(t),e*Math.sin(t)+n*Math.cos(t)]}function cl(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];for(var e=0;e<r.length;e++)if(typeof r[e]!="number")throw new Error("assertNumbers arguments["+e+"] is not a number. "+typeof r[e]+" == typeof "+r[e]);return!0}var ih=Math.PI;function _E(r,t,e){r.lArcFlag=r.lArcFlag===0?0:1,r.sweepFlag=r.sweepFlag===0?0:1;var n=r.rX,i=r.rY,s=r.x,a=r.y;n=Math.abs(r.rX),i=Math.abs(r.rY);var o=yE([(t-s)/2,(e-a)/2],-r.xRot/180*ih),A=o[0],f=o[1],m=Math.pow(A,2)/Math.pow(n,2)+Math.pow(f,2)/Math.pow(i,2);1<m&&(n*=Math.sqrt(m),i*=Math.sqrt(m)),r.rX=n,r.rY=i;var _=Math.pow(n,2)*Math.pow(f,2)+Math.pow(i,2)*Math.pow(A,2),x=(r.lArcFlag!==r.sweepFlag?1:-1)*Math.sqrt(Math.max(0,(Math.pow(n,2)*Math.pow(i,2)-_)/_)),B=n*f/i*x,P=-i*A/n*x,M=yE([B,P],r.xRot/180*ih);r.cX=M[0]+(t+s)/2,r.cY=M[1]+(e+a)/2,r.phi1=Math.atan2((f-P)/i,(A-B)/n),r.phi2=Math.atan2((-f-P)/i,(-A-B)/n),r.sweepFlag===0&&r.phi2>r.phi1&&(r.phi2-=2*ih),r.sweepFlag===1&&r.phi2<r.phi1&&(r.phi2+=2*ih),r.phi1*=180/ih,r.phi2*=180/ih}function b6(r,t,e){cl(r,t,e);var n=r*r+t*t-e*e;if(0>n)return[];if(n===0)return[[r*e/(r*r+t*t),t*e/(r*r+t*t)]];var i=Math.sqrt(n);return[[(r*e+t*i)/(r*r+t*t),(t*e-r*i)/(r*r+t*t)],[(r*e-t*i)/(r*r+t*t),(t*e+r*i)/(r*r+t*t)]]}var vs,Xu=Math.PI/180;function w6(r,t,e){return(1-e)*r+e*t}function x6(r,t,e,n){return r+Math.cos(n/180*ih)*t+Math.sin(n/180*ih)*e}function B6(r,t,e,n){var i=1e-6,s=t-r,a=e-t,o=3*s+3*(n-e)-6*a,A=6*(a-s),f=3*s;return Math.abs(o)<i?[-f/A]:function(m,_,x){x===void 0&&(x=1e-6);var B=m*m/4-_;if(B<-x)return[];if(B<=x)return[-m/2];var P=Math.sqrt(B);return[-m/2-P,-m/2+P]}(A/o,f/o,i)}function C6(r,t,e,n,i){var s=1-i;return r*(s*s*s)+t*(3*s*s*i)+e*(3*s*i*i)+n*(i*i*i)}(function(r){function t(){return i(function(o,A,f){return o.relative&&(o.x1!==void 0&&(o.x1+=A),o.y1!==void 0&&(o.y1+=f),o.x2!==void 0&&(o.x2+=A),o.y2!==void 0&&(o.y2+=f),o.x!==void 0&&(o.x+=A),o.y!==void 0&&(o.y+=f),o.relative=!1),o})}function e(){var o=NaN,A=NaN,f=NaN,m=NaN;return i(function(_,x,B){return _.type&Ue.SMOOTH_CURVE_TO&&(_.type=Ue.CURVE_TO,o=isNaN(o)?x:o,A=isNaN(A)?B:A,_.x1=_.relative?x-o:2*x-o,_.y1=_.relative?B-A:2*B-A),_.type&Ue.CURVE_TO?(o=_.relative?x+_.x2:_.x2,A=_.relative?B+_.y2:_.y2):(o=NaN,A=NaN),_.type&Ue.SMOOTH_QUAD_TO&&(_.type=Ue.QUAD_TO,f=isNaN(f)?x:f,m=isNaN(m)?B:m,_.x1=_.relative?x-f:2*x-f,_.y1=_.relative?B-m:2*B-m),_.type&Ue.QUAD_TO?(f=_.relative?x+_.x1:_.x1,m=_.relative?B+_.y1:_.y1):(f=NaN,m=NaN),_})}function n(){var o=NaN,A=NaN;return i(function(f,m,_){if(f.type&Ue.SMOOTH_QUAD_TO&&(f.type=Ue.QUAD_TO,o=isNaN(o)?m:o,A=isNaN(A)?_:A,f.x1=f.relative?m-o:2*m-o,f.y1=f.relative?_-A:2*_-A),f.type&Ue.QUAD_TO){o=f.relative?m+f.x1:f.x1,A=f.relative?_+f.y1:f.y1;var x=f.x1,B=f.y1;f.type=Ue.CURVE_TO,f.x1=((f.relative?0:m)+2*x)/3,f.y1=((f.relative?0:_)+2*B)/3,f.x2=(f.x+2*x)/3,f.y2=(f.y+2*B)/3}else o=NaN,A=NaN;return f})}function i(o){var A=0,f=0,m=NaN,_=NaN;return function(x){if(isNaN(m)&&!(x.type&Ue.MOVE_TO))throw new Error("path must start with moveto");var B=o(x,A,f,m,_);return x.type&Ue.CLOSE_PATH&&(A=m,f=_),x.x!==void 0&&(A=x.relative?A+x.x:x.x),x.y!==void 0&&(f=x.relative?f+x.y:x.y),x.type&Ue.MOVE_TO&&(m=A,_=f),B}}function s(o,A,f,m,_,x){return cl(o,A,f,m,_,x),i(function(B,P,M,k){var Q=B.x1,q=B.x2,J=B.relative&&!isNaN(k),tt=B.x!==void 0?B.x:J?0:P,ft=B.y!==void 0?B.y:J?0:M;function pt(it){return it*it}B.type&Ue.HORIZ_LINE_TO&&A!==0&&(B.type=Ue.LINE_TO,B.y=B.relative?0:M),B.type&Ue.VERT_LINE_TO&&f!==0&&(B.type=Ue.LINE_TO,B.x=B.relative?0:P),B.x!==void 0&&(B.x=B.x*o+ft*f+(J?0:_)),B.y!==void 0&&(B.y=tt*A+B.y*m+(J?0:x)),B.x1!==void 0&&(B.x1=B.x1*o+B.y1*f+(J?0:_)),B.y1!==void 0&&(B.y1=Q*A+B.y1*m+(J?0:x)),B.x2!==void 0&&(B.x2=B.x2*o+B.y2*f+(J?0:_)),B.y2!==void 0&&(B.y2=q*A+B.y2*m+(J?0:x));var mt=o*m-A*f;if(B.xRot!==void 0&&(o!==1||A!==0||f!==0||m!==1))if(mt===0)delete B.rX,delete B.rY,delete B.xRot,delete B.lArcFlag,delete B.sweepFlag,B.type=Ue.LINE_TO;else{var dt=B.xRot*Math.PI/180,Rt=Math.sin(dt),Lt=Math.cos(dt),st=1/pt(B.rX),ct=1/pt(B.rY),wt=pt(Lt)*st+pt(Rt)*ct,yt=2*Rt*Lt*(st-ct),te=pt(Rt)*st+pt(Lt)*ct,Zt=wt*m*m-yt*A*m+te*A*A,re=yt*(o*m+A*f)-2*(wt*f*m+te*o*A),Xt=wt*f*f-yt*o*f+te*o*o,ne=(Math.atan2(re,Zt-Xt)+Math.PI)%Math.PI/2,se=Math.sin(ne),we=Math.cos(ne);B.rX=Math.abs(mt)/Math.sqrt(Zt*pt(we)+re*se*we+Xt*pt(se)),B.rY=Math.abs(mt)/Math.sqrt(Zt*pt(se)-re*se*we+Xt*pt(we)),B.xRot=180*ne/Math.PI}return B.sweepFlag!==void 0&&0>mt&&(B.sweepFlag=+!B.sweepFlag),B})}function a(){return function(o){var A={};for(var f in o)A[f]=o[f];return A}}r.ROUND=function(o){function A(f){return Math.round(f*o)/o}return o===void 0&&(o=1e13),cl(o),function(f){return f.x1!==void 0&&(f.x1=A(f.x1)),f.y1!==void 0&&(f.y1=A(f.y1)),f.x2!==void 0&&(f.x2=A(f.x2)),f.y2!==void 0&&(f.y2=A(f.y2)),f.x!==void 0&&(f.x=A(f.x)),f.y!==void 0&&(f.y=A(f.y)),f.rX!==void 0&&(f.rX=A(f.rX)),f.rY!==void 0&&(f.rY=A(f.rY)),f}},r.TO_ABS=t,r.TO_REL=function(){return i(function(o,A,f){return o.relative||(o.x1!==void 0&&(o.x1-=A),o.y1!==void 0&&(o.y1-=f),o.x2!==void 0&&(o.x2-=A),o.y2!==void 0&&(o.y2-=f),o.x!==void 0&&(o.x-=A),o.y!==void 0&&(o.y-=f),o.relative=!0),o})},r.NORMALIZE_HVZ=function(o,A,f){return o===void 0&&(o=!0),A===void 0&&(A=!0),f===void 0&&(f=!0),i(function(m,_,x,B,P){if(isNaN(B)&&!(m.type&Ue.MOVE_TO))throw new Error("path must start with moveto");return A&&m.type&Ue.HORIZ_LINE_TO&&(m.type=Ue.LINE_TO,m.y=m.relative?0:x),f&&m.type&Ue.VERT_LINE_TO&&(m.type=Ue.LINE_TO,m.x=m.relative?0:_),o&&m.type&Ue.CLOSE_PATH&&(m.type=Ue.LINE_TO,m.x=m.relative?B-_:B,m.y=m.relative?P-x:P),m.type&Ue.ARC&&(m.rX===0||m.rY===0)&&(m.type=Ue.LINE_TO,delete m.rX,delete m.rY,delete m.xRot,delete m.lArcFlag,delete m.sweepFlag),m})},r.NORMALIZE_ST=e,r.QT_TO_C=n,r.INFO=i,r.SANITIZE=function(o){o===void 0&&(o=0),cl(o);var A=NaN,f=NaN,m=NaN,_=NaN;return i(function(x,B,P,M,k){var Q=Math.abs,q=!1,J=0,tt=0;if(x.type&Ue.SMOOTH_CURVE_TO&&(J=isNaN(A)?0:B-A,tt=isNaN(f)?0:P-f),x.type&(Ue.CURVE_TO|Ue.SMOOTH_CURVE_TO)?(A=x.relative?B+x.x2:x.x2,f=x.relative?P+x.y2:x.y2):(A=NaN,f=NaN),x.type&Ue.SMOOTH_QUAD_TO?(m=isNaN(m)?B:2*B-m,_=isNaN(_)?P:2*P-_):x.type&Ue.QUAD_TO?(m=x.relative?B+x.x1:x.x1,_=x.relative?P+x.y1:x.y2):(m=NaN,_=NaN),x.type&Ue.LINE_COMMANDS||x.type&Ue.ARC&&(x.rX===0||x.rY===0||!x.lArcFlag)||x.type&Ue.CURVE_TO||x.type&Ue.SMOOTH_CURVE_TO||x.type&Ue.QUAD_TO||x.type&Ue.SMOOTH_QUAD_TO){var ft=x.x===void 0?0:x.relative?x.x:x.x-B,pt=x.y===void 0?0:x.relative?x.y:x.y-P;J=isNaN(m)?x.x1===void 0?J:x.relative?x.x:x.x1-B:m-B,tt=isNaN(_)?x.y1===void 0?tt:x.relative?x.y:x.y1-P:_-P;var mt=x.x2===void 0?0:x.relative?x.x:x.x2-B,dt=x.y2===void 0?0:x.relative?x.y:x.y2-P;Q(ft)<=o&&Q(pt)<=o&&Q(J)<=o&&Q(tt)<=o&&Q(mt)<=o&&Q(dt)<=o&&(q=!0)}return x.type&Ue.CLOSE_PATH&&Q(B-M)<=o&&Q(P-k)<=o&&(q=!0),q?[]:x})},r.MATRIX=s,r.ROTATE=function(o,A,f){A===void 0&&(A=0),f===void 0&&(f=0),cl(o,A,f);var m=Math.sin(o),_=Math.cos(o);return s(_,m,-m,_,A-A*_+f*m,f-A*m-f*_)},r.TRANSLATE=function(o,A){return A===void 0&&(A=0),cl(o,A),s(1,0,0,1,o,A)},r.SCALE=function(o,A){return A===void 0&&(A=o),cl(o,A),s(o,0,0,A,0,0)},r.SKEW_X=function(o){return cl(o),s(1,0,Math.atan(o),1,0,0)},r.SKEW_Y=function(o){return cl(o),s(1,Math.atan(o),0,1,0,0)},r.X_AXIS_SYMMETRY=function(o){return o===void 0&&(o=0),cl(o),s(-1,0,0,1,o,0)},r.Y_AXIS_SYMMETRY=function(o){return o===void 0&&(o=0),cl(o),s(1,0,0,-1,0,o)},r.A_TO_C=function(){return i(function(o,A,f){return Ue.ARC===o.type?function(m,_,x){var B,P,M,k;m.cX||_E(m,_,x);for(var Q=Math.min(m.phi1,m.phi2),q=Math.max(m.phi1,m.phi2)-Q,J=Math.ceil(q/90),tt=new Array(J),ft=_,pt=x,mt=0;mt<J;mt++){var dt=w6(m.phi1,m.phi2,mt/J),Rt=w6(m.phi1,m.phi2,(mt+1)/J),Lt=Rt-dt,st=4/3*Math.tan(Lt*Xu/4),ct=[Math.cos(dt*Xu)-st*Math.sin(dt*Xu),Math.sin(dt*Xu)+st*Math.cos(dt*Xu)],wt=ct[0],yt=ct[1],te=[Math.cos(Rt*Xu),Math.sin(Rt*Xu)],Zt=te[0],re=te[1],Xt=[Zt+st*Math.sin(Rt*Xu),re-st*Math.cos(Rt*Xu)],ne=Xt[0],se=Xt[1];tt[mt]={relative:m.relative,type:Ue.CURVE_TO};var we=function(it,vt){var Ft=yE([it*m.rX,vt*m.rY],m.xRot),Ot=Ft[0],$t=Ft[1];return[m.cX+Ot,m.cY+$t]};B=we(wt,yt),tt[mt].x1=B[0],tt[mt].y1=B[1],P=we(ne,se),tt[mt].x2=P[0],tt[mt].y2=P[1],M=we(Zt,re),tt[mt].x=M[0],tt[mt].y=M[1],m.relative&&(tt[mt].x1-=ft,tt[mt].y1-=pt,tt[mt].x2-=ft,tt[mt].y2-=pt,tt[mt].x-=ft,tt[mt].y-=pt),ft=(k=[tt[mt].x,tt[mt].y])[0],pt=k[1]}return tt}(o,o.relative?0:A,o.relative?0:f):o})},r.ANNOTATE_ARCS=function(){return i(function(o,A,f){return o.relative&&(A=0,f=0),Ue.ARC===o.type&&_E(o,A,f),o})},r.CLONE=a,r.CALCULATE_BOUNDS=function(){var o=function(x){var B={};for(var P in x)B[P]=x[P];return B},A=t(),f=n(),m=e(),_=i(function(x,B,P){var M=m(f(A(o(x))));function k(se){se>_.maxX&&(_.maxX=se),se<_.minX&&(_.minX=se)}function Q(se){se>_.maxY&&(_.maxY=se),se<_.minY&&(_.minY=se)}if(M.type&Ue.DRAWING_COMMANDS&&(k(B),Q(P)),M.type&Ue.HORIZ_LINE_TO&&k(M.x),M.type&Ue.VERT_LINE_TO&&Q(M.y),M.type&Ue.LINE_TO&&(k(M.x),Q(M.y)),M.type&Ue.CURVE_TO){k(M.x),Q(M.y);for(var q=0,J=B6(B,M.x1,M.x2,M.x);q<J.length;q++)0<(ne=J[q])&&1>ne&&k(C6(B,M.x1,M.x2,M.x,ne));for(var tt=0,ft=B6(P,M.y1,M.y2,M.y);tt<ft.length;tt++)0<(ne=ft[tt])&&1>ne&&Q(C6(P,M.y1,M.y2,M.y,ne))}if(M.type&Ue.ARC){k(M.x),Q(M.y),_E(M,B,P);for(var pt=M.xRot/180*Math.PI,mt=Math.cos(pt)*M.rX,dt=Math.sin(pt)*M.rX,Rt=-Math.sin(pt)*M.rY,Lt=Math.cos(pt)*M.rY,st=M.phi1<M.phi2?[M.phi1,M.phi2]:-180>M.phi2?[M.phi2+360,M.phi1+360]:[M.phi2,M.phi1],ct=st[0],wt=st[1],yt=function(se){var we=se[0],it=se[1],vt=180*Math.atan2(it,we)/Math.PI;return vt<ct?vt+360:vt},te=0,Zt=b6(Rt,-mt,0).map(yt);te<Zt.length;te++)(ne=Zt[te])>ct&&ne<wt&&k(x6(M.cX,mt,Rt,ne));for(var re=0,Xt=b6(Lt,-dt,0).map(yt);re<Xt.length;re++){var ne;(ne=Xt[re])>ct&&ne<wt&&Q(x6(M.cY,dt,Lt,ne))}}return x});return _.minX=1/0,_.maxX=-1/0,_.minY=1/0,_.maxY=-1/0,_}})(vs||(vs={}));var ll,E6=function(){function r(){}return r.prototype.round=function(t){return this.transform(vs.ROUND(t))},r.prototype.toAbs=function(){return this.transform(vs.TO_ABS())},r.prototype.toRel=function(){return this.transform(vs.TO_REL())},r.prototype.normalizeHVZ=function(t,e,n){return this.transform(vs.NORMALIZE_HVZ(t,e,n))},r.prototype.normalizeST=function(){return this.transform(vs.NORMALIZE_ST())},r.prototype.qtToC=function(){return this.transform(vs.QT_TO_C())},r.prototype.aToC=function(){return this.transform(vs.A_TO_C())},r.prototype.sanitize=function(t){return this.transform(vs.SANITIZE(t))},r.prototype.translate=function(t,e){return this.transform(vs.TRANSLATE(t,e))},r.prototype.scale=function(t,e){return this.transform(vs.SCALE(t,e))},r.prototype.rotate=function(t,e,n){return this.transform(vs.ROTATE(t,e,n))},r.prototype.matrix=function(t,e,n,i,s,a){return this.transform(vs.MATRIX(t,e,n,i,s,a))},r.prototype.skewX=function(t){return this.transform(vs.SKEW_X(t))},r.prototype.skewY=function(t){return this.transform(vs.SKEW_Y(t))},r.prototype.xSymmetry=function(t){return this.transform(vs.X_AXIS_SYMMETRY(t))},r.prototype.ySymmetry=function(t){return this.transform(vs.Y_AXIS_SYMMETRY(t))},r.prototype.annotateArcs=function(){return this.transform(vs.ANNOTATE_ARCS())},r}(),Rvt=function(r){return r===" "||r==="	"||r==="\r"||r===`
`},S6=function(r){return 48<=r.charCodeAt(0)&&r.charCodeAt(0)<=57},Ovt=function(r){function t(){var e=r.call(this)||this;return e.curNumber="",e.curCommandType=-1,e.curCommandRelative=!1,e.canParseCommandOrComma=!0,e.curNumberHasExp=!1,e.curNumberHasExpDigits=!1,e.curNumberHasDecimal=!1,e.curArgs=[],e}return v6(t,r),t.prototype.finish=function(e){if(e===void 0&&(e=[]),this.parse(" ",e),this.curArgs.length!==0||!this.canParseCommandOrComma)throw new SyntaxError("Unterminated command at the path end.");return e},t.prototype.parse=function(e,n){var i=this;n===void 0&&(n=[]);for(var s=function(_){n.push(_),i.curArgs.length=0,i.canParseCommandOrComma=!0},a=0;a<e.length;a++){var o=e[a],A=!(this.curCommandType!==Ue.ARC||this.curArgs.length!==3&&this.curArgs.length!==4||this.curNumber.length!==1||this.curNumber!=="0"&&this.curNumber!=="1"),f=S6(o)&&(this.curNumber==="0"&&o==="0"||A);if(!S6(o)||f)if(o!=="e"&&o!=="E")if(o!=="-"&&o!=="+"||!this.curNumberHasExp||this.curNumberHasExpDigits)if(o!=="."||this.curNumberHasExp||this.curNumberHasDecimal||A){if(this.curNumber&&this.curCommandType!==-1){var m=Number(this.curNumber);if(isNaN(m))throw new SyntaxError("Invalid number ending at "+a);if(this.curCommandType===Ue.ARC){if(this.curArgs.length===0||this.curArgs.length===1){if(0>m)throw new SyntaxError('Expected positive number, got "'+m+'" at index "'+a+'"')}else if((this.curArgs.length===3||this.curArgs.length===4)&&this.curNumber!=="0"&&this.curNumber!=="1")throw new SyntaxError('Expected a flag, got "'+this.curNumber+'" at index "'+a+'"')}this.curArgs.push(m),this.curArgs.length===Dvt[this.curCommandType]&&(Ue.HORIZ_LINE_TO===this.curCommandType?s({type:Ue.HORIZ_LINE_TO,relative:this.curCommandRelative,x:m}):Ue.VERT_LINE_TO===this.curCommandType?s({type:Ue.VERT_LINE_TO,relative:this.curCommandRelative,y:m}):this.curCommandType===Ue.MOVE_TO||this.curCommandType===Ue.LINE_TO||this.curCommandType===Ue.SMOOTH_QUAD_TO?(s({type:this.curCommandType,relative:this.curCommandRelative,x:this.curArgs[0],y:this.curArgs[1]}),Ue.MOVE_TO===this.curCommandType&&(this.curCommandType=Ue.LINE_TO)):this.curCommandType===Ue.CURVE_TO?s({type:Ue.CURVE_TO,relative:this.curCommandRelative,x1:this.curArgs[0],y1:this.curArgs[1],x2:this.curArgs[2],y2:this.curArgs[3],x:this.curArgs[4],y:this.curArgs[5]}):this.curCommandType===Ue.SMOOTH_CURVE_TO?s({type:Ue.SMOOTH_CURVE_TO,relative:this.curCommandRelative,x2:this.curArgs[0],y2:this.curArgs[1],x:this.curArgs[2],y:this.curArgs[3]}):this.curCommandType===Ue.QUAD_TO?s({type:Ue.QUAD_TO,relative:this.curCommandRelative,x1:this.curArgs[0],y1:this.curArgs[1],x:this.curArgs[2],y:this.curArgs[3]}):this.curCommandType===Ue.ARC&&s({type:Ue.ARC,relative:this.curCommandRelative,rX:this.curArgs[0],rY:this.curArgs[1],xRot:this.curArgs[2],lArcFlag:this.curArgs[3],sweepFlag:this.curArgs[4],x:this.curArgs[5],y:this.curArgs[6]})),this.curNumber="",this.curNumberHasExpDigits=!1,this.curNumberHasExp=!1,this.curNumberHasDecimal=!1,this.canParseCommandOrComma=!0}if(!Rvt(o))if(o===","&&this.canParseCommandOrComma)this.canParseCommandOrComma=!1;else if(o!=="+"&&o!=="-"&&o!==".")if(f)this.curNumber=o,this.curNumberHasDecimal=!1;else{if(this.curArgs.length!==0)throw new SyntaxError("Unterminated command at index "+a+".");if(!this.canParseCommandOrComma)throw new SyntaxError('Unexpected character "'+o+'" at index '+a+". Command cannot follow comma");if(this.canParseCommandOrComma=!1,o!=="z"&&o!=="Z")if(o==="h"||o==="H")this.curCommandType=Ue.HORIZ_LINE_TO,this.curCommandRelative=o==="h";else if(o==="v"||o==="V")this.curCommandType=Ue.VERT_LINE_TO,this.curCommandRelative=o==="v";else if(o==="m"||o==="M")this.curCommandType=Ue.MOVE_TO,this.curCommandRelative=o==="m";else if(o==="l"||o==="L")this.curCommandType=Ue.LINE_TO,this.curCommandRelative=o==="l";else if(o==="c"||o==="C")this.curCommandType=Ue.CURVE_TO,this.curCommandRelative=o==="c";else if(o==="s"||o==="S")this.curCommandType=Ue.SMOOTH_CURVE_TO,this.curCommandRelative=o==="s";else if(o==="q"||o==="Q")this.curCommandType=Ue.QUAD_TO,this.curCommandRelative=o==="q";else if(o==="t"||o==="T")this.curCommandType=Ue.SMOOTH_QUAD_TO,this.curCommandRelative=o==="t";else{if(o!=="a"&&o!=="A")throw new SyntaxError('Unexpected character "'+o+'" at index '+a+".");this.curCommandType=Ue.ARC,this.curCommandRelative=o==="a"}else n.push({type:Ue.CLOSE_PATH}),this.canParseCommandOrComma=!0,this.curCommandType=-1}else this.curNumber=o,this.curNumberHasDecimal=o==="."}else this.curNumber+=o,this.curNumberHasDecimal=!0;else this.curNumber+=o;else this.curNumber+=o,this.curNumberHasExp=!0;else this.curNumber+=o,this.curNumberHasExpDigits=this.curNumberHasExp}return n},t.prototype.transform=function(e){return Object.create(this,{parse:{value:function(n,i){i===void 0&&(i=[]);for(var s=0,a=Object.getPrototypeOf(this).parse.call(this,n);s<a.length;s++){var o=a[s],A=e(o);Array.isArray(A)?i.push.apply(i,A):i.push(A)}return i}}})},t}(E6),Ue=function(r){function t(e){var n=r.call(this)||this;return n.commands=typeof e=="string"?t.parse(e):e,n}return v6(t,r),t.prototype.encode=function(){return t.encode(this.commands)},t.prototype.getBounds=function(){var e=vs.CALCULATE_BOUNDS();return this.transform(e),e},t.prototype.transform=function(e){for(var n=[],i=0,s=this.commands;i<s.length;i++){var a=e(s[i]);Array.isArray(a)?n.push.apply(n,a):n.push(a)}return this.commands=n,this},t.encode=function(e){return Uvt(e)},t.parse=function(e){var n=new Ovt,i=[];return n.parse(e,i),n.finish(i),i},t.CLOSE_PATH=1,t.MOVE_TO=2,t.HORIZ_LINE_TO=4,t.VERT_LINE_TO=8,t.LINE_TO=16,t.CURVE_TO=32,t.SMOOTH_CURVE_TO=64,t.QUAD_TO=128,t.SMOOTH_QUAD_TO=256,t.ARC=512,t.LINE_COMMANDS=t.LINE_TO|t.HORIZ_LINE_TO|t.VERT_LINE_TO,t.DRAWING_COMMANDS=t.HORIZ_LINE_TO|t.VERT_LINE_TO|t.LINE_TO|t.CURVE_TO|t.SMOOTH_CURVE_TO|t.QUAD_TO|t.SMOOTH_QUAD_TO|t.ARC,t}(E6),Dvt=((ll={})[Ue.MOVE_TO]=2,ll[Ue.LINE_TO]=2,ll[Ue.HORIZ_LINE_TO]=1,ll[Ue.VERT_LINE_TO]=1,ll[Ue.CLOSE_PATH]=0,ll[Ue.QUAD_TO]=4,ll[Ue.SMOOTH_QUAD_TO]=2,ll[Ue.CURVE_TO]=6,ll[Ue.SMOOTH_CURVE_TO]=4,ll[Ue.ARC]=7,ll),Nvt=Ys,kvt=al,Qvt=K1,Hvt=cD,T6=RegExp.prototype,zvt=function(r){var t=r.flags;return t===void 0&&!("flags"in T6)&&!kvt(r,"flags")&&Qvt(T6,r)?Nvt(Hvt,r):t},Gvt=t_.PROPER,Vvt=ld,jvt=zo,I6=iu,qvt=ss,Kvt=zvt,vE="toString",L6=RegExp.prototype,F6=L6[vE],$vt=qvt(function(){return F6.call({source:"a",flags:"b"})!=="/a/b"}),Wvt=Gvt&&F6.name!==vE;($vt||Wvt)&&Vvt(L6,vE,function(){var r=jvt(this),t=I6(r.source),e=I6(Kvt(r));return"/"+t+"/"+e},{unsafe:!0});function P_(r){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?P_=function(t){return typeof t}:P_=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},P_(r)}function Xvt(r,t){if(!(r instanceof t))throw new TypeError("Cannot call a class as a function")}var Jvt=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],Yvt=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function Zvt(r,t,e,n,i){if(typeof r=="string"&&(r=document.getElementById(r)),!r||P_(r)!=="object"||!("getContext"in r))throw new TypeError("Expecting canvas with `getContext` method in processCanvasRGB(A) calls!");var s=r.getContext("2d");try{return s.getImageData(t,e,n,i)}catch(a){throw new Error("unable to access image data: "+a)}}function tbt(r,t,e,n,i,s){if(!(isNaN(s)||s<1)){s|=0;var a=Zvt(r,t,e,n,i);a=ebt(a,t,e,n,i,s),r.getContext("2d").putImageData(a,t,e)}}function ebt(r,t,e,n,i,s){for(var a=r.data,o=2*s+1,A=n-1,f=i-1,m=s+1,_=m*(m+1)/2,x=new P6,B=x,P,M=1;M<o;M++)B=B.next=new P6,M===m&&(P=B);B.next=x;for(var k=null,Q=null,q=0,J=0,tt=Jvt[s],ft=Yvt[s],pt=0;pt<i;pt++){B=x;for(var mt=a[J],dt=a[J+1],Rt=a[J+2],Lt=a[J+3],st=0;st<m;st++)B.r=mt,B.g=dt,B.b=Rt,B.a=Lt,B=B.next;for(var ct=0,wt=0,yt=0,te=0,Zt=m*mt,re=m*dt,Xt=m*Rt,ne=m*Lt,se=_*mt,we=_*dt,it=_*Rt,vt=_*Lt,Ft=1;Ft<m;Ft++){var Ot=J+((A<Ft?A:Ft)<<2),$t=a[Ot],jt=a[Ot+1],ae=a[Ot+2],ie=a[Ot+3],Be=m-Ft;se+=(B.r=$t)*Be,we+=(B.g=jt)*Be,it+=(B.b=ae)*Be,vt+=(B.a=ie)*Be,ct+=$t,wt+=jt,yt+=ae,te+=ie,B=B.next}k=x,Q=P;for(var Ie=0;Ie<n;Ie++){var Qe=vt*tt>>>ft;if(a[J+3]=Qe,Qe!==0){var He=255/Qe;a[J]=(se*tt>>>ft)*He,a[J+1]=(we*tt>>>ft)*He,a[J+2]=(it*tt>>>ft)*He}else a[J]=a[J+1]=a[J+2]=0;se-=Zt,we-=re,it-=Xt,vt-=ne,Zt-=k.r,re-=k.g,Xt-=k.b,ne-=k.a;var ze=Ie+s+1;ze=q+(ze<A?ze:A)<<2,ct+=k.r=a[ze],wt+=k.g=a[ze+1],yt+=k.b=a[ze+2],te+=k.a=a[ze+3],se+=ct,we+=wt,it+=yt,vt+=te,k=k.next;var ge=Q,Ut=ge.r,Jt=ge.g,er=ge.b,Se=ge.a;Zt+=Ut,re+=Jt,Xt+=er,ne+=Se,ct-=Ut,wt-=Jt,yt-=er,te-=Se,Q=Q.next,J+=4}q+=n}for(var _e=0;_e<n;_e++){J=_e<<2;var xe=a[J],Ne=a[J+1],ir=a[J+2],Ar=a[J+3],Lr=m*xe,Tr=m*Ne,Nr=m*ir,Qr=m*Ar,fe=_*xe,Ir=_*Ne,De=_*ir,xn=_*Ar;B=x;for(var Pr=0;Pr<m;Pr++)B.r=xe,B.g=Ne,B.b=ir,B.a=Ar,B=B.next;for(var Te=n,Je=0,Ke=0,Yr=0,Or=0,gr=1;gr<=s;gr++){J=Te+_e<<2;var an=m-gr;fe+=(B.r=xe=a[J])*an,Ir+=(B.g=Ne=a[J+1])*an,De+=(B.b=ir=a[J+2])*an,xn+=(B.a=Ar=a[J+3])*an,Or+=xe,Je+=Ne,Ke+=ir,Yr+=Ar,B=B.next,gr<f&&(Te+=n)}J=_e,k=x,Q=P;for(var $r=0;$r<i;$r++){var Ct=J<<2;a[Ct+3]=Ar=xn*tt>>>ft,Ar>0?(Ar=255/Ar,a[Ct]=(fe*tt>>>ft)*Ar,a[Ct+1]=(Ir*tt>>>ft)*Ar,a[Ct+2]=(De*tt>>>ft)*Ar):a[Ct]=a[Ct+1]=a[Ct+2]=0,fe-=Lr,Ir-=Tr,De-=Nr,xn-=Qr,Lr-=k.r,Tr-=k.g,Nr-=k.b,Qr-=k.a,Ct=_e+((Ct=$r+m)<f?Ct:f)*n<<2,fe+=Or+=k.r=a[Ct],Ir+=Je+=k.g=a[Ct+1],De+=Ke+=k.b=a[Ct+2],xn+=Yr+=k.a=a[Ct+3],k=k.next,Lr+=xe=Q.r,Tr+=Ne=Q.g,Nr+=ir=Q.b,Qr+=Ar=Q.a,Or-=xe,Je-=Ne,Ke-=ir,Yr-=Ar,Q=Q.next,J+=n}}return r}var P6=function r(){Xvt(this,r),this.r=0,this.g=0,this.b=0,this.a=0,this.next=null};function rbt(){var{DOMParser:r}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t={window:null,ignoreAnimation:!0,ignoreMouse:!0,DOMParser:r,createCanvas(e,n){return new OffscreenCanvas(e,n)},createImage(e){return $u(function*(){var n=yield fetch(e),i=yield n.blob(),s=yield createImageBitmap(i);return s})()}};return(typeof DOMParser<"u"||typeof r>"u")&&Reflect.deleteProperty(t,"DOMParser"),t}function nbt(r){var{DOMParser:t,canvas:e,fetch:n}=r;return{window:null,ignoreAnimation:!0,ignoreMouse:!0,DOMParser:t,fetch:n,createCanvas:e.createCanvas,createImage:e.loadImage}}var ibt=Object.freeze({__proto__:null,offscreen:rbt,node:nbt});function fd(r){return r.replace(/(?!\u3000)\s+/gm," ")}function M6(r){return r.replace(/^[\n \t]+/,"")}function U6(r){return r.replace(/[\n \t]+$/,"")}function ga(r){var t=(r||"").match(/-?(\d+(?:\.\d*(?:[eE][+-]?\d+)?)?|\.\d+)(?=\D|$)/gm)||[];return t.map(parseFloat)}var sbt=/^[A-Z-]+$/;function R6(r){return sbt.test(r)?r.toLowerCase():r}function bE(r){var t=/url\(('([^']+)'|"([^"]+)"|([^'")]+))\)/.exec(r)||[];return t[2]||t[3]||t[4]}function O6(r){if(!r.startsWith("rgb"))return r;var t=3,e=r.replace(/\d+(\.\d+)?/g,(n,i)=>t--&&i?String(Math.round(parseFloat(n))):n);return e}var obt=/(\[[^\]]+\])/g,abt=/(#[^\s+>~.[:]+)/g,cbt=/(\.[^\s+>~.[:]+)/g,lbt=/(::[^\s+>~.[:]+|:first-line|:first-letter|:before|:after)/gi,ubt=/(:[\w-]+\([^)]*\))/gi,Abt=/(:[^\s+>~.[:]+)/g,hbt=/([^\s+>~.[:]+)/g;function pd(r,t){var e=t.exec(r);return e?[r.replace(t," "),e.length]:[r,0]}function D6(r){var t=[0,0,0],e=r.replace(/:not\(([^)]*)\)/g,"     $1 ").replace(/{[\s\S]*/gm," "),n=0;return[e,n]=pd(e,obt),t[1]+=n,[e,n]=pd(e,abt),t[0]+=n,[e,n]=pd(e,cbt),t[1]+=n,[e,n]=pd(e,lbt),t[2]+=n,[e,n]=pd(e,ubt),t[1]+=n,[e,n]=pd(e,Abt),t[1]+=n,e=e.replace(/[*\s+>~]/g," ").replace(/[#.]/g," "),[e,n]=pd(e,hbt),t[2]+=n,t.join("")}var gd=1e-8;function wE(r){return Math.sqrt(Math.pow(r[0],2)+Math.pow(r[1],2))}function M_(r,t){return(r[0]*t[0]+r[1]*t[1])/(wE(r)*wE(t))}function xE(r,t){return(r[0]*t[1]<r[1]*t[0]?-1:1)*Math.acos(M_(r,t))}function BE(r){return r*r*r}function CE(r){return 3*r*r*(1-r)}function EE(r){return 3*r*(1-r)*(1-r)}function SE(r){return(1-r)*(1-r)*(1-r)}function TE(r){return r*r}function IE(r){return 2*r*(1-r)}function LE(r){return(1-r)*(1-r)}class Rr{constructor(t,e,n){this.document=t,this.name=e,this.value=n,this.isNormalizedColor=!1}static empty(t){return new Rr(t,"EMPTY","")}split(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:" ",{document:e,name:n}=this;return fd(this.getString()).trim().split(t).map(i=>new Rr(e,n,i))}hasValue(t){var{value:e}=this;return e!==null&&e!==""&&(t||e!==0)&&typeof e<"u"}isString(t){var{value:e}=this,n=typeof e=="string";return!n||!t?n:t.test(e)}isUrlDefinition(){return this.isString(/^url\(/)}isPixels(){if(!this.hasValue())return!1;var t=this.getString();switch(!0){case t.endsWith("px"):case/^[0-9]+$/.test(t):return!0;default:return!1}}setValue(t){return this.value=t,this}getValue(t){return typeof t>"u"||this.hasValue()?this.value:t}getNumber(t){if(!this.hasValue())return typeof t>"u"?0:parseFloat(t);var{value:e}=this,n=parseFloat(e);return this.isString(/%$/)&&(n/=100),n}getString(t){return typeof t>"u"||this.hasValue()?typeof this.value>"u"?"":String(this.value):String(t)}getColor(t){var e=this.getString(t);return this.isNormalizedColor||(this.isNormalizedColor=!0,e=O6(e),this.value=e),e}getDpi(){return 96}getRem(){return this.document.rootEmSize}getEm(){return this.document.emSize}getUnits(){return this.getString().replace(/[0-9.-]/g,"")}getPixels(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!this.hasValue())return 0;var[n,i]=typeof t=="boolean"?[void 0,t]:[t],{viewPort:s}=this.document.screen;switch(!0){case this.isString(/vmin$/):return this.getNumber()/100*Math.min(s.computeSize("x"),s.computeSize("y"));case this.isString(/vmax$/):return this.getNumber()/100*Math.max(s.computeSize("x"),s.computeSize("y"));case this.isString(/vw$/):return this.getNumber()/100*s.computeSize("x");case this.isString(/vh$/):return this.getNumber()/100*s.computeSize("y");case this.isString(/rem$/):return this.getNumber()*this.getRem();case this.isString(/em$/):return this.getNumber()*this.getEm();case this.isString(/ex$/):return this.getNumber()*this.getEm()/2;case this.isString(/px$/):return this.getNumber();case this.isString(/pt$/):return this.getNumber()*this.getDpi()*(1/72);case this.isString(/pc$/):return this.getNumber()*15;case this.isString(/cm$/):return this.getNumber()*this.getDpi()/2.54;case this.isString(/mm$/):return this.getNumber()*this.getDpi()/25.4;case this.isString(/in$/):return this.getNumber()*this.getDpi();case(this.isString(/%$/)&&i):return this.getNumber()*this.getEm();case this.isString(/%$/):return this.getNumber()*s.computeSize(n);default:{var a=this.getNumber();return e&&a<1?a*s.computeSize(n):a}}}getMilliseconds(){return this.hasValue()?this.isString(/ms$/)?this.getNumber():this.getNumber()*1e3:0}getRadians(){if(!this.hasValue())return 0;switch(!0){case this.isString(/deg$/):return this.getNumber()*(Math.PI/180);case this.isString(/grad$/):return this.getNumber()*(Math.PI/200);case this.isString(/rad$/):return this.getNumber();default:return this.getNumber()*(Math.PI/180)}}getDefinition(){var t=this.getString(),e=/#([^)'"]+)/.exec(t);return e&&(e=e[1]),e||(e=t),this.document.definitions[e]}getFillStyleDefinition(t,e){var n=this.getDefinition();if(!n)return null;if(typeof n.createGradient=="function")return n.createGradient(this.document.ctx,t,e);if(typeof n.createPattern=="function"){if(n.getHrefAttribute().hasValue()){var i=n.getAttribute("patternTransform");n=n.getHrefAttribute().getDefinition(),i.hasValue()&&n.getAttribute("patternTransform",!0).setValue(i.value)}return n.createPattern(this.document.ctx,t,e)}return null}getTextBaseline(){return this.hasValue()?Rr.textBaselineMapping[this.getString()]:null}addOpacity(t){for(var e=this.getColor(),n=e.length,i=0,s=0;s<n&&(e[s]===","&&i++,i!==3);s++);if(t.hasValue()&&this.isString()&&i!==3){var a=new gE(e);a.ok&&(a.alpha=t.getNumber(),e=a.toRGBA())}return new Rr(this.document,this.name,e)}}Rr.textBaselineMapping={baseline:"alphabetic","before-edge":"top","text-before-edge":"top",middle:"middle",central:"middle","after-edge":"bottom","text-after-edge":"bottom",ideographic:"ideographic",alphabetic:"alphabetic",hanging:"hanging",mathematical:"alphabetic"};class N6{constructor(){this.viewPorts=[]}clear(){this.viewPorts=[]}setCurrent(t,e){this.viewPorts.push({width:t,height:e})}removeCurrent(){this.viewPorts.pop()}getCurrent(){var{viewPorts:t}=this;return t[t.length-1]}get width(){return this.getCurrent().width}get height(){return this.getCurrent().height}computeSize(t){return typeof t=="number"?t:t==="x"?this.width:t==="y"?this.height:Math.sqrt(Math.pow(this.width,2)+Math.pow(this.height,2))/Math.sqrt(2)}}class qi{constructor(t,e){this.x=t,this.y=e}static parse(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,[n=e,i=e]=ga(t);return new qi(n,i)}static parseScale(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,[n=e,i=n]=ga(t);return new qi(n,i)}static parsePath(t){for(var e=ga(t),n=e.length,i=[],s=0;s<n;s+=2)i.push(new qi(e[s],e[s+1]));return i}angleTo(t){return Math.atan2(t.y-this.y,t.x-this.x)}applyTransform(t){var{x:e,y:n}=this,i=e*t[0]+n*t[2]+t[4],s=e*t[1]+n*t[3]+t[5];this.x=i,this.y=s}}class k6{constructor(t){this.screen=t,this.working=!1,this.events=[],this.eventElements=[],this.onClick=this.onClick.bind(this),this.onMouseMove=this.onMouseMove.bind(this)}isWorking(){return this.working}start(){if(!this.working){var{screen:t,onClick:e,onMouseMove:n}=this,i=t.ctx.canvas;i.onclick=e,i.onmousemove=n,this.working=!0}}stop(){if(this.working){var t=this.screen.ctx.canvas;this.working=!1,t.onclick=null,t.onmousemove=null}}hasEvents(){return this.working&&this.events.length>0}runEvents(){if(this.working){var{screen:t,events:e,eventElements:n}=this,{style:i}=t.ctx.canvas;i&&(i.cursor=""),e.forEach((s,a)=>{for(var{run:o}=s,A=n[a];A;)o(A),A=A.parent}),this.events=[],this.eventElements=[]}}checkPath(t,e){if(!(!this.working||!e)){var{events:n,eventElements:i}=this;n.forEach((s,a)=>{var{x:o,y:A}=s;!i[a]&&e.isPointInPath&&e.isPointInPath(o,A)&&(i[a]=t)})}}checkBoundingBox(t,e){if(!(!this.working||!e)){var{events:n,eventElements:i}=this;n.forEach((s,a)=>{var{x:o,y:A}=s;!i[a]&&e.isPointInBox(o,A)&&(i[a]=t)})}}mapXY(t,e){for(var{window:n,ctx:i}=this.screen,s=new qi(t,e),a=i.canvas;a;)s.x-=a.offsetLeft,s.y-=a.offsetTop,a=a.offsetParent;return n.scrollX&&(s.x+=n.scrollX),n.scrollY&&(s.y+=n.scrollY),s}onClick(t){var{x:e,y:n}=this.mapXY(t.clientX,t.clientY);this.events.push({type:"onclick",x:e,y:n,run(i){i.onClick&&i.onClick()}})}onMouseMove(t){var{x:e,y:n}=this.mapXY(t.clientX,t.clientY);this.events.push({type:"onmousemove",x:e,y:n,run(i){i.onMouseMove&&i.onMouseMove()}})}}var Q6=typeof window<"u"?window:null,H6=typeof fetch<"u"?fetch.bind(void 0):null;class Fm{constructor(t){var{fetch:e=H6,window:n=Q6}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.ctx=t,this.FRAMERATE=30,this.MAX_VIRTUAL_PIXELS=3e4,this.CLIENT_WIDTH=800,this.CLIENT_HEIGHT=600,this.viewPort=new N6,this.mouse=new k6(this),this.animations=[],this.waits=[],this.frameDuration=0,this.isReadyLock=!1,this.isFirstRender=!0,this.intervalId=null,this.window=n,this.fetch=e}wait(t){this.waits.push(t)}ready(){return this.readyPromise?this.readyPromise:Promise.resolve()}isReady(){if(this.isReadyLock)return!0;var t=this.waits.every(e=>e());return t&&(this.waits=[],this.resolveReady&&this.resolveReady()),this.isReadyLock=t,t}setDefaults(t){t.strokeStyle="rgba(0,0,0,0)",t.lineCap="butt",t.lineJoin="miter",t.miterLimit=4}setViewBox(t){var{document:e,ctx:n,aspectRatio:i,width:s,desiredWidth:a,height:o,desiredHeight:A,minX:f=0,minY:m=0,refX:_,refY:x,clip:B=!1,clipX:P=0,clipY:M=0}=t,k=fd(i).replace(/^defer\s/,""),[Q,q]=k.split(" "),J=Q||"xMidYMid",tt=q||"meet",ft=s/a,pt=o/A,mt=Math.min(ft,pt),dt=Math.max(ft,pt),Rt=a,Lt=A;tt==="meet"&&(Rt*=mt,Lt*=mt),tt==="slice"&&(Rt*=dt,Lt*=dt);var st=new Rr(e,"refX",_),ct=new Rr(e,"refY",x),wt=st.hasValue()&&ct.hasValue();if(wt&&n.translate(-mt*st.getPixels("x"),-mt*ct.getPixels("y")),B){var yt=mt*P,te=mt*M;n.beginPath(),n.moveTo(yt,te),n.lineTo(s,te),n.lineTo(s,o),n.lineTo(yt,o),n.closePath(),n.clip()}if(!wt){var Zt=tt==="meet"&&mt===pt,re=tt==="slice"&&dt===pt,Xt=tt==="meet"&&mt===ft,ne=tt==="slice"&&dt===ft;J.startsWith("xMid")&&(Zt||re)&&n.translate(s/2-Rt/2,0),J.endsWith("YMid")&&(Xt||ne)&&n.translate(0,o/2-Lt/2),J.startsWith("xMax")&&(Zt||re)&&n.translate(s-Rt,0),J.endsWith("YMax")&&(Xt||ne)&&n.translate(0,o-Lt)}switch(!0){case J==="none":n.scale(ft,pt);break;case tt==="meet":n.scale(mt,mt);break;case tt==="slice":n.scale(dt,dt);break}n.translate(-f,-m)}start(t){var{enableRedraw:e=!1,ignoreMouse:n=!1,ignoreAnimation:i=!1,ignoreDimensions:s=!1,ignoreClear:a=!1,forceRedraw:o,scaleWidth:A,scaleHeight:f,offsetX:m,offsetY:_}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{FRAMERATE:x,mouse:B}=this,P=1e3/x;if(this.frameDuration=P,this.readyPromise=new Promise(J=>{this.resolveReady=J}),this.isReady()&&this.render(t,s,a,A,f,m,_),!!e){var M=Date.now(),k=M,Q=0,q=()=>{M=Date.now(),Q=M-k,Q>=P&&(k=M-Q%P,this.shouldUpdate(i,o)&&(this.render(t,s,a,A,f,m,_),B.runEvents())),this.intervalId=dE(q)};n||B.start(),this.intervalId=dE(q)}}stop(){this.intervalId&&(dE.cancel(this.intervalId),this.intervalId=null),this.mouse.stop()}shouldUpdate(t,e){if(!t){var{frameDuration:n}=this,i=this.animations.reduce((s,a)=>a.update(n)||s,!1);if(i)return!0}return!!(typeof e=="function"&&e()||!this.isReadyLock&&this.isReady()||this.mouse.hasEvents())}render(t,e,n,i,s,a,o){var{CLIENT_WIDTH:A,CLIENT_HEIGHT:f,viewPort:m,ctx:_,isFirstRender:x}=this,B=_.canvas;m.clear(),B.width&&B.height?m.setCurrent(B.width,B.height):m.setCurrent(A,f);var P=t.getStyle("width"),M=t.getStyle("height");!e&&(x||typeof i!="number"&&typeof s!="number")&&(P.hasValue()&&(B.width=P.getPixels("x"),B.style&&(B.style.width="".concat(B.width,"px"))),M.hasValue()&&(B.height=M.getPixels("y"),B.style&&(B.style.height="".concat(B.height,"px"))));var k=B.clientWidth||B.width,Q=B.clientHeight||B.height;if(e&&P.hasValue()&&M.hasValue()&&(k=P.getPixels("x"),Q=M.getPixels("y")),m.setCurrent(k,Q),typeof a=="number"&&t.getAttribute("x",!0).setValue(a),typeof o=="number"&&t.getAttribute("y",!0).setValue(o),typeof i=="number"||typeof s=="number"){var q=ga(t.getAttribute("viewBox").getString()),J=0,tt=0;if(typeof i=="number"){var ft=t.getStyle("width");ft.hasValue()?J=ft.getPixels("x")/i:isNaN(q[2])||(J=q[2]/i)}if(typeof s=="number"){var pt=t.getStyle("height");pt.hasValue()?tt=pt.getPixels("y")/s:isNaN(q[3])||(tt=q[3]/s)}J||(J=tt),tt||(tt=J),t.getAttribute("width",!0).setValue(i),t.getAttribute("height",!0).setValue(s);var mt=t.getStyle("transform",!0,!0);mt.setValue("".concat(mt.getString()," scale(").concat(1/J,", ").concat(1/tt,")"))}n||_.clearRect(0,0,k,Q),t.render(_),x&&(this.isFirstRender=!1)}}Fm.defaultWindow=Q6,Fm.defaultFetch=H6;var{defaultFetch:dbt}=Fm,fbt=typeof DOMParser<"u"?DOMParser:null;class U_{constructor(){var{fetch:t=dbt,DOMParser:e=fbt}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.fetch=t,this.DOMParser=e}parse(t){var e=this;return $u(function*(){return t.startsWith("<")?e.parseFromString(t):e.load(t)})()}parseFromString(t){var e=new this.DOMParser;try{return this.checkDocument(e.parseFromString(t,"image/svg+xml"))}catch{return this.checkDocument(e.parseFromString(t,"text/xml"))}}checkDocument(t){var e=t.getElementsByTagName("parsererror")[0];if(e)throw new Error(e.textContent);return t}load(t){var e=this;return $u(function*(){var n=yield e.fetch(t),i=yield n.text();return e.parseFromString(i)})()}}class z6{constructor(t,e){this.type="translate",this.point=null,this.point=qi.parse(e)}apply(t){var{x:e,y:n}=this.point;t.translate(e||0,n||0)}unapply(t){var{x:e,y:n}=this.point;t.translate(-1*e||0,-1*n||0)}applyToPoint(t){var{x:e,y:n}=this.point;t.applyTransform([1,0,0,1,e||0,n||0])}}class G6{constructor(t,e,n){this.type="rotate",this.angle=null,this.originX=null,this.originY=null,this.cx=0,this.cy=0;var i=ga(e);this.angle=new Rr(t,"angle",i[0]),this.originX=n[0],this.originY=n[1],this.cx=i[1]||0,this.cy=i[2]||0}apply(t){var{cx:e,cy:n,originX:i,originY:s,angle:a}=this,o=e+i.getPixels("x"),A=n+s.getPixels("y");t.translate(o,A),t.rotate(a.getRadians()),t.translate(-o,-A)}unapply(t){var{cx:e,cy:n,originX:i,originY:s,angle:a}=this,o=e+i.getPixels("x"),A=n+s.getPixels("y");t.translate(o,A),t.rotate(-1*a.getRadians()),t.translate(-o,-A)}applyToPoint(t){var{cx:e,cy:n,angle:i}=this,s=i.getRadians();t.applyTransform([1,0,0,1,e||0,n||0]),t.applyTransform([Math.cos(s),Math.sin(s),-Math.sin(s),Math.cos(s),0,0]),t.applyTransform([1,0,0,1,-e||0,-n||0])}}class V6{constructor(t,e,n){this.type="scale",this.scale=null,this.originX=null,this.originY=null;var i=qi.parseScale(e);(i.x===0||i.y===0)&&(i.x=gd,i.y=gd),this.scale=i,this.originX=n[0],this.originY=n[1]}apply(t){var{scale:{x:e,y:n},originX:i,originY:s}=this,a=i.getPixels("x"),o=s.getPixels("y");t.translate(a,o),t.scale(e,n||e),t.translate(-a,-o)}unapply(t){var{scale:{x:e,y:n},originX:i,originY:s}=this,a=i.getPixels("x"),o=s.getPixels("y");t.translate(a,o),t.scale(1/e,1/n||e),t.translate(-a,-o)}applyToPoint(t){var{x:e,y:n}=this.scale;t.applyTransform([e||0,0,0,n||0,0,0])}}class FE{constructor(t,e,n){this.type="matrix",this.matrix=[],this.originX=null,this.originY=null,this.matrix=ga(e),this.originX=n[0],this.originY=n[1]}apply(t){var{originX:e,originY:n,matrix:i}=this,s=e.getPixels("x"),a=n.getPixels("y");t.translate(s,a),t.transform(i[0],i[1],i[2],i[3],i[4],i[5]),t.translate(-s,-a)}unapply(t){var{originX:e,originY:n,matrix:i}=this,s=i[0],a=i[2],o=i[4],A=i[1],f=i[3],m=i[5],_=0,x=0,B=1,P=1/(s*(f*B-m*x)-a*(A*B-m*_)+o*(A*x-f*_)),M=e.getPixels("x"),k=n.getPixels("y");t.translate(M,k),t.transform(P*(f*B-m*x),P*(m*_-A*B),P*(o*x-a*B),P*(s*B-o*_),P*(a*m-o*f),P*(o*A-s*m)),t.translate(-M,-k)}applyToPoint(t){t.applyTransform(this.matrix)}}class PE extends FE{constructor(t,e,n){super(t,e,n),this.type="skew",this.angle=null,this.angle=new Rr(t,"angle",e)}}class j6 extends PE{constructor(t,e,n){super(t,e,n),this.type="skewX",this.matrix=[1,0,Math.tan(this.angle.getRadians()),1,0,0]}}class q6 extends PE{constructor(t,e,n){super(t,e,n),this.type="skewY",this.matrix=[1,Math.tan(this.angle.getRadians()),0,1,0,0]}}function pbt(r){return fd(r).trim().replace(/\)([a-zA-Z])/g,") $1").replace(/\)(\s?,\s?)/g,") ").split(/\s(?=[a-z])/)}function gbt(r){var[t,e]=r.split("(");return[t.trim(),e.trim().replace(")","")]}class sh{constructor(t,e,n){this.document=t,this.transforms=[];var i=pbt(e);i.forEach(s=>{if(s!=="none"){var[a,o]=gbt(s),A=sh.transformTypes[a];typeof A<"u"&&this.transforms.push(new A(this.document,o,n))}})}static fromElement(t,e){var n=e.getStyle("transform",!1,!0),[i,s=i]=e.getStyle("transform-origin",!1,!0).split(),a=[i,s];return n.hasValue()?new sh(t,n.getString(),a):null}apply(t){for(var{transforms:e}=this,n=e.length,i=0;i<n;i++)e[i].apply(t)}unapply(t){for(var{transforms:e}=this,n=e.length,i=n-1;i>=0;i--)e[i].unapply(t)}applyToPoint(t){for(var{transforms:e}=this,n=e.length,i=0;i<n;i++)e[i].applyToPoint(t)}}sh.transformTypes={translate:z6,rotate:G6,scale:V6,matrix:FE,skewX:j6,skewY:q6};class _i{constructor(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(this.document=t,this.node=e,this.captureTextNodes=n,this.attributes={},this.styles={},this.stylesSpecificity={},this.animationFrozen=!1,this.animationFrozenValue="",this.parent=null,this.children=[],!(!e||e.nodeType!==1)){if(Array.from(e.attributes).forEach(o=>{var A=R6(o.nodeName);this.attributes[A]=new Rr(t,A,o.value)}),this.addStylesFromStyleDefinition(),this.getAttribute("style").hasValue()){var i=this.getAttribute("style").getString().split(";").map(o=>o.trim());i.forEach(o=>{if(o){var[A,f]=o.split(":").map(m=>m.trim());this.styles[A]=new Rr(t,A,f)}})}var{definitions:s}=t,a=this.getAttribute("id");a.hasValue()&&(s[a.getString()]||(s[a.getString()]=this)),Array.from(e.childNodes).forEach(o=>{if(o.nodeType===1)this.addChild(o);else if(n&&(o.nodeType===3||o.nodeType===4)){var A=t.createTextNode(o);A.getText().length>0&&this.addChild(A)}})}}getAttribute(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,n=this.attributes[t];if(!n&&e){var i=new Rr(this.document,t,"");return this.attributes[t]=i,i}return n||Rr.empty(this.document)}getHrefAttribute(){for(var t in this.attributes)if(t==="href"||t.endsWith(":href"))return this.attributes[t];return Rr.empty(this.document)}getStyle(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=this.styles[t];if(i)return i;var s=this.getAttribute(t);if(s!=null&&s.hasValue())return this.styles[t]=s,s;if(!n){var{parent:a}=this;if(a){var o=a.getStyle(t);if(o!=null&&o.hasValue())return o}}if(e){var A=new Rr(this.document,t,"");return this.styles[t]=A,A}return i||Rr.empty(this.document)}render(t){if(!(this.getStyle("display").getString()==="none"||this.getStyle("visibility").getString()==="hidden")){if(t.save(),this.getStyle("mask").hasValue()){var e=this.getStyle("mask").getDefinition();e&&(this.applyEffects(t),e.apply(t,this))}else if(this.getStyle("filter").getValue("none")!=="none"){var n=this.getStyle("filter").getDefinition();n&&(this.applyEffects(t),n.apply(t,this))}else this.setContext(t),this.renderChildren(t),this.clearContext(t);t.restore()}}setContext(t){}applyEffects(t){var e=sh.fromElement(this.document,this);e&&e.apply(t);var n=this.getStyle("clip-path",!1,!0);if(n.hasValue()){var i=n.getDefinition();i&&i.apply(t)}}clearContext(t){}renderChildren(t){this.children.forEach(e=>{e.render(t)})}addChild(t){var e=t instanceof _i?t:this.document.createElement(t);e.parent=this,_i.ignoreChildTypes.includes(e.type)||this.children.push(e)}matchesSelector(t){var e,{node:n}=this;if(typeof n.matches=="function")return n.matches(t);var i=(e=n.getAttribute)===null||e===void 0?void 0:e.call(n,"class");return!i||i===""?!1:i.split(" ").some(s=>".".concat(s)===t)}addStylesFromStyleDefinition(){var{styles:t,stylesSpecificity:e}=this.document;for(var n in t)if(!n.startsWith("@")&&this.matchesSelector(n)){var i=t[n],s=e[n];if(i)for(var a in i){var o=this.stylesSpecificity[a];typeof o>"u"&&(o="000"),s>=o&&(this.styles[a]=i[a],this.stylesSpecificity[a]=s)}}}removeStyles(t,e){var n=e.reduce((i,s)=>{var a=t.getStyle(s);if(!a.hasValue())return i;var o=a.getString();return a.setValue(""),[...i,[s,o]]},[]);return n}restoreStyles(t,e){e.forEach(n=>{var[i,s]=n;t.getStyle(i,!0).setValue(s)})}isFirstChild(){var t;return((t=this.parent)===null||t===void 0?void 0:t.children.indexOf(this))===0}}_i.ignoreChildTypes=["title"];class K6 extends _i{constructor(t,e,n){super(t,e,n)}}function mbt(r){var t=r.trim();return/^('|")/.test(t)?t:'"'.concat(t,'"')}function ybt(r){return typeof process>"u"?r:r.trim().split(",").map(mbt).join(",")}function _bt(r){if(!r)return"";var t=r.trim().toLowerCase();switch(t){case"normal":case"italic":case"oblique":case"inherit":case"initial":case"unset":return t;default:return/^oblique\s+(-|)\d+deg$/.test(t)?t:""}}function vbt(r){if(!r)return"";var t=r.trim().toLowerCase();switch(t){case"normal":case"bold":case"lighter":case"bolder":case"inherit":case"initial":case"unset":return t;default:return/^[\d.]+$/.test(t)?t:""}}class bo{constructor(t,e,n,i,s,a){var o=a?typeof a=="string"?bo.parse(a):a:{};this.fontFamily=s||o.fontFamily,this.fontSize=i||o.fontSize,this.fontStyle=t||o.fontStyle,this.fontWeight=n||o.fontWeight,this.fontVariant=e||o.fontVariant}static parse(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",e=arguments.length>1?arguments[1]:void 0,n="",i="",s="",a="",o="",A=fd(t).trim().split(" "),f={fontSize:!1,fontStyle:!1,fontWeight:!1,fontVariant:!1};return A.forEach(m=>{switch(!0){case(!f.fontStyle&&bo.styles.includes(m)):m!=="inherit"&&(n=m),f.fontStyle=!0;break;case(!f.fontVariant&&bo.variants.includes(m)):m!=="inherit"&&(i=m),f.fontStyle=!0,f.fontVariant=!0;break;case(!f.fontWeight&&bo.weights.includes(m)):m!=="inherit"&&(s=m),f.fontStyle=!0,f.fontVariant=!0,f.fontWeight=!0;break;case!f.fontSize:m!=="inherit"&&([a]=m.split("/")),f.fontStyle=!0,f.fontVariant=!0,f.fontWeight=!0,f.fontSize=!0;break;default:m!=="inherit"&&(o+=m)}}),new bo(n,i,s,a,o,e)}toString(){return[_bt(this.fontStyle),this.fontVariant,vbt(this.fontWeight),this.fontSize,ybt(this.fontFamily)].join(" ").trim()}}bo.styles="normal|italic|oblique|inherit",bo.variants="normal|small-caps|inherit",bo.weights="normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit";class gc{constructor(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Number.NaN,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Number.NaN,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Number.NaN,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:Number.NaN;this.x1=t,this.y1=e,this.x2=n,this.y2=i,this.addPoint(t,e),this.addPoint(n,i)}get x(){return this.x1}get y(){return this.y1}get width(){return this.x2-this.x1}get height(){return this.y2-this.y1}addPoint(t,e){typeof t<"u"&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=t,this.x2=t),t<this.x1&&(this.x1=t),t>this.x2&&(this.x2=t)),typeof e<"u"&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=e,this.y2=e),e<this.y1&&(this.y1=e),e>this.y2&&(this.y2=e))}addX(t){this.addPoint(t,null)}addY(t){this.addPoint(null,t)}addBoundingBox(t){if(t){var{x1:e,y1:n,x2:i,y2:s}=t;this.addPoint(e,n),this.addPoint(i,s)}}sumCubic(t,e,n,i,s){return Math.pow(1-t,3)*e+3*Math.pow(1-t,2)*t*n+3*(1-t)*Math.pow(t,2)*i+Math.pow(t,3)*s}bezierCurveAdd(t,e,n,i,s){var a=6*e-12*n+6*i,o=-3*e+9*n-9*i+3*s,A=3*n-3*e;if(o===0){if(a===0)return;var f=-A/a;0<f&&f<1&&(t?this.addX(this.sumCubic(f,e,n,i,s)):this.addY(this.sumCubic(f,e,n,i,s)));return}var m=Math.pow(a,2)-4*A*o;if(!(m<0)){var _=(-a+Math.sqrt(m))/(2*o);0<_&&_<1&&(t?this.addX(this.sumCubic(_,e,n,i,s)):this.addY(this.sumCubic(_,e,n,i,s)));var x=(-a-Math.sqrt(m))/(2*o);0<x&&x<1&&(t?this.addX(this.sumCubic(x,e,n,i,s)):this.addY(this.sumCubic(x,e,n,i,s)))}}addBezierCurve(t,e,n,i,s,a,o,A){this.addPoint(t,e),this.addPoint(o,A),this.bezierCurveAdd(!0,t,n,s,o),this.bezierCurveAdd(!1,e,i,a,A)}addQuadraticCurve(t,e,n,i,s,a){var o=t+.6666666666666666*(n-t),A=e+2/3*(i-e),f=o+1/3*(s-t),m=A+1/3*(a-e);this.addBezierCurve(t,e,o,f,A,m,s,a)}isPointInBox(t,e){var{x1:n,y1:i,x2:s,y2:a}=this;return n<=t&&t<=s&&i<=e&&e<=a}}class rn extends Ue{constructor(t){super(t.replace(/([+\-.])\s+/gm,"$1").replace(/[^MmZzLlHhVvCcSsQqTtAae\d\s.,+-].*/g,"")),this.control=null,this.start=null,this.current=null,this.command=null,this.commands=this.commands,this.i=-1,this.previousCommand=null,this.points=[],this.angles=[]}reset(){this.i=-1,this.command=null,this.previousCommand=null,this.start=new qi(0,0),this.control=new qi(0,0),this.current=new qi(0,0),this.points=[],this.angles=[]}isEnd(){var{i:t,commands:e}=this;return t>=e.length-1}next(){var t=this.commands[++this.i];return this.previousCommand=this.command,this.command=t,t}getPoint(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"x",e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"y",n=new qi(this.command[t],this.command[e]);return this.makeAbsolute(n)}getAsControlPoint(t,e){var n=this.getPoint(t,e);return this.control=n,n}getAsCurrentPoint(t,e){var n=this.getPoint(t,e);return this.current=n,n}getReflectedControlPoint(){var t=this.previousCommand.type;if(t!==Ue.CURVE_TO&&t!==Ue.SMOOTH_CURVE_TO&&t!==Ue.QUAD_TO&&t!==Ue.SMOOTH_QUAD_TO)return this.current;var{current:{x:e,y:n},control:{x:i,y:s}}=this,a=new qi(2*e-i,2*n-s);return a}makeAbsolute(t){if(this.command.relative){var{x:e,y:n}=this.current;t.x+=e,t.y+=n}return t}addMarker(t,e,n){var{points:i,angles:s}=this;n&&s.length>0&&!s[s.length-1]&&(s[s.length-1]=i[i.length-1].angleTo(n)),this.addMarkerAngle(t,e?e.angleTo(t):null)}addMarkerAngle(t,e){this.points.push(t),this.angles.push(e)}getMarkerPoints(){return this.points}getMarkerAngles(){for(var{angles:t}=this,e=t.length,n=0;n<e;n++)if(!t[n]){for(var i=n+1;i<e;i++)if(t[i]){t[n]=t[i];break}}return t}}class oh extends _i{constructor(){super(...arguments),this.modifiedEmSizeStack=!1}calculateOpacity(){for(var t=1,e=this;e;){var n=e.getStyle("opacity",!1,!0);n.hasValue(!0)&&(t*=n.getNumber()),e=e.parent}return t}setContext(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!e){var n=this.getStyle("fill"),i=this.getStyle("fill-opacity"),s=this.getStyle("stroke"),a=this.getStyle("stroke-opacity");if(n.isUrlDefinition()){var o=n.getFillStyleDefinition(this,i);o&&(t.fillStyle=o)}else if(n.hasValue()){n.getString()==="currentColor"&&n.setValue(this.getStyle("color").getColor());var A=n.getColor();A!=="inherit"&&(t.fillStyle=A==="none"?"rgba(0,0,0,0)":A)}if(i.hasValue()){var f=new Rr(this.document,"fill",t.fillStyle).addOpacity(i).getColor();t.fillStyle=f}if(s.isUrlDefinition()){var m=s.getFillStyleDefinition(this,a);m&&(t.strokeStyle=m)}else if(s.hasValue()){s.getString()==="currentColor"&&s.setValue(this.getStyle("color").getColor());var _=s.getString();_!=="inherit"&&(t.strokeStyle=_==="none"?"rgba(0,0,0,0)":_)}if(a.hasValue()){var x=new Rr(this.document,"stroke",t.strokeStyle).addOpacity(a).getString();t.strokeStyle=x}var B=this.getStyle("stroke-width");if(B.hasValue()){var P=B.getPixels();t.lineWidth=P||gd}var M=this.getStyle("stroke-linecap"),k=this.getStyle("stroke-linejoin"),Q=this.getStyle("stroke-miterlimit"),q=this.getStyle("stroke-dasharray"),J=this.getStyle("stroke-dashoffset");if(M.hasValue()&&(t.lineCap=M.getString()),k.hasValue()&&(t.lineJoin=k.getString()),Q.hasValue()&&(t.miterLimit=Q.getNumber()),q.hasValue()&&q.getString()!=="none"){var tt=ga(q.getString());typeof t.setLineDash<"u"?t.setLineDash(tt):typeof t.webkitLineDash<"u"?t.webkitLineDash=tt:typeof t.mozDash<"u"&&!(tt.length===1&&tt[0]===0)&&(t.mozDash=tt);var ft=J.getPixels();typeof t.lineDashOffset<"u"?t.lineDashOffset=ft:typeof t.webkitLineDashOffset<"u"?t.webkitLineDashOffset=ft:typeof t.mozDashOffset<"u"&&(t.mozDashOffset=ft)}}if(this.modifiedEmSizeStack=!1,typeof t.font<"u"){var pt=this.getStyle("font"),mt=this.getStyle("font-style"),dt=this.getStyle("font-variant"),Rt=this.getStyle("font-weight"),Lt=this.getStyle("font-size"),st=this.getStyle("font-family"),ct=new bo(mt.getString(),dt.getString(),Rt.getString(),Lt.hasValue()?"".concat(Lt.getPixels(!0),"px"):"",st.getString(),bo.parse(pt.getString(),t.font));mt.setValue(ct.fontStyle),dt.setValue(ct.fontVariant),Rt.setValue(ct.fontWeight),Lt.setValue(ct.fontSize),st.setValue(ct.fontFamily),t.font=ct.toString(),Lt.isPixels()&&(this.document.emSize=Lt.getPixels(),this.modifiedEmSizeStack=!0)}e||(this.applyEffects(t),t.globalAlpha=this.calculateOpacity())}clearContext(t){super.clearContext(t),this.modifiedEmSizeStack&&this.document.popEmSize()}}class $n extends oh{constructor(t,e,n){super(t,e,n),this.type="path",this.pathParser=null,this.pathParser=new rn(this.getAttribute("d").getString())}path(t){var{pathParser:e}=this,n=new gc;for(e.reset(),t&&t.beginPath();!e.isEnd();)switch(e.next().type){case rn.MOVE_TO:this.pathM(t,n);break;case rn.LINE_TO:this.pathL(t,n);break;case rn.HORIZ_LINE_TO:this.pathH(t,n);break;case rn.VERT_LINE_TO:this.pathV(t,n);break;case rn.CURVE_TO:this.pathC(t,n);break;case rn.SMOOTH_CURVE_TO:this.pathS(t,n);break;case rn.QUAD_TO:this.pathQ(t,n);break;case rn.SMOOTH_QUAD_TO:this.pathT(t,n);break;case rn.ARC:this.pathA(t,n);break;case rn.CLOSE_PATH:this.pathZ(t,n);break}return n}getBoundingBox(t){return this.path()}getMarkers(){var{pathParser:t}=this,e=t.getMarkerPoints(),n=t.getMarkerAngles(),i=e.map((s,a)=>[s,n[a]]);return i}renderChildren(t){this.path(t),this.document.screen.mouse.checkPath(this,t);var e=this.getStyle("fill-rule");t.fillStyle!==""&&(e.getString("inherit")!=="inherit"?t.fill(e.getString()):t.fill()),t.strokeStyle!==""&&(this.getAttribute("vector-effect").getString()==="non-scaling-stroke"?(t.save(),t.setTransform(1,0,0,1,0,0),t.stroke(),t.restore()):t.stroke());var n=this.getMarkers();if(n){var i=n.length-1,s=this.getStyle("marker-start"),a=this.getStyle("marker-mid"),o=this.getStyle("marker-end");if(s.isUrlDefinition()){var A=s.getDefinition(),[f,m]=n[0];A.render(t,f,m)}if(a.isUrlDefinition())for(var _=a.getDefinition(),x=1;x<i;x++){var[B,P]=n[x];_.render(t,B,P)}if(o.isUrlDefinition()){var M=o.getDefinition(),[k,Q]=n[i];M.render(t,k,Q)}}}static pathM(t){var e=t.getAsCurrentPoint();return t.start=t.current,{point:e}}pathM(t,e){var{pathParser:n}=this,{point:i}=$n.pathM(n),{x:s,y:a}=i;n.addMarker(i),e.addPoint(s,a),t&&t.moveTo(s,a)}static pathL(t){var{current:e}=t,n=t.getAsCurrentPoint();return{current:e,point:n}}pathL(t,e){var{pathParser:n}=this,{current:i,point:s}=$n.pathL(n),{x:a,y:o}=s;n.addMarker(s,i),e.addPoint(a,o),t&&t.lineTo(a,o)}static pathH(t){var{current:e,command:n}=t,i=new qi((n.relative?e.x:0)+n.x,e.y);return t.current=i,{current:e,point:i}}pathH(t,e){var{pathParser:n}=this,{current:i,point:s}=$n.pathH(n),{x:a,y:o}=s;n.addMarker(s,i),e.addPoint(a,o),t&&t.lineTo(a,o)}static pathV(t){var{current:e,command:n}=t,i=new qi(e.x,(n.relative?e.y:0)+n.y);return t.current=i,{current:e,point:i}}pathV(t,e){var{pathParser:n}=this,{current:i,point:s}=$n.pathV(n),{x:a,y:o}=s;n.addMarker(s,i),e.addPoint(a,o),t&&t.lineTo(a,o)}static pathC(t){var{current:e}=t,n=t.getPoint("x1","y1"),i=t.getAsControlPoint("x2","y2"),s=t.getAsCurrentPoint();return{current:e,point:n,controlPoint:i,currentPoint:s}}pathC(t,e){var{pathParser:n}=this,{current:i,point:s,controlPoint:a,currentPoint:o}=$n.pathC(n);n.addMarker(o,a,s),e.addBezierCurve(i.x,i.y,s.x,s.y,a.x,a.y,o.x,o.y),t&&t.bezierCurveTo(s.x,s.y,a.x,a.y,o.x,o.y)}static pathS(t){var{current:e}=t,n=t.getReflectedControlPoint(),i=t.getAsControlPoint("x2","y2"),s=t.getAsCurrentPoint();return{current:e,point:n,controlPoint:i,currentPoint:s}}pathS(t,e){var{pathParser:n}=this,{current:i,point:s,controlPoint:a,currentPoint:o}=$n.pathS(n);n.addMarker(o,a,s),e.addBezierCurve(i.x,i.y,s.x,s.y,a.x,a.y,o.x,o.y),t&&t.bezierCurveTo(s.x,s.y,a.x,a.y,o.x,o.y)}static pathQ(t){var{current:e}=t,n=t.getAsControlPoint("x1","y1"),i=t.getAsCurrentPoint();return{current:e,controlPoint:n,currentPoint:i}}pathQ(t,e){var{pathParser:n}=this,{current:i,controlPoint:s,currentPoint:a}=$n.pathQ(n);n.addMarker(a,s,s),e.addQuadraticCurve(i.x,i.y,s.x,s.y,a.x,a.y),t&&t.quadraticCurveTo(s.x,s.y,a.x,a.y)}static pathT(t){var{current:e}=t,n=t.getReflectedControlPoint();t.control=n;var i=t.getAsCurrentPoint();return{current:e,controlPoint:n,currentPoint:i}}pathT(t,e){var{pathParser:n}=this,{current:i,controlPoint:s,currentPoint:a}=$n.pathT(n);n.addMarker(a,s,s),e.addQuadraticCurve(i.x,i.y,s.x,s.y,a.x,a.y),t&&t.quadraticCurveTo(s.x,s.y,a.x,a.y)}static pathA(t){var{current:e,command:n}=t,{rX:i,rY:s,xRot:a,lArcFlag:o,sweepFlag:A}=n,f=a*(Math.PI/180),m=t.getAsCurrentPoint(),_=new qi(Math.cos(f)*(e.x-m.x)/2+Math.sin(f)*(e.y-m.y)/2,-Math.sin(f)*(e.x-m.x)/2+Math.cos(f)*(e.y-m.y)/2),x=Math.pow(_.x,2)/Math.pow(i,2)+Math.pow(_.y,2)/Math.pow(s,2);x>1&&(i*=Math.sqrt(x),s*=Math.sqrt(x));var B=(o===A?-1:1)*Math.sqrt((Math.pow(i,2)*Math.pow(s,2)-Math.pow(i,2)*Math.pow(_.y,2)-Math.pow(s,2)*Math.pow(_.x,2))/(Math.pow(i,2)*Math.pow(_.y,2)+Math.pow(s,2)*Math.pow(_.x,2)));isNaN(B)&&(B=0);var P=new qi(B*i*_.y/s,B*-s*_.x/i),M=new qi((e.x+m.x)/2+Math.cos(f)*P.x-Math.sin(f)*P.y,(e.y+m.y)/2+Math.sin(f)*P.x+Math.cos(f)*P.y),k=xE([1,0],[(_.x-P.x)/i,(_.y-P.y)/s]),Q=[(_.x-P.x)/i,(_.y-P.y)/s],q=[(-_.x-P.x)/i,(-_.y-P.y)/s],J=xE(Q,q);return M_(Q,q)<=-1&&(J=Math.PI),M_(Q,q)>=1&&(J=0),{currentPoint:m,rX:i,rY:s,sweepFlag:A,xAxisRotation:f,centp:M,a1:k,ad:J}}pathA(t,e){var{pathParser:n}=this,{currentPoint:i,rX:s,rY:a,sweepFlag:o,xAxisRotation:A,centp:f,a1:m,ad:_}=$n.pathA(n),x=1-o?1:-1,B=m+x*(_/2),P=new qi(f.x+s*Math.cos(B),f.y+a*Math.sin(B));if(n.addMarkerAngle(P,B-x*Math.PI/2),n.addMarkerAngle(i,B-x*Math.PI),e.addPoint(i.x,i.y),t&&!isNaN(m)&&!isNaN(_)){var M=s>a?s:a,k=s>a?1:s/a,Q=s>a?a/s:1;t.translate(f.x,f.y),t.rotate(A),t.scale(k,Q),t.arc(0,0,M,m,m+_,!!(1-o)),t.scale(1/k,1/Q),t.rotate(-A),t.translate(-f.x,-f.y)}}static pathZ(t){t.current=t.start}pathZ(t,e){$n.pathZ(this.pathParser),t&&e.x1!==e.x2&&e.y1!==e.y2&&t.closePath()}}class ME extends $n{constructor(t,e,n){super(t,e,n),this.type="glyph",this.horizAdvX=this.getAttribute("horiz-adv-x").getNumber(),this.unicode=this.getAttribute("unicode").getString(),this.arabicForm=this.getAttribute("arabic-form").getString()}}class Ju extends oh{constructor(t,e,n){super(t,e,new.target===Ju?!0:n),this.type="text",this.x=0,this.y=0,this.measureCache=-1}setContext(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;super.setContext(t,e);var n=this.getStyle("dominant-baseline").getTextBaseline()||this.getStyle("alignment-baseline").getTextBaseline();n&&(t.textBaseline=n)}initializeCoordinates(){this.x=0,this.y=0,this.leafTexts=[],this.textChunkStart=0,this.minX=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY}getBoundingBox(t){if(this.type!=="text")return this.getTElementBoundingBox(t);this.initializeCoordinates(),this.adjustChildCoordinatesRecursive(t);var e=null;return this.children.forEach((n,i)=>{var s=this.getChildBoundingBox(t,this,this,i);e?e.addBoundingBox(s):e=s}),e}getFontSize(){var{document:t,parent:e}=this,n=bo.parse(t.ctx.font).fontSize,i=e.getStyle("font-size").getNumber(n);return i}getTElementBoundingBox(t){var e=this.getFontSize();return new gc(this.x,this.y-e,this.x+this.measureText(t),this.y)}getGlyph(t,e,n){var i=e[n],s=null;if(t.isArabic){var a=e.length,o=e[n-1],A=e[n+1],f="isolated";if((n===0||o===" ")&&n<a-1&&A!==" "&&(f="terminal"),n>0&&o!==" "&&n<a-1&&A!==" "&&(f="medial"),n>0&&o!==" "&&(n===a-1||A===" ")&&(f="initial"),typeof t.glyphs[i]<"u"){var m=t.glyphs[i];s=m instanceof ME?m:m[f]}}else s=t.glyphs[i];return s||(s=t.missingGlyph),s}getText(){return""}getTextFromNode(t){var e=t||this.node,n=Array.from(e.parentNode.childNodes),i=n.indexOf(e),s=n.length-1,a=fd(e.textContent||"");return i===0&&(a=M6(a)),i===s&&(a=U6(a)),a}renderChildren(t){if(this.type!=="text"){this.renderTElementChildren(t);return}this.initializeCoordinates(),this.adjustChildCoordinatesRecursive(t),this.children.forEach((n,i)=>{this.renderChild(t,this,this,i)});var{mouse:e}=this.document.screen;e.isWorking()&&e.checkBoundingBox(this,this.getBoundingBox(t))}renderTElementChildren(t){var{document:e,parent:n}=this,i=this.getText(),s=n.getStyle("font-family").getDefinition();if(s){for(var{unitsPerEm:a}=s.fontFace,o=bo.parse(e.ctx.font),A=n.getStyle("font-size").getNumber(o.fontSize),f=n.getStyle("font-style").getString(o.fontStyle),m=A/a,_=s.isRTL?i.split("").reverse().join(""):i,x=ga(n.getAttribute("dx").getString()),B=_.length,P=0;P<B;P++){var M=this.getGlyph(s,_,P);t.translate(this.x,this.y),t.scale(m,-m);var k=t.lineWidth;t.lineWidth=t.lineWidth*a/A,f==="italic"&&t.transform(1,0,.4,1,0,0),M.render(t),f==="italic"&&t.transform(1,0,-.4,1,0,0),t.lineWidth=k,t.scale(1/m,-1/m),t.translate(-this.x,-this.y),this.x+=A*(M.horizAdvX||s.horizAdvX)/a,typeof x[P]<"u"&&!isNaN(x[P])&&(this.x+=x[P])}return}var{x:Q,y:q}=this;t.fillStyle&&t.fillText(i,Q,q),t.strokeStyle&&t.strokeText(i,Q,q)}applyAnchoring(){if(!(this.textChunkStart>=this.leafTexts.length)){var t=this.leafTexts[this.textChunkStart],e=t.getStyle("text-anchor").getString("start"),n=!1,i=0;e==="start"&&!n||e==="end"&&n?i=t.x-this.minX:e==="end"&&!n||e==="start"&&n?i=t.x-this.maxX:i=t.x-(this.minX+this.maxX)/2;for(var s=this.textChunkStart;s<this.leafTexts.length;s++)this.leafTexts[s].x+=i;this.minX=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.textChunkStart=this.leafTexts.length}}adjustChildCoordinatesRecursive(t){this.children.forEach((e,n)=>{this.adjustChildCoordinatesRecursiveCore(t,this,this,n)}),this.applyAnchoring()}adjustChildCoordinatesRecursiveCore(t,e,n,i){var s=n.children[i];s.children.length>0?s.children.forEach((a,o)=>{e.adjustChildCoordinatesRecursiveCore(t,e,s,o)}):this.adjustChildCoordinates(t,e,n,i)}adjustChildCoordinates(t,e,n,i){var s=n.children[i];if(typeof s.measureText!="function")return s;t.save(),s.setContext(t,!0);var a=s.getAttribute("x"),o=s.getAttribute("y"),A=s.getAttribute("dx"),f=s.getAttribute("dy"),m=s.getStyle("font-family").getDefinition(),_=!!m&&m.isRTL;i===0&&(a.hasValue()||a.setValue(s.getInheritedAttribute("x")),o.hasValue()||o.setValue(s.getInheritedAttribute("y")),A.hasValue()||A.setValue(s.getInheritedAttribute("dx")),f.hasValue()||f.setValue(s.getInheritedAttribute("dy")));var x=s.measureText(t);return _&&(e.x-=x),a.hasValue()?(e.applyAnchoring(),s.x=a.getPixels("x"),A.hasValue()&&(s.x+=A.getPixels("x"))):(A.hasValue()&&(e.x+=A.getPixels("x")),s.x=e.x),e.x=s.x,_||(e.x+=x),o.hasValue()?(s.y=o.getPixels("y"),f.hasValue()&&(s.y+=f.getPixels("y"))):(f.hasValue()&&(e.y+=f.getPixels("y")),s.y=e.y),e.y=s.y,e.leafTexts.push(s),e.minX=Math.min(e.minX,s.x,s.x+x),e.maxX=Math.max(e.maxX,s.x,s.x+x),s.clearContext(t),t.restore(),s}getChildBoundingBox(t,e,n,i){var s=n.children[i];if(typeof s.getBoundingBox!="function")return null;var a=s.getBoundingBox(t);return a?(s.children.forEach((o,A)=>{var f=e.getChildBoundingBox(t,e,s,A);a.addBoundingBox(f)}),a):null}renderChild(t,e,n,i){var s=n.children[i];s.render(t),s.children.forEach((a,o)=>{e.renderChild(t,e,s,o)})}measureText(t){var{measureCache:e}=this;if(~e)return e;var n=this.getText(),i=this.measureTargetText(t,n);return this.measureCache=i,i}measureTargetText(t,e){if(!e.length)return 0;var{parent:n}=this,i=n.getStyle("font-family").getDefinition();if(i){for(var s=this.getFontSize(),a=i.isRTL?e.split("").reverse().join(""):e,o=ga(n.getAttribute("dx").getString()),A=a.length,f=0,m=0;m<A;m++){var _=this.getGlyph(i,a,m);f+=(_.horizAdvX||i.horizAdvX)*s/i.fontFace.unitsPerEm,typeof o[m]<"u"&&!isNaN(o[m])&&(f+=o[m])}return f}if(!t.measureText)return e.length*10;t.save(),this.setContext(t,!0);var{width:x}=t.measureText(e);return this.clearContext(t),t.restore(),x}getInheritedAttribute(t){for(var e=this;e instanceof Ju&&e.isFirstChild();){var n=e.parent.getAttribute(t);if(n.hasValue(!0))return n.getValue("0");e=e.parent}return null}}class Pm extends Ju{constructor(t,e,n){super(t,e,new.target===Pm?!0:n),this.type="tspan",this.text=this.children.length>0?"":this.getTextFromNode()}getText(){return this.text}}class bbt extends Pm{constructor(){super(...arguments),this.type="textNode"}}class dp extends oh{constructor(){super(...arguments),this.type="svg",this.root=!1}setContext(t){var e,{document:n}=this,{screen:i,window:s}=n,a=t.canvas;if(i.setDefaults(t),a.style&&typeof t.font<"u"&&s&&typeof s.getComputedStyle<"u"){t.font=s.getComputedStyle(a).getPropertyValue("font");var o=new Rr(n,"fontSize",bo.parse(t.font).fontSize);o.hasValue()&&(n.rootEmSize=o.getPixels("y"),n.emSize=n.rootEmSize)}this.getAttribute("x").hasValue()||this.getAttribute("x",!0).setValue(0),this.getAttribute("y").hasValue()||this.getAttribute("y",!0).setValue(0);var{width:A,height:f}=i.viewPort;this.getStyle("width").hasValue()||this.getStyle("width",!0).setValue("100%"),this.getStyle("height").hasValue()||this.getStyle("height",!0).setValue("100%"),this.getStyle("color").hasValue()||this.getStyle("color",!0).setValue("black");var m=this.getAttribute("refX"),_=this.getAttribute("refY"),x=this.getAttribute("viewBox"),B=x.hasValue()?ga(x.getString()):null,P=!this.root&&this.getStyle("overflow").getValue("hidden")!=="visible",M=0,k=0,Q=0,q=0;B&&(M=B[0],k=B[1]),this.root||(A=this.getStyle("width").getPixels("x"),f=this.getStyle("height").getPixels("y"),this.type==="marker"&&(Q=M,q=k,M=0,k=0)),i.viewPort.setCurrent(A,f),this.node&&(!this.parent||((e=this.node.parentNode)===null||e===void 0?void 0:e.nodeName)==="foreignObject")&&this.getStyle("transform",!1,!0).hasValue()&&!this.getStyle("transform-origin",!1,!0).hasValue()&&this.getStyle("transform-origin",!0,!0).setValue("50% 50%"),super.setContext(t),t.translate(this.getAttribute("x").getPixels("x"),this.getAttribute("y").getPixels("y")),B&&(A=B[2],f=B[3]),n.setViewBox({ctx:t,aspectRatio:this.getAttribute("preserveAspectRatio").getString(),width:i.viewPort.width,desiredWidth:A,height:i.viewPort.height,desiredHeight:f,minX:M,minY:k,refX:m.getValue(),refY:_.getValue(),clip:P,clipX:Q,clipY:q}),B&&(i.viewPort.removeCurrent(),i.viewPort.setCurrent(A,f))}clearContext(t){super.clearContext(t),this.document.screen.viewPort.removeCurrent()}resize(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=this.getAttribute("width",!0),s=this.getAttribute("height",!0),a=this.getAttribute("viewBox"),o=this.getAttribute("style"),A=i.getNumber(0),f=s.getNumber(0);if(n)if(typeof n=="string")this.getAttribute("preserveAspectRatio",!0).setValue(n);else{var m=this.getAttribute("preserveAspectRatio");m.hasValue()&&m.setValue(m.getString().replace(/^\s*(\S.*\S)\s*$/,"$1"))}if(i.setValue(t),s.setValue(e),a.hasValue()||a.setValue("0 0 ".concat(A||t," ").concat(f||e)),o.hasValue()){var _=this.getStyle("width"),x=this.getStyle("height");_.hasValue()&&_.setValue("".concat(t,"px")),x.hasValue()&&x.setValue("".concat(e,"px"))}}}class UE extends $n{constructor(){super(...arguments),this.type="rect"}path(t){var e=this.getAttribute("x").getPixels("x"),n=this.getAttribute("y").getPixels("y"),i=this.getStyle("width",!1,!0).getPixels("x"),s=this.getStyle("height",!1,!0).getPixels("y"),a=this.getAttribute("rx"),o=this.getAttribute("ry"),A=a.getPixels("x"),f=o.getPixels("y");if(a.hasValue()&&!o.hasValue()&&(f=A),o.hasValue()&&!a.hasValue()&&(A=f),A=Math.min(A,i/2),f=Math.min(f,s/2),t){var m=4*((Math.sqrt(2)-1)/3);t.beginPath(),s>0&&i>0&&(t.moveTo(e+A,n),t.lineTo(e+i-A,n),t.bezierCurveTo(e+i-A+m*A,n,e+i,n+f-m*f,e+i,n+f),t.lineTo(e+i,n+s-f),t.bezierCurveTo(e+i,n+s-f+m*f,e+i-A+m*A,n+s,e+i-A,n+s),t.lineTo(e+A,n+s),t.bezierCurveTo(e+A-m*A,n+s,e,n+s-f+m*f,e,n+s-f),t.lineTo(e,n+f),t.bezierCurveTo(e,n+f-m*f,e+A-m*A,n,e+A,n),t.closePath())}return new gc(e,n,e+i,n+s)}getMarkers(){return null}}class $6 extends $n{constructor(){super(...arguments),this.type="circle"}path(t){var e=this.getAttribute("cx").getPixels("x"),n=this.getAttribute("cy").getPixels("y"),i=this.getAttribute("r").getPixels();return t&&i>0&&(t.beginPath(),t.arc(e,n,i,0,Math.PI*2,!1),t.closePath()),new gc(e-i,n-i,e+i,n+i)}getMarkers(){return null}}class W6 extends $n{constructor(){super(...arguments),this.type="ellipse"}path(t){var e=4*((Math.sqrt(2)-1)/3),n=this.getAttribute("rx").getPixels("x"),i=this.getAttribute("ry").getPixels("y"),s=this.getAttribute("cx").getPixels("x"),a=this.getAttribute("cy").getPixels("y");return t&&n>0&&i>0&&(t.beginPath(),t.moveTo(s+n,a),t.bezierCurveTo(s+n,a+e*i,s+e*n,a+i,s,a+i),t.bezierCurveTo(s-e*n,a+i,s-n,a+e*i,s-n,a),t.bezierCurveTo(s-n,a-e*i,s-e*n,a-i,s,a-i),t.bezierCurveTo(s+e*n,a-i,s+n,a-e*i,s+n,a),t.closePath()),new gc(s-n,a-i,s+n,a+i)}getMarkers(){return null}}class X6 extends $n{constructor(){super(...arguments),this.type="line"}getPoints(){return[new qi(this.getAttribute("x1").getPixels("x"),this.getAttribute("y1").getPixels("y")),new qi(this.getAttribute("x2").getPixels("x"),this.getAttribute("y2").getPixels("y"))]}path(t){var[{x:e,y:n},{x:i,y:s}]=this.getPoints();return t&&(t.beginPath(),t.moveTo(e,n),t.lineTo(i,s)),new gc(e,n,i,s)}getMarkers(){var[t,e]=this.getPoints(),n=t.angleTo(e);return[[t,n],[e,n]]}}class RE extends $n{constructor(t,e,n){super(t,e,n),this.type="polyline",this.points=[],this.points=qi.parsePath(this.getAttribute("points").getString())}path(t){var{points:e}=this,[{x:n,y:i}]=e,s=new gc(n,i);return t&&(t.beginPath(),t.moveTo(n,i)),e.forEach(a=>{var{x:o,y:A}=a;s.addPoint(o,A),t&&t.lineTo(o,A)}),s}getMarkers(){var{points:t}=this,e=t.length-1,n=[];return t.forEach((i,s)=>{s!==e&&n.push([i,i.angleTo(t[s+1])])}),n.length>0&&n.push([t[t.length-1],n[n.length-1][1]]),n}}class J6 extends RE{constructor(){super(...arguments),this.type="polygon"}path(t){var e=super.path(t),[{x:n,y:i}]=this.points;return t&&(t.lineTo(n,i),t.closePath()),e}}class Y6 extends _i{constructor(){super(...arguments),this.type="pattern"}createPattern(t,e,n){var i=this.getStyle("width").getPixels("x",!0),s=this.getStyle("height").getPixels("y",!0),a=new dp(this.document,null);a.attributes.viewBox=new Rr(this.document,"viewBox",this.getAttribute("viewBox").getValue()),a.attributes.width=new Rr(this.document,"width","".concat(i,"px")),a.attributes.height=new Rr(this.document,"height","".concat(s,"px")),a.attributes.transform=new Rr(this.document,"transform",this.getAttribute("patternTransform").getValue()),a.children=this.children;var o=this.document.createCanvas(i,s),A=o.getContext("2d"),f=this.getAttribute("x"),m=this.getAttribute("y");f.hasValue()&&m.hasValue()&&A.translate(f.getPixels("x",!0),m.getPixels("y",!0)),n.hasValue()?this.styles["fill-opacity"]=n:Reflect.deleteProperty(this.styles,"fill-opacity");for(var _=-1;_<=1;_++)for(var x=-1;x<=1;x++)A.save(),a.attributes.x=new Rr(this.document,"x",_*o.width),a.attributes.y=new Rr(this.document,"y",x*o.height),a.render(A),A.restore();var B=t.createPattern(o,"repeat");return B}}class Z6 extends _i{constructor(){super(...arguments),this.type="marker"}render(t,e,n){if(e){var{x:i,y:s}=e,a=this.getAttribute("orient").getString("auto"),o=this.getAttribute("markerUnits").getString("strokeWidth");t.translate(i,s),a==="auto"&&t.rotate(n),o==="strokeWidth"&&t.scale(t.lineWidth,t.lineWidth),t.save();var A=new dp(this.document,null);A.type=this.type,A.attributes.viewBox=new Rr(this.document,"viewBox",this.getAttribute("viewBox").getValue()),A.attributes.refX=new Rr(this.document,"refX",this.getAttribute("refX").getValue()),A.attributes.refY=new Rr(this.document,"refY",this.getAttribute("refY").getValue()),A.attributes.width=new Rr(this.document,"width",this.getAttribute("markerWidth").getValue()),A.attributes.height=new Rr(this.document,"height",this.getAttribute("markerHeight").getValue()),A.attributes.overflow=new Rr(this.document,"overflow",this.getAttribute("overflow").getValue()),A.attributes.fill=new Rr(this.document,"fill",this.getAttribute("fill").getColor("black")),A.attributes.stroke=new Rr(this.document,"stroke",this.getAttribute("stroke").getValue("none")),A.children=this.children,A.render(t),t.restore(),o==="strokeWidth"&&t.scale(1/t.lineWidth,1/t.lineWidth),a==="auto"&&t.rotate(-n),t.translate(-i,-s)}}}class tN extends _i{constructor(){super(...arguments),this.type="defs"}render(){}}class R_ extends oh{constructor(){super(...arguments),this.type="g"}getBoundingBox(t){var e=new gc;return this.children.forEach(n=>{e.addBoundingBox(n.getBoundingBox(t))}),e}}class OE extends _i{constructor(t,e,n){super(t,e,n),this.attributesToInherit=["gradientUnits"],this.stops=[];var{stops:i,children:s}=this;s.forEach(a=>{a.type==="stop"&&i.push(a)})}getGradientUnits(){return this.getAttribute("gradientUnits").getString("objectBoundingBox")}createGradient(t,e,n){var i=this;this.getHrefAttribute().hasValue()&&(i=this.getHrefAttribute().getDefinition(),this.inheritStopContainer(i));var{stops:s}=i,a=this.getGradient(t,e);if(!a)return this.addParentOpacity(n,s[s.length-1].color);if(s.forEach(k=>{a.addColorStop(k.offset,this.addParentOpacity(n,k.color))}),this.getAttribute("gradientTransform").hasValue()){var{document:o}=this,{MAX_VIRTUAL_PIXELS:A,viewPort:f}=o.screen,[m]=f.viewPorts,_=new UE(o,null);_.attributes.x=new Rr(o,"x",-A/3),_.attributes.y=new Rr(o,"y",-A/3),_.attributes.width=new Rr(o,"width",A),_.attributes.height=new Rr(o,"height",A);var x=new R_(o,null);x.attributes.transform=new Rr(o,"transform",this.getAttribute("gradientTransform").getValue()),x.children=[_];var B=new dp(o,null);B.attributes.x=new Rr(o,"x",0),B.attributes.y=new Rr(o,"y",0),B.attributes.width=new Rr(o,"width",m.width),B.attributes.height=new Rr(o,"height",m.height),B.children=[x];var P=o.createCanvas(m.width,m.height),M=P.getContext("2d");return M.fillStyle=a,B.render(M),M.createPattern(P,"no-repeat")}return a}inheritStopContainer(t){this.attributesToInherit.forEach(e=>{!this.getAttribute(e).hasValue()&&t.getAttribute(e).hasValue()&&this.getAttribute(e,!0).setValue(t.getAttribute(e).getValue())})}addParentOpacity(t,e){if(t.hasValue()){var n=new Rr(this.document,"color",e);return n.addOpacity(t).getColor()}return e}}class eN extends OE{constructor(t,e,n){super(t,e,n),this.type="linearGradient",this.attributesToInherit.push("x1","y1","x2","y2")}getGradient(t,e){var n=this.getGradientUnits()==="objectBoundingBox",i=n?e.getBoundingBox(t):null;if(n&&!i)return null;!this.getAttribute("x1").hasValue()&&!this.getAttribute("y1").hasValue()&&!this.getAttribute("x2").hasValue()&&!this.getAttribute("y2").hasValue()&&(this.getAttribute("x1",!0).setValue(0),this.getAttribute("y1",!0).setValue(0),this.getAttribute("x2",!0).setValue(1),this.getAttribute("y2",!0).setValue(0));var s=n?i.x+i.width*this.getAttribute("x1").getNumber():this.getAttribute("x1").getPixels("x"),a=n?i.y+i.height*this.getAttribute("y1").getNumber():this.getAttribute("y1").getPixels("y"),o=n?i.x+i.width*this.getAttribute("x2").getNumber():this.getAttribute("x2").getPixels("x"),A=n?i.y+i.height*this.getAttribute("y2").getNumber():this.getAttribute("y2").getPixels("y");return s===o&&a===A?null:t.createLinearGradient(s,a,o,A)}}class rN extends OE{constructor(t,e,n){super(t,e,n),this.type="radialGradient",this.attributesToInherit.push("cx","cy","r","fx","fy","fr")}getGradient(t,e){var n=this.getGradientUnits()==="objectBoundingBox",i=e.getBoundingBox(t);if(n&&!i)return null;this.getAttribute("cx").hasValue()||this.getAttribute("cx",!0).setValue("50%"),this.getAttribute("cy").hasValue()||this.getAttribute("cy",!0).setValue("50%"),this.getAttribute("r").hasValue()||this.getAttribute("r",!0).setValue("50%");var s=n?i.x+i.width*this.getAttribute("cx").getNumber():this.getAttribute("cx").getPixels("x"),a=n?i.y+i.height*this.getAttribute("cy").getNumber():this.getAttribute("cy").getPixels("y"),o=s,A=a;this.getAttribute("fx").hasValue()&&(o=n?i.x+i.width*this.getAttribute("fx").getNumber():this.getAttribute("fx").getPixels("x")),this.getAttribute("fy").hasValue()&&(A=n?i.y+i.height*this.getAttribute("fy").getNumber():this.getAttribute("fy").getPixels("y"));var f=n?(i.width+i.height)/2*this.getAttribute("r").getNumber():this.getAttribute("r").getPixels(),m=this.getAttribute("fr").getPixels();return t.createRadialGradient(o,A,m,s,a,f)}}class nN extends _i{constructor(t,e,n){super(t,e,n),this.type="stop";var i=Math.max(0,Math.min(1,this.getAttribute("offset").getNumber())),s=this.getStyle("stop-opacity"),a=this.getStyle("stop-color",!0);a.getString()===""&&a.setValue("#000"),s.hasValue()&&(a=a.addOpacity(s)),this.offset=i,this.color=a.getColor()}}class O_ extends _i{constructor(t,e,n){super(t,e,n),this.type="animate",this.duration=0,this.initialValue=null,this.initialUnits="",this.removed=!1,this.frozen=!1,t.screen.animations.push(this),this.begin=this.getAttribute("begin").getMilliseconds(),this.maxDuration=this.begin+this.getAttribute("dur").getMilliseconds(),this.from=this.getAttribute("from"),this.to=this.getAttribute("to"),this.values=new Rr(t,"values",null);var i=this.getAttribute("values");i.hasValue()&&this.values.setValue(i.getString().split(";"))}getProperty(){var t=this.getAttribute("attributeType").getString(),e=this.getAttribute("attributeName").getString();return t==="CSS"?this.parent.getStyle(e,!0):this.parent.getAttribute(e,!0)}calcValue(){var{initialUnits:t}=this,{progress:e,from:n,to:i}=this.getProgress(),s=n.getNumber()+(i.getNumber()-n.getNumber())*e;return t==="%"&&(s*=100),"".concat(s).concat(t)}update(t){var{parent:e}=this,n=this.getProperty();if(this.initialValue||(this.initialValue=n.getString(),this.initialUnits=n.getUnits()),this.duration>this.maxDuration){var i=this.getAttribute("fill").getString("remove");if(this.getAttribute("repeatCount").getString()==="indefinite"||this.getAttribute("repeatDur").getString()==="indefinite")this.duration=0;else if(i==="freeze"&&!this.frozen)this.frozen=!0,e.animationFrozen=!0,e.animationFrozenValue=n.getString();else if(i==="remove"&&!this.removed)return this.removed=!0,n.setValue(e.animationFrozen?e.animationFrozenValue:this.initialValue),!0;return!1}this.duration+=t;var s=!1;if(this.begin<this.duration){var a=this.calcValue(),o=this.getAttribute("type");if(o.hasValue()){var A=o.getString();a="".concat(A,"(").concat(a,")")}n.setValue(a),s=!0}return s}getProgress(){var{document:t,values:e}=this,n={progress:(this.duration-this.begin)/(this.maxDuration-this.begin)};if(e.hasValue()){var i=n.progress*(e.getValue().length-1),s=Math.floor(i),a=Math.ceil(i);n.from=new Rr(t,"from",parseFloat(e.getValue()[s])),n.to=new Rr(t,"to",parseFloat(e.getValue()[a])),n.progress=(i-s)/(a-s)}else n.from=this.from,n.to=this.to;return n}}class iN extends O_{constructor(){super(...arguments),this.type="animateColor"}calcValue(){var{progress:t,from:e,to:n}=this.getProgress(),i=new gE(e.getColor()),s=new gE(n.getColor());if(i.ok&&s.ok){var a=i.r+(s.r-i.r)*t,o=i.g+(s.g-i.g)*t,A=i.b+(s.b-i.b)*t;return"rgb(".concat(Math.floor(a),", ").concat(Math.floor(o),", ").concat(Math.floor(A),")")}return this.getAttribute("from").getColor()}}class sN extends O_{constructor(){super(...arguments),this.type="animateTransform"}calcValue(){var{progress:t,from:e,to:n}=this.getProgress(),i=ga(e.getString()),s=ga(n.getString()),a=i.map((o,A)=>{var f=s[A];return o+(f-o)*t}).join(" ");return a}}class oN extends _i{constructor(t,e,n){super(t,e,n),this.type="font",this.glyphs={},this.horizAdvX=this.getAttribute("horiz-adv-x").getNumber();var{definitions:i}=t,{children:s}=this;for(var a of s)switch(a.type){case"font-face":{this.fontFace=a;var o=a.getStyle("font-family");o.hasValue()&&(i[o.getString()]=this);break}case"missing-glyph":this.missingGlyph=a;break;case"glyph":{var A=a;A.arabicForm?(this.isRTL=!0,this.isArabic=!0,typeof this.glyphs[A.unicode]>"u"&&(this.glyphs[A.unicode]={}),this.glyphs[A.unicode][A.arabicForm]=A):this.glyphs[A.unicode]=A;break}}}render(){}}class aN extends _i{constructor(t,e,n){super(t,e,n),this.type="font-face",this.ascent=this.getAttribute("ascent").getNumber(),this.descent=this.getAttribute("descent").getNumber(),this.unitsPerEm=this.getAttribute("units-per-em").getNumber()}}class cN extends $n{constructor(){super(...arguments),this.type="missing-glyph",this.horizAdvX=0}}class lN extends Ju{constructor(){super(...arguments),this.type="tref"}getText(){var t=this.getHrefAttribute().getDefinition();if(t){var e=t.children[0];if(e)return e.getText()}return""}}class uN extends Ju{constructor(t,e,n){super(t,e,n),this.type="a";var{childNodes:i}=e,s=i[0],a=i.length>0&&Array.from(i).every(o=>o.nodeType===3);this.hasText=a,this.text=a?this.getTextFromNode(s):""}getText(){return this.text}renderChildren(t){if(this.hasText){super.renderChildren(t);var{document:e,x:n,y:i}=this,{mouse:s}=e.screen,a=new Rr(e,"fontSize",bo.parse(e.ctx.font).fontSize);s.isWorking()&&s.checkBoundingBox(this,new gc(n,i-a.getPixels("y"),n+this.measureText(t),i))}else if(this.children.length>0){var o=new R_(this.document,null);o.children=this.children,o.parent=this,o.render(t)}}onClick(){var{window:t}=this.document;t&&t.open(this.getHrefAttribute().getString())}onMouseMove(){var t=this.document.ctx;t.canvas.style.cursor="pointer"}}function AN(r,t){var e=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),e.push.apply(e,n)}return e}function D_(r){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?AN(Object(e),!0).forEach(function(n){cE(r,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(e)):AN(Object(e)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(e,n))})}return r}class hN extends Ju{constructor(t,e,n){super(t,e,n),this.type="textPath",this.textWidth=0,this.textHeight=0,this.pathLength=-1,this.glyphInfo=null,this.letterSpacingCache=[],this.measuresCache=new Map([["",0]]);var i=this.getHrefAttribute().getDefinition();this.text=this.getTextFromNode(),this.dataArray=this.parsePathData(i)}getText(){return this.text}path(t){var{dataArray:e}=this;t&&t.beginPath(),e.forEach(n=>{var{type:i,points:s}=n;switch(i){case rn.LINE_TO:t&&t.lineTo(s[0],s[1]);break;case rn.MOVE_TO:t&&t.moveTo(s[0],s[1]);break;case rn.CURVE_TO:t&&t.bezierCurveTo(s[0],s[1],s[2],s[3],s[4],s[5]);break;case rn.QUAD_TO:t&&t.quadraticCurveTo(s[0],s[1],s[2],s[3]);break;case rn.ARC:{var[a,o,A,f,m,_,x,B]=s,P=A>f?A:f,M=A>f?1:A/f,k=A>f?f/A:1;t&&(t.translate(a,o),t.rotate(x),t.scale(M,k),t.arc(0,0,P,m,m+_,!!(1-B)),t.scale(1/M,1/k),t.rotate(-x),t.translate(-a,-o));break}case rn.CLOSE_PATH:t&&t.closePath();break}})}renderChildren(t){this.setTextData(t),t.save();var e=this.parent.getStyle("text-decoration").getString(),n=this.getFontSize(),{glyphInfo:i}=this,s=t.fillStyle;e==="underline"&&t.beginPath(),i.forEach((a,o)=>{var{p0:A,p1:f,rotation:m,text:_}=a;t.save(),t.translate(A.x,A.y),t.rotate(m),t.fillStyle&&t.fillText(_,0,0),t.strokeStyle&&t.strokeText(_,0,0),t.restore(),e==="underline"&&(o===0&&t.moveTo(A.x,A.y+n/8),t.lineTo(f.x,f.y+n/5))}),e==="underline"&&(t.lineWidth=n/20,t.strokeStyle=s,t.stroke(),t.closePath()),t.restore()}getLetterSpacingAt(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.letterSpacingCache[t]||0}findSegmentToFitChar(t,e,n,i,s,a,o,A,f){var m=a,_=this.measureText(t,A);A===" "&&e==="justify"&&n<i&&(_+=(i-n)/s),f>-1&&(m+=this.getLetterSpacingAt(f));var x=this.textHeight/20,B=this.getEquidistantPointOnPath(m,x,0),P=this.getEquidistantPointOnPath(m+_,x,0),M={p0:B,p1:P},k=B&&P?Math.atan2(P.y-B.y,P.x-B.x):0;if(o){var Q=Math.cos(Math.PI/2+k)*o,q=Math.cos(-k)*o;M.p0=D_(D_({},B),{},{x:B.x+Q,y:B.y+q}),M.p1=D_(D_({},P),{},{x:P.x+Q,y:P.y+q})}return m+=_,{offset:m,segment:M,rotation:k}}measureText(t,e){var{measuresCache:n}=this,i=e||this.getText();if(n.has(i))return n.get(i);var s=this.measureTargetText(t,i);return n.set(i,s),s}setTextData(t){if(!this.glyphInfo){var e=this.getText(),n=e.split(""),i=e.split(" ").length-1,s=this.parent.getAttribute("dx").split().map(tt=>tt.getPixels("x")),a=this.parent.getAttribute("dy").getPixels("y"),o=this.parent.getStyle("text-anchor").getString("start"),A=this.getStyle("letter-spacing"),f=this.parent.getStyle("letter-spacing"),m=0;!A.hasValue()||A.getValue()==="inherit"?m=f.getPixels():A.hasValue()&&A.getValue()!=="initial"&&A.getValue()!=="unset"&&(m=A.getPixels());var _=[],x=e.length;this.letterSpacingCache=_;for(var B=0;B<x;B++)_.push(typeof s[B]<"u"?s[B]:m);var P=_.reduce((tt,ft,pt)=>pt===0?0:tt+ft||0,0),M=this.measureText(t),k=Math.max(M+P,0);this.textWidth=M,this.textHeight=this.getFontSize(),this.glyphInfo=[];var Q=this.getPathLength(),q=this.getStyle("startOffset").getNumber(0)*Q,J=0;(o==="middle"||o==="center")&&(J=-k/2),(o==="end"||o==="right")&&(J=-k),J+=q,n.forEach((tt,ft)=>{var{offset:pt,segment:mt,rotation:dt}=this.findSegmentToFitChar(t,o,k,Q,i,J,a,tt,ft);J=pt,!(!mt.p0||!mt.p1)&&this.glyphInfo.push({text:n[ft],p0:mt.p0,p1:mt.p1,rotation:dt})})}}parsePathData(t){if(this.pathLength=-1,!t)return[];var e=[],{pathParser:n}=t;for(n.reset();!n.isEnd();){var{current:i}=n,s=i?i.x:0,a=i?i.y:0,o=n.next(),A=o.type,f=[];switch(o.type){case rn.MOVE_TO:this.pathM(n,f);break;case rn.LINE_TO:A=this.pathL(n,f);break;case rn.HORIZ_LINE_TO:A=this.pathH(n,f);break;case rn.VERT_LINE_TO:A=this.pathV(n,f);break;case rn.CURVE_TO:this.pathC(n,f);break;case rn.SMOOTH_CURVE_TO:A=this.pathS(n,f);break;case rn.QUAD_TO:this.pathQ(n,f);break;case rn.SMOOTH_QUAD_TO:A=this.pathT(n,f);break;case rn.ARC:f=this.pathA(n);break;case rn.CLOSE_PATH:$n.pathZ(n);break}o.type!==rn.CLOSE_PATH?e.push({type:A,points:f,start:{x:s,y:a},pathLength:this.calcLength(s,a,A,f)}):e.push({type:rn.CLOSE_PATH,points:[],pathLength:0})}return e}pathM(t,e){var{x:n,y:i}=$n.pathM(t).point;e.push(n,i)}pathL(t,e){var{x:n,y:i}=$n.pathL(t).point;return e.push(n,i),rn.LINE_TO}pathH(t,e){var{x:n,y:i}=$n.pathH(t).point;return e.push(n,i),rn.LINE_TO}pathV(t,e){var{x:n,y:i}=$n.pathV(t).point;return e.push(n,i),rn.LINE_TO}pathC(t,e){var{point:n,controlPoint:i,currentPoint:s}=$n.pathC(t);e.push(n.x,n.y,i.x,i.y,s.x,s.y)}pathS(t,e){var{point:n,controlPoint:i,currentPoint:s}=$n.pathS(t);return e.push(n.x,n.y,i.x,i.y,s.x,s.y),rn.CURVE_TO}pathQ(t,e){var{controlPoint:n,currentPoint:i}=$n.pathQ(t);e.push(n.x,n.y,i.x,i.y)}pathT(t,e){var{controlPoint:n,currentPoint:i}=$n.pathT(t);return e.push(n.x,n.y,i.x,i.y),rn.QUAD_TO}pathA(t){var{rX:e,rY:n,sweepFlag:i,xAxisRotation:s,centp:a,a1:o,ad:A}=$n.pathA(t);return i===0&&A>0&&(A-=2*Math.PI),i===1&&A<0&&(A+=2*Math.PI),[a.x,a.y,e,n,o,A,s,i]}calcLength(t,e,n,i){var s=0,a=null,o=null,A=0;switch(n){case rn.LINE_TO:return this.getLineLength(t,e,i[0],i[1]);case rn.CURVE_TO:for(s=0,a=this.getPointOnCubicBezier(0,t,e,i[0],i[1],i[2],i[3],i[4],i[5]),A=.01;A<=1;A+=.01)o=this.getPointOnCubicBezier(A,t,e,i[0],i[1],i[2],i[3],i[4],i[5]),s+=this.getLineLength(a.x,a.y,o.x,o.y),a=o;return s;case rn.QUAD_TO:for(s=0,a=this.getPointOnQuadraticBezier(0,t,e,i[0],i[1],i[2],i[3]),A=.01;A<=1;A+=.01)o=this.getPointOnQuadraticBezier(A,t,e,i[0],i[1],i[2],i[3]),s+=this.getLineLength(a.x,a.y,o.x,o.y),a=o;return s;case rn.ARC:{s=0;var f=i[4],m=i[5],_=i[4]+m,x=Math.PI/180;if(Math.abs(f-_)<x&&(x=Math.abs(f-_)),a=this.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],f,0),m<0)for(A=f-x;A>_;A-=x)o=this.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],A,0),s+=this.getLineLength(a.x,a.y,o.x,o.y),a=o;else for(A=f+x;A<_;A+=x)o=this.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],A,0),s+=this.getLineLength(a.x,a.y,o.x,o.y),a=o;return o=this.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],_,0),s+=this.getLineLength(a.x,a.y,o.x,o.y),s}}return 0}getPointOnLine(t,e,n,i,s){var a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:e,o=arguments.length>6&&arguments[6]!==void 0?arguments[6]:n,A=(s-n)/(i-e+gd),f=Math.sqrt(t*t/(1+A*A));i<e&&(f*=-1);var m=A*f,_=null;if(i===e)_={x:a,y:o+m};else if((o-n)/(a-e+gd)===A)_={x:a+f,y:o+m};else{var x=0,B=0,P=this.getLineLength(e,n,i,s);if(P<gd)return null;var M=(a-e)*(i-e)+(o-n)*(s-n);M/=P*P,x=e+M*(i-e),B=n+M*(s-n);var k=this.getLineLength(a,o,x,B),Q=Math.sqrt(t*t-k*k);f=Math.sqrt(Q*Q/(1+A*A)),i<e&&(f*=-1),m=A*f,_={x:x+f,y:B+m}}return _}getPointOnPath(t){var e=this.getPathLength(),n=0,i=null;if(t<-5e-5||t-5e-5>e)return null;var{dataArray:s}=this;for(var a of s){if(a&&(a.pathLength<5e-5||n+a.pathLength+5e-5<t)){n+=a.pathLength;continue}var o=t-n,A=0;switch(a.type){case rn.LINE_TO:i=this.getPointOnLine(o,a.start.x,a.start.y,a.points[0],a.points[1],a.start.x,a.start.y);break;case rn.ARC:{var f=a.points[4],m=a.points[5],_=a.points[4]+m;if(A=f+o/a.pathLength*m,m<0&&A<_||m>=0&&A>_)break;i=this.getPointOnEllipticalArc(a.points[0],a.points[1],a.points[2],a.points[3],A,a.points[6]);break}case rn.CURVE_TO:A=o/a.pathLength,A>1&&(A=1),i=this.getPointOnCubicBezier(A,a.start.x,a.start.y,a.points[0],a.points[1],a.points[2],a.points[3],a.points[4],a.points[5]);break;case rn.QUAD_TO:A=o/a.pathLength,A>1&&(A=1),i=this.getPointOnQuadraticBezier(A,a.start.x,a.start.y,a.points[0],a.points[1],a.points[2],a.points[3]);break}if(i)return i;break}return null}getLineLength(t,e,n,i){return Math.sqrt((n-t)*(n-t)+(i-e)*(i-e))}getPathLength(){return this.pathLength===-1&&(this.pathLength=this.dataArray.reduce((t,e)=>e.pathLength>0?t+e.pathLength:t,0)),this.pathLength}getPointOnCubicBezier(t,e,n,i,s,a,o,A,f){var m=A*BE(t)+a*CE(t)+i*EE(t)+e*SE(t),_=f*BE(t)+o*CE(t)+s*EE(t)+n*SE(t);return{x:m,y:_}}getPointOnQuadraticBezier(t,e,n,i,s,a,o){var A=a*TE(t)+i*IE(t)+e*LE(t),f=o*TE(t)+s*IE(t)+n*LE(t);return{x:A,y:f}}getPointOnEllipticalArc(t,e,n,i,s,a){var o=Math.cos(a),A=Math.sin(a),f={x:n*Math.cos(s),y:i*Math.sin(s)};return{x:t+(f.x*o-f.y*A),y:e+(f.x*A+f.y*o)}}buildEquidistantCache(t,e){var n=this.getPathLength(),i=e||.25,s=t||n/100;if(!this.equidistantCache||this.equidistantCache.step!==s||this.equidistantCache.precision!==i){this.equidistantCache={step:s,precision:i,points:[]};for(var a=0,o=0;o<=n;o+=i){var A=this.getPointOnPath(o),f=this.getPointOnPath(o+i);!A||!f||(a+=this.getLineLength(A.x,A.y,f.x,f.y),a>=s&&(this.equidistantCache.points.push({x:A.x,y:A.y,distance:o}),a-=s))}}}getEquidistantPointOnPath(t,e,n){if(this.buildEquidistantCache(e,n),t<0||t-this.getPathLength()>5e-5)return null;var i=Math.round(t/this.getPathLength()*(this.equidistantCache.points.length-1));return this.equidistantCache.points[i]||null}}var wbt=/^\s*data:(([^/,;]+\/[^/,;]+)(?:;([^,;=]+=[^,;=]+))?)?(?:;(base64))?,(.*)$/i;class dN extends oh{constructor(t,e,n){super(t,e,n),this.type="image",this.loaded=!1;var i=this.getHrefAttribute().getString();if(i){var s=i.endsWith(".svg")||/^\s*data:image\/svg\+xml/i.test(i);t.images.push(this),s?this.loadSvg(i):this.loadImage(i),this.isSvg=s}}loadImage(t){var e=this;return $u(function*(){try{var n=yield e.document.createImage(t);e.image=n}catch(i){console.error('Error while loading image "'.concat(t,'":'),i)}e.loaded=!0})()}loadSvg(t){var e=this;return $u(function*(){var n=wbt.exec(t);if(n){var i=n[5];n[4]==="base64"?e.image=atob(i):e.image=decodeURIComponent(i)}else try{var s=yield e.document.fetch(t),a=yield s.text();e.image=a}catch(o){console.error('Error while loading image "'.concat(t,'":'),o)}e.loaded=!0})()}renderChildren(t){var{document:e,image:n,loaded:i}=this,s=this.getAttribute("x").getPixels("x"),a=this.getAttribute("y").getPixels("y"),o=this.getStyle("width").getPixels("x"),A=this.getStyle("height").getPixels("y");if(!(!i||!n||!o||!A)){if(t.save(),t.translate(s,a),this.isSvg){var f=e.canvg.forkString(t,this.image,{ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0,ignoreClear:!0,offsetX:0,offsetY:0,scaleWidth:o,scaleHeight:A});f.document.documentElement.parent=this,f.render()}else{var m=this.image;e.setViewBox({ctx:t,aspectRatio:this.getAttribute("preserveAspectRatio").getString(),width:o,desiredWidth:m.width,height:A,desiredHeight:m.height}),this.loaded&&(typeof m.complete>"u"||m.complete)&&t.drawImage(m,0,0)}t.restore()}}getBoundingBox(){var t=this.getAttribute("x").getPixels("x"),e=this.getAttribute("y").getPixels("y"),n=this.getStyle("width").getPixels("x"),i=this.getStyle("height").getPixels("y");return new gc(t,e,t+n,e+i)}}class fN extends oh{constructor(){super(...arguments),this.type="symbol"}render(t){}}class pN{constructor(t){this.document=t,this.loaded=!1,t.fonts.push(this)}load(t,e){var n=this;return $u(function*(){try{var{document:i}=n,s=yield i.canvg.parser.load(e),a=s.getElementsByTagName("font");Array.from(a).forEach(o=>{var A=i.createElement(o);i.definitions[t]=A})}catch(o){console.error('Error while loading font "'.concat(e,'":'),o)}n.loaded=!0})()}}class DE extends _i{constructor(t,e,n){super(t,e,n),this.type="style";var i=fd(Array.from(e.childNodes).map(a=>a.textContent).join("").replace(/(\/\*([^*]|[\r\n]|(\*+([^*/]|[\r\n])))*\*+\/)|(^[\s]*\/\/.*)/gm,"").replace(/@import.*;/g,"")),s=i.split("}");s.forEach(a=>{var o=a.trim();if(o){var A=o.split("{"),f=A[0].split(","),m=A[1].split(";");f.forEach(_=>{var x=_.trim();if(x){var B=t.styles[x]||{};if(m.forEach(k=>{var Q=k.indexOf(":"),q=k.substr(0,Q).trim(),J=k.substr(Q+1,k.length-Q).trim();q&&J&&(B[q]=new Rr(t,q,J))}),t.styles[x]=B,t.stylesSpecificity[x]=D6(x),x==="@font-face"){var P=B["font-family"].getString().replace(/"|'/g,""),M=B.src.getString().split(",");M.forEach(k=>{if(k.indexOf('format("svg")')>0){var Q=bE(k);Q&&new pN(t).load(P,Q)}})}}})}})}}DE.parseExternalUrl=bE;class gN extends oh{constructor(){super(...arguments),this.type="use"}setContext(t){super.setContext(t);var e=this.getAttribute("x"),n=this.getAttribute("y");e.hasValue()&&t.translate(e.getPixels("x"),0),n.hasValue()&&t.translate(0,n.getPixels("y"))}path(t){var{element:e}=this;e&&e.path(t)}renderChildren(t){var{document:e,element:n}=this;if(n){var i=n;if(n.type==="symbol"&&(i=new dp(e,null),i.attributes.viewBox=new Rr(e,"viewBox",n.getAttribute("viewBox").getString()),i.attributes.preserveAspectRatio=new Rr(e,"preserveAspectRatio",n.getAttribute("preserveAspectRatio").getString()),i.attributes.overflow=new Rr(e,"overflow",n.getAttribute("overflow").getString()),i.children=n.children,n.styles.opacity=new Rr(e,"opacity",this.calculateOpacity())),i.type==="svg"){var s=this.getStyle("width",!1,!0),a=this.getStyle("height",!1,!0);s.hasValue()&&(i.attributes.width=new Rr(e,"width",s.getString())),a.hasValue()&&(i.attributes.height=new Rr(e,"height",a.getString()))}var o=i.parent;i.parent=this,i.render(t),i.parent=o}}getBoundingBox(t){var{element:e}=this;return e?e.getBoundingBox(t):null}elementTransform(){var{document:t,element:e}=this;return sh.fromElement(t,e)}get element(){return this.cachedElement||(this.cachedElement=this.getHrefAttribute().getDefinition()),this.cachedElement}}function N_(r,t,e,n,i,s){return r[e*n*4+t*4+s]}function k_(r,t,e,n,i,s,a){r[e*n*4+t*4+s]=a}function bs(r,t,e){var n=r[t];return n*e}function Yu(r,t,e,n){return t+Math.cos(r)*e+Math.sin(r)*n}class NE extends _i{constructor(t,e,n){super(t,e,n),this.type="feColorMatrix";var i=ga(this.getAttribute("values").getString());switch(this.getAttribute("type").getString("matrix")){case"saturate":{var s=i[0];i=[.213+.787*s,.715-.715*s,.072-.072*s,0,0,.213-.213*s,.715+.285*s,.072-.072*s,0,0,.213-.213*s,.715-.715*s,.072+.928*s,0,0,0,0,0,1,0,0,0,0,0,1];break}case"hueRotate":{var a=i[0]*Math.PI/180;i=[Yu(a,.213,.787,-.213),Yu(a,.715,-.715,-.715),Yu(a,.072,-.072,.928),0,0,Yu(a,.213,-.213,.143),Yu(a,.715,.285,.14),Yu(a,.072,-.072,-.283),0,0,Yu(a,.213,-.213,-.787),Yu(a,.715,-.715,.715),Yu(a,.072,.928,.072),0,0,0,0,0,1,0,0,0,0,0,1];break}case"luminanceToAlpha":i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.2125,.7154,.0721,0,0,0,0,0,0,1];break}this.matrix=i,this.includeOpacity=this.getAttribute("includeOpacity").hasValue()}apply(t,e,n,i,s){for(var{includeOpacity:a,matrix:o}=this,A=t.getImageData(0,0,i,s),f=0;f<s;f++)for(var m=0;m<i;m++){var _=N_(A.data,m,f,i,s,0),x=N_(A.data,m,f,i,s,1),B=N_(A.data,m,f,i,s,2),P=N_(A.data,m,f,i,s,3),M=bs(o,0,_)+bs(o,1,x)+bs(o,2,B)+bs(o,3,P)+bs(o,4,1),k=bs(o,5,_)+bs(o,6,x)+bs(o,7,B)+bs(o,8,P)+bs(o,9,1),Q=bs(o,10,_)+bs(o,11,x)+bs(o,12,B)+bs(o,13,P)+bs(o,14,1),q=bs(o,15,_)+bs(o,16,x)+bs(o,17,B)+bs(o,18,P)+bs(o,19,1);a&&(M=0,k=0,Q=0,q*=P/255),k_(A.data,m,f,i,s,0,M),k_(A.data,m,f,i,s,1,k),k_(A.data,m,f,i,s,2,Q),k_(A.data,m,f,i,s,3,q)}t.clearRect(0,0,i,s),t.putImageData(A,0,0)}}class Mm extends _i{constructor(){super(...arguments),this.type="mask"}apply(t,e){var{document:n}=this,i=this.getAttribute("x").getPixels("x"),s=this.getAttribute("y").getPixels("y"),a=this.getStyle("width").getPixels("x"),o=this.getStyle("height").getPixels("y");if(!a&&!o){var A=new gc;this.children.forEach(P=>{A.addBoundingBox(P.getBoundingBox(t))}),i=Math.floor(A.x1),s=Math.floor(A.y1),a=Math.floor(A.width),o=Math.floor(A.height)}var f=this.removeStyles(e,Mm.ignoreStyles),m=n.createCanvas(i+a,s+o),_=m.getContext("2d");n.screen.setDefaults(_),this.renderChildren(_),new NE(n,{nodeType:1,childNodes:[],attributes:[{nodeName:"type",value:"luminanceToAlpha"},{nodeName:"includeOpacity",value:"true"}]}).apply(_,0,0,i+a,s+o);var x=n.createCanvas(i+a,s+o),B=x.getContext("2d");n.screen.setDefaults(B),e.render(B),B.globalCompositeOperation="destination-in",B.fillStyle=_.createPattern(m,"no-repeat"),B.fillRect(0,0,i+a,s+o),t.fillStyle=B.createPattern(x,"no-repeat"),t.fillRect(0,0,i+a,s+o),this.restoreStyles(e,f)}render(t){}}Mm.ignoreStyles=["mask","transform","clip-path"];var mN=()=>{};class yN extends _i{constructor(){super(...arguments),this.type="clipPath"}apply(t){var{document:e}=this,n=Reflect.getPrototypeOf(t),{beginPath:i,closePath:s}=t;n&&(n.beginPath=mN,n.closePath=mN),Reflect.apply(i,t,[]),this.children.forEach(a=>{if(!(typeof a.path>"u")){var o=typeof a.elementTransform<"u"?a.elementTransform():null;o||(o=sh.fromElement(e,a)),o&&o.apply(t),a.path(t),n&&(n.closePath=s),o&&o.unapply(t)}}),Reflect.apply(s,t,[]),t.clip(),n&&(n.beginPath=i,n.closePath=s)}render(t){}}class Um extends _i{constructor(){super(...arguments),this.type="filter"}apply(t,e){var{document:n,children:i}=this,s=e.getBoundingBox(t);if(s){var a=0,o=0;i.forEach(Q=>{var q=Q.extraFilterDistance||0;a=Math.max(a,q),o=Math.max(o,q)});var A=Math.floor(s.width),f=Math.floor(s.height),m=A+2*a,_=f+2*o;if(!(m<1||_<1)){var x=Math.floor(s.x),B=Math.floor(s.y),P=this.removeStyles(e,Um.ignoreStyles),M=n.createCanvas(m,_),k=M.getContext("2d");n.screen.setDefaults(k),k.translate(-x+a,-B+o),e.render(k),i.forEach(Q=>{typeof Q.apply=="function"&&Q.apply(k,0,0,m,_)}),t.drawImage(M,0,0,m,_,x-a,B-o,m,_),this.restoreStyles(e,P)}}}render(t){}}Um.ignoreStyles=["filter","transform","clip-path"];class _N extends _i{constructor(t,e,n){super(t,e,n),this.type="feDropShadow",this.addStylesFromStyleDefinition()}apply(t,e,n,i,s){}}class vN extends _i{constructor(){super(...arguments),this.type="feMorphology"}apply(t,e,n,i,s){}}class bN extends _i{constructor(){super(...arguments),this.type="feComposite"}apply(t,e,n,i,s){}}class wN extends _i{constructor(t,e,n){super(t,e,n),this.type="feGaussianBlur",this.blurRadius=Math.floor(this.getAttribute("stdDeviation").getNumber()),this.extraFilterDistance=this.blurRadius}apply(t,e,n,i,s){var{document:a,blurRadius:o}=this,A=a.window?a.window.document.body:null,f=t.canvas;f.id=a.getUniqueId(),A&&(f.style.display="none",A.appendChild(f)),tbt(f,e,n,i,s,o),A&&A.removeChild(f)}}class xN extends _i{constructor(){super(...arguments),this.type="title"}}class BN extends _i{constructor(){super(...arguments),this.type="desc"}}var xbt={svg:dp,rect:UE,circle:$6,ellipse:W6,line:X6,polyline:RE,polygon:J6,path:$n,pattern:Y6,marker:Z6,defs:tN,linearGradient:eN,radialGradient:rN,stop:nN,animate:O_,animateColor:iN,animateTransform:sN,font:oN,"font-face":aN,"missing-glyph":cN,glyph:ME,text:Ju,tspan:Pm,tref:lN,a:uN,textPath:hN,image:dN,g:R_,symbol:fN,style:DE,use:gN,mask:Mm,clipPath:yN,filter:Um,feDropShadow:_N,feMorphology:vN,feComposite:bN,feColorMatrix:NE,feGaussianBlur:wN,title:xN,desc:BN};function CN(r,t){var e=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),e.push.apply(e,n)}return e}function Bbt(r){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?CN(Object(e),!0).forEach(function(n){cE(r,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(e)):CN(Object(e)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(e,n))})}return r}function Cbt(r,t){var e=document.createElement("canvas");return e.width=r,e.height=t,e}function Ebt(r){return kE.apply(this,arguments)}function kE(){return kE=$u(function*(r){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,e=document.createElement("img");return t&&(e.crossOrigin="Anonymous"),new Promise((n,i)=>{e.onload=()=>{n(e)},e.onerror=(s,a,o,A,f)=>{i(f)},e.src=r})}),kE.apply(this,arguments)}class Zu{constructor(t){var{rootEmSize:e=12,emSize:n=12,createCanvas:i=Zu.createCanvas,createImage:s=Zu.createImage,anonymousCrossOrigin:a}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.canvg=t,this.definitions={},this.styles={},this.stylesSpecificity={},this.images=[],this.fonts=[],this.emSizeStack=[],this.uniqueId=0,this.screen=t.screen,this.rootEmSize=e,this.emSize=n,this.createCanvas=i,this.createImage=this.bindCreateImage(s,a),this.screen.wait(this.isImagesLoaded.bind(this)),this.screen.wait(this.isFontsLoaded.bind(this))}bindCreateImage(t,e){return typeof e=="boolean"?(n,i)=>t(n,typeof i=="boolean"?i:e):t}get window(){return this.screen.window}get fetch(){return this.screen.fetch}get ctx(){return this.screen.ctx}get emSize(){var{emSizeStack:t}=this;return t[t.length-1]}set emSize(t){var{emSizeStack:e}=this;e.push(t)}popEmSize(){var{emSizeStack:t}=this;t.pop()}getUniqueId(){return"canvg".concat(++this.uniqueId)}isImagesLoaded(){return this.images.every(t=>t.loaded)}isFontsLoaded(){return this.fonts.every(t=>t.loaded)}createDocumentElement(t){var e=this.createElement(t.documentElement);return e.root=!0,e.addStylesFromStyleDefinition(),this.documentElement=e,e}createElement(t){var e=t.nodeName.replace(/^[^:]+:/,""),n=Zu.elementTypes[e];return typeof n<"u"?new n(this,t):new K6(this,t)}createTextNode(t){return new bbt(this,t)}setViewBox(t){this.screen.setViewBox(Bbt({document:this},t))}}Zu.createCanvas=Cbt,Zu.createImage=Ebt,Zu.elementTypes=xbt;function EN(r,t){var e=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),e.push.apply(e,n)}return e}function md(r){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?EN(Object(e),!0).forEach(function(n){cE(r,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(e)):EN(Object(e)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(e,n))})}return r}class yd{constructor(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.parser=new U_(n),this.screen=new Fm(t,n),this.options=n;var i=new Zu(this,n),s=i.createDocumentElement(e);this.document=i,this.documentElement=s}static from(t,e){var n=arguments;return $u(function*(){var i=n.length>2&&n[2]!==void 0?n[2]:{},s=new U_(i),a=yield s.parse(e);return new yd(t,a,i)})()}static fromString(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=new U_(n),s=i.parseFromString(e);return new yd(t,s,n)}fork(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return yd.from(t,e,md(md({},this.options),n))}forkString(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return yd.fromString(t,e,md(md({},this.options),n))}ready(){return this.screen.ready()}isReady(){return this.screen.isReady()}render(){var t=arguments,e=this;return $u(function*(){var n=t.length>0&&t[0]!==void 0?t[0]:{};e.start(md({enableRedraw:!0,ignoreAnimation:!0,ignoreMouse:!0},n)),yield e.ready(),e.stop()})()}start(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{documentElement:e,screen:n,options:i}=this;n.start(e,md(md({enableRedraw:!0},i),t))}stop(){this.screen.stop()}resize(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;this.documentElement.resize(t,e,n)}}const Sbt=Object.freeze(Object.defineProperty({__proto__:null,AElement:uN,AnimateColorElement:iN,AnimateElement:O_,AnimateTransformElement:sN,BoundingBox:gc,CB1:BE,CB2:CE,CB3:EE,CB4:SE,Canvg:yd,CircleElement:$6,ClipPathElement:yN,DefsElement:tN,DescElement:BN,Document:Zu,Element:_i,EllipseElement:W6,FeColorMatrixElement:NE,FeCompositeElement:bN,FeDropShadowElement:_N,FeGaussianBlurElement:wN,FeMorphologyElement:vN,FilterElement:Um,Font:bo,FontElement:oN,FontFaceElement:aN,GElement:R_,GlyphElement:ME,GradientElement:OE,ImageElement:dN,LineElement:X6,LinearGradientElement:eN,MarkerElement:Z6,MaskElement:Mm,Matrix:FE,MissingGlyphElement:cN,Mouse:k6,PSEUDO_ZERO:gd,Parser:U_,PathElement:$n,PathParser:rn,PatternElement:Y6,Point:qi,PolygonElement:J6,PolylineElement:RE,Property:Rr,QB1:TE,QB2:IE,QB3:LE,RadialGradientElement:rN,RectElement:UE,RenderedElement:oh,Rotate:G6,SVGElement:dp,SVGFontLoader:pN,Scale:V6,Screen:Fm,Skew:PE,SkewX:j6,SkewY:q6,StopElement:nN,StyleElement:DE,SymbolElement:fN,TRefElement:lN,TSpanElement:Pm,TextElement:Ju,TextPathElement:hN,TitleElement:xN,Transform:sh,Translate:z6,UnknownElement:K6,UseElement:gN,ViewPort:N6,compressSpaces:fd,default:yd,getSelectorSpecificity:D6,normalizeAttributeName:R6,normalizeColor:O6,parseExternalUrl:bE,presets:ibt,toNumbers:ga,trimLeft:M6,trimRight:U6,vectorMagnitude:wE,vectorsAngle:xE,vectorsRatio:M_},Symbol.toStringTag,{value:"Module"}));BA.CompareMaps=Fst,BA.ConfigICGC=DP,BA.Map=Cst,Object.defineProperty(BA,Symbol.toStringTag,{value:"Module"})});
