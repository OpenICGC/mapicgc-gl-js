(function(Wu,Il){typeof exports=="object"&&typeof module<"u"?Il(exports):typeof define=="function"&&define.amd?define(["exports"],Il):(Wu=typeof globalThis<"u"?globalThis:Wu||self,Il(Wu.mapicgcgl={}))})(this,function(Wu){"use strict";var IWe=Object.defineProperty;var MWe=(Wu,Il,dA)=>Il in Wu?IWe(Wu,Il,{enumerable:!0,configurable:!0,writable:!0,value:dA}):Wu[Il]=dA;var xe=(Wu,Il,dA)=>MWe(Wu,typeof Il!="symbol"?Il+"":Il,dA);var yf,bZ,yD,pl,vZ,xZ;var Il=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function dA(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var $D={exports:{}};(function(r,e){(function(t,n){r.exports=n()})(Il,function(){var t={},n={};function i(a,o,h){if(n[a]=h,a==="index"){var f="var sharedModule = {}; ("+n.shared+")(sharedModule); ("+n.worker+")(sharedModule);",_={};return n.shared(_),n.index(t,_),typeof window<"u"&&t.setWorkerUrl(window.URL.createObjectURL(new Blob([f],{type:"text/javascript"}))),t}}i("shared",["exports"],function(a){function o(p,u,A,v){return new(A||(A=Promise))(function(M,L){function k(te){try{q(v.next(te))}catch(ae){L(ae)}}function Q(te){try{q(v.throw(te))}catch(ae){L(ae)}}function q(te){var ae;te.done?M(te.value):(ae=te.value,ae instanceof A?ae:new A(function(de){de(ae)})).then(k,Q)}q((v=v.apply(p,u||[])).next())})}function h(p){return p&&p.__esModule&&Object.prototype.hasOwnProperty.call(p,"default")?p.default:p}var f,_;function x(){if(_)return f;function p(u,A){this.x=u,this.y=A}return _=1,f=p,p.prototype={clone:function(){return new p(this.x,this.y)},add:function(u){return this.clone()._add(u)},sub:function(u){return this.clone()._sub(u)},multByPoint:function(u){return this.clone()._multByPoint(u)},divByPoint:function(u){return this.clone()._divByPoint(u)},mult:function(u){return this.clone()._mult(u)},div:function(u){return this.clone()._div(u)},rotate:function(u){return this.clone()._rotate(u)},rotateAround:function(u,A){return this.clone()._rotateAround(u,A)},matMult:function(u){return this.clone()._matMult(u)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(u){return this.x===u.x&&this.y===u.y},dist:function(u){return Math.sqrt(this.distSqr(u))},distSqr:function(u){var A=u.x-this.x,v=u.y-this.y;return A*A+v*v},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(u){return Math.atan2(this.y-u.y,this.x-u.x)},angleWith:function(u){return this.angleWithSep(u.x,u.y)},angleWithSep:function(u,A){return Math.atan2(this.x*A-this.y*u,this.x*u+this.y*A)},_matMult:function(u){var A=u[2]*this.x+u[3]*this.y;return this.x=u[0]*this.x+u[1]*this.y,this.y=A,this},_add:function(u){return this.x+=u.x,this.y+=u.y,this},_sub:function(u){return this.x-=u.x,this.y-=u.y,this},_mult:function(u){return this.x*=u,this.y*=u,this},_div:function(u){return this.x/=u,this.y/=u,this},_multByPoint:function(u){return this.x*=u.x,this.y*=u.y,this},_divByPoint:function(u){return this.x/=u.x,this.y/=u.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var u=this.y;return this.y=this.x,this.x=-u,this},_rotate:function(u){var A=Math.cos(u),v=Math.sin(u),M=v*this.x+A*this.y;return this.x=A*this.x-v*this.y,this.y=M,this},_rotateAround:function(u,A){var v=Math.cos(u),M=Math.sin(u),L=A.y+M*(this.x-A.x)+v*(this.y-A.y);return this.x=A.x+v*(this.x-A.x)-M*(this.y-A.y),this.y=L,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},p.convert=function(u){return u instanceof p?u:Array.isArray(u)?new p(u[0],u[1]):u},f}typeof SuppressedError=="function"&&SuppressedError;var T,I,N=h(x()),$=function(){if(I)return T;function p(u,A,v,M){this.cx=3*u,this.bx=3*(v-u)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*A,this.by=3*(M-A)-this.cy,this.ay=1-this.cy-this.by,this.p1x=u,this.p1y=A,this.p2x=v,this.p2y=M}return I=1,T=p,p.prototype={sampleCurveX:function(u){return((this.ax*u+this.bx)*u+this.cx)*u},sampleCurveY:function(u){return((this.ay*u+this.by)*u+this.cy)*u},sampleCurveDerivativeX:function(u){return(3*this.ax*u+2*this.bx)*u+this.cx},solveCurveX:function(u,A){if(A===void 0&&(A=1e-6),u<0)return 0;if(u>1)return 1;for(var v=u,M=0;M<8;M++){var L=this.sampleCurveX(v)-u;if(Math.abs(L)<A)return v;var k=this.sampleCurveDerivativeX(v);if(Math.abs(k)<1e-6)break;v-=L/k}var Q=0,q=1;for(v=u,M=0;M<20&&(L=this.sampleCurveX(v),!(Math.abs(L-u)<A));M++)u>L?Q=v:q=v,v=.5*(q-Q)+Q;return v},solve:function(u,A){return this.sampleCurveY(this.solveCurveX(u,A))}},T}(),W=h($);let Y,ie;function ce(){return Y==null&&(Y=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Y}function fe(){if(ie==null&&(ie=!1,ce())){const u=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(u){for(let v=0;v<5*5;v++){const M=4*v;u.fillStyle=`rgb(${M},${M+1},${M+2})`,u.fillRect(v%5,Math.floor(v/5),1,1)}const A=u.getImageData(0,0,5,5).data;for(let v=0;v<5*5*4;v++)if(v%4!=3&&A[v]!==v){ie=!0;break}}}return ie||!1}var ve,be=1e-6,Qe=typeof Float32Array<"u"?Float32Array:Array;function Ue(){var p=new Qe(9);return Qe!=Float32Array&&(p[1]=0,p[2]=0,p[3]=0,p[5]=0,p[6]=0,p[7]=0),p[0]=1,p[4]=1,p[8]=1,p}function st(p){return p[0]=1,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=1,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[10]=1,p[11]=0,p[12]=0,p[13]=0,p[14]=0,p[15]=1,p}function at(){var p=new Qe(3);return Qe!=Float32Array&&(p[0]=0,p[1]=0,p[2]=0),p}function Le(p,u,A){var v=new Qe(3);return v[0]=p,v[1]=u,v[2]=A,v}function ze(p,u,A){var v=u[0],M=u[1],L=u[2],k=u[3];return p[0]=A[0]*v+A[4]*M+A[8]*L+A[12]*k,p[1]=A[1]*v+A[5]*M+A[9]*L+A[13]*k,p[2]=A[2]*v+A[6]*M+A[10]*L+A[14]*k,p[3]=A[3]*v+A[7]*M+A[11]*L+A[15]*k,p}function tt(){var p=new Qe(4);return Qe!=Float32Array&&(p[0]=0,p[1]=0,p[2]=0),p[3]=1,p}function Ne(){var p=new Qe(2);return Qe!=Float32Array&&(p[0]=0,p[1]=0),p}function Ht(p,u){var A=new Qe(2);return A[0]=p,A[1]=u,A}Math.hypot||(Math.hypot=function(){for(var p=0,u=arguments.length;u--;)p+=arguments[u]*arguments[u];return Math.sqrt(p)}),at(),ve=new Qe(4),Qe!=Float32Array&&(ve[0]=0,ve[1]=0,ve[2]=0,ve[3]=0),at(),Le(1,0,0),Le(0,1,0),tt(),tt(),Ue(),Ne();const Vt=8192;function Jt(p,u,A){return u*(Vt/(p.tileSize*Math.pow(2,A-p.tileID.overscaledZ)))}function Kt(p,u){return(p%u+u)%u}function er(p,u,A){return p*(1-A)+u*A}function Xt(p){if(p<=0)return 0;if(p>=1)return 1;const u=p*p,A=u*p;return 4*(p<.5?A:3*(p-u)+A-.75)}function Fr(p,u,A,v){const M=new W(p,u,A,v);return L=>M.solve(L)}const $e=Fr(.25,.1,.25,1);function ut(p,u,A){return Math.min(A,Math.max(u,p))}function Bt(p,u,A){const v=A-u,M=((p-u)%v+v)%v+u;return M===u?A:M}function St(p){for(var u=arguments.length,A=new Array(u>1?u-1:0),v=1;v<u;v++)A[v-1]=arguments[v];for(const M of A)for(const L in M)p[L]=M[L];return p}let jt=1;function qt(p,u,A){const v={};for(const M in p)v[M]=u.call(this,p[M],M,p);return v}function nr(p,u,A){const v={};for(const M in p)u.call(this,p[M],M,p)&&(v[M]=p[M]);return v}function ar(p){return Array.isArray(p)?p.map(ar):typeof p=="object"&&p?qt(p,ar):p}const $r={};function kr(p){$r[p]||(typeof console<"u"&&console.warn(p),$r[p]=!0)}function Gr(p,u,A){return(A.y-p.y)*(u.x-p.x)>(u.y-p.y)*(A.x-p.x)}function sn(p){return typeof WorkerGlobalScope<"u"&&p!==void 0&&p instanceof WorkerGlobalScope}let on=null;function pr(p){return typeof ImageBitmap<"u"&&p instanceof ImageBitmap}const We="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Pn(p,u,A,v,M){return o(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const L=new VideoFrame(p,{timestamp:0});try{const k=L==null?void 0:L.format;if(!k||!k.startsWith("BGR")&&!k.startsWith("RGB"))throw new Error(`Unrecognized format ${k}`);const Q=k.startsWith("BGR"),q=new Uint8ClampedArray(v*M*4);if(yield L.copyTo(q,function(te,ae,de,ye,me){const Ie=4*Math.max(1,0),ke=(Math.max(0,de)-de)*ye*4+Ie,nt=4*ye,ct=Math.max(0,ae),Ot=Math.max(0,de);return{rect:{x:ct,y:Ot,width:Math.min(te.width,ae+ye)-ct,height:Math.min(te.height,de+me)-Ot},layout:[{offset:ke,stride:nt}]}}(p,u,A,v,M)),Q)for(let te=0;te<q.length;te+=4){const ae=q[te];q[te]=q[te+2],q[te+2]=ae}return q}finally{L.close()}})}let mn,mr;function Mr(p){return p/Math.PI*180}const en="AbortError";function Wr(){return new Error(en)}const gn={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Bn(p){return gn.REGISTERED_PROTOCOLS[p.substring(0,p.indexOf("://"))]}const Fn="global-dispatcher";class $n extends Error{constructor(u,A,v,M){super(`AJAXError: ${A} (${u}): ${v}`),this.status=u,this.statusText=A,this.url=v,this.body=M}}const ei=()=>sn(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,br=function(p,u){if(/:\/\//.test(p.url)&&!/^https?:|^file:/.test(p.url)){const v=Bn(p.url);if(v)return v(p,u);if(sn(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:p,targetMapId:Fn},u)}if(!(/^file:/.test(A=p.url)||/^file:/.test(ei())&&!/^\w+:/.test(A))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(v,M){return o(this,void 0,void 0,function*(){const L=new Request(v.url,{method:v.method||"GET",body:v.body,credentials:v.credentials,headers:v.headers,cache:v.cache,referrer:ei(),signal:M.signal});let k,Q;v.type!=="json"||L.headers.has("Accept")||L.headers.set("Accept","application/json");try{k=yield fetch(L)}catch(te){throw new $n(0,te.message,v.url,new Blob)}if(!k.ok){const te=yield k.blob();throw new $n(k.status,k.statusText,v.url,te)}Q=v.type==="arrayBuffer"||v.type==="image"?k.arrayBuffer():v.type==="json"?k.json():k.text();const q=yield Q;if(M.signal.aborted)throw Wr();return{data:q,cacheControl:k.headers.get("Cache-Control"),expires:k.headers.get("Expires")}})}(p,u);if(sn(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:p,mustQueue:!0,targetMapId:Fn},u)}var A;return function(v,M){return new Promise((L,k)=>{var Q;const q=new XMLHttpRequest;q.open(v.method||"GET",v.url,!0),v.type!=="arrayBuffer"&&v.type!=="image"||(q.responseType="arraybuffer");for(const te in v.headers)q.setRequestHeader(te,v.headers[te]);v.type==="json"&&(q.responseType="text",!((Q=v.headers)===null||Q===void 0)&&Q.Accept||q.setRequestHeader("Accept","application/json")),q.withCredentials=v.credentials==="include",q.onerror=()=>{k(new Error(q.statusText))},q.onload=()=>{if(!M.signal.aborted)if((q.status>=200&&q.status<300||q.status===0)&&q.response!==null){let te=q.response;if(v.type==="json")try{te=JSON.parse(q.response)}catch(ae){return void k(ae)}L({data:te,cacheControl:q.getResponseHeader("Cache-Control"),expires:q.getResponseHeader("Expires")})}else{const te=new Blob([q.response],{type:q.getResponseHeader("Content-Type")});k(new $n(q.status,q.statusText,v.url,te))}},M.signal.addEventListener("abort",()=>{q.abort(),k(Wr())}),q.send(v.body)})}(p,u)};function Cn(p){if(!p||p.indexOf("://")<=0||p.indexOf("data:image/")===0||p.indexOf("blob:")===0)return!0;const u=new URL(p),A=window.location;return u.protocol===A.protocol&&u.host===A.host}function Rn(p,u,A){A[p]&&A[p].indexOf(u)!==-1||(A[p]=A[p]||[],A[p].push(u))}function nn(p,u,A){if(A&&A[p]){const v=A[p].indexOf(u);v!==-1&&A[p].splice(v,1)}}class Ci{constructor(u){let A=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};St(this,A),this.type=u}}class Cr extends Ci{constructor(u){let A=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super("error",St({error:u},A))}}class Tn{on(u,A){return this._listeners=this._listeners||{},Rn(u,A,this._listeners),{unsubscribe:()=>{this.off(u,A)}}}off(u,A){return nn(u,A,this._listeners),nn(u,A,this._oneTimeListeners),this}once(u,A){return A?(this._oneTimeListeners=this._oneTimeListeners||{},Rn(u,A,this._oneTimeListeners),this):new Promise(v=>this.once(u,v))}fire(u,A){typeof u=="string"&&(u=new Ci(u,A||{}));const v=u.type;if(this.listens(v)){u.target=this;const M=this._listeners&&this._listeners[v]?this._listeners[v].slice():[];for(const Q of M)Q.call(this,u);const L=this._oneTimeListeners&&this._oneTimeListeners[v]?this._oneTimeListeners[v].slice():[];for(const Q of L)nn(v,Q,this._oneTimeListeners),Q.call(this,u);const k=this._eventedParent;k&&(St(u,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),k.fire(u))}else u instanceof Cr&&console.error(u.error);return this}listens(u){return this._listeners&&this._listeners[u]&&this._listeners[u].length>0||this._oneTimeListeners&&this._oneTimeListeners[u]&&this._oneTimeListeners[u].length>0||this._eventedParent&&this._eventedParent.listens(u)}setEventedParent(u,A){return this._eventedParent=u,this._eventedParentData=A,this}}var Xe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const He=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Je(p,u){const A={};for(const v in p)v!=="ref"&&(A[v]=p[v]);return He.forEach(v=>{v in u&&(A[v]=u[v])}),A}function Ve(p,u){if(Array.isArray(p)){if(!Array.isArray(u)||p.length!==u.length)return!1;for(let A=0;A<p.length;A++)if(!Ve(p[A],u[A]))return!1;return!0}if(typeof p=="object"&&p!==null&&u!==null){if(typeof u!="object"||Object.keys(p).length!==Object.keys(u).length)return!1;for(const A in p)if(!Ve(p[A],u[A]))return!1;return!0}return p===u}function bt(p,u){p.push(u)}function Mt(p,u,A){bt(A,{command:"addSource",args:[p,u[p]]})}function $t(p,u,A){bt(u,{command:"removeSource",args:[p]}),A[p]=!0}function Wt(p,u,A,v){$t(p,A,v),Mt(p,u,A)}function Pe(p,u,A){let v;for(v in p[A])if(Object.prototype.hasOwnProperty.call(p[A],v)&&v!=="data"&&!Ve(p[A][v],u[A][v]))return!1;for(v in u[A])if(Object.prototype.hasOwnProperty.call(u[A],v)&&v!=="data"&&!Ve(p[A][v],u[A][v]))return!1;return!0}function Ae(p,u,A,v,M,L){p=p||{},u=u||{};for(const k in p)Object.prototype.hasOwnProperty.call(p,k)&&(Ve(p[k],u[k])||A.push({command:L,args:[v,k,u[k],M]}));for(const k in u)Object.prototype.hasOwnProperty.call(u,k)&&!Object.prototype.hasOwnProperty.call(p,k)&&(Ve(p[k],u[k])||A.push({command:L,args:[v,k,u[k],M]}))}function ge(p){return p.id}function we(p,u){return p[u.id]=u,p}class Se{constructor(u,A,v,M){this.message=(u?`${u}: `:"")+v,M&&(this.identifier=M),A!=null&&A.__line__&&(this.line=A.__line__)}}function ht(p){for(var u=arguments.length,A=new Array(u>1?u-1:0),v=1;v<u;v++)A[v-1]=arguments[v];for(const M of A)for(const L in M)p[L]=M[L];return p}class At extends Error{constructor(u,A){super(A),this.message=A,this.key=u}}class _t{constructor(u){let A=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.parent=u,this.bindings={};for(const[v,M]of A)this.bindings[v]=M}concat(u){return new _t(this,u)}get(u){if(this.bindings[u])return this.bindings[u];if(this.parent)return this.parent.get(u);throw new Error(`${u} not found in scope.`)}has(u){return!!this.bindings[u]||!!this.parent&&this.parent.has(u)}}const dt={kind:"null"},yt={kind:"number"},Nt={kind:"string"},Rt={kind:"boolean"},dr={kind:"color"},zr={kind:"projectionDefinition"},Pr={kind:"object"},Rr={kind:"value"},ln={kind:"collator"},Jn={kind:"formatted"},_n={kind:"padding"},jn={kind:"resolvedImage"},Gn={kind:"variableAnchorOffsetCollection"};function Ln(p,u){return{kind:"array",itemType:p,N:u}}function Un(p){if(p.kind==="array"){const u=Un(p.itemType);return typeof p.N=="number"?`array<${u}, ${p.N}>`:p.itemType.kind==="value"?"array":`array<${u}>`}return p.kind}const Ei=[dt,yt,Nt,Rt,dr,zr,Jn,Pr,Ln(Rr),_n,jn,Gn];function zi(p,u){if(u.kind==="error")return null;if(p.kind==="array"){if(u.kind==="array"&&(u.N===0&&u.itemType.kind==="value"||!zi(p.itemType,u.itemType))&&(typeof p.N!="number"||p.N===u.N))return null}else{if(p.kind===u.kind)return null;if(p.kind==="value"){for(const A of Ei)if(!zi(A,u))return null}}return`Expected ${Un(p)} but found ${Un(u)} instead.`}function Pt(p,u){return u.some(A=>A.kind===p.kind)}function Zr(p,u){return u.some(A=>A==="null"?p===null:A==="array"?Array.isArray(p):A==="object"?p&&!Array.isArray(p)&&typeof p=="object":A===typeof p)}function Ur(p,u){return p.kind==="array"&&u.kind==="array"?p.itemType.kind===u.itemType.kind&&typeof p.N=="number":p.kind===u.kind}const On=.96422,di=.82521,ks=4/29,bi=6/29,bs=3*bi*bi,jo=bi*bi*bi,Ks=Math.PI/180,Hi=180/Math.PI;function Mc(p){return(p%=360)<0&&(p+=360),p}function wa(p){let[u,A,v,M]=p,L,k;const Q=ss((.2225045*(u=ts(u))+.7168786*(A=ts(A))+.0606169*(v=ts(v)))/1);u===A&&A===v?L=k=Q:(L=ss((.4360747*u+.3850649*A+.1430804*v)/On),k=ss((.0139322*u+.0971045*A+.7141733*v)/di));const q=116*Q-16;return[q<0?0:q,500*(L-Q),200*(Q-k),M]}function ts(p){return p<=.04045?p/12.92:Math.pow((p+.055)/1.055,2.4)}function ss(p){return p>jo?Math.pow(p,1/3):p/bs+ks}function sa(p){let[u,A,v,M]=p,L=(u+16)/116,k=isNaN(A)?L:L+A/500,Q=isNaN(v)?L:L-v/200;return L=1*Pc(L),k=On*Pc(k),Q=di*Pc(Q),[Vi(3.1338561*k-1.6168667*L-.4906146*Q),Vi(-.9787684*k+1.9161415*L+.033454*Q),Vi(.0719453*k-.2289914*L+1.4052427*Q),M]}function Vi(p){return(p=p<=.00304?12.92*p:1.055*Math.pow(p,1/2.4)-.055)<0?0:p>1?1:p}function Pc(p){return p>bi?p*p*p:bs*(p-ks)}function vo(p){return parseInt(p.padEnd(2,p),16)/255}function uh(p,u){return os(u?p/100:p,0,1)}function os(p,u,A){return Math.min(Math.max(u,p),A)}function cu(p){return!p.some(Number.isNaN)}const ds={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function ri(p,u,A){return p+A*(u-p)}function lo(p,u,A){return p.map((v,M)=>ri(v,u[M],A))}class yn{constructor(u,A,v){let M=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1,L=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0;this.r=u,this.g=A,this.b=v,this.a=M,L||(this.r*=M,this.g*=M,this.b*=M,M||this.overwriteGetter("rgb",[u,A,v,M]))}static parse(u){if(u instanceof yn)return u;if(typeof u!="string")return;const A=function(v){if((v=v.toLowerCase().trim())==="transparent")return[0,0,0,0];const M=ds[v];if(M){const[k,Q,q]=M;return[k/255,Q/255,q/255,1]}if(v.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(v)){const k=v.length<6?1:2;let Q=1;return[vo(v.slice(Q,Q+=k)),vo(v.slice(Q,Q+=k)),vo(v.slice(Q,Q+=k)),vo(v.slice(Q,Q+k)||"ff")]}if(v.startsWith("rgb")){const k=v.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(k){const[Q,q,te,ae,de,ye,me,Ie,ke,nt,ct,Ot]=k,wt=[ae||" ",me||" ",nt].join("");if(wt==="  "||wt==="  /"||wt===",,"||wt===",,,"){const Re=[te,ye,ke].join(""),it=Re==="%%%"?100:Re===""?255:0;if(it){const Et=[os(+q/it,0,1),os(+de/it,0,1),os(+Ie/it,0,1),ct?uh(+ct,Ot):1];if(cu(Et))return Et}}return}}const L=v.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(L){const[k,Q,q,te,ae,de,ye,me,Ie]=L,ke=[q||" ",ae||" ",ye].join("");if(ke==="  "||ke==="  /"||ke===",,"||ke===",,,"){const nt=[+Q,os(+te,0,100),os(+de,0,100),me?uh(+me,Ie):1];if(cu(nt))return function(ct){let[Ot,wt,Re,it]=ct;function Et(Zt){const Br=(Zt+Ot/30)%12,or=wt*Math.min(Re,1-Re);return Re-or*Math.max(-1,Math.min(Br-3,9-Br,1))}return Ot=Mc(Ot),wt/=100,Re/=100,[Et(0),Et(8),Et(4),it]}(nt)}}}(u);return A?new yn(...A,!1):void 0}get rgb(){const{r:u,g:A,b:v,a:M}=this,L=M||1/0;return this.overwriteGetter("rgb",[u/L,A/L,v/L,M])}get hcl(){return this.overwriteGetter("hcl",function(u){const[A,v,M,L]=wa(u),k=Math.sqrt(v*v+M*M);return[Math.round(1e4*k)?Mc(Math.atan2(M,v)*Hi):NaN,k,A,L]}(this.rgb))}get lab(){return this.overwriteGetter("lab",wa(this.rgb))}overwriteGetter(u,A){return Object.defineProperty(this,u,{value:A}),A}toString(){const[u,A,v,M]=this.rgb;return`rgba(${[u,A,v].map(L=>Math.round(255*L)).join(",")},${M})`}static interpolate(u,A,v){switch(arguments.length>3&&arguments[3]!==void 0?arguments[3]:"rgb"){case"rgb":{const[L,k,Q,q]=lo(u.rgb,A.rgb,v);return new yn(L,k,Q,q,!1)}case"hcl":{const[L,k,Q,q]=u.hcl,[te,ae,de,ye]=A.hcl;let me,Ie;if(isNaN(L)||isNaN(te))isNaN(L)?isNaN(te)?me=NaN:(me=te,Q!==1&&Q!==0||(Ie=ae)):(me=L,de!==1&&de!==0||(Ie=k));else{let wt=te-L;te>L&&wt>180?wt-=360:te<L&&L-te>180&&(wt+=360),me=L+v*wt}const[ke,nt,ct,Ot]=function(wt){let[Re,it,Et,Zt]=wt;return Re=isNaN(Re)?0:Re*Ks,sa([Et,Math.cos(Re)*it,Math.sin(Re)*it,Zt])}([me,Ie??ri(k,ae,v),ri(Q,de,v),ri(q,ye,v)]);return new yn(ke,nt,ct,Ot,!1)}case"lab":{const[L,k,Q,q]=sa(lo(u.lab,A.lab,v));return new yn(L,k,Q,q,!1)}}}}yn.black=new yn(0,0,0,1),yn.white=new yn(1,1,1,1),yn.transparent=new yn(0,0,0,0),yn.red=new yn(1,0,0,1);class Fc{constructor(u,A,v){this.sensitivity=u?A?"variant":"case":A?"accent":"base",this.locale=v,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(u,A){return this.collator.compare(u,A)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const hh=["bottom","center","top"];class $a{constructor(u,A,v,M,L,k){this.text=u,this.image=A,this.scale=v,this.fontStack=M,this.textColor=L,this.verticalAlign=k}}class fs{constructor(u){this.sections=u}static fromString(u){return new fs([new $a(u,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(u=>u.text.length!==0||u.image&&u.image.name.length!==0)}static factory(u){return u instanceof fs?u:fs.fromString(u)}toString(){return this.sections.length===0?"":this.sections.map(u=>u.text).join("")}}class As{constructor(u){this.values=u.slice()}static parse(u){if(u instanceof As)return u;if(typeof u=="number")return new As([u,u,u,u]);if(Array.isArray(u)&&!(u.length<1||u.length>4)){for(const A of u)if(typeof A!="number")return;switch(u.length){case 1:u=[u[0],u[0],u[0],u[0]];break;case 2:u=[u[0],u[1],u[0],u[1]];break;case 3:u=[u[0],u[1],u[2],u[1]]}return new As(u)}}toString(){return JSON.stringify(this.values)}static interpolate(u,A,v){return new As(lo(u.values,A.values,v))}}class Gi{constructor(u){this.name="ExpressionEvaluationError",this.message=u}toJSON(){return this.message}}const uu=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Us{constructor(u){this.values=u.slice()}static parse(u){if(u instanceof Us)return u;if(Array.isArray(u)&&!(u.length<1)&&u.length%2==0){for(let A=0;A<u.length;A+=2){const v=u[A],M=u[A+1];if(typeof v!="string"||!uu.has(v)||!Array.isArray(M)||M.length!==2||typeof M[0]!="number"||typeof M[1]!="number")return}return new Us(u)}}toString(){return JSON.stringify(this.values)}static interpolate(u,A,v){const M=u.values,L=A.values;if(M.length!==L.length)throw new Gi(`Cannot interpolate values of different length. from: ${u.toString()}, to: ${A.toString()}`);const k=[];for(let Q=0;Q<M.length;Q+=2){if(M[Q]!==L[Q])throw new Gi(`Cannot interpolate values containing mismatched anchors. from[${Q}]: ${M[Q]}, to[${Q}]: ${L[Q]}`);k.push(M[Q]);const[q,te]=M[Q+1],[ae,de]=L[Q+1];k.push([ri(q,ae,v),ri(te,de,v)])}return new Us(k)}}class vs{constructor(u){this.name=u.name,this.available=u.available}toString(){return this.name}static fromString(u){return u?new vs({name:u,available:!1}):null}}class eo{constructor(u,A,v){this.from=u,this.to=A,this.transition=v}static interpolate(u,A,v){return new eo(u,A,v)}static parse(u){return u instanceof eo?u:Array.isArray(u)&&u.length===3&&typeof u[0]=="string"&&typeof u[1]=="string"&&typeof u[2]=="number"?new eo(u[0],u[1],u[2]):typeof u=="object"&&typeof u.from=="string"&&typeof u.to=="string"&&typeof u.transition=="number"?new eo(u.from,u.to,u.transition):typeof u=="string"?new eo(u,u,1):void 0}}function Rc(p,u,A,v){return typeof p=="number"&&p>=0&&p<=255&&typeof u=="number"&&u>=0&&u<=255&&typeof A=="number"&&A>=0&&A<=255?v===void 0||typeof v=="number"&&v>=0&&v<=1?null:`Invalid rgba value [${[p,u,A,v].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof v=="number"?[p,u,A,v]:[p,u,A]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function oc(p){if(p===null||typeof p=="string"||typeof p=="boolean"||typeof p=="number"||p instanceof eo||p instanceof yn||p instanceof Fc||p instanceof fs||p instanceof As||p instanceof Us||p instanceof vs)return!0;if(Array.isArray(p)){for(const u of p)if(!oc(u))return!1;return!0}if(typeof p=="object"){for(const u in p)if(!oc(p[u]))return!1;return!0}return!1}function ai(p){if(p===null)return dt;if(typeof p=="string")return Nt;if(typeof p=="boolean")return Rt;if(typeof p=="number")return yt;if(p instanceof yn)return dr;if(p instanceof eo)return zr;if(p instanceof Fc)return ln;if(p instanceof fs)return Jn;if(p instanceof As)return _n;if(p instanceof Us)return Gn;if(p instanceof vs)return jn;if(Array.isArray(p)){const u=p.length;let A;for(const v of p){const M=ai(v);if(A){if(A===M)continue;A=Rr;break}A=M}return Ln(A||Rr,u)}return Pr}function Dl(p){const u=typeof p;return p===null?"":u==="string"||u==="number"||u==="boolean"?String(p):p instanceof yn||p instanceof eo||p instanceof fs||p instanceof As||p instanceof Us||p instanceof vs?p.toString():JSON.stringify(p)}class ps{constructor(u,A){this.type=u,this.value=A}static parse(u,A){if(u.length!==2)return A.error(`'literal' expression requires exactly one argument, but found ${u.length-1} instead.`);if(!oc(u[1]))return A.error("invalid value");const v=u[1];let M=ai(v);const L=A.expectedType;return M.kind!=="array"||M.N!==0||!L||L.kind!=="array"||typeof L.N=="number"&&L.N!==0||(M=L),new ps(M,v)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const Dn={string:Nt,number:yt,boolean:Rt,object:Pr};class Ro{constructor(u,A){this.type=u,this.args=A}static parse(u,A){if(u.length<2)return A.error("Expected at least one argument.");let v,M=1;const L=u[0];if(L==="array"){let Q,q;if(u.length>2){const te=u[1];if(typeof te!="string"||!(te in Dn)||te==="object")return A.error('The item type argument of "array" must be one of string, number, boolean',1);Q=Dn[te],M++}else Q=Rr;if(u.length>3){if(u[2]!==null&&(typeof u[2]!="number"||u[2]<0||u[2]!==Math.floor(u[2])))return A.error('The length argument to "array" must be a positive integer literal',2);q=u[2],M++}v=Ln(Q,q)}else{if(!Dn[L])throw new Error(`Types doesn't contain name = ${L}`);v=Dn[L]}const k=[];for(;M<u.length;M++){const Q=A.parse(u[M],M,Rr);if(!Q)return null;k.push(Q)}return new Ro(v,k)}evaluate(u){for(let A=0;A<this.args.length;A++){const v=this.args[A].evaluate(u);if(!zi(this.type,ai(v)))return v;if(A===this.args.length-1)throw new Gi(`Expected value to be of type ${Un(this.type)}, but found ${Un(ai(v))} instead.`)}throw new Error}eachChild(u){this.args.forEach(u)}outputDefined(){return this.args.every(u=>u.outputDefined())}}const hu={"to-boolean":Rt,"to-color":dr,"to-number":yt,"to-string":Nt};class to{constructor(u,A){this.type=u,this.args=A}static parse(u,A){if(u.length<2)return A.error("Expected at least one argument.");const v=u[0];if(!hu[v])throw new Error(`Can't parse ${v} as it is not part of the known types`);if((v==="to-boolean"||v==="to-string")&&u.length!==2)return A.error("Expected one argument.");const M=hu[v],L=[];for(let k=1;k<u.length;k++){const Q=A.parse(u[k],k,Rr);if(!Q)return null;L.push(Q)}return new to(M,L)}evaluate(u){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(u);case"color":{let A,v;for(const M of this.args){if(A=M.evaluate(u),v=null,A instanceof yn)return A;if(typeof A=="string"){const L=u.parseColor(A);if(L)return L}else if(Array.isArray(A)&&(v=A.length<3||A.length>4?`Invalid rgba value ${JSON.stringify(A)}: expected an array containing either three or four numeric values.`:Rc(A[0],A[1],A[2],A[3]),!v))return new yn(A[0]/255,A[1]/255,A[2]/255,A[3])}throw new Gi(v||`Could not parse color from value '${typeof A=="string"?A:JSON.stringify(A)}'`)}case"padding":{let A;for(const v of this.args){A=v.evaluate(u);const M=As.parse(A);if(M)return M}throw new Gi(`Could not parse padding from value '${typeof A=="string"?A:JSON.stringify(A)}'`)}case"variableAnchorOffsetCollection":{let A;for(const v of this.args){A=v.evaluate(u);const M=Us.parse(A);if(M)return M}throw new Gi(`Could not parse variableAnchorOffsetCollection from value '${typeof A=="string"?A:JSON.stringify(A)}'`)}case"number":{let A=null;for(const v of this.args){if(A=v.evaluate(u),A===null)return 0;const M=Number(A);if(!isNaN(M))return M}throw new Gi(`Could not convert ${JSON.stringify(A)} to number.`)}case"formatted":return fs.fromString(Dl(this.args[0].evaluate(u)));case"resolvedImage":return vs.fromString(Dl(this.args[0].evaluate(u)));case"projectionDefinition":return this.args[0].evaluate(u);default:return Dl(this.args[0].evaluate(u))}}eachChild(u){this.args.forEach(u)}outputDefined(){return this.args.every(u=>u.outputDefined())}}const du=["Unknown","Point","LineString","Polygon"];class Li{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?du[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(u){let A=this._parseColorCache[u];return A||(A=this._parseColorCache[u]=yn.parse(u)),A}}class Ol{constructor(u,A){let v=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],M=arguments.length>3?arguments[3]:void 0,L=arguments.length>4&&arguments[4]!==void 0?arguments[4]:new _t,k=arguments.length>5&&arguments[5]!==void 0?arguments[5]:[];this.registry=u,this.path=v,this.key=v.map(Q=>`[${Q}]`).join(""),this.scope=L,this.errors=k,this.expectedType=M,this._isConstant=A}parse(u,A,v,M){let L=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};return A?this.concat(A,v,M)._parse(u,L):this._parse(u,L)}_parse(u,A){function v(M,L,k){return k==="assert"?new Ro(L,[M]):k==="coerce"?new to(L,[M]):M}if(u!==null&&typeof u!="string"&&typeof u!="boolean"&&typeof u!="number"||(u=["literal",u]),Array.isArray(u)){if(u.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const M=u[0];if(typeof M!="string")return this.error(`Expression name must be a string, but found ${typeof M} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const L=this.registry[M];if(L){let k=L.parse(u,this);if(!k)return null;if(this.expectedType){const Q=this.expectedType,q=k.type;if(Q.kind!=="string"&&Q.kind!=="number"&&Q.kind!=="boolean"&&Q.kind!=="object"&&Q.kind!=="array"||q.kind!=="value")if(Q.kind!=="projectionDefinition"||q.kind!=="string"&&q.kind!=="array")if(Q.kind!=="color"&&Q.kind!=="formatted"&&Q.kind!=="resolvedImage"||q.kind!=="value"&&q.kind!=="string")if(Q.kind!=="padding"||q.kind!=="value"&&q.kind!=="number"&&q.kind!=="array")if(Q.kind!=="variableAnchorOffsetCollection"||q.kind!=="value"&&q.kind!=="array"){if(this.checkSubtype(Q,q))return null}else k=v(k,Q,A.typeAnnotation||"coerce");else k=v(k,Q,A.typeAnnotation||"coerce");else k=v(k,Q,A.typeAnnotation||"coerce");else k=v(k,Q,A.typeAnnotation||"coerce");else k=v(k,Q,A.typeAnnotation||"assert")}if(!(k instanceof ps)&&k.type.kind!=="resolvedImage"&&this._isConstant(k)){const Q=new Li;try{k=new ps(k.type,k.evaluate(Q))}catch(q){return this.error(q.message),null}}return k}return this.error(`Unknown expression "${M}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(u===void 0?"'undefined' value invalid. Use null instead.":typeof u=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof u} instead.`)}concat(u,A,v){const M=typeof u=="number"?this.path.concat(u):this.path,L=v?this.scope.concat(v):this.scope;return new Ol(this.registry,this._isConstant,M,A||null,L,this.errors)}error(u){for(var A=arguments.length,v=new Array(A>1?A-1:0),M=1;M<A;M++)v[M-1]=arguments[M];const L=`${this.key}${v.map(k=>`[${k}]`).join("")}`;this.errors.push(new At(L,u))}checkSubtype(u,A){const v=zi(u,A);return v&&this.error(v),v}}class Ai{constructor(u,A){this.type=A.type,this.bindings=[].concat(u),this.result=A}evaluate(u){return this.result.evaluate(u)}eachChild(u){for(const A of this.bindings)u(A[1]);u(this.result)}static parse(u,A){if(u.length<4)return A.error(`Expected at least 3 arguments, but found ${u.length-1} instead.`);const v=[];for(let L=1;L<u.length-1;L+=2){const k=u[L];if(typeof k!="string")return A.error(`Expected string, but found ${typeof k} instead.`,L);if(/[^a-zA-Z0-9_]/.test(k))return A.error("Variable names must contain only alphanumeric characters or '_'.",L);const Q=A.parse(u[L+1],L+1);if(!Q)return null;v.push([k,Q])}const M=A.parse(u[u.length-1],u.length-1,A.expectedType,v);return M?new Ai(v,M):null}outputDefined(){return this.result.outputDefined()}}class si{constructor(u,A){this.type=A.type,this.name=u,this.boundExpression=A}static parse(u,A){if(u.length!==2||typeof u[1]!="string")return A.error("'var' expression requires exactly one string literal argument.");const v=u[1];return A.scope.has(v)?new si(v,A.scope.get(v)):A.error(`Unknown variable "${v}". Make sure "${v}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(u){return this.boundExpression.evaluate(u)}eachChild(){}outputDefined(){return!1}}class ku{constructor(u,A,v){this.type=u,this.index=A,this.input=v}static parse(u,A){if(u.length!==3)return A.error(`Expected 2 arguments, but found ${u.length-1} instead.`);const v=A.parse(u[1],1,yt),M=A.parse(u[2],2,Ln(A.expectedType||Rr));return v&&M?new ku(M.type.itemType,v,M):null}evaluate(u){const A=this.index.evaluate(u),v=this.input.evaluate(u);if(A<0)throw new Gi(`Array index out of bounds: ${A} < 0.`);if(A>=v.length)throw new Gi(`Array index out of bounds: ${A} > ${v.length-1}.`);if(A!==Math.floor(A))throw new Gi(`Array index must be an integer, but found ${A} instead.`);return v[A]}eachChild(u){u(this.index),u(this.input)}outputDefined(){return!1}}class wi{constructor(u,A){this.type=Rt,this.needle=u,this.haystack=A}static parse(u,A){if(u.length!==3)return A.error(`Expected 2 arguments, but found ${u.length-1} instead.`);const v=A.parse(u[1],1,Rr),M=A.parse(u[2],2,Rr);return v&&M?Pt(v.type,[Rt,Nt,yt,dt,Rr])?new wi(v,M):A.error(`Expected first argument to be of type boolean, string, number or null, but found ${Un(v.type)} instead`):null}evaluate(u){const A=this.needle.evaluate(u),v=this.haystack.evaluate(u);if(!v)return!1;if(!Zr(A,["boolean","string","number","null"]))throw new Gi(`Expected first argument to be of type boolean, string, number or null, but found ${Un(ai(A))} instead.`);if(!Zr(v,["string","array"]))throw new Gi(`Expected second argument to be of type array or string, but found ${Un(ai(v))} instead.`);return v.indexOf(A)>=0}eachChild(u){u(this.needle),u(this.haystack)}outputDefined(){return!0}}class kl{constructor(u,A,v){this.type=yt,this.needle=u,this.haystack=A,this.fromIndex=v}static parse(u,A){if(u.length<=2||u.length>=5)return A.error(`Expected 3 or 4 arguments, but found ${u.length-1} instead.`);const v=A.parse(u[1],1,Rr),M=A.parse(u[2],2,Rr);if(!v||!M)return null;if(!Pt(v.type,[Rt,Nt,yt,dt,Rr]))return A.error(`Expected first argument to be of type boolean, string, number or null, but found ${Un(v.type)} instead`);if(u.length===4){const L=A.parse(u[3],3,yt);return L?new kl(v,M,L):null}return new kl(v,M)}evaluate(u){const A=this.needle.evaluate(u),v=this.haystack.evaluate(u);if(!Zr(A,["boolean","string","number","null"]))throw new Gi(`Expected first argument to be of type boolean, string, number or null, but found ${Un(ai(A))} instead.`);let M;if(this.fromIndex&&(M=this.fromIndex.evaluate(u)),Zr(v,["string"])){const L=v.indexOf(A,M);return L===-1?-1:[...v.slice(0,L)].length}if(Zr(v,["array"]))return v.indexOf(A,M);throw new Gi(`Expected second argument to be of type array or string, but found ${Un(ai(v))} instead.`)}eachChild(u){u(this.needle),u(this.haystack),this.fromIndex&&u(this.fromIndex)}outputDefined(){return!1}}class ro{constructor(u,A,v,M,L,k){this.inputType=u,this.type=A,this.input=v,this.cases=M,this.outputs=L,this.otherwise=k}static parse(u,A){if(u.length<5)return A.error(`Expected at least 4 arguments, but found only ${u.length-1}.`);if(u.length%2!=1)return A.error("Expected an even number of arguments.");let v,M;A.expectedType&&A.expectedType.kind!=="value"&&(M=A.expectedType);const L={},k=[];for(let te=2;te<u.length-1;te+=2){let ae=u[te];const de=u[te+1];Array.isArray(ae)||(ae=[ae]);const ye=A.concat(te);if(ae.length===0)return ye.error("Expected at least one branch label.");for(const Ie of ae){if(typeof Ie!="number"&&typeof Ie!="string")return ye.error("Branch labels must be numbers or strings.");if(typeof Ie=="number"&&Math.abs(Ie)>Number.MAX_SAFE_INTEGER)return ye.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof Ie=="number"&&Math.floor(Ie)!==Ie)return ye.error("Numeric branch labels must be integer values.");if(v){if(ye.checkSubtype(v,ai(Ie)))return null}else v=ai(Ie);if(L[String(Ie)]!==void 0)return ye.error("Branch labels must be unique.");L[String(Ie)]=k.length}const me=A.parse(de,te,M);if(!me)return null;M=M||me.type,k.push(me)}const Q=A.parse(u[1],1,Rr);if(!Q)return null;const q=A.parse(u[u.length-1],u.length-1,M);return q?Q.type.kind!=="value"&&A.concat(1).checkSubtype(v,Q.type)?null:new ro(v,M,Q,L,k,q):null}evaluate(u){const A=this.input.evaluate(u);return(ai(A)===this.inputType&&this.outputs[this.cases[A]]||this.otherwise).evaluate(u)}eachChild(u){u(this.input),this.outputs.forEach(u),u(this.otherwise)}outputDefined(){return this.outputs.every(u=>u.outputDefined())&&this.otherwise.outputDefined()}}class Ba{constructor(u,A,v){this.type=u,this.branches=A,this.otherwise=v}static parse(u,A){if(u.length<4)return A.error(`Expected at least 3 arguments, but found only ${u.length-1}.`);if(u.length%2!=0)return A.error("Expected an odd number of arguments.");let v;A.expectedType&&A.expectedType.kind!=="value"&&(v=A.expectedType);const M=[];for(let k=1;k<u.length-1;k+=2){const Q=A.parse(u[k],k,Rt);if(!Q)return null;const q=A.parse(u[k+1],k+1,v);if(!q)return null;M.push([Q,q]),v=v||q.type}const L=A.parse(u[u.length-1],u.length-1,v);if(!L)return null;if(!v)throw new Error("Can't infer output type");return new Ba(v,M,L)}evaluate(u){for(const[A,v]of this.branches)if(A.evaluate(u))return v.evaluate(u);return this.otherwise.evaluate(u)}eachChild(u){for(const[A,v]of this.branches)u(A),u(v);u(this.otherwise)}outputDefined(){return this.branches.every(u=>{let[A,v]=u;return v.outputDefined()})&&this.otherwise.outputDefined()}}class ac{constructor(u,A,v,M){this.type=u,this.input=A,this.beginIndex=v,this.endIndex=M}static parse(u,A){if(u.length<=2||u.length>=5)return A.error(`Expected 3 or 4 arguments, but found ${u.length-1} instead.`);const v=A.parse(u[1],1,Rr),M=A.parse(u[2],2,yt);if(!v||!M)return null;if(!Pt(v.type,[Ln(Rr),Nt,Rr]))return A.error(`Expected first argument to be of type array or string, but found ${Un(v.type)} instead`);if(u.length===4){const L=A.parse(u[3],3,yt);return L?new ac(v.type,v,M,L):null}return new ac(v.type,v,M)}evaluate(u){const A=this.input.evaluate(u),v=this.beginIndex.evaluate(u);let M;if(this.endIndex&&(M=this.endIndex.evaluate(u)),Zr(A,["string"]))return[...A].slice(v,M).join("");if(Zr(A,["array"]))return A.slice(v,M);throw new Gi(`Expected first argument to be of type array or string, but found ${Un(ai(A))} instead.`)}eachChild(u){u(this.input),u(this.beginIndex),this.endIndex&&u(this.endIndex)}outputDefined(){return!1}}function ja(p,u){const A=p.length-1;let v,M,L=0,k=A,Q=0;for(;L<=k;)if(Q=Math.floor((L+k)/2),v=p[Q],M=p[Q+1],v<=u){if(Q===A||u<M)return Q;L=Q+1}else{if(!(v>u))throw new Gi("Input is not a number.");k=Q-1}return 0}class qa{constructor(u,A,v){this.type=u,this.input=A,this.labels=[],this.outputs=[];for(const[M,L]of v)this.labels.push(M),this.outputs.push(L)}static parse(u,A){if(u.length-1<4)return A.error(`Expected at least 4 arguments, but found only ${u.length-1}.`);if((u.length-1)%2!=0)return A.error("Expected an even number of arguments.");const v=A.parse(u[1],1,yt);if(!v)return null;const M=[];let L=null;A.expectedType&&A.expectedType.kind!=="value"&&(L=A.expectedType);for(let k=1;k<u.length;k+=2){const Q=k===1?-1/0:u[k],q=u[k+1],te=k,ae=k+1;if(typeof Q!="number")return A.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',te);if(M.length&&M[M.length-1][0]>=Q)return A.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',te);const de=A.parse(q,ae,L);if(!de)return null;L=L||de.type,M.push([Q,de])}return new qa(L,v,M)}evaluate(u){const A=this.labels,v=this.outputs;if(A.length===1)return v[0].evaluate(u);const M=this.input.evaluate(u);if(M<=A[0])return v[0].evaluate(u);const L=A.length;return M>=A[L-1]?v[L-1].evaluate(u):v[ja(A,M)].evaluate(u)}eachChild(u){u(this.input);for(const A of this.outputs)u(A)}outputDefined(){return this.outputs.every(u=>u.outputDefined())}}function qo(p){return p&&p.__esModule&&Object.prototype.hasOwnProperty.call(p,"default")?p.default:p}var dh,fu,Ul=function(){if(fu)return dh;function p(u,A,v,M){this.cx=3*u,this.bx=3*(v-u)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*A,this.by=3*(M-A)-this.cy,this.ay=1-this.cy-this.by,this.p1x=u,this.p1y=A,this.p2x=v,this.p2y=M}return fu=1,dh=p,p.prototype={sampleCurveX:function(u){return((this.ax*u+this.bx)*u+this.cx)*u},sampleCurveY:function(u){return((this.ay*u+this.by)*u+this.cy)*u},sampleCurveDerivativeX:function(u){return(3*this.ax*u+2*this.bx)*u+this.cx},solveCurveX:function(u,A){if(A===void 0&&(A=1e-6),u<0)return 0;if(u>1)return 1;for(var v=u,M=0;M<8;M++){var L=this.sampleCurveX(v)-u;if(Math.abs(L)<A)return v;var k=this.sampleCurveDerivativeX(v);if(Math.abs(k)<1e-6)break;v-=L/k}var Q=0,q=1;for(v=u,M=0;M<20&&(L=this.sampleCurveX(v),!(Math.abs(L-u)<A));M++)u>L?Q=v:q=v,v=.5*(q-Q)+Q;return v},solve:function(u,A){return this.sampleCurveY(this.solveCurveX(u,A))}},dh}(),oa=qo(Ul);class Sn{constructor(u,A,v,M,L){this.type=u,this.operator=A,this.interpolation=v,this.input=M,this.labels=[],this.outputs=[];for(const[k,Q]of L)this.labels.push(k),this.outputs.push(Q)}static interpolationFactor(u,A,v,M){let L=0;if(u.name==="exponential")L=Ko(A,u.base,v,M);else if(u.name==="linear")L=Ko(A,1,v,M);else if(u.name==="cubic-bezier"){const k=u.controlPoints;L=new oa(k[0],k[1],k[2],k[3]).solve(Ko(A,1,v,M))}return L}static parse(u,A){let[v,M,L,...k]=u;if(!Array.isArray(M)||M.length===0)return A.error("Expected an interpolation type expression.",1);if(M[0]==="linear")M={name:"linear"};else if(M[0]==="exponential"){const te=M[1];if(typeof te!="number")return A.error("Exponential interpolation requires a numeric base.",1,1);M={name:"exponential",base:te}}else{if(M[0]!=="cubic-bezier")return A.error(`Unknown interpolation type ${String(M[0])}`,1,0);{const te=M.slice(1);if(te.length!==4||te.some(ae=>typeof ae!="number"||ae<0||ae>1))return A.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);M={name:"cubic-bezier",controlPoints:te}}}if(u.length-1<4)return A.error(`Expected at least 4 arguments, but found only ${u.length-1}.`);if((u.length-1)%2!=0)return A.error("Expected an even number of arguments.");if(L=A.parse(L,2,yt),!L)return null;const Q=[];let q=null;v==="interpolate-hcl"||v==="interpolate-lab"?q=dr:A.expectedType&&A.expectedType.kind!=="value"&&(q=A.expectedType);for(let te=0;te<k.length;te+=2){const ae=k[te],de=k[te+1],ye=te+3,me=te+4;if(typeof ae!="number")return A.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',ye);if(Q.length&&Q[Q.length-1][0]>=ae)return A.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',ye);const Ie=A.parse(de,me,q);if(!Ie)return null;q=q||Ie.type,Q.push([ae,Ie])}return Ur(q,yt)||Ur(q,zr)||Ur(q,dr)||Ur(q,_n)||Ur(q,Gn)||Ur(q,Ln(yt))?new Sn(q,v,M,L,Q):A.error(`Type ${Un(q)} is not interpolatable.`)}evaluate(u){const A=this.labels,v=this.outputs;if(A.length===1)return v[0].evaluate(u);const M=this.input.evaluate(u);if(M<=A[0])return v[0].evaluate(u);const L=A.length;if(M>=A[L-1])return v[L-1].evaluate(u);const k=ja(A,M),Q=Sn.interpolationFactor(this.interpolation,M,A[k],A[k+1]),q=v[k].evaluate(u),te=v[k+1].evaluate(u);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return ri(q,te,Q);case"color":return yn.interpolate(q,te,Q);case"padding":return As.interpolate(q,te,Q);case"variableAnchorOffsetCollection":return Us.interpolate(q,te,Q);case"array":return lo(q,te,Q);case"projectionDefinition":return eo.interpolate(q,te,Q)}case"interpolate-hcl":return yn.interpolate(q,te,Q,"hcl");case"interpolate-lab":return yn.interpolate(q,te,Q,"lab")}}eachChild(u){u(this.input);for(const A of this.outputs)u(A)}outputDefined(){return this.outputs.every(u=>u.outputDefined())}}function Ko(p,u,A,v){const M=v-A,L=p-A;return M===0?0:u===1?L/M:(Math.pow(u,L)-1)/(Math.pow(u,M)-1)}const Ka={color:yn.interpolate,number:ri,padding:As.interpolate,variableAnchorOffsetCollection:Us.interpolate,array:lo};class go{constructor(u,A){this.type=u,this.args=A}static parse(u,A){if(u.length<2)return A.error("Expected at least one argument.");let v=null;const M=A.expectedType;M&&M.kind!=="value"&&(v=M);const L=[];for(const Q of u.slice(1)){const q=A.parse(Q,1+L.length,v,void 0,{typeAnnotation:"omit"});if(!q)return null;v=v||q.type,L.push(q)}if(!v)throw new Error("No output type");const k=M&&L.some(Q=>zi(M,Q.type));return new go(k?Rr:v,L)}evaluate(u){let A,v=null,M=0;for(const L of this.args)if(M++,v=L.evaluate(u),v&&v instanceof vs&&!v.available&&(A||(A=v.name),v=null,M===this.args.length&&(v=A)),v!==null)break;return v}eachChild(u){this.args.forEach(u)}outputDefined(){return this.args.every(u=>u.outputDefined())}}function $i(p,u){return p==="=="||p==="!="?u.kind==="boolean"||u.kind==="string"||u.kind==="number"||u.kind==="null"||u.kind==="value":u.kind==="string"||u.kind==="number"||u.kind==="value"}function Au(p,u,A,v){return v.compare(u,A)===0}function Ca(p,u,A){const v=p!=="=="&&p!=="!=";return class BZ{constructor(L,k,Q){this.type=Rt,this.lhs=L,this.rhs=k,this.collator=Q,this.hasUntypedArgument=L.type.kind==="value"||k.type.kind==="value"}static parse(L,k){if(L.length!==3&&L.length!==4)return k.error("Expected two or three arguments.");const Q=L[0];let q=k.parse(L[1],1,Rr);if(!q)return null;if(!$i(Q,q.type))return k.concat(1).error(`"${Q}" comparisons are not supported for type '${Un(q.type)}'.`);let te=k.parse(L[2],2,Rr);if(!te)return null;if(!$i(Q,te.type))return k.concat(2).error(`"${Q}" comparisons are not supported for type '${Un(te.type)}'.`);if(q.type.kind!==te.type.kind&&q.type.kind!=="value"&&te.type.kind!=="value")return k.error(`Cannot compare types '${Un(q.type)}' and '${Un(te.type)}'.`);v&&(q.type.kind==="value"&&te.type.kind!=="value"?q=new Ro(te.type,[q]):q.type.kind!=="value"&&te.type.kind==="value"&&(te=new Ro(q.type,[te])));let ae=null;if(L.length===4){if(q.type.kind!=="string"&&te.type.kind!=="string"&&q.type.kind!=="value"&&te.type.kind!=="value")return k.error("Cannot use collator to compare non-string types.");if(ae=k.parse(L[3],3,ln),!ae)return null}return new BZ(q,te,ae)}evaluate(L){const k=this.lhs.evaluate(L),Q=this.rhs.evaluate(L);if(v&&this.hasUntypedArgument){const q=ai(k),te=ai(Q);if(q.kind!==te.kind||q.kind!=="string"&&q.kind!=="number")throw new Gi(`Expected arguments for "${p}" to be (string, string) or (number, number), but found (${q.kind}, ${te.kind}) instead.`)}if(this.collator&&!v&&this.hasUntypedArgument){const q=ai(k),te=ai(Q);if(q.kind!=="string"||te.kind!=="string")return u(L,k,Q)}return this.collator?A(L,k,Q,this.collator.evaluate(L)):u(L,k,Q)}eachChild(L){L(this.lhs),L(this.rhs),this.collator&&L(this.collator)}outputDefined(){return!0}}}const Nh=Ca("==",function(p,u,A){return u===A},Au),pu=Ca("!=",function(p,u,A){return u!==A},function(p,u,A,v){return!Au(0,u,A,v)}),Uu=Ca("<",function(p,u,A){return u<A},function(p,u,A,v){return v.compare(u,A)<0}),gu=Ca(">",function(p,u,A){return u>A},function(p,u,A,v){return v.compare(u,A)>0}),fh=Ca("<=",function(p,u,A){return u<=A},function(p,u,A,v){return v.compare(u,A)<=0}),mu=Ca(">=",function(p,u,A){return u>=A},function(p,u,A,v){return v.compare(u,A)>=0});class xo{constructor(u,A,v){this.type=ln,this.locale=v,this.caseSensitive=u,this.diacriticSensitive=A}static parse(u,A){if(u.length!==2)return A.error("Expected one argument.");const v=u[1];if(typeof v!="object"||Array.isArray(v))return A.error("Collator options argument must be an object.");const M=A.parse(v["case-sensitive"]!==void 0&&v["case-sensitive"],1,Rt);if(!M)return null;const L=A.parse(v["diacritic-sensitive"]!==void 0&&v["diacritic-sensitive"],1,Rt);if(!L)return null;let k=null;return v.locale&&(k=A.parse(v.locale,1,Nt),!k)?null:new xo(M,L,k)}evaluate(u){return new Fc(this.caseSensitive.evaluate(u),this.diacriticSensitive.evaluate(u),this.locale?this.locale.evaluate(u):null)}eachChild(u){u(this.caseSensitive),u(this.diacriticSensitive),this.locale&&u(this.locale)}outputDefined(){return!1}}class wo{constructor(u,A,v,M,L){this.type=Nt,this.number=u,this.locale=A,this.currency=v,this.minFractionDigits=M,this.maxFractionDigits=L}static parse(u,A){if(u.length!==3)return A.error("Expected two arguments.");const v=A.parse(u[1],1,yt);if(!v)return null;const M=u[2];if(typeof M!="object"||Array.isArray(M))return A.error("NumberFormat options argument must be an object.");let L=null;if(M.locale&&(L=A.parse(M.locale,1,Nt),!L))return null;let k=null;if(M.currency&&(k=A.parse(M.currency,1,Nt),!k))return null;let Q=null;if(M["min-fraction-digits"]&&(Q=A.parse(M["min-fraction-digits"],1,yt),!Q))return null;let q=null;return M["max-fraction-digits"]&&(q=A.parse(M["max-fraction-digits"],1,yt),!q)?null:new wo(v,L,k,Q,q)}evaluate(u){return new Intl.NumberFormat(this.locale?this.locale.evaluate(u):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(u):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(u):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(u):void 0}).format(this.number.evaluate(u))}eachChild(u){u(this.number),this.locale&&u(this.locale),this.currency&&u(this.currency),this.minFractionDigits&&u(this.minFractionDigits),this.maxFractionDigits&&u(this.maxFractionDigits)}outputDefined(){return!1}}class Lc{constructor(u){this.type=Jn,this.sections=u}static parse(u,A){if(u.length<2)return A.error("Expected at least one argument.");const v=u[1];if(!Array.isArray(v)&&typeof v=="object")return A.error("First argument must be an image or text section.");const M=[];let L=!1;for(let k=1;k<=u.length-1;++k){const Q=u[k];if(L&&typeof Q=="object"&&!Array.isArray(Q)){L=!1;let q=null;if(Q["font-scale"]&&(q=A.parse(Q["font-scale"],1,yt),!q))return null;let te=null;if(Q["text-font"]&&(te=A.parse(Q["text-font"],1,Ln(Nt)),!te))return null;let ae=null;if(Q["text-color"]&&(ae=A.parse(Q["text-color"],1,dr),!ae))return null;let de=null;if(Q["vertical-align"]){if(typeof Q["vertical-align"]=="string"&&!hh.includes(Q["vertical-align"]))return A.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${Q["vertical-align"]}' instead.`);if(de=A.parse(Q["vertical-align"],1,Nt),!de)return null}const ye=M[M.length-1];ye.scale=q,ye.font=te,ye.textColor=ae,ye.verticalAlign=de}else{const q=A.parse(u[k],1,Rr);if(!q)return null;const te=q.type.kind;if(te!=="string"&&te!=="value"&&te!=="null"&&te!=="resolvedImage")return A.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");L=!0,M.push({content:q,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Lc(M)}evaluate(u){return new fs(this.sections.map(A=>{const v=A.content.evaluate(u);return ai(v)===jn?new $a("",v,null,null,null,A.verticalAlign?A.verticalAlign.evaluate(u):null):new $a(Dl(v),null,A.scale?A.scale.evaluate(u):null,A.font?A.font.evaluate(u).join(","):null,A.textColor?A.textColor.evaluate(u):null,A.verticalAlign?A.verticalAlign.evaluate(u):null)}))}eachChild(u){for(const A of this.sections)u(A.content),A.scale&&u(A.scale),A.font&&u(A.font),A.textColor&&u(A.textColor),A.verticalAlign&&u(A.verticalAlign)}outputDefined(){return!1}}class lc{constructor(u){this.type=jn,this.input=u}static parse(u,A){if(u.length!==2)return A.error("Expected two arguments.");const v=A.parse(u[1],1,Nt);return v?new lc(v):A.error("No image name provided.")}evaluate(u){const A=this.input.evaluate(u),v=vs.fromString(A);return v&&u.availableImages&&(v.available=u.availableImages.indexOf(A)>-1),v}eachChild(u){u(this.input)}outputDefined(){return!1}}class Dc{constructor(u){this.type=yt,this.input=u}static parse(u,A){if(u.length!==2)return A.error(`Expected 1 argument, but found ${u.length-1} instead.`);const v=A.parse(u[1],1);return v?v.type.kind!=="array"&&v.type.kind!=="string"&&v.type.kind!=="value"?A.error(`Expected argument of type string or array, but found ${Un(v.type)} instead.`):new Dc(v):null}evaluate(u){const A=this.input.evaluate(u);if(typeof A=="string")return[...A].length;if(Array.isArray(A))return A.length;throw new Gi(`Expected value to be of type string or array, but found ${Un(ai(A))} instead.`)}eachChild(u){u(this.input)}outputDefined(){return!1}}const Lo=8192;function cc(p,u){const A=(180+p[0])/360,v=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+p[1]*Math.PI/360)))/360,M=Math.pow(2,u.z);return[Math.round(A*M*Lo),Math.round(v*M*Lo)]}function Nu(p,u){const A=Math.pow(2,u.z);return[(M=(p[0]/Lo+u.x)/A,360*M-180),(v=(p[1]/Lo+u.y)/A,360/Math.PI*Math.atan(Math.exp((180-360*v)*Math.PI/180))-90)];var v,M}function gl(p,u){p[0]=Math.min(p[0],u[0]),p[1]=Math.min(p[1],u[1]),p[2]=Math.max(p[2],u[0]),p[3]=Math.max(p[3],u[1])}function uc(p,u){return!(p[0]<=u[0]||p[2]>=u[2]||p[1]<=u[1]||p[3]>=u[3])}function ne(p,u,A){const v=p[0]-u[0],M=p[1]-u[1],L=p[0]-A[0],k=p[1]-A[1];return v*k-L*M==0&&v*L<=0&&M*k<=0}function je(p,u,A,v){return(M=[v[0]-A[0],v[1]-A[1]])[0]*(L=[u[0]-p[0],u[1]-p[1]])[1]-M[1]*L[0]!=0&&!(!bn(p,u,A,v)||!bn(A,v,p,u));var M,L}function Tt(p,u,A){for(const v of A)for(let M=0;M<v.length-1;++M)if(je(p,u,v[M],v[M+1]))return!0;return!1}function Qt(p,u){let A=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,v=!1;for(const Q of u)for(let q=0;q<Q.length-1;q++){if(ne(p,Q[q],Q[q+1]))return A;(L=Q[q])[1]>(M=p)[1]!=(k=Q[q+1])[1]>M[1]&&M[0]<(k[0]-L[0])*(M[1]-L[1])/(k[1]-L[1])+L[0]&&(v=!v)}var M,L,k;return v}function rr(p,u){for(const A of u)if(Qt(p,A))return!0;return!1}function vr(p,u){for(const A of p)if(!Qt(A,u))return!1;for(let A=0;A<p.length-1;++A)if(Tt(p[A],p[A+1],u))return!1;return!0}function Xr(p,u){for(const A of u)if(vr(p,A))return!0;return!1}function bn(p,u,A,v){const M=v[0]-A[0],L=v[1]-A[1],k=(p[0]-A[0])*L-M*(p[1]-A[1]),Q=(u[0]-A[0])*L-M*(u[1]-A[1]);return k>0&&Q<0||k<0&&Q>0}function qn(p,u,A){const v=[];for(let M=0;M<p.length;M++){const L=[];for(let k=0;k<p[M].length;k++){const Q=cc(p[M][k],A);gl(u,Q),L.push(Q)}v.push(L)}return v}function li(p,u,A){const v=[];for(let M=0;M<p.length;M++){const L=qn(p[M],u,A);v.push(L)}return v}function fi(p,u,A,v){if(p[0]<A[0]||p[0]>A[2]){const M=.5*v;let L=p[0]-A[0]>M?-v:A[0]-p[0]>M?v:0;L===0&&(L=p[0]-A[2]>M?-v:A[2]-p[0]>M?v:0),p[0]+=L}gl(u,p)}function pi(p,u,A,v){const M=Math.pow(2,v.z)*Lo,L=[v.x*Lo,v.y*Lo],k=[];for(const Q of p)for(const q of Q){const te=[q.x+L[0],q.y+L[1]];fi(te,u,A,M),k.push(te)}return k}function as(p,u,A,v){const M=Math.pow(2,v.z)*Lo,L=[v.x*Lo,v.y*Lo],k=[];for(const q of p){const te=[];for(const ae of q){const de=[ae.x+L[0],ae.y+L[1]];gl(u,de),te.push(de)}k.push(te)}if(u[2]-u[0]<=M/2){(Q=u)[0]=Q[1]=1/0,Q[2]=Q[3]=-1/0;for(const q of k)for(const te of q)fi(te,u,A,M)}var Q;return k}class rs{constructor(u,A){this.type=Rt,this.geojson=u,this.geometries=A}static parse(u,A){if(u.length!==2)return A.error(`'within' expression requires exactly one argument, but found ${u.length-1} instead.`);if(oc(u[1])){const v=u[1];if(v.type==="FeatureCollection"){const M=[];for(const L of v.features){const{type:k,coordinates:Q}=L.geometry;k==="Polygon"&&M.push(Q),k==="MultiPolygon"&&M.push(...Q)}if(M.length)return new rs(v,{type:"MultiPolygon",coordinates:M})}else if(v.type==="Feature"){const M=v.geometry.type;if(M==="Polygon"||M==="MultiPolygon")return new rs(v,v.geometry)}else if(v.type==="Polygon"||v.type==="MultiPolygon")return new rs(v,v)}return A.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(u){if(u.geometry()!=null&&u.canonicalID()!=null){if(u.geometryType()==="Point")return function(A,v){const M=[1/0,1/0,-1/0,-1/0],L=[1/0,1/0,-1/0,-1/0],k=A.canonicalID();if(v.type==="Polygon"){const Q=qn(v.coordinates,L,k),q=pi(A.geometry(),M,L,k);if(!uc(M,L))return!1;for(const te of q)if(!Qt(te,Q))return!1}if(v.type==="MultiPolygon"){const Q=li(v.coordinates,L,k),q=pi(A.geometry(),M,L,k);if(!uc(M,L))return!1;for(const te of q)if(!rr(te,Q))return!1}return!0}(u,this.geometries);if(u.geometryType()==="LineString")return function(A,v){const M=[1/0,1/0,-1/0,-1/0],L=[1/0,1/0,-1/0,-1/0],k=A.canonicalID();if(v.type==="Polygon"){const Q=qn(v.coordinates,L,k),q=as(A.geometry(),M,L,k);if(!uc(M,L))return!1;for(const te of q)if(!vr(te,Q))return!1}if(v.type==="MultiPolygon"){const Q=li(v.coordinates,L,k),q=as(A.geometry(),M,L,k);if(!uc(M,L))return!1;for(const te of q)if(!Xr(te,Q))return!1}return!0}(u,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let gi=class{constructor(){let p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:(A,v)=>A<v?-1:A>v?1:0;if(this.data=p,this.length=this.data.length,this.compare=u,this.length>0)for(let A=(this.length>>1)-1;A>=0;A--)this._down(A)}push(p){this.data.push(p),this._up(this.length++)}pop(){if(this.length===0)return;const p=this.data[0],u=this.data.pop();return--this.length>0&&(this.data[0]=u,this._down(0)),p}peek(){return this.data[0]}_up(p){const{data:u,compare:A}=this,v=u[p];for(;p>0;){const M=p-1>>1,L=u[M];if(A(v,L)>=0)break;u[p]=L,p=M}u[p]=v}_down(p){const{data:u,compare:A}=this,v=this.length>>1,M=u[p];for(;p<v;){let L=1+(p<<1);const k=L+1;if(k<this.length&&A(u[k],u[L])<0&&(L=k),A(u[L],M)>=0)break;u[p]=u[L],p=L}u[p]=M}};function Do(p,u){let A=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,v=arguments.length>3&&arguments[3]!==void 0?arguments[3]:p.length-1,M=arguments.length>4&&arguments[4]!==void 0?arguments[4]:Wo;for(;v>A;){if(v-A>600){const q=v-A+1,te=u-A+1,ae=Math.log(q),de=.5*Math.exp(2*ae/3),ye=.5*Math.sqrt(ae*de*(q-de)/q)*(te-q/2<0?-1:1);Do(p,u,Math.max(A,Math.floor(u-te*de/q+ye)),Math.min(v,Math.floor(u+(q-te)*de/q+ye)),M)}const L=p[u];let k=A,Q=v;for(zn(p,A,u),M(p[v],L)>0&&zn(p,A,v);k<Q;){for(zn(p,k,Q),k++,Q--;M(p[k],L)<0;)k++;for(;M(p[Q],L)>0;)Q--}M(p[A],L)===0?zn(p,A,Q):(Q++,zn(p,Q,v)),Q<=u&&(A=Q+1),u<=Q&&(v=Q-1)}}function zn(p,u,A){const v=p[u];p[u]=p[A],p[A]=v}function Wo(p,u){return p<u?-1:p>u?1:0}function vi(p,u){if(p.length<=1)return[p];const A=[];let v,M;for(const L of p){const k=hc(L);k!==0&&(L.area=Math.abs(k),M===void 0&&(M=k<0),M===k<0?(v&&A.push(v),v=[L]):v.push(L))}if(v&&A.push(v),u>1)for(let L=0;L<A.length;L++)A[L].length<=u||(Do(A[L],u,1,A[L].length-1,Ti),A[L]=A[L].slice(0,u));return A}function Ti(p,u){return u.area-p.area}function hc(p){let u=0;for(let A,v,M=0,L=p.length,k=L-1;M<L;k=M++)A=p[M],v=p[k],u+=(v.x-A.x)*(A.y+v.y);return u}const Nl=1/298.257223563,zl=Nl*(2-Nl),Oc=Math.PI/180;class Wa{constructor(u){const A=6378.137*Oc*1e3,v=Math.cos(u*Oc),M=1/(1-zl*(1-v*v)),L=Math.sqrt(M);this.kx=A*L*v,this.ky=A*L*M*(1-zl)}distance(u,A){const v=this.wrap(u[0]-A[0])*this.kx,M=(u[1]-A[1])*this.ky;return Math.sqrt(v*v+M*M)}pointOnLine(u,A){let v,M,L,k,Q=1/0;for(let q=0;q<u.length-1;q++){let te=u[q][0],ae=u[q][1],de=this.wrap(u[q+1][0]-te)*this.kx,ye=(u[q+1][1]-ae)*this.ky,me=0;de===0&&ye===0||(me=(this.wrap(A[0]-te)*this.kx*de+(A[1]-ae)*this.ky*ye)/(de*de+ye*ye),me>1?(te=u[q+1][0],ae=u[q+1][1]):me>0&&(te+=de/this.kx*me,ae+=ye/this.ky*me)),de=this.wrap(A[0]-te)*this.kx,ye=(A[1]-ae)*this.ky;const Ie=de*de+ye*ye;Ie<Q&&(Q=Ie,v=te,M=ae,L=q,k=me)}return{point:[v,M],index:L,t:Math.max(0,Math.min(1,k))}}wrap(u){for(;u<-180;)u+=360;for(;u>180;)u-=360;return u}}function ml(p,u){return u[0]-p[0]}function no(p){return p[1]-p[0]+1}function Ps(p,u){return p[1]>=p[0]&&p[1]<u}function dc(p,u){if(p[0]>p[1])return[null,null];const A=no(p);if(u){if(A===2)return[p,null];const M=Math.floor(A/2);return[[p[0],p[0]+M],[p[0]+M,p[1]]]}if(A===1)return[p,null];const v=Math.floor(A/2)-1;return[[p[0],p[0]+v],[p[0]+v+1,p[1]]]}function fc(p,u){if(!Ps(u,p.length))return[1/0,1/0,-1/0,-1/0];const A=[1/0,1/0,-1/0,-1/0];for(let v=u[0];v<=u[1];++v)gl(A,p[v]);return A}function aa(p){const u=[1/0,1/0,-1/0,-1/0];for(const A of p)for(const v of A)gl(u,v);return u}function Ac(p){return p[0]!==-1/0&&p[1]!==-1/0&&p[2]!==1/0&&p[3]!==1/0}function co(p,u,A){if(!Ac(p)||!Ac(u))return NaN;let v=0,M=0;return p[2]<u[0]&&(v=u[0]-p[2]),p[0]>u[2]&&(v=p[0]-u[2]),p[1]>u[3]&&(M=p[1]-u[3]),p[3]<u[1]&&(M=u[1]-p[3]),A.distance([0,0],[v,M])}function Ea(p,u,A){const v=A.pointOnLine(u,p);return A.distance(p,v.point)}function Hl(p,u,A,v,M){const L=Math.min(Ea(p,[A,v],M),Ea(u,[A,v],M)),k=Math.min(Ea(A,[p,u],M),Ea(v,[p,u],M));return Math.min(L,k)}function Bi(p,u,A,v,M){if(!Ps(u,p.length)||!Ps(v,A.length))return 1/0;let L=1/0;for(let k=u[0];k<u[1];++k){const Q=p[k],q=p[k+1];for(let te=v[0];te<v[1];++te){const ae=A[te],de=A[te+1];if(je(Q,q,ae,de))return 0;L=Math.min(L,Hl(Q,q,ae,de,M))}}return L}function Xo(p,u,A,v,M){if(!Ps(u,p.length)||!Ps(v,A.length))return NaN;let L=1/0;for(let k=u[0];k<=u[1];++k)for(let Q=v[0];Q<=v[1];++Q)if(L=Math.min(L,M.distance(p[k],A[Q])),L===0)return L;return L}function pc(p,u,A){if(Qt(p,u,!0))return 0;let v=1/0;for(const M of u){const L=M[0],k=M[M.length-1];if(L!==k&&(v=Math.min(v,Ea(p,[k,L],A)),v===0))return v;const Q=A.pointOnLine(M,p);if(v=Math.min(v,A.distance(p,Q.point)),v===0)return v}return v}function vd(p,u,A,v){if(!Ps(u,p.length))return NaN;for(let L=u[0];L<=u[1];++L)if(Qt(p[L],A,!0))return 0;let M=1/0;for(let L=u[0];L<u[1];++L){const k=p[L],Q=p[L+1];for(const q of A)for(let te=0,ae=q.length,de=ae-1;te<ae;de=te++){const ye=q[de],me=q[te];if(je(k,Q,ye,me))return 0;M=Math.min(M,Hl(k,Q,ye,me,v))}}return M}function Ah(p,u){for(const A of p)for(const v of A)if(Qt(v,u,!0))return!0;return!1}function xi(p,u,A){let v=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1/0;const M=aa(p),L=aa(u);if(v!==1/0&&co(M,L,A)>=v)return v;if(uc(M,L)){if(Ah(p,u))return 0}else if(Ah(u,p))return 0;let k=1/0;for(const Q of p)for(let q=0,te=Q.length,ae=te-1;q<te;ae=q++){const de=Q[ae],ye=Q[q];for(const me of u)for(let Ie=0,ke=me.length,nt=ke-1;Ie<ke;nt=Ie++){const ct=me[nt],Ot=me[Ie];if(je(de,ye,ct,Ot))return 0;k=Math.min(k,Hl(de,ye,ct,Ot,A))}}return k}function Jo(p,u,A,v,M,L){if(!L)return;const k=co(fc(v,L),M,A);k<u&&p.push([k,L,[0,0]])}function Ta(p,u,A,v,M,L,k){if(!L||!k)return;const Q=co(fc(v,L),fc(M,k),A);Q<u&&p.push([Q,L,k])}function _l(p,u,A,v){let M=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1/0,L=Math.min(v.distance(p[0],A[0][0]),M);if(L===0)return L;const k=new gi([[0,[0,p.length-1],[0,0]]],ml),Q=aa(A);for(;k.length>0;){const q=k.pop();if(q[0]>=L)continue;const te=q[1],ae=u?50:100;if(no(te)<=ae){if(!Ps(te,p.length))return NaN;if(u){const de=vd(p,te,A,v);if(isNaN(de)||de===0)return de;L=Math.min(L,de)}else for(let de=te[0];de<=te[1];++de){const ye=pc(p[de],A,v);if(L=Math.min(L,ye),L===0)return 0}}else{const de=dc(te,u);Jo(k,L,v,p,Q,de[0]),Jo(k,L,v,p,Q,de[1])}}return L}function Bo(p,u,A,v,M){let L=arguments.length>5&&arguments[5]!==void 0?arguments[5]:1/0,k=Math.min(L,M.distance(p[0],A[0]));if(k===0)return k;const Q=new gi([[0,[0,p.length-1],[0,A.length-1]]],ml);for(;Q.length>0;){const q=Q.pop();if(q[0]>=k)continue;const te=q[1],ae=q[2],de=u?50:100,ye=v?50:100;if(no(te)<=de&&no(ae)<=ye){if(!Ps(te,p.length)&&Ps(ae,A.length))return NaN;let me;if(u&&v)me=Bi(p,te,A,ae,M),k=Math.min(k,me);else if(u&&!v){const Ie=p.slice(te[0],te[1]+1);for(let ke=ae[0];ke<=ae[1];++ke)if(me=Ea(A[ke],Ie,M),k=Math.min(k,me),k===0)return k}else if(!u&&v){const Ie=A.slice(ae[0],ae[1]+1);for(let ke=te[0];ke<=te[1];++ke)if(me=Ea(p[ke],Ie,M),k=Math.min(k,me),k===0)return k}else me=Xo(p,te,A,ae,M),k=Math.min(k,me)}else{const me=dc(te,u),Ie=dc(ae,v);Ta(Q,k,M,p,A,me[0],Ie[0]),Ta(Q,k,M,p,A,me[0],Ie[1]),Ta(Q,k,M,p,A,me[1],Ie[0]),Ta(Q,k,M,p,A,me[1],Ie[1])}}return k}function yl(p){return p.type==="MultiPolygon"?p.coordinates.map(u=>({type:"Polygon",coordinates:u})):p.type==="MultiLineString"?p.coordinates.map(u=>({type:"LineString",coordinates:u})):p.type==="MultiPoint"?p.coordinates.map(u=>({type:"Point",coordinates:u})):[p]}class la{constructor(u,A){this.type=yt,this.geojson=u,this.geometries=A}static parse(u,A){if(u.length!==2)return A.error(`'distance' expression requires exactly one argument, but found ${u.length-1} instead.`);if(oc(u[1])){const v=u[1];if(v.type==="FeatureCollection")return new la(v,v.features.map(M=>yl(M.geometry)).flat());if(v.type==="Feature")return new la(v,yl(v.geometry));if("type"in v&&"coordinates"in v)return new la(v,yl(v))}return A.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(u){if(u.geometry()!=null&&u.canonicalID()!=null){if(u.geometryType()==="Point")return function(A,v){const M=A.geometry(),L=M.flat().map(q=>Nu([q.x,q.y],A.canonical));if(M.length===0)return NaN;const k=new Wa(L[0][1]);let Q=1/0;for(const q of v){switch(q.type){case"Point":Q=Math.min(Q,Bo(L,!1,[q.coordinates],!1,k,Q));break;case"LineString":Q=Math.min(Q,Bo(L,!1,q.coordinates,!0,k,Q));break;case"Polygon":Q=Math.min(Q,_l(L,!1,q.coordinates,k,Q))}if(Q===0)return Q}return Q}(u,this.geometries);if(u.geometryType()==="LineString")return function(A,v){const M=A.geometry(),L=M.flat().map(q=>Nu([q.x,q.y],A.canonical));if(M.length===0)return NaN;const k=new Wa(L[0][1]);let Q=1/0;for(const q of v){switch(q.type){case"Point":Q=Math.min(Q,Bo(L,!0,[q.coordinates],!1,k,Q));break;case"LineString":Q=Math.min(Q,Bo(L,!0,q.coordinates,!0,k,Q));break;case"Polygon":Q=Math.min(Q,_l(L,!0,q.coordinates,k,Q))}if(Q===0)return Q}return Q}(u,this.geometries);if(u.geometryType()==="Polygon")return function(A,v){const M=A.geometry();if(M.length===0||M[0].length===0)return NaN;const L=vi(M,0).map(q=>q.map(te=>te.map(ae=>Nu([ae.x,ae.y],A.canonical)))),k=new Wa(L[0][0][0][1]);let Q=1/0;for(const q of v)for(const te of L){switch(q.type){case"Point":Q=Math.min(Q,_l([q.coordinates],!1,te,k,Q));break;case"LineString":Q=Math.min(Q,_l(q.coordinates,!0,te,k,Q));break;case"Polygon":Q=Math.min(Q,xi(te,q.coordinates,k,Q))}if(Q===0)return Q}return Q}(u,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const Oo={"==":Nh,"!=":pu,">":gu,"<":Uu,">=":mu,"<=":fh,array:Ro,at:ku,boolean:Ro,case:Ba,coalesce:go,collator:xo,format:Lc,image:lc,in:wi,"index-of":kl,interpolate:Sn,"interpolate-hcl":Sn,"interpolate-lab":Sn,length:Dc,let:Ai,literal:ps,match:ro,number:Ro,"number-format":wo,object:Ro,slice:ac,step:qa,string:Ro,"to-boolean":to,"to-color":to,"to-number":to,"to-string":to,var:si,within:rs,distance:la};class Co{constructor(u,A,v,M){this.name=u,this.type=A,this._evaluate=v,this.args=M}evaluate(u){return this._evaluate(u,this.args)}eachChild(u){this.args.forEach(u)}outputDefined(){return!1}static parse(u,A){const v=u[0],M=Co.definitions[v];if(!M)return A.error(`Unknown expression "${v}". If you wanted a literal array, use ["literal", [...]].`,0);const L=Array.isArray(M)?M[0]:M.type,k=Array.isArray(M)?[[M[1],M[2]]]:M.overloads,Q=k.filter(te=>{let[ae]=te;return!Array.isArray(ae)||ae.length===u.length-1});let q=null;for(const[te,ae]of Q){q=new Ol(A.registry,ca,A.path,null,A.scope);const de=[];let ye=!1;for(let me=1;me<u.length;me++){const Ie=u[me],ke=Array.isArray(te)?te[me-1]:te.type,nt=q.parse(Ie,1+de.length,ke);if(!nt){ye=!0;break}de.push(nt)}if(!ye)if(Array.isArray(te)&&te.length!==de.length)q.error(`Expected ${te.length} arguments, but found ${de.length} instead.`);else{for(let me=0;me<de.length;me++){const Ie=Array.isArray(te)?te[me]:te.type,ke=de[me];q.concat(me+1).checkSubtype(Ie,ke.type)}if(q.errors.length===0)return new Co(v,L,ae,de)}}if(Q.length===1)A.errors.push(...q.errors);else{const te=(Q.length?Q:k).map(de=>{let[ye]=de;return me=ye,Array.isArray(me)?`(${me.map(Un).join(", ")})`:`(${Un(me.type)}...)`;var me}).join(" | "),ae=[];for(let de=1;de<u.length;de++){const ye=A.parse(u[de],1+ae.length);if(!ye)return null;ae.push(Un(ye.type))}A.error(`Expected arguments of type ${te}, but found (${ae.join(", ")}) instead.`)}return null}static register(u,A){Co.definitions=A;for(const v in A)u[v]=Co}}function kc(p,u){let[A,v,M,L]=u;A=A.evaluate(p),v=v.evaluate(p),M=M.evaluate(p);const k=L?L.evaluate(p):1,Q=Rc(A,v,M,k);if(Q)throw new Gi(Q);return new yn(A/255,v/255,M/255,k,!1)}function bl(p,u){return p in u}function Eo(p,u){const A=u[p];return A===void 0?null:A}function uo(p){return{type:p}}function ca(p){if(p instanceof si)return ca(p.boundExpression);if(p instanceof Co&&p.name==="error"||p instanceof xo||p instanceof rs||p instanceof la)return!1;const u=p instanceof to||p instanceof Ro;let A=!0;return p.eachChild(v=>{A=u?A&&ca(v):A&&v instanceof ps}),!!A&&Vl(p)&&ua(p,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Vl(p){if(p instanceof Co&&(p.name==="get"&&p.args.length===1||p.name==="feature-state"||p.name==="has"&&p.args.length===1||p.name==="properties"||p.name==="geometry-type"||p.name==="id"||/^filter-/.test(p.name))||p instanceof rs||p instanceof la)return!1;let u=!0;return p.eachChild(A=>{u&&!Vl(A)&&(u=!1)}),u}function Zo(p){if(p instanceof Co&&p.name==="feature-state")return!1;let u=!0;return p.eachChild(A=>{u&&!Zo(A)&&(u=!1)}),u}function ua(p,u){if(p instanceof Co&&u.indexOf(p.name)>=0)return!1;let A=!0;return p.eachChild(v=>{A&&!ua(v,u)&&(A=!1)}),A}function Uc(p){return{result:"success",value:p}}function ho(p){return{result:"error",value:p}}function Yo(p){return p["property-type"]==="data-driven"||p["property-type"]==="cross-faded-data-driven"}function ls(p){return!!p.expression&&p.expression.parameters.indexOf("zoom")>-1}function ji(p){return!!p.expression&&p.expression.interpolated}function Kn(p){return p instanceof Number?"number":p instanceof String?"string":p instanceof Boolean?"boolean":Array.isArray(p)?"array":p===null?"null":typeof p}function Fs(p){return typeof p=="object"&&p!==null&&!Array.isArray(p)}function Xa(p){return p}function Ja(p,u){const A=u.type==="color",v=p.stops&&typeof p.stops[0][0]=="object",M=v||!(v||p.property!==void 0),L=p.type||(ji(u)?"exponential":"interval");if(A||u.type==="padding"){const ae=A?yn.parse:As.parse;(p=ht({},p)).stops&&(p.stops=p.stops.map(de=>[de[0],ae(de[1])])),p.default=ae(p.default?p.default:u.default)}if(p.colorSpace&&(k=p.colorSpace)!=="rgb"&&k!=="hcl"&&k!=="lab")throw new Error(`Unknown color space: "${p.colorSpace}"`);var k;let Q,q,te;if(L==="exponential")Q=xd;else if(L==="interval")Q=vf;else if(L==="categorical"){Q=vl,q=Object.create(null);for(const ae of p.stops)q[ae[0]]=ae[1];te=typeof p.stops[0][0]}else{if(L!=="identity")throw new Error(`Unknown function type "${L}"`);Q=Ns}if(v){const ae={},de=[];for(let Ie=0;Ie<p.stops.length;Ie++){const ke=p.stops[Ie],nt=ke[0].zoom;ae[nt]===void 0&&(ae[nt]={zoom:nt,type:p.type,property:p.property,default:p.default,stops:[]},de.push(nt)),ae[nt].stops.push([ke[0].value,ke[1]])}const ye=[];for(const Ie of de)ye.push([ae[Ie].zoom,Ja(ae[Ie],u)]);const me={name:"linear"};return{kind:"composite",interpolationType:me,interpolationFactor:Sn.interpolationFactor.bind(void 0,me),zoomStops:ye.map(Ie=>Ie[0]),evaluate:(Ie,ke)=>{let{zoom:nt}=Ie;return xd({stops:ye,base:p.base},u,nt).evaluate(nt,ke)}}}if(M){const ae=L==="exponential"?{name:"exponential",base:p.base!==void 0?p.base:1}:null;return{kind:"camera",interpolationType:ae,interpolationFactor:Sn.interpolationFactor.bind(void 0,ae),zoomStops:p.stops.map(de=>de[0]),evaluate:de=>{let{zoom:ye}=de;return Q(p,u,ye,q,te)}}}return{kind:"source",evaluate(ae,de){const ye=de&&de.properties?de.properties[p.property]:void 0;return ye===void 0?xs(p.default,u.default):Q(p,u,ye,q,te)}}}function xs(p,u,A){return p!==void 0?p:u!==void 0?u:A!==void 0?A:void 0}function vl(p,u,A,v,M){return xs(typeof A===M?v[A]:void 0,p.default,u.default)}function vf(p,u,A){if(Kn(A)!=="number")return xs(p.default,u.default);const v=p.stops.length;if(v===1||A<=p.stops[0][0])return p.stops[0][1];if(A>=p.stops[v-1][0])return p.stops[v-1][1];const M=ja(p.stops.map(L=>L[0]),A);return p.stops[M][1]}function xd(p,u,A){const v=p.base!==void 0?p.base:1;if(Kn(A)!=="number")return xs(p.default,u.default);const M=p.stops.length;if(M===1||A<=p.stops[0][0])return p.stops[0][1];if(A>=p.stops[M-1][0])return p.stops[M-1][1];const L=ja(p.stops.map(ae=>ae[0]),A),k=function(ae,de,ye,me){const Ie=me-ye,ke=ae-ye;return Ie===0?0:de===1?ke/Ie:(Math.pow(de,ke)-1)/(Math.pow(de,Ie)-1)}(A,v,p.stops[L][0],p.stops[L+1][0]),Q=p.stops[L][1],q=p.stops[L+1][1],te=Ka[u.type]||Xa;return typeof Q.evaluate=="function"?{evaluate(){for(var ae=arguments.length,de=new Array(ae),ye=0;ye<ae;ye++)de[ye]=arguments[ye];const me=Q.evaluate.apply(void 0,de),Ie=q.evaluate.apply(void 0,de);if(me!==void 0&&Ie!==void 0)return te(me,Ie,k,p.colorSpace)}}:te(Q,q,k,p.colorSpace)}function Ns(p,u,A){switch(u.type){case"color":A=yn.parse(A);break;case"formatted":A=fs.fromString(A.toString());break;case"resolvedImage":A=vs.fromString(A.toString());break;case"padding":A=As.parse(A);break;default:Kn(A)===u.type||u.type==="enum"&&u.values[A]||(A=void 0)}return xs(A,p.default,u.default)}Co.register(Oo,{error:[{kind:"error"},[Nt],(p,u)=>{let[A]=u;throw new Gi(A.evaluate(p))}],typeof:[Nt,[Rr],(p,u)=>{let[A]=u;return Un(ai(A.evaluate(p)))}],"to-rgba":[Ln(yt,4),[dr],(p,u)=>{let[A]=u;const[v,M,L,k]=A.evaluate(p).rgb;return[255*v,255*M,255*L,k]}],rgb:[dr,[yt,yt,yt],kc],rgba:[dr,[yt,yt,yt,yt],kc],has:{type:Rt,overloads:[[[Nt],(p,u)=>{let[A]=u;return bl(A.evaluate(p),p.properties())}],[[Nt,Pr],(p,u)=>{let[A,v]=u;return bl(A.evaluate(p),v.evaluate(p))}]]},get:{type:Rr,overloads:[[[Nt],(p,u)=>{let[A]=u;return Eo(A.evaluate(p),p.properties())}],[[Nt,Pr],(p,u)=>{let[A,v]=u;return Eo(A.evaluate(p),v.evaluate(p))}]]},"feature-state":[Rr,[Nt],(p,u)=>{let[A]=u;return Eo(A.evaluate(p),p.featureState||{})}],properties:[Pr,[],p=>p.properties()],"geometry-type":[Nt,[],p=>p.geometryType()],id:[Rr,[],p=>p.id()],zoom:[yt,[],p=>p.globals.zoom],"heatmap-density":[yt,[],p=>p.globals.heatmapDensity||0],"line-progress":[yt,[],p=>p.globals.lineProgress||0],accumulated:[Rr,[],p=>p.globals.accumulated===void 0?null:p.globals.accumulated],"+":[yt,uo(yt),(p,u)=>{let A=0;for(const v of u)A+=v.evaluate(p);return A}],"*":[yt,uo(yt),(p,u)=>{let A=1;for(const v of u)A*=v.evaluate(p);return A}],"-":{type:yt,overloads:[[[yt,yt],(p,u)=>{let[A,v]=u;return A.evaluate(p)-v.evaluate(p)}],[[yt],(p,u)=>{let[A]=u;return-A.evaluate(p)}]]},"/":[yt,[yt,yt],(p,u)=>{let[A,v]=u;return A.evaluate(p)/v.evaluate(p)}],"%":[yt,[yt,yt],(p,u)=>{let[A,v]=u;return A.evaluate(p)%v.evaluate(p)}],ln2:[yt,[],()=>Math.LN2],pi:[yt,[],()=>Math.PI],e:[yt,[],()=>Math.E],"^":[yt,[yt,yt],(p,u)=>{let[A,v]=u;return Math.pow(A.evaluate(p),v.evaluate(p))}],sqrt:[yt,[yt],(p,u)=>{let[A]=u;return Math.sqrt(A.evaluate(p))}],log10:[yt,[yt],(p,u)=>{let[A]=u;return Math.log(A.evaluate(p))/Math.LN10}],ln:[yt,[yt],(p,u)=>{let[A]=u;return Math.log(A.evaluate(p))}],log2:[yt,[yt],(p,u)=>{let[A]=u;return Math.log(A.evaluate(p))/Math.LN2}],sin:[yt,[yt],(p,u)=>{let[A]=u;return Math.sin(A.evaluate(p))}],cos:[yt,[yt],(p,u)=>{let[A]=u;return Math.cos(A.evaluate(p))}],tan:[yt,[yt],(p,u)=>{let[A]=u;return Math.tan(A.evaluate(p))}],asin:[yt,[yt],(p,u)=>{let[A]=u;return Math.asin(A.evaluate(p))}],acos:[yt,[yt],(p,u)=>{let[A]=u;return Math.acos(A.evaluate(p))}],atan:[yt,[yt],(p,u)=>{let[A]=u;return Math.atan(A.evaluate(p))}],min:[yt,uo(yt),(p,u)=>Math.min(...u.map(A=>A.evaluate(p)))],max:[yt,uo(yt),(p,u)=>Math.max(...u.map(A=>A.evaluate(p)))],abs:[yt,[yt],(p,u)=>{let[A]=u;return Math.abs(A.evaluate(p))}],round:[yt,[yt],(p,u)=>{let[A]=u;const v=A.evaluate(p);return v<0?-Math.round(-v):Math.round(v)}],floor:[yt,[yt],(p,u)=>{let[A]=u;return Math.floor(A.evaluate(p))}],ceil:[yt,[yt],(p,u)=>{let[A]=u;return Math.ceil(A.evaluate(p))}],"filter-==":[Rt,[Nt,Rr],(p,u)=>{let[A,v]=u;return p.properties()[A.value]===v.value}],"filter-id-==":[Rt,[Rr],(p,u)=>{let[A]=u;return p.id()===A.value}],"filter-type-==":[Rt,[Nt],(p,u)=>{let[A]=u;return p.geometryType()===A.value}],"filter-<":[Rt,[Nt,Rr],(p,u)=>{let[A,v]=u;const M=p.properties()[A.value],L=v.value;return typeof M==typeof L&&M<L}],"filter-id-<":[Rt,[Rr],(p,u)=>{let[A]=u;const v=p.id(),M=A.value;return typeof v==typeof M&&v<M}],"filter->":[Rt,[Nt,Rr],(p,u)=>{let[A,v]=u;const M=p.properties()[A.value],L=v.value;return typeof M==typeof L&&M>L}],"filter-id->":[Rt,[Rr],(p,u)=>{let[A]=u;const v=p.id(),M=A.value;return typeof v==typeof M&&v>M}],"filter-<=":[Rt,[Nt,Rr],(p,u)=>{let[A,v]=u;const M=p.properties()[A.value],L=v.value;return typeof M==typeof L&&M<=L}],"filter-id-<=":[Rt,[Rr],(p,u)=>{let[A]=u;const v=p.id(),M=A.value;return typeof v==typeof M&&v<=M}],"filter->=":[Rt,[Nt,Rr],(p,u)=>{let[A,v]=u;const M=p.properties()[A.value],L=v.value;return typeof M==typeof L&&M>=L}],"filter-id->=":[Rt,[Rr],(p,u)=>{let[A]=u;const v=p.id(),M=A.value;return typeof v==typeof M&&v>=M}],"filter-has":[Rt,[Rr],(p,u)=>{let[A]=u;return A.value in p.properties()}],"filter-has-id":[Rt,[],p=>p.id()!==null&&p.id()!==void 0],"filter-type-in":[Rt,[Ln(Nt)],(p,u)=>{let[A]=u;return A.value.indexOf(p.geometryType())>=0}],"filter-id-in":[Rt,[Ln(Rr)],(p,u)=>{let[A]=u;return A.value.indexOf(p.id())>=0}],"filter-in-small":[Rt,[Nt,Ln(Rr)],(p,u)=>{let[A,v]=u;return v.value.indexOf(p.properties()[A.value])>=0}],"filter-in-large":[Rt,[Nt,Ln(Rr)],(p,u)=>{let[A,v]=u;return function(M,L,k,Q){for(;k<=Q;){const q=k+Q>>1;if(L[q]===M)return!0;L[q]>M?Q=q-1:k=q+1}return!1}(p.properties()[A.value],v.value,0,v.value.length-1)}],all:{type:Rt,overloads:[[[Rt,Rt],(p,u)=>{let[A,v]=u;return A.evaluate(p)&&v.evaluate(p)}],[uo(Rt),(p,u)=>{for(const A of u)if(!A.evaluate(p))return!1;return!0}]]},any:{type:Rt,overloads:[[[Rt,Rt],(p,u)=>{let[A,v]=u;return A.evaluate(p)||v.evaluate(p)}],[uo(Rt),(p,u)=>{for(const A of u)if(A.evaluate(p))return!0;return!1}]]},"!":[Rt,[Rt],(p,u)=>{let[A]=u;return!A.evaluate(p)}],"is-supported-script":[Rt,[Nt],(p,u)=>{let[A]=u;const v=p.globals&&p.globals.isSupportedScript;return!v||v(A.evaluate(p))}],upcase:[Nt,[Nt],(p,u)=>{let[A]=u;return A.evaluate(p).toUpperCase()}],downcase:[Nt,[Nt],(p,u)=>{let[A]=u;return A.evaluate(p).toLowerCase()}],concat:[Nt,uo(Rr),(p,u)=>u.map(A=>Dl(A.evaluate(p))).join("")],"resolved-locale":[Nt,[ln],(p,u)=>{let[A]=u;return A.evaluate(p).resolvedLocale()}]});class ha{constructor(u,A){var v;this.expression=u,this._warningHistory={},this._evaluator=new Li,this._defaultValue=A?(v=A).type==="color"&&Fs(v.default)?new yn(0,0,0,0):v.type==="color"?yn.parse(v.default)||null:v.type==="padding"?As.parse(v.default)||null:v.type==="variableAnchorOffsetCollection"?Us.parse(v.default)||null:v.type==="projectionDefinition"?eo.parse(v.default)||null:v.default===void 0?null:v.default:null,this._enumValues=A&&A.type==="enum"?A.values:null}evaluateWithoutErrorHandling(u,A,v,M,L,k){return this._evaluator.globals=u,this._evaluator.feature=A,this._evaluator.featureState=v,this._evaluator.canonical=M,this._evaluator.availableImages=L||null,this._evaluator.formattedSection=k,this.expression.evaluate(this._evaluator)}evaluate(u,A,v,M,L,k){this._evaluator.globals=u,this._evaluator.feature=A||null,this._evaluator.featureState=v||null,this._evaluator.canonical=M,this._evaluator.availableImages=L||null,this._evaluator.formattedSection=k||null;try{const Q=this.expression.evaluate(this._evaluator);if(Q==null||typeof Q=="number"&&Q!=Q)return this._defaultValue;if(this._enumValues&&!(Q in this._enumValues))throw new Gi(`Expected value to be one of ${Object.keys(this._enumValues).map(q=>JSON.stringify(q)).join(", ")}, but found ${JSON.stringify(Q)} instead.`);return Q}catch(Q){return this._warningHistory[Q.message]||(this._warningHistory[Q.message]=!0,typeof console<"u"&&console.warn(Q.message)),this._defaultValue}}}function ko(p){return Array.isArray(p)&&p.length>0&&typeof p[0]=="string"&&p[0]in Oo}function Nc(p,u){const A=new Ol(Oo,ca,[],u?function(M){const L={color:dr,string:Nt,number:yt,enum:Nt,boolean:Rt,formatted:Jn,padding:_n,projectionDefinition:zr,resolvedImage:jn,variableAnchorOffsetCollection:Gn};return M.type==="array"?Ln(L[M.value]||Rr,M.length):L[M.type]}(u):void 0),v=A.parse(p,void 0,void 0,void 0,u&&u.type==="string"?{typeAnnotation:"coerce"}:void 0);return v?Uc(new ha(v,u)):ho(A.errors)}class gc{constructor(u,A){this.kind=u,this._styleExpression=A,this.isStateDependent=u!=="constant"&&!Zo(A.expression)}evaluateWithoutErrorHandling(u,A,v,M,L,k){return this._styleExpression.evaluateWithoutErrorHandling(u,A,v,M,L,k)}evaluate(u,A,v,M,L,k){return this._styleExpression.evaluate(u,A,v,M,L,k)}}class mc{constructor(u,A,v,M){this.kind=u,this.zoomStops=v,this._styleExpression=A,this.isStateDependent=u!=="camera"&&!Zo(A.expression),this.interpolationType=M}evaluateWithoutErrorHandling(u,A,v,M,L,k){return this._styleExpression.evaluateWithoutErrorHandling(u,A,v,M,L,k)}evaluate(u,A,v,M,L,k){return this._styleExpression.evaluate(u,A,v,M,L,k)}interpolationFactor(u,A,v){return this.interpolationType?Sn.interpolationFactor(this.interpolationType,u,A,v):0}}function mo(p,u){const A=Nc(p,u);if(A.result==="error")return A;const v=A.value.expression,M=Vl(v);if(!M&&!Yo(u))return ho([new At("","data expressions not supported")]);const L=ua(v,["zoom"]);if(!L&&!ls(u))return ho([new At("","zoom expressions not supported")]);const k=zc(v);return k||L?k instanceof At?ho([k]):k instanceof Sn&&!ji(u)?ho([new At("",'"interpolate" expressions cannot be used with this property')]):Uc(k?new mc(M?"camera":"composite",A.value,k.labels,k instanceof Sn?k.interpolation:void 0):new gc(M?"constant":"source",A.value)):ho([new At("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class zs{constructor(u,A){this._parameters=u,this._specification=A,ht(this,Ja(this._parameters,this._specification))}static deserialize(u){return new zs(u._parameters,u._specification)}static serialize(u){return{_parameters:u._parameters,_specification:u._specification}}}function zc(p){let u=null;if(p instanceof Ai)u=zc(p.result);else if(p instanceof go){for(const A of p.args)if(u=zc(A),u)break}else(p instanceof qa||p instanceof Sn)&&p.input instanceof Co&&p.input.name==="zoom"&&(u=p);return u instanceof At||p.eachChild(A=>{const v=zc(A);v instanceof At?u=v:!u&&v?u=new At("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):u&&v&&u!==v&&(u=new At("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),u}function Hc(p){if(p===!0||p===!1)return!0;if(!Array.isArray(p)||p.length===0)return!1;switch(p[0]){case"has":return p.length>=2&&p[1]!=="$id"&&p[1]!=="$type";case"in":return p.length>=3&&(typeof p[1]!="string"||Array.isArray(p[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return p.length!==3||Array.isArray(p[1])||Array.isArray(p[2]);case"any":case"all":for(const u of p.slice(1))if(!Hc(u)&&typeof u!="boolean")return!1;return!0;default:return!0}}const wd={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function _c(p){if(p==null)return{filter:()=>!0,needGeometry:!1};Hc(p)||(p=Gl(p));const u=Nc(p,wd);if(u.result==="error")throw new Error(u.value.map(A=>`${A.key}: ${A.message}`).join(", "));return{filter:(A,v,M)=>u.value.evaluate(A,v,{},M),needGeometry:ph(p)}}function zu(p,u){return p<u?-1:p>u?1:0}function ph(p){if(!Array.isArray(p))return!1;if(p[0]==="within"||p[0]==="distance")return!0;for(let u=1;u<p.length;u++)if(ph(p[u]))return!0;return!1}function Gl(p){if(!p)return!0;const u=p[0];return p.length<=1?u!=="any":u==="=="?Vc(p[1],p[2],"=="):u==="!="?Qc(Vc(p[1],p[2],"==")):u==="<"||u===">"||u==="<="||u===">="?Vc(p[1],p[2],u):u==="any"?(A=p.slice(1),["any"].concat(A.map(Gl))):u==="all"?["all"].concat(p.slice(1).map(Gl)):u==="none"?["all"].concat(p.slice(1).map(Gl).map(Qc)):u==="in"?Gc(p[1],p.slice(2)):u==="!in"?Qc(Gc(p[1],p.slice(2))):u==="has"?_u(p[1]):u!=="!has"||Qc(_u(p[1]));var A}function Vc(p,u,A){switch(p){case"$type":return[`filter-type-${A}`,u];case"$id":return[`filter-id-${A}`,u];default:return[`filter-${A}`,p,u]}}function Gc(p,u){if(u.length===0)return!1;switch(p){case"$type":return["filter-type-in",["literal",u]];case"$id":return["filter-id-in",["literal",u]];default:return u.length>200&&!u.some(A=>typeof A!=typeof u[0])?["filter-in-large",p,["literal",u.sort(zu)]]:["filter-in-small",p,["literal",u]]}}function _u(p){switch(p){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",p]}}function Qc(p){return["!",p]}function Hu(p){const u=typeof p;if(u==="number"||u==="boolean"||u==="string"||p==null)return JSON.stringify(p);if(Array.isArray(p)){let M="[";for(const L of p)M+=`${Hu(L)},`;return`${M}]`}const A=Object.keys(p).sort();let v="{";for(let M=0;M<A.length;M++)v+=`${JSON.stringify(A[M])}:${Hu(p[A[M]])},`;return`${v}}`}function zh(p){let u="";for(const A of He)u+=`/${Hu(p[A])}`;return u}function yu(p){const u=p.value;return u?[new Se(p.key,u,"constants have been deprecated as of v8")]:[]}function Qi(p){return p instanceof Number||p instanceof String||p instanceof Boolean?p.valueOf():p}function bu(p){if(Array.isArray(p))return p.map(bu);if(p instanceof Object&&!(p instanceof Number||p instanceof String||p instanceof Boolean)){const u={};for(const A in p)u[A]=bu(p[A]);return u}return Qi(p)}function Hs(p){const u=p.key,A=p.value,v=p.valueSpec||{},M=p.objectElementValidators||{},L=p.style,k=p.styleSpec,Q=p.validateSpec;let q=[];const te=Kn(A);if(te!=="object")return[new Se(u,A,`object expected, ${te} found`)];for(const ae in A){const de=ae.split(".")[0],ye=v[de]||v["*"];let me;if(M[de])me=M[de];else if(v[de])me=Q;else if(M["*"])me=M["*"];else{if(!v["*"]){q.push(new Se(u,A[ae],`unknown property "${ae}"`));continue}me=Q}q=q.concat(me({key:(u&&`${u}.`)+ae,value:A[ae],valueSpec:ye,style:L,styleSpec:k,object:A,objectKey:ae,validateSpec:Q},A))}for(const ae in v)M[ae]||v[ae].required&&v[ae].default===void 0&&A[ae]===void 0&&q.push(new Se(u,A,`missing required property "${ae}"`));return q}function xl(p){const u=p.value,A=p.valueSpec,v=p.style,M=p.styleSpec,L=p.key,k=p.arrayElementValidator||p.validateSpec;if(Kn(u)!=="array")return[new Se(L,u,`array expected, ${Kn(u)} found`)];if(A.length&&u.length!==A.length)return[new Se(L,u,`array length ${A.length} expected, length ${u.length} found`)];if(A["min-length"]&&u.length<A["min-length"])return[new Se(L,u,`array length at least ${A["min-length"]} expected, length ${u.length} found`)];let Q={type:A.value,values:A.values};M.$version<7&&(Q.function=A.function),Kn(A.value)==="object"&&(Q=A.value);let q=[];for(let te=0;te<u.length;te++)q=q.concat(k({array:u,arrayIndex:te,value:u[te],valueSpec:Q,validateSpec:p.validateSpec,style:v,styleSpec:M,key:`${L}[${te}]`}));return q}function Hh(p){const u=p.key,A=p.value,v=p.valueSpec;let M=Kn(A);return M==="number"&&A!=A&&(M="NaN"),M!=="number"?[new Se(u,A,`number expected, ${M} found`)]:"minimum"in v&&A<v.minimum?[new Se(u,A,`${A} is less than the minimum value ${v.minimum}`)]:"maximum"in v&&A>v.maximum?[new Se(u,A,`${A} is greater than the maximum value ${v.maximum}`)]:[]}function Sa(p){const u=p.valueSpec,A=Qi(p.value.type);let v,M,L,k={};const Q=A!=="categorical"&&p.value.property===void 0,q=!Q,te=Kn(p.value.stops)==="array"&&Kn(p.value.stops[0])==="array"&&Kn(p.value.stops[0][0])==="object",ae=Hs({key:p.key,value:p.value,valueSpec:p.styleSpec.function,validateSpec:p.validateSpec,style:p.style,styleSpec:p.styleSpec,objectElementValidators:{stops:function(me){if(A==="identity")return[new Se(me.key,me.value,'identity function may not have a "stops" property')];let Ie=[];const ke=me.value;return Ie=Ie.concat(xl({key:me.key,value:ke,valueSpec:me.valueSpec,validateSpec:me.validateSpec,style:me.style,styleSpec:me.styleSpec,arrayElementValidator:de})),Kn(ke)==="array"&&ke.length===0&&Ie.push(new Se(me.key,ke,"array must have at least one stop")),Ie},default:function(me){return me.validateSpec({key:me.key,value:me.value,valueSpec:u,validateSpec:me.validateSpec,style:me.style,styleSpec:me.styleSpec})}}});return A==="identity"&&Q&&ae.push(new Se(p.key,p.value,'missing required property "property"')),A==="identity"||p.value.stops||ae.push(new Se(p.key,p.value,'missing required property "stops"')),A==="exponential"&&p.valueSpec.expression&&!ji(p.valueSpec)&&ae.push(new Se(p.key,p.value,"exponential functions not supported")),p.styleSpec.$version>=8&&(q&&!Yo(p.valueSpec)?ae.push(new Se(p.key,p.value,"property functions not supported")):Q&&!ls(p.valueSpec)&&ae.push(new Se(p.key,p.value,"zoom functions not supported"))),A!=="categorical"&&!te||p.value.property!==void 0||ae.push(new Se(p.key,p.value,'"property" property is required')),ae;function de(me){let Ie=[];const ke=me.value,nt=me.key;if(Kn(ke)!=="array")return[new Se(nt,ke,`array expected, ${Kn(ke)} found`)];if(ke.length!==2)return[new Se(nt,ke,`array length 2 expected, length ${ke.length} found`)];if(te){if(Kn(ke[0])!=="object")return[new Se(nt,ke,`object expected, ${Kn(ke[0])} found`)];if(ke[0].zoom===void 0)return[new Se(nt,ke,"object stop key must have zoom")];if(ke[0].value===void 0)return[new Se(nt,ke,"object stop key must have value")];if(L&&L>Qi(ke[0].zoom))return[new Se(nt,ke[0].zoom,"stop zoom values must appear in ascending order")];Qi(ke[0].zoom)!==L&&(L=Qi(ke[0].zoom),M=void 0,k={}),Ie=Ie.concat(Hs({key:`${nt}[0]`,value:ke[0],valueSpec:{zoom:{}},validateSpec:me.validateSpec,style:me.style,styleSpec:me.styleSpec,objectElementValidators:{zoom:Hh,value:ye}}))}else Ie=Ie.concat(ye({key:`${nt}[0]`,value:ke[0],valueSpec:{},validateSpec:me.validateSpec,style:me.style,styleSpec:me.styleSpec},ke));return ko(bu(ke[1]))?Ie.concat([new Se(`${nt}[1]`,ke[1],"expressions are not allowed in function stops.")]):Ie.concat(me.validateSpec({key:`${nt}[1]`,value:ke[1],valueSpec:u,validateSpec:me.validateSpec,style:me.style,styleSpec:me.styleSpec}))}function ye(me,Ie){const ke=Kn(me.value),nt=Qi(me.value),ct=me.value!==null?me.value:Ie;if(v){if(ke!==v)return[new Se(me.key,ct,`${ke} stop domain type must match previous stop domain type ${v}`)]}else v=ke;if(ke!=="number"&&ke!=="string"&&ke!=="boolean")return[new Se(me.key,ct,"stop domain value must be a number, string, or boolean")];if(ke!=="number"&&A!=="categorical"){let Ot=`number expected, ${ke} found`;return Yo(u)&&A===void 0&&(Ot+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Se(me.key,ct,Ot)]}return A!=="categorical"||ke!=="number"||isFinite(nt)&&Math.floor(nt)===nt?A!=="categorical"&&ke==="number"&&M!==void 0&&nt<M?[new Se(me.key,ct,"stop domain values must appear in ascending order")]:(M=nt,A==="categorical"&&nt in k?[new Se(me.key,ct,"stop domain values must be unique")]:(k[nt]=!0,[])):[new Se(me.key,ct,`integer expected, found ${nt}`)]}}function Ia(p){const u=(p.expressionContext==="property"?mo:Nc)(bu(p.value),p.valueSpec);if(u.result==="error")return u.value.map(v=>new Se(`${p.key}${v.key}`,p.value,v.message));const A=u.value.expression||u.value._styleExpression.expression;if(p.expressionContext==="property"&&p.propertyKey==="text-font"&&!A.outputDefined())return[new Se(p.key,p.value,`Invalid data expression for "${p.propertyKey}". Output values must be contained as literals within the expression.`)];if(p.expressionContext==="property"&&p.propertyType==="layout"&&!Zo(A))return[new Se(p.key,p.value,'"feature-state" data expressions are not supported with layout properties.')];if(p.expressionContext==="filter"&&!Zo(A))return[new Se(p.key,p.value,'"feature-state" data expressions are not supported with filters.')];if(p.expressionContext&&p.expressionContext.indexOf("cluster")===0){if(!ua(A,["zoom","feature-state"]))return[new Se(p.key,p.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(p.expressionContext==="cluster-initial"&&!Vl(A))return[new Se(p.key,p.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function yc(p){const u=p.key,A=p.value,v=p.valueSpec,M=[];return Array.isArray(v.values)?v.values.indexOf(Qi(A))===-1&&M.push(new Se(u,A,`expected one of [${v.values.join(", ")}], ${JSON.stringify(A)} found`)):Object.keys(v.values).indexOf(Qi(A))===-1&&M.push(new Se(u,A,`expected one of [${Object.keys(v.values).join(", ")}], ${JSON.stringify(A)} found`)),M}function Bd(p){return Hc(bu(p.value))?Ia(ht({},p,{expressionContext:"filter",valueSpec:{value:"boolean"}})):gh(p)}function gh(p){const u=p.value,A=p.key;if(Kn(u)!=="array")return[new Se(A,u,`array expected, ${Kn(u)} found`)];const v=p.styleSpec;let M,L=[];if(u.length<1)return[new Se(A,u,"filter array must have at least 1 element")];switch(L=L.concat(yc({key:`${A}[0]`,value:u[0],valueSpec:v.filter_operator,style:p.style,styleSpec:p.styleSpec})),Qi(u[0])){case"<":case"<=":case">":case">=":u.length>=2&&Qi(u[1])==="$type"&&L.push(new Se(A,u,`"$type" cannot be use with operator "${u[0]}"`));case"==":case"!=":u.length!==3&&L.push(new Se(A,u,`filter array for operator "${u[0]}" must have 3 elements`));case"in":case"!in":u.length>=2&&(M=Kn(u[1]),M!=="string"&&L.push(new Se(`${A}[1]`,u[1],`string expected, ${M} found`)));for(let k=2;k<u.length;k++)M=Kn(u[k]),Qi(u[1])==="$type"?L=L.concat(yc({key:`${A}[${k}]`,value:u[k],valueSpec:v.geometry_type,style:p.style,styleSpec:p.styleSpec})):M!=="string"&&M!=="number"&&M!=="boolean"&&L.push(new Se(`${A}[${k}]`,u[k],`string, number, or boolean expected, ${M} found`));break;case"any":case"all":case"none":for(let k=1;k<u.length;k++)L=L.concat(gh({key:`${A}[${k}]`,value:u[k],style:p.style,styleSpec:p.styleSpec}));break;case"has":case"!has":M=Kn(u[1]),u.length!==2?L.push(new Se(A,u,`filter array for "${u[0]}" operator must have 2 elements`)):M!=="string"&&L.push(new Se(`${A}[1]`,u[1],`string expected, ${M} found`))}return L}function Cd(p,u){const A=p.key,v=p.validateSpec,M=p.style,L=p.styleSpec,k=p.value,Q=p.objectKey,q=L[`${u}_${p.layerType}`];if(!q)return[];const te=Q.match(/^(.*)-transition$/);if(u==="paint"&&te&&q[te[1]]&&q[te[1]].transition)return v({key:A,value:k,valueSpec:L.transition,style:M,styleSpec:L});const ae=p.valueSpec||q[Q];if(!ae)return[new Se(A,k,`unknown property "${Q}"`)];let de;if(Kn(k)==="string"&&Yo(ae)&&!ae.tokens&&(de=/^{([^}]+)}$/.exec(k)))return[new Se(A,k,`"${Q}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(de[1])} }\`.`)];const ye=[];return p.layerType==="symbol"&&(Q==="text-field"&&M&&!M.glyphs&&ye.push(new Se(A,k,'use of "text-field" requires a style "glyphs" property')),Q==="text-font"&&Fs(bu(k))&&Qi(k.type)==="identity"&&ye.push(new Se(A,k,'"text-font" does not support identity functions'))),ye.concat(v({key:p.key,value:k,valueSpec:ae,style:M,styleSpec:L,expressionContext:"property",propertyType:u,propertyKey:Q}))}function Vh(p){return Cd(p,"paint")}function vu(p){return Cd(p,"layout")}function Za(p){let u=[];const A=p.value,v=p.key,M=p.style,L=p.styleSpec;A.type||A.ref||u.push(new Se(v,A,'either "type" or "ref" is required'));let k=Qi(A.type);const Q=Qi(A.ref);if(A.id){const q=Qi(A.id);for(let te=0;te<p.arrayIndex;te++){const ae=M.layers[te];Qi(ae.id)===q&&u.push(new Se(v,A.id,`duplicate layer id "${A.id}", previously used at line ${ae.id.__line__}`))}}if("ref"in A){let q;["type","source","source-layer","filter","layout"].forEach(te=>{te in A&&u.push(new Se(v,A[te],`"${te}" is prohibited for ref layers`))}),M.layers.forEach(te=>{Qi(te.id)===Q&&(q=te)}),q?q.ref?u.push(new Se(v,A.ref,"ref cannot reference another ref layer")):k=Qi(q.type):u.push(new Se(v,A.ref,`ref layer "${Q}" not found`))}else if(k!=="background")if(A.source){const q=M.sources&&M.sources[A.source],te=q&&Qi(q.type);q?te==="vector"&&k==="raster"?u.push(new Se(v,A.source,`layer "${A.id}" requires a raster source`)):te!=="raster-dem"&&k==="hillshade"?u.push(new Se(v,A.source,`layer "${A.id}" requires a raster-dem source`)):te==="raster"&&k!=="raster"?u.push(new Se(v,A.source,`layer "${A.id}" requires a vector source`)):te!=="vector"||A["source-layer"]?te==="raster-dem"&&k!=="hillshade"?u.push(new Se(v,A.source,"raster-dem source can only be used with layer type 'hillshade'.")):k!=="line"||!A.paint||!A.paint["line-gradient"]||te==="geojson"&&q.lineMetrics||u.push(new Se(v,A,`layer "${A.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):u.push(new Se(v,A,`layer "${A.id}" must specify a "source-layer"`)):u.push(new Se(v,A.source,`source "${A.source}" not found`))}else u.push(new Se(v,A,'missing required property "source"'));return u=u.concat(Hs({key:v,value:A,valueSpec:L.layer,style:p.style,styleSpec:p.styleSpec,validateSpec:p.validateSpec,objectElementValidators:{"*":()=>[],type:()=>p.validateSpec({key:`${v}.type`,value:A.type,valueSpec:L.layer.type,style:p.style,styleSpec:p.styleSpec,validateSpec:p.validateSpec,object:A,objectKey:"type"}),filter:Bd,layout:q=>Hs({layer:A,key:q.key,value:q.value,style:q.style,styleSpec:q.styleSpec,validateSpec:q.validateSpec,objectElementValidators:{"*":te=>vu(ht({layerType:k},te))}}),paint:q=>Hs({layer:A,key:q.key,value:q.value,style:q.style,styleSpec:q.styleSpec,validateSpec:q.validateSpec,objectElementValidators:{"*":te=>Vh(ht({layerType:k},te))}})}})),u}function pn(p){const u=p.value,A=p.key,v=Kn(u);return v!=="string"?[new Se(A,u,`string expected, ${v} found`)]:[]}const Ya={promoteId:function(p){let{key:u,value:A}=p;if(Kn(A)==="string")return pn({key:u,value:A});{const v=[];for(const M in A)v.push(...pn({key:`${u}.${M}`,value:A[M]}));return v}}};function To(p){const u=p.value,A=p.key,v=p.styleSpec,M=p.style,L=p.validateSpec;if(!u.type)return[new Se(A,u,'"type" is required')];const k=Qi(u.type);let Q;switch(k){case"vector":case"raster":return Q=Hs({key:A,value:u,valueSpec:v[`source_${k.replace("-","_")}`],style:p.style,styleSpec:v,objectElementValidators:Ya,validateSpec:L}),Q;case"raster-dem":return Q=function(q){var te;const ae=(te=q.sourceName)!==null&&te!==void 0?te:"",de=q.value,ye=q.styleSpec,me=ye.source_raster_dem,Ie=q.style;let ke=[];const nt=Kn(de);if(de===void 0)return ke;if(nt!=="object")return ke.push(new Se("source_raster_dem",de,`object expected, ${nt} found`)),ke;const ct=Qi(de.encoding)==="custom",Ot=["redFactor","greenFactor","blueFactor","baseShift"],wt=q.value.encoding?`"${q.value.encoding}"`:"Default";for(const Re in de)!ct&&Ot.includes(Re)?ke.push(new Se(Re,de[Re],`In "${ae}": "${Re}" is only valid when "encoding" is set to "custom". ${wt} encoding found`)):me[Re]?ke=ke.concat(q.validateSpec({key:Re,value:de[Re],valueSpec:me[Re],validateSpec:q.validateSpec,style:Ie,styleSpec:ye})):ke.push(new Se(Re,de[Re],`unknown property "${Re}"`));return ke}({sourceName:A,value:u,style:p.style,styleSpec:v,validateSpec:L}),Q;case"geojson":if(Q=Hs({key:A,value:u,valueSpec:v.source_geojson,style:M,styleSpec:v,validateSpec:L,objectElementValidators:Ya}),u.cluster)for(const q in u.clusterProperties){const[te,ae]=u.clusterProperties[q],de=typeof te=="string"?[te,["accumulated"],["get",q]]:te;Q.push(...Ia({key:`${A}.${q}.map`,value:ae,validateSpec:L,expressionContext:"cluster-map"})),Q.push(...Ia({key:`${A}.${q}.reduce`,value:de,validateSpec:L,expressionContext:"cluster-reduce"}))}return Q;case"video":return Hs({key:A,value:u,valueSpec:v.source_video,style:M,validateSpec:L,styleSpec:v});case"image":return Hs({key:A,value:u,valueSpec:v.source_image,style:M,validateSpec:L,styleSpec:v});case"canvas":return[new Se(A,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return yc({key:`${A}.type`,value:u.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:M,validateSpec:L,styleSpec:v})}}function Ql(p){const u=p.value,A=p.styleSpec,v=A.light,M=p.style;let L=[];const k=Kn(u);if(u===void 0)return L;if(k!=="object")return L=L.concat([new Se("light",u,`object expected, ${k} found`)]),L;for(const Q in u){const q=Q.match(/^(.*)-transition$/);L=L.concat(q&&v[q[1]]&&v[q[1]].transition?p.validateSpec({key:Q,value:u[Q],valueSpec:A.transition,validateSpec:p.validateSpec,style:M,styleSpec:A}):v[Q]?p.validateSpec({key:Q,value:u[Q],valueSpec:v[Q],validateSpec:p.validateSpec,style:M,styleSpec:A}):[new Se(Q,u[Q],`unknown property "${Q}"`)])}return L}function Vu(p){const u=p.value,A=p.styleSpec,v=A.sky,M=p.style,L=Kn(u);if(u===void 0)return[];if(L!=="object")return[new Se("sky",u,`object expected, ${L} found`)];let k=[];for(const Q in u)k=k.concat(v[Q]?p.validateSpec({key:Q,value:u[Q],valueSpec:v[Q],style:M,styleSpec:A}):[new Se(Q,u[Q],`unknown property "${Q}"`)]);return k}function xu(p){const u=p.value,A=p.styleSpec,v=A.terrain,M=p.style;let L=[];const k=Kn(u);if(u===void 0)return L;if(k!=="object")return L=L.concat([new Se("terrain",u,`object expected, ${k} found`)]),L;for(const Q in u)L=L.concat(v[Q]?p.validateSpec({key:Q,value:u[Q],valueSpec:v[Q],validateSpec:p.validateSpec,style:M,styleSpec:A}):[new Se(Q,u[Q],`unknown property "${Q}"`)]);return L}function $l(p){let u=[];const A=p.value,v=p.key;if(Array.isArray(A)){const M=[],L=[];for(const k in A)A[k].id&&M.includes(A[k].id)&&u.push(new Se(v,A,`all the sprites' ids must be unique, but ${A[k].id} is duplicated`)),M.push(A[k].id),A[k].url&&L.includes(A[k].url)&&u.push(new Se(v,A,`all the sprites' URLs must be unique, but ${A[k].url} is duplicated`)),L.push(A[k].url),u=u.concat(Hs({key:`${v}[${k}]`,value:A[k],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:p.validateSpec}));return u}return pn({key:v,value:A})}const ni={"*":()=>[],array:xl,boolean:function(p){const u=p.value,A=p.key,v=Kn(u);return v!=="boolean"?[new Se(A,u,`boolean expected, ${v} found`)]:[]},number:Hh,color:function(p){const u=p.key,A=p.value,v=Kn(A);return v!=="string"?[new Se(u,A,`color expected, ${v} found`)]:yn.parse(String(A))?[]:[new Se(u,A,`color expected, "${A}" found`)]},constants:yu,enum:yc,filter:Bd,function:Sa,layer:Za,object:Hs,source:To,light:Ql,sky:Vu,terrain:xu,projection:function(p){const u=p.value,A=p.styleSpec,v=A.projection,M=p.style,L=Kn(u);if(u===void 0)return[];if(L!=="object")return[new Se("projection",u,`object expected, ${L} found`)];let k=[];for(const Q in u)k=k.concat(v[Q]?p.validateSpec({key:Q,value:u[Q],valueSpec:v[Q],style:M,styleSpec:A}):[new Se(Q,u[Q],`unknown property "${Q}"`)]);return k},projectionDefinition:function(p){const u=p.key;let A=p.value;A=A instanceof String?A.valueOf():A;const v=Kn(A);return v!=="array"||function(M){return Array.isArray(M)&&M.length===3&&typeof M[0]=="string"&&typeof M[1]=="string"&&typeof M[2]=="number"}(A)||function(M){return!!["interpolate","step","literal"].includes(M[0])}(A)?["array","string"].includes(v)?[]:[new Se(u,A,`projection expected, invalid type "${v}" found`)]:[new Se(u,A,`projection expected, invalid array ${JSON.stringify(A)} found`)]},string:pn,formatted:function(p){return pn(p).length===0?[]:Ia(p)},resolvedImage:function(p){return pn(p).length===0?[]:Ia(p)},padding:function(p){const u=p.key,A=p.value;if(Kn(A)==="array"){if(A.length<1||A.length>4)return[new Se(u,A,`padding requires 1 to 4 values; ${A.length} values found`)];const v={type:"number"};let M=[];for(let L=0;L<A.length;L++)M=M.concat(p.validateSpec({key:`${u}[${L}]`,value:A[L],validateSpec:p.validateSpec,valueSpec:v}));return M}return Hh({key:u,value:A,valueSpec:{}})},variableAnchorOffsetCollection:function(p){const u=p.key,A=p.value,v=Kn(A),M=p.styleSpec;if(v!=="array"||A.length<1||A.length%2!=0)return[new Se(u,A,"variableAnchorOffsetCollection requires a non-empty array of even length")];let L=[];for(let k=0;k<A.length;k+=2)L=L.concat(yc({key:`${u}[${k}]`,value:A[k],valueSpec:M.layout_symbol["text-anchor"]})),L=L.concat(xl({key:`${u}[${k+1}]`,value:A[k+1],valueSpec:{length:2,value:"number"},validateSpec:p.validateSpec,style:p.style,styleSpec:M}));return L},sprite:$l};function Gu(p){const u=p.value,A=p.valueSpec,v=p.styleSpec;return p.validateSpec=Gu,A.expression&&Fs(Qi(u))?Sa(p):A.expression&&ko(bu(u))?Ia(p):A.type&&ni[A.type]?ni[A.type](p):Hs(ht({},p,{valueSpec:A.type?v[A.type]:A}))}function mh(p){const u=p.value,A=p.key,v=pn(p);return v.length||(u.indexOf("{fontstack}")===-1&&v.push(new Se(A,u,'"glyphs" url must include a "{fontstack}" token')),u.indexOf("{range}")===-1&&v.push(new Se(A,u,'"glyphs" url must include a "{range}" token'))),v}function So(p){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Xe,A=[];return A=A.concat(Gu({key:"",value:p,valueSpec:u.$root,styleSpec:u,style:p,validateSpec:Gu,objectElementValidators:{glyphs:mh,"*":()=>[]}})),p.constants&&(A=A.concat(yu({key:"constants",value:p.constants,style:p,styleSpec:u,validateSpec:Gu}))),wl(A)}function Vs(p){return function(u){return p({...u,validateSpec:Gu})}}function wl(p){return[].concat(p).sort((u,A)=>u.line-A.line)}function el(p){return function(){for(var u=arguments.length,A=new Array(u),v=0;v<u;v++)A[v]=arguments[v];return wl(p.apply(this,A))}}So.source=el(Vs(To)),So.sprite=el(Vs($l)),So.glyphs=el(Vs(mh)),So.light=el(Vs(Ql)),So.sky=el(Vs(Vu)),So.terrain=el(Vs(xu)),So.layer=el(Vs(Za)),So.filter=el(Vs(Bd)),So.paintProperty=el(Vs(Vh)),So.layoutProperty=el(Vs(vu));const wu=So,Gh=wu.light,Bu=wu.sky,Cu=wu.paintProperty,Qh=wu.layoutProperty;function xf(p,u){let A=!1;if(u&&u.length)for(const v of u)p.fire(new Cr(new Error(v.message))),A=!0;return A}class _o{constructor(u,A,v){const M=this.cells=[];if(u instanceof ArrayBuffer){this.arrayBuffer=u;const k=new Int32Array(this.arrayBuffer);u=k[0],this.d=(A=k[1])+2*(v=k[2]);for(let q=0;q<this.d*this.d;q++){const te=k[3+q],ae=k[3+q+1];M.push(te===ae?null:k.subarray(te,ae))}const Q=k[3+M.length+1];this.keys=k.subarray(k[3+M.length],Q),this.bboxes=k.subarray(Q),this.insert=this._insertReadonly}else{this.d=A+2*v;for(let k=0;k<this.d*this.d;k++)M.push([]);this.keys=[],this.bboxes=[]}this.n=A,this.extent=u,this.padding=v,this.scale=A/u,this.uid=0;const L=v/A*u;this.min=-L,this.max=u+L}insert(u,A,v,M,L){this._forEachCell(A,v,M,L,this._insertCell,this.uid++,void 0,void 0),this.keys.push(u),this.bboxes.push(A),this.bboxes.push(v),this.bboxes.push(M),this.bboxes.push(L)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(u,A,v,M,L,k){this.cells[L].push(k)}query(u,A,v,M,L){const k=this.min,Q=this.max;if(u<=k&&A<=k&&Q<=v&&Q<=M&&!L)return Array.prototype.slice.call(this.keys);{const q=[];return this._forEachCell(u,A,v,M,this._queryCell,q,{},L),q}}_queryCell(u,A,v,M,L,k,Q,q){const te=this.cells[L];if(te!==null){const ae=this.keys,de=this.bboxes;for(let ye=0;ye<te.length;ye++){const me=te[ye];if(Q[me]===void 0){const Ie=4*me;(q?q(de[Ie+0],de[Ie+1],de[Ie+2],de[Ie+3]):u<=de[Ie+2]&&A<=de[Ie+3]&&v>=de[Ie+0]&&M>=de[Ie+1])?(Q[me]=!0,k.push(ae[me])):Q[me]=!1}}}}_forEachCell(u,A,v,M,L,k,Q,q){const te=this._convertToCellCoord(u),ae=this._convertToCellCoord(A),de=this._convertToCellCoord(v),ye=this._convertToCellCoord(M);for(let me=te;me<=de;me++)for(let Ie=ae;Ie<=ye;Ie++){const ke=this.d*Ie+me;if((!q||q(this._convertFromCellCoord(me),this._convertFromCellCoord(Ie),this._convertFromCellCoord(me+1),this._convertFromCellCoord(Ie+1)))&&L.call(this,u,A,v,M,ke,k,Q,q))return}}_convertFromCellCoord(u){return(u-this.padding)/this.scale}_convertToCellCoord(u){return Math.max(0,Math.min(this.d-1,Math.floor(u*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const u=this.cells,A=3+this.cells.length+1+1;let v=0;for(let k=0;k<this.cells.length;k++)v+=this.cells[k].length;const M=new Int32Array(A+v+this.keys.length+this.bboxes.length);M[0]=this.extent,M[1]=this.n,M[2]=this.padding;let L=A;for(let k=0;k<u.length;k++){const Q=u[k];M[3+k]=L,M.set(Q,L),L+=Q.length}return M[3+u.length]=L,M.set(this.keys,L),L+=this.keys.length,M[3+u.length+1]=L,M.set(this.bboxes,L),L+=this.bboxes.length,M.buffer}static serialize(u,A){const v=u.toArrayBuffer();return A&&A.push(v),{buffer:v}}static deserialize(u){return new _o(u.buffer)}}const Fi={};function un(p,u){let A=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(Fi[p])throw new Error(`${p} is already registered.`);Object.defineProperty(u,"_classRegistryKey",{value:p,writeable:!1}),Fi[p]={klass:u,omit:A.omit||[],shallow:A.shallow||[]}}un("Object",Object),un("TransferableGridIndex",_o),un("Color",yn),un("Error",Error),un("AJAXError",$n),un("ResolvedImage",vs),un("StylePropertyFunction",zs),un("StyleExpression",ha,{omit:["_evaluator"]}),un("ZoomDependentExpression",mc),un("ZoomConstantExpression",gc),un("CompoundExpression",Co,{omit:["_evaluate"]});for(const p in Oo)Oo[p]._classRegistryKey||un(`Expression_${p}`,Oo[p]);function $h(p){return p&&typeof ArrayBuffer<"u"&&(p instanceof ArrayBuffer||p.constructor&&p.constructor.name==="ArrayBuffer")}function bc(p){return p.$name||p.constructor._classRegistryKey}function wf(p){return!function(u){if(u===null||typeof u!="object")return!1;const A=bc(u);return!(!A||A==="Object")}(p)&&(p==null||typeof p=="boolean"||typeof p=="number"||typeof p=="string"||p instanceof Boolean||p instanceof Number||p instanceof String||p instanceof Date||p instanceof RegExp||p instanceof Blob||p instanceof Error||$h(p)||pr(p)||ArrayBuffer.isView(p)||p instanceof ImageData)}function $c(p,u){if(wf(p))return($h(p)||pr(p))&&u&&u.push(p),ArrayBuffer.isView(p)&&u&&u.push(p.buffer),p instanceof ImageData&&u&&u.push(p.data.buffer),p;if(Array.isArray(p)){const L=[];for(const k of p)L.push($c(k,u));return L}if(typeof p!="object")throw new Error("can't serialize object of type "+typeof p);const A=bc(p);if(!A)throw new Error(`can't serialize object of unregistered class ${p.constructor.name}`);if(!Fi[A])throw new Error(`${A} is not registered.`);const{klass:v}=Fi[A],M=v.serialize?v.serialize(p,u):{};if(v.serialize){if(u&&M===u[u.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const L in p){if(!p.hasOwnProperty(L)||Fi[A].omit.indexOf(L)>=0)continue;const k=p[L];M[L]=Fi[A].shallow.indexOf(L)>=0?k:$c(k,u)}p instanceof Error&&(M.message=p.message)}if(M.$name)throw new Error("$name property is reserved for worker serialization logic.");return A!=="Object"&&(M.$name=A),M}function Bl(p){if(wf(p))return p;if(Array.isArray(p))return p.map(Bl);if(typeof p!="object")throw new Error("can't deserialize object of type "+typeof p);const u=bc(p)||"Object";if(!Fi[u])throw new Error(`can't deserialize unregistered class ${u}`);const{klass:A}=Fi[u];if(!A)throw new Error(`can't deserialize unregistered class ${u}`);if(A.deserialize)return A.deserialize(p);const v=Object.create(A.prototype);for(const M of Object.keys(p)){if(M==="$name")continue;const L=p[M];v[M]=Fi[u].shallow.indexOf(M)>=0?L:Bl(L)}return v}class Cl{constructor(){this.first=!0}update(u,A){const v=Math.floor(u);return this.first?(this.first=!1,this.lastIntegerZoom=v,this.lastIntegerZoomTime=0,this.lastZoom=u,this.lastFloorZoom=v,!0):(this.lastFloorZoom>v?(this.lastIntegerZoom=v+1,this.lastIntegerZoomTime=A):this.lastFloorZoom<v&&(this.lastIntegerZoom=v,this.lastIntegerZoomTime=A),u!==this.lastZoom&&(this.lastZoom=u,this.lastFloorZoom=v,!0))}}const ci={"Latin-1 Supplement":p=>p>=128&&p<=255,"Hangul Jamo":p=>p>=4352&&p<=4607,Khmer:p=>p>=6016&&p<=6143,"General Punctuation":p=>p>=8192&&p<=8303,"Letterlike Symbols":p=>p>=8448&&p<=8527,"Number Forms":p=>p>=8528&&p<=8591,"Miscellaneous Technical":p=>p>=8960&&p<=9215,"Control Pictures":p=>p>=9216&&p<=9279,"Optical Character Recognition":p=>p>=9280&&p<=9311,"Enclosed Alphanumerics":p=>p>=9312&&p<=9471,"Geometric Shapes":p=>p>=9632&&p<=9727,"Miscellaneous Symbols":p=>p>=9728&&p<=9983,"Miscellaneous Symbols and Arrows":p=>p>=11008&&p<=11263,"Ideographic Description Characters":p=>p>=12272&&p<=12287,"CJK Symbols and Punctuation":p=>p>=12288&&p<=12351,Katakana:p=>p>=12448&&p<=12543,Kanbun:p=>p>=12688&&p<=12703,"CJK Strokes":p=>p>=12736&&p<=12783,"Enclosed CJK Letters and Months":p=>p>=12800&&p<=13055,"CJK Compatibility":p=>p>=13056&&p<=13311,"Yijing Hexagram Symbols":p=>p>=19904&&p<=19967,"Private Use Area":p=>p>=57344&&p<=63743,"Vertical Forms":p=>p>=65040&&p<=65055,"CJK Compatibility Forms":p=>p>=65072&&p<=65103,"Small Form Variants":p=>p>=65104&&p<=65135,"Halfwidth and Fullwidth Forms":p=>p>=65280&&p<=65519};function vn(p){for(const u of p)if(c(u.charCodeAt(0)))return!0;return!1}function Wn(p){for(const u of p)if(!X(u.charCodeAt(0)))return!1;return!0}function Eu(p){const u=p.map(A=>{try{return new RegExp(`\\p{sc=${A}}`,"u").source}catch{return null}}).filter(A=>A);return new RegExp(u.join("|"),"u")}const z=Eu(["Arab","Dupl","Mong","Ougr","Syrc"]);function X(p){return!z.test(String.fromCodePoint(p))}const E=Eu(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function c(p){return!(p!==746&&p!==747&&(p<4352||!(ci["CJK Compatibility Forms"](p)&&!(p>=65097&&p<=65103)||ci["CJK Compatibility"](p)||ci["CJK Strokes"](p)||!(!ci["CJK Symbols and Punctuation"](p)||p>=12296&&p<=12305||p>=12308&&p<=12319||p===12336)||ci["Enclosed CJK Letters and Months"](p)||ci["Ideographic Description Characters"](p)||ci.Kanbun(p)||ci.Katakana(p)&&p!==12540||!(!ci["Halfwidth and Fullwidth Forms"](p)||p===65288||p===65289||p===65293||p>=65306&&p<=65310||p===65339||p===65341||p===65343||p>=65371&&p<=65503||p===65507||p>=65512&&p<=65519)||!(!ci["Small Form Variants"](p)||p>=65112&&p<=65118||p>=65123&&p<=65126)||ci["Vertical Forms"](p)||ci["Yijing Hexagram Symbols"](p)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(p))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(p))||E.test(String.fromCodePoint(p)))))}function y(p){return!(c(p)||function(u){return!!(ci["Latin-1 Supplement"](u)&&(u===167||u===169||u===174||u===177||u===188||u===189||u===190||u===215||u===247)||ci["General Punctuation"](u)&&(u===8214||u===8224||u===8225||u===8240||u===8241||u===8251||u===8252||u===8258||u===8263||u===8264||u===8265||u===8273)||ci["Letterlike Symbols"](u)||ci["Number Forms"](u)||ci["Miscellaneous Technical"](u)&&(u>=8960&&u<=8967||u>=8972&&u<=8991||u>=8996&&u<=9e3||u===9003||u>=9085&&u<=9114||u>=9150&&u<=9165||u===9167||u>=9169&&u<=9179||u>=9186&&u<=9215)||ci["Control Pictures"](u)&&u!==9251||ci["Optical Character Recognition"](u)||ci["Enclosed Alphanumerics"](u)||ci["Geometric Shapes"](u)||ci["Miscellaneous Symbols"](u)&&!(u>=9754&&u<=9759)||ci["Miscellaneous Symbols and Arrows"](u)&&(u>=11026&&u<=11055||u>=11088&&u<=11097||u>=11192&&u<=11243)||ci["CJK Symbols and Punctuation"](u)||ci.Katakana(u)||ci["Private Use Area"](u)||ci["CJK Compatibility Forms"](u)||ci["Small Form Variants"](u)||ci["Halfwidth and Fullwidth Forms"](u)||u===8734||u===8756||u===8757||u>=9984&&u<=10087||u>=10102&&u<=10131||u===65532||u===65533)}(p))}const B=Eu(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function S(p){return B.test(String.fromCodePoint(p))}function F(p,u){return!(!u&&S(p)||p>=2304&&p<=3583||p>=3840&&p<=4255||ci.Khmer(p))}function H(p){for(const u of p)if(S(u.charCodeAt(0)))return!0;return!1}const j=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(p){this.pluginStatus=p.pluginStatus,this.pluginURL=p.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(p){if(j.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=p.applyArabicShaping,this.processBidirectionalText=p.processBidirectionalText,this.processStyledBidirectionalText=p.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(p,u){return o(this,void 0,void 0,function*(){if(this.isParsed())return this.getState();if(p.pluginStatus!=="loading")return this.setState(p),p;const A=p.pluginURL,v=new Promise(L=>{this.loadScriptResolve=L});u(A);const M=new Promise(L=>setTimeout(()=>L(),this.TIMEOUT));if(yield Promise.race([v,M]),this.isParsed()){const L={pluginStatus:"loaded",pluginURL:A};return this.setState(L),L}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${A}`)})}};class Z{constructor(u,A){this.zoom=u,A?(this.now=A.now,this.fadeDuration=A.fadeDuration,this.zoomHistory=A.zoomHistory,this.transition=A.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Cl,this.transition={})}isSupportedScript(u){return function(A,v){for(const M of A)if(!F(M.charCodeAt(0),v))return!1;return!0}(u,j.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const u=this.zoom,A=u-Math.floor(u),v=this.crossFadingFactor();return u>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:A+(1-A)*v}:{fromScale:.5,toScale:1,t:1-(1-v)*A}}}class se{constructor(u,A){this.property=u,this.value=A,this.expression=function(v,M){if(Fs(v))return new zs(v,M);if(ko(v)){const L=mo(v,M);if(L.result==="error")throw new Error(L.value.map(k=>`${k.key}: ${k.message}`).join(", "));return L.value}{let L=v;return M.type==="color"&&typeof v=="string"?L=yn.parse(v):M.type!=="padding"||typeof v!="number"&&!Array.isArray(v)?M.type==="variableAnchorOffsetCollection"&&Array.isArray(v)?L=Us.parse(v):M.type==="projectionDefinition"&&typeof v=="string"&&(L=eo.parse(v)):L=As.parse(v),{kind:"constant",evaluate:()=>L}}}(A===void 0?u.specification.default:A,u.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(u,A,v){return this.property.possiblyEvaluate(this,u,A,v)}}class he{constructor(u){this.property=u,this.value=new se(u,void 0)}transitioned(u,A){return new Te(this.property,this.value,A,St({},u.transition,this.transition),u.now)}untransitioned(){return new Te(this.property,this.value,null,{},0)}}class ue{constructor(u){this._properties=u,this._values=Object.create(u.defaultTransitionablePropertyValues)}getValue(u){return ar(this._values[u].value.value)}setValue(u,A){Object.prototype.hasOwnProperty.call(this._values,u)||(this._values[u]=new he(this._values[u].property)),this._values[u].value=new se(this._values[u].property,A===null?void 0:ar(A))}getTransition(u){return ar(this._values[u].transition)}setTransition(u,A){Object.prototype.hasOwnProperty.call(this._values,u)||(this._values[u]=new he(this._values[u].property)),this._values[u].transition=ar(A)||void 0}serialize(){const u={};for(const A of Object.keys(this._values)){const v=this.getValue(A);v!==void 0&&(u[A]=v);const M=this.getTransition(A);M!==void 0&&(u[`${A}-transition`]=M)}return u}transitioned(u,A){const v=new Fe(this._properties);for(const M of Object.keys(this._values))v._values[M]=this._values[M].transitioned(u,A._values[M]);return v}untransitioned(){const u=new Fe(this._properties);for(const A of Object.keys(this._values))u._values[A]=this._values[A].untransitioned();return u}}class Te{constructor(u,A,v,M,L){this.property=u,this.value=A,this.begin=L+M.delay||0,this.end=this.begin+M.duration||0,u.specification.transition&&(M.delay||M.duration)&&(this.prior=v)}possiblyEvaluate(u,A,v){const M=u.now||0,L=this.value.possiblyEvaluate(u,A,v),k=this.prior;if(k){if(M>this.end)return this.prior=null,L;if(this.value.isDataDriven())return this.prior=null,L;if(M<this.begin)return k.possiblyEvaluate(u,A,v);{const Q=(M-this.begin)/(this.end-this.begin);return this.property.interpolate(k.possiblyEvaluate(u,A,v),L,Xt(Q))}}return L}}class Fe{constructor(u){this._properties=u,this._values=Object.create(u.defaultTransitioningPropertyValues)}possiblyEvaluate(u,A,v){const M=new rt(this._properties);for(const L of Object.keys(this._values))M._values[L]=this._values[L].possiblyEvaluate(u,A,v);return M}hasTransition(){for(const u of Object.keys(this._values))if(this._values[u].prior)return!0;return!1}}class Ee{constructor(u){this._properties=u,this._values=Object.create(u.defaultPropertyValues)}hasValue(u){return this._values[u].value!==void 0}getValue(u){return ar(this._values[u].value)}setValue(u,A){this._values[u]=new se(this._values[u].property,A===null?void 0:ar(A))}serialize(){const u={};for(const A of Object.keys(this._values)){const v=this.getValue(A);v!==void 0&&(u[A]=v)}return u}possiblyEvaluate(u,A,v){const M=new rt(this._properties);for(const L of Object.keys(this._values))M._values[L]=this._values[L].possiblyEvaluate(u,A,v);return M}}class Oe{constructor(u,A,v){this.property=u,this.value=A,this.parameters=v}isConstant(){return this.value.kind==="constant"}constantOr(u){return this.value.kind==="constant"?this.value.value:u}evaluate(u,A,v,M){return this.property.evaluate(this.value,this.parameters,u,A,v,M)}}class rt{constructor(u){this._properties=u,this._values=Object.create(u.defaultPossiblyEvaluatedValues)}get(u){return this._values[u]}}class qe{constructor(u){this.specification=u}possiblyEvaluate(u,A){if(u.isDataDriven())throw new Error("Value should not be data driven");return u.expression.evaluate(A)}interpolate(u,A,v){const M=Ka[this.specification.type];return M?M(u,A,v):u}}class Ze{constructor(u,A){this.specification=u,this.overrides=A}possiblyEvaluate(u,A,v,M){return new Oe(this,u.expression.kind==="constant"||u.expression.kind==="camera"?{kind:"constant",value:u.expression.evaluate(A,null,{},v,M)}:u.expression,A)}interpolate(u,A,v){if(u.value.kind!=="constant"||A.value.kind!=="constant")return u;if(u.value.value===void 0||A.value.value===void 0)return new Oe(this,{kind:"constant",value:void 0},u.parameters);const M=Ka[this.specification.type];if(M){const L=M(u.value.value,A.value.value,v);return new Oe(this,{kind:"constant",value:L},u.parameters)}return u}evaluate(u,A,v,M,L,k){return u.kind==="constant"?u.value:u.evaluate(A,v,M,L,k)}}class ot extends Ze{possiblyEvaluate(u,A,v,M){if(u.value===void 0)return new Oe(this,{kind:"constant",value:void 0},A);if(u.expression.kind==="constant"){const L=u.expression.evaluate(A,null,{},v,M),k=u.property.specification.type==="resolvedImage"&&typeof L!="string"?L.name:L,Q=this._calculate(k,k,k,A);return new Oe(this,{kind:"constant",value:Q},A)}if(u.expression.kind==="camera"){const L=this._calculate(u.expression.evaluate({zoom:A.zoom-1}),u.expression.evaluate({zoom:A.zoom}),u.expression.evaluate({zoom:A.zoom+1}),A);return new Oe(this,{kind:"constant",value:L},A)}return new Oe(this,u.expression,A)}evaluate(u,A,v,M,L,k){if(u.kind==="source"){const Q=u.evaluate(A,v,M,L,k);return this._calculate(Q,Q,Q,A)}return u.kind==="composite"?this._calculate(u.evaluate({zoom:Math.floor(A.zoom)-1},v,M),u.evaluate({zoom:Math.floor(A.zoom)},v,M),u.evaluate({zoom:Math.floor(A.zoom)+1},v,M),A):u.value}_calculate(u,A,v,M){return M.zoom>M.zoomHistory.lastIntegerZoom?{from:u,to:A}:{from:v,to:A}}interpolate(u){return u}}class vt{constructor(u){this.specification=u}possiblyEvaluate(u,A,v,M){if(u.value!==void 0){if(u.expression.kind==="constant"){const L=u.expression.evaluate(A,null,{},v,M);return this._calculate(L,L,L,A)}return this._calculate(u.expression.evaluate(new Z(Math.floor(A.zoom-1),A)),u.expression.evaluate(new Z(Math.floor(A.zoom),A)),u.expression.evaluate(new Z(Math.floor(A.zoom+1),A)),A)}}_calculate(u,A,v,M){return M.zoom>M.zoomHistory.lastIntegerZoom?{from:u,to:A}:{from:v,to:A}}interpolate(u){return u}}class kt{constructor(u){this.specification=u}possiblyEvaluate(u,A,v,M){return!!u.expression.evaluate(A,null,{},v,M)}interpolate(){return!1}}class It{constructor(u){this.properties=u,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const A in u){const v=u[A];v.specification.overridable&&this.overridableProperties.push(A);const M=this.defaultPropertyValues[A]=new se(v,void 0),L=this.defaultTransitionablePropertyValues[A]=new he(v);this.defaultTransitioningPropertyValues[A]=L.untransitioned(),this.defaultPossiblyEvaluatedValues[A]=M.possiblyEvaluate({})}}}un("DataDrivenProperty",Ze),un("DataConstantProperty",qe),un("CrossFadedDataDrivenProperty",ot),un("CrossFadedProperty",vt),un("ColorRampProperty",kt);const ur="-transition";class wr extends Tn{constructor(u,A){if(super(),this.id=u.id,this.type=u.type,this._featureFilter={filter:()=>!0,needGeometry:!1},u.type!=="custom"&&(this.metadata=u.metadata,this.minzoom=u.minzoom,this.maxzoom=u.maxzoom,u.type!=="background"&&(this.source=u.source,this.sourceLayer=u["source-layer"],this.filter=u.filter),A.layout&&(this._unevaluatedLayout=new Ee(A.layout)),A.paint)){this._transitionablePaint=new ue(A.paint);for(const v in u.paint)this.setPaintProperty(v,u.paint[v],{validate:!1});for(const v in u.layout)this.setLayoutProperty(v,u.layout[v],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new rt(A.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(u){return u==="visibility"?this.visibility:this._unevaluatedLayout.getValue(u)}setLayoutProperty(u,A){let v=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};A!=null&&this._validate(Qh,`layers.${this.id}.layout.${u}`,u,A,v)||(u!=="visibility"?this._unevaluatedLayout.setValue(u,A):this.visibility=A)}getPaintProperty(u){return u.endsWith(ur)?this._transitionablePaint.getTransition(u.slice(0,-11)):this._transitionablePaint.getValue(u)}setPaintProperty(u,A){let v=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(A!=null&&this._validate(Cu,`layers.${this.id}.paint.${u}`,u,A,v))return!1;if(u.endsWith(ur))return this._transitionablePaint.setTransition(u.slice(0,-11),A||void 0),!1;{const M=this._transitionablePaint._values[u],L=M.property.specification["property-type"]==="cross-faded-data-driven",k=M.value.isDataDriven(),Q=M.value;this._transitionablePaint.setValue(u,A),this._handleSpecialPaintPropertyUpdate(u);const q=this._transitionablePaint._values[u].value;return q.isDataDriven()||k||L||this._handleOverridablePaintPropertyUpdate(u,Q,q)}}_handleSpecialPaintPropertyUpdate(u){}_handleOverridablePaintPropertyUpdate(u,A,v){return!1}isHidden(u){return!!(this.minzoom&&u<this.minzoom)||!!(this.maxzoom&&u>=this.maxzoom)||this.visibility==="none"}updateTransitions(u){this._transitioningPaint=this._transitionablePaint.transitioned(u,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(u,A){u.getCrossfadeParameters&&(this._crossfadeParameters=u.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(u,void 0,A)),this.paint=this._transitioningPaint.possiblyEvaluate(u,void 0,A)}serialize(){const u={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(u.layout=u.layout||{},u.layout.visibility=this.visibility),nr(u,(A,v)=>!(A===void 0||v==="layout"&&!Object.keys(A).length||v==="paint"&&!Object.keys(A).length))}_validate(u,A,v,M){let L=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};return(!L||L.validate!==!1)&&xf(this,u.call(wu,{key:A,layerType:this.type,objectKey:v,value:M,styleSpec:Xe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const u in this.paint._values){const A=this.paint.get(u);if(A instanceof Oe&&Yo(A.property.specification)&&(A.value.kind==="source"||A.value.kind==="composite")&&A.value.isStateDependent)return!0}return!1}}const Dr={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Or{constructor(u,A){this._structArray=u,this._pos1=A*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class _r{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(u,A){return u._trim(),A&&(u.isTransferred=!0,A.push(u.arrayBuffer)),{length:u.length,arrayBuffer:u.arrayBuffer}}static deserialize(u){const A=Object.create(this.prototype);return A.arrayBuffer=u.arrayBuffer,A.length=u.length,A.capacity=u.arrayBuffer.byteLength/A.bytesPerElement,A._refreshViews(),A}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(u){this.reserve(u),this.length=u}reserve(u){if(u>this.capacity){this.capacity=Math.max(u,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const A=this.uint8;this._refreshViews(),A&&this.uint8.set(A)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function xr(p){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,A=0,v=0;return{members:p.map(M=>{const L=Dr[M.type].BYTES_PER_ELEMENT,k=A=Vr(A,Math.max(u,L)),Q=M.components||1;return v=Math.max(v,L),A+=L*Q,{name:M.name,type:M.type,components:Q,offset:k}}),size:Vr(A,Math.max(v,u)),alignment:u}}function Vr(p,u){return Math.ceil(p/u)*u}class xn extends _r{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(u,A){const v=this.length;return this.resize(v+1),this.emplace(v,u,A)}emplace(u,A,v){const M=2*u;return this.int16[M+0]=A,this.int16[M+1]=v,u}}xn.prototype.bytesPerElement=4,un("StructArrayLayout2i4",xn);class Qr extends _r{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(u,A,v){const M=this.length;return this.resize(M+1),this.emplace(M,u,A,v)}emplace(u,A,v,M){const L=3*u;return this.int16[L+0]=A,this.int16[L+1]=v,this.int16[L+2]=M,u}}Qr.prototype.bytesPerElement=6,un("StructArrayLayout3i6",Qr);class jr extends _r{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(u,A,v,M){const L=this.length;return this.resize(L+1),this.emplace(L,u,A,v,M)}emplace(u,A,v,M,L){const k=4*u;return this.int16[k+0]=A,this.int16[k+1]=v,this.int16[k+2]=M,this.int16[k+3]=L,u}}jr.prototype.bytesPerElement=8,un("StructArrayLayout4i8",jr);class In extends _r{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(u,A,v,M,L,k){const Q=this.length;return this.resize(Q+1),this.emplace(Q,u,A,v,M,L,k)}emplace(u,A,v,M,L,k,Q){const q=6*u;return this.int16[q+0]=A,this.int16[q+1]=v,this.int16[q+2]=M,this.int16[q+3]=L,this.int16[q+4]=k,this.int16[q+5]=Q,u}}In.prototype.bytesPerElement=12,un("StructArrayLayout2i4i12",In);class Hn extends _r{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(u,A,v,M,L,k){const Q=this.length;return this.resize(Q+1),this.emplace(Q,u,A,v,M,L,k)}emplace(u,A,v,M,L,k,Q){const q=4*u,te=8*u;return this.int16[q+0]=A,this.int16[q+1]=v,this.uint8[te+4]=M,this.uint8[te+5]=L,this.uint8[te+6]=k,this.uint8[te+7]=Q,u}}Hn.prototype.bytesPerElement=8,un("StructArrayLayout2i4ub8",Hn);class Qn extends _r{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u,A){const v=this.length;return this.resize(v+1),this.emplace(v,u,A)}emplace(u,A,v){const M=2*u;return this.float32[M+0]=A,this.float32[M+1]=v,u}}Qn.prototype.bytesPerElement=8,un("StructArrayLayout2f8",Qn);class Zn extends _r{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(u,A,v,M,L,k,Q,q,te,ae){const de=this.length;return this.resize(de+1),this.emplace(de,u,A,v,M,L,k,Q,q,te,ae)}emplace(u,A,v,M,L,k,Q,q,te,ae,de){const ye=10*u;return this.uint16[ye+0]=A,this.uint16[ye+1]=v,this.uint16[ye+2]=M,this.uint16[ye+3]=L,this.uint16[ye+4]=k,this.uint16[ye+5]=Q,this.uint16[ye+6]=q,this.uint16[ye+7]=te,this.uint16[ye+8]=ae,this.uint16[ye+9]=de,u}}Zn.prototype.bytesPerElement=20,un("StructArrayLayout10ui20",Zn);class ui extends _r{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(u,A,v,M,L,k,Q,q,te,ae,de,ye){const me=this.length;return this.resize(me+1),this.emplace(me,u,A,v,M,L,k,Q,q,te,ae,de,ye)}emplace(u,A,v,M,L,k,Q,q,te,ae,de,ye,me){const Ie=12*u;return this.int16[Ie+0]=A,this.int16[Ie+1]=v,this.int16[Ie+2]=M,this.int16[Ie+3]=L,this.uint16[Ie+4]=k,this.uint16[Ie+5]=Q,this.uint16[Ie+6]=q,this.uint16[Ie+7]=te,this.int16[Ie+8]=ae,this.int16[Ie+9]=de,this.int16[Ie+10]=ye,this.int16[Ie+11]=me,u}}ui.prototype.bytesPerElement=24,un("StructArrayLayout4i4ui4i24",ui);class Ii extends _r{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u,A,v){const M=this.length;return this.resize(M+1),this.emplace(M,u,A,v)}emplace(u,A,v,M){const L=3*u;return this.float32[L+0]=A,this.float32[L+1]=v,this.float32[L+2]=M,u}}Ii.prototype.bytesPerElement=12,un("StructArrayLayout3f12",Ii);class cs extends _r{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(u){const A=this.length;return this.resize(A+1),this.emplace(A,u)}emplace(u,A){return this.uint32[1*u+0]=A,u}}cs.prototype.bytesPerElement=4,un("StructArrayLayout1ul4",cs);class mi extends _r{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(u,A,v,M,L,k,Q,q,te){const ae=this.length;return this.resize(ae+1),this.emplace(ae,u,A,v,M,L,k,Q,q,te)}emplace(u,A,v,M,L,k,Q,q,te,ae){const de=10*u,ye=5*u;return this.int16[de+0]=A,this.int16[de+1]=v,this.int16[de+2]=M,this.int16[de+3]=L,this.int16[de+4]=k,this.int16[de+5]=Q,this.uint32[ye+3]=q,this.uint16[de+8]=te,this.uint16[de+9]=ae,u}}mi.prototype.bytesPerElement=20,un("StructArrayLayout6i1ul2ui20",mi);class qi extends _r{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(u,A,v,M,L,k){const Q=this.length;return this.resize(Q+1),this.emplace(Q,u,A,v,M,L,k)}emplace(u,A,v,M,L,k,Q){const q=6*u;return this.int16[q+0]=A,this.int16[q+1]=v,this.int16[q+2]=M,this.int16[q+3]=L,this.int16[q+4]=k,this.int16[q+5]=Q,u}}qi.prototype.bytesPerElement=12,un("StructArrayLayout2i2i2i12",qi);class Di extends _r{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(u,A,v,M,L){const k=this.length;return this.resize(k+1),this.emplace(k,u,A,v,M,L)}emplace(u,A,v,M,L,k){const Q=4*u,q=8*u;return this.float32[Q+0]=A,this.float32[Q+1]=v,this.float32[Q+2]=M,this.int16[q+6]=L,this.int16[q+7]=k,u}}Di.prototype.bytesPerElement=16,un("StructArrayLayout2f1f2i16",Di);class us extends _r{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(u,A,v,M,L,k){const Q=this.length;return this.resize(Q+1),this.emplace(Q,u,A,v,M,L,k)}emplace(u,A,v,M,L,k,Q){const q=16*u,te=4*u,ae=8*u;return this.uint8[q+0]=A,this.uint8[q+1]=v,this.float32[te+1]=M,this.float32[te+2]=L,this.int16[ae+6]=k,this.int16[ae+7]=Q,u}}us.prototype.bytesPerElement=16,un("StructArrayLayout2ub2f2i16",us);class ns extends _r{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(u,A,v){const M=this.length;return this.resize(M+1),this.emplace(M,u,A,v)}emplace(u,A,v,M){const L=3*u;return this.uint16[L+0]=A,this.uint16[L+1]=v,this.uint16[L+2]=M,u}}ns.prototype.bytesPerElement=6,un("StructArrayLayout3ui6",ns);class Uo extends _r{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u,A,v,M,L,k,Q,q,te,ae,de,ye,me,Ie,ke,nt,ct){const Ot=this.length;return this.resize(Ot+1),this.emplace(Ot,u,A,v,M,L,k,Q,q,te,ae,de,ye,me,Ie,ke,nt,ct)}emplace(u,A,v,M,L,k,Q,q,te,ae,de,ye,me,Ie,ke,nt,ct,Ot){const wt=24*u,Re=12*u,it=48*u;return this.int16[wt+0]=A,this.int16[wt+1]=v,this.uint16[wt+2]=M,this.uint16[wt+3]=L,this.uint32[Re+2]=k,this.uint32[Re+3]=Q,this.uint32[Re+4]=q,this.uint16[wt+10]=te,this.uint16[wt+11]=ae,this.uint16[wt+12]=de,this.float32[Re+7]=ye,this.float32[Re+8]=me,this.uint8[it+36]=Ie,this.uint8[it+37]=ke,this.uint8[it+38]=nt,this.uint32[Re+10]=ct,this.int16[wt+22]=Ot,u}}Uo.prototype.bytesPerElement=48,un("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Uo);class da extends _r{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u,A,v,M,L,k,Q,q,te,ae,de,ye,me,Ie,ke,nt,ct,Ot,wt,Re,it,Et,Zt,Br,or,lr,Lr,Tr){const Hr=this.length;return this.resize(Hr+1),this.emplace(Hr,u,A,v,M,L,k,Q,q,te,ae,de,ye,me,Ie,ke,nt,ct,Ot,wt,Re,it,Et,Zt,Br,or,lr,Lr,Tr)}emplace(u,A,v,M,L,k,Q,q,te,ae,de,ye,me,Ie,ke,nt,ct,Ot,wt,Re,it,Et,Zt,Br,or,lr,Lr,Tr,Hr){const Ar=32*u,hn=16*u;return this.int16[Ar+0]=A,this.int16[Ar+1]=v,this.int16[Ar+2]=M,this.int16[Ar+3]=L,this.int16[Ar+4]=k,this.int16[Ar+5]=Q,this.int16[Ar+6]=q,this.int16[Ar+7]=te,this.uint16[Ar+8]=ae,this.uint16[Ar+9]=de,this.uint16[Ar+10]=ye,this.uint16[Ar+11]=me,this.uint16[Ar+12]=Ie,this.uint16[Ar+13]=ke,this.uint16[Ar+14]=nt,this.uint16[Ar+15]=ct,this.uint16[Ar+16]=Ot,this.uint16[Ar+17]=wt,this.uint16[Ar+18]=Re,this.uint16[Ar+19]=it,this.uint16[Ar+20]=Et,this.uint16[Ar+21]=Zt,this.uint16[Ar+22]=Br,this.uint32[hn+12]=or,this.float32[hn+13]=lr,this.float32[hn+14]=Lr,this.uint16[Ar+30]=Tr,this.uint16[Ar+31]=Hr,u}}da.prototype.bytesPerElement=64,un("StructArrayLayout8i15ui1ul2f2ui64",da);class Ki extends _r{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u){const A=this.length;return this.resize(A+1),this.emplace(A,u)}emplace(u,A){return this.float32[1*u+0]=A,u}}Ki.prototype.bytesPerElement=4,un("StructArrayLayout1f4",Ki);class vc extends _r{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u,A,v){const M=this.length;return this.resize(M+1),this.emplace(M,u,A,v)}emplace(u,A,v,M){const L=3*u;return this.uint16[6*u+0]=A,this.float32[L+1]=v,this.float32[L+2]=M,u}}vc.prototype.bytesPerElement=12,un("StructArrayLayout1ui2f12",vc);class D extends _r{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(u,A,v){const M=this.length;return this.resize(M+1),this.emplace(M,u,A,v)}emplace(u,A,v,M){const L=4*u;return this.uint32[2*u+0]=A,this.uint16[L+2]=v,this.uint16[L+3]=M,u}}D.prototype.bytesPerElement=8,un("StructArrayLayout1ul2ui8",D);class l extends _r{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(u,A){const v=this.length;return this.resize(v+1),this.emplace(v,u,A)}emplace(u,A,v){const M=2*u;return this.uint16[M+0]=A,this.uint16[M+1]=v,u}}l.prototype.bytesPerElement=4,un("StructArrayLayout2ui4",l);class m extends _r{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(u){const A=this.length;return this.resize(A+1),this.emplace(A,u)}emplace(u,A){return this.uint16[1*u+0]=A,u}}m.prototype.bytesPerElement=2,un("StructArrayLayout1ui2",m);class w extends _r{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u,A,v,M){const L=this.length;return this.resize(L+1),this.emplace(L,u,A,v,M)}emplace(u,A,v,M,L){const k=4*u;return this.float32[k+0]=A,this.float32[k+1]=v,this.float32[k+2]=M,this.float32[k+3]=L,u}}w.prototype.bytesPerElement=16,un("StructArrayLayout4f16",w);class P extends Or{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new N(this.anchorPointX,this.anchorPointY)}}P.prototype.size=20;class O extends mi{get(u){return new P(this,u)}}un("CollisionBoxArray",O);class G extends Or{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(u){this._structArray.uint8[this._pos1+37]=u}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(u){this._structArray.uint8[this._pos1+38]=u}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(u){this._structArray.uint32[this._pos4+10]=u}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}G.prototype.size=48;class J extends Uo{get(u){return new G(this,u)}}un("PlacedSymbolArray",J);class re extends Or{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(u){this._structArray.uint32[this._pos4+12]=u}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}re.prototype.size=64;class oe extends da{get(u){return new re(this,u)}}un("SymbolInstanceArray",oe);class pe extends Ki{getoffsetX(u){return this.float32[1*u+0]}}un("GlyphOffsetArray",pe);class Ce extends Qr{getx(u){return this.int16[3*u+0]}gety(u){return this.int16[3*u+1]}gettileUnitDistanceFromAnchor(u){return this.int16[3*u+2]}}un("SymbolLineVertexArray",Ce);class Me extends Or{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Me.prototype.size=12;class Ke extends vc{get(u){return new Me(this,u)}}un("TextAnchorOffsetArray",Ke);class Ye extends Or{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Ye.prototype.size=8;class gt extends D{get(u){return new Ye(this,u)}}un("FeatureIndexArray",gt);class ft extends xn{}class mt extends xn{}class xt extends xn{}class Ft extends In{}class Dt extends Hn{}class Ut extends Qn{}class Gt extends Zn{}class zt extends ui{}class ir extends Ii{}class sr extends cs{}class gr extends qi{}class Er extends us{}class fr extends ns{}class qr extends l{}const Jr=xr([{name:"a_pos",components:2,type:"Int16"}],4),{members:Sr}=Jr;class tn{constructor(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];this._forceNewSegmentOnNextPrepare=!1,this.segments=u}prepareSegment(u,A,v,M){const L=this.segments[this.segments.length-1];return u>tn.MAX_VERTEX_ARRAY_LENGTH&&kr(`Max vertices per segment is ${tn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${u}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${tn.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!L||L.vertexLength+u>tn.MAX_VERTEX_ARRAY_LENGTH||L.sortKey!==M?this.createNewSegment(A,v,M):L}createNewSegment(u,A,v){const M={vertexOffset:u.length,primitiveOffset:A.length,vertexLength:0,primitiveLength:0,vaos:{}};return v!==void 0&&(M.sortKey=v),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(M),M}getOrCreateLatestSegment(u,A,v){return this.prepareSegment(0,u,A,v)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const u of this.segments)for(const A in u.vaos)u.vaos[A].destroy()}static simpleSegment(u,A,v,M){return new tn([{vertexOffset:u,primitiveOffset:A,vertexLength:v,primitiveLength:M,vaos:{},sortKey:0}])}}function Yn(p,u){return 256*(p=ut(Math.floor(p),0,255))+ut(Math.floor(u),0,255)}tn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,un("SegmentVector",tn);const oi=xr([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var ws,Oi,Gs,Wi={exports:{}},ti={exports:{}},Xi={exports:{}},No=function(){if(Gs)return Wi.exports;Gs=1;var p=(ws||(ws=1,ti.exports=function(A,v){var M,L,k,Q,q,te,ae,de;for(L=A.length-(M=3&A.length),k=v,q=3432918353,te=461845907,de=0;de<L;)ae=255&A.charCodeAt(de)|(255&A.charCodeAt(++de))<<8|(255&A.charCodeAt(++de))<<16|(255&A.charCodeAt(++de))<<24,++de,k=27492+(65535&(Q=5*(65535&(k=(k^=ae=(65535&(ae=(ae=(65535&ae)*q+(((ae>>>16)*q&65535)<<16)&4294967295)<<15|ae>>>17))*te+(((ae>>>16)*te&65535)<<16)&4294967295)<<13|k>>>19))+((5*(k>>>16)&65535)<<16)&4294967295))+((58964+(Q>>>16)&65535)<<16);switch(ae=0,M){case 3:ae^=(255&A.charCodeAt(de+2))<<16;case 2:ae^=(255&A.charCodeAt(de+1))<<8;case 1:k^=ae=(65535&(ae=(ae=(65535&(ae^=255&A.charCodeAt(de)))*q+(((ae>>>16)*q&65535)<<16)&4294967295)<<15|ae>>>17))*te+(((ae>>>16)*te&65535)<<16)&4294967295}return k^=A.length,k=2246822507*(65535&(k^=k>>>16))+((2246822507*(k>>>16)&65535)<<16)&4294967295,k=3266489909*(65535&(k^=k>>>13))+((3266489909*(k>>>16)&65535)<<16)&4294967295,(k^=k>>>16)>>>0}),ti.exports),u=(Oi||(Oi=1,Xi.exports=function(A,v){for(var M,L=A.length,k=v^L,Q=0;L>=4;)M=1540483477*(65535&(M=255&A.charCodeAt(Q)|(255&A.charCodeAt(++Q))<<8|(255&A.charCodeAt(++Q))<<16|(255&A.charCodeAt(++Q))<<24))+((1540483477*(M>>>16)&65535)<<16),k=1540483477*(65535&k)+((1540483477*(k>>>16)&65535)<<16)^(M=1540483477*(65535&(M^=M>>>24))+((1540483477*(M>>>16)&65535)<<16)),L-=4,++Q;switch(L){case 3:k^=(255&A.charCodeAt(Q+2))<<16;case 2:k^=(255&A.charCodeAt(Q+1))<<8;case 1:k=1540483477*(65535&(k^=255&A.charCodeAt(Q)))+((1540483477*(k>>>16)&65535)<<16)}return k=1540483477*(65535&(k^=k>>>13))+((1540483477*(k>>>16)&65535)<<16),(k^=k>>>15)>>>0}),Xi.exports);return Wi.exports=p,Wi.exports.murmur3=p,Wi.exports.murmur2=u,Wi.exports}(),Rs=h(No);class Bs{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(u,A,v,M){this.ids.push(ea(u)),this.positions.push(A,v,M)}getPositions(u){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const A=ea(u);let v=0,M=this.ids.length-1;for(;v<M;){const k=v+M>>1;this.ids[k]>=A?M=k:v=k+1}const L=[];for(;this.ids[v]===A;)L.push({index:this.positions[3*v],start:this.positions[3*v+1],end:this.positions[3*v+2]}),v++;return L}static serialize(u,A){const v=new Float64Array(u.ids),M=new Uint32Array(u.positions);return tl(v,M,0,v.length-1),A&&A.push(v.buffer,M.buffer),{ids:v,positions:M}}static deserialize(u){const A=new Bs;return A.ids=u.ids,A.positions=u.positions,A.indexed=!0,A}}function ea(p){const u=+p;return!isNaN(u)&&u<=Number.MAX_SAFE_INTEGER?u:Rs(String(p))}function tl(p,u,A,v){for(;A<v;){const M=p[A+v>>1];let L=A-1,k=v+1;for(;;){do L++;while(p[L]<M);do k--;while(p[k]>M);if(L>=k)break;jl(p,L,k),jl(u,3*L,3*k),jl(u,3*L+1,3*k+1),jl(u,3*L+2,3*k+2)}k-A<v-k?(tl(p,u,A,k),A=k+1):(tl(p,u,k+1,v),v=k)}}function jl(p,u,A){const v=p[u];p[u]=p[A],p[A]=v}un("FeaturePositionMap",Bs);class Ma{constructor(u,A){this.gl=u.gl,this.location=A}}class ta extends Ma{constructor(u,A){super(u,A),this.current=0}set(u){this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))}}class xc extends Ma{constructor(u,A){super(u,A),this.current=[0,0,0,0]}set(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3]))}}class El extends Ma{constructor(u,A){super(u,A),this.current=yn.transparent}set(u){u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a))}}const Qu=new Float32Array(16);function ra(p){return[Yn(255*p.r,255*p.g),Yn(255*p.b,255*p.a)]}class Tl{constructor(u,A,v){this.value=u,this.uniformNames=A.map(M=>`u_${M}`),this.type=v}setUniform(u,A,v){u.set(v.constantOr(this.value))}getBinding(u,A,v){return this.type==="color"?new El(u,A):new ta(u,A)}}class ql{constructor(u,A){this.uniformNames=A.map(v=>`u_${v}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(u,A){this.pixelRatioFrom=A.pixelRatio,this.pixelRatioTo=u.pixelRatio,this.patternFrom=A.tlbr,this.patternTo=u.tlbr}setUniform(u,A,v,M){const L=M==="u_pattern_to"?this.patternTo:M==="u_pattern_from"?this.patternFrom:M==="u_pixel_ratio_to"?this.pixelRatioTo:M==="u_pixel_ratio_from"?this.pixelRatioFrom:null;L&&u.set(L)}getBinding(u,A,v){return v.substr(0,9)==="u_pattern"?new xc(u,A):new ta(u,A)}}class Io{constructor(u,A,v,M){this.expression=u,this.type=v,this.maxValue=0,this.paintVertexAttributes=A.map(L=>({name:`a_${L}`,type:"Float32",components:v==="color"?2:1,offset:0})),this.paintVertexArray=new M}populatePaintArray(u,A,v,M,L){const k=this.paintVertexArray.length,Q=this.expression.evaluate(new Z(0),A,{},M,[],L);this.paintVertexArray.resize(u),this._setPaintValue(k,u,Q)}updatePaintArray(u,A,v,M){const L=this.expression.evaluate({zoom:0},v,M);this._setPaintValue(u,A,L)}_setPaintValue(u,A,v){if(this.type==="color"){const M=ra(v);for(let L=u;L<A;L++)this.paintVertexArray.emplace(L,M[0],M[1])}else{for(let M=u;M<A;M++)this.paintVertexArray.emplace(M,v);this.maxValue=Math.max(this.maxValue,Math.abs(v))}}upload(u){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=u.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ji{constructor(u,A,v,M,L,k){this.expression=u,this.uniformNames=A.map(Q=>`u_${Q}_t`),this.type=v,this.useIntegerZoom=M,this.zoom=L,this.maxValue=0,this.paintVertexAttributes=A.map(Q=>({name:`a_${Q}`,type:"Float32",components:v==="color"?4:2,offset:0})),this.paintVertexArray=new k}populatePaintArray(u,A,v,M,L){const k=this.expression.evaluate(new Z(this.zoom),A,{},M,[],L),Q=this.expression.evaluate(new Z(this.zoom+1),A,{},M,[],L),q=this.paintVertexArray.length;this.paintVertexArray.resize(u),this._setPaintValue(q,u,k,Q)}updatePaintArray(u,A,v,M){const L=this.expression.evaluate({zoom:this.zoom},v,M),k=this.expression.evaluate({zoom:this.zoom+1},v,M);this._setPaintValue(u,A,L,k)}_setPaintValue(u,A,v,M){if(this.type==="color"){const L=ra(v),k=ra(M);for(let Q=u;Q<A;Q++)this.paintVertexArray.emplace(Q,L[0],L[1],k[0],k[1])}else{for(let L=u;L<A;L++)this.paintVertexArray.emplace(L,v,M);this.maxValue=Math.max(this.maxValue,Math.abs(v),Math.abs(M))}}upload(u){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=u.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(u,A){const v=this.useIntegerZoom?Math.floor(A.zoom):A.zoom,M=ut(this.expression.interpolationFactor(v,this.zoom,this.zoom+1),0,1);u.set(M)}getBinding(u,A,v){return new ta(u,A)}}class Cs{constructor(u,A,v,M,L,k){this.expression=u,this.type=A,this.useIntegerZoom=v,this.zoom=M,this.layerId=k,this.zoomInPaintVertexArray=new L,this.zoomOutPaintVertexArray=new L}populatePaintArray(u,A,v){const M=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(u),this.zoomOutPaintVertexArray.resize(u),this._setPaintValues(M,u,A.patterns&&A.patterns[this.layerId],v)}updatePaintArray(u,A,v,M,L){this._setPaintValues(u,A,v.patterns&&v.patterns[this.layerId],L)}_setPaintValues(u,A,v,M){if(!M||!v)return;const{min:L,mid:k,max:Q}=v,q=M[L],te=M[k],ae=M[Q];if(q&&te&&ae)for(let de=u;de<A;de++)this.zoomInPaintVertexArray.emplace(de,te.tl[0],te.tl[1],te.br[0],te.br[1],q.tl[0],q.tl[1],q.br[0],q.br[1],te.pixelRatio,q.pixelRatio),this.zoomOutPaintVertexArray.emplace(de,te.tl[0],te.tl[1],te.br[0],te.br[1],ae.tl[0],ae.tl[1],ae.br[0],ae.br[1],te.pixelRatio,ae.pixelRatio)}upload(u){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=u.createVertexBuffer(this.zoomInPaintVertexArray,oi.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=u.createVertexBuffer(this.zoomOutPaintVertexArray,oi.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Sl{constructor(u,A,v){this.binders={},this._buffers=[];const M=[];for(const L in u.paint._values){if(!v(L))continue;const k=u.paint.get(L);if(!(k instanceof Oe&&Yo(k.property.specification)))continue;const Q=yy(L,u.type),q=k.value,te=k.property.specification.type,ae=k.property.useIntegerZoom,de=k.property.specification["property-type"],ye=de==="cross-faded"||de==="cross-faded-data-driven";if(q.kind==="constant")this.binders[L]=ye?new ql(q.value,Q):new Tl(q.value,Q,te),M.push(`/u_${L}`);else if(q.kind==="source"||ye){const me=Pm(L,te,"source");this.binders[L]=ye?new Cs(q,te,ae,A,me,u.id):new Io(q,Q,te,me),M.push(`/a_${L}`)}else{const me=Pm(L,te,"composite");this.binders[L]=new Ji(q,Q,te,ae,A,me),M.push(`/z_${L}`)}}this.cacheKey=M.sort().join("")}getMaxValue(u){const A=this.binders[u];return A instanceof Io||A instanceof Ji?A.maxValue:0}populatePaintArrays(u,A,v,M,L){for(const k in this.binders){const Q=this.binders[k];(Q instanceof Io||Q instanceof Ji||Q instanceof Cs)&&Q.populatePaintArray(u,A,v,M,L)}}setConstantPatternPositions(u,A){for(const v in this.binders){const M=this.binders[v];M instanceof ql&&M.setConstantPatternPositions(u,A)}}updatePaintArrays(u,A,v,M,L){let k=!1;for(const Q in u){const q=A.getPositions(Q);for(const te of q){const ae=v.feature(te.index);for(const de in this.binders){const ye=this.binders[de];if((ye instanceof Io||ye instanceof Ji||ye instanceof Cs)&&ye.expression.isStateDependent===!0){const me=M.paint.get(de);ye.expression=me.value,ye.updatePaintArray(te.start,te.end,ae,u[Q],L),k=!0}}}}return k}defines(){const u=[];for(const A in this.binders){const v=this.binders[A];(v instanceof Tl||v instanceof ql)&&u.push(...v.uniformNames.map(M=>`#define HAS_UNIFORM_${M}`))}return u}getBinderAttributes(){const u=[];for(const A in this.binders){const v=this.binders[A];if(v instanceof Io||v instanceof Ji)for(let M=0;M<v.paintVertexAttributes.length;M++)u.push(v.paintVertexAttributes[M].name);else if(v instanceof Cs)for(let M=0;M<oi.members.length;M++)u.push(oi.members[M].name)}return u}getBinderUniforms(){const u=[];for(const A in this.binders){const v=this.binders[A];if(v instanceof Tl||v instanceof ql||v instanceof Ji)for(const M of v.uniformNames)u.push(M)}return u}getPaintVertexBuffers(){return this._buffers}getUniforms(u,A){const v=[];for(const M in this.binders){const L=this.binders[M];if(L instanceof Tl||L instanceof ql||L instanceof Ji){for(const k of L.uniformNames)if(A[k]){const Q=L.getBinding(u,A[k],k);v.push({name:k,property:M,binding:Q})}}}return v}setUniforms(u,A,v,M){for(const{name:L,property:k,binding:Q}of A)this.binders[k].setUniform(Q,M,v.get(k),L)}updatePaintBuffers(u){this._buffers=[];for(const A in this.binders){const v=this.binders[A];if(u&&v instanceof Cs){const M=u.fromScale===2?v.zoomInPaintVertexBuffer:v.zoomOutPaintVertexBuffer;M&&this._buffers.push(M)}else(v instanceof Io||v instanceof Ji)&&v.paintVertexBuffer&&this._buffers.push(v.paintVertexBuffer)}}upload(u){for(const A in this.binders){const v=this.binders[A];(v instanceof Io||v instanceof Ji||v instanceof Cs)&&v.upload(u)}this.updatePaintBuffers()}destroy(){for(const u in this.binders){const A=this.binders[u];(A instanceof Io||A instanceof Ji||A instanceof Cs)&&A.destroy()}}}class Qs{constructor(u,A){let v=arguments.length>2&&arguments[2]!==void 0?arguments[2]:()=>!0;this.programConfigurations={};for(const M of u)this.programConfigurations[M.id]=new Sl(M,A,v);this.needsUpload=!1,this._featureMap=new Bs,this._bufferOffset=0}populatePaintArrays(u,A,v,M,L,k){for(const Q in this.programConfigurations)this.programConfigurations[Q].populatePaintArrays(u,A,M,L,k);A.id!==void 0&&this._featureMap.add(A.id,v,this._bufferOffset,u),this._bufferOffset=u,this.needsUpload=!0}updatePaintArrays(u,A,v,M){for(const L of v)this.needsUpload=this.programConfigurations[L.id].updatePaintArrays(u,this._featureMap,A,L,M)||this.needsUpload}get(u){return this.programConfigurations[u]}upload(u){if(this.needsUpload){for(const A in this.programConfigurations)this.programConfigurations[A].upload(u);this.needsUpload=!1}}destroy(){for(const u in this.programConfigurations)this.programConfigurations[u].destroy()}}function yy(p,u){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[p]||[p.replace(`${u}-`,"").replace(/-/g,"_")]}function Pm(p,u,A){const v={color:{source:Qn,composite:w},number:{source:Ki,composite:Qn}},M=function(L){return{"line-pattern":{source:Gt,composite:Gt},"fill-pattern":{source:Gt,composite:Gt},"fill-extrusion-pattern":{source:Gt,composite:Gt}}[L]}(p);return M&&M[A]||v[u][A]}un("ConstantBinder",Tl),un("CrossFadedConstantBinder",ql),un("SourceExpressionBinder",Io),un("CrossFadedCompositeBinder",Cs),un("CompositeExpressionBinder",Ji),un("ProgramConfiguration",Sl,{omit:["_buffers"]}),un("ProgramConfigurationSet",Qs);const Fm=Math.pow(2,14)-1,rl=-Fm-1;function Tu(p){const u=Vt/p.extent,A=p.loadGeometry();for(let v=0;v<A.length;v++){const M=A[v];for(let L=0;L<M.length;L++){const k=M[L],Q=Math.round(k.x*u),q=Math.round(k.y*u);k.x=ut(Q,rl,Fm),k.y=ut(q,rl,Fm),(Q<k.x||Q>k.x+1||q<k.y||q>k.y+1)&&kr("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return A}function jh(p,u){return{type:p.type,id:p.id,properties:p.properties,geometry:u?Tu(p):[]}}const qh=-32768;function sA(p,u,A,v,M){p.emplaceBack(qh+8*u+v,qh+8*A+M)}class $p{constructor(u){this.zoom=u.zoom,this.overscaling=u.overscaling,this.layers=u.layers,this.layerIds=this.layers.map(A=>A.id),this.index=u.index,this.hasPattern=!1,this.layoutVertexArray=new mt,this.indexArray=new fr,this.segments=new tn,this.programConfigurations=new Qs(u.layers,u.zoom),this.stateDependentLayerIds=this.layers.filter(A=>A.isStateDependent()).map(A=>A.id)}populate(u,A,v){const M=this.layers[0],L=[];let k=null,Q=!1,q=M.type==="heatmap";if(M.type==="circle"){const ae=M;k=ae.layout.get("circle-sort-key"),Q=!k.isConstant(),q=q||ae.paint.get("circle-pitch-alignment")==="map"}const te=q?A.subdivisionGranularity.circle:1;for(const{feature:ae,id:de,index:ye,sourceLayerIndex:me}of u){const Ie=this.layers[0]._featureFilter.needGeometry,ke=jh(ae,Ie);if(!this.layers[0]._featureFilter.filter(new Z(this.zoom),ke,v))continue;const nt=Q?k.evaluate(ke,{},v):void 0,ct={id:de,properties:ae.properties,type:ae.type,sourceLayerIndex:me,index:ye,geometry:Ie?ke.geometry:Tu(ae),patterns:{},sortKey:nt};L.push(ct)}Q&&L.sort((ae,de)=>ae.sortKey-de.sortKey);for(const ae of L){const{geometry:de,index:ye,sourceLayerIndex:me}=ae,Ie=u[ye].feature;this.addFeature(ae,de,ye,v,te),A.featureIndex.insert(Ie,de,ye,me,this.index)}}update(u,A,v){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(u,A,this.stateDependentLayers,v)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(u){this.uploaded||(this.layoutVertexBuffer=u.createVertexBuffer(this.layoutVertexArray,Sr),this.indexBuffer=u.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(u),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(u,A,v,M){let L=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1,k;switch(L){case 1:k=[0,7];break;case 3:k=[0,2,5,7];break;case 5:k=[0,1,3,4,6,7];break;case 7:k=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${L}; valid values are 1, 3, 5, 7.`)}const Q=k.length;for(const q of A)for(const te of q){const ae=te.x,de=te.y;if(ae<0||ae>=Vt||de<0||de>=Vt)continue;const ye=this.segments.prepareSegment(Q*Q,this.layoutVertexArray,this.indexArray,u.sortKey),me=ye.vertexLength;for(let Ie=0;Ie<Q;Ie++)for(let ke=0;ke<Q;ke++)sA(this.layoutVertexArray,ae,de,k[ke],k[Ie]);for(let Ie=0;Ie<Q-1;Ie++)for(let ke=0;ke<Q-1;ke++){const nt=me+Ie*Q+ke,ct=me+(Ie+1)*Q+ke;this.indexArray.emplaceBack(nt,ct+1,nt+1),this.indexArray.emplaceBack(nt,ct,ct+1)}ye.vertexLength+=Q*Q,ye.primitiveLength+=(Q-1)*(Q-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,u,v,{},M)}}function oA(p,u){for(let A=0;A<p.length;A++)if(Ed(u,p[A]))return!0;for(let A=0;A<u.length;A++)if(Ed(p,u[A]))return!0;return!!by(p,u)}function Rm(p,u,A){return!!Ed(p,u)||!!Lm(u,p,A)}function jp(p,u){if(p.length===1)return vy(u,p[0]);for(let A=0;A<u.length;A++){const v=u[A];for(let M=0;M<v.length;M++)if(Ed(p,v[M]))return!0}for(let A=0;A<p.length;A++)if(vy(u,p[A]))return!0;for(let A=0;A<u.length;A++)if(by(p,u[A]))return!0;return!1}function qp(p,u,A){if(p.length>1){if(by(p,u))return!0;for(let v=0;v<u.length;v++)if(Lm(u[v],p,A))return!0}for(let v=0;v<p.length;v++)if(Lm(p[v],u,A))return!0;return!1}function by(p,u){if(p.length===0||u.length===0)return!1;for(let A=0;A<p.length-1;A++){const v=p[A],M=p[A+1];for(let L=0;L<u.length-1;L++)if(bD(v,M,u[L],u[L+1]))return!0}return!1}function bD(p,u,A,v){return Gr(p,A,v)!==Gr(u,A,v)&&Gr(p,u,A)!==Gr(p,u,v)}function Lm(p,u,A){const v=A*A;if(u.length===1)return p.distSqr(u[0])<v;for(let M=1;M<u.length;M++)if(Ev(p,u[M-1],u[M])<v)return!0;return!1}function Ev(p,u,A){const v=u.distSqr(A);if(v===0)return p.distSqr(u);const M=((p.x-u.x)*(A.x-u.x)+(p.y-u.y)*(A.y-u.y))/v;return p.distSqr(M<0?u:M>1?A:A.sub(u)._mult(M)._add(u))}function vy(p,u){let A,v,M,L=!1;for(let k=0;k<p.length;k++){A=p[k];for(let Q=0,q=A.length-1;Q<A.length;q=Q++)v=A[Q],M=A[q],v.y>u.y!=M.y>u.y&&u.x<(M.x-v.x)*(u.y-v.y)/(M.y-v.y)+v.x&&(L=!L)}return L}function Ed(p,u){let A=!1;for(let v=0,M=p.length-1;v<p.length;M=v++){const L=p[v],k=p[M];L.y>u.y!=k.y>u.y&&u.x<(k.x-L.x)*(u.y-L.y)/(k.y-L.y)+L.x&&(A=!A)}return A}function $u(p,u,A){const v=A[0],M=A[2];if(p.x<v.x&&u.x<v.x||p.x>M.x&&u.x>M.x||p.y<v.y&&u.y<v.y||p.y>M.y&&u.y>M.y)return!1;const L=Gr(p,u,A[0]);return L!==Gr(p,u,A[1])||L!==Gr(p,u,A[2])||L!==Gr(p,u,A[3])}function Kp(p,u,A){const v=u.paint.get(p).value;return v.kind==="constant"?v.value:A.programConfigurations.get(u.id).getMaxValue(p)}function Wp(p){return Math.sqrt(p[0]*p[0]+p[1]*p[1])}function xy(p,u,A,v,M){if(!u[0]&&!u[1])return p;const L=N.convert(u)._mult(M);A==="viewport"&&L._rotate(-v);const k=[];for(let Q=0;Q<p.length;Q++)k.push(p[Q].sub(L));return k}let Tv,lT;un("CircleBucket",$p,{omit:["layers"]});var vD={get paint(){return lT=lT||new It({"circle-radius":new Ze(Xe.paint_circle["circle-radius"]),"circle-color":new Ze(Xe.paint_circle["circle-color"]),"circle-blur":new Ze(Xe.paint_circle["circle-blur"]),"circle-opacity":new Ze(Xe.paint_circle["circle-opacity"]),"circle-translate":new qe(Xe.paint_circle["circle-translate"]),"circle-translate-anchor":new qe(Xe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new qe(Xe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new qe(Xe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ze(Xe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ze(Xe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ze(Xe.paint_circle["circle-stroke-opacity"])})},get layout(){return Tv=Tv||new It({"circle-sort-key":new Ze(Xe.layout_circle["circle-sort-key"])})}};class xD extends wr{constructor(u){super(u,vD)}createBucket(u){return new $p(u)}queryRadius(u){const A=u;return Kp("circle-radius",this,A)+Kp("circle-stroke-width",this,A)+Wp(this.paint.get("circle-translate"))}queryIntersectsFeature(u){let{queryGeometry:A,feature:v,featureState:M,geometry:L,transform:k,pixelsToTileUnits:Q,pixelPosMatrix:q}=u;const te=xy(A,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-k.bearingInRadians,Q),ae=this.paint.get("circle-radius").evaluate(v,M)+this.paint.get("circle-stroke-width").evaluate(v,M),de=this.paint.get("circle-pitch-alignment")==="map",ye=de?te:function(Ie,ke){return Ie.map(nt=>cT(nt,ke))}(te,q),me=de?ae*Q:ae;for(const Ie of L)for(const ke of Ie){const nt=de?ke:cT(ke,q);let ct=me;const Ot=ze([],[ke.x,ke.y,0,1],q);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?ct*=Ot[3]/k.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(ct*=k.cameraToCenterDistance/Ot[3]),Rm(ye,nt,ct))return!0}return!1}}function cT(p,u){const A=ze([],[p.x,p.y,0,1],u);return new N(A[0]/A[3],A[1]/A[3])}class Sv extends $p{}let Iv;un("HeatmapBucket",Sv,{omit:["layers"]});var kA={get paint(){return Iv=Iv||new It({"heatmap-radius":new Ze(Xe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ze(Xe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new qe(Xe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new kt(Xe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new qe(Xe.paint_heatmap["heatmap-opacity"])})}};function UA(p,u,A,v){let{width:M,height:L}=u;if(v){if(v instanceof Uint8ClampedArray)v=new Uint8Array(v.buffer);else if(v.length!==M*L*A)throw new RangeError(`mismatched image size. expected: ${v.length} but got: ${M*L*A}`)}else v=new Uint8Array(M*L*A);return p.width=M,p.height=L,p.data=v,p}function uT(p,u,A){let{width:v,height:M}=u;if(v===p.width&&M===p.height)return;const L=UA({},{width:v,height:M},A);Mv(p,L,{x:0,y:0},{x:0,y:0},{width:Math.min(p.width,v),height:Math.min(p.height,M)},A),p.width=v,p.height=M,p.data=L.data}function Mv(p,u,A,v,M,L){if(M.width===0||M.height===0)return u;if(M.width>p.width||M.height>p.height||A.x>p.width-M.width||A.y>p.height-M.height)throw new RangeError("out of range source coordinates for image copy");if(M.width>u.width||M.height>u.height||v.x>u.width-M.width||v.y>u.height-M.height)throw new RangeError("out of range destination coordinates for image copy");const k=p.data,Q=u.data;if(k===Q)throw new Error("srcData equals dstData, so image is already copied");for(let q=0;q<M.height;q++){const te=((A.y+q)*p.width+A.x)*L,ae=((v.y+q)*u.width+v.x)*L;for(let de=0;de<M.width*L;de++)Q[ae+de]=k[te+de]}return u}class Dm{constructor(u,A){UA(this,u,1,A)}resize(u){uT(this,u,1)}clone(){return new Dm({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(u,A,v,M,L){Mv(u,A,v,M,L,1)}}class ju{constructor(u,A){UA(this,u,4,A)}resize(u){uT(this,u,4)}replace(u,A){A?this.data.set(u):this.data=u instanceof Uint8ClampedArray?new Uint8Array(u.buffer):u}clone(){return new ju({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(u,A,v,M,L){Mv(u,A,v,M,L,4)}}function hT(p){const u={},A=p.resolution||256,v=p.clips?p.clips.length:1,M=p.image||new ju({width:A,height:v});if(Math.log(A)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${A}`);const L=(k,Q,q)=>{u[p.evaluationKey]=q;const te=p.expression.evaluate(u);M.data[k+Q+0]=Math.floor(255*te.r/te.a),M.data[k+Q+1]=Math.floor(255*te.g/te.a),M.data[k+Q+2]=Math.floor(255*te.b/te.a),M.data[k+Q+3]=Math.floor(255*te.a)};if(p.clips)for(let k=0,Q=0;k<v;++k,Q+=4*A)for(let q=0,te=0;q<A;q++,te+=4){const ae=q/(A-1),{start:de,end:ye}=p.clips[k];L(Q,te,de*(1-ae)+ye*ae)}else for(let k=0,Q=0;k<A;k++,Q+=4)L(0,Q,k/(A-1));return M}un("AlphaImage",Dm),un("RGBAImage",ju);const Pv="big-fb";class wD extends wr{createBucket(u){return new Sv(u)}constructor(u){super(u,kA),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(u){u==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=hT({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(Pv)&&this.heatmapFbos.delete(Pv)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let wy;var BD={get paint(){return wy=wy||new It({"hillshade-illumination-direction":new qe(Xe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new qe(Xe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new qe(Xe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new qe(Xe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new qe(Xe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new qe(Xe.paint_hillshade["hillshade-accent-color"])})}};class Xp extends wr{constructor(u){super(u,BD)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const CD=xr([{name:"a_pos",components:2,type:"Int16"}],4),{members:zo}=CD;function Jp(p,u,A){const v=A.patternDependencies;let M=!1;for(const L of u){const k=L.paint.get(`${p}-pattern`);k.isConstant()||(M=!0);const Q=k.constantOr(null);Q&&(M=!0,v[Q.to]=!0,v[Q.from]=!0)}return M}function By(p,u,A,v,M){const L=M.patternDependencies;for(const k of u){const Q=k.paint.get(`${p}-pattern`).value;if(Q.kind!=="constant"){let q=Q.evaluate({zoom:v-1},A,{},M.availableImages),te=Q.evaluate({zoom:v},A,{},M.availableImages),ae=Q.evaluate({zoom:v+1},A,{},M.availableImages);q=q&&q.name?q.name:q,te=te&&te.name?te.name:te,ae=ae&&ae.name?ae.name:ae,L[q]=!0,L[te]=!0,L[ae]=!0,A.patterns[k.id]={min:q,mid:te,max:ae}}}return A}function Om(p,u,A,v,M){let L;if(M===function(k,Q,q,te){let ae=0;for(let de=Q,ye=q-te;de<q;de+=te)ae+=(k[ye]-k[de])*(k[de+1]+k[ye+1]),ye=de;return ae}(p,u,A,v)>0)for(let k=u;k<A;k+=v)L=mT(k/v|0,p[k],p[k+1],L);else for(let k=A-v;k>=u;k-=v)L=mT(k/v|0,p[k],p[k+1],L);return L&&Zp(L,L.next)&&(zm(L),L=L.next),L}function Td(p,u){if(!p)return p;u||(u=p);let A,v=p;do if(A=!1,v.steiner||!Zp(v,v.next)&&Ho(v.prev,v,v.next)!==0)v=v.next;else{if(zm(v),v=u=v.prev,v===v.next)break;A=!0}while(A||v!==u);return u}function Bf(p,u,A,v,M,L,k){if(!p)return;!k&&L&&function(q,te,ae,de){let ye=q;do ye.z===0&&(ye.z=Cy(ye.x,ye.y,te,ae,de)),ye.prevZ=ye.prev,ye.nextZ=ye.next,ye=ye.next;while(ye!==q);ye.prevZ.nextZ=null,ye.prevZ=null,function(me){let Ie,ke=1;do{let nt,ct=me;me=null;let Ot=null;for(Ie=0;ct;){Ie++;let wt=ct,Re=0;for(let Et=0;Et<ke&&(Re++,wt=wt.nextZ,wt);Et++);let it=ke;for(;Re>0||it>0&&wt;)Re!==0&&(it===0||!wt||ct.z<=wt.z)?(nt=ct,ct=ct.nextZ,Re--):(nt=wt,wt=wt.nextZ,it--),Ot?Ot.nextZ=nt:me=nt,nt.prevZ=Ot,Ot=nt;ct=wt}Ot.nextZ=null,ke*=2}while(Ie>1)}(ye)}(p,v,M,L);let Q=p;for(;p.prev!==p.next;){const q=p.prev,te=p.next;if(L?fT(p,v,M,L):dT(p))u.push(q.i,p.i,te.i),zm(p),p=te.next,Q=te.next;else if((p=te)===Q){k?k===1?Bf(p=km(Td(p),u),u,A,v,M,L,2):k===2&&Fv(p,u,A,v,M,L):Bf(Td(p),u,A,v,M,L,1);break}}}function dT(p){const u=p.prev,A=p,v=p.next;if(Ho(u,A,v)>=0)return!1;const M=u.x,L=A.x,k=v.x,Q=u.y,q=A.y,te=v.y,ae=Math.min(M,L,k),de=Math.min(Q,q,te),ye=Math.max(M,L,k),me=Math.max(Q,q,te);let Ie=v.next;for(;Ie!==u;){if(Ie.x>=ae&&Ie.x<=ye&&Ie.y>=de&&Ie.y<=me&&Um(M,Q,L,q,k,te,Ie.x,Ie.y)&&Ho(Ie.prev,Ie,Ie.next)>=0)return!1;Ie=Ie.next}return!0}function fT(p,u,A,v){const M=p.prev,L=p,k=p.next;if(Ho(M,L,k)>=0)return!1;const Q=M.x,q=L.x,te=k.x,ae=M.y,de=L.y,ye=k.y,me=Math.min(Q,q,te),Ie=Math.min(ae,de,ye),ke=Math.max(Q,q,te),nt=Math.max(ae,de,ye),ct=Cy(me,Ie,u,A,v),Ot=Cy(ke,nt,u,A,v);let wt=p.prevZ,Re=p.nextZ;for(;wt&&wt.z>=ct&&Re&&Re.z<=Ot;){if(wt.x>=me&&wt.x<=ke&&wt.y>=Ie&&wt.y<=nt&&wt!==M&&wt!==k&&Um(Q,ae,q,de,te,ye,wt.x,wt.y)&&Ho(wt.prev,wt,wt.next)>=0||(wt=wt.prevZ,Re.x>=me&&Re.x<=ke&&Re.y>=Ie&&Re.y<=nt&&Re!==M&&Re!==k&&Um(Q,ae,q,de,te,ye,Re.x,Re.y)&&Ho(Re.prev,Re,Re.next)>=0))return!1;Re=Re.nextZ}for(;wt&&wt.z>=ct;){if(wt.x>=me&&wt.x<=ke&&wt.y>=Ie&&wt.y<=nt&&wt!==M&&wt!==k&&Um(Q,ae,q,de,te,ye,wt.x,wt.y)&&Ho(wt.prev,wt,wt.next)>=0)return!1;wt=wt.prevZ}for(;Re&&Re.z<=Ot;){if(Re.x>=me&&Re.x<=ke&&Re.y>=Ie&&Re.y<=nt&&Re!==M&&Re!==k&&Um(Q,ae,q,de,te,ye,Re.x,Re.y)&&Ho(Re.prev,Re,Re.next)>=0)return!1;Re=Re.nextZ}return!0}function km(p,u){let A=p;do{const v=A.prev,M=A.next.next;!Zp(v,M)&&Cf(v,A,A.next,M)&&Sd(v,M)&&Sd(M,v)&&(u.push(v.i,A.i,M.i),zm(A),zm(A.next),A=p=M),A=A.next}while(A!==p);return Td(A)}function Fv(p,u,A,v,M,L){let k=p;do{let Q=k.next.next;for(;Q!==k.prev;){if(k.i!==Q.i&&ED(k,Q)){let q=gT(k,Q);return k=Td(k,k.next),q=Td(q,q.next),Bf(k,u,A,v,M,L,0),void Bf(q,u,A,v,M,L,0)}Q=Q.next}k=k.next}while(k!==p)}function Rv(p,u){let A=p.x-u.x;return A===0&&(A=p.y-u.y,A===0)&&(A=(p.next.y-p.y)/(p.next.x-p.x)-(u.next.y-u.y)/(u.next.x-u.x)),A}function Lv(p,u){const A=function(M,L){let k=L;const Q=M.x,q=M.y;let te,ae=-1/0;if(Zp(M,k))return k;do{if(Zp(M,k.next))return k.next;if(q<=k.y&&q>=k.next.y&&k.next.y!==k.y){const ke=k.x+(q-k.y)*(k.next.x-k.x)/(k.next.y-k.y);if(ke<=Q&&ke>ae&&(ae=ke,te=k.x<k.next.x?k:k.next,ke===Q))return te}k=k.next}while(k!==L);if(!te)return null;const de=te,ye=te.x,me=te.y;let Ie=1/0;k=te;do{if(Q>=k.x&&k.x>=ye&&Q!==k.x&&pT(q<me?Q:ae,q,ye,me,q<me?ae:Q,q,k.x,k.y)){const ke=Math.abs(q-k.y)/(Q-k.x);Sd(k,M)&&(ke<Ie||ke===Ie&&(k.x>te.x||k.x===te.x&&Dv(te,k)))&&(te=k,Ie=ke)}k=k.next}while(k!==de);return te}(p,u);if(!A)return u;const v=gT(A,p);return Td(v,v.next),Td(A,A.next)}function Dv(p,u){return Ho(p.prev,p,u.prev)<0&&Ho(u.next,p,p.next)<0}function Cy(p,u,A,v,M){return(p=1431655765&((p=858993459&((p=252645135&((p=16711935&((p=(p-A)*M|0)|p<<8))|p<<4))|p<<2))|p<<1))|(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u=(u-v)*M|0)|u<<8))|u<<4))|u<<2))|u<<1))<<1}function AT(p){let u=p,A=p;do(u.x<A.x||u.x===A.x&&u.y<A.y)&&(A=u),u=u.next;while(u!==p);return A}function pT(p,u,A,v,M,L,k,Q){return(M-k)*(u-Q)>=(p-k)*(L-Q)&&(p-k)*(v-Q)>=(A-k)*(u-Q)&&(A-k)*(L-Q)>=(M-k)*(v-Q)}function Um(p,u,A,v,M,L,k,Q){return!(p===k&&u===Q)&&pT(p,u,A,v,M,L,k,Q)}function ED(p,u){return p.next.i!==u.i&&p.prev.i!==u.i&&!function(A,v){let M=A;do{if(M.i!==A.i&&M.next.i!==A.i&&M.i!==v.i&&M.next.i!==v.i&&Cf(M,M.next,A,v))return!0;M=M.next}while(M!==A);return!1}(p,u)&&(Sd(p,u)&&Sd(u,p)&&function(A,v){let M=A,L=!1;const k=(A.x+v.x)/2,Q=(A.y+v.y)/2;do M.y>Q!=M.next.y>Q&&M.next.y!==M.y&&k<(M.next.x-M.x)*(Q-M.y)/(M.next.y-M.y)+M.x&&(L=!L),M=M.next;while(M!==A);return L}(p,u)&&(Ho(p.prev,p,u.prev)||Ho(p,u.prev,u))||Zp(p,u)&&Ho(p.prev,p,p.next)>0&&Ho(u.prev,u,u.next)>0)}function Ho(p,u,A){return(u.y-p.y)*(A.x-u.x)-(u.x-p.x)*(A.y-u.y)}function Zp(p,u){return p.x===u.x&&p.y===u.y}function Cf(p,u,A,v){const M=Nm(Ho(p,u,A)),L=Nm(Ho(p,u,v)),k=Nm(Ho(A,v,p)),Q=Nm(Ho(A,v,u));return M!==L&&k!==Q||!(M!==0||!Ey(p,A,u))||!(L!==0||!Ey(p,v,u))||!(k!==0||!Ey(A,p,v))||!(Q!==0||!Ey(A,u,v))}function Ey(p,u,A){return u.x<=Math.max(p.x,A.x)&&u.x>=Math.min(p.x,A.x)&&u.y<=Math.max(p.y,A.y)&&u.y>=Math.min(p.y,A.y)}function Nm(p){return p>0?1:p<0?-1:0}function Sd(p,u){return Ho(p.prev,p,p.next)<0?Ho(p,u,p.next)>=0&&Ho(p,p.prev,u)>=0:Ho(p,u,p.prev)<0||Ho(p,p.next,u)<0}function gT(p,u){const A=Ty(p.i,p.x,p.y),v=Ty(u.i,u.x,u.y),M=p.next,L=u.prev;return p.next=u,u.prev=p,A.next=M,M.prev=A,v.next=A,A.prev=v,L.next=v,v.prev=L,v}function mT(p,u,A,v){const M=Ty(p,u,A);return v?(M.next=v.next,M.prev=v,v.next.prev=M,v.next=M):(M.prev=M,M.next=M),M}function zm(p){p.next.prev=p.prev,p.prev.next=p.next,p.prevZ&&(p.prevZ.nextZ=p.nextZ),p.nextZ&&(p.nextZ.prevZ=p.prevZ)}function Ty(p,u,A){return{i:p,x:u,y:A,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class NA{constructor(u,A){if(A>u)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=u,this._minGranularity=A}getGranularityForZoomLevel(u){return Math.max(Math.floor(this._baseZoomGranularity/(1<<u)),this._minGranularity,1)}}class Sy{constructor(u){this.fill=u.fill,this.line=u.line,this.tile=u.tile,this.stencil=u.stencil,this.circle=u.circle}}Sy.noSubdivision=new Sy({fill:new NA(0,0),line:new NA(0,0),tile:new NA(0,0),stencil:new NA(0,0),circle:1}),un("SubdivisionGranularityExpression",NA),un("SubdivisionGranularitySetting",Sy);const Yp=-32768,Hm=32767;class TD{constructor(u,A){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=u,this._granularityCellSize=Vt/u,this._canonical=A}_getKey(u,A){return(u+=32768)<<16|(A+=32768)<<0}_vertexToIndex(u,A){if(u<-32768||A<-32768||u>32767||A>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const v=0|Math.round(u),M=0|Math.round(A),L=this._getKey(v,M);if(this._vertexDictionary.has(L))return this._vertexDictionary.get(L);const k=this._vertexBuffer.length/2;return this._vertexDictionary.set(L,k),this._vertexBuffer.push(v,M),k}_subdivideTrianglesScanline(u){if(this._granularity<2)return function(M,L){const k=[];for(let Q=0;Q<L.length;Q+=3){const q=L[Q],te=L[Q+1],ae=L[Q+2],de=M[2*q],ye=M[2*q+1];(M[2*te]-de)*(M[2*ae+1]-ye)-(M[2*te+1]-ye)*(M[2*ae]-de)>0?(k.push(q),k.push(ae),k.push(te)):(k.push(q),k.push(te),k.push(ae))}return k}(this._vertexBuffer,u);const A=[],v=u.length;for(let M=0;M<v;M+=3){const L=[u[M+0],u[M+1],u[M+2]],k=[this._vertexBuffer[2*u[M+0]+0],this._vertexBuffer[2*u[M+0]+1],this._vertexBuffer[2*u[M+1]+0],this._vertexBuffer[2*u[M+1]+1],this._vertexBuffer[2*u[M+2]+0],this._vertexBuffer[2*u[M+2]+1]];let Q=1/0,q=1/0,te=-1/0,ae=-1/0;for(let ke=0;ke<3;ke++){const nt=k[2*ke],ct=k[2*ke+1];Q=Math.min(Q,nt),te=Math.max(te,nt),q=Math.min(q,ct),ae=Math.max(ae,ct)}if(Q===te||q===ae)continue;const de=Math.floor(Q/this._granularityCellSize),ye=Math.ceil(te/this._granularityCellSize),me=Math.floor(q/this._granularityCellSize),Ie=Math.ceil(ae/this._granularityCellSize);if(de!==ye||me!==Ie)for(let ke=me;ke<Ie;ke++){const nt=this._scanlineGenerateVertexRingForCellRow(ke,k,L);Ov(this._vertexBuffer,nt,A)}else A.push(...L)}return A}_scanlineGenerateVertexRingForCellRow(u,A,v){const M=u*this._granularityCellSize,L=M+this._granularityCellSize,k=[];for(let Q=0;Q<3;Q++){const q=A[2*Q],te=A[2*Q+1],ae=A[2*(Q+1)%6],de=A[(2*(Q+1)+1)%6],ye=A[2*(Q+2)%6],me=A[(2*(Q+2)+1)%6],Ie=ae-q,ke=de-te,nt=Ie===0,ct=ke===0,Ot=(M-te)/ke,wt=(L-te)/ke,Re=Math.min(Ot,wt),it=Math.max(Ot,wt);if(!ct&&(Re>=1||it<=0)||ct&&(te<M||te>L)){de>=M&&de<=L&&k.push(v[(Q+1)%3]);continue}!ct&&Re>0&&k.push(this._vertexToIndex(q+Ie*Re,te+ke*Re));const Et=q+Ie*Math.max(Re,0),Zt=q+Ie*Math.min(it,1);nt||this._generateIntraEdgeVertices(k,q,te,ae,de,Et,Zt),!ct&&it<1&&k.push(this._vertexToIndex(q+Ie*it,te+ke*it)),(ct||de>=M&&de<=L)&&k.push(v[(Q+1)%3]),!ct&&(de<=M||de>=L)&&this._generateInterEdgeVertices(k,q,te,ae,de,ye,me,Zt,M,L)}return k}_generateIntraEdgeVertices(u,A,v,M,L,k,Q){const q=M-A,te=L-v,ae=te===0,de=ae?Math.min(A,M):Math.min(k,Q),ye=ae?Math.max(A,M):Math.max(k,Q),me=Math.floor(de/this._granularityCellSize)+1,Ie=Math.ceil(ye/this._granularityCellSize)-1;if(ae?A<M:k<Q)for(let ke=me;ke<=Ie;ke++){const nt=ke*this._granularityCellSize;u.push(this._vertexToIndex(nt,v+te*(nt-A)/q))}else for(let ke=Ie;ke>=me;ke--){const nt=ke*this._granularityCellSize;u.push(this._vertexToIndex(nt,v+te*(nt-A)/q))}}_generateInterEdgeVertices(u,A,v,M,L,k,Q,q,te,ae){const de=L-v,ye=k-M,me=Q-L,Ie=(te-L)/me,ke=(ae-L)/me,nt=Math.min(Ie,ke),ct=Math.max(Ie,ke),Ot=M+ye*nt;let wt=Math.floor(Math.min(Ot,q)/this._granularityCellSize)+1,Re=Math.ceil(Math.max(Ot,q)/this._granularityCellSize)-1,it=q<Ot;const Et=me===0;if(Et&&(Q===te||Q===ae))return;if(Et||nt>=1||ct<=0){const Br=v-Q,or=k+(A-k)*Math.min((te-Q)/Br,(ae-Q)/Br);wt=Math.floor(Math.min(or,q)/this._granularityCellSize)+1,Re=Math.ceil(Math.max(or,q)/this._granularityCellSize)-1,it=q<or}const Zt=de>0?ae:te;if(it)for(let Br=wt;Br<=Re;Br++)u.push(this._vertexToIndex(Br*this._granularityCellSize,Zt));else for(let Br=Re;Br>=wt;Br--)u.push(this._vertexToIndex(Br*this._granularityCellSize,Zt))}_generateOutline(u){const A=[];for(const v of u){const M=Kh(v,this._granularity,!0),L=this._pointArrayToIndices(M),k=[];for(let Q=1;Q<L.length;Q++)k.push(L[Q-1]),k.push(L[Q]);A.push(k)}return A}_handlePoles(u){let A=!1,v=!1;this._canonical&&(this._canonical.y===0&&(A=!0),this._canonical.y===(1<<this._canonical.z)-1&&(v=!0)),(A||v)&&this._fillPoles(u,A,v)}_ensureNoPoleVertices(){const u=this._vertexBuffer;for(let A=0;A<u.length;A+=2){const v=u[A+1];v===Yp&&(u[A+1]=-32767),v===Hm&&(u[A+1]=32766)}}_generatePoleQuad(u,A,v,M,L,k){M>L!=(k===Yp)?(u.push(A),u.push(v),u.push(this._vertexToIndex(M,k)),u.push(v),u.push(this._vertexToIndex(L,k)),u.push(this._vertexToIndex(M,k))):(u.push(v),u.push(A),u.push(this._vertexToIndex(M,k)),u.push(this._vertexToIndex(L,k)),u.push(v),u.push(this._vertexToIndex(M,k)))}_fillPoles(u,A,v){const M=this._vertexBuffer,L=Vt,k=u.length;for(let Q=2;Q<k;Q+=3){const q=u[Q-2],te=u[Q-1],ae=u[Q],de=M[2*q],ye=M[2*q+1],me=M[2*te],Ie=M[2*te+1],ke=M[2*ae],nt=M[2*ae+1];A&&(ye===0&&Ie===0&&this._generatePoleQuad(u,q,te,de,me,Yp),Ie===0&&nt===0&&this._generatePoleQuad(u,te,ae,me,ke,Yp),nt===0&&ye===0&&this._generatePoleQuad(u,ae,q,ke,de,Yp)),v&&(ye===L&&Ie===L&&this._generatePoleQuad(u,q,te,de,me,Hm),Ie===L&&nt===L&&this._generatePoleQuad(u,te,ae,me,ke,Hm),nt===L&&ye===L&&this._generatePoleQuad(u,ae,q,ke,de,Hm))}}_initializeVertices(u){for(let A=0;A<u.length;A+=2)this._vertexToIndex(u[A],u[A+1])}subdividePolygonInternal(u,A){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:v,holeIndices:M}=function(Q){const q=[],te=[];for(const ae of Q)if(ae.length!==0){ae!==Q[0]&&q.push(te.length/2);for(let de=0;de<ae.length;de++)te.push(ae[de].x),te.push(ae[de].y)}return{flattened:te,holeIndices:q}}(u);let L;this._initializeVertices(v);try{const Q=function(te,ae){let de=arguments.length>2&&arguments[2]!==void 0?arguments[2]:2;const ye=ae&&ae.length,me=ye?ae[0]*de:te.length;let Ie=Om(te,0,me,de,!0);const ke=[];if(!Ie||Ie.next===Ie.prev)return ke;let nt,ct,Ot;if(ye&&(Ie=function(wt,Re,it,Et){const Zt=[];for(let Br=0,or=Re.length;Br<or;Br++){const lr=Om(wt,Re[Br]*Et,Br<or-1?Re[Br+1]*Et:wt.length,Et,!1);lr===lr.next&&(lr.steiner=!0),Zt.push(AT(lr))}Zt.sort(Rv);for(let Br=0;Br<Zt.length;Br++)it=Lv(Zt[Br],it);return it}(te,ae,Ie,de)),te.length>80*de){nt=1/0,ct=1/0;let wt=-1/0,Re=-1/0;for(let it=de;it<me;it+=de){const Et=te[it],Zt=te[it+1];Et<nt&&(nt=Et),Zt<ct&&(ct=Zt),Et>wt&&(wt=Et),Zt>Re&&(Re=Zt)}Ot=Math.max(wt-nt,Re-ct),Ot=Ot!==0?32767/Ot:0}return Bf(Ie,ke,de,nt,ct,Ot,0),ke}(v,M),q=this._convertIndices(v,Q);L=this._subdivideTrianglesScanline(q)}catch(Q){console.error(Q)}let k=[];return A&&(k=this._generateOutline(u)),this._ensureNoPoleVertices(),this._handlePoles(L),{verticesFlattened:this._vertexBuffer,indicesTriangles:L,indicesLineList:k}}_convertIndices(u,A){const v=[];for(let M=0;M<A.length;M++)v.push(this._vertexToIndex(u[2*A[M]],u[2*A[M]+1]));return v}_pointArrayToIndices(u){const A=[];for(let v=0;v<u.length;v++){const M=u[v];A.push(this._vertexToIndex(M.x,M.y))}return A}}function Iy(p,u,A){let v=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0;return new TD(A,u).subdividePolygonInternal(p,v)}function Kh(p,u){let A=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(!p||p.length<1)return[];if(p.length<2)return[];const v=p[0],M=p[p.length-1],L=A&&(v.x!==M.x||v.y!==M.y);if(u<2)return L?[...p,p[0]]:[...p];const k=Math.floor(Vt/u),Q=[];Q.push(new N(p[0].x,p[0].y));const q=p.length,te=L?q:q-1;for(let ae=0;ae<te;ae++){const de=p[ae],ye=ae<q-1?p[ae+1]:p[0],me=de.x,Ie=de.y,ke=ye.x,nt=ye.y,ct=me!==ke,Ot=Ie!==nt;if(!ct&&!Ot)continue;const wt=ke-me,Re=nt-Ie,it=Math.abs(wt),Et=Math.abs(Re);let Zt=me,Br=Ie;for(;;){const lr=wt>0?(Math.floor(Zt/k)+1)*k:(Math.ceil(Zt/k)-1)*k,Lr=Re>0?(Math.floor(Br/k)+1)*k:(Math.ceil(Br/k)-1)*k,Tr=Math.abs(Zt-lr),Hr=Math.abs(Br-Lr),Ar=Math.abs(Zt-ke),hn=Math.abs(Br-nt),Mn=ct?Tr/it:Number.POSITIVE_INFINITY,wn=Ot?Hr/Et:Number.POSITIVE_INFINITY;if((Ar<=Tr||!ct)&&(hn<=Hr||!Ot))break;if(Mn<wn&&ct||!Ot){Zt=lr,Br+=Re*Mn;const Kr=new N(Zt,Math.round(Br));Q[Q.length-1].x===Kr.x&&Q[Q.length-1].y===Kr.y||Q.push(Kr)}else{Zt+=wt*wn,Br=Lr;const Kr=new N(Math.round(Zt),Br);Q[Q.length-1].x===Kr.x&&Q[Q.length-1].y===Kr.y||Q.push(Kr)}}const or=new N(ke,nt);Q[Q.length-1].x===or.x&&Q[Q.length-1].y===or.y||Q.push(or)}return Q}function Ov(p,u,A){if(u.length===0)throw new Error("Subdivision vertex ring is empty.");let v=0,M=p[2*u[0]];for(let q=1;q<u.length;q++){const te=p[2*u[q]];te<M&&(M=te,v=q)}const L=u.length;let k=v,Q=(k+1)%L;for(;;){const q=k-1>=0?k-1:L-1,te=(Q+1)%L,ae=p[2*u[q]],de=p[2*u[te]],ye=p[2*u[k]],me=p[2*u[k]+1],Ie=p[2*u[Q]+1];let ke=!1;if(ae<de)ke=!0;else if(ae>de)ke=!1;else{const nt=Ie-me,ct=-(p[2*u[Q]]-ye),Ot=me<Ie?1:-1;((ae-ye)*nt+(p[2*u[q]+1]-me)*ct)*Ot>((de-ye)*nt+(p[2*u[te]+1]-me)*ct)*Ot&&(ke=!0)}if(ke){const nt=u[q],ct=u[k],Ot=u[Q];nt!==ct&&nt!==Ot&&ct!==Ot&&A.push(Ot,ct,nt),k--,k<0&&(k=L-1)}else{const nt=u[te],ct=u[k],Ot=u[Q];nt!==ct&&nt!==Ot&&ct!==Ot&&A.push(Ot,ct,nt),Q++,Q>=L&&(Q=0)}if(q===te)break}}function _T(p,u,A,v,M,L,k,Q,q){const te=M.length/2,ae=k&&Q&&q;if(te<tn.MAX_VERTEX_ARRAY_LENGTH){const de=u.prepareSegment(te,A,v),ye=de.vertexLength;for(let ke=0;ke<L.length;ke+=3)v.emplaceBack(ye+L[ke],ye+L[ke+1],ye+L[ke+2]);let me,Ie;de.vertexLength+=te,de.primitiveLength+=L.length/3,ae&&(Ie=k.prepareSegment(te,A,Q),me=Ie.vertexLength,Ie.vertexLength+=te);for(let ke=0;ke<M.length;ke+=2)p(M[ke],M[ke+1]);if(ae)for(let ke=0;ke<q.length;ke++){const nt=q[ke];for(let ct=1;ct<nt.length;ct+=2)Q.emplaceBack(me+nt[ct-1],me+nt[ct]);Ie.primitiveLength+=nt.length/2}}else(function(de,ye,me,Ie,ke,nt){const ct=[];for(let Et=0;Et<Ie.length/2;Et++)ct.push(-1);const Ot={count:0};let wt=0,Re=de.getOrCreateLatestSegment(ye,me),it=Re.vertexLength;for(let Et=2;Et<ke.length;Et+=3){const Zt=ke[Et-2],Br=ke[Et-1],or=ke[Et];let lr=ct[Zt]<wt,Lr=ct[Br]<wt,Tr=ct[or]<wt;Re.vertexLength+((lr?1:0)+(Lr?1:0)+(Tr?1:0))>tn.MAX_VERTEX_ARRAY_LENGTH&&(Re=de.createNewSegment(ye,me),wt=Ot.count,lr=!0,Lr=!0,Tr=!0,it=0);const Hr=Vm(ct,Ie,nt,Ot,Zt,lr,Re),Ar=Vm(ct,Ie,nt,Ot,Br,Lr,Re),hn=Vm(ct,Ie,nt,Ot,or,Tr,Re);me.emplaceBack(it+Hr-wt,it+Ar-wt,it+hn-wt),Re.primitiveLength++}})(u,A,v,M,L,p),ae&&function(de,ye,me,Ie,ke,nt){const ct=[];for(let Et=0;Et<Ie.length/2;Et++)ct.push(-1);const Ot={count:0};let wt=0,Re=de.getOrCreateLatestSegment(ye,me),it=Re.vertexLength;for(let Et=0;Et<ke.length;Et++){const Zt=ke[Et];for(let Br=1;Br<ke[Et].length;Br+=2){const or=Zt[Br-1],lr=Zt[Br];let Lr=ct[or]<wt,Tr=ct[lr]<wt;Re.vertexLength+((Lr?1:0)+(Tr?1:0))>tn.MAX_VERTEX_ARRAY_LENGTH&&(Re=de.createNewSegment(ye,me),wt=Ot.count,Lr=!0,Tr=!0,it=0);const Hr=Vm(ct,Ie,nt,Ot,or,Lr,Re),Ar=Vm(ct,Ie,nt,Ot,lr,Tr,Re);me.emplaceBack(it+Hr-wt,it+Ar-wt),Re.primitiveLength++}}}(k,A,Q,M,q,p),u.forceNewSegmentOnNextPrepare(),k==null||k.forceNewSegmentOnNextPrepare()}function Vm(p,u,A,v,M,L,k){if(L){const Q=v.count;return A(u[2*M],u[2*M+1]),p[M]=v.count,v.count++,k.vertexLength++,Q}return p[M]}class My{constructor(u){this.zoom=u.zoom,this.overscaling=u.overscaling,this.layers=u.layers,this.layerIds=this.layers.map(A=>A.id),this.index=u.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new xt,this.indexArray=new fr,this.indexArray2=new qr,this.programConfigurations=new Qs(u.layers,u.zoom),this.segments=new tn,this.segments2=new tn,this.stateDependentLayerIds=this.layers.filter(A=>A.isStateDependent()).map(A=>A.id)}populate(u,A,v){this.hasPattern=Jp("fill",this.layers,A);const M=this.layers[0].layout.get("fill-sort-key"),L=!M.isConstant(),k=[];for(const{feature:Q,id:q,index:te,sourceLayerIndex:ae}of u){const de=this.layers[0]._featureFilter.needGeometry,ye=jh(Q,de);if(!this.layers[0]._featureFilter.filter(new Z(this.zoom),ye,v))continue;const me=L?M.evaluate(ye,{},v,A.availableImages):void 0,Ie={id:q,properties:Q.properties,type:Q.type,sourceLayerIndex:ae,index:te,geometry:de?ye.geometry:Tu(Q),patterns:{},sortKey:me};k.push(Ie)}L&&k.sort((Q,q)=>Q.sortKey-q.sortKey);for(const Q of k){const{geometry:q,index:te,sourceLayerIndex:ae}=Q;if(this.hasPattern){const de=By("fill",this.layers,Q,this.zoom,A);this.patternFeatures.push(de)}else this.addFeature(Q,q,te,v,{},A.subdivisionGranularity);A.featureIndex.insert(u[te].feature,q,te,ae,this.index)}}update(u,A,v){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(u,A,this.stateDependentLayers,v)}addFeatures(u,A,v){for(const M of this.patternFeatures)this.addFeature(M,M.geometry,M.index,A,v,u.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(u){this.uploaded||(this.layoutVertexBuffer=u.createVertexBuffer(this.layoutVertexArray,zo),this.indexBuffer=u.createIndexBuffer(this.indexArray),this.indexBuffer2=u.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(u),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(u,A,v,M,L,k){for(const Q of vi(A,500)){const q=Iy(Q,M,k.fill.getGranularityForZoomLevel(M.z)),te=this.layoutVertexArray;_T((ae,de)=>{te.emplaceBack(ae,de)},this.segments,this.layoutVertexArray,this.indexArray,q.verticesFlattened,q.indicesTriangles,this.segments2,this.indexArray2,q.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,u,v,L,M)}}let yT,bT;un("FillBucket",My,{omit:["layers","patternFeatures"]});var Gm={get paint(){return bT=bT||new It({"fill-antialias":new qe(Xe.paint_fill["fill-antialias"]),"fill-opacity":new Ze(Xe.paint_fill["fill-opacity"]),"fill-color":new Ze(Xe.paint_fill["fill-color"]),"fill-outline-color":new Ze(Xe.paint_fill["fill-outline-color"]),"fill-translate":new qe(Xe.paint_fill["fill-translate"]),"fill-translate-anchor":new qe(Xe.paint_fill["fill-translate-anchor"]),"fill-pattern":new ot(Xe.paint_fill["fill-pattern"])})},get layout(){return yT=yT||new It({"fill-sort-key":new Ze(Xe.layout_fill["fill-sort-key"])})}};class vT extends wr{constructor(u){super(u,Gm)}recalculate(u,A){super.recalculate(u,A);const v=this.paint._values["fill-outline-color"];v.value.kind==="constant"&&v.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(u){return new My(u)}queryRadius(){return Wp(this.paint.get("fill-translate"))}queryIntersectsFeature(u){let{queryGeometry:A,geometry:v,transform:M,pixelsToTileUnits:L}=u;return jp(xy(A,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-M.bearingInRadians,L),v)}isTileClipped(){return!0}}const SD=xr([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),ID=xr([{name:"a_centroid",components:2,type:"Int16"}],4),{members:MD}=SD;var kv,xT,Uv,Nv,Qm,zv,Hv,$m={};function wT(){if(xT)return kv;xT=1;var p=x();function u(M,L,k,Q,q){this.properties={},this.extent=k,this.type=0,this._pbf=M,this._geometry=-1,this._keys=Q,this._values=q,M.readFields(A,this,L)}function A(M,L,k){M==1?L.id=k.readVarint():M==2?function(Q,q){for(var te=Q.readVarint()+Q.pos;Q.pos<te;){var ae=q._keys[Q.readVarint()],de=q._values[Q.readVarint()];q.properties[ae]=de}}(k,L):M==3?L.type=k.readVarint():M==4&&(L._geometry=k.pos)}function v(M){for(var L,k,Q=0,q=0,te=M.length,ae=te-1;q<te;ae=q++)Q+=((k=M[ae]).x-(L=M[q]).x)*(L.y+k.y);return Q}return kv=u,u.types=["Unknown","Point","LineString","Polygon"],u.prototype.loadGeometry=function(){var M=this._pbf;M.pos=this._geometry;for(var L,k=M.readVarint()+M.pos,Q=1,q=0,te=0,ae=0,de=[];M.pos<k;){if(q<=0){var ye=M.readVarint();Q=7&ye,q=ye>>3}if(q--,Q===1||Q===2)te+=M.readSVarint(),ae+=M.readSVarint(),Q===1&&(L&&de.push(L),L=[]),L.push(new p(te,ae));else{if(Q!==7)throw new Error("unknown command "+Q);L&&L.push(L[0].clone())}}return L&&de.push(L),de},u.prototype.bbox=function(){var M=this._pbf;M.pos=this._geometry;for(var L=M.readVarint()+M.pos,k=1,Q=0,q=0,te=0,ae=1/0,de=-1/0,ye=1/0,me=-1/0;M.pos<L;){if(Q<=0){var Ie=M.readVarint();k=7&Ie,Q=Ie>>3}if(Q--,k===1||k===2)(q+=M.readSVarint())<ae&&(ae=q),q>de&&(de=q),(te+=M.readSVarint())<ye&&(ye=te),te>me&&(me=te);else if(k!==7)throw new Error("unknown command "+k)}return[ae,ye,de,me]},u.prototype.toGeoJSON=function(M,L,k){var Q,q,te=this.extent*Math.pow(2,k),ae=this.extent*M,de=this.extent*L,ye=this.loadGeometry(),me=u.types[this.type];function Ie(ct){for(var Ot=0;Ot<ct.length;Ot++){var wt=ct[Ot];ct[Ot]=[360*(wt.x+ae)/te-180,360/Math.PI*Math.atan(Math.exp((180-360*(wt.y+de)/te)*Math.PI/180))-90]}}switch(this.type){case 1:var ke=[];for(Q=0;Q<ye.length;Q++)ke[Q]=ye[Q][0];Ie(ye=ke);break;case 2:for(Q=0;Q<ye.length;Q++)Ie(ye[Q]);break;case 3:for(ye=function(ct){var Ot=ct.length;if(Ot<=1)return[ct];for(var wt,Re,it=[],Et=0;Et<Ot;Et++){var Zt=v(ct[Et]);Zt!==0&&(Re===void 0&&(Re=Zt<0),Re===Zt<0?(wt&&it.push(wt),wt=[ct[Et]]):wt.push(ct[Et]))}return wt&&it.push(wt),it}(ye),Q=0;Q<ye.length;Q++)for(q=0;q<ye[Q].length;q++)Ie(ye[Q][q])}ye.length===1?ye=ye[0]:me="Multi"+me;var nt={type:"Feature",geometry:{type:me,coordinates:ye},properties:this.properties};return"id"in this&&(nt.id=this.id),nt},kv}function jm(){if(Nv)return Uv;Nv=1;var p=wT();function u(v,M){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=v,this._keys=[],this._values=[],this._features=[],v.readFields(A,this,M),this.length=this._features.length}function A(v,M,L){v===15?M.version=L.readVarint():v===1?M.name=L.readString():v===5?M.extent=L.readVarint():v===2?M._features.push(L.pos):v===3?M._keys.push(L.readString()):v===4&&M._values.push(function(k){for(var Q=null,q=k.readVarint()+k.pos;k.pos<q;){var te=k.readVarint()>>3;Q=te===1?k.readString():te===2?k.readFloat():te===3?k.readDouble():te===4?k.readVarint64():te===5?k.readVarint():te===6?k.readSVarint():te===7?k.readBoolean():null}return Q}(L))}return Uv=u,u.prototype.feature=function(v){if(v<0||v>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[v];var M=this._pbf.readVarint()+this._pbf.pos;return new p(this._pbf,M,this.extent,this._keys,this._values)},Uv}function BT(){return Hv||(Hv=1,$m.VectorTile=function(){if(zv)return Qm;zv=1;var p=jm();function u(A,v,M){if(A===3){var L=new p(M,M.readVarint()+M.pos);L.length&&(v[L.name]=L)}}return Qm=function(A,v){this.layers=A.readFields(u,{},v)},Qm}(),$m.VectorTileFeature=wT(),$m.VectorTileLayer=jm()),$m}var eg=h(BT());const PD=eg.VectorTileFeature.types,Vv=Math.pow(2,13);function qm(p,u,A,v,M,L,k,Q){p.emplaceBack(u,A,2*Math.floor(v*Vv)+k,M*Vv*2,L*Vv*2,Math.round(Q))}class Py{constructor(u){this.zoom=u.zoom,this.overscaling=u.overscaling,this.layers=u.layers,this.layerIds=this.layers.map(A=>A.id),this.index=u.index,this.hasPattern=!1,this.layoutVertexArray=new Ft,this.centroidVertexArray=new ft,this.indexArray=new fr,this.programConfigurations=new Qs(u.layers,u.zoom),this.segments=new tn,this.stateDependentLayerIds=this.layers.filter(A=>A.isStateDependent()).map(A=>A.id)}populate(u,A,v){this.features=[],this.hasPattern=Jp("fill-extrusion",this.layers,A);for(const{feature:M,id:L,index:k,sourceLayerIndex:Q}of u){const q=this.layers[0]._featureFilter.needGeometry,te=jh(M,q);if(!this.layers[0]._featureFilter.filter(new Z(this.zoom),te,v))continue;const ae={id:L,sourceLayerIndex:Q,index:k,geometry:q?te.geometry:Tu(M),properties:M.properties,type:M.type,patterns:{}};this.hasPattern?this.features.push(By("fill-extrusion",this.layers,ae,this.zoom,A)):this.addFeature(ae,ae.geometry,k,v,{},A.subdivisionGranularity),A.featureIndex.insert(M,ae.geometry,k,Q,this.index,!0)}}addFeatures(u,A,v){for(const M of this.features){const{geometry:L}=M;this.addFeature(M,L,M.index,A,v,u.subdivisionGranularity)}}update(u,A,v){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(u,A,this.stateDependentLayers,v)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(u){this.uploaded||(this.layoutVertexBuffer=u.createVertexBuffer(this.layoutVertexArray,MD),this.centroidVertexBuffer=u.createVertexBuffer(this.centroidVertexArray,ID.members,!0),this.indexBuffer=u.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(u),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(u,A,v,M,L,k){for(const Q of vi(A,500)){const q={x:0,y:0,sampleCount:0},te=this.layoutVertexArray.length;this.processPolygon(q,M,u,Q,k);const ae=this.layoutVertexArray.length-te,de=Math.floor(q.x/q.sampleCount),ye=Math.floor(q.y/q.sampleCount);for(let me=0;me<ae;me++)this.centroidVertexArray.emplaceBack(de,ye)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,u,v,L,M)}processPolygon(u,A,v,M,L){if(M.length<1||tg(M[0]))return;for(const de of M)de.length!==0&&FD(u,de);const k={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},Q=L.fill.getGranularityForZoomLevel(A.z),q=PD[v.type]==="Polygon";for(const de of M){if(de.length===0||tg(de))continue;const ye=Kh(de,Q,q);this._generateSideFaces(ye,k)}if(!q)return;const te=Iy(M,A,Q,!1),ae=this.layoutVertexArray;_T((de,ye)=>{qm(ae,de,ye,0,0,1,1,0)},this.segments,this.layoutVertexArray,this.indexArray,te.verticesFlattened,te.indicesTriangles)}_generateSideFaces(u,A){let v=0;for(let M=1;M<u.length;M++){const L=u[M],k=u[M-1];if(RD(L,k))continue;A.segment.vertexLength+4>tn.MAX_VERTEX_ARRAY_LENGTH&&(A.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Q=L.sub(k)._perp()._unit(),q=k.dist(L);v+q>32768&&(v=0),qm(this.layoutVertexArray,L.x,L.y,Q.x,Q.y,0,0,v),qm(this.layoutVertexArray,L.x,L.y,Q.x,Q.y,0,1,v),v+=q,qm(this.layoutVertexArray,k.x,k.y,Q.x,Q.y,0,0,v),qm(this.layoutVertexArray,k.x,k.y,Q.x,Q.y,0,1,v);const te=A.segment.vertexLength;this.indexArray.emplaceBack(te,te+2,te+1),this.indexArray.emplaceBack(te+1,te+2,te+3),A.segment.vertexLength+=4,A.segment.primitiveLength+=2}}}function FD(p,u){for(let A=0;A<u.length;A++){const v=u[A];A===u.length-1&&u[0].x===v.x&&u[0].y===v.y||(p.x+=v.x,p.y+=v.y,p.sampleCount++)}}function RD(p,u){return p.x===u.x&&(p.x<0||p.x>Vt)||p.y===u.y&&(p.y<0||p.y>Vt)}function tg(p){return p.every(u=>u.x<0)||p.every(u=>u.x>Vt)||p.every(u=>u.y<0)||p.every(u=>u.y>Vt)}let na;un("FillExtrusionBucket",Py,{omit:["layers","features"]});var CT={get paint(){return na=na||new It({"fill-extrusion-opacity":new qe(Xe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ze(Xe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new qe(Xe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new qe(Xe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ot(Xe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ze(Xe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ze(Xe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new qe(Xe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class ET extends wr{constructor(u){super(u,CT)}createBucket(u){return new Py(u)}queryRadius(){return Wp(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(u){let{queryGeometry:A,feature:v,featureState:M,geometry:L,transform:k,pixelsToTileUnits:Q,pixelPosMatrix:q}=u;const te=xy(A,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-k.bearingInRadians,Q),ae=this.paint.get("fill-extrusion-height").evaluate(v,M),de=this.paint.get("fill-extrusion-base").evaluate(v,M),ye=function(Ie,ke,nt){const ct=[];for(const Ot of Ie){const wt=[Ot.x,Ot.y,0,1];ze(wt,wt,ke),ct.push(new N(wt[0]/wt[3],wt[1]/wt[3]))}return ct}(te,q),me=function(Ie,ke,nt,ct){const Ot=[],wt=[],Re=ct[8]*ke,it=ct[9]*ke,Et=ct[10]*ke,Zt=ct[11]*ke,Br=ct[8]*nt,or=ct[9]*nt,lr=ct[10]*nt,Lr=ct[11]*nt;for(const Tr of Ie){const Hr=[],Ar=[];for(const hn of Tr){const Mn=hn.x,wn=hn.y,Kr=ct[0]*Mn+ct[4]*wn+ct[12],Nn=ct[1]*Mn+ct[5]*wn+ct[13],hi=ct[2]*Mn+ct[6]*wn+ct[14],Yi=ct[3]*Mn+ct[7]*wn+ct[15],ki=hi+Et,Fa=Yi+Zt,Mo=Kr+Br,Ws=Nn+or,es=hi+lr,hs=Yi+Lr,Ni=new N((Kr+Re)/Fa,(Nn+it)/Fa);Ni.z=ki/Fa,Hr.push(Ni);const Ls=new N(Mo/hs,Ws/hs);Ls.z=es/hs,Ar.push(Ls)}Ot.push(Hr),wt.push(Ar)}return[Ot,wt]}(L,de,ae,q);return function(Ie,ke,nt){let ct=1/0;jp(nt,ke)&&(ct=gs(nt,ke[0]));for(let Ot=0;Ot<ke.length;Ot++){const wt=ke[Ot],Re=Ie[Ot];for(let it=0;it<wt.length-1;it++){const Et=wt[it],Zt=[Et,wt[it+1],Re[it+1],Re[it],Et];oA(nt,Zt)&&(ct=Math.min(ct,gs(nt,Zt)))}}return ct!==1/0&&ct}(me[0],me[1],ye)}}function rg(p,u){return p.x*u.x+p.y*u.y}function gs(p,u){if(p.length===1){let A=0;const v=u[A++];let M;for(;!M||v.equals(M);)if(M=u[A++],!M)return 1/0;for(;A<u.length;A++){const L=u[A],k=p[0],Q=M.sub(v),q=L.sub(v),te=k.sub(v),ae=rg(Q,Q),de=rg(Q,q),ye=rg(q,q),me=rg(te,Q),Ie=rg(te,q),ke=ae*ye-de*de,nt=(ye*me-de*Ie)/ke,ct=(ae*Ie-de*me)/ke,Ot=v.z*(1-nt-ct)+M.z*nt+L.z*ct;if(isFinite(Ot))return Ot}return 1/0}{let A=1/0;for(const v of u)A=Math.min(A,v.z);return A}}const Gv=xr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:TT}=Gv,ST=xr([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Ef}=ST,ng=eg.VectorTileFeature.types,IT=Math.cos(Math.PI/180*37.5),MT=Math.pow(2,14)/.5;class Qv{constructor(u){this.zoom=u.zoom,this.overscaling=u.overscaling,this.layers=u.layers,this.layerIds=this.layers.map(A=>A.id),this.index=u.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(A=>{this.gradients[A.id]={}}),this.layoutVertexArray=new Dt,this.layoutVertexArray2=new Ut,this.indexArray=new fr,this.programConfigurations=new Qs(u.layers,u.zoom),this.segments=new tn,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(A=>A.isStateDependent()).map(A=>A.id)}populate(u,A,v){this.hasPattern=Jp("line",this.layers,A);const M=this.layers[0].layout.get("line-sort-key"),L=!M.isConstant(),k=[];for(const{feature:Q,id:q,index:te,sourceLayerIndex:ae}of u){const de=this.layers[0]._featureFilter.needGeometry,ye=jh(Q,de);if(!this.layers[0]._featureFilter.filter(new Z(this.zoom),ye,v))continue;const me=L?M.evaluate(ye,{},v):void 0,Ie={id:q,properties:Q.properties,type:Q.type,sourceLayerIndex:ae,index:te,geometry:de?ye.geometry:Tu(Q),patterns:{},sortKey:me};k.push(Ie)}L&&k.sort((Q,q)=>Q.sortKey-q.sortKey);for(const Q of k){const{geometry:q,index:te,sourceLayerIndex:ae}=Q;if(this.hasPattern){const de=By("line",this.layers,Q,this.zoom,A);this.patternFeatures.push(de)}else this.addFeature(Q,q,te,v,{},A.subdivisionGranularity);A.featureIndex.insert(u[te].feature,q,te,ae,this.index)}}update(u,A,v){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(u,A,this.stateDependentLayers,v)}addFeatures(u,A,v){for(const M of this.patternFeatures)this.addFeature(M,M.geometry,M.index,A,v,u.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(u){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=u.createVertexBuffer(this.layoutVertexArray2,Ef)),this.layoutVertexBuffer=u.createVertexBuffer(this.layoutVertexArray,TT),this.indexBuffer=u.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(u),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(u){if(u.properties&&Object.prototype.hasOwnProperty.call(u.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(u.properties,"mapbox_clip_end"))return{start:+u.properties.mapbox_clip_start,end:+u.properties.mapbox_clip_end}}addFeature(u,A,v,M,L,k){const Q=this.layers[0].layout,q=Q.get("line-join").evaluate(u,{}),te=Q.get("line-cap"),ae=Q.get("line-miter-limit"),de=Q.get("line-round-limit");this.lineClips=this.lineFeatureClips(u);for(const ye of A)this.addLine(ye,u,q,te,ae,de,M,k);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,u,v,L,M)}addLine(u,A,v,M,L,k,Q,q){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,u=Kh(u,Q?q.line.getGranularityForZoomLevel(Q.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let wt=0;wt<u.length-1;wt++)this.totalDistance+=u[wt].dist(u[wt+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const te=ng[A.type]==="Polygon";let ae=u.length;for(;ae>=2&&u[ae-1].equals(u[ae-2]);)ae--;let de=0;for(;de<ae-1&&u[de].equals(u[de+1]);)de++;if(ae<(te?3:2))return;v==="bevel"&&(L=1.05);const ye=this.overscaling<=16?15*Vt/(512*this.overscaling):0,me=this.segments.prepareSegment(10*ae,this.layoutVertexArray,this.indexArray);let Ie,ke,nt,ct,Ot;this.e1=this.e2=-1,te&&(Ie=u[ae-2],Ot=u[de].sub(Ie)._unit()._perp());for(let wt=de;wt<ae;wt++){if(nt=wt===ae-1?te?u[de+1]:void 0:u[wt+1],nt&&u[wt].equals(nt))continue;Ot&&(ct=Ot),Ie&&(ke=Ie),Ie=u[wt],Ot=nt?nt.sub(Ie)._unit()._perp():ct,ct=ct||Ot;let Re=ct.add(Ot);Re.x===0&&Re.y===0||Re._unit();const it=ct.x*Ot.x+ct.y*Ot.y,Et=Re.x*Ot.x+Re.y*Ot.y,Zt=Et!==0?1/Et:1/0,Br=2*Math.sqrt(2-2*Et),or=Et<IT&&ke&&nt,lr=ct.x*Ot.y-ct.y*Ot.x>0;if(or&&wt>de){const Hr=Ie.dist(ke);if(Hr>2*ye){const Ar=Ie.sub(Ie.sub(ke)._mult(ye/Hr)._round());this.updateDistance(ke,Ar),this.addCurrentVertex(Ar,ct,0,0,me),ke=Ar}}const Lr=ke&&nt;let Tr=Lr?v:te?"butt":M;if(Lr&&Tr==="round"&&(Zt<k?Tr="miter":Zt<=2&&(Tr="fakeround")),Tr==="miter"&&Zt>L&&(Tr="bevel"),Tr==="bevel"&&(Zt>2&&(Tr="flipbevel"),Zt<L&&(Tr="miter")),ke&&this.updateDistance(ke,Ie),Tr==="miter")Re._mult(Zt),this.addCurrentVertex(Ie,Re,0,0,me);else if(Tr==="flipbevel"){if(Zt>100)Re=Ot.mult(-1);else{const Hr=Zt*ct.add(Ot).mag()/ct.sub(Ot).mag();Re._perp()._mult(Hr*(lr?-1:1))}this.addCurrentVertex(Ie,Re,0,0,me),this.addCurrentVertex(Ie,Re.mult(-1),0,0,me)}else if(Tr==="bevel"||Tr==="fakeround"){const Hr=-Math.sqrt(Zt*Zt-1),Ar=lr?Hr:0,hn=lr?0:Hr;if(ke&&this.addCurrentVertex(Ie,ct,Ar,hn,me),Tr==="fakeround"){const Mn=Math.round(180*Br/Math.PI/20);for(let wn=1;wn<Mn;wn++){let Kr=wn/Mn;if(Kr!==.5){const hi=Kr-.5;Kr+=Kr*hi*(Kr-1)*((1.0904+it*(it*(3.55645-1.43519*it)-3.2452))*hi*hi+(.848013+it*(.215638*it-1.06021)))}const Nn=Ot.sub(ct)._mult(Kr)._add(ct)._unit()._mult(lr?-1:1);this.addHalfVertex(Ie,Nn.x,Nn.y,!1,lr,0,me)}}nt&&this.addCurrentVertex(Ie,Ot,-Ar,-hn,me)}else if(Tr==="butt")this.addCurrentVertex(Ie,Re,0,0,me);else if(Tr==="square"){const Hr=ke?1:-1;this.addCurrentVertex(Ie,Re,Hr,Hr,me)}else Tr==="round"&&(ke&&(this.addCurrentVertex(Ie,ct,0,0,me),this.addCurrentVertex(Ie,ct,1,1,me,!0)),nt&&(this.addCurrentVertex(Ie,Ot,-1,-1,me,!0),this.addCurrentVertex(Ie,Ot,0,0,me)));if(or&&wt<ae-1){const Hr=Ie.dist(nt);if(Hr>2*ye){const Ar=Ie.add(nt.sub(Ie)._mult(ye/Hr)._round());this.updateDistance(Ie,Ar),this.addCurrentVertex(Ar,Ot,0,0,me),Ie=Ar}}}}addCurrentVertex(u,A,v,M,L){let k=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!1;const Q=A.y*M-A.x,q=-A.y-A.x*M;this.addHalfVertex(u,A.x+A.y*v,A.y-A.x*v,k,!1,v,L),this.addHalfVertex(u,Q,q,k,!0,-M,L),this.distance>MT/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(u,A,v,M,L,k))}addHalfVertex(u,A,v,M,L,k,Q){let{x:q,y:te}=u;const ae=.5*(this.lineClips?this.scaledDistance*(MT-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((q<<1)+(M?1:0),(te<<1)+(L?1:0),Math.round(63*A)+128,Math.round(63*v)+128,1+(k===0?0:k<0?-1:1)|(63&ae)<<2,ae>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const de=Q.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,de,this.e2),Q.primitiveLength++),L?this.e2=de:this.e1=de}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(u,A){this.distance+=u.dist(A),this.updateScaledDistance()}}let PT,FT;un("LineBucket",Qv,{omit:["layers","patternFeatures"]});var RT={get paint(){return FT=FT||new It({"line-opacity":new Ze(Xe.paint_line["line-opacity"]),"line-color":new Ze(Xe.paint_line["line-color"]),"line-translate":new qe(Xe.paint_line["line-translate"]),"line-translate-anchor":new qe(Xe.paint_line["line-translate-anchor"]),"line-width":new Ze(Xe.paint_line["line-width"]),"line-gap-width":new Ze(Xe.paint_line["line-gap-width"]),"line-offset":new Ze(Xe.paint_line["line-offset"]),"line-blur":new Ze(Xe.paint_line["line-blur"]),"line-dasharray":new vt(Xe.paint_line["line-dasharray"]),"line-pattern":new ot(Xe.paint_line["line-pattern"]),"line-gradient":new kt(Xe.paint_line["line-gradient"])})},get layout(){return PT=PT||new It({"line-cap":new qe(Xe.layout_line["line-cap"]),"line-join":new Ze(Xe.layout_line["line-join"]),"line-miter-limit":new qe(Xe.layout_line["line-miter-limit"]),"line-round-limit":new qe(Xe.layout_line["line-round-limit"]),"line-sort-key":new Ze(Xe.layout_line["line-sort-key"])})}};class LD extends Ze{possiblyEvaluate(u,A){return A=new Z(Math.floor(A.zoom),{now:A.now,fadeDuration:A.fadeDuration,zoomHistory:A.zoomHistory,transition:A.transition}),super.possiblyEvaluate(u,A)}evaluate(u,A,v,M){return A=St({},A,{zoom:Math.floor(A.zoom)}),super.evaluate(u,A,v,M)}}let Fy;class DD extends wr{constructor(u){super(u,RT),this.gradientVersion=0,Fy||(Fy=new LD(RT.paint.properties["line-width"].specification),Fy.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(u){if(u==="line-gradient"){const A=this.gradientExpression();this.stepInterpolant=!!function(v){return v._styleExpression!==void 0}(A)&&A._styleExpression.expression instanceof qa,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(u,A){super.recalculate(u,A),this.paint._values["line-floorwidth"]=Fy.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,u)}createBucket(u){return new Qv(u)}queryRadius(u){const A=u,v=LT(Kp("line-width",this,A),Kp("line-gap-width",this,A)),M=Kp("line-offset",this,A);return v/2+Math.abs(M)+Wp(this.paint.get("line-translate"))}queryIntersectsFeature(u){let{queryGeometry:A,feature:v,featureState:M,geometry:L,transform:k,pixelsToTileUnits:Q}=u;const q=xy(A,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-k.bearingInRadians,Q),te=Q/2*LT(this.paint.get("line-width").evaluate(v,M),this.paint.get("line-gap-width").evaluate(v,M)),ae=this.paint.get("line-offset").evaluate(v,M);return ae&&(L=function(de,ye){const me=[];for(let Ie=0;Ie<de.length;Ie++){const ke=de[Ie],nt=[];for(let ct=0;ct<ke.length;ct++){const Ot=ke[ct-1],wt=ke[ct],Re=ke[ct+1],it=ct===0?new N(0,0):wt.sub(Ot)._unit()._perp(),Et=ct===ke.length-1?new N(0,0):Re.sub(wt)._unit()._perp(),Zt=it._add(Et)._unit(),Br=Zt.x*Et.x+Zt.y*Et.y;Br!==0&&Zt._mult(1/Br),nt.push(Zt._mult(ye)._add(wt))}me.push(nt)}return me}(L,ae*Q)),function(de,ye,me){for(let Ie=0;Ie<ye.length;Ie++){const ke=ye[Ie];if(de.length>=3){for(let nt=0;nt<ke.length;nt++)if(Ed(de,ke[nt]))return!0}if(qp(de,ke,me))return!0}return!1}(q,L,te)}isTileClipped(){return!0}}function LT(p,u){return u>0?u+2*p:p}const Ry=xr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),ig=xr([{name:"a_projected_pos",components:3,type:"Float32"}],4);xr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const DT=xr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);xr([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Ly=xr([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),$v=xr([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function OD(p,u,A){return p.sections.forEach(v=>{v.text=function(M,L,k){const Q=L.layout.get("text-transform").evaluate(k,{});return Q==="uppercase"?M=M.toLocaleUpperCase():Q==="lowercase"&&(M=M.toLocaleLowerCase()),j.applyArabicShaping&&(M=j.applyArabicShaping(M)),M}(v.text,u,A)}),p}xr([{name:"triangle",components:3,type:"Uint16"}]),xr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),xr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),xr([{type:"Float32",name:"offsetX"}]),xr([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),xr([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Km={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var OT,Dy,jv,Zi=24,Wm={};function kT(){return OT||(OT=1,Wm.read=function(p,u,A,v,M){var L,k,Q=8*M-v-1,q=(1<<Q)-1,te=q>>1,ae=-7,de=A?M-1:0,ye=A?-1:1,me=p[u+de];for(de+=ye,L=me&(1<<-ae)-1,me>>=-ae,ae+=Q;ae>0;L=256*L+p[u+de],de+=ye,ae-=8);for(k=L&(1<<-ae)-1,L>>=-ae,ae+=v;ae>0;k=256*k+p[u+de],de+=ye,ae-=8);if(L===0)L=1-te;else{if(L===q)return k?NaN:1/0*(me?-1:1);k+=Math.pow(2,v),L-=te}return(me?-1:1)*k*Math.pow(2,L-v)},Wm.write=function(p,u,A,v,M,L){var k,Q,q,te=8*L-M-1,ae=(1<<te)-1,de=ae>>1,ye=M===23?Math.pow(2,-24)-Math.pow(2,-77):0,me=v?0:L-1,Ie=v?1:-1,ke=u<0||u===0&&1/u<0?1:0;for(u=Math.abs(u),isNaN(u)||u===1/0?(Q=isNaN(u)?1:0,k=ae):(k=Math.floor(Math.log(u)/Math.LN2),u*(q=Math.pow(2,-k))<1&&(k--,q*=2),(u+=k+de>=1?ye/q:ye*Math.pow(2,1-de))*q>=2&&(k++,q/=2),k+de>=ae?(Q=0,k=ae):k+de>=1?(Q=(u*q-1)*Math.pow(2,M),k+=de):(Q=u*Math.pow(2,de-1)*Math.pow(2,M),k=0));M>=8;p[A+me]=255&Q,me+=Ie,Q/=256,M-=8);for(k=k<<M|Q,te+=M;te>0;p[A+me]=255&k,me+=Ie,k/=256,te-=8);p[A+me-Ie]|=128*ke}),Wm}function Tf(){if(jv)return Dy;jv=1,Dy=u;var p=kT();function u(Re){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(Re)?Re:new Uint8Array(Re||0),this.pos=0,this.type=0,this.length=this.buf.length}u.Varint=0,u.Fixed64=1,u.Bytes=2,u.Fixed32=5;var A=4294967296,v=1/A,M=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function L(Re){return Re.type===u.Bytes?Re.readVarint()+Re.pos:Re.pos+1}function k(Re,it,Et){return Et?4294967296*it+(Re>>>0):4294967296*(it>>>0)+(Re>>>0)}function Q(Re,it,Et){var Zt=it<=16383?1:it<=2097151?2:it<=268435455?3:Math.floor(Math.log(it)/(7*Math.LN2));Et.realloc(Zt);for(var Br=Et.pos-1;Br>=Re;Br--)Et.buf[Br+Zt]=Et.buf[Br]}function q(Re,it){for(var Et=0;Et<Re.length;Et++)it.writeVarint(Re[Et])}function te(Re,it){for(var Et=0;Et<Re.length;Et++)it.writeSVarint(Re[Et])}function ae(Re,it){for(var Et=0;Et<Re.length;Et++)it.writeFloat(Re[Et])}function de(Re,it){for(var Et=0;Et<Re.length;Et++)it.writeDouble(Re[Et])}function ye(Re,it){for(var Et=0;Et<Re.length;Et++)it.writeBoolean(Re[Et])}function me(Re,it){for(var Et=0;Et<Re.length;Et++)it.writeFixed32(Re[Et])}function Ie(Re,it){for(var Et=0;Et<Re.length;Et++)it.writeSFixed32(Re[Et])}function ke(Re,it){for(var Et=0;Et<Re.length;Et++)it.writeFixed64(Re[Et])}function nt(Re,it){for(var Et=0;Et<Re.length;Et++)it.writeSFixed64(Re[Et])}function ct(Re,it){return(Re[it]|Re[it+1]<<8|Re[it+2]<<16)+16777216*Re[it+3]}function Ot(Re,it,Et){Re[Et]=it,Re[Et+1]=it>>>8,Re[Et+2]=it>>>16,Re[Et+3]=it>>>24}function wt(Re,it){return(Re[it]|Re[it+1]<<8|Re[it+2]<<16)+(Re[it+3]<<24)}return u.prototype={destroy:function(){this.buf=null},readFields:function(Re,it,Et){for(Et=Et||this.length;this.pos<Et;){var Zt=this.readVarint(),Br=Zt>>3,or=this.pos;this.type=7&Zt,Re(Br,it,this),this.pos===or&&this.skip(Zt)}return it},readMessage:function(Re,it){return this.readFields(Re,it,this.readVarint()+this.pos)},readFixed32:function(){var Re=ct(this.buf,this.pos);return this.pos+=4,Re},readSFixed32:function(){var Re=wt(this.buf,this.pos);return this.pos+=4,Re},readFixed64:function(){var Re=ct(this.buf,this.pos)+ct(this.buf,this.pos+4)*A;return this.pos+=8,Re},readSFixed64:function(){var Re=ct(this.buf,this.pos)+wt(this.buf,this.pos+4)*A;return this.pos+=8,Re},readFloat:function(){var Re=p.read(this.buf,this.pos,!0,23,4);return this.pos+=4,Re},readDouble:function(){var Re=p.read(this.buf,this.pos,!0,52,8);return this.pos+=8,Re},readVarint:function(Re){var it,Et,Zt=this.buf;return it=127&(Et=Zt[this.pos++]),Et<128?it:(it|=(127&(Et=Zt[this.pos++]))<<7,Et<128?it:(it|=(127&(Et=Zt[this.pos++]))<<14,Et<128?it:(it|=(127&(Et=Zt[this.pos++]))<<21,Et<128?it:function(Br,or,lr){var Lr,Tr,Hr=lr.buf;if(Lr=(112&(Tr=Hr[lr.pos++]))>>4,Tr<128||(Lr|=(127&(Tr=Hr[lr.pos++]))<<3,Tr<128)||(Lr|=(127&(Tr=Hr[lr.pos++]))<<10,Tr<128)||(Lr|=(127&(Tr=Hr[lr.pos++]))<<17,Tr<128)||(Lr|=(127&(Tr=Hr[lr.pos++]))<<24,Tr<128)||(Lr|=(1&(Tr=Hr[lr.pos++]))<<31,Tr<128))return k(Br,Lr,or);throw new Error("Expected varint not more than 10 bytes")}(it|=(15&(Et=Zt[this.pos]))<<28,Re,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var Re=this.readVarint();return Re%2==1?(Re+1)/-2:Re/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var Re=this.readVarint()+this.pos,it=this.pos;return this.pos=Re,Re-it>=12&&M?function(Et,Zt,Br){return M.decode(Et.subarray(Zt,Br))}(this.buf,it,Re):function(Et,Zt,Br){for(var or="",lr=Zt;lr<Br;){var Lr,Tr,Hr,Ar=Et[lr],hn=null,Mn=Ar>239?4:Ar>223?3:Ar>191?2:1;if(lr+Mn>Br)break;Mn===1?Ar<128&&(hn=Ar):Mn===2?(192&(Lr=Et[lr+1]))==128&&(hn=(31&Ar)<<6|63&Lr)<=127&&(hn=null):Mn===3?(Tr=Et[lr+2],(192&(Lr=Et[lr+1]))==128&&(192&Tr)==128&&((hn=(15&Ar)<<12|(63&Lr)<<6|63&Tr)<=2047||hn>=55296&&hn<=57343)&&(hn=null)):Mn===4&&(Tr=Et[lr+2],Hr=Et[lr+3],(192&(Lr=Et[lr+1]))==128&&(192&Tr)==128&&(192&Hr)==128&&((hn=(15&Ar)<<18|(63&Lr)<<12|(63&Tr)<<6|63&Hr)<=65535||hn>=1114112)&&(hn=null)),hn===null?(hn=65533,Mn=1):hn>65535&&(hn-=65536,or+=String.fromCharCode(hn>>>10&1023|55296),hn=56320|1023&hn),or+=String.fromCharCode(hn),lr+=Mn}return or}(this.buf,it,Re)},readBytes:function(){var Re=this.readVarint()+this.pos,it=this.buf.subarray(this.pos,Re);return this.pos=Re,it},readPackedVarint:function(Re,it){if(this.type!==u.Bytes)return Re.push(this.readVarint(it));var Et=L(this);for(Re=Re||[];this.pos<Et;)Re.push(this.readVarint(it));return Re},readPackedSVarint:function(Re){if(this.type!==u.Bytes)return Re.push(this.readSVarint());var it=L(this);for(Re=Re||[];this.pos<it;)Re.push(this.readSVarint());return Re},readPackedBoolean:function(Re){if(this.type!==u.Bytes)return Re.push(this.readBoolean());var it=L(this);for(Re=Re||[];this.pos<it;)Re.push(this.readBoolean());return Re},readPackedFloat:function(Re){if(this.type!==u.Bytes)return Re.push(this.readFloat());var it=L(this);for(Re=Re||[];this.pos<it;)Re.push(this.readFloat());return Re},readPackedDouble:function(Re){if(this.type!==u.Bytes)return Re.push(this.readDouble());var it=L(this);for(Re=Re||[];this.pos<it;)Re.push(this.readDouble());return Re},readPackedFixed32:function(Re){if(this.type!==u.Bytes)return Re.push(this.readFixed32());var it=L(this);for(Re=Re||[];this.pos<it;)Re.push(this.readFixed32());return Re},readPackedSFixed32:function(Re){if(this.type!==u.Bytes)return Re.push(this.readSFixed32());var it=L(this);for(Re=Re||[];this.pos<it;)Re.push(this.readSFixed32());return Re},readPackedFixed64:function(Re){if(this.type!==u.Bytes)return Re.push(this.readFixed64());var it=L(this);for(Re=Re||[];this.pos<it;)Re.push(this.readFixed64());return Re},readPackedSFixed64:function(Re){if(this.type!==u.Bytes)return Re.push(this.readSFixed64());var it=L(this);for(Re=Re||[];this.pos<it;)Re.push(this.readSFixed64());return Re},skip:function(Re){var it=7&Re;if(it===u.Varint)for(;this.buf[this.pos++]>127;);else if(it===u.Bytes)this.pos=this.readVarint()+this.pos;else if(it===u.Fixed32)this.pos+=4;else{if(it!==u.Fixed64)throw new Error("Unimplemented type: "+it);this.pos+=8}},writeTag:function(Re,it){this.writeVarint(Re<<3|it)},realloc:function(Re){for(var it=this.length||16;it<this.pos+Re;)it*=2;if(it!==this.length){var Et=new Uint8Array(it);Et.set(this.buf),this.buf=Et,this.length=it}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(Re){this.realloc(4),Ot(this.buf,Re,this.pos),this.pos+=4},writeSFixed32:function(Re){this.realloc(4),Ot(this.buf,Re,this.pos),this.pos+=4},writeFixed64:function(Re){this.realloc(8),Ot(this.buf,-1&Re,this.pos),Ot(this.buf,Math.floor(Re*v),this.pos+4),this.pos+=8},writeSFixed64:function(Re){this.realloc(8),Ot(this.buf,-1&Re,this.pos),Ot(this.buf,Math.floor(Re*v),this.pos+4),this.pos+=8},writeVarint:function(Re){(Re=+Re||0)>268435455||Re<0?function(it,Et){var Zt,Br;if(it>=0?(Zt=it%4294967296|0,Br=it/4294967296|0):(Br=~(-it/4294967296),4294967295^(Zt=~(-it%4294967296))?Zt=Zt+1|0:(Zt=0,Br=Br+1|0)),it>=18446744073709552e3||it<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");Et.realloc(10),function(or,lr,Lr){Lr.buf[Lr.pos++]=127&or|128,or>>>=7,Lr.buf[Lr.pos++]=127&or|128,or>>>=7,Lr.buf[Lr.pos++]=127&or|128,or>>>=7,Lr.buf[Lr.pos++]=127&or|128,Lr.buf[Lr.pos]=127&(or>>>=7)}(Zt,0,Et),function(or,lr){var Lr=(7&or)<<4;lr.buf[lr.pos++]|=Lr|((or>>>=3)?128:0),or&&(lr.buf[lr.pos++]=127&or|((or>>>=7)?128:0),or&&(lr.buf[lr.pos++]=127&or|((or>>>=7)?128:0),or&&(lr.buf[lr.pos++]=127&or|((or>>>=7)?128:0),or&&(lr.buf[lr.pos++]=127&or|((or>>>=7)?128:0),or&&(lr.buf[lr.pos++]=127&or)))))}(Br,Et)}(Re,this):(this.realloc(4),this.buf[this.pos++]=127&Re|(Re>127?128:0),Re<=127||(this.buf[this.pos++]=127&(Re>>>=7)|(Re>127?128:0),Re<=127||(this.buf[this.pos++]=127&(Re>>>=7)|(Re>127?128:0),Re<=127||(this.buf[this.pos++]=Re>>>7&127))))},writeSVarint:function(Re){this.writeVarint(Re<0?2*-Re-1:2*Re)},writeBoolean:function(Re){this.writeVarint(!!Re)},writeString:function(Re){Re=String(Re),this.realloc(4*Re.length),this.pos++;var it=this.pos;this.pos=function(Zt,Br,or){for(var lr,Lr,Tr=0;Tr<Br.length;Tr++){if((lr=Br.charCodeAt(Tr))>55295&&lr<57344){if(!Lr){lr>56319||Tr+1===Br.length?(Zt[or++]=239,Zt[or++]=191,Zt[or++]=189):Lr=lr;continue}if(lr<56320){Zt[or++]=239,Zt[or++]=191,Zt[or++]=189,Lr=lr;continue}lr=Lr-55296<<10|lr-56320|65536,Lr=null}else Lr&&(Zt[or++]=239,Zt[or++]=191,Zt[or++]=189,Lr=null);lr<128?Zt[or++]=lr:(lr<2048?Zt[or++]=lr>>6|192:(lr<65536?Zt[or++]=lr>>12|224:(Zt[or++]=lr>>18|240,Zt[or++]=lr>>12&63|128),Zt[or++]=lr>>6&63|128),Zt[or++]=63&lr|128)}return or}(this.buf,Re,this.pos);var Et=this.pos-it;Et>=128&&Q(it,Et,this),this.pos=it-1,this.writeVarint(Et),this.pos+=Et},writeFloat:function(Re){this.realloc(4),p.write(this.buf,Re,this.pos,!0,23,4),this.pos+=4},writeDouble:function(Re){this.realloc(8),p.write(this.buf,Re,this.pos,!0,52,8),this.pos+=8},writeBytes:function(Re){var it=Re.length;this.writeVarint(it),this.realloc(it);for(var Et=0;Et<it;Et++)this.buf[this.pos++]=Re[Et]},writeRawMessage:function(Re,it){this.pos++;var Et=this.pos;Re(it,this);var Zt=this.pos-Et;Zt>=128&&Q(Et,Zt,this),this.pos=Et-1,this.writeVarint(Zt),this.pos+=Zt},writeMessage:function(Re,it,Et){this.writeTag(Re,u.Bytes),this.writeRawMessage(it,Et)},writePackedVarint:function(Re,it){it.length&&this.writeMessage(Re,q,it)},writePackedSVarint:function(Re,it){it.length&&this.writeMessage(Re,te,it)},writePackedBoolean:function(Re,it){it.length&&this.writeMessage(Re,ye,it)},writePackedFloat:function(Re,it){it.length&&this.writeMessage(Re,ae,it)},writePackedDouble:function(Re,it){it.length&&this.writeMessage(Re,de,it)},writePackedFixed32:function(Re,it){it.length&&this.writeMessage(Re,me,it)},writePackedSFixed32:function(Re,it){it.length&&this.writeMessage(Re,Ie,it)},writePackedFixed64:function(Re,it){it.length&&this.writeMessage(Re,ke,it)},writePackedSFixed64:function(Re,it){it.length&&this.writeMessage(Re,nt,it)},writeBytesField:function(Re,it){this.writeTag(Re,u.Bytes),this.writeBytes(it)},writeFixed32Field:function(Re,it){this.writeTag(Re,u.Fixed32),this.writeFixed32(it)},writeSFixed32Field:function(Re,it){this.writeTag(Re,u.Fixed32),this.writeSFixed32(it)},writeFixed64Field:function(Re,it){this.writeTag(Re,u.Fixed64),this.writeFixed64(it)},writeSFixed64Field:function(Re,it){this.writeTag(Re,u.Fixed64),this.writeSFixed64(it)},writeVarintField:function(Re,it){this.writeTag(Re,u.Varint),this.writeVarint(it)},writeSVarintField:function(Re,it){this.writeTag(Re,u.Varint),this.writeSVarint(it)},writeStringField:function(Re,it){this.writeTag(Re,u.Bytes),this.writeString(it)},writeFloatField:function(Re,it){this.writeTag(Re,u.Fixed32),this.writeFloat(it)},writeDoubleField:function(Re,it){this.writeTag(Re,u.Fixed64),this.writeDouble(it)},writeBooleanField:function(Re,it){this.writeVarintField(Re,!!it)}},Dy}var zA=h(Tf());const HA=3;function sg(p,u,A){p===1&&A.readMessage(Oy,u)}function Oy(p,u,A){if(p===3){const{id:v,bitmap:M,width:L,height:k,left:Q,top:q,advance:te}=A.readMessage(ky,{});u.push({id:v,bitmap:new Dm({width:L+2*HA,height:k+2*HA},M),metrics:{width:L,height:k,left:Q,top:q,advance:te}})}}function ky(p,u,A){p===1?u.id=A.readVarint():p===2?u.bitmap=A.readBytes():p===3?u.width=A.readVarint():p===4?u.height=A.readVarint():p===5?u.left=A.readSVarint():p===6?u.top=A.readSVarint():p===7&&(u.advance=A.readVarint())}const kD=HA;function UT(p){let u=0,A=0;for(const k of p)u+=k.w*k.h,A=Math.max(A,k.w);p.sort((k,Q)=>Q.h-k.h);const v=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(u/.95)),A),h:1/0}];let M=0,L=0;for(const k of p)for(let Q=v.length-1;Q>=0;Q--){const q=v[Q];if(!(k.w>q.w||k.h>q.h)){if(k.x=q.x,k.y=q.y,L=Math.max(L,k.y+k.h),M=Math.max(M,k.x+k.w),k.w===q.w&&k.h===q.h){const te=v.pop();Q<v.length&&(v[Q]=te)}else k.h===q.h?(q.x+=k.w,q.w-=k.w):k.w===q.w?(q.y+=k.h,q.h-=k.h):(v.push({x:q.x+k.w,y:q.y,w:q.w-k.w,h:k.h}),q.y+=k.h,q.h-=k.h);break}}return{w:M,h:L,fill:u/(M*L)||0}}const wc=1;class Uy{constructor(u,A){let{pixelRatio:v,version:M,stretchX:L,stretchY:k,content:Q,textFitWidth:q,textFitHeight:te}=A;this.paddedRect=u,this.pixelRatio=v,this.stretchX=L,this.stretchY=k,this.content=Q,this.version=M,this.textFitWidth=q,this.textFitHeight=te}get tl(){return[this.paddedRect.x+wc,this.paddedRect.y+wc]}get br(){return[this.paddedRect.x+this.paddedRect.w-wc,this.paddedRect.y+this.paddedRect.h-wc]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*wc)/this.pixelRatio,(this.paddedRect.h-2*wc)/this.pixelRatio]}}class NT{constructor(u,A){const v={},M={};this.haveRenderCallbacks=[];const L=[];this.addImages(u,v,L),this.addImages(A,M,L);const{w:k,h:Q}=UT(L),q=new ju({width:k||1,height:Q||1});for(const te in u){const ae=u[te],de=v[te].paddedRect;ju.copy(ae.data,q,{x:0,y:0},{x:de.x+wc,y:de.y+wc},ae.data)}for(const te in A){const ae=A[te],de=M[te].paddedRect,ye=de.x+wc,me=de.y+wc,Ie=ae.data.width,ke=ae.data.height;ju.copy(ae.data,q,{x:0,y:0},{x:ye,y:me},ae.data),ju.copy(ae.data,q,{x:0,y:ke-1},{x:ye,y:me-1},{width:Ie,height:1}),ju.copy(ae.data,q,{x:0,y:0},{x:ye,y:me+ke},{width:Ie,height:1}),ju.copy(ae.data,q,{x:Ie-1,y:0},{x:ye-1,y:me},{width:1,height:ke}),ju.copy(ae.data,q,{x:0,y:0},{x:ye+Ie,y:me},{width:1,height:ke})}this.image=q,this.iconPositions=v,this.patternPositions=M}addImages(u,A,v){for(const M in u){const L=u[M],k={x:0,y:0,w:L.data.width+2*wc,h:L.data.height+2*wc};v.push(k),A[M]=new Uy(k,L),L.hasRenderCallback&&this.haveRenderCallbacks.push(M)}}patchUpdatedImages(u,A){u.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const v in u.updatedImages)this.patchUpdatedImage(this.iconPositions[v],u.getImage(v),A),this.patchUpdatedImage(this.patternPositions[v],u.getImage(v),A)}patchUpdatedImage(u,A,v){if(!u||!A||u.version===A.version)return;u.version=A.version;const[M,L]=u.tl;v.update(A.data,void 0,{x:M,y:L})}}var Sf;un("ImagePosition",Uy),un("ImageAtlas",NT),a.ai=void 0,(Sf=a.ai||(a.ai={}))[Sf.none=0]="none",Sf[Sf.horizontal=1]="horizontal",Sf[Sf.vertical=2]="vertical",Sf[Sf.horizontalOnly=3]="horizontalOnly";const Xm=-17;class VA{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(u,A,v){const M=new VA;return M.scale=u||1,M.fontStack=A,M.verticalAlign=v||"bottom",M}static forImage(u,A){const v=new VA;return v.imageName=u,v.verticalAlign=A||"bottom",v}}class aA{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(u,A){const v=new aA;for(let M=0;M<u.sections.length;M++){const L=u.sections[M];L.image?v.addImageSection(L):v.addTextSection(L,A)}return v}length(){return this.text.length}getSection(u){return this.sections[this.sectionIndex[u]]}getSectionIndex(u){return this.sectionIndex[u]}getCharCode(u){return this.text.charCodeAt(u)}verticalizePunctuation(){this.text=function(u){let A="";for(let v=0;v<u.length;v++){const M=u.charCodeAt(v+1)||null,L=u.charCodeAt(v-1)||null;A+=M&&y(M)&&!Km[u[v+1]]||L&&y(L)&&!Km[u[v-1]]||!Km[u[v]]?u[v]:Km[u[v]]}return A}(this.text)}trim(){let u=0;for(let v=0;v<this.text.length&&zy[this.text.charCodeAt(v)];v++)u++;let A=this.text.length;for(let v=this.text.length-1;v>=0&&v>=u&&zy[this.text.charCodeAt(v)];v--)A--;this.text=this.text.substring(u,A),this.sectionIndex=this.sectionIndex.slice(u,A)}substring(u,A){const v=new aA;return v.text=this.text.substring(u,A),v.sectionIndex=this.sectionIndex.slice(u,A),v.sections=this.sections,v}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((u,A)=>Math.max(u,this.sections[A].scale),0)}getMaxImageSize(u){let A=0,v=0;for(let M=0;M<this.length();M++){const L=this.getSection(M);if(L.imageName){const k=u[L.imageName];if(!k)continue;const Q=k.displaySize;A=Math.max(A,Q[0]),v=Math.max(v,Q[1])}}return{maxImageWidth:A,maxImageHeight:v}}addTextSection(u,A){this.text+=u.text,this.sections.push(VA.forText(u.scale,u.fontStack||A,u.verticalAlign));const v=this.sections.length-1;for(let M=0;M<u.text.length;++M)this.sectionIndex.push(v)}addImageSection(u){const A=u.image?u.image.name:"";if(A.length===0)return void kr("Can't add FormattedSection with an empty image.");const v=this.getNextImageSectionCharCode();v?(this.text+=String.fromCharCode(v),this.sections.push(VA.forImage(A,u.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):kr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Ny(p,u,A,v,M,L,k,Q,q,te,ae,de,ye,me,Ie){const ke=aA.fromFeature(p,M);let nt;de===a.ai.vertical&&ke.verticalizePunctuation();const{processBidirectionalText:ct,processStyledBidirectionalText:Ot}=j;if(ct&&ke.sections.length===1){nt=[];const it=ct(ke.toString(),Kv(ke,te,L,u,v,me));for(const Et of it){const Zt=new aA;Zt.text=Et,Zt.sections=ke.sections;for(let Br=0;Br<Et.length;Br++)Zt.sectionIndex.push(0);nt.push(Zt)}}else if(Ot){nt=[];const it=Ot(ke.text,ke.sectionIndex,Kv(ke,te,L,u,v,me));for(const Et of it){const Zt=new aA;Zt.text=Et[0],Zt.sectionIndex=Et[1],Zt.sections=ke.sections,nt.push(Zt)}}else nt=function(it,Et){const Zt=[],Br=it.text;let or=0;for(const lr of Et)Zt.push(it.substring(or,lr)),or=lr;return or<Br.length&&Zt.push(it.substring(or,Br.length)),Zt}(ke,Kv(ke,te,L,u,v,me));const wt=[],Re={positionedLines:wt,text:ke.toString(),top:ae[1],bottom:ae[1],left:ae[0],right:ae[0],writingMode:de,iconsInText:!1,verticalizable:!1};return function(it,Et,Zt,Br,or,lr,Lr,Tr,Hr,Ar,hn,Mn){let wn=0,Kr=0,Nn=0,hi=0;const Yi=Tr==="right"?1:Tr==="left"?0:.5,ki=Zi/Mn;let Fa=0;for(const es of or){es.trim();const hs=es.getMaxScale(),Ni={positionedGlyphs:[],lineOffset:0};it.positionedLines[Fa]=Ni;const Ls=Ni.positionedGlyphs;let Ra=0;if(!es.length()){Kr+=lr,++Fa;continue}const Iu=Vy(Br,es,ki);for(let Kl=0;Kl<es.length();Kl++){const Vo=es.getSection(Kl),Xs=es.getSectionIndex(Kl),Aa=es.getCharCode(Kl),Go=UD(Hr,hn,Aa);let Js;if(Vo.imageName){if(it.iconsInText=!0,Vo.scale=Vo.scale*ki,Js=Jv(Vo,Go,hs,Iu,Br),!Js)continue;Ra=Math.max(Ra,Js.imageOffset)}else if(Js=Xv(Vo,Aa,Go,Iu,Et,Zt),!Js)continue;const{rect:Zh,metrics:Ag,baselineOffset:Yh}=Js;Ls.push({glyph:Aa,imageName:Vo.imageName,x:wn,y:Kr+Yh+Xm,vertical:Go,scale:Vo.scale,fontStack:Vo.fontStack,sectionIndex:Xs,metrics:Ag,rect:Zh}),Go?(it.verticalizable=!0,wn+=(Vo.imageName?Ag.advance:Zi)*Vo.scale+Ar):wn+=Ag.advance*Vo.scale+Ar}Ls.length!==0&&(Nn=Math.max(wn-Ar,Nn),ag(Ls,0,Ls.length-1,Yi)),wn=0,Ni.lineOffset=Math.max(Ra,(hs-1)*Zi);const fa=lr*hs+Ra;Kr+=fa,hi=Math.max(fa,hi),++Fa}const{horizontalAlign:Mo,verticalAlign:Ws}=Wv(Lr);(function(es,hs,Ni,Ls,Ra,Iu,fa,Kl,Vo){const Xs=(hs-Ni)*Ra;let Aa=0;Aa=Iu!==fa?-Kl*Ls-Xm:-Ls*Vo*fa+.5*fa;for(const Go of es)for(const Js of Go.positionedGlyphs)Js.x+=Xs,Js.y+=Aa})(it.positionedLines,Yi,Mo,Ws,Nn,hi,lr,Kr,or.length),it.top+=-Ws*Kr,it.bottom=it.top+Kr,it.left+=-Mo*Nn,it.right=it.left+Nn}(Re,u,A,v,nt,k,Q,q,de,te,ye,Ie),!function(it){for(const Et of it)if(Et.positionedGlyphs.length!==0)return!1;return!0}(wt)&&Re}const zy={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},zT={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},HT={40:!0};function og(p,u,A,v,M,L){if(u.imageName){const k=v[u.imageName];return k?k.displaySize[0]*u.scale*Zi/L+M:0}{const k=A[u.fontStack],Q=k&&k[p];return Q?Q.metrics.advance*u.scale+M:0}}function Wh(p,u,A,v){const M=Math.pow(p-u,2);return v?p<u?M/2:2*M:M+Math.abs(A)*A}function lA(p,u,A){let v=0;return p===10&&(v-=1e4),A&&(v+=150),p!==40&&p!==65288||(v+=50),u!==41&&u!==65289||(v+=50),v}function qv(p,u,A,v,M,L){let k=null,Q=Wh(u,A,M,L);for(const q of v){const te=Wh(u-q.x,A,M,L)+q.badness;te<=Q&&(k=q,Q=te)}return{index:p,x:u,priorBreak:k,badness:Q}}function Hy(p){return p?Hy(p.priorBreak).concat(p.index):[]}function Kv(p,u,A,v,M,L){if(!p)return[];const k=[],Q=function(de,ye,me,Ie,ke,nt){let ct=0;for(let Ot=0;Ot<de.length();Ot++){const wt=de.getSection(Ot);ct+=og(de.getCharCode(Ot),wt,Ie,ke,ye,nt)}return ct/Math.max(1,Math.ceil(ct/me))}(p,u,A,v,M,L),q=p.text.indexOf("")>=0;let te=0;for(let de=0;de<p.length();de++){const ye=p.getSection(de),me=p.getCharCode(de);if(zy[me]||(te+=og(me,ye,v,M,u,L)),de<p.length()-1){const Ie=!((ae=me)<11904)&&(!!ci["CJK Compatibility Forms"](ae)||!!ci["CJK Compatibility"](ae)||!!ci["CJK Strokes"](ae)||!!ci["CJK Symbols and Punctuation"](ae)||!!ci["Enclosed CJK Letters and Months"](ae)||!!ci["Halfwidth and Fullwidth Forms"](ae)||!!ci["Ideographic Description Characters"](ae)||!!ci["Vertical Forms"](ae)||E.test(String.fromCodePoint(ae)));(zT[me]||Ie||ye.imageName||de!==p.length()-2&&HT[p.getCharCode(de+1)])&&k.push(qv(de+1,te,Q,k,lA(me,p.getCharCode(de+1),Ie&&q),!1))}}var ae;return Hy(qv(p.length(),te,Q,k,0,!0))}function Wv(p){let u=.5,A=.5;switch(p){case"right":case"top-right":case"bottom-right":u=1;break;case"left":case"top-left":case"bottom-left":u=0}switch(p){case"bottom":case"bottom-right":case"bottom-left":A=1;break;case"top":case"top-right":case"top-left":A=0}return{horizontalAlign:u,verticalAlign:A}}function Vy(p,u,A){const v=u.getMaxScale()*Zi,{maxImageWidth:M,maxImageHeight:L}=u.getMaxImageSize(p),k=Math.max(v,L*A);return{verticalLineContentWidth:Math.max(v,M*A),horizontalLineContentHeight:k}}function Gy(p){switch(p){case"top":return 0;case"center":return .5;default:return 1}}function UD(p,u,A){return!(p===a.ai.horizontal||!u&&!c(A)||u&&(zy[A]||(v=A,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(v)))));var v}function Xv(p,u,A,v,M,L){const k=L[p.fontStack],Q=function(te,ae,de,ye){if(te&&te.rect)return te;const me=ae[de.fontStack],Ie=me&&me[ye];return Ie?{rect:null,metrics:Ie.metrics}:null}(k&&k[u],M,p,u);if(Q===null)return null;let q;if(A)q=v.verticalLineContentWidth-p.scale*Zi;else{const te=Gy(p.verticalAlign);q=(v.horizontalLineContentHeight-p.scale*Zi)*te}return{rect:Q.rect,metrics:Q.metrics,baselineOffset:q}}function Jv(p,u,A,v,M){const L=M[p.imageName];if(!L)return null;const k=L.paddedRect,Q=L.displaySize,q={width:Q[0],height:Q[1],left:wc,top:-3,advance:u?Q[1]:Q[0]};let te;if(u)te=v.verticalLineContentWidth-Q[1]*p.scale;else{const ae=Gy(p.verticalAlign);te=(v.horizontalLineContentHeight-Q[1]*p.scale)*ae}return{rect:k,metrics:q,baselineOffset:te,imageOffset:(u?Q[0]:Q[1])*p.scale-Zi*A}}function ag(p,u,A,v){if(v===0)return;const M=p[A],L=(p[A].x+M.metrics.advance*M.scale)*v;for(let k=u;k<=A;k++)p[k].x-=L}function VT(p,u,A){const{horizontalAlign:v,verticalAlign:M}=Wv(A),L=u[0]-p.displaySize[0]*v,k=u[1]-p.displaySize[1]*M;return{image:p,top:k,bottom:k+p.displaySize[1],left:L,right:L+p.displaySize[0]}}function Zv(p){var u,A;let v=p.left,M=p.top,L=p.right-v,k=p.bottom-M;const Q=(u=p.image.textFitWidth)!==null&&u!==void 0?u:"stretchOrShrink",q=(A=p.image.textFitHeight)!==null&&A!==void 0?A:"stretchOrShrink",te=(p.image.content[2]-p.image.content[0])/(p.image.content[3]-p.image.content[1]);if(q==="proportional"){if(Q==="stretchOnly"&&L/k<te||Q==="proportional"){const ae=Math.ceil(k*te);v*=ae/L,L=ae}}else if(Q==="proportional"&&q==="stretchOnly"&&te!==0&&L/k>te){const ae=Math.ceil(L/te);M*=ae/k,k=ae}return{x1:v,y1:M,x2:v+L,y2:M+k}}function Qy(p,u,A,v,M,L){const k=p.image;let Q;if(k.content){const nt=k.content,ct=k.pixelRatio||1;Q=[nt[0]/ct,nt[1]/ct,k.displaySize[0]-nt[2]/ct,k.displaySize[1]-nt[3]/ct]}const q=u.left*L,te=u.right*L;let ae,de,ye,me;A==="width"||A==="both"?(me=M[0]+q-v[3],de=M[0]+te+v[1]):(me=M[0]+(q+te-k.displaySize[0])/2,de=me+k.displaySize[0]);const Ie=u.top*L,ke=u.bottom*L;return A==="height"||A==="both"?(ae=M[1]+Ie-v[0],ye=M[1]+ke+v[2]):(ae=M[1]+(Ie+ke-k.displaySize[1])/2,ye=ae+k.displaySize[1]),{image:k,top:ae,right:de,bottom:ye,left:me,collisionPadding:Q}}const lg=255,qu=128,If=lg*qu;function GT(p,u){const{expression:A}=u;if(A.kind==="constant")return{kind:"constant",layoutSize:A.evaluate(new Z(p+1))};if(A.kind==="source")return{kind:"source"};{const{zoomStops:v,interpolationType:M}=A;let L=0;for(;L<v.length&&v[L]<=p;)L++;L=Math.max(0,L-1);let k=L;for(;k<v.length&&v[k]<p+1;)k++;k=Math.min(v.length-1,k);const Q=v[L],q=v[k];return A.kind==="composite"?{kind:"composite",minZoom:Q,maxZoom:q,interpolationType:M}:{kind:"camera",minZoom:Q,maxZoom:q,minSize:A.evaluate(new Z(Q)),maxSize:A.evaluate(new Z(q)),interpolationType:M}}}function Yv(p,u,A){let v="never";const M=p.get(u);return M?v=M:p.get(A)&&(v="always"),v}const QT=eg.VectorTileFeature.types,ND=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function $y(p,u,A,v,M,L,k,Q,q,te,ae,de,ye){const me=Q?Math.min(If,Math.round(Q[0])):0,Ie=Q?Math.min(If,Math.round(Q[1])):0;p.emplaceBack(u,A,Math.round(32*v),Math.round(32*M),L,k,(me<<1)+(q?1:0),Ie,16*te,16*ae,256*de,256*ye)}function ex(p,u,A){p.emplaceBack(u.x,u.y,A),p.emplaceBack(u.x,u.y,A),p.emplaceBack(u.x,u.y,A),p.emplaceBack(u.x,u.y,A)}function zD(p){for(const u of p.sections)if(H(u.text))return!0;return!1}class Jm{constructor(u){this.layoutVertexArray=new zt,this.indexArray=new fr,this.programConfigurations=u,this.segments=new tn,this.dynamicLayoutVertexArray=new ir,this.opacityVertexArray=new sr,this.hasVisibleVertices=!1,this.placedSymbolArray=new J}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(u,A,v,M){this.isEmpty()||(v&&(this.layoutVertexBuffer=u.createVertexBuffer(this.layoutVertexArray,Ry.members),this.indexBuffer=u.createIndexBuffer(this.indexArray,A),this.dynamicLayoutVertexBuffer=u.createVertexBuffer(this.dynamicLayoutVertexArray,ig.members,!0),this.opacityVertexBuffer=u.createVertexBuffer(this.opacityVertexArray,ND,!0),this.opacityVertexBuffer.itemSize=1),(v||M)&&this.programConfigurations.upload(u))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}un("SymbolBuffers",Jm);class Id{constructor(u,A,v){this.layoutVertexArray=new u,this.layoutAttributes=A,this.indexArray=new v,this.segments=new tn,this.collisionVertexArray=new Er}upload(u){this.layoutVertexBuffer=u.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=u.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=u.createVertexBuffer(this.collisionVertexArray,DT.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}un("CollisionBuffers",Id);class GA{constructor(u){this.collisionBoxArray=u.collisionBoxArray,this.zoom=u.zoom,this.overscaling=u.overscaling,this.layers=u.layers,this.layerIds=this.layers.map(k=>k.id),this.index=u.index,this.pixelRatio=u.pixelRatio,this.sourceLayerIndex=u.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const A=this.layers[0]._unevaluatedLayout._values;this.textSizeData=GT(this.zoom,A["text-size"]),this.iconSizeData=GT(this.zoom,A["icon-size"]);const v=this.layers[0].layout,M=v.get("symbol-sort-key"),L=v.get("symbol-z-order");this.canOverlap=Yv(v,"text-overlap","text-allow-overlap")!=="never"||Yv(v,"icon-overlap","icon-allow-overlap")!=="never"||v.get("text-ignore-placement")||v.get("icon-ignore-placement"),this.sortFeaturesByKey=L!=="viewport-y"&&!M.isConstant(),this.sortFeaturesByY=(L==="viewport-y"||L==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,v.get("symbol-placement")==="point"&&(this.writingModes=v.get("text-writing-mode").map(k=>a.ai[k])),this.stateDependentLayerIds=this.layers.filter(k=>k.isStateDependent()).map(k=>k.id),this.sourceID=u.sourceID}createArrays(){this.text=new Jm(new Qs(this.layers,this.zoom,u=>/^text/.test(u))),this.icon=new Jm(new Qs(this.layers,this.zoom,u=>/^icon/.test(u))),this.glyphOffsetArray=new pe,this.lineVertexArray=new Ce,this.symbolInstances=new oe,this.textAnchorOffsets=new Ke}calculateGlyphDependencies(u,A,v,M,L){for(let k=0;k<u.length;k++)if(A[u.charCodeAt(k)]=!0,(v||M)&&L){const Q=Km[u.charAt(k)];Q&&(A[Q.charCodeAt(0)]=!0)}}populate(u,A,v){const M=this.layers[0],L=M.layout,k=L.get("text-font"),Q=L.get("text-field"),q=L.get("icon-image"),te=(Q.value.kind!=="constant"||Q.value.value instanceof fs&&!Q.value.value.isEmpty()||Q.value.value.toString().length>0)&&(k.value.kind!=="constant"||k.value.value.length>0),ae=q.value.kind!=="constant"||!!q.value.value||Object.keys(q.parameters).length>0,de=L.get("symbol-sort-key");if(this.features=[],!te&&!ae)return;const ye=A.iconDependencies,me=A.glyphDependencies,Ie=A.availableImages,ke=new Z(this.zoom);for(const{feature:nt,id:ct,index:Ot,sourceLayerIndex:wt}of u){const Re=M._featureFilter.needGeometry,it=jh(nt,Re);if(!M._featureFilter.filter(ke,it,v))continue;let Et,Zt;if(Re||(it.geometry=Tu(nt)),te){const or=M.getValueAndResolveTokens("text-field",it,v,Ie),lr=fs.factory(or),Lr=this.hasRTLText=this.hasRTLText||zD(lr);(!Lr||j.getRTLTextPluginStatus()==="unavailable"||Lr&&j.isParsed())&&(Et=OD(lr,M,it))}if(ae){const or=M.getValueAndResolveTokens("icon-image",it,v,Ie);Zt=or instanceof vs?or:vs.fromString(or)}if(!Et&&!Zt)continue;const Br=this.sortFeaturesByKey?de.evaluate(it,{},v):void 0;if(this.features.push({id:ct,text:Et,icon:Zt,index:Ot,sourceLayerIndex:wt,geometry:it.geometry,properties:nt.properties,type:QT[nt.type],sortKey:Br}),Zt&&(ye[Zt.name]=!0),Et){const or=k.evaluate(it,{},v).join(","),lr=L.get("text-rotation-alignment")!=="viewport"&&L.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(a.ai.vertical)>=0;for(const Lr of Et.sections)if(Lr.image)ye[Lr.image.name]=!0;else{const Tr=vn(Et.toString()),Hr=Lr.fontStack||or,Ar=me[Hr]=me[Hr]||{};this.calculateGlyphDependencies(Lr.text,Ar,lr,this.allowVerticalPlacement,Tr)}}}L.get("symbol-placement")==="line"&&(this.features=function(nt){const ct={},Ot={},wt=[];let Re=0;function it(or){wt.push(nt[or]),Re++}function Et(or,lr,Lr){const Tr=Ot[or];return delete Ot[or],Ot[lr]=Tr,wt[Tr].geometry[0].pop(),wt[Tr].geometry[0]=wt[Tr].geometry[0].concat(Lr[0]),Tr}function Zt(or,lr,Lr){const Tr=ct[lr];return delete ct[lr],ct[or]=Tr,wt[Tr].geometry[0].shift(),wt[Tr].geometry[0]=Lr[0].concat(wt[Tr].geometry[0]),Tr}function Br(or,lr,Lr){const Tr=Lr?lr[0][lr[0].length-1]:lr[0][0];return`${or}:${Tr.x}:${Tr.y}`}for(let or=0;or<nt.length;or++){const lr=nt[or],Lr=lr.geometry,Tr=lr.text?lr.text.toString():null;if(!Tr){it(or);continue}const Hr=Br(Tr,Lr),Ar=Br(Tr,Lr,!0);if(Hr in Ot&&Ar in ct&&Ot[Hr]!==ct[Ar]){const hn=Zt(Hr,Ar,Lr),Mn=Et(Hr,Ar,wt[hn].geometry);delete ct[Hr],delete Ot[Ar],Ot[Br(Tr,wt[Mn].geometry,!0)]=Mn,wt[hn].geometry=null}else Hr in Ot?Et(Hr,Ar,Lr):Ar in ct?Zt(Hr,Ar,Lr):(it(or),ct[Hr]=Re-1,Ot[Ar]=Re-1)}return wt.filter(or=>or.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((nt,ct)=>nt.sortKey-ct.sortKey)}update(u,A,v){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(u,A,this.layers,v),this.icon.programConfigurations.updatePaintArrays(u,A,this.layers,v))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(u){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(u),this.iconCollisionBox.upload(u)),this.text.upload(u,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(u,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(u,A){const v=this.lineVertexArray.length;if(u.segment!==void 0){let M=u.dist(A[u.segment+1]),L=u.dist(A[u.segment]);const k={};for(let Q=u.segment+1;Q<A.length;Q++)k[Q]={x:A[Q].x,y:A[Q].y,tileUnitDistanceFromAnchor:M},Q<A.length-1&&(M+=A[Q+1].dist(A[Q]));for(let Q=u.segment||0;Q>=0;Q--)k[Q]={x:A[Q].x,y:A[Q].y,tileUnitDistanceFromAnchor:L},Q>0&&(L+=A[Q-1].dist(A[Q]));for(let Q=0;Q<A.length;Q++){const q=k[Q];this.lineVertexArray.emplaceBack(q.x,q.y,q.tileUnitDistanceFromAnchor)}}return{lineStartIndex:v,lineLength:this.lineVertexArray.length-v}}addSymbols(u,A,v,M,L,k,Q,q,te,ae,de,ye){const me=u.indexArray,Ie=u.layoutVertexArray,ke=u.segments.prepareSegment(4*A.length,Ie,me,this.canOverlap?k.sortKey:void 0),nt=this.glyphOffsetArray.length,ct=ke.vertexLength,Ot=this.allowVerticalPlacement&&Q===a.ai.vertical?Math.PI/2:0,wt=k.text&&k.text.sections;for(let Re=0;Re<A.length;Re++){const{tl:it,tr:Et,bl:Zt,br:Br,tex:or,pixelOffsetTL:lr,pixelOffsetBR:Lr,minFontScaleX:Tr,minFontScaleY:Hr,glyphOffset:Ar,isSDF:hn,sectionIndex:Mn}=A[Re],wn=ke.vertexLength,Kr=Ar[1];$y(Ie,q.x,q.y,it.x,Kr+it.y,or.x,or.y,v,hn,lr.x,lr.y,Tr,Hr),$y(Ie,q.x,q.y,Et.x,Kr+Et.y,or.x+or.w,or.y,v,hn,Lr.x,lr.y,Tr,Hr),$y(Ie,q.x,q.y,Zt.x,Kr+Zt.y,or.x,or.y+or.h,v,hn,lr.x,Lr.y,Tr,Hr),$y(Ie,q.x,q.y,Br.x,Kr+Br.y,or.x+or.w,or.y+or.h,v,hn,Lr.x,Lr.y,Tr,Hr),ex(u.dynamicLayoutVertexArray,q,Ot),me.emplaceBack(wn,wn+2,wn+1),me.emplaceBack(wn+1,wn+2,wn+3),ke.vertexLength+=4,ke.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ar[0]),Re!==A.length-1&&Mn===A[Re+1].sectionIndex||u.programConfigurations.populatePaintArrays(Ie.length,k,k.index,{},ye,wt&&wt[Mn])}u.placedSymbolArray.emplaceBack(q.x,q.y,nt,this.glyphOffsetArray.length-nt,ct,te,ae,q.segment,v?v[0]:0,v?v[1]:0,M[0],M[1],Q,0,!1,0,de)}_addCollisionDebugVertex(u,A,v,M,L,k){return A.emplaceBack(0,0),u.emplaceBack(v.x,v.y,M,L,Math.round(k.x),Math.round(k.y))}addCollisionDebugVertices(u,A,v,M,L,k,Q){const q=L.segments.prepareSegment(4,L.layoutVertexArray,L.indexArray),te=q.vertexLength,ae=L.layoutVertexArray,de=L.collisionVertexArray,ye=Q.anchorX,me=Q.anchorY;this._addCollisionDebugVertex(ae,de,k,ye,me,new N(u,A)),this._addCollisionDebugVertex(ae,de,k,ye,me,new N(v,A)),this._addCollisionDebugVertex(ae,de,k,ye,me,new N(v,M)),this._addCollisionDebugVertex(ae,de,k,ye,me,new N(u,M)),q.vertexLength+=4;const Ie=L.indexArray;Ie.emplaceBack(te,te+1),Ie.emplaceBack(te+1,te+2),Ie.emplaceBack(te+2,te+3),Ie.emplaceBack(te+3,te),q.primitiveLength+=4}addDebugCollisionBoxes(u,A,v,M){for(let L=u;L<A;L++){const k=this.collisionBoxArray.get(L);this.addCollisionDebugVertices(k.x1,k.y1,k.x2,k.y2,M?this.textCollisionBox:this.iconCollisionBox,k.anchorPoint,v)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Id(gr,Ly.members,qr),this.iconCollisionBox=new Id(gr,Ly.members,qr);for(let u=0;u<this.symbolInstances.length;u++){const A=this.symbolInstances.get(u);this.addDebugCollisionBoxes(A.textBoxStartIndex,A.textBoxEndIndex,A,!0),this.addDebugCollisionBoxes(A.verticalTextBoxStartIndex,A.verticalTextBoxEndIndex,A,!0),this.addDebugCollisionBoxes(A.iconBoxStartIndex,A.iconBoxEndIndex,A,!1),this.addDebugCollisionBoxes(A.verticalIconBoxStartIndex,A.verticalIconBoxEndIndex,A,!1)}}_deserializeCollisionBoxesForSymbol(u,A,v,M,L,k,Q,q,te){const ae={};for(let de=A;de<v;de++){const ye=u.get(de);ae.textBox={x1:ye.x1,y1:ye.y1,x2:ye.x2,y2:ye.y2,anchorPointX:ye.anchorPointX,anchorPointY:ye.anchorPointY},ae.textFeatureIndex=ye.featureIndex;break}for(let de=M;de<L;de++){const ye=u.get(de);ae.verticalTextBox={x1:ye.x1,y1:ye.y1,x2:ye.x2,y2:ye.y2,anchorPointX:ye.anchorPointX,anchorPointY:ye.anchorPointY},ae.verticalTextFeatureIndex=ye.featureIndex;break}for(let de=k;de<Q;de++){const ye=u.get(de);ae.iconBox={x1:ye.x1,y1:ye.y1,x2:ye.x2,y2:ye.y2,anchorPointX:ye.anchorPointX,anchorPointY:ye.anchorPointY},ae.iconFeatureIndex=ye.featureIndex;break}for(let de=q;de<te;de++){const ye=u.get(de);ae.verticalIconBox={x1:ye.x1,y1:ye.y1,x2:ye.x2,y2:ye.y2,anchorPointX:ye.anchorPointX,anchorPointY:ye.anchorPointY},ae.verticalIconFeatureIndex=ye.featureIndex;break}return ae}deserializeCollisionBoxes(u){this.collisionArrays=[];for(let A=0;A<this.symbolInstances.length;A++){const v=this.symbolInstances.get(A);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(u,v.textBoxStartIndex,v.textBoxEndIndex,v.verticalTextBoxStartIndex,v.verticalTextBoxEndIndex,v.iconBoxStartIndex,v.iconBoxEndIndex,v.verticalIconBoxStartIndex,v.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(u,A){const v=u.placedSymbolArray.get(A),M=v.vertexStartIndex+4*v.numGlyphs;for(let L=v.vertexStartIndex;L<M;L+=4)u.indexArray.emplaceBack(L,L+2,L+1),u.indexArray.emplaceBack(L+1,L+2,L+3)}getSortedSymbolIndexes(u){if(this.sortedAngle===u&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const A=Math.sin(u),v=Math.cos(u),M=[],L=[],k=[];for(let Q=0;Q<this.symbolInstances.length;++Q){k.push(Q);const q=this.symbolInstances.get(Q);M.push(0|Math.round(A*q.anchorX+v*q.anchorY)),L.push(q.featureIndex)}return k.sort((Q,q)=>M[Q]-M[q]||L[q]-L[Q]),k}addToSortKeyRanges(u,A){const v=this.sortKeyRanges[this.sortKeyRanges.length-1];v&&v.sortKey===A?v.symbolInstanceEnd=u+1:this.sortKeyRanges.push({sortKey:A,symbolInstanceStart:u,symbolInstanceEnd:u+1})}sortFeatures(u){if(this.sortFeaturesByY&&this.sortedAngle!==u&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(u),this.sortedAngle=u,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const A of this.symbolInstanceIndexes){const v=this.symbolInstances.get(A);this.featureSortOrder.push(v.featureIndex),[v.rightJustifiedTextSymbolIndex,v.centerJustifiedTextSymbolIndex,v.leftJustifiedTextSymbolIndex].forEach((M,L,k)=>{M>=0&&k.indexOf(M)===L&&this.addIndicesForPlacedSymbol(this.text,M)}),v.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,v.verticalPlacedTextSymbolIndex),v.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,v.placedIconSymbolIndex),v.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,v.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let tx,rx;un("SymbolBucket",GA,{omit:["layers","collisionBoxArray","features","compareText"]}),GA.MAX_GLYPHS=65535,GA.addDynamicAttributes=ex;var jy={get paint(){return rx=rx||new It({"icon-opacity":new Ze(Xe.paint_symbol["icon-opacity"]),"icon-color":new Ze(Xe.paint_symbol["icon-color"]),"icon-halo-color":new Ze(Xe.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ze(Xe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ze(Xe.paint_symbol["icon-halo-blur"]),"icon-translate":new qe(Xe.paint_symbol["icon-translate"]),"icon-translate-anchor":new qe(Xe.paint_symbol["icon-translate-anchor"]),"text-opacity":new Ze(Xe.paint_symbol["text-opacity"]),"text-color":new Ze(Xe.paint_symbol["text-color"],{runtimeType:dr,getOverride:p=>p.textColor,hasOverride:p=>!!p.textColor}),"text-halo-color":new Ze(Xe.paint_symbol["text-halo-color"]),"text-halo-width":new Ze(Xe.paint_symbol["text-halo-width"]),"text-halo-blur":new Ze(Xe.paint_symbol["text-halo-blur"]),"text-translate":new qe(Xe.paint_symbol["text-translate"]),"text-translate-anchor":new qe(Xe.paint_symbol["text-translate-anchor"])})},get layout(){return tx=tx||new It({"symbol-placement":new qe(Xe.layout_symbol["symbol-placement"]),"symbol-spacing":new qe(Xe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new qe(Xe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ze(Xe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new qe(Xe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new qe(Xe.layout_symbol["icon-allow-overlap"]),"icon-overlap":new qe(Xe.layout_symbol["icon-overlap"]),"icon-ignore-placement":new qe(Xe.layout_symbol["icon-ignore-placement"]),"icon-optional":new qe(Xe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new qe(Xe.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ze(Xe.layout_symbol["icon-size"]),"icon-text-fit":new qe(Xe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new qe(Xe.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ze(Xe.layout_symbol["icon-image"]),"icon-rotate":new Ze(Xe.layout_symbol["icon-rotate"]),"icon-padding":new Ze(Xe.layout_symbol["icon-padding"]),"icon-keep-upright":new qe(Xe.layout_symbol["icon-keep-upright"]),"icon-offset":new Ze(Xe.layout_symbol["icon-offset"]),"icon-anchor":new Ze(Xe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new qe(Xe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new qe(Xe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new qe(Xe.layout_symbol["text-rotation-alignment"]),"text-field":new Ze(Xe.layout_symbol["text-field"]),"text-font":new Ze(Xe.layout_symbol["text-font"]),"text-size":new Ze(Xe.layout_symbol["text-size"]),"text-max-width":new Ze(Xe.layout_symbol["text-max-width"]),"text-line-height":new qe(Xe.layout_symbol["text-line-height"]),"text-letter-spacing":new Ze(Xe.layout_symbol["text-letter-spacing"]),"text-justify":new Ze(Xe.layout_symbol["text-justify"]),"text-radial-offset":new Ze(Xe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new qe(Xe.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Ze(Xe.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Ze(Xe.layout_symbol["text-anchor"]),"text-max-angle":new qe(Xe.layout_symbol["text-max-angle"]),"text-writing-mode":new qe(Xe.layout_symbol["text-writing-mode"]),"text-rotate":new Ze(Xe.layout_symbol["text-rotate"]),"text-padding":new qe(Xe.layout_symbol["text-padding"]),"text-keep-upright":new qe(Xe.layout_symbol["text-keep-upright"]),"text-transform":new Ze(Xe.layout_symbol["text-transform"]),"text-offset":new Ze(Xe.layout_symbol["text-offset"]),"text-allow-overlap":new qe(Xe.layout_symbol["text-allow-overlap"]),"text-overlap":new qe(Xe.layout_symbol["text-overlap"]),"text-ignore-placement":new qe(Xe.layout_symbol["text-ignore-placement"]),"text-optional":new qe(Xe.layout_symbol["text-optional"])})}};class nx{constructor(u){if(u.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=u.property.overrides?u.property.overrides.runtimeType:dt,this.defaultValue=u}evaluate(u){if(u.formattedSection){const A=this.defaultValue.property.overrides;if(A&&A.hasOverride(u.formattedSection))return A.getOverride(u.formattedSection)}return u.feature&&u.featureState?this.defaultValue.evaluate(u.feature,u.featureState):this.defaultValue.property.specification.default}eachChild(u){this.defaultValue.isConstant()||u(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}un("FormatSectionOverride",nx,{omit:["defaultValue"]});class cg extends wr{constructor(u){super(u,jy)}recalculate(u,A){if(super.recalculate(u,A),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const v=this.layout.get("text-writing-mode");if(v){const M=[];for(const L of v)M.indexOf(L)<0&&M.push(L);this.layout._values["text-writing-mode"]=M}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(u,A,v,M){const L=this.layout.get(u).evaluate(A,{},v,M),k=this._unevaluatedLayout._values[u];return k.isDataDriven()||ko(k.value)||!L?L:function(Q,q){return q.replace(/{([^{}]+)}/g,(te,ae)=>Q&&ae in Q?String(Q[ae]):"")}(A.properties,L)}createBucket(u){return new GA(u)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const u of jy.paint.overridableProperties){if(!cg.hasPaintOverride(this.layout,u))continue;const A=this.paint.get(u),v=new nx(A),M=new ha(v,A.property.specification);let L=null;L=A.value.kind==="constant"||A.value.kind==="source"?new gc("source",M):new mc("composite",M,A.value.zoomStops),this.paint._values[u]=new Oe(A.property,L,A.parameters)}}_handleOverridablePaintPropertyUpdate(u,A,v){return!(!this.layout||A.isDataDriven()||v.isDataDriven())&&cg.hasPaintOverride(this.layout,u)}static hasPaintOverride(u,A){const v=u.get("text-field"),M=jy.paint.properties[A];let L=!1;const k=Q=>{for(const q of Q)if(M.overrides&&M.overrides.hasOverride(q))return void(L=!0)};if(v.value.kind==="constant"&&v.value.value instanceof fs)k(v.value.value.sections);else if(v.value.kind==="source"){const Q=te=>{L||(te instanceof ps&&ai(te.value)===Jn?k(te.value.sections):te instanceof Lc?k(te.sections):te.eachChild(Q))},q=v.value;q._styleExpression&&Q(q._styleExpression.expression)}return L}}let ug;var $T={get paint(){return ug=ug||new It({"background-color":new qe(Xe.paint_background["background-color"]),"background-pattern":new vt(Xe.paint_background["background-pattern"]),"background-opacity":new qe(Xe.paint_background["background-opacity"])})}};class ix extends wr{constructor(u){super(u,$T)}}let sx;var Ku={get paint(){return sx=sx||new It({"raster-opacity":new qe(Xe.paint_raster["raster-opacity"]),"raster-hue-rotate":new qe(Xe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new qe(Xe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new qe(Xe.paint_raster["raster-brightness-max"]),"raster-saturation":new qe(Xe.paint_raster["raster-saturation"]),"raster-contrast":new qe(Xe.paint_raster["raster-contrast"]),"raster-resampling":new qe(Xe.paint_raster["raster-resampling"]),"raster-fade-duration":new qe(Xe.paint_raster["raster-fade-duration"])})}};class Zm extends wr{constructor(u){super(u,Ku)}}class jT extends wr{constructor(u){super(u,{}),this.onAdd=A=>{this.implementation.onAdd&&this.implementation.onAdd(A,A.painter.context.gl)},this.onRemove=A=>{this.implementation.onRemove&&this.implementation.onRemove(A,A.painter.context.gl)},this.implementation=u}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class qT{constructor(u){this._methodToThrottle=u,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const qy=63710088e-1;class Mf{constructor(u,A){if(isNaN(u)||isNaN(A))throw new Error(`Invalid LngLat object: (${u}, ${A})`);if(this.lng=+u,this.lat=+A,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Mf(Bt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(u){const A=Math.PI/180,v=this.lat*A,M=u.lat*A,L=Math.sin(v)*Math.sin(M)+Math.cos(v)*Math.cos(M)*Math.cos((u.lng-this.lng)*A);return qy*Math.acos(Math.min(L,1))}static convert(u){if(u instanceof Mf)return u;if(Array.isArray(u)&&(u.length===2||u.length===3))return new Mf(Number(u[0]),Number(u[1]));if(!Array.isArray(u)&&typeof u=="object"&&u!==null)return new Mf(Number("lng"in u?u.lng:u.lon),Number(u.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const ox=2*Math.PI*qy;function ax(p){return ox*Math.cos(p*Math.PI/180)}function KT(p){return(180+p)/360}function lx(p){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+p*Math.PI/360)))/360}function Pf(p,u){return p/ax(u)}function Ky(p){return 360/Math.PI*Math.atan(Math.exp((180-360*p)*Math.PI/180))-90}function cx(p,u){return p*ax(Ky(u))}class hg{constructor(u,A){let v=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;this.x=+u,this.y=+A,this.z=+v}static fromLngLat(u){let A=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const v=Mf.convert(u);return new hg(KT(v.lng),lx(v.lat),Pf(A,v.lat))}toLngLat(){return new Mf(360*this.x-180,Ky(this.y))}toAltitude(){return cx(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/ox*(u=Ky(this.y),1/Math.cos(u*Math.PI/180));var u}}function ux(p,u,A){var v=2*Math.PI*6378137/256/Math.pow(2,A);return[p*v-2*Math.PI*6378137/2,u*v-2*Math.PI*6378137/2]}class hx{constructor(u,A,v){if(!function(M,L,k){return!(M<0||M>25||k<0||k>=Math.pow(2,M)||L<0||L>=Math.pow(2,M))}(u,A,v))throw new Error(`x=${A}, y=${v}, z=${u} outside of bounds. 0<=x<${Math.pow(2,u)}, 0<=y<${Math.pow(2,u)} 0<=z<=25 `);this.z=u,this.x=A,this.y=v,this.key=Xh(0,u,u,A,v)}equals(u){return this.z===u.z&&this.x===u.x&&this.y===u.y}url(u,A,v){const M=(k=this.y,Q=this.z,q=ux(256*(L=this.x),256*(k=Math.pow(2,Q)-k-1),Q),te=ux(256*(L+1),256*(k+1),Q),q[0]+","+q[1]+","+te[0]+","+te[1]);var L,k,Q,q,te;const ae=function(de,ye,me){let Ie,ke="";for(let nt=de;nt>0;nt--)Ie=1<<nt-1,ke+=(ye&Ie?1:0)+(me&Ie?2:0);return ke}(this.z,this.x,this.y);return u[(this.x+this.y)%u.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(v==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,A>1?"@2x":"").replace(/{quadkey}/g,ae).replace(/{bbox-epsg-3857}/g,M)}isChildOf(u){const A=this.z-u.z;return A>0&&u.x===this.x>>A&&u.y===this.y>>A}getTilePoint(u){const A=Math.pow(2,this.z);return new N((u.x*A-this.x)*Vt,(u.y*A-this.y)*Vt)}toString(){return`${this.z}/${this.x}/${this.y}`}}class WT{constructor(u,A){this.wrap=u,this.canonical=A,this.key=Xh(u,A.z,A.z,A.x,A.y)}}class Su{constructor(u,A,v,M,L){if(this.terrainRttPosMatrix32f=null,u<v)throw new Error(`overscaledZ should be >= z; overscaledZ = ${u}; z = ${v}`);this.overscaledZ=u,this.wrap=A,this.canonical=new hx(v,+M,+L),this.key=Xh(A,u,v,M,L)}clone(){return new Su(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(u){return this.overscaledZ===u.overscaledZ&&this.wrap===u.wrap&&this.canonical.equals(u.canonical)}scaledTo(u){if(u>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${u}; overscaledZ = ${this.overscaledZ}`);const A=this.canonical.z-u;return u>this.canonical.z?new Su(u,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Su(u,this.wrap,u,this.canonical.x>>A,this.canonical.y>>A)}calculateScaledKey(u,A){if(u>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${u}; overscaledZ = ${this.overscaledZ}`);const v=this.canonical.z-u;return u>this.canonical.z?Xh(this.wrap*+A,u,this.canonical.z,this.canonical.x,this.canonical.y):Xh(this.wrap*+A,u,u,this.canonical.x>>v,this.canonical.y>>v)}isChildOf(u){if(u.wrap!==this.wrap)return!1;const A=this.canonical.z-u.canonical.z;return u.overscaledZ===0||u.overscaledZ<this.overscaledZ&&u.canonical.x===this.canonical.x>>A&&u.canonical.y===this.canonical.y>>A}children(u){if(this.overscaledZ>=u)return[new Su(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const A=this.canonical.z+1,v=2*this.canonical.x,M=2*this.canonical.y;return[new Su(A,this.wrap,A,v,M),new Su(A,this.wrap,A,v+1,M),new Su(A,this.wrap,A,v,M+1),new Su(A,this.wrap,A,v+1,M+1)]}isLessThan(u){return this.wrap<u.wrap||!(this.wrap>u.wrap)&&(this.overscaledZ<u.overscaledZ||!(this.overscaledZ>u.overscaledZ)&&(this.canonical.x<u.canonical.x||!(this.canonical.x>u.canonical.x)&&this.canonical.y<u.canonical.y))}wrapped(){return new Su(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(u){return new Su(this.overscaledZ,u,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new WT(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(u){return this.canonical.getTilePoint(new hg(u.x-this.wrap,u.y))}}function Xh(p,u,A,v,M){(p*=2)<0&&(p=-1*p-1);const L=1<<A;return(L*L*p+L*M+v).toString(36)+A.toString(36)+u.toString(36)}un("CanonicalTileID",hx),un("OverscaledTileID",Su,{omit:["terrainRttPosMatrix32f"]});class dx{constructor(u,A,v){let M=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1,L=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1,k=arguments.length>5&&arguments[5]!==void 0?arguments[5]:1,Q=arguments.length>6&&arguments[6]!==void 0?arguments[6]:0;if(this.uid=u,A.height!==A.width)throw new RangeError("DEM tiles must be square");if(v&&!["mapbox","terrarium","custom"].includes(v))return void kr(`"${v}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=A.height;const q=this.dim=A.height-2;switch(this.data=new Uint32Array(A.data.buffer),v){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=M,this.greenFactor=L,this.blueFactor=k,this.baseShift=Q;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let te=0;te<q;te++)this.data[this._idx(-1,te)]=this.data[this._idx(0,te)],this.data[this._idx(q,te)]=this.data[this._idx(q-1,te)],this.data[this._idx(te,-1)]=this.data[this._idx(te,0)],this.data[this._idx(te,q)]=this.data[this._idx(te,q-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(q,-1)]=this.data[this._idx(q-1,0)],this.data[this._idx(-1,q)]=this.data[this._idx(0,q-1)],this.data[this._idx(q,q)]=this.data[this._idx(q-1,q-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let te=0;te<q;te++)for(let ae=0;ae<q;ae++){const de=this.get(te,ae);de>this.max&&(this.max=de),de<this.min&&(this.min=de)}}get(u,A){const v=new Uint8Array(this.data.buffer),M=4*this._idx(u,A);return this.unpack(v[M],v[M+1],v[M+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(u,A){if(u<-1||u>=this.dim+1||A<-1||A>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(A+1)*this.stride+(u+1)}unpack(u,A,v){return u*this.redFactor+A*this.greenFactor+v*this.blueFactor-this.baseShift}getPixels(){return new ju({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(u,A,v){if(this.dim!==u.dim)throw new Error("dem dimension mismatch");let M=A*this.dim,L=A*this.dim+this.dim,k=v*this.dim,Q=v*this.dim+this.dim;switch(A){case-1:M=L-1;break;case 1:L=M+1}switch(v){case-1:k=Q-1;break;case 1:Q=k+1}const q=-A*this.dim,te=-v*this.dim;for(let ae=k;ae<Q;ae++)for(let de=M;de<L;de++)this.data[this._idx(de,ae)]=u.data[this._idx(de+q,ae+te)]}}un("DEMData",dx);class Ym{constructor(u){this._stringToNumber={},this._numberToString=[];for(let A=0;A<u.length;A++){const v=u[A];this._stringToNumber[v]=A,this._numberToString[A]=v}}encode(u){return this._stringToNumber[u]}decode(u){if(u>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${u} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[u]}}class fx{constructor(u,A,v,M,L){this.type="Feature",this._vectorTileFeature=u,u._z=A,u._x=v,u._y=M,this.properties=u.properties,this.id=L}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(u){this._geometry=u}toJSON(){const u={geometry:this.geometry};for(const A in this)A!=="_geometry"&&A!=="_vectorTileFeature"&&(u[A]=this[A]);return u}}class e_{constructor(u,A){this.tileID=u,this.x=u.canonical.x,this.y=u.canonical.y,this.z=u.canonical.z,this.grid=new _o(Vt,16,0),this.grid3D=new _o(Vt,16,0),this.featureIndexArray=new gt,this.promoteId=A}insert(u,A,v,M,L,k){const Q=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(v,M,L);const q=k?this.grid3D:this.grid;for(let te=0;te<A.length;te++){const ae=A[te],de=[1/0,1/0,-1/0,-1/0];for(let ye=0;ye<ae.length;ye++){const me=ae[ye];de[0]=Math.min(de[0],me.x),de[1]=Math.min(de[1],me.y),de[2]=Math.max(de[2],me.x),de[3]=Math.max(de[3],me.y)}de[0]<Vt&&de[1]<Vt&&de[2]>=0&&de[3]>=0&&q.insert(Q,de[0],de[1],de[2],de[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new eg.VectorTile(new zA(this.rawTileData)).layers,this.sourceLayerCoder=new Ym(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(u,A,v,M){this.loadVTLayers();const L=u.params,k=Vt/u.tileSize/u.scale,Q=_c(L.filter),q=u.queryGeometry,te=u.queryPadding*k,ae=r_(q),de=this.grid.query(ae.minX-te,ae.minY-te,ae.maxX+te,ae.maxY+te),ye=r_(u.cameraQueryGeometry),me=this.grid3D.query(ye.minX-te,ye.minY-te,ye.maxX+te,ye.maxY+te,(nt,ct,Ot,wt)=>function(Re,it,Et,Zt,Br){for(const lr of Re)if(it<=lr.x&&Et<=lr.y&&Zt>=lr.x&&Br>=lr.y)return!0;const or=[new N(it,Et),new N(it,Br),new N(Zt,Br),new N(Zt,Et)];if(Re.length>2){for(const lr of or)if(Ed(Re,lr))return!0}for(let lr=0;lr<Re.length-1;lr++)if($u(Re[lr],Re[lr+1],or))return!0;return!1}(u.cameraQueryGeometry,nt-te,ct-te,Ot+te,wt+te));for(const nt of me)de.push(nt);de.sort(HD);const Ie={};let ke;for(let nt=0;nt<de.length;nt++){const ct=de[nt];if(ct===ke)continue;ke=ct;const Ot=this.featureIndexArray.get(ct);let wt=null;this.loadMatchingFeature(Ie,Ot.bucketIndex,Ot.sourceLayerIndex,Ot.featureIndex,Q,L.layers,L.availableImages,A,v,M,(Re,it,Et)=>(wt||(wt=Tu(Re)),it.queryIntersectsFeature({queryGeometry:q,feature:Re,featureState:Et,geometry:wt,zoom:this.z,transform:u.transform,pixelsToTileUnits:k,pixelPosMatrix:u.pixelPosMatrix})))}return Ie}loadMatchingFeature(u,A,v,M,L,k,Q,q,te,ae,de){const ye=this.bucketLayerIDs[A];if(k&&!ye.some(nt=>k.has(nt)))return;const me=this.sourceLayerCoder.decode(v),Ie=this.vtLayers[me].feature(M);if(L.needGeometry){const nt=jh(Ie,!0);if(!L.filter(new Z(this.tileID.overscaledZ),nt,this.tileID.canonical))return}else if(!L.filter(new Z(this.tileID.overscaledZ),Ie))return;const ke=this.getId(Ie,me);for(let nt=0;nt<ye.length;nt++){const ct=ye[nt];if(k&&!k.has(ct))continue;const Ot=q[ct];if(!Ot)continue;let wt={};ke&&ae&&(wt=ae.getState(Ot.sourceLayer||"_geojsonTileLayer",ke));const Re=St({},te[ct]);Re.paint=t_(Re.paint,Ot.paint,Ie,wt,Q),Re.layout=t_(Re.layout,Ot.layout,Ie,wt,Q);const it=!de||de(Ie,Ot,wt);if(!it)continue;const Et=new fx(Ie,this.z,this.x,this.y,ke);Et.layer=Re;let Zt=u[ct];Zt===void 0&&(Zt=u[ct]=[]),Zt.push({featureIndex:M,feature:Et,intersectionZ:it})}}lookupSymbolFeatures(u,A,v,M,L,k,Q,q){const te={};this.loadVTLayers();const ae=_c(L);for(const de of u)this.loadMatchingFeature(te,v,M,de,ae,k,Q,q,A);return te}hasLayer(u){for(const A of this.bucketLayerIDs)for(const v of A)if(u===v)return!0;return!1}getId(u,A){var v;let M=u.id;return this.promoteId&&(M=u.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[A]],typeof M=="boolean"&&(M=Number(M)),M===void 0&&(!((v=u.properties)===null||v===void 0)&&v.cluster)&&this.promoteId&&(M=Number(u.properties.cluster_id))),M}}function t_(p,u,A,v,M){return qt(p,(L,k)=>{const Q=u instanceof rt?u.get(k):null;return Q&&Q.evaluate?Q.evaluate(A,v,M):Q})}function r_(p){let u=1/0,A=1/0,v=-1/0,M=-1/0;for(const L of p)u=Math.min(u,L.x),A=Math.min(A,L.y),v=Math.max(v,L.x),M=Math.max(M,L.y);return{minX:u,minY:A,maxX:v,maxY:M}}function HD(p,u){return u-p}function XT(p,u,A,v,M){const L=[];for(let k=0;k<p.length;k++){const Q=p[k];let q;for(let te=0;te<Q.length-1;te++){let ae=Q[te],de=Q[te+1];ae.x<u&&de.x<u||(ae.x<u?ae=new N(u,ae.y+(u-ae.x)/(de.x-ae.x)*(de.y-ae.y))._round():de.x<u&&(de=new N(u,ae.y+(u-ae.x)/(de.x-ae.x)*(de.y-ae.y))._round()),ae.y<A&&de.y<A||(ae.y<A?ae=new N(ae.x+(A-ae.y)/(de.y-ae.y)*(de.x-ae.x),A)._round():de.y<A&&(de=new N(ae.x+(A-ae.y)/(de.y-ae.y)*(de.x-ae.x),A)._round()),ae.x>=v&&de.x>=v||(ae.x>=v?ae=new N(v,ae.y+(v-ae.x)/(de.x-ae.x)*(de.y-ae.y))._round():de.x>=v&&(de=new N(v,ae.y+(v-ae.x)/(de.x-ae.x)*(de.y-ae.y))._round()),ae.y>=M&&de.y>=M||(ae.y>=M?ae=new N(ae.x+(M-ae.y)/(de.y-ae.y)*(de.x-ae.x),M)._round():de.y>=M&&(de=new N(ae.x+(M-ae.y)/(de.y-ae.y)*(de.x-ae.x),M)._round()),q&&ae.equals(q[q.length-1])||(q=[ae],L.push(q)),q.push(de)))))}}return L}un("FeatureIndex",e_,{omit:["rawTileData","sourceLayerCoder"]});class cA extends N{constructor(u,A,v,M){super(u,A),this.angle=v,M!==void 0&&(this.segment=M)}clone(){return new cA(this.x,this.y,this.angle,this.segment)}}function QA(p,u,A,v,M){if(u.segment===void 0||A===0)return!0;let L=u,k=u.segment+1,Q=0;for(;Q>-A/2;){if(k--,k<0)return!1;Q-=p[k].dist(L),L=p[k]}Q+=p[k].dist(p[k+1]),k++;const q=[];let te=0;for(;Q<A/2;){const ae=p[k],de=p[k+1];if(!de)return!1;let ye=p[k-1].angleTo(ae)-ae.angleTo(de);for(ye=Math.abs((ye+3*Math.PI)%(2*Math.PI)-Math.PI),q.push({distance:Q,angleDelta:ye}),te+=ye;Q-q[0].distance>v;)te-=q.shift().angleDelta;if(te>M)return!1;k++,Q+=ae.dist(de)}return!0}function nl(p){let u=0;for(let A=0;A<p.length-1;A++)u+=p[A].dist(p[A+1]);return u}function Ff(p,u,A){return p?.6*u*A:0}function Wy(p,u){return Math.max(p?p.right-p.left:0,u?u.right-u.left:0)}function JT(p,u,A,v,M,L){const k=Ff(A,M,L),Q=Wy(A,v)*L;let q=0;const te=nl(p)/2;for(let ae=0;ae<p.length-1;ae++){const de=p[ae],ye=p[ae+1],me=de.dist(ye);if(q+me>te){const Ie=(te-q)/me,ke=Ka.number(de.x,ye.x,Ie),nt=Ka.number(de.y,ye.y,Ie),ct=new cA(ke,nt,ye.angleTo(de),ae);return ct._round(),!k||QA(p,ct,Q,k,u)?ct:void 0}q+=me}}function ZT(p,u,A,v,M,L,k,Q,q){const te=Ff(v,L,k),ae=Wy(v,M),de=ae*k,ye=p[0].x===0||p[0].x===q||p[0].y===0||p[0].y===q;return u-de<u/4&&(u=de+u/4),Xy(p,ye?u/2*Q%u:(ae/2+2*L)*k*Q%u,u,te,A,de,ye,!1,q)}function Xy(p,u,A,v,M,L,k,Q,q){const te=L/2,ae=nl(p);let de=0,ye=u-A,me=[];for(let Ie=0;Ie<p.length-1;Ie++){const ke=p[Ie],nt=p[Ie+1],ct=ke.dist(nt),Ot=nt.angleTo(ke);for(;ye+A<de+ct;){ye+=A;const wt=(ye-de)/ct,Re=Ka.number(ke.x,nt.x,wt),it=Ka.number(ke.y,nt.y,wt);if(Re>=0&&Re<q&&it>=0&&it<q&&ye-te>=0&&ye+te<=ae){const Et=new cA(Re,it,Ot,Ie);Et._round(),v&&!QA(p,Et,L,v,M)||me.push(Et)}}de+=ct}return Q||me.length||k||(me=Xy(p,de/2,A,v,M,L,k,!0,q)),me}un("Anchor",cA);const n_=wc;function Ax(p,u,A,v){const M=[],L=p.image,k=L.pixelRatio,Q=L.paddedRect.w-2*n_,q=L.paddedRect.h-2*n_;let te={x1:p.left,y1:p.top,x2:p.right,y2:p.bottom};const ae=L.stretchX||[[0,Q]],de=L.stretchY||[[0,q]],ye=(Ar,hn)=>Ar+hn[1]-hn[0],me=ae.reduce(ye,0),Ie=de.reduce(ye,0),ke=Q-me,nt=q-Ie;let ct=0,Ot=me,wt=0,Re=Ie,it=0,Et=ke,Zt=0,Br=nt;if(L.content&&v){const Ar=L.content,hn=Ar[2]-Ar[0],Mn=Ar[3]-Ar[1];(L.textFitWidth||L.textFitHeight)&&(te=Zv(p)),ct=i_(ae,0,Ar[0]),wt=i_(de,0,Ar[1]),Ot=i_(ae,Ar[0],Ar[2]),Re=i_(de,Ar[1],Ar[3]),it=Ar[0]-ct,Zt=Ar[1]-wt,Et=hn-Ot,Br=Mn-Re}const or=te.x1,lr=te.y1,Lr=te.x2-or,Tr=te.y2-lr,Hr=(Ar,hn,Mn,wn)=>{const Kr=s_(Ar.stretch-ct,Ot,Lr,or),Nn=dg(Ar.fixed-it,Et,Ar.stretch,me),hi=s_(hn.stretch-wt,Re,Tr,lr),Yi=dg(hn.fixed-Zt,Br,hn.stretch,Ie),ki=s_(Mn.stretch-ct,Ot,Lr,or),Fa=dg(Mn.fixed-it,Et,Mn.stretch,me),Mo=s_(wn.stretch-wt,Re,Tr,lr),Ws=dg(wn.fixed-Zt,Br,wn.stretch,Ie),es=new N(Kr,hi),hs=new N(ki,hi),Ni=new N(ki,Mo),Ls=new N(Kr,Mo),Ra=new N(Nn/k,Yi/k),Iu=new N(Fa/k,Ws/k),fa=u*Math.PI/180;if(fa){const Xs=Math.sin(fa),Aa=Math.cos(fa),Go=[Aa,-Xs,Xs,Aa];es._matMult(Go),hs._matMult(Go),Ls._matMult(Go),Ni._matMult(Go)}const Kl=Ar.stretch+Ar.fixed,Vo=hn.stretch+hn.fixed;return{tl:es,tr:hs,bl:Ls,br:Ni,tex:{x:L.paddedRect.x+n_+Kl,y:L.paddedRect.y+n_+Vo,w:Mn.stretch+Mn.fixed-Kl,h:wn.stretch+wn.fixed-Vo},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ra,pixelOffsetBR:Iu,minFontScaleX:Et/k/Lr,minFontScaleY:Br/k/Tr,isSDF:A}};if(v&&(L.stretchX||L.stretchY)){const Ar=YT(ae,ke,me),hn=YT(de,nt,Ie);for(let Mn=0;Mn<Ar.length-1;Mn++){const wn=Ar[Mn],Kr=Ar[Mn+1];for(let Nn=0;Nn<hn.length-1;Nn++)M.push(Hr(wn,hn[Nn],Kr,hn[Nn+1]))}}else M.push(Hr({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:Q+1},{fixed:0,stretch:q+1}));return M}function i_(p,u,A){let v=0;for(const M of p)v+=Math.max(u,Math.min(A,M[1]))-Math.max(u,Math.min(A,M[0]));return v}function YT(p,u,A){const v=[{fixed:-1,stretch:0}];for(const[M,L]of p){const k=v[v.length-1];v.push({fixed:M-k.stretch,stretch:k.stretch}),v.push({fixed:M-k.stretch,stretch:k.stretch+(L-M)})}return v.push({fixed:u+n_,stretch:A}),v}function s_(p,u,A,v){return p/u*A+v}function dg(p,u,A,v){return p-u*A/v}class fg{constructor(u,A,v,M,L,k,Q,q,te,ae){var de;if(this.boxStartIndex=u.length,te){let ye=k.top,me=k.bottom;const Ie=k.collisionPadding;Ie&&(ye-=Ie[1],me+=Ie[3]);let ke=me-ye;ke>0&&(ke=Math.max(10,ke),this.circleDiameter=ke)}else{const ye=!((de=k.image)===null||de===void 0)&&de.content&&(k.image.textFitWidth||k.image.textFitHeight)?Zv(k):{x1:k.left,y1:k.top,x2:k.right,y2:k.bottom};ye.y1=ye.y1*Q-q[0],ye.y2=ye.y2*Q+q[2],ye.x1=ye.x1*Q-q[3],ye.x2=ye.x2*Q+q[1];const me=k.collisionPadding;if(me&&(ye.x1-=me[0]*Q,ye.y1-=me[1]*Q,ye.x2+=me[2]*Q,ye.y2+=me[3]*Q),ae){const Ie=new N(ye.x1,ye.y1),ke=new N(ye.x2,ye.y1),nt=new N(ye.x1,ye.y2),ct=new N(ye.x2,ye.y2),Ot=ae*Math.PI/180;Ie._rotate(Ot),ke._rotate(Ot),nt._rotate(Ot),ct._rotate(Ot),ye.x1=Math.min(Ie.x,ke.x,nt.x,ct.x),ye.x2=Math.max(Ie.x,ke.x,nt.x,ct.x),ye.y1=Math.min(Ie.y,ke.y,nt.y,ct.y),ye.y2=Math.max(Ie.y,ke.y,nt.y,ct.y)}u.emplaceBack(A.x,A.y,ye.x1,ye.y1,ye.x2,ye.y2,v,M,L)}this.boxEndIndex=u.length}}class eS{constructor(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],A=arguments.length>1&&arguments[1]!==void 0?arguments[1]:(v,M)=>v<M?-1:v>M?1:0;if(this.data=u,this.length=this.data.length,this.compare=A,this.length>0)for(let v=(this.length>>1)-1;v>=0;v--)this._down(v)}push(u){this.data.push(u),this._up(this.length++)}pop(){if(this.length===0)return;const u=this.data[0],A=this.data.pop();return--this.length>0&&(this.data[0]=A,this._down(0)),u}peek(){return this.data[0]}_up(u){const{data:A,compare:v}=this,M=A[u];for(;u>0;){const L=u-1>>1,k=A[L];if(v(M,k)>=0)break;A[u]=k,u=L}A[u]=M}_down(u){const{data:A,compare:v}=this,M=this.length>>1,L=A[u];for(;u<M;){let k=1+(u<<1);const Q=k+1;if(Q<this.length&&v(A[Q],A[k])<0&&(k=Q),v(A[k],L)>=0)break;A[u]=A[k],u=k}A[u]=L}}function o_(p){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,A=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,v=1/0,M=1/0,L=-1/0,k=-1/0;const Q=p[0];for(let me=0;me<Q.length;me++){const Ie=Q[me];(!me||Ie.x<v)&&(v=Ie.x),(!me||Ie.y<M)&&(M=Ie.y),(!me||Ie.x>L)&&(L=Ie.x),(!me||Ie.y>k)&&(k=Ie.y)}const q=Math.min(L-v,k-M);let te=q/2;const ae=new eS([],px);if(q===0)return new N(v,M);for(let me=v;me<L;me+=q)for(let Ie=M;Ie<k;Ie+=q)ae.push(new $A(me+te,Ie+te,te,p));let de=function(me){let Ie=0,ke=0,nt=0;const ct=me[0];for(let Ot=0,wt=ct.length,Re=wt-1;Ot<wt;Re=Ot++){const it=ct[Ot],Et=ct[Re],Zt=it.x*Et.y-Et.x*it.y;ke+=(it.x+Et.x)*Zt,nt+=(it.y+Et.y)*Zt,Ie+=3*Zt}return new $A(ke/Ie,nt/Ie,0,me)}(p),ye=ae.length;for(;ae.length;){const me=ae.pop();(me.d>de.d||!de.d)&&(de=me,A&&console.log("found best %d after %d probes",Math.round(1e4*me.d)/1e4,ye)),me.max-de.d<=u||(te=me.h/2,ae.push(new $A(me.p.x-te,me.p.y-te,te,p)),ae.push(new $A(me.p.x+te,me.p.y-te,te,p)),ae.push(new $A(me.p.x-te,me.p.y+te,te,p)),ae.push(new $A(me.p.x+te,me.p.y+te,te,p)),ye+=4)}return A&&(console.log(`num probes: ${ye}`),console.log(`best distance: ${de.d}`)),de.p}function px(p,u){return u.max-p.max}function $A(p,u,A,v){this.p=new N(p,u),this.h=A,this.d=function(M,L){let k=!1,Q=1/0;for(let q=0;q<L.length;q++){const te=L[q];for(let ae=0,de=te.length,ye=de-1;ae<de;ye=ae++){const me=te[ae],Ie=te[ye];me.y>M.y!=Ie.y>M.y&&M.x<(Ie.x-me.x)*(M.y-me.y)/(Ie.y-me.y)+me.x&&(k=!k),Q=Math.min(Q,Ev(M,me,Ie))}}return(k?1:-1)*Math.sqrt(Q)}(this.p,v),this.max=this.d+this.h*Math.SQRT2}var Pa;a.av=void 0,(Pa=a.av||(a.av={}))[Pa.center=1]="center",Pa[Pa.left=2]="left",Pa[Pa.right=3]="right",Pa[Pa.top=4]="top",Pa[Pa.bottom=5]="bottom",Pa[Pa["top-left"]=6]="top-left",Pa[Pa["top-right"]=7]="top-right",Pa[Pa["bottom-left"]=8]="bottom-left",Pa[Pa["bottom-right"]=9]="bottom-right";const Jh=7,jA=Number.POSITIVE_INFINITY;function Jy(p,u){return u[1]!==jA?function(A,v,M){let L=0,k=0;switch(v=Math.abs(v),M=Math.abs(M),A){case"top-right":case"top-left":case"top":k=M-Jh;break;case"bottom-right":case"bottom-left":case"bottom":k=-M+Jh}switch(A){case"top-right":case"bottom-right":case"right":L=-v;break;case"top-left":case"bottom-left":case"left":L=v}return[L,k]}(p,u[0],u[1]):function(A,v){let M=0,L=0;v<0&&(v=0);const k=v/Math.SQRT2;switch(A){case"top-right":case"top-left":L=k-Jh;break;case"bottom-right":case"bottom-left":L=-k+Jh;break;case"bottom":L=-v+Jh;break;case"top":L=v-Jh}switch(A){case"top-right":case"bottom-right":M=-k;break;case"top-left":case"bottom-left":M=k;break;case"left":M=v;break;case"right":M=-v}return[M,L]}(p,u[0])}function Zy(p,u,A){var v;const M=p.layout,L=(v=M.get("text-variable-anchor-offset"))===null||v===void 0?void 0:v.evaluate(u,{},A);if(L){const Q=L.values,q=[];for(let te=0;te<Q.length;te+=2){const ae=q[te]=Q[te],de=Q[te+1].map(ye=>ye*Zi);ae.startsWith("top")?de[1]-=Jh:ae.startsWith("bottom")&&(de[1]+=Jh),q[te+1]=de}return new Us(q)}const k=M.get("text-variable-anchor");if(k){let Q;Q=p._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[M.get("text-radial-offset").evaluate(u,{},A)*Zi,jA]:M.get("text-offset").evaluate(u,{},A).map(te=>te*Zi);const q=[];for(const te of k)q.push(te,Jy(te,Q));return new Us(q)}return null}function a_(p){switch(p){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function VD(p,u,A,v,M,L,k,Q,q,te,ae,de){let ye=L.textMaxSize.evaluate(u,{});ye===void 0&&(ye=k);const me=p.layers[0].layout,Ie=me.get("icon-offset").evaluate(u,{},ae),ke=d(A.horizontal),nt=k/24,ct=p.tilePixelRatio*nt,Ot=p.tilePixelRatio*ye/24,wt=p.tilePixelRatio*Q,Re=p.tilePixelRatio*me.get("symbol-spacing"),it=me.get("text-padding")*p.tilePixelRatio,Et=function(Mn,wn,Kr){let Nn=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;const hi=Mn.get("icon-padding").evaluate(wn,{},Kr),Yi=hi&&hi.values;return[Yi[0]*Nn,Yi[1]*Nn,Yi[2]*Nn,Yi[3]*Nn]}(me,u,ae,p.tilePixelRatio),Zt=me.get("text-max-angle")/180*Math.PI,Br=me.get("text-rotation-alignment")!=="viewport"&&me.get("symbol-placement")!=="point",or=me.get("icon-rotation-alignment")==="map"&&me.get("symbol-placement")!=="point",lr=me.get("symbol-placement"),Lr=Re/2,Tr=me.get("icon-text-fit");let Hr;v&&Tr!=="none"&&(p.allowVerticalPlacement&&A.vertical&&(Hr=Qy(v,A.vertical,Tr,me.get("icon-text-fit-padding"),Ie,nt)),ke&&(v=Qy(v,ke,Tr,me.get("icon-text-fit-padding"),Ie,nt)));const Ar=ae?de.line.getGranularityForZoomLevel(ae.z):1,hn=(Mn,wn)=>{wn.x<0||wn.x>=Vt||wn.y<0||wn.y>=Vt||function(Kr,Nn,hi,Yi,ki,Fa,Mo,Ws,es,hs,Ni,Ls,Ra,Iu,fa,Kl,Vo,Xs,Aa,Go,Js,Zh,Ag,Yh,GD){const pg=Kr.addToLineVertexArray(Nn,hi);let qA,gg,Bc,Rf,gx=0,tS=0,rS=0,nS=0,il=-1,jc=-1;const qc={};let _h=Rs("");if(Kr.allowVerticalPlacement&&Yi.vertical){const Kc=Ws.layout.get("text-rotate").evaluate(Js,{},Yh)+90;Bc=new fg(es,Nn,hs,Ni,Ls,Yi.vertical,Ra,Iu,fa,Kc),Mo&&(Rf=new fg(es,Nn,hs,Ni,Ls,Mo,Vo,Xs,fa,Kc))}if(ki){const Kc=Ws.layout.get("icon-rotate").evaluate(Js,{}),ed=Ws.layout.get("icon-text-fit")!=="none",l_=Ax(ki,Kc,Ag,ed),Df=Mo?Ax(Mo,Kc,Ag,ed):void 0;gg=new fg(es,Nn,hs,Ni,Ls,ki,Vo,Xs,!1,Kc),gx=4*l_.length;const c_=Kr.iconSizeData;let hA=null;c_.kind==="source"?(hA=[qu*Ws.layout.get("icon-size").evaluate(Js,{})],hA[0]>If&&kr(`${Kr.layerIds[0]}: Value for "icon-size" is >= ${lg}. Reduce your "icon-size".`)):c_.kind==="composite"&&(hA=[qu*Zh.compositeIconSizes[0].evaluate(Js,{},Yh),qu*Zh.compositeIconSizes[1].evaluate(Js,{},Yh)],(hA[0]>If||hA[1]>If)&&kr(`${Kr.layerIds[0]}: Value for "icon-size" is >= ${lg}. Reduce your "icon-size".`)),Kr.addSymbols(Kr.icon,l_,hA,Go,Aa,Js,a.ai.none,Nn,pg.lineStartIndex,pg.lineLength,-1,Yh),il=Kr.icon.placedSymbolArray.length-1,Df&&(tS=4*Df.length,Kr.addSymbols(Kr.icon,Df,hA,Go,Aa,Js,a.ai.vertical,Nn,pg.lineStartIndex,pg.lineLength,-1,Yh),jc=Kr.icon.placedSymbolArray.length-1)}const uA=Object.keys(Yi.horizontal);for(const Kc of uA){const ed=Yi.horizontal[Kc];if(!qA){_h=Rs(ed.text);const Df=Ws.layout.get("text-rotate").evaluate(Js,{},Yh);qA=new fg(es,Nn,hs,Ni,Ls,ed,Ra,Iu,fa,Df)}const l_=ed.positionedLines.length===1;if(rS+=g(Kr,Nn,ed,Fa,Ws,fa,Js,Kl,pg,Yi.vertical?a.ai.horizontal:a.ai.horizontalOnly,l_?uA:[Kc],qc,il,Zh,Yh),l_)break}Yi.vertical&&(nS+=g(Kr,Nn,Yi.vertical,Fa,Ws,fa,Js,Kl,pg,a.ai.vertical,["vertical"],qc,jc,Zh,Yh));const Md=qA?qA.boxStartIndex:Kr.collisionBoxArray.length,yWe=qA?qA.boxEndIndex:Kr.collisionBoxArray.length,bWe=Bc?Bc.boxStartIndex:Kr.collisionBoxArray.length,vWe=Bc?Bc.boxEndIndex:Kr.collisionBoxArray.length,xWe=gg?gg.boxStartIndex:Kr.collisionBoxArray.length,wWe=gg?gg.boxEndIndex:Kr.collisionBoxArray.length,BWe=Rf?Rf.boxStartIndex:Kr.collisionBoxArray.length,CWe=Rf?Rf.boxEndIndex:Kr.collisionBoxArray.length;let Lf=-1;const iS=(Kc,ed)=>Kc&&Kc.circleDiameter?Math.max(Kc.circleDiameter,ed):ed;Lf=iS(qA,Lf),Lf=iS(Bc,Lf),Lf=iS(gg,Lf),Lf=iS(Rf,Lf);const wZ=Lf>-1?1:0;wZ&&(Lf*=GD/Zi),Kr.glyphOffsetArray.length>=GA.MAX_GLYPHS&&kr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Js.sortKey!==void 0&&Kr.addToSortKeyRanges(Kr.symbolInstances.length,Js.sortKey);const EWe=Zy(Ws,Js,Yh),[TWe,SWe]=function(Kc,ed){const l_=Kc.length,Df=ed==null?void 0:ed.values;if((Df==null?void 0:Df.length)>0)for(let c_=0;c_<Df.length;c_+=2){const hA=Df[c_+1];Kc.emplaceBack(a.av[Df[c_]],hA[0],hA[1])}return[l_,Kc.length]}(Kr.textAnchorOffsets,EWe);Kr.symbolInstances.emplaceBack(Nn.x,Nn.y,qc.right>=0?qc.right:-1,qc.center>=0?qc.center:-1,qc.left>=0?qc.left:-1,qc.vertical||-1,il,jc,_h,Md,yWe,bWe,vWe,xWe,wWe,BWe,CWe,hs,rS,nS,gx,tS,wZ,0,Ra,Lf,TWe,SWe)}(p,wn,Mn,A,v,M,Hr,p.layers[0],p.collisionBoxArray,u.index,u.sourceLayerIndex,p.index,ct,[it,it,it,it],Br,q,wt,Et,or,Ie,u,L,te,ae,k)};if(lr==="line")for(const Mn of XT(u.geometry,0,0,Vt,Vt)){const wn=Kh(Mn,Ar),Kr=ZT(wn,Re,Zt,A.vertical||ke,v,24,Ot,p.overscaling,Vt);for(const Nn of Kr)ke&&b(p,ke.text,Lr,Nn)||hn(wn,Nn)}else if(lr==="line-center"){for(const Mn of u.geometry)if(Mn.length>1){const wn=Kh(Mn,Ar),Kr=JT(wn,Zt,A.vertical||ke,v,24,Ot);Kr&&hn(wn,Kr)}}else if(u.type==="Polygon")for(const Mn of vi(u.geometry,0)){const wn=o_(Mn,16);hn(Kh(Mn[0],Ar,!0),new cA(wn.x,wn.y,0))}else if(u.type==="LineString")for(const Mn of u.geometry){const wn=Kh(Mn,Ar);hn(wn,new cA(wn[0].x,wn[0].y,0))}else if(u.type==="Point")for(const Mn of u.geometry)for(const wn of Mn)hn([wn],new cA(wn.x,wn.y,0))}function g(p,u,A,v,M,L,k,Q,q,te,ae,de,ye,me,Ie){const ke=function(Ot,wt,Re,it,Et,Zt,Br,or){const lr=it.layout.get("text-rotate").evaluate(Zt,{})*Math.PI/180,Lr=[];for(const Tr of wt.positionedLines)for(const Hr of Tr.positionedGlyphs){if(!Hr.rect)continue;const Ar=Hr.rect||{};let hn=kD+1,Mn=!0,wn=1,Kr=0;const Nn=(Et||or)&&Hr.vertical,hi=Hr.metrics.advance*Hr.scale/2;if(or&&wt.verticalizable&&(Kr=Tr.lineOffset/2-(Hr.imageName?-(Zi-Hr.metrics.width*Hr.scale)/2:(Hr.scale-1)*Zi)),Hr.imageName){const Xs=Br[Hr.imageName];Mn=Xs.sdf,wn=Xs.pixelRatio,hn=wc/wn}const Yi=Et?[Hr.x+hi,Hr.y]:[0,0];let ki=Et?[0,0]:[Hr.x+hi+Re[0],Hr.y+Re[1]-Kr],Fa=[0,0];Nn&&(Fa=ki,ki=[0,0]);const Mo=Hr.metrics.isDoubleResolution?2:1,Ws=(Hr.metrics.left-hn)*Hr.scale-hi+ki[0],es=(-Hr.metrics.top-hn)*Hr.scale+ki[1],hs=Ws+Ar.w/Mo*Hr.scale/wn,Ni=es+Ar.h/Mo*Hr.scale/wn,Ls=new N(Ws,es),Ra=new N(hs,es),Iu=new N(Ws,Ni),fa=new N(hs,Ni);if(Nn){const Xs=new N(-hi,hi-Xm),Aa=-Math.PI/2,Go=Zi/2-hi,Js=new N(5-Xm-Go,-(Hr.imageName?Go:0)),Zh=new N(...Fa);Ls._rotateAround(Aa,Xs)._add(Js)._add(Zh),Ra._rotateAround(Aa,Xs)._add(Js)._add(Zh),Iu._rotateAround(Aa,Xs)._add(Js)._add(Zh),fa._rotateAround(Aa,Xs)._add(Js)._add(Zh)}if(lr){const Xs=Math.sin(lr),Aa=Math.cos(lr),Go=[Aa,-Xs,Xs,Aa];Ls._matMult(Go),Ra._matMult(Go),Iu._matMult(Go),fa._matMult(Go)}const Kl=new N(0,0),Vo=new N(0,0);Lr.push({tl:Ls,tr:Ra,bl:Iu,br:fa,tex:Ar,writingMode:wt.writingMode,glyphOffset:Yi,sectionIndex:Hr.sectionIndex,isSDF:Mn,pixelOffsetTL:Kl,pixelOffsetBR:Vo,minFontScaleX:0,minFontScaleY:0})}return Lr}(0,A,Q,M,L,k,v,p.allowVerticalPlacement),nt=p.textSizeData;let ct=null;nt.kind==="source"?(ct=[qu*M.layout.get("text-size").evaluate(k,{})],ct[0]>If&&kr(`${p.layerIds[0]}: Value for "text-size" is >= ${lg}. Reduce your "text-size".`)):nt.kind==="composite"&&(ct=[qu*me.compositeTextSizes[0].evaluate(k,{},Ie),qu*me.compositeTextSizes[1].evaluate(k,{},Ie)],(ct[0]>If||ct[1]>If)&&kr(`${p.layerIds[0]}: Value for "text-size" is >= ${lg}. Reduce your "text-size".`)),p.addSymbols(p.text,ke,ct,Q,L,k,te,u,q.lineStartIndex,q.lineLength,ye,Ie);for(const Ot of ae)de[Ot]=p.text.placedSymbolArray.length-1;return 4*ke.length}function d(p){for(const u in p)return p[u];return null}function b(p,u,A,v){const M=p.compareText;if(u in M){const L=M[u];for(let k=L.length-1;k>=0;k--)if(v.dist(L[k])<A)return!0}else M[u]=[];return M[u].push(v),!1}const C=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class R{static from(u){if(!(u instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[A,v]=new Uint8Array(u,0,2);if(A!==219)throw new Error("Data does not appear to be in a KDBush format.");const M=v>>4;if(M!==1)throw new Error(`Got v${M} data when expected v1.`);const L=C[15&v];if(!L)throw new Error("Unrecognized array type.");const[k]=new Uint16Array(u,2,1),[Q]=new Uint32Array(u,4,1);return new R(Q,k,L,u)}constructor(u){let A=arguments.length>1&&arguments[1]!==void 0?arguments[1]:64,v=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Float64Array,M=arguments.length>3?arguments[3]:void 0;if(isNaN(u)||u<0)throw new Error(`Unpexpected numItems value: ${u}.`);this.numItems=+u,this.nodeSize=Math.min(Math.max(+A,2),65535),this.ArrayType=v,this.IndexArrayType=u<65536?Uint16Array:Uint32Array;const L=C.indexOf(this.ArrayType),k=2*u*this.ArrayType.BYTES_PER_ELEMENT,Q=u*this.IndexArrayType.BYTES_PER_ELEMENT,q=(8-Q%8)%8;if(L<0)throw new Error(`Unexpected typed array class: ${v}.`);M&&M instanceof ArrayBuffer?(this.data=M,this.ids=new this.IndexArrayType(this.data,8,u),this.coords=new this.ArrayType(this.data,8+Q+q,2*u),this._pos=2*u,this._finished=!0):(this.data=new ArrayBuffer(8+k+Q+q),this.ids=new this.IndexArrayType(this.data,8,u),this.coords=new this.ArrayType(this.data,8+Q+q,2*u),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+L]),new Uint16Array(this.data,2,1)[0]=A,new Uint32Array(this.data,4,1)[0]=u)}add(u,A){const v=this._pos>>1;return this.ids[v]=v,this.coords[this._pos++]=u,this.coords[this._pos++]=A,v}finish(){const u=this._pos>>1;if(u!==this.numItems)throw new Error(`Added ${u} items when expected ${this.numItems}.`);return U(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(u,A,v,M){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:L,coords:k,nodeSize:Q}=this,q=[0,L.length-1,0],te=[];for(;q.length;){const ae=q.pop()||0,de=q.pop()||0,ye=q.pop()||0;if(de-ye<=Q){for(let nt=ye;nt<=de;nt++){const ct=k[2*nt],Ot=k[2*nt+1];ct>=u&&ct<=v&&Ot>=A&&Ot<=M&&te.push(L[nt])}continue}const me=ye+de>>1,Ie=k[2*me],ke=k[2*me+1];Ie>=u&&Ie<=v&&ke>=A&&ke<=M&&te.push(L[me]),(ae===0?u<=Ie:A<=ke)&&(q.push(ye),q.push(me-1),q.push(1-ae)),(ae===0?v>=Ie:M>=ke)&&(q.push(me+1),q.push(de),q.push(1-ae))}return te}within(u,A,v){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:M,coords:L,nodeSize:k}=this,Q=[0,M.length-1,0],q=[],te=v*v;for(;Q.length;){const ae=Q.pop()||0,de=Q.pop()||0,ye=Q.pop()||0;if(de-ye<=k){for(let nt=ye;nt<=de;nt++)le(L[2*nt],L[2*nt+1],u,A)<=te&&q.push(M[nt]);continue}const me=ye+de>>1,Ie=L[2*me],ke=L[2*me+1];le(Ie,ke,u,A)<=te&&q.push(M[me]),(ae===0?u-v<=Ie:A-v<=ke)&&(Q.push(ye),Q.push(me-1),Q.push(1-ae)),(ae===0?u+v>=Ie:A+v>=ke)&&(Q.push(me+1),Q.push(de),Q.push(1-ae))}return q}}function U(p,u,A,v,M,L){if(M-v<=A)return;const k=v+M>>1;V(p,u,k,v,M,L),U(p,u,A,v,k-1,1-L),U(p,u,A,k+1,M,1-L)}function V(p,u,A,v,M,L){for(;M>v;){if(M-v>600){const te=M-v+1,ae=A-v+1,de=Math.log(te),ye=.5*Math.exp(2*de/3),me=.5*Math.sqrt(de*ye*(te-ye)/te)*(ae-te/2<0?-1:1);V(p,u,A,Math.max(v,Math.floor(A-ae*ye/te+me)),Math.min(M,Math.floor(A+(te-ae)*ye/te+me)),L)}const k=u[2*A+L];let Q=v,q=M;for(K(p,u,v,A),u[2*M+L]>k&&K(p,u,v,M);Q<q;){for(K(p,u,Q,q),Q++,q--;u[2*Q+L]<k;)Q++;for(;u[2*q+L]>k;)q--}u[2*v+L]===k?K(p,u,v,q):(q++,K(p,u,q,M)),q<=A&&(v=q+1),A<=q&&(M=q-1)}}function K(p,u,A,v){ee(p,A,v),ee(u,2*A,2*v),ee(u,2*A+1,2*v+1)}function ee(p,u,A){const v=p[u];p[u]=p[A],p[A]=v}function le(p,u,A,v){const M=p-A,L=u-v;return M*M+L*L}var _e;a.ce=void 0,(_e=a.ce||(a.ce={})).create="create",_e.load="load",_e.fullLoad="fullLoad";let Be=null,De=[];const Ge=1e3/60,et="loadTime",lt="fullLoadTime",Ct={mark(p){performance.mark(p)},frame(p){const u=p;Be!=null&&De.push(u-Be),Be=u},clearMetrics(){Be=null,De=[],performance.clearMeasures(et),performance.clearMeasures(lt);for(const p in a.ce)performance.clearMarks(a.ce[p])},getPerformanceMetrics(){performance.measure(et,a.ce.create,a.ce.load),performance.measure(lt,a.ce.create,a.ce.fullLoad);const p=performance.getEntriesByName(et)[0].duration,u=performance.getEntriesByName(lt)[0].duration,A=De.length,v=1/(De.reduce((L,k)=>L+k,0)/A/1e3),M=De.filter(L=>L>Ge).reduce((L,k)=>L+(k-Ge)/Ge,0);return{loadTime:p,fullLoadTime:u,fps:v,percentDroppedFrames:M/(A+M)*100,totalFrames:A}}};a.$=Se,a.A=Qe,a.B=Bu,a.C=function(p){if(on==null){const u=p.navigator?p.navigator.userAgent:null;on=!!p.safari||!(!u||!(/\b(iPad|iPhone|iPod)\b/.test(u)||u.match("Safari")&&!u.match("Chrome")))}return on},a.D=qe,a.E=Tn,a.F=class{constructor(p,u){this.target=p,this.mapId=u,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new qT(()=>this.process()),this.subscription=function(A,v,M,L){return A.addEventListener(v,M,!1),{unsubscribe:()=>{A.removeEventListener(v,M,!1)}}}(this.target,"message",A=>this.receive(A)),this.globalScope=sn(self)?p:window}registerMessageHandler(p,u){this.messageHandlers[p]=u}sendAsync(p,u){return new Promise((A,v)=>{const M=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[M]={resolve:A,reject:v},u&&u.signal.addEventListener("abort",()=>{delete this.resolveRejects[M];const Q={id:M,type:"<cancel>",origin:location.origin,targetMapId:p.targetMapId,sourceMapId:this.mapId};this.target.postMessage(Q)},{once:!0});const L=[],k=Object.assign(Object.assign({},p),{id:M,sourceMapId:this.mapId,origin:location.origin,data:$c(p.data,L)});this.target.postMessage(k,{transfer:L})})}receive(p){const u=p.data,A=u.id;if(!(u.origin!=="file://"&&location.origin!=="file://"&&u.origin!=="resource://android"&&location.origin!=="resource://android"&&u.origin!==location.origin||u.targetMapId&&this.mapId!==u.targetMapId)){if(u.type==="<cancel>"){delete this.tasks[A];const v=this.abortControllers[A];return delete this.abortControllers[A],void(v&&v.abort())}if(sn(self)||u.mustQueue)return this.tasks[A]=u,this.taskQueue.push(A),void this.invoker.trigger();this.processTask(A,u)}}process(){if(this.taskQueue.length===0)return;const p=this.taskQueue.shift(),u=this.tasks[p];delete this.tasks[p],this.taskQueue.length>0&&this.invoker.trigger(),u&&this.processTask(p,u)}processTask(p,u){return o(this,void 0,void 0,function*(){if(u.type==="<response>"){const M=this.resolveRejects[p];return delete this.resolveRejects[p],M?void(u.error?M.reject(Bl(u.error)):M.resolve(Bl(u.data))):void 0}if(!this.messageHandlers[u.type])return void this.completeTask(p,new Error(`Could not find a registered handler for ${u.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const A=Bl(u.data),v=new AbortController;this.abortControllers[p]=v;try{const M=yield this.messageHandlers[u.type](u.sourceMapId,A,v);this.completeTask(p,null,M)}catch(M){this.completeTask(p,M)}})}completeTask(p,u,A){const v=[];delete this.abortControllers[p];const M={id:p,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:u?$c(u):null,data:$c(A,v)};this.target.postMessage(M,{transfer:v})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},a.G=Fn,a.H=function(){var p=new Qe(16);return Qe!=Float32Array&&(p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[11]=0,p[12]=0,p[13]=0,p[14]=0),p[0]=1,p[5]=1,p[10]=1,p[15]=1,p},a.I=Uy,a.J=function(p,u,A){var v,M,L,k,Q,q,te,ae,de,ye,me,Ie,ke=A[0],nt=A[1],ct=A[2];return u===p?(p[12]=u[0]*ke+u[4]*nt+u[8]*ct+u[12],p[13]=u[1]*ke+u[5]*nt+u[9]*ct+u[13],p[14]=u[2]*ke+u[6]*nt+u[10]*ct+u[14],p[15]=u[3]*ke+u[7]*nt+u[11]*ct+u[15]):(M=u[1],L=u[2],k=u[3],Q=u[4],q=u[5],te=u[6],ae=u[7],de=u[8],ye=u[9],me=u[10],Ie=u[11],p[0]=v=u[0],p[1]=M,p[2]=L,p[3]=k,p[4]=Q,p[5]=q,p[6]=te,p[7]=ae,p[8]=de,p[9]=ye,p[10]=me,p[11]=Ie,p[12]=v*ke+Q*nt+de*ct+u[12],p[13]=M*ke+q*nt+ye*ct+u[13],p[14]=L*ke+te*nt+me*ct+u[14],p[15]=k*ke+ae*nt+Ie*ct+u[15]),p},a.K=function(p,u,A){var v=A[0],M=A[1],L=A[2];return p[0]=u[0]*v,p[1]=u[1]*v,p[2]=u[2]*v,p[3]=u[3]*v,p[4]=u[4]*M,p[5]=u[5]*M,p[6]=u[6]*M,p[7]=u[7]*M,p[8]=u[8]*L,p[9]=u[9]*L,p[10]=u[10]*L,p[11]=u[11]*L,p[12]=u[12],p[13]=u[13],p[14]=u[14],p[15]=u[15],p},a.L=function(p,u,A){var v=u[0],M=u[1],L=u[2],k=u[3],Q=u[4],q=u[5],te=u[6],ae=u[7],de=u[8],ye=u[9],me=u[10],Ie=u[11],ke=u[12],nt=u[13],ct=u[14],Ot=u[15],wt=A[0],Re=A[1],it=A[2],Et=A[3];return p[0]=wt*v+Re*Q+it*de+Et*ke,p[1]=wt*M+Re*q+it*ye+Et*nt,p[2]=wt*L+Re*te+it*me+Et*ct,p[3]=wt*k+Re*ae+it*Ie+Et*Ot,p[4]=(wt=A[4])*v+(Re=A[5])*Q+(it=A[6])*de+(Et=A[7])*ke,p[5]=wt*M+Re*q+it*ye+Et*nt,p[6]=wt*L+Re*te+it*me+Et*ct,p[7]=wt*k+Re*ae+it*Ie+Et*Ot,p[8]=(wt=A[8])*v+(Re=A[9])*Q+(it=A[10])*de+(Et=A[11])*ke,p[9]=wt*M+Re*q+it*ye+Et*nt,p[10]=wt*L+Re*te+it*me+Et*ct,p[11]=wt*k+Re*ae+it*Ie+Et*Ot,p[12]=(wt=A[12])*v+(Re=A[13])*Q+(it=A[14])*de+(Et=A[15])*ke,p[13]=wt*M+Re*q+it*ye+Et*nt,p[14]=wt*L+Re*te+it*me+Et*ct,p[15]=wt*k+Re*ae+it*Ie+Et*Ot,p},a.M=function(p,u){const A={};for(let v=0;v<u.length;v++){const M=u[v];M in p&&(A[M]=p[M])}return A},a.N=Mf,a.O=KT,a.P=N,a.Q=lx,a.R=ju,a.S=Su,a.T=ue,a.U=ce,a.V=fe,a.W=Pn,a.X=Vt,a.Y=hg,a.Z=hx,a._=o,a.a=gn,a.a$=function(){return new Float64Array(16)},a.a0=p=>{const u=window.document.createElement("video");return u.muted=!0,new Promise(A=>{u.onloadstart=()=>{A(u)};for(const v of p){const M=window.document.createElement("source");Cn(v)||(u.crossOrigin="Anonymous"),M.src=v,u.appendChild(M)}})},a.a1=function(){return jt++},a.a2=O,a.a3=GA,a.a4=_c,a.a5=jh,a.a6=fx,a.a7=function(p){const u={};if(p.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(A,v,M,L)=>{const k=M||L;return u[v]=!k||k.toLowerCase(),""}),u["max-age"]){const A=parseInt(u["max-age"],10);isNaN(A)?delete u["max-age"]:u["max-age"]=A}return u},a.a8=function(p){return Math.log(p)/Math.LN2},a.a9=function(p){var u=p[0],A=p[1];return u*u+A*A},a.aA=xr,a.aB=Sy,a.aC=ft,a.aD=tn,a.aE=fr,a.aF=85.051129,a.aG=function(p){return Math.pow(2,p)},a.aH=Pf,a.aI=Bt,a.aJ=Mr,a.aK=cx,a.aL=function(p,u,A){return p[0]=u[0]*A,p[1]=u[1]*A,p[2]=u[2]*A,p},a.aM=function(p,u,A){return p[0]=u[0]+A[0],p[1]=u[1]+A[1],p[2]=u[2]+A[2],p},a.aN=function(p){var u=new Qe(3);return u[0]=p[0],u[1]=p[1],u[2]=p[2],u},a.aO=function(p,u,A){return p[0]=u[0]*A[0],p[1]=u[1]*A[1],p[2]=u[2]*A[2],p[3]=u[3]*A[3],p},a.aP=function(p,u,A){return p[0]=u[0]-A[0],p[1]=u[1]-A[1],p[2]=u[2]-A[2],p},a.aQ=function(p,u){var A=u[0],v=u[1],M=u[2],L=A*A+v*v+M*M;return L>0&&(L=1/Math.sqrt(L)),p[0]=u[0]*L,p[1]=u[1]*L,p[2]=u[2]*L,p},a.aR=function(p,u,A){var v=u[0],M=u[1],L=u[2],k=A[0],Q=A[1],q=A[2];return p[0]=M*q-L*Q,p[1]=L*k-v*q,p[2]=v*Q-M*k,p},a.aS=function(p,u){return p[0]*u[0]+p[1]*u[1]+p[2]*u[2]},a.aT=WT,a.aU=Xh,a.aV=function(p,u,A,v,M){var L,k=1/Math.tan(u/2);return p[0]=k/A,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=k,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[11]=-1,p[12]=0,p[13]=0,p[15]=0,M!=null&&M!==1/0?(p[10]=(M+v)*(L=1/(v-M)),p[14]=2*M*v*L):(p[10]=-1,p[14]=-2*v),p},a.aW=function(p){var u=new Qe(16);return u[0]=p[0],u[1]=p[1],u[2]=p[2],u[3]=p[3],u[4]=p[4],u[5]=p[5],u[6]=p[6],u[7]=p[7],u[8]=p[8],u[9]=p[9],u[10]=p[10],u[11]=p[11],u[12]=p[12],u[13]=p[13],u[14]=p[14],u[15]=p[15],u},a.aX=function(p,u,A){var v=Math.sin(A),M=Math.cos(A),L=u[0],k=u[1],Q=u[2],q=u[3],te=u[4],ae=u[5],de=u[6],ye=u[7];return u!==p&&(p[8]=u[8],p[9]=u[9],p[10]=u[10],p[11]=u[11],p[12]=u[12],p[13]=u[13],p[14]=u[14],p[15]=u[15]),p[0]=L*M+te*v,p[1]=k*M+ae*v,p[2]=Q*M+de*v,p[3]=q*M+ye*v,p[4]=te*M-L*v,p[5]=ae*M-k*v,p[6]=de*M-Q*v,p[7]=ye*M-q*v,p},a.aY=function(p,u,A){var v=Math.sin(A),M=Math.cos(A),L=u[4],k=u[5],Q=u[6],q=u[7],te=u[8],ae=u[9],de=u[10],ye=u[11];return u!==p&&(p[0]=u[0],p[1]=u[1],p[2]=u[2],p[3]=u[3],p[12]=u[12],p[13]=u[13],p[14]=u[14],p[15]=u[15]),p[4]=L*M+te*v,p[5]=k*M+ae*v,p[6]=Q*M+de*v,p[7]=q*M+ye*v,p[8]=te*M-L*v,p[9]=ae*M-k*v,p[10]=de*M-Q*v,p[11]=ye*M-q*v,p},a.aZ=function(){const p=new Float32Array(16);return st(p),p},a.a_=function(){const p=new Float64Array(16);return st(p),p},a.aa=function(p){return p*Math.PI/180},a.ab=ut,a.ac=function(p,u){const A=[];for(const v in p)v in u||A.push(v);return A},a.ad=Ne,a.ae=function(p){return Math.hypot(p[0],p[1])},a.af=function(p){return p[0]=0,p[1]=0,p},a.ag=function(p,u,A){return p[0]=u[0]*A,p[1]=u[1]*A,p},a.ah=function(p,u){let A=0,v=0;if(p.kind==="constant")v=p.layoutSize;else if(p.kind!=="source"){const{interpolationType:M,minZoom:L,maxZoom:k}=p,Q=M?ut(Sn.interpolationFactor(M,u,L,k),0,1):0;p.kind==="camera"?v=Ka.number(p.minSize,p.maxSize,Q):A=Q}return{uSizeT:A,uSize:v}},a.aj=function(p,u,A){let{uSize:v,uSizeT:M}=u,{lowerSize:L,upperSize:k}=A;return p.kind==="source"?L/qu:p.kind==="composite"?Ka.number(L/qu,k/qu,M):v},a.ak=ex,a.al=ze,a.am=function(p,u,A,v){const M=u.y-p.y,L=u.x-p.x,k=v.y-A.y,Q=v.x-A.x,q=k*L-Q*M;if(q===0)return null;const te=(Q*(p.y-A.y)-k*(p.x-A.x))/q;return new N(p.x+te*L,p.y+te*M)},a.an=function(p,u){var A=u[0],v=u[1],M=u[2],L=u[3],k=u[4],Q=u[5],q=u[6],te=u[7],ae=u[8],de=u[9],ye=u[10],me=u[11],Ie=u[12],ke=u[13],nt=u[14],ct=u[15],Ot=A*Q-v*k,wt=A*q-M*k,Re=A*te-L*k,it=v*q-M*Q,Et=v*te-L*Q,Zt=M*te-L*q,Br=ae*ke-de*Ie,or=ae*nt-ye*Ie,lr=ae*ct-me*Ie,Lr=de*nt-ye*ke,Tr=de*ct-me*ke,Hr=ye*ct-me*nt,Ar=Ot*Hr-wt*Tr+Re*Lr+it*lr-Et*or+Zt*Br;return Ar?(p[0]=(Q*Hr-q*Tr+te*Lr)*(Ar=1/Ar),p[1]=(M*Tr-v*Hr-L*Lr)*Ar,p[2]=(ke*Zt-nt*Et+ct*it)*Ar,p[3]=(ye*Et-de*Zt-me*it)*Ar,p[4]=(q*lr-k*Hr-te*or)*Ar,p[5]=(A*Hr-M*lr+L*or)*Ar,p[6]=(nt*Re-Ie*Zt-ct*wt)*Ar,p[7]=(ae*Zt-ye*Re+me*wt)*Ar,p[8]=(k*Tr-Q*lr+te*Br)*Ar,p[9]=(v*lr-A*Tr-L*Br)*Ar,p[10]=(Ie*Et-ke*Re+ct*Ot)*Ar,p[11]=(de*Re-ae*Et-me*Ot)*Ar,p[12]=(Q*or-k*Lr-q*Br)*Ar,p[13]=(A*Lr-v*or+M*Br)*Ar,p[14]=(ke*wt-Ie*it-nt*Ot)*Ar,p[15]=(ae*it-de*wt+ye*Ot)*Ar,p):null},a.ao=XT,a.ap=oA,a.aq=st,a.ar=function(p){let u=1/0,A=1/0,v=-1/0,M=-1/0;for(const L of p)u=Math.min(u,L.x),A=Math.min(A,L.y),v=Math.max(v,L.x),M=Math.max(M,L.y);return[u,A,v,M]},a.as=Zi,a.at=Jt,a.au=function(p,u,A,v){let M=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;if(!A[0]&&!A[1])return[0,0];const L=M?v==="map"?-p.bearingInRadians:0:v==="viewport"?p.bearingInRadians:0;if(L){const k=Math.sin(L),Q=Math.cos(L);A=[A[0]*Q-A[1]*k,A[0]*k+A[1]*Q]}return[M?A[0]:Jt(u,A[0],p.zoom),M?A[1]:Jt(u,A[1],p.zoom)]},a.aw=Yv,a.ax=a_,a.ay=Wv,a.az=R,a.b=pr,a.b$=p=>p.type==="line",a.b0=function(p,u,A){const v=new Float64Array(4);return function(M,L,k,Q){var q=.5*Math.PI/180;L*=q,k*=q,Q*=q;var te=Math.sin(L),ae=Math.cos(L),de=Math.sin(k),ye=Math.cos(k),me=Math.sin(Q),Ie=Math.cos(Q);M[0]=te*ye*Ie-ae*de*me,M[1]=ae*de*Ie+te*ye*me,M[2]=ae*ye*me-te*de*Ie,M[3]=ae*ye*Ie+te*de*me}(v,p,u-90,A),v},a.b1=function(p,u,A,v){var M,L,k,Q,q,te=u[0],ae=u[1],de=u[2],ye=u[3],me=A[0],Ie=A[1],ke=A[2],nt=A[3];return(L=te*me+ae*Ie+de*ke+ye*nt)<0&&(L=-L,me=-me,Ie=-Ie,ke=-ke,nt=-nt),1-L>be?(M=Math.acos(L),k=Math.sin(M),Q=Math.sin((1-v)*M)/k,q=Math.sin(v*M)/k):(Q=1-v,q=v),p[0]=Q*te+q*me,p[1]=Q*ae+q*Ie,p[2]=Q*de+q*ke,p[3]=Q*ye+q*nt,p},a.b2=function(p){const u=new Float64Array(9);var A,v,M,L,k,Q,q,te,ae,de,ye,me,Ie,ke,nt,ct,Ot,wt;de=(M=(v=p)[0])*(q=M+M),ye=(L=v[1])*q,Ie=(k=v[2])*q,ke=k*(te=L+L),ct=(Q=v[3])*q,Ot=Q*te,wt=Q*(ae=k+k),(A=u)[0]=1-(me=L*te)-(nt=k*ae),A[3]=ye-wt,A[6]=Ie+Ot,A[1]=ye+wt,A[4]=1-de-nt,A[7]=ke-ct,A[2]=Ie-Ot,A[5]=ke+ct,A[8]=1-de-me;const Re=Mr(-Math.asin(ut(u[2],-1,1)));let it,Et;return Math.hypot(u[5],u[8])<.001?(it=0,Et=-Mr(Math.atan2(u[3],u[4]))):(it=Mr(u[5]===0&&u[8]===0?0:Math.atan2(u[5],u[8])),Et=Mr(u[1]===0&&u[0]===0?0:Math.atan2(u[1],u[0]))),{roll:it,pitch:Re+90,bearing:Et}},a.b3=function(p,u){return p.roll==u.roll&&p.pitch==u.pitch&&p.bearing==u.bearing},a.b4=yn,a.b5=ta,a.b6=Yp,a.b7=Hm,a.b8=NA,a.b9=er,a.bA=qt,a.bB=nr,a.bC=class extends Ma{constructor(p,u){super(p,u),this.current=0}set(p){this.current!==p&&(this.current=p,this.gl.uniform1i(this.location,p))}},a.bD=class extends Ma{constructor(p,u){super(p,u),this.current=Qu}set(p){if(p[12]!==this.current[12]||p[0]!==this.current[0])return this.current=p,void this.gl.uniformMatrix4fv(this.location,!1,p);for(let u=1;u<16;u++)if(p[u]!==this.current[u]){this.current=p,this.gl.uniformMatrix4fv(this.location,!1,p);break}}},a.bE=xc,a.bF=El,a.bG=class extends Ma{constructor(p,u){super(p,u),this.current=[0,0,0]}set(p){p[0]===this.current[0]&&p[1]===this.current[1]&&p[2]===this.current[2]||(this.current=p,this.gl.uniform3f(this.location,p[0],p[1],p[2]))}},a.bH=class extends Ma{constructor(p,u){super(p,u),this.current=[0,0]}set(p){p[0]===this.current[0]&&p[1]===this.current[1]||(this.current=p,this.gl.uniform2f(this.location,p[0],p[1]))}},a.bI=Ue,a.bJ=function(p,u){var A=Math.sin(u),v=Math.cos(u);return p[0]=v,p[1]=A,p[2]=0,p[3]=-A,p[4]=v,p[5]=0,p[6]=0,p[7]=0,p[8]=1,p},a.bK=function(p,u,A){var v=u[0],M=u[1],L=u[2];return p[0]=v*A[0]+M*A[3]+L*A[6],p[1]=v*A[1]+M*A[4]+L*A[7],p[2]=v*A[2]+M*A[5]+L*A[8],p},a.bL=function(p,u,A,v,M,L,k){var Q=1/(u-A),q=1/(v-M),te=1/(L-k);return p[0]=-2*Q,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=-2*q,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[10]=2*te,p[11]=0,p[12]=(u+A)*Q,p[13]=(M+v)*q,p[14]=(k+L)*te,p[15]=1,p},a.bM=class extends Di{},a.bN=$v,a.bO=class extends ns{},a.bP=Pv,a.bQ=function(p){return p<=1?1:Math.pow(2,Math.ceil(Math.log(p)/Math.LN2))},a.bR=hT,a.bS=function(p,u,A){var v=u[0],M=u[1],L=u[2],k=A[3]*v+A[7]*M+A[11]*L+A[15];return p[0]=(A[0]*v+A[4]*M+A[8]*L+A[12])/(k=k||1),p[1]=(A[1]*v+A[5]*M+A[9]*L+A[13])/k,p[2]=(A[2]*v+A[6]*M+A[10]*L+A[14])/k,p},a.bT=class extends jr{},a.bU=class extends m{},a.bV=function(p,u){return p[0]===u[0]&&p[1]===u[1]&&p[2]===u[2]&&p[3]===u[3]&&p[4]===u[4]&&p[5]===u[5]&&p[6]===u[6]&&p[7]===u[7]&&p[8]===u[8]&&p[9]===u[9]&&p[10]===u[10]&&p[11]===u[11]&&p[12]===u[12]&&p[13]===u[13]&&p[14]===u[14]&&p[15]===u[15]},a.bW=function(p,u){var A=p[0],v=p[1],M=p[2],L=p[3],k=p[4],Q=p[5],q=p[6],te=p[7],ae=p[8],de=p[9],ye=p[10],me=p[11],Ie=p[12],ke=p[13],nt=p[14],ct=p[15],Ot=u[0],wt=u[1],Re=u[2],it=u[3],Et=u[4],Zt=u[5],Br=u[6],or=u[7],lr=u[8],Lr=u[9],Tr=u[10],Hr=u[11],Ar=u[12],hn=u[13],Mn=u[14],wn=u[15];return Math.abs(A-Ot)<=be*Math.max(1,Math.abs(A),Math.abs(Ot))&&Math.abs(v-wt)<=be*Math.max(1,Math.abs(v),Math.abs(wt))&&Math.abs(M-Re)<=be*Math.max(1,Math.abs(M),Math.abs(Re))&&Math.abs(L-it)<=be*Math.max(1,Math.abs(L),Math.abs(it))&&Math.abs(k-Et)<=be*Math.max(1,Math.abs(k),Math.abs(Et))&&Math.abs(Q-Zt)<=be*Math.max(1,Math.abs(Q),Math.abs(Zt))&&Math.abs(q-Br)<=be*Math.max(1,Math.abs(q),Math.abs(Br))&&Math.abs(te-or)<=be*Math.max(1,Math.abs(te),Math.abs(or))&&Math.abs(ae-lr)<=be*Math.max(1,Math.abs(ae),Math.abs(lr))&&Math.abs(de-Lr)<=be*Math.max(1,Math.abs(de),Math.abs(Lr))&&Math.abs(ye-Tr)<=be*Math.max(1,Math.abs(ye),Math.abs(Tr))&&Math.abs(me-Hr)<=be*Math.max(1,Math.abs(me),Math.abs(Hr))&&Math.abs(Ie-Ar)<=be*Math.max(1,Math.abs(Ie),Math.abs(Ar))&&Math.abs(ke-hn)<=be*Math.max(1,Math.abs(ke),Math.abs(hn))&&Math.abs(nt-Mn)<=be*Math.max(1,Math.abs(nt),Math.abs(Mn))&&Math.abs(ct-wn)<=be*Math.max(1,Math.abs(ct),Math.abs(wn))},a.bX=function(p,u){return p[0]=u[0],p[1]=u[1],p[2]=u[2],p[3]=u[3],p[4]=u[4],p[5]=u[5],p[6]=u[6],p[7]=u[7],p[8]=u[8],p[9]=u[9],p[10]=u[10],p[11]=u[11],p[12]=u[12],p[13]=u[13],p[14]=u[14],p[15]=u[15],p},a.bY=p=>p.type==="symbol",a.bZ=p=>p.type==="circle",a.b_=p=>p.type==="heatmap",a.ba=Xt,a.bb=eo,a.bc=function(p,u,A,v,M){return er(v,M,ut((p-u)/(A-u),0,1))},a.bd=Kt,a.be=function(){return new Float64Array(4)},a.bf=function(){return new Float64Array(3)},a.bg=function(p,u,A,v){var M=[],L=[];return M[0]=u[0]-A[0],M[1]=u[1]-A[1],M[2]=u[2]-A[2],L[0]=M[0]*Math.cos(v)-M[1]*Math.sin(v),L[1]=M[0]*Math.sin(v)+M[1]*Math.cos(v),L[2]=M[2],p[0]=L[0]+A[0],p[1]=L[1]+A[1],p[2]=L[2]+A[2],p},a.bh=function(p,u,A,v){var M=[],L=[];return M[0]=u[0]-A[0],M[1]=u[1]-A[1],M[2]=u[2]-A[2],L[0]=M[0],L[1]=M[1]*Math.cos(v)-M[2]*Math.sin(v),L[2]=M[1]*Math.sin(v)+M[2]*Math.cos(v),p[0]=L[0]+A[0],p[1]=L[1]+A[1],p[2]=L[2]+A[2],p},a.bi=function(p,u,A,v){var M=[],L=[];return M[0]=u[0]-A[0],M[1]=u[1]-A[1],M[2]=u[2]-A[2],L[0]=M[2]*Math.sin(v)+M[0]*Math.cos(v),L[1]=M[1],L[2]=M[2]*Math.cos(v)-M[0]*Math.sin(v),p[0]=L[0]+A[0],p[1]=L[1]+A[1],p[2]=L[2]+A[2],p},a.bj=function(p,u,A){var v=Math.sin(A),M=Math.cos(A),L=u[0],k=u[1],Q=u[2],q=u[3],te=u[8],ae=u[9],de=u[10],ye=u[11];return u!==p&&(p[4]=u[4],p[5]=u[5],p[6]=u[6],p[7]=u[7],p[12]=u[12],p[13]=u[13],p[14]=u[14],p[15]=u[15]),p[0]=L*M-te*v,p[1]=k*M-ae*v,p[2]=Q*M-de*v,p[3]=q*M-ye*v,p[8]=L*v+te*M,p[9]=k*v+ae*M,p[10]=Q*v+de*M,p[11]=q*v+ye*M,p},a.bk=function(p,u){const A=Kt(p,360),v=Kt(u,360),M=v-A,L=v>A?M-360:M+360;return Math.abs(M)<Math.abs(L)?M:L},a.bl=function(p){return p[0]=0,p[1]=0,p[2]=0,p},a.bm=function(p,u,A,v){const M=Math.sqrt(p*p+u*u),L=Math.sqrt(A*A+v*v);p/=M,u/=M,A/=L,v/=L;const k=Math.acos(p*A+u*v);return-u*A+p*v>0?k:-k},a.bn=function(p,u){return p[0]*u[0]+p[1]*u[1]+p[2]*u[2]+p[3]},a.bo=qy,a.bp=function(p,u){const A=Kt(p,2*Math.PI),v=Kt(u,2*Math.PI);return Math.min(Math.abs(A-v),Math.abs(A-v+2*Math.PI),Math.abs(A-v-2*Math.PI))},a.bq=function(p){return Math.hypot(p[0],p[1],p[2])},a.br=function(){const p={},u=Xe.$version;for(const A in Xe.$root){const v=Xe.$root[A];if(v.required){let M=null;M=A==="version"?u:v.type==="array"?[]:{},M!=null&&(p[A]=M)}}return p},a.bs=Cl,a.bt=ei,a.bu=function(p){p=p.slice();const u=Object.create(null);for(let A=0;A<p.length;A++)u[p[A].id]=p[A];for(let A=0;A<p.length;A++)"ref"in p[A]&&(p[A]=Je(p[A],u[p[A].ref]));return p},a.bv=function(p){if(p.type==="custom")return new jT(p);switch(p.type){case"background":return new ix(p);case"circle":return new xD(p);case"fill":return new vT(p);case"fill-extrusion":return new ET(p);case"heatmap":return new wD(p);case"hillshade":return new Xp(p);case"line":return new DD(p);case"raster":return new Zm(p);case"symbol":return new cg(p)}},a.bw=ar,a.bx=function(p,u){if(!p)return[{command:"setStyle",args:[u]}];let A=[];try{if(!Ve(p.version,u.version))return[{command:"setStyle",args:[u]}];Ve(p.center,u.center)||A.push({command:"setCenter",args:[u.center]}),Ve(p.centerAltitude,u.centerAltitude)||A.push({command:"setCenterAltitude",args:[u.centerAltitude]}),Ve(p.zoom,u.zoom)||A.push({command:"setZoom",args:[u.zoom]}),Ve(p.bearing,u.bearing)||A.push({command:"setBearing",args:[u.bearing]}),Ve(p.pitch,u.pitch)||A.push({command:"setPitch",args:[u.pitch]}),Ve(p.roll,u.roll)||A.push({command:"setRoll",args:[u.roll]}),Ve(p.sprite,u.sprite)||A.push({command:"setSprite",args:[u.sprite]}),Ve(p.glyphs,u.glyphs)||A.push({command:"setGlyphs",args:[u.glyphs]}),Ve(p.transition,u.transition)||A.push({command:"setTransition",args:[u.transition]}),Ve(p.light,u.light)||A.push({command:"setLight",args:[u.light]}),Ve(p.terrain,u.terrain)||A.push({command:"setTerrain",args:[u.terrain]}),Ve(p.sky,u.sky)||A.push({command:"setSky",args:[u.sky]}),Ve(p.projection,u.projection)||A.push({command:"setProjection",args:[u.projection]});const v={},M=[];(function(k,Q,q,te){let ae;for(ae in Q=Q||{},k=k||{})Object.prototype.hasOwnProperty.call(k,ae)&&(Object.prototype.hasOwnProperty.call(Q,ae)||$t(ae,q,te));for(ae in Q)Object.prototype.hasOwnProperty.call(Q,ae)&&(Object.prototype.hasOwnProperty.call(k,ae)?Ve(k[ae],Q[ae])||(k[ae].type==="geojson"&&Q[ae].type==="geojson"&&Pe(k,Q,ae)?bt(q,{command:"setGeoJSONSourceData",args:[ae,Q[ae].data]}):Wt(ae,Q,q,te)):Mt(ae,Q,q))})(p.sources,u.sources,M,v);const L=[];p.layers&&p.layers.forEach(k=>{"source"in k&&v[k.source]?A.push({command:"removeLayer",args:[k.id]}):L.push(k)}),A=A.concat(M),function(k,Q,q){Q=Q||[];const te=(k=k||[]).map(ge),ae=Q.map(ge),de=k.reduce(we,{}),ye=Q.reduce(we,{}),me=te.slice(),Ie=Object.create(null);let ke,nt,ct,Ot,wt;for(let Re=0,it=0;Re<te.length;Re++)ke=te[Re],Object.prototype.hasOwnProperty.call(ye,ke)?it++:(bt(q,{command:"removeLayer",args:[ke]}),me.splice(me.indexOf(ke,it),1));for(let Re=0,it=0;Re<ae.length;Re++)ke=ae[ae.length-1-Re],me[me.length-1-Re]!==ke&&(Object.prototype.hasOwnProperty.call(de,ke)?(bt(q,{command:"removeLayer",args:[ke]}),me.splice(me.lastIndexOf(ke,me.length-it),1)):it++,Ot=me[me.length-Re],bt(q,{command:"addLayer",args:[ye[ke],Ot]}),me.splice(me.length-Re,0,ke),Ie[ke]=!0);for(let Re=0;Re<ae.length;Re++)if(ke=ae[Re],nt=de[ke],ct=ye[ke],!Ie[ke]&&!Ve(nt,ct))if(Ve(nt.source,ct.source)&&Ve(nt["source-layer"],ct["source-layer"])&&Ve(nt.type,ct.type)){for(wt in Ae(nt.layout,ct.layout,q,ke,null,"setLayoutProperty"),Ae(nt.paint,ct.paint,q,ke,null,"setPaintProperty"),Ve(nt.filter,ct.filter)||bt(q,{command:"setFilter",args:[ke,ct.filter]}),Ve(nt.minzoom,ct.minzoom)&&Ve(nt.maxzoom,ct.maxzoom)||bt(q,{command:"setLayerZoomRange",args:[ke,ct.minzoom,ct.maxzoom]}),nt)Object.prototype.hasOwnProperty.call(nt,wt)&&wt!=="layout"&&wt!=="paint"&&wt!=="filter"&&wt!=="metadata"&&wt!=="minzoom"&&wt!=="maxzoom"&&(wt.indexOf("paint.")===0?Ae(nt[wt],ct[wt],q,ke,wt.slice(6),"setPaintProperty"):Ve(nt[wt],ct[wt])||bt(q,{command:"setLayerProperty",args:[ke,wt,ct[wt]]}));for(wt in ct)Object.prototype.hasOwnProperty.call(ct,wt)&&!Object.prototype.hasOwnProperty.call(nt,wt)&&wt!=="layout"&&wt!=="paint"&&wt!=="filter"&&wt!=="metadata"&&wt!=="minzoom"&&wt!=="maxzoom"&&(wt.indexOf("paint.")===0?Ae(nt[wt],ct[wt],q,ke,wt.slice(6),"setPaintProperty"):Ve(nt[wt],ct[wt])||bt(q,{command:"setLayerProperty",args:[ke,wt,ct[wt]]}))}else bt(q,{command:"removeLayer",args:[ke]}),Ot=me[me.lastIndexOf(ke)+1],bt(q,{command:"addLayer",args:[ct,Ot]})}(L,u.layers,A)}catch(v){console.warn("Unable to compute style diff:",v),A=[{command:"setStyle",args:[u]}]}return A},a.by=function(p){const u=[],A=p.id;return A===void 0&&u.push({message:`layers.${A}: missing required property "id"`}),p.render===void 0&&u.push({message:`layers.${A}: missing required method "render"`}),p.renderingMode&&p.renderingMode!=="2d"&&p.renderingMode!=="3d"&&u.push({message:`layers.${A}: property "renderingMode" must be either "2d" or "3d"`}),u},a.bz=function p(u,A){if(Array.isArray(u)){if(!Array.isArray(A)||u.length!==A.length)return!1;for(let v=0;v<u.length;v++)if(!p(u[v],A[v]))return!1;return!0}if(typeof u=="object"&&u!==null&&A!==null){if(typeof A!="object"||Object.keys(u).length!==Object.keys(A).length)return!1;for(const v in u)if(!p(u[v],A[v]))return!1;return!0}return u===A},a.c=Wr,a.c0=p=>p.type==="fill",a.c1=p=>p.type==="fill-extrusion",a.c2=p=>p.type==="hillshade",a.c3=p=>p.type==="raster",a.c4=p=>p.type==="background",a.c5=p=>p.type==="custom",a.c6=Fr,a.c7=function(p,u,A){const v=Ht(u.x-A.x,u.y-A.y),M=Ht(p.x-A.x,p.y-A.y);var L,k;return Mr(Math.atan2(v[0]*M[1]-v[1]*M[0],(L=v)[0]*(k=M)[0]+L[1]*k[1]))},a.c8=$e,a.c9=function(p,u,A){var v=u[0],M=u[1];return p[0]=A[0]*v+A[4]*M+A[12],p[1]=A[1]*v+A[5]*M+A[13],p},a.cA=Tf,a.cB=Nc,a.cC=j,a.ca=function(p,u){const{x:A,y:v}=hg.fromLngLat(u);return!(p<0||p>25||v<0||v>=1||A<0||A>=1)},a.cb=function(p,u){return p[0]=u[0],p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=u[1],p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[10]=u[2],p[11]=0,p[12]=0,p[13]=0,p[14]=0,p[15]=1,p},a.cc=class extends Qr{},a.cd=Ct,a.cf=function(p){return p.message===en},a.cg=$n,a.ch=function(p,u){gn.REGISTERED_PROTOCOLS[p]=u},a.ci=function(p){delete gn.REGISTERED_PROTOCOLS[p]},a.cj=function(p,u){const A={};for(let M=0;M<p.length;M++){const L=u&&u[p[M].id]||zh(p[M]);u&&(u[p[M].id]=L);let k=A[L];k||(k=A[L]=[]),k.push(p[M])}const v=[];for(const M in A)v.push(A[M]);return v},a.ck=un,a.cl=Ym,a.cm=e_,a.cn=NT,a.co=function(p){p.bucket.createArrays(),p.bucket.tilePixelRatio=Vt/(512*p.bucket.overscaling),p.bucket.compareText={},p.bucket.iconsNeedLinear=!1;const u=p.bucket.layers[0],A=u.layout,v=u._unevaluatedLayout._values,M={layoutIconSize:v["icon-size"].possiblyEvaluate(new Z(p.bucket.zoom+1),p.canonical),layoutTextSize:v["text-size"].possiblyEvaluate(new Z(p.bucket.zoom+1),p.canonical),textMaxSize:v["text-size"].possiblyEvaluate(new Z(18))};if(p.bucket.textSizeData.kind==="composite"){const{minZoom:te,maxZoom:ae}=p.bucket.textSizeData;M.compositeTextSizes=[v["text-size"].possiblyEvaluate(new Z(te),p.canonical),v["text-size"].possiblyEvaluate(new Z(ae),p.canonical)]}if(p.bucket.iconSizeData.kind==="composite"){const{minZoom:te,maxZoom:ae}=p.bucket.iconSizeData;M.compositeIconSizes=[v["icon-size"].possiblyEvaluate(new Z(te),p.canonical),v["icon-size"].possiblyEvaluate(new Z(ae),p.canonical)]}const L=A.get("text-line-height")*Zi,k=A.get("text-rotation-alignment")!=="viewport"&&A.get("symbol-placement")!=="point",Q=A.get("text-keep-upright"),q=A.get("text-size");for(const te of p.bucket.features){const ae=A.get("text-font").evaluate(te,{},p.canonical).join(","),de=q.evaluate(te,{},p.canonical),ye=M.layoutTextSize.evaluate(te,{},p.canonical),me=M.layoutIconSize.evaluate(te,{},p.canonical),Ie={horizontal:{},vertical:void 0},ke=te.text;let nt,ct=[0,0];if(ke){const Re=ke.toString(),it=A.get("text-letter-spacing").evaluate(te,{},p.canonical)*Zi,Et=Wn(Re)?it:0,Zt=A.get("text-anchor").evaluate(te,{},p.canonical),Br=Zy(u,te,p.canonical);if(!Br){const Tr=A.get("text-radial-offset").evaluate(te,{},p.canonical);ct=Tr?Jy(Zt,[Tr*Zi,jA]):A.get("text-offset").evaluate(te,{},p.canonical).map(Hr=>Hr*Zi)}let or=k?"center":A.get("text-justify").evaluate(te,{},p.canonical);const lr=A.get("symbol-placement")==="point"?A.get("text-max-width").evaluate(te,{},p.canonical)*Zi:1/0,Lr=()=>{p.bucket.allowVerticalPlacement&&vn(Re)&&(Ie.vertical=Ny(ke,p.glyphMap,p.glyphPositions,p.imagePositions,ae,lr,L,Zt,"left",Et,ct,a.ai.vertical,!0,ye,de))};if(!k&&Br){const Tr=new Set;if(or==="auto")for(let Ar=0;Ar<Br.values.length;Ar+=2)Tr.add(a_(Br.values[Ar]));else Tr.add(or);let Hr=!1;for(const Ar of Tr)if(!Ie.horizontal[Ar])if(Hr)Ie.horizontal[Ar]=Ie.horizontal[0];else{const hn=Ny(ke,p.glyphMap,p.glyphPositions,p.imagePositions,ae,lr,L,"center",Ar,Et,ct,a.ai.horizontal,!1,ye,de);hn&&(Ie.horizontal[Ar]=hn,Hr=hn.positionedLines.length===1)}Lr()}else{or==="auto"&&(or=a_(Zt));const Tr=Ny(ke,p.glyphMap,p.glyphPositions,p.imagePositions,ae,lr,L,Zt,or,Et,ct,a.ai.horizontal,!1,ye,de);Tr&&(Ie.horizontal[or]=Tr),Lr(),vn(Re)&&k&&Q&&(Ie.vertical=Ny(ke,p.glyphMap,p.glyphPositions,p.imagePositions,ae,lr,L,Zt,or,Et,ct,a.ai.vertical,!1,ye,de))}}let Ot=!1;if(te.icon&&te.icon.name){const Re=p.imageMap[te.icon.name];Re&&(nt=VT(p.imagePositions[te.icon.name],A.get("icon-offset").evaluate(te,{},p.canonical),A.get("icon-anchor").evaluate(te,{},p.canonical)),Ot=!!Re.sdf,p.bucket.sdfIcons===void 0?p.bucket.sdfIcons=Ot:p.bucket.sdfIcons!==Ot&&kr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Re.pixelRatio!==p.bucket.pixelRatio||A.get("icon-rotate").constantOr(1)!==0)&&(p.bucket.iconsNeedLinear=!0))}const wt=d(Ie.horizontal)||Ie.vertical;p.bucket.iconsInText=!!wt&&wt.iconsInText,(wt||nt)&&VD(p.bucket,te,Ie,nt,p.imageMap,M,ye,me,ct,Ot,p.canonical,p.subdivisionGranularity)}p.showCollisionBoxes&&p.bucket.generateCollisionDebugBuffers()},a.cp=Qv,a.cq=My,a.cr=Py,a.cs=eg,a.ct=zA,a.cu=class{constructor(p){this._marks={start:[p.url,"start"].join("#"),end:[p.url,"end"].join("#"),measure:p.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let p=performance.getEntriesByName(this._marks.measure);return p.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),p=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),p}},a.cv=function(p,u,A,v,M){return o(this,void 0,void 0,function*(){if(fe())try{return yield Pn(p,u,A,v,M)}catch{}return function(L,k,Q,q,te){const ae=L.width,de=L.height;mn&&mr||(mn=new OffscreenCanvas(ae,de),mr=mn.getContext("2d",{willReadFrequently:!0})),mn.width=ae,mn.height=de,mr.drawImage(L,0,0,ae,de);const ye=mr.getImageData(k,Q,q,te);return mr.clearRect(0,0,ae,de),ye.data}(p,u,A,v,M)})},a.cw=dx,a.cx=h,a.cy=x,a.cz=BT,a.d=p=>o(void 0,void 0,void 0,function*(){if(p.byteLength===0)return createImageBitmap(new ImageData(1,1));const u=new Blob([new Uint8Array(p)],{type:"image/png"});try{return createImageBitmap(u)}catch(A){throw new Error(`Could not load image because of ${A.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),a.e=St,a.f=p=>new Promise((u,A)=>{const v=new Image;v.onload=()=>{u(v),URL.revokeObjectURL(v.src),v.onload=null,window.requestAnimationFrame(()=>{v.src=We})},v.onerror=()=>A(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const M=new Blob([new Uint8Array(p)],{type:"image/png"});v.src=p.byteLength?URL.createObjectURL(M):We}),a.g=Bn,a.h=(p,u)=>br(St(p,{type:"json"}),u),a.i=sn,a.j=Cr,a.k=Ci,a.l=(p,u)=>br(St(p,{type:"arrayBuffer"}),u),a.m=br,a.n=function(p){return new zA(p).readFields(sg,[])},a.o=Dm,a.p=UT,a.q=It,a.r=Gh,a.s=Cn,a.t=xf,a.u=wu,a.v=Xe,a.w=kr,a.x=function(p){let[u,A,v]=p;return A+=90,A*=Math.PI/180,v*=Math.PI/180,{x:u*Math.cos(A)*Math.sin(v),y:u*Math.sin(A)*Math.sin(v),z:u*Math.cos(v)}},a.y=Ka,a.z=Z}),i("worker",["./shared"],function(a){class o{constructor(He){this.keyCache={},He&&this.replace(He)}replace(He){this._layerConfigs={},this._layers={},this.update(He,[])}update(He,Je){for(const bt of He){this._layerConfigs[bt.id]=bt;const Mt=this._layers[bt.id]=a.bv(bt);Mt._featureFilter=a.a4(Mt.filter),this.keyCache[bt.id]&&delete this.keyCache[bt.id]}for(const bt of Je)delete this.keyCache[bt],delete this._layerConfigs[bt],delete this._layers[bt];this.familiesBySource={};const Ve=a.cj(Object.values(this._layerConfigs),this.keyCache);for(const bt of Ve){const Mt=bt.map(we=>this._layers[we.id]),$t=Mt[0];if($t.visibility==="none")continue;const Wt=$t.source||"";let Pe=this.familiesBySource[Wt];Pe||(Pe=this.familiesBySource[Wt]={});const Ae=$t.sourceLayer||"_geojsonTileLayer";let ge=Pe[Ae];ge||(ge=Pe[Ae]=[]),ge.push(Mt)}}}class h{constructor(He){const Je={},Ve=[];for(const Wt in He){const Pe=He[Wt],Ae=Je[Wt]={};for(const ge in Pe){const we=Pe[+ge];if(!we||we.bitmap.width===0||we.bitmap.height===0)continue;const Se={x:0,y:0,w:we.bitmap.width+2,h:we.bitmap.height+2};Ve.push(Se),Ae[ge]={rect:Se,metrics:we.metrics}}}const{w:bt,h:Mt}=a.p(Ve),$t=new a.o({width:bt||1,height:Mt||1});for(const Wt in He){const Pe=He[Wt];for(const Ae in Pe){const ge=Pe[+Ae];if(!ge||ge.bitmap.width===0||ge.bitmap.height===0)continue;const we=Je[Wt][Ae].rect;a.o.copy(ge.bitmap,$t,{x:0,y:0},{x:we.x+1,y:we.y+1},ge.bitmap)}}this.image=$t,this.positions=Je}}a.ck("GlyphAtlas",h);class f{constructor(He){this.tileID=new a.S(He.tileID.overscaledZ,He.tileID.wrap,He.tileID.canonical.z,He.tileID.canonical.x,He.tileID.canonical.y),this.uid=He.uid,this.zoom=He.zoom,this.pixelRatio=He.pixelRatio,this.tileSize=He.tileSize,this.source=He.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=He.showCollisionBoxes,this.collectResourceTiming=!!He.collectResourceTiming,this.returnDependencies=!!He.returnDependencies,this.promoteId=He.promoteId,this.inFlightDependencies=[]}parse(He,Je,Ve,bt,Mt){return a._(this,void 0,void 0,function*(){this.status="parsing",this.data=He,this.collisionBoxArray=new a.a2;const $t=new a.cl(Object.keys(He.layers).sort()),Wt=new a.cm(this.tileID,this.promoteId);Wt.bucketLayerIDs=[];const Pe={},Ae={featureIndex:Wt,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:Ve,subdivisionGranularity:Mt},ge=Je.familiesBySource[this.source];for(const Pr in ge){const Rr=He.layers[Pr];if(!Rr)continue;Rr.version===1&&a.w(`Vector tile source "${this.source}" layer "${Pr}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ln=$t.encode(Pr),Jn=[];for(let _n=0;_n<Rr.length;_n++){const jn=Rr.feature(_n),Gn=Wt.getId(jn,Pr);Jn.push({feature:jn,id:Gn,index:_n,sourceLayerIndex:ln})}for(const _n of ge[Pr]){const jn=_n[0];jn.source!==this.source&&a.w(`layer.source = ${jn.source} does not equal this.source = ${this.source}`),jn.minzoom&&this.zoom<Math.floor(jn.minzoom)||jn.maxzoom&&this.zoom>=jn.maxzoom||jn.visibility!=="none"&&(_(_n,this.zoom,Ve),(Pe[jn.id]=jn.createBucket({index:Wt.bucketLayerIDs.length,layers:_n,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ln,sourceID:this.source})).populate(Jn,Ae,this.tileID.canonical),Wt.bucketLayerIDs.push(_n.map(Gn=>Gn.id)))}}const we=a.bA(Ae.glyphDependencies,Pr=>Object.keys(Pr).map(Number));this.inFlightDependencies.forEach(Pr=>Pr==null?void 0:Pr.abort()),this.inFlightDependencies=[];let Se=Promise.resolve({});if(Object.keys(we).length){const Pr=new AbortController;this.inFlightDependencies.push(Pr),Se=bt.sendAsync({type:"GG",data:{stacks:we,source:this.source,tileID:this.tileID,type:"glyphs"}},Pr)}const ht=Object.keys(Ae.iconDependencies);let At=Promise.resolve({});if(ht.length){const Pr=new AbortController;this.inFlightDependencies.push(Pr),At=bt.sendAsync({type:"GI",data:{icons:ht,source:this.source,tileID:this.tileID,type:"icons"}},Pr)}const _t=Object.keys(Ae.patternDependencies);let dt=Promise.resolve({});if(_t.length){const Pr=new AbortController;this.inFlightDependencies.push(Pr),dt=bt.sendAsync({type:"GI",data:{icons:_t,source:this.source,tileID:this.tileID,type:"patterns"}},Pr)}const[yt,Nt,Rt]=yield Promise.all([Se,At,dt]),dr=new h(yt),zr=new a.cn(Nt,Rt);for(const Pr in Pe){const Rr=Pe[Pr];Rr instanceof a.a3?(_(Rr.layers,this.zoom,Ve),a.co({bucket:Rr,glyphMap:yt,glyphPositions:dr.positions,imageMap:Nt,imagePositions:zr.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:Ae.subdivisionGranularity})):Rr.hasPattern&&(Rr instanceof a.cp||Rr instanceof a.cq||Rr instanceof a.cr)&&(_(Rr.layers,this.zoom,Ve),Rr.addFeatures(Ae,this.tileID.canonical,zr.patternPositions))}return this.status="done",{buckets:Object.values(Pe).filter(Pr=>!Pr.isEmpty()),featureIndex:Wt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:dr.image,imageAtlas:zr,glyphMap:this.returnDependencies?yt:null,iconMap:this.returnDependencies?Nt:null,glyphPositions:this.returnDependencies?dr.positions:null}})}}function _(Xe,He,Je){const Ve=new a.z(He);for(const bt of Xe)bt.recalculate(Ve,Je)}class x{constructor(He,Je,Ve){this.actor=He,this.layerIndex=Je,this.availableImages=Ve,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(He,Je){return a._(this,void 0,void 0,function*(){const Ve=yield a.l(He.request,Je);try{return{vectorTile:new a.cs.VectorTile(new a.ct(Ve.data)),rawData:Ve.data,cacheControl:Ve.cacheControl,expires:Ve.expires}}catch(bt){const Mt=new Uint8Array(Ve.data);let $t=`Unable to parse the tile at ${He.request.url}, `;throw $t+=Mt[0]===31&&Mt[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${bt.message}`,new Error($t)}})}loadTile(He){return a._(this,void 0,void 0,function*(){const Je=He.uid,Ve=!!(He&&He.request&&He.request.collectResourceTiming)&&new a.cu(He.request),bt=new f(He);this.loading[Je]=bt;const Mt=new AbortController;bt.abort=Mt;try{const $t=yield this.loadVectorTile(He,Mt);if(delete this.loading[Je],!$t)return null;const Wt=$t.rawData,Pe={};$t.expires&&(Pe.expires=$t.expires),$t.cacheControl&&(Pe.cacheControl=$t.cacheControl);const Ae={};if(Ve){const we=Ve.finish();we&&(Ae.resourceTiming=JSON.parse(JSON.stringify(we)))}bt.vectorTile=$t.vectorTile;const ge=bt.parse($t.vectorTile,this.layerIndex,this.availableImages,this.actor,He.subdivisionGranularity);this.loaded[Je]=bt,this.fetching[Je]={rawTileData:Wt,cacheControl:Pe,resourceTiming:Ae};try{const we=yield ge;return a.e({rawTileData:Wt.slice(0)},we,Pe,Ae)}finally{delete this.fetching[Je]}}catch($t){throw delete this.loading[Je],bt.status="done",this.loaded[Je]=bt,$t}})}reloadTile(He){return a._(this,void 0,void 0,function*(){const Je=He.uid;if(!this.loaded||!this.loaded[Je])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const Ve=this.loaded[Je];if(Ve.showCollisionBoxes=He.showCollisionBoxes,Ve.status==="parsing"){const bt=yield Ve.parse(Ve.vectorTile,this.layerIndex,this.availableImages,this.actor,He.subdivisionGranularity);let Mt;if(this.fetching[Je]){const{rawTileData:$t,cacheControl:Wt,resourceTiming:Pe}=this.fetching[Je];delete this.fetching[Je],Mt=a.e({rawTileData:$t.slice(0)},bt,Wt,Pe)}else Mt=bt;return Mt}if(Ve.status==="done"&&Ve.vectorTile)return Ve.parse(Ve.vectorTile,this.layerIndex,this.availableImages,this.actor,He.subdivisionGranularity)})}abortTile(He){return a._(this,void 0,void 0,function*(){const Je=this.loading,Ve=He.uid;Je&&Je[Ve]&&Je[Ve].abort&&(Je[Ve].abort.abort(),delete Je[Ve])})}removeTile(He){return a._(this,void 0,void 0,function*(){this.loaded&&this.loaded[He.uid]&&delete this.loaded[He.uid]})}}class T{constructor(){this.loaded={}}loadTile(He){return a._(this,void 0,void 0,function*(){const{uid:Je,encoding:Ve,rawImageData:bt,redFactor:Mt,greenFactor:$t,blueFactor:Wt,baseShift:Pe}=He,Ae=bt.width+2,ge=bt.height+2,we=a.b(bt)?new a.R({width:Ae,height:ge},yield a.cv(bt,-1,-1,Ae,ge)):bt,Se=new a.cw(Je,we,Ve,Mt,$t,Wt,Pe);return this.loaded=this.loaded||{},this.loaded[Je]=Se,Se})}removeTile(He){const Je=this.loaded,Ve=He.uid;Je&&Je[Ve]&&delete Je[Ve]}}var I,N,$=function(){if(N)return I;function Xe(Je,Ve){if(Je.length!==0){He(Je[0],Ve);for(var bt=1;bt<Je.length;bt++)He(Je[bt],!Ve)}}function He(Je,Ve){for(var bt=0,Mt=0,$t=0,Wt=Je.length,Pe=Wt-1;$t<Wt;Pe=$t++){var Ae=(Je[$t][0]-Je[Pe][0])*(Je[Pe][1]+Je[$t][1]),ge=bt+Ae;Mt+=Math.abs(bt)>=Math.abs(Ae)?bt-ge+Ae:Ae-ge+bt,bt=ge}bt+Mt>=0!=!!Ve&&Je.reverse()}return N=1,I=function Je(Ve,bt){var Mt,$t=Ve&&Ve.type;if($t==="FeatureCollection")for(Mt=0;Mt<Ve.features.length;Mt++)Je(Ve.features[Mt],bt);else if($t==="GeometryCollection")for(Mt=0;Mt<Ve.geometries.length;Mt++)Je(Ve.geometries[Mt],bt);else if($t==="Feature")Je(Ve.geometry,bt);else if($t==="Polygon")Xe(Ve.coordinates,bt);else if($t==="MultiPolygon")for(Mt=0;Mt<Ve.coordinates.length;Mt++)Xe(Ve.coordinates[Mt],bt);return Ve}}(),W=a.cx($);const Y=a.cs.VectorTileFeature.prototype.toGeoJSON;class ie{constructor(He){this._feature=He,this.extent=a.X,this.type=He.type,this.properties=He.tags,"id"in He&&!isNaN(He.id)&&(this.id=parseInt(He.id,10))}loadGeometry(){if(this._feature.type===1){const He=[];for(const Je of this._feature.geometry)He.push([new a.P(Je[0],Je[1])]);return He}{const He=[];for(const Je of this._feature.geometry){const Ve=[];for(const bt of Je)Ve.push(new a.P(bt[0],bt[1]));He.push(Ve)}return He}}toGeoJSON(He,Je,Ve){return Y.call(this,He,Je,Ve)}}class ce{constructor(He){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=a.X,this.length=He.length,this._features=He}feature(He){return new ie(this._features[He])}}var fe,ve,be,Qe={exports:{}},Ue=function(){if(be)return Qe.exports;be=1;var Xe=a.cA(),He=function(){if(ve)return fe;ve=1;var ge=a.cy(),we=a.cz().VectorTileFeature;function Se(At,_t){this.options=_t||{},this.features=At,this.length=At.length}function ht(At,_t){this.id=typeof At.id=="number"?At.id:void 0,this.type=At.type,this.rawGeometry=At.type===1?[At.geometry]:At.geometry,this.properties=At.tags,this.extent=_t||4096}return fe=Se,Se.prototype.feature=function(At){return new ht(this.features[At],this.options.extent)},ht.prototype.loadGeometry=function(){var At=this.rawGeometry;this.geometry=[];for(var _t=0;_t<At.length;_t++){for(var dt=At[_t],yt=[],Nt=0;Nt<dt.length;Nt++)yt.push(new ge(dt[Nt][0],dt[Nt][1]));this.geometry.push(yt)}return this.geometry},ht.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var At=this.geometry,_t=1/0,dt=-1/0,yt=1/0,Nt=-1/0,Rt=0;Rt<At.length;Rt++)for(var dr=At[Rt],zr=0;zr<dr.length;zr++){var Pr=dr[zr];_t=Math.min(_t,Pr.x),dt=Math.max(dt,Pr.x),yt=Math.min(yt,Pr.y),Nt=Math.max(Nt,Pr.y)}return[_t,yt,dt,Nt]},ht.prototype.toGeoJSON=we.prototype.toGeoJSON,fe}();function Je(ge){var we=new Xe;return function(Se,ht){for(var At in Se.layers)ht.writeMessage(3,Ve,Se.layers[At])}(ge,we),we.finish()}function Ve(ge,we){var Se;we.writeVarintField(15,ge.version||1),we.writeStringField(1,ge.name||""),we.writeVarintField(5,ge.extent||4096);var ht={keys:[],values:[],keycache:{},valuecache:{}};for(Se=0;Se<ge.length;Se++)ht.feature=ge.feature(Se),we.writeMessage(2,bt,ht);var At=ht.keys;for(Se=0;Se<At.length;Se++)we.writeStringField(3,At[Se]);var _t=ht.values;for(Se=0;Se<_t.length;Se++)we.writeMessage(4,Ae,_t[Se])}function bt(ge,we){var Se=ge.feature;Se.id!==void 0&&we.writeVarintField(1,Se.id),we.writeMessage(2,Mt,ge),we.writeVarintField(3,Se.type),we.writeMessage(4,Pe,Se)}function Mt(ge,we){var Se=ge.feature,ht=ge.keys,At=ge.values,_t=ge.keycache,dt=ge.valuecache;for(var yt in Se.properties){var Nt=Se.properties[yt],Rt=_t[yt];if(Nt!==null){Rt===void 0&&(ht.push(yt),_t[yt]=Rt=ht.length-1),we.writeVarint(Rt);var dr=typeof Nt;dr!=="string"&&dr!=="boolean"&&dr!=="number"&&(Nt=JSON.stringify(Nt));var zr=dr+":"+Nt,Pr=dt[zr];Pr===void 0&&(At.push(Nt),dt[zr]=Pr=At.length-1),we.writeVarint(Pr)}}}function $t(ge,we){return(we<<3)+(7&ge)}function Wt(ge){return ge<<1^ge>>31}function Pe(ge,we){for(var Se=ge.loadGeometry(),ht=ge.type,At=0,_t=0,dt=Se.length,yt=0;yt<dt;yt++){var Nt=Se[yt],Rt=1;ht===1&&(Rt=Nt.length),we.writeVarint($t(1,Rt));for(var dr=ht===3?Nt.length-1:Nt.length,zr=0;zr<dr;zr++){zr===1&&ht!==1&&we.writeVarint($t(2,dr-1));var Pr=Nt[zr].x-At,Rr=Nt[zr].y-_t;we.writeVarint(Wt(Pr)),we.writeVarint(Wt(Rr)),At+=Pr,_t+=Rr}ht===3&&we.writeVarint($t(7,1))}}function Ae(ge,we){var Se=typeof ge;Se==="string"?we.writeStringField(1,ge):Se==="boolean"?we.writeBooleanField(7,ge):Se==="number"&&(ge%1!=0?we.writeDoubleField(3,ge):ge<0?we.writeSVarintField(6,ge):we.writeVarintField(5,ge))}return Qe.exports=Je,Qe.exports.fromVectorTileJs=Je,Qe.exports.fromGeojsonVt=function(ge,we){we=we||{};var Se={};for(var ht in ge)Se[ht]=new He(ge[ht].features,we),Se[ht].name=ht,Se[ht].version=we.version,Se[ht].extent=we.extent;return Je({layers:Se})},Qe.exports.GeoJSONWrapper=He,Qe.exports}(),st=a.cx(Ue);const at={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Xe=>Xe},Le=Math.fround||(ze=new Float32Array(1),Xe=>(ze[0]=+Xe,ze[0]));var ze;const tt=3,Ne=5,Ht=6;class Vt{constructor(He){this.options=Object.assign(Object.create(at),He),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(He){const{log:Je,minZoom:Ve,maxZoom:bt}=this.options;Je&&console.time("total time");const Mt=`prepare ${He.length} points`;Je&&console.time(Mt),this.points=He;const $t=[];for(let Pe=0;Pe<He.length;Pe++){const Ae=He[Pe];if(!Ae.geometry)continue;const[ge,we]=Ae.geometry.coordinates,Se=Le(er(ge)),ht=Le(Xt(we));$t.push(Se,ht,1/0,Pe,-1,1),this.options.reduce&&$t.push(0)}let Wt=this.trees[bt+1]=this._createTree($t);Je&&console.timeEnd(Mt);for(let Pe=bt;Pe>=Ve;Pe--){const Ae=+Date.now();Wt=this.trees[Pe]=this._createTree(this._cluster(Wt,Pe)),Je&&console.log("z%d: %d clusters in %dms",Pe,Wt.numItems,+Date.now()-Ae)}return Je&&console.timeEnd("total time"),this}getClusters(He,Je){let Ve=((He[0]+180)%360+360)%360-180;const bt=Math.max(-90,Math.min(90,He[1]));let Mt=He[2]===180?180:((He[2]+180)%360+360)%360-180;const $t=Math.max(-90,Math.min(90,He[3]));if(He[2]-He[0]>=360)Ve=-180,Mt=180;else if(Ve>Mt){const we=this.getClusters([Ve,bt,180,$t],Je),Se=this.getClusters([-180,bt,Mt,$t],Je);return we.concat(Se)}const Wt=this.trees[this._limitZoom(Je)],Pe=Wt.range(er(Ve),Xt($t),er(Mt),Xt(bt)),Ae=Wt.data,ge=[];for(const we of Pe){const Se=this.stride*we;ge.push(Ae[Se+Ne]>1?Jt(Ae,Se,this.clusterProps):this.points[Ae[Se+tt]])}return ge}getChildren(He){const Je=this._getOriginId(He),Ve=this._getOriginZoom(He),bt="No cluster with the specified id.",Mt=this.trees[Ve];if(!Mt)throw new Error(bt);const $t=Mt.data;if(Je*this.stride>=$t.length)throw new Error(bt);const Wt=this.options.radius/(this.options.extent*Math.pow(2,Ve-1)),Pe=Mt.within($t[Je*this.stride],$t[Je*this.stride+1],Wt),Ae=[];for(const ge of Pe){const we=ge*this.stride;$t[we+4]===He&&Ae.push($t[we+Ne]>1?Jt($t,we,this.clusterProps):this.points[$t[we+tt]])}if(Ae.length===0)throw new Error(bt);return Ae}getLeaves(He,Je,Ve){const bt=[];return this._appendLeaves(bt,He,Je=Je||10,Ve=Ve||0,0),bt}getTile(He,Je,Ve){const bt=this.trees[this._limitZoom(He)],Mt=Math.pow(2,He),{extent:$t,radius:Wt}=this.options,Pe=Wt/$t,Ae=(Ve-Pe)/Mt,ge=(Ve+1+Pe)/Mt,we={features:[]};return this._addTileFeatures(bt.range((Je-Pe)/Mt,Ae,(Je+1+Pe)/Mt,ge),bt.data,Je,Ve,Mt,we),Je===0&&this._addTileFeatures(bt.range(1-Pe/Mt,Ae,1,ge),bt.data,Mt,Ve,Mt,we),Je===Mt-1&&this._addTileFeatures(bt.range(0,Ae,Pe/Mt,ge),bt.data,-1,Ve,Mt,we),we.features.length?we:null}getClusterExpansionZoom(He){let Je=this._getOriginZoom(He)-1;for(;Je<=this.options.maxZoom;){const Ve=this.getChildren(He);if(Je++,Ve.length!==1)break;He=Ve[0].properties.cluster_id}return Je}_appendLeaves(He,Je,Ve,bt,Mt){const $t=this.getChildren(Je);for(const Wt of $t){const Pe=Wt.properties;if(Pe&&Pe.cluster?Mt+Pe.point_count<=bt?Mt+=Pe.point_count:Mt=this._appendLeaves(He,Pe.cluster_id,Ve,bt,Mt):Mt<bt?Mt++:He.push(Wt),He.length===Ve)break}return Mt}_createTree(He){const Je=new a.az(He.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Ve=0;Ve<He.length;Ve+=this.stride)Je.add(He[Ve],He[Ve+1]);return Je.finish(),Je.data=He,Je}_addTileFeatures(He,Je,Ve,bt,Mt,$t){for(const Wt of He){const Pe=Wt*this.stride,Ae=Je[Pe+Ne]>1;let ge,we,Se;if(Ae)ge=Kt(Je,Pe,this.clusterProps),we=Je[Pe],Se=Je[Pe+1];else{const _t=this.points[Je[Pe+tt]];ge=_t.properties;const[dt,yt]=_t.geometry.coordinates;we=er(dt),Se=Xt(yt)}const ht={type:1,geometry:[[Math.round(this.options.extent*(we*Mt-Ve)),Math.round(this.options.extent*(Se*Mt-bt))]],tags:ge};let At;At=Ae||this.options.generateId?Je[Pe+tt]:this.points[Je[Pe+tt]].id,At!==void 0&&(ht.id=At),$t.features.push(ht)}}_limitZoom(He){return Math.max(this.options.minZoom,Math.min(Math.floor(+He),this.options.maxZoom+1))}_cluster(He,Je){const{radius:Ve,extent:bt,reduce:Mt,minPoints:$t}=this.options,Wt=Ve/(bt*Math.pow(2,Je)),Pe=He.data,Ae=[],ge=this.stride;for(let we=0;we<Pe.length;we+=ge){if(Pe[we+2]<=Je)continue;Pe[we+2]=Je;const Se=Pe[we],ht=Pe[we+1],At=He.within(Pe[we],Pe[we+1],Wt),_t=Pe[we+Ne];let dt=_t;for(const yt of At){const Nt=yt*ge;Pe[Nt+2]>Je&&(dt+=Pe[Nt+Ne])}if(dt>_t&&dt>=$t){let yt,Nt=Se*_t,Rt=ht*_t,dr=-1;const zr=((we/ge|0)<<5)+(Je+1)+this.points.length;for(const Pr of At){const Rr=Pr*ge;if(Pe[Rr+2]<=Je)continue;Pe[Rr+2]=Je;const ln=Pe[Rr+Ne];Nt+=Pe[Rr]*ln,Rt+=Pe[Rr+1]*ln,Pe[Rr+4]=zr,Mt&&(yt||(yt=this._map(Pe,we,!0),dr=this.clusterProps.length,this.clusterProps.push(yt)),Mt(yt,this._map(Pe,Rr)))}Pe[we+4]=zr,Ae.push(Nt/dt,Rt/dt,1/0,zr,-1,dt),Mt&&Ae.push(dr)}else{for(let yt=0;yt<ge;yt++)Ae.push(Pe[we+yt]);if(dt>1)for(const yt of At){const Nt=yt*ge;if(!(Pe[Nt+2]<=Je)){Pe[Nt+2]=Je;for(let Rt=0;Rt<ge;Rt++)Ae.push(Pe[Nt+Rt])}}}}return Ae}_getOriginId(He){return He-this.points.length>>5}_getOriginZoom(He){return(He-this.points.length)%32}_map(He,Je,Ve){if(He[Je+Ne]>1){const $t=this.clusterProps[He[Je+Ht]];return Ve?Object.assign({},$t):$t}const bt=this.points[He[Je+tt]].properties,Mt=this.options.map(bt);return Ve&&Mt===bt?Object.assign({},Mt):Mt}}function Jt(Xe,He,Je){return{type:"Feature",id:Xe[He+tt],properties:Kt(Xe,He,Je),geometry:{type:"Point",coordinates:[(Ve=Xe[He],360*(Ve-.5)),Fr(Xe[He+1])]}};var Ve}function Kt(Xe,He,Je){const Ve=Xe[He+Ne],bt=Ve>=1e4?`${Math.round(Ve/1e3)}k`:Ve>=1e3?Math.round(Ve/100)/10+"k":Ve,Mt=Xe[He+Ht],$t=Mt===-1?{}:Object.assign({},Je[Mt]);return Object.assign($t,{cluster:!0,cluster_id:Xe[He+tt],point_count:Ve,point_count_abbreviated:bt})}function er(Xe){return Xe/360+.5}function Xt(Xe){const He=Math.sin(Xe*Math.PI/180),Je=.5-.25*Math.log((1+He)/(1-He))/Math.PI;return Je<0?0:Je>1?1:Je}function Fr(Xe){const He=(180-360*Xe)*Math.PI/180;return 360*Math.atan(Math.exp(He))/Math.PI-90}function $e(Xe,He,Je,Ve){let bt=Ve;const Mt=He+(Je-He>>1);let $t,Wt=Je-He;const Pe=Xe[He],Ae=Xe[He+1],ge=Xe[Je],we=Xe[Je+1];for(let Se=He+3;Se<Je;Se+=3){const ht=ut(Xe[Se],Xe[Se+1],Pe,Ae,ge,we);if(ht>bt)$t=Se,bt=ht;else if(ht===bt){const At=Math.abs(Se-Mt);At<Wt&&($t=Se,Wt=At)}}bt>Ve&&($t-He>3&&$e(Xe,He,$t,Ve),Xe[$t+2]=bt,Je-$t>3&&$e(Xe,$t,Je,Ve))}function ut(Xe,He,Je,Ve,bt,Mt){let $t=bt-Je,Wt=Mt-Ve;if($t!==0||Wt!==0){const Pe=((Xe-Je)*$t+(He-Ve)*Wt)/($t*$t+Wt*Wt);Pe>1?(Je=bt,Ve=Mt):Pe>0&&(Je+=$t*Pe,Ve+=Wt*Pe)}return $t=Xe-Je,Wt=He-Ve,$t*$t+Wt*Wt}function Bt(Xe,He,Je,Ve){const bt={id:Xe??null,type:He,geometry:Je,tags:Ve,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(He==="Point"||He==="MultiPoint"||He==="LineString")St(bt,Je);else if(He==="Polygon")St(bt,Je[0]);else if(He==="MultiLineString")for(const Mt of Je)St(bt,Mt);else if(He==="MultiPolygon")for(const Mt of Je)St(bt,Mt[0]);return bt}function St(Xe,He){for(let Je=0;Je<He.length;Je+=3)Xe.minX=Math.min(Xe.minX,He[Je]),Xe.minY=Math.min(Xe.minY,He[Je+1]),Xe.maxX=Math.max(Xe.maxX,He[Je]),Xe.maxY=Math.max(Xe.maxY,He[Je+1])}function jt(Xe,He,Je,Ve){if(!He.geometry)return;const bt=He.geometry.coordinates;if(bt&&bt.length===0)return;const Mt=He.geometry.type,$t=Math.pow(Je.tolerance/((1<<Je.maxZoom)*Je.extent),2);let Wt=[],Pe=He.id;if(Je.promoteId?Pe=He.properties[Je.promoteId]:Je.generateId&&(Pe=Ve||0),Mt==="Point")qt(bt,Wt);else if(Mt==="MultiPoint")for(const Ae of bt)qt(Ae,Wt);else if(Mt==="LineString")nr(bt,Wt,$t,!1);else if(Mt==="MultiLineString"){if(Je.lineMetrics){for(const Ae of bt)Wt=[],nr(Ae,Wt,$t,!1),Xe.push(Bt(Pe,"LineString",Wt,He.properties));return}ar(bt,Wt,$t,!1)}else if(Mt==="Polygon")ar(bt,Wt,$t,!0);else{if(Mt!=="MultiPolygon"){if(Mt==="GeometryCollection"){for(const Ae of He.geometry.geometries)jt(Xe,{id:Pe,geometry:Ae,properties:He.properties},Je,Ve);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Ae of bt){const ge=[];ar(Ae,ge,$t,!0),Wt.push(ge)}}Xe.push(Bt(Pe,Mt,Wt,He.properties))}function qt(Xe,He){He.push($r(Xe[0]),kr(Xe[1]),0)}function nr(Xe,He,Je,Ve){let bt,Mt,$t=0;for(let Pe=0;Pe<Xe.length;Pe++){const Ae=$r(Xe[Pe][0]),ge=kr(Xe[Pe][1]);He.push(Ae,ge,0),Pe>0&&($t+=Ve?(bt*ge-Ae*Mt)/2:Math.sqrt(Math.pow(Ae-bt,2)+Math.pow(ge-Mt,2))),bt=Ae,Mt=ge}const Wt=He.length-3;He[2]=1,$e(He,0,Wt,Je),He[Wt+2]=1,He.size=Math.abs($t),He.start=0,He.end=He.size}function ar(Xe,He,Je,Ve){for(let bt=0;bt<Xe.length;bt++){const Mt=[];nr(Xe[bt],Mt,Je,Ve),He.push(Mt)}}function $r(Xe){return Xe/360+.5}function kr(Xe){const He=Math.sin(Xe*Math.PI/180),Je=.5-.25*Math.log((1+He)/(1-He))/Math.PI;return Je<0?0:Je>1?1:Je}function Gr(Xe,He,Je,Ve,bt,Mt,$t,Wt){if(Ve/=He,Mt>=(Je/=He)&&$t<Ve)return Xe;if($t<Je||Mt>=Ve)return null;const Pe=[];for(const Ae of Xe){const ge=Ae.geometry;let we=Ae.type;const Se=bt===0?Ae.minX:Ae.minY,ht=bt===0?Ae.maxX:Ae.maxY;if(Se>=Je&&ht<Ve){Pe.push(Ae);continue}if(ht<Je||Se>=Ve)continue;let At=[];if(we==="Point"||we==="MultiPoint")sn(ge,At,Je,Ve,bt);else if(we==="LineString")on(ge,At,Je,Ve,bt,!1,Wt.lineMetrics);else if(we==="MultiLineString")We(ge,At,Je,Ve,bt,!1);else if(we==="Polygon")We(ge,At,Je,Ve,bt,!0);else if(we==="MultiPolygon")for(const _t of ge){const dt=[];We(_t,dt,Je,Ve,bt,!0),dt.length&&At.push(dt)}if(At.length){if(Wt.lineMetrics&&we==="LineString"){for(const _t of At)Pe.push(Bt(Ae.id,we,_t,Ae.tags));continue}we!=="LineString"&&we!=="MultiLineString"||(At.length===1?(we="LineString",At=At[0]):we="MultiLineString"),we!=="Point"&&we!=="MultiPoint"||(we=At.length===3?"Point":"MultiPoint"),Pe.push(Bt(Ae.id,we,At,Ae.tags))}}return Pe.length?Pe:null}function sn(Xe,He,Je,Ve,bt){for(let Mt=0;Mt<Xe.length;Mt+=3){const $t=Xe[Mt+bt];$t>=Je&&$t<=Ve&&Pn(He,Xe[Mt],Xe[Mt+1],Xe[Mt+2])}}function on(Xe,He,Je,Ve,bt,Mt,$t){let Wt=pr(Xe);const Pe=bt===0?mn:mr;let Ae,ge,we=Xe.start;for(let dt=0;dt<Xe.length-3;dt+=3){const yt=Xe[dt],Nt=Xe[dt+1],Rt=Xe[dt+2],dr=Xe[dt+3],zr=Xe[dt+4],Pr=bt===0?yt:Nt,Rr=bt===0?dr:zr;let ln=!1;$t&&(Ae=Math.sqrt(Math.pow(yt-dr,2)+Math.pow(Nt-zr,2))),Pr<Je?Rr>Je&&(ge=Pe(Wt,yt,Nt,dr,zr,Je),$t&&(Wt.start=we+Ae*ge)):Pr>Ve?Rr<Ve&&(ge=Pe(Wt,yt,Nt,dr,zr,Ve),$t&&(Wt.start=we+Ae*ge)):Pn(Wt,yt,Nt,Rt),Rr<Je&&Pr>=Je&&(ge=Pe(Wt,yt,Nt,dr,zr,Je),ln=!0),Rr>Ve&&Pr<=Ve&&(ge=Pe(Wt,yt,Nt,dr,zr,Ve),ln=!0),!Mt&&ln&&($t&&(Wt.end=we+Ae*ge),He.push(Wt),Wt=pr(Xe)),$t&&(we+=Ae)}let Se=Xe.length-3;const ht=Xe[Se],At=Xe[Se+1],_t=bt===0?ht:At;_t>=Je&&_t<=Ve&&Pn(Wt,ht,At,Xe[Se+2]),Se=Wt.length-3,Mt&&Se>=3&&(Wt[Se]!==Wt[0]||Wt[Se+1]!==Wt[1])&&Pn(Wt,Wt[0],Wt[1],Wt[2]),Wt.length&&He.push(Wt)}function pr(Xe){const He=[];return He.size=Xe.size,He.start=Xe.start,He.end=Xe.end,He}function We(Xe,He,Je,Ve,bt,Mt){for(const $t of Xe)on($t,He,Je,Ve,bt,Mt,!1)}function Pn(Xe,He,Je,Ve){Xe.push(He,Je,Ve)}function mn(Xe,He,Je,Ve,bt,Mt){const $t=(Mt-He)/(Ve-He);return Pn(Xe,Mt,Je+(bt-Je)*$t,1),$t}function mr(Xe,He,Je,Ve,bt,Mt){const $t=(Mt-Je)/(bt-Je);return Pn(Xe,He+(Ve-He)*$t,Mt,1),$t}function Mr(Xe,He){const Je=[];for(let Ve=0;Ve<Xe.length;Ve++){const bt=Xe[Ve],Mt=bt.type;let $t;if(Mt==="Point"||Mt==="MultiPoint"||Mt==="LineString")$t=en(bt.geometry,He);else if(Mt==="MultiLineString"||Mt==="Polygon"){$t=[];for(const Wt of bt.geometry)$t.push(en(Wt,He))}else if(Mt==="MultiPolygon"){$t=[];for(const Wt of bt.geometry){const Pe=[];for(const Ae of Wt)Pe.push(en(Ae,He));$t.push(Pe)}}Je.push(Bt(bt.id,Mt,$t,bt.tags))}return Je}function en(Xe,He){const Je=[];Je.size=Xe.size,Xe.start!==void 0&&(Je.start=Xe.start,Je.end=Xe.end);for(let Ve=0;Ve<Xe.length;Ve+=3)Je.push(Xe[Ve]+He,Xe[Ve+1],Xe[Ve+2]);return Je}function Wr(Xe,He){if(Xe.transformed)return Xe;const Je=1<<Xe.z,Ve=Xe.x,bt=Xe.y;for(const Mt of Xe.features){const $t=Mt.geometry,Wt=Mt.type;if(Mt.geometry=[],Wt===1)for(let Pe=0;Pe<$t.length;Pe+=2)Mt.geometry.push(gn($t[Pe],$t[Pe+1],He,Je,Ve,bt));else for(let Pe=0;Pe<$t.length;Pe++){const Ae=[];for(let ge=0;ge<$t[Pe].length;ge+=2)Ae.push(gn($t[Pe][ge],$t[Pe][ge+1],He,Je,Ve,bt));Mt.geometry.push(Ae)}}return Xe.transformed=!0,Xe}function gn(Xe,He,Je,Ve,bt,Mt){return[Math.round(Je*(Xe*Ve-bt)),Math.round(Je*(He*Ve-Mt))]}function Bn(Xe,He,Je,Ve,bt){const Mt=He===bt.maxZoom?0:bt.tolerance/((1<<He)*bt.extent),$t={features:[],numPoints:0,numSimplified:0,numFeatures:Xe.length,source:null,x:Je,y:Ve,z:He,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Wt of Xe)Fn($t,Wt,Mt,bt);return $t}function Fn(Xe,He,Je,Ve){const bt=He.geometry,Mt=He.type,$t=[];if(Xe.minX=Math.min(Xe.minX,He.minX),Xe.minY=Math.min(Xe.minY,He.minY),Xe.maxX=Math.max(Xe.maxX,He.maxX),Xe.maxY=Math.max(Xe.maxY,He.maxY),Mt==="Point"||Mt==="MultiPoint")for(let Wt=0;Wt<bt.length;Wt+=3)$t.push(bt[Wt],bt[Wt+1]),Xe.numPoints++,Xe.numSimplified++;else if(Mt==="LineString")$n($t,bt,Xe,Je,!1,!1);else if(Mt==="MultiLineString"||Mt==="Polygon")for(let Wt=0;Wt<bt.length;Wt++)$n($t,bt[Wt],Xe,Je,Mt==="Polygon",Wt===0);else if(Mt==="MultiPolygon")for(let Wt=0;Wt<bt.length;Wt++){const Pe=bt[Wt];for(let Ae=0;Ae<Pe.length;Ae++)$n($t,Pe[Ae],Xe,Je,!0,Ae===0)}if($t.length){let Wt=He.tags||null;if(Mt==="LineString"&&Ve.lineMetrics){Wt={};for(const Ae in He.tags)Wt[Ae]=He.tags[Ae];Wt.mapbox_clip_start=bt.start/bt.size,Wt.mapbox_clip_end=bt.end/bt.size}const Pe={geometry:$t,type:Mt==="Polygon"||Mt==="MultiPolygon"?3:Mt==="LineString"||Mt==="MultiLineString"?2:1,tags:Wt};He.id!==null&&(Pe.id=He.id),Xe.features.push(Pe)}}function $n(Xe,He,Je,Ve,bt,Mt){const $t=Ve*Ve;if(Ve>0&&He.size<(bt?$t:Ve))return void(Je.numPoints+=He.length/3);const Wt=[];for(let Pe=0;Pe<He.length;Pe+=3)(Ve===0||He[Pe+2]>$t)&&(Je.numSimplified++,Wt.push(He[Pe],He[Pe+1])),Je.numPoints++;bt&&function(Pe,Ae){let ge=0;for(let we=0,Se=Pe.length,ht=Se-2;we<Se;ht=we,we+=2)ge+=(Pe[we]-Pe[ht])*(Pe[we+1]+Pe[ht+1]);if(ge>0===Ae)for(let we=0,Se=Pe.length;we<Se/2;we+=2){const ht=Pe[we],At=Pe[we+1];Pe[we]=Pe[Se-2-we],Pe[we+1]=Pe[Se-1-we],Pe[Se-2-we]=ht,Pe[Se-1-we]=At}}(Wt,Mt),Xe.push(Wt)}const ei={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class br{constructor(He,Je){const Ve=(Je=this.options=function(Mt,$t){for(const Wt in $t)Mt[Wt]=$t[Wt];return Mt}(Object.create(ei),Je)).debug;if(Ve&&console.time("preprocess data"),Je.maxZoom<0||Je.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Je.promoteId&&Je.generateId)throw new Error("promoteId and generateId cannot be used together.");let bt=function(Mt,$t){const Wt=[];if(Mt.type==="FeatureCollection")for(let Pe=0;Pe<Mt.features.length;Pe++)jt(Wt,Mt.features[Pe],$t,Pe);else jt(Wt,Mt.type==="Feature"?Mt:{geometry:Mt},$t);return Wt}(He,Je);this.tiles={},this.tileCoords=[],Ve&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Je.indexMaxZoom,Je.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),bt=function(Mt,$t){const Wt=$t.buffer/$t.extent;let Pe=Mt;const Ae=Gr(Mt,1,-1-Wt,Wt,0,-1,2,$t),ge=Gr(Mt,1,1-Wt,2+Wt,0,-1,2,$t);return(Ae||ge)&&(Pe=Gr(Mt,1,-Wt,1+Wt,0,-1,2,$t)||[],Ae&&(Pe=Mr(Ae,1).concat(Pe)),ge&&(Pe=Pe.concat(Mr(ge,-1)))),Pe}(bt,Je),bt.length&&this.splitTile(bt,0,0,0),Ve&&(bt.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(He,Je,Ve,bt,Mt,$t,Wt){const Pe=[He,Je,Ve,bt],Ae=this.options,ge=Ae.debug;for(;Pe.length;){bt=Pe.pop(),Ve=Pe.pop(),Je=Pe.pop(),He=Pe.pop();const we=1<<Je,Se=Cn(Je,Ve,bt);let ht=this.tiles[Se];if(!ht&&(ge>1&&console.time("creation"),ht=this.tiles[Se]=Bn(He,Je,Ve,bt,Ae),this.tileCoords.push({z:Je,x:Ve,y:bt}),ge)){ge>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Je,Ve,bt,ht.numFeatures,ht.numPoints,ht.numSimplified),console.timeEnd("creation"));const ln=`z${Je}`;this.stats[ln]=(this.stats[ln]||0)+1,this.total++}if(ht.source=He,Mt==null){if(Je===Ae.indexMaxZoom||ht.numPoints<=Ae.indexMaxPoints)continue}else{if(Je===Ae.maxZoom||Je===Mt)continue;if(Mt!=null){const ln=Mt-Je;if(Ve!==$t>>ln||bt!==Wt>>ln)continue}}if(ht.source=null,He.length===0)continue;ge>1&&console.time("clipping");const At=.5*Ae.buffer/Ae.extent,_t=.5-At,dt=.5+At,yt=1+At;let Nt=null,Rt=null,dr=null,zr=null,Pr=Gr(He,we,Ve-At,Ve+dt,0,ht.minX,ht.maxX,Ae),Rr=Gr(He,we,Ve+_t,Ve+yt,0,ht.minX,ht.maxX,Ae);He=null,Pr&&(Nt=Gr(Pr,we,bt-At,bt+dt,1,ht.minY,ht.maxY,Ae),Rt=Gr(Pr,we,bt+_t,bt+yt,1,ht.minY,ht.maxY,Ae),Pr=null),Rr&&(dr=Gr(Rr,we,bt-At,bt+dt,1,ht.minY,ht.maxY,Ae),zr=Gr(Rr,we,bt+_t,bt+yt,1,ht.minY,ht.maxY,Ae),Rr=null),ge>1&&console.timeEnd("clipping"),Pe.push(Nt||[],Je+1,2*Ve,2*bt),Pe.push(Rt||[],Je+1,2*Ve,2*bt+1),Pe.push(dr||[],Je+1,2*Ve+1,2*bt),Pe.push(zr||[],Je+1,2*Ve+1,2*bt+1)}}getTile(He,Je,Ve){He=+He,Je=+Je,Ve=+Ve;const bt=this.options,{extent:Mt,debug:$t}=bt;if(He<0||He>24)return null;const Wt=1<<He,Pe=Cn(He,Je=Je+Wt&Wt-1,Ve);if(this.tiles[Pe])return Wr(this.tiles[Pe],Mt);$t>1&&console.log("drilling down to z%d-%d-%d",He,Je,Ve);let Ae,ge=He,we=Je,Se=Ve;for(;!Ae&&ge>0;)ge--,we>>=1,Se>>=1,Ae=this.tiles[Cn(ge,we,Se)];return Ae&&Ae.source?($t>1&&(console.log("found parent tile z%d-%d-%d",ge,we,Se),console.time("drilling down")),this.splitTile(Ae.source,ge,we,Se,He,Je,Ve),$t>1&&console.timeEnd("drilling down"),this.tiles[Pe]?Wr(this.tiles[Pe],Mt):null):null}}function Cn(Xe,He,Je){return 32*((1<<Xe)*Je+He)+Xe}function Rn(Xe,He){return He?Xe.properties[He]:Xe.id}function nn(Xe,He){if(Xe==null)return!0;if(Xe.type==="Feature")return Rn(Xe,He)!=null;if(Xe.type==="FeatureCollection"){const Je=new Set;for(const Ve of Xe.features){const bt=Rn(Ve,He);if(bt==null||Je.has(bt))return!1;Je.add(bt)}return!0}return!1}function Ci(Xe,He){const Je=new Map;if(Xe!=null)if(Xe.type==="Feature")Je.set(Rn(Xe,He),Xe);else for(const Ve of Xe.features)Je.set(Rn(Ve,He),Ve);return Je}class Cr extends x{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(He,Je){return a._(this,void 0,void 0,function*(){const Ve=He.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const bt=this._geoJSONIndex.getTile(Ve.z,Ve.x,Ve.y);if(!bt)return null;const Mt=new ce(bt.features);let $t=st(Mt);return $t.byteOffset===0&&$t.byteLength===$t.buffer.byteLength||($t=new Uint8Array($t)),{vectorTile:Mt,rawData:$t.buffer}})}loadData(He){return a._(this,void 0,void 0,function*(){var Je;(Je=this._pendingRequest)===null||Je===void 0||Je.abort();const Ve=!!(He&&He.request&&He.request.collectResourceTiming)&&new a.cu(He.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(He,this._pendingRequest),this._geoJSONIndex=He.cluster?new Vt(function($t){let{superclusterOptions:Wt,clusterProperties:Pe}=$t;if(!Pe||!Wt)return Wt;const Ae={},ge={},we={accumulated:null,zoom:0},Se={properties:null},ht=Object.keys(Pe);for(const At of ht){const[_t,dt]=Pe[At],yt=a.cB(dt),Nt=a.cB(typeof _t=="string"?[_t,["accumulated"],["get",At]]:_t);Ae[At]=yt.value,ge[At]=Nt.value}return Wt.map=At=>{Se.properties=At;const _t={};for(const dt of ht)_t[dt]=Ae[dt].evaluate(we,Se);return _t},Wt.reduce=(At,_t)=>{Se.properties=_t;for(const dt of ht)we.accumulated=At[dt],At[dt]=ge[dt].evaluate(we,Se)},Wt}(He)).load((yield this._pendingData).features):(bt=yield this._pendingData,new br(bt,He.geojsonVtOptions)),this.loaded={};const Mt={};if(Ve){const $t=Ve.finish();$t&&(Mt.resourceTiming={},Mt.resourceTiming[He.source]=JSON.parse(JSON.stringify($t)))}return Mt}catch(Mt){if(delete this._pendingRequest,a.cf(Mt))return{abandoned:!0};throw Mt}var bt})}getData(){return a._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(He){const Je=this.loaded;return Je&&Je[He.uid]?super.reloadTile(He):this.loadTile(He)}loadAndProcessGeoJSON(He,Je){return a._(this,void 0,void 0,function*(){let Ve=yield this.loadGeoJSON(He,Je);if(delete this._pendingRequest,typeof Ve!="object")throw new Error(`Input data given to '${He.source}' is not a valid GeoJSON object.`);if(W(Ve,!0),He.filter){const bt=a.cB(He.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(bt.result==="error")throw new Error(bt.value.map($t=>`${$t.key}: ${$t.message}`).join(", "));Ve={type:"FeatureCollection",features:Ve.features.filter($t=>bt.value.evaluate({zoom:0},$t))}}return Ve})}loadGeoJSON(He,Je){return a._(this,void 0,void 0,function*(){const{promoteId:Ve}=He;if(He.request){const bt=yield a.h(He.request,Je);return this._dataUpdateable=nn(bt.data,Ve)?Ci(bt.data,Ve):void 0,bt.data}if(typeof He.data=="string")try{const bt=JSON.parse(He.data);return this._dataUpdateable=nn(bt,Ve)?Ci(bt,Ve):void 0,bt}catch{throw new Error(`Input data given to '${He.source}' is not a valid GeoJSON object.`)}if(!He.dataDiff)throw new Error(`Input data given to '${He.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${He.source}`);return function(bt,Mt,$t){var Wt,Pe,Ae,ge;if(Mt.removeAll&&bt.clear(),Mt.remove)for(const we of Mt.remove)bt.delete(we);if(Mt.add)for(const we of Mt.add){const Se=Rn(we,$t);Se!=null&&bt.set(Se,we)}if(Mt.update)for(const we of Mt.update){let Se=bt.get(we.id);if(Se==null)continue;const ht=!we.removeAllProperties&&(((Wt=we.removeProperties)===null||Wt===void 0?void 0:Wt.length)>0||((Pe=we.addOrUpdateProperties)===null||Pe===void 0?void 0:Pe.length)>0);if((we.newGeometry||we.removeAllProperties||ht)&&(Se=Object.assign({},Se),bt.set(we.id,Se),ht&&(Se.properties=Object.assign({},Se.properties))),we.newGeometry&&(Se.geometry=we.newGeometry),we.removeAllProperties)Se.properties={};else if(((Ae=we.removeProperties)===null||Ae===void 0?void 0:Ae.length)>0)for(const At of we.removeProperties)Object.prototype.hasOwnProperty.call(Se.properties,At)&&delete Se.properties[At];if(((ge=we.addOrUpdateProperties)===null||ge===void 0?void 0:ge.length)>0)for(const{key:At,value:_t}of we.addOrUpdateProperties)Se.properties[At]=_t}}(this._dataUpdateable,He.dataDiff,Ve),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(He){return a._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(He){return this._geoJSONIndex.getClusterExpansionZoom(He.clusterId)}getClusterChildren(He){return this._geoJSONIndex.getChildren(He.clusterId)}getClusterLeaves(He){return this._geoJSONIndex.getLeaves(He.clusterId,He.limit,He.offset)}}class Tn{constructor(He){this.self=He,this.actor=new a.F(He),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(Je,Ve)=>{if(this.externalWorkerSourceTypes[Je])throw new Error(`Worker source with name "${Je}" already registered.`);this.externalWorkerSourceTypes[Je]=Ve},this.self.addProtocol=a.ch,this.self.removeProtocol=a.ci,this.self.registerRTLTextPlugin=Je=>{a.cC.setMethods(Je)},this.actor.registerMessageHandler("LDT",(Je,Ve)=>this._getDEMWorkerSource(Je,Ve.source).loadTile(Ve)),this.actor.registerMessageHandler("RDT",(Je,Ve)=>a._(this,void 0,void 0,function*(){this._getDEMWorkerSource(Je,Ve.source).removeTile(Ve)})),this.actor.registerMessageHandler("GCEZ",(Je,Ve)=>a._(this,void 0,void 0,function*(){return this._getWorkerSource(Je,Ve.type,Ve.source).getClusterExpansionZoom(Ve)})),this.actor.registerMessageHandler("GCC",(Je,Ve)=>a._(this,void 0,void 0,function*(){return this._getWorkerSource(Je,Ve.type,Ve.source).getClusterChildren(Ve)})),this.actor.registerMessageHandler("GCL",(Je,Ve)=>a._(this,void 0,void 0,function*(){return this._getWorkerSource(Je,Ve.type,Ve.source).getClusterLeaves(Ve)})),this.actor.registerMessageHandler("LD",(Je,Ve)=>this._getWorkerSource(Je,Ve.type,Ve.source).loadData(Ve)),this.actor.registerMessageHandler("GD",(Je,Ve)=>this._getWorkerSource(Je,Ve.type,Ve.source).getData()),this.actor.registerMessageHandler("LT",(Je,Ve)=>this._getWorkerSource(Je,Ve.type,Ve.source).loadTile(Ve)),this.actor.registerMessageHandler("RT",(Je,Ve)=>this._getWorkerSource(Je,Ve.type,Ve.source).reloadTile(Ve)),this.actor.registerMessageHandler("AT",(Je,Ve)=>this._getWorkerSource(Je,Ve.type,Ve.source).abortTile(Ve)),this.actor.registerMessageHandler("RMT",(Je,Ve)=>this._getWorkerSource(Je,Ve.type,Ve.source).removeTile(Ve)),this.actor.registerMessageHandler("RS",(Je,Ve)=>a._(this,void 0,void 0,function*(){if(!this.workerSources[Je]||!this.workerSources[Je][Ve.type]||!this.workerSources[Je][Ve.type][Ve.source])return;const bt=this.workerSources[Je][Ve.type][Ve.source];delete this.workerSources[Je][Ve.type][Ve.source],bt.removeSource!==void 0&&bt.removeSource(Ve)})),this.actor.registerMessageHandler("RM",Je=>a._(this,void 0,void 0,function*(){delete this.layerIndexes[Je],delete this.availableImages[Je],delete this.workerSources[Je],delete this.demWorkerSources[Je]})),this.actor.registerMessageHandler("SR",(Je,Ve)=>a._(this,void 0,void 0,function*(){this.referrer=Ve})),this.actor.registerMessageHandler("SRPS",(Je,Ve)=>this._syncRTLPluginState(Je,Ve)),this.actor.registerMessageHandler("IS",(Je,Ve)=>a._(this,void 0,void 0,function*(){this.self.importScripts(Ve)})),this.actor.registerMessageHandler("SI",(Je,Ve)=>this._setImages(Je,Ve)),this.actor.registerMessageHandler("UL",(Je,Ve)=>a._(this,void 0,void 0,function*(){this._getLayerIndex(Je).update(Ve.layers,Ve.removedIds)})),this.actor.registerMessageHandler("SL",(Je,Ve)=>a._(this,void 0,void 0,function*(){this._getLayerIndex(Je).replace(Ve)}))}_setImages(He,Je){return a._(this,void 0,void 0,function*(){this.availableImages[He]=Je;for(const Ve in this.workerSources[He]){const bt=this.workerSources[He][Ve];for(const Mt in bt)bt[Mt].availableImages=Je}})}_syncRTLPluginState(He,Je){return a._(this,void 0,void 0,function*(){return yield a.cC.syncState(Je,this.self.importScripts)})}_getAvailableImages(He){let Je=this.availableImages[He];return Je||(Je=[]),Je}_getLayerIndex(He){let Je=this.layerIndexes[He];return Je||(Je=this.layerIndexes[He]=new o),Je}_getWorkerSource(He,Je,Ve){if(this.workerSources[He]||(this.workerSources[He]={}),this.workerSources[He][Je]||(this.workerSources[He][Je]={}),!this.workerSources[He][Je][Ve]){const bt={sendAsync:(Mt,$t)=>(Mt.targetMapId=He,this.actor.sendAsync(Mt,$t))};switch(Je){case"vector":this.workerSources[He][Je][Ve]=new x(bt,this._getLayerIndex(He),this._getAvailableImages(He));break;case"geojson":this.workerSources[He][Je][Ve]=new Cr(bt,this._getLayerIndex(He),this._getAvailableImages(He));break;default:this.workerSources[He][Je][Ve]=new this.externalWorkerSourceTypes[Je](bt,this._getLayerIndex(He),this._getAvailableImages(He))}}return this.workerSources[He][Je][Ve]}_getDEMWorkerSource(He,Je){return this.demWorkerSources[He]||(this.demWorkerSources[He]={}),this.demWorkerSources[He][Je]||(this.demWorkerSources[He][Je]=new T),this.demWorkerSources[He][Je]}}return a.i(self)&&(self.worker=new Tn(self)),Tn}),i("index",["exports","./shared"],function(a,o){var h="5.1.0";function f(){var D=new o.A(4);return o.A!=Float32Array&&(D[1]=0,D[2]=0),D[0]=1,D[3]=1,D}let _,x;const T={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(D,l,m){const w=requestAnimationFrame(l);D.signal.addEventListener("abort",()=>{cancelAnimationFrame(w),m(o.c())})},frameAsync(D){return new Promise((l,m)=>{this.frame(D,l,m)})},getImageData(D){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return this.getImageCanvasContext(D).getImageData(-l,-l,D.width+2*l,D.height+2*l)},getImageCanvasContext(D){const l=window.document.createElement("canvas"),m=l.getContext("2d",{willReadFrequently:!0});if(!m)throw new Error("failed to create canvas 2d context");return l.width=D.width,l.height=D.height,m.drawImage(D,0,0,D.width,D.height),m},resolveURL:D=>(_||(_=document.createElement("a")),_.href=D,_.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(x==null&&(x=matchMedia("(prefers-reduced-motion: reduce)")),x.matches)}};class I{static testProp(l){if(!I.docStyle)return l[0];for(let m=0;m<l.length;m++)if(l[m]in I.docStyle)return l[m];return l[0]}static create(l,m,w){const P=window.document.createElement(l);return m!==void 0&&(P.className=m),w&&w.appendChild(P),P}static createNS(l,m){return window.document.createElementNS(l,m)}static disableDrag(){I.docStyle&&I.selectProp&&(I.userSelect=I.docStyle[I.selectProp],I.docStyle[I.selectProp]="none")}static enableDrag(){I.docStyle&&I.selectProp&&(I.docStyle[I.selectProp]=I.userSelect)}static setTransform(l,m){l.style[I.transformProp]=m}static addEventListener(l,m,w){let P=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};l.addEventListener(m,w,"passive"in P?P:P.capture)}static removeEventListener(l,m,w){let P=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};l.removeEventListener(m,w,"passive"in P?P:P.capture)}static suppressClickInternal(l){l.preventDefault(),l.stopPropagation(),window.removeEventListener("click",I.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",I.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",I.suppressClickInternal,!0)},0)}static getScale(l){const m=l.getBoundingClientRect();return{x:m.width/l.offsetWidth||1,y:m.height/l.offsetHeight||1,boundingClientRect:m}}static getPoint(l,m,w){const P=m.boundingClientRect;return new o.P((w.clientX-P.left)/m.x-l.clientLeft,(w.clientY-P.top)/m.y-l.clientTop)}static mousePos(l,m){const w=I.getScale(l);return I.getPoint(l,w,m)}static touchPos(l,m){const w=[],P=I.getScale(l);for(let O=0;O<m.length;O++)w.push(I.getPoint(l,P,m[O]));return w}static mouseButton(l){return l.button}static remove(l){l.parentNode&&l.parentNode.removeChild(l)}static sanitize(l){const m=new DOMParser().parseFromString(l,"text/html").body||document.createElement("body"),w=m.querySelectorAll("script");for(const P of w)P.remove();return I.clean(m),m.innerHTML}static isPossiblyDangerous(l,m){const w=m.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(l)||!w.includes("javascript:")&&!w.includes("data:"))||!!l.startsWith("on")||void 0}static clean(l){const m=l.children;for(const w of m)I.removeAttributes(w),I.clean(w)}static removeAttributes(l){for(const{name:m,value:w}of l.attributes)I.isPossiblyDangerous(m,w)&&l.removeAttribute(m)}}I.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,I.selectProp=I.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),I.transformProp=I.testProp(["transform","WebkitTransform"]);const N={supported:!1,testSupport:function(D){!Y&&W&&(ie?ce(D):$=D)}};let $,W,Y=!1,ie=!1;function ce(D){const l=D.createTexture();D.bindTexture(D.TEXTURE_2D,l);try{if(D.texImage2D(D.TEXTURE_2D,0,D.RGBA,D.RGBA,D.UNSIGNED_BYTE,W),D.isContextLost())return;N.supported=!0}catch{}D.deleteTexture(l),Y=!0}var fe;typeof document<"u"&&(W=document.createElement("img"),W.onload=()=>{$&&ce($),$=null,ie=!0},W.onerror=()=>{Y=!0,$=null},W.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(D){let l,m,w,P;D.resetRequestQueue=()=>{l=[],m=0,w=0,P={}},D.addThrottleControl=re=>{const oe=w++;return P[oe]=re,oe},D.removeThrottleControl=re=>{delete P[re],G()},D.getImage=function(re,oe){let pe=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return new Promise((Ce,Me)=>{N.supported&&(re.headers||(re.headers={}),re.headers.accept="image/webp,*/*"),o.e(re,{type:"image"}),l.push({abortController:oe,requestParameters:re,supportImageRefresh:pe,state:"queued",onError:Ke=>{Me(Ke)},onSuccess:Ke=>{Ce(Ke)}}),G()})};const O=re=>o._(this,void 0,void 0,function*(){re.state="running";const{requestParameters:oe,supportImageRefresh:pe,onError:Ce,onSuccess:Me,abortController:Ke}=re,Ye=pe===!1&&!o.i(self)&&!o.g(oe.url)&&(!oe.headers||Object.keys(oe.headers).reduce((mt,xt)=>mt&&xt==="accept",!0));m++;const gt=Ye?J(oe,Ke):o.m(oe,Ke);try{const mt=yield gt;delete re.abortController,re.state="completed",mt.data instanceof HTMLImageElement||o.b(mt.data)?Me(mt):mt.data&&Me({data:yield(ft=mt.data,typeof createImageBitmap=="function"?o.d(ft):o.f(ft)),cacheControl:mt.cacheControl,expires:mt.expires})}catch(mt){delete re.abortController,Ce(mt)}finally{m--,G()}var ft}),G=()=>{const re=(()=>{for(const oe of Object.keys(P))if(P[oe]())return!0;return!1})()?o.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:o.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let oe=m;oe<re&&l.length>0;oe++){const pe=l.shift();pe.abortController.signal.aborted?oe--:O(pe)}},J=(re,oe)=>new Promise((pe,Ce)=>{const Me=new Image,Ke=re.url,Ye=re.credentials;Ye&&Ye==="include"?Me.crossOrigin="use-credentials":(Ye&&Ye==="same-origin"||!o.s(Ke))&&(Me.crossOrigin="anonymous"),oe.signal.addEventListener("abort",()=>{Me.src="",Ce(o.c())}),Me.fetchPriority="high",Me.onload=()=>{Me.onerror=Me.onload=null,pe({data:Me})},Me.onerror=()=>{Me.onerror=Me.onload=null,oe.signal.aborted||Ce(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},Me.src=Ke})}(fe||(fe={})),fe.resetRequestQueue();class ve{constructor(l){this._transformRequestFn=l}transformRequest(l,m){return this._transformRequestFn&&this._transformRequestFn(l,m)||{url:l}}setTransformRequest(l){this._transformRequestFn=l}}function be(D){const l=[];if(typeof D=="string")l.push({id:"default",url:D});else if(D&&D.length>0){const m=[];for(const{id:w,url:P}of D){const O=`${w}${P}`;m.indexOf(O)===-1&&(m.push(O),l.push({id:w,url:P}))}}return l}function Qe(D,l,m){try{const w=new URL(D);return w.pathname+=`${l}${m}`,w.toString()}catch{throw new Error(`Invalid sprite URL "${D}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}class Ue{constructor(l,m,w,P){this.context=l,this.format=w,this.texture=l.gl.createTexture(),this.update(m,P)}update(l,m,w){const{width:P,height:O}=l,G=!(this.size&&this.size[0]===P&&this.size[1]===O||w),{context:J}=this,{gl:re}=J;if(this.useMipmap=!!(m&&m.useMipmap),re.bindTexture(re.TEXTURE_2D,this.texture),J.pixelStoreUnpackFlipY.set(!1),J.pixelStoreUnpack.set(1),J.pixelStoreUnpackPremultiplyAlpha.set(this.format===re.RGBA&&(!m||m.premultiply!==!1)),G)this.size=[P,O],l instanceof HTMLImageElement||l instanceof HTMLCanvasElement||l instanceof HTMLVideoElement||l instanceof ImageData||o.b(l)?re.texImage2D(re.TEXTURE_2D,0,this.format,this.format,re.UNSIGNED_BYTE,l):re.texImage2D(re.TEXTURE_2D,0,this.format,P,O,0,this.format,re.UNSIGNED_BYTE,l.data);else{const{x:oe,y:pe}=w||{x:0,y:0};l instanceof HTMLImageElement||l instanceof HTMLCanvasElement||l instanceof HTMLVideoElement||l instanceof ImageData||o.b(l)?re.texSubImage2D(re.TEXTURE_2D,0,oe,pe,re.RGBA,re.UNSIGNED_BYTE,l):re.texSubImage2D(re.TEXTURE_2D,0,oe,pe,P,O,re.RGBA,re.UNSIGNED_BYTE,l.data)}this.useMipmap&&this.isSizePowerOfTwo()&&re.generateMipmap(re.TEXTURE_2D)}bind(l,m,w){const{context:P}=this,{gl:O}=P;O.bindTexture(O.TEXTURE_2D,this.texture),w!==O.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(w=O.LINEAR),l!==this.filter&&(O.texParameteri(O.TEXTURE_2D,O.TEXTURE_MAG_FILTER,l),O.texParameteri(O.TEXTURE_2D,O.TEXTURE_MIN_FILTER,w||l),this.filter=l),m!==this.wrap&&(O.texParameteri(O.TEXTURE_2D,O.TEXTURE_WRAP_S,m),O.texParameteri(O.TEXTURE_2D,O.TEXTURE_WRAP_T,m),this.wrap=m)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:l}=this.context;l.deleteTexture(this.texture),this.texture=null}}function st(D){const{userImage:l}=D;return!!(l&&l.render&&l.render())&&(D.data.replace(new Uint8Array(l.data.buffer)),!0)}class at extends o.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(l){if(this.loaded!==l&&(this.loaded=l,l)){for(const{ids:m,promiseResolve:w}of this.requestors)w(this._getImagesForIds(m));this.requestors=[]}}getImage(l){const m=this.images[l];if(m&&!m.data&&m.spriteData){const w=m.spriteData;m.data=new o.R({width:w.width,height:w.height},w.context.getImageData(w.x,w.y,w.width,w.height).data),m.spriteData=null}return m}addImage(l,m){if(this.images[l])throw new Error(`Image id ${l} already exist, use updateImage instead`);this._validate(l,m)&&(this.images[l]=m)}_validate(l,m){let w=!0;const P=m.data||m.spriteData;return this._validateStretch(m.stretchX,P&&P.width)||(this.fire(new o.j(new Error(`Image "${l}" has invalid "stretchX" value`))),w=!1),this._validateStretch(m.stretchY,P&&P.height)||(this.fire(new o.j(new Error(`Image "${l}" has invalid "stretchY" value`))),w=!1),this._validateContent(m.content,m)||(this.fire(new o.j(new Error(`Image "${l}" has invalid "content" value`))),w=!1),w}_validateStretch(l,m){if(!l)return!0;let w=0;for(const P of l){if(P[0]<w||P[1]<P[0]||m<P[1])return!1;w=P[1]}return!0}_validateContent(l,m){if(!l)return!0;if(l.length!==4)return!1;const w=m.spriteData,P=w&&w.width||m.data.width,O=w&&w.height||m.data.height;return!(l[0]<0||P<l[0]||l[1]<0||O<l[1]||l[2]<0||P<l[2]||l[3]<0||O<l[3]||l[2]<l[0]||l[3]<l[1])}updateImage(l,m){let w=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const P=this.getImage(l);if(w&&(P.data.width!==m.data.width||P.data.height!==m.data.height))throw new Error(`size mismatch between old image (${P.data.width}x${P.data.height}) and new image (${m.data.width}x${m.data.height}).`);m.version=P.version+1,this.images[l]=m,this.updatedImages[l]=!0}removeImage(l){const m=this.images[l];delete this.images[l],delete this.patterns[l],m.userImage&&m.userImage.onRemove&&m.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(l){return new Promise((m,w)=>{let P=!0;if(!this.isLoaded())for(const O of l)this.images[O]||(P=!1);this.isLoaded()||P?m(this._getImagesForIds(l)):this.requestors.push({ids:l,promiseResolve:m})})}_getImagesForIds(l){const m={};for(const w of l){let P=this.getImage(w);P||(this.fire(new o.k("styleimagemissing",{id:w})),P=this.getImage(w)),P?m[w]={data:P.data.clone(),pixelRatio:P.pixelRatio,sdf:P.sdf,version:P.version,stretchX:P.stretchX,stretchY:P.stretchY,content:P.content,textFitWidth:P.textFitWidth,textFitHeight:P.textFitHeight,hasRenderCallback:!!(P.userImage&&P.userImage.render)}:o.w(`Image "${w}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return m}getPixelSize(){const{width:l,height:m}=this.atlasImage;return{width:l,height:m}}getPattern(l){const m=this.patterns[l],w=this.getImage(l);if(!w)return null;if(m&&m.position.version===w.version)return m.position;if(m)m.position.version=w.version;else{const P={w:w.data.width+2,h:w.data.height+2,x:0,y:0},O=new o.I(P,w);this.patterns[l]={bin:P,position:O}}return this._updatePatternAtlas(),this.patterns[l].position}bind(l){const m=l.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Ue(l,this.atlasImage,m.RGBA),this.atlasTexture.bind(m.LINEAR,m.CLAMP_TO_EDGE)}_updatePatternAtlas(){const l=[];for(const O in this.patterns)l.push(this.patterns[O].bin);const{w:m,h:w}=o.p(l),P=this.atlasImage;P.resize({width:m||1,height:w||1});for(const O in this.patterns){const{bin:G}=this.patterns[O],J=G.x+1,re=G.y+1,oe=this.getImage(O).data,pe=oe.width,Ce=oe.height;o.R.copy(oe,P,{x:0,y:0},{x:J,y:re},{width:pe,height:Ce}),o.R.copy(oe,P,{x:0,y:Ce-1},{x:J,y:re-1},{width:pe,height:1}),o.R.copy(oe,P,{x:0,y:0},{x:J,y:re+Ce},{width:pe,height:1}),o.R.copy(oe,P,{x:pe-1,y:0},{x:J-1,y:re},{width:1,height:Ce}),o.R.copy(oe,P,{x:0,y:0},{x:J+pe,y:re},{width:1,height:Ce})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(l){for(const m of l){if(this.callbackDispatchedThisFrame[m])continue;this.callbackDispatchedThisFrame[m]=!0;const w=this.getImage(m);w||o.w(`Image with ID: "${m}" was not found`),st(w)&&this.updateImage(m,w)}}}const Le=1e20;function ze(D,l,m,w,P,O,G,J,re){for(let oe=l;oe<l+w;oe++)tt(D,m*O+oe,O,P,G,J,re);for(let oe=m;oe<m+P;oe++)tt(D,oe*O+l,1,w,G,J,re)}function tt(D,l,m,w,P,O,G){O[0]=0,G[0]=-1e20,G[1]=Le,P[0]=D[l];for(let J=1,re=0,oe=0;J<w;J++){P[J]=D[l+J*m];const pe=J*J;do{const Ce=O[re];oe=(P[J]-P[Ce]+pe-Ce*Ce)/(J-Ce)/2}while(oe<=G[re]&&--re>-1);re++,O[re]=J,G[re]=oe,G[re+1]=Le}for(let J=0,re=0;J<w;J++){for(;G[re+1]<J;)re++;const oe=O[re],pe=J-oe;D[l+J*m]=P[oe]+pe*pe}}class Ne{constructor(l,m){this.requestManager=l,this.localIdeographFontFamily=m,this.entries={}}setURL(l){this.url=l}getGlyphs(l){return o._(this,void 0,void 0,function*(){const m=[];for(const O in l)for(const G of l[O])m.push(this._getAndCacheGlyphsPromise(O,G));const w=yield Promise.all(m),P={};for(const{stack:O,id:G,glyph:J}of w)P[O]||(P[O]={}),P[O][G]=J&&{id:J.id,bitmap:J.bitmap.clone(),metrics:J.metrics};return P})}_getAndCacheGlyphsPromise(l,m){return o._(this,void 0,void 0,function*(){let w=this.entries[l];w||(w=this.entries[l]={glyphs:{},requests:{},ranges:{}});let P=w.glyphs[m];if(P!==void 0)return{stack:l,id:m,glyph:P};if(P=this._tinySDF(w,l,m),P)return w.glyphs[m]=P,{stack:l,id:m,glyph:P};const O=Math.floor(m/256);if(256*O>65535)throw new Error("glyphs > 65535 not supported");if(w.ranges[O])return{stack:l,id:m,glyph:P};if(!this.url)throw new Error("glyphsUrl is not set");if(!w.requests[O]){const J=Ne.loadGlyphRange(l,O,this.url,this.requestManager);w.requests[O]=J}const G=yield w.requests[O];for(const J in G)this._doesCharSupportLocalGlyph(+J)||(w.glyphs[+J]=G[+J]);return w.ranges[O]=!0,{stack:l,id:m,glyph:G[m]||null}})}_doesCharSupportLocalGlyph(l){return!!this.localIdeographFontFamily&&new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(l))}_tinySDF(l,m,w){const P=this.localIdeographFontFamily;if(!P||!this._doesCharSupportLocalGlyph(w))return;let O=l.tinySDF;if(!O){let J="400";/bold/i.test(m)?J="900":/medium/i.test(m)?J="500":/light/i.test(m)&&(J="200"),O=l.tinySDF=new Ne.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:P,fontWeight:J})}const G=O.draw(String.fromCharCode(w));return{id:w,bitmap:new o.o({width:G.width||60,height:G.height||60},G.data),metrics:{width:G.glyphWidth/2||24,height:G.glyphHeight/2||24,left:G.glyphLeft/2+.5||0,top:G.glyphTop/2-27.5||-8,advance:G.glyphAdvance/2||24,isDoubleResolution:!0}}}}Ne.loadGlyphRange=function(D,l,m,w){return o._(this,void 0,void 0,function*(){const P=256*l,O=P+255,G=w.transformRequest(m.replace("{fontstack}",D).replace("{range}",`${P}-${O}`),"Glyphs"),J=yield o.l(G,new AbortController);if(!J||!J.data)throw new Error(`Could not load glyph range. range: ${l}, ${P}-${O}`);const re={};for(const oe of o.n(J.data))re[oe.id]=oe;return re})},Ne.TinySDF=class{constructor(){let{fontSize:D=24,buffer:l=3,radius:m=8,cutoff:w=.25,fontFamily:P="sans-serif",fontWeight:O="normal",fontStyle:G="normal"}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.buffer=l,this.cutoff=w,this.radius=m;const J=this.size=D+4*l,re=this._createCanvas(J),oe=this.ctx=re.getContext("2d",{willReadFrequently:!0});oe.font=`${G} ${O} ${D}px ${P}`,oe.textBaseline="alphabetic",oe.textAlign="left",oe.fillStyle="black",this.gridOuter=new Float64Array(J*J),this.gridInner=new Float64Array(J*J),this.f=new Float64Array(J),this.z=new Float64Array(J+1),this.v=new Uint16Array(J)}_createCanvas(D){const l=document.createElement("canvas");return l.width=l.height=D,l}draw(D){const{width:l,actualBoundingBoxAscent:m,actualBoundingBoxDescent:w,actualBoundingBoxLeft:P,actualBoundingBoxRight:O}=this.ctx.measureText(D),G=Math.ceil(m),J=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(O-P))),re=Math.min(this.size-this.buffer,G+Math.ceil(w)),oe=J+2*this.buffer,pe=re+2*this.buffer,Ce=Math.max(oe*pe,0),Me=new Uint8ClampedArray(Ce),Ke={data:Me,width:oe,height:pe,glyphWidth:J,glyphHeight:re,glyphTop:G,glyphLeft:0,glyphAdvance:l};if(J===0||re===0)return Ke;const{ctx:Ye,buffer:gt,gridInner:ft,gridOuter:mt}=this;Ye.clearRect(gt,gt,J,re),Ye.fillText(D,gt,gt+G);const xt=Ye.getImageData(gt,gt,J,re);mt.fill(Le,0,Ce),ft.fill(0,0,Ce);for(let Ft=0;Ft<re;Ft++)for(let Dt=0;Dt<J;Dt++){const Ut=xt.data[4*(Ft*J+Dt)+3]/255;if(Ut===0)continue;const Gt=(Ft+gt)*oe+Dt+gt;if(Ut===1)mt[Gt]=0,ft[Gt]=Le;else{const zt=.5-Ut;mt[Gt]=zt>0?zt*zt:0,ft[Gt]=zt<0?zt*zt:0}}ze(mt,0,0,oe,pe,oe,this.f,this.v,this.z),ze(ft,gt,gt,J,re,oe,this.f,this.v,this.z);for(let Ft=0;Ft<Ce;Ft++){const Dt=Math.sqrt(mt[Ft])-Math.sqrt(ft[Ft]);Me[Ft]=Math.round(255-255*(Dt/this.radius+this.cutoff))}return Ke}};class Ht{constructor(){this.specification=o.v.light.position}possiblyEvaluate(l,m){return o.x(l.expression.evaluate(m))}interpolate(l,m,w){return{x:o.y.number(l.x,m.x,w),y:o.y.number(l.y,m.y,w),z:o.y.number(l.z,m.z,w)}}}let Vt;class Jt extends o.E{constructor(l){super(),Vt=Vt||new o.q({anchor:new o.D(o.v.light.anchor),position:new Ht,color:new o.D(o.v.light.color),intensity:new o.D(o.v.light.intensity)}),this._transitionable=new o.T(Vt),this.setLight(l),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(l){let m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!this._validate(o.r,l,m))for(const w in l){const P=l[w];w.endsWith("-transition")?this._transitionable.setTransition(w.slice(0,-11),P):this._transitionable.setValue(w,P)}}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,m,w){return(!w||w.validate!==!1)&&o.t(this,l.call(o.u,{value:m,style:{glyphs:!0,sprite:!0},styleSpec:o.v}))}}const Kt=new o.q({"sky-color":new o.D(o.v.sky["sky-color"]),"horizon-color":new o.D(o.v.sky["horizon-color"]),"fog-color":new o.D(o.v.sky["fog-color"]),"fog-ground-blend":new o.D(o.v.sky["fog-ground-blend"]),"horizon-fog-blend":new o.D(o.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new o.D(o.v.sky["sky-horizon-blend"]),"atmosphere-blend":new o.D(o.v.sky["atmosphere-blend"])});class er extends o.E{constructor(l){super(),this._transitionable=new o.T(Kt),this.setSky(l),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new o.z(0))}setSky(l){let m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!this._validate(o.B,l,m)){l||(l={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const w in l){const P=l[w];w.endsWith("-transition")?this._transitionable.setTransition(w.slice(0,-11),P):this._transitionable.setValue(w,P)}}}getSky(){return this._transitionable.serialize()}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,m){let w=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return(w==null?void 0:w.validate)!==!1&&o.t(this,l.call(o.u,o.e({value:m,style:{glyphs:!0,sprite:!0},styleSpec:o.v})))}calculateFogBlendOpacity(l){return l<60?0:l<70?(l-60)/10:1}}class Xt{constructor(l,m){this.width=l,this.height=m,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(l,m){const w=l.join(",")+String(m);return this.dashEntry[w]||(this.dashEntry[w]=this.addDash(l,m)),this.dashEntry[w]}getDashRanges(l,m,w){const P=[];let O=l.length%2==1?-l[l.length-1]*w:0,G=l[0]*w,J=!0;P.push({left:O,right:G,isDash:J,zeroLength:l[0]===0});let re=l[0];for(let oe=1;oe<l.length;oe++){J=!J;const pe=l[oe];O=re*w,re+=pe,G=re*w,P.push({left:O,right:G,isDash:J,zeroLength:pe===0})}return P}addRoundDash(l,m,w){const P=m/2;for(let O=-w;O<=w;O++){const G=this.width*(this.nextRow+w+O);let J=0,re=l[J];for(let oe=0;oe<this.width;oe++){oe/re.right>1&&(re=l[++J]);const pe=Math.abs(oe-re.left),Ce=Math.abs(oe-re.right),Me=Math.min(pe,Ce);let Ke;const Ye=O/w*(P+1);if(re.isDash){const gt=P-Math.abs(Ye);Ke=Math.sqrt(Me*Me+gt*gt)}else Ke=P-Math.sqrt(Me*Me+Ye*Ye);this.data[G+oe]=Math.max(0,Math.min(255,Ke+128))}}}addRegularDash(l){for(let J=l.length-1;J>=0;--J){const re=l[J],oe=l[J+1];re.zeroLength?l.splice(J,1):oe&&oe.isDash===re.isDash&&(oe.left=re.left,l.splice(J,1))}const m=l[0],w=l[l.length-1];m.isDash===w.isDash&&(m.left=w.left-this.width,w.right=m.right+this.width);const P=this.width*this.nextRow;let O=0,G=l[O];for(let J=0;J<this.width;J++){J/G.right>1&&(G=l[++O]);const re=Math.abs(J-G.left),oe=Math.abs(J-G.right),pe=Math.min(re,oe);this.data[P+J]=Math.max(0,Math.min(255,(G.isDash?pe:-pe)+128))}}addDash(l,m){const w=m?7:0,P=2*w+1;if(this.nextRow+P>this.height)return o.w("LineAtlas out of space"),null;let O=0;for(let J=0;J<l.length;J++)O+=l[J];if(O!==0){const J=this.width/O,re=this.getDashRanges(l,this.width,J);m?this.addRoundDash(re,J,w):this.addRegularDash(re)}const G={y:(this.nextRow+w+.5)/this.height,height:2*w/this.height,width:O};return this.nextRow+=P,this.dirty=!0,G}bind(l){const m=l.gl;this.texture?(m.bindTexture(m.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,m.texSubImage2D(m.TEXTURE_2D,0,0,0,this.width,this.height,m.ALPHA,m.UNSIGNED_BYTE,this.data))):(this.texture=m.createTexture(),m.bindTexture(m.TEXTURE_2D,this.texture),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,m.REPEAT),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,m.REPEAT),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,m.LINEAR),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,m.LINEAR),m.texImage2D(m.TEXTURE_2D,0,m.ALPHA,this.width,this.height,0,m.ALPHA,m.UNSIGNED_BYTE,this.data))}}const Fr="maplibre_preloaded_worker_pool";class $e{constructor(){this.active={}}acquire(l){if(!this.workers)for(this.workers=[];this.workers.length<$e.workerCount;)this.workers.push(new Worker(o.a.WORKER_URL));return this.active[l]=!0,this.workers.slice()}release(l){delete this.active[l],this.numActive()===0&&(this.workers.forEach(m=>{m.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Fr]}numActive(){return Object.keys(this.active).length}}const ut=Math.floor(T.hardwareConcurrency/2);let Bt,St;function jt(){return Bt||(Bt=new $e),Bt}$e.workerCount=o.C(globalThis)?Math.max(Math.min(ut,3),1):1;class qt{constructor(l,m){this.workerPool=l,this.actors=[],this.currentActor=0,this.id=m;const w=this.workerPool.acquire(m);for(let P=0;P<w.length;P++){const O=new o.F(w[P],m);O.name=`Worker ${P}`,this.actors.push(O)}if(!this.actors.length)throw new Error("No actors found")}broadcast(l,m){const w=[];for(const P of this.actors)w.push(P.sendAsync({type:l,data:m}));return Promise.all(w)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.actors.forEach(m=>{m.remove()}),this.actors=[],l&&this.workerPool.release(this.id)}registerMessageHandler(l,m){for(const w of this.actors)w.registerMessageHandler(l,m)}}function nr(){return St||(St=new qt(jt(),o.G),St.registerMessageHandler("GR",(D,l,m)=>o.m(l,m))),St}function ar(D,l){const m=o.H();return o.J(m,m,[1,1,0]),o.K(m,m,[.5*D.width,.5*D.height,1]),D.calculatePosMatrix?o.L(m,m,D.calculatePosMatrix(l.toUnwrapped())):m}function $r(D,l,m,w,P,O){var G;const J=function(Ce,Me,Ke){if(Ce)for(const Ye of Ce){const gt=Me[Ye];if(gt&&gt.source===Ke&&gt.type==="fill-extrusion")return!0}else for(const Ye in Me){const gt=Me[Ye];if(gt.source===Ke&&gt.type==="fill-extrusion")return!0}return!1}((G=P==null?void 0:P.layers)!==null&&G!==void 0?G:null,l,D.id),re=O.maxPitchScaleFactor(),oe=D.tilesIn(w,re,J);oe.sort(kr);const pe=[];for(const Ce of oe)pe.push({wrappedTileID:Ce.tileID.wrapped().key,queryResults:Ce.tile.queryRenderedFeatures(l,m,D._state,Ce.queryGeometry,Ce.cameraQueryGeometry,Ce.scale,P,O,re,ar(D.transform,Ce.tileID))});return function(Ce,Me){for(const Ke in Ce)for(const Ye of Ce[Ke])Gr(Ye,Me);return Ce}(function(Ce){const Me={},Ke={};for(const Ye of Ce){const gt=Ye.queryResults,ft=Ye.wrappedTileID,mt=Ke[ft]=Ke[ft]||{};for(const xt in gt){const Ft=gt[xt],Dt=mt[xt]=mt[xt]||{},Ut=Me[xt]=Me[xt]||[];for(const Gt of Ft)Dt[Gt.featureIndex]||(Dt[Gt.featureIndex]=!0,Ut.push(Gt))}}return Me}(pe),D)}function kr(D,l){const m=D.tileID,w=l.tileID;return m.overscaledZ-w.overscaledZ||m.canonical.y-w.canonical.y||m.wrap-w.wrap||m.canonical.x-w.canonical.x}function Gr(D,l){const m=D.feature,w=l.getFeatureState(m.layer["source-layer"],m.id);m.source=m.layer.source,m.layer["source-layer"]&&(m.sourceLayer=m.layer["source-layer"]),m.state=w}function sn(D,l,m){return o._(this,void 0,void 0,function*(){let w=D;if(D.url?w=(yield o.h(l.transformRequest(D.url,"Source"),m)).data:yield T.frameAsync(m),!w)return null;const P=o.M(o.e(w,D),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in w&&w.vector_layers&&(P.vectorLayerIds=w.vector_layers.map(O=>O.id)),P})}class on{constructor(l,m){l&&(m?this.setSouthWest(l).setNorthEast(m):Array.isArray(l)&&(l.length===4?this.setSouthWest([l[0],l[1]]).setNorthEast([l[2],l[3]]):this.setSouthWest(l[0]).setNorthEast(l[1])))}setNorthEast(l){return this._ne=l instanceof o.N?new o.N(l.lng,l.lat):o.N.convert(l),this}setSouthWest(l){return this._sw=l instanceof o.N?new o.N(l.lng,l.lat):o.N.convert(l),this}extend(l){const m=this._sw,w=this._ne;let P,O;if(l instanceof o.N)P=l,O=l;else{if(!(l instanceof on))return Array.isArray(l)?l.length===4||l.every(Array.isArray)?this.extend(on.convert(l)):this.extend(o.N.convert(l)):l&&("lng"in l||"lon"in l)&&"lat"in l?this.extend(o.N.convert(l)):this;if(P=l._sw,O=l._ne,!P||!O)return this}return m||w?(m.lng=Math.min(P.lng,m.lng),m.lat=Math.min(P.lat,m.lat),w.lng=Math.max(O.lng,w.lng),w.lat=Math.max(O.lat,w.lat)):(this._sw=new o.N(P.lng,P.lat),this._ne=new o.N(O.lng,O.lat)),this}getCenter(){return new o.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new o.N(this.getWest(),this.getNorth())}getSouthEast(){return new o.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(l){const{lng:m,lat:w}=o.N.convert(l);let P=this._sw.lng<=m&&m<=this._ne.lng;return this._sw.lng>this._ne.lng&&(P=this._sw.lng>=m&&m>=this._ne.lng),this._sw.lat<=w&&w<=this._ne.lat&&P}static convert(l){return l instanceof on?l:l&&new on(l)}static fromLngLat(l){const w=360*(arguments.length>1&&arguments[1]!==void 0?arguments[1]:0)/40075017,P=w/Math.cos(Math.PI/180*l.lat);return new on(new o.N(l.lng-P,l.lat-w),new o.N(l.lng+P,l.lat+w))}adjustAntiMeridian(){const l=new o.N(this._sw.lng,this._sw.lat),m=new o.N(this._ne.lng,this._ne.lat);return new on(l,l.lng>m.lng?new o.N(m.lng+360,m.lat):m)}}class pr{constructor(l,m,w){this.bounds=on.convert(this.validateBounds(l)),this.minzoom=m||0,this.maxzoom=w||24}validateBounds(l){return Array.isArray(l)&&l.length===4?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]}contains(l){const m=Math.pow(2,l.z),w=Math.floor(o.O(this.bounds.getWest())*m),P=Math.floor(o.Q(this.bounds.getNorth())*m),O=Math.ceil(o.O(this.bounds.getEast())*m),G=Math.ceil(o.Q(this.bounds.getSouth())*m);return l.x>=w&&l.x<O&&l.y>=P&&l.y<G}}class We extends o.E{constructor(l,m,w,P){if(super(),this.id=l,this.dispatcher=w,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.e(this,o.M(m,["url","scheme","tileSize","promoteId"])),this._options=o.e({type:"vector"},m),this._collectResourceTiming=m.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(P)}load(){return o._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new o.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const l=yield sn(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),l&&(o.e(this,l),l.bounds&&(this.tileBounds=new pr(l.bounds,this.minzoom,this.maxzoom)),this.fire(new o.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.k("data",{dataType:"source",sourceDataType:"content"})))}catch(l){this._tileJSONRequest=null,this.fire(new o.j(l))}})}loaded(){return this._loaded}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}onAdd(l){this.map=l,this.load()}setSourceProperty(l){this._tileJSONRequest&&this._tileJSONRequest.abort(),l(),this.load()}setTiles(l){return this.setSourceProperty(()=>{this._options.tiles=l}),this}setUrl(l){return this.setSourceProperty(()=>{this.url=l,this._options.url=l}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return o.e({},this._options)}loadTile(l){return o._(this,void 0,void 0,function*(){const m=l.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),w={request:this.map._requestManager.transformRequest(m,"Tile"),uid:l.uid,tileID:l.tileID,zoom:l.tileID.overscaledZ,tileSize:this.tileSize*l.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};w.request.collectResourceTiming=this._collectResourceTiming;let P="RT";if(l.actor&&l.state!=="expired"){if(l.state==="loading")return new Promise((O,G)=>{l.reloadPromise={resolve:O,reject:G}})}else l.actor=this.dispatcher.getActor(),P="LT";l.abortController=new AbortController;try{const O=yield l.actor.sendAsync({type:P,data:w},l.abortController);if(delete l.abortController,l.aborted)return;this._afterTileLoadWorkerResponse(l,O)}catch(O){if(delete l.abortController,l.aborted)return;if(O&&O.status!==404)throw O;this._afterTileLoadWorkerResponse(l,null)}})}_afterTileLoadWorkerResponse(l,m){if(m&&m.resourceTiming&&(l.resourceTiming=m.resourceTiming),m&&this.map._refreshExpiredTiles&&l.setExpiryData(m),l.loadVectorData(m,this.map.painter),l.reloadPromise){const w=l.reloadPromise;l.reloadPromise=null,this.loadTile(l).then(w.resolve).catch(w.reject)}}abortTile(l){return o._(this,void 0,void 0,function*(){l.abortController&&(l.abortController.abort(),delete l.abortController),l.actor&&(yield l.actor.sendAsync({type:"AT",data:{uid:l.uid,type:this.type,source:this.id}}))})}unloadTile(l){return o._(this,void 0,void 0,function*(){l.unloadVectorData(),l.actor&&(yield l.actor.sendAsync({type:"RMT",data:{uid:l.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Pn extends o.E{constructor(l,m,w,P){super(),this.id=l,this.dispatcher=w,this.setEventedParent(P),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.e({type:"raster"},m),o.e(this,o.M(m,["url","scheme","tileSize"]))}load(){return o._(this,arguments,void 0,function(){var l=this;let m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;return function*(){l._loaded=!1,l.fire(new o.k("dataloading",{dataType:"source"})),l._tileJSONRequest=new AbortController;try{const w=yield sn(l._options,l.map._requestManager,l._tileJSONRequest);l._tileJSONRequest=null,l._loaded=!0,w&&(o.e(l,w),w.bounds&&(l.tileBounds=new pr(w.bounds,l.minzoom,l.maxzoom)),l.fire(new o.k("data",{dataType:"source",sourceDataType:"metadata"})),l.fire(new o.k("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:m})))}catch(w){l._tileJSONRequest=null,l.fire(new o.j(w))}}()})}loaded(){return this._loaded}onAdd(l){this.map=l,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(l){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),l(),this.load(!0)}setTiles(l){return this.setSourceProperty(()=>{this._options.tiles=l}),this}setUrl(l){return this.setSourceProperty(()=>{this.url=l,this._options.url=l}),this}serialize(){return o.e({},this._options)}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}loadTile(l){return o._(this,void 0,void 0,function*(){const m=l.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);l.abortController=new AbortController;try{const w=yield fe.getImage(this.map._requestManager.transformRequest(m,"Tile"),l.abortController,this.map._refreshExpiredTiles);if(delete l.abortController,l.aborted)return void(l.state="unloaded");if(w&&w.data){this.map._refreshExpiredTiles&&w.cacheControl&&w.expires&&l.setExpiryData({cacheControl:w.cacheControl,expires:w.expires});const P=this.map.painter.context,O=P.gl,G=w.data;l.texture=this.map.painter.getTileTexture(G.width),l.texture?l.texture.update(G,{useMipmap:!0}):(l.texture=new Ue(P,G,O.RGBA,{useMipmap:!0}),l.texture.bind(O.LINEAR,O.CLAMP_TO_EDGE,O.LINEAR_MIPMAP_NEAREST)),l.state="loaded"}}catch(w){if(delete l.abortController,l.aborted)l.state="unloaded";else if(w)throw l.state="errored",w}})}abortTile(l){return o._(this,void 0,void 0,function*(){l.abortController&&(l.abortController.abort(),delete l.abortController)})}unloadTile(l){return o._(this,void 0,void 0,function*(){l.texture&&this.map.painter.saveTileTexture(l.texture)})}hasTransition(){return!1}}class mn extends Pn{constructor(l,m,w,P){super(l,m,w,P),this.type="raster-dem",this.maxzoom=22,this._options=o.e({type:"raster-dem"},m),this.encoding=m.encoding||"mapbox",this.redFactor=m.redFactor,this.greenFactor=m.greenFactor,this.blueFactor=m.blueFactor,this.baseShift=m.baseShift}loadTile(l){return o._(this,void 0,void 0,function*(){const m=l.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),w=this.map._requestManager.transformRequest(m,"Tile");l.neighboringTiles=this._getNeighboringTiles(l.tileID),l.abortController=new AbortController;try{const P=yield fe.getImage(w,l.abortController,this.map._refreshExpiredTiles);if(delete l.abortController,l.aborted)return void(l.state="unloaded");if(P&&P.data){const O=P.data;this.map._refreshExpiredTiles&&P.cacheControl&&P.expires&&l.setExpiryData({cacheControl:P.cacheControl,expires:P.expires});const G=o.b(O)&&o.U()?O:yield this.readImageNow(O),J={type:this.type,uid:l.uid,source:this.id,rawImageData:G,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!l.actor||l.state==="expired"){l.actor=this.dispatcher.getActor();const re=yield l.actor.sendAsync({type:"LDT",data:J});l.dem=re,l.needsHillshadePrepare=!0,l.needsTerrainPrepare=!0,l.state="loaded"}}}catch(P){if(delete l.abortController,l.aborted)l.state="unloaded";else if(P)throw l.state="errored",P}})}readImageNow(l){return o._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&o.V()){const m=l.width+2,w=l.height+2;try{return new o.R({width:m,height:w},yield o.W(l,-1,-1,m,w))}catch{}}return T.getImageData(l,1)})}_getNeighboringTiles(l){const m=l.canonical,w=Math.pow(2,m.z),P=(m.x-1+w)%w,O=m.x===0?l.wrap-1:l.wrap,G=(m.x+1+w)%w,J=m.x+1===w?l.wrap+1:l.wrap,re={};return re[new o.S(l.overscaledZ,O,m.z,P,m.y).key]={backfilled:!1},re[new o.S(l.overscaledZ,J,m.z,G,m.y).key]={backfilled:!1},m.y>0&&(re[new o.S(l.overscaledZ,O,m.z,P,m.y-1).key]={backfilled:!1},re[new o.S(l.overscaledZ,l.wrap,m.z,m.x,m.y-1).key]={backfilled:!1},re[new o.S(l.overscaledZ,J,m.z,G,m.y-1).key]={backfilled:!1}),m.y+1<w&&(re[new o.S(l.overscaledZ,O,m.z,P,m.y+1).key]={backfilled:!1},re[new o.S(l.overscaledZ,l.wrap,m.z,m.x,m.y+1).key]={backfilled:!1},re[new o.S(l.overscaledZ,J,m.z,G,m.y+1).key]={backfilled:!1}),re}unloadTile(l){return o._(this,void 0,void 0,function*(){l.demTexture&&this.map.painter.saveTileTexture(l.demTexture),l.fbo&&(l.fbo.destroy(),delete l.fbo),l.dem&&delete l.dem,delete l.neighboringTiles,l.state="unloaded",l.actor&&(yield l.actor.sendAsync({type:"RDT",data:{type:this.type,uid:l.uid,source:this.id}}))})}}class mr extends o.E{constructor(l,m,w,P){super(),this.id=l,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=w.getActor(),this.setEventedParent(P),this._data=m.data,this._options=o.e({},m),this._collectResourceTiming=m.collectResourceTiming,m.maxzoom!==void 0&&(this.maxzoom=m.maxzoom),m.type&&(this.type=m.type),m.attribution&&(this.attribution=m.attribution),this.promoteId=m.promoteId,m.clusterMaxZoom!==void 0&&this.maxzoom<=m.clusterMaxZoom&&o.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${m.clusterMaxZoom}".`),this.workerOptions=o.e({source:this.id,cluster:m.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(m.buffer!==void 0?m.buffer:128),tolerance:this._pixelsToTileUnits(m.tolerance!==void 0?m.tolerance:.375),extent:o.X,maxZoom:this.maxzoom,lineMetrics:m.lineMetrics||!1,generateId:m.generateId||!1},superclusterOptions:{maxZoom:m.clusterMaxZoom!==void 0?m.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,m.clusterMinPoints||2),extent:o.X,radius:this._pixelsToTileUnits(m.clusterRadius||50),log:!1,generateId:m.generateId||!1},clusterProperties:m.clusterProperties,filter:m.filter},m.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(l){return l*(o.X/this.tileSize)}load(){return o._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(l){this.map=l,this.load()}setData(l){return this._data=l,this._updateWorkerData(),this}updateData(l){return this._updateWorkerData(l),this}getData(){return o._(this,void 0,void 0,function*(){const l=o.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:l})})}setClusterOptions(l){return this.workerOptions.cluster=l.cluster,l&&(l.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(l.clusterRadius)),l.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=l.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(l){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:l,source:this.id}})}getClusterChildren(l){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:l,source:this.id}})}getClusterLeaves(l,m,w){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:l,limit:m,offset:w}})}_updateWorkerData(l){return o._(this,void 0,void 0,function*(){const m=o.e({type:this.type},this.workerOptions);l?m.dataDiff=l:typeof this._data=="string"?(m.request=this.map._requestManager.transformRequest(T.resolveURL(this._data),"Source"),m.request.collectResourceTiming=this._collectResourceTiming):m.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new o.k("dataloading",{dataType:"source"}));try{const w=yield this.actor.sendAsync({type:"LD",data:m});if(this._pendingLoads--,this._removed||w.abandoned)return void this.fire(new o.k("dataabort",{dataType:"source"}));let P=null;w.resourceTiming&&w.resourceTiming[this.id]&&(P=w.resourceTiming[this.id].slice(0));const O={dataType:"source"};this._collectResourceTiming&&P&&P.length>0&&o.e(O,{resourceTiming:P}),this.fire(new o.k("data",Object.assign(Object.assign({},O),{sourceDataType:"metadata"}))),this.fire(new o.k("data",Object.assign(Object.assign({},O),{sourceDataType:"content"})))}catch(w){if(this._pendingLoads--,this._removed)return void this.fire(new o.k("dataabort",{dataType:"source"}));this.fire(new o.j(w))}})}loaded(){return this._pendingLoads===0}loadTile(l){return o._(this,void 0,void 0,function*(){const m=l.actor?"RT":"LT";l.actor=this.actor;const w={type:this.type,uid:l.uid,tileID:l.tileID,zoom:l.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};l.abortController=new AbortController;const P=yield this.actor.sendAsync({type:m,data:w},l.abortController);delete l.abortController,l.unloadVectorData(),l.aborted||l.loadVectorData(P,this.map.painter,m==="RT")})}abortTile(l){return o._(this,void 0,void 0,function*(){l.abortController&&(l.abortController.abort(),delete l.abortController),l.aborted=!0})}unloadTile(l){return o._(this,void 0,void 0,function*(){l.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:l.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return o.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class Mr extends o.E{constructor(l,m,w,P){super(),this.flippedWindingOrder=!1,this.id=l,this.dispatcher=w,this.coordinates=m.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(P),this.options=m}load(l){return o._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new o.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const m=yield fe.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,m&&m.data&&(this.image=m.data,l&&(this.coordinates=l),this._finishLoading())}catch(m){this._request=null,this._loaded=!0,this.fire(new o.j(m))}})}loaded(){return this._loaded}updateImage(l){return l.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=l.url,this.load(l.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(l){this.map=l,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(l){this.coordinates=l;const m=l.map(o.Y.fromLngLat);var w;return this.tileID=function(P){let O=1/0,G=1/0,J=-1/0,re=-1/0;for(const Me of P)O=Math.min(O,Me.x),G=Math.min(G,Me.y),J=Math.max(J,Me.x),re=Math.max(re,Me.y);const oe=Math.max(J-O,re-G),pe=Math.max(0,Math.floor(-Math.log(oe)/Math.LN2)),Ce=Math.pow(2,pe);return new o.Z(pe,Math.floor((O+J)/2*Ce),Math.floor((G+re)/2*Ce))}(m),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=m.map(P=>this.tileID.getTilePoint(P)._round()),this.flippedWindingOrder=((w=this.tileCoords)[1].x-w[0].x)*(w[2].y-w[0].y)-(w[1].y-w[0].y)*(w[2].x-w[0].x)<0,this.fire(new o.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const l=this.map.painter.context,m=l.gl;this.texture||(this.texture=new Ue(l,this.image,m.RGBA),this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE));let w=!1;for(const P in this.tiles){const O=this.tiles[P];O.state!=="loaded"&&(O.state="loaded",O.texture=this.texture,w=!0)}w&&this.fire(new o.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(l){return o._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(l.tileID.canonical)?(this.tiles[String(l.tileID.wrap)]=l,l.buckets={}):l.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class en extends Mr{constructor(l,m,w,P){super(l,m,w,P),this.roundZoom=!0,this.type="video",this.options=m}load(){return o._(this,void 0,void 0,function*(){this._loaded=!1;const l=this.options;this.urls=[];for(const m of l.urls)this.urls.push(this.map._requestManager.transformRequest(m,"Source").url);try{const m=yield o.a0(this.urls);if(this._loaded=!0,!m)return;this.video=m,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(m){this.fire(new o.j(m))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(l){if(this.video){const m=this.video.seekable;l<m.start(0)||l>m.end(0)?this.fire(new o.j(new o.$(`sources.${this.id}`,null,`Playback for this video can be set only between the ${m.start(0)} and ${m.end(0)}-second mark.`))):this.video.currentTime=l}}getVideo(){return this.video}onAdd(l){this.map||(this.map=l,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const l=this.map.painter.context,m=l.gl;this.texture?this.video.paused||(this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE),m.texSubImage2D(m.TEXTURE_2D,0,0,0,m.RGBA,m.UNSIGNED_BYTE,this.video)):(this.texture=new Ue(l,this.video,m.RGBA),this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE));let w=!1;for(const P in this.tiles){const O=this.tiles[P];O.state!=="loaded"&&(O.state="loaded",O.texture=this.texture,w=!0)}w&&this.fire(new o.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Wr extends Mr{constructor(l,m,w,P){super(l,m,w,P),m.coordinates?Array.isArray(m.coordinates)&&m.coordinates.length===4&&!m.coordinates.some(O=>!Array.isArray(O)||O.length!==2||O.some(G=>typeof G!="number"))||this.fire(new o.j(new o.$(`sources.${l}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.j(new o.$(`sources.${l}`,null,'missing required property "coordinates"'))),m.animate&&typeof m.animate!="boolean"&&this.fire(new o.j(new o.$(`sources.${l}`,null,'optional "animate" property must be a boolean value'))),m.canvas?typeof m.canvas=="string"||m.canvas instanceof HTMLCanvasElement||this.fire(new o.j(new o.$(`sources.${l}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.j(new o.$(`sources.${l}`,null,'missing required property "canvas"'))),this.options=m,this.animate=m.animate===void 0||m.animate}load(){return o._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(l){this.map=l,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let l=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,l=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,l=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const m=this.map.painter.context,w=m.gl;this.texture?(l||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Ue(m,this.canvas,w.RGBA,{premultiply:!0});let P=!1;for(const O in this.tiles){const G=this.tiles[O];G.state!=="loaded"&&(G.state="loaded",G.texture=this.texture,P=!0)}P&&this.fire(new o.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const l of[this.canvas.width,this.canvas.height])if(isNaN(l)||l<=0)return!0;return!1}}const gn={},Bn=D=>{switch(D){case"geojson":return mr;case"image":return Mr;case"raster":return Pn;case"raster-dem":return mn;case"vector":return We;case"video":return en;case"canvas":return Wr}return gn[D]},Fn="RTLPluginLoaded";class $n extends o.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=nr()}_syncState(l){return this.status=l,this.dispatcher.broadcast("SRPS",{pluginStatus:l,pluginURL:this.url}).catch(m=>{throw this.status="error",m})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(l){return o._(this,arguments,void 0,function(m){var w=this;let P=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return function*(){if(w.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(w.url=T.resolveURL(m),!w.url)throw new Error(`requested url ${m} is invalid`);if(w.status==="unavailable"){if(!P)return w._requestImport();w.status="deferred",w._syncState(w.status)}else if(w.status==="requested")return w._requestImport()}()})}_requestImport(){return o._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new o.k(Fn))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let ei=null;function br(){return ei||(ei=new $n),ei}class Cn{constructor(l,m){this.timeAdded=0,this.fadeEndTime=0,this.tileID=l,this.uid=o.a1(),this.uses=0,this.tileSize=m,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(l){const m=l+this.timeAdded;m<this.fadeEndTime||(this.fadeEndTime=m)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(l){this.demTexture&&l.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(l,m,w){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",l){l.featureIndex&&(this.latestFeatureIndex=l.featureIndex,l.rawTileData?(this.latestRawTileData=l.rawTileData,this.latestFeatureIndex.rawTileData=l.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=l.collisionBoxArray,this.buckets=function(P,O){const G={};if(!O)return G;for(const J of P){const re=J.layerIds.map(oe=>O.getLayer(oe)).filter(Boolean);if(re.length!==0){J.layers=re,J.stateDependentLayerIds&&(J.stateDependentLayers=J.stateDependentLayerIds.map(oe=>re.filter(pe=>pe.id===oe)[0]));for(const oe of re)G[oe.id]=J}}return G}(l.buckets,m==null?void 0:m.style),this.hasSymbolBuckets=!1;for(const P in this.buckets){const O=this.buckets[P];if(O instanceof o.a3){if(this.hasSymbolBuckets=!0,!w)break;O.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const P in this.buckets){const O=this.buckets[P];if(O instanceof o.a3&&O.hasRTLText){this.hasRTLText=!0,br().lazyLoad();break}}this.queryPadding=0;for(const P in this.buckets){const O=this.buckets[P];this.queryPadding=Math.max(this.queryPadding,m.style.getLayer(P).queryRadius(O))}l.imageAtlas&&(this.imageAtlas=l.imageAtlas),l.glyphAtlasImage&&(this.glyphAtlasImage=l.glyphAtlasImage)}else this.collisionBoxArray=new o.a2}unloadVectorData(){for(const l in this.buckets)this.buckets[l].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(l){return this.buckets[l.id]}upload(l){for(const w in this.buckets){const P=this.buckets[w];P.uploadPending()&&P.upload(l)}const m=l.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Ue(l,this.imageAtlas.image,m.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Ue(l,this.glyphAtlasImage,m.ALPHA),this.glyphAtlasImage=null)}prepare(l){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(l,this.imageAtlasTexture)}queryRenderedFeatures(l,m,w,P,O,G,J,re,oe,pe){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:P,cameraQueryGeometry:O,scale:G,tileSize:this.tileSize,pixelPosMatrix:pe,transform:re,params:J,queryPadding:this.queryPadding*oe},l,m,w):{}}querySourceFeatures(l,m){const w=this.latestFeatureIndex;if(!w||!w.rawTileData)return;const P=w.loadVTLayers(),O=m&&m.sourceLayer?m.sourceLayer:"",G=P._geojsonTileLayer||P[O];if(!G)return;const J=o.a4(m&&m.filter),{z:re,x:oe,y:pe}=this.tileID.canonical,Ce={z:re,x:oe,y:pe};for(let Me=0;Me<G.length;Me++){const Ke=G.feature(Me);if(J.needGeometry){const ft=o.a5(Ke,!0);if(!J.filter(new o.z(this.tileID.overscaledZ),ft,this.tileID.canonical))continue}else if(!J.filter(new o.z(this.tileID.overscaledZ),Ke))continue;const Ye=w.getId(Ke,O),gt=new o.a6(Ke,re,oe,pe,Ye);gt.tile=Ce,l.push(gt)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(l){const m=this.expirationTime;if(l.cacheControl){const w=o.a7(l.cacheControl);w["max-age"]&&(this.expirationTime=Date.now()+1e3*w["max-age"])}else l.expires&&(this.expirationTime=new Date(l.expires).getTime());if(this.expirationTime){const w=Date.now();let P=!1;if(this.expirationTime>w)P=!1;else if(m)if(this.expirationTime<m)P=!0;else{const O=this.expirationTime-m;O?this.expirationTime=w+Math.max(O,3e4):P=!0}else P=!0;P?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(l,m){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(l).length===0)return;const w=this.latestFeatureIndex.loadVTLayers();for(const P in this.buckets){if(!m.style.hasLayer(P))continue;const O=this.buckets[P],G=O.layers[0].sourceLayer||"_geojsonTileLayer",J=w[G],re=l[G];if(!J||!re||Object.keys(re).length===0)continue;O.update(re,J,this.imageAtlas&&this.imageAtlas.patternPositions||{});const oe=m&&m.style&&m.style.getLayer(P);oe&&(this.queryPadding=Math.max(this.queryPadding,oe.queryRadius(O)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<T.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(l){this.symbolFadeHoldUntil=T.now()+l}setDependencies(l,m){const w={};for(const P of m)w[P]=!0;this.dependencies[l]=w}hasDependency(l,m){for(const w of l){const P=this.dependencies[w];if(P){for(const O of m)if(P[O])return!0}}return!1}}class Rn{constructor(l,m){this.max=l,this.onRemove=m,this.reset()}reset(){for(const l in this.data)for(const m of this.data[l])m.timeout&&clearTimeout(m.timeout),this.onRemove(m.value);return this.data={},this.order=[],this}add(l,m,w){const P=l.wrapped().key;this.data[P]===void 0&&(this.data[P]=[]);const O={value:m,timeout:void 0};if(w!==void 0&&(O.timeout=setTimeout(()=>{this.remove(l,O)},w)),this.data[P].push(O),this.order.push(P),this.order.length>this.max){const G=this._getAndRemoveByKey(this.order[0]);G&&this.onRemove(G)}return this}has(l){return l.wrapped().key in this.data}getAndRemove(l){return this.has(l)?this._getAndRemoveByKey(l.wrapped().key):null}_getAndRemoveByKey(l){const m=this.data[l].shift();return m.timeout&&clearTimeout(m.timeout),this.data[l].length===0&&delete this.data[l],this.order.splice(this.order.indexOf(l),1),m.value}getByKey(l){const m=this.data[l];return m?m[0].value:null}get(l){return this.has(l)?this.data[l.wrapped().key][0].value:null}remove(l,m){if(!this.has(l))return this;const w=l.wrapped().key,P=m===void 0?0:this.data[w].indexOf(m),O=this.data[w][P];return this.data[w].splice(P,1),O.timeout&&clearTimeout(O.timeout),this.data[w].length===0&&delete this.data[w],this.onRemove(O.value),this.order.splice(this.order.indexOf(w),1),this}setMaxSize(l){for(this.max=l;this.order.length>this.max;){const m=this._getAndRemoveByKey(this.order[0]);m&&this.onRemove(m)}return this}filter(l){const m=[];for(const w in this.data)for(const P of this.data[w])l(P.value)||m.push(P);for(const w of m)this.remove(w.value.tileID,w)}}class nn{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(l,m,w){const P=String(m);if(this.stateChanges[l]=this.stateChanges[l]||{},this.stateChanges[l][P]=this.stateChanges[l][P]||{},o.e(this.stateChanges[l][P],w),this.deletedStates[l]===null){this.deletedStates[l]={};for(const O in this.state[l])O!==P&&(this.deletedStates[l][O]=null)}else if(this.deletedStates[l]&&this.deletedStates[l][P]===null){this.deletedStates[l][P]={};for(const O in this.state[l][P])w[O]||(this.deletedStates[l][P][O]=null)}else for(const O in w)this.deletedStates[l]&&this.deletedStates[l][P]&&this.deletedStates[l][P][O]===null&&delete this.deletedStates[l][P][O]}removeFeatureState(l,m,w){if(this.deletedStates[l]===null)return;const P=String(m);if(this.deletedStates[l]=this.deletedStates[l]||{},w&&m!==void 0)this.deletedStates[l][P]!==null&&(this.deletedStates[l][P]=this.deletedStates[l][P]||{},this.deletedStates[l][P][w]=null);else if(m!==void 0)if(this.stateChanges[l]&&this.stateChanges[l][P])for(w in this.deletedStates[l][P]={},this.stateChanges[l][P])this.deletedStates[l][P][w]=null;else this.deletedStates[l][P]=null;else this.deletedStates[l]=null}getState(l,m){const w=String(m),P=o.e({},(this.state[l]||{})[w],(this.stateChanges[l]||{})[w]);if(this.deletedStates[l]===null)return{};if(this.deletedStates[l]){const O=this.deletedStates[l][m];if(O===null)return{};for(const G in O)delete P[G]}return P}initializeTileState(l,m){l.setFeatureState(this.state,m)}coalesceChanges(l,m){const w={};for(const P in this.stateChanges){this.state[P]=this.state[P]||{};const O={};for(const G in this.stateChanges[P])this.state[P][G]||(this.state[P][G]={}),o.e(this.state[P][G],this.stateChanges[P][G]),O[G]=this.state[P][G];w[P]=O}for(const P in this.deletedStates){this.state[P]=this.state[P]||{};const O={};if(this.deletedStates[P]===null)for(const G in this.state[P])O[G]={},this.state[P][G]={};else for(const G in this.deletedStates[P]){if(this.deletedStates[P][G]===null)this.state[P][G]={};else for(const J of Object.keys(this.deletedStates[P][G]))delete this.state[P][G][J];O[G]=this.state[P][G]}w[P]=w[P]||{},o.e(w[P],O)}if(this.stateChanges={},this.deletedStates={},Object.keys(w).length!==0)for(const P in l)l[P].setFeatureState(w,m)}}function Ci(D,l,m){const w=l.intersectsFrustum(D);if(!m)return w;const P=l.intersectsPlane(m);return w===0||P===0?0:w===2&&P===2?2:1}function Cr(D,l,m,w,P){let O=D;const G=Math.atan(l/m),J=Math.hypot(l,m);return O=D+o.a8(w/J/Math.max(.5,Math.cos(o.aa(P/2)))),O+=1*o.a8(Math.cos(G))/2,O+=o.ab(D-O,-0,0),O}function Tn(D,l){const m=(l.roundZoom?Math.round:Math.floor)(D.zoom+o.a8(D.tileSize/l.tileSize));return Math.max(0,m)}function Xe(D,l){const m=D.getCameraFrustum(),w=D.getClippingPlane(),P=D.screenPointToMercatorCoordinate(D.getCameraPoint()),O=o.Y.fromLngLat(D.center,D.elevation);P.z=O.z+Math.cos(D.pitchInRadians)*D.cameraToCenterDistance/D.worldSize;const G=D.getCoveringTilesDetailsProvider(),J=G.allowVariableZoom(D,l),re=Tn(D,l),oe=l.minzoom||0,pe=l.maxzoom!==void 0?l.maxzoom:D.maxZoom,Ce=Math.min(Math.max(0,re),pe),Me=Math.pow(2,Ce),Ke=[Me*P.x,Me*P.y,0],Ye=[Me*O.x,Me*O.y,0],gt=Math.hypot(O.x-P.x,O.y-P.y),ft=Math.abs(O.z-P.z),mt=Math.hypot(gt,ft),xt=Ut=>({zoom:0,x:0,y:0,wrap:Ut,fullyVisible:!1}),Ft=[],Dt=[];if(D.renderWorldCopies&&G.allowWorldCopies())for(let Ut=1;Ut<=3;Ut++)Ft.push(xt(-Ut)),Ft.push(xt(Ut));for(Ft.push(xt(0));Ft.length>0;){const Ut=Ft.pop(),Gt=Ut.x,zt=Ut.y;let ir=Ut.fullyVisible;const sr={x:Gt,y:zt,z:Ut.zoom},gr=G.getTileAABB(sr,Ut.wrap,D.elevation,l);if(!ir){const Jr=Ci(m,gr,w);if(Jr===0)continue;ir=Jr===2}const Er=G.distanceToTile2d(P.x,P.y,sr,gr);let fr=re;J&&(fr=(l.calculateTileZoom||Cr)(D.zoom+o.a8(D.tileSize/l.tileSize),Er,ft,mt,D.fov)),fr=(l.roundZoom?Math.round:Math.floor)(fr),fr=Math.max(0,fr);const qr=Math.min(fr,pe);if(Ut.wrap=G.getWrap(O,sr,Ut.wrap),Ut.zoom>=qr){if(Ut.zoom<oe)continue;const Jr=Ce-Ut.zoom,Sr=Ke[0]-.5-(Gt<<Jr),tn=Ke[1]-.5-(zt<<Jr),Yn=l.reparseOverscaled?Math.max(Ut.zoom,fr):Ut.zoom;Dt.push({tileID:new o.S(Ut.zoom===pe?Yn:Ut.zoom,Ut.wrap,Ut.zoom,Gt,zt),distanceSq:o.a9([Ye[0]-.5-Gt,Ye[1]-.5-zt]),tileDistanceToCamera:Math.sqrt(Sr*Sr+tn*tn)})}else for(let Jr=0;Jr<4;Jr++)Ft.push({zoom:Ut.zoom+1,x:(Gt<<1)+Jr%2,y:(zt<<1)+(Jr>>1),wrap:Ut.wrap,fullyVisible:ir})}return Dt.sort((Ut,Gt)=>Ut.distanceSq-Gt.distanceSq).map(Ut=>Ut.tileID)}class He extends o.E{constructor(l,m,w){super(),this.id=l,this.dispatcher=w,this.on("data",P=>this._dataHandler(P)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((P,O,G,J)=>{const re=new(Bn(O.type))(P,O,G,J);if(re.id!==P)throw new Error(`Expected Source id to be ${P} instead of ${re.id}`);return re})(l,m,w,this),this._tiles={},this._cache=new Rn(0,P=>this._unloadTile(P)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new nn,this._didEmitContent=!1,this._updated=!1}onAdd(l){this.map=l,this._maxTileCacheSize=l?l._maxTileCacheSize:null,this._maxTileCacheZoomLevels=l?l._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(l)}onRemove(l){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(l)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const l in this._tiles){const m=this._tiles[l];if(m.state!=="loaded"&&m.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const l=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,l&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(l,m,w){return o._(this,void 0,void 0,function*(){try{yield this._source.loadTile(l),this._tileLoaded(l,m,w)}catch(P){l.state="errored",P.status!==404?this._source.fire(new o.j(P,{tile:l})):this.update(this.transform,this.terrain)}})}_unloadTile(l){this._source.unloadTile&&this._source.unloadTile(l)}_abortTile(l){this._source.abortTile&&this._source.abortTile(l),this._source.fire(new o.k("dataabort",{tile:l,coord:l.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(l){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const m in this._tiles){const w=this._tiles[m];w.upload(l),w.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(l=>l.tileID).sort(Je).map(l=>l.key)}getRenderableIds(l){const m=[];for(const w in this._tiles)this._isIdRenderable(w,l)&&m.push(this._tiles[w]);return l?m.sort((w,P)=>{const O=w.tileID,G=P.tileID,J=new o.P(O.canonical.x,O.canonical.y)._rotate(-this.transform.bearingInRadians),re=new o.P(G.canonical.x,G.canonical.y)._rotate(-this.transform.bearingInRadians);return O.overscaledZ-G.overscaledZ||re.y-J.y||re.x-J.x}).map(w=>w.tileID.key):m.map(w=>w.tileID).sort(Je).map(w=>w.key)}hasRenderableParent(l){const m=this.findLoadedParent(l,0);return!!m&&this._isIdRenderable(m.tileID.key)}_isIdRenderable(l,m){return this._tiles[l]&&this._tiles[l].hasData()&&!this._coveredTiles[l]&&(m||!this._tiles[l].holdingForFade())}reload(l){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const m in this._tiles)(l||this._tiles[m].state!=="errored")&&this._reloadTile(m,"reloading")}}_reloadTile(l,m){return o._(this,void 0,void 0,function*(){const w=this._tiles[l];w&&(w.state!=="loading"&&(w.state=m),yield this._loadTile(w,l,m))})}_tileLoaded(l,m,w){l.timeAdded=T.now(),w==="expired"&&(l.refreshedUponExpiration=!0),this._setTileReloadTimer(m,l),this.getSource().type==="raster-dem"&&l.dem&&this._backfillDEM(l),this._state.initializeTileState(l,this.map?this.map.painter:null),l.aborted||this._source.fire(new o.k("data",{dataType:"source",tile:l,coord:l.tileID}))}_backfillDEM(l){const m=this.getRenderableIds();for(let P=0;P<m.length;P++){const O=m[P];if(l.neighboringTiles&&l.neighboringTiles[O]){const G=this.getTileByID(O);w(l,G),w(G,l)}}function w(P,O){P.needsHillshadePrepare=!0,P.needsTerrainPrepare=!0;let G=O.tileID.canonical.x-P.tileID.canonical.x;const J=O.tileID.canonical.y-P.tileID.canonical.y,re=Math.pow(2,P.tileID.canonical.z),oe=O.tileID.key;G===0&&J===0||Math.abs(J)>1||(Math.abs(G)>1&&(Math.abs(G+re)===1?G+=re:Math.abs(G-re)===1&&(G-=re)),O.dem&&P.dem&&(P.dem.backfillBorder(O.dem,G,J),P.neighboringTiles&&P.neighboringTiles[oe]&&(P.neighboringTiles[oe].backfilled=!0)))}}getTile(l){return this.getTileByID(l.key)}getTileByID(l){return this._tiles[l]}_retainLoadedChildren(l,m,w,P){for(const O in this._tiles){let G=this._tiles[O];if(P[O]||!G.hasData()||G.tileID.overscaledZ<=m||G.tileID.overscaledZ>w)continue;let J=G.tileID;for(;G&&G.tileID.overscaledZ>m+1;){const oe=G.tileID.scaledTo(G.tileID.overscaledZ-1);G=this._tiles[oe.key],G&&G.hasData()&&(J=oe)}let re=J;for(;re.overscaledZ>m;)if(re=re.scaledTo(re.overscaledZ-1),l[re.key]||l[re.canonical.key]){P[J.key]=J;break}}}findLoadedParent(l,m){if(l.key in this._loadedParentTiles){const w=this._loadedParentTiles[l.key];return w&&w.tileID.overscaledZ>=m?w:null}for(let w=l.overscaledZ-1;w>=m;w--){const P=l.scaledTo(w),O=this._getLoadedTile(P);if(O)return O}}findLoadedSibling(l){return this._getLoadedTile(l)}_getLoadedTile(l){const m=this._tiles[l.key];return m&&m.hasData()?m:this._cache.getByKey(l.wrapped().key)}updateCacheSize(l){const m=Math.ceil(l.width/this._source.tileSize)+1,w=Math.ceil(l.height/this._source.tileSize)+1,P=Math.floor(m*w*(this._maxTileCacheZoomLevels===null?o.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),O=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,P):P;this._cache.setMaxSize(O)}handleWrapJump(l){const m=Math.round((l-(this._prevLng===void 0?l:this._prevLng))/360);if(this._prevLng=l,m){const w={};for(const P in this._tiles){const O=this._tiles[P];O.tileID=O.tileID.unwrapTo(O.tileID.wrap+m),w[O.tileID.key]=O}this._tiles=w;for(const P in this._timers)clearTimeout(this._timers[P]),delete this._timers[P];for(const P in this._tiles)this._setTileReloadTimer(P,this._tiles[P])}}_updateCoveredAndRetainedTiles(l,m,w,P,O,G){const J={},re={},oe=Object.keys(l),pe=T.now();for(const Ce of oe){const Me=l[Ce],Ke=this._tiles[Ce];if(!Ke||Ke.fadeEndTime!==0&&Ke.fadeEndTime<=pe)continue;const Ye=this.findLoadedParent(Me,m),gt=this.findLoadedSibling(Me),ft=Ye||gt||null;ft&&(this._addTile(ft.tileID),J[ft.tileID.key]=ft.tileID),re[Ce]=Me}this._retainLoadedChildren(re,P,w,l);for(const Ce in J)l[Ce]||(this._coveredTiles[Ce]=!0,l[Ce]=J[Ce]);if(G){const Ce={},Me={};for(const Ke of O)this._tiles[Ke.key].hasData()?Ce[Ke.key]=Ke:Me[Ke.key]=Ke;for(const Ke in Me){const Ye=Me[Ke].children(this._source.maxzoom);this._tiles[Ye[0].key]&&this._tiles[Ye[1].key]&&this._tiles[Ye[2].key]&&this._tiles[Ye[3].key]&&(Ce[Ye[0].key]=l[Ye[0].key]=Ye[0],Ce[Ye[1].key]=l[Ye[1].key]=Ye[1],Ce[Ye[2].key]=l[Ye[2].key]=Ye[2],Ce[Ye[3].key]=l[Ye[3].key]=Ye[3],delete Me[Ke])}for(const Ke in Me){const Ye=Me[Ke],gt=this.findLoadedParent(Ye,this._source.minzoom),ft=this.findLoadedSibling(Ye),mt=gt||ft||null;if(mt){Ce[mt.tileID.key]=l[mt.tileID.key]=mt.tileID;for(const xt in Ce)Ce[xt].isChildOf(mt.tileID)&&delete Ce[xt]}}for(const Ke in this._tiles)Ce[Ke]||(this._coveredTiles[Ke]=!0)}}update(l,m){if(!this._sourceLoaded||this._paused)return;let w;this.transform=l,this.terrain=m,this.updateCacheSize(l),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?w=l.getVisibleUnwrappedCoordinates(this._source.tileID).map(pe=>new o.S(pe.canonical.z,pe.wrap,pe.canonical.z,pe.canonical.x,pe.canonical.y)):(w=Xe(l,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:m,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(w=w.filter(pe=>this._source.hasTile(pe)))):w=[];const P=Tn(l,this._source),O=Math.max(P-He.maxOverzooming,this._source.minzoom),G=Math.max(P+He.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const pe={};for(const Ce of w)if(Ce.canonical.z>this._source.minzoom){const Me=Ce.scaledTo(Ce.canonical.z-1);pe[Me.key]=Me;const Ke=Ce.scaledTo(Math.max(this._source.minzoom,Math.min(Ce.canonical.z,5)));pe[Ke.key]=Ke}w=w.concat(Object.values(pe))}const J=w.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,J&&this.fire(new o.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const re=this._updateRetainedTiles(w,P);Ve(this._source.type)&&this._updateCoveredAndRetainedTiles(re,O,G,P,w,m);for(const pe in re)this._tiles[pe].clearFadeHold();const oe=o.ac(this._tiles,re);for(const pe of oe){const Ce=this._tiles[pe];Ce.hasSymbolBuckets&&!Ce.holdingForFade()?Ce.setHoldDuration(this.map._fadeDuration):Ce.hasSymbolBuckets&&!Ce.symbolFadeFinished()||this._removeTile(pe)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const l in this._tiles)this._tiles[l].holdingForFade()&&this._removeTile(l)}_updateRetainedTiles(l,m){var w;const P={},O={},G=Math.max(m-He.maxOverzooming,this._source.minzoom),J=Math.max(m+He.maxUnderzooming,this._source.minzoom),re={};for(const oe of l){const pe=this._addTile(oe);P[oe.key]=oe,pe.hasData()||m<this._source.maxzoom&&(re[oe.key]=oe)}this._retainLoadedChildren(re,m,J,P);for(const oe of l){let pe=this._tiles[oe.key];if(pe.hasData())continue;if(m+1>this._source.maxzoom){const Me=oe.children(this._source.maxzoom)[0],Ke=this.getTile(Me);if(Ke&&Ke.hasData()){P[Me.key]=Me;continue}}else{const Me=oe.children(this._source.maxzoom);if(P[Me[0].key]&&P[Me[1].key]&&P[Me[2].key]&&P[Me[3].key])continue}let Ce=pe.wasRequested();for(let Me=oe.overscaledZ-1;Me>=G;--Me){const Ke=oe.scaledTo(Me);if(O[Ke.key])break;if(O[Ke.key]=!0,pe=this.getTile(Ke),!pe&&Ce&&(pe=this._addTile(Ke)),pe){const Ye=pe.hasData();if((Ye||!(!((w=this.map)===null||w===void 0)&&w.cancelPendingTileRequestsWhileZooming)||Ce)&&(P[Ke.key]=Ke),Ce=pe.wasRequested(),Ye)break}}}return P}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const l in this._tiles){const m=[];let w,P=this._tiles[l].tileID;for(;P.overscaledZ>0;){if(P.key in this._loadedParentTiles){w=this._loadedParentTiles[P.key];break}m.push(P.key);const O=P.scaledTo(P.overscaledZ-1);if(w=this._getLoadedTile(O),w)break;P=O}for(const O of m)this._loadedParentTiles[O]=w}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const l in this._tiles){const m=this._tiles[l].tileID,w=this._getLoadedTile(m);this._loadedSiblingTiles[m.key]=w}}_addTile(l){let m=this._tiles[l.key];if(m)return m;m=this._cache.getAndRemove(l),m&&(this._setTileReloadTimer(l.key,m),m.tileID=l,this._state.initializeTileState(m,this.map?this.map.painter:null),this._cacheTimers[l.key]&&(clearTimeout(this._cacheTimers[l.key]),delete this._cacheTimers[l.key],this._setTileReloadTimer(l.key,m)));const w=m;return m||(m=new Cn(l,this._source.tileSize*l.overscaleFactor()),this._loadTile(m,l.key,m.state)),m.uses++,this._tiles[l.key]=m,w||this._source.fire(new o.k("dataloading",{tile:m,coord:m.tileID,dataType:"source"})),m}_setTileReloadTimer(l,m){l in this._timers&&(clearTimeout(this._timers[l]),delete this._timers[l]);const w=m.getExpiryTimeout();w&&(this._timers[l]=setTimeout(()=>{this._reloadTile(l,"expired"),delete this._timers[l]},w))}_removeTile(l){const m=this._tiles[l];m&&(m.uses--,delete this._tiles[l],this._timers[l]&&(clearTimeout(this._timers[l]),delete this._timers[l]),m.uses>0||(m.hasData()&&m.state!=="reloading"?this._cache.add(m.tileID,m,m.getExpiryTimeout()):(m.aborted=!0,this._abortTile(m),this._unloadTile(m))))}_dataHandler(l){const m=l.sourceDataType;l.dataType==="source"&&m==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&l.dataType==="source"&&m==="content"&&(this.reload(l.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const l in this._tiles)this._removeTile(l);this._cache.reset()}tilesIn(l,m,w){const P=[],O=this.transform;if(!O)return P;const G=w?O.getCameraQueryGeometry(l):l,J=l.map(Ye=>O.screenPointToMercatorCoordinate(Ye,this.terrain)),re=G.map(Ye=>O.screenPointToMercatorCoordinate(Ye,this.terrain)),oe=this.getIds();let pe=1/0,Ce=1/0,Me=-1/0,Ke=-1/0;for(const Ye of re)pe=Math.min(pe,Ye.x),Ce=Math.min(Ce,Ye.y),Me=Math.max(Me,Ye.x),Ke=Math.max(Ke,Ye.y);for(let Ye=0;Ye<oe.length;Ye++){const gt=this._tiles[oe[Ye]];if(gt.holdingForFade())continue;const ft=gt.tileID,mt=Math.pow(2,O.zoom-gt.tileID.overscaledZ),xt=m*gt.queryPadding*o.X/gt.tileSize/mt,Ft=[ft.getTilePoint(new o.Y(pe,Ce)),ft.getTilePoint(new o.Y(Me,Ke))];if(Ft[0].x-xt<o.X&&Ft[0].y-xt<o.X&&Ft[1].x+xt>=0&&Ft[1].y+xt>=0){const Dt=J.map(Gt=>ft.getTilePoint(Gt)),Ut=re.map(Gt=>ft.getTilePoint(Gt));P.push({tile:gt,tileID:ft,queryGeometry:Dt,cameraQueryGeometry:Ut,scale:mt})}}return P}getVisibleCoordinates(l){const m=this.getRenderableIds(l).map(w=>this._tiles[w].tileID);return this.transform&&this.transform.populateCache(m),m}hasTransition(){if(this._source.hasTransition())return!0;if(Ve(this._source.type)){const l=T.now();for(const m in this._tiles)if(this._tiles[m].fadeEndTime>=l)return!0}return!1}setFeatureState(l,m,w){this._state.updateState(l=l||"_geojsonTileLayer",m,w)}removeFeatureState(l,m,w){this._state.removeFeatureState(l=l||"_geojsonTileLayer",m,w)}getFeatureState(l,m){return this._state.getState(l=l||"_geojsonTileLayer",m)}setDependencies(l,m,w){const P=this._tiles[l];P&&P.setDependencies(m,w)}reloadTilesForDependencies(l,m){for(const w in this._tiles)this._tiles[w].hasDependency(l,m)&&this._reloadTile(w,"reloading");this._cache.filter(w=>!w.hasDependency(l,m))}}function Je(D,l){const m=Math.abs(2*D.wrap)-+(D.wrap<0),w=Math.abs(2*l.wrap)-+(l.wrap<0);return D.overscaledZ-l.overscaledZ||w-m||l.canonical.y-D.canonical.y||l.canonical.x-D.canonical.x}function Ve(D){return D==="raster"||D==="image"||D==="video"}He.maxOverzooming=10,He.maxUnderzooming=3;class bt{constructor(l,m){this.reset(l,m)}reset(l,m){this.points=l||[],this._distances=[0];for(let w=1;w<this.points.length;w++)this._distances[w]=this._distances[w-1]+this.points[w].dist(this.points[w-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(m||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(l){if(this.points.length===1)return this.points[0];l=o.ab(l,0,1);let m=1,w=this._distances[m];const P=l*this.paddedLength+this.padding;for(;w<P&&m<this._distances.length;)w=this._distances[++m];const O=m-1,G=this._distances[O],J=w-G,re=J>0?(P-G)/J:0;return this.points[O].mult(1-re).add(this.points[m].mult(re))}}function Mt(D,l){let m=!0;return D==="always"||D!=="never"&&l!=="never"||(m=!1),m}class $t{constructor(l,m,w){const P=this.boxCells=[],O=this.circleCells=[];this.xCellCount=Math.ceil(l/w),this.yCellCount=Math.ceil(m/w);for(let G=0;G<this.xCellCount*this.yCellCount;G++)P.push([]),O.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=m,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/m,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(l,m,w,P,O){this._forEachCell(m,w,P,O,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(m),this.bboxes.push(w),this.bboxes.push(P),this.bboxes.push(O)}insertCircle(l,m,w,P){this._forEachCell(m-P,w-P,m+P,w+P,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(m),this.circles.push(w),this.circles.push(P)}_insertBoxCell(l,m,w,P,O,G){this.boxCells[O].push(G)}_insertCircleCell(l,m,w,P,O,G){this.circleCells[O].push(G)}_query(l,m,w,P,O,G,J){if(w<0||l>this.width||P<0||m>this.height)return[];const re=[];if(l<=0&&m<=0&&this.width<=w&&this.height<=P){if(O)return[{key:null,x1:l,y1:m,x2:w,y2:P}];for(let oe=0;oe<this.boxKeys.length;oe++)re.push({key:this.boxKeys[oe],x1:this.bboxes[4*oe],y1:this.bboxes[4*oe+1],x2:this.bboxes[4*oe+2],y2:this.bboxes[4*oe+3]});for(let oe=0;oe<this.circleKeys.length;oe++){const pe=this.circles[3*oe],Ce=this.circles[3*oe+1],Me=this.circles[3*oe+2];re.push({key:this.circleKeys[oe],x1:pe-Me,y1:Ce-Me,x2:pe+Me,y2:Ce+Me})}}else this._forEachCell(l,m,w,P,this._queryCell,re,{hitTest:O,overlapMode:G,seenUids:{box:{},circle:{}}},J);return re}query(l,m,w,P){return this._query(l,m,w,P,!1,null)}hitTest(l,m,w,P,O,G){return this._query(l,m,w,P,!0,O,G).length>0}hitTestCircle(l,m,w,P,O){const G=l-w,J=l+w,re=m-w,oe=m+w;if(J<0||G>this.width||oe<0||re>this.height)return!1;const pe=[];return this._forEachCell(G,re,J,oe,this._queryCellCircle,pe,{hitTest:!0,overlapMode:P,circle:{x:l,y:m,radius:w},seenUids:{box:{},circle:{}}},O),pe.length>0}_queryCell(l,m,w,P,O,G,J,re){const{seenUids:oe,hitTest:pe,overlapMode:Ce}=J,Me=this.boxCells[O];if(Me!==null){const Ye=this.bboxes;for(const gt of Me)if(!oe.box[gt]){oe.box[gt]=!0;const ft=4*gt,mt=this.boxKeys[gt];if(l<=Ye[ft+2]&&m<=Ye[ft+3]&&w>=Ye[ft+0]&&P>=Ye[ft+1]&&(!re||re(mt))&&(!pe||!Mt(Ce,mt.overlapMode))&&(G.push({key:mt,x1:Ye[ft],y1:Ye[ft+1],x2:Ye[ft+2],y2:Ye[ft+3]}),pe))return!0}}const Ke=this.circleCells[O];if(Ke!==null){const Ye=this.circles;for(const gt of Ke)if(!oe.circle[gt]){oe.circle[gt]=!0;const ft=3*gt,mt=this.circleKeys[gt];if(this._circleAndRectCollide(Ye[ft],Ye[ft+1],Ye[ft+2],l,m,w,P)&&(!re||re(mt))&&(!pe||!Mt(Ce,mt.overlapMode))){const xt=Ye[ft],Ft=Ye[ft+1],Dt=Ye[ft+2];if(G.push({key:mt,x1:xt-Dt,y1:Ft-Dt,x2:xt+Dt,y2:Ft+Dt}),pe)return!0}}}return!1}_queryCellCircle(l,m,w,P,O,G,J,re){const{circle:oe,seenUids:pe,overlapMode:Ce}=J,Me=this.boxCells[O];if(Me!==null){const Ye=this.bboxes;for(const gt of Me)if(!pe.box[gt]){pe.box[gt]=!0;const ft=4*gt,mt=this.boxKeys[gt];if(this._circleAndRectCollide(oe.x,oe.y,oe.radius,Ye[ft+0],Ye[ft+1],Ye[ft+2],Ye[ft+3])&&(!re||re(mt))&&!Mt(Ce,mt.overlapMode))return G.push(!0),!0}}const Ke=this.circleCells[O];if(Ke!==null){const Ye=this.circles;for(const gt of Ke)if(!pe.circle[gt]){pe.circle[gt]=!0;const ft=3*gt,mt=this.circleKeys[gt];if(this._circlesCollide(Ye[ft],Ye[ft+1],Ye[ft+2],oe.x,oe.y,oe.radius)&&(!re||re(mt))&&!Mt(Ce,mt.overlapMode))return G.push(!0),!0}}}_forEachCell(l,m,w,P,O,G,J,re){const oe=this._convertToXCellCoord(l),pe=this._convertToYCellCoord(m),Ce=this._convertToXCellCoord(w),Me=this._convertToYCellCoord(P);for(let Ke=oe;Ke<=Ce;Ke++)for(let Ye=pe;Ye<=Me;Ye++)if(O.call(this,l,m,w,P,this.xCellCount*Ye+Ke,G,J,re))return}_convertToXCellCoord(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))}_convertToYCellCoord(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))}_circlesCollide(l,m,w,P,O,G){const J=P-l,re=O-m,oe=w+G;return oe*oe>J*J+re*re}_circleAndRectCollide(l,m,w,P,O,G,J){const re=(G-P)/2,oe=Math.abs(l-(P+re));if(oe>re+w)return!1;const pe=(J-O)/2,Ce=Math.abs(m-(O+pe));if(Ce>pe+w)return!1;if(oe<=re||Ce<=pe)return!0;const Me=oe-re,Ke=Ce-pe;return Me*Me+Ke*Ke<=w*w}}function Wt(D,l,m){const w=o.H();if(!D){const{vecSouth:Ce,vecEast:Me}=Ae(l),Ke=f();Ke[0]=Me[0],Ke[1]=Me[1],Ke[2]=Ce[0],Ke[3]=Ce[1],P=Ke,(pe=(G=(O=Ke)[0])*(oe=O[3])-(re=O[2])*(J=O[1]))&&(P[0]=oe*(pe=1/pe),P[1]=-J*pe,P[2]=-re*pe,P[3]=G*pe),w[0]=Ke[0],w[1]=Ke[1],w[4]=Ke[2],w[5]=Ke[3]}var P,O,G,J,re,oe,pe;return o.K(w,w,[1/m,1/m,1]),w}function Pe(D,l,m,w){if(D){const P=o.H();if(!l){const{vecSouth:O,vecEast:G}=Ae(m);P[0]=G[0],P[1]=G[1],P[4]=O[0],P[5]=O[1]}return o.K(P,P,[w,w,1]),P}return m.pixelsToClipSpaceMatrix}function Ae(D){const l=Math.cos(D.rollInRadians),m=Math.sin(D.rollInRadians),w=Math.cos(D.pitchInRadians),P=Math.cos(D.bearingInRadians),O=Math.sin(D.bearingInRadians),G=o.ad();G[0]=-P*w*m-O*l,G[1]=-O*w*m+P*l;const J=o.ae(G);J<1e-9?o.af(G):o.ag(G,G,1/J);const re=o.ad();re[0]=P*w*l-O*m,re[1]=O*w*l+P*m;const oe=o.ae(re);return oe<1e-9?o.af(re):o.ag(re,re,1/oe),{vecEast:re,vecSouth:G}}function ge(D,l,m,w){let P;w?(P=[D,l,w(D,l),1],o.al(P,P,m)):(P=[D,l,0,1],jn(P,P,m));const O=P[3];return{point:new o.P(P[0]/O,P[1]/O),signedDistanceFromCamera:O,isOccluded:!1}}function we(D,l){return .5+D/l*.5}function Se(D,l){return D.x>=-l[0]&&D.x<=l[0]&&D.y>=-l[1]&&D.y<=l[1]}function ht(D,l,m,w,P,O,G,J,re,oe,pe,Ce,Me){const Ke=m?D.textSizeData:D.iconSizeData,Ye=o.ah(Ke,l.transform.zoom),gt=[256/l.width*2+1,256/l.height*2+1],ft=m?D.text.dynamicLayoutVertexArray:D.icon.dynamicLayoutVertexArray;ft.clear();const mt=D.lineVertexArray,xt=m?D.text.placedSymbolArray:D.icon.placedSymbolArray,Ft=l.transform.width/l.transform.height;let Dt=!1;for(let Ut=0;Ut<xt.length;Ut++){const Gt=xt.get(Ut);if(Gt.hidden||Gt.writingMode===o.ai.vertical&&!Dt){_n(Gt.numGlyphs,ft);continue}Dt=!1;const zt=new o.P(Gt.anchorX,Gt.anchorY),ir={getElevation:Me,pitchedLabelPlaneMatrix:w,lineVertexArray:mt,pitchWithMap:O,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:l.transform,tileAnchorPoint:zt,unwrappedTileID:re,width:oe,height:pe,translation:Ce},sr=zr(Gt.anchorX,Gt.anchorY,ir);if(!Se(sr.point,gt)){_n(Gt.numGlyphs,ft);continue}const gr=we(l.transform.cameraToCenterDistance,sr.signedDistanceFromCamera),Er=o.aj(Ke,Ye,Gt),fr=O?Er*l.transform.getPitchedTextCorrection(Gt.anchorX,Gt.anchorY,re)/gr:Er*gr,qr=dt({projectionContext:ir,pitchedLabelPlaneMatrixInverse:P,symbol:Gt,fontSize:fr,flip:!1,keepUpright:G,glyphOffsetArray:D.glyphOffsetArray,dynamicLayoutVertexArray:ft,aspectRatio:Ft,rotateToLine:J});Dt=qr.useVertical,(qr.notEnoughRoom||Dt||qr.needsFlipping&&dt({projectionContext:ir,pitchedLabelPlaneMatrixInverse:P,symbol:Gt,fontSize:fr,flip:!0,keepUpright:G,glyphOffsetArray:D.glyphOffsetArray,dynamicLayoutVertexArray:ft,aspectRatio:Ft,rotateToLine:J}).notEnoughRoom)&&_n(Gt.numGlyphs,ft)}m?D.text.dynamicLayoutVertexBuffer.updateData(ft):D.icon.dynamicLayoutVertexBuffer.updateData(ft)}function At(D,l,m,w,P,O,G,J){const re=O.glyphStartIndex+O.numGlyphs,oe=O.lineStartIndex,pe=O.lineStartIndex+O.lineLength,Ce=l.getoffsetX(O.glyphStartIndex),Me=l.getoffsetX(re-1),Ke=ln(D*Ce,m,w,P,O.segment,oe,pe,J,G);if(!Ke)return null;const Ye=ln(D*Me,m,w,P,O.segment,oe,pe,J,G);return Ye?J.projectionCache.anyProjectionOccluded?null:{first:Ke,last:Ye}:null}function _t(D,l,m,w){return D===o.ai.horizontal&&Math.abs(m.y-l.y)>Math.abs(m.x-l.x)*w?{useVertical:!0}:(D===o.ai.vertical?l.y<m.y:l.x>m.x)?{needsFlipping:!0}:null}function dt(D){const{projectionContext:l,pitchedLabelPlaneMatrixInverse:m,symbol:w,fontSize:P,flip:O,keepUpright:G,glyphOffsetArray:J,dynamicLayoutVertexArray:re,aspectRatio:oe,rotateToLine:pe}=D,Ce=P/24,Me=w.lineOffsetX*Ce,Ke=w.lineOffsetY*Ce;let Ye;if(w.numGlyphs>1){const gt=w.glyphStartIndex+w.numGlyphs,ft=w.lineStartIndex,mt=w.lineStartIndex+w.lineLength,xt=At(Ce,J,Me,Ke,O,w,pe,l);if(!xt)return{notEnoughRoom:!0};const Ft=dr(xt.first.point.x,xt.first.point.y,l,m),Dt=dr(xt.last.point.x,xt.last.point.y,l,m);if(G&&!O){const Ut=_t(w.writingMode,Ft,Dt,oe);if(Ut)return Ut}Ye=[xt.first];for(let Ut=w.glyphStartIndex+1;Ut<gt-1;Ut++)Ye.push(ln(Ce*J.getoffsetX(Ut),Me,Ke,O,w.segment,ft,mt,l,pe));Ye.push(xt.last)}else{if(G&&!O){const ft=Rt(l.tileAnchorPoint.x,l.tileAnchorPoint.y,l).point,mt=w.lineStartIndex+w.segment+1,xt=new o.P(l.lineVertexArray.getx(mt),l.lineVertexArray.gety(mt)),Ft=Rt(xt.x,xt.y,l),Dt=Ft.signedDistanceFromCamera>0?Ft.point:yt(l.tileAnchorPoint,xt,ft,1,l),Ut=dr(ft.x,ft.y,l,m),Gt=dr(Dt.x,Dt.y,l,m),zt=_t(w.writingMode,Ut,Gt,oe);if(zt)return zt}const gt=ln(Ce*J.getoffsetX(w.glyphStartIndex),Me,Ke,O,w.segment,w.lineStartIndex,w.lineStartIndex+w.lineLength,l,pe);if(!gt||l.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};Ye=[gt]}for(const gt of Ye)o.ak(re,gt.point,gt.angle);return{}}function yt(D,l,m,w,P){const O=D.add(D.sub(l)._unit()),G=Rt(O.x,O.y,P).point,J=m.sub(G);return m.add(J._mult(w/J.mag()))}function Nt(D,l,m){const w=l.projectionCache;if(w.projections[D])return w.projections[D];const P=new o.P(l.lineVertexArray.getx(D),l.lineVertexArray.gety(D)),O=Rt(P.x,P.y,l);if(O.signedDistanceFromCamera>0)return w.projections[D]=O.point,w.anyProjectionOccluded=w.anyProjectionOccluded||O.isOccluded,O.point;const G=D-m.direction;return yt(m.distanceFromAnchor===0?l.tileAnchorPoint:new o.P(l.lineVertexArray.getx(G),l.lineVertexArray.gety(G)),P,m.previousVertex,m.absOffsetX-m.distanceFromAnchor+1,l)}function Rt(D,l,m){const w=D+m.translation[0],P=l+m.translation[1];let O;return m.pitchWithMap?(O=ge(w,P,m.pitchedLabelPlaneMatrix,m.getElevation),O.isOccluded=!1):(O=m.transform.projectTileCoordinates(w,P,m.unwrappedTileID,m.getElevation),O.point.x=(.5*O.point.x+.5)*m.width,O.point.y=(.5*-O.point.y+.5)*m.height),O}function dr(D,l,m,w){if(m.pitchWithMap){const P=[D,l,0,1];return o.al(P,P,w),m.transform.projectTileCoordinates(P[0]/P[3],P[1]/P[3],m.unwrappedTileID,m.getElevation).point}return{x:D/m.width*2-1,y:l/m.height*2-1}}function zr(D,l,m){return m.transform.projectTileCoordinates(D,l,m.unwrappedTileID,m.getElevation)}function Pr(D,l,m){return D._unit()._perp()._mult(l*m)}function Rr(D,l,m,w,P,O,G,J,re){if(J.projectionCache.offsets[D])return J.projectionCache.offsets[D];const oe=m.add(l);if(D+re.direction<w||D+re.direction>=P)return J.projectionCache.offsets[D]=oe,oe;const pe=Nt(D+re.direction,J,re),Ce=Pr(pe.sub(m),G,re.direction),Me=m.add(Ce),Ke=pe.add(Ce);return J.projectionCache.offsets[D]=o.am(O,oe,Me,Ke)||oe,J.projectionCache.offsets[D]}function ln(D,l,m,w,P,O,G,J,re){const oe=w?D-l:D+l;let pe=oe>0?1:-1,Ce=0;w&&(pe*=-1,Ce=Math.PI),pe<0&&(Ce+=Math.PI);let Me,Ke=pe>0?O+P:O+P+1;J.projectionCache.cachedAnchorPoint?Me=J.projectionCache.cachedAnchorPoint:(Me=Rt(J.tileAnchorPoint.x,J.tileAnchorPoint.y,J).point,J.projectionCache.cachedAnchorPoint=Me);let Ye,gt,ft=Me,mt=Me,xt=0,Ft=0;const Dt=Math.abs(oe),Ut=[];let Gt;for(;xt+Ft<=Dt;){if(Ke+=pe,Ke<O||Ke>=G)return null;xt+=Ft,mt=ft,gt=Ye;const sr={absOffsetX:Dt,direction:pe,distanceFromAnchor:xt,previousVertex:mt};if(ft=Nt(Ke,J,sr),m===0)Ut.push(mt),Gt=ft.sub(mt);else{let gr;const Er=ft.sub(mt);gr=Er.mag()===0?Pr(Nt(Ke+pe,J,sr).sub(ft),m,pe):Pr(Er,m,pe),gt||(gt=mt.add(gr)),Ye=Rr(Ke,gr,ft,O,G,gt,m,J,sr),Ut.push(gt),Gt=Ye.sub(gt)}Ft=Gt.mag()}const zt=Gt._mult((Dt-xt)/Ft)._add(gt||mt),ir=Ce+Math.atan2(ft.y-mt.y,ft.x-mt.x);return Ut.push(zt),{point:zt,angle:re?ir:0,path:Ut}}const Jn=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function _n(D,l){for(let m=0;m<D;m++){const w=l.length;l.resize(w+4),l.float32.set(Jn,3*w)}}function jn(D,l,m){const w=l[0],P=l[1];return D[0]=m[0]*w+m[4]*P+m[12],D[1]=m[1]*w+m[5]*P+m[13],D[3]=m[3]*w+m[7]*P+m[15],D}const Gn=100;class Ln{constructor(l){let m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new $t(l.width+200,l.height+200,25),w=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new $t(l.width+200,l.height+200,25);this.transform=l,this.grid=m,this.ignoredGrid=w,this.pitchFactor=Math.cos(l.pitch*Math.PI/180)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+Gn,this.screenBottomBoundary=l.height+Gn,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(l,m,w,P,O,G,J,re,oe,pe,Ce,Me){const Ke=this.projectAndGetPerspectiveRatio(l.anchorPointX+re[0],l.anchorPointY+re[1],O,pe,Me),Ye=w*Ke.perspectiveRatio;let gt;if(G||J)gt=this._projectCollisionBox(l,Ye,P,O,G,J,re,Ke,pe,Ce,Me);else{const Gt=Ke.x+(Ce?Ce.x*Ye:0),zt=Ke.y+(Ce?Ce.y*Ye:0);gt={allPointsOccluded:!1,box:[Gt+l.x1*Ye,zt+l.y1*Ye,Gt+l.x2*Ye,zt+l.y2*Ye]}}const[ft,mt,xt,Ft]=gt.box,Dt=G?gt.allPointsOccluded:Ke.isOccluded;let Ut=Dt;return Ut||(Ut=Ke.perspectiveRatio<this.perspectiveRatioCutoff),Ut||(Ut=!this.isInsideGrid(ft,mt,xt,Ft)),Ut||m!=="always"&&this.grid.hitTest(ft,mt,xt,Ft,m,oe)?{box:[ft,mt,xt,Ft],placeable:!1,offscreen:!1,occluded:Dt}:{box:[ft,mt,xt,Ft],placeable:!0,offscreen:this.isOffscreen(ft,mt,xt,Ft),occluded:Dt}}placeCollisionCircles(l,m,w,P,O,G,J,re,oe,pe,Ce,Me,Ke,Ye){const gt=[],ft=new o.P(m.anchorX,m.anchorY),mt=this.getPerspectiveRatio(ft.x,ft.y,G,Ye),xt=(oe?O*this.transform.getPitchedTextCorrection(m.anchorX,m.anchorY,G)/mt:O*mt)/o.as,Ft={getElevation:Ye,pitchedLabelPlaneMatrix:J,lineVertexArray:w,pitchWithMap:oe,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:ft,unwrappedTileID:G,width:this.transform.width,height:this.transform.height,translation:Ke},Dt=At(xt,P,m.lineOffsetX*xt,m.lineOffsetY*xt,!1,m,!1,Ft);let Ut=!1,Gt=!1,zt=!0;if(Dt){const ir=.5*Ce*mt+Me,sr=new o.P(-100,-100),gr=new o.P(this.screenRightBoundary,this.screenBottomBoundary),Er=new bt,fr=Dt.first,qr=Dt.last;let Jr=[];for(let Yn=fr.path.length-1;Yn>=1;Yn--)Jr.push(fr.path[Yn]);for(let Yn=1;Yn<qr.path.length;Yn++)Jr.push(qr.path[Yn]);const Sr=2.5*ir;if(oe){const Yn=this.projectPathToScreenSpace(Jr,Ft);Jr=Yn.some(oi=>oi.signedDistanceFromCamera<=0)?[]:Yn.map(oi=>oi.point)}let tn=[];if(Jr.length>0){const Yn=Jr[0].clone(),oi=Jr[0].clone();for(let ws=1;ws<Jr.length;ws++)Yn.x=Math.min(Yn.x,Jr[ws].x),Yn.y=Math.min(Yn.y,Jr[ws].y),oi.x=Math.max(oi.x,Jr[ws].x),oi.y=Math.max(oi.y,Jr[ws].y);tn=Yn.x>=sr.x&&oi.x<=gr.x&&Yn.y>=sr.y&&oi.y<=gr.y?[Jr]:oi.x<sr.x||Yn.x>gr.x||oi.y<sr.y||Yn.y>gr.y?[]:o.ao([Jr],sr.x,sr.y,gr.x,gr.y)}for(const Yn of tn){Er.reset(Yn,.25*ir);let oi=0;oi=Er.length<=.5*ir?1:Math.ceil(Er.paddedLength/Sr)+1;for(let ws=0;ws<oi;ws++){const Oi=ws/Math.max(oi-1,1),Gs=Er.lerp(Oi),Wi=Gs.x+Gn,ti=Gs.y+Gn;gt.push(Wi,ti,ir,0);const Xi=Wi-ir,No=ti-ir,Rs=Wi+ir,Bs=ti+ir;if(zt=zt&&this.isOffscreen(Xi,No,Rs,Bs),Gt=Gt||this.isInsideGrid(Xi,No,Rs,Bs),l!=="always"&&this.grid.hitTestCircle(Wi,ti,ir,l,pe)&&(Ut=!0,!re))return{circles:[],offscreen:!1,collisionDetected:Ut}}}}return{circles:!re&&Ut||!Gt||mt<this.perspectiveRatioCutoff?[]:gt,offscreen:zt,collisionDetected:Ut}}projectPathToScreenSpace(l,m){const w=function(P,O){const G=o.H();return o.an(G,O.pitchedLabelPlaneMatrix),P.map(J=>{const re=ge(J.x,J.y,G,O.getElevation),oe=O.transform.projectTileCoordinates(re.point.x,re.point.y,O.unwrappedTileID,O.getElevation);return oe.point.x=(.5*oe.point.x+.5)*O.width,oe.point.y=(.5*-oe.point.y+.5)*O.height,oe})}(l,m);return function(P){let O=0,G=0,J=0,re=0;for(let oe=0;oe<P.length;oe++)P[oe].isOccluded?(J=oe+1,re=0):(re++,re>G&&(G=re,O=J));return P.slice(O,O+G)}(w)}queryRenderedSymbols(l){if(l.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const m=[];let w=1/0,P=1/0,O=-1/0,G=-1/0;for(const pe of l){const Ce=new o.P(pe.x+Gn,pe.y+Gn);w=Math.min(w,Ce.x),P=Math.min(P,Ce.y),O=Math.max(O,Ce.x),G=Math.max(G,Ce.y),m.push(Ce)}const J=this.grid.query(w,P,O,G).concat(this.ignoredGrid.query(w,P,O,G)),re={},oe={};for(const pe of J){const Ce=pe.key;if(re[Ce.bucketInstanceId]===void 0&&(re[Ce.bucketInstanceId]={}),re[Ce.bucketInstanceId][Ce.featureIndex])continue;const Me=[new o.P(pe.x1,pe.y1),new o.P(pe.x2,pe.y1),new o.P(pe.x2,pe.y2),new o.P(pe.x1,pe.y2)];o.ap(m,Me)&&(re[Ce.bucketInstanceId][Ce.featureIndex]=!0,oe[Ce.bucketInstanceId]===void 0&&(oe[Ce.bucketInstanceId]=[]),oe[Ce.bucketInstanceId].push(Ce.featureIndex))}return oe}insertCollisionBox(l,m,w,P,O,G){(w?this.ignoredGrid:this.grid).insert({bucketInstanceId:P,featureIndex:O,collisionGroupID:G,overlapMode:m},l[0],l[1],l[2],l[3])}insertCollisionCircles(l,m,w,P,O,G){const J=w?this.ignoredGrid:this.grid,re={bucketInstanceId:P,featureIndex:O,collisionGroupID:G,overlapMode:m};for(let oe=0;oe<l.length;oe+=4)J.insertCircle(re,l[oe],l[oe+1],l[oe+2])}projectAndGetPerspectiveRatio(l,m,w,P,O){if(O){let G;P?(G=[l,m,P(l,m),1],o.al(G,G,O)):(G=[l,m,0,1],jn(G,G,O));const J=G[3];return{x:(G[0]/J+1)/2*this.transform.width+Gn,y:(-G[1]/J+1)/2*this.transform.height+Gn,perspectiveRatio:.5+this.transform.cameraToCenterDistance/J*.5,isOccluded:!1,signedDistanceFromCamera:J}}{const G=this.transform.projectTileCoordinates(l,m,w,P);return{x:(G.point.x+1)/2*this.transform.width+Gn,y:(1-G.point.y)/2*this.transform.height+Gn,perspectiveRatio:.5+this.transform.cameraToCenterDistance/G.signedDistanceFromCamera*.5,isOccluded:G.isOccluded,signedDistanceFromCamera:G.signedDistanceFromCamera}}}getPerspectiveRatio(l,m,w,P){const O=this.transform.projectTileCoordinates(l,m,w,P);return .5+this.transform.cameraToCenterDistance/O.signedDistanceFromCamera*.5}isOffscreen(l,m,w,P){return w<Gn||l>=this.screenRightBoundary||P<Gn||m>this.screenBottomBoundary}isInsideGrid(l,m,w,P){return w>=0&&l<this.gridRightBoundary&&P>=0&&m<this.gridBottomBoundary}getViewportMatrix(){const l=o.aq([]);return o.J(l,l,[-100,-100,0]),l}_projectCollisionBox(l,m,w,P,O,G,J,re,oe,pe,Ce){let Me=1,Ke=0,Ye=0,gt=1;const ft=l.anchorPointX+J[0],mt=l.anchorPointY+J[1];if(G&&!O){const Jr=this.projectAndGetPerspectiveRatio(ft+1,mt,P,oe,Ce),Sr=Jr.x-re.x,tn=Math.atan((Jr.y-re.y)/Sr)+(Sr<0?Math.PI:0),Yn=Math.sin(tn),oi=Math.cos(tn);Me=oi,Ke=Yn,Ye=-Yn,gt=oi}else if(!G&&O){const Jr=Ae(this.transform);Me=Jr.vecEast[0],Ke=Jr.vecEast[1],Ye=Jr.vecSouth[0],gt=Jr.vecSouth[1]}let xt=re.x,Ft=re.y,Dt=m;O&&(xt=ft,Ft=mt,Dt=Math.pow(2,-(this.transform.zoom-w.overscaledZ)),Dt*=this.transform.getPitchedTextCorrection(ft,mt,P),pe||(Dt*=o.ab(.5+re.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),pe&&(xt+=Me*pe.x*Dt+Ye*pe.y*Dt,Ft+=Ke*pe.x*Dt+gt*pe.y*Dt);const Ut=l.x1*Dt,Gt=l.x2*Dt,zt=(Ut+Gt)/2,ir=l.y1*Dt,sr=l.y2*Dt,gr=(ir+sr)/2,Er=[{offsetX:Ut,offsetY:ir},{offsetX:zt,offsetY:ir},{offsetX:Gt,offsetY:ir},{offsetX:Gt,offsetY:gr},{offsetX:Gt,offsetY:sr},{offsetX:zt,offsetY:sr},{offsetX:Ut,offsetY:sr},{offsetX:Ut,offsetY:gr}];let fr=[];for(const{offsetX:Jr,offsetY:Sr}of Er)fr.push(new o.P(xt+Me*Jr+Ye*Sr,Ft+Ke*Jr+gt*Sr));let qr=!1;if(O){const Jr=fr.map(Sr=>this.projectAndGetPerspectiveRatio(Sr.x,Sr.y,P,oe,Ce));qr=Jr.some(Sr=>!Sr.isOccluded),fr=Jr.map(Sr=>new o.P(Sr.x,Sr.y))}else qr=!0;return{box:o.ar(fr),allPointsOccluded:!qr}}}class Un{constructor(l,m,w,P){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?m:-m))):P&&w?1:0,this.placed=w}isHidden(){return this.opacity===0&&!this.placed}}class Ei{constructor(l,m,w,P,O){this.text=new Un(l?l.text:null,m,w,O),this.icon=new Un(l?l.icon:null,m,P,O)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class zi{constructor(l,m,w){this.text=l,this.icon=m,this.skipFade=w}}class Pt{constructor(l,m,w,P,O){this.bucketInstanceId=l,this.featureIndex=m,this.sourceLayerIndex=w,this.bucketIndex=P,this.tileID=O}}class Zr{constructor(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}}get(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){const m=++this.maxGroupID;this.collisionGroups[l]={ID:m,predicate:w=>w.collisionGroupID===m}}return this.collisionGroups[l]}}function Ur(D,l,m,w,P){const{horizontalAlign:O,verticalAlign:G}=o.ay(D);return new o.P(-(O-.5)*l+w[0]*P,-(G-.5)*m+w[1]*P)}class On{constructor(l,m,w,P,O){this.transform=l.clone(),this.terrain=m,this.collisionIndex=new Ln(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=w,this.retainedQueryData={},this.collisionGroups=new Zr(P),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=O,O&&(O.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(l){const m=this.terrain;return m?(w,P)=>m.getElevation(l,w,P):null}getBucketParts(l,m,w,P){const O=w.getBucket(m),G=w.latestFeatureIndex;if(!O||!G||m.id!==O.layerIds[0])return;const J=w.collisionBoxArray,re=O.layers[0].layout,oe=O.layers[0].paint,pe=Math.pow(2,this.transform.zoom-w.tileID.overscaledZ),Ce=w.tileSize/o.X,Me=w.tileID.toUnwrapped(),Ke=re.get("text-rotation-alignment")==="map",Ye=o.at(w,1,this.transform.zoom),gt=o.au(this.collisionIndex.transform,w,oe.get("text-translate"),oe.get("text-translate-anchor")),ft=o.au(this.collisionIndex.transform,w,oe.get("icon-translate"),oe.get("icon-translate-anchor")),mt=Wt(Ke,this.transform,Ye);this.retainedQueryData[O.bucketInstanceId]=new Pt(O.bucketInstanceId,G,O.sourceLayerIndex,O.index,w.tileID);const xt={bucket:O,layout:re,translationText:gt,translationIcon:ft,unwrappedTileID:Me,pitchedLabelPlaneMatrix:mt,scale:pe,textPixelRatio:Ce,holdingForFade:w.holdingForFade(),collisionBoxArray:J,partiallyEvaluatedTextSize:o.ah(O.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(O.sourceID)};if(P)for(const Ft of O.sortKeyRanges){const{sortKey:Dt,symbolInstanceStart:Ut,symbolInstanceEnd:Gt}=Ft;l.push({sortKey:Dt,symbolInstanceStart:Ut,symbolInstanceEnd:Gt,parameters:xt})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:O.symbolInstances.length,parameters:xt})}attemptAnchorPlacement(l,m,w,P,O,G,J,re,oe,pe,Ce,Me,Ke,Ye,gt,ft,mt,xt,Ft,Dt){const Ut=o.av[l.textAnchor],Gt=[l.textOffset0,l.textOffset1],zt=Ur(Ut,w,P,Gt,O),ir=this.collisionIndex.placeCollisionBox(m,Me,re,oe,pe,J,G,ft,Ce.predicate,Ft,zt,Dt);if((!xt||this.collisionIndex.placeCollisionBox(xt,Me,re,oe,pe,J,G,mt,Ce.predicate,Ft,zt,Dt).placeable)&&ir.placeable){let sr;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ke.crossTileID]&&this.prevPlacement.placements[Ke.crossTileID]&&this.prevPlacement.placements[Ke.crossTileID].text&&(sr=this.prevPlacement.variableOffsets[Ke.crossTileID].anchor),Ke.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[Ke.crossTileID]={textOffset:Gt,width:w,height:P,anchor:Ut,textBoxScale:O,prevAnchor:sr},this.markUsedJustification(Ye,Ut,Ke,gt),Ye.allowVerticalPlacement&&(this.markUsedOrientation(Ye,gt,Ke),this.placedOrientations[Ke.crossTileID]=gt),{shift:zt,placedGlyphBoxes:ir}}}placeLayerBucketPart(l,m,w){const{bucket:P,layout:O,translationText:G,translationIcon:J,unwrappedTileID:re,pitchedLabelPlaneMatrix:oe,textPixelRatio:pe,holdingForFade:Ce,collisionBoxArray:Me,partiallyEvaluatedTextSize:Ke,collisionGroup:Ye}=l.parameters,gt=O.get("text-optional"),ft=O.get("icon-optional"),mt=o.aw(O,"text-overlap","text-allow-overlap"),xt=mt==="always",Ft=o.aw(O,"icon-overlap","icon-allow-overlap"),Dt=Ft==="always",Ut=O.get("text-rotation-alignment")==="map",Gt=O.get("text-pitch-alignment")==="map",zt=O.get("icon-text-fit")!=="none",ir=O.get("symbol-z-order")==="viewport-y",sr=xt&&(Dt||!P.hasIconData()||ft),gr=Dt&&(xt||!P.hasTextData()||gt);!P.collisionArrays&&Me&&P.deserializeCollisionBoxes(Me);const Er=this.retainedQueryData[P.bucketInstanceId].tileID,fr=this._getTerrainElevationFunc(Er),qr=this.transform.getFastPathSimpleProjectionMatrix(Er),Jr=(Sr,tn,Yn)=>{var oi,ws;if(m[Sr.crossTileID])return;if(Ce)return void(this.placements[Sr.crossTileID]=new zi(!1,!1,!1));let Oi=!1,Gs=!1,Wi=!0,ti=null,Xi={box:null,placeable:!1,offscreen:null,occluded:!1},No={box:null,placeable:!1,offscreen:null},Rs=null,Bs=null,ea=null,tl=0,jl=0,Ma=0;tn.textFeatureIndex?tl=tn.textFeatureIndex:Sr.useRuntimeCollisionCircles&&(tl=Sr.featureIndex),tn.verticalTextFeatureIndex&&(jl=tn.verticalTextFeatureIndex);const ta=tn.textBox;if(ta){const ra=Ji=>{let Cs=o.ai.horizontal;if(P.allowVerticalPlacement&&!Ji&&this.prevPlacement){const Sl=this.prevPlacement.placedOrientations[Sr.crossTileID];Sl&&(this.placedOrientations[Sr.crossTileID]=Sl,Cs=Sl,this.markUsedOrientation(P,Cs,Sr))}return Cs},Tl=(Ji,Cs)=>{if(P.allowVerticalPlacement&&Sr.numVerticalGlyphVertices>0&&tn.verticalTextBox){for(const Sl of P.writingModes)if(Sl===o.ai.vertical?(Xi=Cs(),No=Xi):Xi=Ji(),Xi&&Xi.placeable)break}else Xi=Ji()},ql=Sr.textAnchorOffsetStartIndex,Io=Sr.textAnchorOffsetEndIndex;if(Io===ql){const Ji=(Cs,Sl)=>{const Qs=this.collisionIndex.placeCollisionBox(Cs,mt,pe,Er,re,Gt,Ut,G,Ye.predicate,fr,void 0,qr);return Qs&&Qs.placeable&&(this.markUsedOrientation(P,Sl,Sr),this.placedOrientations[Sr.crossTileID]=Sl),Qs};Tl(()=>Ji(ta,o.ai.horizontal),()=>{const Cs=tn.verticalTextBox;return P.allowVerticalPlacement&&Sr.numVerticalGlyphVertices>0&&Cs?Ji(Cs,o.ai.vertical):{box:null,offscreen:null}}),ra(Xi&&Xi.placeable)}else{let Ji=o.av[(ws=(oi=this.prevPlacement)===null||oi===void 0?void 0:oi.variableOffsets[Sr.crossTileID])===null||ws===void 0?void 0:ws.anchor];const Cs=(Qs,yy,Pm)=>{const Fm=Qs.x2-Qs.x1,rl=Qs.y2-Qs.y1,Tu=Sr.textBoxScale,jh=zt&&Ft==="never"?yy:null;let qh=null,sA=mt==="never"?1:2,$p="never";Ji&&sA++;for(let oA=0;oA<sA;oA++){for(let Rm=ql;Rm<Io;Rm++){const jp=P.textAnchorOffsets.get(Rm);if(Ji&&jp.textAnchor!==Ji)continue;const qp=this.attemptAnchorPlacement(jp,Qs,Fm,rl,Tu,Ut,Gt,pe,Er,re,Ye,$p,Sr,P,Pm,G,J,jh,fr);if(qp&&(qh=qp.placedGlyphBoxes,qh&&qh.placeable))return Oi=!0,ti=qp.shift,qh}Ji?Ji=null:$p=mt}return w&&!qh&&(qh={box:this.collisionIndex.placeCollisionBox(ta,"always",pe,Er,re,Gt,Ut,G,Ye.predicate,fr,void 0,qr).box,offscreen:!1,placeable:!1,occluded:!1}),qh};Tl(()=>Cs(ta,tn.iconBox,o.ai.horizontal),()=>{const Qs=tn.verticalTextBox;return P.allowVerticalPlacement&&(!Xi||!Xi.placeable)&&Sr.numVerticalGlyphVertices>0&&Qs?Cs(Qs,tn.verticalIconBox,o.ai.vertical):{box:null,occluded:!0,offscreen:null}}),Xi&&(Oi=Xi.placeable,Wi=Xi.offscreen);const Sl=ra(Xi&&Xi.placeable);if(!Oi&&this.prevPlacement){const Qs=this.prevPlacement.variableOffsets[Sr.crossTileID];Qs&&(this.variableOffsets[Sr.crossTileID]=Qs,this.markUsedJustification(P,Qs.anchor,Sr,Sl))}}}if(Rs=Xi,Oi=Rs&&Rs.placeable,Wi=Rs&&Rs.offscreen,Sr.useRuntimeCollisionCircles){const ra=P.text.placedSymbolArray.get(Sr.centerJustifiedTextSymbolIndex),Tl=o.aj(P.textSizeData,Ke,ra),ql=O.get("text-padding");Bs=this.collisionIndex.placeCollisionCircles(mt,ra,P.lineVertexArray,P.glyphOffsetArray,Tl,re,oe,w,Gt,Ye.predicate,Sr.collisionCircleDiameter,ql,G,fr),Bs.circles.length&&Bs.collisionDetected&&!w&&o.w("Collisions detected, but collision boxes are not shown"),Oi=xt||Bs.circles.length>0&&!Bs.collisionDetected,Wi=Wi&&Bs.offscreen}if(tn.iconFeatureIndex&&(Ma=tn.iconFeatureIndex),tn.iconBox){const ra=Tl=>this.collisionIndex.placeCollisionBox(Tl,Ft,pe,Er,re,Gt,Ut,J,Ye.predicate,fr,zt&&ti?ti:void 0,qr);No&&No.placeable&&tn.verticalIconBox?(ea=ra(tn.verticalIconBox),Gs=ea.placeable):(ea=ra(tn.iconBox),Gs=ea.placeable),Wi=Wi&&ea.offscreen}const xc=gt||Sr.numHorizontalGlyphVertices===0&&Sr.numVerticalGlyphVertices===0,El=ft||Sr.numIconVertices===0;xc||El?El?xc||(Gs=Gs&&Oi):Oi=Gs&&Oi:Gs=Oi=Gs&&Oi;const Qu=Gs&&ea.placeable;if(Oi&&Rs.placeable&&this.collisionIndex.insertCollisionBox(Rs.box,mt,O.get("text-ignore-placement"),P.bucketInstanceId,No&&No.placeable&&jl?jl:tl,Ye.ID),Qu&&this.collisionIndex.insertCollisionBox(ea.box,Ft,O.get("icon-ignore-placement"),P.bucketInstanceId,Ma,Ye.ID),Bs&&Oi&&this.collisionIndex.insertCollisionCircles(Bs.circles,mt,O.get("text-ignore-placement"),P.bucketInstanceId,tl,Ye.ID),w&&this.storeCollisionData(P.bucketInstanceId,Yn,tn,Rs,ea,Bs),Sr.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(P.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Sr.crossTileID]=new zi((Oi||sr)&&!(Rs!=null&&Rs.occluded),(Gs||gr)&&!(ea!=null&&ea.occluded),Wi||P.justReloaded),m[Sr.crossTileID]=!0};if(ir){if(l.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Sr=P.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let tn=Sr.length-1;tn>=0;--tn){const Yn=Sr[tn];Jr(P.symbolInstances.get(Yn),P.collisionArrays[Yn],Yn)}}else for(let Sr=l.symbolInstanceStart;Sr<l.symbolInstanceEnd;Sr++)Jr(P.symbolInstances.get(Sr),P.collisionArrays[Sr],Sr);P.justReloaded=!1}storeCollisionData(l,m,w,P,O,G){if(w.textBox||w.iconBox){let J,re;this.collisionBoxArrays.has(l)?J=this.collisionBoxArrays.get(l):(J=new Map,this.collisionBoxArrays.set(l,J)),J.has(m)?re=J.get(m):(re={text:null,icon:null},J.set(m,re)),w.textBox&&(re.text=P.box),w.iconBox&&(re.icon=O.box)}if(G){let J=this.collisionCircleArrays[l];J===void 0&&(J=this.collisionCircleArrays[l]=[]);for(let re=0;re<G.circles.length;re+=4)J.push(G.circles[re+0]-Gn),J.push(G.circles[re+1]-Gn),J.push(G.circles[re+2]),J.push(G.collisionDetected?1:0)}}markUsedJustification(l,m,w,P){let O;O=P===o.ai.vertical?w.verticalPlacedTextSymbolIndex:{left:w.leftJustifiedTextSymbolIndex,center:w.centerJustifiedTextSymbolIndex,right:w.rightJustifiedTextSymbolIndex}[o.ax(m)];const G=[w.leftJustifiedTextSymbolIndex,w.centerJustifiedTextSymbolIndex,w.rightJustifiedTextSymbolIndex,w.verticalPlacedTextSymbolIndex];for(const J of G)J>=0&&(l.text.placedSymbolArray.get(J).crossTileID=O>=0&&J!==O?0:w.crossTileID)}markUsedOrientation(l,m,w){const P=m===o.ai.horizontal||m===o.ai.horizontalOnly?m:0,O=m===o.ai.vertical?m:0,G=[w.leftJustifiedTextSymbolIndex,w.centerJustifiedTextSymbolIndex,w.rightJustifiedTextSymbolIndex];for(const J of G)l.text.placedSymbolArray.get(J).placedOrientation=P;w.verticalPlacedTextSymbolIndex&&(l.text.placedSymbolArray.get(w.verticalPlacedTextSymbolIndex).placedOrientation=O)}commit(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;const m=this.prevPlacement;let w=!1;this.prevZoomAdjustment=m?m.zoomAdjustment(this.transform.zoom):0;const P=m?m.symbolFadeChange(l):1,O=m?m.opacities:{},G=m?m.variableOffsets:{},J=m?m.placedOrientations:{};for(const re in this.placements){const oe=this.placements[re],pe=O[re];pe?(this.opacities[re]=new Ei(pe,P,oe.text,oe.icon),w=w||oe.text!==pe.text.placed||oe.icon!==pe.icon.placed):(this.opacities[re]=new Ei(null,P,oe.text,oe.icon,oe.skipFade),w=w||oe.text||oe.icon)}for(const re in O){const oe=O[re];if(!this.opacities[re]){const pe=new Ei(oe,P,!1,!1);pe.isHidden()||(this.opacities[re]=pe,w=w||oe.text.placed||oe.icon.placed)}}for(const re in G)this.variableOffsets[re]||!this.opacities[re]||this.opacities[re].isHidden()||(this.variableOffsets[re]=G[re]);for(const re in J)this.placedOrientations[re]||!this.opacities[re]||this.opacities[re].isHidden()||(this.placedOrientations[re]=J[re]);if(m&&m.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");w?this.lastPlacementChangeTime=l:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=m?m.lastPlacementChangeTime:l)}updateLayerOpacities(l,m){const w={};for(const P of m){const O=P.getBucket(l);O&&P.latestFeatureIndex&&l.id===O.layerIds[0]&&this.updateBucketOpacities(O,P.tileID,w,P.collisionBoxArray)}}updateBucketOpacities(l,m,w,P){l.hasTextData()&&(l.text.opacityVertexArray.clear(),l.text.hasVisibleVertices=!1),l.hasIconData()&&(l.icon.opacityVertexArray.clear(),l.icon.hasVisibleVertices=!1),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();const O=l.layers[0],G=O.layout,J=new Ei(null,0,!1,!1,!0),re=G.get("text-allow-overlap"),oe=G.get("icon-allow-overlap"),pe=O._unevaluatedLayout.hasValue("text-variable-anchor")||O._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Ce=G.get("text-rotation-alignment")==="map",Me=G.get("text-pitch-alignment")==="map",Ke=G.get("icon-text-fit")!=="none",Ye=new Ei(null,0,re&&(oe||!l.hasIconData()||G.get("icon-optional")),oe&&(re||!l.hasTextData()||G.get("text-optional")),!0);!l.collisionArrays&&P&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(P);const gt=(mt,xt,Ft)=>{for(let Dt=0;Dt<xt/4;Dt++)mt.opacityVertexArray.emplaceBack(Ft);mt.hasVisibleVertices=mt.hasVisibleVertices||Ft!==ts},ft=this.collisionBoxArrays.get(l.bucketInstanceId);for(let mt=0;mt<l.symbolInstances.length;mt++){const xt=l.symbolInstances.get(mt),{numHorizontalGlyphVertices:Ft,numVerticalGlyphVertices:Dt,crossTileID:Ut}=xt;let Gt=this.opacities[Ut];w[Ut]?Gt=J:Gt||(Gt=Ye,this.opacities[Ut]=Gt),w[Ut]=!0;const zt=xt.numIconVertices>0,ir=this.placedOrientations[xt.crossTileID],sr=ir===o.ai.vertical,gr=ir===o.ai.horizontal||ir===o.ai.horizontalOnly;if(Ft>0||Dt>0){const fr=wa(Gt.text);gt(l.text,Ft,sr?ts:fr),gt(l.text,Dt,gr?ts:fr);const qr=Gt.text.isHidden();[xt.rightJustifiedTextSymbolIndex,xt.centerJustifiedTextSymbolIndex,xt.leftJustifiedTextSymbolIndex].forEach(tn=>{tn>=0&&(l.text.placedSymbolArray.get(tn).hidden=qr||sr?1:0)}),xt.verticalPlacedTextSymbolIndex>=0&&(l.text.placedSymbolArray.get(xt.verticalPlacedTextSymbolIndex).hidden=qr||gr?1:0);const Jr=this.variableOffsets[xt.crossTileID];Jr&&this.markUsedJustification(l,Jr.anchor,xt,ir);const Sr=this.placedOrientations[xt.crossTileID];Sr&&(this.markUsedJustification(l,"left",xt,Sr),this.markUsedOrientation(l,Sr,xt))}if(zt){const fr=wa(Gt.icon),qr=!(Ke&&xt.verticalPlacedIconSymbolIndex&&sr);xt.placedIconSymbolIndex>=0&&(gt(l.icon,xt.numIconVertices,qr?fr:ts),l.icon.placedSymbolArray.get(xt.placedIconSymbolIndex).hidden=Gt.icon.isHidden()),xt.verticalPlacedIconSymbolIndex>=0&&(gt(l.icon,xt.numVerticalIconVertices,qr?ts:fr),l.icon.placedSymbolArray.get(xt.verticalPlacedIconSymbolIndex).hidden=Gt.icon.isHidden())}const Er=ft&&ft.has(mt)?ft.get(mt):{text:null,icon:null};if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){const fr=l.collisionArrays[mt];if(fr){let qr=new o.P(0,0);if(fr.textBox||fr.verticalTextBox){let Jr=!0;if(pe){const Sr=this.variableOffsets[Ut];Sr?(qr=Ur(Sr.anchor,Sr.width,Sr.height,Sr.textOffset,Sr.textBoxScale),Ce&&qr._rotate(Me?-this.transform.bearingInRadians:this.transform.bearingInRadians)):Jr=!1}if(fr.textBox||fr.verticalTextBox){let Sr;fr.textBox&&(Sr=sr),fr.verticalTextBox&&(Sr=gr),di(l.textCollisionBox.collisionVertexArray,Gt.text.placed,!Jr||Sr,Er.text,qr.x,qr.y)}}if(fr.iconBox||fr.verticalIconBox){const Jr=!!(!gr&&fr.verticalIconBox);let Sr;fr.iconBox&&(Sr=Jr),fr.verticalIconBox&&(Sr=!Jr),di(l.iconCollisionBox.collisionVertexArray,Gt.icon.placed,Sr,Er.icon,Ke?qr.x:0,Ke?qr.y:0)}}}}if(l.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.text.opacityVertexArray.length!==l.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${l.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${l.text.layoutVertexArray.length}) / 4`);if(l.icon.opacityVertexArray.length!==l.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${l.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${l.icon.layoutVertexArray.length}) / 4`);l.bucketInstanceId in this.collisionCircleArrays&&(l.collisionCircleArray=this.collisionCircleArrays[l.bucketInstanceId],delete this.collisionCircleArrays[l.bucketInstanceId])}symbolFadeChange(l){return this.fadeDuration===0?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(l){return Math.max(0,(this.transform.zoom-l)/1.5)}hasTransitions(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(l,m){const w=this.zoomAtLastRecencyCheck===m?1-this.zoomAdjustment(m):1;return this.zoomAtLastRecencyCheck=m,this.commitTime+this.fadeDuration*w>l}setStale(){this.stale=!0}}function di(D,l,m,w,P,O){w&&w.length!==0||(w=[0,0,0,0]);const G=w[0]-Gn,J=w[1]-Gn,re=w[2]-Gn,oe=w[3]-Gn;D.emplaceBack(l?1:0,m?1:0,P||0,O||0,G,J),D.emplaceBack(l?1:0,m?1:0,P||0,O||0,re,J),D.emplaceBack(l?1:0,m?1:0,P||0,O||0,re,oe),D.emplaceBack(l?1:0,m?1:0,P||0,O||0,G,oe)}const ks=Math.pow(2,25),bi=Math.pow(2,24),bs=Math.pow(2,17),jo=Math.pow(2,16),Ks=Math.pow(2,9),Hi=Math.pow(2,8),Mc=Math.pow(2,1);function wa(D){if(D.opacity===0&&!D.placed)return 0;if(D.opacity===1&&D.placed)return 4294967295;const l=D.placed?1:0,m=Math.floor(127*D.opacity);return m*ks+l*bi+m*bs+l*jo+m*Ks+l*Hi+m*Mc+l}const ts=0;class ss{constructor(l){this._sortAcrossTiles=l.layout.get("symbol-z-order")!=="viewport-y"&&!l.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(l,m,w,P,O){const G=this._bucketParts;for(;this._currentTileIndex<l.length;)if(m.getBucketParts(G,P,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,O())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,G.sort((J,re)=>J.sortKey-re.sortKey));this._currentPartIndex<G.length;)if(m.placeLayerBucketPart(G[this._currentPartIndex],this._seenCrossTileIDs,w),this._currentPartIndex++,O())return!0;return!1}}class sa{constructor(l,m,w,P,O,G,J,re){this.placement=new On(l,m,G,J,re),this._currentPlacementIndex=w.length-1,this._forceFullPlacement=P,this._showCollisionBoxes=O,this._done=!1}isDone(){return this._done}continuePlacement(l,m,w){const P=T.now(),O=()=>!this._forceFullPlacement&&T.now()-P>2;for(;this._currentPlacementIndex>=0;){const G=m[l[this._currentPlacementIndex]],J=this.placement.collisionIndex.transform.zoom;if(G.type==="symbol"&&(!G.minzoom||G.minzoom<=J)&&(!G.maxzoom||G.maxzoom>J)){if(this._inProgressLayer||(this._inProgressLayer=new ss(G)),this._inProgressLayer.continuePlacement(w[G.source],this.placement,this._showCollisionBoxes,G,O))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(l){return this.placement.commit(l),this.placement}}const Vi=512/o.X/2;class Pc{constructor(l,m,w){this.tileID=l,this.bucketInstanceId=w,this._symbolsByKey={};const P=new Map;for(let O=0;O<m.length;O++){const G=m.get(O),J=G.key,re=P.get(J);re?re.push(G):P.set(J,[G])}for(const[O,G]of P){const J={positions:G.map(re=>({x:Math.floor(re.anchorX*Vi),y:Math.floor(re.anchorY*Vi)})),crossTileIDs:G.map(re=>re.crossTileID)};if(J.positions.length>128){const re=new o.az(J.positions.length,16,Uint16Array);for(const{x:oe,y:pe}of J.positions)re.add(oe,pe);re.finish(),delete J.positions,J.index=re}this._symbolsByKey[O]=J}}getScaledCoordinates(l,m){const{x:w,y:P,z:O}=this.tileID.canonical,{x:G,y:J,z:re}=m.canonical,oe=Vi/Math.pow(2,re-O),pe=(J*o.X+l.anchorY)*oe,Ce=P*o.X*Vi;return{x:Math.floor((G*o.X+l.anchorX)*oe-w*o.X*Vi),y:Math.floor(pe-Ce)}}findMatches(l,m,w){const P=this.tileID.canonical.z<m.canonical.z?1:Math.pow(2,this.tileID.canonical.z-m.canonical.z);for(let O=0;O<l.length;O++){const G=l.get(O);if(G.crossTileID)continue;const J=this._symbolsByKey[G.key];if(!J)continue;const re=this.getScaledCoordinates(G,m);if(J.index){const oe=J.index.range(re.x-P,re.y-P,re.x+P,re.y+P).sort();for(const pe of oe){const Ce=J.crossTileIDs[pe];if(!w[Ce]){w[Ce]=!0,G.crossTileID=Ce;break}}}else if(J.positions)for(let oe=0;oe<J.positions.length;oe++){const pe=J.positions[oe],Ce=J.crossTileIDs[oe];if(Math.abs(pe.x-re.x)<=P&&Math.abs(pe.y-re.y)<=P&&!w[Ce]){w[Ce]=!0,G.crossTileID=Ce;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(l=>{let{crossTileIDs:m}=l;return m})}}class vo{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class uh{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(l){const m=Math.round((l-this.lng)/360);if(m!==0)for(const w in this.indexes){const P=this.indexes[w],O={};for(const G in P){const J=P[G];J.tileID=J.tileID.unwrapTo(J.tileID.wrap+m),O[J.tileID.key]=J}this.indexes[w]=O}this.lng=l}addBucket(l,m,w){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===m.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(let O=0;O<m.symbolInstances.length;O++)m.symbolInstances.get(O).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]={});const P=this.usedCrossTileIDs[l.overscaledZ];for(const O in this.indexes){const G=this.indexes[O];if(Number(O)>l.overscaledZ)for(const J in G){const re=G[J];re.tileID.isChildOf(l)&&re.findMatches(m.symbolInstances,l,P)}else{const J=G[l.scaledTo(Number(O)).key];J&&J.findMatches(m.symbolInstances,l,P)}}for(let O=0;O<m.symbolInstances.length;O++){const G=m.symbolInstances.get(O);G.crossTileID||(G.crossTileID=w.generate(),P[G.crossTileID]=!0)}return this.indexes[l.overscaledZ]===void 0&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new Pc(l,m.symbolInstances,m.bucketInstanceId),!0}removeBucketCrossTileIDs(l,m){for(const w of m.getCrossTileIDsLists())for(const P of w)delete this.usedCrossTileIDs[l][P]}removeStaleBuckets(l){let m=!1;for(const w in this.indexes){const P=this.indexes[w];for(const O in P)l[P[O].bucketInstanceId]||(this.removeBucketCrossTileIDs(w,P[O]),delete P[O],m=!0)}return m}}class os{constructor(){this.layerIndexes={},this.crossTileIDs=new vo,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(l,m,w){let P=this.layerIndexes[l.id];P===void 0&&(P=this.layerIndexes[l.id]=new uh);let O=!1;const G={};P.handleWrapJump(w);for(const J of m){const re=J.getBucket(l);re&&l.id===re.layerIds[0]&&(re.bucketInstanceId||(re.bucketInstanceId=++this.maxBucketInstanceId),P.addBucket(J.tileID,re,this.crossTileIDs)&&(O=!0),G[re.bucketInstanceId]=!0)}return P.removeStaleBuckets(G)&&(O=!0),O}pruneUnusedLayers(l){const m={};l.forEach(w=>{m[w]=!0});for(const w in this.layerIndexes)m[w]||delete this.layerIndexes[w]}}var cu="void main() {fragColor=vec4(1.0);}";const ds={prelude:ri(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:ri("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:ri("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:ri(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:ri(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:ri(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:ri(cu,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:ri(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:ri(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:ri("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:ri("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:ri("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:ri(cu,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:ri(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:ri(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:ri(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:ri(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:ri(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:ri(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:ri(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));fragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ri(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:ri(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:ri(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:ri(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:ri(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:ri(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:ri(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:ri(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:ri(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:ri("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:ri("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:ri("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:ri("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:ri(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:ri("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function ri(D,l){const m=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,w=l.match(/in ([\w]+) ([\w]+)/g),P=D.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),O=l.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),G=O?O.concat(P):P,J={};return{fragmentSource:D=D.replace(m,(re,oe,pe,Ce,Me)=>(J[Me]=!0,oe==="define"?`
#ifndef HAS_UNIFORM_u_${Me}
in ${pe} ${Ce} ${Me};
#else
uniform ${pe} ${Ce} u_${Me};
#endif
`:`
#ifdef HAS_UNIFORM_u_${Me}
    ${pe} ${Ce} ${Me} = u_${Me};
#endif
`)),vertexSource:l=l.replace(m,(re,oe,pe,Ce,Me)=>{const Ke=Ce==="float"?"vec2":"vec4",Ye=Me.match(/color/)?"color":Ke;return J[Me]?oe==="define"?`
#ifndef HAS_UNIFORM_u_${Me}
uniform lowp float u_${Me}_t;
in ${pe} ${Ke} a_${Me};
out ${pe} ${Ce} ${Me};
#else
uniform ${pe} ${Ce} u_${Me};
#endif
`:Ye==="vec4"?`
#ifndef HAS_UNIFORM_u_${Me}
    ${Me} = a_${Me};
#else
    ${pe} ${Ce} ${Me} = u_${Me};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Me}
    ${Me} = unpack_mix_${Ye}(a_${Me}, u_${Me}_t);
#else
    ${pe} ${Ce} ${Me} = u_${Me};
#endif
`:oe==="define"?`
#ifndef HAS_UNIFORM_u_${Me}
uniform lowp float u_${Me}_t;
in ${pe} ${Ke} a_${Me};
#else
uniform ${pe} ${Ce} u_${Me};
#endif
`:Ye==="vec4"?`
#ifndef HAS_UNIFORM_u_${Me}
    ${pe} ${Ce} ${Me} = a_${Me};
#else
    ${pe} ${Ce} ${Me} = u_${Me};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Me}
    ${pe} ${Ce} ${Me} = unpack_mix_${Ye}(a_${Me}, u_${Me}_t);
#else
    ${pe} ${Ce} ${Me} = u_${Me};
#endif
`}),staticAttributes:w,staticUniforms:G}}class lo{constructor(l,m,w){this.vertexBuffer=l,this.indexBuffer=m,this.segments=w}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var yn=o.aA([{name:"a_pos",type:"Int16",components:2}]);const Fc="#define PROJECTION_MERCATOR",hh="mercator";class $a{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return hh}get shaderDefine(){return Fc}get shaderPreludeCode(){return ds.projectionMercator}get vertexShaderPreludeCode(){return ds.projectionMercator.vertexSource}get subdivisionGranularity(){return o.aB.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(l){}getMeshFromTileID(l,m,w,P,O){if(this._cachedMesh)return this._cachedMesh;const G=new o.aC;G.emplaceBack(0,0),G.emplaceBack(o.X,0),G.emplaceBack(0,o.X),G.emplaceBack(o.X,o.X);const J=l.createVertexBuffer(G,yn.members),re=o.aD.simpleSegment(0,0,4,2),oe=new o.aE;oe.emplaceBack(1,0,2),oe.emplaceBack(1,2,3);const pe=l.createIndexBuffer(oe);return this._cachedMesh=new lo(J,pe,re),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(l){}}function fs(D,l){const m=o.ab(l.lat,-85.051129,o.aF);return new o.P(o.O(l.lng)*D,o.Q(m)*D)}function As(D,l){return new o.Y(l.x/D,l.y/D).toLngLat()}function Gi(D){return D.cameraToCenterDistance*Math.min(.85*Math.tan(o.aa(90-D.pitch)),Math.tan(o.aa(89.25-D.pitch)))}function uu(D,l){const m=D.canonical,w=l/o.aG(m.z),P=m.x+Math.pow(2,m.z)*D.wrap,O=o.aq(new Float64Array(16));return o.J(O,O,[P*w,m.y*w,0]),o.K(O,O,[w/o.X,w/o.X,1]),O}function Us(D,l,m,w,P){const O=o.Y.fromLngLat(D,l),G=P*o.aH(1,D.lat),J=G*Math.cos(o.aa(m)),re=Math.sqrt(G*G-J*J),oe=re*Math.sin(o.aa(-w)),pe=re*Math.cos(o.aa(-w));return new o.Y(O.x+oe,O.y+pe,O.z+J)}class vs{constructor(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,w=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,P=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;if(isNaN(l)||l<0||isNaN(m)||m<0||isNaN(w)||w<0||isNaN(P)||P<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=m,this.left=w,this.right=P}interpolate(l,m,w){return m.top!=null&&l.top!=null&&(this.top=o.y.number(l.top,m.top,w)),m.bottom!=null&&l.bottom!=null&&(this.bottom=o.y.number(l.bottom,m.bottom,w)),m.left!=null&&l.left!=null&&(this.left=o.y.number(l.left,m.left,w)),m.right!=null&&l.right!=null&&(this.right=o.y.number(l.right,m.right,w)),this}getCenter(l,m){const w=o.ab((this.left+l-this.right)/2,0,l),P=o.ab((this.top+m-this.bottom)/2,0,m);return new o.P(w,P)}equals(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right}clone(){return new vs(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function eo(D,l){if(!D.renderWorldCopies||D.lngRange)return;const m=l.lng-D.center.lng;l.lng+=m>180?-360:m<-180?360:0}function Rc(D){return Math.max(0,Math.floor(D))}class oc{constructor(l,m,w,P,O,G){this._callbacks=l,this._tileSize=512,this._renderWorldCopies=G===void 0||!!G,this._minZoom=m||0,this._maxZoom=w||22,this._minPitch=P??0,this._maxPitch=O??60,this.setMaxBounds(),this._width=0,this._height=0,this._center=new o.N(0,0),this._elevation=0,this._zoom=0,this._tileZoom=Rc(this._zoom),this._scale=o.aG(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new vs,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(l,m,w){this._latRange=l.latRange,this._lngRange=l.lngRange,this._width=l.width,this._height=l.height,this._center=l.center,this._elevation=l.elevation,this._minElevationForCurrentTile=l.minElevationForCurrentTile,this._zoom=l.zoom,this._tileZoom=Rc(this._zoom),this._scale=o.aG(this._zoom),this._bearingInRadians=l.bearingInRadians,this._fovInRadians=l.fovInRadians,this._pitchInRadians=l.pitchInRadians,this._rollInRadians=l.rollInRadians,this._unmodified=l.unmodified,this._edgeInsets=new vs(l.padding.top,l.padding.bottom,l.padding.left,l.padding.right),this._minZoom=l.minZoom,this._maxZoom=l.maxZoom,this._minPitch=l.minPitch,this._maxPitch=l.maxPitch,this._renderWorldCopies=l.renderWorldCopies,this._cameraToCenterDistance=l.cameraToCenterDistance,this._nearZ=l.nearZ,this._farZ=l.farZ,this._autoCalculateNearFarZ=!w&&l.autoCalculateNearFarZ,m&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(l){this._minElevationForCurrentTile=l}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(l){this._minZoom!==l&&(this._minZoom=l,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(l){this._maxZoom!==l&&(this._maxZoom=l,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(l){this._minPitch!==l&&(this._minPitch=l,this.setPitch(Math.max(this.pitch,l)))}get maxPitch(){return this._maxPitch}setMaxPitch(l){this._maxPitch!==l&&(this._maxPitch=l,this.setPitch(Math.min(this.pitch,l)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(l){l===void 0?l=!0:l===null&&(l=!1),this._renderWorldCopies=l}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(l){const m=o.aI(l,-180,180)*Math.PI/180;var w,P,O,G,J,re,oe,pe,Ce;this._bearingInRadians!==m&&(this._unmodified=!1,this._bearingInRadians=m,this._calcMatrices(),this._rotationMatrix=f(),w=this._rotationMatrix,O=-this._bearingInRadians,G=(P=this._rotationMatrix)[0],J=P[1],re=P[2],oe=P[3],pe=Math.sin(O),Ce=Math.cos(O),w[0]=G*Ce+re*pe,w[1]=J*Ce+oe*pe,w[2]=G*-pe+re*Ce,w[3]=J*-pe+oe*Ce)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(l){const m=o.ab(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==m&&(this._unmodified=!1,this._pitchInRadians=m,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(l){const m=l/180*Math.PI;this._rollInRadians!==m&&(this._unmodified=!1,this._rollInRadians=m,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return o.aJ(this._fovInRadians)}setFov(l){l=o.ab(l,.1,150),this.fov!==l&&(this._unmodified=!1,this._fovInRadians=o.aa(l),this._calcMatrices())}get zoom(){return this._zoom}setZoom(l){const m=this.getConstrained(this._center,l).zoom;this._zoom!==m&&(this._unmodified=!1,this._zoom=m,this._tileZoom=Math.max(0,Math.floor(m)),this._scale=o.aG(m),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(l){l!==this._elevation&&(this._elevation=l,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(l,m){this._autoCalculateNearFarZ=!1,this._nearZ=l,this._farZ=m,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(l){return this._edgeInsets.equals(l)}interpolatePadding(l,m,w){this._unmodified=!1,this._edgeInsets.interpolate(l,m,w),this._constrain(),this._calcMatrices()}resize(l,m){let w=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;this._width=l,this._height=m,w&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new on([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(l){l?(this._lngRange=[l.getWest(),l.getEast()],this._latRange=[l.getSouth(),l.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-85.051129,o.aF])}getConstrained(l,m){return this._callbacks.getConstrained(l,m)}getCameraQueryGeometry(l,m){if(m.length===1)return[m[0],l];{let w=l.x,P=l.y,O=l.x,G=l.y;for(const J of m)w=Math.min(w,J.x),P=Math.min(P,J.y),O=Math.max(O,J.x),G=Math.max(G,J.y);return[new o.P(w,P),new o.P(O,P),new o.P(O,G),new o.P(w,G),new o.P(w,P)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const l=this._unmodified,{center:m,zoom:w}=this.getConstrained(this.center,this.zoom);this.setCenter(m),this.setZoom(w),this._unmodified=l,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let l=o.aq(new Float64Array(16));o.K(l,l,[this._width/2,-this._height/2,1]),o.J(l,l,[1,-1,0]),this._clipSpaceToPixelsMatrix=l,l=o.aq(new Float64Array(16)),o.K(l,l,[1,-1,1]),o.J(l,l,[-1,-1,0]),o.K(l,l,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=l,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(l,m,w,P){const O=w!==void 0?w:this.bearing,G=P=P!==void 0?P:this.pitch,J=o.Y.fromLngLat(l,m),re=-Math.cos(o.aa(G)),oe=Math.sin(o.aa(G)),pe=oe*Math.sin(o.aa(O)),Ce=-oe*Math.cos(o.aa(O));let Me=this.elevation;const Ke=m-Me;let Ye;re*Ke>=0||Math.abs(re)<.1?(Ye=1e4,Me=m+Ye*re):Ye=-Ke/re;let gt,ft,mt=o.aK(1,J.y),xt=0;do{if(xt+=1,xt>10)break;ft=Ye/mt,gt=new o.Y(J.x+pe*ft,J.y+Ce*ft),mt=1/gt.meterInMercatorCoordinateUnits()}while(Math.abs(Ye-ft*mt)>1e-12);return{center:gt.toLngLat(),elevation:Me,zoom:o.a8(this.height/2/Math.tan(this.fovInRadians/2)/ft/this.tileSize)}}recalculateZoomAndCenter(l){if(this.elevation-l==0)return;const m=o.aH(1,this.center.lat)*this.worldSize,w=this.cameraToCenterDistance/m,P=o.Y.fromLngLat(this.center,this.elevation),O=Us(this.center,this.elevation,this.pitch,this.bearing,w);this._elevation=l;const G=this.calculateCenterFromCameraLngLatAlt(O.toLngLat(),o.aK(O.z,P.y),this.bearing,this.pitch);this._elevation=G.elevation,this._center=G.center,this.setZoom(G.zoom)}getCameraPoint(){const l=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(l*Math.sin(this.rollInRadians),l*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const l=o.aH(1,this.center.lat)*this.worldSize;return Us(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/l).toLngLat()}getMercatorTileCoordinates(l){if(!l)return[0,0,1,1];const m=l.canonical.z>=0?1<<l.canonical.z:Math.pow(2,l.canonical.z);return[l.canonical.x/m,l.canonical.y/m,1/m/o.X,1/m/o.X]}}class ai{constructor(l,m){this.min=l,this.max=m,this.center=o.aL([],o.aM([],this.min,this.max),.5)}quadrant(l){const m=[l%2==0,l<2],w=o.aN(this.min),P=o.aN(this.max);for(let O=0;O<m.length;O++)w[O]=m[O]?this.min[O]:this.center[O],P[O]=m[O]?this.center[O]:this.max[O];return P[2]=this.max[2],new ai(w,P)}distanceX(l){return Math.max(Math.min(this.max[0],l[0]),this.min[0])-l[0]}distanceY(l){return Math.max(Math.min(this.max[1],l[1]),this.min[1])-l[1]}intersectsFrustum(l){let m=!0;for(let w=0;w<l.planes.length;w++){const P=this.intersectsPlane(l.planes[w]);if(P===0)return 0;P===1&&(m=!1)}return m?2:l.aabb.min[0]>this.max[0]||l.aabb.min[1]>this.max[1]||l.aabb.min[2]>this.max[2]||l.aabb.max[0]<this.min[0]||l.aabb.max[1]<this.min[1]||l.aabb.max[2]<this.min[2]?0:1}intersectsPlane(l){let m=l[3],w=l[3];for(let P=0;P<3;P++)l[P]>0?(m+=l[P]*this.min[P],w+=l[P]*this.max[P]):(w+=l[P]*this.min[P],m+=l[P]*this.max[P]);return m>=0?2:w<0?0:1}}class Dl{distanceToTile2d(l,m,w,P){const O=P.distanceX([l,m]),G=P.distanceY([l,m]);return Math.hypot(O,G)}getWrap(l,m,w){return w}getTileAABB(l,m,w,P){var O,G;let J=w,re=w;if(P.terrain){const pe=new o.S(l.z,m,l.z,l.x,l.y),Ce=P.terrain.getMinMaxElevation(pe);J=(O=Ce.minElevation)!==null&&O!==void 0?O:w,re=(G=Ce.maxElevation)!==null&&G!==void 0?G:w}const oe=1<<l.z;return new ai([m+l.x/oe,l.y/oe,J],[m+(l.x+1)/oe,(l.y+1)/oe,re])}allowVariableZoom(l,m){const w=l.fov*(Math.abs(Math.cos(l.rollInRadians))*l.height+Math.abs(Math.sin(l.rollInRadians))*l.width)/l.height,P=o.ab(78.5-w/2,0,60);return!!m.terrain||l.pitch>P||l.padding.top>=.1}allowWorldCopies(){return!0}recalculateCache(){}}class ps{constructor(l,m,w){this.points=l,this.planes=m,this.aabb=w}static fromInvProjectionMatrix(l){let m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,w=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const P=Math.pow(2,w),O=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(oe=>{const pe=1/(oe=o.al([],oe,l))[3]/m*P;return o.aO(oe,oe,[pe,pe,1/oe[3],pe])}),G=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(oe=>{const pe=o.aP([],O[oe[0]],O[oe[1]]),Ce=o.aP([],O[oe[2]],O[oe[1]]),Me=o.aQ([],o.aR([],pe,Ce)),Ke=-o.aS(Me,O[oe[1]]);return Me.concat(Ke)}),J=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],re=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const oe of O)for(let pe=0;pe<3;pe++)J[pe]=Math.min(J[pe],oe[pe]),re[pe]=Math.max(re[pe],oe[pe]);return new ps(O,G,new ai(J,re))}}class Dn{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(l){this._helper.setMinZoom(l)}setMaxZoom(l){this._helper.setMaxZoom(l)}setMinPitch(l){this._helper.setMinPitch(l)}setMaxPitch(l){this._helper.setMaxPitch(l)}setRenderWorldCopies(l){this._helper.setRenderWorldCopies(l)}setBearing(l){this._helper.setBearing(l)}setPitch(l){this._helper.setPitch(l)}setRoll(l){this._helper.setRoll(l)}setFov(l){this._helper.setFov(l)}setZoom(l){this._helper.setZoom(l)}setCenter(l){this._helper.setCenter(l)}setElevation(l){this._helper.setElevation(l)}setMinElevationForCurrentTile(l){this._helper.setMinElevationForCurrentTile(l)}setPadding(l){this._helper.setPadding(l)}interpolatePadding(l,m,w){return this._helper.interpolatePadding(l,m,w)}isPaddingEqual(l){return this._helper.isPaddingEqual(l)}resize(l,m){let w=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;this._helper.resize(l,m,w)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(l){this._helper.setMaxBounds(l)}overrideNearFarZ(l,m){this._helper.overrideNearFarZ(l,m)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(l){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),l)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(l,m){}constructor(l,m,w,P,O){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new oc({calcMatrices:()=>{this._calcMatrices()},getConstrained:(G,J)=>this.getConstrained(G,J)},l,m,w,P,O),this._coveringTilesDetailsProvider=new Dl}clone(){const l=new Dn;return l.apply(this),l}apply(l,m,w){this._helper.apply(l,m,w)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(l){const m=[new o.aT(0,l)];if(this._helper._renderWorldCopies){const w=this.screenPointToMercatorCoordinate(new o.P(0,0)),P=this.screenPointToMercatorCoordinate(new o.P(this._helper._width,0)),O=this.screenPointToMercatorCoordinate(new o.P(this._helper._width,this._helper._height)),G=this.screenPointToMercatorCoordinate(new o.P(0,this._helper._height)),J=Math.floor(Math.min(w.x,P.x,O.x,G.x)),re=Math.floor(Math.max(w.x,P.x,O.x,G.x)),oe=1;for(let pe=J-oe;pe<=re+oe;pe++)pe!==0&&m.push(new o.aT(pe,l))}return m}getCameraFrustum(){return ps.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(l){const m=this.screenPointToLocation(this.centerPoint,l),w=l?l.getElevationForLngLatZoom(m,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(w)}setLocationAtPoint(l,m){const w=o.aH(this.elevation,this.center.lat),P=this.screenPointToMercatorCoordinateAtZ(m,w),O=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,w),G=o.Y.fromLngLat(l),J=new o.Y(G.x-(P.x-O.x),G.y-(P.y-O.y));this.setCenter(J==null?void 0:J.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(l,m){return m?this.coordinatePoint(o.Y.fromLngLat(l),m.getElevationForLngLatZoom(l,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(o.Y.fromLngLat(l))}screenPointToLocation(l,m){var w;return(w=this.screenPointToMercatorCoordinate(l,m))===null||w===void 0?void 0:w.toLngLat()}screenPointToMercatorCoordinate(l,m){if(m){const w=m.pointCoordinate(l);if(w!=null)return w}return this.screenPointToMercatorCoordinateAtZ(l)}screenPointToMercatorCoordinateAtZ(l,m){const w=m||0,P=[l.x,l.y,0,1],O=[l.x,l.y,1,1];o.al(P,P,this._pixelMatrixInverse),o.al(O,O,this._pixelMatrixInverse);const G=P[3],J=O[3],re=P[1]/G,oe=O[1]/J,pe=P[2]/G,Ce=O[2]/J,Me=pe===Ce?0:(w-pe)/(Ce-pe);return new o.Y(o.y.number(P[0]/G,O[0]/J,Me)/this.worldSize,o.y.number(re,oe,Me)/this.worldSize,w)}coordinatePoint(l){let m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,w=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this._pixelMatrix;const P=[l.x*this.worldSize,l.y*this.worldSize,m,1];return o.al(P,P,w),new o.P(P[0]/P[3],P[1]/P[3])}getBounds(){const l=Math.max(0,this._helper._height/2-Gi(this));return new on().extend(this.screenPointToLocation(new o.P(0,l))).extend(this.screenPointToLocation(new o.P(this._helper._width,l))).extend(this.screenPointToLocation(new o.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new o.P(0,this._helper._height)))}isPointOnMapSurface(l,m){return m?m.pointCoordinate(l)!=null:l.y>this.height/2-Gi(this)}calculatePosMatrix(l){let m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,w=arguments.length>2?arguments[2]:void 0;var P;const O=(P=l.key)!==null&&P!==void 0?P:o.aU(l.wrap,l.canonical.z,l.canonical.z,l.canonical.x,l.canonical.y),G=m?this._alignedPosMatrixCache:this._posMatrixCache;if(G.has(O)){const oe=G.get(O);return w?oe.f32:oe.f64}const J=uu(l,this.worldSize);o.L(J,m?this._alignedProjMatrix:this._viewProjMatrix,J);const re={f64:J,f32:new Float32Array(J)};return G.set(O,re),w?re.f32:re.f64}calculateFogMatrix(l){const m=l.key,w=this._fogMatrixCacheF32;if(w.has(m))return w.get(m);const P=uu(l,this.worldSize);return o.L(P,this._fogMatrix,P),w.set(m,new Float32Array(P)),w.get(m)}getConstrained(l,m){m=o.ab(+m,this.minZoom,this.maxZoom);const w={center:new o.N(l.lng,l.lat),zoom:m};let P=this._helper._lngRange;this._helper._renderWorldCopies||P!==null||(P=[-179.9999999999,180-1e-10]);const O=this.tileSize*o.aG(w.zoom);let G=0,J=O,re=0,oe=O,pe=0,Ce=0;const{x:Me,y:Ke}=this.size;if(this._helper._latRange){const Ft=this._helper._latRange;G=o.Q(Ft[1])*O,J=o.Q(Ft[0])*O,J-G<Ke&&(pe=Ke/(J-G))}P&&(re=o.aI(o.O(P[0])*O,0,O),oe=o.aI(o.O(P[1])*O,0,O),oe<re&&(oe+=O),oe-re<Me&&(Ce=Me/(oe-re)));const{x:Ye,y:gt}=fs(O,l);let ft,mt;const xt=Math.max(Ce||0,pe||0);if(xt){const Ft=new o.P(Ce?(oe+re)/2:Ye,pe?(J+G)/2:gt);return w.center=As(O,Ft).wrap(),w.zoom+=o.a8(xt),w}if(this._helper._latRange){const Ft=Ke/2;gt-Ft<G&&(mt=G+Ft),gt+Ft>J&&(mt=J-Ft)}if(P){const Ft=(re+oe)/2;let Dt=Ye;this._helper._renderWorldCopies&&(Dt=o.aI(Ye,Ft-O/2,Ft+O/2));const Ut=Me/2;Dt-Ut<re&&(ft=re+Ut),Dt+Ut>oe&&(ft=oe-Ut)}if(ft!==void 0||mt!==void 0){const Ft=new o.P(ft??Ye,mt??gt);w.center=As(O,Ft).wrap()}return w}calculateCenterFromCameraLngLatAlt(l,m,w,P){return this._helper.calculateCenterFromCameraLngLatAlt(l,m,w,P)}_calculateNearFarZIfNeeded(l,m,w){if(!this._helper.autoCalculateNearFarZ)return;const P=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),O=l-P*this._helper._pixelPerMeter/Math.cos(m),G=P<0?O:l,J=Math.PI/2+this.pitchInRadians,re=o.aa(this.fov)*(Math.abs(Math.cos(o.aa(this.roll)))*this.height+Math.abs(Math.sin(o.aa(this.roll)))*this.width)/this.height*(.5+w.y/this.height),oe=Math.sin(re)*G/Math.sin(o.ab(Math.PI-J-re,.01,Math.PI-.01)),pe=Gi(this),Ce=Math.atan(pe/this._helper.cameraToCenterDistance),Me=o.aa(.75),Ke=Ce>Me?2*Ce*(.5+w.y/(2*pe)):Me,Ye=Math.sin(Ke)*G/Math.sin(o.ab(Math.PI-J-Ke,.01,Math.PI-.01)),gt=Math.min(oe,Ye);this._helper._farZ=1.01*(Math.cos(Math.PI/2-m)*gt+G),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const l=this.centerOffset,m=fs(this.worldSize,this.center),w=m.x,P=m.y;this._helper._pixelPerMeter=o.aH(1,this.center.lat)*this.worldSize;const O=o.aa(Math.min(this.pitch,89.25)),G=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(O));let J;this._calculateNearFarZIfNeeded(G,O,l),J=new Float64Array(16),o.aV(J,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),o.an(this._invProjMatrix,J),J[8]=2*-l.x/this._helper._width,J[9]=2*l.y/this._helper._height,this._projectionMatrix=o.aW(J),o.K(J,J,[1,-1,1]),o.J(J,J,[0,0,-this._helper.cameraToCenterDistance]),o.aX(J,J,-this.rollInRadians),o.aY(J,J,this.pitchInRadians),o.aX(J,J,-this.bearingInRadians),o.J(J,J,[-w,-P,0]),this._mercatorMatrix=o.K([],J,[this.worldSize,this.worldSize,this.worldSize]),o.K(J,J,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=o.L(new Float64Array(16),this.clipSpaceToPixelsMatrix,J),o.J(J,J,[0,0,-this.elevation]),this._viewProjMatrix=J,this._invViewProjMatrix=o.an([],J);const re=[0,0,-1,1];o.al(re,re,this._invViewProjMatrix),this._cameraPosition=[re[0]/re[3],re[1]/re[3],re[2]/re[3]],this._fogMatrix=new Float64Array(16),o.aV(this._fogMatrix,this.fovInRadians,this.width/this.height,G,this._helper._farZ),this._fogMatrix[8]=2*-l.x/this.width,this._fogMatrix[9]=2*l.y/this.height,o.K(this._fogMatrix,this._fogMatrix,[1,-1,1]),o.J(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),o.aX(this._fogMatrix,this._fogMatrix,-this.rollInRadians),o.aY(this._fogMatrix,this._fogMatrix,this.pitchInRadians),o.aX(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),o.J(this._fogMatrix,this._fogMatrix,[-w,-P,0]),o.K(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),o.J(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=o.L(new Float64Array(16),this.clipSpaceToPixelsMatrix,J);const oe=this._helper._width%2/2,pe=this._helper._height%2/2,Ce=Math.cos(this.bearingInRadians),Me=Math.sin(-this.bearingInRadians),Ke=w-Math.round(w)+Ce*oe+Me*pe,Ye=P-Math.round(P)+Ce*pe+Me*oe,gt=new Float64Array(J);if(o.J(gt,gt,[Ke>.5?Ke-1:Ke,Ye>.5?Ye-1:Ye,0]),this._alignedProjMatrix=gt,J=o.an(new Float64Array(16),this._pixelMatrix),!J)throw new Error("failed to invert matrix");this._pixelMatrixInverse=J,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const l=this.screenPointToMercatorCoordinate(new o.P(0,0)),m=[l.x*this.worldSize,l.y*this.worldSize,0,1];return o.al(m,m,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const l=o.aH(1,this.center.lat)*this.worldSize;return Us(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/l).toLngLat()}lngLatToCameraDepth(l,m){const w=o.Y.fromLngLat(l),P=[w.x*this.worldSize,w.y*this.worldSize,m,1];return o.al(P,P,this._viewProjMatrix),P[2]/P[3]}getProjectionData(l){const{overscaledTileID:m,aligned:w,applyTerrainMatrix:P}=l,O=this._helper.getMercatorTileCoordinates(m),G=m?this.calculatePosMatrix(m,w,!0):null;let J;return J=m&&m.terrainRttPosMatrix32f&&P?m.terrainRttPosMatrix32f:G||o.aZ(),{mainMatrix:J,tileMercatorCoords:O,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:J}}isLocationOccluded(l){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(l,m,w){return 1}transformLightDirection(l){return o.aN(l)}getRayDirectionFromPixel(l){throw new Error("Not implemented.")}projectTileCoordinates(l,m,w,P){const O=this.calculatePosMatrix(w);let G;P?(G=[l,m,P(l,m),1],o.al(G,G,O)):(G=[l,m,0,1],jn(G,G,O));const J=G[3];return{point:new o.P(G[0]/J,G[1]/J),signedDistanceFromCamera:J,isOccluded:!1}}populateCache(l){for(const m of l)this.calculatePosMatrix(m)}getMatrixForModel(l,m){const w=o.Y.fromLngLat(l,m),P=w.meterInMercatorCoordinateUnits(),O=o.a_();return o.J(O,O,[w.x,w.y,w.z]),o.aX(O,O,Math.PI),o.aY(O,O,Math.PI/2),o.K(O,O,[-P,P,P]),O}getProjectionDataForCustomLayer(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;const m=new o.S(0,0,0,0,0),w=this.getProjectionData({overscaledTileID:m,applyGlobeMatrix:l}),P=uu(m,this.worldSize);o.L(P,this._viewProjMatrix,P),w.tileMercatorCoords=[0,0,1,1];const O=[o.X,o.X,this.worldSize/this._helper.pixelsPerMeter],G=o.a$();return o.K(G,P,O),w.fallbackMatrix=G,w.mainMatrix=G,w}getFastPathSimpleProjectionMatrix(l){return this.calculatePosMatrix(l)}}function Ro(){o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function hu(D){if(D.useSlerp)if(D.k<1){const l=o.b0(D.startEulerAngles.roll,D.startEulerAngles.pitch,D.startEulerAngles.bearing),m=o.b0(D.endEulerAngles.roll,D.endEulerAngles.pitch,D.endEulerAngles.bearing),w=new Float64Array(4);o.b1(w,l,m,D.k);const P=o.b2(w);D.tr.setRoll(P.roll),D.tr.setPitch(P.pitch),D.tr.setBearing(P.bearing)}else D.tr.setRoll(D.endEulerAngles.roll),D.tr.setPitch(D.endEulerAngles.pitch),D.tr.setBearing(D.endEulerAngles.bearing);else D.tr.setRoll(o.y.number(D.startEulerAngles.roll,D.endEulerAngles.roll,D.k)),D.tr.setPitch(o.y.number(D.startEulerAngles.pitch,D.endEulerAngles.pitch,D.k)),D.tr.setBearing(o.y.number(D.startEulerAngles.bearing,D.endEulerAngles.bearing,D.k))}function to(D,l,m,w,P){const O=P.padding,G=fs(P.worldSize,m.getNorthWest()),J=fs(P.worldSize,m.getNorthEast()),re=fs(P.worldSize,m.getSouthEast()),oe=fs(P.worldSize,m.getSouthWest()),pe=o.aa(-w),Ce=G.rotate(pe),Me=J.rotate(pe),Ke=re.rotate(pe),Ye=oe.rotate(pe),gt=new o.P(Math.max(Ce.x,Me.x,Ye.x,Ke.x),Math.max(Ce.y,Me.y,Ye.y,Ke.y)),ft=new o.P(Math.min(Ce.x,Me.x,Ye.x,Ke.x),Math.min(Ce.y,Me.y,Ye.y,Ke.y)),mt=gt.sub(ft),xt=(P.width-(O.left+O.right+l.left+l.right))/mt.x,Ft=(P.height-(O.top+O.bottom+l.top+l.bottom))/mt.y;if(Ft<0||xt<0)return void Ro();const Dt=Math.min(o.a8(P.scale*Math.min(xt,Ft)),D.maxZoom),Ut=o.P.convert(D.offset),Gt=new o.P((l.left-l.right)/2,(l.top-l.bottom)/2).rotate(o.aa(w)),zt=Ut.add(Gt).mult(P.scale/o.aG(Dt));return{center:As(P.worldSize,G.add(re).div(2).sub(zt)),zoom:Dt,bearing:w}}class du{get useGlobeControls(){return!1}handlePanInertia(l,m){return{easingOffset:l,easingCenter:m.center}}handleMapControlsRollPitchBearingZoom(l,m){l.bearingDelta&&m.setBearing(m.bearing+l.bearingDelta),l.pitchDelta&&m.setPitch(m.pitch+l.pitchDelta),l.rollDelta&&m.setRoll(m.roll+l.rollDelta),l.zoomDelta&&m.setZoom(m.zoom+l.zoomDelta)}handleMapControlsPan(l,m,w){l.around.distSqr(m.centerPoint)<.01||m.setLocationAtPoint(w,l.around)}cameraForBoxAndBearing(l,m,w,P,O){return to(l,m,w,P,O)}handleJumpToCenterZoom(l,m){l.zoom!==(m.zoom!==void 0?+m.zoom:l.zoom)&&l.setZoom(+m.zoom),m.center!==void 0&&l.setCenter(o.N.convert(m.center))}handleEaseTo(l,m){const w=l.zoom,P=l.padding,O={roll:l.roll,pitch:l.pitch,bearing:l.bearing},G={roll:m.roll===void 0?l.roll:m.roll,pitch:m.pitch===void 0?l.pitch:m.pitch,bearing:m.bearing===void 0?l.bearing:m.bearing},J=m.zoom!==void 0,re=!l.isPaddingEqual(m.padding);let oe=!1;const pe=J?+m.zoom:l.zoom;let Ce=l.centerPoint.add(m.offsetAsPoint);const Me=l.screenPointToLocation(Ce),{center:Ke,zoom:Ye}=l.getConstrained(o.N.convert(m.center||Me),pe??w);eo(l,Ke);const gt=fs(l.worldSize,Me),ft=fs(l.worldSize,Ke).sub(gt),mt=o.aG(Ye-w);return oe=Ye!==w,{easeFunc:xt=>{if(oe&&l.setZoom(o.y.number(w,Ye,xt)),o.b3(O,G)||hu({startEulerAngles:O,endEulerAngles:G,tr:l,k:xt,useSlerp:O.roll!=G.roll}),re&&(l.interpolatePadding(P,m.padding,xt),Ce=l.centerPoint.add(m.offsetAsPoint)),m.around)l.setLocationAtPoint(m.around,m.aroundPoint);else{const Ft=o.aG(l.zoom-w),Dt=Ye>w?Math.min(2,mt):Math.max(.5,mt),Ut=Math.pow(Dt,1-xt),Gt=As(l.worldSize,gt.add(ft.mult(xt*Ut)).mult(Ft));l.setLocationAtPoint(l.renderWorldCopies?Gt.wrap():Gt,Ce)}},isZooming:oe,elevationCenter:Ke}}handleFlyTo(l,m){const w=m.zoom!==void 0,P=l.zoom,O=l.getConstrained(o.N.convert(m.center||m.locationAtOffset),w?+m.zoom:P),G=O.center,J=O.zoom;eo(l,G);const re=fs(l.worldSize,m.locationAtOffset),oe=fs(l.worldSize,G).sub(re),pe=oe.mag(),Ce=o.aG(J-P);let Me;if(m.minZoom!==void 0){const Ke=Math.min(+m.minZoom,P,J),Ye=l.getConstrained(G,Ke).zoom;Me=o.aG(Ye-P)}return{easeFunc:(Ke,Ye,gt,ft)=>{l.setZoom(Ke===1?J:P+o.a8(Ye));const mt=Ke===1?G:As(l.worldSize,re.add(oe.mult(gt)).mult(Ye));l.setLocationAtPoint(l.renderWorldCopies?mt.wrap():mt,ft)},scaleOfZoom:Ce,targetCenter:G,scaleOfMinZoom:Me,pixelPathLength:pe}}}class Li{constructor(l,m,w){this.blendFunction=l,this.blendColor=m,this.mask=w}}Li.Replace=[1,0],Li.disabled=new Li(Li.Replace,o.b4.transparent,[!1,!1,!1,!1]),Li.unblended=new Li(Li.Replace,o.b4.transparent,[!0,!0,!0,!0]),Li.alphaBlended=new Li([1,771],o.b4.transparent,[!0,!0,!0,!0]);const Ol=2305;class Ai{constructor(l,m,w){this.enable=l,this.mode=m,this.frontFace=w}}Ai.disabled=new Ai(!1,1029,Ol),Ai.backCCW=new Ai(!0,1029,Ol),Ai.frontCCW=new Ai(!0,1028,Ol);class si{constructor(l,m,w){this.func=l,this.mask=m,this.range=w}}si.ReadOnly=!1,si.ReadWrite=!0,si.disabled=new si(519,si.ReadOnly,[0,1]);const ku=7680;class wi{constructor(l,m,w,P,O,G){this.test=l,this.ref=m,this.mask=w,this.fail=P,this.depthFail=O,this.pass=G}}wi.disabled=new wi({func:519,mask:0},0,0,ku,ku,ku);const kl=new WeakMap;function ro(D){var l;if(kl.has(D))return kl.get(D);{const m=(l=D.getParameter(D.VERSION))===null||l===void 0?void 0:l.startsWith("WebGL 2.0");return kl.set(D,m),m}}class Ba{get awaitingQuery(){return!!this._readbackQueue}constructor(l){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=l;const m=l.context,w=m.gl;this._texFormat=w.RGBA,this._texType=w.UNSIGNED_BYTE;const P=new o.aC;P.emplaceBack(-1,-1),P.emplaceBack(2,-1),P.emplaceBack(-1,2);const O=new o.aE;O.emplaceBack(0,1,2),this._fullscreenTriangle=new lo(m.createVertexBuffer(P,yn.members),m.createIndexBuffer(O),o.aD.simpleSegment(0,0,P.length,O.length)),this._resultBuffer=new Uint8Array(4),m.activeTexture.set(w.TEXTURE1);const G=w.createTexture();w.bindTexture(w.TEXTURE_2D,G),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_S,w.CLAMP_TO_EDGE),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_T,w.CLAMP_TO_EDGE),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MIN_FILTER,w.NEAREST),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MAG_FILTER,w.NEAREST),w.texImage2D(w.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=m.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(G),ro(w)&&(this._pbo=w.createBuffer(),w.bindBuffer(w.PIXEL_PACK_BUFFER,this._pbo),w.bufferData(w.PIXEL_PACK_BUFFER,4,w.STREAM_READ),w.bindBuffer(w.PIXEL_PACK_BUFFER,null))}destroy(){const l=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),l.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(l,m){const w=this._updateCount;return this._readbackQueue?w>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():w>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(l,m),this._updateCount++,this._measuredError}_bindFramebuffer(){const l=this._cachedRenderContext.context,m=l.gl;l.activeTexture.set(m.TEXTURE1),m.bindTexture(m.TEXTURE_2D,this._fbo.colorAttachment.get()),l.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(l,m){const w=this._cachedRenderContext.context,P=w.gl;if(this._bindFramebuffer(),w.viewport.set([0,0,this._texWidth,this._texHeight]),w.clear({color:o.b4.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(w,P.TRIANGLES,si.disabled,wi.disabled,Li.unblended,Ai.disabled,((O,G)=>({u_input:O,u_output_expected:G}))(l,m),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&ro(P)){P.bindBuffer(P.PIXEL_PACK_BUFFER,this._pbo),P.readBuffer(P.COLOR_ATTACHMENT0),P.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),P.bindBuffer(P.PIXEL_PACK_BUFFER,null);const O=P.fenceSync(P.SYNC_GPU_COMMANDS_COMPLETE,0);P.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:O}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const l=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&ro(l)){const m=l.clientWaitSync(this._readbackQueue.sync,0,0);if(m===l.WAIT_FAILED)return o.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(m===l.TIMEOUT_EXPIRED)return;l.bindBuffer(l.PIXEL_PACK_BUFFER,this._pbo),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),l.bindBuffer(l.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),l.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=Ba._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(l){let m=0;return m+=l[0]/256,m+=l[1]/65536,m+=l[2]/16777216,l[3]<127&&(m=-m),m/128}}const ac=o.X/128;function ja(D,l){const m=D.granularity!==void 0?Math.max(D.granularity,1):1,w=m+(D.generateBorders?2:0),P=m+(D.extendToNorthPole||D.generateBorders?1:0)+(D.extendToSouthPole||D.generateBorders?1:0),O=w+1,G=P+1,J=D.generateBorders?-1:0,re=D.generateBorders||D.extendToNorthPole?-1:0,oe=m+(D.generateBorders?1:0),pe=m+(D.generateBorders||D.extendToSouthPole?1:0),Ce=O*G,Me=w*P*6,Ke=O*G>65536;if(Ke&&l==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const Ye=Ke||l==="32bit",gt=new Int16Array(2*Ce);let ft=0;for(let Ft=re;Ft<=pe;Ft++)for(let Dt=J;Dt<=oe;Dt++){let Ut=Dt/m*o.X;Dt===-1&&(Ut=-64),Dt===m+1&&(Ut=o.X+ac);let Gt=Ft/m*o.X;Ft===-1&&(Gt=D.extendToNorthPole?o.b6:-64),Ft===m+1&&(Gt=D.extendToSouthPole?o.b7:o.X+ac),gt[ft++]=Ut,gt[ft++]=Gt}const mt=Ye?new Uint32Array(Me):new Uint16Array(Me);let xt=0;for(let Ft=0;Ft<P;Ft++)for(let Dt=0;Dt<w;Dt++){const Ut=Dt+1+Ft*O,Gt=Dt+(Ft+1)*O,zt=Dt+1+(Ft+1)*O;mt[xt++]=Dt+Ft*O,mt[xt++]=Gt,mt[xt++]=Ut,mt[xt++]=Ut,mt[xt++]=Gt,mt[xt++]=zt}return{vertices:gt.buffer.slice(0),indices:mt.buffer.slice(0),uses32bitIndices:Ye}}const qa=new o.aB({fill:new o.b8(128,2),line:new o.b8(512,0),tile:new o.b8(128,32),stencil:new o.b8(128,1),circle:3});class qo{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return ds.projectionGlobe}get vertexShaderPreludeCode(){return ds.projectionMercator.vertexSource}get subdivisionGranularity(){return qa}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(l){this._errorMeasurement||(this._errorMeasurement=new Ba(l));const m=o.Q(this._errorQueryLatitudeDegrees),w=2*Math.atan(Math.exp(Math.PI-m*Math.PI*2))-.5*Math.PI,P=this._errorMeasurement.updateErrorLoop(m,w),O=T.now();P!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=P,this._errorMeasurementLastChangeTime=O);const G=Math.min(Math.max((O-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=o.b9(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,o.ba(G))}_getMeshKey(l){return`${l.granularity.toString(36)}_${l.generateBorders?"b":""}${l.extendToNorthPole?"n":""}${l.extendToSouthPole?"s":""}`}getMeshFromTileID(l,m,w,P,O){const G=(O==="stencil"?qa.stencil:qa.tile).getGranularityForZoomLevel(m.z);return this._getMesh(l,{granularity:G,generateBorders:w,extendToNorthPole:m.y===0&&P,extendToSouthPole:m.y===(1<<m.z)-1&&P})}_getMesh(l,m){const w=this._getMeshKey(m);if(w in this._tileMeshCache)return this._tileMeshCache[w];const P=function(O,G){const J=ja(G,"16bit"),re=o.aC.deserialize({arrayBuffer:J.vertices,length:J.vertices.byteLength/2/2}),oe=o.aE.deserialize({arrayBuffer:J.indices,length:J.indices.byteLength/2/3});return new lo(O.createVertexBuffer(re,yn.members),O.createIndexBuffer(oe),o.aD.simpleSegment(0,0,re.length,oe.length))}(l,m);return this._tileMeshCache[w]=P,P}recalculate(l){}hasTransition(){const l=T.now();let m=!1;return m=m||(l-this._errorMeasurementLastChangeTime)/1e3<.7,m=m||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,m}setErrorQueryLatitudeDegrees(l){this._errorQueryLatitudeDegrees=l}}const dh=new o.q({type:new o.D(o.v.projection.type)});class fu extends o.E{constructor(l){super(),this._transitionable=new o.T(dh),this.setProjection(l),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new o.z(0)),this._mercatorProjection=new $a,this._verticalPerspectiveProjection=new qo}get transitionState(){const l=this.properties.get("type");if(typeof l=="string"&&l==="mercator")return 0;if(typeof l=="string"&&l==="vertical-perspective")return 1;if(l instanceof o.bb){if(l.from==="vertical-perspective"&&l.to==="mercator")return 1-l.transition;if(l.from==="mercator"&&l.to==="vertical-perspective")return l.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(l){this._mercatorProjection.updateGPUdependent(l),this._verticalPerspectiveProjection.updateGPUdependent(l)}getMeshFromTileID(l,m,w,P,O){return this.currentProjection.getMeshFromTileID(l,m,w,P,O)}setProjection(l){this._transitionable.setValue("type",(l==null?void 0:l.type)||"mercator")}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}setErrorQueryLatitudeDegrees(l){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(l),this._mercatorProjection.setErrorQueryLatitudeDegrees(l)}}function Ul(D){const l=Ko(D.worldSize,D.center.lat);return 2*Math.PI*l}function oa(D,l,m,w,P){const O=1/(1<<P),G=l/o.X*O+w*O,J=o.bd((D/o.X*O+m*O)*Math.PI*2+Math.PI,2*Math.PI),re=2*Math.atan(Math.exp(Math.PI-G*Math.PI*2))-.5*Math.PI,oe=Math.cos(re),pe=new Float64Array(3);return pe[0]=Math.sin(J)*oe,pe[1]=Math.sin(re),pe[2]=Math.cos(J)*oe,pe}function Sn(D){return function(l,m){const w=Math.cos(m),P=new Float64Array(3);return P[0]=Math.sin(l)*w,P[1]=Math.sin(m),P[2]=Math.cos(l)*w,P}(D.lng*Math.PI/180,D.lat*Math.PI/180)}function Ko(D,l){return D/(2*Math.PI)/Math.cos(l*Math.PI/180)}function Ka(D){const l=Math.asin(D[1])/Math.PI*180,m=Math.sqrt(D[0]*D[0]+D[2]*D[2]);if(m>1e-6){const w=D[0]/m,P=Math.acos(D[2]/m),O=(w>0?P:-P)/Math.PI*180;return new o.N(o.aI(O,-180,180),l)}return new o.N(0,l)}function go(D){return Math.cos(D*Math.PI/180)}function $i(D,l){const m=go(D),w=go(l);return o.a8(w/m)}function Au(D,l){const m=D.rotate(l.bearingInRadians),w=l.zoom+$i(l.center.lat,0),P=o.b9(1/go(l.center.lat),1/go(Math.min(Math.abs(l.center.lat),60)),o.bc(w,7,3,0,1)),O=360/Ul({worldSize:l.worldSize,center:{lat:l.center.lat}});return new o.N(l.center.lng-m.x*O*P,o.ab(l.center.lat+m.y*O,-85.051129,o.aF))}function Ca(D){const l=.5*D,m=Math.sin(l),w=Math.cos(l);return Math.log(m+w)-Math.log(w-m)}function Nh(D,l,m,w){const P=D.lat+m*w;if(Math.abs(m)>1){const O=(Math.sign(D.lat+m)!==Math.sign(D.lat)?-Math.abs(D.lat):Math.abs(D.lat))*Math.PI/180,G=Math.abs(D.lat+m)*Math.PI/180,J=Ca(O+w*(G-O)),re=Ca(O),oe=Ca(G);return new o.N(D.lng+l*((J-re)/(oe-re)),P)}return new o.N(D.lng+l*w,P)}class pu{constructor(l){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._aabbFactory=l}recalculateCache(){if(!this._hadAnyChanges)return;const l=this._cachePrevious;this._cachePrevious=this._cache,this._cache=l,this._cache.clear(),this._hadAnyChanges=!1}getTileAABB(l,m,w,P){const O=`${l.z}_${l.x}_${l.y}`,G=this._cache.get(O);if(G)return G;const J=this._cachePrevious.get(O);if(J)return this._cache.set(O,J),J;const re=this._aabbFactory(l,m,w,P);return this._cache.set(O,re),this._hadAnyChanges=!0,re}}function Uu(D,l,m){const w=D-l;return w<0?-w:Math.max(0,w-m)}function gu(D,l,m,w,P){const O=D-m;let G;return G=O<0?Math.min(-O,1+O-P):O>1?Math.min(Math.max(O-P,0),1-O):0,Math.max(G,Uu(l,w,P))}class fh{constructor(){this._aabbCache=new pu(this._computeTileAABB)}recalculateCache(){this._aabbCache.recalculateCache()}distanceToTile2d(l,m,w,P){const O=1<<w.z,G=1/O,J=w.x/O,re=w.y/O;let oe=2;return oe=Math.min(oe,gu(l,m,J,re,G)),oe=Math.min(oe,gu(l,m,J+.5,-re-G,G)),oe=Math.min(oe,gu(l,m,J+.5,2-re-G,G)),oe}getWrap(l,m,w){const P=1<<m.z,O=1/P,G=m.x/P,J=Uu(l.x,G,O),re=Uu(l.x,G-1,O),oe=Uu(l.x,G+1,O),pe=Math.min(J,re,oe);return pe===oe?1:pe===re?-1:0}allowVariableZoom(l,m){return Tn(l,m)>4}allowWorldCopies(){return!1}getTileAABB(l,m,w,P){return this._aabbCache.getTileAABB(l,m,w,P)}_computeTileAABB(l,m,w,P){if(l.z<=0)return new ai([-1,-1,-1],[1,1,1]);if(l.z===1)return new ai([l.x===0?-1:0,l.y===0?0:-1,-1],[l.x===0?0:1,l.y===0?1:0,1]);{const O=[oa(0,0,l.x,l.y,l.z),oa(o.X,0,l.x,l.y,l.z),oa(o.X,o.X,l.x,l.y,l.z),oa(0,o.X,l.x,l.y,l.z)],G=[1,1,1],J=[-1,-1,-1];for(const re of O)for(let oe=0;oe<3;oe++)G[oe]=Math.min(G[oe],re[oe]),J[oe]=Math.max(J[oe],re[oe]);if(l.y===0||l.y===(1<<l.z)-1){const re=[0,l.y===0?1:-1,0];for(let oe=0;oe<3;oe++)G[oe]=Math.min(G[oe],re[oe]),J[oe]=Math.max(J[oe],re[oe])}return new ai(G,J)}}}class mu{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(l){this._helper.setMinZoom(l)}setMaxZoom(l){this._helper.setMaxZoom(l)}setMinPitch(l){this._helper.setMinPitch(l)}setMaxPitch(l){this._helper.setMaxPitch(l)}setRenderWorldCopies(l){this._helper.setRenderWorldCopies(l)}setBearing(l){this._helper.setBearing(l)}setPitch(l){this._helper.setPitch(l)}setRoll(l){this._helper.setRoll(l)}setFov(l){this._helper.setFov(l)}setZoom(l){this._helper.setZoom(l)}setCenter(l){this._helper.setCenter(l)}setElevation(l){this._helper.setElevation(l)}setMinElevationForCurrentTile(l){this._helper.setMinElevationForCurrentTile(l)}setPadding(l){this._helper.setPadding(l)}interpolatePadding(l,m,w){return this._helper.interpolatePadding(l,m,w)}isPaddingEqual(l){return this._helper.isPaddingEqual(l)}resize(l,m){this._helper.resize(l,m)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(l){this._helper.setMaxBounds(l)}overrideNearFarZ(l,m){this._helper.overrideNearFarZ(l,m)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(l){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),l)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(l){}constructor(){this._cachedClippingPlane=o.be(),this._projectionMatrix=o.a_(),this._globeViewProjMatrix32f=o.aZ(),this._globeViewProjMatrixNoCorrection=o.a_(),this._globeViewProjMatrixNoCorrectionInverted=o.a_(),this._globeProjMatrixInverted=o.a_(),this._cameraPosition=o.bf(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new oc({calcMatrices:()=>{this._calcMatrices()},getConstrained:(l,m)=>this.getConstrained(l,m)}),this._coveringTilesDetailsProvider=new fh}clone(){const l=new mu;return l.apply(this),l}apply(l,m){this._globeLatitudeErrorCorrectionRadians=m||0,this._helper.apply(l)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const l=o.bf();return l[0]=this._cameraPosition[0],l[1]=this._cameraPosition[1],l[2]=this._cameraPosition[2],l}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(l){const{overscaledTileID:m,applyGlobeMatrix:w}=l,P=this._helper.getMercatorTileCoordinates(m);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:P,clippingPlane:this._cachedClippingPlane,projectionTransition:w?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(l){const m=this.pitchInRadians,w=this.cameraToCenterDistance/l,P=Math.sin(m)*w,O=Math.cos(m)*w+1,G=1/Math.sqrt(P*P+O*O)*1;let J=-P,re=O;const oe=Math.sqrt(J*J+re*re);J/=oe,re/=oe;const pe=[0,J,re];return o.bg(pe,pe,[0,0,0],-this.bearingInRadians),o.bh(pe,pe,[0,0,0],-1*this.center.lat*Math.PI/180),o.bi(pe,pe,[0,0,0],this.center.lng*Math.PI/180),o.aL(pe,pe,.25),[...pe,.25*-G]}isLocationOccluded(l){return!this.isSurfacePointVisible(Sn(l))}transformLightDirection(l){const m=this._helper._center.lng*Math.PI/180,w=this._helper._center.lat*Math.PI/180,P=Math.cos(w),O=[Math.sin(m)*P,Math.sin(w),Math.cos(m)*P],G=[O[2],0,-O[0]],J=[0,0,0];o.aR(J,G,O),o.aQ(G,G),o.aQ(J,J);const re=[0,0,0];return o.aQ(re,[G[0]*l[0]+J[0]*l[1]+O[0]*l[2],G[1]*l[0]+J[1]*l[1]+O[1]*l[2],G[2]*l[0]+J[2]*l[1]+O[2]*l[2]]),re}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(l,m,w){const P=function(J,re,oe){const pe=1/(1<<oe.z);return new o.Y(J/o.X*pe+oe.x*pe,re/o.X*pe+oe.y*pe)}(l,m,w.canonical),O=(G=P.y,[o.bd(P.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-G*Math.PI*2))-.5*Math.PI]);var G;return this.getCircleRadiusCorrection()/Math.cos(O[1])}projectTileCoordinates(l,m,w,P){const O=w.canonical,G=oa(l,m,O.x,O.y,O.z),J=1+(P?P(l,m):0)/o.bo,re=[G[0]*J,G[1]*J,G[2]*J,1];o.al(re,re,this._globeViewProjMatrixNoCorrection);const oe=this._cachedClippingPlane,pe=oe[0]*G[0]+oe[1]*G[1]+oe[2]*G[2]+oe[3]<0;return{point:new o.P(re[0]/re[3],re[1]/re[3]),signedDistanceFromCamera:re[3],isOccluded:pe}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const l=Ko(this.worldSize,this.center.lat),m=o.a$(),w=o.a$();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*l),o.aV(m,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const P=this.centerOffset;m[8]=2*-P.x/this._helper._width,m[9]=2*P.y/this._helper._height,this._projectionMatrix=o.aW(m),this._globeProjMatrixInverted=o.a$(),o.an(this._globeProjMatrixInverted,m),o.J(m,m,[0,0,-this.cameraToCenterDistance]),o.aX(m,m,this.rollInRadians),o.aY(m,m,-this.pitchInRadians),o.aX(m,m,this.bearingInRadians),o.J(m,m,[0,0,-l]);const O=o.bf();O[0]=l,O[1]=l,O[2]=l,o.aY(w,m,this.center.lat*Math.PI/180),o.bj(w,w,-this.center.lng*Math.PI/180),o.K(w,w,O),this._globeViewProjMatrixNoCorrection=w,o.aY(m,m,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),o.bj(m,m,-this.center.lng*Math.PI/180),o.K(m,m,O),this._globeViewProjMatrix32f=new Float32Array(m),this._globeViewProjMatrixNoCorrectionInverted=o.a$(),o.an(this._globeViewProjMatrixNoCorrectionInverted,w);const G=o.bf();this._cameraPosition=o.bf(),this._cameraPosition[2]=this.cameraToCenterDistance/l,o.bg(this._cameraPosition,this._cameraPosition,G,-this.rollInRadians),o.bh(this._cameraPosition,this._cameraPosition,G,this.pitchInRadians),o.bg(this._cameraPosition,this._cameraPosition,G,-this.bearingInRadians),o.aM(this._cameraPosition,this._cameraPosition,[0,0,1]),o.bh(this._cameraPosition,this._cameraPosition,G,-this.center.lat*Math.PI/180),o.bi(this._cameraPosition,this._cameraPosition,G,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(l);const J=o.aW(this._globeViewProjMatrixNoCorrectionInverted);o.K(J,J,[1,1,-1]),this._cachedFrustum=ps.fromInvProjectionMatrix(J)}calculateFogMatrix(l){o.w("calculateFogMatrix is not supported on globe projection.");const m=o.a$();return o.aq(m),m}getVisibleUnwrappedCoordinates(l){return[new o.aT(0,l)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(l){l&&o.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(l,m){if(!this._globeViewProjMatrixNoCorrection)return 1;const w=Sn(l);o.aL(w,w,1+m/o.bo);const P=o.be();return o.al(P,[w[0],w[1],w[2],1],this._globeViewProjMatrixNoCorrection),P[2]/P[3]}populateCache(l){}getBounds(){const l=.5*this.width,m=.5*this.height,w=[new o.P(0,0),new o.P(l,0),new o.P(this.width,0),new o.P(this.width,m),new o.P(this.width,this.height),new o.P(l,this.height),new o.P(0,this.height),new o.P(0,m)],P=[];for(const Ce of w)P.push(this.unprojectScreenPoint(Ce));let O=0,G=0,J=0,re=0;const oe=this.center;for(const Ce of P){const Me=o.bk(oe.lng,Ce.lng),Ke=o.bk(oe.lat,Ce.lat);Me<G&&(G=Me),Me>O&&(O=Me),Ke<re&&(re=Ke),Ke>J&&(J=Ke)}const pe=[oe.lng+G,oe.lat+re,oe.lng+O,oe.lat+J];return this.isSurfacePointOnScreen([0,1,0])&&(pe[3]=90,pe[0]=-180,pe[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(pe[1]=-90,pe[0]=-180,pe[2]=180),new on(pe)}getConstrained(l,m){const w=o.ab(l.lat,-85.051129,o.aF),P=o.ab(+m,this.minZoom+$i(0,w),this.maxZoom);return{center:new o.N(l.lng,w),zoom:P}}calculateCenterFromCameraLngLatAlt(l,m,w,P){return this._helper.calculateCenterFromCameraLngLatAlt(l,m,w,P)}setLocationAtPoint(l,m){const w=Sn(this.unprojectScreenPoint(m)),P=Sn(l),O=o.bf();o.bl(O);const G=o.bf();o.bi(G,w,O,-this.center.lng*Math.PI/180),o.bh(G,G,O,this.center.lat*Math.PI/180);const J=P[0]*P[0]+P[2]*P[2],re=G[0]*G[0];if(J<re)return;const oe=Math.sqrt(J-re),pe=-oe,Ce=o.bm(P[0],P[2],G[0],oe),Me=o.bm(P[0],P[2],G[0],pe),Ke=o.bf();o.bi(Ke,P,O,-Ce);const Ye=o.bm(Ke[1],Ke[2],G[1],G[2]),gt=o.bf();o.bi(gt,P,O,-Me);const ft=o.bm(gt[1],gt[2],G[1],G[2]),mt=.5*Math.PI,xt=Ye>=-mt&&Ye<=mt,Ft=ft>=-mt&&ft<=mt;let Dt,Ut;if(xt&&Ft){const sr=this.center.lng*Math.PI/180,gr=this.center.lat*Math.PI/180;o.bp(Ce,sr)+o.bp(Ye,gr)<o.bp(Me,sr)+o.bp(ft,gr)?(Dt=Ce,Ut=Ye):(Dt=Me,Ut=ft)}else if(xt)Dt=Ce,Ut=Ye;else{if(!Ft)return;Dt=Me,Ut=ft}const Gt=Dt/Math.PI*180,zt=Ut/Math.PI*180,ir=this.center.lat;this.setCenter(new o.N(Gt,o.ab(zt,-90,90))),this.setZoom(this.zoom+$i(ir,this.center.lat))}locationToScreenPoint(l,m){const w=Sn(l);if(m){const P=m.getElevationForLngLatZoom(l,this._helper._tileZoom);o.aL(w,w,1+P/o.bo)}return this._projectSurfacePointToScreen(w)}_projectSurfacePointToScreen(l){const m=o.be();return o.al(m,[...l,1],this._globeViewProjMatrixNoCorrection),m[0]/=m[3],m[1]/=m[3],new o.P((.5*m[0]+.5)*this.width,(.5*-m[1]+.5)*this.height)}screenPointToMercatorCoordinate(l,m){if(m){const w=m.pointCoordinate(l);if(w)return w}return o.Y.fromLngLat(this.unprojectScreenPoint(l))}screenPointToLocation(l,m){var w;return(w=this.screenPointToMercatorCoordinate(l,m))===null||w===void 0?void 0:w.toLngLat()}isPointOnMapSurface(l,m){const w=this._cameraPosition,P=this.getRayDirectionFromPixel(l);return!!this.rayPlanetIntersection(w,P)}getRayDirectionFromPixel(l){const m=o.be();m[0]=l.x/this.width*2-1,m[1]=-1*(l.y/this.height*2-1),m[2]=1,m[3]=1,o.al(m,m,this._globeViewProjMatrixNoCorrectionInverted),m[0]/=m[3],m[1]/=m[3],m[2]/=m[3];const w=o.bf();w[0]=m[0]-this._cameraPosition[0],w[1]=m[1]-this._cameraPosition[1],w[2]=m[2]-this._cameraPosition[2];const P=o.bf();return o.aQ(P,w),P}isSurfacePointVisible(l){const m=this._cachedClippingPlane;return m[0]*l[0]+m[1]*l[1]+m[2]*l[2]+m[3]>=0}isSurfacePointOnScreen(l){if(!this.isSurfacePointVisible(l))return!1;const m=o.be();return o.al(m,[...l,1],this._globeViewProjMatrixNoCorrection),m[0]/=m[3],m[1]/=m[3],m[2]/=m[3],m[0]>-1&&m[0]<1&&m[1]>-1&&m[1]<1&&m[2]>-1&&m[2]<1}rayPlanetIntersection(l,m){const w=o.aS(l,m),P=o.bf(),O=o.bf();o.aL(O,m,w),o.aP(P,l,O);const G=1-o.aS(P,P);if(G<0)return null;const J=o.aS(l,l)-1,re=-w+(w<0?1:-1)*Math.sqrt(G),oe=J/re,pe=re;return{tMin:Math.min(oe,pe),tMax:Math.max(oe,pe)}}unprojectScreenPoint(l){const m=this._cameraPosition,w=this.getRayDirectionFromPixel(l),P=this.rayPlanetIntersection(m,w);if(P){const oe=o.bf();o.aM(oe,m,[w[0]*P.tMin,w[1]*P.tMin,w[2]*P.tMin]);const pe=o.bf();return o.aQ(pe,oe),Ka(pe)}const O=this._cachedClippingPlane[0]*w[0]+this._cachedClippingPlane[1]*w[1]+this._cachedClippingPlane[2]*w[2],G=-o.bn(this._cachedClippingPlane,m)/O,J=o.bf();if(G>0)o.aM(J,m,[w[0]*G,w[1]*G,w[2]*G]);else{const oe=o.bf();o.aM(oe,m,[2*w[0],2*w[1],2*w[2]]);const pe=o.bn(this._cachedClippingPlane,oe);o.aP(J,oe,[this._cachedClippingPlane[0]*pe,this._cachedClippingPlane[1]*pe,this._cachedClippingPlane[2]*pe])}const re=o.bf();return o.aQ(re,J),Ka(re)}getMatrixForModel(l,m){const w=o.N.convert(l),P=1/o.bo,O=o.a_();return o.bj(O,O,w.lng/180*Math.PI),o.aY(O,O,-w.lat/180*Math.PI),o.J(O,O,[0,0,1+m/o.bo]),o.aY(O,O,.5*Math.PI),o.K(O,O,[P,P,P]),O}getProjectionDataForCustomLayer(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;const m=this.getProjectionData({overscaledTileID:new o.S(0,0,0,0,0),applyGlobeMatrix:l});return m.tileMercatorCoords=[0,0,1,1],m}getFastPathSimpleProjectionMatrix(l){}}class xo{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(l){this._helper.setMinZoom(l)}setMaxZoom(l){this._helper.setMaxZoom(l)}setMinPitch(l){this._helper.setMinPitch(l)}setMaxPitch(l){this._helper.setMaxPitch(l)}setRenderWorldCopies(l){this._helper.setRenderWorldCopies(l)}setBearing(l){this._helper.setBearing(l)}setPitch(l){this._helper.setPitch(l)}setRoll(l){this._helper.setRoll(l)}setFov(l){this._helper.setFov(l)}setZoom(l){this._helper.setZoom(l)}setCenter(l){this._helper.setCenter(l)}setElevation(l){this._helper.setElevation(l)}setMinElevationForCurrentTile(l){this._helper.setMinElevationForCurrentTile(l)}setPadding(l){this._helper.setPadding(l)}interpolatePadding(l,m,w){return this._helper.interpolatePadding(l,m,w)}isPaddingEqual(l){return this._helper.isPaddingEqual(l)}resize(l,m){let w=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;this._helper.resize(l,m,w)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(l){this._helper.setMaxBounds(l)}overrideNearFarZ(l,m){this._helper.overrideNearFarZ(l,m)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(l){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),l)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(l,m){this._globeness=l,this._globeLatitudeErrorCorrectionRadians=m,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().recalculateCache(),this._mercatorTransform.getCoveringTilesDetailsProvider().recalculateCache()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new oc({calcMatrices:()=>{this._calcMatrices()},getConstrained:(l,m)=>this.getConstrained(l,m)}),this._globeness=1,this._mercatorTransform=new Dn,this._verticalPerspectiveTransform=new mu}clone(){const l=new xo;return l._globeness=this._globeness,l._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,l.apply(this),l}apply(l){this._helper.apply(l),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(l){const m=this._mercatorTransform.getProjectionData(l),w=this._verticalPerspectiveTransform.getProjectionData(l);return{mainMatrix:this.isGlobeRendering?w.mainMatrix:m.mainMatrix,clippingPlane:w.clippingPlane,tileMercatorCoords:w.tileMercatorCoords,projectionTransition:l.applyGlobeMatrix?this._globeness:0,fallbackMatrix:m.fallbackMatrix}}isLocationOccluded(l){return this.currentTransform.isLocationOccluded(l)}transformLightDirection(l){return this.currentTransform.transformLightDirection(l)}getPixelScale(){return o.b9(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return o.b9(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(l,m,w){const P=this._mercatorTransform.getPitchedTextCorrection(l,m,w),O=this._verticalPerspectiveTransform.getPitchedTextCorrection(l,m,w);return o.b9(P,O,this._globeness)}projectTileCoordinates(l,m,w,P){return this.currentTransform.projectTileCoordinates(l,m,w,P)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(l){return this.currentTransform.calculateFogMatrix(l)}getVisibleUnwrappedCoordinates(l){return this.currentTransform.getVisibleUnwrappedCoordinates(l)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(l){this._mercatorTransform.recalculateZoomAndCenter(l),this._verticalPerspectiveTransform.recalculateZoomAndCenter(l)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(l,m){return this.currentTransform.lngLatToCameraDepth(l,m)}populateCache(l){this._mercatorTransform.populateCache(l),this._verticalPerspectiveTransform.populateCache(l)}getBounds(){return this.currentTransform.getBounds()}getConstrained(l,m){return this.currentTransform.getConstrained(l,m)}calculateCenterFromCameraLngLatAlt(l,m,w,P){return this._helper.calculateCenterFromCameraLngLatAlt(l,m,w,P)}setLocationAtPoint(l,m){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(l,m),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(l,m),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(l,m){return this.currentTransform.locationToScreenPoint(l,m)}screenPointToMercatorCoordinate(l,m){return this.currentTransform.screenPointToMercatorCoordinate(l,m)}screenPointToLocation(l,m){return this.currentTransform.screenPointToLocation(l,m)}isPointOnMapSurface(l,m){return this.currentTransform.isPointOnMapSurface(l,m)}getRayDirectionFromPixel(l){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(l)}getMatrixForModel(l,m){return this.currentTransform.getMatrixForModel(l,m)}getProjectionDataForCustomLayer(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;const m=this._mercatorTransform.getProjectionDataForCustomLayer(l);if(!this.isGlobeRendering)return m;const w=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(l);return w.fallbackMatrix=m.mainMatrix,w}getFastPathSimpleProjectionMatrix(l){return this.currentTransform.getFastPathSimpleProjectionMatrix(l)}}class wo{get useGlobeControls(){return!0}handlePanInertia(l,m){const w=Au(l,m);return Math.abs(w.lng-m.center.lng)>180&&(w.lng=m.center.lng+179.5*Math.sign(w.lng-m.center.lng)),{easingCenter:w,easingOffset:new o.P(0,0)}}handleMapControlsRollPitchBearingZoom(l,m){const w=l.around,P=m.screenPointToLocation(w);l.bearingDelta&&m.setBearing(m.bearing+l.bearingDelta),l.pitchDelta&&m.setPitch(m.pitch+l.pitchDelta),l.rollDelta&&m.setRoll(m.roll+l.rollDelta);const O=m.zoom;l.zoomDelta&&m.setZoom(m.zoom+l.zoomDelta);const G=m.zoom-O;if(G===0)return;const J=o.bk(m.center.lng,P.lng),re=J/(Math.abs(J/180)+1),oe=o.bk(m.center.lat,P.lat),pe=m.getRayDirectionFromPixel(w),Ce=m.cameraPosition,Me=-1*o.aS(Ce,pe),Ke=o.bf();o.aM(Ke,Ce,[pe[0]*Me,pe[1]*Me,pe[2]*Me]);const Ye=o.bq(Ke)-1,gt=Math.exp(.5*-Math.max(Ye-.3,0)),ft=Ko(m.worldSize,m.center.lat)/Math.min(m.width,m.height),mt=o.bc(ft,.9,.5,1,.25),xt=(1-o.aG(-G))*Math.min(gt,mt),Ft=m.center.lat,Dt=m.zoom,Ut=new o.N(m.center.lng+re*xt,o.ab(m.center.lat+oe*xt,-85.051129,o.aF));m.setLocationAtPoint(P,w);const Gt=m.center,zt=o.bc(Math.abs(J),45,85,0,1),ir=o.bc(ft,.75,.35,0,1),sr=Math.pow(Math.max(zt,ir),.25),gr=o.bk(Gt.lng,Ut.lng),Er=o.bk(Gt.lat,Ut.lat);m.setCenter(new o.N(Gt.lng+gr*sr,Gt.lat+Er*sr).wrap()),m.setZoom(Dt+$i(Ft,m.center.lat))}handleMapControlsPan(l,m,w){if(!l.panDelta)return;const P=m.center.lat,O=m.zoom;m.setCenter(Au(l.panDelta,m).wrap()),m.setZoom(O+$i(P,m.center.lat))}cameraForBoxAndBearing(l,m,w,P,O){const G=to(l,m,w,P,O),J=m.left/O.width*2-1,re=(O.width-m.right)/O.width*2-1,oe=m.top/O.height*-2+1,pe=(O.height-m.bottom)/O.height*-2+1,Ce=o.bk(w.getWest(),w.getEast())<0,Me=Ce?w.getEast():w.getWest(),Ke=Ce?w.getWest():w.getEast(),Ye=Math.max(w.getNorth(),w.getSouth()),gt=Math.min(w.getNorth(),w.getSouth()),ft=Me+.5*o.bk(Me,Ke),mt=Ye+.5*o.bk(Ye,gt),xt=O.clone();xt.setCenter(G.center),xt.setBearing(G.bearing),xt.setPitch(0),xt.setRoll(0),xt.setZoom(G.zoom);const Ft=xt.modelViewProjectionMatrix,Dt=[Sn(w.getNorthWest()),Sn(w.getNorthEast()),Sn(w.getSouthWest()),Sn(w.getSouthEast()),Sn(new o.N(Ke,mt)),Sn(new o.N(Me,mt)),Sn(new o.N(ft,Ye)),Sn(new o.N(ft,gt))],Ut=Sn(G.center);let Gt=Number.POSITIVE_INFINITY;for(const zt of Dt)J<0&&(Gt=wo.getLesserNonNegativeNonNull(Gt,wo.solveVectorScale(zt,Ut,Ft,"x",J))),re>0&&(Gt=wo.getLesserNonNegativeNonNull(Gt,wo.solveVectorScale(zt,Ut,Ft,"x",re))),oe>0&&(Gt=wo.getLesserNonNegativeNonNull(Gt,wo.solveVectorScale(zt,Ut,Ft,"y",oe))),pe<0&&(Gt=wo.getLesserNonNegativeNonNull(Gt,wo.solveVectorScale(zt,Ut,Ft,"y",pe)));if(Number.isFinite(Gt)&&Gt!==0)return G.zoom=xt.zoom+o.a8(Gt),G;Ro()}handleJumpToCenterZoom(l,m){const w=l.center.lat,P=l.getConstrained(m.center?o.N.convert(m.center):l.center,l.zoom).center;l.setCenter(P.wrap());const O=m.zoom!==void 0?+m.zoom:l.zoom+$i(w,P.lat);l.zoom!==O&&l.setZoom(O)}handleEaseTo(l,m){const w=l.zoom,P=l.center,O=l.padding,G={roll:l.roll,pitch:l.pitch,bearing:l.bearing},J={roll:m.roll===void 0?l.roll:m.roll,pitch:m.pitch===void 0?l.pitch:m.pitch,bearing:m.bearing===void 0?l.bearing:m.bearing},re=m.zoom!==void 0,oe=!l.isPaddingEqual(m.padding);let pe=!1;const Ce=m.center?o.N.convert(m.center):P,Me=l.getConstrained(Ce,w).center;eo(l,Me);const Ke=l.clone();Ke.setCenter(Me),Ke.setZoom(re?+m.zoom:w+$i(P.lat,Ce.lat)),Ke.setBearing(m.bearing);const Ye=new o.P(o.ab(l.centerPoint.x+m.offsetAsPoint.x,0,l.width),o.ab(l.centerPoint.y+m.offsetAsPoint.y,0,l.height));Ke.setLocationAtPoint(Me,Ye);const gt=(m.offset&&m.offsetAsPoint.mag())>0?Ke.center:Me,ft=re?+m.zoom:w+$i(P.lat,gt.lat),mt=w+$i(P.lat,0),xt=ft+$i(gt.lat,0),Ft=o.bk(P.lng,gt.lng),Dt=o.bk(P.lat,gt.lat),Ut=o.aG(xt-mt);return pe=ft!==w,{easeFunc:Gt=>{if(o.b3(G,J)||hu({startEulerAngles:G,endEulerAngles:J,tr:l,k:Gt,useSlerp:G.roll!=J.roll}),oe&&l.interpolatePadding(O,m.padding,Gt),m.around)o.w("Easing around a point is not supported under globe projection."),l.setLocationAtPoint(m.around,m.aroundPoint);else{const zt=xt>mt?Math.min(2,Ut):Math.max(.5,Ut),ir=Math.pow(zt,1-Gt),sr=Nh(P,Ft,Dt,Gt*ir);l.setCenter(sr.wrap())}if(pe){const zt=o.y.number(mt,xt,Gt)+$i(0,l.center.lat);l.setZoom(zt)}},isZooming:pe,elevationCenter:gt}}handleFlyTo(l,m){const w=m.zoom!==void 0,P=l.center,O=l.zoom,G=!l.isPaddingEqual(m.padding),J=l.getConstrained(o.N.convert(m.center||m.locationAtOffset),O).center,re=w?+m.zoom:l.zoom+$i(l.center.lat,J.lat),oe=l.clone();oe.setCenter(J),G&&oe.setPadding(m.padding),oe.setZoom(re),oe.setBearing(m.bearing);const pe=new o.P(o.ab(l.centerPoint.x+m.offsetAsPoint.x,0,l.width),o.ab(l.centerPoint.y+m.offsetAsPoint.y,0,l.height));oe.setLocationAtPoint(J,pe);const Ce=oe.center;eo(l,Ce);const Me=function(Ft,Dt,Ut){const Gt=Sn(Dt),zt=Sn(Ut),ir=o.aS(Gt,zt),sr=Math.acos(ir),gr=Ul(Ft);return sr/(2*Math.PI)*gr}(l,P,Ce),Ke=O+$i(P.lat,0),Ye=re+$i(Ce.lat,0),gt=o.aG(Ye-Ke);let ft;if(typeof m.minZoom=="number"){const Ft=+m.minZoom+$i(Ce.lat,0),Dt=Math.min(Ft,Ke,Ye)+$i(0,Ce.lat),Ut=l.getConstrained(Ce,Dt).zoom+$i(Ce.lat,0);ft=o.aG(Ut-Ke)}const mt=o.bk(P.lng,Ce.lng),xt=o.bk(P.lat,Ce.lat);return{easeFunc:(Ft,Dt,Ut,Gt)=>{const zt=Nh(P,mt,xt,Ut),ir=Ft===1?Ce:zt;l.setCenter(ir.wrap());const sr=Ke+o.a8(Dt);l.setZoom(Ft===1?re:sr+$i(0,ir.lat))},scaleOfZoom:gt,targetCenter:Ce,scaleOfMinZoom:ft,pixelPathLength:Me}}static solveVectorScale(l,m,w,P,O){const G=P==="x"?[w[0],w[4],w[8],w[12]]:[w[1],w[5],w[9],w[13]],J=[w[3],w[7],w[11],w[15]],re=l[0]*G[0]+l[1]*G[1]+l[2]*G[2],oe=l[0]*J[0]+l[1]*J[1]+l[2]*J[2],pe=m[0]*G[0]+m[1]*G[1]+m[2]*G[2],Ce=m[0]*J[0]+m[1]*J[1]+m[2]*J[2];return pe+O*oe===re+O*Ce||J[3]*(re-pe)+G[3]*(Ce-oe)+re*Ce==pe*oe?null:(pe+G[3]-O*Ce-O*J[3])/(pe-re-O*Ce+O*oe)}static getLesserNonNegativeNonNull(l,m){return m!==null&&m>=0&&m<l?m:l}}class Lc{constructor(l){this._globe=l,this._mercatorCameraHelper=new du,this._verticalPerspectiveCameraHelper=new wo}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(l,m){return this.currentHelper.handlePanInertia(l,m)}handleMapControlsRollPitchBearingZoom(l,m){return this.currentHelper.handleMapControlsRollPitchBearingZoom(l,m)}handleMapControlsPan(l,m,w){this.currentHelper.handleMapControlsPan(l,m,w)}cameraForBoxAndBearing(l,m,w,P,O){return this.currentHelper.cameraForBoxAndBearing(l,m,w,P,O)}handleJumpToCenterZoom(l,m){this.currentHelper.handleJumpToCenterZoom(l,m)}handleEaseTo(l,m){return this.currentHelper.handleEaseTo(l,m)}handleFlyTo(l,m){return this.currentHelper.handleFlyTo(l,m)}}const lc=(D,l)=>o.t(D,l&&l.filter(m=>m.identifier!=="source.canvas")),Dc=o.br();class Lo extends o.E{constructor(l){let m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),this._rtlPluginLoaded=()=>{for(const w in this.sourceCaches){const P=this.sourceCaches[w].getSource().type;P!=="vector"&&P!=="geojson"||this.sourceCaches[w].reload()}},this.map=l,this.dispatcher=new qt(jt(),l._getMapId()),this.dispatcher.registerMessageHandler("GG",(w,P)=>this.getGlyphs(w,P)),this.dispatcher.registerMessageHandler("GI",(w,P)=>this.getImages(w,P)),this.imageManager=new at,this.imageManager.setEventedParent(this),this.glyphManager=new Ne(l._requestManager,m.localIdeographFontFamily),this.lineAtlas=new Xt(256,512),this.crossTileSymbolIndex=new os,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new o.bs,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",o.bt()),br().on(Fn,this._rtlPluginLoaded),this.on("data",w=>{if(w.dataType!=="source"||w.sourceDataType!=="metadata")return;const P=this.sourceCaches[w.sourceId];if(!P)return;const O=P.getSource();if(O&&O.vectorLayerIds)for(const G in this._layers){const J=this._layers[G];J.source===O.id&&this._validateLayer(J)}})}loadURL(l){let m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},w=arguments.length>2?arguments[2]:void 0;this.fire(new o.k("dataloading",{dataType:"style"})),m.validate=typeof m.validate!="boolean"||m.validate;const P=this.map._requestManager.transformRequest(l,"Style");this._loadStyleRequest=new AbortController;const O=this._loadStyleRequest;o.h(P,this._loadStyleRequest).then(G=>{this._loadStyleRequest=null,this._load(G.data,m,w)}).catch(G=>{this._loadStyleRequest=null,G&&!O.signal.aborted&&this.fire(new o.j(G))})}loadJSON(l){let m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},w=arguments.length>2?arguments[2]:void 0;this.fire(new o.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,T.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,m.validate=m.validate!==!1,this._load(l,m,w)}).catch(()=>{})}loadEmpty(){this.fire(new o.k("dataloading",{dataType:"style"})),this._load(Dc,{validate:!1})}_load(l,m,w){var P,O;const G=m.transformStyle?m.transformStyle(w,l):l;if(!m.validate||!lc(this,o.u(G))){this._loaded=!0,this.stylesheet=G;for(const J in G.sources)this.addSource(J,G.sources[J],{validate:!1});G.sprite?this._loadSprite(G.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(G.glyphs),this._createLayers(),this.light=new Jt(this.stylesheet.light),this._setProjectionInternal(((P=this.stylesheet.projection)===null||P===void 0?void 0:P.type)||"mercator"),this.sky=new er(this.stylesheet.sky),this.map.setTerrain((O=this.stylesheet.terrain)!==null&&O!==void 0?O:null),this.fire(new o.k("data",{dataType:"style"})),this.fire(new o.k("style.load"))}}_createLayers(){const l=o.bu(this.stylesheet.layers);this.dispatcher.broadcast("SL",l),this._order=l.map(m=>m.id),this._layers={},this._serializedLayers=null;for(const m of l){const w=o.bv(m);w.setEventedParent(this,{layer:{id:m.id}}),this._layers[m.id]=w}}_loadSprite(l){let m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,w=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0,P;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(O,G,J,re){return o._(this,void 0,void 0,function*(){const oe=be(O),pe=J>1?"@2x":"",Ce={},Me={};for(const{id:Ke,url:Ye}of oe){const gt=G.transformRequest(Qe(Ye,pe,".json"),"SpriteJSON");Ce[Ke]=o.h(gt,re);const ft=G.transformRequest(Qe(Ye,pe,".png"),"SpriteImage");Me[Ke]=fe.getImage(ft,re)}return yield Promise.all([...Object.values(Ce),...Object.values(Me)]),function(Ke,Ye){return o._(this,void 0,void 0,function*(){const gt={};for(const ft in Ke){gt[ft]={};const mt=T.getImageCanvasContext((yield Ye[ft]).data),xt=(yield Ke[ft]).data;for(const Ft in xt){const{width:Dt,height:Ut,x:Gt,y:zt,sdf:ir,pixelRatio:sr,stretchX:gr,stretchY:Er,content:fr,textFitWidth:qr,textFitHeight:Jr}=xt[Ft];gt[ft][Ft]={data:null,pixelRatio:sr,sdf:ir,stretchX:gr,stretchY:Er,content:fr,textFitWidth:qr,textFitHeight:Jr,spriteData:{width:Dt,height:Ut,x:Gt,y:zt,context:mt}}}}return gt})}(Ce,Me)})}(l,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(O=>{if(this._spriteRequest=null,O)for(const G in O){this._spritesImagesIds[G]=[];const J=this._spritesImagesIds[G]?this._spritesImagesIds[G].filter(re=>!(re in O)):[];for(const re of J)this.imageManager.removeImage(re),this._changedImages[re]=!0;for(const re in O[G]){const oe=G==="default"?re:`${G}:${re}`;this._spritesImagesIds[G].push(oe),oe in this.imageManager.images?this.imageManager.updateImage(oe,O[G][re],!1):this.imageManager.addImage(oe,O[G][re]),m&&(this._changedImages[oe]=!0)}}}).catch(O=>{this._spriteRequest=null,P=O,this.fire(new o.j(P))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),m&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.k("data",{dataType:"style"})),w&&w(P)})}_unloadSprite(){for(const l of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(l),this._changedImages[l]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.k("data",{dataType:"style"}))}_validateLayer(l){const m=this.sourceCaches[l.source];if(!m)return;const w=l.sourceLayer;if(!w)return;const P=m.getSource();(P.type==="geojson"||P.vectorLayerIds&&P.vectorLayerIds.indexOf(w)===-1)&&this.fire(new o.j(new Error(`Source layer "${w}" does not exist on source "${P.id}" as specified by style layer "${l.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const l in this.sourceCaches)if(!this.sourceCaches[l].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(l){let m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const w=this._serializedAllLayers();if(!l||l.length===0)return Object.values(m?o.bw(w):w);const P=[];for(const O of l)if(w[O]){const G=m?o.bw(w[O]):w[O];P.push(G)}return P}_serializedAllLayers(){let l=this._serializedLayers;if(l)return l;l=this._serializedLayers={};const m=Object.keys(this._layers);for(const w of m){const P=this._layers[w];P.type!=="custom"&&(l[w]=P.serialize())}return l}hasTransitions(){var l,m,w;if(!((l=this.light)===null||l===void 0)&&l.hasTransition()||!((m=this.sky)===null||m===void 0)&&m.hasTransition()||!((w=this.projection)===null||w===void 0)&&w.hasTransition())return!0;for(const P in this.sourceCaches)if(this.sourceCaches[P].hasTransition())return!0;for(const P in this._layers)if(this._layers[P].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(l){if(!this._loaded)return;const m=this._changed;if(m){const P=Object.keys(this._updatedLayers),O=Object.keys(this._removedLayers);(P.length||O.length)&&this._updateWorkerLayers(P,O);for(const G in this._updatedSources){const J=this._updatedSources[G];if(J==="reload")this._reloadSource(G);else{if(J!=="clear")throw new Error(`Invalid action ${J}`);this._clearSource(G)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const G in this._updatedPaintProps)this._layers[G].updateTransitions(l);this.light.updateTransitions(l),this.sky.updateTransitions(l),this._resetUpdates()}const w={};for(const P in this.sourceCaches){const O=this.sourceCaches[P];w[P]=O.used,O.used=!1}for(const P of this._order){const O=this._layers[P];O.recalculate(l,this._availableImages),!O.isHidden(l.zoom)&&O.source&&(this.sourceCaches[O.source].used=!0)}for(const P in w){const O=this.sourceCaches[P];!!w[P]!=!!O.used&&O.fire(new o.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:P}))}this.light.recalculate(l),this.sky.recalculate(l),this.projection.recalculate(l),this.z=l.zoom,m&&this.fire(new o.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const l=Object.keys(this._changedImages);if(l.length){for(const m in this.sourceCaches)this.sourceCaches[m].reloadTilesForDependencies(["icons","patterns"],l);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const l in this.sourceCaches)this.sourceCaches[l].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(l,m){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(l,!1),removedIds:m})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(l){let m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var w;this._checkLoaded();const P=this.serialize();if(l=m.transformStyle?m.transformStyle(P,l):l,((w=m.validate)===null||w===void 0||w)&&lc(this,o.u(l)))return!1;(l=o.bw(l)).layers=o.bu(l.layers);const O=o.bx(P,l),G=this._getOperationsToPerform(O);if(G.unimplemented.length>0)throw new Error(`Unimplemented: ${G.unimplemented.join(", ")}.`);if(G.operations.length===0)return!1;for(const J of G.operations)J();return this.stylesheet=l,this._serializedLayers=null,!0}_getOperationsToPerform(l){const m=[],w=[];for(const P of l)switch(P.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":m.push(()=>this.addLayer.apply(this,P.args));break;case"removeLayer":m.push(()=>this.removeLayer.apply(this,P.args));break;case"setPaintProperty":m.push(()=>this.setPaintProperty.apply(this,P.args));break;case"setLayoutProperty":m.push(()=>this.setLayoutProperty.apply(this,P.args));break;case"setFilter":m.push(()=>this.setFilter.apply(this,P.args));break;case"addSource":m.push(()=>this.addSource.apply(this,P.args));break;case"removeSource":m.push(()=>this.removeSource.apply(this,P.args));break;case"setLayerZoomRange":m.push(()=>this.setLayerZoomRange.apply(this,P.args));break;case"setLight":m.push(()=>this.setLight.apply(this,P.args));break;case"setGeoJSONSourceData":m.push(()=>this.setGeoJSONSourceData.apply(this,P.args));break;case"setGlyphs":m.push(()=>this.setGlyphs.apply(this,P.args));break;case"setSprite":m.push(()=>this.setSprite.apply(this,P.args));break;case"setTerrain":m.push(()=>this.map.setTerrain.apply(this,P.args));break;case"setSky":m.push(()=>this.setSky.apply(this,P.args));break;case"setProjection":this.setProjection.apply(this,P.args);break;case"setTransition":m.push(()=>{});break;default:w.push(P.command)}return{operations:m,unimplemented:w}}addImage(l,m){if(this.getImage(l))return this.fire(new o.j(new Error(`An image named "${l}" already exists.`)));this.imageManager.addImage(l,m),this._afterImageUpdated(l)}updateImage(l,m){this.imageManager.updateImage(l,m)}getImage(l){return this.imageManager.getImage(l)}removeImage(l){if(!this.getImage(l))return this.fire(new o.j(new Error(`An image named "${l}" does not exist.`)));this.imageManager.removeImage(l),this._afterImageUpdated(l)}_afterImageUpdated(l){this._availableImages=this.imageManager.listImages(),this._changedImages[l]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(l,m){let w=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(this._checkLoaded(),this.sourceCaches[l]!==void 0)throw new Error(`Source "${l}" already exists.`);if(!m.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(m).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(m.type)>=0&&this._validate(o.u.source,`sources.${l}`,m,null,w))return;this.map&&this.map._collectResourceTiming&&(m.collectResourceTiming=!0);const P=this.sourceCaches[l]=new He(l,m,this.dispatcher);P.style=this,P.setEventedParent(this,()=>({isSourceLoaded:P.loaded(),source:P.serialize(),sourceId:l})),P.onAdd(this.map),this._changed=!0}removeSource(l){if(this._checkLoaded(),this.sourceCaches[l]===void 0)throw new Error("There is no source with this ID");for(const w in this._layers)if(this._layers[w].source===l)return this.fire(new o.j(new Error(`Source "${l}" cannot be removed while layer "${w}" is using it.`)));const m=this.sourceCaches[l];delete this.sourceCaches[l],delete this._updatedSources[l],m.fire(new o.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:l})),m.setEventedParent(null),m.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(l,m){if(this._checkLoaded(),this.sourceCaches[l]===void 0)throw new Error(`There is no source with this ID=${l}`);const w=this.sourceCaches[l].getSource();if(w.type!=="geojson")throw new Error(`geojsonSource.type is ${w.type}, which is !== 'geojson`);w.setData(m),this._changed=!0}getSource(l){return this.sourceCaches[l]&&this.sourceCaches[l].getSource()}addLayer(l,m){let w=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this._checkLoaded();const P=l.id;if(this.getLayer(P))return void this.fire(new o.j(new Error(`Layer "${P}" already exists on this map.`)));let O;if(l.type==="custom"){if(lc(this,o.by(l)))return;O=o.bv(l)}else{if("source"in l&&typeof l.source=="object"&&(this.addSource(P,l.source),l=o.bw(l),l=o.e(l,{source:P})),this._validate(o.u.layer,`layers.${P}`,l,{arrayIndex:-1},w))return;O=o.bv(l),this._validateLayer(O),O.setEventedParent(this,{layer:{id:P}})}const G=m?this._order.indexOf(m):this._order.length;if(m&&G===-1)this.fire(new o.j(new Error(`Cannot add layer "${P}" before non-existing layer "${m}".`)));else{if(this._order.splice(G,0,P),this._layerOrderChanged=!0,this._layers[P]=O,this._removedLayers[P]&&O.source&&O.type!=="custom"){const J=this._removedLayers[P];delete this._removedLayers[P],J.type!==O.type?this._updatedSources[O.source]="clear":(this._updatedSources[O.source]="reload",this.sourceCaches[O.source].pause())}this._updateLayer(O),O.onAdd&&O.onAdd(this.map)}}moveLayer(l,m){if(this._checkLoaded(),this._changed=!0,!this._layers[l])return void this.fire(new o.j(new Error(`The layer '${l}' does not exist in the map's style and cannot be moved.`)));if(l===m)return;const w=this._order.indexOf(l);this._order.splice(w,1);const P=m?this._order.indexOf(m):this._order.length;m&&P===-1?this.fire(new o.j(new Error(`Cannot move layer "${l}" before non-existing layer "${m}".`))):(this._order.splice(P,0,l),this._layerOrderChanged=!0)}removeLayer(l){this._checkLoaded();const m=this._layers[l];if(!m)return void this.fire(new o.j(new Error(`Cannot remove non-existing layer "${l}".`)));m.setEventedParent(null);const w=this._order.indexOf(l);this._order.splice(w,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[l]=m,delete this._layers[l],this._serializedLayers&&delete this._serializedLayers[l],delete this._updatedLayers[l],delete this._updatedPaintProps[l],m.onRemove&&m.onRemove(this.map)}getLayer(l){return this._layers[l]}getLayersOrder(){return[...this._order]}hasLayer(l){return l in this._layers}setLayerZoomRange(l,m,w){this._checkLoaded();const P=this.getLayer(l);P?P.minzoom===m&&P.maxzoom===w||(m!=null&&(P.minzoom=m),w!=null&&(P.maxzoom=w),this._updateLayer(P)):this.fire(new o.j(new Error(`Cannot set the zoom range of non-existing layer "${l}".`)))}setFilter(l,m){let w=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this._checkLoaded();const P=this.getLayer(l);if(P){if(!o.bz(P.filter,m))return m==null?(P.filter=void 0,void this._updateLayer(P)):void(this._validate(o.u.filter,`layers.${P.id}.filter`,m,null,w)||(P.filter=o.bw(m),this._updateLayer(P)))}else this.fire(new o.j(new Error(`Cannot filter non-existing layer "${l}".`)))}getFilter(l){return o.bw(this.getLayer(l).filter)}setLayoutProperty(l,m,w){let P=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};this._checkLoaded();const O=this.getLayer(l);O?o.bz(O.getLayoutProperty(m),w)||(O.setLayoutProperty(m,w,P),this._updateLayer(O)):this.fire(new o.j(new Error(`Cannot style non-existing layer "${l}".`)))}getLayoutProperty(l,m){const w=this.getLayer(l);if(w)return w.getLayoutProperty(m);this.fire(new o.j(new Error(`Cannot get style of non-existing layer "${l}".`)))}setPaintProperty(l,m,w){let P=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};this._checkLoaded();const O=this.getLayer(l);O?o.bz(O.getPaintProperty(m),w)||(O.setPaintProperty(m,w,P)&&this._updateLayer(O),this._changed=!0,this._updatedPaintProps[l]=!0,this._serializedLayers=null):this.fire(new o.j(new Error(`Cannot style non-existing layer "${l}".`)))}getPaintProperty(l,m){return this.getLayer(l).getPaintProperty(m)}setFeatureState(l,m){this._checkLoaded();const w=l.source,P=l.sourceLayer,O=this.sourceCaches[w];if(O===void 0)return void this.fire(new o.j(new Error(`The source '${w}' does not exist in the map's style.`)));const G=O.getSource().type;G==="geojson"&&P?this.fire(new o.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):G!=="vector"||P?(l.id===void 0&&this.fire(new o.j(new Error("The feature id parameter must be provided."))),O.setFeatureState(P,l.id,m)):this.fire(new o.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(l,m){this._checkLoaded();const w=l.source,P=this.sourceCaches[w];if(P===void 0)return void this.fire(new o.j(new Error(`The source '${w}' does not exist in the map's style.`)));const O=P.getSource().type,G=O==="vector"?l.sourceLayer:void 0;O!=="vector"||G?m&&typeof l.id!="string"&&typeof l.id!="number"?this.fire(new o.j(new Error("A feature id is required to remove its specific state property."))):P.removeFeatureState(G,l.id,m):this.fire(new o.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(l){this._checkLoaded();const m=l.source,w=l.sourceLayer,P=this.sourceCaches[m];if(P!==void 0)return P.getSource().type!=="vector"||w?(l.id===void 0&&this.fire(new o.j(new Error("The feature id parameter must be provided."))),P.getFeatureState(w,l.id)):void this.fire(new o.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new o.j(new Error(`The source '${m}' does not exist in the map's style.`)))}getTransition(){return o.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const l=o.bA(this.sourceCaches,O=>O.serialize()),m=this._serializeByIds(this._order,!0),w=this.map.getTerrain()||void 0,P=this.stylesheet;return o.bB({version:P.version,name:P.name,metadata:P.metadata,light:P.light,sky:P.sky,center:P.center,zoom:P.zoom,bearing:P.bearing,pitch:P.pitch,sprite:P.sprite,glyphs:P.glyphs,transition:P.transition,projection:P.projection,sources:l,layers:m,terrain:w},O=>O!==void 0)}_updateLayer(l){this._updatedLayers[l.id]=!0,l.source&&!this._updatedSources[l.source]&&this.sourceCaches[l.source].getSource().type!=="raster"&&(this._updatedSources[l.source]="reload",this.sourceCaches[l.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(l){const m=G=>this._layers[G].type==="fill-extrusion",w={},P=[];for(let G=this._order.length-1;G>=0;G--){const J=this._order[G];if(m(J)){w[J]=G;for(const re of l){const oe=re[J];if(oe)for(const pe of oe)P.push(pe)}}}P.sort((G,J)=>J.intersectionZ-G.intersectionZ);const O=[];for(let G=this._order.length-1;G>=0;G--){const J=this._order[G];if(m(J))for(let re=P.length-1;re>=0;re--){const oe=P[re].feature;if(w[oe.layer.id]<G)break;O.push(oe),P.pop()}else for(const re of l){const oe=re[J];if(oe)for(const pe of oe)O.push(pe.feature)}}return O}queryRenderedFeatures(l,m,w){m&&m.filter&&this._validate(o.u.filter,"queryRenderedFeatures.filter",m.filter,null,m);const P={};if(m&&m.layers){if(!(Array.isArray(m.layers)||m.layers instanceof Set))return this.fire(new o.j(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const oe of m.layers){const pe=this._layers[oe];if(!pe)return this.fire(new o.j(new Error(`The layer '${oe}' does not exist in the map's style and cannot be queried for features.`))),[];P[pe.source]=!0}}const O=[];m.availableImages=this._availableImages;const G=this._serializedAllLayers(),J=m.layers instanceof Set?m.layers:Array.isArray(m.layers)?new Set(m.layers):null,re=Object.assign(Object.assign({},m),{layers:J});for(const oe in this.sourceCaches)m.layers&&!P[oe]||O.push($r(this.sourceCaches[oe],this._layers,G,l,re,w));return this.placement&&O.push(function(oe,pe,Ce,Me,Ke,Ye,gt){const ft={},mt=Ye.queryRenderedSymbols(Me),xt=[];for(const Ft of Object.keys(mt).map(Number))xt.push(gt[Ft]);xt.sort(kr);for(const Ft of xt){const Dt=Ft.featureIndex.lookupSymbolFeatures(mt[Ft.bucketInstanceId],pe,Ft.bucketIndex,Ft.sourceLayerIndex,Ke.filter,Ke.layers,Ke.availableImages,oe);for(const Ut in Dt){const Gt=ft[Ut]=ft[Ut]||[],zt=Dt[Ut];zt.sort((ir,sr)=>{const gr=Ft.featureSortOrder;if(gr){const Er=gr.indexOf(ir.featureIndex);return gr.indexOf(sr.featureIndex)-Er}return sr.featureIndex-ir.featureIndex});for(const ir of zt)Gt.push(ir)}}return function(Ft,Dt,Ut){for(const Gt in Ft)for(const zt of Ft[Gt])Gr(zt,Ut[Dt[Gt].source]);return Ft}(ft,oe,Ce)}(this._layers,G,this.sourceCaches,l,re,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(O)}querySourceFeatures(l,m){m&&m.filter&&this._validate(o.u.filter,"querySourceFeatures.filter",m.filter,null,m);const w=this.sourceCaches[l];return w?function(P,O){const G=P.getRenderableIds().map(oe=>P.getTileByID(oe)),J=[],re={};for(let oe=0;oe<G.length;oe++){const pe=G[oe],Ce=pe.tileID.canonical.key;re[Ce]||(re[Ce]=!0,pe.querySourceFeatures(J,O))}return J}(w,m):[]}getLight(){return this.light.getLight()}setLight(l){let m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this._checkLoaded();const w=this.light.getLight();let P=!1;for(const G in l)if(!o.bz(l[G],w[G])){P=!0;break}if(!P)return;const O={now:T.now(),transition:o.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(l,m),this.light.updateTransitions(O)}getProjection(){var l;return(l=this.stylesheet)===null||l===void 0?void 0:l.projection}setProjection(l){if(this._checkLoaded(),this.projection){if(this.projection.name===l.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=l,this._setProjectionInternal(l.type)}getSky(){var l;return(l=this.stylesheet)===null||l===void 0?void 0:l.sky}setSky(l){let m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this._checkLoaded();const w=this.getSky();let P=!1;if(!l&&!w)return;if(l&&!w)P=!0;else if(!l&&w)P=!0;else for(const G in l)if(!o.bz(l[G],w[G])){P=!0;break}if(!P)return;const O={now:T.now(),transition:o.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=l,this.sky.setSky(l,m),this.sky.updateTransitions(O)}_setProjectionInternal(l){const m=function(w){if(Array.isArray(w)){const P=new fu({type:w});return{projection:P,transform:new xo,cameraHelper:new Lc(P)}}switch(w){case"mercator":return{projection:new $a,transform:new Dn,cameraHelper:new du};case"globe":{const P=new fu({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:P,transform:new xo,cameraHelper:new Lc(P)}}case"vertical-perspective":return{projection:new qo,transform:new mu,cameraHelper:new wo};default:return o.w(`Unknown projection name: ${w}. Falling back to mercator projection.`),{projection:new $a,transform:new Dn,cameraHelper:new du}}}(l);this.projection=m.projection,this.map.migrateProjection(m.transform,m.cameraHelper);for(const w in this.sourceCaches)this.sourceCaches[w].reload()}_validate(l,m,w,P){let O=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};return(!O||O.validate!==!1)&&lc(this,l.call(o.u,o.e({key:m,style:this.serialize(),value:w,styleSpec:o.v},P)))}_remove(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),br().off(Fn,this._rtlPluginLoaded);for(const m in this._layers)this._layers[m].setEventedParent(null);for(const m in this.sourceCaches){const w=this.sourceCaches[m];w.setEventedParent(null),w.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),l&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(l)}_clearSource(l){this.sourceCaches[l].clearTiles()}_reloadSource(l){this.sourceCaches[l].resume(),this.sourceCaches[l].reload()}_updateSources(l){for(const m in this.sourceCaches)this.sourceCaches[m].update(l,this.map.terrain)}_generateCollisionBoxes(){for(const l in this.sourceCaches)this._reloadSource(l)}_updatePlacement(l,m,w,P){let O=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1,G=!1,J=!1;const re={};for(const oe of this._order){const pe=this._layers[oe];if(pe.type!=="symbol")continue;if(!re[pe.source]){const Me=this.sourceCaches[pe.source];re[pe.source]=Me.getRenderableIds(!0).map(Ke=>Me.getTileByID(Ke)).sort((Ke,Ye)=>Ye.tileID.overscaledZ-Ke.tileID.overscaledZ||(Ke.tileID.isLessThan(Ye.tileID)?-1:1))}const Ce=this.crossTileSymbolIndex.addLayer(pe,re[pe.source],l.center.lng);G=G||Ce}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((O=O||this._layerOrderChanged||w===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(T.now(),l.zoom))&&(this.pauseablePlacement=new sa(l,this.map.terrain,this._order,O,m,w,P,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,re),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(T.now()),J=!0),G&&this.pauseablePlacement.placement.setStale()),J||G)for(const oe of this._order){const pe=this._layers[oe];pe.type==="symbol"&&this.placement.updateLayerOpacities(pe,re[pe.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(T.now())}_releaseSymbolFadeTiles(){for(const l in this.sourceCaches)this.sourceCaches[l].releaseSymbolFadeTiles()}getImages(l,m){return o._(this,void 0,void 0,function*(){const w=yield this.imageManager.getImages(m.icons);this._updateTilesForChangedImages();const P=this.sourceCaches[m.source];return P&&P.setDependencies(m.tileID.key,m.type,m.icons),w})}getGlyphs(l,m){return o._(this,void 0,void 0,function*(){const w=yield this.glyphManager.getGlyphs(m.stacks),P=this.sourceCaches[m.source];return P&&P.setDependencies(m.tileID.key,m.type,[""]),w})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(l){let m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this._checkLoaded(),l&&this._validate(o.u.glyphs,"glyphs",l,null,m)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=l,this.glyphManager.entries={},this.glyphManager.setURL(l))}addSprite(l,m){let w=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},P=arguments.length>3?arguments[3]:void 0;this._checkLoaded();const O=[{id:l,url:m}],G=[...be(this.stylesheet.sprite),...O];this._validate(o.u.sprite,"sprite",G,null,w)||(this.stylesheet.sprite=G,this._loadSprite(O,!0,P))}removeSprite(l){this._checkLoaded();const m=be(this.stylesheet.sprite);if(m.find(w=>w.id===l)){if(this._spritesImagesIds[l])for(const w of this._spritesImagesIds[l])this.imageManager.removeImage(w),this._changedImages[w]=!0;m.splice(m.findIndex(w=>w.id===l),1),this.stylesheet.sprite=m.length>0?m:void 0,delete this._spritesImagesIds[l],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.k("data",{dataType:"style"}))}else this.fire(new o.j(new Error(`Sprite "${l}" doesn't exists on this map.`)))}getSprite(){return be(this.stylesheet.sprite)}setSprite(l){let m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},w=arguments.length>2?arguments[2]:void 0;this._checkLoaded(),l&&this._validate(o.u.sprite,"sprite",l,null,m)||(this.stylesheet.sprite=l,l?this._loadSprite(l,!0,w):(this._unloadSprite(),w&&w(null)))}}var cc=o.aA([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Nu{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(l,m,w,P,O,G,J,re,oe){this.context=l;let pe=this.boundPaintVertexBuffers.length!==P.length;for(let Ce=0;!pe&&Ce<P.length;Ce++)this.boundPaintVertexBuffers[Ce]!==P[Ce]&&(pe=!0);!this.vao||this.boundProgram!==m||this.boundLayoutVertexBuffer!==w||pe||this.boundIndexBuffer!==O||this.boundVertexOffset!==G||this.boundDynamicVertexBuffer!==J||this.boundDynamicVertexBuffer2!==re||this.boundDynamicVertexBuffer3!==oe?this.freshBind(m,w,P,O,G,J,re,oe):(l.bindVertexArray.set(this.vao),J&&J.bind(),O&&O.dynamicDraw&&O.bind(),re&&re.bind(),oe&&oe.bind())}freshBind(l,m,w,P,O,G,J,re){const oe=l.numAttributes,pe=this.context,Ce=pe.gl;this.vao&&this.destroy(),this.vao=pe.createVertexArray(),pe.bindVertexArray.set(this.vao),this.boundProgram=l,this.boundLayoutVertexBuffer=m,this.boundPaintVertexBuffers=w,this.boundIndexBuffer=P,this.boundVertexOffset=O,this.boundDynamicVertexBuffer=G,this.boundDynamicVertexBuffer2=J,this.boundDynamicVertexBuffer3=re,m.enableAttributes(Ce,l);for(const Me of w)Me.enableAttributes(Ce,l);G&&G.enableAttributes(Ce,l),J&&J.enableAttributes(Ce,l),re&&re.enableAttributes(Ce,l),m.bind(),m.setVertexAttribPointers(Ce,l,O);for(const Me of w)Me.bind(),Me.setVertexAttribPointers(Ce,l,O);G&&(G.bind(),G.setVertexAttribPointers(Ce,l,O)),P&&P.bind(),J&&(J.bind(),J.setVertexAttribPointers(Ce,l,O)),re&&(re.bind(),re.setVertexAttribPointers(Ce,l,O)),pe.currentNumAttributes=oe}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const gl=(D,l,m,w,P)=>({u_texture:0,u_ele_delta:D,u_fog_matrix:l,u_fog_color:m?m.properties.get("fog-color"):o.b4.white,u_fog_ground_blend:m?m.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:P?0:m?m.calculateFogBlendOpacity(w):0,u_horizon_color:m?m.properties.get("horizon-color"):o.b4.white,u_horizon_fog_blend:m?m.properties.get("horizon-fog-blend"):1,u_is_globe_mode:P?1:0}),uc={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function ne(D){const l=[];for(let m=0;m<D.length;m++){if(D[m]===null)continue;const w=D[m].split(" ");l.push(w.pop())}return l}class je{constructor(l,m,w,P,O,G,J,re){const oe=l.gl;this.program=oe.createProgram();const pe=ne(m.staticAttributes),Ce=w?w.getBinderAttributes():[],Me=pe.concat(Ce),Ke=ds.prelude.staticUniforms?ne(ds.prelude.staticUniforms):[],Ye=J.staticUniforms?ne(J.staticUniforms):[],gt=m.staticUniforms?ne(m.staticUniforms):[],ft=w?w.getBinderUniforms():[],mt=Ke.concat(Ye).concat(gt).concat(ft),xt=[];for(const sr of mt)xt.indexOf(sr)<0&&xt.push(sr);const Ft=w?w.defines():[];ro(oe)&&Ft.unshift("#version 300 es"),O&&Ft.push("#define OVERDRAW_INSPECTOR;"),G&&Ft.push("#define TERRAIN3D;"),re&&Ft.push(re);let Dt=Ft.concat(ds.prelude.fragmentSource,J.fragmentSource,m.fragmentSource).join(`
`),Ut=Ft.concat(ds.prelude.vertexSource,J.vertexSource,m.vertexSource).join(`
`);ro(oe)||(Dt=function(sr){return sr.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")}(Dt),Ut=function(sr){return sr.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")}(Ut));const Gt=oe.createShader(oe.FRAGMENT_SHADER);if(oe.isContextLost())return void(this.failedToCreate=!0);if(oe.shaderSource(Gt,Dt),oe.compileShader(Gt),!oe.getShaderParameter(Gt,oe.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${oe.getShaderInfoLog(Gt)}`);oe.attachShader(this.program,Gt);const zt=oe.createShader(oe.VERTEX_SHADER);if(oe.isContextLost())return void(this.failedToCreate=!0);if(oe.shaderSource(zt,Ut),oe.compileShader(zt),!oe.getShaderParameter(zt,oe.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${oe.getShaderInfoLog(zt)}`);oe.attachShader(this.program,zt),this.attributes={};const ir={};this.numAttributes=Me.length;for(let sr=0;sr<this.numAttributes;sr++)Me[sr]&&(oe.bindAttribLocation(this.program,sr,Me[sr]),this.attributes[Me[sr]]=sr);if(oe.linkProgram(this.program),!oe.getProgramParameter(this.program,oe.LINK_STATUS))throw new Error(`Program failed to link: ${oe.getProgramInfoLog(this.program)}`);oe.deleteShader(zt),oe.deleteShader(Gt);for(let sr=0;sr<xt.length;sr++){const gr=xt[sr];if(gr&&!ir[gr]){const Er=oe.getUniformLocation(this.program,gr);Er&&(ir[gr]=Er)}}this.fixedUniforms=P(l,ir),this.terrainUniforms=((sr,gr)=>({u_depth:new o.bC(sr,gr.u_depth),u_terrain:new o.bC(sr,gr.u_terrain),u_terrain_dim:new o.b5(sr,gr.u_terrain_dim),u_terrain_matrix:new o.bD(sr,gr.u_terrain_matrix),u_terrain_unpack:new o.bE(sr,gr.u_terrain_unpack),u_terrain_exaggeration:new o.b5(sr,gr.u_terrain_exaggeration)}))(l,ir),this.projectionUniforms=((sr,gr)=>({u_projection_matrix:new o.bD(sr,gr.u_projection_matrix),u_projection_tile_mercator_coords:new o.bE(sr,gr.u_projection_tile_mercator_coords),u_projection_clipping_plane:new o.bE(sr,gr.u_projection_clipping_plane),u_projection_transition:new o.b5(sr,gr.u_projection_transition),u_projection_fallback_matrix:new o.bD(sr,gr.u_projection_fallback_matrix)}))(l,ir),this.binderUniforms=w?w.getUniforms(l,ir):[]}draw(l,m,w,P,O,G,J,re,oe,pe,Ce,Me,Ke,Ye,gt,ft,mt,xt,Ft){const Dt=l.gl;if(this.failedToCreate)return;if(l.program.set(this.program),l.setDepthMode(w),l.setStencilMode(P),l.setColorMode(O),l.setCullFace(G),re){l.activeTexture.set(Dt.TEXTURE2),Dt.bindTexture(Dt.TEXTURE_2D,re.depthTexture),l.activeTexture.set(Dt.TEXTURE3),Dt.bindTexture(Dt.TEXTURE_2D,re.texture);for(const Gt in this.terrainUniforms)this.terrainUniforms[Gt].set(re[Gt])}if(oe)for(const Gt in oe)this.projectionUniforms[uc[Gt]].set(oe[Gt]);if(J)for(const Gt in this.fixedUniforms)this.fixedUniforms[Gt].set(J[Gt]);ft&&ft.setUniforms(l,this.binderUniforms,Ye,{zoom:gt});let Ut=0;switch(m){case Dt.LINES:Ut=2;break;case Dt.TRIANGLES:Ut=3;break;case Dt.LINE_STRIP:Ut=1}for(const Gt of Ke.get()){const zt=Gt.vaos||(Gt.vaos={});(zt[pe]||(zt[pe]=new Nu)).bind(l,this,Ce,ft?ft.getPaintVertexBuffers():[],Me,Gt.vertexOffset,mt,xt,Ft),Dt.drawElements(m,Gt.primitiveLength*Ut,Dt.UNSIGNED_SHORT,Gt.primitiveOffset*Ut*2)}}}function Tt(D,l,m){const w=1/o.at(m,1,l.transform.tileZoom),P=Math.pow(2,m.tileID.overscaledZ),O=m.tileSize*Math.pow(2,l.transform.tileZoom)/P,G=O*(m.tileID.canonical.x+m.tileID.wrap*P),J=O*m.tileID.canonical.y;return{u_image:0,u_texsize:m.imageAtlasTexture.size,u_scale:[w,D.fromScale,D.toScale],u_fade:D.t,u_pixel_coord_upper:[G>>16,J>>16],u_pixel_coord_lower:[65535&G,65535&J]}}const Qt=(D,l,m,w)=>{const P=D.style.light,O=P.properties.get("position"),G=[O.x,O.y,O.z],J=o.bI();P.properties.get("anchor")==="viewport"&&o.bJ(J,D.transform.bearingInRadians),o.bK(G,G,J);const re=D.transform.transformLightDirection(G),oe=P.properties.get("color");return{u_lightpos:G,u_lightpos_globe:re,u_lightintensity:P.properties.get("intensity"),u_lightcolor:[oe.r,oe.g,oe.b],u_vertical_gradient:+l,u_opacity:m,u_fill_translate:w}},rr=(D,l,m,w,P,O,G)=>o.e(Qt(D,l,m,w),Tt(O,D,G),{u_height_factor:-Math.pow(2,P.overscaledZ)/G.tileSize/8}),vr=(D,l,m,w)=>o.e(Tt(l,D,m),{u_fill_translate:w}),Xr=(D,l)=>({u_world:D,u_fill_translate:l}),bn=(D,l,m,w,P)=>o.e(vr(D,l,m,P),{u_world:w}),qn=(D,l,m,w,P)=>{const O=D.transform;let G,J,re=0;if(m.paint.get("circle-pitch-alignment")==="map"){const oe=o.at(l,1,O.zoom);G=!0,J=[oe,oe],re=oe/(o.X*Math.pow(2,l.tileID.overscaledZ))*2*Math.PI*P}else G=!1,J=O.pixelsToGLUnits;return{u_camera_to_center_distance:O.cameraToCenterDistance,u_scale_with_map:+(m.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+G,u_device_pixel_ratio:D.pixelRatio,u_extrude_scale:J,u_globe_extrude_scale:re,u_translate:w}},li=D=>({u_pixel_extrude_scale:[1/D.width,1/D.height]}),fi=D=>({u_viewport_size:[D.width,D.height]}),pi=function(D){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return{u_color:D,u_overlay:0,u_overlay_scale:l}},as=(D,l,m,w)=>{const P=o.at(D,1,l)/(o.X*Math.pow(2,D.tileID.overscaledZ))*2*Math.PI*w;return{u_extrude_scale:o.at(D,1,l),u_intensity:m,u_globe_extrude_scale:P}},rs=(D,l,m,w)=>{const P=o.H();o.bL(P,0,D.width,D.height,0,0,1);const O=D.context.gl;return{u_matrix:P,u_world:[O.drawingBufferWidth,O.drawingBufferHeight],u_image:m,u_color_ramp:w,u_opacity:l.paint.get("heatmap-opacity")}},gi=(D,l,m)=>{const w=m.paint.get("hillshade-shadow-color"),P=m.paint.get("hillshade-highlight-color"),O=m.paint.get("hillshade-accent-color");let G=m.paint.get("hillshade-illumination-direction")*(Math.PI/180);return m.paint.get("hillshade-illumination-anchor")==="viewport"&&(G+=D.transform.bearingInRadians),{u_image:0,u_latrange:zn(0,l.tileID),u_light:[m.paint.get("hillshade-exaggeration"),G],u_shadow:w,u_highlight:P,u_accent:O}},Do=(D,l)=>{const m=l.stride,w=o.H();return o.bL(w,0,o.X,-8192,0,0,1),o.J(w,w,[0,-8192,0]),{u_matrix:w,u_image:1,u_dimension:[m,m],u_zoom:D.overscaledZ,u_unpack:l.getUnpackVector()}};function zn(D,l){const m=Math.pow(2,l.canonical.z),w=l.canonical.y;return[new o.Y(0,w/m).toLngLat().lat,new o.Y(0,(w+1)/m).toLngLat().lat]}const Wo=(D,l,m,w)=>{const P=D.transform;return{u_translation:zl(D,l,m),u_ratio:w/o.at(l,1,P.zoom),u_device_pixel_ratio:D.pixelRatio,u_units_to_pixels:[1/P.pixelsToGLUnits[0],1/P.pixelsToGLUnits[1]]}},vi=(D,l,m,w,P)=>o.e(Wo(D,l,m,w),{u_image:0,u_image_height:P}),Ti=(D,l,m,w,P)=>{const O=D.transform,G=Nl(l,O);return{u_translation:zl(D,l,m),u_texsize:l.imageAtlasTexture.size,u_ratio:w/o.at(l,1,O.zoom),u_device_pixel_ratio:D.pixelRatio,u_image:0,u_scale:[G,P.fromScale,P.toScale],u_fade:P.t,u_units_to_pixels:[1/O.pixelsToGLUnits[0],1/O.pixelsToGLUnits[1]]}},hc=(D,l,m,w,P,O)=>{const G=D.lineAtlas,J=Nl(l,D.transform),re=m.layout.get("line-cap")==="round",oe=G.getDash(P.from,re),pe=G.getDash(P.to,re),Ce=oe.width*O.fromScale,Me=pe.width*O.toScale;return o.e(Wo(D,l,m,w),{u_patternscale_a:[J/Ce,-oe.height/2],u_patternscale_b:[J/Me,-pe.height/2],u_sdfgamma:G.width/(256*Math.min(Ce,Me)*D.pixelRatio)/2,u_image:0,u_tex_y_a:oe.y,u_tex_y_b:pe.y,u_mix:O.t})};function Nl(D,l){return 1/o.at(D,1,l.tileZoom)}function zl(D,l,m){return o.au(D.transform,l,m.paint.get("line-translate"),m.paint.get("line-translate-anchor"))}const Oc=(D,l,m,w,P)=>{return{u_tl_parent:D,u_scale_parent:l,u_buffer_scale:1,u_fade_t:m.mix,u_opacity:m.opacity*w.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:w.paint.get("raster-brightness-min"),u_brightness_high:w.paint.get("raster-brightness-max"),u_saturation_factor:(G=w.paint.get("raster-saturation"),G>0?1-1/(1.001-G):-G),u_contrast_factor:(O=w.paint.get("raster-contrast"),O>0?1/(1-O):1+O),u_spin_weights:Wa(w.paint.get("raster-hue-rotate")),u_coords_top:[P[0].x,P[0].y,P[1].x,P[1].y],u_coords_bottom:[P[3].x,P[3].y,P[2].x,P[2].y]};var O,G};function Wa(D){D*=Math.PI/180;const l=Math.sin(D),m=Math.cos(D);return[(2*m+1)/3,(-Math.sqrt(3)*l-m+1)/3,(Math.sqrt(3)*l-m+1)/3]}const ml=(D,l,m,w,P,O,G,J,re,oe,pe,Ce,Me)=>{const Ke=G.transform;return{u_is_size_zoom_constant:+(D==="constant"||D==="source"),u_is_size_feature_constant:+(D==="constant"||D==="camera"),u_size_t:l?l.uSizeT:0,u_size:l?l.uSize:0,u_camera_to_center_distance:Ke.cameraToCenterDistance,u_pitch:Ke.pitch/360*2*Math.PI,u_rotate_symbol:+m,u_aspect_ratio:Ke.width/Ke.height,u_fade_change:G.options.fadeDuration?G.symbolFadeChange:1,u_label_plane_matrix:J,u_coord_matrix:re,u_is_text:+pe,u_pitch_with_map:+w,u_is_along_line:P,u_is_variable_anchor:O,u_texsize:Ce,u_texture:0,u_translation:oe,u_pitched_scale:Me}},no=(D,l,m,w,P,O,G,J,re,oe,pe,Ce,Me,Ke)=>{const Ye=G.transform;return o.e(ml(D,l,m,w,P,O,G,J,re,oe,pe,Ce,Ke),{u_gamma_scale:w?Math.cos(Ye.pitch*Math.PI/180)*Ye.cameraToCenterDistance:1,u_device_pixel_ratio:G.pixelRatio,u_is_halo:1})},Ps=(D,l,m,w,P,O,G,J,re,oe,pe,Ce,Me)=>o.e(no(D,l,m,w,P,O,G,J,re,oe,!0,pe,0,Me),{u_texsize_icon:Ce,u_texture_icon:1}),dc=(D,l)=>({u_opacity:D,u_color:l}),fc=(D,l,m,w,P)=>o.e(function(O,G,J,re){const oe=J.imageManager.getPattern(O.from.toString()),pe=J.imageManager.getPattern(O.to.toString()),{width:Ce,height:Me}=J.imageManager.getPixelSize(),Ke=Math.pow(2,re.tileID.overscaledZ),Ye=re.tileSize*Math.pow(2,J.transform.tileZoom)/Ke,gt=Ye*(re.tileID.canonical.x+re.tileID.wrap*Ke),ft=Ye*re.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:oe.tl,u_pattern_br_a:oe.br,u_pattern_tl_b:pe.tl,u_pattern_br_b:pe.br,u_texsize:[Ce,Me],u_mix:G.t,u_pattern_size_a:oe.displaySize,u_pattern_size_b:pe.displaySize,u_scale_a:G.fromScale,u_scale_b:G.toScale,u_tile_units_to_pixels:1/o.at(re,1,J.transform.tileZoom),u_pixel_coord_upper:[gt>>16,ft>>16],u_pixel_coord_lower:[65535&gt,65535&ft]}}(m,P,l,w),{u_opacity:D}),aa=(D,l)=>{},Ac={fillExtrusion:(D,l)=>({u_lightpos:new o.bG(D,l.u_lightpos),u_lightpos_globe:new o.bG(D,l.u_lightpos_globe),u_lightintensity:new o.b5(D,l.u_lightintensity),u_lightcolor:new o.bG(D,l.u_lightcolor),u_vertical_gradient:new o.b5(D,l.u_vertical_gradient),u_opacity:new o.b5(D,l.u_opacity),u_fill_translate:new o.bH(D,l.u_fill_translate)}),fillExtrusionPattern:(D,l)=>({u_lightpos:new o.bG(D,l.u_lightpos),u_lightpos_globe:new o.bG(D,l.u_lightpos_globe),u_lightintensity:new o.b5(D,l.u_lightintensity),u_lightcolor:new o.bG(D,l.u_lightcolor),u_vertical_gradient:new o.b5(D,l.u_vertical_gradient),u_height_factor:new o.b5(D,l.u_height_factor),u_opacity:new o.b5(D,l.u_opacity),u_fill_translate:new o.bH(D,l.u_fill_translate),u_image:new o.bC(D,l.u_image),u_texsize:new o.bH(D,l.u_texsize),u_pixel_coord_upper:new o.bH(D,l.u_pixel_coord_upper),u_pixel_coord_lower:new o.bH(D,l.u_pixel_coord_lower),u_scale:new o.bG(D,l.u_scale),u_fade:new o.b5(D,l.u_fade)}),fill:(D,l)=>({u_fill_translate:new o.bH(D,l.u_fill_translate)}),fillPattern:(D,l)=>({u_image:new o.bC(D,l.u_image),u_texsize:new o.bH(D,l.u_texsize),u_pixel_coord_upper:new o.bH(D,l.u_pixel_coord_upper),u_pixel_coord_lower:new o.bH(D,l.u_pixel_coord_lower),u_scale:new o.bG(D,l.u_scale),u_fade:new o.b5(D,l.u_fade),u_fill_translate:new o.bH(D,l.u_fill_translate)}),fillOutline:(D,l)=>({u_world:new o.bH(D,l.u_world),u_fill_translate:new o.bH(D,l.u_fill_translate)}),fillOutlinePattern:(D,l)=>({u_world:new o.bH(D,l.u_world),u_image:new o.bC(D,l.u_image),u_texsize:new o.bH(D,l.u_texsize),u_pixel_coord_upper:new o.bH(D,l.u_pixel_coord_upper),u_pixel_coord_lower:new o.bH(D,l.u_pixel_coord_lower),u_scale:new o.bG(D,l.u_scale),u_fade:new o.b5(D,l.u_fade),u_fill_translate:new o.bH(D,l.u_fill_translate)}),circle:(D,l)=>({u_camera_to_center_distance:new o.b5(D,l.u_camera_to_center_distance),u_scale_with_map:new o.bC(D,l.u_scale_with_map),u_pitch_with_map:new o.bC(D,l.u_pitch_with_map),u_extrude_scale:new o.bH(D,l.u_extrude_scale),u_device_pixel_ratio:new o.b5(D,l.u_device_pixel_ratio),u_globe_extrude_scale:new o.b5(D,l.u_globe_extrude_scale),u_translate:new o.bH(D,l.u_translate)}),collisionBox:(D,l)=>({u_pixel_extrude_scale:new o.bH(D,l.u_pixel_extrude_scale)}),collisionCircle:(D,l)=>({u_viewport_size:new o.bH(D,l.u_viewport_size)}),debug:(D,l)=>({u_color:new o.bF(D,l.u_color),u_overlay:new o.bC(D,l.u_overlay),u_overlay_scale:new o.b5(D,l.u_overlay_scale)}),depth:aa,clippingMask:aa,heatmap:(D,l)=>({u_extrude_scale:new o.b5(D,l.u_extrude_scale),u_intensity:new o.b5(D,l.u_intensity),u_globe_extrude_scale:new o.b5(D,l.u_globe_extrude_scale)}),heatmapTexture:(D,l)=>({u_matrix:new o.bD(D,l.u_matrix),u_world:new o.bH(D,l.u_world),u_image:new o.bC(D,l.u_image),u_color_ramp:new o.bC(D,l.u_color_ramp),u_opacity:new o.b5(D,l.u_opacity)}),hillshade:(D,l)=>({u_image:new o.bC(D,l.u_image),u_latrange:new o.bH(D,l.u_latrange),u_light:new o.bH(D,l.u_light),u_shadow:new o.bF(D,l.u_shadow),u_highlight:new o.bF(D,l.u_highlight),u_accent:new o.bF(D,l.u_accent)}),hillshadePrepare:(D,l)=>({u_matrix:new o.bD(D,l.u_matrix),u_image:new o.bC(D,l.u_image),u_dimension:new o.bH(D,l.u_dimension),u_zoom:new o.b5(D,l.u_zoom),u_unpack:new o.bE(D,l.u_unpack)}),line:(D,l)=>({u_translation:new o.bH(D,l.u_translation),u_ratio:new o.b5(D,l.u_ratio),u_device_pixel_ratio:new o.b5(D,l.u_device_pixel_ratio),u_units_to_pixels:new o.bH(D,l.u_units_to_pixels)}),lineGradient:(D,l)=>({u_translation:new o.bH(D,l.u_translation),u_ratio:new o.b5(D,l.u_ratio),u_device_pixel_ratio:new o.b5(D,l.u_device_pixel_ratio),u_units_to_pixels:new o.bH(D,l.u_units_to_pixels),u_image:new o.bC(D,l.u_image),u_image_height:new o.b5(D,l.u_image_height)}),linePattern:(D,l)=>({u_translation:new o.bH(D,l.u_translation),u_texsize:new o.bH(D,l.u_texsize),u_ratio:new o.b5(D,l.u_ratio),u_device_pixel_ratio:new o.b5(D,l.u_device_pixel_ratio),u_image:new o.bC(D,l.u_image),u_units_to_pixels:new o.bH(D,l.u_units_to_pixels),u_scale:new o.bG(D,l.u_scale),u_fade:new o.b5(D,l.u_fade)}),lineSDF:(D,l)=>({u_translation:new o.bH(D,l.u_translation),u_ratio:new o.b5(D,l.u_ratio),u_device_pixel_ratio:new o.b5(D,l.u_device_pixel_ratio),u_units_to_pixels:new o.bH(D,l.u_units_to_pixels),u_patternscale_a:new o.bH(D,l.u_patternscale_a),u_patternscale_b:new o.bH(D,l.u_patternscale_b),u_sdfgamma:new o.b5(D,l.u_sdfgamma),u_image:new o.bC(D,l.u_image),u_tex_y_a:new o.b5(D,l.u_tex_y_a),u_tex_y_b:new o.b5(D,l.u_tex_y_b),u_mix:new o.b5(D,l.u_mix)}),raster:(D,l)=>({u_tl_parent:new o.bH(D,l.u_tl_parent),u_scale_parent:new o.b5(D,l.u_scale_parent),u_buffer_scale:new o.b5(D,l.u_buffer_scale),u_fade_t:new o.b5(D,l.u_fade_t),u_opacity:new o.b5(D,l.u_opacity),u_image0:new o.bC(D,l.u_image0),u_image1:new o.bC(D,l.u_image1),u_brightness_low:new o.b5(D,l.u_brightness_low),u_brightness_high:new o.b5(D,l.u_brightness_high),u_saturation_factor:new o.b5(D,l.u_saturation_factor),u_contrast_factor:new o.b5(D,l.u_contrast_factor),u_spin_weights:new o.bG(D,l.u_spin_weights),u_coords_top:new o.bE(D,l.u_coords_top),u_coords_bottom:new o.bE(D,l.u_coords_bottom)}),symbolIcon:(D,l)=>({u_is_size_zoom_constant:new o.bC(D,l.u_is_size_zoom_constant),u_is_size_feature_constant:new o.bC(D,l.u_is_size_feature_constant),u_size_t:new o.b5(D,l.u_size_t),u_size:new o.b5(D,l.u_size),u_camera_to_center_distance:new o.b5(D,l.u_camera_to_center_distance),u_pitch:new o.b5(D,l.u_pitch),u_rotate_symbol:new o.bC(D,l.u_rotate_symbol),u_aspect_ratio:new o.b5(D,l.u_aspect_ratio),u_fade_change:new o.b5(D,l.u_fade_change),u_label_plane_matrix:new o.bD(D,l.u_label_plane_matrix),u_coord_matrix:new o.bD(D,l.u_coord_matrix),u_is_text:new o.bC(D,l.u_is_text),u_pitch_with_map:new o.bC(D,l.u_pitch_with_map),u_is_along_line:new o.bC(D,l.u_is_along_line),u_is_variable_anchor:new o.bC(D,l.u_is_variable_anchor),u_texsize:new o.bH(D,l.u_texsize),u_texture:new o.bC(D,l.u_texture),u_translation:new o.bH(D,l.u_translation),u_pitched_scale:new o.b5(D,l.u_pitched_scale)}),symbolSDF:(D,l)=>({u_is_size_zoom_constant:new o.bC(D,l.u_is_size_zoom_constant),u_is_size_feature_constant:new o.bC(D,l.u_is_size_feature_constant),u_size_t:new o.b5(D,l.u_size_t),u_size:new o.b5(D,l.u_size),u_camera_to_center_distance:new o.b5(D,l.u_camera_to_center_distance),u_pitch:new o.b5(D,l.u_pitch),u_rotate_symbol:new o.bC(D,l.u_rotate_symbol),u_aspect_ratio:new o.b5(D,l.u_aspect_ratio),u_fade_change:new o.b5(D,l.u_fade_change),u_label_plane_matrix:new o.bD(D,l.u_label_plane_matrix),u_coord_matrix:new o.bD(D,l.u_coord_matrix),u_is_text:new o.bC(D,l.u_is_text),u_pitch_with_map:new o.bC(D,l.u_pitch_with_map),u_is_along_line:new o.bC(D,l.u_is_along_line),u_is_variable_anchor:new o.bC(D,l.u_is_variable_anchor),u_texsize:new o.bH(D,l.u_texsize),u_texture:new o.bC(D,l.u_texture),u_gamma_scale:new o.b5(D,l.u_gamma_scale),u_device_pixel_ratio:new o.b5(D,l.u_device_pixel_ratio),u_is_halo:new o.bC(D,l.u_is_halo),u_translation:new o.bH(D,l.u_translation),u_pitched_scale:new o.b5(D,l.u_pitched_scale)}),symbolTextAndIcon:(D,l)=>({u_is_size_zoom_constant:new o.bC(D,l.u_is_size_zoom_constant),u_is_size_feature_constant:new o.bC(D,l.u_is_size_feature_constant),u_size_t:new o.b5(D,l.u_size_t),u_size:new o.b5(D,l.u_size),u_camera_to_center_distance:new o.b5(D,l.u_camera_to_center_distance),u_pitch:new o.b5(D,l.u_pitch),u_rotate_symbol:new o.bC(D,l.u_rotate_symbol),u_aspect_ratio:new o.b5(D,l.u_aspect_ratio),u_fade_change:new o.b5(D,l.u_fade_change),u_label_plane_matrix:new o.bD(D,l.u_label_plane_matrix),u_coord_matrix:new o.bD(D,l.u_coord_matrix),u_is_text:new o.bC(D,l.u_is_text),u_pitch_with_map:new o.bC(D,l.u_pitch_with_map),u_is_along_line:new o.bC(D,l.u_is_along_line),u_is_variable_anchor:new o.bC(D,l.u_is_variable_anchor),u_texsize:new o.bH(D,l.u_texsize),u_texsize_icon:new o.bH(D,l.u_texsize_icon),u_texture:new o.bC(D,l.u_texture),u_texture_icon:new o.bC(D,l.u_texture_icon),u_gamma_scale:new o.b5(D,l.u_gamma_scale),u_device_pixel_ratio:new o.b5(D,l.u_device_pixel_ratio),u_is_halo:new o.bC(D,l.u_is_halo),u_translation:new o.bH(D,l.u_translation),u_pitched_scale:new o.b5(D,l.u_pitched_scale)}),background:(D,l)=>({u_opacity:new o.b5(D,l.u_opacity),u_color:new o.bF(D,l.u_color)}),backgroundPattern:(D,l)=>({u_opacity:new o.b5(D,l.u_opacity),u_image:new o.bC(D,l.u_image),u_pattern_tl_a:new o.bH(D,l.u_pattern_tl_a),u_pattern_br_a:new o.bH(D,l.u_pattern_br_a),u_pattern_tl_b:new o.bH(D,l.u_pattern_tl_b),u_pattern_br_b:new o.bH(D,l.u_pattern_br_b),u_texsize:new o.bH(D,l.u_texsize),u_mix:new o.b5(D,l.u_mix),u_pattern_size_a:new o.bH(D,l.u_pattern_size_a),u_pattern_size_b:new o.bH(D,l.u_pattern_size_b),u_scale_a:new o.b5(D,l.u_scale_a),u_scale_b:new o.b5(D,l.u_scale_b),u_pixel_coord_upper:new o.bH(D,l.u_pixel_coord_upper),u_pixel_coord_lower:new o.bH(D,l.u_pixel_coord_lower),u_tile_units_to_pixels:new o.b5(D,l.u_tile_units_to_pixels)}),terrain:(D,l)=>({u_texture:new o.bC(D,l.u_texture),u_ele_delta:new o.b5(D,l.u_ele_delta),u_fog_matrix:new o.bD(D,l.u_fog_matrix),u_fog_color:new o.bF(D,l.u_fog_color),u_fog_ground_blend:new o.b5(D,l.u_fog_ground_blend),u_fog_ground_blend_opacity:new o.b5(D,l.u_fog_ground_blend_opacity),u_horizon_color:new o.bF(D,l.u_horizon_color),u_horizon_fog_blend:new o.b5(D,l.u_horizon_fog_blend),u_is_globe_mode:new o.b5(D,l.u_is_globe_mode)}),terrainDepth:(D,l)=>({u_ele_delta:new o.b5(D,l.u_ele_delta)}),terrainCoords:(D,l)=>({u_texture:new o.bC(D,l.u_texture),u_terrain_coords_id:new o.b5(D,l.u_terrain_coords_id),u_ele_delta:new o.b5(D,l.u_ele_delta)}),projectionErrorMeasurement:(D,l)=>({u_input:new o.b5(D,l.u_input),u_output_expected:new o.b5(D,l.u_output_expected)}),atmosphere:(D,l)=>({u_sun_pos:new o.bG(D,l.u_sun_pos),u_atmosphere_blend:new o.b5(D,l.u_atmosphere_blend),u_globe_position:new o.bG(D,l.u_globe_position),u_globe_radius:new o.b5(D,l.u_globe_radius),u_inv_proj_matrix:new o.bD(D,l.u_inv_proj_matrix)}),sky:(D,l)=>({u_sky_color:new o.bF(D,l.u_sky_color),u_horizon_color:new o.bF(D,l.u_horizon_color),u_horizon:new o.bH(D,l.u_horizon),u_horizon_normal:new o.bH(D,l.u_horizon_normal),u_sky_horizon_blend:new o.b5(D,l.u_sky_horizon_blend),u_sky_blend:new o.b5(D,l.u_sky_blend)})};class co{constructor(l,m,w){this.context=l;const P=l.gl;this.buffer=P.createBuffer(),this.dynamicDraw=!!w,this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),P.bufferData(P.ELEMENT_ARRAY_BUFFER,m.arrayBuffer,this.dynamicDraw?P.DYNAMIC_DRAW:P.STATIC_DRAW),this.dynamicDraw||delete m.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(l){const m=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),m.bufferSubData(m.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ea={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Hl{constructor(l,m,w,P){this.length=m.length,this.attributes=w,this.itemSize=m.bytesPerElement,this.dynamicDraw=P,this.context=l;const O=l.gl;this.buffer=O.createBuffer(),l.bindVertexBuffer.set(this.buffer),O.bufferData(O.ARRAY_BUFFER,m.arrayBuffer,this.dynamicDraw?O.DYNAMIC_DRAW:O.STATIC_DRAW),this.dynamicDraw||delete m.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(l){if(l.length!==this.length)throw new Error(`Length of new data is ${l.length}, which doesn't match current length of ${this.length}`);const m=this.context.gl;this.bind(),m.bufferSubData(m.ARRAY_BUFFER,0,l.arrayBuffer)}enableAttributes(l,m){for(let w=0;w<this.attributes.length;w++){const P=m.attributes[this.attributes[w].name];P!==void 0&&l.enableVertexAttribArray(P)}}setVertexAttribPointers(l,m,w){for(let P=0;P<this.attributes.length;P++){const O=this.attributes[P],G=m.attributes[O.name];G!==void 0&&l.vertexAttribPointer(G,O.components,l[Ea[O.type]],!1,this.itemSize,O.offset+this.itemSize*(w||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Bi{constructor(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(l){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Xo extends Bi{getDefault(){return o.b4.transparent}set(l){const m=this.current;(l.r!==m.r||l.g!==m.g||l.b!==m.b||l.a!==m.a||this.dirty)&&(this.gl.clearColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class pc extends Bi{getDefault(){return 1}set(l){(l!==this.current||this.dirty)&&(this.gl.clearDepth(l),this.current=l,this.dirty=!1)}}class vd extends Bi{getDefault(){return 0}set(l){(l!==this.current||this.dirty)&&(this.gl.clearStencil(l),this.current=l,this.dirty=!1)}}class Ah extends Bi{getDefault(){return[!0,!0,!0,!0]}set(l){const m=this.current;(l[0]!==m[0]||l[1]!==m[1]||l[2]!==m[2]||l[3]!==m[3]||this.dirty)&&(this.gl.colorMask(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class xi extends Bi{getDefault(){return!0}set(l){(l!==this.current||this.dirty)&&(this.gl.depthMask(l),this.current=l,this.dirty=!1)}}class Jo extends Bi{getDefault(){return 255}set(l){(l!==this.current||this.dirty)&&(this.gl.stencilMask(l),this.current=l,this.dirty=!1)}}class Ta extends Bi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(l){const m=this.current;(l.func!==m.func||l.ref!==m.ref||l.mask!==m.mask||this.dirty)&&(this.gl.stencilFunc(l.func,l.ref,l.mask),this.current=l,this.dirty=!1)}}class _l extends Bi{getDefault(){const l=this.gl;return[l.KEEP,l.KEEP,l.KEEP]}set(l){const m=this.current;(l[0]!==m[0]||l[1]!==m[1]||l[2]!==m[2]||this.dirty)&&(this.gl.stencilOp(l[0],l[1],l[2]),this.current=l,this.dirty=!1)}}class Bo extends Bi{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const m=this.gl;l?m.enable(m.STENCIL_TEST):m.disable(m.STENCIL_TEST),this.current=l,this.dirty=!1}}class yl extends Bi{getDefault(){return[0,1]}set(l){const m=this.current;(l[0]!==m[0]||l[1]!==m[1]||this.dirty)&&(this.gl.depthRange(l[0],l[1]),this.current=l,this.dirty=!1)}}class la extends Bi{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const m=this.gl;l?m.enable(m.DEPTH_TEST):m.disable(m.DEPTH_TEST),this.current=l,this.dirty=!1}}class Oo extends Bi{getDefault(){return this.gl.LESS}set(l){(l!==this.current||this.dirty)&&(this.gl.depthFunc(l),this.current=l,this.dirty=!1)}}class Co extends Bi{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const m=this.gl;l?m.enable(m.BLEND):m.disable(m.BLEND),this.current=l,this.dirty=!1}}class kc extends Bi{getDefault(){const l=this.gl;return[l.ONE,l.ZERO]}set(l){const m=this.current;(l[0]!==m[0]||l[1]!==m[1]||this.dirty)&&(this.gl.blendFunc(l[0],l[1]),this.current=l,this.dirty=!1)}}class bl extends Bi{getDefault(){return o.b4.transparent}set(l){const m=this.current;(l.r!==m.r||l.g!==m.g||l.b!==m.b||l.a!==m.a||this.dirty)&&(this.gl.blendColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class Eo extends Bi{getDefault(){return this.gl.FUNC_ADD}set(l){(l!==this.current||this.dirty)&&(this.gl.blendEquation(l),this.current=l,this.dirty=!1)}}class uo extends Bi{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const m=this.gl;l?m.enable(m.CULL_FACE):m.disable(m.CULL_FACE),this.current=l,this.dirty=!1}}class ca extends Bi{getDefault(){return this.gl.BACK}set(l){(l!==this.current||this.dirty)&&(this.gl.cullFace(l),this.current=l,this.dirty=!1)}}class Vl extends Bi{getDefault(){return this.gl.CCW}set(l){(l!==this.current||this.dirty)&&(this.gl.frontFace(l),this.current=l,this.dirty=!1)}}class Zo extends Bi{getDefault(){return null}set(l){(l!==this.current||this.dirty)&&(this.gl.useProgram(l),this.current=l,this.dirty=!1)}}class ua extends Bi{getDefault(){return this.gl.TEXTURE0}set(l){(l!==this.current||this.dirty)&&(this.gl.activeTexture(l),this.current=l,this.dirty=!1)}}class Uc extends Bi{getDefault(){const l=this.gl;return[0,0,l.drawingBufferWidth,l.drawingBufferHeight]}set(l){const m=this.current;(l[0]!==m[0]||l[1]!==m[1]||l[2]!==m[2]||l[3]!==m[3]||this.dirty)&&(this.gl.viewport(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class ho extends Bi{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const m=this.gl;m.bindFramebuffer(m.FRAMEBUFFER,l),this.current=l,this.dirty=!1}}class Yo extends Bi{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const m=this.gl;m.bindRenderbuffer(m.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class ls extends Bi{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const m=this.gl;m.bindTexture(m.TEXTURE_2D,l),this.current=l,this.dirty=!1}}class ji extends Bi{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const m=this.gl;m.bindBuffer(m.ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class Kn extends Bi{getDefault(){return null}set(l){const m=this.gl;m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class Fs extends Bi{getDefault(){return null}set(l){var m;if(l===this.current&&!this.dirty)return;const w=this.gl;ro(w)?w.bindVertexArray(l):(m=w.getExtension("OES_vertex_array_object"))===null||m===void 0||m.bindVertexArrayOES(l),this.current=l,this.dirty=!1}}class Xa extends Bi{getDefault(){return 4}set(l){if(l===this.current&&!this.dirty)return;const m=this.gl;m.pixelStorei(m.UNPACK_ALIGNMENT,l),this.current=l,this.dirty=!1}}class Ja extends Bi{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const m=this.gl;m.pixelStorei(m.UNPACK_PREMULTIPLY_ALPHA_WEBGL,l),this.current=l,this.dirty=!1}}class xs extends Bi{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const m=this.gl;m.pixelStorei(m.UNPACK_FLIP_Y_WEBGL,l),this.current=l,this.dirty=!1}}class vl extends Bi{constructor(l,m){super(l),this.context=l,this.parent=m}getDefault(){return null}}class vf extends vl{setDirty(){this.dirty=!0}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const m=this.gl;m.framebufferTexture2D(m.FRAMEBUFFER,m.COLOR_ATTACHMENT0,m.TEXTURE_2D,l,0),this.current=l,this.dirty=!1}}class xd extends vl{set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const m=this.gl;m.framebufferRenderbuffer(m.FRAMEBUFFER,m.DEPTH_ATTACHMENT,m.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class Ns extends vl{set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const m=this.gl;m.framebufferRenderbuffer(m.FRAMEBUFFER,m.DEPTH_STENCIL_ATTACHMENT,m.RENDERBUFFER,l),this.current=l,this.dirty=!1}}const ha="Framebuffer is not complete";class ko{constructor(l,m,w,P,O){this.context=l,this.width=m,this.height=w;const G=l.gl,J=this.framebuffer=G.createFramebuffer();if(this.colorAttachment=new vf(l,J),P)this.depthAttachment=O?new Ns(l,J):new xd(l,J);else if(O)throw new Error("Stencil cannot be set without depth");if(G.checkFramebufferStatus(G.FRAMEBUFFER)!==G.FRAMEBUFFER_COMPLETE)throw new Error(ha)}destroy(){const l=this.context.gl,m=this.colorAttachment.get();if(m&&l.deleteTexture(m),this.depthAttachment){const w=this.depthAttachment.get();w&&l.deleteRenderbuffer(w)}l.deleteFramebuffer(this.framebuffer)}}class Nc{constructor(l){var m,w;if(this.gl=l,this.clearColor=new Xo(this),this.clearDepth=new pc(this),this.clearStencil=new vd(this),this.colorMask=new Ah(this),this.depthMask=new xi(this),this.stencilMask=new Jo(this),this.stencilFunc=new Ta(this),this.stencilOp=new _l(this),this.stencilTest=new Bo(this),this.depthRange=new yl(this),this.depthTest=new la(this),this.depthFunc=new Oo(this),this.blend=new Co(this),this.blendFunc=new kc(this),this.blendColor=new bl(this),this.blendEquation=new Eo(this),this.cullFace=new uo(this),this.cullFaceSide=new ca(this),this.frontFace=new Vl(this),this.program=new Zo(this),this.activeTexture=new ua(this),this.viewport=new Uc(this),this.bindFramebuffer=new ho(this),this.bindRenderbuffer=new Yo(this),this.bindTexture=new ls(this),this.bindVertexBuffer=new ji(this),this.bindElementBuffer=new Kn(this),this.bindVertexArray=new Fs(this),this.pixelStoreUnpack=new Xa(this),this.pixelStoreUnpackPremultiplyAlpha=new Ja(this),this.pixelStoreUnpackFlipY=new xs(this),this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE),ro(l)){this.HALF_FLOAT=l.HALF_FLOAT;const P=l.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(m=l.RGBA16F)!==null&&m!==void 0?m:P==null?void 0:P.RGBA16F_EXT,this.RGB16F=(w=l.RGB16F)!==null&&w!==void 0?w:P==null?void 0:P.RGB16F_EXT,l.getExtension("EXT_color_buffer_float")}else{l.getExtension("EXT_color_buffer_half_float"),l.getExtension("OES_texture_half_float_linear");const P=l.getExtension("OES_texture_half_float");this.HALF_FLOAT=P==null?void 0:P.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(l,m){return new co(this,l,m)}createVertexBuffer(l,m,w){return new Hl(this,l,m,w)}createRenderbuffer(l,m,w){const P=this.gl,O=P.createRenderbuffer();return this.bindRenderbuffer.set(O),P.renderbufferStorage(P.RENDERBUFFER,l,m,w),this.bindRenderbuffer.set(null),O}createFramebuffer(l,m,w,P){return new ko(this,l,m,w,P)}clear(l){let{color:m,depth:w,stencil:P}=l;const O=this.gl;let G=0;m&&(G|=O.COLOR_BUFFER_BIT,this.clearColor.set(m),this.colorMask.set([!0,!0,!0,!0])),w!==void 0&&(G|=O.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(w),this.depthMask.set(!0)),P!==void 0&&(G|=O.STENCIL_BUFFER_BIT,this.clearStencil.set(P),this.stencilMask.set(255)),O.clear(G)}setCullFace(l){l.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))}setDepthMode(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)}setStencilMode(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)}setColorMode(l){o.bz(l.blendFunction,Li.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor)),this.colorMask.set(l.mask)}createVertexArray(){var l;return ro(this.gl)?this.gl.createVertexArray():(l=this.gl.getExtension("OES_vertex_array_object"))===null||l===void 0?void 0:l.createVertexArrayOES()}deleteVertexArray(l){var m;return ro(this.gl)?this.gl.deleteVertexArray(l):(m=this.gl.getExtension("OES_vertex_array_object"))===null||m===void 0?void 0:m.deleteVertexArrayOES(l)}unbindVAO(){this.bindVertexArray.set(null)}}let gc;function mc(D,l,m,w,P){const O=D.context,G=D.transform,J=O.gl,re=D.useProgram("collisionBox"),oe=[];let pe=0,Ce=0;for(let mt=0;mt<w.length;mt++){const xt=w[mt],Ft=l.getTile(xt).getBucket(m);if(!Ft)continue;const Dt=P?Ft.textCollisionBox:Ft.iconCollisionBox,Ut=Ft.collisionCircleArray;Ut.length>0&&(oe.push({circleArray:Ut,circleOffset:Ce,coord:xt}),pe+=Ut.length/4,Ce=pe),Dt&&re.draw(O,J.LINES,si.disabled,wi.disabled,D.colorModeForRenderPass(),Ai.disabled,li(D.transform),D.style.map.terrain&&D.style.map.terrain.getTerrainData(xt),G.getProjectionData({overscaledTileID:xt,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),m.id,Dt.layoutVertexBuffer,Dt.indexBuffer,Dt.segments,null,D.transform.zoom,null,null,Dt.collisionVertexBuffer)}if(!P||!oe.length)return;const Me=D.useProgram("collisionCircle"),Ke=new o.bM;Ke.resize(4*pe),Ke._trim();let Ye=0;for(const mt of oe)for(let xt=0;xt<mt.circleArray.length/4;xt++){const Ft=4*xt,Dt=mt.circleArray[Ft+0],Ut=mt.circleArray[Ft+1],Gt=mt.circleArray[Ft+2],zt=mt.circleArray[Ft+3];Ke.emplace(Ye++,Dt,Ut,Gt,zt,0),Ke.emplace(Ye++,Dt,Ut,Gt,zt,1),Ke.emplace(Ye++,Dt,Ut,Gt,zt,2),Ke.emplace(Ye++,Dt,Ut,Gt,zt,3)}(!gc||gc.length<2*pe)&&(gc=function(mt){const xt=2*mt,Ft=new o.bO;Ft.resize(xt),Ft._trim();for(let Dt=0;Dt<xt;Dt++){const Ut=6*Dt;Ft.uint16[Ut+0]=4*Dt+0,Ft.uint16[Ut+1]=4*Dt+1,Ft.uint16[Ut+2]=4*Dt+2,Ft.uint16[Ut+3]=4*Dt+2,Ft.uint16[Ut+4]=4*Dt+3,Ft.uint16[Ut+5]=4*Dt+0}return Ft}(pe));const gt=O.createIndexBuffer(gc,!0),ft=O.createVertexBuffer(Ke,o.bN.members,!0);for(const mt of oe){const xt=fi(D.transform);Me.draw(O,J.TRIANGLES,si.disabled,wi.disabled,D.colorModeForRenderPass(),Ai.disabled,xt,D.style.map.terrain&&D.style.map.terrain.getTerrainData(mt.coord),null,m.id,ft,gt,o.aD.simpleSegment(0,2*mt.circleOffset,mt.circleArray.length,mt.circleArray.length/2),null,D.transform.zoom,null,null,null)}ft.destroy(),gt.destroy()}const mo=o.aq(new Float32Array(16));function zs(D,l,m,w,P,O){const{horizontalAlign:G,verticalAlign:J}=o.ay(D);return new o.P((-(G-.5)*l/P+w[0])*O,(-(J-.5)*m/P+w[1])*O)}function zc(D,l,m,w,P,O){const G=l.tileAnchorPoint.add(new o.P(l.translation[0],l.translation[1]));if(l.pitchWithMap){let J=w.mult(O);m||(J=J.rotate(-P));const re=G.add(J);return ge(re.x,re.y,l.pitchedLabelPlaneMatrix,l.getElevation).point}if(m){const J=Rt(l.tileAnchorPoint.x+1,l.tileAnchorPoint.y,l).point.sub(D),re=Math.atan(J.y/J.x)+(J.x<0?Math.PI:0);return D.add(w.rotate(re))}return D.add(w)}function Hc(D,l,m,w,P,O,G,J,re,oe,pe,Ce){const Me=D.text.placedSymbolArray,Ke=D.text.dynamicLayoutVertexArray,Ye=D.icon.dynamicLayoutVertexArray,gt={};Ke.clear();for(let ft=0;ft<Me.length;ft++){const mt=Me.get(ft),xt=mt.hidden||!mt.crossTileID||D.allowVerticalPlacement&&!mt.placedOrientation?null:w[mt.crossTileID];if(xt){const Ft=new o.P(mt.anchorX,mt.anchorY),Dt={getElevation:Ce,width:P.width,height:P.height,pitchedLabelPlaneMatrix:O,lineVertexArray:null,pitchWithMap:m,transform:P,projectionCache:null,tileAnchorPoint:Ft,translation:oe,unwrappedTileID:pe},Ut=m?zr(Ft.x,Ft.y,Dt):Rt(Ft.x,Ft.y,Dt),Gt=we(P.cameraToCenterDistance,Ut.signedDistanceFromCamera);let zt=o.aj(D.textSizeData,J,mt)*Gt/o.as;m&&(zt*=D.tilePixelRatio/G);const{width:ir,height:sr,anchor:gr,textOffset:Er,textBoxScale:fr}=xt,qr=zs(gr,ir,sr,Er,fr,zt),Jr=P.getPitchedTextCorrection(Ft.x+oe[0],Ft.y+oe[1],pe),Sr=zc(Ut.point,Dt,l,qr,-P.bearingInRadians,Jr),tn=D.allowVerticalPlacement&&mt.placedOrientation===o.ai.vertical?Math.PI/2:0;for(let Yn=0;Yn<mt.numGlyphs;Yn++)o.ak(Ke,Sr,tn);re&&mt.associatedIconIndex>=0&&(gt[mt.associatedIconIndex]={shiftedAnchor:Sr,angle:tn})}else _n(mt.numGlyphs,Ke)}if(re){Ye.clear();const ft=D.icon.placedSymbolArray;for(let mt=0;mt<ft.length;mt++){const xt=ft.get(mt);if(xt.hidden)_n(xt.numGlyphs,Ye);else{const Ft=gt[mt];if(Ft)for(let Dt=0;Dt<xt.numGlyphs;Dt++)o.ak(Ye,Ft.shiftedAnchor,Ft.angle);else _n(xt.numGlyphs,Ye)}}D.icon.dynamicLayoutVertexBuffer.updateData(Ye)}D.text.dynamicLayoutVertexBuffer.updateData(Ke)}function wd(D,l,m){return m.iconsInText&&l?"symbolTextAndIcon":D?"symbolSDF":"symbolIcon"}function _c(D,l,m,w,P,O,G,J,re,oe,pe,Ce,Me){const Ke=D.context,Ye=Ke.gl,gt=D.transform,ft=J==="map",mt=re==="map",xt=J!=="viewport"&&m.layout.get("symbol-placement")!=="point",Ft=ft&&!mt&&!xt,Dt=!m.layout.get("symbol-sort-key").isConstant();let Ut=!1;const Gt=D.getDepthModeForSublayer(0,si.ReadOnly),zt=m._unevaluatedLayout.hasValue("text-variable-anchor")||m._unevaluatedLayout.hasValue("text-variable-anchor-offset"),ir=[],sr=gt.getCircleRadiusCorrection();for(const gr of w){const Er=l.getTile(gr),fr=Er.getBucket(m);if(!fr)continue;const qr=P?fr.text:fr.icon;if(!qr||!qr.segments.get().length||!qr.hasVisibleVertices)continue;const Jr=qr.programConfigurations.get(m.id),Sr=P||fr.sdfIcons,tn=P?fr.textSizeData:fr.iconSizeData,Yn=mt||gt.pitch!==0,oi=D.useProgram(wd(Sr,P,fr),Jr),ws=o.ah(tn,gt.zoom),Oi=D.style.map.terrain&&D.style.map.terrain.getTerrainData(gr);let Gs,Wi,ti,Xi,No=[0,0],Rs=null;if(P)Wi=Er.glyphAtlasTexture,ti=Ye.LINEAR,Gs=Er.glyphAtlasTexture.size,fr.iconsInText&&(No=Er.imageAtlasTexture.size,Rs=Er.imageAtlasTexture,Xi=Yn||D.options.rotating||D.options.zooming||tn.kind==="composite"||tn.kind==="camera"?Ye.LINEAR:Ye.NEAREST);else{const Ji=m.layout.get("icon-size").constantOr(0)!==1||fr.iconsNeedLinear;Wi=Er.imageAtlasTexture,ti=Sr||D.options.rotating||D.options.zooming||Ji||Yn?Ye.LINEAR:Ye.NEAREST,Gs=Er.imageAtlasTexture.size}const Bs=o.at(Er,1,D.transform.zoom),ea=Wt(ft,D.transform,Bs),tl=o.H();o.an(tl,ea);const jl=Pe(mt,ft,D.transform,Bs),Ma=o.au(gt,Er,O,G),ta=gt.getProjectionData({overscaledTileID:gr,applyGlobeMatrix:!Me,applyTerrainMatrix:!0}),xc=zt&&fr.hasTextData(),El=m.layout.get("icon-text-fit")!=="none"&&xc&&fr.hasIconData();if(xt){const Ji=D.style.map.terrain?(Sl,Qs)=>D.style.map.terrain.getElevation(gr,Sl,Qs):null,Cs=m.layout.get("text-rotation-alignment")==="map";ht(fr,D,P,ea,tl,mt,oe,Cs,gr.toUnwrapped(),gt.width,gt.height,Ma,Ji)}const Qu=P&&zt||El,ra=xt||Qu?mo:mt?ea:D.transform.clipSpaceToPixelsMatrix,Tl=Sr&&m.paint.get(P?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let ql;ql=Sr?fr.iconsInText?Ps(tn.kind,ws,Ft,mt,xt,Qu,D,ra,jl,Ma,Gs,No,sr):no(tn.kind,ws,Ft,mt,xt,Qu,D,ra,jl,Ma,P,Gs,0,sr):ml(tn.kind,ws,Ft,mt,xt,Qu,D,ra,jl,Ma,P,Gs,sr);const Io={program:oi,buffers:qr,uniformValues:ql,projectionData:ta,atlasTexture:Wi,atlasTextureIcon:Rs,atlasInterpolation:ti,atlasInterpolationIcon:Xi,isSDF:Sr,hasHalo:Tl};if(Dt&&fr.canOverlap){Ut=!0;const Ji=qr.segments.get();for(const Cs of Ji)ir.push({segments:new o.aD([Cs]),sortKey:Cs.sortKey,state:Io,terrainData:Oi})}else ir.push({segments:qr.segments,sortKey:0,state:Io,terrainData:Oi})}Ut&&ir.sort((gr,Er)=>gr.sortKey-Er.sortKey);for(const gr of ir){const Er=gr.state;if(Ke.activeTexture.set(Ye.TEXTURE0),Er.atlasTexture.bind(Er.atlasInterpolation,Ye.CLAMP_TO_EDGE),Er.atlasTextureIcon&&(Ke.activeTexture.set(Ye.TEXTURE1),Er.atlasTextureIcon&&Er.atlasTextureIcon.bind(Er.atlasInterpolationIcon,Ye.CLAMP_TO_EDGE)),Er.isSDF){const fr=Er.uniformValues;Er.hasHalo&&(fr.u_is_halo=1,zu(Er.buffers,gr.segments,m,D,Er.program,Gt,pe,Ce,fr,Er.projectionData,gr.terrainData)),fr.u_is_halo=0}zu(Er.buffers,gr.segments,m,D,Er.program,Gt,pe,Ce,Er.uniformValues,Er.projectionData,gr.terrainData)}}function zu(D,l,m,w,P,O,G,J,re,oe,pe){const Ce=w.context;P.draw(Ce,Ce.gl.TRIANGLES,O,G,J,Ai.backCCW,re,pe,oe,m.id,D.layoutVertexBuffer,D.indexBuffer,l,m.paint,w.transform.zoom,D.programConfigurations.get(m.id),D.dynamicLayoutVertexBuffer,D.opacityVertexBuffer)}function ph(D,l,m,w,P){const O=D.context,G=O.gl,J=wi.disabled,re=new Li([G.ONE,G.ONE],o.b4.transparent,[!0,!0,!0,!0]),oe=l.getBucket(m);if(!oe)return;const pe=w.key;let Ce=m.heatmapFbos.get(pe);Ce||(Ce=Vc(O,l.tileSize,l.tileSize),m.heatmapFbos.set(pe,Ce)),O.bindFramebuffer.set(Ce.framebuffer),O.viewport.set([0,0,l.tileSize,l.tileSize]),O.clear({color:o.b4.transparent});const Me=oe.programConfigurations.get(m.id),Ke=D.useProgram("heatmap",Me,!P),Ye=D.transform.getProjectionData({overscaledTileID:l.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),gt=D.style.map.terrain.getTerrainData(w);Ke.draw(O,G.TRIANGLES,si.disabled,J,re,Ai.disabled,as(l,D.transform.zoom,m.paint.get("heatmap-intensity"),1),gt,Ye,m.id,oe.layoutVertexBuffer,oe.indexBuffer,oe.segments,m.paint,D.transform.zoom,Me)}function Gl(D,l,m,w,P){const O=D.context,G=O.gl,J=D.transform;O.setColorMode(D.colorModeForRenderPass());const re=Gc(O,l),oe=m.key,pe=l.heatmapFbos.get(oe);if(!pe)return;O.activeTexture.set(G.TEXTURE0),G.bindTexture(G.TEXTURE_2D,pe.colorAttachment.get()),O.activeTexture.set(G.TEXTURE1),re.bind(G.LINEAR,G.CLAMP_TO_EDGE);const Ce=J.getProjectionData({overscaledTileID:m,applyTerrainMatrix:P,applyGlobeMatrix:!w});D.useProgram("heatmapTexture").draw(O,G.TRIANGLES,si.disabled,wi.disabled,D.colorModeForRenderPass(),Ai.disabled,rs(D,l,0,1),null,Ce,l.id,D.rasterBoundsBuffer,D.quadTriangleIndexBuffer,D.rasterBoundsSegments,l.paint,J.zoom),pe.destroy(),l.heatmapFbos.delete(oe)}function Vc(D,l,m){var w,P;const O=D.gl,G=O.createTexture();O.bindTexture(O.TEXTURE_2D,G),O.texParameteri(O.TEXTURE_2D,O.TEXTURE_WRAP_S,O.CLAMP_TO_EDGE),O.texParameteri(O.TEXTURE_2D,O.TEXTURE_WRAP_T,O.CLAMP_TO_EDGE),O.texParameteri(O.TEXTURE_2D,O.TEXTURE_MIN_FILTER,O.LINEAR),O.texParameteri(O.TEXTURE_2D,O.TEXTURE_MAG_FILTER,O.LINEAR);const J=(w=D.HALF_FLOAT)!==null&&w!==void 0?w:O.UNSIGNED_BYTE,re=(P=D.RGBA16F)!==null&&P!==void 0?P:O.RGBA;O.texImage2D(O.TEXTURE_2D,0,re,l,m,0,O.RGBA,J,null);const oe=D.createFramebuffer(l,m,!1,!1);return oe.colorAttachment.set(G),oe}function Gc(D,l){return l.colorRampTexture||(l.colorRampTexture=new Ue(D,l.colorRamp,D.gl.RGBA)),l.colorRampTexture}function _u(D,l,m,w,P){if(!m||!w||!w.imageAtlas)return;const O=w.imageAtlas.patternPositions;let G=O[m.to.toString()],J=O[m.from.toString()];if(!G&&J&&(G=J),!J&&G&&(J=G),!G||!J){const re=P.getPaintProperty(l);G=O[re],J=O[re]}G&&J&&D.setConstantPatternPositions(G,J)}function Qc(D,l,m,w,P,O,G,J){const re=D.context.gl,oe="fill-pattern",pe=m.paint.get(oe),Ce=pe&&pe.constantOr(1),Me=m.getCrossfadeParameters();let Ke,Ye,gt,ft,mt;const xt=D.transform,Ft=m.paint.get("fill-translate"),Dt=m.paint.get("fill-translate-anchor");G?(Ye=Ce&&!m.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Ke=re.LINES):(Ye=Ce?"fillPattern":"fill",Ke=re.TRIANGLES);const Ut=pe.constantOr(null);for(const Gt of w){const zt=l.getTile(Gt);if(Ce&&!zt.patternsLoaded())continue;const ir=zt.getBucket(m);if(!ir)continue;const sr=ir.programConfigurations.get(m.id),gr=D.useProgram(Ye,sr),Er=D.style.map.terrain&&D.style.map.terrain.getTerrainData(Gt);Ce&&(D.context.activeTexture.set(re.TEXTURE0),zt.imageAtlasTexture.bind(re.LINEAR,re.CLAMP_TO_EDGE),sr.updatePaintBuffers(Me)),_u(sr,oe,Ut,zt,m);const fr=xt.getProjectionData({overscaledTileID:Gt,applyGlobeMatrix:!J,applyTerrainMatrix:!0}),qr=o.au(xt,zt,Ft,Dt);if(G){ft=ir.indexBuffer2,mt=ir.segments2;const Sr=[re.drawingBufferWidth,re.drawingBufferHeight];gt=Ye==="fillOutlinePattern"&&Ce?bn(D,Me,zt,Sr,qr):Xr(Sr,qr)}else ft=ir.indexBuffer,mt=ir.segments,gt=Ce?vr(D,Me,zt,qr):{u_fill_translate:qr};let Jr;if(D.renderPass==="translucent"&&J){const[Sr]=D.getStencilConfigForOverlapAndUpdateStencilID(w);Jr=Sr[Gt.overscaledZ]}else Jr=D.stencilModeForClipping(Gt);gr.draw(D.context,Ke,P,Jr,O,Ai.backCCW,gt,Er,fr,m.id,ir.layoutVertexBuffer,ft,mt,m.paint,D.transform.zoom,sr)}}function Hu(D,l,m,w,P,O,G,J){const re=D.context,oe=re.gl,pe="fill-extrusion-pattern",Ce=m.paint.get(pe),Me=Ce.constantOr(1),Ke=m.getCrossfadeParameters(),Ye=m.paint.get("fill-extrusion-opacity"),gt=Ce.constantOr(null),ft=D.transform;for(const mt of w){const xt=l.getTile(mt),Ft=xt.getBucket(m);if(!Ft)continue;const Dt=D.style.map.terrain&&D.style.map.terrain.getTerrainData(mt),Ut=Ft.programConfigurations.get(m.id),Gt=D.useProgram(Me?"fillExtrusionPattern":"fillExtrusion",Ut);Me&&(D.context.activeTexture.set(oe.TEXTURE0),xt.imageAtlasTexture.bind(oe.LINEAR,oe.CLAMP_TO_EDGE),Ut.updatePaintBuffers(Ke));const zt=ft.getProjectionData({overscaledTileID:mt,applyGlobeMatrix:!J,applyTerrainMatrix:!0});_u(Ut,pe,gt,xt,m);const ir=o.au(ft,xt,m.paint.get("fill-extrusion-translate"),m.paint.get("fill-extrusion-translate-anchor")),sr=m.paint.get("fill-extrusion-vertical-gradient"),gr=Me?rr(D,sr,Ye,ir,mt,Ke,xt):Qt(D,sr,Ye,ir);Gt.draw(re,re.gl.TRIANGLES,P,O,G,Ai.backCCW,gr,Dt,zt,m.id,Ft.layoutVertexBuffer,Ft.indexBuffer,Ft.segments,m.paint,D.transform.zoom,Ut,D.style.map.terrain&&Ft.centroidVertexBuffer)}}function zh(D,l,m,w,P,O,G,J,re){var oe;const pe=D.style.projection,Ce=D.context,Me=D.transform,Ke=Ce.gl,Ye=D.useProgram("hillshade"),gt=!D.options.moving;for(const ft of w){const mt=l.getTile(ft),xt=mt.fbo;if(!xt)continue;const Ft=pe.getMeshFromTileID(Ce,ft.canonical,J,!0,"raster"),Dt=(oe=D.style.map.terrain)===null||oe===void 0?void 0:oe.getTerrainData(ft);Ce.activeTexture.set(Ke.TEXTURE0),Ke.bindTexture(Ke.TEXTURE_2D,xt.colorAttachment.get());const Ut=Me.getProjectionData({overscaledTileID:ft,aligned:gt,applyGlobeMatrix:!re,applyTerrainMatrix:!0});Ye.draw(Ce,Ke.TRIANGLES,O,P[ft.overscaledZ],G,Ai.backCCW,gi(D,mt,m),Dt,Ut,m.id,Ft.vertexBuffer,Ft.indexBuffer,Ft.segments)}}const yu=[new o.P(0,0),new o.P(o.X,0),new o.P(o.X,o.X),new o.P(0,o.X)];function Qi(D,l,m,w,P,O,G,J){let re=arguments.length>8&&arguments[8]!==void 0?arguments[8]:!1,oe=arguments.length>9&&arguments[9]!==void 0?arguments[9]:!1;const pe=w[w.length-1].overscaledZ,Ce=D.context,Me=Ce.gl,Ke=D.useProgram("raster"),Ye=D.transform,gt=D.style.projection,ft=D.colorModeForRenderPass(),mt=!D.options.moving;for(const xt of w){const Ft=D.getDepthModeForSublayer(xt.overscaledZ-pe,m.paint.get("raster-opacity")===1?si.ReadWrite:si.ReadOnly,Me.LESS),Dt=l.getTile(xt);Dt.registerFadeDuration(m.paint.get("raster-fade-duration"));const Ut=l.findLoadedParent(xt,0),Gt=l.findLoadedSibling(xt),zt=bu(Dt,Ut||Gt||null,l,m,D.transform,D.style.map.terrain);let ir,sr;const gr=m.paint.get("raster-resampling")==="nearest"?Me.NEAREST:Me.LINEAR;Ce.activeTexture.set(Me.TEXTURE0),Dt.texture.bind(gr,Me.CLAMP_TO_EDGE,Me.LINEAR_MIPMAP_NEAREST),Ce.activeTexture.set(Me.TEXTURE1),Ut?(Ut.texture.bind(gr,Me.CLAMP_TO_EDGE,Me.LINEAR_MIPMAP_NEAREST),ir=Math.pow(2,Ut.tileID.overscaledZ-Dt.tileID.overscaledZ),sr=[Dt.tileID.canonical.x*ir%1,Dt.tileID.canonical.y*ir%1]):Dt.texture.bind(gr,Me.CLAMP_TO_EDGE,Me.LINEAR_MIPMAP_NEAREST),Dt.texture.useMipmap&&Ce.extTextureFilterAnisotropic&&D.transform.pitch>20&&Me.texParameterf(Me.TEXTURE_2D,Ce.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Ce.extTextureFilterAnisotropicMax);const Er=D.style.map.terrain&&D.style.map.terrain.getTerrainData(xt),fr=Ye.getProjectionData({overscaledTileID:xt,aligned:mt,applyGlobeMatrix:!oe,applyTerrainMatrix:!0}),qr=Oc(sr||[0,0],ir||1,zt,m,J),Jr=gt.getMeshFromTileID(Ce,xt.canonical,O,G,"raster");Ke.draw(Ce,Me.TRIANGLES,Ft,P?P[xt.overscaledZ]:wi.disabled,ft,re?Ai.frontCCW:Ai.backCCW,qr,Er,fr,m.id,Jr.vertexBuffer,Jr.indexBuffer,Jr.segments)}}function bu(D,l,m,w,P,O){const G=w.paint.get("raster-fade-duration");if(!O&&G>0){const J=T.now(),re=(J-D.timeAdded)/G,oe=l?(J-l.timeAdded)/G:-1,pe=m.getSource(),Ce=Tn(P,{tileSize:pe.tileSize,roundZoom:pe.roundZoom}),Me=!l||Math.abs(l.tileID.overscaledZ-Ce)>Math.abs(D.tileID.overscaledZ-Ce),Ke=Me&&D.refreshedUponExpiration?1:o.ab(Me?re:1-oe,0,1);return D.refreshedUponExpiration&&re>=1&&(D.refreshedUponExpiration=!1),l?{opacity:1,mix:1-Ke}:{opacity:Ke,mix:0}}return{opacity:1,mix:0}}const Hs=new o.b4(1,0,0,1),xl=new o.b4(0,1,0,1),Hh=new o.b4(0,0,1,1),Sa=new o.b4(1,0,1,1),Ia=new o.b4(0,1,1,1);function yc(D,l,m,w){gh(D,0,l+m/2,D.transform.width,m,w)}function Bd(D,l,m,w){gh(D,l-m/2,0,m,D.transform.height,w)}function gh(D,l,m,w,P,O){const G=D.context,J=G.gl;J.enable(J.SCISSOR_TEST),J.scissor(l*D.pixelRatio,m*D.pixelRatio,w*D.pixelRatio,P*D.pixelRatio),G.clear({color:O}),J.disable(J.SCISSOR_TEST)}function Cd(D,l,m){const w=D.context,P=w.gl,O=D.useProgram("debug"),G=si.disabled,J=wi.disabled,re=D.colorModeForRenderPass(),oe="$debug",pe=D.style.map.terrain&&D.style.map.terrain.getTerrainData(m);w.activeTexture.set(P.TEXTURE0);const Ce=l.getTileByID(m.key).latestRawTileData,Me=Math.floor((Ce&&Ce.byteLength||0)/1024),Ke=l.getTile(m).tileSize,Ye=512/Math.min(Ke,512)*(m.overscaledZ/D.transform.zoom)*.5;let gt=m.canonical.toString();m.overscaledZ!==m.canonical.z&&(gt+=` => ${m.overscaledZ}`),function(mt,xt){mt.initDebugOverlayCanvas();const Ft=mt.debugOverlayCanvas,Dt=mt.context.gl,Ut=mt.debugOverlayCanvas.getContext("2d");Ut.clearRect(0,0,Ft.width,Ft.height),Ut.shadowColor="white",Ut.shadowBlur=2,Ut.lineWidth=1.5,Ut.strokeStyle="white",Ut.textBaseline="top",Ut.font="bold 36px Open Sans, sans-serif",Ut.fillText(xt,5,5),Ut.strokeText(xt,5,5),mt.debugOverlayTexture.update(Ft),mt.debugOverlayTexture.bind(Dt.LINEAR,Dt.CLAMP_TO_EDGE)}(D,`${gt} ${Me}kB`);const ft=D.transform.getProjectionData({overscaledTileID:m,applyGlobeMatrix:!0,applyTerrainMatrix:!0});O.draw(w,P.TRIANGLES,G,J,Li.alphaBlended,Ai.disabled,pi(o.b4.transparent,Ye),null,ft,oe,D.debugBuffer,D.quadTriangleIndexBuffer,D.debugSegments),O.draw(w,P.LINE_STRIP,G,J,re,Ai.disabled,pi(o.b4.red),pe,ft,oe,D.debugBuffer,D.tileBorderIndexBuffer,D.debugSegments)}function Vh(D,l,m,w){const{isRenderingGlobe:P}=w,O=D.context,G=O.gl,J=D.transform,re=D.colorModeForRenderPass(),oe=D.getDepthModeFor3D(),pe=D.useProgram("terrain");O.bindFramebuffer.set(null),O.viewport.set([0,0,D.width,D.height]);for(const Ce of m){const Me=l.getTerrainMesh(Ce.tileID),Ke=D.renderToTexture.getTexture(Ce),Ye=l.getTerrainData(Ce.tileID);O.activeTexture.set(G.TEXTURE0),G.bindTexture(G.TEXTURE_2D,Ke.texture);const gt=l.getMeshFrameDelta(J.zoom),ft=J.calculateFogMatrix(Ce.tileID.toUnwrapped()),mt=gl(gt,ft,D.style.sky,J.pitch,P),xt=J.getProjectionData({overscaledTileID:Ce.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});pe.draw(O,G.TRIANGLES,oe,wi.disabled,re,Ai.backCCW,mt,Ye,xt,"terrain",Me.vertexBuffer,Me.indexBuffer,Me.segments)}}function vu(D,l){if(!l.mesh){const m=new o.aC;m.emplaceBack(-1,-1),m.emplaceBack(1,-1),m.emplaceBack(1,1),m.emplaceBack(-1,1);const w=new o.aE;w.emplaceBack(0,1,2),w.emplaceBack(0,2,3),l.mesh=new lo(D.createVertexBuffer(m,yn.members),D.createIndexBuffer(w),o.aD.simpleSegment(0,0,m.length,w.length))}return l.mesh}class Za{constructor(l,m){this.context=new Nc(l),this.transform=m,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:o.aq(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=He.maxUnderzooming+He.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new os}resize(l,m,w){if(this.width=Math.floor(l*w),this.height=Math.floor(m*w),this.pixelRatio=w,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const P of this.style._order)this.style._layers[P].resize()}setup(){const l=this.context,m=new o.aC;m.emplaceBack(0,0),m.emplaceBack(o.X,0),m.emplaceBack(0,o.X),m.emplaceBack(o.X,o.X),this.tileExtentBuffer=l.createVertexBuffer(m,yn.members),this.tileExtentSegments=o.aD.simpleSegment(0,0,4,2);const w=new o.aC;w.emplaceBack(0,0),w.emplaceBack(o.X,0),w.emplaceBack(0,o.X),w.emplaceBack(o.X,o.X),this.debugBuffer=l.createVertexBuffer(w,yn.members),this.debugSegments=o.aD.simpleSegment(0,0,4,5);const P=new o.bT;P.emplaceBack(0,0,0,0),P.emplaceBack(o.X,0,o.X,0),P.emplaceBack(0,o.X,0,o.X),P.emplaceBack(o.X,o.X,o.X,o.X),this.rasterBoundsBuffer=l.createVertexBuffer(P,cc.members),this.rasterBoundsSegments=o.aD.simpleSegment(0,0,4,2);const O=new o.aC;O.emplaceBack(0,0),O.emplaceBack(o.X,0),O.emplaceBack(0,o.X),O.emplaceBack(o.X,o.X),this.rasterBoundsBufferPosOnly=l.createVertexBuffer(O,yn.members),this.rasterBoundsSegmentsPosOnly=o.aD.simpleSegment(0,0,4,5);const G=new o.aC;G.emplaceBack(0,0),G.emplaceBack(1,0),G.emplaceBack(0,1),G.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(G,yn.members),this.viewportSegments=o.aD.simpleSegment(0,0,4,2);const J=new o.bU;J.emplaceBack(0),J.emplaceBack(1),J.emplaceBack(3),J.emplaceBack(2),J.emplaceBack(0),this.tileBorderIndexBuffer=l.createIndexBuffer(J);const re=new o.aE;re.emplaceBack(1,0,2),re.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(re);const oe=this.context.gl;this.stencilClearMode=new wi({func:oe.ALWAYS,mask:0},0,255,oe.ZERO,oe.ZERO,oe.ZERO),this.tileExtentMesh=new lo(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const l=this.context,m=l.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const w=o.H();o.bL(w,0,this.width,this.height,0,0,1),o.K(w,w,[m.drawingBufferWidth,m.drawingBufferHeight,0]);const P={mainMatrix:w,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:w};this.useProgram("clippingMask",null,!0).draw(l,m.TRIANGLES,si.disabled,this.stencilClearMode,Li.disabled,Ai.disabled,null,null,P,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(l,m,w){if(this.currentStencilSource===l.source||!l.isTileClipped()||!m||!m.length)return;this.currentStencilSource=l.source,this.nextStencilID+m.length>256&&this.clearStencil();const P=this.context;P.setColorMode(Li.disabled),P.setDepthMode(si.disabled);const O={};for(const G of m)O[G.key]=this.nextStencilID++;this._renderTileMasks(O,m,w,!0),this._renderTileMasks(O,m,w,!1),this._tileClippingMaskIDs=O}_renderTileMasks(l,m,w,P){const O=this.context,G=O.gl,J=this.style.projection,re=this.transform,oe=this.useProgram("clippingMask");for(const pe of m){const Ce=l[pe.key],Me=this.style.map.terrain&&this.style.map.terrain.getTerrainData(pe),Ke=J.getMeshFromTileID(this.context,pe.canonical,P,!0,"stencil"),Ye=re.getProjectionData({overscaledTileID:pe,applyGlobeMatrix:!0,applyTerrainMatrix:!0});oe.draw(O,G.TRIANGLES,si.disabled,new wi({func:G.ALWAYS,mask:0},Ce,255,G.KEEP,G.KEEP,G.REPLACE),Li.disabled,w?Ai.disabled:Ai.backCCW,null,Me,Ye,"$clipping",Ke.vertexBuffer,Ke.indexBuffer,Ke.segments)}}_renderTilesDepthBuffer(){const l=this.context,m=l.gl,w=this.style.projection,P=this.transform,O=this.useProgram("depth"),G=this.getDepthModeFor3D(),J=Xe(P,{tileSize:P.tileSize});for(const re of J){const oe=this.style.map.terrain&&this.style.map.terrain.getTerrainData(re),pe=w.getMeshFromTileID(this.context,re.canonical,!0,!0,"raster"),Ce=P.getProjectionData({overscaledTileID:re,applyGlobeMatrix:!0,applyTerrainMatrix:!0});O.draw(l,m.TRIANGLES,G,wi.disabled,Li.disabled,Ai.backCCW,null,oe,Ce,"$clipping",pe.vertexBuffer,pe.indexBuffer,pe.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const l=this.nextStencilID++,m=this.context.gl;return new wi({func:m.NOTEQUAL,mask:255},l,255,m.KEEP,m.KEEP,m.REPLACE)}stencilModeForClipping(l){const m=this.context.gl;return new wi({func:m.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,m.KEEP,m.KEEP,m.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(l){const m=this.context.gl,w=l.sort((G,J)=>J.overscaledZ-G.overscaledZ),P=w[w.length-1].overscaledZ,O=w[0].overscaledZ-P+1;if(O>1){this.currentStencilSource=void 0,this.nextStencilID+O>256&&this.clearStencil();const G={};for(let J=0;J<O;J++)G[J+P]=new wi({func:m.GEQUAL,mask:255},J+this.nextStencilID,255,m.KEEP,m.KEEP,m.REPLACE);return this.nextStencilID+=O,[G,w]}return[{[P]:wi.disabled},w]}stencilConfigForOverlapTwoPass(l){const m=this.context.gl,w=l.sort((G,J)=>J.overscaledZ-G.overscaledZ),P=w[w.length-1].overscaledZ,O=w[0].overscaledZ-P+1;if(this.clearStencil(),O>1){const G={},J={};for(let re=0;re<O;re++)G[re+P]=new wi({func:m.GREATER,mask:255},O+1+re,255,m.KEEP,m.KEEP,m.REPLACE),J[re+P]=new wi({func:m.GREATER,mask:255},1+re,255,m.KEEP,m.KEEP,m.REPLACE);return this.nextStencilID=2*O+1,[G,J,w]}return this.nextStencilID=3,[{[P]:new wi({func:m.GREATER,mask:255},2,255,m.KEEP,m.KEEP,m.REPLACE)},{[P]:new wi({func:m.GREATER,mask:255},1,255,m.KEEP,m.KEEP,m.REPLACE)},w]}colorModeForRenderPass(){const l=this.context.gl;return this._showOverdrawInspector?new Li([l.CONSTANT_COLOR,l.ONE],new o.b4(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Li.unblended:Li.alphaBlended}getDepthModeForSublayer(l,m,w){if(!this.opaquePassEnabledForLayer())return si.disabled;const P=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new si(w||this.context.gl.LEQUAL,m,[P,P])}getDepthModeFor3D(){return new si(this.context.gl.LEQUAL,si.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(l,m){var w,P;this.style=l,this.options=m,this.lineAtlas=l.lineAtlas,this.imageManager=l.imageManager,this.glyphManager=l.glyphManager,this.symbolFadeChange=l.placement.symbolFadeChange(T.now()),this.imageManager.beginFrame();const O=this.style._order,G=this.style.sourceCaches,J={},re={},oe={},pe={isRenderingToTexture:!1,isRenderingGlobe:((w=l.projection)===null||w===void 0?void 0:w.transitionState)>0};for(const Me in G){const Ke=G[Me];Ke.used&&Ke.prepare(this.context),J[Me]=Ke.getVisibleCoordinates(!1),re[Me]=J[Me].slice().reverse(),oe[Me]=Ke.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let Me=0;Me<O.length;Me++)if(this.style._layers[O[Me]].is3D()){this.opaquePassCutoff=Me;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const Me of O){const Ke=this.style._layers[Me];if(!Ke.hasOffscreenPass()||Ke.isHidden(this.transform.zoom))continue;const Ye=re[Ke.source];(Ke.type==="custom"||Ye.length)&&this.renderLayer(this,G[Ke.source],Ke,Ye,pe)}if((P=this.style.projection)===null||P===void 0||P.updateGPUdependent({context:this.context,useProgram:Me=>this.useProgram(Me)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:m.showOverdrawInspector?o.b4.black:o.b4.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(Me,Ke){const Ye=Me.context,gt=Ye.gl,ft=((Gt,zt,ir)=>{const sr=Math.cos(zt.rollInRadians),gr=Math.sin(zt.rollInRadians),Er=Gi(zt),fr=zt.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:Gt.properties.get("sky-color"),u_horizon_color:Gt.properties.get("horizon-color"),u_horizon:[(zt.width/2-Er*gr)*ir,(zt.height/2+Er*sr)*ir],u_horizon_normal:[-gr,sr],u_sky_horizon_blend:Gt.properties.get("sky-horizon-blend")*zt.height/2*ir,u_sky_blend:fr}})(Ke,Me.style.map.transform,Me.pixelRatio),mt=new si(gt.LEQUAL,si.ReadWrite,[0,1]),xt=wi.disabled,Ft=Me.colorModeForRenderPass(),Dt=Me.useProgram("sky"),Ut=vu(Ye,Ke);Dt.draw(Ye,gt.TRIANGLES,mt,xt,Ft,Ai.disabled,ft,null,void 0,"sky",Ut.vertexBuffer,Ut.indexBuffer,Ut.segments)}(this,this.style.sky),this._showOverdrawInspector=m.showOverdrawInspector,this.depthRangeFor3D=[0,1-(l._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=O.length-1;this.currentLayer>=0;this.currentLayer--){const Me=this.style._layers[O[this.currentLayer]],Ke=G[Me.source],Ye=J[Me.source];this._renderTileClippingMasks(Me,Ye,!1),this.renderLayer(this,Ke,Me,Ye,pe)}this.renderPass="translucent";let Ce=!1;for(this.currentLayer=0;this.currentLayer<O.length;this.currentLayer++){const Me=this.style._layers[O[this.currentLayer]],Ke=G[Me.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(Me,pe))continue;this.opaquePassEnabledForLayer()||Ce||(Ce=!0,pe.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const Ye=(Me.type==="symbol"?oe:re)[Me.source];this._renderTileClippingMasks(Me,J[Me.source],!1),this.renderLayer(this,Ke,Me,Ye,pe)}if(pe.isRenderingGlobe&&function(Me,Ke,Ye){const gt=Me.context,ft=gt.gl,mt=Me.useProgram("atmosphere"),xt=new si(ft.LEQUAL,si.ReadOnly,[0,1]),Ft=Me.transform,Dt=function(fr,qr){const Jr=fr.properties.get("position"),Sr=[-Jr.x,-Jr.y,-Jr.z],tn=o.aq(new Float64Array(16));return fr.properties.get("anchor")==="map"&&(o.aX(tn,tn,qr.rollInRadians),o.aY(tn,tn,-qr.pitchInRadians),o.aX(tn,tn,qr.bearingInRadians),o.aY(tn,tn,qr.center.lat*Math.PI/180),o.bj(tn,tn,-qr.center.lng*Math.PI/180)),o.bS(Sr,Sr,tn),Sr}(Ye,Me.transform),Ut=Ft.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),Gt=Ke.properties.get("atmosphere-blend")*Ut.projectionTransition;if(Gt===0)return;const zt=Ko(Ft.worldSize,Ft.center.lat),ir=Ft.inverseProjectionMatrix,sr=new Float64Array(4);sr[3]=1,o.al(sr,sr,Ft.modelViewProjectionMatrix),sr[0]/=sr[3],sr[1]/=sr[3],sr[2]/=sr[3],sr[3]=1,o.al(sr,sr,ir),sr[0]/=sr[3],sr[1]/=sr[3],sr[2]/=sr[3],sr[3]=1;const gr=((fr,qr,Jr,Sr,tn)=>({u_sun_pos:fr,u_atmosphere_blend:qr,u_globe_position:Jr,u_globe_radius:Sr,u_inv_proj_matrix:tn}))(Dt,Gt,[sr[0],sr[1],sr[2]],zt,ir),Er=vu(gt,Ke);mt.draw(gt,ft.TRIANGLES,xt,wi.disabled,Li.alphaBlended,Ai.disabled,gr,null,null,"atmosphere",Er.vertexBuffer,Er.indexBuffer,Er.segments)}(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const Me=function(Ke,Ye){let gt=null;const ft=Object.values(Ke._layers).flatMap(Dt=>Dt.source&&!Dt.isHidden(Ye)?[Ke.sourceCaches[Dt.source]]:[]),mt=ft.filter(Dt=>Dt.getSource().type==="vector"),xt=ft.filter(Dt=>Dt.getSource().type!=="vector"),Ft=Dt=>{(!gt||gt.getSource().maxzoom<Dt.getSource().maxzoom)&&(gt=Dt)};return mt.forEach(Dt=>Ft(Dt)),gt||xt.forEach(Dt=>Ft(Dt)),gt}(this.style,this.transform.zoom);Me&&function(Ke,Ye,gt){for(let ft=0;ft<gt.length;ft++)Cd(Ke,Ye,gt[ft])}(this,Me,Me.getVisibleCoordinates())}this.options.showPadding&&function(Me){const Ke=Me.transform.padding;yc(Me,Me.transform.height-(Ke.top||0),3,Hs),yc(Me,Ke.bottom||0,3,xl),Bd(Me,Ke.left||0,3,Hh),Bd(Me,Me.transform.width-(Ke.right||0),3,Sa);const Ye=Me.transform.centerPoint;(function(gt,ft,mt,xt){gh(gt,ft-1,mt-10,2,20,xt),gh(gt,ft-10,mt-1,20,2,xt)})(Me,Ye.x,Me.transform.height-Ye.y,Ia)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(l){if(!this.style||!this.style.map||!this.style.map.terrain)return;const m=this.terrainFacilitator.matrix,w=this.transform.modelViewProjectionMatrix;let P=this.terrainFacilitator.dirty;P||(P=l?!o.bV(m,w):!o.bW(m,w)),P||(P=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),P&&(o.bX(m,w),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(O,G){const J=O.context,re=J.gl,oe=O.transform,pe=Li.unblended,Ce=new si(re.LEQUAL,si.ReadWrite,[0,1]),Me=G.sourceCache.getRenderableTiles(),Ke=O.useProgram("terrainDepth");J.bindFramebuffer.set(G.getFramebuffer("depth").framebuffer),J.viewport.set([0,0,O.width/devicePixelRatio,O.height/devicePixelRatio]),J.clear({color:o.b4.transparent,depth:1});for(const Ye of Me){const gt=G.getTerrainMesh(Ye.tileID),ft=G.getTerrainData(Ye.tileID),mt=oe.getProjectionData({overscaledTileID:Ye.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),xt={u_ele_delta:G.getMeshFrameDelta(oe.zoom)};Ke.draw(J,re.TRIANGLES,Ce,wi.disabled,pe,Ai.backCCW,xt,ft,mt,"terrain",gt.vertexBuffer,gt.indexBuffer,gt.segments)}J.bindFramebuffer.set(null),J.viewport.set([0,0,O.width,O.height])}(this,this.style.map.terrain),function(O,G){const J=O.context,re=J.gl,oe=O.transform,pe=Li.unblended,Ce=new si(re.LEQUAL,si.ReadWrite,[0,1]),Me=G.getCoordsTexture(),Ke=G.sourceCache.getRenderableTiles(),Ye=O.useProgram("terrainCoords");J.bindFramebuffer.set(G.getFramebuffer("coords").framebuffer),J.viewport.set([0,0,O.width/devicePixelRatio,O.height/devicePixelRatio]),J.clear({color:o.b4.transparent,depth:1}),G.coordsIndex=[];for(const gt of Ke){const ft=G.getTerrainMesh(gt.tileID),mt=G.getTerrainData(gt.tileID);J.activeTexture.set(re.TEXTURE0),re.bindTexture(re.TEXTURE_2D,Me.texture);const xt={u_terrain_coords_id:(255-G.coordsIndex.length)/255,u_texture:0,u_ele_delta:G.getMeshFrameDelta(oe.zoom)},Ft=oe.getProjectionData({overscaledTileID:gt.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});Ye.draw(J,re.TRIANGLES,Ce,wi.disabled,pe,Ai.backCCW,xt,mt,Ft,"terrain",ft.vertexBuffer,ft.indexBuffer,ft.segments),G.coordsIndex.push(gt.tileID.key)}J.bindFramebuffer.set(null),J.viewport.set([0,0,O.width,O.height])}(this,this.style.map.terrain))}renderLayer(l,m,w,P,O){w.isHidden(this.transform.zoom)||(w.type==="background"||w.type==="custom"||(P||[]).length)&&(this.id=w.id,o.bY(w)?function(G,J,re,oe,pe,Ce){if(G.renderPass!=="translucent")return;const{isRenderingToTexture:Me}=Ce,Ke=wi.disabled,Ye=G.colorModeForRenderPass();(re._unevaluatedLayout.hasValue("text-variable-anchor")||re._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(gt,ft,mt,xt,Ft,Dt,Ut,Gt,zt){const ir=ft.transform,sr=ft.style.map.terrain,gr=Ft==="map",Er=Dt==="map";for(const fr of gt){const qr=xt.getTile(fr),Jr=qr.getBucket(mt);if(!Jr||!Jr.text||!Jr.text.segments.get().length)continue;const Sr=o.ah(Jr.textSizeData,ir.zoom),tn=o.at(qr,1,ft.transform.zoom),Yn=Wt(gr,ft.transform,tn),oi=mt.layout.get("icon-text-fit")!=="none"&&Jr.hasIconData();{const ws=Math.pow(2,ir.zoom-qr.tileID.overscaledZ),Oi=sr?(Gs,Wi)=>sr.getElevation(fr,Gs,Wi):null;Hc(Jr,gr,Er,zt,ir,Yn,ws,Sr,oi,o.au(ir,qr,Ut,Gt),fr.toUnwrapped(),Oi)}}}(oe,G,re,J,re.layout.get("text-rotation-alignment"),re.layout.get("text-pitch-alignment"),re.paint.get("text-translate"),re.paint.get("text-translate-anchor"),pe),re.paint.get("icon-opacity").constantOr(1)!==0&&_c(G,J,re,oe,!1,re.paint.get("icon-translate"),re.paint.get("icon-translate-anchor"),re.layout.get("icon-rotation-alignment"),re.layout.get("icon-pitch-alignment"),re.layout.get("icon-keep-upright"),Ke,Ye,Me),re.paint.get("text-opacity").constantOr(1)!==0&&_c(G,J,re,oe,!0,re.paint.get("text-translate"),re.paint.get("text-translate-anchor"),re.layout.get("text-rotation-alignment"),re.layout.get("text-pitch-alignment"),re.layout.get("text-keep-upright"),Ke,Ye,Me),J.map.showCollisionBoxes&&(mc(G,J,re,oe,!0),mc(G,J,re,oe,!1))}(l,m,w,P,this.style.placement.variableOffsets,O):o.bZ(w)?function(G,J,re,oe,pe){if(G.renderPass!=="translucent")return;const{isRenderingToTexture:Ce}=pe,Me=re.paint.get("circle-opacity"),Ke=re.paint.get("circle-stroke-width"),Ye=re.paint.get("circle-stroke-opacity"),gt=!re.layout.get("circle-sort-key").isConstant();if(Me.constantOr(1)===0&&(Ke.constantOr(1)===0||Ye.constantOr(1)===0))return;const ft=G.context,mt=ft.gl,xt=G.transform,Ft=G.getDepthModeForSublayer(0,si.ReadOnly),Dt=wi.disabled,Ut=G.colorModeForRenderPass(),Gt=[],zt=xt.getCircleRadiusCorrection();for(let ir=0;ir<oe.length;ir++){const sr=oe[ir],gr=J.getTile(sr),Er=gr.getBucket(re);if(!Er)continue;const fr=re.paint.get("circle-translate"),qr=re.paint.get("circle-translate-anchor"),Jr=o.au(xt,gr,fr,qr),Sr=Er.programConfigurations.get(re.id),tn=G.useProgram("circle",Sr),Yn=Er.layoutVertexBuffer,oi=Er.indexBuffer,ws=G.style.map.terrain&&G.style.map.terrain.getTerrainData(sr),Oi={programConfiguration:Sr,program:tn,layoutVertexBuffer:Yn,indexBuffer:oi,uniformValues:qn(G,gr,re,Jr,zt),terrainData:ws,projectionData:xt.getProjectionData({overscaledTileID:sr,applyGlobeMatrix:!Ce,applyTerrainMatrix:!0})};if(gt){const Gs=Er.segments.get();for(const Wi of Gs)Gt.push({segments:new o.aD([Wi]),sortKey:Wi.sortKey,state:Oi})}else Gt.push({segments:Er.segments,sortKey:0,state:Oi})}gt&&Gt.sort((ir,sr)=>ir.sortKey-sr.sortKey);for(const ir of Gt){const{programConfiguration:sr,program:gr,layoutVertexBuffer:Er,indexBuffer:fr,uniformValues:qr,terrainData:Jr,projectionData:Sr}=ir.state;gr.draw(ft,mt.TRIANGLES,Ft,Dt,Ut,Ai.backCCW,qr,Jr,Sr,re.id,Er,fr,ir.segments,re.paint,G.transform.zoom,sr)}}(l,m,w,P,O):o.b_(w)?function(G,J,re,oe,pe){if(re.paint.get("heatmap-opacity")===0)return;const Ce=G.context,{isRenderingToTexture:Me,isRenderingGlobe:Ke}=pe;if(G.style.map.terrain){for(const Ye of oe){const gt=J.getTile(Ye);J.hasRenderableParent(Ye)||(G.renderPass==="offscreen"?ph(G,gt,re,Ye,Ke):G.renderPass==="translucent"&&Gl(G,re,Ye,Me,Ke))}Ce.viewport.set([0,0,G.width,G.height])}else G.renderPass==="offscreen"?function(Ye,gt,ft,mt){const xt=Ye.context,Ft=xt.gl,Dt=Ye.transform,Ut=wi.disabled,Gt=new Li([Ft.ONE,Ft.ONE],o.b4.transparent,[!0,!0,!0,!0]);(function(zt,ir,sr){const gr=zt.gl;zt.activeTexture.set(gr.TEXTURE1),zt.viewport.set([0,0,ir.width/4,ir.height/4]);let Er=sr.heatmapFbos.get(o.bP);Er?(gr.bindTexture(gr.TEXTURE_2D,Er.colorAttachment.get()),zt.bindFramebuffer.set(Er.framebuffer)):(Er=Vc(zt,ir.width/4,ir.height/4),sr.heatmapFbos.set(o.bP,Er))})(xt,Ye,ft),xt.clear({color:o.b4.transparent});for(let zt=0;zt<mt.length;zt++){const ir=mt[zt];if(gt.hasRenderableParent(ir))continue;const sr=gt.getTile(ir),gr=sr.getBucket(ft);if(!gr)continue;const Er=gr.programConfigurations.get(ft.id),fr=Ye.useProgram("heatmap",Er),qr=Dt.getProjectionData({overscaledTileID:ir,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),Jr=Dt.getCircleRadiusCorrection();fr.draw(xt,Ft.TRIANGLES,si.disabled,Ut,Gt,Ai.backCCW,as(sr,Dt.zoom,ft.paint.get("heatmap-intensity"),Jr),null,qr,ft.id,gr.layoutVertexBuffer,gr.indexBuffer,gr.segments,ft.paint,Dt.zoom,Er)}xt.viewport.set([0,0,Ye.width,Ye.height])}(G,J,re,oe):G.renderPass==="translucent"&&function(Ye,gt){const ft=Ye.context,mt=ft.gl;ft.setColorMode(Ye.colorModeForRenderPass());const xt=gt.heatmapFbos.get(o.bP);xt&&(ft.activeTexture.set(mt.TEXTURE0),mt.bindTexture(mt.TEXTURE_2D,xt.colorAttachment.get()),ft.activeTexture.set(mt.TEXTURE1),Gc(ft,gt).bind(mt.LINEAR,mt.CLAMP_TO_EDGE),Ye.useProgram("heatmapTexture").draw(ft,mt.TRIANGLES,si.disabled,wi.disabled,Ye.colorModeForRenderPass(),Ai.disabled,rs(Ye,gt,0,1),null,null,gt.id,Ye.viewportBuffer,Ye.quadTriangleIndexBuffer,Ye.viewportSegments,gt.paint,Ye.transform.zoom))}(G,re)}(l,m,w,P,O):o.b$(w)?function(G,J,re,oe,pe){if(G.renderPass!=="translucent")return;const{isRenderingToTexture:Ce}=pe,Me=re.paint.get("line-opacity"),Ke=re.paint.get("line-width");if(Me.constantOr(1)===0||Ke.constantOr(1)===0)return;const Ye=G.getDepthModeForSublayer(0,si.ReadOnly),gt=G.colorModeForRenderPass(),ft=re.paint.get("line-dasharray"),mt=re.paint.get("line-pattern"),xt=mt.constantOr(1),Ft=re.paint.get("line-gradient"),Dt=re.getCrossfadeParameters(),Ut=xt?"linePattern":ft?"lineSDF":Ft?"lineGradient":"line",Gt=G.context,zt=Gt.gl,ir=G.transform;let sr=!0;for(const gr of oe){const Er=J.getTile(gr);if(xt&&!Er.patternsLoaded())continue;const fr=Er.getBucket(re);if(!fr)continue;const qr=fr.programConfigurations.get(re.id),Jr=G.context.program.get(),Sr=G.useProgram(Ut,qr),tn=sr||Sr.program!==Jr,Yn=G.style.map.terrain&&G.style.map.terrain.getTerrainData(gr),oi=mt.constantOr(null);if(oi&&Er.imageAtlas){const ti=Er.imageAtlas,Xi=ti.patternPositions[oi.to.toString()],No=ti.patternPositions[oi.from.toString()];Xi&&No&&qr.setConstantPatternPositions(Xi,No)}const ws=ir.getProjectionData({overscaledTileID:gr,applyGlobeMatrix:!Ce,applyTerrainMatrix:!0}),Oi=ir.getPixelScale(),Gs=xt?Ti(G,Er,re,Oi,Dt):ft?hc(G,Er,re,Oi,ft,Dt):Ft?vi(G,Er,re,Oi,fr.lineClipsArray.length):Wo(G,Er,re,Oi);if(xt)Gt.activeTexture.set(zt.TEXTURE0),Er.imageAtlasTexture.bind(zt.LINEAR,zt.CLAMP_TO_EDGE),qr.updatePaintBuffers(Dt);else if(ft&&(tn||G.lineAtlas.dirty))Gt.activeTexture.set(zt.TEXTURE0),G.lineAtlas.bind(Gt);else if(Ft){const ti=fr.gradients[re.id];let Xi=ti.texture;if(re.gradientVersion!==ti.version){let No=256;if(re.stepInterpolant){const Rs=J.getSource().maxzoom,Bs=gr.canonical.z===Rs?Math.ceil(1<<G.transform.maxZoom-gr.canonical.z):1;No=o.ab(o.bQ(fr.maxLineLength/o.X*1024*Bs),256,Gt.maxTextureSize)}ti.gradient=o.bR({expression:re.gradientExpression(),evaluationKey:"lineProgress",resolution:No,image:ti.gradient||void 0,clips:fr.lineClipsArray}),ti.texture?ti.texture.update(ti.gradient):ti.texture=new Ue(Gt,ti.gradient,zt.RGBA),ti.version=re.gradientVersion,Xi=ti.texture}Gt.activeTexture.set(zt.TEXTURE0),Xi.bind(re.stepInterpolant?zt.NEAREST:zt.LINEAR,zt.CLAMP_TO_EDGE)}let Wi;if(Ce){const[ti]=G.getStencilConfigForOverlapAndUpdateStencilID(oe);Wi=ti[gr.overscaledZ]}else Wi=G.stencilModeForClipping(gr);Sr.draw(Gt,zt.TRIANGLES,Ye,Wi,gt,Ai.disabled,Gs,Yn,ws,re.id,fr.layoutVertexBuffer,fr.indexBuffer,fr.segments,re.paint,G.transform.zoom,qr,fr.layoutVertexBuffer2),sr=!1}}(l,m,w,P,O):o.c0(w)?function(G,J,re,oe,pe){const Ce=re.paint.get("fill-color"),Me=re.paint.get("fill-opacity");if(Me.constantOr(1)===0)return;const{isRenderingToTexture:Ke}=pe,Ye=G.colorModeForRenderPass(),gt=re.paint.get("fill-pattern"),ft=G.opaquePassEnabledForLayer()&&!gt.constantOr(1)&&Ce.constantOr(o.b4.transparent).a===1&&Me.constantOr(0)===1?"opaque":"translucent";if(G.renderPass===ft){const mt=G.getDepthModeForSublayer(1,G.renderPass==="opaque"?si.ReadWrite:si.ReadOnly);Qc(G,J,re,oe,mt,Ye,!1,Ke)}if(G.renderPass==="translucent"&&re.paint.get("fill-antialias")){const mt=G.getDepthModeForSublayer(re.getPaintProperty("fill-outline-color")?2:0,si.ReadOnly);Qc(G,J,re,oe,mt,Ye,!0,Ke)}}(l,m,w,P,O):o.c1(w)?function(G,J,re,oe,pe){const Ce=re.paint.get("fill-extrusion-opacity");if(Ce===0)return;const{isRenderingToTexture:Me}=pe;if(G.renderPass==="translucent"){const Ke=new si(G.context.gl.LEQUAL,si.ReadWrite,G.depthRangeFor3D);if(Ce!==1||re.paint.get("fill-extrusion-pattern").constantOr(1))Hu(G,J,re,oe,Ke,wi.disabled,Li.disabled,Me),Hu(G,J,re,oe,Ke,G.stencilModeFor3D(),G.colorModeForRenderPass(),Me);else{const Ye=G.colorModeForRenderPass();Hu(G,J,re,oe,Ke,wi.disabled,Ye,Me)}}}(l,m,w,P,O):o.c2(w)?function(G,J,re,oe,pe){if(G.renderPass!=="offscreen"&&G.renderPass!=="translucent")return;const{isRenderingToTexture:Ce}=pe,Me=G.context,Ke=G.style.projection.useSubdivision,Ye=G.getDepthModeForSublayer(0,si.ReadOnly),gt=G.colorModeForRenderPass();if(G.renderPass==="offscreen")(function(ft,mt,xt,Ft,Dt,Ut,Gt){const zt=ft.context,ir=zt.gl;for(const sr of xt){const gr=mt.getTile(sr),Er=gr.dem;if(!Er||!Er.data||!gr.needsHillshadePrepare)continue;const fr=Er.dim,qr=Er.stride,Jr=Er.getPixels();if(zt.activeTexture.set(ir.TEXTURE1),zt.pixelStoreUnpackPremultiplyAlpha.set(!1),gr.demTexture=gr.demTexture||ft.getTileTexture(qr),gr.demTexture){const tn=gr.demTexture;tn.update(Jr,{premultiply:!1}),tn.bind(ir.NEAREST,ir.CLAMP_TO_EDGE)}else gr.demTexture=new Ue(zt,Jr,ir.RGBA,{premultiply:!1}),gr.demTexture.bind(ir.NEAREST,ir.CLAMP_TO_EDGE);zt.activeTexture.set(ir.TEXTURE0);let Sr=gr.fbo;if(!Sr){const tn=new Ue(zt,{width:fr,height:fr,data:null},ir.RGBA);tn.bind(ir.LINEAR,ir.CLAMP_TO_EDGE),Sr=gr.fbo=zt.createFramebuffer(fr,fr,!0,!1),Sr.colorAttachment.set(tn.texture)}zt.bindFramebuffer.set(Sr.framebuffer),zt.viewport.set([0,0,fr,fr]),ft.useProgram("hillshadePrepare").draw(zt,ir.TRIANGLES,Dt,Ut,Gt,Ai.disabled,Do(gr.tileID,Er),null,null,Ft.id,ft.rasterBoundsBuffer,ft.quadTriangleIndexBuffer,ft.rasterBoundsSegments),gr.needsHillshadePrepare=!1}})(G,J,oe,re,Ye,wi.disabled,gt),Me.viewport.set([0,0,G.width,G.height]);else if(G.renderPass==="translucent")if(Ke){const[ft,mt,xt]=G.stencilConfigForOverlapTwoPass(oe);zh(G,J,re,xt,ft,Ye,gt,!1,Ce),zh(G,J,re,xt,mt,Ye,gt,!0,Ce)}else{const[ft,mt]=G.getStencilConfigForOverlapAndUpdateStencilID(oe);zh(G,J,re,mt,ft,Ye,gt,!1,Ce)}}(l,m,w,P,O):o.c3(w)?function(G,J,re,oe,pe){if(G.renderPass!=="translucent"||re.paint.get("raster-opacity")===0||!oe.length)return;const{isRenderingToTexture:Ce}=pe,Me=J.getSource(),Ke=G.style.projection.useSubdivision;if(Me instanceof Mr)Qi(G,J,re,oe,null,!1,!1,Me.tileCoords,Me.flippedWindingOrder,Ce);else if(Ke){const[Ye,gt,ft]=G.stencilConfigForOverlapTwoPass(oe);Qi(G,J,re,ft,Ye,!1,!0,yu,!1,Ce),Qi(G,J,re,ft,gt,!0,!0,yu,!1,Ce)}else{const[Ye,gt]=G.getStencilConfigForOverlapAndUpdateStencilID(oe);Qi(G,J,re,gt,Ye,!1,!0,yu,!1,Ce)}}(l,m,w,P,O):o.c4(w)?function(G,J,re,oe,pe){const Ce=re.paint.get("background-color"),Me=re.paint.get("background-opacity");if(Me===0)return;const{isRenderingToTexture:Ke}=pe,Ye=G.context,gt=Ye.gl,ft=G.style.projection,mt=G.transform,xt=mt.tileSize,Ft=re.paint.get("background-pattern");if(G.isPatternMissing(Ft))return;const Dt=!Ft&&Ce.a===1&&Me===1&&G.opaquePassEnabledForLayer()?"opaque":"translucent";if(G.renderPass!==Dt)return;const Ut=wi.disabled,Gt=G.getDepthModeForSublayer(0,Dt==="opaque"?si.ReadWrite:si.ReadOnly),zt=G.colorModeForRenderPass(),ir=G.useProgram(Ft?"backgroundPattern":"background"),sr=oe||Xe(mt,{tileSize:xt,terrain:G.style.map.terrain});Ft&&(Ye.activeTexture.set(gt.TEXTURE0),G.imageManager.bind(G.context));const gr=re.getCrossfadeParameters();for(const Er of sr){const fr=mt.getProjectionData({overscaledTileID:Er,applyGlobeMatrix:!Ke,applyTerrainMatrix:!0}),qr=Ft?fc(Me,G,Ft,{tileID:Er,tileSize:xt},gr):dc(Me,Ce),Jr=G.style.map.terrain&&G.style.map.terrain.getTerrainData(Er),Sr=ft.getMeshFromTileID(Ye,Er.canonical,!1,!0,"raster");ir.draw(Ye,gt.TRIANGLES,Gt,Ut,zt,Ai.backCCW,qr,Jr,fr,re.id,Sr.vertexBuffer,Sr.indexBuffer,Sr.segments)}}(l,0,w,P,O):o.c5(w)&&function(G,J,re,oe){const{isRenderingGlobe:pe}=oe,Ce=G.context,Me=re.implementation,Ke=G.style.projection,Ye=G.transform,gt=Ye.getProjectionDataForCustomLayer(pe),ft={farZ:Ye.farZ,nearZ:Ye.nearZ,fov:Ye.fov*Math.PI/180,modelViewProjectionMatrix:Ye.modelViewProjectionMatrix,projectionMatrix:Ye.projectionMatrix,shaderData:{variantName:Ke.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${Ke.shaderPreludeCode.vertexSource}`,define:Ke.shaderDefine},defaultProjectionData:gt},mt=Me.renderingMode?Me.renderingMode:"2d";if(G.renderPass==="offscreen"){const xt=Me.prerender;xt&&(G.setCustomLayerDefaults(),Ce.setColorMode(G.colorModeForRenderPass()),xt.call(Me,Ce.gl,ft),Ce.setDirty(),G.setBaseState())}else if(G.renderPass==="translucent"){G.setCustomLayerDefaults(),Ce.setColorMode(G.colorModeForRenderPass()),Ce.setStencilMode(wi.disabled);const xt=mt==="3d"?G.getDepthModeFor3D():G.getDepthModeForSublayer(0,si.ReadOnly);Ce.setDepthMode(xt),Me.render(Ce.gl,ft),Ce.setDirty(),G.setBaseState(),Ce.bindFramebuffer.set(null)}}(l,0,w,O))}saveTileTexture(l){const m=this._tileTextures[l.size[0]];m?m.push(l):this._tileTextures[l.size[0]]=[l]}getTileTexture(l){const m=this._tileTextures[l];return m&&m.length>0?m.pop():null}isPatternMissing(l){if(!l)return!1;if(!l.from||!l.to)return!0;const m=this.imageManager.getPattern(l.from.toString()),w=this.imageManager.getPattern(l.to.toString());return!m||!w}useProgram(l,m){let w=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;this.cache=this.cache||{};const P=!!this.style.map.terrain,O=this.style.projection,G=l+(m?m.cacheKey:"")+`/${w?hh:O.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(P?"/terrain":"");return this.cache[G]||(this.cache[G]=new je(this.context,ds[l],m,Ac[l],this._showOverdrawInspector,P,w?ds.projectionMercator:O.shaderPreludeCode,w?Fc:O.shaderDefine)),this.cache[G]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Ue(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:l,drawingBufferHeight:m}=this.context.gl;return this.width!==l||this.height!==m}}function pn(D,l){var m=this;let w,P=!1,O=null,G=null;const J=()=>{O=null,P&&(D.apply(G,w),O=setTimeout(J,l),P=!1)};return function(){for(var re=arguments.length,oe=new Array(re),pe=0;pe<re;pe++)oe[pe]=arguments[pe];return P=!0,G=m,w=oe,O||J(),O}}class Ya{constructor(l){this._getCurrentHash=()=>{const m=window.location.hash.replace("#","");if(this._hashName){let w;return m.split("&").map(P=>P.split("=")).forEach(P=>{P[0]===this._hashName&&(w=P)}),(w&&w[1]||"").split("/")}return m.split("/")},this._onHashChange=()=>{const m=this._getCurrentHash();if(!this._isValidHash(m))return!1;const w=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(m[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+m[2],+m[1]],zoom:+m[0],bearing:w,pitch:+(m[4]||0)}),!0},this._updateHashUnthrottled=()=>{const m=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,m)},this._removeHash=()=>{const m=this._getCurrentHash();if(m.length===0)return;const w=m.join("/");let P=w;P.split("&").length>0&&(P=P.split("&")[0]),this._hashName&&(P=`${this._hashName}=${w}`);let O=window.location.hash.replace(P,"");O.startsWith("#&")?O=O.slice(0,1)+O.slice(2):O==="#"&&(O="");let G=window.location.href.replace(/(#.+)?$/,O);G=G.replace("&&","&"),window.history.replaceState(window.history.state,null,G)},this._updateHash=pn(this._updateHashUnthrottled,300),this._hashName=l&&encodeURIComponent(l)}addTo(l){return this._map=l,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(l){const m=this._map.getCenter(),w=Math.round(100*this._map.getZoom())/100,P=Math.ceil((w*Math.LN2+Math.log(512/360/.5))/Math.LN10),O=Math.pow(10,P),G=Math.round(m.lng*O)/O,J=Math.round(m.lat*O)/O,re=this._map.getBearing(),oe=this._map.getPitch();let pe="";if(pe+=l?`/${G}/${J}/${w}`:`${w}/${J}/${G}`,(re||oe)&&(pe+="/"+Math.round(10*re)/10),oe&&(pe+=`/${Math.round(oe)}`),this._hashName){const Ce=this._hashName;let Me=!1;const Ke=window.location.hash.slice(1).split("&").map(Ye=>{const gt=Ye.split("=")[0];return gt===Ce?(Me=!0,`${gt}=${pe}`):Ye}).filter(Ye=>Ye);return Me||Ke.push(`${Ce}=${pe}`),`#${Ke.join("&")}`}return`#${pe}`}_isValidHash(l){if(l.length<3||l.some(isNaN))return!1;try{new o.N(+l[2],+l[1])}catch{return!1}const m=+l[0],w=+(l[3]||0),P=+(l[4]||0);return m>=this._map.getMinZoom()&&m<=this._map.getMaxZoom()&&w>=0&&w<=180&&P>=this._map.getMinPitch()&&P<=this._map.getMaxPitch()}}const To={linearity:.3,easing:o.c6(0,0,.3,1)},Ql=o.e({deceleration:2500,maxSpeed:1400},To),Vu=o.e({deceleration:20,maxSpeed:1400},To),xu=o.e({deceleration:1e3,maxSpeed:360},To),$l=o.e({deceleration:1e3,maxSpeed:90},To),ni=o.e({deceleration:1e3,maxSpeed:360},To);class Gu{constructor(l){this._map=l,this.clear()}clear(){this._inertiaBuffer=[]}record(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:T.now(),settings:l})}_drainInertiaBuffer(){const l=this._inertiaBuffer,m=T.now();for(;l.length>0&&m-l[0].time>160;)l.shift()}_onMoveEnd(l){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const m={zoom:0,bearing:0,pitch:0,roll:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:O}of this._inertiaBuffer)m.zoom+=O.zoomDelta||0,m.bearing+=O.bearingDelta||0,m.pitch+=O.pitchDelta||0,m.roll+=O.rollDelta||0,O.panDelta&&m.pan._add(O.panDelta),O.around&&(m.around=O.around),O.pinchAround&&(m.pinchAround=O.pinchAround);const w=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,P={};if(m.pan.mag()){const O=So(m.pan.mag(),w,o.e({},Ql,l||{})),G=m.pan.mult(O.amount/m.pan.mag()),J=this._map.cameraHelper.handlePanInertia(G,this._map.transform);P.center=J.easingCenter,P.offset=J.easingOffset,mh(P,O)}if(m.zoom){const O=So(m.zoom,w,Vu);P.zoom=this._map.transform.zoom+O.amount,mh(P,O)}if(m.bearing){const O=So(m.bearing,w,xu);P.bearing=this._map.transform.bearing+o.ab(O.amount,-179,179),mh(P,O)}if(m.pitch){const O=So(m.pitch,w,$l);P.pitch=this._map.transform.pitch+O.amount,mh(P,O)}if(m.roll){const O=So(m.roll,w,ni);P.roll=this._map.transform.roll+o.ab(O.amount,-179,179),mh(P,O)}if(P.zoom||P.bearing){const O=m.pinchAround===void 0?m.around:m.pinchAround;P.around=O?this._map.unproject(O):this._map.getCenter()}return this.clear(),o.e(P,{noMoveStart:!0})}}function mh(D,l){(!D.duration||D.duration<l.duration)&&(D.duration=l.duration,D.easing=l.easing)}function So(D,l,m){const{maxSpeed:w,linearity:P,deceleration:O}=m,G=o.ab(D*P/(l/1e3),-w,w),J=Math.abs(G)/(O*P);return{easing:m.easing,duration:1e3*J,amount:G*(J/2)}}class Vs extends o.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,m,w){let P=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const O=I.mousePos(m.getCanvas(),w),G=m.unproject(O);super(l,o.e({point:O,lngLat:G,originalEvent:w},P)),this._defaultPrevented=!1,this.target=m}}class wl extends o.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,m,w){const P=l==="touchend"?w.changedTouches:w.touches,O=I.touchPos(m.getCanvasContainer(),P),G=O.map(re=>m.unproject(re)),J=O.reduce((re,oe,pe,Ce)=>re.add(oe.div(Ce.length)),new o.P(0,0));super(l,{points:O,point:J,lngLats:G,lngLat:m.unproject(J),originalEvent:w}),this._defaultPrevented=!1}}class el extends o.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,m,w){super(l,{originalEvent:w}),this._defaultPrevented=!1}}class wu{constructor(l,m){this._map=l,this._clickTolerance=m.clickTolerance}reset(){delete this._mousedownPos}wheel(l){return this._firePreventable(new el(l.type,this._map,l))}mousedown(l,m){return this._mousedownPos=m,this._firePreventable(new Vs(l.type,this._map,l))}mouseup(l){this._map.fire(new Vs(l.type,this._map,l))}click(l,m){this._mousedownPos&&this._mousedownPos.dist(m)>=this._clickTolerance||this._map.fire(new Vs(l.type,this._map,l))}dblclick(l){return this._firePreventable(new Vs(l.type,this._map,l))}mouseover(l){this._map.fire(new Vs(l.type,this._map,l))}mouseout(l){this._map.fire(new Vs(l.type,this._map,l))}touchstart(l){return this._firePreventable(new wl(l.type,this._map,l))}touchmove(l){this._map.fire(new wl(l.type,this._map,l))}touchend(l){this._map.fire(new wl(l.type,this._map,l))}touchcancel(l){this._map.fire(new wl(l.type,this._map,l))}_firePreventable(l){if(this._map.fire(l),l.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Gh{constructor(l){this._map=l}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(l){this._map.fire(new Vs(l.type,this._map,l))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Vs("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(l){this._delayContextMenu?this._contextMenuEvent=l:this._ignoreContextMenu||this._map.fire(new Vs(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Bu{constructor(l){this._map=l}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(l){return this.transform.screenPointToLocation(o.P.convert(l),this._map.terrain)}}class Cu{constructor(l,m){this._map=l,this._tr=new Bu(l),this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=m.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(l,m){this.isEnabled()&&l.shiftKey&&l.button===0&&(I.disableDrag(),this._startPos=this._lastPos=m,this._active=!0)}mousemoveWindow(l,m){if(!this._active)return;const w=m;if(this._lastPos.equals(w)||!this._box&&w.dist(this._startPos)<this._clickTolerance)return;const P=this._startPos;this._lastPos=w,this._box||(this._box=I.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",l));const O=Math.min(P.x,w.x),G=Math.max(P.x,w.x),J=Math.min(P.y,w.y),re=Math.max(P.y,w.y);I.setTransform(this._box,`translate(${O}px,${J}px)`),this._box.style.width=G-O+"px",this._box.style.height=re-J+"px"}mouseupWindow(l,m){if(!this._active||l.button!==0)return;const w=this._startPos,P=m;if(this.reset(),I.suppressClick(),w.x!==P.x||w.y!==P.y)return this._map.fire(new o.k("boxzoomend",{originalEvent:l})),{cameraAnimation:O=>O.fitScreenCoordinates(w,P,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",l)}keydown(l){this._active&&l.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",l))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(I.remove(this._box),this._box=null),I.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(l,m){return this._map.fire(new o.k(l,{originalEvent:m}))}}function Qh(D,l){if(D.length!==l.length)throw new Error(`The number of touches and points are not equal - touches ${D.length}, points ${l.length}`);const m={};for(let w=0;w<D.length;w++)m[D[w].identifier]=l[w];return m}class xf{constructor(l){this.reset(),this.numTouches=l.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(l,m,w){(this.centroid||w.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=l.timeStamp),w.length===this.numTouches&&(this.centroid=function(P){const O=new o.P(0,0);for(const G of P)O._add(G);return O.div(P.length)}(m),this.touches=Qh(w,m)))}touchmove(l,m,w){if(this.aborted||!this.centroid)return;const P=Qh(w,m);for(const O in this.touches){const G=P[O];(!G||G.dist(this.touches[O])>30)&&(this.aborted=!0)}}touchend(l,m,w){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),w.length===0){const P=!this.aborted&&this.centroid;if(this.reset(),P)return P}}}class _o{constructor(l){this.singleTap=new xf(l),this.numTaps=l.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(l,m,w){this.singleTap.touchstart(l,m,w)}touchmove(l,m,w){this.singleTap.touchmove(l,m,w)}touchend(l,m,w){const P=this.singleTap.touchend(l,m,w);if(P){const O=l.timeStamp-this.lastTime<500,G=!this.lastTap||this.lastTap.dist(P)<30;if(O&&G||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=P,this.count===this.numTaps)return this.reset(),P}}}class Fi{constructor(l){this._tr=new Bu(l),this._zoomIn=new _o({numTouches:1,numTaps:2}),this._zoomOut=new _o({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(l,m,w){this._zoomIn.touchstart(l,m,w),this._zoomOut.touchstart(l,m,w)}touchmove(l,m,w){this._zoomIn.touchmove(l,m,w),this._zoomOut.touchmove(l,m,w)}touchend(l,m,w){const P=this._zoomIn.touchend(l,m,w),O=this._zoomOut.touchend(l,m,w),G=this._tr;return P?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:J=>J.easeTo({duration:300,zoom:G.zoom+1,around:G.unproject(P)},{originalEvent:l})}):O?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:J=>J.easeTo({duration:300,zoom:G.zoom-1,around:G.unproject(O)},{originalEvent:l})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class un{constructor(l){this._enabled=!!l.enable,this._moveStateManager=l.moveStateManager,this._clickTolerance=l.clickTolerance||1,this._moveFunction=l.move,this._activateOnStart=!!l.activateOnStart,l.assignEvents(this),this.reset()}reset(l){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(l)}_move(){const l=this._moveFunction(...arguments);if(l.bearingDelta||l.pitchDelta||l.rollDelta||l.around||l.panDelta)return this._active=!0,l}dragStart(l,m){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(l)&&(this._moveStateManager.startMove(l),this._lastPoint=Array.isArray(m)?m[0]:m,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(l,m){if(!this.isEnabled())return;const w=this._lastPoint;if(!w)return;if(l.preventDefault(),!this._moveStateManager.isValidMoveEvent(l))return void this.reset(l);const P=Array.isArray(m)?m[0]:m;return!this._moved&&P.dist(w)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=P,this._move(w,P))}dragEnd(l){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(l)&&(this._moved&&I.suppressClick(),this.reset(l))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const $h={0:1,2:2};class bc{constructor(l){this._correctEvent=l.checkCorrectEvent}startMove(l){const m=I.mouseButton(l);this._eventButton=m}endMove(l){delete this._eventButton}isValidStartEvent(l){return this._correctEvent(l)}isValidMoveEvent(l){return!function(m,w){const P=$h[w];return m.buttons===void 0||(m.buttons&P)!==P}(l,this._eventButton)}isValidEndEvent(l){return I.mouseButton(l)===this._eventButton}}class wf{constructor(){this._firstTouch=void 0}_isOneFingerTouch(l){return l.targetTouches.length===1}_isSameTouchEvent(l){return l.targetTouches[0].identifier===this._firstTouch}startMove(l){this._firstTouch=l.targetTouches[0].identifier}endMove(l){delete this._firstTouch}isValidStartEvent(l){return this._isOneFingerTouch(l)}isValidMoveEvent(l){return this._isOneFingerTouch(l)&&this._isSameTouchEvent(l)}isValidEndEvent(l){return this._isOneFingerTouch(l)&&this._isSameTouchEvent(l)}}class $c{constructor(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:new bc({checkCorrectEvent:()=>!0}),m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new wf;this.mouseMoveStateManager=l,this.oneFingerTouchMoveStateManager=m}_executeRelevantHandler(l,m,w){return l instanceof MouseEvent?m(l):typeof TouchEvent<"u"&&l instanceof TouchEvent?w(l):void 0}startMove(l){this._executeRelevantHandler(l,m=>this.mouseMoveStateManager.startMove(m),m=>this.oneFingerTouchMoveStateManager.startMove(m))}endMove(l){this._executeRelevantHandler(l,m=>this.mouseMoveStateManager.endMove(m),m=>this.oneFingerTouchMoveStateManager.endMove(m))}isValidStartEvent(l){return this._executeRelevantHandler(l,m=>this.mouseMoveStateManager.isValidStartEvent(m),m=>this.oneFingerTouchMoveStateManager.isValidStartEvent(m))}isValidMoveEvent(l){return this._executeRelevantHandler(l,m=>this.mouseMoveStateManager.isValidMoveEvent(m),m=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(m))}isValidEndEvent(l){return this._executeRelevantHandler(l,m=>this.mouseMoveStateManager.isValidEndEvent(m),m=>this.oneFingerTouchMoveStateManager.isValidEndEvent(m))}}const Bl=D=>{D.mousedown=D.dragStart,D.mousemoveWindow=D.dragMove,D.mouseup=D.dragEnd,D.contextmenu=l=>{l.preventDefault()}};class Cl{constructor(l,m){this._clickTolerance=l.clickTolerance||1,this._map=m,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0)}_shouldBePrevented(l){return l<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(l,m,w){return this._calculateTransform(l,m,w)}touchmove(l,m,w){if(this._active){if(!this._shouldBePrevented(w.length))return l.preventDefault(),this._calculateTransform(l,m,w);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",l)}}touchend(l,m,w){this._calculateTransform(l,m,w),this._active&&this._shouldBePrevented(w.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(l,m,w){w.length>0&&(this._active=!0);const P=Qh(w,m),O=new o.P(0,0),G=new o.P(0,0);let J=0;for(const oe in P){const pe=P[oe],Ce=this._touches[oe];Ce&&(O._add(pe),G._add(pe.sub(Ce)),J++,P[oe]=pe)}if(this._touches=P,this._shouldBePrevented(J)||!G.mag())return;const re=G.div(J);return this._sum._add(re),this._sum.mag()<this._clickTolerance?void 0:{around:O.div(J),panDelta:re}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ci{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(l,m,w){this._firstTwoTouches||w.length<2||(this._firstTwoTouches=[w[0].identifier,w[1].identifier],this._start([m[0],m[1]]))}touchmove(l,m,w){if(!this._firstTwoTouches)return;l.preventDefault();const[P,O]=this._firstTwoTouches,G=vn(w,m,P),J=vn(w,m,O);if(!G||!J)return;const re=this._aroundCenter?null:G.add(J).div(2);return this._move([G,J],re,l)}touchend(l,m,w){if(!this._firstTwoTouches)return;const[P,O]=this._firstTwoTouches,G=vn(w,m,P),J=vn(w,m,O);G&&J||(this._active&&I.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(l){this._enabled=!0,this._aroundCenter=!!l&&l.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function vn(D,l,m){for(let w=0;w<D.length;w++)if(D[w].identifier===m)return l[w]}function Wn(D,l){return Math.log(D/l)/Math.LN2}class Eu extends ci{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(l){this._startDistance=this._distance=l[0].dist(l[1])}_move(l,m){const w=this._distance;if(this._distance=l[0].dist(l[1]),this._active||!(Math.abs(Wn(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Wn(this._distance,w),pinchAround:m}}}function z(D,l){return 180*D.angleWith(l)/Math.PI}class X extends ci{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(l){this._startVector=this._vector=l[0].sub(l[1]),this._minDiameter=l[0].dist(l[1])}_move(l,m,w){const P=this._vector;if(this._vector=l[0].sub(l[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:z(this._vector,P),pinchAround:m}}_isBelowThreshold(l){this._minDiameter=Math.min(this._minDiameter,l.mag());const m=25/(Math.PI*this._minDiameter)*360,w=z(l,this._startVector);return Math.abs(w)<m}}function E(D){return Math.abs(D.y)>Math.abs(D.x)}class c extends ci{constructor(l){super(),this._currentTouchCount=0,this._map=l}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(l,m,w){super.touchstart(l,m,w),this._currentTouchCount=w.length}_start(l){this._lastPoints=l,E(l[0].sub(l[1]))&&(this._valid=!1)}_move(l,m,w){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const P=l[0].sub(this._lastPoints[0]),O=l[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(P,O,w.timeStamp),this._valid?(this._lastPoints=l,this._active=!0,{pitchDelta:(P.y+O.y)/2*-.5}):void 0}gestureBeginsVertically(l,m,w){if(this._valid!==void 0)return this._valid;const P=l.mag()>=2,O=m.mag()>=2;if(!P&&!O)return;if(!P||!O)return this._firstMove===void 0&&(this._firstMove=w),w-this._firstMove<100&&void 0;const G=l.y>0==m.y>0;return E(l)&&E(m)&&G}}const y={panStep:100,bearingStep:15,pitchStep:10};class B{constructor(l){this._tr=new Bu(l);const m=y;this._panStep=m.panStep,this._bearingStep=m.bearingStep,this._pitchStep=m.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(l){if(l.altKey||l.ctrlKey||l.metaKey)return;let m=0,w=0,P=0,O=0,G=0;switch(l.keyCode){case 61:case 107:case 171:case 187:m=1;break;case 189:case 109:case 173:m=-1;break;case 37:l.shiftKey?w=-1:(l.preventDefault(),O=-1);break;case 39:l.shiftKey?w=1:(l.preventDefault(),O=1);break;case 38:l.shiftKey?P=1:(l.preventDefault(),G=-1);break;case 40:l.shiftKey?P=-1:(l.preventDefault(),G=1);break;default:return}return this._rotationDisabled&&(w=0,P=0),{cameraAnimation:J=>{const re=this._tr;J.easeTo({duration:300,easeId:"keyboardHandler",easing:S,zoom:m?Math.round(re.zoom)+m*(l.shiftKey?2:1):re.zoom,bearing:re.bearing+w*this._bearingStep,pitch:re.pitch+P*this._pitchStep,offset:[-O*this._panStep,-G*this._panStep],center:re.center},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function S(D){return D*(2-D)}const F=4.000244140625;class H{constructor(l,m){this._onTimeout=w=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(w)},this._map=l,this._tr=new Bu(l),this._triggerRenderFrame=m,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(l){this._defaultZoomRate=l}setWheelZoomRate(l){this._wheelZoomRate=l}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!l&&l.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(l){return!!this._map.cooperativeGestures.isEnabled()&&!(l.ctrlKey||this._map.cooperativeGestures.isBypassed(l))}wheel(l){if(!this.isEnabled())return;if(this._shouldBePrevented(l))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",l);let m=l.deltaMode===WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY;const w=T.now(),P=w-(this._lastWheelEventTime||0);this._lastWheelEventTime=w,m!==0&&m%F==0?this._type="wheel":m!==0&&Math.abs(m)<4?this._type="trackpad":P>400?(this._type=null,this._lastValue=m,this._timeout=setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(P*m)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,m+=this._lastValue)),l.shiftKey&&m&&(m/=4),this._type&&(this._lastWheelEvent=l,this._delta-=m,this._active||this._start(l)),l.preventDefault()}_start(l){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const m=I.mousePos(this._map.getCanvas(),l),w=this._tr;this._aroundPoint=this._aroundCenter?w.transform.locationToScreenPoint(o.N.convert(w.center)):m,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const l=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const J=l.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=J),typeof this._targetZoom=="number"&&(this._targetZoom+=J)}if(this._delta!==0){const J=this._type==="wheel"&&Math.abs(this._delta)>F?this._wheelZoomRate:this._defaultZoomRate;let re=2/(1+Math.exp(-Math.abs(this._delta*J)));this._delta<0&&re!==0&&(re=1/re);const oe=typeof this._targetZoom!="number"?l.scale:o.aG(this._targetZoom);this._targetZoom=Math.min(l.maxZoom,Math.max(l.minZoom,o.a8(oe*re))),this._type==="wheel"&&(this._startZoom=l.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const m=typeof this._targetZoom!="number"?l.zoom:this._targetZoom,w=this._startZoom,P=this._easing;let O,G=!1;if(this._type==="wheel"&&w&&P){const J=T.now()-this._lastWheelEventTime,re=Math.min((J+5)/200,1),oe=P(re);O=o.y.number(w,m,oe),re<1?this._frameId||(this._frameId=!0):G=!0}else O=m,G=!0;return this._active=!0,G&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout},200)),this._lastExpectedZoom=O,{noInertia:!0,needsRenderFrame:!G,zoomDelta:O-l.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(l){let m=o.c8;if(this._prevEase){const w=this._prevEase,P=(T.now()-w.start)/w.duration,O=w.easing(P+.01)-w.easing(P),G=.27/Math.sqrt(O*O+1e-4)*.01,J=Math.sqrt(.0729-G*G);m=o.c6(G,J,.25,1)}return this._prevEase={start:T.now(),duration:l,easing:m},m}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class j{constructor(l,m){this._clickZoom=l,this._tapZoom=m}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Z{constructor(l){this._tr=new Bu(l),this.reset()}reset(){this._active=!1}dblclick(l,m){return l.preventDefault(),{cameraAnimation:w=>{w.easeTo({duration:300,zoom:this._tr.zoom+(l.shiftKey?-1:1),around:this._tr.unproject(m)},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class se{constructor(){this._tap=new _o({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(l,m,w){if(!this._swipePoint)if(this._tapTime){const P=m[0],O=l.timeStamp-this._tapTime<500,G=this._tapPoint.dist(P)<30;O&&G?w.length>0&&(this._swipePoint=P,this._swipeTouch=w[0].identifier):this.reset()}else this._tap.touchstart(l,m,w)}touchmove(l,m,w){if(this._tapTime){if(this._swipePoint){if(w[0].identifier!==this._swipeTouch)return;const P=m[0],O=P.y-this._swipePoint.y;return this._swipePoint=P,l.preventDefault(),this._active=!0,{zoomDelta:O/128}}}else this._tap.touchmove(l,m,w)}touchend(l,m,w){if(this._tapTime)this._swipePoint&&w.length===0&&this.reset();else{const P=this._tap.touchend(l,m,w);P&&(this._tapTime=l.timeStamp,this._tapPoint=P)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class he{constructor(l,m,w){this._el=l,this._mousePan=m,this._touchPan=w}enable(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ue{constructor(l,m,w,P){this._pitchWithRotate=l.pitchWithRotate,this._rollEnabled=l.rollEnabled,this._mouseRotate=m,this._mousePitch=w,this._mouseRoll=P}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class Te{constructor(l,m,w,P){this._el=l,this._touchZoom=m,this._touchRotate=w,this._tapDragZoom=P,this._rotationDisabled=!1,this._enabled=!0}enable(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Fe{constructor(l,m){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=l,this._options=m,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const l=this._map.getCanvasContainer();l.classList.add("maplibregl-cooperative-gestures"),this._container=I.create("div","maplibregl-cooperative-gesture-screen",l);let m=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(m=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const w=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),P=document.createElement("div");P.className="maplibregl-desktop-message",P.textContent=m,this._container.appendChild(P);const O=document.createElement("div");O.className="maplibregl-mobile-message",O.textContent=w,this._container.appendChild(O),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(I.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(l){return l[this._bypassKey]}notifyGestureBlocked(l,m){this._enabled&&(this._map.fire(new o.k("cooperativegestureprevented",{gestureType:l,originalEvent:m})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const Ee=D=>D.zoom||D.drag||D.roll||D.pitch||D.rotate;class Oe extends o.k{}function rt(D){return D.panDelta&&D.panDelta.mag()||D.zoomDelta||D.bearingDelta||D.pitchDelta||D.rollDelta}class qe{constructor(l,m){this.handleWindowEvent=P=>{this.handleEvent(P,`${P.type}Window`)},this.handleEvent=(P,O)=>{if(P.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const G=P.type==="renderFrame"?void 0:P,J={needsRenderFrame:!1},re={},oe={},pe=P.touches,Ce=pe?this._getMapTouches(pe):void 0,Me=Ce?I.touchPos(this._map.getCanvas(),Ce):I.mousePos(this._map.getCanvas(),P);for(const{handlerName:gt,handler:ft,allowed:mt}of this._handlers){if(!ft.isEnabled())continue;let xt;this._blockedByActive(oe,mt,gt)?ft.reset():ft[O||P.type]&&(xt=ft[O||P.type](P,Me,Ce),this.mergeHandlerResult(J,re,xt,gt,G),xt&&xt.needsRenderFrame&&this._triggerRenderFrame()),(xt||ft.isActive())&&(oe[gt]=ft)}const Ke={};for(const gt in this._previousActiveHandlers)oe[gt]||(Ke[gt]=G);this._previousActiveHandlers=oe,(Object.keys(Ke).length||rt(J))&&(this._changes.push([J,re,Ke]),this._triggerRenderFrame()),(Object.keys(oe).length||rt(J))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:Ye}=J;Ye&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Ye(this._map))},this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Gu(l),this._bearingSnap=m.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(m);const w=this._el;this._listeners=[[w,"touchstart",{passive:!0}],[w,"touchmove",{passive:!1}],[w,"touchend",void 0],[w,"touchcancel",void 0],[w,"mousedown",void 0],[w,"mousemove",void 0],[w,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[w,"mouseover",void 0],[w,"mouseout",void 0],[w,"dblclick",void 0],[w,"click",void 0],[w,"keydown",{capture:!1}],[w,"keyup",void 0],[w,"wheel",{passive:!1}],[w,"contextmenu",void 0],[window,"blur",void 0]];for(const[P,O,G]of this._listeners)I.addEventListener(P,O,P===document?this.handleWindowEvent:this.handleEvent,G)}destroy(){for(const[l,m,w]of this._listeners)I.removeEventListener(l,m,l===document?this.handleWindowEvent:this.handleEvent,w)}_addDefaultHandlers(l){const m=this._map,w=m.getCanvasContainer();this._add("mapEvent",new wu(m,l));const P=m.boxZoom=new Cu(m,l);this._add("boxZoom",P),l.interactive&&l.boxZoom&&P.enable();const O=m.cooperativeGestures=new Fe(m,l.cooperativeGestures);this._add("cooperativeGestures",O),l.cooperativeGestures&&O.enable();const G=new Fi(m),J=new Z(m);m.doubleClickZoom=new j(J,G),this._add("tapZoom",G),this._add("clickZoom",J),l.interactive&&l.doubleClickZoom&&m.doubleClickZoom.enable();const re=new se;this._add("tapDragZoom",re);const oe=m.touchPitch=new c(m);this._add("touchPitch",oe),l.interactive&&l.touchPitch&&m.touchPitch.enable(l.touchPitch);const pe=()=>m.project(m.getCenter()),Ce=function(Dt,Ut){let{enable:Gt,clickTolerance:zt,aroundCenter:ir=!0,minPixelCenterThreshold:sr=100,rotateDegreesPerPixelMoved:gr=.8}=Dt;const Er=new bc({checkCorrectEvent:fr=>I.mouseButton(fr)===0&&fr.ctrlKey||I.mouseButton(fr)===2&&!fr.ctrlKey});return new un({clickTolerance:zt,move:(fr,qr)=>{const Jr=Ut();if(ir&&Math.abs(Jr.y-fr.y)>sr)return{bearingDelta:o.c7(new o.P(fr.x,qr.y),qr,Jr)};let Sr=(qr.x-fr.x)*gr;return ir&&qr.y<Jr.y&&(Sr=-Sr),{bearingDelta:Sr}},moveStateManager:Er,enable:Gt,assignEvents:Bl})}(l,pe),Me=function(Dt){let{enable:Ut,clickTolerance:Gt,pitchDegreesPerPixelMoved:zt=-.5}=Dt;const ir=new bc({checkCorrectEvent:sr=>I.mouseButton(sr)===0&&sr.ctrlKey||I.mouseButton(sr)===2});return new un({clickTolerance:Gt,move:(sr,gr)=>({pitchDelta:(gr.y-sr.y)*zt}),moveStateManager:ir,enable:Ut,assignEvents:Bl})}(l),Ke=function(Dt,Ut){let{enable:Gt,clickTolerance:zt,rollDegreesPerPixelMoved:ir=.3}=Dt;const sr=new bc({checkCorrectEvent:gr=>I.mouseButton(gr)===2&&gr.ctrlKey});return new un({clickTolerance:zt,move:(gr,Er)=>{const fr=Ut();let qr=(Er.x-gr.x)*ir;return Er.y<fr.y&&(qr=-qr),{rollDelta:qr}},moveStateManager:sr,enable:Gt,assignEvents:Bl})}(l,pe);m.dragRotate=new ue(l,Ce,Me,Ke),this._add("mouseRotate",Ce,["mousePitch"]),this._add("mousePitch",Me,["mouseRotate","mouseRoll"]),this._add("mouseRoll",Ke,["mousePitch"]),l.interactive&&l.dragRotate&&m.dragRotate.enable();const Ye=function(Dt){let{enable:Ut,clickTolerance:Gt}=Dt;const zt=new bc({checkCorrectEvent:ir=>I.mouseButton(ir)===0&&!ir.ctrlKey});return new un({clickTolerance:Gt,move:(ir,sr)=>({around:sr,panDelta:sr.sub(ir)}),activateOnStart:!0,moveStateManager:zt,enable:Ut,assignEvents:Bl})}(l),gt=new Cl(l,m);m.dragPan=new he(w,Ye,gt),this._add("mousePan",Ye),this._add("touchPan",gt,["touchZoom","touchRotate"]),l.interactive&&l.dragPan&&m.dragPan.enable(l.dragPan);const ft=new X,mt=new Eu;m.touchZoomRotate=new Te(w,mt,ft,re),this._add("touchRotate",ft,["touchPan","touchZoom"]),this._add("touchZoom",mt,["touchPan","touchRotate"]),l.interactive&&l.touchZoomRotate&&m.touchZoomRotate.enable(l.touchZoomRotate);const xt=m.scrollZoom=new H(m,()=>this._triggerRenderFrame());this._add("scrollZoom",xt,["mousePan"]),l.interactive&&l.scrollZoom&&m.scrollZoom.enable(l.scrollZoom);const Ft=m.keyboard=new B(m);this._add("keyboard",Ft),l.interactive&&l.keyboard&&m.keyboard.enable(),this._add("blockableMapEvent",new Gh(m))}_add(l,m,w){this._handlers.push({handlerName:l,handler:m,allowed:w}),this._handlersById[l]=m}stop(l){if(!this._updatingCamera){for(const{handler:m}of this._handlers)m.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[]}}isActive(){for(const{handler:l}of this._handlers)if(l.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ee(this._eventsInProgress)||this.isZooming()}_blockedByActive(l,m,w){for(const P in l)if(P!==w&&(!m||m.indexOf(P)<0))return!0;return!1}_getMapTouches(l){const m=[];for(const w of l)this._el.contains(w.target)&&m.push(w);return m}mergeHandlerResult(l,m,w,P,O){if(!w)return;o.e(l,w);const G={handlerName:P,originalEvent:w.originalEvent||O};w.zoomDelta!==void 0&&(m.zoom=G),w.panDelta!==void 0&&(m.drag=G),w.rollDelta!==void 0&&(m.roll=G),w.pitchDelta!==void 0&&(m.pitch=G),w.bearingDelta!==void 0&&(m.rotate=G)}_applyChanges(){const l={},m={},w={};for(const[P,O,G]of this._changes)P.panDelta&&(l.panDelta=(l.panDelta||new o.P(0,0))._add(P.panDelta)),P.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+P.zoomDelta),P.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+P.bearingDelta),P.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+P.pitchDelta),P.rollDelta&&(l.rollDelta=(l.rollDelta||0)+P.rollDelta),P.around!==void 0&&(l.around=P.around),P.pinchAround!==void 0&&(l.pinchAround=P.pinchAround),P.noInertia&&(l.noInertia=P.noInertia),o.e(m,O),o.e(w,G);this._updateMapTransform(l,m,w),this._changes=[]}_updateMapTransform(l,m,w){const P=this._map,O=P._getTransformForUpdate(),G=P.terrain;if(!(rt(l)||G&&this._terrainMovement))return this._fireEvents(m,w,!0);P._stop(!0);let{panDelta:J,zoomDelta:re,bearingDelta:oe,pitchDelta:pe,rollDelta:Ce,around:Me,pinchAround:Ke}=l;Ke!==void 0&&(Me=Ke),Me=Me||P.transform.centerPoint,G&&!O.isPointOnMapSurface(Me)&&(Me=O.centerPoint);const Ye={panDelta:J,zoomDelta:re,rollDelta:Ce,pitchDelta:pe,bearingDelta:oe,around:Me};this._map.cameraHelper.useGlobeControls&&!O.isPointOnMapSurface(Me)&&(Me=O.centerPoint);const gt=Me.distSqr(O.centerPoint)<.01?O.center:O.screenPointToLocation(J?Me.sub(J):Me);G?(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(Ye,O),this._terrainMovement||!m.drag&&!m.zoom?m.drag&&this._terrainMovement?O.setCenter(O.screenPointToLocation(O.centerPoint.sub(J))):this._map.cameraHelper.handleMapControlsPan(Ye,O,gt):(this._terrainMovement=!0,this._map._elevationFreeze=!0,this._map.cameraHelper.handleMapControlsPan(Ye,O,gt))):(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(Ye,O),this._map.cameraHelper.handleMapControlsPan(Ye,O,gt)),P._applyUpdatedTransform(O),this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(m,w,!0)}_fireEvents(l,m,w){const P=Ee(this._eventsInProgress),O=Ee(l),G={};for(const Ce in l){const{originalEvent:Me}=l[Ce];this._eventsInProgress[Ce]||(G[`${Ce}start`]=Me),this._eventsInProgress[Ce]=l[Ce]}!P&&O&&this._fireEvent("movestart",O.originalEvent);for(const Ce in G)this._fireEvent(Ce,G[Ce]);O&&this._fireEvent("move",O.originalEvent);for(const Ce in l){const{originalEvent:Me}=l[Ce];this._fireEvent(Ce,Me)}const J={};let re;for(const Ce in this._eventsInProgress){const{handlerName:Me,originalEvent:Ke}=this._eventsInProgress[Ce];this._handlersById[Me].isActive()||(delete this._eventsInProgress[Ce],re=m[Me]||Ke,J[`${Ce}end`]=re)}for(const Ce in J)this._fireEvent(Ce,J[Ce]);const oe=Ee(this._eventsInProgress),pe=(P||O)&&!oe;if(pe&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const Ce=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&Ce.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(Ce)}if(w&&pe){this._updatingCamera=!0;const Ce=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Me=Ke=>Ke!==0&&-this._bearingSnap<Ke&&Ke<this._bearingSnap;!Ce||!Ce.essential&&T.prefersReducedMotion?(this._map.fire(new o.k("moveend",{originalEvent:re})),Me(this._map.getBearing())&&this._map.resetNorth()):(Me(Ce.bearing||this._map.getBearing())&&(Ce.bearing=0),Ce.freezeElevation=!0,this._map.easeTo(Ce,{originalEvent:re})),this._updatingCamera=!1}}_fireEvent(l,m){this._map.fire(new o.k(l,m?{originalEvent:m}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(l=>{delete this._frameId,this.handleEvent(new Oe("renderFrame",{timeStamp:l})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Ze extends o.E{constructor(l,m,w){super(),this._renderFrameCallback=()=>{const P=Math.min((T.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(P)),P<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=l,this._bearingSnap=w.bearingSnap,this.cameraHelper=m,this.on("moveend",()=>{delete this._requestedCameraState})}migrateProjection(l,m){l.apply(this.transform),this.transform=l,this.cameraHelper=m}getCenter(){return new o.N(this.transform.center.lng,this.transform.center.lat)}setCenter(l,m){return this.jumpTo({center:l},m)}getCenterElevation(){return this.transform.elevation}setCenterElevation(l,m){return this.jumpTo({elevation:l},m),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(l){this._centerClampedToGround=l}panBy(l,m,w){return l=o.P.convert(l).mult(-1),this.panTo(this.transform.center,o.e({offset:l},m),w)}panTo(l,m,w){return this.easeTo(o.e({center:l},m),w)}getZoom(){return this.transform.zoom}setZoom(l,m){return this.jumpTo({zoom:l},m),this}zoomTo(l,m,w){return this.easeTo(o.e({zoom:l},m),w)}zoomIn(l,m){return this.zoomTo(this.getZoom()+1,l,m),this}zoomOut(l,m){return this.zoomTo(this.getZoom()-1,l,m),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(l,m){return l!=this.transform.fov&&(this.transform.setFov(l),this.fire(new o.k("movestart",m)).fire(new o.k("move",m)).fire(new o.k("moveend",m))),this}getBearing(){return this.transform.bearing}setBearing(l,m){return this.jumpTo({bearing:l},m),this}getPadding(){return this.transform.padding}setPadding(l,m){return this.jumpTo({padding:l},m),this}rotateTo(l,m,w){return this.easeTo(o.e({bearing:l},m),w)}resetNorth(l,m){return this.rotateTo(0,o.e({duration:1e3},l),m),this}resetNorthPitch(l,m){return this.easeTo(o.e({bearing:0,pitch:0,roll:0,duration:1e3},l),m),this}snapToNorth(l,m){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(l,m):this}getPitch(){return this.transform.pitch}setPitch(l,m){return this.jumpTo({pitch:l},m),this}getRoll(){return this.transform.roll}setRoll(l,m){return this.jumpTo({roll:l},m),this}cameraForBounds(l,m){l=on.convert(l).adjustAntiMeridian();const w=m&&m.bearing||0;return this._cameraForBoxAndBearing(l.getNorthWest(),l.getSouthEast(),w,m)}_cameraForBoxAndBearing(l,m,w,P){const O={top:0,bottom:0,right:0,left:0};if(typeof(P=o.e({padding:O,offset:[0,0],maxZoom:this.transform.maxZoom},P)).padding=="number"){const oe=P.padding;P.padding={top:oe,bottom:oe,right:oe,left:oe}}const G=o.e(O,P.padding);P.padding=G;const J=this.transform,re=new on(l,m);return this.cameraHelper.cameraForBoxAndBearing(P,G,re,w,J)}fitBounds(l,m,w){return this._fitInternal(this.cameraForBounds(l,m),m,w)}fitScreenCoordinates(l,m,w,P,O){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(o.P.convert(l)),this.transform.screenPointToLocation(o.P.convert(m)),w,P),P,O)}_fitInternal(l,m,w){return l?(delete(m=o.e(l,m)).padding,m.linear?this.easeTo(m,w):this.flyTo(m,w)):this}jumpTo(l,m){this.stop();const w=this._getTransformForUpdate();let P=!1,O=!1,G=!1;const J=w.zoom;this.cameraHelper.handleJumpToCenterZoom(w,l);const re=w.zoom!==J;return"elevation"in l&&w.elevation!==+l.elevation&&w.setElevation(+l.elevation),"bearing"in l&&w.bearing!==+l.bearing&&(P=!0,w.setBearing(+l.bearing)),"pitch"in l&&w.pitch!==+l.pitch&&(O=!0,w.setPitch(+l.pitch)),"roll"in l&&w.roll!==+l.roll&&(G=!0,w.setRoll(+l.roll)),l.padding==null||w.isPaddingEqual(l.padding)||w.setPadding(l.padding),this._applyUpdatedTransform(w),this.fire(new o.k("movestart",m)).fire(new o.k("move",m)),re&&this.fire(new o.k("zoomstart",m)).fire(new o.k("zoom",m)).fire(new o.k("zoomend",m)),P&&this.fire(new o.k("rotatestart",m)).fire(new o.k("rotate",m)).fire(new o.k("rotateend",m)),O&&this.fire(new o.k("pitchstart",m)).fire(new o.k("pitch",m)).fire(new o.k("pitchend",m)),G&&this.fire(new o.k("rollstart",m)).fire(new o.k("roll",m)).fire(new o.k("rollend",m)),this.fire(new o.k("moveend",m))}calculateCameraOptionsFromTo(l,m,w){let P=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;const O=o.Y.fromLngLat(l,m),G=o.Y.fromLngLat(w,P),J=G.x-O.x,re=G.y-O.y,oe=G.z-O.z,pe=Math.hypot(J,re,oe);if(pe===0)throw new Error("Can't calculate camera options with same From and To");const Ce=Math.hypot(J,re),Me=o.a8(this.transform.cameraToCenterDistance/pe/this.transform.tileSize),Ke=180*Math.atan2(J,-re)/Math.PI;let Ye=180*Math.acos(Ce/pe)/Math.PI;return Ye=oe<0?90-Ye:90+Ye,{center:G.toLngLat(),elevation:P,zoom:Me,pitch:Ye,bearing:Ke}}calculateCameraOptionsFromCameraLngLatAltRotation(l,m,w,P,O){const G=this.transform.calculateCenterFromCameraLngLatAlt(l,m,w,P);return{center:G.center,elevation:G.elevation,zoom:G.zoom,bearing:w,pitch:P,roll:O}}easeTo(l,m){this._stop(!1,l.easeId),((l=o.e({offset:[0,0],duration:500,easing:o.c8},l)).animate===!1||!l.essential&&T.prefersReducedMotion)&&(l.duration=0);const w=this._getTransformForUpdate(),P=this.getBearing(),O=w.pitch,G=w.roll,J="bearing"in l?this._normalizeBearing(l.bearing,P):P,re="pitch"in l?+l.pitch:O,oe="roll"in l?this._normalizeBearing(l.roll,G):G,pe="padding"in l?l.padding:w.padding,Ce=o.P.convert(l.offset);let Me,Ke;l.around&&(Me=o.N.convert(l.around),Ke=w.locationToScreenPoint(Me));const Ye={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},gt=this.cameraHelper.handleEaseTo(w,{bearing:J,pitch:re,roll:oe,padding:pe,around:Me,aroundPoint:Ke,offsetAsPoint:Ce,offset:l.offset,zoom:l.zoom,center:l.center});return this._rotating=this._rotating||P!==J,this._pitching=this._pitching||re!==O,this._rolling=this._rolling||oe!==G,this._padding=!w.isPaddingEqual(pe),this._zooming=this._zooming||gt.isZooming,this._easeId=l.easeId,this._prepareEase(m,l.noMoveStart,Ye),this.terrain&&this._prepareElevation(gt.elevationCenter),this._ease(ft=>{gt.easeFunc(ft),this.terrain&&!l.freezeElevation&&this._updateElevation(ft),this._applyUpdatedTransform(w),this._fireMoveEvents(m)},ft=>{this.terrain&&l.freezeElevation&&this._finalizeElevation(),this._afterEase(m,ft)},l),this}_prepareEase(l,m){let w=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this._moving=!0,m||w.moving||this.fire(new o.k("movestart",l)),this._zooming&&!w.zooming&&this.fire(new o.k("zoomstart",l)),this._rotating&&!w.rotating&&this.fire(new o.k("rotatestart",l)),this._pitching&&!w.pitching&&this.fire(new o.k("pitchstart",l)),this._rolling&&!w.rolling&&this.fire(new o.k("rollstart",l))}_prepareElevation(l){this._elevationCenter=l,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(l,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(l){this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const m=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(l<1&&m!==this._elevationTarget){const w=this._elevationTarget-this._elevationStart;this._elevationStart+=l*(w-(m-(w*l+this._elevationStart))/(1-l)),this._elevationTarget=m}this.transform.setElevation(o.y.number(this._elevationStart,this._elevationTarget,l))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(l){if(!this.terrain&&l.elevation>=0&&l.pitch<=90)return{};const m=l.getCameraLngLat(),w=l.getCameraAltitude(),P=this.terrain?this.terrain.getElevationForLngLatZoom(m,l.zoom):0;if(w<P){const O=this.calculateCameraOptionsFromTo(m,P,l.center,l.elevation);return{pitch:O.pitch,zoom:O.zoom}}return{}}_applyUpdatedTransform(l){const m=[];if(m.push(P=>this._elevateCameraIfInsideTerrain(P)),this.transformCameraUpdate&&m.push(P=>this.transformCameraUpdate(P)),!m.length)return;const w=l.clone();for(const P of m){const O=w.clone(),{center:G,zoom:J,roll:re,pitch:oe,bearing:pe,elevation:Ce}=P(O);G&&O.setCenter(G),Ce!==void 0&&O.setElevation(Ce),J!==void 0&&O.setZoom(J),re!==void 0&&O.setRoll(re),oe!==void 0&&O.setPitch(oe),pe!==void 0&&O.setBearing(pe),w.apply(O)}this.transform.apply(w)}_fireMoveEvents(l){this.fire(new o.k("move",l)),this._zooming&&this.fire(new o.k("zoom",l)),this._rotating&&this.fire(new o.k("rotate",l)),this._pitching&&this.fire(new o.k("pitch",l)),this._rolling&&this.fire(new o.k("roll",l))}_afterEase(l,m){if(this._easeId&&m&&this._easeId===m)return;delete this._easeId;const w=this._zooming,P=this._rotating,O=this._pitching,G=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,w&&this.fire(new o.k("zoomend",l)),P&&this.fire(new o.k("rotateend",l)),O&&this.fire(new o.k("pitchend",l)),G&&this.fire(new o.k("rollend",l)),this.fire(new o.k("moveend",l))}flyTo(l,m){if(!l.essential&&T.prefersReducedMotion){const fr=o.M(l,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(fr,m)}this.stop(),l=o.e({offset:[0,0],speed:1.2,curve:1.42,easing:o.c8},l);const w=this._getTransformForUpdate(),P=w.bearing,O=w.pitch,G=w.roll,J=w.padding,re="bearing"in l?this._normalizeBearing(l.bearing,P):P,oe="pitch"in l?+l.pitch:O,pe="roll"in l?this._normalizeBearing(l.roll,G):G,Ce="padding"in l?l.padding:w.padding,Me=o.P.convert(l.offset);let Ke=w.centerPoint.add(Me);const Ye=w.screenPointToLocation(Ke),gt=this.cameraHelper.handleFlyTo(w,{bearing:re,pitch:oe,roll:pe,padding:Ce,locationAtOffset:Ye,offsetAsPoint:Me,center:l.center,minZoom:l.minZoom,zoom:l.zoom});let ft=l.curve;const mt=Math.max(w.width,w.height),xt=mt/gt.scaleOfZoom,Ft=gt.pixelPathLength;typeof gt.scaleOfMinZoom=="number"&&(ft=Math.sqrt(mt/gt.scaleOfMinZoom/Ft*2));const Dt=ft*ft;function Ut(fr){const qr=(xt*xt-mt*mt+(fr?-1:1)*Dt*Dt*Ft*Ft)/(2*(fr?xt:mt)*Dt*Ft);return Math.log(Math.sqrt(qr*qr+1)-qr)}function Gt(fr){return(Math.exp(fr)-Math.exp(-fr))/2}function zt(fr){return(Math.exp(fr)+Math.exp(-fr))/2}const ir=Ut(!1);let sr=function(fr){return zt(ir)/zt(ir+ft*fr)},gr=function(fr){return mt*((zt(ir)*(Gt(qr=ir+ft*fr)/zt(qr))-Gt(ir))/Dt)/Ft;var qr},Er=(Ut(!0)-ir)/ft;if(Math.abs(Ft)<2e-6||!isFinite(Er)){if(Math.abs(mt-xt)<1e-6)return this.easeTo(l,m);const fr=xt<mt?-1:1;Er=Math.abs(Math.log(xt/mt))/ft,gr=()=>0,sr=qr=>Math.exp(fr*ft*qr)}return l.duration="duration"in l?+l.duration:1e3*Er/("screenSpeed"in l?+l.screenSpeed/ft:+l.speed),l.maxDuration&&l.duration>l.maxDuration&&(l.duration=0),this._zooming=!0,this._rotating=P!==re,this._pitching=oe!==O,this._rolling=pe!==G,this._padding=!w.isPaddingEqual(Ce),this._prepareEase(m,!1),this.terrain&&this._prepareElevation(gt.targetCenter),this._ease(fr=>{const qr=fr*Er,Jr=1/sr(qr),Sr=gr(qr);this._rotating&&w.setBearing(o.y.number(P,re,fr)),this._pitching&&w.setPitch(o.y.number(O,oe,fr)),this._rolling&&w.setRoll(o.y.number(G,pe,fr)),this._padding&&(w.interpolatePadding(J,Ce,fr),Ke=w.centerPoint.add(Me)),gt.easeFunc(fr,Jr,Sr,Ke),this.terrain&&!l.freezeElevation&&this._updateElevation(fr),this._applyUpdatedTransform(w),this._fireMoveEvents(m)},()=>{this.terrain&&l.freezeElevation&&this._finalizeElevation(),this._afterEase(m)},l),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(l,m){var w;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const P=this._onEaseEnd;delete this._onEaseEnd,P.call(this,m)}return l||(w=this.handlers)===null||w===void 0||w.stop(!1),this}_ease(l,m,w){w.animate===!1||w.duration===0?(l(1),m()):(this._easeStart=T.now(),this._easeOptions=w,this._onEaseFrame=l,this._onEaseEnd=m,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(l,m){l=o.aI(l,-180,180);const w=Math.abs(l-m);return Math.abs(l-360-m)<w&&(l-=360),Math.abs(l+360-m)<w&&(l+=360),l}queryTerrainElevation(l){return this.terrain?this.terrain.getElevationForLngLatZoom(o.N.convert(l),this.transform.tileZoom):null}}const ot={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class vt{constructor(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:ot;this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=m=>{!m||m.sourceDataType!=="metadata"&&m.sourceDataType!=="visibility"&&m.dataType!=="style"&&m.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=l}getDefaultPosition(){return"bottom-right"}onAdd(l){return this._map=l,this._compact=this.options.compact,this._container=I.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=I.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=I.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){I.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._sanitizedAttributionHTML=void 0}_setElementTitle(l,m){const w=this._map._getUIString(`AttributionControl.${m}`);l.title=w,l.setAttribute("aria-label",w)}_updateAttributions(){if(!this._map.style)return;let l=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=l.concat(this.options.customAttribution.map(P=>typeof P!="string"?"":P)):typeof this.options.customAttribution=="string"&&l.push(this.options.customAttribution)),this._map.style.stylesheet){const P=this._map.style.stylesheet;this.styleOwner=P.owner,this.styleId=P.id}const m=this._map.style.sourceCaches;for(const P in m){const O=m[P];if(O.used||O.usedForTerrain){const G=O.getSource();G.attribution&&l.indexOf(G.attribution)<0&&l.push(G.attribution)}}l=l.filter(P=>String(P).trim()),l.sort((P,O)=>P.length-O.length),l=l.filter((P,O)=>{for(let G=O+1;G<l.length;G++)if(l[G].indexOf(P)>=0)return!1;return!0});const w=l.join(" | ");w!==this._sanitizedAttributionHTML&&(this._sanitizedAttributionHTML=I.sanitize(w),l.length?(this._innerContainer.innerHTML=this._sanitizedAttributionHTML,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class kt{constructor(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._updateCompact=()=>{const m=this._container.children;if(m.length){const w=m[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&w.classList.add("maplibregl-compact"):w.classList.remove("maplibregl-compact")}},this.options=l}getDefaultPosition(){return"bottom-left"}onAdd(l){this._map=l,this._compact=this.options&&this.options.compact,this._container=I.create("div","maplibregl-ctrl");const m=I.create("a","maplibregl-ctrl-logo");return m.target="_blank",m.rel="noopener nofollow",m.href="https://maplibre.org/",m.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),m.setAttribute("rel","noopener nofollow"),this._container.appendChild(m),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){I.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class It{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(l){const m=++this._id;return this._queue.push({callback:l,id:m,cancelled:!1}),m}remove(l){const m=this._currentlyRunning,w=m?this._queue.concat(m):this._queue;for(const P of w)if(P.id===l)return void(P.cancelled=!0)}run(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const m=this._currentlyRunning=this._queue;this._queue=[];for(const w of m)if(!w.cancelled&&(w.callback(l),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var ur=o.aA([{name:"a_pos3d",type:"Int16",components:3}]);class wr extends o.E{constructor(l){super(),this._lastTilesetChange=T.now(),this.sourceCache=l,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=l._source.tileSize*2**this.deltaZoom,l.usedForTerrain=!0,l.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(l,m){this.sourceCache.update(l,m),this._renderableTilesKeys=[];const w={};for(const P of Xe(l,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:m,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))w[P.key]=!0,this._renderableTilesKeys.push(P.key),this._tiles[P.key]||(P.terrainRttPosMatrix32f=new Float64Array(16),o.bL(P.terrainRttPosMatrix32f,0,o.X,o.X,0,0,1),this._tiles[P.key]=new Cn(P,this.tileSize),this._lastTilesetChange=T.now());for(const P in this._tiles)w[P]||delete this._tiles[P]}freeRtt(l){for(const m in this._tiles){const w=this._tiles[m];(!l||w.tileID.equals(l)||w.tileID.isChildOf(l)||l.isChildOf(w.tileID))&&(w.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(l=>this.getTileByID(l))}getTileByID(l){return this._tiles[l]}getTerrainCoords(l){const m={};for(const w of this._renderableTilesKeys){const P=this._tiles[w].tileID,O=l.clone(),G=o.a$();if(P.canonical.equals(l.canonical))o.bL(G,0,o.X,o.X,0,0,1);else if(P.canonical.isChildOf(l.canonical)){const J=P.canonical.z-l.canonical.z,re=P.canonical.x-(P.canonical.x>>J<<J),oe=P.canonical.y-(P.canonical.y>>J<<J),pe=o.X>>J;o.bL(G,0,pe,pe,0,0,1),o.J(G,G,[-re*pe,-oe*pe,0])}else{if(!l.canonical.isChildOf(P.canonical))continue;{const J=l.canonical.z-P.canonical.z,re=l.canonical.x-(l.canonical.x>>J<<J),oe=l.canonical.y-(l.canonical.y>>J<<J),pe=o.X>>J;o.bL(G,0,o.X,o.X,0,0,1),o.J(G,G,[re*pe,oe*pe,0]),o.K(G,G,[1/2**J,1/2**J,0])}}O.terrainRttPosMatrix32f=new Float32Array(G),m[w]=O}return m}getSourceTile(l,m){const w=this.sourceCache._source;let P=l.overscaledZ-this.deltaZoom;if(P>w.maxzoom&&(P=w.maxzoom),P<w.minzoom)return null;this._sourceTileCache[l.key]||(this._sourceTileCache[l.key]=l.scaledTo(P).key);let O=this.sourceCache.getTileByID(this._sourceTileCache[l.key]);if((!O||!O.dem)&&m)for(;P>=w.minzoom&&(!O||!O.dem);)O=this.sourceCache.getTileByID(l.scaledTo(P--).key);return O}anyTilesAfterTime(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Date.now();return this._lastTilesetChange>=l}}class Dr{constructor(l,m,w){this._meshCache={},this.painter=l,this.sourceCache=new wr(m),this.options=w,this.exaggeration=typeof w.exaggeration=="number"?w.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(l,m,w){let P=arguments.length>3&&arguments[3]!==void 0?arguments[3]:o.X;var O;if(!(m>=0&&m<P&&w>=0&&w<P))return 0;const G=this.getTerrainData(l),J=(O=G.tile)===null||O===void 0?void 0:O.dem;if(!J)return 0;const re=o.c9([],[m/P*o.X,w/P*o.X],G.u_terrain_matrix),oe=[re[0]*J.dim,re[1]*J.dim],pe=Math.floor(oe[0]),Ce=Math.floor(oe[1]),Me=oe[0]-pe,Ke=oe[1]-Ce;return J.get(pe,Ce)*(1-Me)*(1-Ke)+J.get(pe+1,Ce)*Me*(1-Ke)+J.get(pe,Ce+1)*(1-Me)*Ke+J.get(pe+1,Ce+1)*Me*Ke}getElevationForLngLatZoom(l,m){if(!o.ca(m,l.wrap()))return 0;const{tileID:w,mercatorX:P,mercatorY:O}=this._getOverscaledTileIDFromLngLatZoom(l,m);return this.getElevation(w,P%o.X,O%o.X,o.X)}getElevation(l,m,w){let P=arguments.length>3&&arguments[3]!==void 0?arguments[3]:o.X;return this.getDEMElevation(l,m,w,P)*this.exaggeration}getTerrainData(l){if(!this._emptyDemTexture){const P=this.painter.context,O=new o.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Ue(P,O,P.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Ue(P,new o.R({width:1,height:1}),P.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(P.gl.NEAREST,P.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=o.aq([])}const m=this.sourceCache.getSourceTile(l,!0);if(m&&m.dem&&(!m.demTexture||m.needsTerrainPrepare)){const P=this.painter.context;m.demTexture=this.painter.getTileTexture(m.dem.stride),m.demTexture?m.demTexture.update(m.dem.getPixels(),{premultiply:!1}):m.demTexture=new Ue(P,m.dem.getPixels(),P.gl.RGBA,{premultiply:!1}),m.demTexture.bind(P.gl.NEAREST,P.gl.CLAMP_TO_EDGE),m.needsTerrainPrepare=!1}const w=m&&m+m.tileID.key+l.key;if(w&&!this._demMatrixCache[w]){const P=this.sourceCache.sourceCache._source.maxzoom;let O=l.canonical.z-m.tileID.canonical.z;l.overscaledZ>l.canonical.z&&(l.canonical.z>=P?O=l.canonical.z-P:o.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const G=l.canonical.x-(l.canonical.x>>O<<O),J=l.canonical.y-(l.canonical.y>>O<<O),re=o.cb(new Float64Array(16),[1/(o.X<<O),1/(o.X<<O),0]);o.J(re,re,[G*o.X,J*o.X,0]),this._demMatrixCache[l.key]={matrix:re,coord:l}}return{u_depth:2,u_terrain:3,u_terrain_dim:m&&m.dem&&m.dem.dim||1,u_terrain_matrix:w?this._demMatrixCache[l.key].matrix:this._emptyDemMatrix,u_terrain_unpack:m&&m.dem&&m.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(m&&m.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:m}}getFramebuffer(l){const m=this.painter,w=m.width/devicePixelRatio,P=m.height/devicePixelRatio;return!this._fbo||this._fbo.width===w&&this._fbo.height===P||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Ue(m.context,{width:w,height:P,data:null},m.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(m.context.gl.NEAREST,m.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Ue(m.context,{width:w,height:P,data:null},m.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(m.context.gl.NEAREST,m.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=m.context.createFramebuffer(w,P,!0,!1),this._fbo.depthAttachment.set(m.context.createRenderbuffer(m.context.gl.DEPTH_COMPONENT16,w,P))),this._fbo.colorAttachment.set(l==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const l=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const m=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let O=0,G=0;O<this._coordsTextureSize;O++)for(let J=0;J<this._coordsTextureSize;J++,G+=4)m[G+0]=255&J,m[G+1]=255&O,m[G+2]=J>>8<<4|O>>8,m[G+3]=0;const w=new o.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(m.buffer)),P=new Ue(l,w,l.gl.RGBA,{premultiply:!1});return P.bind(l.gl.NEAREST,l.gl.CLAMP_TO_EDGE),this._coordsTexture=P,P}pointCoordinate(l){this.painter.maybeDrawDepthAndCoords(!0);const m=new Uint8Array(4),w=this.painter.context,P=w.gl,O=Math.round(l.x*this.painter.pixelRatio/devicePixelRatio),G=Math.round(l.y*this.painter.pixelRatio/devicePixelRatio),J=Math.round(this.painter.height/devicePixelRatio);w.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),P.readPixels(O,J-G-1,1,1,P.RGBA,P.UNSIGNED_BYTE,m),w.bindFramebuffer.set(null);const re=m[0]+(m[2]>>4<<8),oe=m[1]+((15&m[2])<<8),pe=this.coordsIndex[255-m[3]],Ce=pe&&this.sourceCache.getTileByID(pe);if(!Ce)return null;const Me=this._coordsTextureSize,Ke=(1<<Ce.tileID.canonical.z)*Me;return new o.Y((Ce.tileID.canonical.x*Me+re)/Ke+Ce.tileID.wrap,(Ce.tileID.canonical.y*Me+oe)/Ke,this.getElevation(Ce.tileID,re,oe,Me))}depthAtPoint(l){const m=new Uint8Array(4),w=this.painter.context,P=w.gl;return w.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),P.readPixels(l.x,this.painter.height/devicePixelRatio-l.y-1,1,1,P.RGBA,P.UNSIGNED_BYTE,m),w.bindFramebuffer.set(null),(m[0]/16777216+m[1]/65536+m[2]/256+m[3])/256}getTerrainMesh(l){var m;const w=((m=this.painter.style.projection)===null||m===void 0?void 0:m.transitionState)>0,P=w&&l.canonical.y===0,O=w&&l.canonical.y===(1<<l.canonical.z)-1,G=`m_${P?"n":""}_${O?"s":""}`;if(this._meshCache[G])return this._meshCache[G];const J=this.painter.context,re=new o.cc,oe=new o.aE,pe=this.meshSize,Ce=o.X/pe,Me=pe*pe;for(let zt=0;zt<=pe;zt++)for(let ir=0;ir<=pe;ir++)re.emplaceBack(ir*Ce,zt*Ce,0);for(let zt=0;zt<Me;zt+=pe+1)for(let ir=0;ir<pe;ir++)oe.emplaceBack(ir+zt,pe+ir+zt+1,pe+ir+zt+2),oe.emplaceBack(ir+zt,pe+ir+zt+2,ir+zt+1);const Ke=re.length,Ye=Ke+(pe+1),gt=(pe+1)*pe,ft=P?o.b6:0,mt=P?0:1,xt=O?o.b7:o.X,Ft=O?0:1;for(let zt=0;zt<=pe;zt++)re.emplaceBack(zt*Ce,ft,mt);for(let zt=0;zt<=pe;zt++)re.emplaceBack(zt*Ce,xt,Ft);for(let zt=0;zt<pe;zt++)oe.emplaceBack(gt+zt,Ye+zt,Ye+zt+1),oe.emplaceBack(gt+zt,Ye+zt+1,gt+zt+1),oe.emplaceBack(0+zt,Ke+zt+1,Ke+zt),oe.emplaceBack(0+zt,0+zt+1,Ke+zt+1);const Dt=re.length,Ut=Dt+2*(pe+1);for(const zt of[0,1])for(let ir=0;ir<=pe;ir++)for(const sr of[0,1])re.emplaceBack(zt*o.X,ir*Ce,sr);for(let zt=0;zt<2*pe;zt+=2)oe.emplaceBack(Dt+zt,Dt+zt+1,Dt+zt+3),oe.emplaceBack(Dt+zt,Dt+zt+3,Dt+zt+2),oe.emplaceBack(Ut+zt,Ut+zt+3,Ut+zt+1),oe.emplaceBack(Ut+zt,Ut+zt+2,Ut+zt+3);const Gt=new lo(J.createVertexBuffer(re,ur.members),J.createIndexBuffer(oe),o.aD.simpleSegment(0,0,re.length,oe.length));return this._meshCache[G]=Gt,Gt}getMeshFrameDelta(l){return 2*Math.PI*o.bo/Math.pow(2,Math.max(l,0))/5}getMinTileElevationForLngLatZoom(l,m){var w;const{tileID:P}=this._getOverscaledTileIDFromLngLatZoom(l,m);return(w=this.getMinMaxElevation(P).minElevation)!==null&&w!==void 0?w:0}getMinMaxElevation(l){const m=this.getTerrainData(l).tile,w={minElevation:null,maxElevation:null};return m&&m.dem&&(w.minElevation=m.dem.min*this.exaggeration,w.maxElevation=m.dem.max*this.exaggeration),w}_getOverscaledTileIDFromLngLatZoom(l,m){const w=o.Y.fromLngLat(l.wrap()),P=(1<<m)*o.X,O=w.x*P,G=w.y*P,J=Math.floor(O/o.X),re=Math.floor(G/o.X);return{tileID:new o.S(m,0,m,J,re),mercatorX:O,mercatorY:G}}}class Or{constructor(l,m,w){this._context=l,this._size=m,this._tileSize=w,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const l of this._objects)l.texture.destroy(),l.fbo.destroy()}_createObject(l){const m=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),w=new Ue(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return w.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),m.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),m.colorAttachment.set(w.texture),{id:l,fbo:m,texture:w,stamp:-1,inUse:!1}}getObjectForId(l){return this._objects[l]}useObject(l){l.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(m=>l.id!==m),this._recentlyUsed.push(l.id)}stampObject(l){l.stamp=++this._stamp}getOrCreateFreeObject(){for(const m of this._recentlyUsed)if(!this._objects[m].inUse)return this._objects[m];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const l=this._createObject(this._objects.length);return this._objects.push(l),l}freeObject(l){l.inUse=!1}freeAllObjects(){for(const l of this._objects)this.freeObject(l)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(l=>!l.inUse)===!1}}const _r={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class xr{constructor(l,m){this.painter=l,this.terrain=m,this.pool=new Or(l.context,30,m.sourceCache.tileSize*m.qualityFactor)}destruct(){this.pool.destruct()}getTexture(l){return this.pool.getObjectForId(l.rtt[this._stacks.length-1].id).texture}prepareForRender(l,m){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=l._order.filter(w=>!l._layers[w].isHidden(m)),this._coordsAscending={};for(const w in l.sourceCaches){this._coordsAscending[w]={};const P=l.sourceCaches[w].getVisibleCoordinates();for(const O of P){const G=this.terrain.sourceCache.getTerrainCoords(O);for(const J in G)this._coordsAscending[w][J]||(this._coordsAscending[w][J]=[]),this._coordsAscending[w][J].push(G[J])}}this._coordsAscendingStr={};for(const w of l._order){const P=l._layers[w],O=P.source;if(_r[P.type]&&!this._coordsAscendingStr[O]){this._coordsAscendingStr[O]={};for(const G in this._coordsAscending[O])this._coordsAscendingStr[O][G]=this._coordsAscending[O][G].map(J=>J.key).sort().join()}}for(const w of this._renderableTiles)for(const P in this._coordsAscendingStr){const O=this._coordsAscendingStr[P][w.tileID.key];O&&O!==w.rttCoords[P]&&(w.rtt=[])}}renderLayer(l,m){if(l.isHidden(this.painter.transform.zoom))return!1;const w=Object.assign(Object.assign({},m),{isRenderingToTexture:!0}),P=l.type,O=this.painter,G=this._renderableLayerIds[this._renderableLayerIds.length-1]===l.id;if(_r[P]&&(this._prevType&&_r[this._prevType]||this._stacks.push([]),this._prevType=P,this._stacks[this._stacks.length-1].push(l.id),!G))return!0;if(_r[this._prevType]||_r[P]&&G){this._prevType=P;const J=this._stacks.length-1,re=this._stacks[J]||[];for(const oe of this._renderableTiles){if(this.pool.isFull()&&(Vh(this.painter,this.terrain,this._rttTiles,w),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(oe),oe.rtt[J]){const Ce=this.pool.getObjectForId(oe.rtt[J].id);if(Ce.stamp===oe.rtt[J].stamp){this.pool.useObject(Ce);continue}}const pe=this.pool.getOrCreateFreeObject();this.pool.useObject(pe),this.pool.stampObject(pe),oe.rtt[J]={id:pe.id,stamp:pe.stamp},O.context.bindFramebuffer.set(pe.fbo.framebuffer),O.context.clear({color:o.b4.transparent,stencil:0}),O.currentStencilSource=void 0;for(let Ce=0;Ce<re.length;Ce++){const Me=O.style._layers[re[Ce]],Ke=Me.source?this._coordsAscending[Me.source][oe.tileID.key]:[oe.tileID];O.context.viewport.set([0,0,pe.fbo.width,pe.fbo.height]),O._renderTileClippingMasks(Me,Ke,!0),O.renderLayer(O,O.style.sourceCaches[Me.source],Me,Ke,w),Me.source&&(oe.rttCoords[Me.source]=this._coordsAscendingStr[Me.source][oe.tileID.key])}}return Vh(this.painter,this.terrain,this._rttTiles,w),this._rttTiles=[],this.pool.freeAllObjects(),_r[P]}return!1}}const Vr={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},xn=h,Qr={hash:!1,interactive:!0,bearingSnap:7,attributionControl:ot,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:o.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},jr={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class In{constructor(l,m){let w=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;this.mousedown=O=>{this.startMove(O,I.mousePos(this.element,O)),I.addEventListener(window,"mousemove",this.mousemove),I.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=O=>{this.move(O,I.mousePos(this.element,O))},this.mouseup=O=>{this._rotatePitchHanlder.dragEnd(O),this.offTemp()},this.touchstart=O=>{O.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=I.touchPos(this.element,O.targetTouches)[0],this.startMove(O,this._startPos),I.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),I.addEventListener(window,"touchend",this.touchend))},this.touchmove=O=>{O.targetTouches.length!==1?this.reset():(this._lastPos=I.touchPos(this.element,O.targetTouches)[0],this.move(O,this._lastPos))},this.touchend=O=>{O.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHanlder.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=m;const P=new $c;this._rotatePitchHanlder=new un({clickTolerance:3,move:(O,G)=>{const J=m.getBoundingClientRect(),re=new o.P((J.bottom-J.top)/2,(J.right-J.left)/2);return{bearingDelta:o.c7(new o.P(O.x,G.y),G,re),pitchDelta:w?-.5*(G.y-O.y):void 0}},moveStateManager:P,enable:!0,assignEvents:()=>{}}),this.map=l,I.addEventListener(m,"mousedown",this.mousedown),I.addEventListener(m,"touchstart",this.touchstart,{passive:!1}),I.addEventListener(m,"touchcancel",this.reset)}startMove(l,m){this._rotatePitchHanlder.dragStart(l,m),I.disableDrag()}move(l,m){const w=this.map,{bearingDelta:P,pitchDelta:O}=this._rotatePitchHanlder.dragMove(l,m)||{};P&&w.setBearing(w.getBearing()+P),O&&w.setPitch(w.getPitch()+O)}off(){const l=this.element;I.removeEventListener(l,"mousedown",this.mousedown),I.removeEventListener(l,"touchstart",this.touchstart,{passive:!1}),I.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),I.removeEventListener(window,"touchend",this.touchend),I.removeEventListener(l,"touchcancel",this.reset),this.offTemp()}offTemp(){I.enableDrag(),I.removeEventListener(window,"mousemove",this.mousemove),I.removeEventListener(window,"mouseup",this.mouseup),I.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),I.removeEventListener(window,"touchend",this.touchend)}}let Hn;function Qn(D,l,m){const w=new o.N(D.lng,D.lat);if(D=new o.N(D.lng,D.lat),l){const P=new o.N(D.lng-360,D.lat),O=new o.N(D.lng+360,D.lat),G=m.locationToScreenPoint(D).distSqr(l);m.locationToScreenPoint(P).distSqr(l)<G?D=P:m.locationToScreenPoint(O).distSqr(l)<G&&(D=O)}for(;Math.abs(D.lng-m.center.lng)>180;){const P=m.locationToScreenPoint(D);if(P.x>=0&&P.y>=0&&P.x<=m.width&&P.y<=m.height)break;D.lng>m.center.lng?D.lng-=360:D.lng+=360}return D.lng!==w.lng&&m.isPointOnMapSurface(m.locationToScreenPoint(D))?D:w}const Zn={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function ui(D,l,m){const w=D.classList;for(const P in Zn)w.remove(`maplibregl-${m}-anchor-${P}`);w.add(`maplibregl-${m}-anchor-${l}`)}class Ii extends o.E{constructor(l){if(super(),this._onKeyPress=m=>{const w=m.code,P=m.charCode||m.keyCode;w!=="Space"&&w!=="Enter"&&P!==32&&P!==13||this.togglePopup()},this._onMapClick=m=>{const w=m.originalEvent.target,P=this._element;this._popup&&(w===P||P.contains(w))&&this.togglePopup()},this._update=m=>{var w;if(!this._map)return;const P=this._map.loaded()&&!this._map.isMoving();((m==null?void 0:m.type)==="terrain"||(m==null?void 0:m.type)==="render"&&!P)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Qn(this._lngLat,this._flatPos,this._map.transform):(w=this._lngLat)===null||w===void 0?void 0:w.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let O="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?O=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(O=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let G="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?G="rotateX(0deg)":this._pitchAlignment==="map"&&(G=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||m&&m.type!=="moveend"||(this._pos=this._pos.round()),I.setTransform(this._element,`${Zn[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${G} ${O}`),T.frameAsync(new AbortController).then(()=>{this._updateOpacity(m&&m.type==="moveend")}).catch(()=>{})},this._onMove=m=>{if(!this._isDragging){const w=this._clickTolerance||this._map._clickTolerance;this._isDragging=m.point.dist(this._pointerdownPos)>=w}this._isDragging&&(this._pos=m.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.k("dragstart"))),this.fire(new o.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new o.k("dragend")),this._state="inactive"},this._addDragHandler=m=>{this._element.contains(m.originalEvent.target)&&(m.preventDefault(),this._positionDelta=m.point.sub(this._pos).add(this._offset),this._pointerdownPos=m.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=l&&l.anchor||"center",this._color=l&&l.color||"#3FB1CE",this._scale=l&&l.scale||1,this._draggable=l&&l.draggable||!1,this._clickTolerance=l&&l.clickTolerance||0,this._subpixelPositioning=l&&l.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=l&&l.rotation||0,this._rotationAlignment=l&&l.rotationAlignment||"auto",this._pitchAlignment=l&&l.pitchAlignment&&l.pitchAlignment!=="auto"?l.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(l==null?void 0:l.opacity,l==null?void 0:l.opacityWhenCovered),l&&l.element)this._element=l.element,this._offset=o.P.convert(l&&l.offset||[0,0]);else{this._defaultMarker=!0,this._element=I.create("div");const m=I.createNS("http://www.w3.org/2000/svg","svg"),w=41,P=27;m.setAttributeNS(null,"display","block"),m.setAttributeNS(null,"height",`${w}px`),m.setAttributeNS(null,"width",`${P}px`),m.setAttributeNS(null,"viewBox",`0 0 ${P} ${w}`);const O=I.createNS("http://www.w3.org/2000/svg","g");O.setAttributeNS(null,"stroke","none"),O.setAttributeNS(null,"stroke-width","1"),O.setAttributeNS(null,"fill","none"),O.setAttributeNS(null,"fill-rule","evenodd");const G=I.createNS("http://www.w3.org/2000/svg","g");G.setAttributeNS(null,"fill-rule","nonzero");const J=I.createNS("http://www.w3.org/2000/svg","g");J.setAttributeNS(null,"transform","translate(3.0, 29.0)"),J.setAttributeNS(null,"fill","#000000");const re=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const mt of re){const xt=I.createNS("http://www.w3.org/2000/svg","ellipse");xt.setAttributeNS(null,"opacity","0.04"),xt.setAttributeNS(null,"cx","10.5"),xt.setAttributeNS(null,"cy","5.80029008"),xt.setAttributeNS(null,"rx",mt.rx),xt.setAttributeNS(null,"ry",mt.ry),J.appendChild(xt)}const oe=I.createNS("http://www.w3.org/2000/svg","g");oe.setAttributeNS(null,"fill",this._color);const pe=I.createNS("http://www.w3.org/2000/svg","path");pe.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),oe.appendChild(pe);const Ce=I.createNS("http://www.w3.org/2000/svg","g");Ce.setAttributeNS(null,"opacity","0.25"),Ce.setAttributeNS(null,"fill","#000000");const Me=I.createNS("http://www.w3.org/2000/svg","path");Me.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Ce.appendChild(Me);const Ke=I.createNS("http://www.w3.org/2000/svg","g");Ke.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Ke.setAttributeNS(null,"fill","#FFFFFF");const Ye=I.createNS("http://www.w3.org/2000/svg","g");Ye.setAttributeNS(null,"transform","translate(8.0, 8.0)");const gt=I.createNS("http://www.w3.org/2000/svg","circle");gt.setAttributeNS(null,"fill","#000000"),gt.setAttributeNS(null,"opacity","0.25"),gt.setAttributeNS(null,"cx","5.5"),gt.setAttributeNS(null,"cy","5.5"),gt.setAttributeNS(null,"r","5.4999962");const ft=I.createNS("http://www.w3.org/2000/svg","circle");ft.setAttributeNS(null,"fill","#FFFFFF"),ft.setAttributeNS(null,"cx","5.5"),ft.setAttributeNS(null,"cy","5.5"),ft.setAttributeNS(null,"r","5.4999962"),Ye.appendChild(gt),Ye.appendChild(ft),G.appendChild(J),G.appendChild(oe),G.appendChild(Ce),G.appendChild(Ke),G.appendChild(Ye),m.appendChild(G),m.setAttributeNS(null,"height",w*this._scale+"px"),m.setAttributeNS(null,"width",P*this._scale+"px"),this._element.appendChild(m),this._offset=o.P.convert(l&&l.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",m=>{m.preventDefault()}),this._element.addEventListener("mousedown",m=>{m.preventDefault()}),ui(this._element,this._anchor,"marker"),l&&l.className)for(const m of l.className.split(" "))this._element.classList.add(m);this._popup=null}addTo(l){return this.remove(),this._map=l,this._element.setAttribute("aria-label",l._getUIString("Marker.Title")),l.getCanvasContainer().appendChild(this._element),l.on("move",this._update),l.on("moveend",this._update),l.on("terrain",this._update),l.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),I.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(l){return this._lngLat=o.N.convert(l),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(l){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),l){if(!("offset"in l.options)){const P=Math.abs(13.5)/Math.SQRT2;l.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[P,-1*(38.1-13.5+P)],"bottom-right":[-P,-1*(38.1-13.5+P)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=l,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(l){return this._subpixelPositioning=l,this}getPopup(){return this._popup}togglePopup(){const l=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:l?(l.isOpen()?l.remove():(l.setLngLat(this._lngLat),l.addTo(this._map)),this):this}_updateOpacity(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;var m,w;if(!(!((m=this._map)===null||m===void 0)&&m.terrain)){const Ce=this._map.transform.isLocationOccluded(this._lngLat)?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==Ce&&(this._element.style.opacity=Ce))}if(l)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const P=this._map,O=P.terrain.depthAtPoint(this._pos),G=P.terrain.getElevationForLngLatZoom(this._lngLat,P.transform.tileZoom);if(P.transform.lngLatToCameraDepth(this._lngLat,G)-O<.006)return void(this._element.style.opacity=this._opacity);const J=-this._offset.y/P.transform.pixelsPerMeter,re=Math.sin(P.getPitch()*Math.PI/180)*J,oe=P.terrain.depthAtPoint(new o.P(this._pos.x,this._pos.y-this._offset.y)),pe=P.transform.lngLatToCameraDepth(this._lngLat,G+re)-oe>.006;!((w=this._popup)===null||w===void 0)&&w.isOpen()&&pe&&this._popup.remove(),this._element.style.opacity=pe?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(l){return this._offset=o.P.convert(l),this._update(),this}addClassName(l){this._element.classList.add(l)}removeClassName(l){this._element.classList.remove(l)}toggleClassName(l){return this._element.classList.toggle(l)}setDraggable(l){return this._draggable=!!l,this._map&&(l?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(l){return this._rotation=l||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(l){return this._rotationAlignment=l||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(l){return this._pitchAlignment=l&&l!=="auto"?l:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(l,m){return l===void 0&&m===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),l!==void 0&&(this._opacity=l),m!==void 0&&(this._opacityWhenCovered=m),this._map&&this._updateOpacity(!0),this}}const cs={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let mi=0,qi=!1;const Di={maxWidth:100,unit:"metric"};function us(D,l,m){const w=m&&m.maxWidth||100,P=D._container.clientHeight/2,O=D._container.clientWidth/2,G=D.unproject([O-w/2,P]),J=D.unproject([O+w/2,P]),re=Math.round(D.project(J).x-D.project(G).x),oe=Math.min(w,re,D._container.clientWidth),pe=G.distanceTo(J);if(m&&m.unit==="imperial"){const Ce=3.2808*pe;Ce>5280?ns(l,oe,Ce/5280,D._getUIString("ScaleControl.Miles")):ns(l,oe,Ce,D._getUIString("ScaleControl.Feet"))}else m&&m.unit==="nautical"?ns(l,oe,pe/1852,D._getUIString("ScaleControl.NauticalMiles")):pe>=1e3?ns(l,oe,pe/1e3,D._getUIString("ScaleControl.Kilometers")):ns(l,oe,pe,D._getUIString("ScaleControl.Meters"))}function ns(D,l,m,w){const P=function(O){const G=Math.pow(10,`${Math.floor(O)}`.length-1);let J=O/G;return J=J>=10?10:J>=5?5:J>=3?3:J>=2?2:J>=1?1:function(re){const oe=Math.pow(10,Math.ceil(-Math.log(re)/Math.LN10));return Math.round(re*oe)/oe}(J),G*J}(m);D.style.width=l*(P/m)+"px",D.innerHTML=`${P}&nbsp;${w}`}const Uo={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},da=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Ki(D){if(D){if(typeof D=="number"){const l=Math.round(Math.abs(D)/Math.SQRT2);return{center:new o.P(0,0),top:new o.P(0,D),"top-left":new o.P(l,l),"top-right":new o.P(-l,l),bottom:new o.P(0,-D),"bottom-left":new o.P(l,-l),"bottom-right":new o.P(-l,-l),left:new o.P(D,0),right:new o.P(-D,0)}}if(D instanceof o.P||Array.isArray(D)){const l=o.P.convert(D);return{center:l,top:l,"top-left":l,"top-right":l,bottom:l,"bottom-left":l,"bottom-right":l,left:l,right:l}}return{center:o.P.convert(D.center||[0,0]),top:o.P.convert(D.top||[0,0]),"top-left":o.P.convert(D["top-left"]||[0,0]),"top-right":o.P.convert(D["top-right"]||[0,0]),bottom:o.P.convert(D.bottom||[0,0]),"bottom-left":o.P.convert(D["bottom-left"]||[0,0]),"bottom-right":o.P.convert(D["bottom-right"]||[0,0]),left:o.P.convert(D.left||[0,0]),right:o.P.convert(D.right||[0,0])}}return Ki(new o.P(0,0))}const vc=h;a.AJAXError=o.cg,a.Event=o.k,a.Evented=o.E,a.LngLat=o.N,a.MercatorCoordinate=o.Y,a.Point=o.P,a.addProtocol=o.ch,a.config=o.a,a.removeProtocol=o.ci,a.AttributionControl=vt,a.BoxZoomHandler=Cu,a.CanvasSource=Wr,a.CooperativeGesturesHandler=Fe,a.DoubleClickZoomHandler=j,a.DragPanHandler=he,a.DragRotateHandler=ue,a.EdgeInsets=vs,a.FullscreenControl=class extends o.E{constructor(){let D=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this._onFullscreenChange=()=>{var l;let m=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((l=m==null?void 0:m.shadowRoot)===null||l===void 0)&&l.fullscreenElement;)m=m.shadowRoot.fullscreenElement;m===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,D&&D.container&&(D.container instanceof HTMLElement?this._container=D.container:o.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(D){return this._map=D,this._container||(this._container=this._map.getContainer()),this._controlContainer=I.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){I.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const D=this._fullscreenButton=I.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);I.create("span","maplibregl-ctrl-icon",D).setAttribute("aria-hidden","true"),D.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const D=this._getTitle();this._fullscreenButton.setAttribute("aria-label",D),this._fullscreenButton.title=D}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new o.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new o.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},a.GeoJSONSource=mr,a.GeolocateControl=class extends o.E{constructor(D){super(),this._onSuccess=l=>{if(this._map){if(this._isOutOfMapMaxBounds(l))return this._setErrorState(),this.fire(new o.k("outofmaxbounds",l)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=l,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(l),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(l),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new o.k("geolocate",l)),this._finish()}},this._updateCamera=l=>{const m=new o.N(l.coords.longitude,l.coords.latitude),w=l.coords.accuracy,P=this._map.getBearing(),O=o.e({bearing:P},this.options.fitBoundsOptions),G=on.fromLngLat(m,w);this._map.fitBounds(G,O,{geolocateSource:!0})},this._updateMarker=l=>{if(l){const m=new o.N(l.coords.longitude,l.coords.latitude);this._accuracyCircleMarker.setLngLat(m).addTo(this._map),this._userLocationDotMarker.setLngLat(m).addTo(this._map),this._accuracy=l.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=l=>{if(this._map){if(this.options.trackUserLocation)if(l.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const m=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=m,this._geolocateButton.setAttribute("aria-label",m),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(l.code===3&&qi)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new o.k("error",l)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",l=>l.preventDefault()),this._geolocateButton=I.create("button","maplibregl-ctrl-geolocate",this._container),I.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=l=>{if(this._map){if(l===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");const m=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=m,this._geolocateButton.setAttribute("aria-label",m)}else{const m=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=m,this._geolocateButton.setAttribute("aria-label",m)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=I.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Ii({element:this._dotElement}),this._circleElement=I.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ii({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",m=>{m.geolocateSource||this._watchState!=="ACTIVE_LOCK"||m.originalEvent&&m.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new o.k("trackuserlocationend")),this.fire(new o.k("userlocationlostfocus")))})}},this.options=o.e({},cs,D)}onAdd(D){return this._map=D,this._container=I.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return o._(this,arguments,void 0,function(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;return function*(){if(Hn!==void 0&&!l)return Hn;if(window.navigator.permissions===void 0)return Hn=!!window.navigator.geolocation,Hn;try{Hn=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Hn=!!window.navigator.geolocation}return Hn}()})}().then(l=>this._finishSetupUI(l)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),I.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,mi=0,qi=!1}_isOutOfMapMaxBounds(D){const l=this._map.getMaxBounds(),m=D.coords;return l&&(m.longitude<l.getWest()||m.longitude>l.getEast()||m.latitude<l.getSouth()||m.latitude>l.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const D=this._map.getBounds(),l=D.getSouthEast(),m=D.getNorthEast(),w=l.distanceTo(m),P=Math.ceil(this._accuracy/(w/this._map._container.clientHeight)*2);this._circleElement.style.width=`${P}px`,this._circleElement.style.height=`${P}px`}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":mi--,qi=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new o.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.k("trackuserlocationstart")),this.fire(new o.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let D;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),mi++,mi>1?(D={maximumAge:6e5,timeout:0},qi=!0):(D=this.options.positionOptions,qi=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,D)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},a.GlobeControl=class{constructor(){this._toggleProjection=()=>{var D;const l=(D=this._map.getProjection())===null||D===void 0?void 0:D.type;this._map.setProjection(l!=="mercator"&&l?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var D;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((D=this._map.getProjection())===null||D===void 0?void 0:D.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(D){return this._map=D,this._container=I.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=I.create("button","maplibregl-ctrl-globe",this._container),I.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){I.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},a.Hash=Ya,a.ImageSource=Mr,a.KeyboardHandler=B,a.LngLatBounds=on,a.LogoControl=kt,a.Map=class extends Ze{constructor(D){var l,m;o.cd.mark(o.ce.create);const w=Object.assign(Object.assign(Object.assign({},Qr),D),{canvasContextAttributes:Object.assign(Object.assign({},Qr.canvasContextAttributes),D.canvasContextAttributes)});if(w.minZoom!=null&&w.maxZoom!=null&&w.minZoom>w.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(w.minPitch!=null&&w.maxPitch!=null&&w.minPitch>w.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(w.minPitch!=null&&w.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(w.maxPitch!=null&&w.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const P=new Dn,O=new du;if(w.minZoom!==void 0&&P.setMinZoom(w.minZoom),w.maxZoom!==void 0&&P.setMaxZoom(w.maxZoom),w.minPitch!==void 0&&P.setMinPitch(w.minPitch),w.maxPitch!==void 0&&P.setMaxPitch(w.maxPitch),w.renderWorldCopies!==void 0&&P.setRenderWorldCopies(w.renderWorldCopies),super(P,O,{bearingSnap:w.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new It,this._controls=[],this._mapId=o.a1(),this._contextLost=J=>{J.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new o.k("webglcontextlost",{originalEvent:J}))},this._contextRestored=J=>{this._setupPainter(),this.resize(),this._update(),this.fire(new o.k("webglcontextrestored",{originalEvent:J}))},this._onMapScroll=J=>{if(J.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=w.interactive,this._maxTileCacheSize=w.maxTileCacheSize,this._maxTileCacheZoomLevels=w.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},w.canvasContextAttributes),this._trackResize=w.trackResize===!0,this._bearingSnap=w.bearingSnap,this._centerClampedToGround=w.centerClampedToGround,this._refreshExpiredTiles=w.refreshExpiredTiles===!0,this._fadeDuration=w.fadeDuration,this._crossSourceCollisions=w.crossSourceCollisions===!0,this._collectResourceTiming=w.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Vr),w.locale),this._clickTolerance=w.clickTolerance,this._overridePixelRatio=w.pixelRatio,this._maxCanvasSize=w.maxCanvasSize,this.transformCameraUpdate=w.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=w.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=fe.addThrottleControl(()=>this.isMoving()),this._requestManager=new ve(w.transformRequest),typeof w.container=="string"){if(this._container=document.getElementById(w.container),!this._container)throw new Error(`Container '${w.container}' not found.`)}else{if(!(w.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=w.container}if(w.maxBounds&&this.setMaxBounds(w.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let J=!1;const re=pn(oe=>{this._trackResize&&!this._removed&&(this.resize(oe),this.redraw())},50);this._resizeObserver=new ResizeObserver(oe=>{J?re(oe):J=!0}),this._resizeObserver.observe(this._container)}this.handlers=new qe(this,w),this._hash=w.hash&&new Ya(typeof w.hash=="string"&&w.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:w.center,elevation:w.elevation,zoom:w.zoom,bearing:w.bearing,pitch:w.pitch,roll:w.roll}),w.bounds&&(this.resize(),this.fitBounds(w.bounds,o.e({},w.fitBoundsOptions,{duration:0}))));const G=typeof w.style=="string"||((m=(l=w.style)===null||l===void 0?void 0:l.projection)===null||m===void 0?void 0:m.type)!=="globe";this.resize(null,G),this._localIdeographFontFamily=w.localIdeographFontFamily,this._validateStyle=w.validateStyle,w.style&&this.setStyle(w.style,{localIdeographFontFamily:w.localIdeographFontFamily}),w.attributionControl&&this.addControl(new vt(typeof w.attributionControl=="boolean"?void 0:w.attributionControl)),w.maplibreLogo&&this.addControl(new kt,w.logoPosition),this.on("style.load",()=>{if(G||this._resizeTransform(),this.transform.unmodified){const J=o.M(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(J)}}),this.on("data",J=>{this._update(J.dataType==="style"),this.fire(new o.k(`${J.dataType}data`,J))}),this.on("dataloading",J=>{this.fire(new o.k(`${J.dataType}dataloading`,J))}),this.on("dataabort",J=>{this.fire(new o.k("sourcedataabort",J))})}_getMapId(){return this._mapId}addControl(D,l){if(l===void 0&&(l=D.getDefaultPosition?D.getDefaultPosition():"top-right"),!D||!D.onAdd)return this.fire(new o.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const m=D.onAdd(this);this._controls.push(D);const w=this._controlPositions[l];return l.indexOf("bottom")!==-1?w.insertBefore(m,w.firstChild):w.appendChild(m),this}removeControl(D){if(!D||!D.onRemove)return this.fire(new o.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const l=this._controls.indexOf(D);return l>-1&&this._controls.splice(l,1),D.onRemove(this),this}hasControl(D){return this._controls.indexOf(D)>-1}calculateCameraOptionsFromTo(D,l,m,w){return w==null&&this.terrain&&(w=this.terrain.getElevationForLngLatZoom(m,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(D,l,m,w)}resize(D){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;const[m,w]=this._containerDimensions(),P=this._getClampedPixelRatio(m,w);if(this._resizeCanvas(m,w,P),this.painter.resize(m,w,P),this.painter.overLimit()){const G=this.painter.context.gl;this._maxCanvasSize=[G.drawingBufferWidth,G.drawingBufferHeight];const J=this._getClampedPixelRatio(m,w);this._resizeCanvas(m,w,J),this.painter.resize(m,w,J)}this._resizeTransform(l);const O=!this._moving;return O&&(this.stop(),this.fire(new o.k("movestart",D)).fire(new o.k("move",D))),this.fire(new o.k("resize",D)),O&&this.fire(new o.k("moveend",D)),this}_resizeTransform(){let D=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;var l;const[m,w]=this._containerDimensions();this.transform.resize(m,w,D),(l=this._requestedCameraState)===null||l===void 0||l.resize(m,w,D)}_getClampedPixelRatio(D,l){const{0:m,1:w}=this._maxCanvasSize,P=this.getPixelRatio(),O=D*P,G=l*P;return Math.min(O>m?m/O:1,G>w?w/G:1)*P}getPixelRatio(){var D;return(D=this._overridePixelRatio)!==null&&D!==void 0?D:devicePixelRatio}setPixelRatio(D){this._overridePixelRatio=D,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(D){return this.transform.setMaxBounds(on.convert(D)),this._update()}setMinZoom(D){if((D=D??-2)>=-2&&D<=this.transform.maxZoom)return this.transform.setMinZoom(D),this._update(),this.getZoom()<D&&this.setZoom(D),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(D){if((D=D??22)>=this.transform.minZoom)return this.transform.setMaxZoom(D),this._update(),this.getZoom()>D&&this.setZoom(D),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(D){if((D=D??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(D>=0&&D<=this.transform.maxPitch)return this.transform.setMinPitch(D),this._update(),this.getPitch()<D&&this.setPitch(D),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(D){if((D=D??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(D>=this.transform.minPitch)return this.transform.setMaxPitch(D),this._update(),this.getPitch()>D&&this.setPitch(D),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(D){return this.transform.setRenderWorldCopies(D),this._update()}project(D){return this.transform.locationToScreenPoint(o.N.convert(D),this.style&&this.terrain)}unproject(D){return this.transform.screenPointToLocation(o.P.convert(D),this.terrain)}isMoving(){var D;return this._moving||((D=this.handlers)===null||D===void 0?void 0:D.isMoving())}isZooming(){var D;return this._zooming||((D=this.handlers)===null||D===void 0?void 0:D.isZooming())}isRotating(){var D;return this._rotating||((D=this.handlers)===null||D===void 0?void 0:D.isRotating())}_createDelegatedListener(D,l,m){if(D==="mouseenter"||D==="mouseover"){let w=!1;return{layers:l,listener:m,delegates:{mousemove:O=>{const G=l.filter(re=>this.getLayer(re)),J=G.length!==0?this.queryRenderedFeatures(O.point,{layers:G}):[];J.length?w||(w=!0,m.call(this,new Vs(D,this,O.originalEvent,{features:J}))):w=!1},mouseout:()=>{w=!1}}}}if(D==="mouseleave"||D==="mouseout"){let w=!1;return{layers:l,listener:m,delegates:{mousemove:G=>{const J=l.filter(re=>this.getLayer(re));(J.length!==0?this.queryRenderedFeatures(G.point,{layers:J}):[]).length?w=!0:w&&(w=!1,m.call(this,new Vs(D,this,G.originalEvent)))},mouseout:G=>{w&&(w=!1,m.call(this,new Vs(D,this,G.originalEvent)))}}}}{const w=P=>{const O=l.filter(J=>this.getLayer(J)),G=O.length!==0?this.queryRenderedFeatures(P.point,{layers:O}):[];G.length&&(P.features=G,m.call(this,P),delete P.features)};return{layers:l,listener:m,delegates:{[D]:w}}}}_saveDelegatedListener(D,l){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[D]=this._delegatedListeners[D]||[],this._delegatedListeners[D].push(l)}_removeDelegatedListener(D,l,m){if(!this._delegatedListeners||!this._delegatedListeners[D])return;const w=this._delegatedListeners[D];for(let P=0;P<w.length;P++){const O=w[P];if(O.listener===m&&O.layers.length===l.length&&O.layers.every(G=>l.includes(G))){for(const G in O.delegates)this.off(G,O.delegates[G]);return void w.splice(P,1)}}}on(D,l,m){if(m===void 0)return super.on(D,l);const w=typeof l=="string"?[l]:l,P=this._createDelegatedListener(D,w,m);this._saveDelegatedListener(D,P);for(const O in P.delegates)this.on(O,P.delegates[O]);return{unsubscribe:()=>{this._removeDelegatedListener(D,w,m)}}}once(D,l,m){var w=this;if(m===void 0)return super.once(D,l);const P=typeof l=="string"?[l]:l,O=this._createDelegatedListener(D,P,m);for(const G in O.delegates){const J=O.delegates[G];O.delegates[G]=function(){w._removeDelegatedListener(D,P,m),J(...arguments)}}this._saveDelegatedListener(D,O);for(const G in O.delegates)this.once(G,O.delegates[G]);return this}off(D,l,m){return m===void 0?super.off(D,l):(this._removeDelegatedListener(D,typeof l=="string"?[l]:l,m),this)}queryRenderedFeatures(D,l){if(!this.style)return[];let m;const w=D instanceof o.P||Array.isArray(D),P=w?D:[[0,0],[this.transform.width,this.transform.height]];if(l=l||(w?{}:D)||{},P instanceof o.P||typeof P[0]=="number")m=[o.P.convert(P)];else{const O=o.P.convert(P[0]),G=o.P.convert(P[1]);m=[O,new o.P(G.x,O.y),G,new o.P(O.x,G.y),O]}return this.style.queryRenderedFeatures(m,l,this.transform)}querySourceFeatures(D,l){return this.style.querySourceFeatures(D,l)}setStyle(D,l){return(l=o.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},l)).diff!==!1&&l.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&D?(this._diffStyle(D,l),this):(this._localIdeographFontFamily=l.localIdeographFontFamily,this._updateStyle(D,l))}setTransformRequest(D){return this._requestManager.setTransformRequest(D),this}_getUIString(D){const l=this._locale[D];if(l==null)throw new Error(`Missing UI string '${D}'`);return l}_updateStyle(D,l){var m,w;if(l.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(D,l));const P=this.style&&l.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!D)),D?(this.style=new Lo(this,l||{}),this.style.setEventedParent(this,{style:this.style}),typeof D=="string"?this.style.loadURL(D,l,P):this.style.loadJSON(D,l,P),this):((w=(m=this.style)===null||m===void 0?void 0:m.projection)===null||w===void 0||w.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Lo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(D,l){if(typeof D=="string"){const m=this._requestManager.transformRequest(D,"Style");o.h(m,new AbortController).then(w=>{this._updateDiff(w.data,l)}).catch(w=>{w&&this.fire(new o.j(w))})}else typeof D=="object"&&this._updateDiff(D,l)}_updateDiff(D,l){try{this.style.setState(D,l)&&this._update(!0)}catch(m){o.w(`Unable to perform style diff: ${m.message||m.error||m}.  Rebuilding the style from scratch.`),this._updateStyle(D,l)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():o.w("There is no style added to the map.")}addSource(D,l){return this._lazyInitEmptyStyle(),this.style.addSource(D,l),this._update(!0)}isSourceLoaded(D){const l=this.style&&this.style.sourceCaches[D];if(l!==void 0)return l.loaded();this.fire(new o.j(new Error(`There is no source with ID '${D}'`)))}setTerrain(D){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),D){const l=this.style.sourceCaches[D.source];if(!l)throw new Error(`cannot load terrain, because there exists no source with ID: ${D.source}`);this.terrain===null&&l.reload();for(const m in this.style._layers){const w=this.style._layers[m];w.type==="hillshade"&&w.source===D.source&&o.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Dr(this.painter,l,D),this.painter.renderToTexture=new xr(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=m=>{m.dataType==="style"?this.terrain.sourceCache.freeRtt():m.dataType==="source"&&m.tile&&(m.sourceId!==D.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),this.terrain.sourceCache.freeRtt(m.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new o.k("terrain",{terrain:D})),this}getTerrain(){var D,l;return(l=(D=this.terrain)===null||D===void 0?void 0:D.options)!==null&&l!==void 0?l:null}areTilesLoaded(){const D=this.style&&this.style.sourceCaches;for(const l in D){const m=D[l]._tiles;for(const w in m){const P=m[w];if(P.state!=="loaded"&&P.state!=="errored")return!1}}return!0}removeSource(D){return this.style.removeSource(D),this._update(!0)}getSource(D){return this.style.getSource(D)}addImage(D,l){let m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{pixelRatio:w=1,sdf:P=!1,stretchX:O,stretchY:G,content:J,textFitWidth:re,textFitHeight:oe}=m;if(this._lazyInitEmptyStyle(),!(l instanceof HTMLImageElement||o.b(l))){if(l.width===void 0||l.height===void 0)return this.fire(new o.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:pe,height:Ce,data:Me}=l,Ke=l;return this.style.addImage(D,{data:new o.R({width:pe,height:Ce},new Uint8Array(Me)),pixelRatio:w,stretchX:O,stretchY:G,content:J,textFitWidth:re,textFitHeight:oe,sdf:P,version:0,userImage:Ke}),Ke.onAdd&&Ke.onAdd(this,D),this}}{const{width:pe,height:Ce,data:Me}=T.getImageData(l);this.style.addImage(D,{data:new o.R({width:pe,height:Ce},Me),pixelRatio:w,stretchX:O,stretchY:G,content:J,textFitWidth:re,textFitHeight:oe,sdf:P,version:0})}}updateImage(D,l){const m=this.style.getImage(D);if(!m)return this.fire(new o.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const w=l instanceof HTMLImageElement||o.b(l)?T.getImageData(l):l,{width:P,height:O,data:G}=w;if(P===void 0||O===void 0)return this.fire(new o.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(P!==m.data.width||O!==m.data.height)return this.fire(new o.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const J=!(l instanceof HTMLImageElement||o.b(l));return m.data.replace(G,J),this.style.updateImage(D,m),this}getImage(D){return this.style.getImage(D)}hasImage(D){return D?!!this.style.getImage(D):(this.fire(new o.j(new Error("Missing required image id"))),!1)}removeImage(D){this.style.removeImage(D)}loadImage(D){return fe.getImage(this._requestManager.transformRequest(D,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(D,l){return this._lazyInitEmptyStyle(),this.style.addLayer(D,l),this._update(!0)}moveLayer(D,l){return this.style.moveLayer(D,l),this._update(!0)}removeLayer(D){return this.style.removeLayer(D),this._update(!0)}getLayer(D){return this.style.getLayer(D)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(D,l,m){return this.style.setLayerZoomRange(D,l,m),this._update(!0)}setFilter(D,l){let m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.style.setFilter(D,l,m),this._update(!0)}getFilter(D){return this.style.getFilter(D)}setPaintProperty(D,l,m){let w=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return this.style.setPaintProperty(D,l,m,w),this._update(!0)}getPaintProperty(D,l){return this.style.getPaintProperty(D,l)}setLayoutProperty(D,l,m){let w=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return this.style.setLayoutProperty(D,l,m,w),this._update(!0)}getLayoutProperty(D,l){return this.style.getLayoutProperty(D,l)}setGlyphs(D){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setGlyphs(D,l),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(D,l){let m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this._lazyInitEmptyStyle(),this.style.addSprite(D,l,m,w=>{w||this._update(!0)}),this}removeSprite(D){return this._lazyInitEmptyStyle(),this.style.removeSprite(D),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(D){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setSprite(D,l,m=>{m||this._update(!0)}),this}setLight(D){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setLight(D,l),this._update(!0)}getLight(){return this.style.getLight()}setSky(D){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setSky(D,l),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(D,l){return this.style.setFeatureState(D,l),this._update()}removeFeatureState(D,l){return this.style.removeFeatureState(D,l),this._update()}getFeatureState(D){return this.style.getFeatureState(D)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let D=0,l=0;return this._container&&(D=this._container.clientWidth||400,l=this._container.clientHeight||300),[D,l]}_setupContainer(){const D=this._container;D.classList.add("maplibregl-map");const l=this._canvasContainer=I.create("div","maplibregl-canvas-container",D);this._interactive&&l.classList.add("maplibregl-interactive"),this._canvas=I.create("canvas","maplibregl-canvas",l),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const m=this._containerDimensions(),w=this._getClampedPixelRatio(m[0],m[1]);this._resizeCanvas(m[0],m[1],w);const P=this._controlContainer=I.create("div","maplibregl-control-container",D),O=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(G=>{O[G]=I.create("div",`maplibregl-ctrl-${G} `,P)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(D,l,m){this._canvas.width=Math.floor(m*D),this._canvas.height=Math.floor(m*l),this._canvas.style.width=`${D}px`,this._canvas.style.height=`${l}px`}_setupPainter(){const D=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let l=null;this._canvas.addEventListener("webglcontextcreationerror",w=>{l={requestedAttributes:D},w&&(l.statusMessage=w.statusMessage,l.type=w.type)},{once:!0});let m=null;if(m=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,D):this._canvas.getContext("webgl2",D)||this._canvas.getContext("webgl",D),!m){const w="Failed to initialize WebGL";throw l?(l.message=w,new Error(JSON.stringify(l))):new Error(w)}this.painter=new Za(m,this.transform),N.testSupport(m)}migrateProjection(D,l){super.migrateProjection(D,l),this.painter.transform=D,this.fire(new o.k("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(D){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||D,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(D){return this._update(),this._renderTaskQueue.add(D)}_cancelRenderFrame(D){this._renderTaskQueue.remove(D)}_render(D){var l,m,w,P,O;const G=this._idleTriggered?this._fadeDuration:0,J=((l=this.style.projection)===null||l===void 0?void 0:l.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(D),this._removed)return;let re=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const Ce=this.transform.zoom,Me=T.now();this.style.zoomHistory.update(Ce,Me);const Ke=new o.z(Ce,{now:Me,fadeDuration:G,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),Ye=Ke.crossFadingFactor();Ye===1&&Ye===this._crossFadingFactor||(re=!0,this._crossFadingFactor=Ye),this.style.update(Ke)}const oe=((m=this.style.projection)===null||m===void 0?void 0:m.transitionState)>0!==J;(w=this.style.projection)===null||w===void 0||w.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((P=this.style.projection)===null||P===void 0?void 0:P.transitionState,(O=this.style.projection)===null||O===void 0?void 0:O.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||oe)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,G,this._crossSourceCollisions,oe),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:G,showPadding:this.showPadding}),this.fire(new o.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,o.cd.mark(o.ce.load),this.fire(new o.k("load"))),this.style&&(this.style.hasTransitions()||re)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const pe=this._sourcesDirty||this._styleDirty||this._placementDirty;return pe||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new o.k("idle")),!this._loaded||this._fullyLoaded||pe||(this._fullyLoaded=!0,o.cd.mark(o.ce.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var D;this._hash&&this._hash.remove();for(const m of this._controls)m.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),fe.removeThrottleControl(this._imageQueueHandle),(D=this._resizeObserver)===null||D===void 0||D.disconnect();const l=this.painter.context.gl.getExtension("WEBGL_lose_context");l!=null&&l.loseContext&&l.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),I.remove(this._canvasContainer),I.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),o.cd.clearMetrics(),this._removed=!0,this.fire(new o.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,T.frame(this._frameRequest,D=>{o.cd.frame(D),this._frameRequest=null;try{this._render(D)}catch(l){if(!o.cf(l)&&!function(m){return m.message===ha}(l))throw l}},()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(D){this._showTileBoundaries!==D&&(this._showTileBoundaries=D,this._update())}get showPadding(){return!!this._showPadding}set showPadding(D){this._showPadding!==D&&(this._showPadding=D,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(D){this._showCollisionBoxes!==D&&(this._showCollisionBoxes=D,D?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(D){this._showOverdrawInspector!==D&&(this._showOverdrawInspector=D,this._update())}get repaint(){return!!this._repaint}set repaint(D){this._repaint!==D&&(this._repaint=D,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(D){this._vertices=D,this._update()}get version(){return xn}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(D){return this._lazyInitEmptyStyle(),this.style.setProjection(D),this._update(!0)}},a.MapMouseEvent=Vs,a.MapTouchEvent=wl,a.MapWheelEvent=el,a.Marker=Ii,a.NavigationControl=class{constructor(D){this._updateZoomButtons=()=>{const l=this._map.getZoom(),m=l===this._map.getMaxZoom(),w=l===this._map.getMinZoom();this._zoomInButton.disabled=m,this._zoomOutButton.disabled=w,this._zoomInButton.setAttribute("aria-disabled",m.toString()),this._zoomOutButton.setAttribute("aria-disabled",w.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(l,m)=>{const w=this._map._getUIString(`NavigationControl.${m}`);l.title=w,l.setAttribute("aria-label",w)},this.options=o.e({},jr,D),this._container=I.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",l=>l.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",l=>this._map.zoomIn({},{originalEvent:l})),I.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",l=>this._map.zoomOut({},{originalEvent:l})),I.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",l=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:l}):this._map.resetNorth({},{originalEvent:l})}),this._compassIcon=I.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(D){return this._map=D,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new In(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){I.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(D,l){const m=I.create("button",D,this._container);return m.type="button",m.addEventListener("click",l),m}},a.Popup=class extends o.E{constructor(D){super(),this.remove=()=>(this._content&&I.remove(this._content),this._container&&(I.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new o.k("close"))),this),this._onMouseUp=l=>{this._update(l.point)},this._onMouseMove=l=>{this._update(l.point)},this._onDrag=l=>{this._update(l.point)},this._update=l=>{var m;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=I.create("div","maplibregl-popup",this._map.getContainer()),this._tip=I.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const J of this.options.className.split(" "))this._container.classList.add(J);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Qn(this._lngLat,this._flatPos,this._map.transform):(m=this._lngLat)===null||m===void 0?void 0:m.wrap(),this._trackPointer&&!l)return;const w=this._flatPos=this._pos=this._trackPointer&&l?l:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&l?l:this._map.transform.locationToScreenPoint(this._lngLat));let P=this.options.anchor;const O=Ki(this.options.offset);if(!P){const J=this._container.offsetWidth,re=this._container.offsetHeight;let oe;oe=w.y+O.bottom.y<re?["top"]:w.y>this._map.transform.height-re?["bottom"]:[],w.x<J/2?oe.push("left"):w.x>this._map.transform.width-J/2&&oe.push("right"),P=oe.length===0?"bottom":oe.join("-")}let G=w.add(O[P]);this.options.subpixelPositioning||(G=G.round()),I.setTransform(this._container,`${Zn[P]} translate(${G.x}px,${G.y}px)`),ui(this._container,P,"popup")},this._onClose=()=>{this.remove()},this.options=o.e(Object.create(Uo),D)}addTo(D){return this._map&&this.remove(),this._map=D,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new o.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(D){return this._lngLat=o.N.convert(D),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(D){return this.setDOMContent(document.createTextNode(D))}setHTML(D){const l=document.createDocumentFragment(),m=document.createElement("body");let w;for(m.innerHTML=D;w=m.firstChild,w;)l.appendChild(w);return this.setDOMContent(l)}getMaxWidth(){var D;return(D=this._container)===null||D===void 0?void 0:D.style.maxWidth}setMaxWidth(D){return this.options.maxWidth=D,this._update(),this}setDOMContent(D){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=I.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(D),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(D){return this._container&&this._container.classList.add(D),this}removeClassName(D){return this._container&&this._container.classList.remove(D),this}setOffset(D){return this.options.offset=D,this._update(),this}toggleClassName(D){if(this._container)return this._container.classList.toggle(D)}setSubpixelPositioning(D){this.options.subpixelPositioning=D}_createCloseButton(){this.options.closeButton&&(this._closeButton=I.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const D=this._container.querySelector(da);D&&D.focus()}},a.RasterDEMTileSource=mn,a.RasterTileSource=Pn,a.ScaleControl=class{constructor(D){this._onMove=()=>{us(this._map,this._container,this.options)},this.setUnit=l=>{this.options.unit=l,us(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Di),D)}getDefaultPosition(){return"bottom-left"}onAdd(D){return this._map=D,this._container=I.create("div","maplibregl-ctrl maplibregl-ctrl-scale",D.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){I.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},a.ScrollZoomHandler=H,a.Style=Lo,a.TerrainControl=class{constructor(D){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=D}onAdd(D){return this._map=D,this._container=I.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=I.create("button","maplibregl-ctrl-terrain",this._container),I.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){I.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},a.TwoFingersTouchPitchHandler=c,a.TwoFingersTouchRotateHandler=X,a.TwoFingersTouchZoomHandler=Eu,a.TwoFingersTouchZoomRotateHandler=Te,a.VectorTileSource=We,a.VideoSource=en,a.addSourceType=(D,l)=>o._(void 0,void 0,void 0,function*(){if(Bn(D))throw new Error(`A source type called "${D}" already exists.`);((m,w)=>{gn[m]=w})(D,l)}),a.clearPrewarmedResources=function(){const D=Bt;D&&(D.isPreloaded()&&D.numActive()===1?(D.release(Fr),Bt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},a.createTileMesh=ja,a.getMaxParallelImageRequests=function(){return o.a.MAX_PARALLEL_IMAGE_REQUESTS},a.getRTLTextPluginStatus=function(){return br().getRTLTextPluginStatus()},a.getVersion=function(){return vc},a.getWorkerCount=function(){return $e.workerCount},a.getWorkerUrl=function(){return o.a.WORKER_URL},a.importScriptInWorkers=function(D){return nr().broadcast("IS",D)},a.prewarm=function(){jt().acquire(Fr)},a.setMaxParallelImageRequests=function(D){o.a.MAX_PARALLEL_IMAGE_REQUESTS=D},a.setRTLTextPlugin=function(D,l){return br().setRTLTextPlugin(D,l)},a.setWorkerCount=function(D){$e.workerCount=D},a.setWorkerUrl=function(D){o.a.WORKER_URL=D}});var s=t;return s})})($D);var VZ=$D.exports;const Wl=dA(VZ);var Xl;(function(r){r[r.Unknown=0]="Unknown",r[r.Point=1]="Point",r[r.LineString=2]="LineString",r[r.Polygon=3]="Polygon",r[r.MultiPoint=4]="MultiPoint",r[r.MultiLineString=5]="MultiLineString",r[r.MultiPolygon=6]="MultiPolygon",r[r.GeometryCollection=7]="GeometryCollection",r[r.CircularString=8]="CircularString",r[r.CompoundCurve=9]="CompoundCurve",r[r.CurvePolygon=10]="CurvePolygon",r[r.MultiCurve=11]="MultiCurve",r[r.MultiSurface=12]="MultiSurface",r[r.Curve=13]="Curve",r[r.Surface=14]="Surface",r[r.PolyhedralSurface=15]="PolyhedralSurface",r[r.TIN=16]="TIN",r[r.Triangle=17]="Triangle"})(Xl||(Xl={}));const Yy=4,e1=4,t1=4,KA=new Int32Array(2),jD=new Float32Array(KA.buffer),qD=new Float64Array(KA.buffer),bx=new Uint16Array(new Uint8Array([1,0]).buffer)[0]===1;var oS;(function(r){r[r.UTF8_BYTES=1]="UTF8_BYTES",r[r.UTF16_STRING=2]="UTF16_STRING"})(oS||(oS={}));class fA{constructor(e){this.bytes_=e,this.position_=0,this.text_decoder_=new TextDecoder}static allocate(e){return new fA(new Uint8Array(e))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(e){this.position_=e}capacity(){return this.bytes_.length}readInt8(e){return this.readUint8(e)<<24>>24}readUint8(e){return this.bytes_[e]}readInt16(e){return this.readUint16(e)<<16>>16}readUint16(e){return this.bytes_[e]|this.bytes_[e+1]<<8}readInt32(e){return this.bytes_[e]|this.bytes_[e+1]<<8|this.bytes_[e+2]<<16|this.bytes_[e+3]<<24}readUint32(e){return this.readInt32(e)>>>0}readInt64(e){return BigInt.asIntN(64,BigInt(this.readUint32(e))+(BigInt(this.readUint32(e+4))<<BigInt(32)))}readUint64(e){return BigInt.asUintN(64,BigInt(this.readUint32(e))+(BigInt(this.readUint32(e+4))<<BigInt(32)))}readFloat32(e){return KA[0]=this.readInt32(e),jD[0]}readFloat64(e){return KA[bx?0:1]=this.readInt32(e),KA[bx?1:0]=this.readInt32(e+4),qD[0]}writeInt8(e,t){this.bytes_[e]=t}writeUint8(e,t){this.bytes_[e]=t}writeInt16(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8}writeUint16(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8}writeInt32(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8,this.bytes_[e+2]=t>>16,this.bytes_[e+3]=t>>24}writeUint32(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8,this.bytes_[e+2]=t>>16,this.bytes_[e+3]=t>>24}writeInt64(e,t){this.writeInt32(e,Number(BigInt.asIntN(32,t))),this.writeInt32(e+4,Number(BigInt.asIntN(32,t>>BigInt(32))))}writeUint64(e,t){this.writeUint32(e,Number(BigInt.asUintN(32,t))),this.writeUint32(e+4,Number(BigInt.asUintN(32,t>>BigInt(32))))}writeFloat32(e,t){jD[0]=t,this.writeInt32(e,KA[0])}writeFloat64(e,t){qD[0]=t,this.writeInt32(e,KA[bx?0:1]),this.writeInt32(e+4,KA[bx?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+Yy+e1)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let e="";for(let t=0;t<e1;t++)e+=String.fromCharCode(this.readInt8(this.position_+Yy+t));return e}__offset(e,t){const n=e-this.readInt32(e);return t<this.readInt16(n)?this.readInt16(n+t):0}__union(e,t){return e.bb_pos=t+this.readInt32(t),e.bb=this,e}__string(e,t){e+=this.readInt32(e);const n=this.readInt32(e);e+=Yy;const i=this.bytes_.subarray(e,e+n);return t===oS.UTF8_BYTES?i:this.text_decoder_.decode(i)}__union_with_string(e,t){return typeof e=="string"?this.__string(t):this.__union(e,t)}__indirect(e){return e+this.readInt32(e)}__vector(e){return e+this.readInt32(e)+Yy}__vector_len(e){return this.readInt32(e+this.readInt32(e))}__has_identifier(e){if(e.length!=e1)throw new Error("FlatBuffers: file identifier must be length "+e1);for(let t=0;t<e1;t++)if(e.charCodeAt(t)!=this.readInt8(this.position()+Yy+t))return!1;return!0}createScalarList(e,t){const n=[];for(let i=0;i<t;++i){const s=e(i);s!==null&&n.push(s)}return n}createObjList(e,t){const n=[];for(let i=0;i<t;++i){const s=e(i);s!==null&&n.push(s.unpack())}return n}}let GZ=class yh{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsGeometry(e,t){return(t||new yh).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsGeometry(e,t){return e.setPosition(e.position()+t1),(t||new yh).__init(e.readInt32(e.position())+e.position(),e)}ends(e){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readUint32(this.bb.__vector(this.bb_pos+t)+e*4):0}endsLength(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__vector_len(this.bb_pos+e):0}endsArray(){const e=this.bb.__offset(this.bb_pos,4);return e?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}xy(e){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+e*8):0}xyLength(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}xyArray(){const e=this.bb.__offset(this.bb_pos,6);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}z(e){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+e*8):0}zLength(){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__vector_len(this.bb_pos+e):0}zArray(){const e=this.bb.__offset(this.bb_pos,8);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}m(e){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+e*8):0}mLength(){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__vector_len(this.bb_pos+e):0}mArray(){const e=this.bb.__offset(this.bb_pos,10);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}t(e){const t=this.bb.__offset(this.bb_pos,12);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+e*8):0}tLength(){const e=this.bb.__offset(this.bb_pos,12);return e?this.bb.__vector_len(this.bb_pos+e):0}tArray(){const e=this.bb.__offset(this.bb_pos,12);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}tm(e){const t=this.bb.__offset(this.bb_pos,14);return t?this.bb.readUint64(this.bb.__vector(this.bb_pos+t)+e*8):BigInt(0)}tmLength(){const e=this.bb.__offset(this.bb_pos,14);return e?this.bb.__vector_len(this.bb_pos+e):0}type(){const e=this.bb.__offset(this.bb_pos,16);return e?this.bb.readUint8(this.bb_pos+e):Xl.Unknown}parts(e,t){const n=this.bb.__offset(this.bb_pos,18);return n?(t||new yh).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+e*4),this.bb):null}partsLength(){const e=this.bb.__offset(this.bb_pos,18);return e?this.bb.__vector_len(this.bb_pos+e):0}static startGeometry(e){e.startObject(8)}static addEnds(e,t){e.addFieldOffset(0,t,0)}static createEndsVector(e,t){e.startVector(4,t.length,4);for(let n=t.length-1;n>=0;n--)e.addInt32(t[n]);return e.endVector()}static startEndsVector(e,t){e.startVector(4,t,4)}static addXy(e,t){e.addFieldOffset(1,t,0)}static createXyVector(e,t){e.startVector(8,t.length,8);for(let n=t.length-1;n>=0;n--)e.addFloat64(t[n]);return e.endVector()}static startXyVector(e,t){e.startVector(8,t,8)}static addZ(e,t){e.addFieldOffset(2,t,0)}static createZVector(e,t){e.startVector(8,t.length,8);for(let n=t.length-1;n>=0;n--)e.addFloat64(t[n]);return e.endVector()}static startZVector(e,t){e.startVector(8,t,8)}static addM(e,t){e.addFieldOffset(3,t,0)}static createMVector(e,t){e.startVector(8,t.length,8);for(let n=t.length-1;n>=0;n--)e.addFloat64(t[n]);return e.endVector()}static startMVector(e,t){e.startVector(8,t,8)}static addT(e,t){e.addFieldOffset(4,t,0)}static createTVector(e,t){e.startVector(8,t.length,8);for(let n=t.length-1;n>=0;n--)e.addFloat64(t[n]);return e.endVector()}static startTVector(e,t){e.startVector(8,t,8)}static addTm(e,t){e.addFieldOffset(5,t,0)}static createTmVector(e,t){e.startVector(8,t.length,8);for(let n=t.length-1;n>=0;n--)e.addInt64(t[n]);return e.endVector()}static startTmVector(e,t){e.startVector(8,t,8)}static addType(e,t){e.addFieldInt8(6,t,Xl.Unknown)}static addParts(e,t){e.addFieldOffset(7,t,0)}static createPartsVector(e,t){e.startVector(4,t.length,4);for(let n=t.length-1;n>=0;n--)e.addOffset(t[n]);return e.endVector()}static startPartsVector(e,t){e.startVector(4,t,4)}static endGeometry(e){return e.endObject()}static createGeometry(e,t,n,i,s,a,o,h,f){return yh.startGeometry(e),yh.addEnds(e,t),yh.addXy(e,n),yh.addZ(e,i),yh.addM(e,s),yh.addT(e,a),yh.addTm(e,o),yh.addType(e,h),yh.addParts(e,f),yh.endGeometry(e)}};function aS(r,e){const t=[];for(let n=0;n<r.length;n+=2){const i=[r[n],r[n+1]];e&&i.push(e[n>>1]),t.push(i)}return t}function KD(r,e,t){if(!t||t.length===0)return[aS(r,e)];let n=0;const i=Array.from(t).map(a=>r.slice(n,n=a<<1));let s;return e&&(n=0,s=Array.from(t).map(a=>e.slice(n,n=a))),i.map((a,o)=>aS(a,s?s[o]:void 0))}function QZ(r,e){const t=r.xyArray(),n=r.zArray();switch(e){case Xl.Point:{const i=Array.from(t);return n&&i.push(n[0]),i}case Xl.MultiPoint:case Xl.LineString:return aS(t,n);case Xl.MultiLineString:return KD(t,n,r.endsArray());case Xl.Polygon:return KD(t,n,r.endsArray())}}function lS(r,e){let t=e;if(t===Xl.Unknown&&(t=r.type()),t===Xl.GeometryCollection){const i=[];for(let s=0;s<r.partsLength();s++){const a=r.parts(s),o=a.type();i.push(lS(a,o))}return{type:Xl[t],geometries:i}}else if(t===Xl.MultiPolygon){const i=[];for(let s=0;s<r.partsLength();s++)i.push(lS(r.parts(s),Xl.Polygon));return{type:Xl[t],coordinates:i.map(s=>s.coordinates)}}const n=QZ(r,t);return{type:Xl[t],coordinates:n}}var Jl;(function(r){r[r.Byte=0]="Byte",r[r.UByte=1]="UByte",r[r.Bool=2]="Bool",r[r.Short=3]="Short",r[r.UShort=4]="UShort",r[r.Int=5]="Int",r[r.UInt=6]="UInt",r[r.Long=7]="Long",r[r.ULong=8]="ULong",r[r.Float=9]="Float",r[r.Double=10]="Double",r[r.String=11]="String",r[r.Json=12]="Json",r[r.DateTime=13]="DateTime",r[r.Binary=14]="Binary"})(Jl||(Jl={}));class Zl{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsColumn(e,t){return(t||new Zl).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsColumn(e,t){return e.setPosition(e.position()+t1),(t||new Zl).__init(e.readInt32(e.position())+e.position(),e)}name(e){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}type(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readUint8(this.bb_pos+e):Jl.Byte}title(e){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__string(this.bb_pos+t,e):null}description(e){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__string(this.bb_pos+t,e):null}width(){const e=this.bb.__offset(this.bb_pos,12);return e?this.bb.readInt32(this.bb_pos+e):-1}precision(){const e=this.bb.__offset(this.bb_pos,14);return e?this.bb.readInt32(this.bb_pos+e):-1}scale(){const e=this.bb.__offset(this.bb_pos,16);return e?this.bb.readInt32(this.bb_pos+e):-1}nullable(){const e=this.bb.__offset(this.bb_pos,18);return e?!!this.bb.readInt8(this.bb_pos+e):!0}unique(){const e=this.bb.__offset(this.bb_pos,20);return e?!!this.bb.readInt8(this.bb_pos+e):!1}primaryKey(){const e=this.bb.__offset(this.bb_pos,22);return e?!!this.bb.readInt8(this.bb_pos+e):!1}metadata(e){const t=this.bb.__offset(this.bb_pos,24);return t?this.bb.__string(this.bb_pos+t,e):null}static startColumn(e){e.startObject(11)}static addName(e,t){e.addFieldOffset(0,t,0)}static addType(e,t){e.addFieldInt8(1,t,Jl.Byte)}static addTitle(e,t){e.addFieldOffset(2,t,0)}static addDescription(e,t){e.addFieldOffset(3,t,0)}static addWidth(e,t){e.addFieldInt32(4,t,-1)}static addPrecision(e,t){e.addFieldInt32(5,t,-1)}static addScale(e,t){e.addFieldInt32(6,t,-1)}static addNullable(e,t){e.addFieldInt8(7,+t,1)}static addUnique(e,t){e.addFieldInt8(8,+t,0)}static addPrimaryKey(e,t){e.addFieldInt8(9,+t,0)}static addMetadata(e,t){e.addFieldOffset(10,t,0)}static endColumn(e){const t=e.endObject();return e.requiredField(t,4),t}static createColumn(e,t,n,i,s,a,o,h,f,_,x,T){return Zl.startColumn(e),Zl.addName(e,t),Zl.addType(e,n),Zl.addTitle(e,i),Zl.addDescription(e,s),Zl.addWidth(e,a),Zl.addPrecision(e,o),Zl.addScale(e,h),Zl.addNullable(e,f),Zl.addUnique(e,_),Zl.addPrimaryKey(e,x),Zl.addMetadata(e,T),Zl.endColumn(e)}}class Fd{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsFeature(e,t){return(t||new Fd).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsFeature(e,t){return e.setPosition(e.position()+t1),(t||new Fd).__init(e.readInt32(e.position())+e.position(),e)}geometry(e){const t=this.bb.__offset(this.bb_pos,4);return t?(e||new GZ).__init(this.bb.__indirect(this.bb_pos+t),this.bb):null}properties(e){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readUint8(this.bb.__vector(this.bb_pos+t)+e):0}propertiesLength(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}propertiesArray(){const e=this.bb.__offset(this.bb_pos,6);return e?new Uint8Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}columns(e,t){const n=this.bb.__offset(this.bb_pos,8);return n?(t||new Zl).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+e*4),this.bb):null}columnsLength(){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__vector_len(this.bb_pos+e):0}static startFeature(e){e.startObject(3)}static addGeometry(e,t){e.addFieldOffset(0,t,0)}static addProperties(e,t){e.addFieldOffset(1,t,0)}static createPropertiesVector(e,t){e.startVector(1,t.length,1);for(let n=t.length-1;n>=0;n--)e.addInt8(t[n]);return e.endVector()}static startPropertiesVector(e,t){e.startVector(1,t,1)}static addColumns(e,t){e.addFieldOffset(2,t,0)}static createColumnsVector(e,t){e.startVector(4,t.length,4);for(let n=t.length-1;n>=0;n--)e.addOffset(t[n]);return e.endVector()}static startColumnsVector(e,t){e.startVector(4,t,4)}static endFeature(e){return e.endObject()}static finishFeatureBuffer(e,t){e.finish(t)}static finishSizePrefixedFeatureBuffer(e,t){e.finish(t,void 0,!0)}static createFeature(e,t,n,i){return Fd.startFeature(e),Fd.addGeometry(e,t),Fd.addProperties(e,n),Fd.addColumns(e,i),Fd.endFeature(e)}}new TextEncoder;const WD=new TextDecoder;function $Z(r,e){const t={};if(!e||e.length===0)return t;const n=r.propertiesArray();if(!n)return t;const i=new DataView(n.buffer,n.byteOffset),s=r.propertiesLength();let a=0;for(;a<s;){const o=i.getUint16(a,!0);a+=2;const h=e[o],f=h.name;switch(h.type){case Jl.Bool:{t[f]=!!i.getUint8(a),a+=1;break}case Jl.Byte:{t[f]=i.getInt8(a),a+=1;break}case Jl.UByte:{t[f]=i.getUint8(a),a+=1;break}case Jl.Short:{t[f]=i.getInt16(a,!0),a+=2;break}case Jl.UShort:{t[f]=i.getUint16(a,!0),a+=2;break}case Jl.Int:{t[f]=i.getInt32(a,!0),a+=4;break}case Jl.UInt:{t[f]=i.getUint32(a,!0),a+=4;break}case Jl.Long:{t[f]=Number(i.getBigInt64(a,!0)),a+=8;break}case Jl.ULong:{t[f]=Number(i.getBigUint64(a,!0)),a+=8;break}case Jl.Float:{t[f]=i.getFloat32(a,!0),a+=4;break}case Jl.Double:{t[f]=i.getFloat64(a,!0),a+=8;break}case Jl.DateTime:case Jl.String:{const _=i.getUint32(a,!0);a+=4,t[f]=WD.decode(n.subarray(a,a+_)),a+=_;break}case Jl.Json:{const _=i.getUint32(a,!0);a+=4;const x=WD.decode(n.subarray(a,a+_));t[f]=JSON.parse(x),a+=_;break}default:throw new Error("Unknown type "+h.type)}}return t}function cS(r,e){const t=e.columns;return{type:"Feature",geometry:lS(r.geometry(),e.geometryType),properties:$Z(r,t)}}const uS=new Uint8Array(0);function jZ(){return this._source.cancel()}function qZ(r,e){if(!r.length)return e;if(!e.length)return r;var t=new Uint8Array(r.length+e.length);return t.set(r),t.set(e,r.length),t}function KZ(){var r=this,e=r._array.subarray(r._index);return r._source.read().then(function(t){return r._array=uS,r._index=0,t.done?e.length>0?{done:!1,value:e}:{done:!0,value:void 0}:{done:!1,value:qZ(e,t.value)}})}function WZ(r){if((r|=0)<0)throw new Error("invalid length");var e=this,t=this._array.length-this._index;if(this._index+r<=this._array.length)return Promise.resolve(this._array.subarray(this._index,this._index+=r));var n=new Uint8Array(r);return n.set(this._array.subarray(this._index)),function i(){return e._source.read().then(function(s){return s.done?(e._array=uS,e._index=0,t>0?n.subarray(0,t):null):t+s.value.length>=r?(e._array=s.value,e._index=r-t,n.set(s.value.subarray(0,r-t),t),n):(n.set(s.value,t),t+=s.value.length,i())})}()}function XZ(r){return typeof r.slice=="function"?r:new vx(typeof r.read=="function"?r:r.getReader())}function vx(r){this._source=r,this._array=uS,this._index=0}vx.prototype.read=KZ,vx.prototype.slice=WZ,vx.prototype.cancel=jZ;class td{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsCrs(e,t){return(t||new td).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsCrs(e,t){return e.setPosition(e.position()+t1),(t||new td).__init(e.readInt32(e.position())+e.position(),e)}org(e){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}code(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readInt32(this.bb_pos+e):0}name(e){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__string(this.bb_pos+t,e):null}description(e){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__string(this.bb_pos+t,e):null}wkt(e){const t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__string(this.bb_pos+t,e):null}codeString(e){const t=this.bb.__offset(this.bb_pos,14);return t?this.bb.__string(this.bb_pos+t,e):null}static startCrs(e){e.startObject(6)}static addOrg(e,t){e.addFieldOffset(0,t,0)}static addCode(e,t){e.addFieldInt32(1,t,0)}static addName(e,t){e.addFieldOffset(2,t,0)}static addDescription(e,t){e.addFieldOffset(3,t,0)}static addWkt(e,t){e.addFieldOffset(4,t,0)}static addCodeString(e,t){e.addFieldOffset(5,t,0)}static endCrs(e){return e.endObject()}static createCrs(e,t,n,i,s,a,o){return td.startCrs(e),td.addOrg(e,t),td.addCode(e,n),td.addName(e,i),td.addDescription(e,s),td.addWkt(e,a),td.addCodeString(e,o),td.endCrs(e)}}class xx{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsHeader(e,t){return(t||new xx).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsHeader(e,t){return e.setPosition(e.position()+t1),(t||new xx).__init(e.readInt32(e.position())+e.position(),e)}name(e){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}envelope(e){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+e*8):0}envelopeLength(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}envelopeArray(){const e=this.bb.__offset(this.bb_pos,6);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}geometryType(){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.readUint8(this.bb_pos+e):Xl.Unknown}hasZ(){const e=this.bb.__offset(this.bb_pos,10);return e?!!this.bb.readInt8(this.bb_pos+e):!1}hasM(){const e=this.bb.__offset(this.bb_pos,12);return e?!!this.bb.readInt8(this.bb_pos+e):!1}hasT(){const e=this.bb.__offset(this.bb_pos,14);return e?!!this.bb.readInt8(this.bb_pos+e):!1}hasTm(){const e=this.bb.__offset(this.bb_pos,16);return e?!!this.bb.readInt8(this.bb_pos+e):!1}columns(e,t){const n=this.bb.__offset(this.bb_pos,18);return n?(t||new Zl).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+e*4),this.bb):null}columnsLength(){const e=this.bb.__offset(this.bb_pos,18);return e?this.bb.__vector_len(this.bb_pos+e):0}featuresCount(){const e=this.bb.__offset(this.bb_pos,20);return e?this.bb.readUint64(this.bb_pos+e):BigInt("0")}indexNodeSize(){const e=this.bb.__offset(this.bb_pos,22);return e?this.bb.readUint16(this.bb_pos+e):16}crs(e){const t=this.bb.__offset(this.bb_pos,24);return t?(e||new td).__init(this.bb.__indirect(this.bb_pos+t),this.bb):null}title(e){const t=this.bb.__offset(this.bb_pos,26);return t?this.bb.__string(this.bb_pos+t,e):null}description(e){const t=this.bb.__offset(this.bb_pos,28);return t?this.bb.__string(this.bb_pos+t,e):null}metadata(e){const t=this.bb.__offset(this.bb_pos,30);return t?this.bb.__string(this.bb_pos+t,e):null}static startHeader(e){e.startObject(14)}static addName(e,t){e.addFieldOffset(0,t,0)}static addEnvelope(e,t){e.addFieldOffset(1,t,0)}static createEnvelopeVector(e,t){e.startVector(8,t.length,8);for(let n=t.length-1;n>=0;n--)e.addFloat64(t[n]);return e.endVector()}static startEnvelopeVector(e,t){e.startVector(8,t,8)}static addGeometryType(e,t){e.addFieldInt8(2,t,Xl.Unknown)}static addHasZ(e,t){e.addFieldInt8(3,+t,0)}static addHasM(e,t){e.addFieldInt8(4,+t,0)}static addHasT(e,t){e.addFieldInt8(5,+t,0)}static addHasTm(e,t){e.addFieldInt8(6,+t,0)}static addColumns(e,t){e.addFieldOffset(7,t,0)}static createColumnsVector(e,t){e.startVector(4,t.length,4);for(let n=t.length-1;n>=0;n--)e.addOffset(t[n]);return e.endVector()}static startColumnsVector(e,t){e.startVector(4,t,4)}static addFeaturesCount(e,t){e.addFieldInt64(8,t,BigInt("0"))}static addIndexNodeSize(e,t){e.addFieldInt16(9,t,16)}static addCrs(e,t){e.addFieldOffset(10,t,0)}static addTitle(e,t){e.addFieldOffset(11,t,0)}static addDescription(e,t){e.addFieldOffset(12,t,0)}static addMetadata(e,t){e.addFieldOffset(13,t,0)}static endHeader(e){return e.endObject()}static finishHeaderBuffer(e,t){e.finish(t)}static finishSizePrefixedHeaderBuffer(e,t){e.finish(t,void 0,!0)}}function hS(r){const e=xx.getRootAsHeader(r),t=e.featuresCount(),n=e.indexNodeSize(),i=[];for(let h=0;h<e.columnsLength();h++){const f=e.columns(h);if(!f)throw new Error("Column unexpectedly missing");if(!f.name())throw new Error("Column name unexpectedly missing");i.push({name:f.name(),type:f.type(),title:f.title(),description:f.description(),width:f.width(),precision:f.precision(),scale:f.scale(),nullable:f.nullable(),unique:f.unique(),primary_key:f.primaryKey()})}const s=e.crs(),a=s?{org:s.org(),code:s.code(),name:s.name(),description:s.description(),wkt:s.wkt(),code_string:s.codeString()}:null;return{geometryType:e.geometryType(),columns:i,envelope:null,featuresCount:Number(t),indexNodeSize:n,crs:a,title:e.title(),description:e.description(),metadata:e.metadata()}}/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var dS=function(r,e){return dS=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])},dS(r,e)};function JZ(r,e){dS(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function u_(r,e,t,n){function i(s){return s instanceof t?s:new t(function(a){a(s)})}return new(t||(t=Promise))(function(s,a){function o(_){try{f(n.next(_))}catch(x){a(x)}}function h(_){try{f(n.throw(_))}catch(x){a(x)}}function f(_){_.done?s(_.value):i(_.value).then(o,h)}f((n=n.apply(r,[])).next())})}function WA(r,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,i,s,a;return a={next:o(0),throw:o(1),return:o(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function o(f){return function(_){return h([f,_])}}function h(f){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(s=f[0]&2?i.return:f[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,f[1])).done)return s;switch(i=0,s&&(f=[f[0]&2,s.value]),f[0]){case 0:case 1:s=f;break;case 4:return t.label++,{value:f[1],done:!1};case 5:t.label++,i=f[1],f=[0];continue;case 7:f=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(f[0]===6||f[0]===2)){t=0;continue}if(f[0]===3&&(!s||f[1]>s[0]&&f[1]<s[3])){t.label=f[1];break}if(f[0]===6&&t.label<s[1]){t.label=s[1],s=f;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(f);break}s[2]&&t.ops.pop(),t.trys.pop();continue}f=e.call(r,t)}catch(_){f=[6,_],i=0}finally{n=s=0}if(f[0]&5)throw f[1];return{value:f[0]?f[1]:void 0,done:!0}}}function h_(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function r1(r){return this instanceof r1?(this.v=r,this):new r1(r)}function ZZ(r,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(r,e||[]),i,s=[];return i={},a("next"),a("throw"),a("return"),i[Symbol.asyncIterator]=function(){return this},i;function a(T){n[T]&&(i[T]=function(I){return new Promise(function(N,$){s.push([T,I,N,$])>1||o(T,I)})})}function o(T,I){try{h(n[T](I))}catch(N){x(s[0][3],N)}}function h(T){T.value instanceof r1?Promise.resolve(T.value.v).then(f,_):x(s[0][2],T)}function f(T){o("next",T)}function _(T){o("throw",T)}function x(T,I){T(I),s.shift(),s.length&&o(s[0][0],s[0][1])}}var XD=function(r){JZ(e,r);function e(t){var n=r.call(this,t)||this;return Object.defineProperty(n,"name",{value:"RepeaterOverflowError",enumerable:!1}),typeof Object.setPrototypeOf=="function"?Object.setPrototypeOf(n,n.constructor.prototype):n.__proto__=n.constructor.prototype,typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(n,n.constructor),n}return e}(Error);(function(){function r(e){if(e<0)throw new RangeError("Capacity may not be less than 0");this._c=e,this._q=[]}return Object.defineProperty(r.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"full",{get:function(){return this._q.length>=this._c},enumerable:!1,configurable:!0}),r.prototype.add=function(e){if(this.full)throw new Error("Buffer full");this._q.push(e)},r.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},r})(),function(){function r(e){if(e<1)throw new RangeError("Capacity may not be less than 1");this._c=e,this._q=[]}return Object.defineProperty(r.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"full",{get:function(){return!1},enumerable:!1,configurable:!0}),r.prototype.add=function(e){for(;this._q.length>=this._c;)this._q.shift();this._q.push(e)},r.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},r}(),function(){function r(e){if(e<1)throw new RangeError("Capacity may not be less than 1");this._c=e,this._q=[]}return Object.defineProperty(r.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"full",{get:function(){return!1},enumerable:!1,configurable:!0}),r.prototype.add=function(e){this._q.length<this._c&&this._q.push(e)},r.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},r}();function fS(r){r!=null&&typeof r.then=="function"&&r.then(Cx,Cx)}var AS=0,JD=1,mg=2,wx=3,pS=4,Bx=1024,Cx=function(){};function d_(r){var e=r.err,t=Promise.resolve(r.execution).then(function(n){if(e!=null)throw e;return n});return r.err=void 0,r.execution=t.then(function(){},function(){}),r.pending===void 0?t:r.pending.then(function(){return t})}function _g(r,e){var t=r.state>=wx;return Promise.resolve(e).then(function(n){return!t&&r.state>=pS?d_(r).then(function(i){return{value:i,done:!0}}):{value:n,done:t}})}function gS(r,e){var t,n;if(!(r.state>=mg))if(r.state=mg,r.onnext(),r.onstop(),r.err==null&&(r.err=e),r.pushes.length===0&&(typeof r.buffer>"u"||r.buffer.empty))n1(r);else try{for(var i=h_(r.pushes),s=i.next();!s.done;s=i.next()){var a=s.value;a.resolve()}}catch(o){t={error:o}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}}function n1(r){var e,t;if(!(r.state>=wx)){r.state<mg&&gS(r),r.state=wx,r.buffer=void 0;try{for(var n=h_(r.nexts),i=n.next();!i.done;i=n.next()){var s=i.value,a=r.pending===void 0?d_(r):r.pending.then(function(){return d_(r)});s.resolve(_g(r,a))}}catch(o){e={error:o}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}r.pushes=[],r.nexts=[]}}function ZD(r){r.state>=pS||(r.state<wx&&n1(r),r.state=pS)}function YZ(r,e){if(fS(e),r.pushes.length>=Bx)throw new XD("No more than "+Bx+" pending calls to push are allowed on a single repeater.");if(r.state>=mg)return Promise.resolve(void 0);var t=r.pending===void 0?Promise.resolve(e):r.pending.then(function(){return e});t=t.catch(function(h){r.state<mg&&(r.err=h),ZD(r)});var n;if(r.nexts.length){var i=r.nexts.shift();i.resolve(_g(r,t)),r.nexts.length?n=Promise.resolve(r.nexts[0].value):n=new Promise(function(h){return r.onnext=h})}else typeof r.buffer<"u"&&!r.buffer.full?(r.buffer.add(t),n=Promise.resolve(void 0)):n=new Promise(function(h){return r.pushes.push({resolve:h,value:t})});var s=!0,a={},o=n.catch(function(h){if(s)throw h});return a.then=function(h,f){return s=!1,Promise.prototype.then.call(n,h,f)},a.catch=function(h){return s=!1,Promise.prototype.catch.call(n,h)},a.finally=n.finally.bind(n),r.pending=t.then(function(){return o}).catch(function(h){r.err=h,ZD(r)}),a}function eY(r){var e=gS.bind(null,r),t=new Promise(function(n){return r.onstop=n});return e.then=t.then.bind(t),e.catch=t.catch.bind(t),e.finally=t.finally.bind(t),e}function tY(r){if(!(r.state>=JD)){r.state=JD;var e=YZ.bind(null,r),t=eY(r);r.execution=new Promise(function(n){return n(r.executor(e,t))}),r.execution.catch(function(){return gS(r)})}}var Ex=new WeakMap,i1=function(){function r(e,t){Ex.set(this,{executor:e,buffer:t,err:void 0,state:AS,pushes:[],nexts:[],pending:void 0,execution:void 0,onnext:Cx,onstop:Cx})}return r.prototype.next=function(e){fS(e);var t=Ex.get(this);if(t===void 0)throw new Error("WeakMap error");if(t.nexts.length>=Bx)throw new XD("No more than "+Bx+" pending calls to next are allowed on a single repeater.");if(t.state<=AS&&tY(t),t.onnext(e),typeof t.buffer<"u"&&!t.buffer.empty){var n=_g(t,t.buffer.remove());if(t.pushes.length){var i=t.pushes.shift();t.buffer.add(i.value),t.onnext=i.resolve}return n}else if(t.pushes.length){var s=t.pushes.shift();return t.onnext=s.resolve,_g(t,s.value)}else if(t.state>=mg)return n1(t),_g(t,d_(t));return new Promise(function(a){return t.nexts.push({resolve:a,value:e})})},r.prototype.return=function(e){fS(e);var t=Ex.get(this);if(t===void 0)throw new Error("WeakMap error");return n1(t),t.execution=Promise.resolve(t.execution).then(function(){return e}),_g(t,d_(t))},r.prototype.throw=function(e){var t=Ex.get(this);if(t===void 0)throw new Error("WeakMap error");return t.state<=AS||t.state>=mg||typeof t.buffer<"u"&&!t.buffer.empty?(n1(t),t.err==null&&(t.err=e),_g(t,d_(t))):this.next(Promise.reject(e))},r.prototype[Symbol.asyncIterator]=function(){return this},r.race=rY,r.merge=nY,r.zip=iY,r.latest=sY,r}();function Tx(r,e){var t,n,i=[],s=function(f){f!=null&&typeof f[Symbol.asyncIterator]=="function"?i.push(f[Symbol.asyncIterator]()):f!=null&&typeof f[Symbol.iterator]=="function"?i.push(f[Symbol.iterator]()):i.push(function(){return ZZ(this,arguments,function(){return WA(this,function(T){switch(T.label){case 0:return e.yieldValues?[4,r1(f)]:[3,3];case 1:return[4,T.sent()];case 2:T.sent(),T.label=3;case 3:return e.returnValues?[4,r1(f)]:[3,5];case 4:return[2,T.sent()];case 5:return[2]}})})}())};try{for(var a=h_(r),o=a.next();!o.done;o=a.next()){var h=o.value;s(h)}}catch(f){t={error:f}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return i}function rY(r){var e=this,t=Tx(r,{returnValues:!0});return new i1(function(n,i){return u_(e,void 0,void 0,function(){var s,a,o,h,f,_;return WA(this,function(x){switch(x.label){case 0:if(!t.length)return i(),[2];a=!1,i.then(function(){s(),a=!0}),x.label=1;case 1:x.trys.push([1,,5,7]),h=void 0,f=0,_=function(){var T,I,N,$,W,Y;return WA(this,function(ie){switch(ie.label){case 0:T=f;try{for(I=(W=void 0,h_(t)),N=I.next();!N.done;N=I.next())$=N.value,Promise.resolve($.next()).then(function(ce){ce.done?(i(),o===void 0&&(o=ce)):f===T&&(f++,s(ce))},function(ce){return i(ce)})}catch(ce){W={error:ce}}finally{try{N&&!N.done&&(Y=I.return)&&Y.call(I)}finally{if(W)throw W.error}}return[4,new Promise(function(ce){return s=ce})];case 1:return h=ie.sent(),h===void 0?[3,3]:[4,n(h.value)];case 2:ie.sent(),ie.label=3;case 3:return[2]}})},x.label=2;case 2:return a?[3,4]:[5,_()];case 3:return x.sent(),[3,2];case 4:return[2,o&&o.value];case 5:return i(),[4,Promise.race(t.map(function(T){return T.return&&T.return()}))];case 6:return x.sent(),[7];case 7:return[2]}})})})}function nY(r){var e=this,t=Tx(r,{yieldValues:!0});return new i1(function(n,i){return u_(e,void 0,void 0,function(){var s,a,o,h=this;return WA(this,function(f){switch(f.label){case 0:if(!t.length)return i(),[2];s=[],a=!1,i.then(function(){var _,x;a=!0;try{for(var T=h_(s),I=T.next();!I.done;I=T.next()){var N=I.value;N()}}catch($){_={error:$}}finally{try{I&&!I.done&&(x=T.return)&&x.call(T)}finally{if(_)throw _.error}}}),f.label=1;case 1:return f.trys.push([1,,3,4]),[4,Promise.all(t.map(function(_,x){return u_(h,void 0,void 0,function(){var T,I;return WA(this,function(N){switch(N.label){case 0:N.trys.push([0,,6,9]),N.label=1;case 1:return a?[3,5]:(Promise.resolve(_.next()).then(function($){return s[x]($)},function($){return i($)}),[4,new Promise(function($){s[x]=$})]);case 2:return T=N.sent(),T===void 0?[3,4]:T.done?(o=T,[2]):[4,n(T.value)];case 3:N.sent(),N.label=4;case 4:return[3,1];case 5:return[3,9];case 6:return I=_.return,I?[4,_.return()]:[3,8];case 7:I=N.sent(),N.label=8;case 8:return[7];case 9:return[2]}})})}))];case 2:return f.sent(),[2,o&&o.value];case 3:return i(),[7];case 4:return[2]}})})})}function iY(r){var e=this,t=Tx(r,{returnValues:!0});return new i1(function(n,i){return u_(e,void 0,void 0,function(){var s,a,o,h;return WA(this,function(f){switch(f.label){case 0:if(!t.length)return i(),[2,[]];a=!1,i.then(function(){s(),a=!0}),f.label=1;case 1:f.trys.push([1,,6,8]),f.label=2;case 2:return a?[3,5]:(Promise.all(t.map(function(_){return _.next()})).then(function(_){return s(_)},function(_){return i(_)}),[4,new Promise(function(_){return s=_})]);case 3:return o=f.sent(),o===void 0?[2]:(h=o.map(function(_){return _.value}),o.some(function(_){return _.done})?[2,h]:[4,n(h)]);case 4:return f.sent(),[3,2];case 5:return[3,8];case 6:return i(),[4,Promise.all(t.map(function(_){return _.return&&_.return()}))];case 7:return f.sent(),[7];case 8:return[2]}})})})}function sY(r){var e=this,t=Tx(r,{yieldValues:!0,returnValues:!0});return new i1(function(n,i){return u_(e,void 0,void 0,function(){var s,a,o,h,f,_=this;return WA(this,function(x){switch(x.label){case 0:if(!t.length)return i(),[2,[]];a=[],o=!1,i.then(function(){var T,I;s();try{for(var N=h_(a),$=N.next();!$.done;$=N.next()){var W=$.value;W()}}catch(Y){T={error:Y}}finally{try{$&&!$.done&&(I=N.return)&&I.call(N)}finally{if(T)throw T.error}}o=!0}),x.label=1;case 1:return x.trys.push([1,,5,7]),Promise.all(t.map(function(T){return T.next()})).then(function(T){return s(T)},function(T){return i(T)}),[4,new Promise(function(T){return s=T})];case 2:return h=x.sent(),h===void 0?[2]:(f=h.map(function(T){return T.value}),h.every(function(T){return T.done})?[2,f]:[4,n(f.slice())]);case 3:return x.sent(),[4,Promise.all(t.map(function(T,I){return u_(_,void 0,void 0,function(){var N;return WA(this,function($){switch($.label){case 0:if(h[I].done)return[2,h[I].value];$.label=1;case 1:return o?[3,4]:(Promise.resolve(T.next()).then(function(W){return a[I](W)},function(W){return i(W)}),[4,new Promise(function(W){return a[I]=W})]);case 2:return N=$.sent(),N===void 0?[2,h[I].value]:N.done?[2,N.value]:(f[I]=N.value,[4,n(f.slice())]);case 3:return $.sent(),[3,1];case 4:return[2]}})})}))];case 4:return[2,x.sent()];case 5:return i(),[4,Promise.all(t.map(function(T){return T.return&&T.return()}))];case 6:return x.sent(),[7];case 7:return[2]}})})})}let Sx=class{constructor(){this._extraRequestThreshold=256*1024}extraRequestThreshold(){return this._extraRequestThreshold}setExtraRequestThreshold(e){if(e<0)throw new Error("extraRequestThreshold cannot be negative");this._extraRequestThreshold=e}};Sx.global=new Sx;var Rd;(function(r){r[r.Debug=0]="Debug",r[r.Info=1]="Info",r[r.Warn=2]="Warn",r[r.Error=3]="Error"})(Rd||(Rd={}));class Yl{static debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.log(Rd.Debug,...t)}static info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.log(Rd.Info,...t)}static warn(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.log(Rd.Warn,...t)}static error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.log(Rd.Error,...t)}static log(e){if(!(this.logLevel>e)){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];switch(e){case Rd.Debug:{console.debug(...n);break}case Rd.Info:{console.info(...n);break}case Rd.Warn:{console.warn(...n);break}case Rd.Error:{console.error(...n);break}}}}}Yl.logLevel=Rd.Warn;const yg=8*4+8,oY=16;function mS(r,e){e=Math.min(Math.max(+e,2),65535);let t=r,n=t;do t=Math.ceil(t/e),n+=t;while(t!==1);return n*yg}function aY(r,e){if(e<2)throw new Error("Node size must be at least 2");if(r===0)throw new Error("Number of items must be greater than 0");let t=r,n=t;const i=[t];do t=Math.ceil(t/e),n+=t,i.push(t);while(t!==1);const s=[];t=n;for(const o of i)s.push(t-o),t-=o;const a=[];for(let o=0;o<i.length;o++)a.push([s[o],s[o]+i[o]]);return a}async function*lY(r,e,t,n){class i{constructor(N,$){this._level=$,this.nodes=N}level(){return this._level}startNodeIdx(){return this.nodes[0]}endNodeIdx(){return this.nodes[1]}extendEndNodeIdx(N){console.assert(N>this.nodes[1]),this.nodes[1]=N}toString(){return`[NodeRange level: ${this._level}, nodes: ${this.nodes[0]}-${this.nodes[1]}]`}}const{minX:s,minY:a,maxX:o,maxY:h}=t;Yl.info(`tree items: ${r}, nodeSize: ${e}`);const f=aY(r,e),_=f[0][0],T=[(()=>{const I=[0,1],N=f.length-1;return new i(I,N)})()];for(Yl.debug(`starting stream search with queue: ${T}, numItems: ${r}, nodeSize: ${e}, levelBounds: ${f}`);T.length!=0;){const I=T.shift();Yl.debug(`popped node: ${I}, queueLength: ${T.length}`);const N=I.startNodeIdx(),$=N>=_,W=(()=>{const[,fe]=f[I.level()],ve=Math.min(I.endNodeIdx()+e,fe);return $&&ve<fe?ve+1:ve})(),Y=W-N,ie=await n(N*yg,Y*yg),ce=new DataView(ie);for(let fe=N;fe<W;fe++){const ve=fe-N,be=ve*yg;if(o<ce.getFloat64(be+0,!0)||h<ce.getFloat64(be+8,!0)||s>ce.getFloat64(be+16,!0)||a>ce.getFloat64(be+24,!0))continue;const Qe=ce.getBigUint64(be+32,!0);if($){const ze=Qe,tt=(()=>{if(fe<r-1){const Ht=(ve+1)*yg;return ce.getBigUint64(Ht+32,!0)-ze}else return null})(),Ne=fe-_;yield[Number(ze),Ne,Number(tt)];continue}const Ue=Qe,st=Sx.global.extraRequestThreshold()/yg,at=T[T.length-1];if(at!==void 0&&at.level()==I.level()-1&&Ue<at.endNodeIdx()+st){Yl.debug(`Merging "nodeRange" request into existing range: ${at}, newEndNodeIdx: ${at.endNodeIdx()} -> ${Ue}`),at.extendEndNodeIdx(Number(Ue));continue}const Le=(()=>{const ze=I.level()-1,tt=[Number(Ue),Number(Ue)+1];return new i(tt,ze)})();at!==void 0&&at.level()==Le.level()?Yl.info(`Same level, but too far away. Pushing new request for nodeIdx: ${Ue} rather than merging with distant ${at}`):Yl.info(`Pushing new level for ${Le} onto queue with nearestNodeRange: ${at} since there's not already a range for this level.`),T.push(Le)}}}const XA=new Uint8Array([102,103,98,3,102,103,98,0]),AA=4;class _S{constructor(e,t,n,i,s){this.headerClient=e,this.header=t,this.headerLength=n,this.indexLength=i,this.nocache=s}static async open(e,t){const i=new YD(e,t),s=(()=>{const T=oY,I=3;let N=0,$;for($=0;$<I;$++){const W=T**$*yg;N+=W}return N})(),a=2024+s;Yl.debug(`fetching header. minReqLength: ${a} (assumedHeaderLength: 2024, assumedIndexLength: ${s})`);{const T=new Uint8Array(await i.getRange(0,8,a,"header"));if(!T.subarray(0,3).every((I,N)=>XA[N]===I))throw Yl.error(`bytes: ${T} != ${XA}`),new Error("Not a FlatGeobuf file");Yl.debug("magic bytes look good")}let o;{const T=await i.getRange(8,4,a,"header");o=new DataView(T).getUint32(0,!0);const I=1048576*10;if(o>I||o<8)throw new Error("Invalid header size");Yl.debug(`headerLength: ${o}`)}const h=await i.getRange(12,o,a,"header"),f=new fA(new Uint8Array(h)),_=hS(f),x=mS(_.featuresCount,_.indexNodeSize);return Yl.debug("completed: opening http reader"),new _S(i,_,o,x,t)}async*selectBbox(e){const t=this.lengthBeforeTree(),n=this.headerClient,i=async function(h,f){return n.getRange(t+h,f,0,"index")},s=[];let a=[];for await(const h of lY(this.header.featuresCount,this.header.indexNodeSize,e,i)){const[f,,]=h;let[,,_]=h;if(_||(Yl.info("final feature"),_=4),a.length==0){a.push([f,_]);continue}const x=a[a.length-1],T=f-(x[0]+x[1]);T>Sx.global.extraRequestThreshold()&&(Yl.info(`Pushing new feature batch, since gap ${T} was too large`),s.push(a),a=[]),a.push([f,_])}this.headerClient.logUsage("header+index"),a.length>0&&s.push(a);const o=s.flatMap(h=>this.readFeatureBatch(h,this.nocache));yield*i1.merge(o)}lengthBeforeTree(){return XA.length+AA+this.headerLength}lengthBeforeFeatures(){return this.lengthBeforeTree()+this.indexLength}buildFeatureClient(e){return new YD(this.headerClient.httpClient,e)}async*readFeatureBatch(e,t){const[n]=e[0],[i,s]=e[e.length-1],a=n,h=i+s-a,f=this.buildFeatureClient(t);let _=h;for(const[x]of e)yield await this.readFeature(f,x,_),_=0;f.logUsage("feature")}async readFeature(e,t,n){const i=t+this.lengthBeforeFeatures();let s;{const _=await e.getRange(i,4,n,"feature length");s=new DataView(_).getUint32(0,!0)}const a=await e.getRange(i+4,s,n,"feature data"),o=new Uint8Array(a),h=new Uint8Array(s+AA);h.set(o,AA);const f=new fA(h);return f.setPosition(AA),Fd.getRootAsFeature(f)}}class YD{constructor(e,t){if(this.bytesEverUsed=0,this.bytesEverFetched=0,this.buffer=new ArrayBuffer(0),this.head=0,typeof e=="string")this.httpClient=new eO(e,t);else if(e instanceof eO)this.httpClient=e;else throw new Error("Unknown source ")}async getRange(e,t,n,i){this.bytesEverUsed+=t;const s=e-this.head,a=s+t;if(s>=0&&a<=this.buffer.byteLength)return this.buffer.slice(s,a);const o=Math.max(t,n);return this.bytesEverFetched+=o,Yl.debug(`requesting for new Range: ${e}-${e+o-1}`),this.buffer=await this.httpClient.getRange(e,o,i),this.head=e,this.buffer.slice(0,t)}logUsage(e){const t=e.split(" ")[0],n=this.bytesEverUsed,i=this.bytesEverFetched,s=(100*n/i).toFixed(2);Yl.info(`${t} bytes used/requested: ${n} / ${i} = ${s}%`)}}class eO{constructor(e,t){this.requestsEverMade=0,this.bytesEverRequested=0,this.url=e,this.nocache=t}async getRange(e,t,n){this.requestsEverMade+=1,this.bytesEverRequested+=t;const i=`bytes=${e}-${e+t-1}`;Yl.info(`request: #${this.requestsEverMade}, purpose: ${n}), bytes: (this_request: ${t}, ever: ${this.bytesEverRequested}), Range: ${i}`);const s={Range:i};return this.nocache&&(s["Cache-Control"]="no-cache, no-store"),(await fetch(this.url,{headers:s})).arrayBuffer()}}function cY(r,e,t){if(!r.subarray(0,3).every((_,x)=>XA[x]===_))throw new Error("Not a FlatGeobuf file");const n=new fA(r),i=n.readUint32(XA.length);n.setPosition(XA.length+AA);const s=hS(n);let a=XA.length+AA+i;const{indexNodeSize:o,featuresCount:h}=s;o>0&&(a+=mS(h,o));const f=[];for(;a<n.capacity();){const _=n.readUint32(a);n.setPosition(a+AA);const x=Fd.getRootAsFeature(n);f.push(e(x,s)),a+=AA+_}return f}async function*uY(r,e,t){const n=XZ(r),i=async T=>await n.slice(T);let s=new Uint8Array(await i(8));if(!s.subarray(0,3).every((T,I)=>XA[I]===T))throw new Error("Not a FlatGeobuf file");s=new Uint8Array(await i(4));let a=new fA(s);const o=a.readUint32(0);s=new Uint8Array(await i(o)),a=new fA(s);const h=hS(a),{indexNodeSize:f,featuresCount:_}=h;if(f>0){const T=mS(_,f);await i(T)}let x;for(;x=await dY(i,h,e);)yield x}function hY(r,e,t,n){try{let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;return async function*(){const s=await _S.open(r,i);Yl.debug("opened reader");for await(const a of s.selectBbox(e))yield t(a,s.header)}()}catch(i){return Promise.reject(i)}}async function dY(r,e,t){let n=new Uint8Array(await r(4,"feature length"));if(n.byteLength===0)return;let i=new fA(n);const s=i.readUint32(0);n=new Uint8Array(await r(s,"feature data"));const a=new Uint8Array(s+4);a.set(n,4),i=new fA(a),i.setPosition(AA);const o=Fd.getRootAsFeature(i);return t(o,e)}function fY(r,e){return{type:"FeatureCollection",features:cY(r,cS)}}function AY(r,e){return uY(r,cS)}function pY(r,e,t){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;return hY(r,e,cS,t,n)}function tO(r,e,t){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;return r instanceof Uint8Array?fY(r):r instanceof ReadableStream?AY(r):pY(r,e,t,n)}class gY{constructor(){this._bearing=0,this._pitch=60,this._minpitchzoom=null}onAdd(e){this._map=e;let t=this;return this._btn=document.createElement("button"),this._btn.className="maplibregl-ctrl-icon maplibregl-ctrl-pitchtoggle-2d",this._btn.id="bt3D",this._btn.type="button",this._btn["aria-label"]="Vista 3D",this._btn.onclick=function(){if(t._btn.className.indexOf("3d")!=-1){let f={pitch:t._pitch,bearing:t._bearing};t._minpitchzoom&&e.getZoom()>t._minpitchzoom&&(f.zoom=t._minpitchzoom);var n=0,i=38.5,s=6,a=62.33,{longitude:o,latitude:h}=e.getCenter();e.getZoom()<10?e.setTerrain({source:"terrainICGC",exaggeration:1.5}):o>=n&&o<=s&&h>=i&&h<=a?e.setTerrain({source:"terrainICGC",exaggeration:1.2}):e.setTerrain({source:"terrainICGC",exaggeration:1.5}),e.easeTo(f),t._btn.className="maplibregl-ctrl-icon maplibregl-ctrl-pitchtoggle-2d"}else e.setTerrain(null),e.easeTo({pitch:0,bearing:0}),t._btn.className="maplibregl-ctrl-icon maplibregl-ctrl-pitchtoggle-3d"},this._container=document.createElement("div"),this._container.className="maplibregl-ctrl maplibregl-ctrl-group",this._container.title="Vista 3D",this._container.appendChild(this._btn),this._container}onRemove(){this._container.parentNode.removeChild(this._container),this._map=void 0}}function Ix(r,e){if(!r)throw new Error(e||"loader assertion failed.")}const yS=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),rO=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);rO&&parseFloat(rO[1]);const Mx=globalThis,f_=globalThis.process||{};function mY(r){var n,i;if(typeof window<"u"&&((n=window.process)==null?void 0:n.type)==="renderer"||typeof process<"u"&&((i=process.versions)!=null&&i.electron))return!0;const t=typeof navigator<"u"&&navigator.userAgent;return!!(t&&t.indexOf("Electron")>=0)}function bS(){return!(typeof process=="object"&&String(process)==="[object process]"&&!(process!=null&&process.browser))||mY()}const nO="4.1.0";function _Y(r){try{const e=window[r],t="__storage_test__";return e.setItem(t,t),e.removeItem(t),e}catch{return null}}let yY=class{constructor(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";this.storage=_Y(n),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}};function bY(r){let e;return r<10?e=`${r.toFixed(2)}ms`:r<100?e=`${r.toFixed(1)}ms`:r<1e3?e=`${r.toFixed(0)}ms`:e=`${(r/1e3).toFixed(2)}s`,e}function vY(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const t=Math.max(e-r.length,0);return`${" ".repeat(t)}${r}`}var Px;(function(r){r[r.BLACK=30]="BLACK",r[r.RED=31]="RED",r[r.GREEN=32]="GREEN",r[r.YELLOW=33]="YELLOW",r[r.BLUE=34]="BLUE",r[r.MAGENTA=35]="MAGENTA",r[r.CYAN=36]="CYAN",r[r.WHITE=37]="WHITE",r[r.BRIGHT_BLACK=90]="BRIGHT_BLACK",r[r.BRIGHT_RED=91]="BRIGHT_RED",r[r.BRIGHT_GREEN=92]="BRIGHT_GREEN",r[r.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",r[r.BRIGHT_BLUE=94]="BRIGHT_BLUE",r[r.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",r[r.BRIGHT_CYAN=96]="BRIGHT_CYAN",r[r.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Px||(Px={}));const xY=10;function iO(r){return typeof r!="string"?r:(r=r.toUpperCase(),Px[r]||Px.WHITE)}function wY(r,e,t){return!bS&&typeof r=="string"&&(e&&(r=`\x1B[${iO(e)}m${r}\x1B[39m`),t&&(r=`\x1B[${iO(t)+xY}m${r}\x1B[49m`)),r}function BY(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const t=Object.getPrototypeOf(r),n=Object.getOwnPropertyNames(t),i=r;for(const s of n){const a=i[s];typeof a=="function"&&(e.find(o=>s===o)||(i[s]=a.bind(r)))}}function vS(r,e){if(!r)throw new Error("Assertion failed")}function A_(){var e,t,n;let r;if(bS()&&Mx.performance)r=(t=(e=Mx==null?void 0:Mx.performance)==null?void 0:e.now)==null?void 0:t.call(e);else if("hrtime"in f_){const i=(n=f_==null?void 0:f_.hrtime)==null?void 0:n.call(f_);r=i[0]*1e3+i[1]/1e6}else r=Date.now();return r}const p_={debug:bS()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},CY={enabled:!0,level:0};function g_(){}const sO={},oO={once:!0};let Fx=class{constructor(){let{id:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};this.VERSION=nO,this._startTs=A_(),this._deltaTs=A_(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new yY(`__probe-${this.id}__`,CY),this.timeStamp(`${this.id} started`),BY(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((A_()-this._startTs).toPrecision(10))}getDelta(){return Number((A_()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){if(!e)throw new Error(t||"Assertion failed")}warn(e){return this._getLogFunction(0,e,p_.warn,arguments,oO)}error(e){return this._getLogFunction(0,e,p_.error,arguments)}deprecated(e,t){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${t}\` instead`)}removed(e,t){return this.error(`\`${e}\` has been removed. Use \`${t}\` instead`)}probe(e,t){return this._getLogFunction(e,t,p_.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,p_.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){return this._getLogFunction(e,t,p_.debug||p_.info,arguments,oO)}table(e,t,n){return t?this._getLogFunction(e,t,console.table||g_,n&&[n],{tag:TY(t)}):g_}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||g_)}group(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const i=lO({logLevel:e,message:t,opts:n}),{collapsed:s}=n;return i.method=(s?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(e,t,Object.assign({},n,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||g_)}withGroup(e,t,n){this.group(e,t)();try{n()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=aO(e)}_getLogFunction(e,t,n,i,s){if(this._shouldLog(e)){s=lO({logLevel:e,message:t,args:i,opts:s}),n=n||s.method,vS(n),s.total=this.getTotal(),s.delta=this.getDelta(),this._deltaTs=A_();const a=s.tag||s.message;if(s.once&&a)if(!sO[a])sO[a]=A_();else return g_;return t=EY(this.id,s.message,s),n.bind(console,t,...s.args)}return g_}};Fx.VERSION=nO;function aO(r){if(!r)return 0;let e;switch(typeof r){case"number":e=r;break;case"object":e=r.logLevel||r.priority||0;break;default:return 0}return vS(Number.isFinite(e)&&e>=0),e}function lO(r){const{logLevel:e,message:t}=r;r.logLevel=aO(e);const n=r.args?Array.from(r.args):[];for(;n.length&&n.shift()!==t;);switch(typeof e){case"string":case"function":t!==void 0&&n.unshift(t),r.message=e;break;case"object":Object.assign(r,e);break}typeof r.message=="function"&&(r.message=r.message());const i=typeof r.message;return vS(i==="string"||i==="object"),Object.assign(r,{args:n},r.opts)}function EY(r,e,t){if(typeof e=="string"){const n=t.time?vY(bY(t.total)):"";e=t.time?`${r}: ${n}  ${e}`:`${r}: ${e}`,e=wY(e,t.color,t.background)}return e}function TY(r){for(const e in r)for(const t in r[e])return t||"untitled";return"empty"}const xS="4.3.2",SY=xS[0]>="0"&&xS[0]<="9"?`v${xS}`:"";function IY(){const r=new Fx({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=r,globalThis.loaders.version=SY,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=r,r}const MY=IY();function PY(r,e){return cO(r||{},e)}function cO(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;if(t>3)return e;const n={...r};for(const[i,s]of Object.entries(e))s&&typeof s=="object"&&!Array.isArray(s)?n[i]=cO(n[i]||{},e[i],t+1):n[i]=e[i];return n}const FY="latest";function RY(){var r;return(r=globalThis._loadersgl_)!=null&&r.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.2"),globalThis._loadersgl_.version}const LY=RY();function JA(r,e){if(!r)throw new Error(e||"loaders.gl assertion failed.")}const bg=typeof process!="object"||String(process)!=="[object process]"||process.browser,DY=typeof window<"u"&&typeof window.orientation<"u",uO=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);uO&&parseFloat(uO[1]);let OY=class{constructor(e,t){xe(this,"name");xe(this,"workerThread");xe(this,"isRunning",!0);xe(this,"result");xe(this,"_resolve",()=>{});xe(this,"_reject",()=>{});this.name=e,this.workerThread=t,this.result=new Promise((n,i)=>{this._resolve=n,this._reject=i})}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){JA(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){JA(this.isRunning),this.isRunning=!1,this._reject(e)}};class wS{terminate(){}}const BS=new Map;function kY(r){JA(r.source&&!r.url||!r.source&&r.url);let e=BS.get(r.source||r.url);return e||(r.url&&(e=UY(r.url),BS.set(r.url,e)),r.source&&(e=hO(r.source),BS.set(r.source,e))),JA(e),e}function UY(r){if(!r.startsWith("http"))return r;const e=NY(r);return hO(e)}function hO(r){const e=new Blob([r],{type:"application/javascript"});return URL.createObjectURL(e)}function NY(r){return`try {
  importScripts('${r}');
} catch (error) {
  console.error(error);
  throw error;
}`}function dO(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,t=arguments.length>2?arguments[2]:void 0;const n=t||new Set;if(r){if(fO(r))n.add(r);else if(fO(r.buffer))n.add(r.buffer);else if(!ArrayBuffer.isView(r)){if(e&&typeof r=="object")for(const i in r)dO(r[i],e,n)}}return t===void 0?Array.from(n):[]}function fO(r){return r?r instanceof ArrayBuffer||typeof MessagePort<"u"&&r instanceof MessagePort||typeof ImageBitmap<"u"&&r instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&r instanceof OffscreenCanvas:!1}const CS=()=>{};let ES=class{constructor(e){xe(this,"name");xe(this,"source");xe(this,"url");xe(this,"terminated",!1);xe(this,"worker");xe(this,"onMessage");xe(this,"onError");xe(this,"_loadableURL","");const{name:t,source:n,url:i}=e;JA(n||i),this.name=t,this.source=n,this.url=i,this.onMessage=CS,this.onError=s=>console.log(s),this.worker=bg?this._createBrowserWorker():this._createNodeWorker()}static isSupported(){return typeof Worker<"u"&&bg||typeof wS<"u"&&!bg}destroy(){this.onMessage=CS,this.onError=CS,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,t){t=t||dO(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+=`worker ${this.name} from ${this.url}. `,e.message&&(t+=`${e.message} in `),e.lineno&&(t+=`:${e.lineno}:${e.colno}`),new Error(t)}_createBrowserWorker(){this._loadableURL=kY({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=t=>{t.data?this.onMessage(t.data):this.onError(new Error("No data received"))},e.onerror=t=>{this.onError(this._getErrorFromErrorEvent(t)),this.terminated=!0},e.onmessageerror=t=>console.error(t),e}_createNodeWorker(){let e;if(this.url){const n=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new wS(n,{eval:!1})}else if(this.source)e=new wS(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",t=>{this.onMessage(t)}),e.on("error",t=>{this.onError(t)}),e.on("exit",t=>{}),e}},zY=class{constructor(e){xe(this,"name","unnamed");xe(this,"source");xe(this,"url");xe(this,"maxConcurrency",1);xe(this,"maxMobileConcurrency",1);xe(this,"onDebug",()=>{});xe(this,"reuseWorkers",!0);xe(this,"props",{});xe(this,"jobQueue",[]);xe(this,"idleQueue",[]);xe(this,"count",0);xe(this,"isDestroyed",!1);this.source=e.source,this.url=e.url,this.setProps(e)}static isSupported(){return ES.isSupported()}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:(s,a,o)=>s.done(o),n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:(s,a)=>s.error(a);const i=new Promise(s=>(this.jobQueue.push({name:e,onMessage:t,onError:n,onStart:s}),this));return this._startQueuedJob(),await i}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});const n=new OY(t.name,e);e.onMessage=i=>t.onMessage(n,i.type,i.payload),e.onError=i=>t.onError(n,i),t.onStart(n);try{await n.result}catch(i){console.error(`Worker exception: ${i}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!bg||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new ES({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return DY?this.maxMobileConcurrency:this.maxConcurrency}};const HY={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};let AO=(yf=class{constructor(e){xe(this,"props");xe(this,"workerPools",new Map);this.props={...HY},this.setProps(e),this.workerPools=new Map}static isSupported(){return ES.isSupported()}static getWorkerFarm(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return yf._workerFarm=yf._workerFarm||new yf({}),yf._workerFarm.setProps(e),yf._workerFarm}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const t of this.workerPools.values())t.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:t,source:n,url:i}=e;let s=this.workerPools.get(t);return s||(s=new zY({name:t,source:n,url:i}),s.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,s)),s}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}},xe(yf,"_workerFarm"),yf);function VY(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const t=e[r.id]||{},n=bg?`${r.id}-worker.js`:`${r.id}-worker-node.js`;let i=t.workerUrl;if(!i&&r.id==="compression"&&(i=e.workerUrl),e._workerType==="test"&&(bg?i=`modules/${r.module}/dist/${n}`:i=`modules/${r.module}/src/workers/${r.id}-worker-node.ts`),!i){let s=r.version;s==="latest"&&(s=FY);const a=s?`@${s}`:"";i=`https://unpkg.com/@loaders.gl/${r.module}${a}/dist/${n}`}return JA(i),i}function GY(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:LY;JA(r,"no worker provided");const t=r.version;return!(!e||!t)}function QY(r,e){return!AO.isSupported()||!bg&&!(e!=null&&e._nodeWorkers)?!1:r.worker&&(e==null?void 0:e.worker)}async function $Y(r,e,t,n,i){const s=r.id,a=VY(r,t),h=AO.getWorkerFarm(t).getWorkerPool({name:s,url:a});t=JSON.parse(JSON.stringify(t)),n=JSON.parse(JSON.stringify(n||{}));const f=await h.startJob("process-on-worker",jY.bind(null,i));return f.postMessage("process",{input:e,options:t,context:n}),await(await f.result).result}async function jY(r,e,t,n){switch(t){case"done":e.done(n);break;case"error":e.error(new Error(n.error));break;case"process":const{id:i,input:s,options:a}=n;try{const o=await r(s,a);e.postMessage("done",{id:i,result:o})}catch(o){const h=o instanceof Error?o.message:"unknown error";e.postMessage("error",{id:i,error:h})}break;default:console.warn(`parse-with-worker unknown message ${t}`)}}function qY(r,e,t){if(t=t||r.byteLength,r.byteLength<t||e.byteLength<t)return!1;const n=new Uint8Array(r),i=new Uint8Array(e);for(let s=0;s<n.length;++s)if(n[s]!==i[s])return!1;return!0}function KY(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];return WY(e)}function WY(r){const e=r.map(s=>s instanceof ArrayBuffer?new Uint8Array(s):s),t=e.reduce((s,a)=>s+a.byteLength,0),n=new Uint8Array(t);let i=0;for(const s of e)n.set(s,i),i+=s.byteLength;return n.buffer}async function XY(r){const e=[];for await(const t of r)e.push(t);return KY(...e)}function pO(){let r;if(typeof window<"u"&&window.performance)r=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();r=e[0]*1e3+e[1]/1e6}else r=Date.now();return r}let gO=class{constructor(e,t){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=pO(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(pO()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}},mO=class{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const t of Object.values(this.stats))e(t)}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(t=>this._getOrCreate(t))}_getOrCreate(e){const{name:t,type:n}=e;let i=this.stats[t];return i||(e instanceof gO?i=e:i=new gO(t,n),this.stats[t]=i),i}},JY="";const _O={};function ZY(r){for(const e in _O)if(r.startsWith(e)){const t=_O[e];r=r.replace(e,t)}return!r.startsWith("http://")&&!r.startsWith("https://")&&(r=`${JY}${r}`),r}function PWe(r){return r}function YY(r){return r&&typeof r=="object"&&r.isBuffer}function yO(r){if(YY(r))return r;if(r instanceof ArrayBuffer)return r;if(ArrayBuffer.isView(r))return r.byteOffset===0&&r.byteLength===r.buffer.byteLength?r.buffer:r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength);if(typeof r=="string"){const e=r;return new TextEncoder().encode(e).buffer}if(r&&typeof r=="object"&&r._toArrayBuffer)return r._toArrayBuffer();throw new Error("toArrayBuffer")}function bO(r){const e=r?r.lastIndexOf("/"):-1;return e>=0?r.substr(e+1):""}function eee(r){const e=r?r.lastIndexOf("/"):-1;return e>=0?r.substr(0,e):""}const tee=r=>typeof r=="boolean",s1=r=>typeof r=="function",o1=r=>r!==null&&typeof r=="object",vO=r=>o1(r)&&r.constructor==={}.constructor,ree=r=>!!r&&typeof r[Symbol.iterator]=="function",nee=r=>r&&typeof r[Symbol.asyncIterator]=="function",vg=r=>typeof Response<"u"&&r instanceof Response||r&&r.arrayBuffer&&r.text&&r.json,xg=r=>typeof Blob<"u"&&r instanceof Blob,iee=r=>r&&typeof r=="object"&&r.isBuffer,see=r=>typeof ReadableStream<"u"&&r instanceof ReadableStream||o1(r)&&s1(r.tee)&&s1(r.cancel)&&s1(r.getReader),oee=r=>o1(r)&&s1(r.read)&&s1(r.pipe)&&tee(r.readable),xO=r=>see(r)||oee(r);class aee extends Error{constructor(t,n){super(t);xe(this,"reason");xe(this,"url");xe(this,"response");this.reason=n.reason,this.url=n.url,this.response=n.response}}const lee=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,cee=/^([-\w.]+\/[-\w.+]+)/;function wO(r,e){return r.toLowerCase()===e.toLowerCase()}function uee(r){const e=cee.exec(r);return e?e[1]:r}function BO(r){const e=lee.exec(r);return e?e[1]:""}const CO=/\?.*/;function hee(r){const e=r.match(CO);return e&&e[0]}function TS(r){return r.replace(CO,"")}function dee(r){if(r.length<50)return r;const e=r.slice(r.length-15);return`${r.substr(0,32)}...${e}`}function Rx(r){return vg(r)?r.url:xg(r)?r.name||"":typeof r=="string"?r:""}function SS(r){if(vg(r)){const e=r,t=e.headers.get("content-type")||"",n=TS(e.url);return uee(t)||BO(n)}return xg(r)?r.type||"":typeof r=="string"?BO(r):""}function fee(r){return vg(r)?r.headers["content-length"]||-1:xg(r)?r.size:typeof r=="string"?r.length:r instanceof ArrayBuffer||ArrayBuffer.isView(r)?r.byteLength:-1}async function EO(r){if(vg(r))return r;const e={},t=fee(r);t>=0&&(e["content-length"]=String(t));const n=Rx(r),i=SS(r);i&&(e["content-type"]=i);const s=await gee(r);s&&(e["x-first-bytes"]=s),typeof r=="string"&&(r=new TextEncoder().encode(r));const a=new Response(r,{headers:e});return Object.defineProperty(a,"url",{value:n}),a}async function Aee(r){if(!r.ok)throw await pee(r)}async function pee(r){const e=dee(r.url);let t=`Failed to fetch resource (${r.status}) ${r.statusText}: ${e}`;t=t.length>100?`${t.slice(0,100)}...`:t;const n={reason:r.statusText,url:r.url,response:r};try{const i=r.headers.get("Content-Type");n.reason=!r.bodyUsed&&(i!=null&&i.includes("application/json"))?await r.json():await r.text()}catch{}return new aee(t,n)}async function gee(r){if(typeof r=="string")return`data:,${r.slice(0,5)}`;if(r instanceof Blob){const t=r.slice(0,5);return await new Promise(n=>{const i=new FileReader;i.onload=s=>{var a;return n((a=s==null?void 0:s.target)==null?void 0:a.result)},i.readAsDataURL(t)})}if(r instanceof ArrayBuffer){const t=r.slice(0,5);return`data:base64,${mee(t)}`}return null}function mee(r){let e="";const t=new Uint8Array(r);for(let n=0;n<t.byteLength;n++)e+=String.fromCharCode(t[n]);return btoa(e)}function _ee(r){return!yee(r)&&!bee(r)}function yee(r){return r.startsWith("http:")||r.startsWith("https:")}function bee(r){return r.startsWith("data:")}async function TO(r,e){var t,n;if(typeof r=="string"){const i=ZY(r);return _ee(i)&&(t=globalThis.loaders)!=null&&t.fetchNode?(n=globalThis.loaders)==null?void 0:n.fetchNode(i,e):await fetch(i,e)}return await EO(r)}const SO=new Fx({id:"loaders.gl"});let vee=class{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}},xee=class{constructor(){xe(this,"console");this.console=console}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.console.log.bind(this.console,...t)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.console.info.bind(this.console,...t)}warn(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.console.warn.bind(this.console,...t)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.console.error.bind(this.console,...t)}};const IO={fetch:null,mimeType:void 0,nothrow:!1,log:new xee,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:yS,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},wee={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function MO(){globalThis.loaders=globalThis.loaders||{};const{loaders:r}=globalThis;return r._state||(r._state={}),r._state}function PO(){const r=MO();return r.globalOptions=r.globalOptions||{...IO},r.globalOptions}function Bee(r,e,t,n){return t=t||[],t=Array.isArray(t)?t:[t],Cee(r,t),Tee(e,r,n)}function Cee(r,e){FO(r,null,IO,wee,e);for(const t of e){const n=r&&r[t.id]||{},i=t.options&&t.options[t.id]||{},s=t.deprecatedOptions&&t.deprecatedOptions[t.id]||{};FO(n,t.id,i,s,e)}}function FO(r,e,t,n,i){const s=e||"Top level",a=e?`${e}.`:"";for(const o in r){const h=!e&&o1(r[o]),f=o==="baseUri"&&!e,_=o==="workerUrl"&&e;if(!(o in t)&&!f&&!_){if(o in n)SO.warn(`${s} loader option '${a}${o}' no longer supported, use '${n[o]}'`)();else if(!h){const x=Eee(o,i);SO.warn(`${s} loader option '${a}${o}' not recognized. ${x}`)()}}}}function Eee(r,e){const t=r.toLowerCase();let n="";for(const i of e)for(const s in i.options){if(r===s)return`Did you mean '${i.id}.${s}'?`;const a=s.toLowerCase();(t.startsWith(a)||a.startsWith(t))&&(n=n||`Did you mean '${i.id}.${s}'?`)}return n}function Tee(r,e,t){const i={...r.options||{}};return See(i,t),i.log===null&&(i.log=new vee),RO(i,PO()),RO(i,e),i}function RO(r,e){for(const t in e)if(t in e){const n=e[t];vO(n)&&vO(r[t])?r[t]={...r[t],...e[t]}:r[t]=e[t]}}function See(r,e){e&&!("baseUri"in r)&&(r.baseUri=e)}function IS(r){return r?(Array.isArray(r)&&(r=r[0]),Array.isArray(r==null?void 0:r.extensions)):!1}function MS(r){Ix(r,"null loader"),Ix(IS(r),"invalid loader");let e;return Array.isArray(r)&&(e=r[1],r=r[0],r={...r,options:{...r.options,...e}}),(r!=null&&r.parseTextSync||r!=null&&r.parseText)&&(r.text=!0),r.text||(r.binary=!0),r}const LO=()=>{const r=MO();return r.loaderRegistry=r.loaderRegistry||[],r.loaderRegistry};function Iee(r){const e=LO();r=Array.isArray(r)?r:[r];for(const t of r){const n=MS(t);e.find(i=>n===i)||e.unshift(n)}}function Mee(){return LO()}const Pee=/\.([^.]+)$/;async function Fee(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],t=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;if(!OO(r))return null;let i=DO(r,e,{...t,nothrow:!0},n);if(i)return i;if(xg(r)&&(r=await r.slice(0,10).arrayBuffer(),i=DO(r,e,t,n)),!i&&!(t!=null&&t.nothrow))throw new Error(kO(r));return i}function DO(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],t=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;if(!OO(r))return null;if(e&&!Array.isArray(e))return MS(e);let i=[];e&&(i=i.concat(e)),t!=null&&t.ignoreRegisteredLoaders||i.push(...Mee()),Lee(i);const s=Ree(r,i,t,n);if(!s&&!(t!=null&&t.nothrow))throw new Error(kO(r));return s}function Ree(r,e,t,n){const i=Rx(r),s=SS(r),a=TS(i)||(n==null?void 0:n.url);let o=null,h="";return t!=null&&t.mimeType&&(o=PS(e,t==null?void 0:t.mimeType),h=`match forced by supplied MIME type ${t==null?void 0:t.mimeType}`),o=o||Dee(e,a),h=h||(o?`matched url ${a}`:""),o=o||PS(e,s),h=h||(o?`matched MIME type ${s}`:""),o=o||kee(e,r),h=h||(o?`matched initial data ${NO(r)}`:""),t!=null&&t.fallbackMimeType&&(o=o||PS(e,t==null?void 0:t.fallbackMimeType),h=h||(o?`matched fallback MIME type ${s}`:"")),h&&MY.log(1,`selectLoader selected ${o==null?void 0:o.name}: ${h}.`),o}function OO(r){return!(r instanceof Response&&r.status===204)}function kO(r){const e=Rx(r),t=SS(r);let n="No valid loader found (";n+=e?`${bO(e)}, `:"no url provided, ",n+=`MIME type: ${t?`"${t}"`:"not provided"}, `;const i=r?NO(r):"";return n+=i?` first bytes: "${i}"`:"first bytes: not available",n+=")",n}function Lee(r){for(const e of r)MS(e)}function Dee(r,e){const t=e&&Pee.exec(e),n=t&&t[1];return n?Oee(r,n):null}function Oee(r,e){e=e.toLowerCase();for(const t of r)for(const n of t.extensions)if(n.toLowerCase()===e)return t;return null}function PS(r,e){var t;for(const n of r)if((t=n.mimeTypes)!=null&&t.some(i=>wO(e,i))||wO(e,`application/x.${n.id}`))return n;return null}function kee(r,e){if(!e)return null;for(const t of r)if(typeof e=="string"){if(Uee(e,t))return t}else if(ArrayBuffer.isView(e)){if(UO(e.buffer,e.byteOffset,t))return t}else if(e instanceof ArrayBuffer&&UO(e,0,t))return t;return null}function Uee(r,e){return e.testText?e.testText(r):(Array.isArray(e.tests)?e.tests:[e.tests]).some(n=>r.startsWith(n))}function UO(r,e,t){return(Array.isArray(t.tests)?t.tests:[t.tests]).some(i=>Nee(r,e,t,i))}function Nee(r,e,t,n){if(n instanceof ArrayBuffer)return qY(n,r,n.byteLength);switch(typeof n){case"function":return n(r);case"string":const i=FS(r,e,n.length);return n===i;default:return!1}}function NO(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof r=="string"?r.slice(0,e):ArrayBuffer.isView(r)?FS(r.buffer,r.byteOffset,e):r instanceof ArrayBuffer?FS(r,0,e):""}function FS(r,e,t){if(r.byteLength<e+t)return"";const n=new DataView(r);let i="";for(let s=0;s<t;s++)i+=String.fromCharCode(n.getUint8(e+s));return i}const zee=256*1024;function*Hee(r,e){const t=(e==null?void 0:e.chunkSize)||zee;let n=0;const i=new TextEncoder;for(;n<r.length;){const s=Math.min(r.length-n,t),a=r.slice(n,n+s);n+=s,yield i.encode(a)}}const Vee=256*1024;function Gee(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){const{chunkSize:t=Vee}=e;let n=0;for(;n<r.byteLength;){const i=Math.min(r.byteLength-n,t),s=new ArrayBuffer(i),a=new Uint8Array(r,n,i);new Uint8Array(s).set(a),n+=i,yield s}}()}const Qee=1024*1024;async function*$ee(r,e){const t=(e==null?void 0:e.chunkSize)||Qee;let n=0;for(;n<r.size;){const i=n+t,s=await r.slice(n,i).arrayBuffer();n=i,yield s}}function zO(r,e){return yS?jee(r,e):qee(r)}async function*jee(r,e){const t=r.getReader();let n;try{for(;;){const i=n||t.read();e!=null&&e._streamReadAhead&&(n=t.read());const{done:s,value:a}=await i;if(s)return;yield yO(a)}}catch{t.releaseLock()}}async function*qee(r,e){for await(const t of r)yield yO(t)}function Kee(r,e){if(typeof r=="string")return Hee(r,e);if(r instanceof ArrayBuffer)return Gee(r,e);if(xg(r))return $ee(r,e);if(xO(r))return zO(r,e);if(vg(r))return zO(r.body,e);throw new Error("makeIterator")}const HO="Cannot convert supplied data type";function Wee(r,e,t){if(e.text&&typeof r=="string")return r;if(iee(r)&&(r=r.buffer),r instanceof ArrayBuffer){const n=r;return e.text&&!e.binary?new TextDecoder("utf8").decode(n):n}if(ArrayBuffer.isView(r)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(r);let n=r.buffer;const i=r.byteLength||r.length;return(r.byteOffset!==0||i!==n.byteLength)&&(n=n.slice(r.byteOffset,r.byteOffset+i)),n}throw new Error(HO)}async function Xee(r,e,t){const n=r instanceof ArrayBuffer||ArrayBuffer.isView(r);if(typeof r=="string"||n)return Wee(r,e);if(xg(r)&&(r=await EO(r)),vg(r)){const i=r;return await Aee(i),e.binary?await i.arrayBuffer():await i.text()}if(xO(r)&&(r=Kee(r,t)),ree(r)||nee(r))return XY(r);throw new Error(HO)}function VO(r,e){const t=PO(),n=r||t;return typeof n.fetch=="function"?n.fetch:o1(n.fetch)?i=>TO(i,n.fetch):e!=null&&e.fetch?e==null?void 0:e.fetch:TO}function Jee(r,e,t){if(t)return t;const n={fetch:VO(e,r),...r};if(n.url){const i=TS(n.url);n.baseUrl=i,n.queryString=hee(n.url),n.filename=bO(i),n.baseUrl=eee(i)}return Array.isArray(n.loaders)||(n.loaders=null),n}function Zee(r,e){if(r&&!Array.isArray(r))return r;let t;if(r&&(t=Array.isArray(r)?r:[r]),e&&e.loaders){const n=Array.isArray(e.loaders)?e.loaders:[e.loaders];t=t?[...t,...n]:n}return t&&t.length?t:void 0}async function Lx(r,e,t,n){e&&!Array.isArray(e)&&!IS(e)&&(n=void 0,t=e,e=void 0),r=await r,t=t||{};const i=Rx(r),a=Zee(e,n),o=await Fee(r,a,t);return o?(t=Bee(t,o,a,i),n=Jee({url:i,_parse:Lx,loaders:a},t,n||null),await Yee(o,r,t,n)):null}async function Yee(r,e,t,n){if(GY(r),t=PY(r.options,t),vg(e)){const s=e,{ok:a,redirected:o,status:h,statusText:f,type:_,url:x}=s,T=Object.fromEntries(s.headers.entries());n.response={headers:T,ok:a,redirected:o,status:h,statusText:f,type:_,url:x}}e=await Xee(e,r,t);const i=r;if(i.parseTextSync&&typeof e=="string")return i.parseTextSync(e,t,n);if(QY(r,t))return await $Y(r,e,t,n,Lx);if(i.parseText&&typeof e=="string")return await i.parseText(e,t,n);if(i.parse)return await i.parse(e,t,n);throw JA(!i.parseSync),new Error(`${r.id} loader - no parser found and worker is disabled`)}async function RS(r,e,t,n){let i,s;!Array.isArray(e)&&!IS(e)?(i=[],s=e):(i=e,s=t);const a=VO(s);let o=r;return typeof r=="string"&&(o=await a(r)),xg(r)&&(o=await a(r)),Array.isArray(i)?await Lx(o,i,s):await Lx(o,i,s)}const ete="4.3.2",tte=(bZ=globalThis.loaders)==null?void 0:bZ.parseImageNode,LS=typeof Image<"u",DS=typeof ImageBitmap<"u",OS=yS?!0:!!tte;function rte(r){switch(r){case"auto":return DS||LS||OS;case"imagebitmap":return DS;case"image":return LS;case"data":return OS;default:throw new Error(`@loaders.gl/images: image ${r} not supported in this environment`)}}function nte(){if(DS)return"imagebitmap";if(LS)return"image";if(OS)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function ite(r){const e=ote(r);if(!e)throw new Error("Not an image");return e}function ste(r){switch(ite(r)){case"data":return r;case"image":case"imagebitmap":const e=document.createElement("canvas"),t=e.getContext("2d");if(!t)throw new Error("getImageData");return e.width=r.width,e.height=r.height,t.drawImage(r,0,0),t.getImageData(0,0,r.width,r.height);default:throw new Error("getImageData")}}function ote(r){return typeof ImageBitmap<"u"&&r instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&r instanceof Image?"image":r&&typeof r=="object"&&r.data&&r.width&&r.height?"data":null}const ate=/^data:image\/svg\+xml/,lte=/\.svg((\?|#).*)?$/;function kS(r){return r&&(ate.test(r)||lte.test(r))}function cte(r,e){if(kS(e)){let n=new TextDecoder().decode(r);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(n=unescape(encodeURIComponent(n)))}catch(s){throw new Error(s.message)}return`data:image/svg+xml;base64,${btoa(n)}`}return GO(r,e)}function GO(r,e){if(kS(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(r)])}async function QO(r,e,t){const n=cte(r,t),i=self.URL||self.webkitURL,s=typeof n!="string"&&i.createObjectURL(n);try{return await ute(s||n,e)}finally{s&&i.revokeObjectURL(s)}}async function ute(r,e){const t=new Image;return t.src=r,e.image&&e.image.decode&&t.decode?(await t.decode(),t):await new Promise((n,i)=>{try{t.onload=()=>n(t),t.onerror=s=>{const a=s instanceof Error?s.message:"error";i(new Error(a))}}catch(s){i(s)}})}const hte={};let $O=!0;async function dte(r,e,t){let n;kS(t)?n=await QO(r,e,t):n=GO(r,t);const i=e&&e.imagebitmap;return await fte(n,i)}async function fte(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if((Ate(e)||!$O)&&(e=null),e)try{return await createImageBitmap(r,e)}catch(t){console.warn(t),$O=!1}return await createImageBitmap(r)}function Ate(r){for(const e in r||hte)return!1;return!0}function pte(r){return!yte(r,"ftyp",4)||!(r[8]&96)?null:gte(r)}function gte(r){switch(mte(r,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function mte(r,e,t){return String.fromCharCode(...r.slice(e,t))}function _te(r){return[...r].map(e=>e.charCodeAt(0))}function yte(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const n=_te(e);for(let i=0;i<n.length;++i)if(n[i]!==r[i+t])return!1;return!0}const Of=!1,a1=!0;function jO(r){const e=l1(r);return vte(e)||Bte(e)||xte(e)||wte(e)||bte(e)}function bte(r){const e=new Uint8Array(r instanceof DataView?r.buffer:r),t=pte(e);return t?{mimeType:t.mimeType,width:0,height:0}:null}function vte(r){const e=l1(r);return e.byteLength>=24&&e.getUint32(0,Of)===2303741511?{mimeType:"image/png",width:e.getUint32(16,Of),height:e.getUint32(20,Of)}:null}function xte(r){const e=l1(r);return e.byteLength>=10&&e.getUint32(0,Of)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,a1),height:e.getUint16(8,a1)}:null}function wte(r){const e=l1(r);return e.byteLength>=14&&e.getUint16(0,Of)===16973&&e.getUint32(2,a1)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,a1),height:e.getUint32(22,a1)}:null}function Bte(r){const e=l1(r);if(!(e.byteLength>=3&&e.getUint16(0,Of)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:n,sofMarkers:i}=Cte();let s=2;for(;s+9<e.byteLength;){const a=e.getUint16(s,Of);if(i.has(a))return{mimeType:"image/jpeg",height:e.getUint16(s+5,Of),width:e.getUint16(s+7,Of)};if(!n.has(a))return null;s+=2,s+=e.getUint16(s,Of)}return null}function Cte(){const r=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)r.add(t);return{tableMarkers:r,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function l1(r){if(r instanceof DataView)return r;if(ArrayBuffer.isView(r))return new DataView(r.buffer);if(r instanceof ArrayBuffer)return new DataView(r);throw new Error("toDataView")}async function Ete(r,e){var i;const{mimeType:t}=jO(r)||{},n=(i=globalThis.loaders)==null?void 0:i.parseImageNode;return Ix(n),await n(r,t)}async function Tte(r,e,t){e=e||{};const i=(e.image||{}).type||"auto",{url:s}=t||{},a=Ste(i);let o;switch(a){case"imagebitmap":o=await dte(r,e,s);break;case"image":o=await QO(r,e,s);break;case"data":o=await Ete(r);break;default:Ix(!1)}return i==="data"&&(o=ste(o)),o}function Ste(r){switch(r){case"auto":case"data":return nte();default:return rte(r),r}}const Ite={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:ete,mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],parse:Tte,tests:[r=>!!jO(new DataView(r))],options:{image:{type:"auto",decode:!0}}},Es=new Fx({id:"deck"}),ZA={attributeUpdateStart:-1,attributeManagerUpdateStart:-1,attributeUpdateMessages:[]},US=1,c1=2,NS=3,zS=4,Mte=2,Pte=r=>({"layer.changeFlag":(e,t,n)=>{r.log(NS,`${e.id} ${t}: `,n[t])()},"layer.initialize":e=>{r.log(US,`Initializing ${e}`)()},"layer.update":(e,t)=>{if(t){const n=e.getChangeFlags();r.log(c1,`Updating ${e} because: ${Object.keys(n).filter(i=>n[i]).join(", ")}`)()}else r.log(zS,`${e} does not need update`)()},"layer.matched":(e,t)=>{t&&r.log(zS,`Matched ${e}, state transfered`)()},"layer.finalize":e=>{r.log(US,`Finalizing ${e}`)()},"compositeLayer.renderLayers":(e,t,n)=>{t?r.log(c1,`Composite layer rendered new subLayers ${e}`,n)():r.log(zS,`Composite layer reused subLayers ${e}`,n)()},"layerManager.setLayers":(e,t,n)=>{t&&r.log(c1,`Updating ${n.length} deck layers`)()},"layerManager.activateViewport":(e,t)=>{r.log(NS,"Viewport changed",t)()},"attributeManager.invalidate":(e,t,n)=>{r.log(US,n?`invalidated attributes ${n} (${t}) for ${e.id}`:`invalidated all attributes for ${e.id}`)()},"attributeManager.updateStart":e=>{ZA.attributeUpdateMessages.length=0,ZA.attributeManagerUpdateStart=Date.now()},"attributeManager.updateEnd":(e,t)=>{const n=Math.round(Date.now()-ZA.attributeManagerUpdateStart);r.groupCollapsed(c1,`Updated attributes for ${t} instances in ${e.id} in ${n}ms`)();for(const i of ZA.attributeUpdateMessages)r.log(NS,i)();r.groupEnd(c1)()},"attribute.updateStart":e=>{ZA.attributeUpdateStart=Date.now()},"attribute.allocate":(e,t)=>{const n=`${e.id} allocated ${t}`;ZA.attributeUpdateMessages.push(n)},"attribute.updateEnd":(e,t)=>{const n=Math.round(Date.now()-ZA.attributeUpdateStart),i=`${e.id} updated ${t} in ${n}ms`;ZA.attributeUpdateMessages.push(i)},"deckRenderer.renderLayers":(e,t,n)=>{const{pass:i,redrawReason:s,stats:a}=n;for(const o of t){const{totalCount:h,visibleCount:f,compositeCount:_,pickableCount:x}=o,I=h-_-f;r.log(Mte,`RENDER #${e.renderCount}   ${f} (of ${h} layers) to ${i} because ${s}   (${I} hidden, ${_} composite ${x} pickable)`)(),a&&a.get("Redraw Layers").add(f)}}});var Fte={};let Dx={};Fte.NODE_ENV!=="production"&&(Dx=Pte(Es));function Rte(r){Dx=r}function Wc(r,e,t,n){Es.level>0&&Dx[r]&&Dx[r].call(null,e,t,n)}function Lte(r){const e=r[0],t=r[r.length-1];return e==="{"&&t==="}"||e==="["&&t==="]"}const Dte={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:Lte,parseTextSync:JSON.parse};function Ote(){const r="9.1.3",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==r)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${r}`);return e||(Es.log(1,`deck.gl ${r}`)(),globalThis.deck={...globalThis.deck,VERSION:r,version:r,log:Es,_registerLoggers:Rte},Iee([Dte,[Ite,{imagebitmap:{premultiplyAlpha:"none"}}]])),r}const kte=Ote();function HS(r,e){if(!r)throw new Error(e||"shadertools: assertion failed.")}const VS={number:{type:"number",validate(r,e){return Number.isFinite(r)&&typeof e=="object"&&(e.max===void 0||r<=e.max)&&(e.min===void 0||r>=e.min)}},array:{type:"array",validate(r,e){return Array.isArray(r)||ArrayBuffer.isView(r)}}};function Ute(r){const e={};for(const[t,n]of Object.entries(r))e[t]=Nte(n);return e}function Nte(r){let e=qO(r);if(e!=="object")return{value:r,...VS[e],type:e};if(typeof r=="object")return r?r.type!==void 0?{...r,...VS[r.type],type:r.type}:r.value===void 0?{type:"object",value:r}:(e=qO(r.value),{...r,...VS[e],type:e}):{type:"object",value:null};throw new Error("props")}function qO(r){return Array.isArray(r)||ArrayBuffer.isView(r)?"array":typeof r}const zte={vertex:`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,fragment:`#ifdef MODULE_MATERIAL
  fragColor = material_filterColor(fragColor);
#endif

#ifdef MODULE_LIGHTING
  fragColor = lighting_filterColor(fragColor);
#endif

#ifdef MODULE_FOG
  fragColor = fog_filterColor(fragColor);
#endif

#ifdef MODULE_PICKING
  fragColor = picking_filterHighlightColor(fragColor);
  fragColor = picking_filterPickingColor(fragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`},KO=/void\s+main\s*\([^)]*\)\s*\{\n?/,WO=/}\n?[^{}]*$/,GS=[],Ox="__LUMA_INJECT_DECLARATIONS__";function Hte(r){const e={vertex:{},fragment:{}};for(const t in r){let n=r[t];const i=Vte(t);typeof n=="string"&&(n={order:0,injection:n}),e[i][t]=n}return e}function Vte(r){const e=r.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function kx(r,e,t){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const i=e==="vertex";for(const s in t){const a=t[s];a.sort((h,f)=>h.order-f.order),GS.length=a.length;for(let h=0,f=a.length;h<f;++h)GS[h]=a[h].injection;const o=`${GS.join(`
`)}
`;switch(s){case"vs:#decl":i&&(r=r.replace(Ox,o));break;case"vs:#main-start":i&&(r=r.replace(KO,h=>h+o));break;case"vs:#main-end":i&&(r=r.replace(WO,h=>o+h));break;case"fs:#decl":i||(r=r.replace(Ox,o));break;case"fs:#main-start":i||(r=r.replace(KO,h=>h+o));break;case"fs:#main-end":i||(r=r.replace(WO,h=>o+h));break;default:r=r.replace(s,h=>h+o)}}return r=r.replace(Ox,""),n&&(r=r.replace(/\}\s*$/,s=>s+zte[e])),r}function Ux(r){r.map(e=>Gte(e))}function Gte(r){if(r.instance)return;Ux(r.dependencies||[]);const{propTypes:e={},deprecations:t=[],inject:n={}}=r,i={normalizedInjections:Hte(n),parsedDeprecations:Qte(t)};e&&(i.propValidators=Ute(e)),r.instance=i;let s={};e&&(s=Object.entries(e).reduce((a,o)=>{let[h,f]=o;const _=f==null?void 0:f.value;return _&&(a[h]=_),a},{})),r.defaultUniforms={...r.defaultUniforms,...s}}function XO(r,e,t){var n;(n=r.deprecations)==null||n.forEach(i=>{var s;(s=i.regex)!=null&&s.test(e)&&(i.deprecated?t.deprecated(i.old,i.new)():t.removed(i.old,i.new)())})}function Qte(r){return r.forEach(e=>{switch(e.type){case"function":e.regex=new RegExp(`\\b${e.old}\\(`);break;default:e.regex=new RegExp(`${e.type} ${e.old};`)}}),r}function QS(r){Ux(r);const e={},t={};JO({modules:r,level:0,moduleMap:e,moduleDepth:t});const n=Object.keys(t).sort((i,s)=>t[s]-t[i]).map(i=>e[i]);return Ux(n),n}function JO(r){const{modules:e,level:t,moduleMap:n,moduleDepth:i}=r;if(t>=5)throw new Error("Possible loop in shader dependency graph");for(const s of e)n[s.name]=s,(i[s.name]===void 0||i[s.name]<t)&&(i[s.name]=t);for(const s of e)s.dependencies&&JO({modules:s.dependencies,level:t+1,moduleMap:n,moduleDepth:i})}function $te(r){switch(r==null?void 0:r.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
// Apple optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Headless Chrome's software shader 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// If the GPU doesn't have full 32 bits precision, will causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function jte(r,e){var n;if(Number(((n=r.match(/^#version[ \t]+(\d+)/m))==null?void 0:n[1])||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return r=YO(r,qte),r;case"fragment":return r=YO(r,Kte),r;default:throw new Error(e)}}const ZO=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],qte=[...ZO,[$S("attribute"),"in $1"],[$S("varying"),"out $1"]],Kte=[...ZO,[$S("varying"),"in $1"]];function YO(r,e){for(const[t,n]of e)r=r.replace(t,n);return r}function $S(r){return new RegExp(`\\b${r}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function ek(r,e){let t="";for(const n in r){const i=r[n];if(t+=`void ${i.signature} {
`,i.header&&(t+=`  ${i.header}`),e[n]){const s=e[n];s.sort((a,o)=>a.order-o.order);for(const a of s)t+=`  ${a.injection}
`}i.footer&&(t+=`  ${i.footer}`),t+=`}
`}return t}function tk(r){const e={vertex:{},fragment:{}};for(const t of r){let n,i;typeof t!="string"?(n=t,i=n.hook):(n={},i=t),i=i.trim();const[s,a]=i.split(":"),o=i.replace(/\(.+/,""),h=Object.assign(n,{signature:a});switch(s){case"vs":e.vertex[o]=h;break;case"fs":e.fragment[o]=h;break;default:throw new Error(s)}}return e}function Wte(r,e){return{name:Xte(r,e),language:"glsl",version:Jte(r)}}function Xte(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"unnamed";const n=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(r);return n?n[1]:e}function Jte(r){let e=100;const t=r.match(/[^\s]+/g);if(t&&t.length>=2&&t[0]==="#version"){const n=parseInt(t[1],10);Number.isFinite(n)&&(e=n)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}const rk=`

${Ox}
`,Zte=`precision highp float;
`;function Yte(r){const e=QS(r.modules||[]);return{source:tre(r.platformInfo,{...r,source:r.source,stage:"vertex",modules:e}),getUniforms:ik(e)}}function ere(r){const{vs:e,fs:t}=r,n=QS(r.modules||[]);return{vs:nk(r.platformInfo,{...r,source:e,stage:"vertex",modules:n}),fs:nk(r.platformInfo,{...r,source:t,stage:"fragment",modules:n}),getUniforms:ik(n)}}function tre(r,e){var $;const{source:t,stage:n,modules:i,hookFunctions:s=[],inject:a={},log:o}=e;HS(typeof t=="string","shader source must be a string");const h=t;let f="";const _=tk(s),x={},T={},I={};for(const W in a){const Y=typeof a[W]=="string"?{injection:a[W],order:0}:a[W],ie=/^(v|f)s:(#)?([\w-]+)$/.exec(W);if(ie){const ce=ie[2],fe=ie[3];ce?fe==="decl"?T[W]=[Y]:I[W]=[Y]:x[W]=[Y]}else I[W]=[Y]}const N=i;for(const W of N){o&&XO(W,h,o);const Y=sk(W,"wgsl");f+=Y;const ie=(($=W.injections)==null?void 0:$[n])||{};for(const ce in ie){const fe=/^(v|f)s:#([\w-]+)$/.exec(ce);if(fe){const be=fe[2]==="decl"?T:I;be[ce]=be[ce]||[],be[ce].push(ie[ce])}else x[ce]=x[ce]||[],x[ce].push(ie[ce])}}return f+=rk,f=kx(f,n,T),f+=ek(_[n],x),f+=h,f=kx(f,n,I),f}function nk(r,e){var Qe;const{id:t,source:n,stage:i,language:s="glsl",modules:a,defines:o={},hookFunctions:h=[],inject:f={},prologue:_=!0,log:x}=e;HS(typeof n=="string","shader source must be a string");const T=s==="glsl"?Wte(n).version:-1,I=r.shaderLanguageVersion,N=T===100?"#version 100":"#version 300 es",W=n.split(`
`).slice(1).join(`
`),Y={};a.forEach(Ue=>{Object.assign(Y,Ue.defines)}),Object.assign(Y,o);let ie="";switch(s){case"wgsl":break;case"glsl":ie=_?`${N}

// ----- PROLOGUE -------------------------
${rre({id:t,source:n,stage:i})}
${`#define SHADER_TYPE_${i.toUpperCase()}`}

${$te(r)}
${i==="fragment"?Zte:""}

// ----- APPLICATION DEFINES -------------------------

${nre(Y)}

`:`${N}
`;break}const ce=tk(h),fe={},ve={},be={};for(const Ue in f){const st=typeof f[Ue]=="string"?{injection:f[Ue],order:0}:f[Ue],at=/^(v|f)s:(#)?([\w-]+)$/.exec(Ue);if(at){const Le=at[2],ze=at[3];Le?ze==="decl"?ve[Ue]=[st]:be[Ue]=[st]:fe[Ue]=[st]}else be[Ue]=[st]}for(const Ue of a){x&&XO(Ue,W,x);const st=sk(Ue,i);ie+=st;const at=((Qe=Ue.instance)==null?void 0:Qe.normalizedInjections[i])||{};for(const Le in at){const ze=/^(v|f)s:#([\w-]+)$/.exec(Le);if(ze){const Ne=ze[2]==="decl"?ve:be;Ne[Le]=Ne[Le]||[],Ne[Le].push(at[Le])}else fe[Le]=fe[Le]||[],fe[Le].push(at[Le])}}return ie+="// ----- MAIN SHADER SOURCE -------------------------",ie+=rk,ie=kx(ie,i,ve),ie+=ek(ce[i],fe),ie+=W,ie=kx(ie,i,be),s==="glsl"&&T!==I&&(ie=jte(ie,i)),ie.trim()}function ik(r){return function(t){var i;const n={};for(const s of r){const a=(i=s.getUniforms)==null?void 0:i.call(s,t,n);Object.assign(n,a)}return n}}function rre(r){const{id:e,source:t,stage:n}=r;return e&&t.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${e}_${n}`:""}function nre(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e="";for(const t in r){const n=r[t];(n||Number.isFinite(n))&&(e+=`#define ${t.toUpperCase()} ${r[t]}
`)}return e}function sk(r,e){let t;switch(e){case"vertex":t=r.vs||"";break;case"fragment":t=r.fs||"";break;case"wgsl":t=r.source||"";break;default:HS(!1)}if(!r.name)throw new Error("Shader module must have a name");const n=r.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");let i=`// ----- MODULE ${r.name} ---------------

`;return e!=="wgsl"&&(i+=`#define MODULE_${n}
`),i+=`${t}
`,i}const ire=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,sre=/^\s*\#\s*endif\s*$/;function ore(r,e){var a;const t=r.split(`
`),n=[];let i=!0,s=null;for(const o of t){const h=o.match(ire),f=o.match(sre);h?(s=h[1],i=!!((a=e==null?void 0:e.defines)!=null&&a[s])):f?i=!0:i&&n.push(o)}return n.join(`
`)}const Mm=class Mm{constructor(){xe(this,"_hookFunctions",[]);xe(this,"_defaultModules",[])}static getDefaultShaderAssembler(){return Mm.defaultShaderAssembler=Mm.defaultShaderAssembler||new Mm,Mm.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(t=>t.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const t=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(n=>n.name!==t)}addShaderHook(e,t){t&&(e=Object.assign(t,{hook:e})),this._hookFunctions.push(e)}assembleWGSLShader(e){const t=this._getModuleList(e.modules),n=this._hookFunctions,{source:i,getUniforms:s}=Yte({...e,source:e.source,modules:t,hookFunctions:n});return{source:e.platformInfo.shaderLanguage==="wgsl"?ore(i):i,getUniforms:s,modules:t}}assembleGLSLShaderPair(e){const t=this._getModuleList(e.modules),n=this._hookFunctions;return{...ere({...e,vs:e.vs,fs:e.fs,modules:t,hookFunctions:n}),modules:t}}_getModuleList(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const t=new Array(this._defaultModules.length+e.length),n={};let i=0;for(let s=0,a=this._defaultModules.length;s<a;++s){const o=this._defaultModules[s],h=o.name;t[i++]=o,n[h]=!0}for(let s=0,a=e.length;s<a;++s){const o=e[s],h=o.name;n[h]||(t[i++]=o,n[h]=!0)}return t.length=i,Ux(t),t}};xe(Mm,"defaultShaderAssembler");let Nx=Mm;const are=`#version 300 es
out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`;function lre(r){const{input:e,inputChannels:t,output:n}={};if(!e)return are;if(!t)throw new Error("inputChannels");const i=cre(t),s=ure(e,t);return`#version 300 es
in ${i} ${e};
out vec4 ${n};
void main() {
  ${n} = ${s};
}`}function cre(r){switch(r){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${r}`)}}function ure(r,e){switch(e){case 1:return`vec4(${r}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${r}, 0.0, 1.0)`;case 3:return`vec4(${r}, 1.0)`;case 4:return r;default:throw new Error(`invalid channels: ${e}`)}}const zx=globalThis,m_=globalThis.process||{};function hre(r){var n,i;if(typeof window<"u"&&((n=window.process)==null?void 0:n.type)==="renderer"||typeof process<"u"&&((i=process.versions)!=null&&i.electron))return!0;const t=typeof navigator<"u"&&navigator.userAgent;return!!(t&&t.indexOf("Electron")>=0)}function u1(){return!(typeof process=="object"&&String(process)==="[object process]"&&!(process!=null&&process.browser))||hre()}const ok="4.0.7";function ak(){let r;if(typeof window<"u"&&window.performance)r=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();r=e[0]*1e3+e[1]/1e6}else r=Date.now();return r}let lk=class{constructor(e,t){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=ak(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(ak()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}},dre=class{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const t of Object.values(this.stats))e(t)}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(t=>this._getOrCreate(t))}_getOrCreate(e){const{name:t,type:n}=e;let i=this.stats[t];return i||(e instanceof lk?i=e:i=new lk(t,n),this.stats[t]=i),i}};class fre{constructor(){xe(this,"stats",new Map)}getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new dre({id:e})),this.stats.get(e)}}const ck=new fre;function Are(r){try{const e=window[r],t="__storage_test__";return e.setItem(t,t),e.removeItem(t),e}catch{return null}}let pre=class{constructor(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";this.storage=Are(n),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}};function gre(r){let e;return r<10?e=`${r.toFixed(2)}ms`:r<100?e=`${r.toFixed(1)}ms`:r<1e3?e=`${r.toFixed(0)}ms`:e=`${(r/1e3).toFixed(2)}s`,e}function mre(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const t=Math.max(e-r.length,0);return`${" ".repeat(t)}${r}`}var Hx;(function(r){r[r.BLACK=30]="BLACK",r[r.RED=31]="RED",r[r.GREEN=32]="GREEN",r[r.YELLOW=33]="YELLOW",r[r.BLUE=34]="BLUE",r[r.MAGENTA=35]="MAGENTA",r[r.CYAN=36]="CYAN",r[r.WHITE=37]="WHITE",r[r.BRIGHT_BLACK=90]="BRIGHT_BLACK",r[r.BRIGHT_RED=91]="BRIGHT_RED",r[r.BRIGHT_GREEN=92]="BRIGHT_GREEN",r[r.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",r[r.BRIGHT_BLUE=94]="BRIGHT_BLUE",r[r.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",r[r.BRIGHT_CYAN=96]="BRIGHT_CYAN",r[r.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Hx||(Hx={}));const _re=10;function uk(r){return typeof r!="string"?r:(r=r.toUpperCase(),Hx[r]||Hx.WHITE)}function yre(r,e,t){return!u1&&typeof r=="string"&&(e&&(r=`\x1B[${uk(e)}m${r}\x1B[39m`),t&&(r=`\x1B[${uk(t)+_re}m${r}\x1B[49m`)),r}function bre(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const t=Object.getPrototypeOf(r),n=Object.getOwnPropertyNames(t),i=r;for(const s of n){const a=i[s];typeof a=="function"&&(e.find(o=>s===o)||(i[s]=a.bind(r)))}}function jS(r,e){if(!r)throw new Error("Assertion failed")}function __(){var e,t,n;let r;if(u1()&&zx.performance)r=(t=(e=zx==null?void 0:zx.performance)==null?void 0:e.now)==null?void 0:t.call(e);else if("hrtime"in m_){const i=(n=m_==null?void 0:m_.hrtime)==null?void 0:n.call(m_);r=i[0]*1e3+i[1]/1e6}else r=Date.now();return r}const y_={debug:u1()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},vre={enabled:!0,level:0};function b_(){}const hk={},dk={once:!0};let fk=class{constructor(){let{id:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};this.VERSION=ok,this._startTs=__(),this._deltaTs=__(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new pre(`__probe-${this.id}__`,vre),this.timeStamp(`${this.id} started`),bre(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((__()-this._startTs).toPrecision(10))}getDelta(){return Number((__()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){if(!e)throw new Error(t||"Assertion failed")}warn(e){return this._getLogFunction(0,e,y_.warn,arguments,dk)}error(e){return this._getLogFunction(0,e,y_.error,arguments)}deprecated(e,t){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${t}\` instead`)}removed(e,t){return this.error(`\`${e}\` has been removed. Use \`${t}\` instead`)}probe(e,t){return this._getLogFunction(e,t,y_.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,y_.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){return this._getLogFunction(e,t,y_.debug||y_.info,arguments,dk)}table(e,t,n){return t?this._getLogFunction(e,t,console.table||b_,n&&[n],{tag:wre(t)}):b_}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||b_)}group(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const i=pk({logLevel:e,message:t,opts:n}),{collapsed:s}=n;return i.method=(s?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(e,t,Object.assign({},n,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||b_)}withGroup(e,t,n){this.group(e,t)();try{n()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=Ak(e)}_getLogFunction(e,t,n,i,s){if(this._shouldLog(e)){s=pk({logLevel:e,message:t,args:i,opts:s}),n=n||s.method,jS(n),s.total=this.getTotal(),s.delta=this.getDelta(),this._deltaTs=__();const a=s.tag||s.message;if(s.once&&a)if(!hk[a])hk[a]=__();else return b_;return t=xre(this.id,s.message,s),n.bind(console,t,...s.args)}return b_}};fk.VERSION=ok;function Ak(r){if(!r)return 0;let e;switch(typeof r){case"number":e=r;break;case"object":e=r.logLevel||r.priority||0;break;default:return 0}return jS(Number.isFinite(e)&&e>=0),e}function pk(r){const{logLevel:e,message:t}=r;r.logLevel=Ak(e);const n=r.args?Array.from(r.args):[];for(;n.length&&n.shift()!==t;);switch(typeof e){case"string":case"function":t!==void 0&&n.unshift(t),r.message=e;break;case"object":Object.assign(r,e);break}typeof r.message=="function"&&(r.message=r.message());const i=typeof r.message;return jS(i==="string"||i==="object"),Object.assign(r,{args:n},r.opts)}function xre(r,e,t){if(typeof e=="string"){const n=t.time?mre(gre(t.total)):"";e=t.time?`${r}: ${n}  ${e}`:`${r}: ${e}`,e=yre(e,t.color,t.background)}return e}function wre(r){for(const e in r)for(const t in r[e])return t||"untitled";return"empty"}const an=new fk({id:"luma.gl"}),qS={};function Vx(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"id";qS[r]=qS[r]||1;const e=qS[r]++;return`${r}-${e}`}let io=(yD=class{constructor(e,t,n){xe(this,"id");xe(this,"props");xe(this,"userData",{});xe(this,"_device");xe(this,"destroyed",!1);xe(this,"allocatedBytes",0);xe(this,"_attachedResources",new Set);if(!e)throw new Error("no device");this._device=e,this.props=Bre(t,n);const i=this.props.id!=="undefined"?this.props.id:Vx(this[Symbol.toStringTag]);this.props.id=i,this.id=i,this.userData=this.props.userData||{},this.addStats()}toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get(`${t}s Active`).decrementCount()}trackAllocatedMemory(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag];const n=this._device.statsManager.getStats("Resource Counts");n.get("GPU Memory").addCount(e),n.get(`${t} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag];const t=this._device.statsManager.getStats("Resource Counts");t.get("GPU Memory").subtractCount(this.allocatedBytes),t.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${t}s Created`).incrementCount(),e.get(`${t}s Active`).incrementCount()}},xe(yD,"defaultProps",{id:"undefined",handle:void 0,userData:void 0}),yD);function Bre(r,e){const t={...e};for(const n in r)r[n]!==void 0&&(t[n]=r[n]);return t}let La=(pl=class extends io{constructor(t,n){const i={...n};(n.usage||0)&pl.INDEX&&!n.indexType&&(n.data instanceof Uint32Array?i.indexType="uint32":n.data instanceof Uint16Array&&(i.indexType="uint16")),delete i.data;super(t,i,pl.defaultProps);xe(this,"usage");xe(this,"indexType");xe(this,"updateTimestamp");xe(this,"debugData",new ArrayBuffer(0));this.usage=i.usage||0,this.indexType=i.indexType,this.updateTimestamp=t.incrementTimestamp()}get[Symbol.toStringTag](){return"Buffer"}clone(t){return this.device.createBuffer({...this.props,...t})}readSyncWebGL(t,n){throw new Error("not implemented")}_setDebugData(t,n,i){const s=ArrayBuffer.isView(t)?t.buffer:t,a=Math.min(t?t.byteLength:i,pl.DEBUG_DATA_MAX_LENGTH);s===null?this.debugData=new ArrayBuffer(a):n===0&&i===s.byteLength?this.debugData=s.slice(0,a):this.debugData=s.slice(n,n+a)}},xe(pl,"defaultProps",{...io.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1}),xe(pl,"MAP_READ",1),xe(pl,"MAP_WRITE",2),xe(pl,"COPY_SRC",4),xe(pl,"COPY_DST",8),xe(pl,"INDEX",16),xe(pl,"VERTEX",32),xe(pl,"UNIFORM",64),xe(pl,"STORAGE",128),xe(pl,"INDIRECT",256),xe(pl,"QUERY_RESOLVE",512),xe(pl,"DEBUG_DATA_MAX_LENGTH",32),pl);function gk(r){const e=mk[r],t=Cre(e),n=r.includes("norm"),i=!n&&!r.startsWith("float"),s=r.startsWith("s");return{dataType:mk[r],byteLength:t,integer:i,signed:s,normalized:n}}function Cre(r){return Ere[r]}const mk={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},Ere={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},Xc="texture-compression-bc",so="texture-compression-astc",kf="texture-compression-etc2",Tre="texture-compression-etc1-webgl",Gx="texture-compression-pvrtc-webgl",KS="texture-compression-atc-webgl",Qx="float32-renderable-webgl",WS="float16-renderable-webgl",Sre="rgb9e5ufloat-renderable-webgl",XS="snorm8-renderable-webgl",h1="norm16-renderable-webgl",JS="snorm16-renderable-webgl",$x="float32-filterable",_k="float16-filterable-webgl";function yk(r){const e=Ire[r];if(!e)throw new Error(`Unsupported texture format ${r}`);return e}const Ire={r8unorm:{},r8snorm:{render:XS},r8uint:{},r8sint:{},rg8unorm:{},rg8snorm:{render:XS},rg8uint:{},rg8sint:{},r16uint:{},r16sint:{},r16float:{render:WS,filter:"float16-filterable-webgl"},"r16unorm-webgl":{f:h1},"r16snorm-webgl":{f:JS},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},"rgb8unorm-webgl":{},"rgb8snorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},rgba8snorm:{render:XS},rgba8uint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{},rg16sint:{},rg16float:{render:WS,filter:_k},"rg16unorm-webgl":{render:h1},"rg16snorm-webgl":{render:JS},r32uint:{},r32sint:{},r32float:{render:Qx,filter:$x},rgb9e5ufloat:{channels:"rgb",packed:!0,render:Sre},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:Qx},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},"rgb10a2uint-webgl":{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1,wgpu:!1},"rgb16unorm-webgl":{f:h1},"rgb16snorm-webgl":{f:h1},rg32uint:{},rg32sint:{},rg32float:{render:!1,filter:$x},rgba16uint:{},rgba16sint:{},rgba16float:{render:WS,filter:_k},"rgba16unorm-webgl":{render:h1},"rgba16snorm-webgl":{render:JS},"rgb32float-webgl":{render:Qx,filter:$x},rgba32uint:{},rgba32sint:{},rgba32float:{render:Qx,filter:$x},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0},"bc1-rgb-unorm-webgl":{f:Xc},"bc1-rgb-unorm-srgb-webgl":{f:Xc},"bc1-rgba-unorm":{f:Xc},"bc1-rgba-unorm-srgb":{f:Xc},"bc2-rgba-unorm":{f:Xc},"bc2-rgba-unorm-srgb":{f:Xc},"bc3-rgba-unorm":{f:Xc},"bc3-rgba-unorm-srgb":{f:Xc},"bc4-r-unorm":{f:Xc},"bc4-r-snorm":{f:Xc},"bc5-rg-unorm":{f:Xc},"bc5-rg-snorm":{f:Xc},"bc6h-rgb-ufloat":{f:Xc},"bc6h-rgb-float":{f:Xc},"bc7-rgba-unorm":{f:Xc},"bc7-rgba-unorm-srgb":{f:Xc},"etc2-rgb8unorm":{f:kf},"etc2-rgb8unorm-srgb":{f:kf},"etc2-rgb8a1unorm":{f:kf},"etc2-rgb8a1unorm-srgb":{f:kf},"etc2-rgba8unorm":{f:kf},"etc2-rgba8unorm-srgb":{f:kf},"eac-r11unorm":{f:kf},"eac-r11snorm":{f:kf},"eac-rg11unorm":{f:kf},"eac-rg11snorm":{f:kf},"astc-4x4-unorm":{f:so},"astc-4x4-unorm-srgb":{f:so},"astc-5x4-unorm":{f:so},"astc-5x4-unorm-srgb":{f:so},"astc-5x5-unorm":{f:so},"astc-5x5-unorm-srgb":{f:so},"astc-6x5-unorm":{f:so},"astc-6x5-unorm-srgb":{f:so},"astc-6x6-unorm":{f:so},"astc-6x6-unorm-srgb":{f:so},"astc-8x5-unorm":{f:so},"astc-8x5-unorm-srgb":{f:so},"astc-8x6-unorm":{f:so},"astc-8x6-unorm-srgb":{f:so},"astc-8x8-unorm":{f:so},"astc-8x8-unorm-srgb":{f:so},"astc-10x5-unorm":{f:so},"astc-10x5-unorm-srgb":{f:so},"astc-10x6-unorm":{f:so},"astc-10x6-unorm-srgb":{f:so},"astc-10x8-unorm":{f:so},"astc-10x8-unorm-srgb":{f:so},"astc-10x10-unorm":{f:so},"astc-10x10-unorm-srgb":{f:so},"astc-12x10-unorm":{f:so},"astc-12x10-unorm-srgb":{f:so},"astc-12x12-unorm":{f:so},"astc-12x12-unorm-srgb":{f:so},"pvrtc-rgb4unorm-webgl":{f:Gx},"pvrtc-rgba4unorm-webgl":{f:Gx},"pvrtc-rbg2unorm-webgl":{f:Gx},"pvrtc-rgba2unorm-webgl":{f:Gx},"etc1-rbg-unorm-webgl":{f:Tre},"atc-rgb-unorm-webgl":{f:KS},"atc-rgba-unorm-webgl":{f:KS},"atc-rgbai-unorm-webgl":{f:KS}},Mre=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],Pre=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/;function bk(r){return Mre.some(e=>r.startsWith(e))}function ZS(r){let e=Fre(r);if(bk(r)){e.channels="rgb",e.components=3,e.bytesPerPixel=1,e.srgb=!1,e.compressed=!0;const n=Rre(r);n&&(e.blockWidth=n.blockWidth,e.blockHeight=n.blockHeight)}const t=Pre.exec(r);if(t){const[,n,i,s,a,o]=t,h=`${s}${i}`,f=gk(h),_=f.byteLength*8,x=n.length,T=[_,x>=2?_:0,x>=3?_:0,x>=4?_:0];e={format:r,attachment:e.attachment,dataType:f.dataType,components:x,channels:n,integer:f.integer,signed:f.signed,normalized:f.normalized,bitsPerChannel:T,bytesPerPixel:f.byteLength*n.length,packed:e.packed,srgb:e.srgb},o==="-webgl"&&(e.webgl=!0),a==="-srgb"&&(e.srgb=!0)}return r.endsWith("-webgl")&&(e.webgl=!0),r.endsWith("-srgb")&&(e.srgb=!0),e}function Fre(r){var s;const e=yk(r),t=e.bytesPerPixel||1,n=e.bitsPerChannel||[8,8,8,8];return delete e.bitsPerChannel,delete e.bytesPerPixel,delete e.f,delete e.render,delete e.filter,delete e.blend,delete e.store,{...e,format:r,attachment:e.attachment||"color",channels:e.channels||"r",components:e.components||((s=e.channels)==null?void 0:s.length)||1,bytesPerPixel:t,bitsPerChannel:n,dataType:e.dataType||"uint8",srgb:e.srgb??!1,packed:e.packed??!1,webgl:e.webgl??!1,integer:e.integer??!1,signed:e.signed??!1,normalized:e.normalized??!1,compressed:e.compressed??!1}}function Rre(r){const t=/.*-(\d+)x(\d+)-.*/.exec(r);if(t){const[,n,i]=t;return{blockWidth:Number(n),blockHeight:Number(i)}}return null}function Lre(r){const e=yk(r),t={format:r,create:e.f??!0,render:e.render??!0,filter:e.filter??!0,blend:e.blend??!0,store:e.store??!0},n=ZS(r),i=r.startsWith("depth")||r.startsWith("stencil"),s=n==null?void 0:n.signed,a=n==null?void 0:n.integer,o=n==null?void 0:n.webgl;return t.render&&(t.render=!s),t.filter&&(t.filter=!i&&!s&&!a&&!o),t}class Dre{}class Ore{constructor(){xe(this,"features");xe(this,"disabledFeatures");let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;this.features=new Set(e),this.disabledFeatures=t||{}}*[Symbol.iterator](){yield*this.features}has(e){var t;return!((t=this.disabledFeatures)!=null&&t[e])&&this.features.has(e)}}const qE=class qE{constructor(e){xe(this,"id");xe(this,"props");xe(this,"userData",{});xe(this,"statsManager",ck);xe(this,"timestamp",0);xe(this,"_reused",!1);xe(this,"_lumaData",{});this.props={...qE.defaultProps,...e},this.id=this.props.id||Vx(this[Symbol.toStringTag].toLowerCase())}get[Symbol.toStringTag](){return"Device"}getTextureFormatCapabilities(e){const t=Lre(e),n=a=>(typeof a=="string"?this.features.has(a):a)??!0,i=n(t.create),s={format:e,create:i,render:i&&n(t.render),filter:i&&n(t.filter),blend:i&&n(t.blend),store:i&&n(t.store)};return this._getDeviceSpecificTextureFormatCapabilities(s)}isTextureFormatSupported(e,t){return this.getTextureFormatCapabilities(e).create}isTextureFormatFilterable(e){return this.getTextureFormatCapabilities(e).filter}isTextureFormatRenderable(e){return this.getTextureFormatCapabilities(e).render}isTextureFormatCompressed(e){return bk(e)}loseDevice(){return!1}reportError(e){this.props.onError(e)}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}createCommandEncoder(){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(e){this.props.onError(e)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(e,t){throw new Error("not implemented")}readPixelsToBufferWebGL(e,t){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,t){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}static _getCanvasContextProps(e){return e.createCanvasContext===!0?{}:e.createCanvasContext}_normalizeBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const t={...e};return(e.usage||0)&La.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?t.indexType="uint32":e.data instanceof Uint16Array?t.indexType="uint16":an.warn("indices buffer content must be of integer type")()),t}};xe(qE,"defaultProps",{id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,onError:e=>an.error(e.message)(),_reuseDevices:!1,_requestMaxLimits:!0,_factoryDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_resourceDefaults:{},webgl:{},debug:an.get("debug")||void 0,debugShaders:an.get("debug-shaders")||void 0,debugFramebuffers:!!an.get("debug-framebuffers"),debugWebGL:!!an.get("debug-webgl"),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_handle:void 0});let YA=qE;const kre=u1()&&typeof document<"u",Ure=()=>kre&&document.readyState==="complete",Nre="set luma.log.level=1 (or higher) to trace rendering",vk="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.",Qp=class Qp{constructor(){xe(this,"stats",ck);xe(this,"log",an);xe(this,"VERSION","9.1.4");xe(this,"spector");xe(this,"preregisteredAdapters",new Map);if(globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw an.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),an.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),new Error("luma.gl - multiple versions detected: see console log");an.error("This version of luma.gl has already been initialized")()}an.log(1,`${this.VERSION} - ${Nre}`)(),globalThis.luma=this}registerAdapters(e){for(const t of e)this.preregisteredAdapters.set(t.type,t)}getSupportedAdapters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const t=this.getAdapterMap(e);return Array.from(t).map(n=>{let[,i]=n;return i}).filter(n=>{var i;return(i=n.isSupported)==null?void 0:i.call(n)}).map(n=>n.type)}getBestAvailableAdapter(){var n,i,s,a;let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const t=this.getAdapterMap(e);return(i=(n=t.get("webgpu"))==null?void 0:n.isSupported)!=null&&i.call(n)?"webgpu":(a=(s=t.get("webgl"))==null?void 0:s.isSupported)!=null&&a.call(s)?"webgl":null}setDefaultDeviceProps(e){Object.assign(Qp.defaultProps,e)}async createDevice(){var o;let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};e={...Qp.defaultProps,...e},e.waitForPageLoad&&await Qp.pageLoaded;const t=this.getAdapterMap(e.adapters);let n=e.type||"";n==="best-available"&&(n=this.getBestAvailableAdapter(e.adapters)||n);const s=(this.getAdapterMap(e.adapters)||t).get(n),a=await((o=s==null?void 0:s.create)==null?void 0:o.call(s,e));if(a)return a;throw new Error(vk)}async attachDevice(e){var a;const t=this.getAdapterMap(e.adapters);let n="";e.handle instanceof WebGL2RenderingContext&&(n="webgl"),e.createCanvasContext&&await Qp.pageLoaded,e.handle===null&&(n="unknown");const i=t.get(n),s=await((a=i==null?void 0:i.attach)==null?void 0:a.call(i,null));if(s)return s;throw new Error(vk)}enforceWebGL2(){var s;let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const i=this.getAdapterMap(t).get("webgl");i||an.warn("enforceWebGL2: webgl adapter not found")(),(s=i==null?void 0:i.enforceWebGL2)==null||s.call(i,e)}getAdapterMap(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const t=new Map(this.preregisteredAdapters);for(const n of e)t.set(n.type,n);return t}registerDevices(e){an.warn("luma.registerDevices() is deprecated, use luma.registerAdapters() instead");for(const t of e){const n=t.adapter;n&&this.preregisteredAdapters.set(n.type,n)}}};xe(Qp,"defaultProps",{...YA.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0}),xe(Qp,"pageLoaded",zre().then(()=>{an.probe(2,"DOM is loaded")()}));let YS=Qp;const eI=new YS;function zre(){return Ure()||typeof window>"u"?Promise.resolve():new Promise(r=>{window.addEventListener("load",()=>r())})}class Hre{}const KE=class KE{constructor(e){xe(this,"id");xe(this,"props");xe(this,"canvas");xe(this,"htmlCanvas");xe(this,"offscreenCanvas");xe(this,"type");xe(this,"width",1);xe(this,"height",1);xe(this,"resizeObserver");xe(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});if(this.props={...KE.defaultProps,...e},e=this.props,!u1()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(e.canvas)typeof e.canvas=="string"?this.canvas=Gre(e.canvas):this.canvas=e.canvas;else{const t=Qre(e),n=Vre((e==null?void 0:e.container)||null);n.insertBefore(t,n.firstChild),this.canvas=t,e!=null&&e.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver(t=>{for(const n of t)n.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}toString(){return`${this[Symbol.toStringTag]}(${this.id})`}getDevicePixelRatio(e){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(e=e===void 0?this.props.useDevicePixels:e,!e||e<=0)?1:e===!0?typeof window<"u"&&window.devicePixelRatio||1:e}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const e=this.getDevicePixelRatio(),t=this.canvas;return t.parentElement?[t.clientWidth*e,t.clientHeight*e]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[e,t]=this.getPixelSize();return e/t}cssToDeviceRatio(){var e;try{const[t]=this.getDrawingBufferSize(),n=this._canvasSizeInfo.clientWidth||((e=this.htmlCanvas)==null?void 0:e.clientWidth);return n?t/n:1}catch{return 1}}cssToDevicePixels(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;const n=this.cssToDeviceRatio(),[i,s]=this.getDrawingBufferSize();return $re(e,n,i,s,t)}setDevicePixelRatio(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!this.htmlCanvas)return;let n="width"in t?t.width:this.htmlCanvas.clientWidth,i="height"in t?t.height:this.htmlCanvas.clientHeight;(!n||!i)&&(an.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,n=this.htmlCanvas.width||1,i=this.htmlCanvas.height||1);const s=this._canvasSizeInfo;if(s.clientWidth!==n||s.clientHeight!==i||s.devicePixelRatio!==e){let a=e;const o=Math.floor(n*a),h=Math.floor(i*a);if(this.htmlCanvas.width=o,this.htmlCanvas.height=h,this.device.gl){const[_,x]=this.getDrawingBufferSize();(_!==o||x!==h)&&(a=Math.min(_/n,x/i),this.htmlCanvas.width=Math.floor(n*a),this.htmlCanvas.height=Math.floor(i*a),an.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=n,this._canvasSizeInfo.clientHeight=i,this._canvasSizeInfo.devicePixelRatio=e}}}getDrawingBufferSize(){const e=this.device.gl;return e?[e.drawingBufferWidth,e.drawingBufferHeight]:this.getPixelSize()}_setAutoCreatedCanvasId(e){var t;((t=this.htmlCanvas)==null?void 0:t.id)==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}};xe(KE,"defaultProps",{canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb"});let tI=KE;function Vre(r){if(typeof r=="string"){const e=document.getElementById(r);if(!e)throw new Error(`${r} is not an HTML element`);return e}else if(r)return r;return document.body}function Gre(r){const e=document.getElementById(r);if(!(e instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return e}function Qre(r){const{width:e,height:t}=r,n=document.createElement("canvas");return n.id=Vx("lumagl-auto-created-canvas"),n.width=e||1,n.height=t||1,n.style.width=Number.isFinite(e)?`${e}px`:"100%",n.style.height=Number.isFinite(t)?`${t}px`:"100%",n}function $re(r,e,t,n,i){const s=r,a=xk(s[0],e,t);let o=wk(s[1],e,n,i),h=xk(s[0]+1,e,t);const f=h===t-1?h:h-1;h=wk(s[1]+1,e,n,i);let _;return i?(h=h===0?h:h+1,_=o,o=h):_=h===n-1?h:h-1,{x:a,y:o,width:Math.max(f-a+1,1),height:Math.max(_-o+1,1)}}function xk(r,e,t){return Math.min(Math.round(r*e),t-1)}function wk(r,e,t,n){return n?Math.max(0,t-1-Math.round(r*e)):Math.min(Math.round(r*e),t-1)}const Ic=class Ic extends io{constructor(t,n){n=Ic.normalizeProps(t,n);super(t,n,Ic.defaultProps);xe(this,"dimension");xe(this,"format");xe(this,"width");xe(this,"height");xe(this,"depth");xe(this,"mipLevels");xe(this,"updateTimestamp");if(this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.props.width===void 0||this.props.height===void 0){const i=Ic.getTextureDataSize(this.props.data);this.width=(i==null?void 0:i.width)||1,this.height=(i==null?void 0:i.height)||1}this.props.mipmaps&&this.props.mipLevels===void 0&&(this.props.mipLevels="pyramid"),this.mipLevels=this.props.mipLevels==="pyramid"?Ic.getMipLevelCount(this.width,this.height):this.props.mipLevels||1,this.updateTimestamp=t.incrementTimestamp()}get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}clone(t){return this.device.createTexture({...this.props,...t})}static isExternalImage(t){return typeof ImageData<"u"&&t instanceof ImageData||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement||typeof VideoFrame<"u"&&t instanceof VideoFrame||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas}static getExternalImageSize(t){if(typeof ImageData<"u"&&t instanceof ImageData||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas)return{width:t.width,height:t.height};if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement)return{width:t.naturalWidth,height:t.naturalHeight};if(typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement)return{width:t.videoWidth,height:t.videoHeight};if(typeof VideoFrame<"u"&&t instanceof VideoFrame)return{width:t.displayWidth,height:t.displayHeight};throw new Error("Unknown image type")}static isTextureLevelData(t){const n=t==null?void 0:t.data;return ArrayBuffer.isView(n)}static getTextureDataSize(t){if(!t||ArrayBuffer.isView(t))return null;if(Array.isArray(t))return Ic.getTextureDataSize(t[0]);if(Ic.isExternalImage(t))return Ic.getExternalImageSize(t);if(t&&typeof t=="object"&&t.constructor===Object){const i=Object.values(t)[0];return{width:i.width,height:i.height}}throw new Error("texture size deduction failed")}static normalizeTextureData(t,n){let i;return ArrayBuffer.isView(t)?i=[{data:t,width:n.width,height:n.height}]:Array.isArray(t)?i=t:i=[t],i}static getMipLevelCount(t,n){return Math.floor(Math.log2(Math.max(t,n)))+1}static getCubeFaceDepth(t){switch(t){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(t)}}static normalizeProps(t,n){var h,f;const i={...n},s=((f=(h=t==null?void 0:t.props)==null?void 0:h._resourceDefaults)==null?void 0:f.texture)||{};Object.assign(i,s);const{width:a,height:o}=i;return typeof a=="number"&&(i.width=Math.max(1,Math.ceil(a))),typeof o=="number"&&(i.height=Math.max(1,Math.ceil(o))),i}};xe(Ic,"COPY_SRC",1),xe(Ic,"COPY_DST",2),xe(Ic,"TEXTURE",4),xe(Ic,"STORAGE",8),xe(Ic,"RENDER_ATTACHMENT",16),xe(Ic,"CubeFaces",["+X","-X","+Y","-Y","+Z","-Z"]),xe(Ic,"defaultProps",{...io.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!1,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,sampler:{},view:void 0,flipY:void 0}),xe(Ic,"defaultCopyExternalImageOptions",{image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1});let ia=Ic;const WE=class WE extends io{get[Symbol.toStringTag](){return"TextureView"}constructor(e,t){super(e,t,WE.defaultProps)}};xe(WE,"defaultProps",{...io.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0});let jx=WE;function jre(r,e,t){let n="";const i=e.split(/\r?\n/),s=r.slice().sort((a,o)=>a.lineNum-o.lineNum);switch((t==null?void 0:t.showSourceCode)||"no"){case"all":let a=0;for(let o=1;o<=i.length;o++)for(n+=Ck(i[o-1],o,t);s.length>a&&s[a].lineNum===o;){const h=s[a++];n+=Bk(h,i,h.lineNum,{...t,inlineSource:!1})}return n;case"issues":case"no":for(const o of r)n+=Bk(o,i,o.lineNum,{inlineSource:(t==null?void 0:t.showSourceCode)!=="no"});return n}}function Bk(r,e,t,n){if(n!=null&&n.inlineSource){const s=qre(e,t),a=r.linePos>0?`${" ".repeat(r.linePos+5)}^^^
`:"";return`
${s}${a}${r.type.toUpperCase()}: ${r.message}

`}const i=r.type==="error"?"red":"#8B4000";return n!=null&&n.html?`<div class='luma-compiler-log-error' style="color:${i};"><b> ${r.type.toUpperCase()}: ${r.message}</b></div>`:`${r.type.toUpperCase()}: ${r.message}`}function qre(r,e,t){let n="";for(let i=e-2;i<=e;i++){const s=r[i-1];s!==void 0&&(n+=Ck(s,e,t))}return n}function Ck(r,e,t){const n=t!=null&&t.html?Wre(r):r;return`${Kre(String(e),4)}: ${n}${t!=null&&t.html?"<br/>":`
`}`}function Kre(r,e){let t="";for(let n=r.length;n<e;++n)t+=" ";return t+r}function Wre(r){return r.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}const XE=class XE extends io{constructor(t,n){n={...n,debugShaders:n.debugShaders||t.props.debugShaders||"errors"};super(t,{id:Xre(n),...n},XE.defaultProps);xe(this,"stage");xe(this,"source");xe(this,"compilationStatus","pending");this.stage=this.props.stage,this.source=this.props.source}get[Symbol.toStringTag](){return"Shader"}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){const t=this.props.debugShaders;switch(t){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const n=await this.getCompilationInfo();t==="warnings"&&(n==null?void 0:n.length)===0||this._displayShaderLog(n)}_displayShaderLog(t){var f;if(typeof document>"u"||!(document!=null&&document.createElement))return;const n=Ek(this.source),i=`${this.stage} ${n}`;let s=jre(t,this.source,{showSourceCode:"all",html:!0});const a=this.getTranslatedSource();a&&(s+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${a}</pre></code>`);const o=document.createElement("Button");o.innerHTML=`
<h1>Shader Compilation Error in ${i}</h1><br /><br />
<code style="user-select:text;"><pre>
${s}
</pre></code>`,o.style.top="10px",o.style.left="10px",o.style.position="absolute",o.style.zIndex="9999",o.style.width="100%",o.style.textAlign="left",document.body.appendChild(o),(f=document.getElementsByClassName("luma-compiler-log-error")[0])==null||f.scrollIntoView(),o.onclick=()=>{const _=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(_)}}};xe(XE,"defaultProps",{...io.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0});let qx=XE;function Xre(r){return Ek(r.source)||r.id||Vx(`unnamed ${r.stage}-shader`)}function Ek(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"unnamed";const n=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(r);return n?n[1]:e}const Bv=class Bv extends io{get[Symbol.toStringTag](){return"Sampler"}constructor(e,t){t=Bv.normalizeProps(e,t),super(e,t,Bv.defaultProps)}static normalizeProps(e,t){var s,a;const n=((a=(s=e==null?void 0:e.props)==null?void 0:s._resourceDefaults)==null?void 0:a.sampler)||{};return{...t,...n}}};xe(Bv,"defaultProps",{...io.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1});let Kx=Bv;const JE=class JE extends io{constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(t,n,JE.defaultProps);xe(this,"width");xe(this,"height");this.width=this.props.width,this.height=this.props.height}get[Symbol.toStringTag](){return"Framebuffer"}clone(t){const n=this.colorAttachments.map(s=>s.texture.clone(t)),i=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(t);return this.device.createFramebuffer({...this.props,colorAttachments:n,depthStencilAttachment:i})}resize(t){let n=!t;if(t){const[i,s]=Array.isArray(t)?t:[t.width,t.height];n=n||s!==this.height||i!==this.width,this.width=i,this.height=s}n&&(an.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((n,i)=>{if(typeof n=="string"){const s=this.createColorTexture(n,i);return this.attachResource(s),s.view}return n instanceof ia?n.view:n});const t=this.props.depthStencilAttachment;if(t)if(typeof t=="string"){const n=this.createDepthStencilTexture(t);this.attachResource(n),this.depthStencilAttachment=n.view}else t instanceof ia?this.depthStencilAttachment=t.view:this.depthStencilAttachment=t}createColorTexture(t,n){return this.device.createTexture({id:`${this.id}-color-attachment-${n}`,usage:ia.RENDER_ATTACHMENT,format:t,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(t){return this.device.createTexture({id:`${this.id}-depth-stencil-attachment`,usage:ia.RENDER_ATTACHMENT,format:t,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(t,n){for(let i=0;i<this.colorAttachments.length;++i)if(this.colorAttachments[i]){const s=this.colorAttachments[i].texture.clone({width:t,height:n});this.destroyAttachedResource(this.colorAttachments[i]),this.colorAttachments[i]=s.view,this.attachResource(s.view)}if(this.depthStencilAttachment){const i=this.depthStencilAttachment.texture.clone({width:t,height:n});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=i.view,this.attachResource(i)}this.updateAttachments()}};xe(JE,"defaultProps",{...io.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null});let Wx=JE;const ZE=class ZE extends io{constructor(t,n){super(t,n,ZE.defaultProps);xe(this,"shaderLayout");xe(this,"bufferLayout");xe(this,"linkStatus","pending");xe(this,"hash","");this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}get[Symbol.toStringTag](){return"RenderPipeline"}setUniformsWebGL(t){throw new Error("Use uniform blocks")}};xe(ZE,"defaultProps",{...io.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}});let v_=ZE;const bf=class bf extends io{get[Symbol.toStringTag](){return"RenderPass"}constructor(e,t){t=bf.normalizeProps(e,t),super(e,t,bf.defaultProps)}static normalizeProps(e,t){var s;return{...(s=e.props._resourceDefaults)==null?void 0:s.renderPass,...t}}};xe(bf,"defaultClearColor",[0,0,0,1]),xe(bf,"defaultClearDepth",1),xe(bf,"defaultClearStencil",0),xe(bf,"defaultProps",{...io.defaultProps,framebuffer:null,parameters:void 0,clearColor:bf.defaultClearColor,clearColors:void 0,clearDepth:bf.defaultClearDepth,clearStencil:bf.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0});let rI=bf;const YE=class YE extends io{constructor(t,n){super(t,n,YE.defaultProps);xe(this,"hash","");xe(this,"shaderLayout");this.shaderLayout=n.shaderLayout}get[Symbol.toStringTag](){return"ComputePipeline"}};xe(YE,"defaultProps",{...io.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0});let Xx=YE;const eT=class eT extends io{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,t){super(e,t,eT.defaultProps)}};xe(eT,"defaultProps",{...io.defaultProps,measureExecutionTime:void 0});let nI=eT;const tT=class tT extends io{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,t){super(e,t,tT.defaultProps)}};xe(tT,"defaultProps",{...io.defaultProps});let iI=tT;function Jre(r){const[e,t]=Yre[r],n=e==="i32"||e==="u32",i=e!=="u32",s=ene[e]*t,a=Zre(e,t);return{dataType:e,components:t,defaultVertexFormat:a,byteLength:s,integer:n,signed:i}}function Zre(r,e){let t;switch(r){case"f32":t="float32";break;case"i32":t="sint32";break;case"u32":t="uint32";break;case"f16":return e<=2?"float16x2":"float16x4"}return e===1?t:`${t}x${e}`}const Yre={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},ene={f32:4,f16:2,i32:4,u32:4};function Tk(r){let e;r.endsWith("-webgl")&&(r.replace("-webgl",""),e=!0);const[t,n]=r.split("x"),i=t,s=n?parseInt(n):1,a=gk(i),o={type:i,components:s,byteLength:a.byteLength*s,integer:a.integer,signed:a.signed,normalized:a.normalized};return e&&(o.webglOnly=!0),o}function Sk(r,e){const t={};for(const n of r.attributes){const i=rne(r,e,n.name);i&&(t[n.name]=i)}return t}function tne(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:16;const n=Sk(r,e),i=new Array(t).fill(null);for(const s of Object.values(n))i[s.location]=s;return i}function rne(r,e,t){const n=nne(r,t),i=ine(e,t);if(!n)return null;const s=Jre(n.type),a=(i==null?void 0:i.vertexFormat)||s.defaultVertexFormat,o=Tk(a);return{attributeName:(i==null?void 0:i.attributeName)||n.name,bufferName:(i==null?void 0:i.bufferName)||n.name,location:n.location,shaderType:n.type,shaderDataType:s.dataType,shaderComponents:s.components,vertexFormat:a,bufferDataType:o.type,bufferComponents:o.components,normalized:o.normalized,integer:s.integer,stepMode:(i==null?void 0:i.stepMode)||n.stepMode||"vertex",byteOffset:(i==null?void 0:i.byteOffset)||0,byteStride:(i==null?void 0:i.byteStride)||0}}function nne(r,e){const t=r.attributes.find(n=>n.name===e);return t||an.warn(`shader layout attribute "${e}" not present in shader`),t||null}function ine(r,e){sne(r);let t=one(r,e);return t||(t=ane(r,e),t)?t:(an.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function sne(r){for(const e of r)(e.attributes&&e.format||!e.attributes&&!e.format)&&an.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function one(r,e){for(const t of r)if(t.format&&t.name===e)return{attributeName:t.name,bufferName:e,stepMode:t.stepMode,vertexFormat:t.format,byteOffset:0,byteStride:t.byteStride||0};return null}function ane(r,e){var t;for(const n of r){let i=n.byteStride;if(typeof n.byteStride!="number")for(const a of n.attributes||[]){const o=Tk(a.format);i+=o.byteLength}const s=(t=n.attributes)==null?void 0:t.find(a=>a.attribute===e);if(s)return{attributeName:s.attribute,bufferName:n.name,stepMode:n.stepMode,vertexFormat:s.format,byteOffset:s.byteOffset,byteStride:i}}return null}const rT=class rT extends io{constructor(t,n){super(t,n,rT.defaultProps);xe(this,"maxVertexAttributes");xe(this,"attributeInfos");xe(this,"indexBuffer",null);xe(this,"attributes");this.maxVertexAttributes=t.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null);const{shaderLayout:i,bufferLayout:s}=n.renderPipeline||{};if(!i||!s)throw new Error("VertexArray");this.attributeInfos=tne(i,s,this.maxVertexAttributes)}get[Symbol.toStringTag](){return"VertexArray"}setConstantWebGL(t,n){this.device.reportError(new Error("constant attributes not supported"))}};xe(rT,"defaultProps",{...io.defaultProps,renderPipeline:null});let sI=rT;const nT=class nT extends io{get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,t){super(e,t,nT.defaultProps)}};xe(nT,"defaultProps",{...io.defaultProps,layout:void 0,buffers:{}});let oI=nT;const iT=class iT extends io{get[Symbol.toStringTag](){return"QuerySet"}constructor(e,t){super(e,t,iT.defaultProps)}};xe(iT,"defaultProps",{...io.defaultProps,type:void 0,count:void 0});let aI=iT;const lne={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function cne(r){return lne[r]}function une(r,e){switch(e){case 1:return r;case 2:return r+r%2;default:return r+(4-r%4)%4}}let Jx;function Ik(r){return(!Jx||Jx.byteLength<r)&&(Jx=new ArrayBuffer(r)),Jx}function hne(r,e){const t=Ik(r.BYTES_PER_ELEMENT*e);return new r(t,0,e)}function dne(r){return ArrayBuffer.isView(r)&&!(r instanceof DataView)}function Zx(r){return Array.isArray(r)?r.length===0||typeof r[0]=="number":dne(r)}const Mk=1024;class fne{constructor(e){xe(this,"layout",{});xe(this,"byteLength");let t=0;for(const[i,s]of Object.entries(e)){const a=cne(s),{type:o,components:h}=a;t=une(t,h);const f=t;t+=h,this.layout[i]={type:o,size:h,offset:f}}t+=(4-t%4)%4;const n=t*4;this.byteLength=Math.max(n,Mk)}getData(e){const t=Math.max(this.byteLength,Mk),n=Ik(t),i={i32:new Int32Array(n),u32:new Uint32Array(n),f32:new Float32Array(n),f16:new Uint16Array(n)};for(const[s,a]of Object.entries(e)){const o=this.layout[s];if(!o){an.warn(`Supplied uniform value ${s} not present in uniform block layout`)();continue}const{type:h,size:f,offset:_}=o,x=i[h];if(f===1){if(typeof a!="number"&&typeof a!="boolean"){an.warn(`Supplied value for single component uniform ${s} is not a number: ${a}`)();continue}x[_]=Number(a)}else{if(!Zx(a)){an.warn(`Supplied value for multi component / array uniform ${s} is not a numeric array: ${a}`)();continue}x.set(a,_)}}return new Uint8Array(n)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}function Ane(r,e){if(r!==e)return!1;const t=r,n=e;if(!Zx(t))return!1;if(Zx(n)&&t.length===n.length){for(let i=0;i<t.length;++i)if(n[i]!==t[i])return!1}return!0}function pne(r){return Zx(r)?r.slice():r}class gne{constructor(e){xe(this,"name");xe(this,"uniforms",{});xe(this,"modifiedUniforms",{});xe(this,"modified",!0);xe(this,"bindingLayout",{});xe(this,"needsRedraw","initialized");var t;if(this.name=(e==null?void 0:e.name)||"unnamed",e!=null&&e.name&&(e!=null&&e.shaderLayout)){const n=(t=e==null?void 0:e.shaderLayout.bindings)==null?void 0:t.find(s=>s.type==="uniform"&&s.name===(e==null?void 0:e.name));if(!n)throw new Error(e==null?void 0:e.name);const i=n;for(const s of i.uniforms||[])this.bindingLayout[s.name]=s}}setUniforms(e){for(const[t,n]of Object.entries(e))this._setUniform(t,n),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${t}=${n}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,t){Ane(this.uniforms[e],t)||(this.uniforms[e]=pne(t),this.modifiedUniforms[e]=!0,this.modified=!0)}}class mne{constructor(e){xe(this,"uniformBlocks",new Map);xe(this,"uniformBufferLayouts",new Map);xe(this,"uniformBuffers",new Map);for(const[t,n]of Object.entries(e)){const i=t,s=new fne(n.uniformTypes||{});this.uniformBufferLayouts.set(i,s);const a=new gne({name:t});a.setUniforms(n.defaultUniforms||{}),this.uniformBlocks.set(i,a)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){var t;for(const[n,i]of Object.entries(e))(t=this.uniformBlocks.get(n))==null||t.setUniforms(i);this.updateUniformBuffers()}getUniformBufferByteLength(e){var t;return((t=this.uniformBufferLayouts.get(e))==null?void 0:t.byteLength)||0}getUniformBufferData(e){var n,i;const t=((n=this.uniformBlocks.get(e))==null?void 0:n.getAllUniforms())||{};return(i=this.uniformBufferLayouts.get(e))==null?void 0:i.getData(t)}createUniformBuffer(e,t,n){n&&this.setUniforms(n);const i=this.getUniformBufferByteLength(t),s=e.createBuffer({usage:La.UNIFORM|La.COPY_DST,byteLength:i}),a=this.getUniformBufferData(t);return s.write(a),s}getManagedUniformBuffer(e,t){if(!this.uniformBuffers.get(t)){const n=this.getUniformBufferByteLength(t),i=e.createBuffer({usage:La.UNIFORM|La.COPY_DST,byteLength:n});this.uniformBuffers.set(t,i)}return this.uniformBuffers.get(t)}updateUniformBuffers(){let e=!1;for(const t of this.uniformBlocks.keys()){const n=this.updateUniformBuffer(t);e||(e=n)}return e&&an.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){var s;const t=this.uniformBlocks.get(e);let n=this.uniformBuffers.get(e),i=!1;if(n&&(t!=null&&t.needsRedraw)){i||(i=t.needsRedraw);const a=this.getUniformBufferData(e);n=this.uniformBuffers.get(e),n==null||n.write(a);const o=(s=this.uniformBlocks.get(e))==null?void 0:s.getAllUniforms();an.log(4,`Writing to uniform buffer ${String(e)}`,a,o)()}return i}}function Pk(r){const e=ArrayBuffer.isView(r)?r.constructor:r;switch(e){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(e.constructor.name)}}function Fk(r){switch(r){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(r)}}function _ne(r,e,t){if(!e||e>4)throw new Error(`size ${e}`);const n=e;let i=Pk(r);if(i==="uint8"&&t&&n===1)return"unorm8-webgl";if(i==="uint8"&&t&&n===3)return"unorm8x3-webgl";if(i==="uint8"||i==="sint8"){if(n===1||n===3)throw new Error(`size: ${e}`);return t&&(i=i.replace("int","norm")),`${i}x${n}`}if(i==="uint16"||i==="sint16"){if(n===1||n===3)throw new Error(`size: ${e}`);return t&&(i=i.replace("int","norm")),`${i}x${n}`}return n===1?i:`${i}x${n}`}class lI{constructor(e){xe(this,"bufferLayouts");this.bufferLayouts=e}getBufferLayout(e){return this.bufferLayouts.find(t=>t.name===e)||null}getAttributeNamesForBuffer(e){var t;return e.attributes?(t=e.attributes)==null?void 0:t.map(n=>n.attribute):[e.name]}mergeBufferLayouts(e,t){const n=[...e];for(const i of t){const s=n.findIndex(a=>a.name===i.name);s<0?n.push(i):n[s]=i}return n}}class Ld{constructor(e,t){this.name=e,this.attributes=t,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}}class Rk{constructor(e,t,n){this.name=e,this.type=t,this.attributes=n,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}let ep=class extends Ld{constructor(e,t){super(e,t),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}},wg=class extends Ld{constructor(e,t){super(e,t),this.count=0,this.stride=0}get isArray(){return!0}},tp=class extends Ld{constructor(e,t,n,i){super(e,n),this.format=t,this.access=i}get isTemplate(){return!0}};var rp,x_,d1,cr,Yt;(r=>{r[r.Uniform=0]="Uniform",r[r.Storage=1]="Storage",r[r.Texture=2]="Texture",r[r.Sampler=3]="Sampler",r[r.StorageTexture=4]="StorageTexture"})(rp||(rp={}));class Yx{constructor(e,t,n,i,s,a,o){this.name=e,this.type=t,this.group=n,this.binding=i,this.attributes=s,this.resourceType=a,this.access=o}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}let yne=class{constructor(e,t){this.name=e,this.type=t}},bne=class{constructor(e,t,n,i){this.name=e,this.type=t,this.locationType=n,this.location=i,this.interpolation=null}};class Lk{constructor(e,t,n,i){this.name=e,this.type=t,this.locationType=n,this.location=i}}let vne=class{constructor(e,t,n,i){this.name=e,this.type=t,this.attributes=n,this.id=i}};class xne{constructor(e,t,n){this.name=e,this.type=t,this.attributes=n}}let wne=class{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0;this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=t,this.attributes=n}};class Bne{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}let Cne=class{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}};class rd{constructor(){this.id=rd._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}constEvaluate(e,t){throw new Error("Cannot evaluate node")}constEvaluateString(e){return this.constEvaluate(e).toString()}search(e){}searchBlock(e,t){if(e){t(ew.instance);for(const n of e)n instanceof Array?this.searchBlock(n,t):n.search(t);t(tw.instance)}}}rd._id=0;class ew extends rd{}ew.instance=new ew;let tw=class extends rd{};tw.instance=new tw;let Qo=class extends rd{constructor(){super()}},rw=class extends Qo{constructor(e,t,n,i,s,a){super(),this.calls=new Set,this.name=e,this.args=t,this.returnType=n,this.body=i,this.startLine=s,this.endLine=a}get astNodeType(){return"function"}search(e){this.searchBlock(this.body,e)}},Ene=class extends Qo{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}},Dk=class extends Qo{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}},cI=class extends Qo{constructor(e){super(),this.body=e}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}};class Ok extends Qo{constructor(e,t,n,i){super(),this.init=e,this.condition=t,this.increment=n,this.body=i}get astNodeType(){return"for"}search(e){var t,n,i;(t=this.init)===null||t===void 0||t.search(e),(n=this.condition)===null||n===void 0||n.search(e),(i=this.increment)===null||i===void 0||i.search(e),this.searchBlock(this.body,e)}}let np=class extends Qo{constructor(e,t,n,i,s){super(),this.attributes=null,this.name=e,this.type=t,this.storage=n,this.access=i,this.value=s}get astNodeType(){return"var"}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}},uI=class extends Qo{constructor(e,t,n){super(),this.attributes=null,this.name=e,this.type=t,this.value=n}get astNodeType(){return"override"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}},nw=class extends Qo{constructor(e,t,n,i,s){super(),this.attributes=null,this.name=e,this.type=t,this.storage=n,this.access=i,this.value=s}get astNodeType(){return"let"}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}},hI=class extends Qo{constructor(e,t,n,i,s){super(),this.attributes=null,this.name=e,this.type=t,this.storage=n,this.access=i,this.value=s}get astNodeType(){return"const"}constEvaluate(e,t){return this.value.constEvaluate(e,t)}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}};(r=>{r.increment="++",r.decrement="--"})(x_||(x_={})),(r=>{r.parse=function(e){const t=e;if(t=="parse")throw new Error("Invalid value for IncrementOperator");return r[t]}})(x_||(x_={}));let kk=class extends Qo{constructor(e,t){super(),this.operator=e,this.variable=t}get astNodeType(){return"increment"}search(e){this.variable.search(e)}};(r=>{r.assign="=",r.addAssign="+=",r.subtractAssin="-=",r.multiplyAssign="*=",r.divideAssign="/=",r.moduloAssign="%=",r.andAssign="&=",r.orAssign="|=",r.xorAssign="^=",r.shiftLeftAssign="<<=",r.shiftRightAssign=">>="})(d1||(d1={})),(r=>{r.parse=function(e){const t=e;if(t=="parse")throw new Error("Invalid value for AssignOperator");return t}})(d1||(d1={}));class Uk extends Qo{constructor(e,t,n){super(),this.operator=e,this.variable=t,this.value=n}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}let dI=class extends Qo{constructor(e,t){super(),this.name=e,this.args=t}get astNodeType(){return"call"}search(e){for(const t of this.args)t.search(e);e(this)}};class Nk extends Qo{constructor(e,t){super(),this.body=e,this.continuing=t}get astNodeType(){return"loop"}}let zk=class extends Qo{constructor(e,t){super(),this.condition=e,this.cases=t}get astNodeType(){return"switch"}},Hk=class extends Qo{constructor(e,t,n,i){super(),this.condition=e,this.body=t,this.elseif=n,this.else=i}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}},Vk=class extends Qo{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}};class Tne extends Qo{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}let Sne=class extends Qo{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}},Gk=class extends Qo{constructor(e,t){super(),this.severity=e,this.rule=t}get astNodeType(){return"diagnostic"}},fI=class extends Qo{constructor(e,t){super(),this.name=e,this.type=t}get astNodeType(){return"alias"}},Ine=class extends Qo{constructor(){super()}get astNodeType(){return"discard"}};class Qk extends Qo{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}}let $k=class extends Qo{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}},dn=class sS extends Qo{constructor(e){super(),this.attributes=null,this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(e){let t=e[0];if(t.name==="f32")return t;for(let n=1;n<e.length;++n){const i=sS._priority.get(t.name);sS._priority.get(e[n].name)<i&&(t=e[n])}return t.name==="x32"?sS.i32:t}};dn.x32=new dn("x32"),dn.f32=new dn("f32"),dn.i32=new dn("i32"),dn.u32=new dn("u32"),dn.f16=new dn("f16"),dn.bool=new dn("bool"),dn._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);let ip=class extends dn{constructor(e,t,n,i){super(e),this.members=t,this.startLine=n,this.endLine=i}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let t=0;t<this.members.length;t++)if(this.members[t].name==e)return t;return-1}},Nr=class extends dn{constructor(e,t,n){super(e),this.format=t,this.access=n}get astNodeType(){return"template"}};Nr.vec2f=new Nr("vec2",dn.f32,null),Nr.vec3f=new Nr("vec3",dn.f32,null),Nr.vec4f=new Nr("vec4",dn.f32,null),Nr.vec2i=new Nr("vec2",dn.i32,null),Nr.vec3i=new Nr("vec3",dn.i32,null),Nr.vec4i=new Nr("vec4",dn.i32,null),Nr.vec2u=new Nr("vec2",dn.u32,null),Nr.vec3u=new Nr("vec3",dn.u32,null),Nr.vec4u=new Nr("vec4",dn.u32,null),Nr.vec2h=new Nr("vec2",dn.f16,null),Nr.vec3h=new Nr("vec3",dn.f16,null),Nr.vec4h=new Nr("vec4",dn.f16,null),Nr.vec2b=new Nr("vec2",dn.bool,null),Nr.vec3b=new Nr("vec3",dn.bool,null),Nr.vec4b=new Nr("vec4",dn.bool,null),Nr.mat2x2f=new Nr("mat2x2",dn.f32,null),Nr.mat2x3f=new Nr("mat2x3",dn.f32,null),Nr.mat2x4f=new Nr("mat2x4",dn.f32,null),Nr.mat3x2f=new Nr("mat3x2",dn.f32,null),Nr.mat3x3f=new Nr("mat3x3",dn.f32,null),Nr.mat3x4f=new Nr("mat3x4",dn.f32,null),Nr.mat4x2f=new Nr("mat4x2",dn.f32,null),Nr.mat4x3f=new Nr("mat4x3",dn.f32,null),Nr.mat4x4f=new Nr("mat4x4",dn.f32,null),Nr.mat2x2h=new Nr("mat2x2",dn.f16,null),Nr.mat2x3h=new Nr("mat2x3",dn.f16,null),Nr.mat2x4h=new Nr("mat2x4",dn.f16,null),Nr.mat3x2h=new Nr("mat3x2",dn.f16,null),Nr.mat3x3h=new Nr("mat3x3",dn.f16,null),Nr.mat3x4h=new Nr("mat3x4",dn.f16,null),Nr.mat4x2h=new Nr("mat4x2",dn.f16,null),Nr.mat4x3h=new Nr("mat4x3",dn.f16,null),Nr.mat4x4h=new Nr("mat4x4",dn.f16,null);class Mne extends dn{constructor(e,t,n,i){super(e),this.storage=t,this.type=n,this.access=i}get astNodeType(){return"pointer"}}let jk=class extends dn{constructor(e,t,n,i){super(e),this.attributes=t,this.format=n,this.count=i}get astNodeType(){return"array"}get isArray(){return!0}};class f1 extends dn{constructor(e,t,n){super(e),this.format=t,this.access=n}get astNodeType(){return"sampler"}}let Dd=class extends rd{constructor(){super(),this.postfix=null}},Bg=class extends Dd{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}},Cg=class extends Dd{constructor(e,t){super(),this.type=e,this.args=t}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(const t of this.args)t.search(e)}constEvaluate(e,t){return t&&(t[0]=this.type),e.evalExpression(this,e.context)}},iw=class CZ extends Dd{constructor(e,t){super(),this.cachedReturnValue=null,this.name=e,this.args=t}get astNodeType(){return"callExpr"}setCachedReturnValue(e){this.cachedReturnValue=e}get isBuiltin(){return CZ.builtinFunctionNames.has(this.name)}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){for(const t of this.args)t.search(e);e(this)}};iw.builtinFunctionNames=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]);let sp=class extends Dd{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}constEvaluate(e,t){return e.evalExpression(this,e.context)}},qk=class extends Dd{constructor(e,t){super(),this.name=e,this.initializer=t}get astNodeType(){return"constExpr"}constEvaluate(e,t){if(this.initializer){const n=e.evalExpression(this.initializer,e.context);return n!==null&&this.postfix?n.getDataValue(e,this.postfix,e.context):n}return null}search(e){this.initializer.search(e)}},pa=class extends Dd{constructor(e,t){super(),this.value=e,this.type=t}get astNodeType(){return"literalExpr"}constEvaluate(e,t){return t!==void 0&&(t[0]=this.type),this.value}get isScalar(){return this.value instanceof hr}get isVector(){return this.value instanceof Lt||this.value instanceof $s}get scalarValue(){return this.value instanceof hr?this.value.value:(console.error("Value is not scalar."),0)}get vectorValue(){return this.value instanceof Lt||this.value instanceof $s?this.value.value:(console.error("Value is not a vector or matrix."),[])}},Kk=class extends Dd{constructor(e,t){super(),this.type=e,this.value=t}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}},sw=class extends Dd{constructor(e){super(),this.contents=e}get astNodeType(){return"groupExpr"}constEvaluate(e,t){return this.contents[0].constEvaluate(e,t)}search(e){this.searchBlock(this.contents,e)}},w_=class extends Dd{constructor(e){super(),this.index=e}search(e){this.index.search(e)}},Wk=class extends Dd{constructor(){super()}},bh=class extends Wk{constructor(e,t){super(),this.operator=e,this.right=t}get astNodeType(){return"unaryOp"}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.right.search(e)}},Od=class extends Wk{constructor(e,t,n){super(),this.operator=e,this.left=t,this.right=n}get astNodeType(){return"binaryOp"}_getPromotedType(e,t){return e.name===t.name?e:e.name==="f32"||t.name==="f32"?dn.f32:e.name==="u32"||t.name==="u32"?dn.u32:dn.i32}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.left.search(e),this.right.search(e)}},Xk=class extends rd{constructor(e){super(),this.body=e}},ow=class extends Dd{constructor(){super()}get astNodeType(){return"default"}},Jk=class extends Xk{constructor(e,t){super(t),this.selectors=e}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}},Zk=class extends Xk{constructor(e){super(e)}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}},Pne=class extends rd{constructor(e,t,n){super(),this.name=e,this.type=t,this.attributes=n}get astNodeType(){return"argument"}},Fne=class extends rd{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}},Rne=class extends rd{constructor(e,t,n){super(),this.name=e,this.type=t,this.attributes=n}get astNodeType(){return"member"}},Lne=class extends rd{constructor(e,t){super(),this.name=e,this.value=t}get astNodeType(){return"attribute"}},Eg=class{constructor(e){this.typeInfo=e}setDataValue(e,t,n,i){console.error("SetDataValue: Not implemented",t,n)}getDataValue(e,t,n){return console.error("GetDataValue: Not implemented",t),null}toString(){return`<${this.typeInfo.name}>`}},AI=class extends Eg{constructor(){super(new Ld("void",null))}toString(){return"void"}};AI.void=new AI;let hr=class EZ extends Eg{constructor(e,t){super(t),this.typeInfo.name==="i32"||this.typeInfo.name==="u32"?e=Math.floor(e):this.typeInfo.name==="bool"&&(e=e?1:0),this.value=e}setDataValue(e,t,n,i){n?console.error("SetDataValue: Scalar data does not support postfix",n):t instanceof EZ?(t.value,this.typeInfo.name==="i32"||this.typeInfo.name==="u32"||this.typeInfo.name,this.value=t.value):console.error("SetDataValue: Invalid value",t)}getDataValue(e,t,n){return t?(console.error("GetDataValue: Scalar data does not support postfix",t),null):this}toString(){return`${this.value}`}};function Yk(r,e,t){const n=e.length;return n===2?t==="f32"?new Lt(e,r.getTypeInfo("vec2f")):t==="i32"?new Lt(e,r.getTypeInfo("vec2i")):t==="u32"?new Lt(e,r.getTypeInfo("vec2u")):t==="f16"?new Lt(e,r.getTypeInfo("vec2h")):(console.error(`GetDataValue: Unknown format ${t}`),null):n===3?t==="f32"?new Lt(e,r.getTypeInfo("vec3f")):t==="i32"?new Lt(e,r.getTypeInfo("vec3i")):t==="u32"?new Lt(e,r.getTypeInfo("vec3u")):t==="f16"?new Lt(e,r.getTypeInfo("vec3h")):(console.error(`GetDataValue: Unknown format ${t}`),null):n===4?t==="f32"?new Lt(e,r.getTypeInfo("vec4f")):t==="i32"?new Lt(e,r.getTypeInfo("vec4i")):t==="u32"?new Lt(e,r.getTypeInfo("vec4u")):t==="f16"?new Lt(e,r.getTypeInfo("vec4h")):(console.error(`GetDataValue: Unknown format ${t}`),null):(console.error(`GetDataValue: Invalid vector size ${e.length}`),null)}let Lt=class TZ extends Eg{constructor(e,t){super(t),Array.isArray(e)?this.value=e:this.value=Array.from(e)}setDataValue(e,t,n,i){n instanceof Bg?console.error("TODO: Set vector postfix"):t instanceof TZ?this.value=t.value:console.error("SetDataValue: Invalid value",t)}getDataValue(e,t,n){let i=e.getTypeInfo("f32");if(this.typeInfo instanceof tp)i=this.typeInfo.format;else{const s=this.typeInfo.name;s==="vec2f"||s==="vec3f"||s==="vec4f"?i=e.getTypeInfo("f32"):s==="vec2i"||s==="vec3i"||s==="vec4i"?i=e.getTypeInfo("i32"):s==="vec2u"||s==="vec3u"||s==="vec4u"?i=e.getTypeInfo("u32"):s==="vec2h"||s==="vec3h"||s==="vec4h"?i=e.getTypeInfo("f16"):console.error(`GetDataValue: Unknown type ${s}`)}if(t instanceof w_){const s=t.index;let a=-1;if(s instanceof pa){if(!(s.value instanceof hr))return console.error(`GetValueData: Invalid array index ${s.value}`),null;a=s.value.value}else{const o=e.evalExpression(s,n);if(!(o instanceof hr))return console.error("GetDataValue: Unknown index type",s),null;a=o.value}return a<0||a>=this.value.length?(console.error("GetDataValue: Index out of range",a),null):new hr(this.value[a],i)}if(t instanceof Bg){const s=t.value,a=[];for(const o of s)o==="x"||o==="r"?a.push(this.value[0]):o==="y"||o==="g"?a.push(this.value[1]):o==="z"||o==="b"?a.push(this.value[2]):o==="w"||o==="a"?a.push(this.value[3]):console.error(`GetDataValue: Unknown member ${o}`);return a.length===1?new hr(a[0],i):Yk(e,a,i.name)}return this}toString(){let e=`${this.value[0]}`;for(let t=1;t<this.value.length;++t)e+=`, ${this.value[t]}`;return e}},$s=class SZ extends Eg{constructor(e,t){super(t),this.value=e}setDataValue(e,t,n,i){n instanceof Bg?console.error("TODO: Set matrix postfix"):t instanceof SZ?this.value=t.value:console.error("SetDataValue: Invalid value",t)}getDataValue(e,t,n){const i=this.typeInfo.name;let s=e.getTypeInfo("f32");if(this.typeInfo instanceof tp)s=this.typeInfo.format;else if(i.endsWith("f"))s=e.getTypeInfo("f32");else if(i.endsWith("i"))s=e.getTypeInfo("i32");else if(i.endsWith("u"))s=e.getTypeInfo("u32");else{if(!i.endsWith("h"))return console.error(`GetDataValue: Unknown type ${i}`),null;s=e.getTypeInfo("f16")}if(t instanceof w_){const a=t.index;let o,h=-1;if(a instanceof pa){if(!(a.value instanceof hr))return console.error(`GetDataValue: Invalid array index ${a.value}`),null;h=a.value.value}else{const _=e.evalExpression(a,n);if(!(_ instanceof hr))return console.error("GetDataValue: Unknown index type",a),null;h=_.value}if(h<0||h>=this.value.length)return console.error("GetDataValue: Index out of range",h),null;if(i==="mat2x2"||i==="mat2x2f"||i==="mat2x2h")o=this.value.slice(2*h,2*h+2);else if(i==="mat2x3"||i==="mat2x3f"||i==="mat2x3h")o=this.value.slice(3*h,3*h+3);else if(i==="mat2x4"||i==="mat2x4f"||i==="mat2x4h")o=this.value.slice(4*h,4*h+4);else if(i==="mat3x2"||i==="mat3x2f"||i==="mat3x2h")o=this.value.slice(2*h,2*h+2);else if(i==="mat3x3"||i==="mat3x3f"||i==="mat3x3h")o=this.value.slice(3*h,3*h+3);else if(i==="mat3x4"||i==="mat3x4f"||i==="mat3x4h")o=this.value.slice(4*h,4*h+4);else if(i==="mat4x2"||i==="mat4x2f"||i==="mat4x2h")o=this.value.slice(2*h,2*h+2);else if(i==="mat4x3"||i==="mat4x3f"||i==="mat4x3h")o=this.value.slice(3*h,3*h+3);else{if(i!=="mat4x4"&&i!=="mat4x4f"&&i!=="mat4x4h")return console.error(`GetDataValue: Unknown type ${i}`),null;o=this.value.slice(4*h,4*h+4)}const f=Yk(e,o,s.name);if(t.postfix)return f.getDataValue(e,t.postfix,n)}return this}toString(){let e=`${this.value[0]}`;for(let t=1;t<this.value.length;++t)e+=`, ${this.value[t]}`;return e}},Ml=class QD extends Eg{constructor(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0;super(t),this.textureSize=[0,0,0],this.buffer=e instanceof ArrayBuffer?e:e.buffer,this.offset=n,i!==void 0&&(this.textureSize=i)}setDataValue(e,t,n,i){if(t===null)return void console.log("setDataValue: NULL data.");let s=this.offset,a=this.typeInfo;for(;n;){if(n instanceof w_)if(a instanceof wg){const o=n.index;if(o instanceof pa){if(!(o.value instanceof hr))return void console.error(`SetDataValue: Invalid index type ${o.value}`);s+=o.value.value*a.stride}else{const h=e.evalExpression(o,i);if(!(h instanceof hr))return void console.error("SetDataValue: Unknown index type",o);s+=h.value*a.stride}a=a.format}else console.error(`SetDataValue: Type ${e.getTypeName(a)} is not an array`);else{if(!(n instanceof Bg))return void console.error("SetDataValue: Unknown postfix type",n);{const o=n.value;if(a instanceof ep){let h=!1;for(const f of a.members)if(f.name===o){s+=f.offset,a=f.type,h=!0;break}if(!h)return void console.error(`SetDataValue: Member ${o} not found`)}else if(a instanceof Ld){const h=e.getTypeName(a);let f=0;if(o==="x"||o==="r")f=0;else if(o==="y"||o==="g")f=1;else if(o==="z"||o==="b")f=2;else{if(o!=="w"&&o!=="a")return void console.error(`SetDataValue: Unknown member ${o}`);f=3}if(!(t instanceof hr))return void console.error("SetDataValue: Invalid value",t);const _=t.value;return h==="vec2f"?void(new Float32Array(this.buffer,s,2)[f]=_):h==="vec3f"?void(new Float32Array(this.buffer,s,3)[f]=_):h==="vec4f"?void(new Float32Array(this.buffer,s,4)[f]=_):h==="vec2i"?void(new Int32Array(this.buffer,s,2)[f]=_):h==="vec3i"?void(new Int32Array(this.buffer,s,3)[f]=_):h==="vec4i"?void(new Int32Array(this.buffer,s,4)[f]=_):h==="vec2u"?void(new Uint32Array(this.buffer,s,2)[f]=_):h==="vec3u"?void(new Uint32Array(this.buffer,s,3)[f]=_):h==="vec4u"?void(new Uint32Array(this.buffer,s,4)[f]=_):void console.error(`SetDataValue: Type ${h} is not a struct`)}}}n=n.postfix}this.setData(e,t,a,s,i)}setData(e,t,n,i,s){const a=e.getTypeName(n);if(a!=="f32"&&a!=="f16")if(a!=="i32"&&a!=="atomic<i32>"&&a!=="x32")if(a!=="u32"&&a!=="atomic<u32>")if(a!=="bool")if(a!=="vec2f"&&a!=="vec2h")if(a!=="vec3f"&&a!=="vec3h")if(a!=="vec4f"&&a!=="vec4h")if(a!=="vec2i")if(a!=="vec3i")if(a!=="vec4i")if(a!=="vec2u")if(a!=="vec3u")if(a!=="vec4u")if(a!=="vec2b")if(a!=="vec3b")if(a!=="vec4b")if(a!=="mat2x2f"&&a!=="mat2x2h")if(a!=="mat2x3f"&&a!=="mat2x3h")if(a!=="mat2x4f"&&a!=="mat2x4h")if(a!=="mat3x2f"&&a!=="mat3x2h")if(a!=="mat3x3f"&&a!=="mat3x3h")if(a!=="mat3x4f"&&a!=="mat3x4h")if(a!=="mat4x2f"&&a!=="mat4x2h")if(a!=="mat4x3f"&&a!=="mat4x3h")if(a!=="mat4x4f"&&a!=="mat4x4h")if(t instanceof QD){if(n===t.typeInfo)return void new Uint8Array(this.buffer,i,t.buffer.byteLength).set(new Uint8Array(t.buffer));console.error("SetDataValue: Type mismatch",a,e.getTypeName(t.typeInfo))}else console.error(`SetData: Unknown type ${a}`);else{const o=new Float32Array(this.buffer,i,16);t instanceof $s?(o[0]=t.value[0],o[1]=t.value[1],o[2]=t.value[2],o[3]=t.value[3],o[4]=t.value[4],o[5]=t.value[5],o[6]=t.value[6],o[7]=t.value[7],o[8]=t.value[8],o[9]=t.value[9],o[10]=t.value[10],o[11]=t.value[11],o[12]=t.value[12],o[13]=t.value[13],o[14]=t.value[14],o[15]=t.value[15]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[4]=t[4],o[5]=t[5],o[6]=t[6],o[7]=t[7],o[8]=t[8],o[9]=t[9],o[10]=t[10],o[11]=t[11],o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15])}else{const o=new Float32Array(this.buffer,i,12);t instanceof $s?(o[0]=t.value[0],o[1]=t.value[1],o[2]=t.value[2],o[3]=t.value[3],o[4]=t.value[4],o[5]=t.value[5],o[6]=t.value[6],o[7]=t.value[7],o[8]=t.value[8],o[9]=t.value[9],o[10]=t.value[10],o[11]=t.value[11]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[4]=t[4],o[5]=t[5],o[6]=t[6],o[7]=t[7],o[8]=t[8],o[9]=t[9],o[10]=t[10],o[11]=t[11])}else{const o=new Float32Array(this.buffer,i,8);t instanceof $s?(o[0]=t.value[0],o[1]=t.value[1],o[2]=t.value[2],o[3]=t.value[3],o[4]=t.value[4],o[5]=t.value[5],o[6]=t.value[6],o[7]=t.value[7]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[4]=t[4],o[5]=t[5],o[6]=t[6],o[7]=t[7])}else{const o=new Float32Array(this.buffer,i,12);t instanceof $s?(o[0]=t.value[0],o[1]=t.value[1],o[2]=t.value[2],o[3]=t.value[3],o[4]=t.value[4],o[5]=t.value[5],o[6]=t.value[6],o[7]=t.value[7],o[8]=t.value[8],o[9]=t.value[9],o[10]=t.value[10],o[11]=t.value[11]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[4]=t[4],o[5]=t[5],o[6]=t[6],o[7]=t[7],o[8]=t[8],o[9]=t[9],o[10]=t[10],o[11]=t[11])}else{const o=new Float32Array(this.buffer,i,9);t instanceof $s?(o[0]=t.value[0],o[1]=t.value[1],o[2]=t.value[2],o[3]=t.value[3],o[4]=t.value[4],o[5]=t.value[5],o[6]=t.value[6],o[7]=t.value[7],o[8]=t.value[8]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[4]=t[4],o[5]=t[5],o[6]=t[6],o[7]=t[7],o[8]=t[8])}else{const o=new Float32Array(this.buffer,i,6);t instanceof $s?(o[0]=t.value[0],o[1]=t.value[1],o[2]=t.value[2],o[3]=t.value[3],o[4]=t.value[4],o[5]=t.value[5]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[4]=t[4],o[5]=t[5])}else{const o=new Float32Array(this.buffer,i,8);t instanceof $s?(o[0]=t.value[0],o[1]=t.value[1],o[2]=t.value[2],o[3]=t.value[3],o[4]=t.value[4],o[5]=t.value[5],o[6]=t.value[6],o[7]=t.value[7]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[4]=t[4],o[5]=t[5],o[6]=t[6],o[7]=t[7])}else{const o=new Float32Array(this.buffer,i,6);t instanceof $s?(o[0]=t.value[0],o[1]=t.value[1],o[2]=t.value[2],o[3]=t.value[3],o[4]=t.value[4],o[5]=t.value[5]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[4]=t[4],o[5]=t[5])}else{const o=new Float32Array(this.buffer,i,4);t instanceof $s?(o[0]=t.value[0],o[1]=t.value[1],o[2]=t.value[2],o[3]=t.value[3]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3])}else{const o=new Uint32Array(this.buffer,i,4);t instanceof Lt?(o[0]=t.value[0],o[1]=t.value[1],o[2]=t.value[2],o[3]=t.value[3]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3])}else{const o=new Uint32Array(this.buffer,i,3);t instanceof Lt?(o[0]=t.value[0],o[1]=t.value[1],o[2]=t.value[2]):(o[0]=t[0],o[1]=t[1],o[2]=t[2])}else{const o=new Uint32Array(this.buffer,i,2);t instanceof Lt?(o[0]=t.value[0],o[1]=t.value[1]):(o[0]=t[0],o[1]=t[1])}else{const o=new Uint32Array(this.buffer,i,4);t instanceof Lt?(o[0]=t.value[0],o[1]=t.value[1],o[2]=t.value[2],o[3]=t.value[3]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3])}else{const o=new Uint32Array(this.buffer,i,3);t instanceof Lt?(o[0]=t.value[0],o[1]=t.value[1],o[2]=t.value[2]):(o[0]=t[0],o[1]=t[1],o[2]=t[2])}else{const o=new Uint32Array(this.buffer,i,2);t instanceof Lt?(o[0]=t.value[0],o[1]=t.value[1]):(o[0]=t[0],o[1]=t[1])}else{const o=new Int32Array(this.buffer,i,4);t instanceof Lt?(o[0]=t.value[0],o[1]=t.value[1],o[2]=t.value[2],o[3]=t.value[3]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3])}else{const o=new Int32Array(this.buffer,i,3);t instanceof Lt?(o[0]=t.value[0],o[1]=t.value[1],o[2]=t.value[2]):(o[0]=t[0],o[1]=t[1],o[2]=t[2])}else{const o=new Int32Array(this.buffer,i,2);t instanceof Lt?(o[0]=t.value[0],o[1]=t.value[1]):(o[0]=t[0],o[1]=t[1])}else{const o=new Float32Array(this.buffer,i,4);t instanceof Lt?(o[0]=t.value[0],o[1]=t.value[1],o[2]=t.value[2],o[3]=t.value[3]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3])}else{const o=new Float32Array(this.buffer,i,3);t instanceof Lt?(o[0]=t.value[0],o[1]=t.value[1],o[2]=t.value[2]):(o[0]=t[0],o[1]=t[1],o[2]=t[2])}else{const o=new Float32Array(this.buffer,i,2);t instanceof Lt?(o[0]=t.value[0],o[1]=t.value[1]):(o[0]=t[0],o[1]=t[1])}else t instanceof hr&&(new Int32Array(this.buffer,i,1)[0]=t.value);else t instanceof hr&&(new Uint32Array(this.buffer,i,1)[0]=t.value);else t instanceof hr&&(new Int32Array(this.buffer,i,1)[0]=t.value);else t instanceof hr&&(new Float32Array(this.buffer,i,1)[0]=t.value)}getDataValue(e,t,n){let i=this.offset,s=this.typeInfo;for(;t;){if(t instanceof w_){const o=t.index,h=e.evalExpression(o,n);let f=0;if(h instanceof hr?f=h.value:console.error("GetDataValue: Invalid index type",o),s instanceof wg)i+=f*s.stride,s=s.format;else{const _=e.getTypeName(s);_==="mat4x4"||_==="mat4x4f"||_==="mat4x4h"?(i+=16*f,s=e.getTypeInfo("vec4f")):console.error(`getDataValue: Type ${e.getTypeName(s)} is not an array`)}}else{if(!(t instanceof Bg))return console.error("GetDataValue: Unknown postfix type",t),null;{const o=t.value;if(s instanceof ep){let h=!1;for(const f of s.members)if(f.name===o){i+=f.offset,s=f.type,h=!0;break}if(!h)return console.error(`GetDataValue: Member ${o} not found`),null}else if(s instanceof Ld){const h=e.getTypeName(s);if(h==="vec2f"||h==="vec3f"||h==="vec4f"||h==="vec2i"||h==="vec3i"||h==="vec4i"||h==="vec2u"||h==="vec3u"||h==="vec4u"||h==="vec2b"||h==="vec3b"||h==="vec4b"||h==="vec2h"||h==="vec3h"||h==="vec4h"||h==="vec2"||h==="vec3"||h==="vec4"){if(o.length>0&&o.length<5){let f="f32",_="f";const x=[];for(let T=0;T<o.length;++T){const I=o[T].toLocaleLowerCase();let N=0;if(I==="x"||I==="r")N=0;else if(I==="y"||I==="g")N=1;else if(I==="z"||I==="b")N=2;else{if(I!=="w"&&I!=="a")return console.error(`Unknown member ${o}`),null;N=3}if(h==="vec2f")x.push(new Float32Array(this.buffer,i,2)[N]);else if(h==="vec3f"){if(i+12>=this.buffer.byteLength)return console.log("Insufficient buffer data"),null;const $=new Float32Array(this.buffer,i,3);x.push($[N])}else if(h==="vec4f")x.push(new Float32Array(this.buffer,i,4)[N]);else if(h==="vec2i")f="i32",_="i",x.push(new Int32Array(this.buffer,i,2)[N]);else if(h==="vec3i")f="i32",_="i",x.push(new Int32Array(this.buffer,i,3)[N]);else if(h==="vec4i")f="i32",_="i",x.push(new Int32Array(this.buffer,i,4)[N]);else if(h==="vec2u"){f="u32",_="u";const $=new Uint32Array(this.buffer,i,2);x.push($[N])}else h==="vec3u"?(f="u32",_="u",x.push(new Uint32Array(this.buffer,i,3)[N])):h==="vec4u"&&(f="u32",_="u",x.push(new Uint32Array(this.buffer,i,4)[N]))}return x.length===1?new hr(x[0],e.getTypeInfo(f)):(x.length===2?s=e.getTypeInfo(`vec2${_}`):x.length===3?s=e.getTypeInfo(`vec3${_}`):x.length===4?s=e.getTypeInfo(`vec4${_}`):console.error(`GetDataValue: Invalid vector length ${x.length}`),new Lt(x,s))}return console.error(`GetDataValue: Unknown member ${o}`),null}return console.error(`GetDataValue: Type ${h} is not a struct`),null}}}t=t.postfix}const a=e.getTypeName(s);return a==="f32"?new hr(new Float32Array(this.buffer,i,1)[0],s):a==="i32"?new hr(new Int32Array(this.buffer,i,1)[0],s):a==="u32"?new hr(new Uint32Array(this.buffer,i,1)[0],s):a==="vec2f"?new Lt(new Float32Array(this.buffer,i,2),s):a==="vec3f"?new Lt(new Float32Array(this.buffer,i,3),s):a==="vec4f"?new Lt(new Float32Array(this.buffer,i,4),s):a==="vec2i"?new Lt(new Int32Array(this.buffer,i,2),s):a==="vec3i"?new Lt(new Int32Array(this.buffer,i,3),s):a==="vec4i"?new Lt(new Int32Array(this.buffer,i,4),s):a==="vec2u"?new Lt(new Uint32Array(this.buffer,i,2),s):a==="vec3u"?new Lt(new Uint32Array(this.buffer,i,3),s):a==="vec4u"?new Lt(new Uint32Array(this.buffer,i,4),s):s instanceof tp&&s.name==="atomic"?s.format.name==="u32"?new hr(new Uint32Array(this.buffer,i,1)[0],s.format):s.format.name==="i32"?new hr(new Int32Array(this.buffer,i,1)[0],s.format):(console.error(`GetDataValue: Invalid atomic format ${s.format.name}`),null):new QD(this.buffer,s,i)}toString(){let e="";if(this.typeInfo instanceof wg)if(this.typeInfo.format.name==="f32"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let n=1;n<t.length;++n)e+=`, ${t[n]}`}else if(this.typeInfo.format.name==="i32"){const t=new Int32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let n=1;n<t.length;++n)e+=`, ${t[n]}`}else if(this.typeInfo.format.name==="u32"){const t=new Uint32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let n=1;n<t.length;++n)e+=`, ${t[n]}`}else if(this.typeInfo.format.name==="vec2f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}]`;for(let n=1;n<t.length/2;++n)e+=`, [${t[2*n]}, ${t[2*n+1]}]`}else if(this.typeInfo.format.name==="vec3f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}]`;for(let n=4;n<t.length;n+=4)e+=`, [${t[n]}, ${t[n+1]}, ${t[n+2]}]`}else if(this.typeInfo.format.name==="vec4f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}, ${t[3]}]`;for(let n=4;n<t.length;n+=4)e+=`, [${t[n]}, ${t[n+1]}, ${t[n+2]}, ${t[n+3]}]`}else e="[...]";else this.typeInfo instanceof ep?e+="{...}":e="[...]";return e}};(r=>{r[r.token=0]="token",r[r.keyword=1]="keyword",r[r.reserved=2]="reserved"})(Yt||(Yt={}));let tr=class{constructor(e,t,n){this.name=e,this.type=t,this.rule=n}toString(){return this.name}},pt=class{};cr=pt,pt.none=new tr("",Yt.reserved,""),pt.eof=new tr("EOF",Yt.token,""),pt.reserved={asm:new tr("asm",Yt.reserved,"asm"),bf16:new tr("bf16",Yt.reserved,"bf16"),do:new tr("do",Yt.reserved,"do"),enum:new tr("enum",Yt.reserved,"enum"),f16:new tr("f16",Yt.reserved,"f16"),f64:new tr("f64",Yt.reserved,"f64"),handle:new tr("handle",Yt.reserved,"handle"),i8:new tr("i8",Yt.reserved,"i8"),i16:new tr("i16",Yt.reserved,"i16"),i64:new tr("i64",Yt.reserved,"i64"),mat:new tr("mat",Yt.reserved,"mat"),premerge:new tr("premerge",Yt.reserved,"premerge"),regardless:new tr("regardless",Yt.reserved,"regardless"),typedef:new tr("typedef",Yt.reserved,"typedef"),u8:new tr("u8",Yt.reserved,"u8"),u16:new tr("u16",Yt.reserved,"u16"),u64:new tr("u64",Yt.reserved,"u64"),unless:new tr("unless",Yt.reserved,"unless"),using:new tr("using",Yt.reserved,"using"),vec:new tr("vec",Yt.reserved,"vec"),void:new tr("void",Yt.reserved,"void")},pt.keywords={array:new tr("array",Yt.keyword,"array"),atomic:new tr("atomic",Yt.keyword,"atomic"),bool:new tr("bool",Yt.keyword,"bool"),f32:new tr("f32",Yt.keyword,"f32"),i32:new tr("i32",Yt.keyword,"i32"),mat2x2:new tr("mat2x2",Yt.keyword,"mat2x2"),mat2x3:new tr("mat2x3",Yt.keyword,"mat2x3"),mat2x4:new tr("mat2x4",Yt.keyword,"mat2x4"),mat3x2:new tr("mat3x2",Yt.keyword,"mat3x2"),mat3x3:new tr("mat3x3",Yt.keyword,"mat3x3"),mat3x4:new tr("mat3x4",Yt.keyword,"mat3x4"),mat4x2:new tr("mat4x2",Yt.keyword,"mat4x2"),mat4x3:new tr("mat4x3",Yt.keyword,"mat4x3"),mat4x4:new tr("mat4x4",Yt.keyword,"mat4x4"),ptr:new tr("ptr",Yt.keyword,"ptr"),sampler:new tr("sampler",Yt.keyword,"sampler"),sampler_comparison:new tr("sampler_comparison",Yt.keyword,"sampler_comparison"),struct:new tr("struct",Yt.keyword,"struct"),texture_1d:new tr("texture_1d",Yt.keyword,"texture_1d"),texture_2d:new tr("texture_2d",Yt.keyword,"texture_2d"),texture_2d_array:new tr("texture_2d_array",Yt.keyword,"texture_2d_array"),texture_3d:new tr("texture_3d",Yt.keyword,"texture_3d"),texture_cube:new tr("texture_cube",Yt.keyword,"texture_cube"),texture_cube_array:new tr("texture_cube_array",Yt.keyword,"texture_cube_array"),texture_multisampled_2d:new tr("texture_multisampled_2d",Yt.keyword,"texture_multisampled_2d"),texture_storage_1d:new tr("texture_storage_1d",Yt.keyword,"texture_storage_1d"),texture_storage_2d:new tr("texture_storage_2d",Yt.keyword,"texture_storage_2d"),texture_storage_2d_array:new tr("texture_storage_2d_array",Yt.keyword,"texture_storage_2d_array"),texture_storage_3d:new tr("texture_storage_3d",Yt.keyword,"texture_storage_3d"),texture_depth_2d:new tr("texture_depth_2d",Yt.keyword,"texture_depth_2d"),texture_depth_2d_array:new tr("texture_depth_2d_array",Yt.keyword,"texture_depth_2d_array"),texture_depth_cube:new tr("texture_depth_cube",Yt.keyword,"texture_depth_cube"),texture_depth_cube_array:new tr("texture_depth_cube_array",Yt.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new tr("texture_depth_multisampled_2d",Yt.keyword,"texture_depth_multisampled_2d"),texture_external:new tr("texture_external",Yt.keyword,"texture_external"),u32:new tr("u32",Yt.keyword,"u32"),vec2:new tr("vec2",Yt.keyword,"vec2"),vec3:new tr("vec3",Yt.keyword,"vec3"),vec4:new tr("vec4",Yt.keyword,"vec4"),bitcast:new tr("bitcast",Yt.keyword,"bitcast"),block:new tr("block",Yt.keyword,"block"),break:new tr("break",Yt.keyword,"break"),case:new tr("case",Yt.keyword,"case"),continue:new tr("continue",Yt.keyword,"continue"),continuing:new tr("continuing",Yt.keyword,"continuing"),default:new tr("default",Yt.keyword,"default"),diagnostic:new tr("diagnostic",Yt.keyword,"diagnostic"),discard:new tr("discard",Yt.keyword,"discard"),else:new tr("else",Yt.keyword,"else"),enable:new tr("enable",Yt.keyword,"enable"),fallthrough:new tr("fallthrough",Yt.keyword,"fallthrough"),false:new tr("false",Yt.keyword,"false"),fn:new tr("fn",Yt.keyword,"fn"),for:new tr("for",Yt.keyword,"for"),function:new tr("function",Yt.keyword,"function"),if:new tr("if",Yt.keyword,"if"),let:new tr("let",Yt.keyword,"let"),const:new tr("const",Yt.keyword,"const"),loop:new tr("loop",Yt.keyword,"loop"),while:new tr("while",Yt.keyword,"while"),private:new tr("private",Yt.keyword,"private"),read:new tr("read",Yt.keyword,"read"),read_write:new tr("read_write",Yt.keyword,"read_write"),return:new tr("return",Yt.keyword,"return"),requires:new tr("requires",Yt.keyword,"requires"),storage:new tr("storage",Yt.keyword,"storage"),switch:new tr("switch",Yt.keyword,"switch"),true:new tr("true",Yt.keyword,"true"),alias:new tr("alias",Yt.keyword,"alias"),type:new tr("type",Yt.keyword,"type"),uniform:new tr("uniform",Yt.keyword,"uniform"),var:new tr("var",Yt.keyword,"var"),override:new tr("override",Yt.keyword,"override"),workgroup:new tr("workgroup",Yt.keyword,"workgroup"),write:new tr("write",Yt.keyword,"write"),r8unorm:new tr("r8unorm",Yt.keyword,"r8unorm"),r8snorm:new tr("r8snorm",Yt.keyword,"r8snorm"),r8uint:new tr("r8uint",Yt.keyword,"r8uint"),r8sint:new tr("r8sint",Yt.keyword,"r8sint"),r16uint:new tr("r16uint",Yt.keyword,"r16uint"),r16sint:new tr("r16sint",Yt.keyword,"r16sint"),r16float:new tr("r16float",Yt.keyword,"r16float"),rg8unorm:new tr("rg8unorm",Yt.keyword,"rg8unorm"),rg8snorm:new tr("rg8snorm",Yt.keyword,"rg8snorm"),rg8uint:new tr("rg8uint",Yt.keyword,"rg8uint"),rg8sint:new tr("rg8sint",Yt.keyword,"rg8sint"),r32uint:new tr("r32uint",Yt.keyword,"r32uint"),r32sint:new tr("r32sint",Yt.keyword,"r32sint"),r32float:new tr("r32float",Yt.keyword,"r32float"),rg16uint:new tr("rg16uint",Yt.keyword,"rg16uint"),rg16sint:new tr("rg16sint",Yt.keyword,"rg16sint"),rg16float:new tr("rg16float",Yt.keyword,"rg16float"),rgba8unorm:new tr("rgba8unorm",Yt.keyword,"rgba8unorm"),rgba8unorm_srgb:new tr("rgba8unorm_srgb",Yt.keyword,"rgba8unorm_srgb"),rgba8snorm:new tr("rgba8snorm",Yt.keyword,"rgba8snorm"),rgba8uint:new tr("rgba8uint",Yt.keyword,"rgba8uint"),rgba8sint:new tr("rgba8sint",Yt.keyword,"rgba8sint"),bgra8unorm:new tr("bgra8unorm",Yt.keyword,"bgra8unorm"),bgra8unorm_srgb:new tr("bgra8unorm_srgb",Yt.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new tr("rgb10a2unorm",Yt.keyword,"rgb10a2unorm"),rg11b10float:new tr("rg11b10float",Yt.keyword,"rg11b10float"),rg32uint:new tr("rg32uint",Yt.keyword,"rg32uint"),rg32sint:new tr("rg32sint",Yt.keyword,"rg32sint"),rg32float:new tr("rg32float",Yt.keyword,"rg32float"),rgba16uint:new tr("rgba16uint",Yt.keyword,"rgba16uint"),rgba16sint:new tr("rgba16sint",Yt.keyword,"rgba16sint"),rgba16float:new tr("rgba16float",Yt.keyword,"rgba16float"),rgba32uint:new tr("rgba32uint",Yt.keyword,"rgba32uint"),rgba32sint:new tr("rgba32sint",Yt.keyword,"rgba32sint"),rgba32float:new tr("rgba32float",Yt.keyword,"rgba32float"),static_assert:new tr("static_assert",Yt.keyword,"static_assert")},pt.tokens={decimal_float_literal:new tr("decimal_float_literal",Yt.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new tr("hex_float_literal",Yt.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new tr("int_literal",Yt.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new tr("uint_literal",Yt.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new tr("name",Yt.token,/[_a-zA-Z][0-9a-zA-Z_]*/),ident:new tr("ident",Yt.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new tr("and",Yt.token,"&"),and_and:new tr("and_and",Yt.token,"&&"),arrow:new tr("arrow ",Yt.token,"->"),attr:new tr("attr",Yt.token,"@"),forward_slash:new tr("forward_slash",Yt.token,"/"),bang:new tr("bang",Yt.token,"!"),bracket_left:new tr("bracket_left",Yt.token,"["),bracket_right:new tr("bracket_right",Yt.token,"]"),brace_left:new tr("brace_left",Yt.token,"{"),brace_right:new tr("brace_right",Yt.token,"}"),colon:new tr("colon",Yt.token,":"),comma:new tr("comma",Yt.token,","),equal:new tr("equal",Yt.token,"="),equal_equal:new tr("equal_equal",Yt.token,"=="),not_equal:new tr("not_equal",Yt.token,"!="),greater_than:new tr("greater_than",Yt.token,">"),greater_than_equal:new tr("greater_than_equal",Yt.token,">="),shift_right:new tr("shift_right",Yt.token,">>"),less_than:new tr("less_than",Yt.token,"<"),less_than_equal:new tr("less_than_equal",Yt.token,"<="),shift_left:new tr("shift_left",Yt.token,"<<"),modulo:new tr("modulo",Yt.token,"%"),minus:new tr("minus",Yt.token,"-"),minus_minus:new tr("minus_minus",Yt.token,"--"),period:new tr("period",Yt.token,"."),plus:new tr("plus",Yt.token,"+"),plus_plus:new tr("plus_plus",Yt.token,"++"),or:new tr("or",Yt.token,"|"),or_or:new tr("or_or",Yt.token,"||"),paren_left:new tr("paren_left",Yt.token,"("),paren_right:new tr("paren_right",Yt.token,")"),semicolon:new tr("semicolon",Yt.token,";"),star:new tr("star",Yt.token,"*"),tilde:new tr("tilde",Yt.token,"~"),underscore:new tr("underscore",Yt.token,"_"),xor:new tr("xor",Yt.token,"^"),plus_equal:new tr("plus_equal",Yt.token,"+="),minus_equal:new tr("minus_equal",Yt.token,"-="),times_equal:new tr("times_equal",Yt.token,"*="),division_equal:new tr("division_equal",Yt.token,"/="),modulo_equal:new tr("modulo_equal",Yt.token,"%="),and_equal:new tr("and_equal",Yt.token,"&="),or_equal:new tr("or_equal",Yt.token,"|="),xor_equal:new tr("xor_equal",Yt.token,"^="),shift_right_equal:new tr("shift_right_equal",Yt.token,">>="),shift_left_equal:new tr("shift_left_equal",Yt.token,"<<=")},pt.simpleTokens={"@":cr.tokens.attr,"{":cr.tokens.brace_left,"}":cr.tokens.brace_right,":":cr.tokens.colon,",":cr.tokens.comma,"(":cr.tokens.paren_left,")":cr.tokens.paren_right,";":cr.tokens.semicolon},pt.literalTokens={"&":cr.tokens.and,"&&":cr.tokens.and_and,"->":cr.tokens.arrow,"/":cr.tokens.forward_slash,"!":cr.tokens.bang,"[":cr.tokens.bracket_left,"]":cr.tokens.bracket_right,"=":cr.tokens.equal,"==":cr.tokens.equal_equal,"!=":cr.tokens.not_equal,">":cr.tokens.greater_than,">=":cr.tokens.greater_than_equal,">>":cr.tokens.shift_right,"<":cr.tokens.less_than,"<=":cr.tokens.less_than_equal,"<<":cr.tokens.shift_left,"%":cr.tokens.modulo,"-":cr.tokens.minus,"--":cr.tokens.minus_minus,".":cr.tokens.period,"+":cr.tokens.plus,"++":cr.tokens.plus_plus,"|":cr.tokens.or,"||":cr.tokens.or_or,"*":cr.tokens.star,"~":cr.tokens.tilde,_:cr.tokens.underscore,"^":cr.tokens.xor,"+=":cr.tokens.plus_equal,"-=":cr.tokens.minus_equal,"*=":cr.tokens.times_equal,"/=":cr.tokens.division_equal,"%=":cr.tokens.modulo_equal,"&=":cr.tokens.and_equal,"|=":cr.tokens.or_equal,"^=":cr.tokens.xor_equal,">>=":cr.tokens.shift_right_equal,"<<=":cr.tokens.shift_left_equal},pt.regexTokens={decimal_float_literal:cr.tokens.decimal_float_literal,hex_float_literal:cr.tokens.hex_float_literal,int_literal:cr.tokens.int_literal,uint_literal:cr.tokens.uint_literal,ident:cr.tokens.ident},pt.storage_class=[cr.keywords.function,cr.keywords.private,cr.keywords.workgroup,cr.keywords.uniform,cr.keywords.storage],pt.access_mode=[cr.keywords.read,cr.keywords.write,cr.keywords.read_write],pt.sampler_type=[cr.keywords.sampler,cr.keywords.sampler_comparison],pt.sampled_texture_type=[cr.keywords.texture_1d,cr.keywords.texture_2d,cr.keywords.texture_2d_array,cr.keywords.texture_3d,cr.keywords.texture_cube,cr.keywords.texture_cube_array],pt.multisampled_texture_type=[cr.keywords.texture_multisampled_2d],pt.storage_texture_type=[cr.keywords.texture_storage_1d,cr.keywords.texture_storage_2d,cr.keywords.texture_storage_2d_array,cr.keywords.texture_storage_3d],pt.depth_texture_type=[cr.keywords.texture_depth_2d,cr.keywords.texture_depth_2d_array,cr.keywords.texture_depth_cube,cr.keywords.texture_depth_cube_array,cr.keywords.texture_depth_multisampled_2d],pt.texture_external_type=[cr.keywords.texture_external],pt.any_texture_type=[...cr.sampled_texture_type,...cr.multisampled_texture_type,...cr.storage_texture_type,...cr.depth_texture_type,...cr.texture_external_type],pt.texel_format=[cr.keywords.r8unorm,cr.keywords.r8snorm,cr.keywords.r8uint,cr.keywords.r8sint,cr.keywords.r16uint,cr.keywords.r16sint,cr.keywords.r16float,cr.keywords.rg8unorm,cr.keywords.rg8snorm,cr.keywords.rg8uint,cr.keywords.rg8sint,cr.keywords.r32uint,cr.keywords.r32sint,cr.keywords.r32float,cr.keywords.rg16uint,cr.keywords.rg16sint,cr.keywords.rg16float,cr.keywords.rgba8unorm,cr.keywords.rgba8unorm_srgb,cr.keywords.rgba8snorm,cr.keywords.rgba8uint,cr.keywords.rgba8sint,cr.keywords.bgra8unorm,cr.keywords.bgra8unorm_srgb,cr.keywords.rgb10a2unorm,cr.keywords.rg11b10float,cr.keywords.rg32uint,cr.keywords.rg32sint,cr.keywords.rg32float,cr.keywords.rgba16uint,cr.keywords.rgba16sint,cr.keywords.rgba16float,cr.keywords.rgba32uint,cr.keywords.rgba32sint,cr.keywords.rgba32float],pt.const_literal=[cr.tokens.int_literal,cr.tokens.uint_literal,cr.tokens.decimal_float_literal,cr.tokens.hex_float_literal,cr.keywords.true,cr.keywords.false],pt.literal_or_ident=[cr.tokens.ident,cr.tokens.int_literal,cr.tokens.uint_literal,cr.tokens.decimal_float_literal,cr.tokens.hex_float_literal,cr.tokens.name],pt.element_count_expression=[cr.tokens.int_literal,cr.tokens.uint_literal,cr.tokens.ident],pt.template_types=[cr.keywords.vec2,cr.keywords.vec3,cr.keywords.vec4,cr.keywords.mat2x2,cr.keywords.mat2x3,cr.keywords.mat2x4,cr.keywords.mat3x2,cr.keywords.mat3x3,cr.keywords.mat3x4,cr.keywords.mat4x2,cr.keywords.mat4x3,cr.keywords.mat4x4,cr.keywords.atomic,cr.keywords.bitcast,...cr.any_texture_type],pt.attribute_name=[cr.tokens.ident,cr.keywords.block,cr.keywords.diagnostic],pt.assignment_operators=[cr.tokens.equal,cr.tokens.plus_equal,cr.tokens.minus_equal,cr.tokens.times_equal,cr.tokens.division_equal,cr.tokens.modulo_equal,cr.tokens.and_equal,cr.tokens.or_equal,cr.tokens.xor_equal,cr.tokens.shift_right_equal,cr.tokens.shift_left_equal],pt.increment_operators=[cr.tokens.plus_plus,cr.tokens.minus_minus];let eU=class{constructor(e,t,n){this.type=e,this.lexeme=t,this.line=n}toString(){return this.lexeme}isTemplateType(){return pt.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==pt.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}},Dne=class{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new eU(pt.eof,"",this._line)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}if(this._peekAhead()=="*"){this._advance();let a=1;for(;a>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),a--,a==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),a++)}return!0}}const t=pt.simpleTokens[e];if(t)return this._addToken(t),!0;let n=pt.none;const i=this._isAlpha(e),s=e==="_";if(this._isAlphaNumeric(e)){let a=this._peekAhead();for(;this._isAlphaNumeric(a);)e+=this._advance(),a=this._peekAhead()}if(i){const a=pt.keywords[e];if(a)return this._addToken(a),!0}if(i||s)return this._addToken(pt.tokens.ident),!0;for(;;){let a=this._findType(e);const o=this._peekAhead();if(e=="-"&&this._tokens.length>0){if(o=="=")return this._current++,e+=o,this._addToken(pt.tokens.minus_equal),!0;if(o=="-")return this._current++,e+=o,this._addToken(pt.tokens.minus_minus),!0;const h=this._tokens.length-1;if((pt.literal_or_ident.indexOf(this._tokens[h].type)!=-1||this._tokens[h].type==pt.tokens.paren_right)&&o!=">")return this._addToken(a),!0}if(e==">"&&(o==">"||o=="=")){let h=!1,f=this._tokens.length-1;for(let _=0;_<5&&f>=0&&pt.assignment_operators.indexOf(this._tokens[f].type)===-1;++_,--f)if(this._tokens[f].type===pt.tokens.less_than){f>0&&this._tokens[f-1].isArrayOrTemplateType()&&(h=!0);break}if(h)return this._addToken(a),!0}if(a===pt.none){let h=e,f=0;const _=2;for(let x=0;x<_;++x)if(h+=this._peekAhead(x),a=this._findType(h),a!==pt.none){f=x;break}if(a===pt.none)return n!==pt.none&&(this._current--,this._addToken(n),!0);e=h,this._current+=f+1}if(n=a,this._isAtEnd())break;e+=this._advance()}return n!==pt.none&&(this._addToken(n),!0)}_findType(e){for(const n in pt.regexTokens){const i=pt.regexTokens[n];if(this._match(e,i.rule))return i}return pt.literalTokens[e]||pt.none}_match(e,t){const n=t.exec(e);return n&&n.index==0&&n[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"}_isAlphaNumeric(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"||e=="_"||e>="0"&&e<="9"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=this._source[this._current];return e=e||0,e++,this._current+=e,t}_peekAhead(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const t=this._source.substring(this._start,this._current);this._tokens.push(new eU(e,t,this._line))}},One=class{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}},aw=class{constructor(e,t){this.align=e,this.size=t}},A1=class mx{constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new Bne,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}updateAST(e){for(const t of e)t instanceof rw&&this._functions.set(t.name,new One(t));for(const t of e)if(t instanceof ip){const n=this.getTypeInfo(t,null);n instanceof ep&&this.structs.push(n)}for(const t of e)if(t instanceof fI)this.aliases.push(this._getAliasInfo(t));else if(t instanceof uI){const n=t,i=this._getAttributeNum(n.attributes,"id",0),s=n.type!=null?this.getTypeInfo(n.type,n.attributes):null;this.overrides.push(new vne(n.name,s,n.attributes,i))}else if(this._isUniformVar(t)){const n=t,i=this._getAttributeNum(n.attributes,"group",0),s=this._getAttributeNum(n.attributes,"binding",0),a=this.getTypeInfo(n.type,n.attributes),o=new Yx(n.name,a,i,s,n.attributes,rp.Uniform,n.access);this.uniforms.push(o)}else if(this._isStorageVar(t)){const n=t,i=this._getAttributeNum(n.attributes,"group",0),s=this._getAttributeNum(n.attributes,"binding",0),a=this.getTypeInfo(n.type,n.attributes),o=this._isStorageTexture(a),h=new Yx(n.name,a,i,s,n.attributes,o?rp.StorageTexture:rp.Storage,n.access);this.storage.push(h)}else if(this._isTextureVar(t)){const n=t,i=this._getAttributeNum(n.attributes,"group",0),s=this._getAttributeNum(n.attributes,"binding",0),a=this.getTypeInfo(n.type,n.attributes),o=this._isStorageTexture(a),h=new Yx(n.name,a,i,s,n.attributes,o?rp.StorageTexture:rp.Texture,n.access);o?this.storage.push(h):this.textures.push(h)}else if(this._isSamplerVar(t)){const n=t,i=this._getAttributeNum(n.attributes,"group",0),s=this._getAttributeNum(n.attributes,"binding",0),a=this.getTypeInfo(n.type,n.attributes),o=new Yx(n.name,a,i,s,n.attributes,rp.Sampler,n.access);this.samplers.push(o)}else if(t instanceof rw){const n=this._getAttribute(t,"vertex"),i=this._getAttribute(t,"fragment"),s=this._getAttribute(t,"compute"),a=n||i||s,o=new wne(t.name,a==null?void 0:a.name,t.attributes);o.attributes=t.attributes,o.startLine=t.startLine,o.endLine=t.endLine,this.functions.push(o),this._functions.get(t.name).info=o,a&&(this._functions.get(t.name).inUse=!0,o.inUse=!0,o.resources=this._findResources(t,!!a),o.inputs=this._getInputs(t.args),o.outputs=this._getOutputs(t.returnType),this.entry[a.name].push(o)),o.arguments=t.args.map(h=>new xne(h.name,this.getTypeInfo(h.type,h.attributes),h.attributes)),o.returnType=t.returnType?this.getTypeInfo(t.returnType,t.attributes):null}for(const t of this._functions.values())t.info&&(t.info.inUse=t.inUse,this._addCalls(t.node,t.info.calls));for(const t of this._functions.values())t.node.search(n=>{var i;if(n.astNodeType==="varExpr"){const s=n;for(const a of this.overrides)s.name==a.name&&((i=t.info)===null||i===void 0||i.overrides.push(a))}});for(const t of this.uniforms)this._markStructsInUse(t.type);for(const t of this.storage)this._markStructsInUse(t.type)}getStructInfo(e){for(const t of this.structs)if(t.name==e)return t;return null}getOverrideInfo(e){for(const t of this.overrides)if(t.name==e)return t;return null}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(const t of e.members)this._markStructsInUse(t.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{const t=this._getAlias(e.name);t&&this._markStructsInUse(t)}}_addCalls(e,t){var n;for(const i of e.calls){const s=(n=this._functions.get(i.name))===null||n===void 0?void 0:n.info;s&&t.add(s)}}findResource(e,t){for(const n of this.uniforms)if(n.group==e&&n.binding==t)return n;for(const n of this.storage)if(n.group==e&&n.binding==t)return n;for(const n of this.textures)if(n.group==e&&n.binding==t)return n;for(const n of this.samplers)if(n.group==e&&n.binding==t)return n;return null}_findResource(e){for(const t of this.uniforms)if(t.name==e)return t;for(const t of this.storage)if(t.name==e)return t;for(const t of this.textures)if(t.name==e)return t;for(const t of this.samplers)if(t.name==e)return t;return null}_markStructsFromAST(e){const t=this.getTypeInfo(e,null);this._markStructsInUse(t)}_findResources(e,t){const n=[],i=this,s=[];return e.search(a=>{if(a instanceof ew)s.push({});else if(a instanceof tw)s.pop();else if(a instanceof np){const o=a;t&&o.type!==null&&this._markStructsFromAST(o.type),s.length>0&&(s[s.length-1][o.name]=o)}else if(a instanceof Cg){const o=a;t&&o.type!==null&&this._markStructsFromAST(o.type)}else if(a instanceof nw){const o=a;t&&o.type!==null&&this._markStructsFromAST(o.type),s.length>0&&(s[s.length-1][o.name]=o)}else if(a instanceof sp){const o=a;if(s.length>0&&s[s.length-1][o.name])return;const h=i._findResource(o.name);h&&n.push(h)}else if(a instanceof iw){const o=a,h=i._functions.get(o.name);h&&(t&&(h.inUse=!0),e.calls.add(h.node),h.resources===null&&(h.resources=i._findResources(h.node,t)),n.push(...h.resources))}else if(a instanceof dI){const o=a,h=i._functions.get(o.name);h&&(t&&(h.inUse=!0),e.calls.add(h.node),h.resources===null&&(h.resources=i._findResources(h.node,t)),n.push(...h.resources))}}),[...new Map(n.map(a=>[a.name,a])).values()]}getBindGroups(){const e=[];function t(n,i){n>=e.length&&(e.length=n+1),e[n]===void 0&&(e[n]=[]),i>=e[n].length&&(e[n].length=i+1)}for(const n of this.uniforms)t(n.group,n.binding),e[n.group][n.binding]=n;for(const n of this.storage)t(n.group,n.binding),e[n.group][n.binding]=n;for(const n of this.textures)t(n.group,n.binding),e[n.group][n.binding]=n;for(const n of this.samplers)t(n.group,n.binding),e[n.group][n.binding]=n;return e}_getOutputs(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:void 0;if(t===void 0&&(t=[]),e instanceof ip)this._getStructOutputs(e,t);else{const n=this._getOutputInfo(e);n!==null&&t.push(n)}return t}_getStructOutputs(e,t){for(const n of e.members)if(n.type instanceof ip)this._getStructOutputs(n.type,t);else{const i=this._getAttribute(n,"location")||this._getAttribute(n,"builtin");if(i!==null){const s=this.getTypeInfo(n.type,n.type.attributes),a=this._parseInt(i.value),o=new Lk(n.name,s,i.name,a);t.push(o)}}}_getOutputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(t!==null){const n=this.getTypeInfo(e,e.attributes),i=this._parseInt(t.value);return new Lk("",n,t.name,i)}return null}_getInputs(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:void 0;t===void 0&&(t=[]);for(const n of e)if(n.type instanceof ip)this._getStructInputs(n.type,t);else{const i=this._getInputInfo(n);i!==null&&t.push(i)}return t}_getStructInputs(e,t){for(const n of e.members)if(n.type instanceof ip)this._getStructInputs(n.type,t);else{const i=this._getInputInfo(n);i!==null&&t.push(i)}}_getInputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(t!==null){const n=this._getAttribute(e,"interpolation"),i=this.getTypeInfo(e.type,e.attributes),s=this._parseInt(t.value),a=new bne(e.name,i,t.name,s);return n!==null&&(a.interpolation=this._parseString(n.value)),a}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const t=parseInt(e);return isNaN(t)?e:t}_getAlias(e){for(const t of this.aliases)if(t.name==e)return t.type;return null}_getAliasInfo(e){return new yne(e.name,this.getTypeInfo(e.type,null))}getTypeInfo(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(this._types.has(e))return this._types.get(e);if(e instanceof jk){const i=e,s=i.format?this.getTypeInfo(i.format,i.attributes):null,a=new wg(i.name,t);return a.format=s,a.count=i.count,this._types.set(e,a),this._updateTypeInfo(a),a}if(e instanceof ip){const i=e,s=new ep(i.name,t);s.startLine=i.startLine,s.endLine=i.endLine;for(const a of i.members){const o=this.getTypeInfo(a.type,a.attributes);s.members.push(new Rk(a.name,o,a.attributes))}return this._types.set(e,s),this._updateTypeInfo(s),s}if(e instanceof f1){const i=e,s=i.format instanceof dn,a=i.format?s?this.getTypeInfo(i.format,null):new Ld(i.format,null):null,o=new tp(i.name,a,t,i.access);return this._types.set(e,o),this._updateTypeInfo(o),o}if(e instanceof Nr){const i=e,s=i.format?this.getTypeInfo(i.format,null):null,a=new tp(i.name,s,t,i.access);return this._types.set(e,a),this._updateTypeInfo(a),a}const n=new Ld(e.name,t);return this._types.set(e,n),this._updateTypeInfo(n),n}_updateTypeInfo(e){var t,n,i;const s=this._getTypeSize(e);if(e.size=(t=s==null?void 0:s.size)!==null&&t!==void 0?t:0,e instanceof wg&&e.format){const a=this._getTypeSize(e.format);e.stride=Math.max((n=a==null?void 0:a.size)!==null&&n!==void 0?n:0,(i=a==null?void 0:a.align)!==null&&i!==void 0?i:0),this._updateTypeInfo(e.format)}e instanceof ep&&this._updateStructInfo(e)}_updateStructInfo(e){var t;let n=0,i=0,s=0,a=0;for(let o=0,h=e.members.length;o<h;++o){const f=e.members[o],_=this._getTypeSize(f);if(!_)continue;(t=this._getAlias(f.type.name))!==null&&t!==void 0||f.type;const x=_.align,T=_.size;n=this._roundUp(x,n+i),i=T,s=n,a=Math.max(a,x),f.offset=n,f.size=T,this._updateTypeInfo(f.type)}e.size=this._roundUp(a,s+i),e.align=a}_getTypeSize(e){var t,n;if(e==null)return null;const i=this._getAttributeNum(e.attributes,"size",0),s=this._getAttributeNum(e.attributes,"align",0);if(e instanceof Rk&&(e=e.type),e instanceof Ld){const a=this._getAlias(e.name);a!==null&&(e=a)}{const a=mx._typeInfo[e.name];if(a!==void 0){const o=((t=e.format)===null||t===void 0?void 0:t.name)==="f16"?2:1;return new aw(Math.max(s,a.align/o),Math.max(i,a.size/o))}}{const a=mx._typeInfo[e.name.substring(0,e.name.length-1)];if(a){const o=e.name[e.name.length-1]==="h"?2:1;return new aw(Math.max(s,a.align/o),Math.max(i,a.size/o))}}if(e instanceof wg){let a=e,o=8,h=8;const f=this._getTypeSize(a.format);return f!==null&&(h=f.size,o=f.align),h=a.count*this._getAttributeNum((n=e==null?void 0:e.attributes)!==null&&n!==void 0?n:null,"stride",this._roundUp(o,h)),i&&(h=i),new aw(Math.max(s,o),Math.max(i,h))}if(e instanceof ep){let a=0,o=0,h=0,f=0,_=0;for(const x of e.members){const T=this._getTypeSize(x.type);T!==null&&(a=Math.max(T.align,a),h=this._roundUp(T.align,h+f),f=T.size,_=h)}return o=this._roundUp(a,_+f),new aw(Math.max(s,a),Math.max(i,o))}return null}_isUniformVar(e){return e instanceof np&&e.storage=="uniform"}_isStorageVar(e){return e instanceof np&&e.storage=="storage"}_isTextureVar(e){return e instanceof np&&e.type!==null&&mx._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof np&&e.type!==null&&mx._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,t){const n=e;if(!n||!n.attributes)return null;const i=n.attributes;for(let s of i)if(s.name==t)return s;return null}_getAttributeNum(e,t,n){if(e===null)return n;for(let i of e)if(i.name==t){let s=i!==null&&i.value!==null?i.value:n;return s instanceof Array&&(s=s[0]),typeof s=="number"?s:typeof s=="string"?parseInt(s):n}return n}_roundUp(e,t){return Math.ceil(t/e)*e}};A1._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},A1._textureTypes=pt.any_texture_type.map(r=>r.name),A1._samplerTypes=pt.sampler_type.map(r=>r.name);let kne=class IZ{constructor(e,t,n){this.name=e,this.value=t,this.node=n}clone(){return new IZ(this.name,this.value,this.node)}},Une=class MZ{constructor(e){this.name=e.name,this.node=e}clone(){return new MZ(this.node)}},Nne=class PZ{constructor(e){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",e&&(this.parent=e,this.currentFunctionName=e.currentFunctionName)}getVariable(e){var t;return this.variables.has(e)?(t=this.variables.get(e))!==null&&t!==void 0?t:null:this.parent?this.parent.getVariable(e):null}getFunction(e){var t;return this.functions.has(e)?(t=this.functions.get(e))!==null&&t!==void 0?t:null:this.parent?this.parent.getFunction(e):null}createVariable(e,t,n){this.variables.set(e,new kne(e,t,n??null))}setVariable(e,t,n){const i=this.getVariable(e);i!==null?i.value=t:this.createVariable(e,t,n)}getVariableValue(e){var t;const n=this.getVariable(e);return(t=n==null?void 0:n.value)!==null&&t!==void 0?t:null}clone(){return new PZ(this)}},zne=class{evalExpression(e,t){return null}getTypeName(e){return""}getTypeInfo(e){return null}getVariableName(e,t){return""}},Hne=class{constructor(e){this.exec=e}getTypeInfo(e){return this.exec.getTypeInfo(e)}All(e,t){const n=this.exec.evalExpression(e.args[0],t);let i=!0;if(n instanceof Lt)return n.value.forEach(s=>{s||(i=!1)}),new hr(i?1:0,this.getTypeInfo("bool"));throw new Error(`All() expects a vector argument. Line ${e.line}`)}Any(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Lt){const i=n.value.some(s=>s);return new hr(i?1:0,this.getTypeInfo("bool"))}throw new Error(`Any() expects a vector argument. Line ${e.line}`)}Select(e,t){const n=this.exec.evalExpression(e.args[2],t);if(!(n instanceof hr))throw new Error(`Select() expects a bool condition. Line ${e.line}`);return n.value?this.exec.evalExpression(e.args[1],t):this.exec.evalExpression(e.args[0],t)}ArrayLength(e,t){let n=e.args[0];n instanceof bh&&(n=n.right);const i=this.exec.evalExpression(n,t);if(i instanceof Ml&&i.typeInfo.size===0){const s=i.typeInfo,a=i.buffer.byteLength/s.stride;return new hr(a,this.getTypeInfo("u32"))}return new hr(i.typeInfo.size,this.getTypeInfo("u32"))}Abs(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Lt)return new Lt(n.value.map(s=>Math.abs(s)),n.typeInfo);const i=n;return new hr(Math.abs(i.value),i.typeInfo)}Acos(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Lt)return new Lt(n.value.map(s=>Math.acos(s)),n.typeInfo);const i=n;return new hr(Math.acos(i.value),n.typeInfo)}Acosh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Lt)return new Lt(n.value.map(s=>Math.acosh(s)),n.typeInfo);const i=n;return new hr(Math.acosh(i.value),n.typeInfo)}Asin(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Lt)return new Lt(n.value.map(s=>Math.asin(s)),n.typeInfo);const i=n;return new hr(Math.asin(i.value),n.typeInfo)}Asinh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Lt)return new Lt(n.value.map(s=>Math.asinh(s)),n.typeInfo);const i=n;return new hr(Math.asinh(i.value),n.typeInfo)}Atan(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Lt)return new Lt(n.value.map(s=>Math.atan(s)),n.typeInfo);const i=n;return new hr(Math.atan(i.value),n.typeInfo)}Atanh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Lt)return new Lt(n.value.map(s=>Math.atanh(s)),n.typeInfo);const i=n;return new hr(Math.atanh(i.value),n.typeInfo)}Atan2(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(n instanceof Lt&&i instanceof Lt)return new Lt(n.value.map((o,h)=>Math.atan2(o,i.value[h])),n.typeInfo);const s=n,a=i;return new hr(Math.atan2(s.value,a.value),n.typeInfo)}Ceil(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Lt)return new Lt(n.value.map(s=>Math.ceil(s)),n.typeInfo);const i=n;return new hr(Math.ceil(i.value),n.typeInfo)}_clamp(e,t,n){return Math.min(Math.max(e,t),n)}Clamp(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t);if(n instanceof Lt&&i instanceof Lt&&s instanceof Lt)return new Lt(n.value.map((f,_)=>this._clamp(f,i.value[_],s.value[_])),n.typeInfo);const a=n,o=i,h=s;return new hr(this._clamp(a.value,o.value,h.value),n.typeInfo)}Cos(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Lt)return new Lt(n.value.map(s=>Math.cos(s)),n.typeInfo);const i=n;return new hr(Math.cos(i.value),n.typeInfo)}Cosh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Lt)return new Lt(n.value.map(s=>Math.cosh(s)),n.typeInfo);const i=n;return new hr(Math.cos(i.value),n.typeInfo)}CountLeadingZeros(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Lt)return new Lt(n.value.map(s=>Math.clz32(s)),n.typeInfo);const i=n;return new hr(Math.clz32(i.value),n.typeInfo)}_countOneBits(e){let t=0;for(;e!==0;)1&e&&t++,e>>=1;return t}CountOneBits(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Lt)return new Lt(n.value.map(s=>this._countOneBits(s)),n.typeInfo);const i=n;return new hr(this._countOneBits(i.value),n.typeInfo)}_countTrailingZeros(e){if(e===0)return 32;let t=0;for(;!(1&e);)e>>=1,t++;return t}CountTrailingZeros(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Lt)return new Lt(n.value.map(s=>this._countTrailingZeros(s)),n.typeInfo);const i=n;return new hr(this._countTrailingZeros(i.value),n.typeInfo)}Cross(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(n instanceof Lt&&i instanceof Lt){if(n.value.length!==3||i.value.length!==3)return console.error(`Cross() expects 3D vectors. Line ${e.line}`),null;const s=n.value,a=i.value;return new Lt([s[1]*a[2]-a[1]*s[2],s[2]*a[0]-a[2]*s[0],s[0]*a[1]-a[0]*s[1]],n.typeInfo)}return console.error(`Cross() expects vector arguments. Line ${e.line}`),null}Degrees(e,t){const n=this.exec.evalExpression(e.args[0],t),i=180/Math.PI;return n instanceof Lt?new Lt(n.value.map(s=>s*i),n.typeInfo):new hr(n.value*i,n.typeInfo)}Determinant(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof $s){const i=n.value,s=this.exec.getTypeName(n.typeInfo),a=s.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if(s==="mat2x2"||s==="mat2x2f"||s==="mat2x2h")return new hr(i[0]*i[3]-i[1]*i[2],a);if(s==="mat2x3"||s==="mat2x3f"||s==="mat2x3h")return new hr(i[0]*(i[4]*i[8]-i[5]*i[7])-i[1]*(i[3]*i[8]-i[5]*i[6])+i[2]*(i[3]*i[7]-i[4]*i[6]),a);if(s==="mat2x4"||s==="mat2x4f"||s==="mat2x4h")console.error(`TODO: Determinant for ${s}`);else if(s==="mat3x2"||s==="mat3x2f"||s==="mat3x2h")console.error(`TODO: Determinant for ${s}`);else{if(s==="mat3x3"||s==="mat3x3f"||s==="mat3x3h")return new hr(i[0]*(i[4]*i[8]-i[5]*i[7])-i[1]*(i[3]*i[8]-i[5]*i[6])+i[2]*(i[3]*i[7]-i[4]*i[6]),a);s==="mat3x4"||s==="mat3x4f"||s==="mat3x4h"||s==="mat4x2"||s==="mat4x2f"||s==="mat4x2h"||s==="mat4x3"||s==="mat4x3f"||s==="mat4x3h"?console.error(`TODO: Determinant for ${s}`):s!=="mat4x4"&&s!=="mat4x4f"&&s!=="mat4x4h"||console.error(`TODO: Determinant for ${s}`)}}return console.error(`Determinant expects a matrix argument. Line ${e.line}`),null}Distance(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(n instanceof Lt&&i instanceof Lt){let o=0;for(let h=0;h<n.value.length;++h)o+=(n.value[h]-i.value[h])*(n.value[h]-i.value[h]);return new hr(Math.sqrt(o),this.getTypeInfo("f32"))}const s=n,a=i;return new hr(Math.abs(s.value-a.value),n.typeInfo)}_dot(e,t){let n=0;for(let i=0;i<e.length;++i)n+=t[i]*e[i];return n}Dot(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);return n instanceof Lt&&i instanceof Lt?new hr(this._dot(n.value,i.value),this.getTypeInfo("f32")):(console.error(`Dot() expects vector arguments. Line ${e.line}`),null)}Dot4U8Packed(e,t){return console.error(`TODO: dot4U8Packed. Line ${e.line}`),null}Dot4I8Packed(e,t){return console.error(`TODO: dot4I8Packed. Line ${e.line}`),null}Exp(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Lt)return new Lt(n.value.map(s=>Math.exp(s)),n.typeInfo);const i=n;return new hr(Math.exp(i.value),n.typeInfo)}Exp2(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Lt)return new Lt(n.value.map(s=>Math.pow(2,s)),n.typeInfo);const i=n;return new hr(Math.pow(2,i.value),n.typeInfo)}ExtractBits(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t);if(i.typeInfo.name!=="u32"&&i.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 offset argument. Line ${e.line}`),null;if(s.typeInfo.name!=="u32"&&s.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 count argument. Line ${e.line}`),null;const a=i.value,o=s.value;if(n instanceof Lt)return new Lt(n.value.map(f=>f>>a&(1<<o)-1),n.typeInfo);if(n.typeInfo.name!=="i32"&&n.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 argument. Line ${e.line}`),null;const h=n.value;return new hr(h>>a&(1<<o)-1,this.getTypeInfo("i32"))}FaceForward(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t);if(n instanceof Lt&&i instanceof Lt&&s instanceof Lt){const a=this._dot(i.value,s.value);return new Lt(a<0?n.value:n.value.map(o=>-o),n.typeInfo)}return console.error(`FaceForward() expects vector arguments. Line ${e.line}`),null}_firstLeadingBit(e){return e===0?-1:31-Math.clz32(e)}FirstLeadingBit(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Lt)return new Lt(n.value.map(s=>this._firstLeadingBit(s)),n.typeInfo);const i=n;return new hr(this._firstLeadingBit(i.value),n.typeInfo)}_firstTrailingBit(e){return e===0?-1:Math.log2(e&-e)}FirstTrailingBit(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Lt)return new Lt(n.value.map(s=>this._firstTrailingBit(s)),n.typeInfo);const i=n;return new hr(this._firstTrailingBit(i.value),n.typeInfo)}Floor(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Lt)return new Lt(n.value.map(s=>Math.floor(s)),n.typeInfo);const i=n;return new hr(Math.floor(i.value),n.typeInfo)}Fma(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t);if(n instanceof Lt&&i instanceof Lt&&s instanceof Lt)return n.value.length!==i.value.length||n.value.length!==s.value.length?(console.error(`Fma() expects vectors of the same length. Line ${e.line}`),null):new Lt(n.value.map((f,_)=>f*i.value[_]+s.value[_]),n.typeInfo);const a=n,o=i,h=s;return new hr(a.value*o.value+h.value,a.typeInfo)}Fract(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Lt)return new Lt(n.value.map(s=>s-Math.floor(s)),n.typeInfo);const i=n;return new hr(i.value-Math.floor(i.value),n.typeInfo)}Frexp(e,t){return console.error(`TODO: frexp. Line ${e.line}`),null}InsertBits(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t),a=this.exec.evalExpression(e.args[3],t);if(s.typeInfo.name!=="u32"&&s.typeInfo.name!=="x32")return console.error(`InsertBits() expects an i32 offset argument. Line ${e.line}`),null;const o=s.value,h=(1<<a.value)-1<<o,f=~h;if(n instanceof Lt&&i instanceof Lt)return new Lt(n.value.map((T,I)=>T&f|i.value[I]<<o&h),n.typeInfo);const _=n.value,x=i.value;return new hr(_&f|x<<o&h,n.typeInfo)}InverseSqrt(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Lt)return new Lt(n.value.map(s=>1/Math.sqrt(s)),n.typeInfo);const i=n;return new hr(1/Math.sqrt(i.value),n.typeInfo)}Ldexp(e,t){return console.error(`TODO: ldexp. Line ${e.line}`),null}Length(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Lt){let s=0;return n.value.forEach(a=>{s+=a*a}),new hr(Math.sqrt(s),this.getTypeInfo("f32"))}const i=n;return new hr(Math.abs(i.value),n.typeInfo)}Log(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Lt)return new Lt(n.value.map(s=>Math.log(s)),n.typeInfo);const i=n;return new hr(Math.log(i.value),n.typeInfo)}Log2(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Lt)return new Lt(n.value.map(s=>Math.log2(s)),n.typeInfo);const i=n;return new hr(Math.log2(i.value),n.typeInfo)}Max(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(n instanceof Lt&&i instanceof Lt)return new Lt(n.value.map((o,h)=>Math.max(o,i.value[h])),n.typeInfo);const s=n,a=i;return new hr(Math.max(s.value,a.value),n.typeInfo)}Min(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(n instanceof Lt&&i instanceof Lt)return new Lt(n.value.map((o,h)=>Math.min(o,i.value[h])),n.typeInfo);const s=n,a=i;return new hr(Math.min(s.value,a.value),n.typeInfo)}Mix(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t);if(n instanceof Lt&&i instanceof Lt&&s instanceof Lt)return new Lt(n.value.map((h,f)=>n.value[f]*(1-s.value[f])+i.value[f]*s.value[f]),n.typeInfo);const a=i,o=s;return new hr(n.value*(1-o.value)+a.value*o.value,n.typeInfo)}Modf(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(n instanceof Lt&&i instanceof Lt)return new Lt(n.value.map((a,o)=>a%i.value[o]),n.typeInfo);const s=i;return new hr(n.value%s.value,n.typeInfo)}Normalize(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Lt){const i=this.Length(e,t).value;return new Lt(n.value.map(s=>s/i),n.typeInfo)}return console.error(`Normalize() expects a vector argument. Line ${e.line}`),null}Pow(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(n instanceof Lt&&i instanceof Lt)return new Lt(n.value.map((o,h)=>Math.pow(o,i.value[h])),n.typeInfo);const s=n,a=i;return new hr(Math.pow(s.value,a.value),n.typeInfo)}QuantizeToF16(e,t){const n=this.exec.evalExpression(e.args[0],t);return n instanceof Lt?new Lt(n.value.map(i=>i),n.typeInfo):new hr(n.value,n.typeInfo)}Radians(e,t){const n=this.exec.evalExpression(e.args[0],t);return n instanceof Lt?new Lt(n.value.map(i=>i*Math.PI/180),n.typeInfo):new hr(n.value*Math.PI/180,n.typeInfo)}Reflect(e,t){let n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(n instanceof Lt&&i instanceof Lt){const s=this._dot(n.value,i.value);return new Lt(n.value.map((a,o)=>a-2*s*i.value[o]),n.typeInfo)}return console.error(`Reflect() expects vector arguments. Line ${e.line}`),null}Refract(e,t){let n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t);if(n instanceof Lt&&i instanceof Lt&&s instanceof hr){const a=this._dot(i.value,n.value);return new Lt(n.value.map((o,h)=>{const f=1-s.value*s.value*(1-a*a);if(f<0)return 0;const _=Math.sqrt(f);return s.value*o-(s.value*a+_)*i.value[h]}),n.typeInfo)}return console.error(`Refract() expects vector arguments and a scalar argument. Line ${e.line}`),null}ReverseBits(e,t){return console.error(`TODO: reverseBits. Line ${e.line}`),null}Round(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Lt)return new Lt(n.value.map(s=>Math.round(s)),n.typeInfo);const i=n;return new hr(Math.round(i.value),n.typeInfo)}Saturate(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Lt)return new Lt(n.value.map(s=>Math.min(Math.max(s,0),1)),n.typeInfo);const i=n;return new hr(Math.min(Math.max(i.value,0),1),n.typeInfo)}Sign(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Lt)return new Lt(n.value.map(s=>Math.sign(s)),n.typeInfo);const i=n;return new hr(Math.sign(i.value),n.typeInfo)}Sin(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Lt)return new Lt(n.value.map(s=>Math.sin(s)),n.typeInfo);const i=n;return new hr(Math.sin(i.value),n.typeInfo)}Sinh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Lt)return new Lt(n.value.map(s=>Math.sinh(s)),n.typeInfo);const i=n;return new hr(Math.sinh(i.value),n.typeInfo)}_smoothstep(e,t,n){const i=Math.min(Math.max((n-e)/(t-e),0),1);return i*i*(3-2*i)}SmoothStep(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t);if(s instanceof Lt&&n instanceof Lt&&i instanceof Lt)return new Lt(s.value.map((f,_)=>this._smoothstep(n.value[_],i.value[_],f)),s.typeInfo);const a=n,o=i,h=s;return new hr(this._smoothstep(a.value,o.value,h.value),s.typeInfo)}Sqrt(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Lt)return new Lt(n.value.map(s=>Math.sqrt(s)),n.typeInfo);const i=n;return new hr(Math.sqrt(i.value),n.typeInfo)}Step(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(i instanceof Lt&&n instanceof Lt)return new Lt(i.value.map((a,o)=>a<n.value[o]?0:1),i.typeInfo);const s=n;return new hr(i.value<s.value?0:1,s.typeInfo)}Tan(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Lt)return new Lt(n.value.map(s=>Math.tan(s)),n.typeInfo);const i=n;return new hr(Math.tan(i.value),n.typeInfo)}Tanh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Lt)return new Lt(n.value.map(s=>Math.tanh(s)),n.typeInfo);const i=n;return new hr(Math.tanh(i.value),n.typeInfo)}_getTransposeType(e){const t=this.exec.getTypeName(e);return t==="mat2x2f"||t==="mat2x2h"?e:t==="mat2x3f"?this.getTypeInfo("mat3x2f"):t==="mat2x3h"?this.getTypeInfo("mat3x2h"):t==="mat2x4f"?this.getTypeInfo("mat4x2f"):t==="mat2x4h"?this.getTypeInfo("mat4x2h"):t==="mat3x2f"?this.getTypeInfo("mat2x3f"):t==="mat3x2h"?this.getTypeInfo("mat2x3h"):t==="mat3x3f"||t==="mat3x3h"?e:t==="mat3x4f"?this.getTypeInfo("mat4x3f"):t==="mat3x4h"?this.getTypeInfo("mat4x3h"):t==="mat4x2f"?this.getTypeInfo("mat2x4f"):t==="mat4x2h"?this.getTypeInfo("mat2x4h"):t==="mat4x3f"?this.getTypeInfo("mat3x4f"):t==="mat4x3h"?this.getTypeInfo("mat3x4h"):(t==="mat4x4f"||t==="mat4x4h"||console.error(`Invalid matrix type ${t}`),e)}Transpose(e,t){const n=this.exec.evalExpression(e.args[0],t);if(!(n instanceof $s))return console.error(`Transpose() expects a matrix argument. Line ${e.line}`),null;const i=this._getTransposeType(n.typeInfo);if(n.typeInfo.name==="mat2x2"||n.typeInfo.name==="mat2x2f"||n.typeInfo.name==="mat2x2h"){const s=n.value;return new $s([s[0],s[2],s[1],s[3]],i)}if(n.typeInfo.name==="mat2x3"||n.typeInfo.name==="mat2x3f"||n.typeInfo.name==="mat2x3h"){const s=n.value;return new $s([s[0],s[3],s[6],s[1],s[4],s[7]],i)}if(n.typeInfo.name==="mat2x4"||n.typeInfo.name==="mat2x4f"||n.typeInfo.name==="mat2x4h"){const s=n.value;return new $s([s[0],s[4],s[8],s[12],s[1],s[5],s[9],s[13]],i)}if(n.typeInfo.name==="mat3x2"||n.typeInfo.name==="mat3x2f"||n.typeInfo.name==="mat3x2h"){const s=n.value;return new $s([s[0],s[3],s[1],s[4],s[2],s[5]],i)}if(n.typeInfo.name==="mat3x3"||n.typeInfo.name==="mat3x3f"||n.typeInfo.name==="mat3x3h"){const s=n.value;return new $s([s[0],s[3],s[6],s[1],s[4],s[7],s[2],s[5],s[8]],i)}if(n.typeInfo.name==="mat3x4"||n.typeInfo.name==="mat3x4f"||n.typeInfo.name==="mat3x4h"){const s=n.value;return new $s([s[0],s[4],s[8],s[12],s[1],s[5],s[9],s[13],s[2],s[6],s[10],s[14]],i)}if(n.typeInfo.name==="mat4x2"||n.typeInfo.name==="mat4x2f"||n.typeInfo.name==="mat4x2h"){const s=n.value;return new $s([s[0],s[4],s[1],s[5],s[2],s[6]],i)}if(n.typeInfo.name==="mat4x3"||n.typeInfo.name==="mat4x3f"||n.typeInfo.name==="mat4x3h"){const s=n.value;return new $s([s[0],s[4],s[8],s[1],s[5],s[9],s[2],s[6],s[10]],i)}if(n.typeInfo.name==="mat4x4"||n.typeInfo.name==="mat4x4f"||n.typeInfo.name==="mat4x4h"){const s=n.value;return new $s([s[0],s[4],s[8],s[12],s[1],s[5],s[9],s[13],s[2],s[6],s[10],s[14],s[3],s[7],s[11],s[15]],i)}return console.error(`Invalid matrix type ${n.typeInfo.name}`),null}Trunc(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Lt)return new Lt(n.value.map(s=>Math.trunc(s)),n.typeInfo);const i=n;return new hr(Math.trunc(i.value),n.typeInfo)}Dpdx(e,t){return console.error(`TODO: dpdx. Line ${e.line}`),null}DpdxCoarse(e,t){return console.error(`TODO: dpdxCoarse. Line ${e.line}`),null}DpdxFine(e,t){return console.error("TODO: dpdxFine"),null}Dpdy(e,t){return console.error("TODO: dpdy"),null}DpdyCoarse(e,t){return console.error("TODO: dpdyCoarse"),null}DpdyFine(e,t){return console.error("TODO: dpdyFine"),null}Fwidth(e,t){return console.error("TODO: fwidth"),null}FwidthCoarse(e,t){return console.error("TODO: fwidthCoarse"),null}FwidthFine(e,t){return console.error("TODO: fwidthFine"),null}TextureDimensions(e,t){const n=e.args[0];if((e.args.length>1?this.exec.evalExpression(e.args[1],t).value:0)>0)return console.error(`TODO: Mip levels. Line ${e.line}`),null;if(n instanceof sp){const i=n.name,s=t.getVariableValue(i);return s instanceof Ml?new Lt(s.textureSize,this.getTypeInfo("vec2u")):(console.error(`Texture ${i} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureDimensions. Line ${e.line}`),null}TextureGather(e,t){return console.error("TODO: textureGather"),null}TextureGatherCompare(e,t){return console.error("TODO: textureGatherCompare"),null}TextureLoad(e,t){const n=e.args[0],i=this.exec.evalExpression(e.args[1],t);if((e.args.length>2?this.exec.evalExpression(e.args[2],t).value:0)>0)return console.error(`TODO: Mip levels. Line ${e.line}`),null;if(!(i instanceof Lt)||i.value.length!==2)return console.error(`Invalid UV argument for textureLoad. Line ${e.line}`),null;if(n instanceof sp){const s=n.name,a=t.getVariableValue(s);if(a instanceof Ml){const o=a.textureSize,h=Math.floor(i.value[0]),f=Math.floor(i.value[1]);if(h<0||h>=o[0]||f<0||f>=o[1])return console.error(`Texture ${s} out of bounds. Line ${e.line}`),null;const _=4*(f*o[0]+h),x=new Uint8Array(a.buffer,_,4);return new Lt([x[0]/255,x[1]/255,x[2]/255,x[3]/255],this.getTypeInfo("vec4f"))}return console.error(`Texture ${s} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureLoad. Line ${e.line}`),null}TextureNumLayers(e,t){return console.error("TODO: textureNumLayers"),null}TextureNumLevels(e,t){return console.error("TODO: textureNumLevels"),null}TextureNumSamples(e,t){return console.error("TODO: textureNumSamples"),null}TextureSample(e,t){return console.error("TODO: textureSample"),null}TextureSampleBias(e,t){return console.error("TODO: textureSampleBias"),null}TextureSampleCompare(e,t){return console.error("TODO: textureSampleCompare"),null}TextureSampleCompareLevel(e,t){return console.error("TODO: textureSampleCompareLevel"),null}TextureSampleGrad(e,t){return console.error("TODO: textureSampleGrad"),null}TextureSampleLevel(e,t){return console.error("TODO: textureSampleLevel"),null}TextureSampleBaseClampToEdge(e,t){return console.error("TODO: textureSampleBaseClampToEdge"),null}TextureStore(e,t){const n=e.args[0],i=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t).value;if(s.length!==4)return console.error(`Invalid value argument for textureStore. Line ${e.line}`),null;if(!(i instanceof Lt)||i.value.length!==2)return console.error(`Invalid UV argument for textureStore. Line ${e.line}`),null;if(n instanceof sp){const a=n.name,o=t.getVariableValue(a);if(o instanceof Ml){const h=o.textureSize,f=Math.floor(i.value[0]),_=Math.floor(i.value[1]);if(f<0||f>=h[0]||_<0||_>=h[1])return console.error(`Texture ${a} out of bounds. Line ${e.line}`),null;const x=4*(_*h[0]+f),T=new Uint8Array(o.buffer,x,4);return T[0]=255*s[0],T[1]=255*s[1],T[2]=255*s[2],T[3]=255*s[3],null}return console.error(`Texture ${a} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureStore. Line ${e.line}`),null}AtomicLoad(e,t){let n=e.args[0];n instanceof bh&&(n=n.right);const i=this.exec.getVariableName(n,t);return t.getVariable(i).value.getDataValue(this.exec,n.postfix,t)}AtomicStore(e,t){let n=e.args[0];n instanceof bh&&(n=n.right);const i=this.exec.getVariableName(n,t),s=t.getVariable(i);let a=e.args[1];const o=this.exec.evalExpression(a,t),h=s.value.getDataValue(this.exec,n.postfix,t);return h instanceof hr&&o instanceof hr&&(h.value=o.value),s.value instanceof Ml&&s.value.setDataValue(this.exec,h,n.postfix,t),null}AtomicAdd(e,t){let n=e.args[0];n instanceof bh&&(n=n.right);const i=this.exec.getVariableName(n,t),s=t.getVariable(i);let a=e.args[1];const o=this.exec.evalExpression(a,t),h=s.value.getDataValue(this.exec,n.postfix,t);return h instanceof hr&&o instanceof hr&&(h.value+=o.value),s.value instanceof Ml&&s.value.setDataValue(this.exec,h,n.postfix,t),null}AtomicSub(e,t){let n=e.args[0];n instanceof bh&&(n=n.right);const i=this.exec.getVariableName(n,t),s=t.getVariable(i);let a=e.args[1];const o=this.exec.evalExpression(a,t),h=s.value.getDataValue(this.exec,n.postfix,t);return h instanceof hr&&o instanceof hr&&(h.value-=o.value),s.value instanceof Ml&&s.value.setDataValue(this.exec,h,n.postfix,t),null}AtomicMax(e,t){let n=e.args[0];n instanceof bh&&(n=n.right);const i=this.exec.getVariableName(n,t),s=t.getVariable(i);let a=e.args[1];const o=this.exec.evalExpression(a,t),h=s.value.getDataValue(this.exec,n.postfix,t),f=new hr(h.value,h.typeInfo);return h instanceof hr&&o instanceof hr&&(h.value=Math.max(h.value,o.value)),s.value instanceof Ml&&s.value.setDataValue(this.exec,h,n.postfix,t),f}AtomicMin(e,t){let n=e.args[0];n instanceof bh&&(n=n.right);const i=this.exec.getVariableName(n,t),s=t.getVariable(i);let a=e.args[1];const o=this.exec.evalExpression(a,t),h=s.value.getDataValue(this.exec,n.postfix,t),f=new hr(h.value,h.typeInfo);return h instanceof hr&&o instanceof hr&&(h.value=Math.min(h.value,o.value)),s.value instanceof Ml&&s.value.setDataValue(this.exec,h,n.postfix,t),f}AtomicAnd(e,t){let n=e.args[0];n instanceof bh&&(n=n.right);const i=this.exec.getVariableName(n,t),s=t.getVariable(i);let a=e.args[1];const o=this.exec.evalExpression(a,t),h=s.value.getDataValue(this.exec,n.postfix,t),f=new hr(h.value,h.typeInfo);return h instanceof hr&&o instanceof hr&&(h.value=h.value&o.value),s.value instanceof Ml&&s.value.setDataValue(this.exec,h,n.postfix,t),f}AtomicOr(e,t){let n=e.args[0];n instanceof bh&&(n=n.right);const i=this.exec.getVariableName(n,t),s=t.getVariable(i);let a=e.args[1];const o=this.exec.evalExpression(a,t),h=s.value.getDataValue(this.exec,n.postfix,t),f=new hr(h.value,h.typeInfo);return h instanceof hr&&o instanceof hr&&(h.value=h.value|o.value),s.value instanceof Ml&&s.value.setDataValue(this.exec,h,n.postfix,t),f}AtomicXor(e,t){let n=e.args[0];n instanceof bh&&(n=n.right);const i=this.exec.getVariableName(n,t),s=t.getVariable(i);let a=e.args[1];const o=this.exec.evalExpression(a,t),h=s.value.getDataValue(this.exec,n.postfix,t),f=new hr(h.value,h.typeInfo);return h instanceof hr&&o instanceof hr&&(h.value=h.value^o.value),s.value instanceof Ml&&s.value.setDataValue(this.exec,h,n.postfix,t),f}AtomicExchange(e,t){let n=e.args[0];n instanceof bh&&(n=n.right);const i=this.exec.getVariableName(n,t),s=t.getVariable(i);let a=e.args[1];const o=this.exec.evalExpression(a,t),h=s.value.getDataValue(this.exec,n.postfix,t),f=new hr(h.value,h.typeInfo);return h instanceof hr&&o instanceof hr&&(h.value=o.value),s.value instanceof Ml&&s.value.setDataValue(this.exec,h,n.postfix,t),f}AtomicCompareExchangeWeak(e,t){return console.error("TODO: atomicCompareExchangeWeak"),null}Pack4x8snorm(e,t){return console.error("TODO: pack4x8snorm"),null}Pack4x8unorm(e,t){return console.error("TODO: pack4x8unorm"),null}Pack4xI8(e,t){return console.error("TODO: pack4xI8"),null}Pack4xU8(e,t){return console.error("TODO: pack4xU8"),null}Pack4x8Clamp(e,t){return console.error("TODO: pack4x8Clamp"),null}Pack4xU8Clamp(e,t){return console.error("TODO: pack4xU8Clamp"),null}Pack2x16snorm(e,t){return console.error("TODO: pack2x16snorm"),null}Pack2x16unorm(e,t){return console.error("TODO: pack2x16unorm"),null}Pack2x16float(e,t){return console.error("TODO: pack2x16float"),null}Unpack4x8snorm(e,t){return console.error("TODO: unpack4x8snorm"),null}Unpack4x8unorm(e,t){return console.error("TODO: unpack4x8unorm"),null}Unpack4xI8(e,t){return console.error("TODO: unpack4xI8"),null}Unpack4xU8(e,t){return console.error("TODO: unpack4xU8"),null}Unpack2x16snorm(e,t){return console.error("TODO: unpack2x16snorm"),null}Unpack2x16unorm(e,t){return console.error("TODO: unpack2x16unorm"),null}Unpack2x16float(e,t){return console.error("TODO: unpack2x16float"),null}StorageBarrier(e,t){return null}TextureBarrier(e,t){return null}WorkgroupBarrier(e,t){return null}WorkgroupUniformLoad(e,t){return null}SubgroupAdd(e,t){return console.error("TODO: subgroupAdd"),null}SubgroupExclusiveAdd(e,t){return console.error("TODO: subgroupExclusiveAdd"),null}SubgroupInclusiveAdd(e,t){return console.error("TODO: subgroupInclusiveAdd"),null}SubgroupAll(e,t){return console.error("TODO: subgroupAll"),null}SubgroupAnd(e,t){return console.error("TODO: subgroupAnd"),null}SubgroupAny(e,t){return console.error("TODO: subgroupAny"),null}SubgroupBallot(e,t){return console.error("TODO: subgroupBallot"),null}SubgroupBroadcast(e,t){return console.error("TODO: subgroupBroadcast"),null}SubgroupBroadcastFirst(e,t){return console.error("TODO: subgroupBroadcastFirst"),null}SubgroupElect(e,t){return console.error("TODO: subgroupElect"),null}SubgroupMax(e,t){return console.error("TODO: subgroupMax"),null}SubgroupMin(e,t){return console.error("TODO: subgroupMin"),null}SubgroupMul(e,t){return console.error("TODO: subgroupMul"),null}SubgroupExclusiveMul(e,t){return console.error("TODO: subgroupExclusiveMul"),null}SubgroupInclusiveMul(e,t){return console.error("TODO: subgroupInclusiveMul"),null}SubgroupOr(e,t){return console.error("TODO: subgroupOr"),null}SubgroupShuffle(e,t){return console.error("TODO: subgroupShuffle"),null}SubgroupShuffleDown(e,t){return console.error("TODO: subgroupShuffleDown"),null}SubgroupShuffleUp(e,t){return console.error("TODO: subgroupShuffleUp"),null}SubgroupShuffleXor(e,t){return console.error("TODO: subgroupShuffleXor"),null}SubgroupXor(e,t){return console.error("TODO: subgroupXor"),null}QuadBroadcast(e,t){return console.error("TODO: quadBroadcast"),null}QuadSwapDiagonal(e,t){return console.error("TODO: quadSwapDiagonal"),null}QuadSwapX(e,t){return console.error("TODO: quadSwapX"),null}QuadSwapY(e,t){return console.error("TODO: quadSwapY"),null}};function En(r){return Array.isArray(r)||(r==null?void 0:r.buffer)instanceof ArrayBuffer}const lw=new Float32Array(1),Vne=new Uint32Array(lw.buffer),Gne=new Uint32Array(lw.buffer),cw=new Int32Array(1),Qne=new Float32Array(cw.buffer),$ne=new Uint32Array(cw.buffer),uw=new Uint32Array(1),jne=new Float32Array(uw.buffer),qne=new Int32Array(uw.buffer);function tU(r,e,t){if(e===t)return r;if(e==="f32"){if(t==="i32"||t==="x32")return lw[0]=r,Vne[0];if(t==="u32")return lw[0]=r,Gne[0]}else if(e==="i32"||e==="x32"){if(t==="f32")return cw[0]=r,Qne[0];if(t==="u32")return cw[0]=r,$ne[0]}else if(e==="u32"){if(t==="f32")return uw[0]=r,jne[0];if(t==="i32"||t==="x32")return uw[0]=r,qne[0]}return console.error(`Unsupported cast from ${e} to ${t}`),r}let hw=class Pd extends zne{constructor(e,t){var n;super(),this.ast=e??[],this.reflection=new A1,this.reflection.updateAST(this.ast),this.context=(n=t==null?void 0:t.clone())!==null&&n!==void 0?n:new Nne,this.builtins=new Hne(this),this.typeInfo={bool:this.getTypeInfo(dn.bool),i32:this.getTypeInfo(dn.i32),u32:this.getTypeInfo(dn.u32),f32:this.getTypeInfo(dn.f32),f16:this.getTypeInfo(dn.f16),vec2f:this.getTypeInfo(Nr.vec2f),vec2u:this.getTypeInfo(Nr.vec2u),vec2i:this.getTypeInfo(Nr.vec2i),vec2h:this.getTypeInfo(Nr.vec2h),vec3f:this.getTypeInfo(Nr.vec3f),vec3u:this.getTypeInfo(Nr.vec3u),vec3i:this.getTypeInfo(Nr.vec3i),vec3h:this.getTypeInfo(Nr.vec3h),vec4f:this.getTypeInfo(Nr.vec4f),vec4u:this.getTypeInfo(Nr.vec4u),vec4i:this.getTypeInfo(Nr.vec4i),vec4h:this.getTypeInfo(Nr.vec4h),mat2x2f:this.getTypeInfo(Nr.mat2x2f),mat2x3f:this.getTypeInfo(Nr.mat2x3f),mat2x4f:this.getTypeInfo(Nr.mat2x4f),mat3x2f:this.getTypeInfo(Nr.mat3x2f),mat3x3f:this.getTypeInfo(Nr.mat3x3f),mat3x4f:this.getTypeInfo(Nr.mat3x4f),mat4x2f:this.getTypeInfo(Nr.mat4x2f),mat4x3f:this.getTypeInfo(Nr.mat4x3f),mat4x4f:this.getTypeInfo(Nr.mat4x4f)}}getVariableValue(e){var t,n;const i=(n=(t=this.context.getVariable(e))===null||t===void 0?void 0:t.value)!==null&&n!==void 0?n:null;return i===null?null:i instanceof hr||i instanceof Lt||i instanceof $s?i.value:(console.error(`Unsupported return variable type ${i.typeInfo.name}`),null)}execute(e){(e=e??{}).constants&&this._setOverrides(e.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(e,t,n,i){const s=this.context.clone();(i=i??{}).constants&&this._setOverrides(i.constants,s),this._execStatements(this.ast,s);const a=s.getFunction(e);if(!a)return void console.error(`Function ${e} not found`);if(typeof t=="number")t=[t,1,1];else{if(t.length===0)return void console.error("Invalid dispatch count");t.length===1?t=[t[0],1,1]:t.length===2?t=[t[0],t[1],1]:t.length>3&&(t=[t[0],t[1],t[2]])}const o=t[0],h=t[1],f=t[2],_=this.getTypeInfo("vec3u");s.setVariable("@num_workgroups",new Lt(t,_));for(const x in n)for(const T in n[x]){const I=n[x][T];s.variables.forEach(N=>{const $=N.node;if($!=null&&$.attributes){let W=null,Y=null;for(const ie of $.attributes)ie.name==="binding"?W=ie.value:ie.name==="group"&&(Y=ie.value);T==W&&x==Y&&(I.texture!==void 0&&I.size!==void 0?N.value=new Ml(I.texture,this.getTypeInfo($.type),0,I.size):I.uniform!==void 0?N.value=new Ml(I.uniform,this.getTypeInfo($.type)):N.value=new Ml(I,this.getTypeInfo($.type)))}})}for(let x=0;x<f;++x)for(let T=0;T<h;++T)for(let I=0;I<o;++I)s.setVariable("@workgroup_id",new Lt([I,T,x],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(a,[I,T,x],s)}execStatement(e,t){if(e instanceof Vk)return this.evalExpression(e.value,t);if(e instanceof Qk){if(e.condition){const n=this.evalExpression(e.condition,t);if(!(n instanceof hr))throw new Error("Invalid break-if condition");if(!n.value)return null}return Pd._breakObj}if(e instanceof $k)return Pd._continueObj;if(e instanceof nw)this._let(e,t);else if(e instanceof np)this._var(e,t);else if(e instanceof hI)this._const(e,t);else if(e instanceof rw)this._function(e,t);else{if(e instanceof Hk)return this._if(e,t);if(e instanceof zk)return this._switch(e,t);if(e instanceof Ok)return this._for(e,t);if(e instanceof Dk)return this._while(e,t);if(e instanceof Nk)return this._loop(e,t);if(e instanceof cI){const n=t.clone();return n.currentFunctionName=t.currentFunctionName,this._execStatements(e.body,n)}if(e instanceof Uk)this._assign(e,t);else if(e instanceof kk)this._increment(e,t);else{if(e instanceof ip)return null;if(e instanceof uI){const n=e.name;t.getVariable(n)===null&&t.setVariable(n,new hr(0,this.getTypeInfo("u32")))}else if(e instanceof dI)this._call(e,t);else{if(e instanceof Gk||e instanceof fI)return null;console.error("Invalid statement type.",e,`Line ${e.line}`)}}}return null}evalExpression(e,t){for(;e instanceof sw;)e=e.contents[0];return e instanceof Od?this._evalBinaryOp(e,t):e instanceof pa?this._evalLiteral(e,t):e instanceof sp?this._evalVariable(e,t):e instanceof iw?this._evalCall(e,t):e instanceof Cg?this._evalCreate(e,t):e instanceof qk?this._evalConst(e,t):e instanceof Kk?this._evalBitcast(e,t):e instanceof bh?this._evalUnaryOp(e,t):(console.error("Invalid expression type",e,`Line ${e.line}`),null)}getTypeInfo(e){var t;if(e instanceof dn){const i=this.reflection.getTypeInfo(e);if(i!==null)return i}const n=(t=this.typeInfo[e])!==null&&t!==void 0?t:null;return n!==null?n:null}getTypeName(e){if(e===null)return console.error("Type is null."),"unknown";let t=e.name;if(e instanceof tp||e instanceof Nr){if(e.format!==null){if(t==="vec2"||t==="vec3"||t==="vec4"||t==="mat2x2"||t==="mat2x3"||t==="mat2x4"||t==="mat3x2"||t==="mat3x3"||t==="mat3x4"||t==="mat4x2"||t==="mat4x3"||t==="mat4x4"){if(e.format.name==="f32")return t+="f",t;if(e.format.name==="i32")return t+="i",t;if(e.format.name==="u32")return t+="u",t;if(e.format.name==="bool")return t+="b",t;if(e.format.name==="f16")return t+="h",t}t+=`<${e.format.name}>`}else if(t==="vec2"||t==="vec3"||t==="vec4")return t}return t}_setOverrides(e,t){for(const n in e){const i=e[n],s=this.reflection.getOverrideInfo(n);s!==null?s.type.name==="u32"||s.type.name==="i32"||s.type.name==="f32"||s.type.name==="f16"?t.setVariable(n,new hr(i,s.type)):s.type.name==="bool"?t.setVariable(n,new hr(i?1:0,s.type)):s.type.name==="vec2"||s.type.name==="vec3"||s.type.name==="vec4"||s.type.name==="vec2f"||s.type.name==="vec3f"||s.type.name==="vec4f"||s.type.name==="vec2i"||s.type.name==="vec3i"||s.type.name==="vec4i"||s.type.name==="vec2u"||s.type.name==="vec3u"||s.type.name==="vec4u"||s.type.name==="vec2h"||s.type.name==="vec3h"||s.type.name==="vec4h"?t.setVariable(n,new Lt(i,s.type)):console.error(`Invalid constant type for ${n}`):console.error(`Override ${n} does not exist in the shader.`)}}_dispatchWorkgroup(e,t,n){const i=[1,1,1];for(const _ of e.node.attributes)if(_.name==="workgroup_size"){if(_.value.length>0){const x=n.getVariableValue(_.value[0]);i[0]=x instanceof hr?x.value:parseInt(_.value[0])}if(_.value.length>1){const x=n.getVariableValue(_.value[1]);i[1]=x instanceof hr?x.value:parseInt(_.value[1])}if(_.value.length>2){const x=n.getVariableValue(_.value[2]);i[2]=x instanceof hr?x.value:parseInt(_.value[2])}}const s=this.getTypeInfo("vec3u"),a=this.getTypeInfo("u32");n.setVariable("@workgroup_size",new Lt(i,s));const o=i[0],h=i[1],f=i[2];for(let _=0,x=0;_<f;++_)for(let T=0;T<h;++T)for(let I=0;I<o;++I,++x){const N=[I,T,_],$=[I+t[0]*i[0],T+t[1]*i[1],_+t[2]*i[2]];n.setVariable("@local_invocation_id",new Lt(N,s)),n.setVariable("@global_invocation_id",new Lt($,s)),n.setVariable("@local_invocation_index",new hr(x,a)),this._dispatchExec(e,n)}}_dispatchExec(e,t){for(const n of e.node.args)for(const i of n.attributes)if(i.name==="builtin"){const s=`@${i.value}`,a=t.getVariable(s);a!==void 0&&t.variables.set(n.name,a)}this._execStatements(e.node.body,t)}getVariableName(e,t){return e instanceof sp?e.name:(console.error("Unknown variable type",e,"Line",e.line),null)}_execStatements(e,t){for(const n of e){if(n instanceof Array){const s=t.clone(),a=this._execStatements(n,s);if(a)return a;continue}const i=this.execStatement(n,t);if(i)return i}return null}_call(e,t){const n=t.clone();n.currentFunctionName=e.name;const i=t.getFunction(e.name);if(i){for(let s=0;s<i.node.args.length;++s){const a=i.node.args[s],o=this.evalExpression(e.args[s],n);n.setVariable(a.name,o,a)}this._execStatements(i.node.body,n)}else this._callBuiltinFunction(e,n)}_increment(e,t){const n=this.getVariableName(e.variable,t),i=t.getVariable(n);i?e.operator==="++"?i.value instanceof hr?i.value.value++:console.error(`Variable ${n} is not a scalar. Line ${e.line}`):e.operator==="--"?i.value instanceof hr?i.value.value--:console.error(`Variable ${n} is not a scalar. Line ${e.line}`):console.error(`Unknown increment operator ${e.operator}. Line ${e.line}`):console.error(`Variable ${n} not found. Line ${e.line}`)}_assign(e,t){const n=this.getVariableName(e.variable,t),i=t.getVariable(n);if(i===null)return void console.error(`Variable ${n} not found. Line ${e.line}`);const s=this.evalExpression(e.value,t),a=e.operator;if(a==="=")if(i.value instanceof Ml)i.value.setDataValue(this,s,e.variable.postfix,t);else if(e.variable.postfix){if(!(i.value instanceof Lt||i.value instanceof $s))return void console.error(`Variable ${i.name} is not a vector or matrix. Line ${e.line}`);if(e.variable.postfix instanceof w_){const o=this.evalExpression(e.variable.postfix.index,t).value;if(i.value instanceof Lt){if(!(s instanceof hr))return void console.error(`Invalid assignment to ${i.name}. Line ${e.line}`);i.value.value[o]=s.value}else{if(!(i.value instanceof $s))return void console.error(`Invalid assignment to ${i.name}. Line ${e.line}`);{const h=this.evalExpression(e.variable.postfix.index,t).value;if(h<0)return void console.error(`Invalid assignment to ${i.name}. Line ${e.line}`);if(!(s instanceof Lt))return void console.error(`Invalid assignment to ${i.name}. Line ${e.line}`);{const f=this.getTypeName(i.value.typeInfo);if(f==="mat2x2"||f==="mat2x2f"||f==="mat2x2h"){if(!(h<2&&s.value.length===2))return void console.error(`Invalid assignment to ${i.name}. Line ${e.line}`);i.value.value[2*h]=s.value[0],i.value.value[2*h+1]=s.value[1]}else if(f==="mat2x3"||f==="mat2x3f"||f==="mat2x3h"){if(!(h<2&&s.value.length===3))return void console.error(`Invalid assignment to ${i.name}. Line ${e.line}`);i.value.value[3*h]=s.value[0],i.value.value[3*h+1]=s.value[1],i.value.value[3*h+2]=s.value[2]}else if(f==="mat2x4"||f==="mat2x4f"||f==="mat2x4h"){if(!(h<2&&s.value.length===4))return void console.error(`Invalid assignment to ${i.name}. Line ${e.line}`);i.value.value[4*h]=s.value[0],i.value.value[4*h+1]=s.value[1],i.value.value[4*h+2]=s.value[2],i.value.value[4*h+3]=s.value[3]}else if(f==="mat3x2"||f==="mat3x2f"||f==="mat3x2h"){if(!(h<3&&s.value.length===2))return void console.error(`Invalid assignment to ${i.name}. Line ${e.line}`);i.value.value[2*h]=s.value[0],i.value.value[2*h+1]=s.value[1]}else if(f==="mat3x3"||f==="mat3x3f"||f==="mat3x3h"){if(!(h<3&&s.value.length===3))return void console.error(`Invalid assignment to ${i.name}. Line ${e.line}`);i.value.value[3*h]=s.value[0],i.value.value[3*h+1]=s.value[1],i.value.value[3*h+2]=s.value[2]}else if(f==="mat3x4"||f==="mat3x4f"||f==="mat3x4h"){if(!(h<3&&s.value.length===4))return void console.error(`Invalid assignment to ${i.name}. Line ${e.line}`);i.value.value[4*h]=s.value[0],i.value.value[4*h+1]=s.value[1],i.value.value[4*h+2]=s.value[2],i.value.value[4*h+3]=s.value[3]}else if(f==="mat4x2"||f==="mat4x2f"||f==="mat4x2h"){if(!(h<4&&s.value.length===2))return void console.error(`Invalid assignment to ${i.name}. Line ${e.line}`);i.value.value[2*h]=s.value[0],i.value.value[2*h+1]=s.value[1]}else if(f==="mat4x3"||f==="mat4x3f"||f==="mat4x3h"){if(!(h<4&&s.value.length===3))return void console.error(`Invalid assignment to ${i.name}. Line ${e.line}`);i.value.value[3*h]=s.value[0],i.value.value[3*h+1]=s.value[1],i.value.value[3*h+2]=s.value[2]}else{if(f!=="mat4x4"&&f!=="mat4x4f"&&f!=="mat4x4h")return void console.error(`Invalid assignment to ${i.name}. Line ${e.line}`);if(!(h<4&&s.value.length===4))return void console.error(`Invalid assignment to ${i.name}. Line ${e.line}`);i.value.value[4*h]=s.value[0],i.value.value[4*h+1]=s.value[1],i.value.value[4*h+2]=s.value[2],i.value.value[4*h+3]=s.value[3]}}}}}else if(e.variable.postfix instanceof Bg){const o=e.variable.postfix.value;if(!(i.value instanceof Lt))return void console.error(`Invalid assignment to ${o}. Variable ${i.name} is not a vector. Line ${e.line}`);if(s instanceof hr){if(o.length>1)return void console.error(`Invalid assignment to ${o} for variable ${i.name}. Line ${e.line}`);if(o==="x")i.value.value[0]=s.value;else if(o==="y"){if(i.value.value.length<2)return void console.error(`Invalid assignment to ${o} for variable ${i.name}. Line ${e.line}`);i.value.value[1]=s.value}else if(o==="z"){if(i.value.value.length<3)return void console.error(`Invalid assignment to ${o} for variable ${i.name}. Line ${e.line}`);i.value.value[2]=s.value}else if(o==="w"){if(i.value.value.length<4)return void console.error(`Invalid assignment to ${o} for variable ${i.name}. Line ${e.line}`);i.value.value[3]=s.value}}else{if(!(s instanceof Lt))return void console.error(`Invalid assignment to ${i.name}. Line ${e.line}`);if(o.length!==s.value.length)return void console.error(`Invalid assignment to ${o} for variable ${i.name}. Line ${e.line}`);for(let h=0;h<o.length;++h){const f=o[h];if(f==="x"||f==="r")i.value.value[0]=s.value[h];else if(f==="y"||f==="g"){if(s.value.length<2)return void console.error(`Invalid assignment to ${f} for variable ${i.name}. Line ${e.line}`);i.value.value[1]=s.value[h]}else if(f==="z"||f==="b"){if(s.value.length<3)return void console.error(`Invalid assignment to ${f} for variable ${i.name}. Line ${e.line}`);i.value.value[2]=s.value[h]}else{if(f!=="w"&&f!=="a")return void console.error(`Invalid assignment to ${f} for variable ${i.name}. Line ${e.line}`);if(s.value.length<4)return void console.error(`Invalid assignment to ${f} for variable ${i.name}. Line ${e.line}`);i.value.value[3]=s.value[h]}}}}}else i.value=s;else{const o=i.value.getDataValue(this,e.variable.postfix,t);if(o instanceof Lt&&s instanceof hr){const h=o.value,f=s.value;if(a==="+=")for(let _=0;_<h.length;++_)h[_]+=f;else if(a==="-=")for(let _=0;_<h.length;++_)h[_]-=f;else if(a==="*=")for(let _=0;_<h.length;++_)h[_]*=f;else if(a==="/=")for(let _=0;_<h.length;++_)h[_]/=f;else if(a==="%=")for(let _=0;_<h.length;++_)h[_]%=f;else if(a==="&=")for(let _=0;_<h.length;++_)h[_]&=f;else if(a==="|=")for(let _=0;_<h.length;++_)h[_]|=f;else if(a==="^=")for(let _=0;_<h.length;++_)h[_]^=f;else if(a==="<<=")for(let _=0;_<h.length;++_)h[_]<<=f;else if(a===">>=")for(let _=0;_<h.length;++_)h[_]>>=f;else console.error(`Invalid operator ${a}. Line ${e.line}`)}else if(o instanceof Lt&&s instanceof Lt){const h=o.value,f=s.value;if(h.length!==f.length)return void console.error(`Vector length mismatch. Line ${e.line}`);if(a==="+=")for(let _=0;_<h.length;++_)h[_]+=f[_];else if(a==="-=")for(let _=0;_<h.length;++_)h[_]-=f[_];else if(a==="*=")for(let _=0;_<h.length;++_)h[_]*=f[_];else if(a==="/=")for(let _=0;_<h.length;++_)h[_]/=f[_];else if(a==="%=")for(let _=0;_<h.length;++_)h[_]%=f[_];else if(a==="&=")for(let _=0;_<h.length;++_)h[_]&=f[_];else if(a==="|=")for(let _=0;_<h.length;++_)h[_]|=f[_];else if(a==="^=")for(let _=0;_<h.length;++_)h[_]^=f[_];else if(a==="<<=")for(let _=0;_<h.length;++_)h[_]<<=f[_];else if(a===">>=")for(let _=0;_<h.length;++_)h[_]>>=f[_];else console.error(`Invalid operator ${a}. Line ${e.line}`)}else{if(!(o instanceof hr&&s instanceof hr))return void console.error(`Invalid type for ${e.operator} operator. Line ${e.line}`);a==="+="?o.value+=s.value:a==="-="?o.value-=s.value:a==="*="?o.value*=s.value:a==="/="?o.value/=s.value:a==="%="?o.value%=s.value:a==="&="?o.value&=s.value:a==="|="?o.value|=s.value:a==="^="?o.value^=s.value:a==="<<="?o.value<<=s.value:a===">>="?o.value>>=s.value:console.error(`Invalid operator ${a}. Line ${e.line}`)}i.value instanceof Ml&&i.value.setDataValue(this,o,e.variable.postfix,t)}}_function(e,t){const n=new Une(e);t.functions.set(e.name,n)}_const(e,t){let n=null;e.value!=null&&(n=this.evalExpression(e.value,t)),t.createVariable(e.name,n,e)}_let(e,t){let n=null;e.value!=null&&(n=this.evalExpression(e.value,t)),t.createVariable(e.name,n,e)}_var(e,t){let n=null;if(e.value!==null)n=this.evalExpression(e.value,t);else{if(e.type===null)return void console.error(`Variable ${e.name} has no type. Line ${e.line}`);if(e.type.name==="f32"||e.type.name==="i32"||e.type.name==="u32"||e.type.name==="bool"||e.type.name==="f16"||e.type.name==="vec2"||e.type.name==="vec3"||e.type.name==="vec4"||e.type.name==="vec2f"||e.type.name==="vec3f"||e.type.name==="vec4f"||e.type.name==="vec2i"||e.type.name==="vec3i"||e.type.name==="vec4i"||e.type.name==="vec2u"||e.type.name==="vec3u"||e.type.name==="vec4u"||e.type.name==="vec2h"||e.type.name==="vec3h"||e.type.name==="vec4h"||e.type.name==="mat2x2"||e.type.name==="mat2x3"||e.type.name==="mat2x4"||e.type.name==="mat3x2"||e.type.name==="mat3x3"||e.type.name==="mat3x4"||e.type.name==="mat4x2"||e.type.name==="mat4x3"||e.type.name==="mat4x4"||e.type.name==="mat2x2f"||e.type.name==="mat2x3f"||e.type.name==="mat2x4f"||e.type.name==="mat3x2f"||e.type.name==="mat3x3f"||e.type.name==="mat3x4f"||e.type.name==="mat4x2f"||e.type.name==="mat4x3f"||e.type.name==="mat4x4f"||e.type.name==="mat2x2h"||e.type.name==="mat2x3h"||e.type.name==="mat2x4h"||e.type.name==="mat3x2h"||e.type.name==="mat3x3h"||e.type.name==="mat3x4h"||e.type.name==="mat4x2h"||e.type.name==="mat4x3h"||e.type.name==="mat4x4h"){const i=new Cg(e.type,[]);n=this._evalCreate(i,t)}if(e.type.name==="array"){const i=new Cg(e.type,[]);n=this._evalCreate(i,t)}}t.createVariable(e.name,n,e)}_switch(e,t){t=t.clone();const n=this.evalExpression(e.condition,t);if(!(n instanceof hr))return console.error(`Invalid if condition. Line ${e.line}`),null;let i=null;for(const s of e.cases)if(s instanceof Jk)for(const a of s.selectors){if(a instanceof ow){i=s;continue}const o=this.evalExpression(a,t);if(!(o instanceof hr))return console.error(`Invalid case selector. Line ${e.line}`),null;if(o.value===n.value)return this._execStatements(s.body,t)}else s instanceof Zk&&(i=s);return i?this._execStatements(i.body,t):null}_if(e,t){t=t.clone();const n=this.evalExpression(e.condition,t);if(!(n instanceof hr))return console.error(`Invalid if condition. Line ${e.line}`),null;if(n.value)return this._execStatements(e.body,t);for(const i of e.elseif){const s=this.evalExpression(i.condition,t);if(!(s instanceof hr))return console.error(`Invalid if condition. Line ${e.line}`),null;if(s.value)return this._execStatements(i.body,t)}return e.else?this._execStatements(e.else,t):null}_getScalarValue(e){return e instanceof hr?e.value:(console.error("Expected scalar value.",e),0)}_for(e,t){for(t=t.clone(),this.execStatement(e.init,t);this._getScalarValue(this.evalExpression(e.condition,t));){const n=this._execStatements(e.body,t);if(n===Pd._breakObj)break;if(n!==null&&n!==Pd._continueObj)return n;this.execStatement(e.increment,t)}return null}_loop(e,t){for(t=t.clone();;){const n=this._execStatements(e.body,t);if(n===Pd._breakObj)break;if(n===Pd._continueObj){if(e.continuing&&this._execStatements(e.continuing.body,t)===Pd._breakObj)break}else if(n!==null)return n}return null}_while(e,t){for(t=t.clone();this._getScalarValue(this.evalExpression(e.condition,t));){const n=this._execStatements(e.body,t);if(n===Pd._breakObj)break;if(n!==Pd._continueObj&&n!==null)return n}return null}_evalBitcast(e,t){const n=this.evalExpression(e.value,t),i=e.type;if(n instanceof hr){const s=tU(n.value,n.typeInfo.name,i.name);return new hr(s,this.getTypeInfo(i))}if(n instanceof Lt){const s=this.getTypeName(n.typeInfo);let a="";if(s.endsWith("f"))a="f32";else if(s.endsWith("i"))a="i32";else if(s.endsWith("u"))a="u32";else if(s.endsWith("b"))a="bool";else{if(!s.endsWith("h"))return console.error(`Unknown vector type ${s}. Line ${e.line}`),null;a="f16"}const o=this.getTypeName(i);let h="";if(o.endsWith("f"))h="f32";else if(o.endsWith("i"))h="i32";else if(o.endsWith("u"))h="u32";else if(o.endsWith("b"))h="bool";else{if(!o.endsWith("h"))return console.error(`Unknown vector type ${h}. Line ${e.line}`),null;h="f16"}const f=function(_,x,T){if(x===T)return _;const I=new Array(_.length);for(let N=0;N<_.length;N++)I[N]=tU(_[N],x,T);return I}(n.value,a,h);return new Lt(f,this.getTypeInfo(i))}return console.error(`TODO: bitcast for ${n.typeInfo.name}. Line ${e.line}`),null}_evalConst(e,t){const n=t.getVariableValue(e.name);return e.postfix?n.getDataValue(this,e.postfix,t):n}_evalCreate(e,t){var n;if(e.type===null)return AI.void;const i=this.getTypeName(e.type);switch(i){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(e,t);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(e,t);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(e,t)}const s=this.getTypeInfo(e.type);if(s===null)return console.error(`Unknown type ${i}. Line ${e.line}`),null;if(s.size===0)return null;const a=new Ml(new ArrayBuffer(s.size),s,0);if(s instanceof ep){if(e.args)for(let o=0;o<e.args.length;++o){const h=s.members[o],f=e.args[o],_=this.evalExpression(f,t);a.setData(this,_,h.type,h.offset,t)}}else if(s instanceof wg){let o=0;if(e.args)for(let h=0;h<e.args.length;++h){const f=e.args[h],_=this.evalExpression(f,t);s.format===null&&(((n=_.typeInfo)===null||n===void 0?void 0:n.name)==="x32"?s.format=this.getTypeInfo("i32"):s.format=_.typeInfo),a.setData(this,_,s.format,o,t),o+=s.stride}}else console.error(`Unknown type "${i}". Line ${e.line}`);return a}_evalLiteral(e,t){const n=this.getTypeInfo(e.type),i=n.name;return i==="x32"||i==="u32"||i==="f32"||i==="f16"||i==="i32"||i==="bool"?new hr(e.scalarValue,n):i==="vec2"||i==="vec3"||i==="vec4"||i==="vec2f"||i==="vec3f"||i==="vec4f"||i==="vec2h"||i==="vec3h"||i==="vec4h"||i==="vec2i"||i==="vec3i"||i==="vec4i"||i==="vec2u"||i==="vec3u"||i==="vec4u"?this._callConstructorVec(e,t):i==="mat2x2"||i==="mat2x3"||i==="mat2x4"||i==="mat3x2"||i==="mat3x3"||i==="mat3x4"||i==="mat4x2"||i==="mat4x3"||i==="mat4x4"||i==="mat2x2f"||i==="mat2x3f"||i==="mat2x4f"||i==="mat3x2f"||i==="mat3x3f"||i==="mat3x4f"||i==="mat4x2f"||i==="mat4x3f"||i==="mat4x4f"||i==="mat2x2h"||i==="mat2x3h"||i==="mat2x4h"||i==="mat3x2h"||i==="mat3x3h"||i==="mat3x4h"||i==="mat4x2h"||i==="mat4x3h"||i==="mat4x4h"?this._callConstructorMatrix(e,t):e.value}_evalVariable(e,t){const n=t.getVariableValue(e.name);return n===null?n:e!=null&&e.postfix?n.getDataValue(this,e.postfix,t):n}_maxFormatTypeInfo(e){let t=e[0];if(t.name==="f32")return t;for(let n=1;n<e.length;++n){const i=Pd._priority.get(t.name);Pd._priority.get(e[n].name)<i&&(t=e[n])}return t.name==="x32"?this.getTypeInfo("i32"):t}_evalUnaryOp(e,t){const n=this.evalExpression(e.right,t),i=n instanceof hr||n instanceof Lt?n.value:null;switch(e.operator){case"+":{if(En(i)){const o=i.map((h,f)=>+h);return new Lt(o,n.typeInfo)}const s=i,a=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new hr(+s,a)}case"-":{if(En(i)){const o=i.map((h,f)=>-h);return new Lt(o,n.typeInfo)}const s=i,a=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new hr(-s,a)}case"!":{if(En(i)){const o=i.map((h,f)=>h?0:1);return new Lt(o,n.typeInfo)}const s=i,a=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new hr(s?0:1,a)}case"~":{if(En(i)){const o=i.map((h,f)=>~h);return new Lt(o,n.typeInfo)}const s=i,a=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new hr(~s,a)}}return console.error(`Invalid unary operator ${e.operator}. Line ${e.line}`),null}_evalBinaryOp(e,t){const n=this.evalExpression(e.left,t),i=this.evalExpression(e.right,t),s=n instanceof hr||n instanceof Lt||n instanceof $s?n.value:null,a=i instanceof hr||i instanceof Lt||i instanceof $s?i.value:null;switch(e.operator){case"+":{if(En(s)&&En(a)){const _=s,x=a;if(_.length!==x.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const T=_.map((I,N)=>I+x[N]);return new Lt(T,n.typeInfo)}if(En(s)){const _=a,x=s.map((T,I)=>T+_);return new Lt(x,n.typeInfo)}if(En(a)){const _=s,x=a.map((T,I)=>_+T);return new Lt(x,i.typeInfo)}const o=s,h=a,f=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new hr(o+h,f)}case"-":{if(En(s)&&En(a)){const _=s,x=a;if(_.length!==x.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const T=_.map((I,N)=>I-x[N]);return new Lt(T,n.typeInfo)}if(En(s)){const _=a,x=s.map((T,I)=>T-_);return new Lt(x,n.typeInfo)}if(En(a)){const _=s,x=a.map((T,I)=>_-T);return new Lt(x,i.typeInfo)}const o=s,h=a,f=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new hr(o-h,f)}case"*":{if(En(s)&&En(a)){const _=s,x=a;if(_.length!==x.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const T=_.map((I,N)=>I*x[N]);return new Lt(T,n.typeInfo)}if(En(s)){const _=a,x=s.map((T,I)=>T*_);return new Lt(x,n.typeInfo)}if(En(a)){const _=s,x=a.map((T,I)=>_*T);return new Lt(x,i.typeInfo)}const o=s,h=a,f=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new hr(o*h,f)}case"%":{if(En(s)&&En(a)){const _=s,x=a;if(_.length!==x.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const T=_.map((I,N)=>I%x[N]);return new Lt(T,n.typeInfo)}if(En(s)){const _=a,x=s.map((T,I)=>T%_);return new Lt(x,n.typeInfo)}if(En(a)){const _=s,x=a.map((T,I)=>_%T);return new Lt(x,i.typeInfo)}const o=s,h=a,f=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new hr(o%h,f)}case"/":{if(En(s)&&En(a)){const _=s,x=a;if(_.length!==x.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const T=_.map((I,N)=>I/x[N]);return new Lt(T,n.typeInfo)}if(En(s)){const _=a,x=s.map((T,I)=>T/_);return new Lt(x,n.typeInfo)}if(En(a)){const _=s,x=a.map((T,I)=>_/T);return new Lt(x,i.typeInfo)}const o=s,h=a,f=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new hr(o/h,f)}case"&":{if(En(s)&&En(a)){const _=s,x=a;if(_.length!==x.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const T=_.map((I,N)=>I&x[N]);return new Lt(T,n.typeInfo)}if(En(s)){const _=a,x=s.map((T,I)=>T&_);return new Lt(x,n.typeInfo)}if(En(a)){const _=s,x=a.map((T,I)=>_&T);return new Lt(x,i.typeInfo)}const o=s,h=a,f=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new hr(o&h,f)}case"|":{if(En(s)&&En(a)){const _=s,x=a;if(_.length!==x.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const T=_.map((I,N)=>I|x[N]);return new Lt(T,n.typeInfo)}if(En(s)){const _=a,x=s.map((T,I)=>T|_);return new Lt(x,n.typeInfo)}if(En(a)){const _=s,x=a.map((T,I)=>_|T);return new Lt(x,i.typeInfo)}const o=s,h=a,f=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new hr(o|h,f)}case"^":{if(En(s)&&En(a)){const _=s,x=a;if(_.length!==x.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const T=_.map((I,N)=>I^x[N]);return new Lt(T,n.typeInfo)}if(En(s)){const _=a,x=s.map((T,I)=>T^_);return new Lt(x,n.typeInfo)}if(En(a)){const _=s,x=a.map((T,I)=>_^T);return new Lt(x,i.typeInfo)}const o=s,h=a,f=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new hr(o^h,f)}case"<<":{if(En(s)&&En(a)){const _=s,x=a;if(_.length!==x.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const T=_.map((I,N)=>I<<x[N]);return new Lt(T,n.typeInfo)}if(En(s)){const _=a,x=s.map((T,I)=>T<<_);return new Lt(x,n.typeInfo)}if(En(a)){const _=s,x=a.map((T,I)=>_<<T);return new Lt(x,i.typeInfo)}const o=s,h=a,f=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new hr(o<<h,f)}case">>":{if(En(s)&&En(a)){const _=s,x=a;if(_.length!==x.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const T=_.map((I,N)=>I>>x[N]);return new Lt(T,n.typeInfo)}if(En(s)){const _=a,x=s.map((T,I)=>T>>_);return new Lt(x,n.typeInfo)}if(En(a)){const _=s,x=a.map((T,I)=>_>>T);return new Lt(x,i.typeInfo)}const o=s,h=a,f=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new hr(o>>h,f)}case">":if(En(s)&&En(a)){const o=s,h=a;if(o.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const f=o.map((_,x)=>_>h[x]?1:0);return new Lt(f,n.typeInfo)}if(En(s)){const o=a,h=s.map((f,_)=>f>o?1:0);return new Lt(h,n.typeInfo)}if(En(a)){const o=s,h=a.map((f,_)=>o>f?1:0);return new Lt(h,i.typeInfo)}return new hr(s>a?1:0,this.getTypeInfo("bool"));case"<":if(En(s)&&En(a)){const o=s,h=a;if(o.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const f=o.map((_,x)=>_<h[x]?1:0);return new Lt(f,n.typeInfo)}if(En(s)){const o=a,h=s.map((f,_)=>f<o?1:0);return new Lt(h,n.typeInfo)}if(En(a)){const o=s,h=a.map((f,_)=>o<f?1:0);return new Lt(h,i.typeInfo)}return new hr(s<a?1:0,this.getTypeInfo("bool"));case"==":if(En(s)&&En(a)){const o=s,h=a;if(o.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const f=o.map((_,x)=>_===h[x]?1:0);return new Lt(f,n.typeInfo)}if(En(s)){const o=a,h=s.map((f,_)=>f==o?1:0);return new Lt(h,n.typeInfo)}if(En(a)){const o=s,h=a.map((f,_)=>o==f?1:0);return new Lt(h,i.typeInfo)}return new hr(s===a?1:0,this.getTypeInfo("bool"));case"!=":if(En(s)&&En(a)){const o=s,h=a;if(o.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const f=o.map((_,x)=>_!==h[x]?1:0);return new Lt(f,n.typeInfo)}if(En(s)){const o=a,h=s.map((f,_)=>f!==o?1:0);return new Lt(h,n.typeInfo)}if(En(a)){const o=s,h=a.map((f,_)=>o!==f?1:0);return new Lt(h,i.typeInfo)}return new hr(s!==a?1:0,this.getTypeInfo("bool"));case">=":if(En(s)&&En(a)){const o=s,h=a;if(o.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const f=o.map((_,x)=>_>=h[x]?1:0);return new Lt(f,n.typeInfo)}if(En(s)){const o=a,h=s.map((f,_)=>f>=o?1:0);return new Lt(h,n.typeInfo)}if(En(a)){const o=s,h=a.map((f,_)=>o>=f?1:0);return new Lt(h,i.typeInfo)}return new hr(s>=a?1:0,this.getTypeInfo("bool"));case"<=":if(En(s)&&En(a)){const o=s,h=a;if(o.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const f=o.map((_,x)=>_<=h[x]?1:0);return new Lt(f,n.typeInfo)}if(En(s)){const o=a,h=s.map((f,_)=>f<=o?1:0);return new Lt(h,n.typeInfo)}if(En(a)){const o=s,h=a.map((f,_)=>o<=f?1:0);return new Lt(h,i.typeInfo)}return new hr(s<=a?1:0,this.getTypeInfo("bool"));case"&&":if(En(s)&&En(a)){const o=s,h=a;if(o.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const f=o.map((_,x)=>_&&h[x]?1:0);return new Lt(f,n.typeInfo)}if(En(s)){const o=a,h=s.map((f,_)=>f&&o?1:0);return new Lt(h,n.typeInfo)}if(En(a)){const o=s,h=a.map((f,_)=>o&&f?1:0);return new Lt(h,i.typeInfo)}return new hr(s&&a?1:0,this.getTypeInfo("bool"));case"||":if(En(s)&&En(a)){const o=s,h=a;if(o.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const f=o.map((_,x)=>_||h[x]?1:0);return new Lt(f,n.typeInfo)}if(En(s)){const o=a,h=s.map((f,_)=>f||o?1:0);return new Lt(h,n.typeInfo)}if(En(a)){const o=s,h=a.map((f,_)=>o||f?1:0);return new Lt(h,i.typeInfo)}return new hr(s||a?1:0,this.getTypeInfo("bool"))}return console.error(`Unknown operator ${e.operator}. Line ${e.line}`),null}_evalCall(e,t){if(e.cachedReturnValue!==null)return e.cachedReturnValue;const n=t.clone();n.currentFunctionName=e.name;const i=t.getFunction(e.name);if(!i)return this._callBuiltinFunction(e,n);for(let s=0;s<i.node.args.length;++s){const a=i.node.args[s],o=this.evalExpression(e.args[s],n);n.createVariable(a.name,o,a)}return this._execStatements(i.node.body,n)}_callBuiltinFunction(e,t){switch(e.name){case"all":return this.builtins.All(e,t);case"any":return this.builtins.Any(e,t);case"select":return this.builtins.Select(e,t);case"arrayLength":return this.builtins.ArrayLength(e,t);case"abs":return this.builtins.Abs(e,t);case"acos":return this.builtins.Acos(e,t);case"acosh":return this.builtins.Acosh(e,t);case"asin":return this.builtins.Asin(e,t);case"asinh":return this.builtins.Asinh(e,t);case"atan":return this.builtins.Atan(e,t);case"atanh":return this.builtins.Atanh(e,t);case"atan2":return this.builtins.Atan2(e,t);case"ceil":return this.builtins.Ceil(e,t);case"clamp":return this.builtins.Clamp(e,t);case"cos":return this.builtins.Cos(e,t);case"cosh":return this.builtins.Cosh(e,t);case"countLeadingZeros":return this.builtins.CountLeadingZeros(e,t);case"countOneBits":return this.builtins.CountOneBits(e,t);case"countTrailingZeros":return this.builtins.CountTrailingZeros(e,t);case"cross":return this.builtins.Cross(e,t);case"degrees":return this.builtins.Degrees(e,t);case"determinant":return this.builtins.Determinant(e,t);case"distance":return this.builtins.Distance(e,t);case"dot":return this.builtins.Dot(e,t);case"dot4U8Packed":return this.builtins.Dot4U8Packed(e,t);case"dot4I8Packed":return this.builtins.Dot4I8Packed(e,t);case"exp":return this.builtins.Exp(e,t);case"exp2":return this.builtins.Exp2(e,t);case"extractBits":return this.builtins.ExtractBits(e,t);case"faceForward":return this.builtins.FaceForward(e,t);case"firstLeadingBit":return this.builtins.FirstLeadingBit(e,t);case"firstTrailingBit":return this.builtins.FirstTrailingBit(e,t);case"floor":return this.builtins.Floor(e,t);case"fma":return this.builtins.Fma(e,t);case"fract":return this.builtins.Fract(e,t);case"frexp":return this.builtins.Frexp(e,t);case"insertBits":return this.builtins.InsertBits(e,t);case"inverseSqrt":return this.builtins.InverseSqrt(e,t);case"ldexp":return this.builtins.Ldexp(e,t);case"length":return this.builtins.Length(e,t);case"log":return this.builtins.Log(e,t);case"log2":return this.builtins.Log2(e,t);case"max":return this.builtins.Max(e,t);case"min":return this.builtins.Min(e,t);case"mix":return this.builtins.Mix(e,t);case"modf":return this.builtins.Modf(e,t);case"normalize":return this.builtins.Normalize(e,t);case"pow":return this.builtins.Pow(e,t);case"quantizeToF16":return this.builtins.QuantizeToF16(e,t);case"radians":return this.builtins.Radians(e,t);case"reflect":return this.builtins.Reflect(e,t);case"refract":return this.builtins.Refract(e,t);case"reverseBits":return this.builtins.ReverseBits(e,t);case"round":return this.builtins.Round(e,t);case"saturate":return this.builtins.Saturate(e,t);case"sign":return this.builtins.Sign(e,t);case"sin":return this.builtins.Sin(e,t);case"sinh":return this.builtins.Sinh(e,t);case"smoothStep":return this.builtins.SmoothStep(e,t);case"sqrt":return this.builtins.Sqrt(e,t);case"step":return this.builtins.Step(e,t);case"tan":return this.builtins.Tan(e,t);case"tanh":return this.builtins.Tanh(e,t);case"transpose":return this.builtins.Transpose(e,t);case"trunc":return this.builtins.Trunc(e,t);case"dpdx":return this.builtins.Dpdx(e,t);case"dpdxCoarse":return this.builtins.DpdxCoarse(e,t);case"dpdxFine":return this.builtins.DpdxFine(e,t);case"dpdy":return this.builtins.Dpdy(e,t);case"dpdyCoarse":return this.builtins.DpdyCoarse(e,t);case"dpdyFine":return this.builtins.DpdyFine(e,t);case"fwidth":return this.builtins.Fwidth(e,t);case"fwidthCoarse":return this.builtins.FwidthCoarse(e,t);case"fwidthFine":return this.builtins.FwidthFine(e,t);case"textureDimensions":return this.builtins.TextureDimensions(e,t);case"textureGather":return this.builtins.TextureGather(e,t);case"textureGatherCompare":return this.builtins.TextureGatherCompare(e,t);case"textureLoad":return this.builtins.TextureLoad(e,t);case"textureNumLayers":return this.builtins.TextureNumLayers(e,t);case"textureNumLevels":return this.builtins.TextureNumLevels(e,t);case"textureNumSamples":return this.builtins.TextureNumSamples(e,t);case"textureSample":return this.builtins.TextureSample(e,t);case"textureSampleBias":return this.builtins.TextureSampleBias(e,t);case"textureSampleCompare":return this.builtins.TextureSampleCompare(e,t);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(e,t);case"textureSampleGrad":return this.builtins.TextureSampleGrad(e,t);case"textureSampleLevel":return this.builtins.TextureSampleLevel(e,t);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(e,t);case"textureStore":return this.builtins.TextureStore(e,t);case"atomicLoad":return this.builtins.AtomicLoad(e,t);case"atomicStore":return this.builtins.AtomicStore(e,t);case"atomicAdd":return this.builtins.AtomicAdd(e,t);case"atomicSub":return this.builtins.AtomicSub(e,t);case"atomicMax":return this.builtins.AtomicMax(e,t);case"atomicMin":return this.builtins.AtomicMin(e,t);case"atomicAnd":return this.builtins.AtomicAnd(e,t);case"atomicOr":return this.builtins.AtomicOr(e,t);case"atomicXor":return this.builtins.AtomicXor(e,t);case"atomicExchange":return this.builtins.AtomicExchange(e,t);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(e,t);case"pack4x8snorm":return this.builtins.Pack4x8snorm(e,t);case"pack4x8unorm":return this.builtins.Pack4x8unorm(e,t);case"pack4xI8":return this.builtins.Pack4xI8(e,t);case"pack4xU8":return this.builtins.Pack4xU8(e,t);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(e,t);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(e,t);case"pack2x16snorm":return this.builtins.Pack2x16snorm(e,t);case"pack2x16unorm":return this.builtins.Pack2x16unorm(e,t);case"pack2x16float":return this.builtins.Pack2x16float(e,t);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(e,t);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(e,t);case"unpack4xI8":return this.builtins.Unpack4xI8(e,t);case"unpack4xU8":return this.builtins.Unpack4xU8(e,t);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(e,t);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(e,t);case"unpack2x16float":return this.builtins.Unpack2x16float(e,t);case"storageBarrier":return this.builtins.StorageBarrier(e,t);case"textureBarrier":return this.builtins.TextureBarrier(e,t);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(e,t);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(e,t);case"subgroupAdd":return this.builtins.SubgroupAdd(e,t);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(e,t);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(e,t);case"subgroupAll":return this.builtins.SubgroupAll(e,t);case"subgroupAnd":return this.builtins.SubgroupAnd(e,t);case"subgroupAny":return this.builtins.SubgroupAny(e,t);case"subgroupBallot":return this.builtins.SubgroupBallot(e,t);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(e,t);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(e,t);case"subgroupElect":return this.builtins.SubgroupElect(e,t);case"subgroupMax":return this.builtins.SubgroupMax(e,t);case"subgroupMin":return this.builtins.SubgroupMin(e,t);case"subgroupMul":return this.builtins.SubgroupMul(e,t);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(e,t);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(e,t);case"subgroupOr":return this.builtins.SubgroupOr(e,t);case"subgroupShuffle":return this.builtins.SubgroupShuffle(e,t);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(e,t);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(e,t);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(e,t);case"subgroupXor":return this.builtins.SubgroupXor(e,t);case"quadBroadcast":return this.builtins.QuadBroadcast(e,t);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(e,t);case"quadSwapX":return this.builtins.QuadSwapX(e,t);case"quadSwapY":return this.builtins.QuadSwapY(e,t)}const n=t.getFunction(e.name);if(n){const i=t.clone();for(let s=0;s<n.node.args.length;++s){const a=n.node.args[s],o=this.evalExpression(e.args[s],i);i.setVariable(a.name,o,a)}return this._execStatements(n.node.body,i)}return null}_callConstructorValue(e,t){if(!e.args||e.args.length===0)return new hr(0,this.getTypeInfo(e.type));const n=this.evalExpression(e.args[0],t);return n.typeInfo=this.getTypeInfo(e.type),n}_callConstructorVec(e,t){const n=this.getTypeInfo(e.type),i=this.getTypeName(e.type),s={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4}[i];if(s===void 0)return console.error(`Invalid vec constructor ${i}. Line ${e.line}`),null;const a=i.endsWith("i")||i.endsWith("u"),o=[];if(e instanceof pa)if(e.isVector){const h=e.vectorValue;for(const f of h)o.push(f)}else o.push(e.scalarValue);else if(e.args)for(const h of e.args){const f=this.evalExpression(h,t);if(f instanceof Lt){const _=f.value;for(let x=0;x<_.length;++x){let T=_[x];a&&(T=Math.floor(T)),o.push(T)}}else if(f instanceof hr){let _=f.value;a&&(_=Math.floor(_)),o.push(_)}}if(e.type instanceof Nr&&e.type.format===null&&(e.type.format=Nr.f32),o.length===0){const h=new Array(s).fill(0);return new Lt(h,n)}if(o.length===1)for(;o.length<s;)o.push(o[0]);return o.length<s?(console.error(`Invalid vec constructor. Line ${e.line}`),null):new Lt(o.length>s?o.slice(0,s):o,n)}_callConstructorMatrix(e,t){const n=this.getTypeInfo(e.type),i=this.getTypeName(e.type),s={mat2x2:4,mat2x2f:4,mat2x2h:4,mat2x3:6,mat2x3f:6,mat2x3h:6,mat2x4:8,mat2x4f:8,mat2x4h:8,mat3x2:6,mat3x2f:6,mat3x2h:6,mat3x3:9,mat3x3f:9,mat3x3h:9,mat3x4:12,mat3x4f:12,mat3x4h:12,mat4x2:8,mat4x2f:8,mat4x2h:8,mat4x3:12,mat4x3f:12,mat4x3h:12,mat4x4:16,mat4x4f:16,mat4x4h:16}[i];if(s===void 0)return console.error(`Invalid matrix constructor ${i}. Line ${e.line}`),null;const a=[];if(e instanceof pa)if(e.isVector){const o=e.vectorValue;for(const h of o)a.push(h)}else a.push(e.scalarValue);else if(e.args)for(const o of e.args){const h=this.evalExpression(o,t);if(h instanceof Lt){const f=h.value;for(let _=0;_<f.length;++_)a.push(f[_])}else h instanceof hr?a.push(h.value):h instanceof $s&&a.push(...h.value)}if(n instanceof tp&&n.format===null&&(n.format=this.getTypeInfo("f32")),a.length===0){const o=new Array(s).fill(0);return new $s(o,n)}return a.length!==s?(console.error(`Invalid matrix constructor. Line ${e.line}`),null):new $s(a,n)}};hw._breakObj=new Eg(new Ld("BREAK",null)),hw._continueObj=new Eg(new Ld("CONTINUE",null)),hw._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);let Kne=class{constructor(){this._tokens=[],this._current=0,this._currentLine=0,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new Cne,this._exec=new hw}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const t=[];for(;!this._isAtEnd();){const n=this._global_decl_or_directive();if(!n)break;t.push(n)}if(this._deferArrayCountEval.length>0){for(const n of this._deferArrayCountEval){const i=n.arrayType,s=n.countNode;if(s instanceof sp){const a=s.name,o=this._context.constants.get(a);if(o)try{const h=o.constEvaluate(this._exec);i.count=h}catch{}}}this._deferArrayCountEval.length=0}return t}_initialize(e){if(e)if(typeof e=="string"){const t=new Dne(e);this._tokens=t.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_updateNode(e,t){return e.line=t??this._currentLine,e}_error(e,t){return{token:e,message:t,toString:()=>`${t}`}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==pt.eof}_match(e){if(e instanceof tr)return!!this._check(e)&&(this._advance(),!0);for(let t=0,n=e.length;t<n;++t){const i=e[t];if(this._check(i))return this._advance(),!0}return!1}_consume(e,t){if(this._check(e))return this._advance();throw this._error(this._peek(),`${t}. Line:${this._currentLine}`)}_check(e){if(this._isAtEnd())return!1;const t=this._peek();if(e instanceof Array){const n=t.type;let i=!1;for(const s of e){if(n===s)return!0;s===pt.tokens.name&&(i=!0)}if(i){const s=pt.tokens.name.rule.exec(t.lexeme);if(s&&s.index==0&&s[0]==t.lexeme)return!0}return!1}if(t.type===e)return!0;if(e===pt.tokens.name){const n=pt.tokens.name.rule.exec(t.lexeme);return n&&n.index==0&&n[0]==t.lexeme}return!1}_advance(){var e,t;return this._currentLine=(t=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&t!==void 0?t:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(pt.tokens.semicolon)&&!this._isAtEnd(););if(this._match(pt.keywords.alias)){const t=this._type_alias();return this._consume(pt.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(pt.keywords.diagnostic)){const t=this._diagnostic();return this._consume(pt.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(pt.keywords.requires)){const t=this._requires_directive();return this._consume(pt.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(pt.keywords.enable)){const t=this._enable_directive();return this._consume(pt.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}const e=this._attribute();if(this._check(pt.keywords.var)){const t=this._global_variable_decl();return t!=null&&(t.attributes=e),this._consume(pt.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(pt.keywords.override)){const t=this._override_variable_decl();return t!=null&&(t.attributes=e),this._consume(pt.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(pt.keywords.let)){const t=this._global_let_decl();return t!=null&&(t.attributes=e),this._consume(pt.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(pt.keywords.const)){const t=this._global_const_decl();return t!=null&&(t.attributes=e),this._consume(pt.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(pt.keywords.struct)){const t=this._struct_decl();return t!=null&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}if(this._check(pt.keywords.fn)){const t=this._function_decl();return t!=null&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}return null}_function_decl(){if(!this._match(pt.keywords.fn))return null;const e=this._currentLine,t=this._consume(pt.tokens.ident,"Expected function name.").toString();this._consume(pt.tokens.paren_left,"Expected '(' for function arguments.");const n=[];if(!this._check(pt.tokens.paren_right))do{if(this._check(pt.tokens.paren_right))break;const o=this._attribute(),h=this._consume(pt.tokens.name,"Expected argument name.").toString();this._consume(pt.tokens.colon,"Expected ':' for argument type.");const f=this._attribute(),_=this._type_decl();_!=null&&(_.attributes=f,n.push(this._updateNode(new Pne(h,_,o))))}while(this._match(pt.tokens.comma));this._consume(pt.tokens.paren_right,"Expected ')' after function arguments.");let i=null;if(this._match(pt.tokens.arrow)){const o=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=o)}const s=this._compound_statement(),a=this._currentLine;return this._updateNode(new rw(t,n,i,s,e,a),e)}_compound_statement(){const e=[];for(this._consume(pt.tokens.brace_left,"Expected '{' for block.");!this._check(pt.tokens.brace_right);){const t=this._statement();t!==null&&e.push(t)}return this._consume(pt.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(pt.tokens.semicolon)&&!this._isAtEnd(););if(this._check(pt.tokens.attr)&&this._attribute(),this._check(pt.keywords.if))return this._if_statement();if(this._check(pt.keywords.switch))return this._switch_statement();if(this._check(pt.keywords.loop))return this._loop_statement();if(this._check(pt.keywords.for))return this._for_statement();if(this._check(pt.keywords.while))return this._while_statement();if(this._check(pt.keywords.continuing))return this._continuing_statement();if(this._check(pt.keywords.static_assert))return this._static_assert_statement();if(this._check(pt.tokens.brace_left))return this._compound_statement();let e=null;if(this._check(pt.keywords.return))e=this._return_statement();else if(this._check([pt.keywords.var,pt.keywords.let,pt.keywords.const]))e=this._variable_statement();else if(this._match(pt.keywords.discard))e=this._updateNode(new Ine);else if(this._match(pt.keywords.break)){const t=this._updateNode(new Qk);if(this._currentLoop.length>0){const n=this._currentLoop[this._currentLoop.length-1];t.loopId=n.id}e=t,this._check(pt.keywords.if)&&(this._advance(),t.condition=this._optional_paren_expression(),t.condition instanceof sw&&t.condition.contents.length===1&&(t.condition=t.condition.contents[0]))}else if(this._match(pt.keywords.continue)){const t=this._updateNode(new $k);if(!(this._currentLoop.length>0))throw this._error(this._peek(),`Continue statement must be inside a loop. Line: ${t.line}`);{const n=this._currentLoop[this._currentLoop.length-1];t.loopId=n.id}e=t}else e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return e!=null&&this._consume(pt.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(pt.keywords.static_assert))return null;const e=this._optional_paren_expression();return this._updateNode(new Ene(e))}_while_statement(){if(!this._match(pt.keywords.while))return null;const e=this._updateNode(new Dk(null,null));return this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(pt.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_continuing_statement(){if(!this._match(pt.keywords.continuing))return null;const e=this._compound_statement();return this._updateNode(new cI(e))}_for_statement(){if(!this._match(pt.keywords.for))return null;this._consume(pt.tokens.paren_left,"Expected '('.");const e=this._updateNode(new Ok(null,null,null,null));return this._currentLoop.push(e),e.init=this._check(pt.tokens.semicolon)?null:this._for_init(),this._consume(pt.tokens.semicolon,"Expected ';'."),e.condition=this._check(pt.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(pt.tokens.semicolon,"Expected ';'."),e.increment=this._check(pt.tokens.paren_right)?null:this._for_increment(),this._consume(pt.tokens.paren_right,"Expected ')'."),this._check(pt.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(pt.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let t=null;return this._match(pt.tokens.equal)&&(t=this._short_circuit_or_expression()),this._updateNode(new np(e.name,e.type,e.storage,e.access,t))}if(this._match(pt.keywords.let)){const e=this._consume(pt.tokens.name,"Expected name for let.").toString();let t=null;if(this._match(pt.tokens.colon)){const i=this._attribute();t=this._type_decl(),t!=null&&(t.attributes=i)}this._consume(pt.tokens.equal,"Expected '=' for let.");const n=this._short_circuit_or_expression();return this._updateNode(new nw(e,t,null,null,n))}if(this._match(pt.keywords.const)){const e=this._consume(pt.tokens.name,"Expected name for const.").toString();let t=null;if(this._match(pt.tokens.colon)){const i=this._attribute();t=this._type_decl(),t!=null&&(t.attributes=i)}this._consume(pt.tokens.equal,"Expected '=' for const.");const n=this._short_circuit_or_expression();return t===null&&n instanceof pa&&(t=n.type),this._updateNode(new hI(e,t,null,null,n))}return null}_increment_decrement_statement(){const e=this._current,t=this._unary_expression();if(t==null)return null;if(!this._check(pt.increment_operators))return this._current=e,null;const n=this._consume(pt.increment_operators,"Expected increment operator");return this._updateNode(new kk(n.type===pt.tokens.plus_plus?x_.increment:x_.decrement,t))}_assignment_statement(){let e=null;if(this._check(pt.tokens.brace_right))return null;let t=this._match(pt.tokens.underscore);if(t||(e=this._unary_expression()),!t&&e==null)return null;const n=this._consume(pt.assignment_operators,"Expected assignment operator."),i=this._short_circuit_or_expression();return this._updateNode(new Uk(d1.parse(n.lexeme),e,i))}_func_call_statement(){if(!this._check(pt.tokens.ident))return null;const e=this._current,t=this._consume(pt.tokens.ident,"Expected function name."),n=this._argument_expression_list();return n===null?(this._current=e,null):this._updateNode(new dI(t.lexeme,n))}_loop_statement(){if(!this._match(pt.keywords.loop))return null;this._check(pt.tokens.attr)&&this._attribute(),this._consume(pt.tokens.brace_left,"Expected '{' for loop.");const e=this._updateNode(new Nk([],null));this._currentLoop.push(e);let t=this._statement();for(;t!==null;){if(Array.isArray(t))for(let n of t)e.body.push(n);else e.body.push(t);if(t instanceof cI){e.continuing=t;break}t=this._statement()}return this._currentLoop.pop(),this._consume(pt.tokens.brace_right,"Expected '}' for loop."),e}_switch_statement(){if(!this._match(pt.keywords.switch))return null;const e=this._updateNode(new zk(null,[]));if(this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(pt.tokens.attr)&&this._attribute(),this._consume(pt.tokens.brace_left,"Expected '{' for switch."),e.cases=this._switch_body(),e.cases==null||e.cases.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(pt.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),e}_switch_body(){const e=[];let t=!1;for(;this._check([pt.keywords.default,pt.keywords.case]);){if(this._match(pt.keywords.case)){const n=this._case_selectors();for(const s of n)if(s instanceof ow){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");t=!0;break}this._match(pt.tokens.colon),this._check(pt.tokens.attr)&&this._attribute(),this._consume(pt.tokens.brace_left,"Exected '{' for switch case.");const i=this._case_body();this._consume(pt.tokens.brace_right,"Exected '}' for switch case."),e.push(this._updateNode(new Jk(n,i)))}if(this._match(pt.keywords.default)){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(pt.tokens.colon),this._check(pt.tokens.attr)&&this._attribute(),this._consume(pt.tokens.brace_left,"Exected '{' for switch default.");const n=this._case_body();this._consume(pt.tokens.brace_right,"Exected '}' for switch default."),e.push(this._updateNode(new Zk(n)))}}return e}_case_selectors(){const e=[];for(this._match(pt.keywords.default)?e.push(this._updateNode(new ow)):e.push(this._shift_expression());this._match(pt.tokens.comma);)this._match(pt.keywords.default)?e.push(this._updateNode(new ow)):e.push(this._shift_expression());return e}_case_body(){if(this._match(pt.keywords.fallthrough))return this._consume(pt.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const t=this._case_body();return t.length==0?e:[...e,t[0]]}_if_statement(){if(!this._match(pt.keywords.if))return null;const e=this._currentLine,t=this._optional_paren_expression();this._check(pt.tokens.attr)&&this._attribute();const n=this._compound_statement();let i=[];this._match_elseif()&&(this._check(pt.tokens.attr)&&this._attribute(),i=this._elseif_statement(i));let s=null;return this._match(pt.keywords.else)&&(this._check(pt.tokens.attr)&&this._attribute(),s=this._compound_statement()),this._updateNode(new Hk(t,n,i,s),e)}_match_elseif(){return this._tokens[this._current].type===pt.keywords.else&&this._tokens[this._current+1].type===pt.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const t=this._optional_paren_expression(),n=this._compound_statement();return e.push(this._updateNode(new Fne(t,n))),this._match_elseif()&&(this._check(pt.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(pt.keywords.return))return null;const e=this._short_circuit_or_expression();return this._updateNode(new Vk(e))}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(pt.tokens.or_or);)e=this._updateNode(new Od(this._previous().toString(),e,this._short_circuit_and_expr()));return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(pt.tokens.and_and);)e=this._updateNode(new Od(this._previous().toString(),e,this._inclusive_or_expression()));return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(pt.tokens.or);)e=this._updateNode(new Od(this._previous().toString(),e,this._exclusive_or_expression()));return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(pt.tokens.xor);)e=this._updateNode(new Od(this._previous().toString(),e,this._and_expression()));return e}_and_expression(){let e=this._equality_expression();for(;this._match(pt.tokens.and);)e=this._updateNode(new Od(this._previous().toString(),e,this._equality_expression()));return e}_equality_expression(){const e=this._relational_expression();return this._match([pt.tokens.equal_equal,pt.tokens.not_equal])?this._updateNode(new Od(this._previous().toString(),e,this._relational_expression())):e}_relational_expression(){let e=this._shift_expression();for(;this._match([pt.tokens.less_than,pt.tokens.greater_than,pt.tokens.less_than_equal,pt.tokens.greater_than_equal]);)e=this._updateNode(new Od(this._previous().toString(),e,this._shift_expression()));return e}_shift_expression(){let e=this._additive_expression();for(;this._match([pt.tokens.shift_left,pt.tokens.shift_right]);)e=this._updateNode(new Od(this._previous().toString(),e,this._additive_expression()));return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([pt.tokens.plus,pt.tokens.minus]);)e=this._updateNode(new Od(this._previous().toString(),e,this._multiplicative_expression()));return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([pt.tokens.star,pt.tokens.forward_slash,pt.tokens.modulo]);)e=this._updateNode(new Od(this._previous().toString(),e,this._unary_expression()));return e}_unary_expression(){return this._match([pt.tokens.minus,pt.tokens.bang,pt.tokens.tilde,pt.tokens.star,pt.tokens.and])?this._updateNode(new bh(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),t=this._postfix_expression();return t&&(e.postfix=t),e}_postfix_expression(){if(this._match(pt.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(pt.tokens.bracket_right,"Expected ']'.");const t=this._updateNode(new w_(e)),n=this._postfix_expression();return n&&(t.postfix=n),t}if(this._match(pt.tokens.period)){const e=this._consume(pt.tokens.name,"Expected member name."),t=this._postfix_expression(),n=this._updateNode(new Bg(e.lexeme));return t&&(n.postfix=t),n}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_getType(e){const t=this._getStruct(e);if(t!==null)return t;switch(e){case"bool":return dn.bool;case"i32":return dn.i32;case"u32":return dn.u32;case"f32":return dn.f32;case"f16":return dn.f16;case"vec2f":return Nr.vec2f;case"vec3f":return Nr.vec3f;case"vec4f":return Nr.vec4f;case"vec2i":return Nr.vec2i;case"vec3i":return Nr.vec3i;case"vec4i":return Nr.vec4i;case"vec2u":return Nr.vec2u;case"vec3u":return Nr.vec3u;case"vec4u":return Nr.vec4u;case"vec2h":return Nr.vec2h;case"vec3h":return Nr.vec3h;case"vec4h":return Nr.vec4h;case"mat2x2f":return Nr.mat2x2f;case"mat2x3f":return Nr.mat2x3f;case"mat2x4f":return Nr.mat2x4f;case"mat3x2f":return Nr.mat3x2f;case"mat3x3f":return Nr.mat3x3f;case"mat3x4f":return Nr.mat3x4f;case"mat4x2f":return Nr.mat4x2f;case"mat4x3f":return Nr.mat4x3f;case"mat4x4f":return Nr.mat4x4f;case"mat2x2h":return Nr.mat2x2h;case"mat2x3h":return Nr.mat2x3h;case"mat2x4h":return Nr.mat2x4h;case"mat3x2h":return Nr.mat3x2h;case"mat3x3h":return Nr.mat3x3h;case"mat3x4h":return Nr.mat3x4h;case"mat4x2h":return Nr.mat4x2h;case"mat4x3h":return Nr.mat4x3h;case"mat4x4h":return Nr.mat4x4h}return null}_validateTypeRange(e,t){if(t.name==="i32"){if(e<-2147483648||e>2147483647)throw this._error(this._previous(),`Value out of range for i32: ${e}. Line: ${this._currentLine}.`)}else if(t.name==="u32"&&(e<0||e>4294967295))throw this._error(this._previous(),`Value out of range for u32: ${e}. Line: ${this._currentLine}.`)}_primary_expression(){if(this._match(pt.tokens.ident)){const n=this._previous().toString();if(this._check(pt.tokens.paren_left)){const i=this._argument_expression_list(),s=this._getType(n);return s!==null?this._updateNode(new Cg(s,i)):this._updateNode(new iw(n,i))}if(this._context.constants.has(n)){const i=this._context.constants.get(n);return this._updateNode(new qk(n,i.value))}return this._updateNode(new sp(n))}if(this._match(pt.tokens.int_literal)){const n=this._previous().toString();let i=n.endsWith("i")||n.endsWith("i")?dn.i32:n.endsWith("u")||n.endsWith("U")?dn.u32:dn.x32;const s=parseInt(n);return this._validateTypeRange(s,i),this._updateNode(new pa(new hr(s,this._exec.getTypeInfo(i)),i))}if(this._match(pt.tokens.uint_literal)){const n=parseInt(this._previous().toString());return this._validateTypeRange(n,dn.u32),this._updateNode(new pa(new hr(n,this._exec.getTypeInfo(dn.u32)),dn.u32))}if(this._match([pt.tokens.decimal_float_literal,pt.tokens.hex_float_literal])){let n=this._previous().toString(),i=n.endsWith("h");i&&(n=n.substring(0,n.length-1));const s=parseFloat(n);this._validateTypeRange(s,i?dn.f16:dn.f32);const a=i?dn.f16:dn.f32;return this._updateNode(new pa(new hr(s,this._exec.getTypeInfo(a)),a))}if(this._match([pt.keywords.true,pt.keywords.false])){let n=this._previous().toString()===pt.keywords.true.rule;return this._updateNode(new pa(new hr(n?1:0,this._exec.getTypeInfo(dn.bool)),dn.bool))}if(this._check(pt.tokens.paren_left))return this._paren_expression();if(this._match(pt.keywords.bitcast)){this._consume(pt.tokens.less_than,"Expected '<'.");const n=this._type_decl();this._consume(pt.tokens.greater_than,"Expected '>'.");const i=this._paren_expression();return this._updateNode(new Kk(n,i))}const e=this._type_decl(),t=this._argument_expression_list();return this._updateNode(new Cg(e,t))}_argument_expression_list(){if(!this._match(pt.tokens.paren_left))return null;const e=[];do{if(this._check(pt.tokens.paren_right))break;const t=this._short_circuit_or_expression();e.push(t)}while(this._match(pt.tokens.comma));return this._consume(pt.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(pt.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(pt.tokens.paren_right),this._updateNode(new sw([e]))}_paren_expression(){this._consume(pt.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(pt.tokens.paren_right,"Expected ')'."),this._updateNode(new sw([e]))}_struct_decl(){if(!this._match(pt.keywords.struct))return null;const e=this._currentLine,t=this._consume(pt.tokens.ident,"Expected name for struct.").toString();this._consume(pt.tokens.brace_left,"Expected '{' for struct body.");const n=[];for(;!this._check(pt.tokens.brace_right);){const a=this._attribute(),o=this._consume(pt.tokens.name,"Expected variable name.").toString();this._consume(pt.tokens.colon,"Expected ':' for struct member type.");const h=this._attribute(),f=this._type_decl();f!=null&&(f.attributes=h),this._check(pt.tokens.brace_right)?this._match(pt.tokens.comma):this._consume(pt.tokens.comma,"Expected ',' for struct member."),n.push(this._updateNode(new Rne(o,f,a)))}this._consume(pt.tokens.brace_right,"Expected '}' after struct body.");const i=this._currentLine,s=this._updateNode(new ip(t,n,e,i),e);return this._context.structs.set(t,s),s}_global_variable_decl(){const e=this._variable_decl();if(!e)return null;if(this._match(pt.tokens.equal)){const t=this._const_expression(),n=[dn.f32];try{const i=t.constEvaluate(this._exec,n);e.value=new pa(i,n[0]),this._exec.context.setVariable(e.name,i)}catch{e.value=t}}else{const t=new Cg(e.type,null),n=this._exec.evalExpression(t,this._exec.context);n!==null&&(e.value=new pa(n,e.type),this._exec.context.setVariable(e.name,n))}if(e.type!==null&&e.value instanceof pa){if(e.value.type.name!=="x32"&&this._exec.getTypeName(e.type)!==this._exec.getTypeName(e.value.type))throw this._error(this._peek(),`Invalid cast from ${e.value.type.name} to ${e.type.name}. Line:${this._currentLine}`);e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type),e.value.type=e.type}else e.type===null&&e.value instanceof pa&&(e.type=e.value.type.name==="x32"?dn.i32:e.value.type,e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type));return e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(pt.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){var e;if(!this._match(pt.keywords.const))return null;const t=this._consume(pt.tokens.name,"Expected variable name");let n=null;if(this._match(pt.tokens.colon)){const o=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=o)}let i=null;this._consume(pt.tokens.equal,"const declarations require an assignment");const s=this._short_circuit_or_expression();try{let o=[dn.f32];const h=s.constEvaluate(this._exec,o);h instanceof hr&&this._validateTypeRange(h.value,o[0]),o[0]instanceof Nr&&o[0].format===null&&h.typeInfo instanceof tp&&h.typeInfo.format!==null&&(h.typeInfo.format.name==="f16"?o[0].format=dn.f16:h.typeInfo.format.name==="f32"?o[0].format=dn.f32:h.typeInfo.format.name==="i32"?o[0].format=dn.i32:h.typeInfo.format.name==="u32"?o[0].format=dn.u32:h.typeInfo.format.name==="bool"?o[0].format=dn.bool:console.error(`TODO: impelement template format type ${h.typeInfo.format.name}`)),i=this._updateNode(new pa(h,o[0])),this._exec.context.setVariable(t.toString(),h)}catch{i=s}if(n!==null&&i instanceof pa){if(i.type.name!=="x32"&&this._exec.getTypeName(n)!==this._exec.getTypeName(i.type))throw this._error(this._peek(),`Invalid cast from ${i.type.name} to ${n.name}. Line:${this._currentLine}`);i.type=n,i.isScalar&&this._validateTypeRange(i.scalarValue,i.type)}else n===null&&i instanceof pa&&(n=(e=i==null?void 0:i.type)!==null&&e!==void 0?e:dn.f32,n===dn.x32&&(n=dn.i32));const a=this._updateNode(new hI(t.toString(),n,"","",i));return this._context.constants.set(a.name,a),a}_global_let_decl(){if(!this._match(pt.keywords.let))return null;const e=this._consume(pt.tokens.name,"Expected variable name");let t=null;if(this._match(pt.tokens.colon)){const i=this._attribute();t=this._type_decl(),t!=null&&(t.attributes=i)}let n=null;if(this._match(pt.tokens.equal)){n=this._const_expression();const i=[dn.f32];try{const s=n.constEvaluate(this._exec,i);s!==null&&(n=new pa(s,i[0]))}catch{}}if(t!==null&&n instanceof pa){if(n.type.name!=="x32"&&this._exec.getTypeName(t)!==this._exec.getTypeName(n.type))throw this._error(this._peek(),`Invalid cast from ${n.type.name} to ${t.name}. Line:${this._currentLine}`);n.type=t}else t===null&&n instanceof pa&&(t=n.type.name==="x32"?dn.i32:n.type);return n instanceof pa&&n.isScalar&&this._validateTypeRange(n.scalarValue,t),this._updateNode(new nw(e.toString(),t,"","",n))}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(pt.keywords.var))return null;let e="",t="";this._match(pt.tokens.less_than)&&(e=this._consume(pt.storage_class,"Expected storage_class.").toString(),this._match(pt.tokens.comma)&&(t=this._consume(pt.access_mode,"Expected access_mode.").toString()),this._consume(pt.tokens.greater_than,"Expected '>'."));const n=this._consume(pt.tokens.name,"Expected variable name");let i=null;if(this._match(pt.tokens.colon)){const s=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=s)}return this._updateNode(new np(n.toString(),i,e,t,null))}_override_decl(){if(!this._match(pt.keywords.override))return null;const e=this._consume(pt.tokens.name,"Expected variable name");let t=null;if(this._match(pt.tokens.colon)){const n=this._attribute();t=this._type_decl(),t!=null&&(t.attributes=n)}return this._updateNode(new uI(e.toString(),t,null))}_diagnostic(){this._consume(pt.tokens.paren_left,"Expected '('");const e=this._consume(pt.tokens.ident,"Expected severity control name.");this._consume(pt.tokens.comma,"Expected ','");let t=this._consume(pt.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(pt.tokens.period)&&(t+=`.${this._consume(pt.tokens.ident,"Expected diagnostic message.").toString()}`),this._consume(pt.tokens.paren_right,"Expected ')'"),this._updateNode(new Gk(e.toString(),t))}_enable_directive(){const e=this._consume(pt.tokens.ident,"identity expected.");return this._updateNode(new Tne(e.toString()))}_requires_directive(){const e=[this._consume(pt.tokens.ident,"identity expected.").toString()];for(;this._match(pt.tokens.comma);){const t=this._consume(pt.tokens.ident,"identity expected.");e.push(t.toString())}return this._updateNode(new Sne(e))}_type_alias(){const e=this._consume(pt.tokens.ident,"identity expected.");this._consume(pt.tokens.equal,"Expected '=' for type alias.");let t=this._type_decl();if(t===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(t.name)&&(t=this._context.aliases.get(t.name).type);const n=this._updateNode(new fI(e.toString(),t));return this._context.aliases.set(n.name,n),n}_type_decl(){if(this._check([pt.tokens.ident,...pt.texel_format,pt.keywords.bool,pt.keywords.f32,pt.keywords.i32,pt.keywords.u32])){const n=this._advance(),i=n.toString();return this._context.structs.has(i)?this._context.structs.get(i):this._context.aliases.has(i)?this._context.aliases.get(i).type:this._updateNode(new dn(n.toString()))}let e=this._texture_sampler_types();if(e)return e;if(this._check(pt.template_types)){let n=this._advance().toString(),i=null,s=null;return this._match(pt.tokens.less_than)&&(i=this._type_decl(),s=null,this._match(pt.tokens.comma)&&(s=this._consume(pt.access_mode,"Expected access_mode for pointer").toString()),this._consume(pt.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new Nr(n,i,s))}if(this._match(pt.keywords.ptr)){let n=this._previous().toString();this._consume(pt.tokens.less_than,"Expected '<' for pointer.");const i=this._consume(pt.storage_class,"Expected storage_class for pointer");this._consume(pt.tokens.comma,"Expected ',' for pointer.");const s=this._type_decl();let a=null;return this._match(pt.tokens.comma)&&(a=this._consume(pt.access_mode,"Expected access_mode for pointer").toString()),this._consume(pt.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new Mne(n,i.toString(),s,a))}const t=this._attribute();if(this._match(pt.keywords.array)){let n=null,i=-1;const s=this._previous();let a=null;if(this._match(pt.tokens.less_than)){n=this._type_decl(),this._context.aliases.has(n.name)&&(n=this._context.aliases.get(n.name).type);let h="";if(this._match(pt.tokens.comma)){a=this._shift_expression();try{h=a.constEvaluate(this._exec).toString(),a=null}catch{h="1"}}this._consume(pt.tokens.greater_than,"Expected '>' for array."),i=h?parseInt(h):0}const o=this._updateNode(new jk(s.toString(),t,n,i));return a&&this._deferArrayCountEval.push({arrayType:o,countNode:a}),o}return null}_texture_sampler_types(){if(this._match(pt.sampler_type))return this._updateNode(new f1(this._previous().toString(),null,null));if(this._match(pt.depth_texture_type))return this._updateNode(new f1(this._previous().toString(),null,null));if(this._match(pt.sampled_texture_type)||this._match(pt.multisampled_texture_type)){const e=this._previous();this._consume(pt.tokens.less_than,"Expected '<' for sampler type.");const t=this._type_decl();return this._consume(pt.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new f1(e.toString(),t,null))}if(this._match(pt.storage_texture_type)){const e=this._previous();this._consume(pt.tokens.less_than,"Expected '<' for sampler type.");const t=this._consume(pt.texel_format,"Invalid texel format.").toString();this._consume(pt.tokens.comma,"Expected ',' after texel format.");const n=this._consume(pt.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(pt.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new f1(e.toString(),t,n))}return null}_attribute(){let e=[];for(;this._match(pt.tokens.attr);){const t=this._consume(pt.attribute_name,"Expected attribute name"),n=this._updateNode(new Lne(t.toString(),null));if(this._match(pt.tokens.paren_left)){if(n.value=this._consume(pt.literal_or_ident,"Expected attribute value").toString(),this._check(pt.tokens.comma)){this._advance();do{const i=this._consume(pt.literal_or_ident,"Expected attribute value").toString();n.value instanceof Array||(n.value=[n.value]),n.value.push(i)}while(this._match(pt.tokens.comma))}this._consume(pt.tokens.paren_right,"Expected ')'")}e.push(n)}return e.length==0?null:e}},Wne=class extends A1{constructor(e){super(),e&&this.update(e)}update(e){const t=new Kne().parse(e);this.updateAST(t)}};function Xne(r){var s;const e={attributes:[],bindings:[]};let t;try{t=Jne(r)}catch(a){return an.error(a.message)(),e}for(const a of t.uniforms){const o=[];for(const h of((s=a.type)==null?void 0:s.members)||[])o.push({name:h.name,type:rU(h.type)});e.bindings.push({type:"uniform",name:a.name,group:a.group,location:a.binding,members:o})}for(const a of t.textures)e.bindings.push({type:"texture",name:a.name,group:a.group,location:a.binding});for(const a of t.samplers)e.bindings.push({type:"sampler",name:a.name,group:a.group,location:a.binding});const n=t.entry.vertex[0],i=(n==null?void 0:n.inputs.length)||0;for(let a=0;a<i;a++){const o=n.inputs[a];if(o.locationType==="location"){const h=rU(o.type);e.attributes.push({name:o.name,location:Number(o.location),type:h})}}return e}function rU(r){return r.format?`${r.name}<${r.format.name}>`:r.name}function Jne(r){try{return new Wne(r)}catch(e){if(e instanceof Error)throw e;let t="WGSL parse error";throw typeof e=="object"&&(e!=null&&e.message)&&(t+=`: ${e.message} `),typeof e=="object"&&(e!=null&&e.token)&&(t+=e.token.line||""),new Error(t,{cause:e})}}function nU(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const n=Math.fround(r),i=r-n;return e[t]=n,e[t+1]=i,e}function Zne(r){return r-Math.fround(r)}function Yne(r){const e=new Float32Array(32);for(let t=0;t<4;++t)for(let n=0;n<4;++n){const i=t*4+n;nU(r[n*4+t],e,i*2)}return e}const eie={name:"fp32",vs:`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND

// All these functions are for substituting tan() function from Intel GPU only
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }

    // 2pi range reduction
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`},tie={name:"fp64arithmetic",vs:`
uniform fp64arithmeticUniforms {
  uniform float ONE;
} fp64;

/*
About LUMA_FP64_CODE_ELIMINATION_WORKAROUND

The purpose of this workaround is to prevent shader compilers from
optimizing away necessary arithmetic operations by swapping their sequences
or transform the equation to some 'equivalent' form.

The method is to multiply an artifical variable, ONE, which will be known to
the compiler to be 1 only at runtime. The whole expression is then represented
as a polynomial with respective to ONE. In the coefficients of all terms, only one a
and one b should appear

err = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE
*/

// Divide float number to high and low floats to extend fraction bits
vec2 split(float a) {
  const float SPLIT = 4097.0;
  float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float a_hi = t * fp64.ONE - (t - a);
  float a_lo = a * fp64.ONE - a_hi;
#else
  float a_hi = t - (t - a);
  float a_lo = a - a_hi;
#endif
  return vec2(a_hi, a_lo);
}

// Divide float number again when high float uses too many fraction bits
vec2 split2(vec2 a) {
  vec2 b = split(a.x);
  b.y += a.y;
  return b;
}

// Special sum operation when a > b
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float sum = (a + b) * fp64.ONE;
  float err = b - (sum - a) * fp64.ONE;
#else
  float sum = a + b;
  float err = b - (sum - a);
#endif
  return vec2(sum, err);
}

// General sum operation
vec2 twoSum(float a, float b) {
  float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);
#else
  float v = s - a;
  float err = (a - (s - v)) + (b - v);
#endif
  return vec2(s, err);
}

vec2 twoSub(float a, float b) {
  float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);
#else
  float v = s - a;
  float err = (a - (s - v)) - (b + v);
#endif
  return vec2(s, err);
}

vec2 twoSqr(float a) {
  float prod = a * a;
  vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *
    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;
#else
  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
  return vec2(prod, err);
}

vec2 twoProd(float a, float b) {
  float prod = a * b;
  vec2 a_fp64 = split(a);
  vec2 b_fp64 = split(b);
  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
  return vec2(prod, err);
}

vec2 sum_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSum(a.x, b.x);
  t = twoSum(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 sub_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSub(a.x, b.x);
  t = twoSub(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 mul_fp64(vec2 a, vec2 b) {
  vec2 prod = twoProd(a.x, b.x);
  // y component is for the error
  prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  return prod;
}

vec2 div_fp64(vec2 a, vec2 b) {
  float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
  vec2 yn = a * xn;
#endif
  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
  vec2 prod = twoProd(xn, diff);
  return sum_fp64(yn, prod);
}

vec2 sqrt_fp64(vec2 a) {
  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);

  float x = 1.0 / sqrt(a.x);
  float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;
#else
  vec2 yn_sqr = twoSqr(yn);
#endif
  float diff = sub_fp64(a, yn_sqr).x;
  vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  return sum_fp64(split(yn), prod);
#else
  return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,defaultUniforms:{ONE:1},uniformTypes:{ONE:"f32"},fp64ify:nU,fp64LowPart:Zne,fp64ifyMatrix4:Yne},iU={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:[0,1,1,1]},vs:`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

out vec4 picking_vRGBcolor_Avalid;

// Normalize unsigned byte color to 0-1 range
vec3 picking_normalizeColor(vec3 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

// Normalize unsigned byte color to 0-1 range
vec4 picking_normalizeColor(vec4 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

bool picking_isColorZero(vec3 color) {
  return dot(color, vec3(1.0)) < 0.00001;
}

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.00001;
}

// Check if this vertex is highlighted 
bool isVertexHighlighted(vec3 vertexColor) {
  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
  return
    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}

// Set the current picking color
void picking_setPickingColor(vec3 pickingColor) {
  pickingColor = picking_normalizeColor(pickingColor);

  if (bool(picking.isActive)) {
    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!bool(picking.isAttribute)) {
      // Stores the picking color so that the fragment shader can render it during picking
      picking_vRGBcolor_Avalid.rgb = pickingColor;
    }
  } else {
    // Do the comparison with selected item color in vertex shader as it should mean fewer compares
    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.r = value;
  }
}

void picking_setPickingAttribute(vec2 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}

void picking_setPickingAttribute(vec3 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,fs:`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

in vec4 picking_vRGBcolor_Avalid;

/*
 * Returns highlight color if this item is selected.
 */
vec4 picking_filterHighlightColor(vec4 color) {
  // If we are still picking, we don't highlight
  if (picking.isActive > 0.5) {
    return color;
  }

  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    // Blend in highlight color based on its alpha value
    float highLightAlpha = picking.highlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 picking_filterPickingColor(vec4 color) {
  if (bool(picking.isActive)) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 picking_filterColor(vec4 color) {
  vec4 highlightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highlightColor);
}
`,getUniforms:rie};function rie(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e={};if(r.highlightedObjectColor!==void 0)if(r.highlightedObjectColor===null)e.isHighlightActive=!1;else{e.isHighlightActive=!0;const t=r.highlightedObjectColor.slice(0,3);e.highlightedObjectColor=t}if(r.highlightColor){const t=Array.from(r.highlightColor,n=>n/255);Number.isFinite(t[3])||(t[3]=1),e.highlightColor=t}return r.isActive!==void 0&&(e.isActive=!!r.isActive,e.isAttribute=!!r.isAttribute),r.useFloatColors!==void 0&&(e.useFloatColors=!!r.useFloatColors),e}const sU=`precision highp int;

// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  vec3 color;
};

struct PointLight {
  vec3 color;
  vec3 position;
  vec3 attenuation; // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform lightingUniforms {
  int enabled;
  int lightType;

  int directionalLightCount;
  int pointLightCount;

  vec3 ambientColor;

  vec3 lightColor0;
  vec3 lightPosition0;
  vec3 lightDirection0;
  vec3 lightAttenuation0;

  vec3 lightColor1;
  vec3 lightPosition1;
  vec3 lightDirection1;
  vec3 lightAttenuation1;

  vec3 lightColor2;
  vec3 lightPosition2;
  vec3 lightDirection2;
  vec3 lightAttenuation2;
} lighting;

PointLight lighting_getPointLight(int index) {
  switch (index) {
    case 0:
      return PointLight(lighting.lightColor0, lighting.lightPosition0, lighting.lightAttenuation0);
    case 1:
      return PointLight(lighting.lightColor1, lighting.lightPosition1, lighting.lightAttenuation1);
    case 2:
    default:  
      return PointLight(lighting.lightColor2, lighting.lightPosition2, lighting.lightAttenuation2);
  }
}

DirectionalLight lighting_getDirectionalLight(int index) {
  switch (index) {
    case 0:
      return DirectionalLight(lighting.lightColor0, lighting.lightDirection0);
    case 1:
      return DirectionalLight(lighting.lightColor1, lighting.lightDirection1);
    case 2:
    default:   
      return DirectionalLight(lighting.lightColor2, lighting.lightDirection2);
  }
} 

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

// #endif
`,nie=`// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  color: vec3<f32>,
};

struct PointLight {
  color: vec3<f32>,
  position: vec3<f32>,
  attenuation: vec3<f32>, // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  color: vec3<f32>,
  direction: vec3<f32>,
};

struct lightingUniforms {
  enabled: i32,
  poightCount: i32,
  directionalLightCount: i32,

  ambientColor: vec3<f32>,

  // TODO - support multiple lights by uncommenting arrays below
  lightType: i32,
  lightColor: vec3<f32>,
  lightDirection: vec3<f32>,
  lightPosition: vec3<f32>,
  lightAttenuation: vec3<f32>,

  // AmbientLight ambientLight;
  // PointLight pointLight[MAX_LIGHTS];
  // DirectionalLight directionalLight[MAX_LIGHTS];
};

// Binding 0:1 is reserved for lighting (Note: could go into separate bind group as it is stable across draw calls)
@binding(1) @group(0) var<uniform> lighting : lightingUniforms;

fn lighting_getPointLight(index: i32) -> PointLight {
  return PointLight(lighting.lightColor, lighting.lightPosition, lighting.lightAttenuation);
}

fn lighting_getDirectionalLight(index: i32) -> DirectionalLight {
  return DirectionalLight(lighting.lightColor, lighting.lightDirection);
} 

fn getPointLightAttenuation(pointLight: PointLight, distance: f32) -> f32 {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}
`,oU=3,iie=255;var p1;(function(r){r[r.POINT=0]="POINT",r[r.DIRECTIONAL=1]="DIRECTIONAL"})(p1||(p1={}));const B_={props:{},uniforms:{},name:"lighting",defines:{MAX_LIGHTS:oU},uniformTypes:{enabled:"i32",lightType:"i32",directionalLightCount:"i32",pointLightCount:"i32",ambientLightColor:"vec3<f32>",lightColor0:"vec3<f32>",lightPosition0:"vec3<f32>",lightDirection0:"vec3<f32>",lightAttenuation0:"vec3<f32>",lightColor1:"vec3<f32>",lightPosition1:"vec3<f32>",lightDirection1:"vec3<f32>",lightAttenuation1:"vec3<f32>",lightColor2:"vec3<f32>",lightPosition2:"vec3<f32>",lightDirection2:"vec3<f32>",lightAttenuation2:"vec3<f32>"},defaultUniforms:{enabled:1,lightType:p1.POINT,directionalLightCount:0,pointLightCount:0,ambientLightColor:[.1,.1,.1],lightColor0:[1,1,1],lightPosition0:[1,1,2],lightDirection0:[1,1,1],lightAttenuation0:[1,0,0],lightColor1:[1,1,1],lightPosition1:[1,1,2],lightDirection1:[1,1,1],lightAttenuation1:[1,0,0],lightColor2:[1,1,1],lightPosition2:[1,1,2],lightDirection2:[1,1,1],lightAttenuation2:[1,0,0]},source:nie,vs:sU,fs:sU,getUniforms:sie};function sie(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(r=r&&{...r},!r)return{...B_.defaultUniforms};r.lights&&(r={...r,...aie(r.lights),lights:void 0});const{ambientLight:t,pointLights:n,directionalLights:i}=r||{};if(!(t||n&&n.length>0||i&&i.length>0))return{...B_.defaultUniforms,enabled:0};const a={...B_.defaultUniforms,...e,...oie({ambientLight:t,pointLights:n,directionalLights:i})};return r.enabled!==void 0&&(a.enabled=r.enabled?1:0),a}function oie(r){let{ambientLight:e,pointLights:t=[],directionalLights:n=[]}=r;const i={};i.ambientLightColor=pI(e);let s=0;for(const a of t){i.lightType=p1.POINT;const o=s;i[`lightColor${o}`]=pI(a),i[`lightPosition${o}`]=a.position,i[`lightAttenuation${o}`]=a.attenuation||[1,0,0],s++}for(const a of n){i.lightType=p1.DIRECTIONAL;const o=s;i[`lightColor${o}`]=pI(a),i[`lightDirection${o}`]=a.direction,s++}return s>oU&&an.warn("MAX_LIGHTS exceeded")(),i.directionalLightCount=n.length,i.pointLightCount=t.length,i}function aie(r){var t,n;const e={pointLights:[],directionalLights:[]};for(const i of r||[])switch(i.type){case"ambient":e.ambientLight=i;break;case"directional":(t=e.directionalLights)==null||t.push(i);break;case"point":(n=e.pointLights)==null||n.push(i);break}return e}function pI(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{color:e=[0,0,0],intensity:t=1}=r;return e.map(n=>n*t/iie)}const aU=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;
`,lU=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
  vec3 halfway_direction = normalize(light_direction + view_direction);
  float lambertian = dot(light_direction, normal_worldspace);
  float specular = 0.0;
  if (lambertian > 0.0) {
    float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, material.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  vec3 view_direction = normalize(cameraPosition - position_worldspace);
  lightColor = material.ambient * surfaceColor * lighting.ambientColor;

  for (int i = 0; i < lighting.pointLightCount; i++) {
    PointLight pointLight = lighting_getPointLight(i);
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    float light_attenuation = getPointLightAttenuation(pointLight, distance(light_position_worldspace, position_worldspace));
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color / light_attenuation);
  }

  int totalLights = min(MAX_LIGHTS, lighting.pointLightCount + lighting.directionalLightCount);
  for (int i = lighting.pointLightCount; i < totalLights; i++) {
    DirectionalLight directionalLight = lighting_getDirectionalLight(i);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
}
`,cU={props:{},name:"gouraudMaterial",vs:lU.replace("phongMaterial","gouraudMaterial"),fs:aU.replace("phongMaterial","gouraudMaterial"),defines:{LIGHTING_VERTEX:1},dependencies:[B_],uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(r){const e={...r};return e.specularColor&&(e.specularColor=e.specularColor.map(t=>t/255)),{...cU.defaultUniforms,...e}}},uU={name:"phongMaterial",dependencies:[B_],source:`struct phongMaterialUniforms {
  ambient: f32,
  diffuse: f32,
  shininess: f32,
  specularColor: vec3<f32>,
};

@binding(2) @group(0) var<uniform> material : phongMaterialUniforms;

fn lighting_getLightColor(surfaceColor: vec3<f32>, light_direction: vec3<f32>, view_direction: vec3<f32>, normal_worldspace: vec3<f32>, color: vec3<f32>) -> vec3<f32> {
  let halfway_direction: vec3<f32> = normalize(light_direction + view_direction);
  var lambertian: f32 = dot(light_direction, normal_worldspace);
  var specular: f32 = 0.0;
  if (lambertian > 0.0) {
    let specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, material.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;
}

fn lighting_getLightColor2(surfaceColor: vec3<f32>, cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32> {
  var lightColor: vec3<f32> = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  let view_direction: vec3<f32> = normalize(cameraPosition - position_worldspace);
  lightColor = material.ambient * surfaceColor * lighting.ambientColor;

  if (lighting.lightType == 0) {
    let pointLight: PointLight  = lighting_getPointLight(0);
    let light_position_worldspace: vec3<f32> = pointLight.position;
    let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  } else if (lighting.lightType == 1) {
    var directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
  /*
  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.pointLightCount) {
      break;
    }
    PointLight pointLight = lighting.pointLight[i];
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  }

  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.directionalLightCount) {
      break;
    }
    DirectionalLight directionalLight = lighting.directionalLight[i];
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  */
}

fn lighting_getSpecularLightColor(cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32>{
  var lightColor = vec3<f32>(0, 0, 0);
  let surfaceColor = vec3<f32>(0, 0, 0);

  if (lighting.enabled == 0) {
    let view_direction = normalize(cameraPosition - position_worldspace);

    switch (lighting.lightType) {
      case 0, default: {
        let pointLight: PointLight = lighting_getPointLight(0);
        let light_position_worldspace: vec3<f32> = pointLight.position;
        let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
        lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
      }
      case 1: {
        let directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
        lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
      }
    }
  }
  return lightColor;
}
`,vs:aU,fs:lU,defines:{LIGHTING_FRAGMENT:1},uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(r){const e={...r};return e.specularColor&&(e.specularColor=e.specularColor.map(t=>t/255)),{...uU.defaultUniforms,...e}}},lie=`out vec3 pbr_vPosition;
out vec2 pbr_vUV;

#ifdef HAS_NORMALS
# ifdef HAS_TANGENTS
out mat3 pbr_vTBN;
# else
out vec3 pbr_vNormal;
# endif
#endif

void pbr_setPositionNormalTangentUV(vec4 position, vec4 normal, vec4 tangent, vec2 uv)
{
  vec4 pos = pbrProjection.modelMatrix * position;
  pbr_vPosition = vec3(pos.xyz) / pos.w;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
  vec3 normalW = normalize(vec3(pbrProjection.normalMatrix * vec4(normal.xyz, 0.0)));
  vec3 tangentW = normalize(vec3(pbrProjection.modelMatrix * vec4(tangent.xyz, 0.0)));
  vec3 bitangentW = cross(normalW, tangentW) * tangent.w;
  pbr_vTBN = mat3(tangentW, bitangentW, normalW);
#else // HAS_TANGENTS != 1
  pbr_vNormal = normalize(vec3(pbrProjection.modelMatrix * vec4(normal.xyz, 0.0)));
#endif
#endif

#ifdef HAS_UV
  pbr_vUV = uv;
#else
  pbr_vUV = vec2(0.,0.);
#endif
}
`,cie=`precision highp float;

uniform pbrMaterialUniforms {
  // Material is unlit
  bool unlit;

  // Base color map
  bool baseColorMapEnabled;
  vec4 baseColorFactor;

  bool normalMapEnabled;  
  float normalScale; // #ifdef HAS_NORMALMAP

  bool emissiveMapEnabled;
  vec3 emissiveFactor; // #ifdef HAS_EMISSIVEMAP

  vec2 metallicRoughnessValues;
  bool metallicRoughnessMapEnabled;

  bool occlusionMapEnabled;
  float occlusionStrength; // #ifdef HAS_OCCLUSIONMAP
  
  bool alphaCutoffEnabled;
  float alphaCutoff; // #ifdef ALPHA_CUTOFF
  
  // IBL
  bool IBLenabled;
  vec2 scaleIBLAmbient; // #ifdef USE_IBL
  
  // debugging flags used for shader output of intermediate PBR variables
  // #ifdef PBR_DEBUG
  vec4 scaleDiffBaseMR;
  vec4 scaleFGDSpec;
  // #endif
} pbrMaterial;

// Samplers
#ifdef HAS_BASECOLORMAP
uniform sampler2D pbr_baseColorSampler;
#endif
#ifdef HAS_NORMALMAP
uniform sampler2D pbr_normalSampler;
#endif
#ifdef HAS_EMISSIVEMAP
uniform sampler2D pbr_emissiveSampler;
#endif
#ifdef HAS_METALROUGHNESSMAP
uniform sampler2D pbr_metallicRoughnessSampler;
#endif
#ifdef HAS_OCCLUSIONMAP
uniform sampler2D pbr_occlusionSampler;
#endif
#ifdef USE_IBL
uniform samplerCube pbr_diffuseEnvSampler;
uniform samplerCube pbr_specularEnvSampler;
uniform sampler2D pbr_brdfLUT;
#endif

// Inputs from vertex shader

in vec3 pbr_vPosition;
in vec2 pbr_vUV;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
in mat3 pbr_vTBN;
#else
in vec3 pbr_vNormal;
#endif
#endif

// Encapsulate the various inputs used by the various functions in the shading equation
// We store values in this struct to simplify the integration of alternative implementations
// of the shading terms, outlined in the Readme.MD Appendix.
struct PBRInfo {
  float NdotL;                  // cos angle between normal and light direction
  float NdotV;                  // cos angle between normal and view direction
  float NdotH;                  // cos angle between normal and half vector
  float LdotH;                  // cos angle between light direction and half vector
  float VdotH;                  // cos angle between view direction and half vector
  float perceptualRoughness;    // roughness value, as authored by the model creator (input to shader)
  float metalness;              // metallic value at the surface
  vec3 reflectance0;            // full reflectance color (normal incidence angle)
  vec3 reflectance90;           // reflectance color at grazing angle
  float alphaRoughness;         // roughness mapped to a more linear change in the roughness (proposed by [2])
  vec3 diffuseColor;            // color contribution from diffuse lighting
  vec3 specularColor;           // color contribution from specular lighting
  vec3 n;                       // normal at surface point
  vec3 v;                       // vector from surface point to camera
};

const float M_PI = 3.141592653589793;
const float c_MinRoughness = 0.04;

vec4 SRGBtoLINEAR(vec4 srgbIn)
{
#ifdef MANUAL_SRGB
#ifdef SRGB_FAST_APPROXIMATION
  vec3 linOut = pow(srgbIn.xyz,vec3(2.2));
#else // SRGB_FAST_APPROXIMATION
  vec3 bLess = step(vec3(0.04045),srgbIn.xyz);
  vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );
#endif //SRGB_FAST_APPROXIMATION
  return vec4(linOut,srgbIn.w);;
#else //MANUAL_SRGB
  return srgbIn;
#endif //MANUAL_SRGB
}

// Find the normal for this fragment, pulling either from a predefined normal map
// or from the interpolated mesh normal and tangent attributes.
vec3 getNormal()
{
  // Retrieve the tangent space matrix
#ifndef HAS_TANGENTS
  vec3 pos_dx = dFdx(pbr_vPosition);
  vec3 pos_dy = dFdy(pbr_vPosition);
  vec3 tex_dx = dFdx(vec3(pbr_vUV, 0.0));
  vec3 tex_dy = dFdy(vec3(pbr_vUV, 0.0));
  vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);

#ifdef HAS_NORMALS
  vec3 ng = normalize(pbr_vNormal);
#else
  vec3 ng = cross(pos_dx, pos_dy);
#endif

  t = normalize(t - ng * dot(ng, t));
  vec3 b = normalize(cross(ng, t));
  mat3 tbn = mat3(t, b, ng);
#else // HAS_TANGENTS
  mat3 tbn = pbr_vTBN;
#endif

#ifdef HAS_NORMALMAP
  vec3 n = texture(pbr_normalSampler, pbr_vUV).rgb;
  n = normalize(tbn * ((2.0 * n - 1.0) * vec3(pbrMaterial.normalScale, pbrMaterial.normalScale, 1.0)));
#else
  // The tbn matrix is linearly interpolated, so we need to re-normalize
  vec3 n = normalize(tbn[2].xyz);
#endif

  return n;
}

// Calculation of the lighting contribution from an optional Image Based Light source.
// Precomputed Environment Maps are required uniform inputs and are computed as outlined in [1].
// See our README.md on Environment Maps [3] for additional discussion.
#ifdef USE_IBL
vec3 getIBLContribution(PBRInfo pbrInfo, vec3 n, vec3 reflection)
{
  float mipCount = 9.0; // resolution of 512x512
  float lod = (pbrInfo.perceptualRoughness * mipCount);
  // retrieve a scale and bias to F0. See [1], Figure 3
  vec3 brdf = SRGBtoLINEAR(texture(pbr_brdfLUT,
    vec2(pbrInfo.NdotV, 1.0 - pbrInfo.perceptualRoughness))).rgb;
  vec3 diffuseLight = SRGBtoLINEAR(texture(pbr_diffuseEnvSampler, n)).rgb;

#ifdef USE_TEX_LOD
  vec3 specularLight = SRGBtoLINEAR(texture(pbr_specularEnvSampler, reflection, lod)).rgb;
#else
  vec3 specularLight = SRGBtoLINEAR(texture(pbr_specularEnvSampler, reflection)).rgb;
#endif

  vec3 diffuse = diffuseLight * pbrInfo.diffuseColor;
  vec3 specular = specularLight * (pbrInfo.specularColor * brdf.x + brdf.y);

  // For presentation, this allows us to disable IBL terms
  diffuse *= pbrMaterial.scaleIBLAmbient.x;
  specular *= pbrMaterial.scaleIBLAmbient.y;

  return diffuse + specular;
}
#endif

// Basic Lambertian diffuse
// Implementation from Lambert's Photometria https://archive.org/details/lambertsphotome00lambgoog
// See also [1], Equation 1
vec3 diffuse(PBRInfo pbrInfo)
{
  return pbrInfo.diffuseColor / M_PI;
}

// The following equation models the Fresnel reflectance term of the spec equation (aka F())
// Implementation of fresnel from [4], Equation 15
vec3 specularReflection(PBRInfo pbrInfo)
{
  return pbrInfo.reflectance0 +
    (pbrInfo.reflectance90 - pbrInfo.reflectance0) *
    pow(clamp(1.0 - pbrInfo.VdotH, 0.0, 1.0), 5.0);
}

// This calculates the specular geometric attenuation (aka G()),
// where rougher material will reflect less light back to the viewer.
// This implementation is based on [1] Equation 4, and we adopt their modifications to
// alphaRoughness as input as originally proposed in [2].
float geometricOcclusion(PBRInfo pbrInfo)
{
  float NdotL = pbrInfo.NdotL;
  float NdotV = pbrInfo.NdotV;
  float r = pbrInfo.alphaRoughness;

  float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));
  float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));
  return attenuationL * attenuationV;
}

// The following equation(s) model the distribution of microfacet normals across
// the area being drawn (aka D())
// Implementation from "Average Irregularity Representation of a Roughened Surface
// for Ray Reflection" by T. S. Trowbridge, and K. P. Reitz
// Follows the distribution function recommended in the SIGGRAPH 2013 course notes
// from EPIC Games [1], Equation 3.
float microfacetDistribution(PBRInfo pbrInfo)
{
  float roughnessSq = pbrInfo.alphaRoughness * pbrInfo.alphaRoughness;
  float f = (pbrInfo.NdotH * roughnessSq - pbrInfo.NdotH) * pbrInfo.NdotH + 1.0;
  return roughnessSq / (M_PI * f * f);
}

void PBRInfo_setAmbientLight(inout PBRInfo pbrInfo) {
  pbrInfo.NdotL = 1.0;
  pbrInfo.NdotH = 0.0;
  pbrInfo.LdotH = 0.0;
  pbrInfo.VdotH = 1.0;
}

void PBRInfo_setDirectionalLight(inout PBRInfo pbrInfo, vec3 lightDirection) {
  vec3 n = pbrInfo.n;
  vec3 v = pbrInfo.v;
  vec3 l = normalize(lightDirection);             // Vector from surface point to light
  vec3 h = normalize(l+v);                        // Half vector between both l and v

  pbrInfo.NdotL = clamp(dot(n, l), 0.001, 1.0);
  pbrInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
  pbrInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
  pbrInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
}

void PBRInfo_setPointLight(inout PBRInfo pbrInfo, PointLight pointLight) {
  vec3 light_direction = normalize(pointLight.position - pbr_vPosition);
  PBRInfo_setDirectionalLight(pbrInfo, light_direction);
}

vec3 calculateFinalColor(PBRInfo pbrInfo, vec3 lightColor) {
  // Calculate the shading terms for the microfacet specular shading model
  vec3 F = specularReflection(pbrInfo);
  float G = geometricOcclusion(pbrInfo);
  float D = microfacetDistribution(pbrInfo);

  // Calculation of analytical lighting contribution
  vec3 diffuseContrib = (1.0 - F) * diffuse(pbrInfo);
  vec3 specContrib = F * G * D / (4.0 * pbrInfo.NdotL * pbrInfo.NdotV);
  // Obtain final intensity as reflectance (BRDF) scaled by the energy of the light (cosine law)
  return pbrInfo.NdotL * lightColor * (diffuseContrib + specContrib);
}

vec4 pbr_filterColor(vec4 colorUnused)
{
  // The albedo may be defined from a base texture or a flat color
#ifdef HAS_BASECOLORMAP
  vec4 baseColor = SRGBtoLINEAR(texture(pbr_baseColorSampler, pbr_vUV)) * pbrMaterial.baseColorFactor;
#else
  vec4 baseColor = pbrMaterial.baseColorFactor;
#endif

#ifdef ALPHA_CUTOFF
  if (baseColor.a < pbrMaterial.alphaCutoff) {
    discard;
  }
#endif

  vec3 color = vec3(0, 0, 0);

  if(pbrMaterial.unlit){
    color.rgb = baseColor.rgb;
  }
  else{
    // Metallic and Roughness material properties are packed together
    // In glTF, these factors can be specified by fixed scalar values
    // or from a metallic-roughness map
    float perceptualRoughness = pbrMaterial.metallicRoughnessValues.y;
    float metallic = pbrMaterial.metallicRoughnessValues.x;
#ifdef HAS_METALROUGHNESSMAP
    // Roughness is stored in the 'g' channel, metallic is stored in the 'b' channel.
    // This layout intentionally reserves the 'r' channel for (optional) occlusion map data
    vec4 mrSample = texture(pbr_metallicRoughnessSampler, pbr_vUV);
    perceptualRoughness = mrSample.g * perceptualRoughness;
    metallic = mrSample.b * metallic;
#endif
    perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);
    metallic = clamp(metallic, 0.0, 1.0);
    // Roughness is authored as perceptual roughness; as is convention,
    // convert to material roughness by squaring the perceptual roughness [2].
    float alphaRoughness = perceptualRoughness * perceptualRoughness;

    vec3 f0 = vec3(0.04);
    vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);
    diffuseColor *= 1.0 - metallic;
    vec3 specularColor = mix(f0, baseColor.rgb, metallic);

    // Compute reflectance.
    float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);

    // For typical incident reflectance range (between 4% to 100%) set the grazing
    // reflectance to 100% for typical fresnel effect.
    // For very low reflectance range on highly diffuse objects (below 4%),
    // incrementally reduce grazing reflecance to 0%.
    float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);
    vec3 specularEnvironmentR0 = specularColor.rgb;
    vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;

    vec3 n = getNormal();                          // normal at surface point
    vec3 v = normalize(pbrProjection.camera - pbr_vPosition);  // Vector from surface point to camera

    float NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);
    vec3 reflection = -normalize(reflect(v, n));

    PBRInfo pbrInfo = PBRInfo(
      0.0, // NdotL
      NdotV,
      0.0, // NdotH
      0.0, // LdotH
      0.0, // VdotH
      perceptualRoughness,
      metallic,
      specularEnvironmentR0,
      specularEnvironmentR90,
      alphaRoughness,
      diffuseColor,
      specularColor,
      n,
      v
    );


#ifdef USE_LIGHTS
    // Apply ambient light
    PBRInfo_setAmbientLight(pbrInfo);
    color += calculateFinalColor(pbrInfo, lighting.ambientColor);

    // Apply directional light
    for(int i = 0; i < lighting.directionalLightCount; i++) {
      if (i < lighting.directionalLightCount) {
        PBRInfo_setDirectionalLight(pbrInfo, lighting_getDirectionalLight(i).direction);
        color += calculateFinalColor(pbrInfo, lighting_getDirectionalLight(i).color);
      }
    }

    // Apply point light
    for(int i = 0; i < lighting.pointLightCount; i++) {
      if (i < lighting.pointLightCount) {
        PBRInfo_setPointLight(pbrInfo, lighting_getPointLight(i));
        float attenuation = getPointLightAttenuation(lighting_getPointLight(i), distance(lighting_getPointLight(i).position, pbr_vPosition));
        color += calculateFinalColor(pbrInfo, lighting_getPointLight(i).color / attenuation);
      }
    }
#endif

    // Calculate lighting contribution from image based lighting source (IBL)
#ifdef USE_IBL
    if (pbrMaterial.IBLenabled) {
      color += getIBLContribution(pbrInfo, n, reflection);
    }
#endif

 // Apply optional PBR terms for additional (optional) shading
#ifdef HAS_OCCLUSIONMAP
    if (pbrMaterial.occlusionMapEnabled) {
      float ao = texture(pbr_occlusionSampler, pbr_vUV).r;
      color = mix(color, color * ao, pbrMaterial.occlusionStrength);
    }
#endif

#ifdef HAS_EMISSIVEMAP
    if (pbrMaterial.emissiveMapEnabled) {
      vec3 emissive = SRGBtoLINEAR(texture(pbr_emissiveSampler, pbr_vUV)).rgb * pbrMaterial.emissiveFactor;
      color += emissive;
    }
#endif

    // This section uses mix to override final color for reference app visualization
    // of various parameters in the lighting equation.
#ifdef PBR_DEBUG
    // TODO: Figure out how to debug multiple lights

    // color = mix(color, F, pbr_scaleFGDSpec.x);
    // color = mix(color, vec3(G), pbr_scaleFGDSpec.y);
    // color = mix(color, vec3(D), pbr_scaleFGDSpec.z);
    // color = mix(color, specContrib, pbr_scaleFGDSpec.w);

    // color = mix(color, diffuseContrib, pbr_scaleDiffBaseMR.x);
    color = mix(color, baseColor.rgb, pbrMaterial.scaleDiffBaseMR.y);
    color = mix(color, vec3(metallic), pbrMaterial.scaleDiffBaseMR.z);
    color = mix(color, vec3(perceptualRoughness), pbrMaterial.scaleDiffBaseMR.w);
#endif

  }

  return vec4(pow(color,vec3(1.0/2.2)), baseColor.a);
}
`,hU=`uniform pbrProjectionUniforms {
  mat4 modelViewProjectionMatrix;
  mat4 modelMatrix;
  mat4 normalMatrix;
  vec3 camera;
} pbrProjection;
`,gI={props:{},uniforms:{},name:"pbrMaterial",dependencies:[B_,{name:"pbrProjection",vs:hU,fs:hU,getUniforms:r=>r,uniformTypes:{modelViewProjectionMatrix:"mat4x4<f32>",modelMatrix:"mat4x4<f32>",normalMatrix:"mat4x4<f32>",camera:"vec3<i32>"}}],vs:lie,fs:cie,defines:{LIGHTING_FRAGMENT:1},getUniforms:r=>r,uniformTypes:{unlit:"i32",baseColorMapEnabled:"i32",baseColorFactor:"vec4<f32>",normalMapEnabled:"i32",normalScale:"f32",emissiveMapEnabled:"i32",emissiveFactor:"vec3<f32>",metallicRoughnessValues:"vec2<f32>",metallicRoughnessMapEnabled:"i32",occlusionMapEnabled:"i32",occlusionStrength:"f32",alphaCutoffEnabled:"i32",alphaCutoff:"f32",IBLenabled:"i32",scaleIBLAmbient:"vec2<f32>",scaleDiffBaseMR:"vec4<f32>",scaleFGDSpec:"vec4<f32>"}},dU=`uniform layerUniforms {
  uniform float opacity;
} layer;
`,uie={name:"layer",vs:dU,fs:dU,getUniforms:r=>({opacity:Math.pow(r.opacity,1/2.2)}),uniformTypes:{opacity:"f32"}},fU="#define SMOOTH_EDGE_RADIUS 0.5",hie=`
${fU}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,die=`
${fU}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,AU={name:"geometry",vs:hie,fs:die},fie=25;var sl;(function(r){r[r.Start=1]="Start",r[r.Move=2]="Move",r[r.End=4]="End",r[r.Cancel=8]="Cancel"})(sl||(sl={}));var Pl;(function(r){r[r.None=0]="None",r[r.Left=1]="Left",r[r.Right=2]="Right",r[r.Up=4]="Up",r[r.Down=8]="Down",r[r.Horizontal=3]="Horizontal",r[r.Vertical=12]="Vertical",r[r.All=15]="All"})(Pl||(Pl={}));var Mi;(function(r){r[r.Possible=1]="Possible",r[r.Began=2]="Began",r[r.Changed=4]="Changed",r[r.Ended=8]="Ended",r[r.Recognized=8]="Recognized",r[r.Cancelled=16]="Cancelled",r[r.Failed=32]="Failed"})(Mi||(Mi={}));const Aie="compute",pie="auto",mI="manipulation",dw="none",_I="pan-x",yI="pan-y";function gie(r){if(r.includes(dw))return dw;const e=r.includes(_I),t=r.includes(yI);return e&&t?dw:e||t?e?_I:yI:r.includes(mI)?mI:pie}class mie{constructor(e,t){this.actions="",this.manager=e,this.set(t)}set(e){e===Aie&&(e=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=e,this.actions=e)}update(){this.set(this.manager.options.touchAction)}compute(){let e=[];for(const t of this.manager.recognizers)t.options.enable&&(e=e.concat(t.getTouchAction()));return gie(e.join(" "))}}function fw(r){return r.trim().split(/\s+/g)}function bI(r,e,t){if(r)for(const n of fw(e))r.addEventListener(n,t,!1)}function vI(r,e,t){if(r)for(const n of fw(e))r.removeEventListener(n,t,!1)}function pU(r){return(r.ownerDocument||r).defaultView}function _ie(r,e){let t=r;for(;t;){if(t===e)return!0;t=t.parentNode}return!1}function gU(r){const e=r.length;if(e===1)return{x:Math.round(r[0].clientX),y:Math.round(r[0].clientY)};let t=0,n=0,i=0;for(;i<e;)t+=r[i].clientX,n+=r[i].clientY,i++;return{x:Math.round(t/e),y:Math.round(n/e)}}function mU(r){const e=[];let t=0;for(;t<r.pointers.length;)e[t]={clientX:Math.round(r.pointers[t].clientX),clientY:Math.round(r.pointers[t].clientY)},t++;return{timeStamp:Date.now(),pointers:e,center:gU(e),deltaX:r.deltaX,deltaY:r.deltaY}}function _U(r,e){const t=e.x-r.x,n=e.y-r.y;return Math.sqrt(t*t+n*n)}function yU(r,e){const t=e.clientX-r.clientX,n=e.clientY-r.clientY;return Math.sqrt(t*t+n*n)}function yie(r,e){const t=e.x-r.x,n=e.y-r.y;return Math.atan2(n,t)*180/Math.PI}function bU(r,e){const t=e.clientX-r.clientX,n=e.clientY-r.clientY;return Math.atan2(n,t)*180/Math.PI}function vU(r,e){return r===e?Pl.None:Math.abs(r)>=Math.abs(e)?r<0?Pl.Left:Pl.Right:e<0?Pl.Up:Pl.Down}function bie(r,e){const t=e.center;let n=r.offsetDelta,i=r.prevDelta;const s=r.prevInput;return(e.eventType===sl.Start||(s==null?void 0:s.eventType)===sl.End)&&(i=r.prevDelta={x:(s==null?void 0:s.deltaX)||0,y:(s==null?void 0:s.deltaY)||0},n=r.offsetDelta={x:t.x,y:t.y}),{deltaX:i.x+(t.x-n.x),deltaY:i.y+(t.y-n.y)}}function xU(r,e,t){return{x:e/r||0,y:t/r||0}}function vie(r,e){return yU(e[0],e[1])/yU(r[0],r[1])}function xie(r,e){return bU(e[1],e[0])-bU(r[1],r[0])}function wie(r,e){const t=r.lastInterval||e,n=e.timeStamp-t.timeStamp;let i,s,a,o;if(e.eventType!==sl.Cancel&&(n>fie||t.velocity===void 0)){const h=e.deltaX-t.deltaX,f=e.deltaY-t.deltaY,_=xU(n,h,f);s=_.x,a=_.y,i=Math.abs(_.x)>Math.abs(_.y)?_.x:_.y,o=vU(h,f),r.lastInterval=e}else i=t.velocity,s=t.velocityX,a=t.velocityY,o=t.direction;e.velocity=i,e.velocityX=s,e.velocityY=a,e.direction=o}function Bie(r,e){const{session:t}=r,{pointers:n}=e,{length:i}=n;t.firstInput||(t.firstInput=mU(e)),i>1&&!t.firstMultiple?t.firstMultiple=mU(e):i===1&&(t.firstMultiple=!1);const{firstInput:s,firstMultiple:a}=t,o=a?a.center:s.center,h=e.center=gU(n);e.timeStamp=Date.now(),e.deltaTime=e.timeStamp-s.timeStamp,e.angle=yie(o,h),e.distance=_U(o,h);const{deltaX:f,deltaY:_}=bie(t,e);e.deltaX=f,e.deltaY=_,e.offsetDirection=vU(e.deltaX,e.deltaY);const x=xU(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=x.x,e.overallVelocityY=x.y,e.overallVelocity=Math.abs(x.x)>Math.abs(x.y)?x.x:x.y,e.scale=a?vie(a.pointers,n):1,e.rotation=a?xie(a.pointers,n):0,e.maxPointers=t.prevInput?e.pointers.length>t.prevInput.maxPointers?e.pointers.length:t.prevInput.maxPointers:e.pointers.length;let T=r.element;return _ie(e.srcEvent.target,T)&&(T=e.srcEvent.target),e.target=T,wie(t,e),e}function Cie(r,e,t){const n=t.pointers.length,i=t.changedPointers.length,s=e&sl.Start&&n-i===0,a=e&(sl.End|sl.Cancel)&&n-i===0;t.isFirst=!!s,t.isFinal=!!a,s&&(r.session={}),t.eventType=e;const o=Bie(r,t);r.emit("hammer.input",o),r.recognize(o),r.session.prevInput=o}let Eie=class{constructor(e){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=t=>{this.manager.options.enable&&this.handler(t)},this.manager=e,this.element=e.element,this.target=e.options.inputTarget||e.element}callback(e,t){Cie(this.manager,e,t)}init(){bI(this.element,this.evEl,this.domHandler),bI(this.target,this.evTarget,this.domHandler),bI(pU(this.element),this.evWin,this.domHandler)}destroy(){vI(this.element,this.evEl,this.domHandler),vI(this.target,this.evTarget,this.domHandler),vI(pU(this.element),this.evWin,this.domHandler)}};const Tie={pointerdown:sl.Start,pointermove:sl.Move,pointerup:sl.End,pointercancel:sl.Cancel,pointerout:sl.Cancel},Sie="pointerdown",Iie="pointermove pointerup pointercancel";class Mie extends Eie{constructor(e){super(e),this.evEl=Sie,this.evWin=Iie,this.store=this.manager.session.pointerEvents=[],this.init()}handler(e){const{store:t}=this;let n=!1;const i=Tie[e.type],s=e.pointerType,a=s==="touch";let o=t.findIndex(h=>h.pointerId===e.pointerId);i&sl.Start&&(e.buttons||a)?o<0&&(t.push(e),o=t.length-1):i&(sl.End|sl.Cancel)&&(n=!0),!(o<0)&&(t[o]=e,this.callback(i,{pointers:t,changedPointers:[e],eventType:i,pointerType:s,srcEvent:e}),n&&t.splice(o,1))}}const Pie=["","webkit","Moz","MS","ms","o"];function Fie(r,e){const t=e[0].toUpperCase()+e.slice(1);for(const n of Pie){const i=n?n+t:e;if(i in r)return i}}const Rie=1,wU=2,BU={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}};class Lie{constructor(e,t){this.options={...BU,...t,cssProps:{...BU.cssProps,...t.cssProps},inputTarget:t.inputTarget||e},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new Mie(this),this.touchAction=new mie(this,this.options.touchAction),this.toggleCssProps(!0)}set(e){return Object.assign(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this}stop(e){this.session.stopped=e?wU:Rie}recognize(e){const{session:t}=this;if(t.stopped)return;this.session.prevented&&e.srcEvent.preventDefault();let n;const{recognizers:i}=this;let{curRecognizer:s}=t;(!s||s&&s.state&Mi.Recognized)&&(s=t.curRecognizer=null);let a=0;for(;a<i.length;)n=i[a],t.stopped!==wU&&(!s||n===s||n.canRecognizeWith(s))?n.recognize(e):n.reset(),!s&&n.state&(Mi.Began|Mi.Changed|Mi.Ended)&&(s=t.curRecognizer=n),a++}get(e){const{recognizers:t}=this;for(let n=0;n<t.length;n++)if(t[n].options.event===e)return t[n];return null}add(e){if(Array.isArray(e)){for(const n of e)this.add(n);return this}const t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e}remove(e){if(Array.isArray(e)){for(const n of e)this.remove(n);return this}const t=typeof e=="string"?this.get(e):e;if(t){const{recognizers:n}=this,i=n.indexOf(t);i!==-1&&(n.splice(i,1),this.touchAction.update())}return this}on(e,t){if(!e||!t)return;const{handlers:n}=this;for(const i of fw(e))n[i]=n[i]||[],n[i].push(t)}off(e,t){if(!e)return;const{handlers:n}=this;for(const i of fw(e))t?n[i]&&n[i].splice(n[i].indexOf(t),1):delete n[i]}emit(e,t){const n=this.handlers[e]&&this.handlers[e].slice();if(!n||!n.length)return;const i=t;i.type=e,i.preventDefault=function(){t.srcEvent.preventDefault()};let s=0;for(;s<n.length;)n[s](i),s++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(e){const{element:t}=this;if(t){for(const[n,i]of Object.entries(this.options.cssProps)){const s=Fie(t.style,n);e?(this.oldCssProps[s]=t.style[s],t.style[s]=i):t.style[s]=this.oldCssProps[s]||""}e||(this.oldCssProps={})}}}let Die=1;function Oie(){return Die++}function CU(r){return r&Mi.Cancelled?"cancel":r&Mi.Ended?"end":r&Mi.Changed?"move":r&Mi.Began?"start":""}class EU{constructor(e){this.options=e,this.id=Oie(),this.state=Mi.Possible,this.simultaneous={},this.requireFail=[]}set(e){return Object.assign(this.options,e),this.manager.touchAction.update(),this}recognizeWith(e){if(Array.isArray(e)){for(const i of e)this.recognizeWith(i);return this}let t;if(typeof e=="string"){if(t=this.manager.get(e),!t)throw new Error(`Cannot find recognizer ${e}`)}else t=e;const{simultaneous:n}=this;return n[t.id]||(n[t.id]=t,t.recognizeWith(this)),this}dropRecognizeWith(e){if(Array.isArray(e)){for(const n of e)this.dropRecognizeWith(n);return this}let t;return typeof e=="string"?t=this.manager.get(e):t=e,t&&delete this.simultaneous[t.id],this}requireFailure(e){if(Array.isArray(e)){for(const i of e)this.requireFailure(i);return this}let t;if(typeof e=="string"){if(t=this.manager.get(e),!t)throw new Error(`Cannot find recognizer ${e}`)}else t=e;const{requireFail:n}=this;return n.indexOf(t)===-1&&(n.push(t),t.requireFailure(this)),this}dropRequireFailure(e){if(Array.isArray(e)){for(const n of e)this.dropRequireFailure(n);return this}let t;if(typeof e=="string"?t=this.manager.get(e):t=e,t){const n=this.requireFail.indexOf(t);n>-1&&this.requireFail.splice(n,1)}return this}hasRequireFailures(){return!!this.requireFail.find(e=>e.options.enable)}canRecognizeWith(e){return!!this.simultaneous[e.id]}emit(e){if(!e)return;const{state:t}=this;t<Mi.Ended&&this.manager.emit(this.options.event+CU(t),e),this.manager.emit(this.options.event,e),e.additionalEvent&&this.manager.emit(e.additionalEvent,e),t>=Mi.Ended&&this.manager.emit(this.options.event+CU(t),e)}tryEmit(e){this.canEmit()?this.emit(e):this.state=Mi.Failed}canEmit(){let e=0;for(;e<this.requireFail.length;){if(!(this.requireFail[e].state&(Mi.Failed|Mi.Possible)))return!1;e++}return!0}recognize(e){const t={...e};if(!this.options.enable){this.reset(),this.state=Mi.Failed;return}this.state&(Mi.Recognized|Mi.Cancelled|Mi.Failed)&&(this.state=Mi.Possible),this.state=this.process(t),this.state&(Mi.Began|Mi.Changed|Mi.Ended|Mi.Cancelled)&&this.tryEmit(t)}getEventNames(){return[this.options.event]}reset(){}}class TU extends EU{attrTest(e){const t=this.options.pointers;return t===0||e.pointers.length===t}process(e){const{state:t}=this,{eventType:n}=e,i=t&(Mi.Began|Mi.Changed),s=this.attrTest(e);return i&&(n&sl.Cancel||!s)?t|Mi.Cancelled:i||s?n&sl.End?t|Mi.Ended:t&Mi.Began?t|Mi.Changed:Mi.Began:Mi.Failed}}class SU extends EU{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...e}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[mI]}process(e){const{options:t}=this,n=e.pointers.length===t.pointers,i=e.distance<t.threshold,s=e.deltaTime<t.time;if(this.reset(),e.eventType&sl.Start&&this.count===0)return this.failTimeout();if(i&&s&&n){if(e.eventType!==sl.End)return this.failTimeout();const a=this.pTime?e.timeStamp-this.pTime<t.interval:!0,o=!this.pCenter||_U(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,!o||!a?this.count=1:this.count+=1,this._input=e,this.count%t.taps===0)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=Mi.Recognized,this.tryEmit(this._input)},t.interval),Mi.Began):Mi.Recognized}return Mi.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=Mi.Failed},this.options.interval),Mi.Failed}reset(){clearTimeout(this._timer)}emit(e){this.state===Mi.Recognized&&(e.tapCount=this.count,this.manager.emit(this.options.event,e))}}const kie=["","start","move","end","cancel","up","down","left","right"];class IU extends TU{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super({enable:!0,pointers:1,event:"pan",threshold:10,direction:Pl.All,...e}),this.pX=null,this.pY=null}getTouchAction(){const{options:{direction:e}}=this,t=[];return e&Pl.Horizontal&&t.push(yI),e&Pl.Vertical&&t.push(_I),t}getEventNames(){return kie.map(e=>this.options.event+e)}directionTest(e){const{options:t}=this;let n=!0,{distance:i}=e,{direction:s}=e;const a=e.deltaX,o=e.deltaY;return s&t.direction||(t.direction&Pl.Horizontal?(s=a===0?Pl.None:a<0?Pl.Left:Pl.Right,n=a!==this.pX,i=Math.abs(e.deltaX)):(s=o===0?Pl.None:o<0?Pl.Up:Pl.Down,n=o!==this.pY,i=Math.abs(e.deltaY))),e.direction=s,n&&i>t.threshold&&!!(s&t.direction)}attrTest(e){return super.attrTest(e)&&(!!(this.state&Mi.Began)||!(this.state&Mi.Began)&&this.directionTest(e))}emit(e){this.pX=e.deltaX,this.pY=e.deltaY;const t=Pl[e.direction].toLowerCase();t&&(e.additionalEvent=this.options.event+t),super.emit(e)}}const Uie=["","start","move","end","cancel","in","out"];class Nie extends TU{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super({enable:!0,event:"pinch",threshold:0,pointers:2,...e})}getTouchAction(){return[dw]}getEventNames(){return Uie.map(e=>this.options.event+e)}attrTest(e){return super.attrTest(e)&&(Math.abs(e.scale-1)>this.options.threshold||!!(this.state&Mi.Began))}emit(e){if(e.scale!==1){const t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}super.emit(e)}}class Aw{constructor(e,t,n){this.element=e,this.callback=t,this.options=n}}const zie=(typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"").indexOf("firefox")!==-1,MU=4.000244140625,Hie=40,Vie=.25;class Gie extends Aw{constructor(e,t,n){super(e,t,{enable:!0,...n}),this.handleEvent=i=>{if(!this.options.enable)return;let s=i.deltaY;globalThis.WheelEvent&&(zie&&i.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(s/=globalThis.devicePixelRatio),i.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(s*=Hie)),s!==0&&s%MU===0&&(s=Math.floor(s/MU)),i.shiftKey&&s&&(s=s*Vie),this.callback({type:"wheel",center:{x:i.clientX,y:i.clientY},delta:-s,srcEvent:i,pointerType:"mouse",target:i.target})},e.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(e,t){e==="wheel"&&(this.options.enable=t)}}const PU=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"];class Qie extends Aw{constructor(e,t,n){super(e,t,{enable:!0,...n}),this.handleEvent=s=>{this.handleOverEvent(s),this.handleOutEvent(s),this.handleEnterEvent(s),this.handleLeaveEvent(s),this.handleMoveEvent(s)},this.pressed=!1;const{enable:i}=this.options;this.enableMoveEvent=i,this.enableLeaveEvent=i,this.enableEnterEvent=i,this.enableOutEvent=i,this.enableOverEvent=i,PU.forEach(s=>e.addEventListener(s,this.handleEvent))}destroy(){PU.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){switch(e){case"pointermove":this.enableMoveEvent=t;break;case"pointerover":this.enableOverEvent=t;break;case"pointerout":this.enableOutEvent=t;break;case"pointerenter":this.enableEnterEvent=t;break;case"pointerleave":this.enableLeaveEvent=t;break}}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit("pointerover",e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit("pointerout",e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit("pointerenter",e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit("pointerleave",e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit("pointermove",e);break;case"mouseup":this.pressed=!1;break}}_emit(e,t){this.callback({type:e,center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target})}}const FU=["keydown","keyup"];class $ie extends Aw{constructor(e,t,n){super(e,t,{enable:!0,tabIndex:0,...n}),this.handleEvent=i=>{const s=i.target||i.srcElement;s.tagName==="INPUT"&&s.type==="text"||s.tagName==="TEXTAREA"||(this.enableDownEvent&&i.type==="keydown"&&this.callback({type:"keydown",srcEvent:i,key:i.key,target:i.target}),this.enableUpEvent&&i.type==="keyup"&&this.callback({type:"keyup",srcEvent:i,key:i.key,target:i.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,e.tabIndex=this.options.tabIndex,e.style.outline="none",FU.forEach(i=>e.addEventListener(i,this.handleEvent))}destroy(){FU.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e==="keydown"&&(this.enableDownEvent=t),e==="keyup"&&(this.enableUpEvent=t)}}class jie extends Aw{constructor(e,t,n){super(e,t,n),this.handleEvent=i=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:i.clientX,y:i.clientY},srcEvent:i,pointerType:"mouse",target:i.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,t){e==="contextmenu"&&(this.options.enable=t)}}const RU=1,xI=2,LU=4,qie={pointerdown:RU,pointermove:xI,pointerup:LU,mousedown:RU,mousemove:xI,mouseup:LU},Kie=0,Wie=1,Xie=2,Jie=1,Zie=2,Yie=4;function ese(r){const e=qie[r.srcEvent.type];if(!e)return null;const{buttons:t,button:n}=r.srcEvent;let i=!1,s=!1,a=!1;return e===xI?(i=!!(t&Jie),s=!!(t&Yie),a=!!(t&Zie)):(i=n===Kie,s=n===Wie,a=n===Xie),{leftButton:i,middleButton:s,rightButton:a}}function tse(r,e){const t=r.center;if(!t)return null;const n=e.getBoundingClientRect(),i=n.width/e.offsetWidth||1,s=n.height/e.offsetHeight||1,a={x:(t.x-n.left-e.clientLeft)/i,y:(t.y-n.top-e.clientTop)/s};return{center:t,offsetCenter:a}}const rse={srcElement:"root",priority:0};class nse{constructor(e,t){this.handleEvent=n=>{if(this.isEmpty())return;const i=this._normalizeEvent(n);let s=n.srcEvent.target;for(;s&&s!==i.rootElement;){if(this._emit(i,s),i.handled)return;s=s.parentNode}this._emit(i,"root")},this.eventManager=e,this.recognizerName=t,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,t,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;const{handlers:a,handlersByElement:o}=this,h={...rse,...n};let f=o.get(h.srcElement);f||(f=[],o.set(h.srcElement,f));const _={type:e,handler:t,srcElement:h.srcElement,priority:h.priority};i&&(_.once=!0),s&&(_.passive=!0),a.push(_),this._active=this._active||!_.passive;let x=f.length-1;for(;x>=0&&!(f[x].priority>=_.priority);)x--;f.splice(x+1,0,_)}remove(e,t){const{handlers:n,handlersByElement:i}=this;for(let s=n.length-1;s>=0;s--){const a=n[s];if(a.type===e&&a.handler===t){n.splice(s,1);const o=i.get(a.srcElement);o.splice(o.indexOf(a),1),o.length===0&&i.delete(a.srcElement)}}this._active=n.some(s=>!s.passive)}_emit(e,t){const n=this.handlersByElement.get(t);if(n){let i=!1;const s=()=>{e.handled=!0},a=()=>{e.handled=!0,i=!0},o=[];for(let h=0;h<n.length;h++){const{type:f,handler:_,once:x}=n[h];if(_({...e,type:f,stopPropagation:s,stopImmediatePropagation:a}),x&&o.push(n[h]),i)break}for(let h=0;h<o.length;h++){const{type:f,handler:_}=o[h];this.remove(f,_)}}}_normalizeEvent(e){const t=this.eventManager.getElement();return{...e,...ese(e),...tse(e,t),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:t}}}function ise(r){if("recognizer"in r)return r;let e;const t=Array.isArray(r)?[...r]:[r];if(typeof t[0]=="function"){const n=t.shift(),i=t.shift()||{};e=new n(i)}else e=t.shift();return{recognizer:e,recognizeWith:typeof t[0]=="string"?[t[0]]:t[0],requireFailure:typeof t[1]=="string"?[t[1]]:t[1]}}class sse{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this._onBasicInput=n=>{this.manager.emit(n.srcEvent.type,n)},this._onOtherEvent=n=>{this.manager.emit(n.type,n)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...t},this.events=new Map,this.element=e,!!e){this.manager=new Lie(e,this.options);for(const n of this.options.recognizers){const{recognizer:i,recognizeWith:s,requireFailure:a}=ise(n);this.manager.add(i),s&&i.recognizeWith(s),a&&i.requireFailure(a)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new Gie(e,this._onOtherEvent,{enable:!1}),this.moveInput=new Qie(e,this._onOtherEvent,{enable:!1}),this.keyInput=new $ie(e,this._onOtherEvent,{enable:!1,tabIndex:t.tabIndex}),this.contextmenuInput=new jie(e,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(e,t,n){this._addEventHandler(e,t,n,!1)}once(e,t,n){this._addEventHandler(e,t,n,!0)}watch(e,t,n){this._addEventHandler(e,t,n,!1,!0)}off(e,t){this._removeEventHandler(e,t)}_toggleRecognizer(e,t){var s,a,o,h;const{manager:n}=this;if(!n)return;const i=n.get(e);i&&(i.set({enable:t}),n.touchAction.update()),(s=this.wheelInput)==null||s.enableEventType(e,t),(a=this.moveInput)==null||a.enableEventType(e,t),(o=this.keyInput)==null||o.enableEventType(e,t),(h=this.contextmenuInput)==null||h.enableEventType(e,t)}_addEventHandler(e,t,n,i,s){if(typeof e!="string"){n=t;for(const[f,_]of Object.entries(e))this._addEventHandler(f,_,n,i,s);return}const{manager:a,events:o}=this;if(!a)return;let h=o.get(e);if(!h){const f=this._getRecognizerName(e)||e;h=new nse(this,f),o.set(e,h),a&&a.on(e,h.handleEvent)}h.add(e,t,n,i,s),h.isEmpty()||this._toggleRecognizer(h.recognizerName,!0)}_removeEventHandler(e,t){if(typeof e!="string"){for(const[s,a]of Object.entries(e))this._removeEventHandler(s,a);return}const{events:n}=this,i=n.get(e);if(i&&(i.remove(e,t),i.isEmpty())){const{recognizerName:s}=i;let a=!1;for(const o of n.values())if(o.recognizerName===s&&!o.isEmpty()){a=!0;break}a||this._toggleRecognizer(s,!1)}}_getRecognizerName(e){var t;return(t=this.manager.recognizers.find(n=>n.getEventNames().includes(e)))==null?void 0:t.options.event}}const is={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(is,"IDENTITY",{get:()=>(Es.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const kd={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},wI={common:0,meters:1,pixels:2},BI={click:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},DU={multipan:[IU,{threshold:10,direction:Pl.Vertical,pointers:2}],pinch:[Nie,{},null,["multipan"]],pan:[IU,{threshold:1},["pinch"],["multipan"]],dblclick:[SU,{event:"dblclick",taps:2}],click:[SU,{event:"click"},null,["dblclick"]]},ose=Object.keys(is).map(r=>`const int COORDINATE_SYSTEM_${r} = ${is[r]};`).join(""),ase=Object.keys(kd).map(r=>`const int PROJECTION_MODE_${r} = ${kd[r]};`).join(""),lse=Object.keys(wI).map(r=>`const int UNIT_${r.toUpperCase()} = ${wI[r]};`).join(""),cse=`${ose}
${ase}
${lse}
uniform projectUniforms {
bool wrapLongitude;
int coordinateSystem;
vec3 commonUnitsPerMeter;
int projectionMode;
float scale;
vec3 commonUnitsPerWorldUnit;
vec3 commonUnitsPerWorldUnit2;
vec4 center;
mat4 modelMatrix;
mat4 viewProjectionMatrix;
vec2 viewportSize;
float devicePixelRatio;
float focalDistance;
vec3 cameraPosition;
vec3 coordinateOrigin;
vec3 commonOrigin;
bool pseudoMeters;
} project;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project.pseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project.commonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project.commonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project.commonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project.wrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project.modelMatrix * position;
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project.coordinateOrigin;
}
}
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project.commonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project.coordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
return offset * project.focalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project.scale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project.scale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project.scale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project.scale;
}
`,use={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...use}};const nd=globalThis.mathgl.config;function hse(r){let{precision:e=nd.precision}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return r=dse(r),`${parseFloat(r.toPrecision(e))}`}function C_(r){return Array.isArray(r)||ArrayBuffer.isView(r)&&!(r instanceof DataView)}function Uf(r,e,t){return Ase(r,n=>Math.max(e,Math.min(t,n)))}function pw(r,e,t){return C_(r)?r.map((n,i)=>pw(n,e[i],t)):t*e+(1-t)*r}function g1(r,e,t){const n=nd.EPSILON;try{if(r===e)return!0;if(C_(r)&&C_(e)){if(r.length!==e.length)return!1;for(let i=0;i<r.length;++i)if(!g1(r[i],e[i]))return!1;return!0}return r&&r.equals?r.equals(e):e&&e.equals?e.equals(r):typeof r=="number"&&typeof e=="number"?Math.abs(r-e)<=nd.EPSILON*Math.max(1,Math.abs(r),Math.abs(e)):!1}finally{nd.EPSILON=n}}function dse(r){return Math.round(r/nd.EPSILON)*nd.EPSILON}function fse(r){return r.clone?r.clone():new Array(r.length)}function Ase(r,e,t){if(C_(r)){const n=r;t=t||fse(n);for(let i=0;i<t.length&&i<n.length;++i){const s=typeof r=="number"?r:r[i];t[i]=e(s,i,t)}return t}return e(r)}let OU=class extends Array{clone(){return new this.constructor().copy(this)}fromArray(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;for(let n=0;n<this.ELEMENTS;++n)this[n]=e[n+t];return this.check()}toArray(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;for(let n=0;n<this.ELEMENTS;++n)e[t+n]=this[n];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:C_(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(nd)}formatString(e){let t="";for(let n=0;n<this.ELEMENTS;++n)t+=(n>0?", ":"")+hse(this[n],e);return`${e.printTypes?this.constructor.name:""}[${t}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(!g1(this[t],e[t]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(this[t]!==e[t])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,t,n){if(n===void 0)return this.lerp(this,e,t);for(let i=0;i<this.ELEMENTS;++i){const s=e[i],a=typeof t=="number"?t:t[i];this[i]=s+n*(a-s)}return this.check()}min(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}max(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}clamp(e,t){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e[n]),t[n]);return this.check()}add(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(const i of t)for(let s=0;s<this.ELEMENTS;++s)this[s]+=i[s];return this.check()}subtract(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(const i of t)for(let s=0;s<this.ELEMENTS;++s)this[s]-=i[s];return this.check()}scale(e){if(typeof e=="number")for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;else for(let t=0;t<this.ELEMENTS&&t<e.length;++t)this[t]*=e[t];return this.check()}multiplyByScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}check(){if(nd.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let t=0;t<this.ELEMENTS;++t)e=e&&Number.isFinite(this[t]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}addScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,t){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e),t);return this.check()}get elements(){return this}};function pse(r,e){if(r.length!==e)return!1;for(let t=0;t<r.length;++t)if(!Number.isFinite(r[t]))return!1;return!0}function vh(r){if(!Number.isFinite(r))throw new Error(`Invalid number ${JSON.stringify(r)}`);return r}function CI(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";if(nd.debug&&!pse(r,e))throw new Error(`math.gl: ${t} some fields set to invalid numbers'`);return r}function kU(r,e){if(!r)throw new Error(`math.gl assertion ${e}`)}let gse=class extends OU{get x(){return this[0]}set x(e){this[0]=vh(e)}get y(){return this[1]}set y(e){this[1]=vh(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let t=0;for(let n=0;n<this.ELEMENTS;++n){const i=this[n]-e[n];t+=i*i}return vh(t)}dot(e){let t=0;for(let n=0;n<this.ELEMENTS;++n)t+=this[n]*e[n];return vh(t)}normalize(){const e=this.magnitude();if(e!==0)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}multiply(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(const i of t)for(let s=0;s<this.ELEMENTS;++s)this[s]*=i[s];return this.check()}divide(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(const i of t)for(let s=0;s<this.ELEMENTS;++s)this[s]/=i[s];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return kU(e>=0&&e<this.ELEMENTS,"index is out of range"),vh(this[e])}setComponent(e,t){return kU(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=t,this.check()}addVectors(e,t){return this.copy(e).add(t)}subVectors(e,t){return this.copy(e).subtract(t)}multiplyVectors(e,t){return this.copy(e).multiply(t)}addScaledVector(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}};const gw=1e-6;let E_=typeof Float32Array<"u"?Float32Array:Array;function mse(){const r=new E_(2);return E_!=Float32Array&&(r[0]=0,r[1]=0),r}function UU(r,e,t){return r[0]=e[0]+t[0],r[1]=e[1]+t[1],r}function _se(r,e){return r[0]=-e[0],r[1]=-e[1],r}function NU(r,e,t,n){const i=e[0],s=e[1];return r[0]=i+n*(t[0]-i),r[1]=s+n*(t[1]-s),r}function yse(r,e,t){const n=e[0],i=e[1];return r[0]=t[0]*n+t[4]*i+t[12],r[1]=t[1]*n+t[5]*i+t[13],r}(function(){const r=mse();return function(e,t,n,i,s,a){let o,h;for(t||(t=2),n||(n=0),i?h=Math.min(i*t+n,e.length):h=e.length,o=n;o<h;o+=t)r[0]=e[o],r[1]=e[o+1],s(r,r,a),e[o]=r[0],e[o+1]=r[1];return e}})();function bse(r,e,t){const n=e[0],i=e[1],s=t[3]*n+t[7]*i||1;return r[0]=(t[0]*n+t[4]*i)/s,r[1]=(t[1]*n+t[5]*i)/s,r}function zU(r,e,t){const n=e[0],i=e[1],s=e[2],a=t[3]*n+t[7]*i+t[11]*s||1;return r[0]=(t[0]*n+t[4]*i+t[8]*s)/a,r[1]=(t[1]*n+t[5]*i+t[9]*s)/a,r[2]=(t[2]*n+t[6]*i+t[10]*s)/a,r}function vse(r,e,t){const n=e[0],i=e[1];return r[0]=t[0]*n+t[2]*i,r[1]=t[1]*n+t[3]*i,r[2]=e[2],r}function xse(){const r=new E_(3);return E_!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function wse(r){const e=r[0],t=r[1],n=r[2];return Math.sqrt(e*e+t*t+n*n)}function Bse(r,e,t){return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],r}function Cse(r){const e=r[0],t=r[1],n=r[2];return e*e+t*t+n*n}function Ese(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r}function Tse(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]}function Sse(r,e,t){const n=e[0],i=e[1],s=e[2],a=t[0],o=t[1],h=t[2];return r[0]=i*h-s*o,r[1]=s*a-n*h,r[2]=n*o-i*a,r}function Ise(r,e,t,n){const i=e[0],s=e[1],a=e[2];return r[0]=i+n*(t[0]-i),r[1]=s+n*(t[1]-s),r[2]=a+n*(t[2]-a),r}function HU(r,e,t){const n=e[0],i=e[1],s=e[2];let a=t[3]*n+t[7]*i+t[11]*s+t[15];return a=a||1,r[0]=(t[0]*n+t[4]*i+t[8]*s+t[12])/a,r[1]=(t[1]*n+t[5]*i+t[9]*s+t[13])/a,r[2]=(t[2]*n+t[6]*i+t[10]*s+t[14])/a,r}function Mse(r,e,t){const n=e[0],i=e[1],s=e[2];return r[0]=n*t[0]+i*t[3]+s*t[6],r[1]=n*t[1]+i*t[4]+s*t[7],r[2]=n*t[2]+i*t[5]+s*t[8],r}function Pse(r,e,t){const n=t[0],i=t[1],s=t[2],a=t[3],o=e[0],h=e[1],f=e[2];let _=i*f-s*h,x=s*o-n*f,T=n*h-i*o,I=i*T-s*x,N=s*_-n*T,$=n*x-i*_;const W=a*2;return _*=W,x*=W,T*=W,I*=2,N*=2,$*=2,r[0]=o+_+I,r[1]=h+x+N,r[2]=f+T+$,r}function Fse(r,e,t,n){const i=[],s=[];return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],s[0]=i[0],s[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),s[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),r[0]=s[0]+t[0],r[1]=s[1]+t[1],r[2]=s[2]+t[2],r}function Rse(r,e,t,n){const i=[],s=[];return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],s[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),s[1]=i[1],s[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),r[0]=s[0]+t[0],r[1]=s[1]+t[1],r[2]=s[2]+t[2],r}function Lse(r,e,t,n){const i=[],s=[];return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],s[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),s[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),s[2]=i[2],r[0]=s[0]+t[0],r[1]=s[1]+t[1],r[2]=s[2]+t[2],r}function Dse(r,e){const t=r[0],n=r[1],i=r[2],s=e[0],a=e[1],o=e[2],h=Math.sqrt((t*t+n*n+i*i)*(s*s+a*a+o*o)),f=h&&Tse(r,e)/h;return Math.acos(Math.min(Math.max(f,-1),1))}const VU=Bse,Ose=wse,EI=Cse;(function(){const r=xse();return function(e,t,n,i,s,a){let o,h;for(t||(t=3),n||(n=0),i?h=Math.min(i*t+n,e.length):h=e.length,o=n;o<h;o+=t)r[0]=e[o],r[1]=e[o+1],r[2]=e[o+2],s(r,r,a),e[o]=r[0],e[o+1]=r[1],e[o+2]=r[2];return e}})();const TI=[0,0,0];let mw,op=class FZ extends gse{static get ZERO(){return mw||(mw=new FZ(0,0,0),Object.freeze(mw)),mw}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;super(-0,-0,-0),arguments.length===1&&C_(e)?this.copy(e):(nd.debug&&(vh(e),vh(t),vh(n)),this[0]=e,this[1]=t,this[2]=n)}set(e,t,n){return this[0]=e,this[1]=t,this[2]=n,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return nd.debug&&(vh(e.x),vh(e.y),vh(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=vh(e)}angle(e){return Dse(this,e)}cross(e){return Sse(this,this,e),this.check()}rotateX(e){let{radians:t,origin:n=TI}=e;return Fse(this,this,n,t),this.check()}rotateY(e){let{radians:t,origin:n=TI}=e;return Rse(this,this,n,t),this.check()}rotateZ(e){let{radians:t,origin:n=TI}=e;return Lse(this,this,n,t),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return HU(this,this,e),this.check()}transformAsVector(e){return zU(this,this,e),this.check()}transformByMatrix3(e){return Mse(this,this,e),this.check()}transformByMatrix2(e){return vse(this,this,e),this.check()}transformByQuaternion(e){return Pse(this,this,e),this.check()}},kse=class extends OU{toString(){let e="[";if(nd.printRowMajor){e+="row-major:";for(let t=0;t<this.RANK;++t)for(let n=0;n<this.RANK;++n)e+=` ${this[n*this.RANK+t]}`}else{e+="column-major:";for(let t=0;t<this.ELEMENTS;++t)e+=` ${this[t]}`}return e+="]",e}getElementIndex(e,t){return t*this.RANK+e}getElement(e,t){return this[t*this.RANK+e]}setElement(e,t,n){return this[t*this.RANK+e]=vh(n),this}getColumn(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Array(this.RANK).fill(-0);const n=e*this.RANK;for(let i=0;i<this.RANK;++i)t[i]=this[n+i];return t}setColumn(e,t){const n=e*this.RANK;for(let i=0;i<this.RANK;++i)this[n+i]=t[i];return this}};function Use(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Nse(r,e){if(r===e){const t=e[1],n=e[2],i=e[3],s=e[6],a=e[7],o=e[11];r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=t,r[6]=e[9],r[7]=e[13],r[8]=n,r[9]=s,r[11]=e[14],r[12]=i,r[13]=a,r[14]=o}else r[0]=e[0],r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=e[1],r[5]=e[5],r[6]=e[9],r[7]=e[13],r[8]=e[2],r[9]=e[6],r[10]=e[10],r[11]=e[14],r[12]=e[3],r[13]=e[7],r[14]=e[11],r[15]=e[15];return r}function SI(r,e){const t=e[0],n=e[1],i=e[2],s=e[3],a=e[4],o=e[5],h=e[6],f=e[7],_=e[8],x=e[9],T=e[10],I=e[11],N=e[12],$=e[13],W=e[14],Y=e[15],ie=t*o-n*a,ce=t*h-i*a,fe=t*f-s*a,ve=n*h-i*o,be=n*f-s*o,Qe=i*f-s*h,Ue=_*$-x*N,st=_*W-T*N,at=_*Y-I*N,Le=x*W-T*$,ze=x*Y-I*$,tt=T*Y-I*W;let Ne=ie*tt-ce*ze+fe*Le+ve*at-be*st+Qe*Ue;return Ne?(Ne=1/Ne,r[0]=(o*tt-h*ze+f*Le)*Ne,r[1]=(i*ze-n*tt-s*Le)*Ne,r[2]=($*Qe-W*be+Y*ve)*Ne,r[3]=(T*be-x*Qe-I*ve)*Ne,r[4]=(h*at-a*tt-f*st)*Ne,r[5]=(t*tt-i*at+s*st)*Ne,r[6]=(W*fe-N*Qe-Y*ce)*Ne,r[7]=(_*Qe-T*fe+I*ce)*Ne,r[8]=(a*ze-o*at+f*Ue)*Ne,r[9]=(n*at-t*ze-s*Ue)*Ne,r[10]=(N*be-$*fe+Y*ie)*Ne,r[11]=(x*fe-_*be-I*ie)*Ne,r[12]=(o*st-a*Le-h*Ue)*Ne,r[13]=(t*Le-n*st+i*Ue)*Ne,r[14]=($*ce-N*ve-W*ie)*Ne,r[15]=(_*ve-x*ce+T*ie)*Ne,r):null}function zse(r){const e=r[0],t=r[1],n=r[2],i=r[3],s=r[4],a=r[5],o=r[6],h=r[7],f=r[8],_=r[9],x=r[10],T=r[11],I=r[12],N=r[13],$=r[14],W=r[15],Y=e*a-t*s,ie=e*o-n*s,ce=t*o-n*a,fe=f*N-_*I,ve=f*$-x*I,be=_*$-x*N,Qe=e*be-t*ve+n*fe,Ue=s*be-a*ve+o*fe,st=f*ce-_*ie+x*Y,at=I*ce-N*ie+$*Y;return h*Qe-i*Ue+W*st-T*at}function Tg(r,e,t){const n=e[0],i=e[1],s=e[2],a=e[3],o=e[4],h=e[5],f=e[6],_=e[7],x=e[8],T=e[9],I=e[10],N=e[11],$=e[12],W=e[13],Y=e[14],ie=e[15];let ce=t[0],fe=t[1],ve=t[2],be=t[3];return r[0]=ce*n+fe*o+ve*x+be*$,r[1]=ce*i+fe*h+ve*T+be*W,r[2]=ce*s+fe*f+ve*I+be*Y,r[3]=ce*a+fe*_+ve*N+be*ie,ce=t[4],fe=t[5],ve=t[6],be=t[7],r[4]=ce*n+fe*o+ve*x+be*$,r[5]=ce*i+fe*h+ve*T+be*W,r[6]=ce*s+fe*f+ve*I+be*Y,r[7]=ce*a+fe*_+ve*N+be*ie,ce=t[8],fe=t[9],ve=t[10],be=t[11],r[8]=ce*n+fe*o+ve*x+be*$,r[9]=ce*i+fe*h+ve*T+be*W,r[10]=ce*s+fe*f+ve*I+be*Y,r[11]=ce*a+fe*_+ve*N+be*ie,ce=t[12],fe=t[13],ve=t[14],be=t[15],r[12]=ce*n+fe*o+ve*x+be*$,r[13]=ce*i+fe*h+ve*T+be*W,r[14]=ce*s+fe*f+ve*I+be*Y,r[15]=ce*a+fe*_+ve*N+be*ie,r}function _w(r,e,t){const n=t[0],i=t[1],s=t[2];let a,o,h,f,_,x,T,I,N,$,W,Y;return e===r?(r[12]=e[0]*n+e[4]*i+e[8]*s+e[12],r[13]=e[1]*n+e[5]*i+e[9]*s+e[13],r[14]=e[2]*n+e[6]*i+e[10]*s+e[14],r[15]=e[3]*n+e[7]*i+e[11]*s+e[15]):(a=e[0],o=e[1],h=e[2],f=e[3],_=e[4],x=e[5],T=e[6],I=e[7],N=e[8],$=e[9],W=e[10],Y=e[11],r[0]=a,r[1]=o,r[2]=h,r[3]=f,r[4]=_,r[5]=x,r[6]=T,r[7]=I,r[8]=N,r[9]=$,r[10]=W,r[11]=Y,r[12]=a*n+_*i+N*s+e[12],r[13]=o*n+x*i+$*s+e[13],r[14]=h*n+T*i+W*s+e[14],r[15]=f*n+I*i+Y*s+e[15]),r}function II(r,e,t){const n=t[0],i=t[1],s=t[2];return r[0]=e[0]*n,r[1]=e[1]*n,r[2]=e[2]*n,r[3]=e[3]*n,r[4]=e[4]*i,r[5]=e[5]*i,r[6]=e[6]*i,r[7]=e[7]*i,r[8]=e[8]*s,r[9]=e[9]*s,r[10]=e[10]*s,r[11]=e[11]*s,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function Hse(r,e,t,n){let i=n[0],s=n[1],a=n[2],o=Math.sqrt(i*i+s*s+a*a),h,f,_,x,T,I,N,$,W,Y,ie,ce,fe,ve,be,Qe,Ue,st,at,Le,ze,tt,Ne,Ht;return o<gw?null:(o=1/o,i*=o,s*=o,a*=o,f=Math.sin(t),h=Math.cos(t),_=1-h,x=e[0],T=e[1],I=e[2],N=e[3],$=e[4],W=e[5],Y=e[6],ie=e[7],ce=e[8],fe=e[9],ve=e[10],be=e[11],Qe=i*i*_+h,Ue=s*i*_+a*f,st=a*i*_-s*f,at=i*s*_-a*f,Le=s*s*_+h,ze=a*s*_+i*f,tt=i*a*_+s*f,Ne=s*a*_-i*f,Ht=a*a*_+h,r[0]=x*Qe+$*Ue+ce*st,r[1]=T*Qe+W*Ue+fe*st,r[2]=I*Qe+Y*Ue+ve*st,r[3]=N*Qe+ie*Ue+be*st,r[4]=x*at+$*Le+ce*ze,r[5]=T*at+W*Le+fe*ze,r[6]=I*at+Y*Le+ve*ze,r[7]=N*at+ie*Le+be*ze,r[8]=x*tt+$*Ne+ce*Ht,r[9]=T*tt+W*Ne+fe*Ht,r[10]=I*tt+Y*Ne+ve*Ht,r[11]=N*tt+ie*Ne+be*Ht,e!==r&&(r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r)}function GU(r,e,t){const n=Math.sin(t),i=Math.cos(t),s=e[4],a=e[5],o=e[6],h=e[7],f=e[8],_=e[9],x=e[10],T=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=s*i+f*n,r[5]=a*i+_*n,r[6]=o*i+x*n,r[7]=h*i+T*n,r[8]=f*i-s*n,r[9]=_*i-a*n,r[10]=x*i-o*n,r[11]=T*i-h*n,r}function Vse(r,e,t){const n=Math.sin(t),i=Math.cos(t),s=e[0],a=e[1],o=e[2],h=e[3],f=e[8],_=e[9],x=e[10],T=e[11];return e!==r&&(r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=s*i-f*n,r[1]=a*i-_*n,r[2]=o*i-x*n,r[3]=h*i-T*n,r[8]=s*n+f*i,r[9]=a*n+_*i,r[10]=o*n+x*i,r[11]=h*n+T*i,r}function QU(r,e,t){const n=Math.sin(t),i=Math.cos(t),s=e[0],a=e[1],o=e[2],h=e[3],f=e[4],_=e[5],x=e[6],T=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=s*i+f*n,r[1]=a*i+_*n,r[2]=o*i+x*n,r[3]=h*i+T*n,r[4]=f*i-s*n,r[5]=_*i-a*n,r[6]=x*i-o*n,r[7]=T*i-h*n,r}function Gse(r,e){const t=e[0],n=e[1],i=e[2],s=e[3],a=t+t,o=n+n,h=i+i,f=t*a,_=n*a,x=n*o,T=i*a,I=i*o,N=i*h,$=s*a,W=s*o,Y=s*h;return r[0]=1-x-N,r[1]=_+Y,r[2]=T-W,r[3]=0,r[4]=_-Y,r[5]=1-f-N,r[6]=I+$,r[7]=0,r[8]=T+W,r[9]=I-$,r[10]=1-f-x,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Qse(r,e,t,n,i,s,a){const o=1/(t-e),h=1/(i-n),f=1/(s-a);return r[0]=s*2*o,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=s*2*h,r[6]=0,r[7]=0,r[8]=(t+e)*o,r[9]=(i+n)*h,r[10]=(a+s)*f,r[11]=-1,r[12]=0,r[13]=0,r[14]=a*s*2*f,r[15]=0,r}function $se(r,e,t,n,i){const s=1/Math.tan(e/2);if(r[0]=s/t,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=s,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,i!=null&&i!==1/0){const a=1/(n-i);r[10]=(i+n)*a,r[14]=2*i*n*a}else r[10]=-1,r[14]=-2*n;return r}const jse=$se;function qse(r,e,t,n,i,s,a){const o=1/(e-t),h=1/(n-i),f=1/(s-a);return r[0]=-2*o,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*h,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*f,r[11]=0,r[12]=(e+t)*o,r[13]=(i+n)*h,r[14]=(a+s)*f,r[15]=1,r}const Kse=qse;function Wse(r,e,t,n){let i,s,a,o,h,f,_,x,T,I;const N=e[0],$=e[1],W=e[2],Y=n[0],ie=n[1],ce=n[2],fe=t[0],ve=t[1],be=t[2];return Math.abs(N-fe)<gw&&Math.abs($-ve)<gw&&Math.abs(W-be)<gw?Use(r):(x=N-fe,T=$-ve,I=W-be,i=1/Math.sqrt(x*x+T*T+I*I),x*=i,T*=i,I*=i,s=ie*I-ce*T,a=ce*x-Y*I,o=Y*T-ie*x,i=Math.sqrt(s*s+a*a+o*o),i?(i=1/i,s*=i,a*=i,o*=i):(s=0,a=0,o=0),h=T*o-I*a,f=I*s-x*o,_=x*a-T*s,i=Math.sqrt(h*h+f*f+_*_),i?(i=1/i,h*=i,f*=i,_*=i):(h=0,f=0,_=0),r[0]=s,r[1]=h,r[2]=x,r[3]=0,r[4]=a,r[5]=f,r[6]=T,r[7]=0,r[8]=o,r[9]=_,r[10]=I,r[11]=0,r[12]=-(s*N+a*$+o*W),r[13]=-(h*N+f*$+_*W),r[14]=-(x*N+T*$+I*W),r[15]=1,r)}function Xse(){const r=new E_(4);return E_!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0,r[3]=0),r}function $U(r,e,t){return r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r[3]=e[3]*t,r}function T_(r,e,t){const n=e[0],i=e[1],s=e[2],a=e[3];return r[0]=t[0]*n+t[4]*i+t[8]*s+t[12]*a,r[1]=t[1]*n+t[5]*i+t[9]*s+t[13]*a,r[2]=t[2]*n+t[6]*i+t[10]*s+t[14]*a,r[3]=t[3]*n+t[7]*i+t[11]*s+t[15]*a,r}(function(){const r=Xse();return function(e,t,n,i,s,a){let o,h;for(t||(t=4),n||(n=0),i?h=Math.min(i*t+n,e.length):h=e.length,o=n;o<h;o+=t)r[0]=e[o],r[1]=e[o+1],r[2]=e[o+2],r[3]=e[o+3],s(r,r,a),e[o]=r[0],e[o+1]=r[1],e[o+2]=r[2],e[o+3]=r[3];return e}})();var MI;(function(r){r[r.COL0ROW0=0]="COL0ROW0",r[r.COL0ROW1=1]="COL0ROW1",r[r.COL0ROW2=2]="COL0ROW2",r[r.COL0ROW3=3]="COL0ROW3",r[r.COL1ROW0=4]="COL1ROW0",r[r.COL1ROW1=5]="COL1ROW1",r[r.COL1ROW2=6]="COL1ROW2",r[r.COL1ROW3=7]="COL1ROW3",r[r.COL2ROW0=8]="COL2ROW0",r[r.COL2ROW1=9]="COL2ROW1",r[r.COL2ROW2=10]="COL2ROW2",r[r.COL2ROW3=11]="COL2ROW3",r[r.COL3ROW0=12]="COL3ROW0",r[r.COL3ROW1=13]="COL3ROW1",r[r.COL3ROW2=14]="COL3ROW2",r[r.COL3ROW3=15]="COL3ROW3"})(MI||(MI={}));const Jse=45*Math.PI/180,Zse=1,PI=.1,FI=500,Yse=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);let Ud=class extends kse{static get IDENTITY(){return toe()}static get ZERO(){return eoe()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return MI}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,t,n,i,s,a,o,h,f,_,x,T,I,N,$,W){return this[0]=e,this[1]=t,this[2]=n,this[3]=i,this[4]=s,this[5]=a,this[6]=o,this[7]=h,this[8]=f,this[9]=_,this[10]=x,this[11]=T,this[12]=I,this[13]=N,this[14]=$,this[15]=W,this.check()}setRowMajor(e,t,n,i,s,a,o,h,f,_,x,T,I,N,$,W){return this[0]=e,this[1]=s,this[2]=f,this[3]=I,this[4]=t,this[5]=a,this[6]=_,this[7]=N,this[8]=n,this[9]=o,this[10]=x,this[11]=$,this[12]=i,this[13]=h,this[14]=T,this[15]=W,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(Yse)}fromObject(e){return this.check()}fromQuaternion(e){return Gse(this,e),this.check()}frustum(e){const{left:t,right:n,bottom:i,top:s,near:a=PI,far:o=FI}=e;return o===1/0?roe(this,t,n,i,s,a):Qse(this,t,n,i,s,a,o),this.check()}lookAt(e){const{eye:t,center:n=[0,0,0],up:i=[0,1,0]}=e;return Wse(this,t,n,i),this.check()}ortho(e){const{left:t,right:n,bottom:i,top:s,near:a=PI,far:o=FI}=e;return Kse(this,t,n,i,s,a,o),this.check()}orthographic(e){const{fovy:t=Jse,aspect:n=Zse,focalDistance:i=1,near:s=PI,far:a=FI}=e;jU(t);const o=t/2,h=i*Math.tan(o),f=h*n;return this.ortho({left:-f,right:f,bottom:-h,top:h,near:s,far:a})}perspective(e){const{fovy:t=45*Math.PI/180,aspect:n=1,near:i=.1,far:s=500}=e;return jU(t),jse(this,t,n,i,s),this.check()}determinant(){return zse(this)}getScale(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[-0,-0,-0];return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[-0,-0,-0];return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const n=this.getScale(t),i=1/n[0],s=1/n[1],a=1/n[2];return e[0]=this[0]*i,e[1]=this[1]*s,e[2]=this[2]*a,e[3]=0,e[4]=this[4]*i,e[5]=this[5]*s,e[6]=this[6]*a,e[7]=0,e[8]=this[8]*i,e[9]=this[9]*s,e[10]=this[10]*a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const n=this.getScale(t),i=1/n[0],s=1/n[1],a=1/n[2];return e[0]=this[0]*i,e[1]=this[1]*s,e[2]=this[2]*a,e[3]=this[4]*i,e[4]=this[5]*s,e[5]=this[6]*a,e[6]=this[8]*i,e[7]=this[9]*s,e[8]=this[10]*a,e}transpose(){return Nse(this,this),this.check()}invert(){return SI(this,this),this.check()}multiplyLeft(e){return Tg(this,e,this),this.check()}multiplyRight(e){return Tg(this,this,e),this.check()}rotateX(e){return GU(this,this,e),this.check()}rotateY(e){return Vse(this,this,e),this.check()}rotateZ(e){return QU(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,t){return Hse(this,this,e,t),this.check()}scale(e){return II(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return _w(this,this,e),this.check()}transform(e,t){return e.length===4?(t=T_(t||[-0,-0,-0,-0],e,this),CI(t,4),t):this.transformAsPoint(e,t)}transformAsPoint(e,t){const{length:n}=e;let i;switch(n){case 2:i=yse(t||[-0,-0],e,this);break;case 3:i=HU(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return CI(i,e.length),i}transformAsVector(e,t){let n;switch(e.length){case 2:n=bse(t||[-0,-0],e,this);break;case 3:n=zU(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return CI(n,e.length),n}transformPoint(e,t){return this.transformAsPoint(e,t)}transformVector(e,t){return this.transformAsPoint(e,t)}transformDirection(e,t){return this.transformAsVector(e,t)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,t,n){return this.identity().translate([e,t,n])}},yw,bw;function eoe(){return yw||(yw=new Ud([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(yw)),yw}function toe(){return bw||(bw=new Ud,Object.freeze(bw)),bw}function jU(r){if(r>Math.PI*2)throw Error("expected radians")}function roe(r,e,t,n,i,s){const a=2*s/(t-e),o=2*s/(i-n),h=(t+e)/(t-e),f=(i+n)/(i-n),_=-1,x=-1,T=-2*s;return r[0]=a,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=o,r[6]=0,r[7]=0,r[8]=h,r[9]=f,r[10]=_,r[11]=x,r[12]=0,r[13]=0,r[14]=T,r[15]=0,r}function noe(r,e){if(r===e)return!0;if(Array.isArray(r)){const t=r.length;if(!e||e.length!==t)return!1;for(let n=0;n<t;n++)if(r[n]!==e[n])return!1;return!0}return!1}function m1(r){let e={},t;return n=>{for(const i in n)if(!noe(n[i],e[i])){t=r(n),e=n;break}return t}}const qU=[0,0,0,0],ioe=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],KU=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],soe=[0,0,0],WU=[0,0,0],ooe=m1(coe);function XU(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:WU;t.length<3&&(t=[t[0],t[1],0]);let n=t,i,s=!0;switch(e===is.LNGLAT_OFFSETS||e===is.METER_OFFSETS?i=t:i=r.isGeospatial?[Math.fround(r.longitude),Math.fround(r.latitude),0]:null,r.projectionMode){case kd.WEB_MERCATOR:(e===is.LNGLAT||e===is.CARTESIAN)&&(i=[0,0,0],s=!1);break;case kd.WEB_MERCATOR_AUTO_OFFSET:e===is.LNGLAT?n=i:e===is.CARTESIAN&&(n=[Math.fround(r.center[0]),Math.fround(r.center[1]),0],i=r.unprojectPosition(n),n[0]-=t[0],n[1]-=t[1],n[2]-=t[2]);break;case kd.IDENTITY:n=r.position.map(Math.fround),n[2]=n[2]||0;break;case kd.GLOBE:s=!1,i=null;break;default:s=!1}return{geospatialOrigin:i,shaderCoordinateOrigin:n,offsetMode:s}}function aoe(r,e,t){const{viewMatrixUncentered:n,projectionMatrix:i}=r;let{viewMatrix:s,viewProjectionMatrix:a}=r,o=qU,h=qU,f=r.cameraPosition;const{geospatialOrigin:_,shaderCoordinateOrigin:x,offsetMode:T}=XU(r,e,t);return T&&(h=r.projectPosition(_||x),f=[f[0]-h[0],f[1]-h[1],f[2]-h[2]],h[3]=1,o=T_([],h,a),s=n||s,a=Tg([],i,s),a=Tg([],a,ioe)),{viewMatrix:s,viewProjectionMatrix:a,projectionCenter:o,originCommon:h,cameraPosCommon:f,shaderCoordinateOrigin:x,geospatialOrigin:_}}function loe(r){let{viewport:e,devicePixelRatio:t=1,modelMatrix:n=null,coordinateSystem:i=is.DEFAULT,coordinateOrigin:s=WU,autoWrapLongitude:a=!1}=r;i===is.DEFAULT&&(i=e.isGeospatial?is.LNGLAT:is.CARTESIAN);const o=ooe({viewport:e,devicePixelRatio:t,coordinateSystem:i,coordinateOrigin:s});return o.wrapLongitude=a,o.modelMatrix=n||KU,o}function coe(r){let{viewport:e,devicePixelRatio:t,coordinateSystem:n,coordinateOrigin:i}=r;const{projectionCenter:s,viewProjectionMatrix:a,originCommon:o,cameraPosCommon:h,shaderCoordinateOrigin:f,geospatialOrigin:_}=aoe(e,n,i),x=e.getDistanceScales(),T=[e.width*t,e.height*t],I=T_([],[0,0,-e.focalDistance,1],e.projectionMatrix)[3]||1,N={coordinateSystem:n,projectionMode:e.projectionMode,coordinateOrigin:f,commonOrigin:o.slice(0,3),center:s,pseudoMeters:!!e._pseudoMeters,viewportSize:T,devicePixelRatio:t,focalDistance:I,commonUnitsPerMeter:x.unitsPerMeter,commonUnitsPerWorldUnit:x.unitsPerMeter,commonUnitsPerWorldUnit2:soe,scale:e.scale,wrapLongitude:!1,viewProjectionMatrix:a,modelMatrix:KU,cameraPosition:h};if(_){const $=e.getDistanceScales(_);switch(n){case is.METER_OFFSETS:N.commonUnitsPerWorldUnit=$.unitsPerMeter,N.commonUnitsPerWorldUnit2=$.unitsPerMeter2;break;case is.LNGLAT:case is.LNGLAT_OFFSETS:e._pseudoMeters||(N.commonUnitsPerMeter=$.unitsPerMeter),N.commonUnitsPerWorldUnit=$.unitsPerDegree,N.commonUnitsPerWorldUnit2=$.unitsPerDegree2;break;case is.CARTESIAN:N.commonUnitsPerWorldUnit=[1,1,$.unitsPerMeter[2]],N.commonUnitsPerWorldUnit2=[0,0,$.unitsPerMeter2[2]];break}}return N}const uoe={};function hoe(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:uoe;return"viewport"in r?loe(r):{}}const RI={name:"project",dependencies:[eie,AU],vs:cse,getUniforms:hoe,uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}},LI={name:"project32",dependencies:[RI],vs:`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`};function doe(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function S_(r,e){const t=T_([],e,r);return $U(t,t,1/t[3]),t}function JU(r,e){const t=r%e;return t<0?e+t:t}function DI(r,e,t){return r<e?e:r>t?t:r}function foe(r){return Math.log(r)*Math.LOG2E}const OI=Math.log2||foe;function pA(r,e){if(!r)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const Nd=Math.PI,ZU=Nd/4,id=Nd/180,kI=180/Nd,I_=512,vw=4003e4,ap=85.051129,Aoe=1.5;function poe(r){return OI(r)}function xw(r){const[e,t]=r;pA(Number.isFinite(e)),pA(Number.isFinite(t)&&t>=-90&&t<=90,"invalid latitude");const n=e*id,i=t*id,s=I_*(n+Nd)/(2*Nd),a=I_*(Nd+Math.log(Math.tan(ZU+i*.5)))/(2*Nd);return[s,a]}function M_(r){const[e,t]=r,n=e/I_*(2*Nd)-Nd,i=2*(Math.atan(Math.exp(t/I_*(2*Nd)-Nd))-ZU);return[n*kI,i*kI]}function goe(r){const{latitude:e}=r;pA(Number.isFinite(e));const t=Math.cos(e*id);return poe(vw*t)-9}function UI(r){const e=Math.cos(r*id);return I_/vw/e}function NI(r){const{latitude:e,longitude:t,highPrecision:n=!1}=r;pA(Number.isFinite(e)&&Number.isFinite(t));const i=I_,s=Math.cos(e*id),a=i/360,o=a/s,h=i/vw/s,f={unitsPerMeter:[h,h,h],metersPerUnit:[1/h,1/h,1/h],unitsPerDegree:[a,o,h],degreesPerUnit:[1/a,1/o,1/h]};if(n){const _=id*Math.tan(e*id)/s,x=a*_/2,T=i/vw*_,I=T/o*h;f.unitsPerDegree2=[0,x,T],f.unitsPerMeter2=[I,0,I]}return f}function YU(r,e){const[t,n,i]=r,[s,a,o]=e,{unitsPerMeter:h,unitsPerMeter2:f}=NI({longitude:t,latitude:n,highPrecision:!0}),_=xw(r);_[0]+=s*(h[0]+f[0]*a),_[1]+=a*(h[1]+f[1]*a);const x=M_(_),T=(i||0)+(o||0);return Number.isFinite(i)||Number.isFinite(o)?[x[0],x[1],T]:x}function moe(r){const{height:e,pitch:t,bearing:n,altitude:i,scale:s,center:a}=r,o=doe();_w(o,o,[0,0,-i]),GU(o,o,-t*id),QU(o,o,n*id);const h=s/e;return II(o,o,[h,h,h]),a&&_w(o,o,Ese([],a)),o}function _oe(r){const{width:e,height:t,altitude:n,pitch:i=0,offset:s,center:a,scale:o,nearZMultiplier:h=1,farZMultiplier:f=1}=r;let{fovy:_=_1(Aoe)}=r;n!==void 0&&(_=_1(n));const x=_*id,T=i*id,I=zI(_);let N=I;a&&(N+=a[2]*o/Math.cos(T)/t);const $=x*(.5+(s?s[1]:0)/t),W=Math.sin($)*N/Math.sin(DI(Math.PI/2-T-$,.01,Math.PI-.01)),Y=Math.sin(T)*W+N,ie=N*10,ce=Math.min(Y*f,ie);return{fov:x,aspect:e/t,focalDistance:I,near:h,far:ce}}function _1(r){return 2*Math.atan(.5/r)*kI}function zI(r){return .5/Math.tan(.5*r*id)}function eN(r,e){const[t,n,i=0]=r;return pA(Number.isFinite(t)&&Number.isFinite(n)&&Number.isFinite(i)),S_(e,[t,n,i,1])}function HI(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const[n,i,s]=r;if(pA(Number.isFinite(n)&&Number.isFinite(i),"invalid pixel coordinate"),Number.isFinite(s))return S_(e,[n,i,s,1]);const a=S_(e,[n,i,0,1]),o=S_(e,[n,i,1,1]),h=a[2],f=o[2],_=h===f?0:((t||0)-h)/(f-h);return NU([],a,o,_)}function yoe(r){const{width:e,height:t,bounds:n,minExtent:i=0,maxZoom:s=24,offset:a=[0,0]}=r,[[o,h],[f,_]]=n,x=boe(r.padding),T=xw([o,DI(_,-ap,ap)]),I=xw([f,DI(h,-ap,ap)]),N=[Math.max(Math.abs(I[0]-T[0]),i),Math.max(Math.abs(I[1]-T[1]),i)],$=[e-x.left-x.right-Math.abs(a[0])*2,t-x.top-x.bottom-Math.abs(a[1])*2];pA($[0]>0&&$[1]>0);const W=$[0]/N[0],Y=$[1]/N[1],ie=(x.right-x.left)/2/W,ce=(x.top-x.bottom)/2/Y,fe=[(I[0]+T[0])/2+ie,(I[1]+T[1])/2+ce],ve=M_(fe),be=Math.min(s,OI(Math.abs(Math.min(W,Y))));return pA(Number.isFinite(be)),{longitude:ve[0],latitude:ve[1],zoom:be}}function boe(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return typeof r=="number"?{top:r,bottom:r,left:r,right:r}:(pA(Number.isFinite(r.top)&&Number.isFinite(r.bottom)&&Number.isFinite(r.left)&&Number.isFinite(r.right)),r)}const tN=Math.PI/180;function voe(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const{width:t,height:n,unproject:i}=r,s={targetZ:e},a=i([0,n],s),o=i([t,n],s);let h,f;const _=r.fovy?.5*r.fovy*tN:Math.atan(.5/r.altitude),x=(90-r.pitch)*tN;return _>x-.01?(h=rN(r,0,e),f=rN(r,t,e)):(h=i([0,0],s),f=i([t,0],s)),[a,o,f,h]}function rN(r,e,t){const{pixelUnprojectionMatrix:n}=r,i=S_(n,[e,0,1,1]),s=S_(n,[e,r.height,1,1]),o=(t*r.distanceScales.unitsPerMeter[2]-i[2])/(s[2]-i[2]),h=NU([],i,s,o),f=M_(h);return f.push(t),f}const nN=512;function xoe(r){const{width:e,height:t,pitch:n=0}=r;let{longitude:i,latitude:s,zoom:a,bearing:o=0}=r;(i<-180||i>180)&&(i=JU(i+180,360)-180),(o<-180||o>180)&&(o=JU(o+180,360)-180);const h=OI(t/nN);if(a<=h)a=h,s=0;else{const f=t/2/Math.pow(2,a),_=M_([0,f])[1];if(s<_)s=_;else{const x=M_([0,nN-f])[1];s>x&&(s=x)}}return{width:e,height:t,longitude:i,latitude:s,zoom:a,pitch:n,bearing:o}}const iN=`
uniform shadowUniforms {
  bool drawShadowMap;
  bool useShadowMap;
  vec4 color;
  highp int lightId;
  float lightCount;
  mat4 viewProjectionMatrix0;
  mat4 viewProjectionMatrix1;
  vec4 projectCenter0;
  vec4 projectCenter1;
} shadow;
`,woe=`
${iN}

const int max_lights = 2;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  mat4 viewProjectionMatrices[max_lights];
  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;
  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;
  vec4 projectCenters[max_lights];
  projectCenters[0] = shadow.projectCenter0;
  projectCenters[1] = shadow.projectCenter1;

  if (shadow.drawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);
  }
  if (shadow.useShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow.lightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}

`,Boe=`
${iN}

const int max_lights = 2;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow.drawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow.useShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow.lightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow.color.a / shadow.lightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}

`,Coe=m1(Moe),Eoe=m1(Poe),Toe=[0,0,0,1],Soe=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function Ioe(r,e){const[t,n,i]=r,s=HI([t,n,i],e);return Number.isFinite(i)?s:[s[0],s[1],0]}function Moe(r){let{viewport:e,center:t}=r;return new Ud(e.viewProjectionMatrix).invert().transform(t)}function Poe(r){let{viewport:e,shadowMatrices:t}=r;const n=[],i=e.pixelUnprojectionMatrix,s=e.isGeospatial?void 0:1,a=[[0,0,s],[e.width,0,s],[0,e.height,s],[e.width,e.height,s],[0,0,-1],[e.width,0,-1],[0,e.height,-1],[e.width,e.height,-1]].map(o=>Ioe(o,i));for(const o of t){const h=o.clone().translate(new op(e.center).negate()),f=a.map(x=>h.transform(x)),_=new Ud().ortho({left:Math.min(...f.map(x=>x[0])),right:Math.max(...f.map(x=>x[0])),bottom:Math.min(...f.map(x=>x[1])),top:Math.max(...f.map(x=>x[1])),near:Math.min(...f.map(x=>-x[2])),far:Math.max(...f.map(x=>-x[2]))});n.push(_.multiplyRight(o))}return n}function Foe(r){const{shadowEnabled:e=!0,project:t}=r;if(!e||!t||!r.shadowMatrices||!r.shadowMatrices.length)return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:r.dummyShadowMap,shadow_uShadowMap1:r.dummyShadowMap};const n=RI.getUniforms(t),i=Coe({viewport:t.viewport,center:n.center}),s=[],a=Eoe({shadowMatrices:r.shadowMatrices,viewport:t.viewport}).slice();for(let h=0;h<r.shadowMatrices.length;h++){const f=a[h],_=f.clone().translate(new op(t.viewport.center).negate());n.coordinateSystem===is.LNGLAT&&n.projectionMode===kd.WEB_MERCATOR?(a[h]=_,s[h]=i):(a[h]=f.clone().multiplyRight(Soe),s[h]=_.transform(i))}const o={drawShadowMap:!!r.drawToShadowMap,useShadowMap:r.shadowMaps?r.shadowMaps.length>0:!1,color:r.shadowColor||Toe,lightId:r.shadowLightId||0,lightCount:r.shadowMatrices.length,shadow_uShadowMap0:r.dummyShadowMap,shadow_uShadowMap1:r.dummyShadowMap};for(let h=0;h<a.length;h++)o[`viewProjectionMatrix${h}`]=a[h],o[`projectCenter${h}`]=s[h];for(let h=0;h<2;h++)o[`shadow_uShadowMap${h}`]=r.shadowMaps&&r.shadowMaps[h]||r.dummyShadowMap;return o}const sN={name:"shadow",dependencies:[RI],vs:woe,fs:Boe,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:Foe,uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}},VI={...iU,defaultUniforms:{...iU.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},Roe=[AU],Loe=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function Doe(){const r=Nx.getDefaultShaderAssembler();for(const e of Roe)r.addDefaultModule(e);for(const e of Loe)r.addShaderHook(e);return r}const Ooe=[255,255,255],koe=1;let Uoe=0;class oN{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.type="ambient";const{color:t=Ooe}=e,{intensity:n=koe}=e;this.id=e.id||`ambient-${Uoe++}`,this.color=t,this.intensity=n}}const Noe=[255,255,255],zoe=1,Hoe=[0,0,-1];let Voe=0;class aN{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.type="directional";const{color:t=Noe}=e,{intensity:n=zoe}=e,{direction:i=Hoe}=e,{_shadow:s=!1}=e;this.id=e.id||`directional-${Voe++}`,this.color=t,this.intensity=n,this.type="directional",this.direction=new op(i).normalize().toArray(),this.shadow=s}getProjectedLight(e){return this}}class Goe{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{id:"pass"};const{id:n}=t;this.id=n,this.device=e,this.props={...t}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class GI extends Goe{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[t,n]=this.device.canvasContext.getDrawingBufferSize(),i=e.clearCanvas??!0,s=e.clearColor??(i?[0,0,0,0]:!1),a=i?1:!1,o=i?0:!1,h=e.colorMask??15,f={viewport:[0,0,t,n]};e.colorMask&&(f.colorMask=h),e.scissorRect&&(f.scissorRect=e.scissorRect);const _=this.device.beginRenderPass({framebuffer:e.target,parameters:f,clearColor:s,clearDepth:a,clearStencil:o});try{return this._drawLayers(_,e)}finally{_.end()}}_drawLayers(e,t){const{target:n,shaderModuleProps:i,viewports:s,views:a,onViewportActive:o,clearStack:h=!0}=t;t.pass=t.pass||"unknown",h&&(this._lastRenderIndex=-1);const f=[];for(const _ of s){const x=a&&a[_.id];o==null||o(_);const T=this._getDrawLayerParams(_,t),I=_.subViewports||[_];for(const N of I){const $=this._drawLayersInViewport(e,{target:n,shaderModuleProps:i,viewport:N,view:x,pass:t.pass,layers:t.layers},T);f.push($)}}return f}_getDrawLayerParams(e,t){var $;let{layers:n,pass:i,isPicking:s=!1,layerFilter:a,cullRect:o,effects:h,shaderModuleProps:f}=t,_=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const x=[],T=lN(this._lastRenderIndex+1),I={layer:n[0],viewport:e,isPicking:s,renderPass:i,cullRect:o},N={};for(let W=0;W<n.length;W++){const Y=n[W],ie=this._shouldDrawLayer(Y,I,a,N),ce={shouldDrawLayer:ie};ie&&!_&&(ce.shouldDrawLayer=!0,ce.layerRenderIndex=T(Y,ie),ce.shaderModuleProps=this._getShaderModuleProps(Y,h,i,f),ce.layerParameters={...($=Y.context.deck)==null?void 0:$.props.parameters,...this.getLayerParameters(Y,W,e)}),x[W]=ce}return x}_drawLayersInViewport(e,t,n){let{layers:i,shaderModuleProps:s,pass:a,target:o,viewport:h,view:f}=t;const _=Qoe(this.device,{shaderModuleProps:s,target:o,viewport:h});if(f&&f.props.clear){const T=f.props.clear===!0?{color:!0,depth:!0}:f.props.clear;this.device.beginRenderPass({framebuffer:o,parameters:{viewport:_,scissorRect:_},clearColor:T.color?[0,0,0,0]:!1,clearDepth:T.depth?1:!1}).end()}const x={totalCount:i.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:_});for(let T=0;T<i.length;T++){const I=i[T],N=n[T],{shouldDrawLayer:$}=N;if($&&I.props.pickable&&x.pickableCount++,I.isComposite&&x.compositeCount++,I.isDrawable&&N.shouldDrawLayer){const{layerRenderIndex:W,shaderModuleProps:Y,layerParameters:ie}=N;x.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,W),Y.project&&(Y.project.viewport=h),I.context.renderPass=e;try{I._drawLayer({renderPass:e,shaderModuleProps:Y,uniforms:{layerIndex:W},parameters:ie})}catch(ce){I.raiseError(ce,`drawing ${I} to ${a}`)}}}return x}shouldDrawLayer(e){return!0}getShaderModuleProps(e,t,n){return null}getLayerParameters(e,t,n){return e.props.parameters}_shouldDrawLayer(e,t,n,i){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;t.layer=e;let a=e.parent;for(;a;){if(!a.props.visible||!a.filterSubLayer(t))return!1;t.layer=a,a=a.parent}if(n){const o=t.layer.id;if(o in i||(i[o]=n(t)),!i[o])return!1}return e.activateViewport(t.viewport),!0}_getShaderModuleProps(e,t,n,i){var h,f;const s=this.device.canvasContext.cssToDeviceRatio(),a=((h=e.internalState)==null?void 0:h.propsInTransition)||e.props,o={layer:a,picking:{isActive:!1},project:{viewport:e.context.viewport,devicePixelRatio:s,modelMatrix:a.modelMatrix,coordinateSystem:a.coordinateSystem,coordinateOrigin:a.coordinateOrigin,autoWrapLongitude:e.wrapLongitude}};if(t)for(const _ of t)cN(o,(f=_.getShaderModuleProps)==null?void 0:f.call(_,e,o));return cN(o,this.getShaderModuleProps(e,t,o),i)}}function lN(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const t={},n=(i,s)=>{const a=i.props._offset,o=i.id,h=i.parent&&i.parent.id;let f;if(h&&!(h in e)&&n(i.parent,!1),h in t){const _=t[h]=t[h]||lN(e[h],e);f=_(i,s),t[o]=_}else Number.isFinite(a)?(f=a+(e[h]||0),t[o]=null):f=r;return s&&f>=r&&(r=f+1),e[o]=f,f};return n}function Qoe(r,e){var f;let{shaderModuleProps:t,target:n,viewport:i}=e;const s=((f=t==null?void 0:t.project)==null?void 0:f.devicePixelRatio)??r.canvasContext.cssToDeviceRatio(),[,a]=r.canvasContext.getDrawingBufferSize(),o=n?n.height:a,h=i;return[h.x*s,o-(h.y+h.height)*s,h.width*s,h.height*s]}function cN(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];for(const i of t)if(i)for(const s in i)r[s]?Object.assign(r[s],i[s]):r[s]=i[s];return r}class $oe extends GI{constructor(e,t){super(e,t);const n=e.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},mipmaps:!0}),i=e.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1});this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[n],depthStencilAttachment:i})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(e){const t=this.fbo,n=this.device.canvasContext.cssToDeviceRatio(),i=e.viewports[0],s=i.width*n,a=i.height*n,o=[1,1,1,1];(s!==t.width||a!==t.height)&&t.resize({width:s,height:a}),super.render({...e,clearColor:o,target:t,pass:"shadow"})}getLayerParameters(e,t,n){return{...e.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getShaderModuleProps(e,t,n){return{shadow:{project:n.project,drawToShadowMap:!0}}}}const joe={color:[255,255,255],intensity:1},uN=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],qoe=[0,0,0,200/255];class QI{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.id="lighting-effect",this.shadowColor=qoe,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:t,deck:n}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(t),n._addDefaultShaderModule(sN),this.dummyShadowMap=t.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[];for(const t in e){const n=e[t];switch(n.type){case"ambient":this.ambientLight=n;break;case"directional":this.directionalLights.push(n);break;case"point":this.pointLights.push(n);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(t=>t.shadow),this.context&&this.setup(this.context),this.props=e}preRender(e){let{layers:t,layerFilter:n,viewports:i,onViewportActive:s,views:a}=e;if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let o=0;o<this.shadowPasses.length;o++)this.shadowPasses[o].render({layers:t,layerFilter:n,viewports:i,onViewportActive:s,views:a,shaderModuleProps:{shadow:{shadowLightId:o,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}getShaderModuleProps(e,t){const n=this.shadow?{project:t.project,shadowMaps:this.shadowPasses.map(a=>a.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},i={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(a=>a.getProjectedLight({layer:e})),pointLights:this.pointLights.map(a=>a.getProjectedLight({layer:e}))},s=e.props.material;return{shadow:n,lighting:i,phongMaterial:s,gouraudMaterial:s}}cleanup(e){for(const t of this.shadowPasses)t.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(sN))}_calculateMatrices(){const e=[];for(const t of this.directionalLights){const n=new Ud().lookAt({eye:new op(t.direction).negate()});e.push(n)}return e}_createShadowPasses(e){for(let t=0;t<this.directionalLights.length;t++){const n=new $oe(e);this.shadowPasses[t]=n}}_applyDefaultLights(){const{ambientLight:e,pointLights:t,directionalLights:n}=this;!e&&t.length===0&&n.length===0&&(this.ambientLight=new oN(joe),this.directionalLights.push(new aN(uN[0]),new aN(uN[1])))}}class Koe{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,t,n){let{size:i=1,type:s,padding:a=0,copy:o=!1,initialize:h=!1,maxCount:f}=n;const _=s||e&&e.constructor||Float32Array,x=t*i+a;if(ArrayBuffer.isView(e)){if(x<=e.length)return e;if(x*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new _(e.buffer,0,x)}let T=1/0;f&&(T=f*i+a);const I=this._allocate(_,x,h,T);return e&&o?I.set(e):h||I.fill(0,0,4),this._release(e),I}release(e){this._release(e)}_allocate(e,t,n,i){let s=Math.max(Math.ceil(t*this.opts.overAlloc),1);s>i&&(s=i);const a=this._pool,o=e.BYTES_PER_ELEMENT*s,h=a.findIndex(f=>f.byteLength>=o);if(h>=0){const f=new e(a.splice(h,1)[0],0,s);return n&&f.fill(0),f}return new e(s)}_release(e){if(!ArrayBuffer.isView(e))return;const t=this._pool,{buffer:n}=e,{byteLength:i}=n,s=t.findIndex(a=>a.byteLength>=i);s<0?t.push(n):(s>0||t.length<this.opts.poolSize)&&t.splice(s,0,n),t.length>this.opts.poolSize&&t.shift()}}const y1=new Koe;function b1(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Woe(r,e){const t=r%e;return t<0?e+t:t}function Xoe(r){return[r[12],r[13],r[14]]}function Joe(r){return{left:P_(r[3]+r[0],r[7]+r[4],r[11]+r[8],r[15]+r[12]),right:P_(r[3]-r[0],r[7]-r[4],r[11]-r[8],r[15]-r[12]),bottom:P_(r[3]+r[1],r[7]+r[5],r[11]+r[9],r[15]+r[13]),top:P_(r[3]-r[1],r[7]-r[5],r[11]-r[9],r[15]-r[13]),near:P_(r[3]+r[2],r[7]+r[6],r[11]+r[10],r[15]+r[14]),far:P_(r[3]-r[2],r[7]-r[6],r[11]-r[10],r[15]-r[14])}}const hN=new op;function P_(r,e,t,n){hN.set(r,e,t);const i=hN.len();return{distance:n/i,normal:new op(-r/i,-e/i,-t/i)}}function Zoe(r){return r-Math.fround(r)}let v1;function $I(r,e){const{size:t=1,startIndex:n=0}=e,i=e.endIndex!==void 0?e.endIndex:r.length,s=(i-n)/t;v1=y1.allocate(v1,s,{type:Float32Array,size:t*2});let a=n,o=0;for(;a<i;){for(let h=0;h<t;h++){const f=r[a++];v1[o+h]=f,v1[o+h+t]=Zoe(f)}o+=t*2}return v1.subarray(0,s*t*2)}function Yoe(r){let e=null,t=!1;for(const n of r)n&&(e?(t||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],t=!0),e[0][0]=Math.min(e[0][0],n[0][0]),e[0][1]=Math.min(e[0][1],n[0][1]),e[1][0]=Math.max(e[1][0],n[1][0]),e[1][1]=Math.max(e[1][1],n[1][1])):e=n);return e}const eae=Math.PI/180,tae=b1(),dN=[0,0,0],rae={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function nae(r){let{width:e,height:t,orthographic:n,fovyRadians:i,focalDistance:s,padding:a,near:o,far:h}=r;const f=e/t,_=n?new Ud().orthographic({fovy:i,aspect:f,focalDistance:s,near:o,far:h}):new Ud().perspective({fovy:i,aspect:f,near:o,far:h});if(a){const{left:x=0,right:T=0,top:I=0,bottom:N=0}=a,$=Uf((x+e-T)/2,0,e)-e/2,W=Uf((I+t-N)/2,0,t)-t/2;_[8]-=$*2/e,_[9]+=W*2/t}return _}class F_{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||rae,this.focalDistance=e.focalDistance||1,this.position=e.position||dN,this.modelMatrix=e.modelMatrix||null;const{longitude:t,latitude:n}=e;this.isGeospatial=Number.isFinite(n)&&Number.isFinite(t),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?kd.WEB_MERCATOR:kd.WEB_MERCATOR_AUTO_OFFSET:kd.IDENTITY}equals(e){return e instanceof F_?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&g1(e.projectionMatrix,this.projectionMatrix)&&g1(e.viewMatrix,this.viewMatrix):!1}project(e){let{topLeft:t=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=this.projectPosition(e),i=eN(n,this.pixelProjectionMatrix),[s,a]=i,o=t?a:this.height-a;return e.length===2?[s,o]:[s,o,i[2]]}unproject(e){let{topLeft:t=!0,targetZ:n}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const[i,s,a]=e,o=t?s:this.height-s,h=n&&n*this.distanceScales.unitsPerMeter[2],f=HI([i,o,a],this.pixelUnprojectionMatrix,h),[_,x,T]=this.unprojectPosition(f);return Number.isFinite(a)?[_,x,T]:Number.isFinite(n)?[_,x,n]:[_,x]}projectPosition(e){const[t,n]=this.projectFlat(e),i=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[t,n,i]}unprojectPosition(e){const[t,n]=this.unprojectFlat(e),i=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[t,n,i]}projectFlat(e){if(this.isGeospatial){const t=xw(e);return t[1]=Uf(t[1],-318,830),t}return e}unprojectFlat(e){return this.isGeospatial?M_(e):e}getBounds(){const t={targetZ:(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{}).z||0},n=this.unproject([0,0],t),i=this.unproject([this.width,0],t),s=this.unproject([0,this.height],t),a=this.unproject([this.width,this.height],t);return[Math.min(n[0],i[0],s[0],a[0]),Math.min(n[1],i[1],s[1],a[1]),Math.max(n[0],i[0],s[0],a[0]),Math.max(n[1],i[1],s[1],a[1])]}getDistanceScales(e){return e&&this.isGeospatial?NI({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel(e){let{x:t,y:n,width:i=1,height:s=1}=e;return t<this.x+this.width&&this.x<t+i&&n<this.y+this.height&&this.y<n+s}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,Joe(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,t){return null}_initProps(e){const t=e.longitude,n=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=goe({latitude:n})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||NI({latitude:n,longitude:t}));const i=Math.pow(2,this.zoom);this.scale=i;const{position:s,modelMatrix:a}=e;let o=dN;if(s&&(o=a?new Ud(a).transformAsVector(s,[]):s),this.isGeospatial){const h=this.projectPosition([t,n,0]);this.center=new op(o).scale(this.distanceScales.unitsPerMeter).add(h)}else this.center=this.projectPosition(o)}_initMatrices(e){const{viewMatrix:t=tae,projectionMatrix:n=null,orthographic:i=!1,fovyRadians:s,fovy:a=75,near:o=.1,far:h=1e3,padding:f=null,focalDistance:_=1}=e;this.viewMatrixUncentered=t,this.viewMatrix=new Ud().multiplyRight(t).translate(new op(this.center).negate()),this.projectionMatrix=n||nae({width:this.width,height:this.height,orthographic:i,fovyRadians:s||a*eae,focalDistance:_,padding:f,near:o,far:h});const x=b1();Tg(x,x,this.projectionMatrix),Tg(x,x,this.viewMatrix),this.viewProjectionMatrix=x,this.viewMatrixInverse=SI([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=Xoe(this.viewMatrixInverse);const T=b1(),I=b1();II(T,T,[this.width/2,-this.height/2,1]),_w(T,T,[1,-1,0]),Tg(I,T,this.viewProjectionMatrix),this.pixelProjectionMatrix=I,this.pixelUnprojectionMatrix=SI(b1(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||Es.warn("Pixel project matrix not invertible")()}}F_.displayName="Viewport";class Sg extends F_{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{latitude:t=0,longitude:n=0,zoom:i=0,pitch:s=0,bearing:a=0,nearZMultiplier:o=.1,farZMultiplier:h=1.01,nearZ:f,farZ:_,orthographic:x=!1,projectionMatrix:T,repeat:I=!1,worldOffset:N=0,position:$,padding:W,legacyMeterSizes:Y=!1}=e;let{width:ie,height:ce,altitude:fe=1.5}=e;const ve=Math.pow(2,i);ie=ie||1,ce=ce||1;let be,Qe=null;if(T)fe=T[5]/2,be=_1(fe);else{e.fovy?(be=e.fovy,fe=zI(be)):be=_1(fe);let st;if(W){const{top:at=0,bottom:Le=0}=W;st=[0,Uf((at+ce-Le)/2,0,ce)-ce/2]}Qe=_oe({width:ie,height:ce,scale:ve,center:$&&[0,0,$[2]*UI(t)],offset:st,pitch:s,fovy:be,nearZMultiplier:o,farZMultiplier:h}),Number.isFinite(f)&&(Qe.near=f),Number.isFinite(_)&&(Qe.far=_)}let Ue=moe({height:ce,pitch:s,bearing:a,scale:ve,altitude:fe});N&&(Ue=new Ud().translate([512*N,0,0]).multiplyLeft(Ue)),super({...e,width:ie,height:ce,viewMatrix:Ue,longitude:n,latitude:t,zoom:i,...Qe,fovy:be,focalDistance:fe}),this.latitude=t,this.longitude=n,this.zoom=i,this.pitch=s,this.bearing=a,this.altitude=fe,this.fovy=be,this.orthographic=x,this._subViewports=I?[]:null,this._pseudoMeters=Y,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),t=Math.floor((e[0]+180)/360),n=Math.ceil((e[2]-180)/360);for(let i=t;i<=n;i++){const s=i?new Sg({...this,worldOffset:i}):this;this._subViewports.push(s)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[t,n]=this.projectFlat(e),i=(e[2]||0)*UI(e[1]);return[t,n,i]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[t,n]=this.unprojectFlat(e),i=(e[2]||0)/UI(n);return[t,n,i]}addMetersToLngLat(e,t){return YU(e,t)}panByPosition(e,t){const n=HI(t,this.pixelUnprojectionMatrix),i=this.projectFlat(e),s=UU([],i,_se([],n)),a=UU([],this.center,s),[o,h]=this.unprojectFlat(a);return{longitude:o,latitude:h}}getBounds(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=voe(this,e.z||0);return[Math.min(t[0][0],t[1][0],t[2][0],t[3][0]),Math.min(t[0][1],t[1][1],t[2][1],t[3][1]),Math.max(t[0][0],t[1][0],t[2][0],t[3][0]),Math.max(t[0][1],t[1][1],t[2][1],t[3][1])]}fitBounds(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{width:n,height:i}=this,{longitude:s,latitude:a,zoom:o}=yoe({width:n,height:i,bounds:e,...t});return new Sg({width:n,height:i,longitude:s,latitude:a,zoom:o})}}Sg.displayName="WebMercatorViewport";const fN=[0,0,0];function jI(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const n=e.projectPosition(r);if(t&&e instanceof Sg){const[i,s,a=0]=r,o=e.getDistanceScales([i,s]);n[2]=a*o.unitsPerMeter[2]}return n}function iae(r){const{viewport:e,modelMatrix:t,coordinateOrigin:n}=r;let{coordinateSystem:i,fromCoordinateSystem:s,fromCoordinateOrigin:a}=r;return i===is.DEFAULT&&(i=e.isGeospatial?is.LNGLAT:is.CARTESIAN),s===void 0&&(s=i),a===void 0&&(a=n),{viewport:e,coordinateSystem:i,coordinateOrigin:n,modelMatrix:t,fromCoordinateSystem:s,fromCoordinateOrigin:a}}function AN(r,e){let{viewport:t,modelMatrix:n,coordinateSystem:i,coordinateOrigin:s,offsetMode:a}=e,[o,h,f=0]=r;switch(n&&([o,h,f]=T_([],[o,h,f,1],n)),i){case is.LNGLAT:return jI([o,h,f],t,a);case is.LNGLAT_OFFSETS:return jI([o+s[0],h+s[1],f+(s[2]||0)],t,a);case is.METER_OFFSETS:return jI(YU(s,[o,h,f]),t,a);case is.CARTESIAN:default:return t.isGeospatial?[o+s[0],h+s[1],f+s[2]]:t.projectPosition([o,h,f])}}function sae(r,e){const{viewport:t,coordinateSystem:n,coordinateOrigin:i,modelMatrix:s,fromCoordinateSystem:a,fromCoordinateOrigin:o}=iae(e),{autoOffset:h=!0}=e,{geospatialOrigin:f=fN,shaderCoordinateOrigin:_=fN,offsetMode:x=!1}=h?XU(t,n,i):{},T=AN(r,{viewport:t,modelMatrix:s,coordinateSystem:a,coordinateOrigin:o,offsetMode:x});if(x){const I=t.projectPosition(f||_);VU(T,T,I)}return T}let oae=1,aae=1;class pN{constructor(){xe(this,"time",0);xe(this,"channels",new Map);xe(this,"animations",new Map);xe(this,"playing",!1);xe(this,"lastEngineTime",-1)}addChannel(e){const{delay:t=0,duration:n=Number.POSITIVE_INFINITY,rate:i=1,repeat:s=1}=e,a=oae++,o={time:0,delay:t,duration:n,rate:i,repeat:s};return this._setChannelTime(o,this.time),this.channels.set(a,o),a}removeChannel(e){this.channels.delete(e);for(const[t,n]of this.animations)n.channel===e&&this.detachAnimation(t)}isFinished(e){const t=this.channels.get(e);return t===void 0?!1:this.time>=t.delay+t.duration*t.repeat}getTime(e){if(e===void 0)return this.time;const t=this.channels.get(e);return t===void 0?-1:t.time}setTime(e){this.time=Math.max(0,e);const t=this.channels.values();for(const i of t)this._setChannelTime(i,this.time);const n=this.animations.values();for(const i of n){const{animation:s,channel:a}=i;s.setTime(this.getTime(a))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,t){const n=aae++;return this.animations.set(n,{animation:e,channel:t}),e.setTime(this.getTime(t)),n}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,t){const n=t-e.delay,i=e.duration*e.repeat;n>=i?e.time=e.duration*e.rate:(e.time=Math.max(0,n)%e.duration,e.time*=e.rate)}}function lae(r){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(r):setTimeout(r,1e3/60)}function cae(r){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(r):clearTimeout(r)}function gN(){let r;if(typeof window<"u"&&window.performance)r=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();r=e[0]*1e3+e[1]/1e6}else r=Date.now();return r}let mN=class{constructor(e,t){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=gN(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(gN()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}},uae=class{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const t of Object.values(this.stats))e(t)}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(t=>this._getOrCreate(t))}_getOrCreate(e){const{name:t,type:n}=e;let i=this.stats[t];return i||(e instanceof mN?i=e:i=new mN(t,n),this.stats[t]=i),i}},hae=0;const dae={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:r=>console.error(r),stats:eI.stats.get(`animation-loop-${hae++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class fae{constructor(e){xe(this,"device",null);xe(this,"canvas",null);xe(this,"props");xe(this,"animationProps",null);xe(this,"timeline",null);xe(this,"stats");xe(this,"cpuTime");xe(this,"gpuTime");xe(this,"frameRate");xe(this,"display");xe(this,"needsRedraw","initialized");xe(this,"_initialized",!1);xe(this,"_running",!1);xe(this,"_animationFrameId",null);xe(this,"_nextFramePromise",null);xe(this,"_resolveNextFrame",null);xe(this,"_cpuStartTime",0);xe(this,"_error",null);if(this.props={...dae,...e},e=this.props,!e.device)throw new Error("No device provided");const{useDevicePixels:t=!0}=this.props;this.stats=e.stats||new uae({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport,autoResizeDrawingBuffer:e.autoResizeDrawingBuffer,useDevicePixels:t}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setError(e){var n,i;if(this.props.onError(e),this._error=Error(),((i=(n=this.device)==null?void 0:n.canvasContext)==null?void 0:i.canvas)instanceof HTMLCanvasElement){const s=document.createElement("h1");s.innerHTML=e.message,s.style.position="absolute",s.style.top="20%",s.style.left="10px",s.style.color="black",s.style.backgroundColor="red",document.body.appendChild(s)}}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),"autoResizeDrawingBuffer"in e&&(this.props.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer||!1),"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const t=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(t),t}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){var e;return(e=this.device)!=null&&e.isLost||this._error?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=lae(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(cae(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){var t;if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),(t=this.device)==null||t.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){var t,n;const e=(n=(t=this.device)==null?void 0:t.canvasContext)==null?void 0:n.canvas;if(!this.device||!e)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:e,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:t,aspect:n}=this._getSizeAndAspect();(e!==this.animationProps.width||t!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),n!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=t,this.animationProps.aspect=n,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){var e;if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=((e=this.device.canvasContext)==null?void 0:e.canvas)||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const t=document.createElement("div");t.style.position="absolute",t.style.left="10px",t.style.bottom="10px",t.style.width="300px",t.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(t);const n=this.props.onAddHTML(t);n&&(t.innerHTML=n)}}_getSizeAndAspect(){var s,a,o,h;if(!this.device)return{width:1,height:1,aspect:1};const[e,t]=((a=(s=this.device)==null?void 0:s.canvasContext)==null?void 0:a.getPixelSize())||[1,1];let n=1;const i=(h=(o=this.device)==null?void 0:o.canvasContext)==null?void 0:h.canvas;return i&&i.clientHeight?n=i.clientWidth/i.clientHeight:e>0&&t>0&&(n=e/t),{width:e,height:t,aspect:n}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){var e,t;this.props.autoResizeDrawingBuffer&&((t=(e=this.device)==null?void 0:e.canvasContext)==null||t.resize({useDevicePixels:this.props.useDevicePixels}))}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}const qI={};function x1(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"id";qI[r]=qI[r]||1;const e=qI[r]++;return`${r}-${e}`}class _N{constructor(e){xe(this,"id");xe(this,"userData",{});xe(this,"topology");xe(this,"bufferLayout",[]);xe(this,"vertexCount");xe(this,"indices");xe(this,"attributes");if(this.id=e.id||x1("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&!(this.indices.usage&La.INDEX))throw new Error("Index buffer must have INDEX usage")}destroy(){var e;(e=this.indices)==null||e.destroy();for(const t of Object.values(this.attributes))t.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(e){return e.byteLength/12}}function Aae(r,e){if(e instanceof _N)return e;const t=pae(r,e),{attributes:n,bufferLayout:i}=gae(r,e);return new _N({topology:e.topology||"triangle-list",bufferLayout:i,vertexCount:e.vertexCount,indices:t,attributes:n})}function pae(r,e){if(!e.indices)return;const t=e.indices.value;return r.createBuffer({usage:La.INDEX,data:t})}function gae(r,e){const t=[],n={};for(const[s,a]of Object.entries(e.attributes)){let o=s;switch(s){case"POSITION":o="positions";break;case"NORMAL":o="normals";break;case"TEXCOORD_0":o="texCoords";break;case"COLOR_0":o="colors";break}if(a){n[o]=r.createBuffer({data:a.value,id:`${s}-buffer`});const{value:h,size:f,normalized:_}=a;t.push({name:o,format:_ne(h,f,_)})}}const i=e._calculateVertexCount(e.attributes,e.indices);return{attributes:n,bufferLayout:t,vertexCount:i}}const sT=class sT{constructor(e){xe(this,"device");xe(this,"destroyPolicy");xe(this,"_hashCounter",0);xe(this,"_hashes",{});xe(this,"_renderPipelineCache",{});xe(this,"_computePipelineCache",{});this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new sT(e),e._lumaData.defaultPipelineFactory}createRenderPipeline(e){const t={...v_.defaultProps,...e},n=this._hashRenderPipeline(t);if(!this._renderPipelineCache[n]){const i=this.device.createRenderPipeline({...t,id:t.id?`${t.id}-cached`:void 0});i.hash=n,this._renderPipelineCache[n]={pipeline:i,useCount:0}}return this._renderPipelineCache[n].useCount++,this._renderPipelineCache[n].pipeline}createComputePipeline(e){const t={...Xx.defaultProps,...e},n=this._hashComputePipeline(t);if(!this._computePipelineCache[n]){const i=this.device.createComputePipeline({...t,id:t.id?`${t.id}-cached`:void 0});i.hash=n,this._computePipelineCache[n]={pipeline:i,useCount:0}}return this._computePipelineCache[n].useCount++,this._computePipelineCache[n].pipeline}release(e){const t=e.hash,n=e instanceof Xx?this._computePipelineCache:this._renderPipelineCache;n[t].useCount--,n[t].useCount===0&&this.destroyPolicy==="unused"&&(n[t].pipeline.destroy(),delete n[t])}_hashComputePipeline(e){return`${this._getHash(e.shader.source)}`}_hashRenderPipeline(e){const t=e.vs?this._getHash(e.vs.source):0,n=e.fs?this._getHash(e.fs.source):0,i="-",s=this._getHash(JSON.stringify(e.bufferLayout));switch(this.device.type){case"webgl":return`${t}/${n}V${i}BL${s}`;default:const a=this._getHash(JSON.stringify(e.parameters));return`${t}/${n}V${i}T${e.topology}P${a}BL${s}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}};xe(sT,"defaultProps",{...v_.defaultProps});let KI=sT;const oT=class oT{constructor(e){xe(this,"device");xe(this,"destroyPolicy");xe(this,"_cache",{});this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}static getDefaultShaderFactory(e){var t;return(t=e._lumaData).defaultShaderFactory||(t.defaultShaderFactory=new oT(e)),e._lumaData.defaultShaderFactory}createShader(e){const t=this._hashShader(e);let n=this._cache[t];if(!n){const i=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[t]=n={shader:i,useCount:0}}return n.useCount++,n.shader}release(e){const t=this._hashShader(e),n=this._cache[t];n&&(n.useCount--,n.useCount===0&&this.destroyPolicy==="unused"&&(delete this._cache[t],n.shader.destroy()))}_hashShader(e){return`${e.stage}:${e.source}`}};xe(oT,"defaultProps",{...qx.defaultProps});let WI=oT;function mae(r,e){var i;const t={},n="Values";if(r.attributes.length===0&&!((i=r.varyings)!=null&&i.length))return{"No attributes or varyings":{[n]:"N/A"}};for(const s of r.attributes)if(s){const a=`${s.location} ${s.name}: ${s.type}`;t[`in ${a}`]={[n]:s.stepMode||"vertex"}}for(const s of r.varyings||[]){const a=`${s.location} ${s.name}`;t[`out ${a}`]={[n]:JSON.stringify(s)}}return t}let ec=null,Ig=null;function _ae(r,e){let{id:t,minimap:n,opaque:i,top:s="0",left:a="0",rgbaScale:o=1}=e;ec||(ec=document.createElement("canvas"),ec.id=t,ec.title=t,ec.style.zIndex="100",ec.style.position="absolute",ec.style.top=s,ec.style.left=a,ec.style.border="blue 5px solid",ec.style.transform="scaleY(-1)",document.body.appendChild(ec),Ig=ec.getContext("2d")),(ec.width!==r.width||ec.height!==r.height)&&(ec.width=r.width/2,ec.height=r.height/2,ec.style.width="400px",ec.style.height="400px");const h=r.device.readPixelsToArrayWebGL(r),f=Ig==null?void 0:Ig.createImageData(r.width,r.height);if(f){for(let x=0;x<h.length;x+=4)f.data[0+x+0]=h[x+0]*o,f.data[0+x+1]=h[x+1]*o,f.data[0+x+2]=h[x+2]*o,f.data[0+x+3]=i?255:h[x+3]*o;Ig==null||Ig.putImageData(f,0,0)}}function XI(r,e,t){if(r===e)return!0;if(!t||!r||!e)return!1;if(Array.isArray(r)){if(!Array.isArray(e)||r.length!==e.length)return!1;for(let n=0;n<r.length;n++)if(!XI(r[n],e[n],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof r=="object"&&typeof e=="object"){const n=Object.keys(r),i=Object.keys(e);if(n.length!==i.length)return!1;for(const s of n)if(!e.hasOwnProperty(s)||!XI(r[s],e[s],t-1))return!1;return!0}return!1}function yae(r){return ArrayBuffer.isView(r)&&!(r instanceof DataView)}function bae(r){return Array.isArray(r)?r.length===0||typeof r[0]=="number":!1}function vae(r){return yae(r)||bae(r)}function xae(r){return vae(r)||typeof r=="number"||typeof r=="boolean"}function yN(r){const e={bindings:{},uniforms:{}};return Object.keys(r).forEach(t=>{const n=r[t];xae(n)?e.uniforms[t]=n:e.bindings[t]=n}),e}class wae{constructor(e,t){xe(this,"options",{disableWarnings:!1});xe(this,"modules");xe(this,"moduleUniforms");xe(this,"moduleBindings");Object.assign(this.options,t);const n=QS(Object.values(e).filter(i=>i.dependencies));for(const i of n)e[i.name]=i;an.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[i,s]of Object.entries(e))this._addModule(s),s.name&&i!==s.name&&!this.options.disableWarnings&&an.warn(`Module name: ${i} vs ${s.name}`)()}destroy(){}setProps(e){var t;for(const n of Object.keys(e)){const i=n,s=e[i]||{},a=this.modules[i];if(!a){this.options.disableWarnings||an.warn(`Module ${n} not found`)();continue}const o=this.moduleUniforms[i],h=this.moduleBindings[i],f=((t=a.getUniforms)==null?void 0:t.call(a,s,o))||s,{uniforms:_,bindings:x}=yN(f);this.moduleUniforms[i]={...o,..._},this.moduleBindings[i]={...h,...x}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){const e={};for(const t of Object.values(this.moduleBindings))Object.assign(e,t);return e}getDebugTable(){var t;const e={};for(const[n,i]of Object.entries(this.moduleUniforms))for(const[s,a]of Object.entries(i))e[`${n}.${s}`]={type:(t=this.modules[n].uniformTypes)==null?void 0:t[s],value:String(a)};return e}_addModule(e){const t=e.name;this.moduleUniforms[t]=e.defaultUniforms||{},this.moduleBindings[t]={}}}let Bae="";async function Cae(r,e){const t=new Image;return t.crossOrigin=(e==null?void 0:e.crossOrigin)||"anonymous",t.src=r.startsWith("http")?r:Bae+r,await t.decode(),e?await createImageBitmap(t,e):await createImageBitmap(t)}class JI{constructor(e,t){xe(this,"device");xe(this,"id");xe(this,"texture");xe(this,"sampler");xe(this,"view");xe(this,"ready");xe(this,"isReady",!1);xe(this,"destroyed",!1);xe(this,"resolveReady",()=>{});xe(this,"rejectReady",()=>{});this.device=e,this.id=t.id||x1("async-texture"),typeof(t==null?void 0:t.data)=="string"&&t.dimension==="2d"&&(t={...t,data:Cae(t.data)}),this.ready=new Promise((n,i)=>{this.resolveReady=()=>{this.isReady=!0,n()},this.rejectReady=i}),this.initAsync(t)}get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}async initAsync(e){let t,n;const i=e.data,s=await bN(i).then(t,n);if(this.destroyed)return;const a={...e,data:s};this.texture=this.device.createTexture(a),this.sampler=this.texture.sampler,this.view=this.texture.view,this.isReady=!0}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}resize(e){if(!this.isReady)throw new Error("Cannot resize texture before it is ready");if(e.width===this.texture.width&&e.height===this.texture.height)return!1;if(this.texture){const t=this.texture;this.texture=t.clone(e),t.destroy()}return!0}}async function bN(r){if(r=await r,Array.isArray(r))return await Promise.all(r.map(bN));if(r&&typeof r=="object"&&r.constructor===Object){const e=r,t=await Promise.all(Object.values(e)),n=Object.keys(e),i={};for(let s=0;s<n.length;s++)i[n[s]]=t[s];return i}return r}const Mg=2,Eae=1e4,aT=class aT{constructor(e,t){xe(this,"device");xe(this,"id");xe(this,"source");xe(this,"vs");xe(this,"fs");xe(this,"pipelineFactory");xe(this,"shaderFactory");xe(this,"userData",{});xe(this,"parameters");xe(this,"topology");xe(this,"bufferLayout");xe(this,"isInstanced");xe(this,"instanceCount",0);xe(this,"vertexCount");xe(this,"indexBuffer",null);xe(this,"bufferAttributes",{});xe(this,"constantAttributes",{});xe(this,"bindings",{});xe(this,"uniforms",{});xe(this,"vertexArray");xe(this,"transformFeedback",null);xe(this,"pipeline");xe(this,"shaderInputs");xe(this,"_uniformStore");xe(this,"_attributeInfos",{});xe(this,"_gpuGeometry",null);xe(this,"_getModuleUniforms");xe(this,"props");xe(this,"_pipelineNeedsUpdate","newly created");xe(this,"_needsRedraw","initializing");xe(this,"_destroyed",!1);xe(this,"_lastDrawTimestamp",-1);xe(this,"_lastLogTime",0);xe(this,"_logOpen",!1);xe(this,"_drawCount",0);var h,f,_,x;this.props={...aT.defaultProps,...t},t=this.props,this.id=t.id||x1("model"),this.device=e,Object.assign(this.userData,t.userData);const n=Object.fromEntries(((h=this.props.modules)==null?void 0:h.map(T=>[T.name,T]))||[]),i=t.shaderInputs||new wae(n,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(i);const s=Sae(e),a=(((f=this.props.modules)==null?void 0:f.length)>0?this.props.modules:(_=this.shaderInputs)==null?void 0:_.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){(x=this.props).shaderLayout||(x.shaderLayout=Xne(this.props.source));const{source:T,getUniforms:I}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:s,...this.props,modules:a});this.source=T,this._getModuleUniforms=I}else{const{vs:T,fs:I,getUniforms:N}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:s,...this.props,modules:a});this.vs=T,this.fs=I,this._getModuleUniforms=N}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,t.geometry&&this.setGeometry(t.geometry),this.pipelineFactory=t.pipelineFactory||KI.getDefaultPipelineFactory(this.device),this.shaderFactory=t.shaderFactory||WI.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in t&&(this.isInstanced=t.isInstanced),t.instanceCount&&this.setInstanceCount(t.instanceCount),t.vertexCount&&this.setVertexCount(t.vertexCount),t.indexBuffer&&this.setIndexBuffer(t.indexBuffer),t.attributes&&this.setAttributes(t.attributes),t.constantAttributes&&this.setConstantAttributes(t.constantAttributes),t.bindings&&this.setBindings(t.bindings),t.uniforms&&this.setUniformsWebGL(t.uniforms),t.moduleSettings&&this.updateModuleSettingsWebGL(t.moduleSettings),t.transformFeedback&&(this.transformFeedback=t.transformFeedback),Object.seal(this)}get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}destroy(){var e;this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),(e=this._gpuGeometry)==null||e.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||(this._needsRedraw=e)}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){const t=this._areBindingsLoading();if(t)return an.info(Mg,`>>> DRAWING ABORTED ${this.id}: ${t} not loaded`)(),!1;try{e.pushDebugGroup(`${this}.predraw(${e})`),this.predraw()}finally{e.popDebugGroup()}let n;try{e.pushDebugGroup(`${this}.draw(${e})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();const i=this._getBindings();this.pipeline.setBindings(i,{disableWarnings:this.props.disableWarnings}),ZI(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);const{indexBuffer:s}=this.vertexArray,a=s?s.byteLength/(s.indexType==="uint32"?4:2):void 0;n=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:a,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{e.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(e),n?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",n}setGeometry(e){var n;(n=this._gpuGeometry)==null||n.destroy();const t=e&&Aae(this.device,e);if(t){this.setTopology(t.topology||"triangle-list");const i=new lI(this.bufferLayout);this.bufferLayout=i.mergeBufferLayouts(t.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(t)}this._gpuGeometry=t}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){const t=new lI(this.bufferLayout);this.bufferLayout=this._gpuGeometry?t.mergeBufferLayouts(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){XI(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,this.isInstanced===void 0&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new mne(this.shaderInputs.modules);for(const[t,n]of Object.entries(this.shaderInputs.modules))if(Tae(n)){const i=this._uniformStore.getManagedUniformBuffer(this.device,t);this.bindings[`${t}Uniforms`]=i}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,t){const n=(t==null?void 0:t.disableWarnings)??this.props.disableWarnings;e.indices&&an.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)();const i=new lI(this.bufferLayout);for(const[s,a]of Object.entries(e)){const o=i.getBufferLayout(s);if(!o){n||an.warn(`Model(${this.id}): Missing layout for buffer "${s}".`)();continue}const h=i.getAttributeNamesForBuffer(o);let f=!1;for(const _ of h){const x=this._attributeInfos[_];x&&(this.vertexArray.setBuffer(x.location,a),f=!0)}!f&&!n&&an.warn(`Model(${this.id}): Ignoring buffer "${a.id}" for unknown attribute "${s}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,t){for(const[n,i]of Object.entries(e)){const s=this._attributeInfos[n];s?this.vertexArray.setConstantWebGL(s.location,i):((t==null?void 0:t.disableWarnings)??this.props.disableWarnings)||an.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${n}"`)()}this.setNeedsRedraw("constants")}setUniforms(e){this.setUniformsWebGL(e)}setUniformsWebGL(e){ZI(e)||(this.pipeline.setUniformsWebGL(e),Object.assign(this.uniforms,e)),this.setNeedsRedraw("uniforms")}updateModuleSettingsWebGL(e){const{bindings:t,uniforms:n}=yN(this._getModuleUniforms(e));Object.assign(this.bindings,t),Object.assign(this.uniforms,n),this.setNeedsRedraw("moduleSettings")}_areBindingsLoading(){for(const e of Object.values(this.bindings))if(e instanceof JI&&!e.isReady)return e.id;return!1}_getBindings(){const e={};for(const[t,n]of Object.entries(this.bindings))n instanceof JI?n.isReady&&(e[t]=n.texture):e[t]=n;return e}_getBindingsUpdateTimestamp(){let e=0;for(const t of Object.values(this.bindings))t instanceof jx?e=Math.max(e,t.texture.updateTimestamp):t instanceof La||t instanceof ia?e=Math.max(e,t.updateTimestamp):t instanceof JI?e=t.texture?Math.max(e,t.texture.updateTimestamp):1/0:t instanceof Kx||(e=Math.max(e,t.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const t={...e.attributes};for(const[n]of Object.entries(t))!this.pipeline.shaderLayout.attributes.find(i=>i.name===n)&&n!=="positions"&&delete t[n];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(t,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||(this._pipelineNeedsUpdate=e),this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,t=null;this.pipeline&&(an.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,t=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const n=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders});let i=null;this.source?i=n:this.fs&&(i=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:n,fs:i}),this._attributeInfos=Sk(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),t&&this.shaderFactory.release(t)}return this.pipeline}_logDrawCallStart(){const e=an.level>3?0:Eae;an.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,an.group(Mg,`>>> DRAWING MODEL ${this.id}`,{collapsed:an.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=mae(this.pipeline.shaderLayout,this.id);an.table(Mg,e)();const t=this.shaderInputs.getDebugTable();for(const[i,s]of Object.entries(this.uniforms))t[i]={value:s};an.table(Mg,t)();const n=this._getAttributeDebugTable();an.table(Mg,this._attributeInfos)(),an.table(Mg,n)(),an.groupEnd(Mg)(),this._logOpen=!1}}_logFramebuffer(e){const t=this.device.props.debugFramebuffers;if(this._drawCount++,!t)return;const n=e.props.framebuffer;n&&_ae(n,{id:n.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[t,n]of Object.entries(this._attributeInfos)){const i=this.vertexArray.attributes[n.location];e[n.location]={name:t,type:n.shaderType,values:i?this._getBufferOrConstantValues(i,n.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){const{indexBuffer:t}=this.vertexArray,n=t.indexType==="uint32"?new Uint32Array(t.debugData):new Uint16Array(t.debugData);e.indices={name:"indices",type:t.indexType,values:n.toString()}}return e}_getBufferOrConstantValues(e,t){const n=Fk(t);return(e instanceof La?new n(e.debugData):e).toString()}};xe(aT,"defaultProps",{...v_.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:Nx.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0});let lp=aT;function Tae(r){return!!(r.uniformTypes&&!ZI(r.uniformTypes))}function Sae(r){return{type:r.type,shaderLanguage:r.info.shadingLanguage,shaderLanguageVersion:r.info.shadingLanguageVersion,gpu:r.info.gpu,features:r.features}}function ZI(r){for(const e in r)return!1;return!0}const Cv=class Cv{constructor(e){xe(this,"device");xe(this,"model");xe(this,"transformFeedback");let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Cv.defaultProps;if(!Cv.isSupported(e))throw new Error("BufferTransform not yet implemented on WebGPU");this.device=e,this.model=new lp(this.device,{id:t.id||"buffer-transform-model",fs:t.fs||lre(),topology:t.topology||"point-list",varyings:t.outputs||t.varyings,...t}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:t.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}static isSupported(e){var t;return((t=e==null?void 0:e.info)==null?void 0:t.type)==="webgl"}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){e!=null&&e.inputBuffers&&this.model.setAttributes(e.inputBuffers),e!=null&&e.outputBuffers&&this.transformFeedback.setBuffers(e.outputBuffers);const t=this.device.beginRenderPass(e);this.model.draw(t),t.end()}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const t=this.getBuffer(e);if(!t)throw new Error("BufferTransform#getBuffer");if(t instanceof La)return t.readAsync();const{buffer:n,byteOffset:i=0,byteLength:s=n.byteLength}=t;return n.readAsync(i,s)}};xe(Cv,"defaultProps",{...lp.defaultProps,outputs:void 0,feedbackBuffers:void 0});let w1=Cv;class R_{constructor(e){xe(this,"id");xe(this,"topology");xe(this,"vertexCount");xe(this,"indices");xe(this,"attributes");xe(this,"userData",{});const{attributes:t={},indices:n=null,vertexCount:i=null}=e;this.id=e.id||x1("geometry"),this.topology=e.topology,n&&(this.indices=ArrayBuffer.isView(n)?{value:n,size:1}:n),this.attributes={};for(const[s,a]of Object.entries(t)){const o=ArrayBuffer.isView(a)?{value:a}:a;if(!ArrayBuffer.isView(o.value))throw new Error(`${this._print(s)}: must be typed array or object with value as typed array`);if((s==="POSITION"||s==="positions")&&!o.size&&(o.size=3),s==="indices"){if(this.indices)throw new Error("Multiple indices detected");this.indices=o}else this.attributes[s]=o}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=i||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,t){return this}_calculateVertexCount(e,t){if(t)return t.value.length;let n=1/0;for(const i of Object.values(e)){const{value:s,size:a,constant:o}=i;!o&&s&&a!==void 0&&a>=1&&(n=Math.min(n,s.length/a))}return n}}const Iae={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...Iae}};const sd=globalThis.mathgl.config;function Mae(r){let{precision:e=sd.precision}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return r=Pae(r),`${parseFloat(r.toPrecision(e))}`}function ww(r){return Array.isArray(r)||ArrayBuffer.isView(r)&&!(r instanceof DataView)}function vN(r,e,t){const n=sd.EPSILON;try{if(r===e)return!0;if(ww(r)&&ww(e)){if(r.length!==e.length)return!1;for(let i=0;i<r.length;++i)if(!vN(r[i],e[i]))return!1;return!0}return r&&r.equals?r.equals(e):e&&e.equals?e.equals(r):typeof r=="number"&&typeof e=="number"?Math.abs(r-e)<=sd.EPSILON*Math.max(1,Math.abs(r),Math.abs(e)):!1}finally{sd.EPSILON=n}}function Pae(r){return Math.round(r/sd.EPSILON)*sd.EPSILON}let xN=class extends Array{clone(){return new this.constructor().copy(this)}fromArray(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;for(let n=0;n<this.ELEMENTS;++n)this[n]=e[n+t];return this.check()}toArray(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;for(let n=0;n<this.ELEMENTS;++n)e[t+n]=this[n];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:ww(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(sd)}formatString(e){let t="";for(let n=0;n<this.ELEMENTS;++n)t+=(n>0?", ":"")+Mae(this[n],e);return`${e.printTypes?this.constructor.name:""}[${t}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(!vN(this[t],e[t]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(this[t]!==e[t])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,t,n){if(n===void 0)return this.lerp(this,e,t);for(let i=0;i<this.ELEMENTS;++i){const s=e[i],a=typeof t=="number"?t:t[i];this[i]=s+n*(a-s)}return this.check()}min(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}max(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}clamp(e,t){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e[n]),t[n]);return this.check()}add(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(const i of t)for(let s=0;s<this.ELEMENTS;++s)this[s]+=i[s];return this.check()}subtract(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(const i of t)for(let s=0;s<this.ELEMENTS;++s)this[s]-=i[s];return this.check()}scale(e){if(typeof e=="number")for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;else for(let t=0;t<this.ELEMENTS&&t<e.length;++t)this[t]*=e[t];return this.check()}multiplyByScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}check(){if(sd.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let t=0;t<this.ELEMENTS;++t)e=e&&Number.isFinite(this[t]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}addScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,t){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e),t);return this.check()}get elements(){return this}};function Fae(r,e){if(r.length!==e)return!1;for(let t=0;t<r.length;++t)if(!Number.isFinite(r[t]))return!1;return!0}function xh(r){if(!Number.isFinite(r))throw new Error(`Invalid number ${JSON.stringify(r)}`);return r}function YI(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";if(sd.debug&&!Fae(r,e))throw new Error(`math.gl: ${t} some fields set to invalid numbers'`);return r}function wN(r,e){if(!r)throw new Error(`math.gl assertion ${e}`)}let Rae=class extends xN{get x(){return this[0]}set x(e){this[0]=xh(e)}get y(){return this[1]}set y(e){this[1]=xh(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let t=0;for(let n=0;n<this.ELEMENTS;++n){const i=this[n]-e[n];t+=i*i}return xh(t)}dot(e){let t=0;for(let n=0;n<this.ELEMENTS;++n)t+=this[n]*e[n];return xh(t)}normalize(){const e=this.magnitude();if(e!==0)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}multiply(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(const i of t)for(let s=0;s<this.ELEMENTS;++s)this[s]*=i[s];return this.check()}divide(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(const i of t)for(let s=0;s<this.ELEMENTS;++s)this[s]/=i[s];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return wN(e>=0&&e<this.ELEMENTS,"index is out of range"),xh(this[e])}setComponent(e,t){return wN(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=t,this.check()}addVectors(e,t){return this.copy(e).add(t)}subVectors(e,t){return this.copy(e).subtract(t)}multiplyVectors(e,t){return this.copy(e).multiply(t)}addScaledVector(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}};const Bw=1e-6;let L_=typeof Float32Array<"u"?Float32Array:Array;function Lae(){const r=new L_(2);return L_!=Float32Array&&(r[0]=0,r[1]=0),r}function Dae(r,e,t){const n=e[0],i=e[1];return r[0]=t[0]*n+t[4]*i+t[12],r[1]=t[1]*n+t[5]*i+t[13],r}(function(){const r=Lae();return function(e,t,n,i,s,a){let o,h;for(t||(t=2),n||(n=0),i?h=Math.min(i*t+n,e.length):h=e.length,o=n;o<h;o+=t)r[0]=e[o],r[1]=e[o+1],s(r,r,a),e[o]=r[0],e[o+1]=r[1];return e}})();function Oae(r,e,t){const n=e[0],i=e[1],s=t[3]*n+t[7]*i||1;return r[0]=(t[0]*n+t[4]*i)/s,r[1]=(t[1]*n+t[5]*i)/s,r}function BN(r,e,t){const n=e[0],i=e[1],s=e[2],a=t[3]*n+t[7]*i+t[11]*s||1;return r[0]=(t[0]*n+t[4]*i+t[8]*s)/a,r[1]=(t[1]*n+t[5]*i+t[9]*s)/a,r[2]=(t[2]*n+t[6]*i+t[10]*s)/a,r}function kae(r,e,t){const n=e[0],i=e[1];return r[0]=t[0]*n+t[2]*i,r[1]=t[1]*n+t[3]*i,r[2]=e[2],r}function Uae(){const r=new L_(3);return L_!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function Nae(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]}function zae(r,e,t){const n=e[0],i=e[1],s=e[2],a=t[0],o=t[1],h=t[2];return r[0]=i*h-s*o,r[1]=s*a-n*h,r[2]=n*o-i*a,r}function CN(r,e,t){const n=e[0],i=e[1],s=e[2];let a=t[3]*n+t[7]*i+t[11]*s+t[15];return a=a||1,r[0]=(t[0]*n+t[4]*i+t[8]*s+t[12])/a,r[1]=(t[1]*n+t[5]*i+t[9]*s+t[13])/a,r[2]=(t[2]*n+t[6]*i+t[10]*s+t[14])/a,r}function Hae(r,e,t){const n=e[0],i=e[1],s=e[2];return r[0]=n*t[0]+i*t[3]+s*t[6],r[1]=n*t[1]+i*t[4]+s*t[7],r[2]=n*t[2]+i*t[5]+s*t[8],r}function Vae(r,e,t){const n=t[0],i=t[1],s=t[2],a=t[3],o=e[0],h=e[1],f=e[2];let _=i*f-s*h,x=s*o-n*f,T=n*h-i*o,I=i*T-s*x,N=s*_-n*T,$=n*x-i*_;const W=a*2;return _*=W,x*=W,T*=W,I*=2,N*=2,$*=2,r[0]=o+_+I,r[1]=h+x+N,r[2]=f+T+$,r}function Gae(r,e,t,n){const i=[],s=[];return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],s[0]=i[0],s[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),s[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),r[0]=s[0]+t[0],r[1]=s[1]+t[1],r[2]=s[2]+t[2],r}function Qae(r,e,t,n){const i=[],s=[];return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],s[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),s[1]=i[1],s[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),r[0]=s[0]+t[0],r[1]=s[1]+t[1],r[2]=s[2]+t[2],r}function $ae(r,e,t,n){const i=[],s=[];return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],s[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),s[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),s[2]=i[2],r[0]=s[0]+t[0],r[1]=s[1]+t[1],r[2]=s[2]+t[2],r}function jae(r,e){const t=r[0],n=r[1],i=r[2],s=e[0],a=e[1],o=e[2],h=Math.sqrt((t*t+n*n+i*i)*(s*s+a*a+o*o)),f=h&&Nae(r,e)/h;return Math.acos(Math.min(Math.max(f,-1),1))}(function(){const r=Uae();return function(e,t,n,i,s,a){let o,h;for(t||(t=3),n||(n=0),i?h=Math.min(i*t+n,e.length):h=e.length,o=n;o<h;o+=t)r[0]=e[o],r[1]=e[o+1],r[2]=e[o+2],s(r,r,a),e[o]=r[0],e[o+1]=r[1],e[o+2]=r[2];return e}})();const e3=[0,0,0];let Cw,D_=class RZ extends Rae{static get ZERO(){return Cw||(Cw=new RZ(0,0,0),Object.freeze(Cw)),Cw}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;super(-0,-0,-0),arguments.length===1&&ww(e)?this.copy(e):(sd.debug&&(xh(e),xh(t),xh(n)),this[0]=e,this[1]=t,this[2]=n)}set(e,t,n){return this[0]=e,this[1]=t,this[2]=n,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return sd.debug&&(xh(e.x),xh(e.y),xh(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=xh(e)}angle(e){return jae(this,e)}cross(e){return zae(this,this,e),this.check()}rotateX(e){let{radians:t,origin:n=e3}=e;return Gae(this,this,n,t),this.check()}rotateY(e){let{radians:t,origin:n=e3}=e;return Qae(this,this,n,t),this.check()}rotateZ(e){let{radians:t,origin:n=e3}=e;return $ae(this,this,n,t),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return CN(this,this,e),this.check()}transformAsVector(e){return BN(this,this,e),this.check()}transformByMatrix3(e){return Hae(this,this,e),this.check()}transformByMatrix2(e){return kae(this,this,e),this.check()}transformByQuaternion(e){return Vae(this,this,e),this.check()}},qae=class extends xN{toString(){let e="[";if(sd.printRowMajor){e+="row-major:";for(let t=0;t<this.RANK;++t)for(let n=0;n<this.RANK;++n)e+=` ${this[n*this.RANK+t]}`}else{e+="column-major:";for(let t=0;t<this.ELEMENTS;++t)e+=` ${this[t]}`}return e+="]",e}getElementIndex(e,t){return t*this.RANK+e}getElement(e,t){return this[t*this.RANK+e]}setElement(e,t,n){return this[t*this.RANK+e]=xh(n),this}getColumn(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Array(this.RANK).fill(-0);const n=e*this.RANK;for(let i=0;i<this.RANK;++i)t[i]=this[n+i];return t}setColumn(e,t){const n=e*this.RANK;for(let i=0;i<this.RANK;++i)this[n+i]=t[i];return this}};function Kae(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Wae(r,e){if(r===e){const t=e[1],n=e[2],i=e[3],s=e[6],a=e[7],o=e[11];r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=t,r[6]=e[9],r[7]=e[13],r[8]=n,r[9]=s,r[11]=e[14],r[12]=i,r[13]=a,r[14]=o}else r[0]=e[0],r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=e[1],r[5]=e[5],r[6]=e[9],r[7]=e[13],r[8]=e[2],r[9]=e[6],r[10]=e[10],r[11]=e[14],r[12]=e[3],r[13]=e[7],r[14]=e[11],r[15]=e[15];return r}function Xae(r,e){const t=e[0],n=e[1],i=e[2],s=e[3],a=e[4],o=e[5],h=e[6],f=e[7],_=e[8],x=e[9],T=e[10],I=e[11],N=e[12],$=e[13],W=e[14],Y=e[15],ie=t*o-n*a,ce=t*h-i*a,fe=t*f-s*a,ve=n*h-i*o,be=n*f-s*o,Qe=i*f-s*h,Ue=_*$-x*N,st=_*W-T*N,at=_*Y-I*N,Le=x*W-T*$,ze=x*Y-I*$,tt=T*Y-I*W;let Ne=ie*tt-ce*ze+fe*Le+ve*at-be*st+Qe*Ue;return Ne?(Ne=1/Ne,r[0]=(o*tt-h*ze+f*Le)*Ne,r[1]=(i*ze-n*tt-s*Le)*Ne,r[2]=($*Qe-W*be+Y*ve)*Ne,r[3]=(T*be-x*Qe-I*ve)*Ne,r[4]=(h*at-a*tt-f*st)*Ne,r[5]=(t*tt-i*at+s*st)*Ne,r[6]=(W*fe-N*Qe-Y*ce)*Ne,r[7]=(_*Qe-T*fe+I*ce)*Ne,r[8]=(a*ze-o*at+f*Ue)*Ne,r[9]=(n*at-t*ze-s*Ue)*Ne,r[10]=(N*be-$*fe+Y*ie)*Ne,r[11]=(x*fe-_*be-I*ie)*Ne,r[12]=(o*st-a*Le-h*Ue)*Ne,r[13]=(t*Le-n*st+i*Ue)*Ne,r[14]=($*ce-N*ve-W*ie)*Ne,r[15]=(_*ve-x*ce+T*ie)*Ne,r):null}function Jae(r){const e=r[0],t=r[1],n=r[2],i=r[3],s=r[4],a=r[5],o=r[6],h=r[7],f=r[8],_=r[9],x=r[10],T=r[11],I=r[12],N=r[13],$=r[14],W=r[15],Y=e*a-t*s,ie=e*o-n*s,ce=t*o-n*a,fe=f*N-_*I,ve=f*$-x*I,be=_*$-x*N,Qe=e*be-t*ve+n*fe,Ue=s*be-a*ve+o*fe,st=f*ce-_*ie+x*Y,at=I*ce-N*ie+$*Y;return h*Qe-i*Ue+W*st-T*at}function EN(r,e,t){const n=e[0],i=e[1],s=e[2],a=e[3],o=e[4],h=e[5],f=e[6],_=e[7],x=e[8],T=e[9],I=e[10],N=e[11],$=e[12],W=e[13],Y=e[14],ie=e[15];let ce=t[0],fe=t[1],ve=t[2],be=t[3];return r[0]=ce*n+fe*o+ve*x+be*$,r[1]=ce*i+fe*h+ve*T+be*W,r[2]=ce*s+fe*f+ve*I+be*Y,r[3]=ce*a+fe*_+ve*N+be*ie,ce=t[4],fe=t[5],ve=t[6],be=t[7],r[4]=ce*n+fe*o+ve*x+be*$,r[5]=ce*i+fe*h+ve*T+be*W,r[6]=ce*s+fe*f+ve*I+be*Y,r[7]=ce*a+fe*_+ve*N+be*ie,ce=t[8],fe=t[9],ve=t[10],be=t[11],r[8]=ce*n+fe*o+ve*x+be*$,r[9]=ce*i+fe*h+ve*T+be*W,r[10]=ce*s+fe*f+ve*I+be*Y,r[11]=ce*a+fe*_+ve*N+be*ie,ce=t[12],fe=t[13],ve=t[14],be=t[15],r[12]=ce*n+fe*o+ve*x+be*$,r[13]=ce*i+fe*h+ve*T+be*W,r[14]=ce*s+fe*f+ve*I+be*Y,r[15]=ce*a+fe*_+ve*N+be*ie,r}function Zae(r,e,t){const n=t[0],i=t[1],s=t[2];let a,o,h,f,_,x,T,I,N,$,W,Y;return e===r?(r[12]=e[0]*n+e[4]*i+e[8]*s+e[12],r[13]=e[1]*n+e[5]*i+e[9]*s+e[13],r[14]=e[2]*n+e[6]*i+e[10]*s+e[14],r[15]=e[3]*n+e[7]*i+e[11]*s+e[15]):(a=e[0],o=e[1],h=e[2],f=e[3],_=e[4],x=e[5],T=e[6],I=e[7],N=e[8],$=e[9],W=e[10],Y=e[11],r[0]=a,r[1]=o,r[2]=h,r[3]=f,r[4]=_,r[5]=x,r[6]=T,r[7]=I,r[8]=N,r[9]=$,r[10]=W,r[11]=Y,r[12]=a*n+_*i+N*s+e[12],r[13]=o*n+x*i+$*s+e[13],r[14]=h*n+T*i+W*s+e[14],r[15]=f*n+I*i+Y*s+e[15]),r}function Yae(r,e,t){const n=t[0],i=t[1],s=t[2];return r[0]=e[0]*n,r[1]=e[1]*n,r[2]=e[2]*n,r[3]=e[3]*n,r[4]=e[4]*i,r[5]=e[5]*i,r[6]=e[6]*i,r[7]=e[7]*i,r[8]=e[8]*s,r[9]=e[9]*s,r[10]=e[10]*s,r[11]=e[11]*s,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function ele(r,e,t,n){let i=n[0],s=n[1],a=n[2],o=Math.sqrt(i*i+s*s+a*a),h,f,_,x,T,I,N,$,W,Y,ie,ce,fe,ve,be,Qe,Ue,st,at,Le,ze,tt,Ne,Ht;return o<Bw?null:(o=1/o,i*=o,s*=o,a*=o,f=Math.sin(t),h=Math.cos(t),_=1-h,x=e[0],T=e[1],I=e[2],N=e[3],$=e[4],W=e[5],Y=e[6],ie=e[7],ce=e[8],fe=e[9],ve=e[10],be=e[11],Qe=i*i*_+h,Ue=s*i*_+a*f,st=a*i*_-s*f,at=i*s*_-a*f,Le=s*s*_+h,ze=a*s*_+i*f,tt=i*a*_+s*f,Ne=s*a*_-i*f,Ht=a*a*_+h,r[0]=x*Qe+$*Ue+ce*st,r[1]=T*Qe+W*Ue+fe*st,r[2]=I*Qe+Y*Ue+ve*st,r[3]=N*Qe+ie*Ue+be*st,r[4]=x*at+$*Le+ce*ze,r[5]=T*at+W*Le+fe*ze,r[6]=I*at+Y*Le+ve*ze,r[7]=N*at+ie*Le+be*ze,r[8]=x*tt+$*Ne+ce*Ht,r[9]=T*tt+W*Ne+fe*Ht,r[10]=I*tt+Y*Ne+ve*Ht,r[11]=N*tt+ie*Ne+be*Ht,e!==r&&(r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r)}function tle(r,e,t){const n=Math.sin(t),i=Math.cos(t),s=e[4],a=e[5],o=e[6],h=e[7],f=e[8],_=e[9],x=e[10],T=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=s*i+f*n,r[5]=a*i+_*n,r[6]=o*i+x*n,r[7]=h*i+T*n,r[8]=f*i-s*n,r[9]=_*i-a*n,r[10]=x*i-o*n,r[11]=T*i-h*n,r}function rle(r,e,t){const n=Math.sin(t),i=Math.cos(t),s=e[0],a=e[1],o=e[2],h=e[3],f=e[8],_=e[9],x=e[10],T=e[11];return e!==r&&(r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=s*i-f*n,r[1]=a*i-_*n,r[2]=o*i-x*n,r[3]=h*i-T*n,r[8]=s*n+f*i,r[9]=a*n+_*i,r[10]=o*n+x*i,r[11]=h*n+T*i,r}function nle(r,e,t){const n=Math.sin(t),i=Math.cos(t),s=e[0],a=e[1],o=e[2],h=e[3],f=e[4],_=e[5],x=e[6],T=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=s*i+f*n,r[1]=a*i+_*n,r[2]=o*i+x*n,r[3]=h*i+T*n,r[4]=f*i-s*n,r[5]=_*i-a*n,r[6]=x*i-o*n,r[7]=T*i-h*n,r}function ile(r,e){const t=e[0],n=e[1],i=e[2],s=e[3],a=t+t,o=n+n,h=i+i,f=t*a,_=n*a,x=n*o,T=i*a,I=i*o,N=i*h,$=s*a,W=s*o,Y=s*h;return r[0]=1-x-N,r[1]=_+Y,r[2]=T-W,r[3]=0,r[4]=_-Y,r[5]=1-f-N,r[6]=I+$,r[7]=0,r[8]=T+W,r[9]=I-$,r[10]=1-f-x,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function sle(r,e,t,n,i,s,a){const o=1/(t-e),h=1/(i-n),f=1/(s-a);return r[0]=s*2*o,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=s*2*h,r[6]=0,r[7]=0,r[8]=(t+e)*o,r[9]=(i+n)*h,r[10]=(a+s)*f,r[11]=-1,r[12]=0,r[13]=0,r[14]=a*s*2*f,r[15]=0,r}function ole(r,e,t,n,i){const s=1/Math.tan(e/2);if(r[0]=s/t,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=s,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,i!=null&&i!==1/0){const a=1/(n-i);r[10]=(i+n)*a,r[14]=2*i*n*a}else r[10]=-1,r[14]=-2*n;return r}const ale=ole;function lle(r,e,t,n,i,s,a){const o=1/(e-t),h=1/(n-i),f=1/(s-a);return r[0]=-2*o,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*h,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*f,r[11]=0,r[12]=(e+t)*o,r[13]=(i+n)*h,r[14]=(a+s)*f,r[15]=1,r}const cle=lle;function ule(r,e,t,n){let i,s,a,o,h,f,_,x,T,I;const N=e[0],$=e[1],W=e[2],Y=n[0],ie=n[1],ce=n[2],fe=t[0],ve=t[1],be=t[2];return Math.abs(N-fe)<Bw&&Math.abs($-ve)<Bw&&Math.abs(W-be)<Bw?Kae(r):(x=N-fe,T=$-ve,I=W-be,i=1/Math.sqrt(x*x+T*T+I*I),x*=i,T*=i,I*=i,s=ie*I-ce*T,a=ce*x-Y*I,o=Y*T-ie*x,i=Math.sqrt(s*s+a*a+o*o),i?(i=1/i,s*=i,a*=i,o*=i):(s=0,a=0,o=0),h=T*o-I*a,f=I*s-x*o,_=x*a-T*s,i=Math.sqrt(h*h+f*f+_*_),i?(i=1/i,h*=i,f*=i,_*=i):(h=0,f=0,_=0),r[0]=s,r[1]=h,r[2]=x,r[3]=0,r[4]=a,r[5]=f,r[6]=T,r[7]=0,r[8]=o,r[9]=_,r[10]=I,r[11]=0,r[12]=-(s*N+a*$+o*W),r[13]=-(h*N+f*$+_*W),r[14]=-(x*N+T*$+I*W),r[15]=1,r)}function hle(){const r=new L_(4);return L_!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0,r[3]=0),r}function dle(r,e,t){const n=e[0],i=e[1],s=e[2],a=e[3];return r[0]=t[0]*n+t[4]*i+t[8]*s+t[12]*a,r[1]=t[1]*n+t[5]*i+t[9]*s+t[13]*a,r[2]=t[2]*n+t[6]*i+t[10]*s+t[14]*a,r[3]=t[3]*n+t[7]*i+t[11]*s+t[15]*a,r}(function(){const r=hle();return function(e,t,n,i,s,a){let o,h;for(t||(t=4),n||(n=0),i?h=Math.min(i*t+n,e.length):h=e.length,o=n;o<h;o+=t)r[0]=e[o],r[1]=e[o+1],r[2]=e[o+2],r[3]=e[o+3],s(r,r,a),e[o]=r[0],e[o+1]=r[1],e[o+2]=r[2],e[o+3]=r[3];return e}})();var t3;(function(r){r[r.COL0ROW0=0]="COL0ROW0",r[r.COL0ROW1=1]="COL0ROW1",r[r.COL0ROW2=2]="COL0ROW2",r[r.COL0ROW3=3]="COL0ROW3",r[r.COL1ROW0=4]="COL1ROW0",r[r.COL1ROW1=5]="COL1ROW1",r[r.COL1ROW2=6]="COL1ROW2",r[r.COL1ROW3=7]="COL1ROW3",r[r.COL2ROW0=8]="COL2ROW0",r[r.COL2ROW1=9]="COL2ROW1",r[r.COL2ROW2=10]="COL2ROW2",r[r.COL2ROW3=11]="COL2ROW3",r[r.COL3ROW0=12]="COL3ROW0",r[r.COL3ROW1=13]="COL3ROW1",r[r.COL3ROW2=14]="COL3ROW2",r[r.COL3ROW3=15]="COL3ROW3"})(t3||(t3={}));const fle=45*Math.PI/180,Ale=1,r3=.1,n3=500,ple=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);let O_=class extends qae{static get IDENTITY(){return mle()}static get ZERO(){return gle()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return t3}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,t,n,i,s,a,o,h,f,_,x,T,I,N,$,W){return this[0]=e,this[1]=t,this[2]=n,this[3]=i,this[4]=s,this[5]=a,this[6]=o,this[7]=h,this[8]=f,this[9]=_,this[10]=x,this[11]=T,this[12]=I,this[13]=N,this[14]=$,this[15]=W,this.check()}setRowMajor(e,t,n,i,s,a,o,h,f,_,x,T,I,N,$,W){return this[0]=e,this[1]=s,this[2]=f,this[3]=I,this[4]=t,this[5]=a,this[6]=_,this[7]=N,this[8]=n,this[9]=o,this[10]=x,this[11]=$,this[12]=i,this[13]=h,this[14]=T,this[15]=W,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(ple)}fromObject(e){return this.check()}fromQuaternion(e){return ile(this,e),this.check()}frustum(e){const{left:t,right:n,bottom:i,top:s,near:a=r3,far:o=n3}=e;return o===1/0?_le(this,t,n,i,s,a):sle(this,t,n,i,s,a,o),this.check()}lookAt(e){const{eye:t,center:n=[0,0,0],up:i=[0,1,0]}=e;return ule(this,t,n,i),this.check()}ortho(e){const{left:t,right:n,bottom:i,top:s,near:a=r3,far:o=n3}=e;return cle(this,t,n,i,s,a,o),this.check()}orthographic(e){const{fovy:t=fle,aspect:n=Ale,focalDistance:i=1,near:s=r3,far:a=n3}=e;TN(t);const o=t/2,h=i*Math.tan(o),f=h*n;return this.ortho({left:-f,right:f,bottom:-h,top:h,near:s,far:a})}perspective(e){const{fovy:t=45*Math.PI/180,aspect:n=1,near:i=.1,far:s=500}=e;return TN(t),ale(this,t,n,i,s),this.check()}determinant(){return Jae(this)}getScale(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[-0,-0,-0];return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[-0,-0,-0];return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const n=this.getScale(t),i=1/n[0],s=1/n[1],a=1/n[2];return e[0]=this[0]*i,e[1]=this[1]*s,e[2]=this[2]*a,e[3]=0,e[4]=this[4]*i,e[5]=this[5]*s,e[6]=this[6]*a,e[7]=0,e[8]=this[8]*i,e[9]=this[9]*s,e[10]=this[10]*a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const n=this.getScale(t),i=1/n[0],s=1/n[1],a=1/n[2];return e[0]=this[0]*i,e[1]=this[1]*s,e[2]=this[2]*a,e[3]=this[4]*i,e[4]=this[5]*s,e[5]=this[6]*a,e[6]=this[8]*i,e[7]=this[9]*s,e[8]=this[10]*a,e}transpose(){return Wae(this,this),this.check()}invert(){return Xae(this,this),this.check()}multiplyLeft(e){return EN(this,e,this),this.check()}multiplyRight(e){return EN(this,this,e),this.check()}rotateX(e){return tle(this,this,e),this.check()}rotateY(e){return rle(this,this,e),this.check()}rotateZ(e){return nle(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,t){return ele(this,this,e,t),this.check()}scale(e){return Yae(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return Zae(this,this,e),this.check()}transform(e,t){return e.length===4?(t=dle(t||[-0,-0,-0,-0],e,this),YI(t,4),t):this.transformAsPoint(e,t)}transformAsPoint(e,t){const{length:n}=e;let i;switch(n){case 2:i=Dae(t||[-0,-0],e,this);break;case 3:i=CN(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return YI(i,e.length),i}transformAsVector(e,t){let n;switch(e.length){case 2:n=Oae(t||[-0,-0],e,this);break;case 3:n=BN(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return YI(n,e.length),n}transformPoint(e,t){return this.transformAsPoint(e,t)}transformVector(e,t){return this.transformAsPoint(e,t)}transformDirection(e,t){return this.transformAsVector(e,t)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,t,n){return this.identity().translate([e,t,n])}},Ew,Tw;function gle(){return Ew||(Ew=new O_([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(Ew)),Ew}function mle(){return Tw||(Tw=new O_,Object.freeze(Tw)),Tw}function TN(r){if(r>Math.PI*2)throw Error("expected radians")}function _le(r,e,t,n,i,s){const a=2*s/(t-e),o=2*s/(i-n),h=(t+e)/(t-e),f=(i+n)/(i-n),_=-1,x=-1,T=-2*s;return r[0]=a,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=o,r[6]=0,r[7]=0,r[8]=h,r[9]=f,r[10]=_,r[11]=x,r[12]=0,r[13]=0,r[14]=T,r[15]=0,r}class Sw{constructor(){xe(this,"id");xe(this,"matrix",new O_);xe(this,"display",!0);xe(this,"position",new D_);xe(this,"rotation",new D_);xe(this,"scale",new D_(1,1,1));xe(this,"userData",{});xe(this,"props",{});let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:t}=e;this.id=t||x1(this.constructor.name),this._setScenegraphNodeProps(e)}getBounds(){return null}destroy(){}delete(){this.destroy()}setProps(e){return this._setScenegraphNodeProps(e),this}toString(){return`{type: ScenegraphNode, id: ${this.id})}`}setPosition(e){return this.position=e,this}setRotation(e){return this.rotation=e,this}setScale(e){return this.scale=e,this}setMatrix(e){(arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0)?this.matrix.copy(e):this.matrix=e}setMatrixComponents(e){const{position:t,rotation:n,scale:i,update:s=!0}=e;return t&&this.setPosition(t),n&&this.setRotation(n),i&&this.setScale(i),s&&this.updateMatrix(),this}updateMatrix(){const e=this.position,t=this.rotation,n=this.scale;return this.matrix.identity(),this.matrix.translate(e),this.matrix.rotateXYZ(t),this.matrix.scale(n),this}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{position:t,rotation:n,scale:i}=e;return t&&this.setPosition(t),n&&this.setRotation(n),i&&this.setScale(i),this.updateMatrix(),this}getCoordinateUniforms(e,t){t=t||this.matrix;const n=new O_(e).multiplyRight(t),i=n.invert(),s=i.transpose();return{viewMatrix:e,modelMatrix:t,objectMatrix:t,worldMatrix:n,worldInverseMatrix:i,worldInverseTransposeMatrix:s}}_setScenegraphNodeProps(e){"position"in e&&this.setPosition(e.position),"rotation"in e&&this.setRotation(e.rotation),"scale"in e&&this.setScale(e.scale),"matrix"in e&&this.setMatrix(e.matrix),Object.assign(this.props,e)}}class k_ extends Sw{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};t=Array.isArray(t)?{children:t}:t;const{children:n=[]}=t;an.assert(n.every(i=>i instanceof Sw),"every child must an instance of ScenegraphNode");super(t);xe(this,"children");this.children=n}getBounds(){const t=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]];return this.traverse((n,i)=>{let{worldMatrix:s}=i;const a=n.getBounds();if(!a)return;const[o,h]=a,f=new D_(o).add(h).divide([2,2,2]);s.transformAsPoint(f,f);const _=new D_(h).subtract(o).divide([2,2,2]);s.transformAsVector(_,_);for(let x=0;x<8;x++){const T=new D_(x&1?-1:1,x&2?-1:1,x&4?-1:1).multiply(_).add(f);for(let I=0;I<3;I++)t[0][I]=Math.min(t[0][I],T[I]),t[1][I]=Math.max(t[1][I],T[I])}}),Number.isFinite(t[0][0])?t:null}destroy(){this.children.forEach(t=>t.destroy()),this.removeAll(),super.destroy()}add(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];for(const s of n)Array.isArray(s)?this.add(...s):this.children.push(s);return this}remove(t){const n=this.children,i=n.indexOf(t);return i>-1&&n.splice(i,1),this}removeAll(){return this.children=[],this}traverse(t){let{worldMatrix:n=new O_}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=new O_(n).multiplyRight(this.matrix);for(const s of this.children)s instanceof k_?s.traverse(t,{worldMatrix:i}):t(s,{worldMatrix:i})}}class i3 extends Sw{constructor(t){super(t);xe(this,"model");xe(this,"bounds",null);xe(this,"managedResources");this.model=t.model,this.managedResources=t.managedResources||[],this.bounds=t.bounds||null,this.setProps(t)}destroy(){this.model&&(this.model.destroy(),this.model=null),this.managedResources.forEach(t=>t.destroy()),this.managedResources=[]}getBounds(){return this.bounds}draw(t){return this.model.draw(t)}}const yle={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"};class SN extends GI{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer(e){let{layers:t,layerFilter:n,views:i,viewports:s,onViewportActive:a,pickingFBO:o,deviceRect:{x:h,y:f,width:_,height:x},cullRect:T,effects:I,pass:N="picking",pickZ:$,shaderModuleProps:W}=e;this.pickZ=$;const Y=this._resetColorEncoder($),ie=[h,f,_,x],ce=super.render({target:o,layers:t,layerFilter:n,views:i,viewports:s,onViewportActive:a,cullRect:T,effects:I==null?void 0:I.filter(ve=>ve.useInPicking),pass:N,isPicking:!0,shaderModuleProps:W,clearColor:[0,0,0,0],colorMask:15,scissorRect:ie});return this._colorEncoderState=null,{decodePickingColor:Y&&vle.bind(null,Y),stats:ce}}shouldDrawLayer(e){const{pickable:t,operation:n}=e.props;return t&&n.includes("draw")||n.includes("terrain")||n.includes("mask")}getShaderModuleProps(e,t,n){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(e,t,n){const i={...e.props.parameters},{pickable:s,operation:a}=e.props;return!this._colorEncoderState||a.includes("terrain")?i.blend=!1:s&&a.includes("draw")&&(Object.assign(i,yle),i.blend=!0,i.blendColor=ble(this._colorEncoderState,e,n)),i}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function ble(r,e,t){const{byLayer:n,byAlpha:i}=r;let s,a=n.get(e);return a?(a.viewports.push(t),s=a.a):(s=n.size+1,s<=255?(a={a:s,layer:e,viewports:[t]},n.set(e,a),i[s]=a):(Es.warn("Too many pickable layers, only picking the first 255")(),s=0)),[0,0,0,s/255]}function vle(r,e){const t=r.byAlpha[e[3]];return t&&{pickedLayer:t.layer,pickedViewports:t.viewports,pickedObjectIndex:t.layer.decodePickingColor(e)}}const U_={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},Iw=Symbol.for("component"),cp=Symbol.for("propTypes"),s3=Symbol.for("deprecatedProps"),N_=Symbol.for("asyncPropDefaults"),Pg=Symbol.for("asyncPropOriginal"),up=Symbol.for("asyncPropResolved");function Mw(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:()=>!0;return Array.isArray(r)?IN(r,e,[]):e(r)?[r]:[]}function IN(r,e,t){let n=-1;for(;++n<r.length;){const i=r[n];Array.isArray(i)?IN(i,e,t):e(i)&&t.push(i)}return t}function xle(r){let{target:e,source:t,start:n=0,count:i=1}=r;const s=t.length,a=i*s;let o=0;for(let h=n;o<s;o++)e[h++]=t[o];for(;o<a;)o<a-o?(e.copyWithin(n+o,n,n+o),o*=2):(e.copyWithin(n+o,n,n+a-o),o=a);return e}class wle{constructor(e,t,n){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=n,this.setData(t)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,t){if(e===this._data&&!t)return;this._data=e;const n=++this._loadCount;let i=e;typeof e=="string"&&(i=RS(e)),i instanceof Promise?(this.isLoaded=!1,this._loader=i.then(s=>{this._loadCount===n&&(this.isLoaded=!0,this._error=void 0,this._content=s)}).catch(s=>{this._loadCount===n&&(this.isLoaded=!0,this._error=s||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const s of this._subscribers)s.onChange(this.getData())}}class Ble{constructor(e){var t;this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:(t=e.device)==null?void 0:t.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add(e){let{resourceId:t,data:n,forceUpdate:i=!1,persistent:s=!0}=e,a=this._resources[t];a?a.setData(n,i):(a=new wle(t,n,this._context),this._resources[t]=a),a.persistent=s}remove(e){const t=this._resources[e];t&&(t.delete(),delete this._resources[e])}unsubscribe(e){let{consumerId:t}=e;const n=this._consumers[t];if(n){for(const i in n){const s=n[i],a=this._resources[s.resourceId];a&&a.unsubscribe(s)}delete this._consumers[t],this.prune()}}subscribe(e){let{resourceId:t,onChange:n,consumerId:i,requestId:s="default"}=e;const{_resources:a,protocol:o}=this;t.startsWith(o)&&(t=t.replace(o,""),a[t]||this.add({resourceId:t,data:null,persistent:!1}));const h=a[t];if(this._track(i,s,h,n),h)return h.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,t,n,i){const s=this._consumers,a=s[e]=s[e]||{};let o=a[t];const h=o&&o.resourceId&&this._resources[o.resourceId];h&&(h.unsubscribe(o),this.prune()),n&&(o?(o.onChange=i,o.resourceId=n.id):o={onChange:i,resourceId:n.id},a[t]=o,n.subscribe(o))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const t=this._resources[e];!t.persistent&&!t.inUse()&&(t.delete(),delete this._resources[e])}}}const Cle="layerManager.setLayers",Ele="layerManager.activateViewport";class Tle{constructor(e,t){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=o=>{Wc(Ele,this,o),o&&(this.context.viewport=o)};const{deck:n,stats:i,viewport:s,timeline:a}=t||{};this.layers=[],this.resourceManager=new Ble({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e==null?void 0:e.gl,deck:n,shaderAssembler:Doe(),defaultShaderModules:[uie],renderPass:void 0,stats:i||new mO({id:"deck.gl"}),viewport:s||new F_({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:a||new pN,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1},t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const n of this.layers){const i=n.getNeedsRedraw(e);t=t||i}return t}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers(){let{layerIds:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e?this.layers.filter(t=>e.find(n=>t.id.indexOf(n)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,t){Wc(Cle,this,t,e),this._lastRenderedLayers=e;const n=Mw(e,Boolean);for(const i of n)i.context=this.context;this._updateLayers(this.layers,n)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:t}=this.context;t.find(n=>n.name===e.name)||(t.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:t}=this.context,n=t.findIndex(i=>i.name===e.name);n>=0&&(t.splice(n,1),this._defaultShaderModulesChanged=!0)}_handleError(e,t,n){n.raiseError(t,`${e} of ${n}`)}_updateLayers(e,t){const n={};for(const a of e)n[a.id]?Es.warn(`Multiple old layers with same id ${a.id}`)():n[a.id]=a;if(this._defaultShaderModulesChanged){for(const a of e)a.setNeedsUpdate(),a.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const i=[];this._updateSublayersRecursively(t,n,i),this._finalizeOldLayers(n);let s=!1;for(const a of i)if(a.hasUniformTransition()){s=`Uniform transition in ${a}`;break}this._needsUpdate=s,this.layers=i}_updateSublayersRecursively(e,t,n){for(const i of e){i.context=this.context;const s=t[i.id];s===null&&Es.warn(`Multiple new layers with same id ${i.id}`)(),t[i.id]=null;let a=null;try{this._debug&&s!==i&&i.validateProps(),s?(this._transferLayerState(s,i),this._updateLayer(i)):this._initializeLayer(i),n.push(i),a=i.isComposite?i.getSubLayers():null}catch(o){this._handleError("matching",o,i)}a&&this._updateSublayersRecursively(a,t,n)}}_finalizeOldLayers(e){for(const t in e){const n=e[t];n&&this._finalizeLayer(n)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=U_.INITIALIZED}catch(t){this._handleError("initialization",t,e)}}_transferLayerState(e,t){t._transferState(e),t.lifecycle=U_.MATCHED,t!==e&&(e.lifecycle=U_.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(t){this._handleError("update",t,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=U_.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=U_.FINALIZED}catch(t){this._handleError("finalization",t,e)}}}function zd(r,e,t){if(r===e)return!0;if(!t||!r||!e)return!1;if(Array.isArray(r)){if(!Array.isArray(e)||r.length!==e.length)return!1;for(let n=0;n<r.length;n++)if(!zd(r[n],e[n],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof r=="object"&&typeof e=="object"){const n=Object.keys(r),i=Object.keys(e);if(n.length!==i.length)return!1;for(const s of n)if(!e.hasOwnProperty(s)||!zd(r[s],e[s],t-1))return!1;return!0}return!1}class Sle{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const t=this.controllers[e];t&&t.finalize()}this.controllers={}}needsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const t=this.controllers[e];t&&t.updateTransition()}}getViewports(e){return e?this._viewports.filter(t=>t.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(t=>{e[t.id]=t}),e}getView(e){return this.views.find(t=>t.id===e)}getViewState(e){const t=typeof e=="string"?this.getView(e):e,n=t&&this.viewState[t.getViewStateId()]||this.viewState;return t?t.filterViewState(n):n}getViewport(e){return this._viewportMap[e]}unproject(e,t){const n=this.getViewports(),i={x:e[0],y:e[1]};for(let s=n.length-1;s>=0;--s){const a=n[s];if(a.containsPixel(i)){const o=e.slice();return o[0]-=a.x,o[1]-=a.y,a.unproject(o,t)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,t){(e!==this.width||t!==this.height)&&(this.width=e,this.height=t,this.setNeedsUpdate("Size changed"))}_setViews(e){e=Mw(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!zd(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):Es.warn("missing `viewState` or `initialViewState`")()}_createController(e,t){const n=t.type;return new n({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:s=>{var a;return(a=this.getView(e.id))==null?void 0:a.makeViewport({viewState:s,width:this.width,height:this.height})}})}_updateController(e,t,n,i){const s=e.controller;if(s&&n){const a={...t,...s,id:e.id,x:n.x,y:n.y,width:n.width,height:n.height};return(!i||i.constructor!==s.type)&&(i=this._createController(e,a)),i&&i.setProps(a),i}return null}_rebuildViewports(){const{views:e}=this,t=this.controllers;this._viewports=[],this.controllers={};let n=!1;for(let i=e.length;i--;){const s=e[i],a=this.getViewState(s),o=s.makeViewport({viewState:a,width:this.width,height:this.height});let h=t[s.id];const f=!!s.controller;f&&!h&&(n=!0),(n||!f)&&h&&(h.finalize(),h=null),this.controllers[s.id]=this._updateController(s,a,o,h),o&&this._viewports.unshift(o)}for(const i in t){const s=t[i];s&&!this.controllers[i]&&s.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,t){return e.length!==t.length?!0:e.some((n,i)=>!e[i].equals(t[i]))}}const Ile=/([0-9]+\.?[0-9]*)(%|px)/;function hp(r){switch(typeof r){case"number":return{position:r,relative:!1};case"string":const e=Ile.exec(r);if(e&&e.length>=3){const t=e[2]==="%",n=parseFloat(e[1]);return{position:t?n/100:n,relative:t}}default:throw new Error(`Could not parse position string ${r}`)}}function dp(r,e){return r.relative?Math.round(r.position*e):r.position}class MN{constructor(e){const{id:t,x:n=0,y:i=0,width:s="100%",height:a="100%",padding:o=null}=e;this.id=t||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=hp(n),this._y=hp(i),this._width=hp(s),this._height=hp(a),this._padding=o&&{left:hp(o.left||0),right:hp(o.right||0),top:hp(o.top||0),bottom:hp(o.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.constructor===e.constructor&&zd(this.props,e.props,2)}makeViewport(e){let{width:t,height:n,viewState:i}=e;i=this.filterViewState(i);const s=this.getDimensions({width:t,height:n});if(!s.height||!s.width)return null;const a=this.getViewportType(i);return new a({...i,...this.props,...s})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const t={...e};for(const n in this.props.viewState)n!=="id"&&(t[n]=this.props.viewState[n]);return t}return e}getDimensions(e){let{width:t,height:n}=e;const i={x:dp(this._x,t),y:dp(this._y,n),width:dp(this._width,t),height:dp(this._height,n)};return this._padding&&(i.padding={left:dp(this._padding.left,t),top:dp(this._padding.top,n),right:dp(this._padding.right,t),bottom:dp(this._padding.bottom,n)}),i}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class Pw{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){var t,n;this.cancel(),this.settings=e,this._inProgress=!0,(n=(t=this.settings).onStart)==null||n.call(t,this)}end(){var e,t;this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(t=(e=this.settings).onEnd)==null||t.call(e,this))}cancel(){var e,t;this._inProgress&&((t=(e=this.settings).onInterrupt)==null||t.call(e,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){var e,t;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:n,settings:i}=this;this._handle=n.addChannel({delay:n.getTime(),duration:i.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(t=(e=this.settings).onUpdate)==null||t.call(e,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const PN=()=>{},o3={BREAK:1,SNAP_TO_END:2,IGNORE:3},Mle=r=>r,Ple=o3.BREAK;class Fle{constructor(e){this._onTransitionUpdate=t=>{const{time:n,settings:{interpolator:i,startProps:s,endProps:a,duration:o,easing:h}}=t,f=h(n/o),_=i.interpolateProps(s,a,f);this.propsInTransition=this.getControllerState({...this.props,..._}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new Pw(e.timeline),this.onViewStateChange=e.onViewStateChange||PN,this.onStateChange=e.onStateChange||PN}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let t=!1;const n=this.props;if(this.props=e,!n||this._shouldIgnoreViewportChange(n,e))return!1;if(this._isTransitionEnabled(e)){let i=n;if(this.transition.inProgress){const{interruption:s,endProps:a}=this.transition.settings;i={...n,...s===o3.SNAP_TO_END?a:this.propsInTransition||n}}this._triggerTransition(i,e),t=!0}else this.transition.cancel();return t}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:t,transitionInterpolator:n}=e;return(t>0||t==="auto")&&!!n}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,t){return this.transition.inProgress?this.transition.settings.interruption===o3.IGNORE||this._isUpdateDueToCurrentTransition(t):this._isTransitionEnabled(t)?t.transitionInterpolator.arePropsEqual(e,t):!0}_triggerTransition(e,t){const n=this.getControllerState(e),i=this.getControllerState(t).shortestPathFrom(n),s=t.transitionInterpolator,a=s.getDuration?s.getDuration(e,t):t.transitionDuration;if(a===0)return;const o=s.initializeProps(e,i);this.propsInTransition={};const h={duration:a,easing:t.transitionEasing||Mle,interpolator:s,interruption:t.transitionInterruption||Ple,startProps:o.start,endProps:o.end,onStart:t.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(t.onTransitionInterrupt),onEnd:this._onTransitionEnd(t.onTransitionEnd)};this.transition.start(h),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return t=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(t)}}}function Jc(r,e){if(!r)throw new Error(e||"deck.gl: assertion failed.")}class Rle{constructor(e){const{compare:t,extract:n,required:i}=e;this._propsToCompare=t,this._propsToExtract=n||t,this._requiredProps=i}arePropsEqual(e,t){for(const n of this._propsToCompare)if(!(n in e)||!(n in t)||!g1(e[n],t[n]))return!1;return!0}initializeProps(e,t){const n={},i={};for(const s of this._propsToExtract)(s in e||s in t)&&(n[s]=e[s],i[s]=t[s]);return this._checkRequiredProps(n),this._checkRequiredProps(i),{start:n,end:i}}getDuration(e,t){return t.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(t=>{const n=e[t];Jc(Number.isFinite(n)||Array.isArray(n),`${t} is required for transition`)})}}const Lle=["longitude","latitude","zoom","bearing","pitch"],Dle=["longitude","latitude","zoom"];class a3 extends Rle{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=Array.isArray(e)?e:e.transitionProps,n=Array.isArray(e)?{}:e;n.transitionProps=Array.isArray(t)?{compare:t,required:t}:t||{compare:Lle,required:Dle},super(n.transitionProps),this.opts=n}initializeProps(e,t){const n=super.initializeProps(e,t),{makeViewport:i,around:s}=this.opts;if(i&&s){const a=i(e),o=i(t),h=a.unproject(s);n.start.around=s,Object.assign(n.end,{around:o.project(h),aroundPosition:h,width:t.width,height:t.height})}return n}interpolateProps(e,t,n){const i={};for(const s of this._propsToExtract)i[s]=pw(e[s]||0,t[s]||0,n);if(t.aroundPosition&&this.opts.makeViewport){const s=this.opts.makeViewport({...t,...i});Object.assign(i,s.panByPosition(t.aroundPosition,pw(e.around,t.around,n)))}return i}}const fp={transitionDuration:0},Ole=300,Fw=r=>1-(1-r)*(1-r),z_={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],MULTI_PAN:["multipanstart","multipanmove","multipanend"],DOUBLE_CLICK:["dblclick"],KEYBOARD:["keydown"]},Fg={};class FN{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new Fle({...e,getControllerState:t=>new this.ControllerState(t),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){var e;for(const t in this._events)this._events[t]&&((e=this.eventManager)==null||e.off(t,this.handleEvent));this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const t=this._eventStartBlocked;switch(e.type){case"panstart":return t?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return t?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"multipanstart":return t?!1:this._onMultiPanStart(e);case"multipanmove":return this._onMultiPan(e);case"multipanend":return this._onMultiPanEnd(e);case"dblclick":return this._onDoubleClick(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:t,y:n}=this.props,{offsetCenter:i}=e;return[i.x-t,i.y-n]}isPointInBounds(e,t){const{width:n,height:i}=this.props;if(t&&t.handled)return!1;const s=e[0]>=0&&e[0]<=n&&e[1]>=0&&e[1]<=i;return s&&t&&t.stopPropagation(),s}isFunctionKeyPressed(e){const{srcEvent:t}=e;return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const t=setTimeout(()=>{this._eventStartBlocked===t&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=t}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:t}=e;this.inertia=Number.isFinite(t)?t:t===!0?Ole:0;const{scrollZoom:n=!0,dragPan:i=!0,dragRotate:s=!0,doubleClickZoom:a=!0,touchZoom:o=!0,touchRotate:h=!1,keyboard:f=!0}=e,_=!!this.onViewStateChange;this.toggleEvents(z_.WHEEL,_&&n),this.toggleEvents(z_.PAN,_),this.toggleEvents(z_.PINCH,_&&(o||h)),this.toggleEvents(z_.MULTI_PAN,_&&h),this.toggleEvents(z_.DOUBLE_CLICK,_&&a),this.toggleEvents(z_.KEYBOARD,_&&f),this.scrollZoom=n,this.dragPan=i,this.dragRotate=s,this.doubleClickZoom=a,this.touchZoom=o,this.touchRotate=h,this.keyboard=f}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,t){this.eventManager&&e.forEach(n=>{this._events[n]!==t&&(this._events[n]=t,t?this.eventManager.on(n,this.handleEvent):this.eventManager.off(n,this.handleEvent))})}updateViewport(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const i={...e.getViewportProps(),...t},s=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(n),s){const a=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:i,interactionState:this._interactionState,oldViewState:a,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let n=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(n=!n);const i=this.controllerState[n?"panStart":"rotateStart"]({pos:t});return this._panMove=n,this.updateViewport(i,fp,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const t=this.getCenter(e),n=this.controllerState.pan({pos:t});return this.updateViewport(n,fp,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:t}=this;if(this.dragPan&&t&&e.velocity){const n=this.getCenter(e),i=[n[0]+e.velocityX*t/2,n[1]+e.velocityY*t/2],s=this.controllerState.pan({pos:i}).panEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:Fw},{isDragging:!1,isPanning:!0})}else{const n=this.controllerState.panEnd();this.updateViewport(n,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const t=this.getCenter(e),n=this.controllerState.rotate({pos:t});return this.updateViewport(n,fp,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:t}=this;if(this.dragRotate&&t&&e.velocity){const n=this.getCenter(e),i=[n[0]+e.velocityX*t/2,n[1]+e.velocityY*t/2],s=this.controllerState.rotate({pos:i}).rotateEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:Fw},{isDragging:!1,isRotating:!0})}else{const n=this.controllerState.rotateEnd();this.updateViewport(n,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;e.srcEvent.preventDefault();const{speed:n=.01,smooth:i=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:s}=e;let a=2/(1+Math.exp(-Math.abs(s*n)));s<0&&a!==0&&(a=1/a);const o=this.controllerState.zoom({pos:t,scale:a});return this.updateViewport(o,{...this._getTransitionProps({around:t}),transitionDuration:i?250:1},{isZooming:!0,isPanning:!0}),!0}_onMultiPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const n=this.controllerState.rotateStart({pos:t});return this.updateViewport(n,fp,{isDragging:!0}),!0}_onMultiPan(e){if(!this.touchRotate||!this.isDragging())return!1;const t=this.getCenter(e);t[0]-=e.deltaX;const n=this.controllerState.rotate({pos:t});return this.updateViewport(n,fp,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this;if(this.touchRotate&&t&&e.velocityY){const n=this.getCenter(e),i=[n[0],n[1]+=e.velocityY*t/2],s=this.controllerState.rotate({pos:i});this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:Fw},{isDragging:!1,isRotating:!0}),this.blockEvents(t)}else{const n=this.controllerState.rotateEnd();this.updateViewport(n,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const n=this.controllerState.zoomStart({pos:t}).rotateStart({pos:t});return Fg._startPinchRotation=e.rotation,Fg._lastPinchEvent=e,this.updateViewport(n,fp,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let t=this.controllerState;if(this.touchZoom){const{scale:n}=e,i=this.getCenter(e);t=t.zoom({pos:i,scale:n})}if(this.touchRotate){const{rotation:n}=e;t=t.rotate({deltaAngleX:Fg._startPinchRotation-n})}return this.updateViewport(t,fp,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),Fg._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this,{_lastPinchEvent:n}=Fg;if(this.touchZoom&&t&&n&&e.scale!==n.scale){const i=this.getCenter(e);let s=this.controllerState.rotateEnd();const a=Math.log2(e.scale),o=(a-Math.log2(n.scale))/(e.deltaTime-n.deltaTime),h=Math.pow(2,a+o*t/2);s=s.zoom({pos:i,scale:h}).zoomEnd(),this.updateViewport(s,{...this._getTransitionProps({around:i}),transitionDuration:t,transitionEasing:Fw},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(t)}else{const i=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return Fg._startPinchRotation=null,Fg._lastPinchEvent=null,!0}_onDoubleClick(e){if(!this.doubleClickZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const n=this.isFunctionKeyPressed(e),i=this.controllerState.zoom({pos:t,scale:n?.5:2});return this.updateViewport(i,this._getTransitionProps({around:t}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const t=this.isFunctionKeyPressed(e),{zoomSpeed:n,moveSpeed:i,rotateSpeedX:s,rotateSpeedY:a}=this.keyboard===!0?{}:this.keyboard,{controllerState:o}=this;let h;const f={};switch(e.srcEvent.code){case"Minus":h=t?o.zoomOut(n).zoomOut(n):o.zoomOut(n),f.isZooming=!0;break;case"Equal":h=t?o.zoomIn(n).zoomIn(n):o.zoomIn(n),f.isZooming=!0;break;case"ArrowLeft":t?(h=o.rotateLeft(s),f.isRotating=!0):(h=o.moveLeft(i),f.isPanning=!0);break;case"ArrowRight":t?(h=o.rotateRight(s),f.isRotating=!0):(h=o.moveRight(i),f.isPanning=!0);break;case"ArrowUp":t?(h=o.rotateUp(a),f.isRotating=!0):(h=o.moveUp(i),f.isPanning=!0);break;case"ArrowDown":t?(h=o.rotateDown(a),f.isRotating=!0):(h=o.moveDown(i),f.isPanning=!0);break;default:return!1}return this.updateViewport(h,this._getTransitionProps(),f),!0}_getTransitionProps(e){const{transition:t}=this;return!t||!t.transitionInterpolator?fp:e?{...t,transitionInterpolator:new a3({...e,...t.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:t}}class kle{constructor(e,t){this._viewportProps=this.applyConstraints(e),this._state=t}getViewportProps(){return this._viewportProps}getState(){return this._state}}const RN=5,Ule=1.2;class LN extends kle{constructor(e){const{width:t,height:n,latitude:i,longitude:s,zoom:a,bearing:o=0,pitch:h=0,altitude:f=1.5,position:_=[0,0,0],maxZoom:x=20,minZoom:T=0,maxPitch:I=60,minPitch:N=0,startPanLngLat:$,startZoomLngLat:W,startRotatePos:Y,startBearing:ie,startPitch:ce,startZoom:fe,normalize:ve=!0}=e;Jc(Number.isFinite(s)),Jc(Number.isFinite(i)),Jc(Number.isFinite(a)),super({width:t,height:n,latitude:i,longitude:s,zoom:a,bearing:o,pitch:h,altitude:f,maxZoom:x,minZoom:T,maxPitch:I,minPitch:N,normalize:ve,position:_},{startPanLngLat:$,startZoomLngLat:W,startRotatePos:Y,startBearing:ie,startPitch:ce,startZoom:fe}),this.makeViewport=e.makeViewport}panStart(e){let{pos:t}=e;return this._getUpdatedState({startPanLngLat:this._unproject(t)})}pan(e){let{pos:t,startPos:n}=e;const i=this.getState().startPanLngLat||this._unproject(n);if(!i)return this;const a=this.makeViewport(this.getViewportProps()).panByPosition(i,t);return this._getUpdatedState(a)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart(e){let{pos:t}=e;return this._getUpdatedState({startRotatePos:t,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate(e){let{pos:t,deltaAngleX:n=0,deltaAngleY:i=0}=e;const{startRotatePos:s,startBearing:a,startPitch:o}=this.getState();if(!s||a===void 0||o===void 0)return this;let h;return t?h=this._getNewRotation(t,s,o,a):h={bearing:a+n,pitch:o+i},this._getUpdatedState(h)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart(e){let{pos:t}=e;return this._getUpdatedState({startZoomLngLat:this._unproject(t),startZoom:this.getViewportProps().zoom})}zoom(e){let{pos:t,startPos:n,scale:i}=e,{startZoom:s,startZoomLngLat:a}=this.getState();if(a||(s=this.getViewportProps().zoom,a=this._unproject(n)||this._unproject(t)),!a)return this;const{maxZoom:o,minZoom:h}=this.getViewportProps();let f=s+Math.log2(i);f=Uf(f,h,o);const _=this.makeViewport({...this.getViewportProps(),zoom:f});return this._getUpdatedState({zoom:f,..._.panByPosition(a,t)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2;return this._zoomFromCenter(e)}zoomOut(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2;return this._zoomFromCenter(1/e)}moveLeft(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([e,0])}moveRight(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([-e,0])}moveUp(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([0,e])}moveDown(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([0,-e])}rotateLeft(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:15;return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:15;return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const t=e.getViewportProps(),n={...this.getViewportProps()},{bearing:i,longitude:s}=n;return Math.abs(i-t.bearing)>180&&(n.bearing=i<0?i+360:i-360),Math.abs(s-t.longitude)>180&&(n.longitude=s<0?s+360:s-360),n}applyConstraints(e){const{maxZoom:t,minZoom:n,zoom:i}=e;e.zoom=Uf(i,n,t);const{maxPitch:s,minPitch:a,pitch:o}=e;e.pitch=Uf(o,a,s);const{normalize:h=!0}=e;return h&&Object.assign(e,xoe(e)),e}_zoomFromCenter(e){const{width:t,height:n}=this.getViewportProps();return this.zoom({pos:[t/2,n/2],scale:e})}_panFromCenter(e){const{width:t,height:n}=this.getViewportProps();return this.pan({startPos:[t/2,n/2],pos:[t/2+e[0],n/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const t=this.makeViewport(this.getViewportProps());return e&&t.unproject(e)}_getNewRotation(e,t,n,i){const s=e[0]-t[0],a=e[1]-t[1],o=e[1],h=t[1],{width:f,height:_}=this.getViewportProps(),x=s/f;let T=0;a>0?Math.abs(_-h)>RN&&(T=a/(h-_)*Ule):a<0&&h>RN&&(T=1-o/h),T=Uf(T,-1,1);const{minPitch:I,maxPitch:N}=this.getViewportProps(),$=i+180*x;let W=n;return T>0?W=n+T*(N-n):T<0&&(W=n-T*(I-n)),{pitch:W,bearing:$}}}class Nle extends FN{constructor(){super(...arguments),this.ControllerState=LN,this.transition={transitionDuration:300,transitionInterpolator:new a3({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const t=this.props;super.setProps(e),(!t||t.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class l3 extends MN{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(e)}getViewportType(){return Sg}get ControllerType(){return Nle}}l3.displayName="MapView";const zle=new QI;function Hle(r,e){const t=r.order??1/0,n=e.order??1/0;return t-n}class Vle{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const t=this._defaultEffects;if(!t.find(n=>n.id===e.id)){const n=t.findIndex(i=>Hle(i,e)>0);n<0?t.push(e):t.splice(n,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(zd(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}getEffects(){return this._resolvedEffects}_setEffects(e){const t={};for(const i of this.effects)t[i.id]=i;const n=[];for(const i of e){const s=t[i.id];let a=i;s&&s!==i?s.setProps?(s.setProps(i.props),a=s):s.cleanup(this._context):s||i.setup(this._context),n.push(a),delete t[i.id]}for(const i in t)t[i].cleanup(this._context);this.effects=n,this._resolvedEffects=n.concat(this._defaultEffects),e.some(i=>i instanceof QI)||this._resolvedEffects.push(zle),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class Gle extends GI{shouldDrawLayer(e){const{operation:t}=e.props;return t.includes("draw")||t.includes("terrain")}}const Qle="deckRenderer.renderLayers";class $le{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new Gle(e),this.pickLayersPass=new SN(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const t=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,n={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};n.effects&&this._preRender(n.effects,n);const i=this.lastPostProcessEffect?this.renderBuffers[0]:n.target;this.lastPostProcessEffect&&(n.clearColor=[0,0,0,0],n.clearCanvas=!0);const s=t.render({...n,target:i});n.effects&&this._postRender(n.effects,n),this.renderCount++,Wc(Qle,this,s,e)}needsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}finalize(){const{renderBuffers:e}=this;for(const t of e)t.delete();e.length=0}_preRender(e,t){this.lastPostProcessEffect=null,t.preRenderStats=t.preRenderStats||{};for(const n of e)t.preRenderStats[n.id]=n.preRender(t),n.postRender&&(this.lastPostProcessEffect=n.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,t=this.device.canvasContext.getDrawingBufferSize();e.length===0&&[0,1].map(n=>{const i=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${n}`,colorAttachments:[i]}))});for(const n of e)n.resize(t)}_postRender(e,t){const{renderBuffers:n}=this,i={...t,inputBuffer:n[0],swapBuffer:n[1]};for(const s of e)if(s.postRender){i.target=s.id===this.lastPostProcessEffect?t.target:void 0;const a=s.postRender(i);i.inputBuffer=a,i.swapBuffer=a===n[0]?n[1]:n[0]}}}const jle={pickedColor:null,pickedObjectIndex:-1};function qle(r){let{pickedColors:e,decodePickingColor:t,deviceX:n,deviceY:i,deviceRadius:s,deviceRect:a}=r;const{x:o,y:h,width:f,height:_}=a;let x=s*s,T=-1,I=0;for(let N=0;N<_;N++){const $=N+h-i,W=$*$;if(W>x)I+=4*f;else for(let Y=0;Y<f;Y++){if(e[I+3]-1>=0){const ce=Y+o-n,fe=ce*ce+W;fe<=x&&(x=fe,T=I)}I+=4}}if(T>=0){const N=e.slice(T,T+4),$=t(N);if($){const W=Math.floor(T/4/f),Y=T/4-W*f;return{...$,pickedColor:N,pickedX:o+Y,pickedY:h+W}}Es.error("Picked non-existent layer. Is picking buffer corrupt?")()}return jle}function Kle(r){let{pickedColors:e,decodePickingColor:t}=r;const n=new Map;if(e){for(let i=0;i<e.length;i+=4)if(e[i+3]-1>=0){const a=e.slice(i,i+4),o=a.join(",");if(!n.has(o)){const h=t(a);h?n.set(o,{...h,color:a}):Es.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(n.values())}function DN(r){let{pickInfo:e,viewports:t,pixelRatio:n,x:i,y:s,z:a}=r,o=t[0];t.length>1&&(o=Xle((e==null?void 0:e.pickedViewports)||t,{x:i,y:s}));let h;if(o){const f=[i-o.x,s-o.y];a!==void 0&&(f[2]=a),h=o.unproject(f)}return{color:null,layer:null,viewport:o,index:-1,picked:!1,x:i,y:s,pixel:[i,s],coordinate:h,devicePixel:e&&"pickedX"in e?[e.pickedX,e.pickedY]:void 0,pixelRatio:n}}function Wle(r){const{pickInfo:e,lastPickedInfo:t,mode:n,layers:i}=r,{pickedColor:s,pickedLayer:a,pickedObjectIndex:o}=e,h=a?[a]:[];if(n==="hover"){const x=t.index,T=t.layerId,I=a?a.props.id:null;if(I!==T||o!==x){if(I!==T){const N=i.find($=>$.props.id===T);N&&h.unshift(N)}t.layerId=I,t.index=o,t.info=null}}const f=DN(r),_=new Map;return _.set(null,f),h.forEach(x=>{let T={...f};x===a&&(T.color=s,T.index=o,T.picked=!0),T=ON({layer:x,info:T,mode:n});const I=T.layer;x===a&&n==="hover"&&(t.info=T),_.set(I.id,T),n==="hover"&&I.updateAutoHighlight(T)}),_}function ON(r){let{layer:e,info:t,mode:n}=r;for(;e&&t;){const i=t.layer||null;t.sourceLayer=i,t.layer=e,t=e.getPickingInfo({info:t,mode:n,sourceLayer:i}),e=e.parent}return t}function Xle(r,e){for(let t=r.length-1;t>=0;t--){const n=r[t];if(n.containsPixel(e))return n}return r[0]}class Jle{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new SN(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject(e){let{x:t,y:n,layers:i,viewports:s}=e,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.lastPickedInfo.info;const o=a&&a.layer&&a.layer.id,h=a&&a.viewport&&a.viewport.id,f=o?i.find(I=>I.id===o):null,_=h&&s.find(I=>I.id===h)||s[0],x=_&&_.unproject([t-_.x,n-_.y]);return{...a,...{x:t,y:n,viewport:_,coordinate:x,layer:f}}}_resizeBuffer(){var t,n;if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const i=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=i}const{canvas:e}=this.device.getDefaultCanvasContext();(t=this.pickingFBO)==null||t.resize({width:e.width,height:e.height}),(n=this.depthFBO)==null||n.resize({width:e.width,height:e.height})}_getPickable(e){if(this._pickable===!1)return null;const t=e.filter(n=>this.pickLayersPass.shouldDrawLayer(n)&&!n.isComposite);return t.length?t:null}_pickClosestObject(e){let{layers:t,views:n,viewports:i,x:s,y:a,radius:o=0,depth:h=1,mode:f="query",unproject3D:_,onViewportActive:x,effects:T}=e;const I=this.device.canvasContext.cssToDeviceRatio(),N=this._getPickable(t);if(!N||i.length===0)return{result:[],emptyInfo:DN({viewports:i,x:s,y:a,pixelRatio:I})};this._resizeBuffer();const $=this.device.canvasContext.cssToDevicePixels([s,a],!0),W=[$.x+Math.floor($.width/2),$.y+Math.floor($.height/2)],Y=Math.round(o*I),{width:ie,height:ce}=this.pickingFBO,fe=this._getPickingRect({deviceX:W[0],deviceY:W[1],deviceRadius:Y,deviceWidth:ie,deviceHeight:ce}),ve={x:s-o,y:a-o,width:o*2+1,height:o*2+1};let be;const Qe=[],Ue=new Set;for(let st=0;st<h;st++){let at;if(fe){const ze=this._drawAndSample({layers:N,views:n,viewports:i,onViewportActive:x,deviceRect:fe,cullRect:ve,effects:T,pass:`picking:${f}`});at=qle({...ze,deviceX:W[0],deviceY:W[1],deviceRadius:Y,deviceRect:fe})}else at={pickedColor:null,pickedObjectIndex:-1};let Le;if(at.pickedLayer&&_&&this.depthFBO){const{pickedColors:ze}=this._drawAndSample({layers:[at.pickedLayer],views:n,viewports:i,onViewportActive:x,deviceRect:{x:at.pickedX,y:at.pickedY,width:1,height:1},cullRect:ve,effects:T,pass:`picking:${f}:z`},!0);ze[3]&&(Le=ze[0])}at.pickedLayer&&st+1<h&&(Ue.add(at.pickedLayer),at.pickedLayer.disablePickingIndex(at.pickedObjectIndex)),be=Wle({pickInfo:at,lastPickedInfo:this.lastPickedInfo,mode:f,layers:N,viewports:i,x:s,y:a,z:Le,pixelRatio:I});for(const ze of be.values())ze.layer&&Qe.push(ze);if(!at.pickedColor)break}for(const st of Ue)st.restorePickingColors();return{result:Qe,emptyInfo:be.get(null)}}_pickVisibleObjects(e){let{layers:t,views:n,viewports:i,x:s,y:a,width:o=1,height:h=1,mode:f="query",maxObjects:_=null,onViewportActive:x,effects:T}=e;const I=this._getPickable(t);if(!I||i.length===0)return[];this._resizeBuffer();const N=this.device.canvasContext.cssToDeviceRatio(),$=this.device.canvasContext.cssToDevicePixels([s,a],!0),W=$.x,Y=$.y+$.height,ie=this.device.canvasContext.cssToDevicePixels([s+o,a+h],!0),ce=ie.x+ie.width,fe=ie.y,ve={x:W,y:fe,width:ce-W,height:Y-fe},be=this._drawAndSample({layers:I,views:n,viewports:i,onViewportActive:x,deviceRect:ve,cullRect:{x:s,y:a,width:o,height:h},effects:T,pass:`picking:${f}`}),Qe=Kle(be),Ue=new Map,st=[],at=Number.isFinite(_);for(let Le=0;Le<Qe.length&&!(at&&st.length>=_);Le++){const ze=Qe[Le];let tt={color:ze.pickedColor,layer:null,index:ze.pickedObjectIndex,picked:!0,x:s,y:a,pixelRatio:N};tt=ON({layer:ze.pickedLayer,info:tt,mode:f});const Ne=tt.layer.id;Ue.has(Ne)||Ue.set(Ne,new Set);const Ht=Ue.get(Ne),Vt=tt.object??tt.index;Ht.has(Vt)||(Ht.add(Vt),st.push(tt))}return st}_drawAndSample(e){let{layers:t,views:n,viewports:i,onViewportActive:s,deviceRect:a,cullRect:o,effects:h,pass:f}=e,_=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const x=_?this.depthFBO:this.pickingFBO,T={layers:t,layerFilter:this.layerFilter,views:n,viewports:i,onViewportActive:s,pickingFBO:x,deviceRect:a,cullRect:o,effects:h,pass:f,pickZ:_,preRenderStats:{},isPicking:!0};for(const ce of h)ce.useInPicking&&(T.preRenderStats[ce.id]=ce.preRender(T));const{decodePickingColor:I}=this.pickLayersPass.render(T),{x:N,y:$,width:W,height:Y}=a,ie=new(_?Float32Array:Uint8Array)(W*Y*4);return this.device.readPixelsToArrayWebGL(x,{sourceX:N,sourceY:$,sourceWidth:W,sourceHeight:Y,target:ie}),{pickedColors:ie,decodePickingColor:I}}_getPickingRect(e){let{deviceX:t,deviceY:n,deviceRadius:i,deviceWidth:s,deviceHeight:a}=e;const o=Math.max(0,t-i),h=Math.max(0,n-i),f=Math.min(s,t+i+1)-o,_=Math.min(a,n+i+1)-h;return f<=0||_<=0?null:{x:o,y:h,width:f,height:_}}}const Zle={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},Yle="top-left",kN="__root";class ece{constructor(e){let{deck:t,parentElement:n}=e;this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=t,this.parentElement=n}getWidgets(){return this.resolvedWidgets}setProps(e){e.widgets&&!zd(e.widgets,this.widgets,1)&&this._setWidgets(e.widgets)}finalize(){for(const e of this.getWidgets())this._remove(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(t=>t.id===e.id)||(this._add(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}_setWidgets(e){const t={};for(const n of this.resolvedWidgets)t[n.id]=n;this.resolvedWidgets.length=0;for(const n of this.defaultWidgets)t[n.id]=null,this.resolvedWidgets.push(n);for(let n of e){const i=t[n.id];i?i.viewId!==n.viewId||i.placement!==n.placement?(this._remove(i),this._add(n)):n!==i&&(i.setProps(n.props),n=i):this._add(n),t[n.id]=null,this.resolvedWidgets.push(n)}for(const n in t){const i=t[n];i&&this._remove(i)}this.widgets=e}_add(e){const{viewId:t=null,placement:n=Yle}=e,i=e.onAdd({deck:this.deck,viewId:t});i&&this._getContainer(t,n).append(i),e._element=i}_remove(e){var t;(t=e.onRemove)==null||t.call(e),e._element&&e._element.remove(),e._element=void 0}_getContainer(e,t){var a;const n=e||kN;let i=this.containers[n];i||(i=document.createElement("div"),i.style.pointerEvents="none",i.style.position="absolute",i.style.overflow="hidden",(a=this.parentElement)==null||a.append(i),this.containers[n]=i);let s=i.querySelector(`.${t}`);return s||(s=document.createElement("div"),s.className=t,s.style.position="absolute",s.style.zIndex="2",Object.assign(s.style,Zle[t]),i.append(s)),s}_updateContainers(){const e=this.deck.width,t=this.deck.height;for(const n in this.containers){const i=this.lastViewports[n]||null,s=n===kN||i,a=this.containers[n];s?(a.style.display="block",a.style.left=`${i?i.x:0}px`,a.style.top=`${i?i.y:0}px`,a.style.width=`${i?i.width:e}px`,a.style.height=`${i?i.height:t}px`):a.style.display="none"}}onRedraw(e){var s,a;let{viewports:t,layers:n}=e;const i=t.reduce((o,h)=>(o[h.id]=h,o),{});for(const o of this.getWidgets()){const{viewId:h}=o;if(h){const f=i[h];f&&(o.onViewportChange&&o.onViewportChange(f),(s=o.onRedraw)==null||s.call(o,{viewports:[f],layers:n}))}else{if(o.onViewportChange)for(const f of t)o.onViewportChange(f);(a=o.onRedraw)==null||a.call(o,{viewports:t,layers:n})}}this.lastViewports=i,this._updateContainers()}onHover(e,t){var n,i;for(const s of this.getWidgets()){const{viewId:a}=s;(!a||a===((n=e.viewport)==null?void 0:n.id))&&((i=s.onHover)==null||i.call(s,e,t))}}onEvent(e,t){var i,s;const n=BI[t.type];if(n)for(const a of this.getWidgets()){const{viewId:o}=a;(!o||o===((i=e.viewport)==null?void 0:i.id))&&((s=a[n])==null||s.call(a,e,t))}}}const tce={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class rce{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd(e){let{deck:t}=e;const n=document.createElement("div");return n.className="deck-tooltip",Object.assign(n.style,tce),this.deck=t,this.element=n,n}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(e){var t;this.isVisible&&e.id===((t=this.lastViewport)==null?void 0:t.id)&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){const{deck:t}=this,n=t&&t.props.getTooltip;if(!n)return;const i=n(e);this.lastViewport=e.viewport,this.setTooltip(i,e.x,e.y)}setTooltip(e,t,n){const i=this.element;if(i){if(typeof e=="string")i.innerText=e;else if(e)e.text&&(i.innerText=e.text),e.html&&(i.innerHTML=e.html),e.className&&(i.className=e.className);else{this.isVisible=!1,i.style.display="none";return}this.isVisible=!0,i.style.display="block",i.style.transform=`translate(${t}px, ${n}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(i.style,e.style)}}}var H_;(function(r){r[r.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",r[r.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",r[r.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",r[r.POINTS=0]="POINTS",r[r.LINES=1]="LINES",r[r.LINE_LOOP=2]="LINE_LOOP",r[r.LINE_STRIP=3]="LINE_STRIP",r[r.TRIANGLES=4]="TRIANGLES",r[r.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",r[r.TRIANGLE_FAN=6]="TRIANGLE_FAN",r[r.ZERO=0]="ZERO",r[r.ONE=1]="ONE",r[r.SRC_COLOR=768]="SRC_COLOR",r[r.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",r[r.SRC_ALPHA=770]="SRC_ALPHA",r[r.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",r[r.DST_ALPHA=772]="DST_ALPHA",r[r.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",r[r.DST_COLOR=774]="DST_COLOR",r[r.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",r[r.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",r[r.CONSTANT_COLOR=32769]="CONSTANT_COLOR",r[r.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",r[r.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",r[r.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",r[r.FUNC_ADD=32774]="FUNC_ADD",r[r.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",r[r.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",r[r.BLEND_EQUATION=32777]="BLEND_EQUATION",r[r.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",r[r.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",r[r.BLEND_DST_RGB=32968]="BLEND_DST_RGB",r[r.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",r[r.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",r[r.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",r[r.BLEND_COLOR=32773]="BLEND_COLOR",r[r.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",r[r.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",r[r.LINE_WIDTH=2849]="LINE_WIDTH",r[r.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",r[r.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",r[r.CULL_FACE_MODE=2885]="CULL_FACE_MODE",r[r.FRONT_FACE=2886]="FRONT_FACE",r[r.DEPTH_RANGE=2928]="DEPTH_RANGE",r[r.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",r[r.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",r[r.DEPTH_FUNC=2932]="DEPTH_FUNC",r[r.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",r[r.STENCIL_FUNC=2962]="STENCIL_FUNC",r[r.STENCIL_FAIL=2964]="STENCIL_FAIL",r[r.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",r[r.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",r[r.STENCIL_REF=2967]="STENCIL_REF",r[r.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",r[r.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",r[r.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",r[r.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",r[r.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",r[r.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",r[r.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",r[r.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",r[r.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",r[r.VIEWPORT=2978]="VIEWPORT",r[r.SCISSOR_BOX=3088]="SCISSOR_BOX",r[r.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",r[r.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",r[r.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",r[r.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",r[r.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",r[r.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",r[r.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",r[r.RED_BITS=3410]="RED_BITS",r[r.GREEN_BITS=3411]="GREEN_BITS",r[r.BLUE_BITS=3412]="BLUE_BITS",r[r.ALPHA_BITS=3413]="ALPHA_BITS",r[r.DEPTH_BITS=3414]="DEPTH_BITS",r[r.STENCIL_BITS=3415]="STENCIL_BITS",r[r.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",r[r.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",r[r.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",r[r.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",r[r.SAMPLES=32937]="SAMPLES",r[r.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",r[r.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",r[r.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",r[r.VENDOR=7936]="VENDOR",r[r.RENDERER=7937]="RENDERER",r[r.VERSION=7938]="VERSION",r[r.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",r[r.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",r[r.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",r[r.STATIC_DRAW=35044]="STATIC_DRAW",r[r.STREAM_DRAW=35040]="STREAM_DRAW",r[r.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",r[r.ARRAY_BUFFER=34962]="ARRAY_BUFFER",r[r.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",r[r.BUFFER_SIZE=34660]="BUFFER_SIZE",r[r.BUFFER_USAGE=34661]="BUFFER_USAGE",r[r.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",r[r.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",r[r.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",r[r.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",r[r.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",r[r.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",r[r.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",r[r.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",r[r.CULL_FACE=2884]="CULL_FACE",r[r.FRONT=1028]="FRONT",r[r.BACK=1029]="BACK",r[r.FRONT_AND_BACK=1032]="FRONT_AND_BACK",r[r.BLEND=3042]="BLEND",r[r.DEPTH_TEST=2929]="DEPTH_TEST",r[r.DITHER=3024]="DITHER",r[r.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",r[r.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",r[r.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",r[r.SCISSOR_TEST=3089]="SCISSOR_TEST",r[r.STENCIL_TEST=2960]="STENCIL_TEST",r[r.NO_ERROR=0]="NO_ERROR",r[r.INVALID_ENUM=1280]="INVALID_ENUM",r[r.INVALID_VALUE=1281]="INVALID_VALUE",r[r.INVALID_OPERATION=1282]="INVALID_OPERATION",r[r.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",r[r.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",r[r.CW=2304]="CW",r[r.CCW=2305]="CCW",r[r.DONT_CARE=4352]="DONT_CARE",r[r.FASTEST=4353]="FASTEST",r[r.NICEST=4354]="NICEST",r[r.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",r[r.BYTE=5120]="BYTE",r[r.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",r[r.SHORT=5122]="SHORT",r[r.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",r[r.INT=5124]="INT",r[r.UNSIGNED_INT=5125]="UNSIGNED_INT",r[r.FLOAT=5126]="FLOAT",r[r.DOUBLE=5130]="DOUBLE",r[r.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",r[r.ALPHA=6406]="ALPHA",r[r.RGB=6407]="RGB",r[r.RGBA=6408]="RGBA",r[r.LUMINANCE=6409]="LUMINANCE",r[r.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",r[r.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",r[r.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",r[r.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",r[r.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",r[r.VERTEX_SHADER=35633]="VERTEX_SHADER",r[r.COMPILE_STATUS=35713]="COMPILE_STATUS",r[r.DELETE_STATUS=35712]="DELETE_STATUS",r[r.LINK_STATUS=35714]="LINK_STATUS",r[r.VALIDATE_STATUS=35715]="VALIDATE_STATUS",r[r.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",r[r.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",r[r.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",r[r.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",r[r.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",r[r.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",r[r.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",r[r.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",r[r.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",r[r.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",r[r.SHADER_TYPE=35663]="SHADER_TYPE",r[r.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",r[r.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",r[r.NEVER=512]="NEVER",r[r.LESS=513]="LESS",r[r.EQUAL=514]="EQUAL",r[r.LEQUAL=515]="LEQUAL",r[r.GREATER=516]="GREATER",r[r.NOTEQUAL=517]="NOTEQUAL",r[r.GEQUAL=518]="GEQUAL",r[r.ALWAYS=519]="ALWAYS",r[r.KEEP=7680]="KEEP",r[r.REPLACE=7681]="REPLACE",r[r.INCR=7682]="INCR",r[r.DECR=7683]="DECR",r[r.INVERT=5386]="INVERT",r[r.INCR_WRAP=34055]="INCR_WRAP",r[r.DECR_WRAP=34056]="DECR_WRAP",r[r.NEAREST=9728]="NEAREST",r[r.LINEAR=9729]="LINEAR",r[r.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",r[r.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",r[r.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",r[r.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",r[r.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",r[r.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",r[r.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",r[r.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",r[r.TEXTURE_2D=3553]="TEXTURE_2D",r[r.TEXTURE=5890]="TEXTURE",r[r.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",r[r.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",r[r.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",r[r.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",r[r.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",r[r.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",r[r.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",r[r.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",r[r.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",r[r.TEXTURE0=33984]="TEXTURE0",r[r.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",r[r.REPEAT=10497]="REPEAT",r[r.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",r[r.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",r[r.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",r[r.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",r[r.FLOAT_VEC2=35664]="FLOAT_VEC2",r[r.FLOAT_VEC3=35665]="FLOAT_VEC3",r[r.FLOAT_VEC4=35666]="FLOAT_VEC4",r[r.INT_VEC2=35667]="INT_VEC2",r[r.INT_VEC3=35668]="INT_VEC3",r[r.INT_VEC4=35669]="INT_VEC4",r[r.BOOL=35670]="BOOL",r[r.BOOL_VEC2=35671]="BOOL_VEC2",r[r.BOOL_VEC3=35672]="BOOL_VEC3",r[r.BOOL_VEC4=35673]="BOOL_VEC4",r[r.FLOAT_MAT2=35674]="FLOAT_MAT2",r[r.FLOAT_MAT3=35675]="FLOAT_MAT3",r[r.FLOAT_MAT4=35676]="FLOAT_MAT4",r[r.SAMPLER_2D=35678]="SAMPLER_2D",r[r.SAMPLER_CUBE=35680]="SAMPLER_CUBE",r[r.LOW_FLOAT=36336]="LOW_FLOAT",r[r.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",r[r.HIGH_FLOAT=36338]="HIGH_FLOAT",r[r.LOW_INT=36339]="LOW_INT",r[r.MEDIUM_INT=36340]="MEDIUM_INT",r[r.HIGH_INT=36341]="HIGH_INT",r[r.FRAMEBUFFER=36160]="FRAMEBUFFER",r[r.RENDERBUFFER=36161]="RENDERBUFFER",r[r.RGBA4=32854]="RGBA4",r[r.RGB5_A1=32855]="RGB5_A1",r[r.RGB565=36194]="RGB565",r[r.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",r[r.STENCIL_INDEX=6401]="STENCIL_INDEX",r[r.STENCIL_INDEX8=36168]="STENCIL_INDEX8",r[r.DEPTH_STENCIL=34041]="DEPTH_STENCIL",r[r.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",r[r.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",r[r.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",r[r.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",r[r.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",r[r.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",r[r.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",r[r.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",r[r.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",r[r.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",r[r.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",r[r.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",r[r.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",r[r.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",r[r.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",r[r.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",r[r.NONE=0]="NONE",r[r.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",r[r.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",r[r.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",r[r.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",r[r.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",r[r.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",r[r.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",r[r.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",r[r.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",r[r.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",r[r.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",r[r.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",r[r.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",r[r.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",r[r.READ_BUFFER=3074]="READ_BUFFER",r[r.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",r[r.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",r[r.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",r[r.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",r[r.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",r[r.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",r[r.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",r[r.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",r[r.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",r[r.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",r[r.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",r[r.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",r[r.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",r[r.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",r[r.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",r[r.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",r[r.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",r[r.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",r[r.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",r[r.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",r[r.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",r[r.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",r[r.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",r[r.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",r[r.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",r[r.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",r[r.RED=6403]="RED",r[r.RGB8=32849]="RGB8",r[r.RGBA8=32856]="RGBA8",r[r.RGB10_A2=32857]="RGB10_A2",r[r.TEXTURE_3D=32879]="TEXTURE_3D",r[r.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",r[r.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",r[r.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",r[r.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",r[r.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",r[r.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",r[r.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",r[r.SRGB=35904]="SRGB",r[r.SRGB8=35905]="SRGB8",r[r.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",r[r.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",r[r.RGBA32F=34836]="RGBA32F",r[r.RGB32F=34837]="RGB32F",r[r.RGBA16F=34842]="RGBA16F",r[r.RGB16F=34843]="RGB16F",r[r.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",r[r.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",r[r.R11F_G11F_B10F=35898]="R11F_G11F_B10F",r[r.RGB9_E5=35901]="RGB9_E5",r[r.RGBA32UI=36208]="RGBA32UI",r[r.RGB32UI=36209]="RGB32UI",r[r.RGBA16UI=36214]="RGBA16UI",r[r.RGB16UI=36215]="RGB16UI",r[r.RGBA8UI=36220]="RGBA8UI",r[r.RGB8UI=36221]="RGB8UI",r[r.RGBA32I=36226]="RGBA32I",r[r.RGB32I=36227]="RGB32I",r[r.RGBA16I=36232]="RGBA16I",r[r.RGB16I=36233]="RGB16I",r[r.RGBA8I=36238]="RGBA8I",r[r.RGB8I=36239]="RGB8I",r[r.RED_INTEGER=36244]="RED_INTEGER",r[r.RGB_INTEGER=36248]="RGB_INTEGER",r[r.RGBA_INTEGER=36249]="RGBA_INTEGER",r[r.R8=33321]="R8",r[r.RG8=33323]="RG8",r[r.R16F=33325]="R16F",r[r.R32F=33326]="R32F",r[r.RG16F=33327]="RG16F",r[r.RG32F=33328]="RG32F",r[r.R8I=33329]="R8I",r[r.R8UI=33330]="R8UI",r[r.R16I=33331]="R16I",r[r.R16UI=33332]="R16UI",r[r.R32I=33333]="R32I",r[r.R32UI=33334]="R32UI",r[r.RG8I=33335]="RG8I",r[r.RG8UI=33336]="RG8UI",r[r.RG16I=33337]="RG16I",r[r.RG16UI=33338]="RG16UI",r[r.RG32I=33339]="RG32I",r[r.RG32UI=33340]="RG32UI",r[r.R8_SNORM=36756]="R8_SNORM",r[r.RG8_SNORM=36757]="RG8_SNORM",r[r.RGB8_SNORM=36758]="RGB8_SNORM",r[r.RGBA8_SNORM=36759]="RGBA8_SNORM",r[r.RGB10_A2UI=36975]="RGB10_A2UI",r[r.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",r[r.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",r[r.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",r[r.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",r[r.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",r[r.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",r[r.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",r[r.HALF_FLOAT=5131]="HALF_FLOAT",r[r.RG=33319]="RG",r[r.RG_INTEGER=33320]="RG_INTEGER",r[r.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",r[r.CURRENT_QUERY=34917]="CURRENT_QUERY",r[r.QUERY_RESULT=34918]="QUERY_RESULT",r[r.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",r[r.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",r[r.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",r[r.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",r[r.DRAW_BUFFER0=34853]="DRAW_BUFFER0",r[r.DRAW_BUFFER1=34854]="DRAW_BUFFER1",r[r.DRAW_BUFFER2=34855]="DRAW_BUFFER2",r[r.DRAW_BUFFER3=34856]="DRAW_BUFFER3",r[r.DRAW_BUFFER4=34857]="DRAW_BUFFER4",r[r.DRAW_BUFFER5=34858]="DRAW_BUFFER5",r[r.DRAW_BUFFER6=34859]="DRAW_BUFFER6",r[r.DRAW_BUFFER7=34860]="DRAW_BUFFER7",r[r.DRAW_BUFFER8=34861]="DRAW_BUFFER8",r[r.DRAW_BUFFER9=34862]="DRAW_BUFFER9",r[r.DRAW_BUFFER10=34863]="DRAW_BUFFER10",r[r.DRAW_BUFFER11=34864]="DRAW_BUFFER11",r[r.DRAW_BUFFER12=34865]="DRAW_BUFFER12",r[r.DRAW_BUFFER13=34866]="DRAW_BUFFER13",r[r.DRAW_BUFFER14=34867]="DRAW_BUFFER14",r[r.DRAW_BUFFER15=34868]="DRAW_BUFFER15",r[r.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",r[r.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",r[r.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",r[r.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",r[r.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",r[r.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",r[r.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",r[r.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",r[r.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",r[r.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",r[r.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",r[r.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",r[r.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",r[r.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",r[r.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",r[r.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",r[r.SAMPLER_3D=35679]="SAMPLER_3D",r[r.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",r[r.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",r[r.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",r[r.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",r[r.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",r[r.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",r[r.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",r[r.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",r[r.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",r[r.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",r[r.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",r[r.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",r[r.MAX_SAMPLES=36183]="MAX_SAMPLES",r[r.SAMPLER_BINDING=35097]="SAMPLER_BINDING",r[r.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",r[r.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",r[r.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",r[r.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",r[r.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",r[r.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",r[r.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",r[r.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",r[r.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",r[r.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",r[r.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",r[r.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",r[r.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",r[r.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",r[r.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",r[r.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",r[r.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",r[r.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",r[r.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",r[r.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",r[r.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",r[r.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",r[r.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",r[r.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",r[r.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",r[r.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",r[r.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",r[r.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",r[r.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",r[r.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",r[r.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",r[r.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",r[r.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",r[r.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",r[r.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",r[r.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",r[r.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",r[r.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",r[r.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",r[r.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",r[r.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",r[r.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",r[r.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",r[r.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",r[r.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",r[r.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",r[r.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",r[r.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",r[r.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",r[r.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",r[r.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",r[r.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",r[r.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",r[r.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",r[r.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",r[r.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",r[r.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",r[r.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",r[r.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",r[r.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",r[r.UNIFORM_TYPE=35383]="UNIFORM_TYPE",r[r.UNIFORM_SIZE=35384]="UNIFORM_SIZE",r[r.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",r[r.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",r[r.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",r[r.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",r[r.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",r[r.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",r[r.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",r[r.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",r[r.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",r[r.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",r[r.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",r[r.OBJECT_TYPE=37138]="OBJECT_TYPE",r[r.SYNC_CONDITION=37139]="SYNC_CONDITION",r[r.SYNC_STATUS=37140]="SYNC_STATUS",r[r.SYNC_FLAGS=37141]="SYNC_FLAGS",r[r.SYNC_FENCE=37142]="SYNC_FENCE",r[r.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",r[r.UNSIGNALED=37144]="UNSIGNALED",r[r.SIGNALED=37145]="SIGNALED",r[r.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",r[r.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",r[r.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",r[r.WAIT_FAILED=37149]="WAIT_FAILED",r[r.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",r[r.COLOR=6144]="COLOR",r[r.DEPTH=6145]="DEPTH",r[r.STENCIL=6146]="STENCIL",r[r.MIN=32775]="MIN",r[r.MAX=32776]="MAX",r[r.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",r[r.STREAM_READ=35041]="STREAM_READ",r[r.STREAM_COPY=35042]="STREAM_COPY",r[r.STATIC_READ=35045]="STATIC_READ",r[r.STATIC_COPY=35046]="STATIC_COPY",r[r.DYNAMIC_READ=35049]="DYNAMIC_READ",r[r.DYNAMIC_COPY=35050]="DYNAMIC_COPY",r[r.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",r[r.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",r[r.INVALID_INDEX=4294967295]="INVALID_INDEX",r[r.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",r[r.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",r[r.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",r[r.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",r[r.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",r[r.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",r[r.R16_EXT=33322]="R16_EXT",r[r.RG16_EXT=33324]="RG16_EXT",r[r.RGB16_EXT=32852]="RGB16_EXT",r[r.RGBA16_EXT=32859]="RGBA16_EXT",r[r.R16_SNORM_EXT=36760]="R16_SNORM_EXT",r[r.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",r[r.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",r[r.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",r[r.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",r[r.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",r[r.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",r[r.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",r[r.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",r[r.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",r[r.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",r[r.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",r[r.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",r[r.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",r[r.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",r[r.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",r[r.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",r[r.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",r[r.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",r[r.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",r[r.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",r[r.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",r[r.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",r[r.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",r[r.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",r[r.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",r[r.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",r[r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",r[r.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",r[r.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",r[r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",r[r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",r[r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",r[r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",r[r.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",r[r.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",r[r.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",r[r.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",r[r.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",r[r.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",r[r.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",r[r.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",r[r.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",r[r.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",r[r.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",r[r.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",r[r.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",r[r.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",r[r.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",r[r.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",r[r.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",r[r.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",r[r.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",r[r.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",r[r.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",r[r.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",r[r.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",r[r.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",r[r.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",r[r.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",r[r.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",r[r.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",r[r.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",r[r.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",r[r.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",r[r.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",r[r.LINE_WEBGL=6913]="LINE_WEBGL",r[r.FILL_WEBGL=6914]="FILL_WEBGL",r[r.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",r[r.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",r[r.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",r[r.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",r[r.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",r[r.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",r[r.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",r[r.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",r[r.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",r[r.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",r[r.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",r[r.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",r[r.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",r[r.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",r[r.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",r[r.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",r[r.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",r[r.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",r[r.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",r[r.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",r[r.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",r[r.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",r[r.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",r[r.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(H_||(H_={}));const c3={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},ol=(r,e,t)=>e?r.enable(t):r.disable(t),UN=(r,e,t)=>r.hint(t,e),wh=(r,e,t)=>r.pixelStorei(t,e),NN=(r,e,t)=>{const n=t===36006?36009:36008;return r.bindFramebuffer(n,e)},B1=(r,e,t)=>{const i={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[t];r.bindBuffer(i,e)};function u3(r){return Array.isArray(r)||ArrayBuffer.isView(r)&&!(r instanceof DataView)}const nce={3042:ol,32773:(r,e)=>r.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(r,e)=>r.clearColor(...e),3107:(r,e)=>r.colorMask(...e),2884:ol,2885:(r,e)=>r.cullFace(e),2929:ol,2931:(r,e)=>r.clearDepth(e),2932:(r,e)=>r.depthFunc(e),2928:(r,e)=>r.depthRange(...e),2930:(r,e)=>r.depthMask(e),3024:ol,35723:UN,35725:(r,e)=>r.useProgram(e),36007:(r,e)=>r.bindRenderbuffer(36161,e),36389:(r,e)=>{var t;return(t=r.bindTransformFeedback)==null?void 0:t.call(r,36386,e)},34229:(r,e)=>r.bindVertexArray(e),36006:NN,36010:NN,34964:B1,36662:B1,36663:B1,35053:B1,35055:B1,2886:(r,e)=>r.frontFace(e),33170:UN,2849:(r,e)=>r.lineWidth(e),32823:ol,32824:"polygonOffset",10752:"polygonOffset",35977:ol,32926:ol,32928:ol,32938:"sampleCoverage",32939:"sampleCoverage",3089:ol,3088:(r,e)=>r.scissor(...e),2960:ol,2961:(r,e)=>r.clearStencil(e),2968:(r,e)=>r.stencilMaskSeparate(1028,e),36005:(r,e)=>r.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(r,e)=>r.viewport(...e),34383:ol,10754:ol,12288:ol,12289:ol,12290:ol,12291:ol,12292:ol,12293:ol,12294:ol,12295:ol,3333:wh,3317:wh,37440:wh,37441:wh,37443:wh,3330:wh,3332:wh,3331:wh,3314:wh,32878:wh,3316:wh,3315:wh,32877:wh,framebuffer:(r,e)=>{const t=e&&"handle"in e?e.handle:e;return r.bindFramebuffer(36160,t)},blend:(r,e)=>e?r.enable(3042):r.disable(3042),blendColor:(r,e)=>r.blendColor(...e),blendEquation:(r,e)=>{const t=typeof e=="number"?[e,e]:e;r.blendEquationSeparate(...t)},blendFunc:(r,e)=>{const t=(e==null?void 0:e.length)===2?[...e,...e]:e;r.blendFuncSeparate(...t)},clearColor:(r,e)=>r.clearColor(...e),clearDepth:(r,e)=>r.clearDepth(e),clearStencil:(r,e)=>r.clearStencil(e),colorMask:(r,e)=>r.colorMask(...e),cull:(r,e)=>e?r.enable(2884):r.disable(2884),cullFace:(r,e)=>r.cullFace(e),depthTest:(r,e)=>e?r.enable(2929):r.disable(2929),depthFunc:(r,e)=>r.depthFunc(e),depthMask:(r,e)=>r.depthMask(e),depthRange:(r,e)=>r.depthRange(...e),dither:(r,e)=>e?r.enable(3024):r.disable(3024),derivativeHint:(r,e)=>{r.hint(35723,e)},frontFace:(r,e)=>r.frontFace(e),mipmapHint:(r,e)=>r.hint(33170,e),lineWidth:(r,e)=>r.lineWidth(e),polygonOffsetFill:(r,e)=>e?r.enable(32823):r.disable(32823),polygonOffset:(r,e)=>r.polygonOffset(...e),sampleCoverage:(r,e)=>r.sampleCoverage(e[0],e[1]||!1),scissorTest:(r,e)=>e?r.enable(3089):r.disable(3089),scissor:(r,e)=>r.scissor(...e),stencilTest:(r,e)=>e?r.enable(2960):r.disable(2960),stencilMask:(r,e)=>{e=u3(e)?e:[e,e];const[t,n]=e;r.stencilMaskSeparate(1028,t),r.stencilMaskSeparate(1029,n)},stencilFunc:(r,e)=>{e=u3(e)&&e.length===3?[...e,...e]:e;const[t,n,i,s,a,o]=e;r.stencilFuncSeparate(1028,t,n,i),r.stencilFuncSeparate(1029,s,a,o)},stencilOp:(r,e)=>{e=u3(e)&&e.length===3?[...e,...e]:e;const[t,n,i,s,a,o]=e;r.stencilOpSeparate(1028,t,n,i),r.stencilOpSeparate(1029,s,a,o)},viewport:(r,e)=>r.viewport(...e)};function ga(r,e,t){return e[r]!==void 0?e[r]:t[r]}const ice={blendEquation:(r,e,t)=>r.blendEquationSeparate(ga(32777,e,t),ga(34877,e,t)),blendFunc:(r,e,t)=>r.blendFuncSeparate(ga(32969,e,t),ga(32968,e,t),ga(32971,e,t),ga(32970,e,t)),polygonOffset:(r,e,t)=>r.polygonOffset(ga(32824,e,t),ga(10752,e,t)),sampleCoverage:(r,e,t)=>r.sampleCoverage(ga(32938,e,t),ga(32939,e,t)),stencilFuncFront:(r,e,t)=>r.stencilFuncSeparate(1028,ga(2962,e,t),ga(2967,e,t),ga(2963,e,t)),stencilFuncBack:(r,e,t)=>r.stencilFuncSeparate(1029,ga(34816,e,t),ga(36003,e,t),ga(36004,e,t)),stencilOpFront:(r,e,t)=>r.stencilOpSeparate(1028,ga(2964,e,t),ga(2965,e,t),ga(2966,e,t)),stencilOpBack:(r,e,t)=>r.stencilOpSeparate(1029,ga(34817,e,t),ga(34818,e,t),ga(34819,e,t))},zN={enable:(r,e)=>r({[e]:!0}),disable:(r,e)=>r({[e]:!1}),pixelStorei:(r,e,t)=>r({[e]:t}),hint:(r,e,t)=>r({[e]:t}),useProgram:(r,e)=>r({35725:e}),bindRenderbuffer:(r,e,t)=>r({36007:t}),bindTransformFeedback:(r,e,t)=>r({36389:t}),bindVertexArray:(r,e)=>r({34229:e}),bindFramebuffer:(r,e,t)=>{switch(e){case 36160:return r({36006:t,36010:t});case 36009:return r({36006:t});case 36008:return r({36010:t});default:return null}},bindBuffer:(r,e,t)=>{const n={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return n?r({[n]:t}):{valueChanged:!0}},blendColor:(r,e,t,n,i)=>r({32773:new Float32Array([e,t,n,i])}),blendEquation:(r,e)=>r({32777:e,34877:e}),blendEquationSeparate:(r,e,t)=>r({32777:e,34877:t}),blendFunc:(r,e,t)=>r({32969:e,32968:t,32971:e,32970:t}),blendFuncSeparate:(r,e,t,n,i)=>r({32969:e,32968:t,32971:n,32970:i}),clearColor:(r,e,t,n,i)=>r({3106:new Float32Array([e,t,n,i])}),clearDepth:(r,e)=>r({2931:e}),clearStencil:(r,e)=>r({2961:e}),colorMask:(r,e,t,n,i)=>r({3107:[e,t,n,i]}),cullFace:(r,e)=>r({2885:e}),depthFunc:(r,e)=>r({2932:e}),depthRange:(r,e,t)=>r({2928:new Float32Array([e,t])}),depthMask:(r,e)=>r({2930:e}),frontFace:(r,e)=>r({2886:e}),lineWidth:(r,e)=>r({2849:e}),polygonOffset:(r,e,t)=>r({32824:e,10752:t}),sampleCoverage:(r,e,t)=>r({32938:e,32939:t}),scissor:(r,e,t,n,i)=>r({3088:new Int32Array([e,t,n,i])}),stencilMask:(r,e)=>r({2968:e,36005:e}),stencilMaskSeparate:(r,e,t)=>r({[e===1028?2968:36005]:t}),stencilFunc:(r,e,t,n)=>r({2962:e,2967:t,2963:n,34816:e,36003:t,36004:n}),stencilFuncSeparate:(r,e,t,n,i)=>r({[e===1028?2962:34816]:t,[e===1028?2967:36003]:n,[e===1028?2963:36004]:i}),stencilOp:(r,e,t,n)=>r({2964:e,2965:t,2966:n,34817:e,34818:t,34819:n}),stencilOpSeparate:(r,e,t,n,i)=>r({[e===1028?2964:34817]:t,[e===1028?2965:34818]:n,[e===1028?2966:34819]:i}),viewport:(r,e,t,n,i)=>r({2978:[e,t,n,i]})},Nf=(r,e)=>r.isEnabled(e),HN={3042:Nf,2884:Nf,2929:Nf,3024:Nf,32823:Nf,32926:Nf,32928:Nf,3089:Nf,2960:Nf,35977:Nf},sce=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function V_(r,e){if(ace(e))return;const t={};for(const i in e){const s=Number(i),a=nce[i];a&&(typeof a=="string"?t[a]=!0:a(r,e[i],s))}const n=r.state&&r.state.cache;if(n)for(const i in t){const s=ice[i];s(r,e,n)}}function VN(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:c3;if(typeof e=="number"){const i=e,s=HN[i];return s?s(r,i):r.getParameter(i)}const t=Array.isArray(e)?e:Object.keys(e),n={};for(const i of t){const s=HN[i];n[i]=s?s(r,Number(i)):r.getParameter(Number(i))}return n}function oce(r){V_(r,c3)}function ace(r){for(const e in r)return!1;return!0}function lce(r,e){if(r===e)return!0;const t=Array.isArray(r)||ArrayBuffer.isView(r),n=Array.isArray(e)||ArrayBuffer.isView(e);if(t&&n&&r.length===e.length){for(let i=0;i<r.length;++i)if(r[i]!==e[i])return!1;return!0}return!1}class Rg{constructor(e,t){xe(this,"gl");xe(this,"program",null);xe(this,"stateStack",[]);xe(this,"enable",!0);xe(this,"cache",null);xe(this,"log");xe(this,"initialized",!1);this.gl=e,this.log=(t==null?void 0:t.log)||(()=>{}),this._updateCache=this._updateCache.bind(this),Object.seal(this)}static get(e){return e.state}push(){this.stateStack.push({})}pop(){const e=this.stateStack[this.stateStack.length-1];V_(this.gl,e),this.stateStack.pop()}trackState(e,t){if(this.cache=t.copyState?VN(e):Object.assign({},c3),this.initialized)throw new Error("WebGLStateTracker");this.initialized=!0,this.gl.state=this,uce(e);for(const n in zN){const i=zN[n];cce(e,n,i)}GN(e,"getParameter"),GN(e,"isEnabled")}_updateCache(e){let t=!1,n;const i=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const s in e){const a=e[s],o=this.cache[s];lce(a,o)||(t=!0,n=o,i&&!(s in i)&&(i[s]=o),this.cache[s]=a)}return{valueChanged:t,oldValue:n}}}function GN(r,e){const t=r[e].bind(r);r[e]=function(i){if(i===void 0||sce.has(i))return t(i);const s=Rg.get(r);return i in s.cache||(s.cache[i]=t(i)),s.enable?s.cache[i]:t(i)},Object.defineProperty(r[e],"name",{value:`${e}-from-cache`,configurable:!1})}function cce(r,e,t){if(!r[e])return;const n=r[e].bind(r);r[e]=function(){const s=Rg.get(r);for(var a=arguments.length,o=new Array(a),h=0;h<a;h++)o[h]=arguments[h];const{valueChanged:f,oldValue:_}=t(s._updateCache,...o);return f&&n(...o),_},Object.defineProperty(r[e],"name",{value:`${e}-to-cache`,configurable:!1})}function uce(r){const e=r.useProgram.bind(r);r.useProgram=function(n){const i=Rg.get(r);i.program!==n&&(e(n),i.program=n)}}function hce(r,e,t){let n="";const i={preserveDrawingBuffer:!0,...t};let s=null;if(s||(s=r.getContext("webgl2",i)),i.failIfMajorPerformanceCaveat&&(n||(n="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow.")),!s&&!t.failIfMajorPerformanceCaveat&&(i.failIfMajorPerformanceCaveat=!1,s=r.getContext("webgl2",i),s.luma||(s.luma={}),s.luma.softwareRenderer=!0),s||(s=r.getContext("webgl",{}),s&&(s=null,n||(n="Your browser only supports WebGL1"))),!s)throw n||(n="Your browser does not support WebGL"),new Error(`Failed to create WebGL context: ${n}`);const{onContextLost:a,onContextRestored:o}=e;return r.addEventListener("webglcontextlost",h=>a(h),!1),r.addEventListener("webglcontextrestored",h=>o(h),!1),s.luma||(s.luma={}),s}function G_(r,e,t){return t[e]===void 0&&(t[e]=r.getExtension(e)||null),t[e]}function dce(r,e){const t=r.getParameter(7936),n=r.getParameter(7937);G_(r,"WEBGL_debug_renderer_info",e);const i=e.WEBGL_debug_renderer_info,s=r.getParameter(i?i.UNMASKED_VENDOR_WEBGL:7936),a=r.getParameter(i?i.UNMASKED_RENDERER_WEBGL:7937),o=s||t,h=a||n,f=r.getParameter(7938),_=QN(o,h),x=fce(o,h),T=Ace(o,h);return{type:"webgl",gpu:_,gpuType:T,gpuBackend:x,vendor:o,renderer:h,version:f,shadingLanguage:"glsl",shadingLanguageVersion:300}}function QN(r,e){return/NVIDIA/i.exec(r)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(r)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(r)||/Apple/i.exec(e)?"apple":/AMD/i.exec(r)||/AMD/i.exec(e)||/ATI/i.exec(r)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(r)||/SwiftShader/i.exec(e)?"software":"unknown"}function fce(r,e){return/Metal/i.exec(r)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(r)||/ANGLE/i.exec(e)?"opengl":"unknown"}function Ace(r,e){if(/SwiftShader/i.exec(r)||/SwiftShader/i.exec(e))return"cpu";switch(QN(r,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function $N(r){switch(r){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(r))}const C1="WEBGL_compressed_texture_s3tc",E1="WEBGL_compressed_texture_s3tc_srgb",Q_="EXT_texture_compression_rgtc",$_="EXT_texture_compression_bptc",pce="WEBGL_compressed_texture_etc",gce="WEBGL_compressed_texture_astc",mce="WEBGL_compressed_texture_etc1",_ce="WEBGL_compressed_texture_pvrtc",yce="WEBGL_compressed_texture_atc",jN="EXT_texture_norm16",qN="EXT_render_snorm",bce="EXT_color_buffer_float",h3={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat-renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[qN],"norm16-renderable-webgl":[jN],"snorm16-renderable-webgl":[jN,qN],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[C1,E1,Q_,$_],"texture-compression-bc5-webgl":[Q_],"texture-compression-bc7-webgl":[$_],"texture-compression-etc2":[pce],"texture-compression-astc":[gce],"texture-compression-etc1-webgl":[mce],"texture-compression-pvrtc-webgl":[_ce],"texture-compression-atc-webgl":[yce]};function vce(r){return r in h3}function xce(r,e,t){return(h3[e]||[]).every(i=>G_(r,i,t))}const d3={r8unorm:{gl:33321,rb:!0},r8snorm:{gl:36756},r8uint:{gl:33330,rb:!0},r8sint:{gl:33329,rb:!0},rg8unorm:{gl:33323,rb:!0},rg8snorm:{gl:36757},rg8uint:{gl:33336,rb:!0},rg8sint:{gl:33335,rb:!0},r16uint:{gl:33332,rb:!0},r16sint:{gl:33331,rb:!0},r16float:{gl:33325,rb:!0},"r16unorm-webgl":{gl:33322,rb:!0},"r16snorm-webgl":{gl:36760},"rgba4unorm-webgl":{gl:32854,rb:!0},"rgb565unorm-webgl":{gl:36194,rb:!0},"rgb5a1unorm-webgl":{gl:32855,rb:!0},"rgb8unorm-webgl":{gl:32849},"rgb8snorm-webgl":{gl:36758},rgba8unorm:{gl:32856},"rgba8unorm-srgb":{gl:35907},rgba8snorm:{gl:36759},rgba8uint:{gl:36220},rgba8sint:{gl:36238},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{gl:33338},rg16sint:{gl:33337},rg16float:{gl:33327,rb:!0},"rg16unorm-webgl":{gl:33324},"rg16snorm-webgl":{gl:36761},r32uint:{gl:33334,rb:!0},r32sint:{gl:33333,rb:!0},r32float:{gl:33326},rgb9e5ufloat:{gl:35901},rg11b10ufloat:{gl:35898,rb:!0},rgb10a2unorm:{gl:32857,rb:!0},"rgb10a2uint-webgl":{gl:36975,rb:!0},"rgb16unorm-webgl":{gl:32852},"rgb16snorm-webgl":{gl:36762},rg32uint:{gl:33340,rb:!0},rg32sint:{gl:33339,rb:!0},rg32float:{gl:33328,rb:!0},rgba16uint:{gl:36214,rb:!0},rgba16sint:{gl:36232,rb:!0},rgba16float:{gl:34842},"rgba16unorm-webgl":{gl:32859,rb:!0},"rgba16snorm-webgl":{gl:36763},"rgb32float-webgl":{gl:34837,x:bce,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,rb:!0},rgba32sint:{gl:36226,rb:!0},rgba32float:{gl:34836,rb:!0},stencil8:{gl:36168,rb:!0},depth16unorm:{gl:33189,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,dataFormat:6402,types:[5125]},depth32float:{gl:36012,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth32float-stencil8":{gl:36013,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:C1},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:E1},"bc1-rgba-unorm":{gl:33777,x:C1},"bc1-rgba-unorm-srgb":{gl:35916,x:E1},"bc2-rgba-unorm":{gl:33778,x:C1},"bc2-rgba-unorm-srgb":{gl:35918,x:E1},"bc3-rgba-unorm":{gl:33779,x:C1},"bc3-rgba-unorm-srgb":{gl:35919,x:E1},"bc4-r-unorm":{gl:36283,x:Q_},"bc4-r-snorm":{gl:36284,x:Q_},"bc5-rg-unorm":{gl:36285,x:Q_},"bc5-rg-snorm":{gl:36286,x:Q_},"bc6h-rgb-ufloat":{gl:36495,x:$_},"bc6h-rgb-float":{gl:36494,x:$_},"bc7-rgba-unorm":{gl:36492,x:$_},"bc7-rgba-unorm-srgb":{gl:36493,x:$_},"etc2-rgb8unorm":{gl:37492},"etc2-rgb8unorm-srgb":{gl:37494},"etc2-rgb8a1unorm":{gl:37496},"etc2-rgb8a1unorm-srgb":{gl:37497},"etc2-rgba8unorm":{gl:37493},"etc2-rgba8unorm-srgb":{gl:37495},"eac-r11unorm":{gl:37488},"eac-r11snorm":{gl:37489},"eac-rg11unorm":{gl:37490},"eac-rg11snorm":{gl:37491},"astc-4x4-unorm":{gl:37808},"astc-4x4-unorm-srgb":{gl:37840},"astc-5x4-unorm":{gl:37809},"astc-5x4-unorm-srgb":{gl:37841},"astc-5x5-unorm":{gl:37810},"astc-5x5-unorm-srgb":{gl:37842},"astc-6x5-unorm":{gl:37811},"astc-6x5-unorm-srgb":{gl:37843},"astc-6x6-unorm":{gl:37812},"astc-6x6-unorm-srgb":{gl:37844},"astc-8x5-unorm":{gl:37813},"astc-8x5-unorm-srgb":{gl:37845},"astc-8x6-unorm":{gl:37814},"astc-8x6-unorm-srgb":{gl:37846},"astc-8x8-unorm":{gl:37815},"astc-8x8-unorm-srgb":{gl:37847},"astc-10x5-unorm":{gl:37819},"astc-10x5-unorm-srgb":{gl:37851},"astc-10x6-unorm":{gl:37817},"astc-10x6-unorm-srgb":{gl:37849},"astc-10x8-unorm":{gl:37818},"astc-10x8-unorm-srgb":{gl:37850},"astc-10x10-unorm":{gl:37819},"astc-10x10-unorm-srgb":{gl:37851},"astc-12x10-unorm":{gl:37820},"astc-12x10-unorm-srgb":{gl:37852},"astc-12x12-unorm":{gl:37821},"astc-12x12-unorm-srgb":{gl:37853},"pvrtc-rgb4unorm-webgl":{gl:35840},"pvrtc-rgba4unorm-webgl":{gl:35842},"pvrtc-rbg2unorm-webgl":{gl:35841},"pvrtc-rgba2unorm-webgl":{gl:35843},"etc1-rbg-unorm-webgl":{gl:36196},"atc-rgb-unorm-webgl":{gl:35986},"atc-rgba-unorm-webgl":{gl:35986},"atc-rgbai-unorm-webgl":{gl:34798}};function wce(r,e,t){let n=e.create;const i=d3[e.format];return(i==null?void 0:i.gl)===void 0&&(n=!1),i!=null&&i.x&&(n=n&&!!G_(r,i.x,t)),{format:e.format,create:n&&e.create,render:n&&e.render,filter:n&&e.filter,blend:n&&e.blend,store:n&&e.store}}function KN(r){var i;const e=d3[r],t=Ece(r),n=ZS(r);return{internalFormat:t,format:(e==null?void 0:e.dataFormat)||Cce(n.channels,n.integer,n.normalized,t),type:n.dataType?$N(n.dataType):((i=e==null?void 0:e.types)==null?void 0:i[0])||5121,compressed:n.compressed||!1}}function Bce(r){switch(ZS(r).attachment){case"depth":return 36096;case"stencil":return 36128;case"depth-stencil":return 33306;default:throw new Error(`Not a depth stencil format: ${r}`)}}function Cce(r,e,t,n){if(n===6408||n===6407)return n;switch(r){case"r":return e&&!t?36244:6403;case"rg":return e&&!t?33320:33319;case"rgb":return e&&!t?36248:6407;case"rgba":return e&&!t?36249:6408;case"bgra":throw new Error("bgra pixels not supported by WebGL");default:return 6408}}function Ece(r){const e=d3[r],t=e==null?void 0:e.gl;if(t===void 0)throw new Error(`Unsupported texture format ${r}`);return t}const WN={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class Tce extends Ore{constructor(t,n,i){super([],i);xe(this,"gl");xe(this,"extensions");xe(this,"testedFeatures",new Set);this.gl=t,this.extensions=n,G_(t,"EXT_color_buffer_float",n)}*[Symbol.iterator](){const t=this.getFeatures();for(const n of t)this.has(n)&&(yield n);return[]}has(t){var n;return(n=this.disabledFeatures)!=null&&n[t]?!1:(this.testedFeatures.has(t)||(this.testedFeatures.add(t),vce(t)&&xce(this.gl,t,this.extensions)&&this.features.add(t),this.getWebGLFeature(t)&&this.features.add(t)),this.features.has(t))}initializeFeatures(){const t=this.getFeatures().filter(n=>n!=="polygon-mode-webgl");for(const n of t)this.has(n)}getFeatures(){return[...Object.keys(WN),...Object.keys(h3)]}getWebGLFeature(t){const n=WN[t];return typeof n=="string"?!!G_(this.gl,n,this.extensions):!!n}}class Sce extends Dre{constructor(t){super();xe(this,"gl");xe(this,"limits",{});this.gl=t}get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}getParameter(t){return this.limits[t]===void 0&&(this.limits[t]=this.gl.getParameter(t)),this.limits[t]||0}}class T1 extends Wx{constructor(t,n){super(t,n);xe(this,"device");xe(this,"gl");xe(this,"handle");xe(this,"colorAttachments",[]);xe(this,"depthStencilAttachment",null);const i=n.handle===null;this.device=t,this.gl=t.gl,this.handle=this.props.handle||i?this.props.handle:this.gl.createFramebuffer(),i||(t.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures(),this.updateAttachments())}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}updateAttachments(){const t=this.gl.bindFramebuffer(36160,this.handle);for(let n=0;n<this.colorAttachments.length;++n){const i=this.colorAttachments[n];if(i){const s=36064+n;this._attachTextureView(s,i)}}if(this.depthStencilAttachment){const n=Bce(this.depthStencilAttachment.props.format);this._attachTextureView(n,this.depthStencilAttachment)}if(this.device.props.debug){const n=this.gl.checkFramebufferStatus(36160);if(n!==36053)throw new Error(`Framebuffer ${Mce(n)}`)}this.gl.bindFramebuffer(36160,t)}_attachTextureView(t,n){const{gl:i}=this.device,{texture:s}=n,a=n.props.baseMipLevel,o=n.props.baseArrayLayer;switch(i.bindTexture(s.glTarget,s.handle),s.glTarget){case 35866:case 32879:i.framebufferTextureLayer(36160,t,s.handle,a,o);break;case 34067:const h=Ice(o);i.framebufferTexture2D(36160,t,h,s.handle,a);break;case 3553:i.framebufferTexture2D(36160,t,3553,s.handle,a);break;default:throw new Error("Illegal texture type")}i.bindTexture(s.glTarget,null)}}function Ice(r){return r<34069?r+34069:r}function Mce(r){switch(r){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${r}`}}class Pce extends tI{constructor(t,n){super(n);xe(this,"device");xe(this,"format","rgba8unorm");xe(this,"depthStencilFormat","depth24plus");xe(this,"presentationSize");xe(this,"_framebuffer",null);this.device=t,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}get[Symbol.toStringTag](){return"WebGLCanvasContext"}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new T1(this.device,{handle:null}),this._framebuffer}update(){const t=this.getPixelSize();(t[0]!==this.presentationSize[0]||t[1]!==this.presentationSize[1])&&(this.presentationSize=t,this.resize())}resize(t){if(this.device.gl&&this.canvas){const n=this.getDevicePixelRatio(t==null?void 0:t.useDevicePixels);this.setDevicePixelRatio(n,t);return}}commit(){}}async function XN(r,e){const t=document.getElementsByTagName("head")[0];if(!t)throw new Error("loadScript");const n=document.createElement("script");return n.setAttribute("type","text/javascript"),n.setAttribute("src",r),new Promise((i,s)=>{n.onload=i,n.onerror=a=>s(new Error(`Unable to load script '${r}': ${a}`)),t.appendChild(n)})}const Fce=1;let fo=null,JN=!1;const f3={debugSpectorJS:an.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};async function Rce(r){if(!globalThis.SPECTOR)try{await XN(r.debugSpectorJSUrl||f3.debugSpectorJSUrl)}catch(e){an.warn(String(e))}}function Lce(r){var e;if(r={...f3,...r},!r.debugSpectorJS)return null;if(!fo&&globalThis.SPECTOR&&!((e=globalThis.luma)!=null&&e.spector)){an.probe(Fce,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();const{Spector:t}=globalThis.SPECTOR;fo=new t,globalThis.luma&&(globalThis.luma.spector=fo)}if(!fo)return null;if(JN||(JN=!0,fo.spyCanvases(),fo==null||fo.onCaptureStarted.add(t=>an.info("Spector capture started:",t)()),fo==null||fo.onCapture.add(t=>{an.info("Spector capture complete:",t)(),fo==null||fo.getResultUI(),fo==null||fo.resultView.display(),fo==null||fo.resultView.addCapture(t)})),r.gl){const t=r.gl,n=t.device;fo==null||fo.startCapture(r.gl,500),t.device=n,new Promise(i=>setTimeout(i,2e3)).then(i=>{an.info("Spector capture stopped after 2 seconds")(),fo==null||fo.stopCapture()})}return fo}const Dce=globalThis.navigator||{};function ZN(r){var n,i;if(typeof window<"u"&&((n=window.process)==null?void 0:n.type)==="renderer"||typeof process<"u"&&((i=process.versions)!=null&&i.electron))return!0;const t=typeof navigator<"u"&&navigator.userAgent;return!!(t&&t.indexOf("Electron")>=0)}function YN(){return!(typeof process=="object"&&String(process)==="[object process]"&&!(process!=null&&process.browser))||ZN()}function Oce(r){return YN()?ZN()?"Electron":(Dce.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node"}const kce="https://unpkg.com/webgl-debug@2.0.1/index.js";function e6(r){return r.luma=r.luma||{},r.luma}async function Uce(){YN()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await XN(kce))}function Nce(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e.debugWebGL||e.traceWebGL?Hce(r,e):zce(r)}function zce(r){const e=e6(r);return e.realContext?e.realContext:r}function Hce(r,e){if(!globalThis.WebGLDebugUtils)return an.warn("webgl-debug not loaded")(),r;const t=e6(r);if(t.debugContext)return t.debugContext;globalThis.WebGLDebugUtils.init({...H_,...r});const n=globalThis.WebGLDebugUtils.makeDebugContext(r,Vce.bind(null,e),Gce.bind(null,e));for(const a in H_)!(a in n)&&typeof H_[a]=="number"&&(n[a]=H_[a]);class i{}Object.setPrototypeOf(n,Object.getPrototypeOf(r)),Object.setPrototypeOf(i,n);const s=Object.create(i);return t.realContext=r,t.debugContext=s,s.debug=!0,s}function t6(r,e){e=Array.from(e).map(n=>n===void 0?"undefined":n);let t=globalThis.WebGLDebugUtils.glFunctionArgsToString(r,e);return t=`${t.slice(0,100)}${t.length>100?"...":""}`,`gl.${r}(${t})`}function Vce(r,e,t,n){n=Array.from(n).map(o=>o===void 0?"undefined":o);const i=globalThis.WebGLDebugUtils.glEnumToString(e),s=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,n),a=`${i} in gl.${t}(${s})`;an.error(a)();debugger}function Gce(r,e,t){let n="";an.level>=1&&(n=t6(e,t),r.traceWebGL&&an.log(1,n)());for(const i of t)if(i===void 0){n=n||t6(e,t);debugger}}const A3={};function Qce(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"id";A3[r]=A3[r]||1;const e=A3[r]++;return`${r}-${e}`}class S1 extends La{constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(t,n);xe(this,"device");xe(this,"gl");xe(this,"handle");xe(this,"glTarget");xe(this,"glUsage");xe(this,"glIndexType",5123);xe(this,"byteLength");xe(this,"bytesUsed");this.device=t,this.gl=this.device.gl;const i=typeof n=="object"?n.handle:void 0;this.handle=i||this.gl.createBuffer(),t.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=$ce(this.props.usage),this.glUsage=jce(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,n.data?this._initWithData(n.data,n.byteOffset,n.byteLength):this._initWithByteLength(n.byteLength||0)}_initWithData(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:t.byteLength+n;const s=this.glTarget;this.gl.bindBuffer(s,this.handle),this.gl.bufferData(s,i,this.glUsage),this.gl.bufferSubData(s,n,t),this.gl.bindBuffer(s,null),this.bytesUsed=i,this.byteLength=i,this._setDebugData(t,n,i),this.trackAllocatedMemory(i)}_initWithByteLength(t){let n=t;t===0&&(n=new Float32Array(0));const i=this.glTarget;return this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,n,this.glUsage),this.gl.bindBuffer(i,null),this.bytesUsed=t,this.byteLength=t,this._setDebugData(null,0,t),this.trackAllocatedMemory(t),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const i=36663;this.gl.bindBuffer(i,this.handle),this.gl.bufferSubData(i,n,t),this.gl.bindBuffer(i,null),this._setDebugData(t,n,t.byteLength)}async readAsync(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1?arguments[1]:void 0;return this.readSyncWebGL(t,n)}readSyncWebGL(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1?arguments[1]:void 0;n=n??this.byteLength-t;const i=new Uint8Array(n),s=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,t,i,s,n),this.gl.bindBuffer(36662,null),this._setDebugData(i,t,n),i}}function $ce(r){return r&La.INDEX?34963:r&La.VERTEX?34962:r&La.UNIFORM?35345:34962}function jce(r){return r&La.INDEX||r&La.VERTEX?35044:r&La.UNIFORM?35048:35044}function qce(r){const e=r.split(/\r?\n/),t=[];for(const n of e){if(n.length<=1)continue;const i=n.split(":");if(i.length===2){const[x,T]=i;t.push({message:T.trim(),type:r6(x),lineNum:0,linePos:0});continue}const[s,a,o,...h]=i;let f=parseInt(o,10);isNaN(f)&&(f=0);let _=parseInt(a,10);isNaN(_)&&(_=0),t.push({message:h.join(":").trim(),type:r6(s),lineNum:f,linePos:_})}return t}function r6(r){const e=["warning","error","info"],t=r.toLowerCase();return e.includes(t)?t:"info"}class Kce extends qx{constructor(t,n){super(t,n);xe(this,"device");xe(this,"handle");switch(this.device=t,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}get asyncCompilationStatus(){return this._waitForCompilationComplete().then(()=>this.compilationStatus)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const t=this.device.gl.getShaderInfoLog(this.handle);return t?qce(t):[]}getTranslatedSource(){const n=this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders;return(n==null?void 0:n.getTranslatedShaderSource(this.handle))||null}async _compile(t){t=t.startsWith("#version ")?t:`#version 300 es
${t}`;const{gl:n}=this.device;if(n.shaderSource(this.handle,t),n.compileShader(this.handle),!this.device.props.debug){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}an.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),an.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const t=async s=>await new Promise(a=>setTimeout(a,s));if(!this.device.features.has("compilation-status-async-webgl")){await t(10);return}const{gl:i}=this.device;for(;;){if(i.getShaderParameter(this.handle,37297))return;await t(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}function Wce(r,e,t,n){if(Yce(e))return n(r);const i=r;i.pushState();try{return Xce(r,e),V_(i.gl,t),n(r)}finally{i.popState()}}function Xce(r,e){const t=r,{gl:n}=t;if(e.cullMode)switch(e.cullMode){case"none":n.disable(2884);break;case"front":n.enable(2884),n.cullFace(1028);break;case"back":n.enable(2884),n.cullFace(1029);break}if(e.frontFace&&n.frontFace(Lg("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&r.features.has("depth-clip-control")&&n.enable(34383),e.depthBias!==void 0&&(n.enable(32823),n.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&r.features.has("provoking-vertex-webgl")){const s=t.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,a=Lg("provokingVertex",e.provokingVertex,{first:36429,last:36430});s==null||s.provokingVertexWEBGL(a)}if((e.polygonMode||e.polygonOffsetLine)&&r.features.has("polygon-mode-webgl")){if(e.polygonMode){const s=t.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,a=Lg("polygonMode",e.polygonMode,{fill:6914,line:6913});s==null||s.polygonModeWEBGL(1028,a),s==null||s.polygonModeWEBGL(1029,a)}e.polygonOffsetLine&&n.enable(10754)}if(r.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&n.enable(12288),e.clipDistance1&&n.enable(12289),e.clipDistance2&&n.enable(12290),e.clipDistance3&&n.enable(12291),e.clipDistance4&&n.enable(12292),e.clipDistance5&&n.enable(12293),e.clipDistance6&&n.enable(12294),e.clipDistance7&&n.enable(12295)),e.depthWriteEnabled!==void 0&&n.depthMask(Zce("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?n.enable(2929):n.disable(2929),n.depthFunc(p3("depthCompare",e.depthCompare))),e.stencilWriteMask){const i=e.stencilWriteMask;n.stencilMaskSeparate(1028,i),n.stencilMaskSeparate(1029,i)}if(e.stencilReadMask&&an.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){const i=e.stencilReadMask||4294967295,s=p3("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?n.enable(2960):n.disable(2960),n.stencilFuncSeparate(1028,s,0,i),n.stencilFuncSeparate(1029,s,0,i)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){const i=g3("stencilPassOperation",e.stencilPassOperation),s=g3("stencilFailOperation",e.stencilFailOperation),a=g3("stencilDepthFailOperation",e.stencilDepthFailOperation);n.stencilOpSeparate(1028,s,a,i),n.stencilOpSeparate(1029,s,a,i)}switch(e.blend){case!0:n.enable(3042);break;case!1:n.disable(3042);break}if(e.blendColorOperation||e.blendAlphaOperation){const i=n6("blendColorOperation",e.blendColorOperation||"add"),s=n6("blendAlphaOperation",e.blendAlphaOperation||"add");n.blendEquationSeparate(i,s);const a=Rw("blendColorSrcFactor",e.blendColorSrcFactor||"one"),o=Rw("blendColorDstFactor",e.blendColorDstFactor||"zero"),h=Rw("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),f=Rw("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");n.blendFuncSeparate(a,o,h,f)}}function p3(r,e){return Lg(r,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function g3(r,e){return Lg(r,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function n6(r,e){return Lg(r,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function Rw(r,e){return Lg(r,e,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function Jce(r,e){return`Illegal parameter ${e} for ${r}`}function Lg(r,e,t){if(!(e in t))throw new Error(Jce(r,e));return t[e]}function Zce(r,e){return e}function Yce(r){let e=!0;for(const t in r){e=!1;break}return e}function i6(r){const e={};return r.addressModeU&&(e[10242]=m3(r.addressModeU)),r.addressModeV&&(e[10243]=m3(r.addressModeV)),r.addressModeW&&(e[32882]=m3(r.addressModeW)),r.magFilter&&(e[10240]=_3(r.magFilter)),(r.minFilter||r.mipmapFilter)&&(e[10241]=eue(r.minFilter||"linear",r.mipmapFilter)),r.lodMinClamp!==void 0&&(e[33082]=r.lodMinClamp),r.lodMaxClamp!==void 0&&(e[33083]=r.lodMaxClamp),r.type==="comparison-sampler"&&(e[34892]=34894),r.compare&&(e[34893]=p3("compare",r.compare)),r.maxAnisotropy&&(e[34046]=r.maxAnisotropy),e}function m3(r){switch(r){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function _3(r){switch(r){case"nearest":return 9728;case"linear":return 9729}}function eue(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"none";if(!e)return _3(r);switch(e){case"none":return _3(r);case"nearest":return r==="nearest"?9984:9986;case"linear":return r==="nearest"?9985:9987}}class y3 extends Kx{constructor(t,n){super(t,n);xe(this,"device");xe(this,"handle");xe(this,"parameters");this.device=t,this.parameters=i6(n),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(t){for(const[n,i]of Object.entries(t)){const s=Number(n);switch(s){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,s,i);break;default:this.device.gl.samplerParameteri(this.handle,s,i);break}}}}class j_ extends jx{constructor(t,n){super(t,{...ia.defaultProps,...n});xe(this,"device");xe(this,"gl");xe(this,"handle");xe(this,"texture");this.device=t,this.gl=this.device.gl,this.handle=null,this.texture=n.texture}}const tue="Failed to deduce GL constant from typed array";function rue(r){switch(ArrayBuffer.isView(r)?r.constructor:r){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(tue)}}function nue(r,e){const{clamped:t=!0}=e||{};switch(r){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return t?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function s6(r){switch(r){case 6406:case 33326:case 6403:case 36244:return 1;case 33339:case 33340:case 33328:case 33320:case 33319:return 2;case 6407:case 36248:case 34837:return 3;case 6408:case 36249:case 34836:return 4;default:return 0}}function iue(r){switch(r){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return 0}}function Lw(r,e,t){if(sue(e))return t(r);const{nocatch:n=!0}=e,i=Rg.get(r);i.push(),V_(r,e);let s;if(n)s=t(r),i.pop();else try{s=t(r)}finally{i.pop()}return s}function sue(r){for(const e in r)return!1;return!0}function oue(r,e,t){const{dimension:n,width:i,height:s,depth:a=0}=t,{glInternalFormat:o}=t,h=t.glTarget;switch(n){case"2d-array":case"3d":r.texStorage3D(h,e,o,i,s,a);break;default:r.texStorage2D(h,e,o,i,s)}}function o6(r,e,t,n){const{width:i,height:s}=n,{dimension:a,depth:o=0,mipLevel:h=0}=n,{x:f=0,y:_=0,z:x=0}=n,{glFormat:T,glType:I}=n,N=l6(n.glTarget,a,o),$=n.flipY?{37440:!0}:{};Lw(r,$,()=>{switch(a){case"2d-array":case"3d":r.bindTexture(N,e),r.texSubImage3D(N,h,f,_,x,i,s,o,T,I,t),r.bindTexture(N,null);break;case"2d":case"cube":r.bindTexture(N,e),r.texSubImage2D(N,h,f,_,i,s,T,I,t),r.bindTexture(N,null);break;default:throw new Error(a)}})}function a6(r,e,t){const{dimension:n,width:i,height:s,depth:a=0,mipLevel:o=0,byteOffset:h=0}=t,{x:f=0,y:_=0,z:x=0}=t,{glFormat:T,glType:I,compressed:N}=t,$=l6(t.glTarget,n,a);switch(n){case"2d-array":case"3d":N?r.compressedTexSubImage3D($,o,f,_,x,i,s,a,T,e,h):r.texSubImage3D($,o,f,_,x,i,s,a,T,I,e,h);break;case"2d":case"cube":N?r.compressedTexSubImage2D($,o,f,_,i,s,T,e,h):r.texSubImage2D($,o,f,_,i,s,T,I,e,h);break;default:throw new Error(n)}}function aue(r){switch(r){case"1d":break;case"2d":return 3553;case"3d":return 32879;case"cube":return 34067;case"2d-array":return 35866}throw new Error(r)}function l6(r,e,t){return e==="cube"?34069+t:r}function lue(r,e){var Y;const{sourceX:t=0,sourceY:n=0,sourceAttachment:i=0}=e||{};let{target:s=null,sourceWidth:a,sourceHeight:o,sourceDepth:h,sourceFormat:f,sourceType:_}=e||{};const{framebuffer:x,deleteFramebuffer:T}=c6(r),{gl:I,handle:N}=x;a||(a=x.width),o||(o=x.height);const $=(Y=x.colorAttachments[i])==null?void 0:Y.texture;if(!$)throw new Error(`Invalid framebuffer attachment ${i}`);h=($==null?void 0:$.depth)||1,f||(f=($==null?void 0:$.glFormat)||6408),_||(_=($==null?void 0:$.glType)||5121),s=hue(s,_,f,a,o),_=_||rue(s);const W=I.bindFramebuffer(36160,N);return I.readBuffer(36064+i),I.readPixels(t,n,a,o,f,_,s),I.readBuffer(36064),I.bindFramebuffer(36160,W||null),T&&x.destroy(),s}function cue(r,e){const{target:t,sourceX:n=0,sourceY:i=0,sourceFormat:s=6408,targetByteOffset:a=0}=e||{};let{sourceWidth:o,sourceHeight:h,sourceType:f}=e||{};const{framebuffer:_,deleteFramebuffer:x}=c6(r);o=o||_.width,h=h||_.height;const T=_;f=f||5121;let I=t;if(!I){const $=s6(s),W=iue(f),Y=a+o*h*$*W;I=T.device.createBuffer({byteLength:Y})}const N=r.device.createCommandEncoder();return N.copyTextureToBuffer({sourceTexture:r,width:o,height:h,origin:[n,i],destinationBuffer:I,byteOffset:a}),N.destroy(),x&&_.destroy(),I}function c6(r){return r instanceof Wx?{framebuffer:r,deleteFramebuffer:!1}:{framebuffer:uue(r),deleteFramebuffer:!0}}function uue(r,e){const{device:t,width:n,height:i,id:s}=r;return t.createFramebuffer({...e,id:`framebuffer-for-${s}`,width:n,height:i,colorAttachments:[r]})}function hue(r,e,t,n,i,s){if(r)return r;e||(e=5121);const a=nue(e,{clamped:!1}),o=s6(t);return new a(n*i*o)}class I1 extends ia{constructor(t,n){super(t,n);xe(this,"device");xe(this,"gl");xe(this,"handle");xe(this,"sampler");xe(this,"view");xe(this,"mipmaps");xe(this,"compressed");xe(this,"glTarget");xe(this,"glFormat");xe(this,"glType");xe(this,"glInternalFormat");xe(this,"textureUnit",0);const i={...this.props};i.data=n.data,this.device=t,this.gl=this.device.gl,this.glTarget=aue(this.props.dimension);const s=KN(this.props.format);this.glInternalFormat=s.internalFormat,this.glFormat=s.format,this.glType=s.type,this.compressed=s.compressed,this.mipmaps=!!this.props.mipmaps,this._initialize(i),Object.seal(this)}_initialize(t){this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:t.data});let{width:n,height:i}=t;if(!n||!i){const s=ia.getTextureDataSize(t.data);n=(s==null?void 0:s.width)||1,i=(s==null?void 0:s.height)||1}if(this.width=n,this.height=i,this.depth=t.depth,this.setSampler(t.sampler),this.view=new j_(this.device,{...this.props,texture:this}),this.bind(),oue(this.gl,this.mipLevels,this),t.data)switch(t.dimension){case"1d":this.setTexture1DData(t.data);break;case"2d":this.setTexture2DData(t.data);break;case"3d":this.setTexture3DData(t.data);break;case"cube":this.setTextureCubeData(t.data);break;case"2d-array":this.setTextureArrayData(t.data);break;case"cube-array":this.setTextureCubeArrayData(t.data);break;default:throw new Error(t.dimension)}this.mipmaps&&this.generateMipmap()}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}createView(t){return new j_(this.device,{...t,texture:this})}setSampler(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n;t instanceof y3?(this.sampler=t,n=t.props):(this.sampler=new y3(this.device,t),n=t);const i=i6(n);this._setSamplerParameters(i)}generateMipmap(t){if(!(!(this.device.isTextureFormatRenderable(this.props.format)&&this.device.isTextureFormatFilterable(this.props.format))&&(an.warn(`${this} is not renderable or filterable, may not be able to generate mipmaps`)(),!(t!=null&&t.force))))try{this.gl.bindTexture(this.glTarget,this.handle),this.gl.generateMipmap(this.glTarget)}catch(i){an.warn(`Error generating mipmap for ${this}: ${i.message}`)()}finally{this.gl.bindTexture(this.glTarget,null)}}copyExternalImage(t){const n=ia.getExternalImageSize(t.image),i={...ia.defaultCopyExternalImageOptions,...n,...t},{image:s,depth:a,mipLevel:o,x:h,y:f,z:_,flipY:x}=i;let{width:T,height:I}=i;const{dimension:N,glTarget:$,glFormat:W,glInternalFormat:Y,glType:ie}=this;if(T=Math.min(T,this.width-h),I=Math.min(I,this.height-f),t.sourceX||t.sourceY)throw new Error("WebGL does not support sourceX/sourceY)");return o6(this.device.gl,this.handle,s,{dimension:N,mipLevel:o,x:h,y:f,z:_,width:T,height:I,depth:a,glFormat:W,glInternalFormat:Y,glType:ie,glTarget:$,flipY:x}),{width:i.width,height:i.height}}setTexture1DData(t){throw new Error("setTexture1DData not supported in WebGL.")}setTexture2DData(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;this.bind();const i=ia.normalizeTextureData(t,this);i.length>1&&this.props.mipmaps!==!1&&an.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let s=0;s<i.length;s++){const a=i[s];this._setMipLevel(n,s,a)}this.unbind()}setTexture3DData(t){if(this.props.dimension!=="3d")throw new Error(this.id);ArrayBuffer.isView(t)&&(this.bind(),a6(this.device.gl,t,this),this.unbind())}setTextureCubeData(t){if(this.props.dimension!=="cube")throw new Error(this.id);for(const n of ia.CubeFaces)this.setTextureCubeFaceData(t[n],n)}setTextureArrayData(t){throw this.props.dimension!=="2d-array"?new Error(this.id):new Error("setTextureArrayData not implemented.")}setTextureCubeArrayData(t){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}setTextureCubeFaceData(t,n){Array.isArray(t)&&t.length>1&&this.props.mipmaps!==!1&&an.warn(`${this.id} has mipmap and multiple LODs.`)();const i=ia.CubeFaces.indexOf(n);this.setTexture2DData(t,i)}update(){throw new Error("Texture.update() not implemented. Use ExternalTexture")}setImageDataForFace(t){const{face:n,width:i,height:s,pixels:a,data:o,format:h=6408,type:f=5121}=t,{gl:_}=this,x=a||o;this.bind(),x instanceof Promise?x.then(T=>this.setImageDataForFace(Object.assign({},t,{face:n,data:T,pixels:T}))):this.width||this.height?_.texImage2D(n,0,h,i,s,0,h,f,x):_.texImage2D(n,0,h,h,f,x)}_getImageDataMap(t){for(let n=0;n<ia.CubeFaces.length;++n){const i=ia.CubeFaces[n];t[i]&&(t[34069+n]=t[i],delete t[i])}return t}_setSamplerParameters(t){an.log(1,`${this.id} sampler parameters`,this.device.getGLKeys(t))(),this.gl.bindTexture(this.glTarget,this.handle);for(const[n,i]of Object.entries(t)){const s=Number(n),a=i;switch(s){case 33082:case 33083:this.gl.texParameterf(this.glTarget,s,a);break;case 10241:this.gl.texParameteri(this.glTarget,s,a);break;case 10242:case 10243:this.gl.texParameteri(this.glTarget,s,a);break;case 34046:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,s,a);break;default:this.gl.texParameteri(this.glTarget,s,a);break}}this.gl.bindTexture(this.glTarget,null)}_setMipLevel(t,n,i){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:this.glTarget;if(ia.isExternalImage(i)){o6(this.device.gl,this.handle,i,{...this,depth:t,mipLevel:n,glTarget:s,flipY:this.props.flipY});return}if(ia.isTextureLevelData(i)){a6(this.device.gl,i.data,{...this,depth:t,mipLevel:n,glTarget:s});return}throw new Error("Texture: invalid image data")}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(t){const{gl:n}=this;return t!==void 0&&(this.textureUnit=t,n.activeTexture(33984+t)),n.bindTexture(this.glTarget,this.handle),t}unbind(t){const{gl:n}=this;return t!==void 0&&(this.textureUnit=t,n.activeTexture(33984+t)),n.bindTexture(this.glTarget,null),t}}const due=[1,2,4,8];class fue extends rI{constructor(t,n){var a;super(t,n);xe(this,"device");xe(this,"glParameters");this.device=t;let i;if(!((a=n==null?void 0:n.parameters)!=null&&a.viewport))if(n!=null&&n.framebuffer){const{width:o,height:h}=n.framebuffer;i=[0,0,o,h]}else{const[o,h]=t.getCanvasContext().getDrawingBufferSize();i=[0,0,o,h]}this.device.pushState(),this.setParameters({viewport:i,...this.props.parameters});const s=this.props.framebuffer;if(s!=null&&s.handle)if(this.props.framebuffer){const o=this.props.framebuffer.colorAttachments.map((h,f)=>36064+f);this.device.gl.drawBuffers(o)}else this.device.gl.drawBuffers([1029]);this.clear()}end(){this.device.popState()}pushDebugGroup(t){}popDebugGroup(){}insertDebugMarker(t){}setParameters(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n={...this.glParameters};n.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(n.depthMask=!this.props.depthReadOnly),n.stencilMask=this.props.stencilReadOnly?0:1,n[35977]=this.props.discard,t.viewport&&(t.viewport.length>=6?(n.viewport=t.viewport.slice(0,4),n.depthRange=[t.viewport[4],t.viewport[5]]):n.viewport=t.viewport),t.scissorRect&&(n.scissorTest=!0,n.scissor=t.scissorRect),t.blendConstant&&(n.blendColor=t.blendConstant),t.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),t[2967]=t.stencilReference),t.colorMask&&(n.colorMask=due.map(i=>!!(i&t.colorMask))),this.glParameters=n,V_(this.device.gl,n)}beginOcclusionQuery(t){const n=this.props.occlusionQuerySet;n==null||n.beginOcclusionQuery()}endOcclusionQuery(){const t=this.props.occlusionQuerySet;t==null||t.endOcclusionQuery()}clear(){const t={...this.glParameters};let n=0;this.props.clearColors&&this.props.clearColors.forEach((i,s)=>{i&&this.clearColorBuffer(s,i)}),this.props.clearColor!==!1&&this.props.clearColors===void 0&&(n|=16384,t.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(n|=256,t.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(n|=1024,t.clearStencil=this.props.clearStencil),n!==0&&Lw(this.device.gl,t,()=>{this.device.gl.clear(n)})}clearColorBuffer(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0,0];Lw(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(n.constructor){case Int8Array:case Int16Array:case Int32Array:this.device.gl.clearBufferiv(6144,t,n);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:this.device.gl.clearBufferuiv(6144,t,n);break;case Float32Array:this.device.gl.clearBufferfv(6144,t,n);break;default:throw new Error("clearColorBuffer: color must be typed array")}})}}function Aue(r){return pue.includes(r)}const pue=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],u6={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function h6(r){const e=u6[r];if(!e)throw new Error("uniform");const[t,n,,i]=e;return{format:i,components:n,glType:t}}function gue(r){const e=u6[r];if(!e)throw new Error("attribute");const[,t,,n,i]=e;return{attributeType:n,vertexFormat:i,components:t}}function mue(r,e){const t={attributes:[],bindings:[]};t.attributes=_ue(r,e);const n=vue(r,e);for(const o of n){const h=o.uniforms.map(f=>({name:f.name,format:f.format,byteOffset:f.byteOffset,byteStride:f.byteStride,arrayLength:f.arrayLength}));t.bindings.push({type:"uniform",name:o.name,group:0,location:o.location,visibility:(o.vertex?1:0)&(o.fragment?2:0),minBindingSize:o.byteLength,uniforms:h})}const i=bue(r,e);let s=0;for(const o of i)if(Aue(o.type)){const{viewDimension:h,sampleType:f}=wue(o.type);t.bindings.push({type:"texture",name:o.name,group:0,location:s,viewDimension:h,sampleType:f}),o.textureUnit=s,s+=1}i.length&&(t.uniforms=i);const a=yue(r,e);return a!=null&&a.length&&(t.varyings=a),t}function _ue(r,e){const t=[],n=r.getProgramParameter(e,35721);for(let i=0;i<n;i++){const s=r.getActiveAttrib(e,i);if(!s)throw new Error("activeInfo");const{name:a,type:o}=s,h=r.getAttribLocation(e,a);if(h>=0){const{attributeType:f}=gue(o),_=/instance/i.test(a)?"instance":"vertex";t.push({name:a,location:h,stepMode:_,type:f})}}return t.sort((i,s)=>i.location-s.location),t}function yue(r,e){const t=[],n=r.getProgramParameter(e,35971);for(let i=0;i<n;i++){const s=r.getTransformFeedbackVarying(e,i);if(!s)throw new Error("activeInfo");const{name:a,type:o,size:h}=s,{glType:f,components:_}=h6(o),x={location:i,name:a,type:f,size:h*_};t.push(x)}return t.sort((i,s)=>i.location-s.location),t}function bue(r,e){const t=[],n=r.getProgramParameter(e,35718);for(let i=0;i<n;i++){const s=r.getActiveUniform(e,i);if(!s)throw new Error("activeInfo");const{name:a,size:o,type:h}=s,{name:f,isArray:_}=Bue(a);let x=r.getUniformLocation(e,f);const T={location:x,name:f,size:o,type:h,isArray:_};if(t.push(T),T.size>1)for(let I=0;I<T.size;I++){const N=`${f}[${I}]`;x=r.getUniformLocation(e,N);const $={...T,name:N,location:x};t.push($)}}return t}function vue(r,e){const t=(s,a)=>r.getActiveUniformBlockParameter(e,s,a),n=[],i=r.getProgramParameter(e,35382);for(let s=0;s<i;s++){const a={name:r.getActiveUniformBlockName(e,s)||"",location:t(s,35391),byteLength:t(s,35392),vertex:t(s,35396),fragment:t(s,35398),uniformCount:t(s,35394),uniforms:[]},o=t(s,35395)||[],h=r.getActiveUniforms(e,o,35383),f=r.getActiveUniforms(e,o,35384),_=r.getActiveUniforms(e,o,35387),x=r.getActiveUniforms(e,o,35388);for(let T=0;T<a.uniformCount;++T){const I=r.getActiveUniform(e,o[T]);if(!I)throw new Error("activeInfo");a.uniforms.push({name:I.name,format:h6(h[T]).format,type:h[T],arrayLength:f[T],byteOffset:_[T],byteStride:x[T]})}n.push(a)}return n.sort((s,a)=>s.location-a.location),n}const xue={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function wue(r){const e=xue[r];if(!e)throw new Error("sampler");const[t,n]=e;return{viewDimension:t,sampleType:n}}function Bue(r){if(r[r.length-1]!=="]")return{name:r,length:1,isArray:!1};const t=/([^[]*)(\[[0-9]+\])?/.exec(r);if(!t||t.length<2)throw new Error(`Failed to parse GLSL uniform name ${r}`);return{name:t[1],length:t[2]?1:0,isArray:!!t[2]}}function Cue(r,e,t,n){const i=r;let s=n;s===!0&&(s=1),s===!1&&(s=0);const a=typeof s=="number"?[s]:s;switch(t){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof n!="number")throw new Error("samplers must be set to integers");return r.uniform1i(e,n);case 5126:return r.uniform1fv(e,a);case 35664:return r.uniform2fv(e,a);case 35665:return r.uniform3fv(e,a);case 35666:return r.uniform4fv(e,a);case 5124:return r.uniform1iv(e,a);case 35667:return r.uniform2iv(e,a);case 35668:return r.uniform3iv(e,a);case 35669:return r.uniform4iv(e,a);case 35670:return r.uniform1iv(e,a);case 35671:return r.uniform2iv(e,a);case 35672:return r.uniform3iv(e,a);case 35673:return r.uniform4iv(e,a);case 5125:return i.uniform1uiv(e,a,1);case 36294:return i.uniform2uiv(e,a,2);case 36295:return i.uniform3uiv(e,a,3);case 36296:return i.uniform4uiv(e,a,4);case 35674:return r.uniformMatrix2fv(e,!1,a);case 35675:return r.uniformMatrix3fv(e,!1,a);case 35676:return r.uniformMatrix4fv(e,!1,a);case 35685:return i.uniformMatrix2x3fv(e,!1,a);case 35686:return i.uniformMatrix2x4fv(e,!1,a);case 35687:return i.uniformMatrix3x2fv(e,!1,a);case 35688:return i.uniformMatrix3x4fv(e,!1,a);case 35689:return i.uniformMatrix4x2fv(e,!1,a);case 35690:return i.uniformMatrix4x3fv(e,!1,a)}throw new Error("Illegal uniform")}function Eue(r){return ArrayBuffer.isView(r)&&!(r instanceof DataView)}function Tue(r){return Array.isArray(r)?r.length===0||typeof r[0]=="number":!1}function Sue(r){return Eue(r)||Tue(r)}function Iue(r){return Sue(r)!==null||typeof r=="number"||typeof r=="boolean"}function Mue(r){const e={bindings:{},uniforms:{}};return Object.keys(r).forEach(t=>{const n=r[t];Iue(n)?e.uniforms[t]=n:e.bindings[t]=n}),e}function Pue(r){switch(r){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"triangle-list":return 4;case"triangle-strip":return 5;default:throw new Error(r)}}function Fue(r){switch(r){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;default:throw new Error(r)}}const d6=4;class Rue extends v_{constructor(t,n){super(t,n);xe(this,"device");xe(this,"handle");xe(this,"vs");xe(this,"fs");xe(this,"introspectedLayout");xe(this,"uniforms",{});xe(this,"bindings",{});xe(this,"varyings",null);xe(this,"_uniformCount",0);xe(this,"_uniformSetters",{});this.device=t,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=n.vs,this.fs=n.fs;const{varyings:i,bufferMode:s=35981}=n;i&&i.length>0&&(this.varyings=i,this.device.gl.transformFeedbackVaryings(this.handle,i,s)),this._linkShaders(),an.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=mue(this.device.gl,this.handle),an.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=Lue(this.introspectedLayout,n.shaderLayout)}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(t,n){for(const[i,s]of Object.entries(t)){const a=this.shaderLayout.bindings.find(o=>o.name===i)||this.shaderLayout.bindings.find(o=>o.name===`${i}Uniforms`);if(!a){const o=this.shaderLayout.bindings.map(h=>`"${h.name}"`).join(", ");n!=null&&n.disableWarnings||an.warn(`No binding "${i}" in render pipeline "${this.id}", expected one of ${o}`,s)();continue}switch(s||an.warn(`Unsetting binding "${i}" in render pipeline "${this.id}"`)(),a.type){case"uniform":if(!(s instanceof S1)&&!(s.buffer instanceof S1))throw new Error("buffer value");break;case"texture":if(!(s instanceof j_||s instanceof I1||s instanceof T1))throw new Error("texture value");break;case"sampler":an.warn(`Ignoring sampler ${i}`)();break;default:throw new Error(a.type)}this.bindings[i]=s}}draw(t){var W;const{renderPass:n,parameters:i=this.props.parameters,topology:s=this.props.topology,vertexArray:a,vertexCount:o,instanceCount:h,isInstanced:f=!1,firstVertex:_=0,transformFeedback:x}=t,T=Pue(s),I=!!a.indexBuffer,N=(W=a.indexBuffer)==null?void 0:W.glIndexType;if(this.linkStatus!=="success")return an.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable())return an.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;this.device.gl.useProgram(this.handle),a.bindBeforeRender(n),x&&x.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const $=n;return Wce(this.device,i,$.glParameters,()=>{I&&f?this.device.gl.drawElementsInstanced(T,o||0,N,_,h||0):I?this.device.gl.drawElements(T,o||0,N,_):f?this.device.gl.drawArraysInstanced(T,_,o||0,h||0):this.device.gl.drawArrays(T,_,o||0),x&&x.end()}),a.unbindAfterRender(n),!0}setUniformsWebGL(t){const{bindings:n}=Mue(t);Object.keys(n).forEach(i=>{an.warn(`Unsupported value "${JSON.stringify(n[i])}" used in setUniforms() for key ${i}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,t)}async _linkShaders(){const{gl:t}=this.device;if(t.attachShader(this.handle,this.vs.handle),t.attachShader(this.handle,this.fs.handle),an.time(d6,`linkProgram for ${this.id}`)(),t.linkProgram(this.handle),an.timeEnd(d6,`linkProgram for ${this.id}`)(),an.level,!this.device.features.has("compilation-status-async-webgl")){const i=this._getLinkStatus();this._reportLinkStatus(i);return}an.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),an.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const n=this._getLinkStatus();this._reportLinkStatus(n)}async _reportLinkStatus(t){var n;switch(t){case"success":return;default:switch(this.vs.compilationStatus){case"error":throw this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`);case"pending":this.vs.asyncCompilationStatus.then(()=>this.vs.debugShader());break}switch((n=this.fs)==null?void 0:n.compilationStatus){case"error":throw this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`);case"pending":this.fs.asyncCompilationStatus.then(()=>this.fs.debugShader());break}const i=this.device.gl.getProgramInfoLog(this.handle);throw new Error(`Error during ${t}: ${i}`)}}_getLinkStatus(){const{gl:t}=this.device;return t.getProgramParameter(this.handle,35714)?(t.validateProgram(this.handle),t.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){const t=async s=>await new Promise(a=>setTimeout(a,s));if(!this.device.features.has("compilation-status-async-webgl")){await t(10);return}const{gl:i}=this.device;for(;;){if(i.getProgramParameter(this.handle,37297))return;await t(10)}}_areTexturesRenderable(){let t=!0;for(const n of this.shaderLayout.bindings)!this.bindings[n.name]&&!this.bindings[n.name.replace(/Uniforms$/,"")]&&(an.warn(`Binding ${n.name} not found in ${this.id}`)(),t=!1);return t}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:t}=this.device;t.useProgram(this.handle);let n=0,i=0;for(const s of this.shaderLayout.bindings){const a=this.bindings[s.name]||this.bindings[s.name.replace(/Uniforms$/,"")];if(!a)throw new Error(`No value for binding ${s.name} in ${this.id}`);switch(s.type){case"uniform":const{name:o}=s,h=t.getUniformBlockIndex(this.handle,o);if(h===4294967295)throw new Error(`Invalid uniform block name ${o}`);t.uniformBlockBinding(this.handle,i,h),a instanceof S1?t.bindBufferBase(35345,i,a.handle):t.bindBufferRange(35345,i,a.buffer.handle,a.offset||0,a.size||a.buffer.byteLength-a.offset),i+=1;break;case"texture":if(!(a instanceof j_||a instanceof I1||a instanceof T1))throw new Error("texture");let f;if(a instanceof j_)f=a.texture;else if(a instanceof I1)f=a;else if(a instanceof T1&&a.colorAttachments[0]instanceof j_)an.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),f=a.colorAttachments[0].texture;else throw new Error("No texture");t.activeTexture(33984+n),t.bindTexture(f.glTarget,f.handle),n+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${s.type}' not supported in WebGL`)}}}_applyUniforms(){for(const t of this.shaderLayout.uniforms||[]){const{name:n,location:i,type:s,textureUnit:a}=t,o=this.uniforms[n]??a;o!==void 0&&Cue(this.device.gl,i,s,o)}}}function Lue(r,e){const t={...r,attributes:r.attributes.map(n=>({...n}))};for(const n of(e==null?void 0:e.attributes)||[]){const i=t.attributes.find(s=>s.name===n.name);i?(i.type=n.type||i.type,i.stepMode=n.stepMode||i.stepMode):an.warn(`shader layout attribute ${n.name} not present in shader`)}return t}class Due extends iI{constructor(t){super(t,{});xe(this,"device");xe(this,"commands",[]);this.device=t}submitCommands(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.commands;for(const n of t)switch(n.name){case"copy-buffer-to-buffer":Oue(this.device,n.options);break;case"copy-buffer-to-texture":kue(this.device,n.options);break;case"copy-texture-to-buffer":Uue(this.device,n.options);break;case"copy-texture-to-texture":Nue(this.device,n.options);break;default:throw new Error(n.name)}}}function Oue(r,e){const t=e.sourceBuffer,n=e.destinationBuffer;r.gl.bindBuffer(36662,t.handle),r.gl.bindBuffer(36663,n.handle),r.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),r.gl.bindBuffer(36662,null),r.gl.bindBuffer(36663,null)}function kue(r,e){throw new Error("Not implemented")}function Uue(r,e){const{sourceTexture:t,mipLevel:n=0,aspect:i="all",width:s=e.sourceTexture.width,height:a=e.sourceTexture.height,depthOrArrayLayers:o=0,origin:h=[0,0],destinationBuffer:f,byteOffset:_=0,bytesPerRow:x,rowsPerImage:T}=e;if(i!=="all")throw new Error("aspect not supported in WebGL");if(n!==0||o!==0||x||T)throw new Error("not implemented");const{framebuffer:I,destroyFramebuffer:N}=f6(t);let $;try{const W=f,Y=s||I.width,ie=a||I.height,ce=KN(I.colorAttachments[0].texture.props.format),fe=ce.format,ve=ce.type;r.gl.bindBuffer(35051,W.handle),$=r.gl.bindFramebuffer(36160,I.handle),r.gl.readPixels(h[0],h[1],Y,ie,fe,ve,_)}finally{r.gl.bindBuffer(35051,null),$!==void 0&&r.gl.bindFramebuffer(36160,$),N&&I.destroy()}}function Nue(r,e){const{sourceTexture:t,destinationMipLevel:n=0,origin:i=[0,0],destinationOrigin:s=[0,0],destinationTexture:a}=e;let{width:o=e.destinationTexture.width,height:h=e.destinationTexture.height}=e;const{framebuffer:f,destroyFramebuffer:_}=f6(t),[x,T]=i,[I,N,$]=s,W=r.gl.bindFramebuffer(36160,f.handle);let Y=null,ie;if(a instanceof I1)Y=a,o=Number.isFinite(o)?o:Y.width,h=Number.isFinite(h)?h:Y.height,Y.bind(0),ie=Y.glTarget;else throw new Error("invalid destination");switch(ie){case 3553:case 34067:r.gl.copyTexSubImage2D(ie,n,I,N,x,T,o,h);break;case 35866:case 32879:r.gl.copyTexSubImage3D(ie,n,I,N,$,x,T,o,h);break}Y&&Y.unbind(),r.gl.bindFramebuffer(36160,W),_&&f.destroy()}function f6(r){if(r instanceof ia){const{width:e,height:t,id:n}=r;return{framebuffer:r.device.createFramebuffer({id:`framebuffer-for-${n}`,width:e,height:t,colorAttachments:[r]}),destroyFramebuffer:!0}}return{framebuffer:r,destroyFramebuffer:!1}}class zue extends nI{constructor(t,n){super(t,n);xe(this,"device");xe(this,"commandBuffer");this.device=t,this.commandBuffer=new Due(t)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(t){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:t})}copyBufferToTexture(t){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:t})}copyTextureToBuffer(t){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:t})}copyTextureToTexture(t){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:t})}pushDebugGroup(t){}popDebugGroup(){}insertDebugMarker(t){}resolveQuerySet(t,n,i){}}function Hue(r){const{target:e,source:t,start:n=0,count:i=1}=r,s=t.length,a=i*s;let o=0;for(let h=n;o<s;o++)e[h++]=t[o];for(;o<a;)o<a-o?(e.copyWithin(n+o,n,n+o),o*=2):(e.copyWithin(n+o,n,n+a-o),o=a);return r.target}class b3 extends sI{constructor(t,n){super(t,n);xe(this,"device");xe(this,"handle");xe(this,"buffer",null);xe(this,"bufferValue",null);this.device=t,this.handle=this.device.gl.createVertexArray()}get[Symbol.toStringTag](){return"VertexArray"}static isConstantAttributeZeroSupported(t){return Oce()==="Chrome"}destroy(){var t;super.destroy(),this.buffer&&((t=this.buffer)==null||t.destroy()),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(t){const n=t;if(n&&n.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,n?n.handle:null),this.indexBuffer=n,this.device.gl.bindVertexArray(null)}setBuffer(t,n){const i=n;if(i.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:s,type:a,stride:o,offset:h,normalized:f,integer:_,divisor:x}=this._getAccessor(t);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,i.handle),_?this.device.gl.vertexAttribIPointer(t,s,a,o,h):this.device.gl.vertexAttribPointer(t,s,a,f,o,h),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(t),this.device.gl.vertexAttribDivisor(t,x||0),this.attributes[t]=i,this.device.gl.bindVertexArray(null)}setConstantWebGL(t,n){this._enable(t,!1),this.attributes[t]=n}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let t=0;t<this.maxVertexAttributes;++t){const n=this.attributes[t];ArrayBuffer.isView(n)&&this.device.setConstantAttributeWebGL(t,n)}}_getAccessor(t){const n=this.attributeInfos[t];if(!n)throw new Error(`Unknown attribute location ${t}`);const i=$N(n.bufferDataType);return{size:n.bufferComponents,type:i,stride:n.byteStride,offset:n.byteOffset,normalized:n.normalized,integer:n.integer,divisor:n.stepMode==="instance"?1:0}}_enable(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;const s=b3.isConstantAttributeZeroSupported(this.device)||t!==0;(n||s)&&(t=Number(t),this.device.gl.bindVertexArray(this.handle),n?this.device.gl.enableVertexAttribArray(t):this.device.gl.disableVertexAttribArray(t),this.device.gl.bindVertexArray(null))}getConstantBuffer(t,n){const i=Vue(n),s=i.byteLength*t,a=i.length*t;if(this.buffer&&s!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${s} !== ${this.buffer.byteLength}.`);let o=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:s}),o=o||!Gue(i,this.bufferValue),o){const h=hne(n.constructor,a);Hue({target:h,source:i,start:0,count:a}),this.buffer.write(h),this.bufferValue=n}return this.buffer}}function Vue(r){return Array.isArray(r)?new Float32Array(r):r}function Gue(r,e){if(!r||!e||r.length!==e.length||r.constructor!==e.constructor)return!1;for(let t=0;t<r.length;++t)if(r[t]!==e[t])return!1;return!0}class Que extends oI{constructor(t,n){super(t,n);xe(this,"device");xe(this,"gl");xe(this,"handle");xe(this,"layout");xe(this,"buffers",{});xe(this,"unusedBuffers",{});xe(this,"bindOnUse",!0);xe(this,"_bound",!1);this.device=t,this.gl=t.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,n.buffers&&this.setBuffers(n.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"point-list";this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(Fue(t))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(t){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const n in t)this.setBuffer(n,t[n])})}setBuffer(t,n){const i=this._getVaryingIndex(t),{buffer:s,byteLength:a,byteOffset:o}=this._getBufferRange(n);if(i<0){this.unusedBuffers[t]=s,an.warn(`${this.id} unusedBuffers varying buffer ${t}`)();return}this.buffers[i]={buffer:s,byteLength:a,byteOffset:o},this.bindOnUse||this._bindBuffer(i,s,o,a)}getBuffer(t){if(A6(t))return this.buffers[t]||null;const n=this._getVaryingIndex(t);return n>=0?this.buffers[n]:null}bind(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.handle;if(typeof t!="function")return this.gl.bindTransformFeedback(36386,t),this;let n;return this._bound?n=t():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,n=t(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),n}unbind(){this.bind(null)}_getBufferRange(t){if(t instanceof S1)return{buffer:t,byteOffset:0,byteLength:t.byteLength};const{buffer:n,byteOffset:i=0,byteLength:s=t.buffer.byteLength}=t;return{buffer:n,byteOffset:i,byteLength:s}}_getVaryingIndex(t){if(A6(t))return Number(t);for(const n of this.layout.varyings)if(t===n.name)return n.location;return-1}_bindBuffers(){for(const t in this.buffers){const{buffer:n,byteLength:i,byteOffset:s}=this._getBufferRange(this.buffers[t]);this._bindBuffer(Number(t),n,s,i)}}_unbindBuffers(){for(const t in this.buffers)this.gl.bindBufferBase(35982,Number(t),null)}_bindBuffer(t,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=arguments.length>3?arguments[3]:void 0;const a=n&&n.handle;!a||s===void 0?this.gl.bindBufferBase(35982,t,a):this.gl.bindBufferRange(35982,t,a,i,s)}}function A6(r){return typeof r=="number"?Number.isInteger(r):/^\d+$/.test(r)}class $ue extends aI{constructor(t,n){super(t,n);xe(this,"device");xe(this,"handle");xe(this,"target",null);xe(this,"_queryPending",!1);xe(this,"_pollingPromise",null);if(this.device=t,n.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}get[Symbol.toStringTag](){return"Query"}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(t){return this._begin(t!=null&&t.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(t){this._queryPending||(this.target=t,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const t=this.device.gl.getQueryParameter(this.handle,34919);return t&&(this._queryPending=!1),t}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Number.POSITIVE_INFINITY;if(this._pollingPromise)return this._pollingPromise;let n=0;return this._pollingPromise=new Promise((i,s)=>{const a=()=>{this.isResultAvailable()?(i(this.getResult()),this._pollingPromise=null):n++>t?(s("Timed out"),this._pollingPromise=null):requestAnimationFrame(a)};requestAnimationFrame(a)}),this._pollingPromise}}class Ap extends YA{constructor(t){var x,T;super({...t,id:t.id||Qce("webgl-device")});xe(this,"type","webgl");xe(this,"handle");xe(this,"features");xe(this,"limits");xe(this,"info");xe(this,"canvasContext");xe(this,"lost");xe(this,"_resolveContextLost");xe(this,"gl");xe(this,"debug",!1);xe(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});xe(this,"_extensions",{});xe(this,"_polyfilled",!1);xe(this,"spectorJS");xe(this,"renderPass",null);xe(this,"_constants");const n=YA._getCanvasContextProps(t);if(!n)throw new Error("WebGLDevice requires props.createCanvasContext to be set");let i=(T=(x=n.canvas)==null?void 0:x.gl)==null?void 0:T.device;if(i)throw new Error(`WebGL context already attached to device ${i.id}`);this.canvasContext=new Pce(this,n),this.lost=new Promise(I=>{this._resolveContextLost=I});const s={...t.webgl};n.alphaMode==="premultiplied"&&(s.premultipliedAlpha=!0),t.powerPreference!==void 0&&(s.powerPreference=t.powerPreference);const o=this.props._handle||hce(this.canvasContext.canvas,{onContextLost:I=>{var N;return(N=this._resolveContextLost)==null?void 0:N.call(this,{reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."})},onContextRestored:I=>console.log("WebGL context restored")},s);if(!o)throw new Error("WebGL context creation failed");if(i=o.device,i){if(t._reuseDevices)return an.log(1,`Not creating a new Device, instead returning a reference to Device ${i.id} already attached to WebGL context`,i)(),i._reused=!0,i;throw new Error(`WebGL context already attached to device ${i.id}`)}this.handle=o,this.gl=o,this.spectorJS=Lce({...this.props,gl:this.handle}),this.gl.device=this,this.gl._version=2,this.info=dce(this.gl,this._extensions),this.limits=new Sce(this.gl),this.features=new Tce(this.gl,this._extensions,this.props._disabledFeatures),this.props._initializeFeatures&&this.features.initializeFeatures(),n.autoResize!==!1&&this.canvasContext.resize(),new Rg(this.gl,{log:function(){for(var I=arguments.length,N=new Array(I),$=0;$<I;$++)N[$]=arguments[$];return an.log(1,...N)()}}).trackState(this.gl,{copyState:!1});const f=t.debugWebGL||t.debug,_=t.debugWebGL;f&&(this.gl=Nce(this.gl,{debugWebGL:f,traceWebGL:_}),an.warn("WebGL debug mode activated. Performance reduced.")(),t.debugWebGL&&(an.level=Math.max(an.level,1)))}destroy(){!this.props._reuseDevices&&!this._reused&&delete this.gl.device}get isLost(){return this.gl.isContextLost()}createCanvasContext(t){throw new Error("WebGL only supports a single canvas")}createBuffer(t){const n=this._normalizeBufferProps(t);return new S1(this,n)}createTexture(t){return new I1(this,t)}createExternalTexture(t){throw new Error("createExternalTexture() not implemented")}createSampler(t){return new y3(this,t)}createShader(t){return new Kce(this,t)}createFramebuffer(t){return new T1(this,t)}createVertexArray(t){return new b3(this,t)}createTransformFeedback(t){return new Que(this,t)}createQuerySet(t){return new $ue(this,t)}createRenderPipeline(t){return new Rue(this,t)}beginRenderPass(t){return new fue(this,t)}createComputePipeline(t){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(t){throw new Error("ComputePass not supported in WebGL")}createCommandEncoder(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return new zue(this,t)}submit(){var t;(t=this.renderPass)==null||t.end(),this.renderPass=null}readPixelsToArrayWebGL(t,n){return lue(t,n)}readPixelsToBufferWebGL(t,n){return cue(t,n)}setParametersWebGL(t){V_(this.gl,t)}getParametersWebGL(t){return VN(this.gl,t)}withParametersWebGL(t,n){return Lw(this.gl,t,n)}resetWebGL(){an.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),oce(this.gl)}_getDeviceSpecificTextureFormatCapabilities(t){return wce(this.gl,t,this._extensions)}loseDevice(){var s;let t=!1;const i=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return i&&(t=!0,i.loseContext()),(s=this._resolveContextLost)==null||s.call(this,{reason:"destroyed",message:"Application triggered context loss"}),t}pushState(){Rg.get(this.gl).push()}popState(){Rg.get(this.gl).pop()}setSpectorMetadata(t,n){t.__SPECTOR_Metadata=n}getGLKey(t,n){const i=Number(t);for(const s in this.gl)if(this.gl[s]===i)return`GL.${s}`;return n!=null&&n.emptyIfUnknown?"":String(t)}getGLKeys(t){const n={emptyIfUnknown:!0};return Object.entries(t).reduce((i,s)=>{let[a,o]=s;return i[`${a}:${this.getGLKey(a,n)}`]=`${o}:${this.getGLKey(o,n)}`,i},{})}setConstantAttributeWebGL(t,n){const i=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(i).fill(null);const s=this._constants[t];switch(s&&Wue(s,n)&&an.info(1,`setConstantAttributeWebGL(${t}) could have been skipped, value unchanged`)(),this._constants[t]=n,n.constructor){case Float32Array:jue(this,t,n);break;case Int32Array:que(this,t,n);break;case Uint32Array:Kue(this,t,n);break;default:throw new Error("constant")}}getExtension(t){return G_(this.gl,t,this._extensions),this._extensions}}function jue(r,e,t){switch(t.length){case 1:r.gl.vertexAttrib1fv(e,t);break;case 2:r.gl.vertexAttrib2fv(e,t);break;case 3:r.gl.vertexAttrib3fv(e,t);break;case 4:r.gl.vertexAttrib4fv(e,t);break}}function que(r,e,t){r.gl.vertexAttribI4iv(e,t)}function Kue(r,e,t){r.gl.vertexAttribI4uiv(e,t)}function Wue(r,e){if(!r||!e||r.length!==e.length||r.constructor!==e.constructor)return!1;for(let t=0;t<r.length;++t)if(r[t]!==e[t])return!1;return!0}const Xue={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}},Jue=r=>({drawBuffersWEBGL(e){return r.drawBuffers(e)},COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067}),Zue=r=>({VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES(){return r.createVertexArray()},deleteVertexArrayOES(e){return r.deleteVertexArray(e)},isVertexArrayOES(e){return r.isVertexArray(e)},bindVertexArrayOES(e){return r.bindVertexArray(e)}}),Yue=r=>({VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE(){return r.drawArraysInstanced(...arguments)},drawElementsInstancedANGLE(){return r.drawElementsInstanced(...arguments)},vertexAttribDivisorANGLE(){return r.vertexAttribDivisor(...arguments)}});function ehe(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;const e=HTMLCanvasElement.prototype;if(!r&&e.originalGetContext){e.getContext=e.originalGetContext,e.originalGetContext=void 0;return}e.originalGetContext=e.getContext,e.getContext=function(t,n){if(t==="webgl"||t==="experimental-webgl"){const i=this.originalGetContext("webgl2",n);return i instanceof HTMLElement&&the(i),i}return this.originalGetContext(t,n)}}function the(r){r.getExtension("EXT_color_buffer_float");const e={...Xue,WEBGL_disjoint_timer_query:r.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:Jue(r),OES_vertex_array_object:Zue(r),ANGLE_instanced_arrays:Yue(r)},t=r.getExtension;r.getExtension=function(i){const s=t.call(r,i);return s||(i in e?e[i]:null)};const n=r.getSupportedExtensions;r.getSupportedExtensions=function(){const i=n.apply(r)||[];return i==null?void 0:i.concat(Object.keys(e))}}const Dw=1;class rhe extends Hre{constructor(){super();xe(this,"type","webgl");YA.defaultProps={...YA.defaultProps,...f3},Ap.adapter=this}isSupported(){return typeof WebGL2RenderingContext<"u"}enforceWebGL2(t){ehe(t)}async attach(t){if(t instanceof Ap)return t;if((t==null?void 0:t.device)instanceof YA)return t.device;if(!nhe(t))throw new Error("Invalid WebGL2RenderingContext");return new Ap({_handle:t,createCanvasContext:{canvas:t.canvas,autoResize:!1}})}async create(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};an.groupCollapsed(Dw,"WebGLDevice created")();const n=[];(t.debugWebGL||t.debug)&&n.push(Uce()),t.debugSpectorJS&&n.push(Rce(t));const i=await Promise.allSettled(n);for(const o of i)o.status==="rejected"&&an.error(`Failed to initialize debug libraries ${o.reason}`)();const s=new Ap(t),a=`${s._reused?"Reusing":"Created"} device with WebGL2 ${s.debug?"debug ":""}context: ${s.info.vendor}, ${s.info.renderer} for canvas: ${s.canvasContext.id}`;return an.probe(Dw,a)(),an.table(Dw,s.info)(),an.groupEnd(Dw)(),s}}function nhe(r){return typeof WebGL2RenderingContext<"u"&&r instanceof WebGL2RenderingContext?!0:!!(r&&Number.isFinite(r._version))}const p6=new rhe;function pp(){}const g6={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{type:"webgl"},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:pp,onWebGLInitialized:pp,onResize:pp,onViewStateChange:pp,onInteractionStateChange:pp,onBeforeRender:pp,onAfterRender:pp,onLoad:pp,onError:r=>Es.error(r.message,r.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:r=>{let{isDragging:e}=r;return e?"grabbing":"grab"},getTooltip:null,debug:!1,drawPickingColors:!1};class v3{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new mO({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=n=>{const{_pickRequest:i}=this;if(n.type==="pointerleave")i.x=-1,i.y=-1,i.radius=0;else{if(n.leftButton||n.rightButton)return;{const s=n.offsetCenter;if(!s)return;i.x=s.x,i.y=s.y,i.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:i.x,y:i.y}),i.event=n},this._onEvent=n=>{const i=BI[n.type],s=n.offsetCenter;if(!i||!s||!this.layerManager)return;const a=this.layerManager.getLayers(),o=this.deckPicker.getLastPickedObject({x:s.x,y:s.y,layers:a,viewports:this.getViewports(s)},this._lastPointerDownInfo),{layer:h}=o,f=h&&(h[i]||h.props[i]),_=this.props[i];let x=!1;f&&(x=f.call(h,o,n)),x||(_==null||_(o,n),this.widgetManager.onEvent(o,n))},this._onPointerDown=n=>{const i=n.offsetCenter,s=this._pick("pickObject","pickObject Time",{x:i.x,y:i.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=s.result[0]||s.emptyInfo},this.props={...g6,...e},e=this.props,e.viewState&&e.initialViewState&&Es.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device&&(this.device=e.device);let t=this.device;!t&&e.gl&&(e.gl instanceof WebGLRenderingContext&&Es.error("WebGL1 context not supported.")(),t=p6.attach(e.gl)),t||(t=eI.createDevice({type:"best-available",_reuseDevices:!0,adapters:[p6],...e.deviceProps,createCanvasContext:{canvas:this._createCanvas(e),useDevicePixels:this.props.useDevicePixels,autoResize:!1}})),this.animationLoop=this._createAnimationLoop(t,e),this.setProps(e),e._typedArrayManagerProps&&y1.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,t,n,i,s,a,o,h,f,_;(e=this.animationLoop)==null||e.stop(),(t=this.animationLoop)==null||t.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,(n=this.layerManager)==null||n.finalize(),this.layerManager=null,(i=this.viewManager)==null||i.finalize(),this.viewManager=null,(s=this.effectManager)==null||s.finalize(),this.effectManager=null,(a=this.deckRenderer)==null||a.finalize(),this.deckRenderer=null,(o=this.deckPicker)==null||o.finalize(),this.deckPicker=null,(h=this.eventManager)==null||h.destroy(),this.eventManager=null,(f=this.widgetManager)==null||f.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&((_=this.canvas.parentElement)==null||_.removeChild(this.canvas),this.canvas=null)}setProps(e){var n;this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&Es.removed("onLayerHover","onHover")(),"onLayerClick"in e&&Es.removed("onLayerClick","onClick")(),e.initialViewState&&!zd(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const t=Object.create(this.props);Object.assign(t,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),(n=this.animationLoop)==null||n.setProps(t),this.layerManager&&(this.viewManager.setProps(t),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(t),this.effectManager.setProps(t),this.deckRenderer.setProps(t),this.deckPicker.setProps(t),this.widgetManager.setProps(t)),this.stats.get("setProps Time").timeEnd()}needsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const n=this.viewManager.needsRedraw(e),i=this.layerManager.needsRedraw(e),s=this.effectManager.needsRedraw(e),a=this.deckRenderer.needsRedraw(e);return t=t||n||i||s||a,t}redraw(e){if(!this.layerManager)return;let t=this.needsRedraw({clearRedrawFlags:!0});t=e||t,t&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(t):this._drawLayers(t))}get isInitialized(){return this.viewManager!==null}getViews(){return Jc(this.viewManager),this.viewManager.views}getViewports(e){return Jc(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const t=this._pick("pickObject","pickObject Time",e).result;return t.length?t[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;for(const n in e)this.layerManager.resourceManager.add({resourceId:n,data:e[n],forceUpdate:t})}_removeResources(e){for(const t of e)this.layerManager.resourceManager.remove(t)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){var t;(t=this.layerManager)==null||t.removeDefaultShaderModule(e)}_pick(e,t,n){Jc(this.deckPicker);const{stats:i}=this;i.get("Pick Count").incrementCount(),i.get(t).timeStart();const s=this.deckPicker[e]({layers:this.layerManager.getLayers(n),views:this.viewManager.getViews(),viewports:this.getViewports(n),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...n});return i.get(t).timeEnd(),s}_createCanvas(e){let t=e.canvas;return typeof t=="string"&&(t=document.getElementById(t),Jc(t)),t||(t=document.createElement("canvas"),t.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(t)),Object.assign(t.style,e.style),t}_setCanvasSize(e){var i;if(!this.canvas)return;const{width:t,height:n}=e;if(t||t===0){const s=Number.isFinite(t)?`${t}px`:t;this.canvas.style.width=s}if(n||n===0){const s=Number.isFinite(n)?`${n}px`:n;this.canvas.style.position=((i=e.style)==null?void 0:i.position)||"absolute",this.canvas.style.height=s}}_updateCanvasSize(){var i,s;const{canvas:e}=this;if(!e)return;const t=e.clientWidth??e.width,n=e.clientHeight??e.height;(t!==this.width||n!==this.height)&&(this.width=t,this.height=n,(i=this.viewManager)==null||i.setProps({width:t,height:n}),(s=this.layerManager)==null||s.activateViewport(this.getViewports()[0]),this.props.onResize({width:t,height:n}))}_createAnimationLoop(e,t){const{gl:n,onError:i,useDevicePixels:s}=t;return new fae({device:e,useDevicePixels:s,autoResizeDrawingBuffer:!n,autoResizeViewport:!1,onInitialize:a=>this._setDevice(a.device),onRender:this._onRenderFrame.bind(this),onError:i})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,t=Array.isArray(e)?e:e?[e]:[new l3({id:"default-view"})];return t.length&&this.props.controller&&(t[0].props.controller=this.props.controller),t}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){var t,n,i;const{_pickRequest:e}=this;if(e.event){const{result:s,emptyInfo:a}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=s.length>0;let o=a,h=!1;for(const f of s)o=f,h=((t=f.layer)==null?void 0:t.onHover(f,e.event))||h;h||((i=(n=this.props).onHover)==null||i.call(n,o,e.event),this.widgetManager.onHover(o,e.event)),e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){var i,s;if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=(i=this.device.canvasContext)==null?void 0:i.canvas),this.device instanceof Ap&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device instanceof Ap&&this.props.onWebGLInitialized(this.device.gl);const t=new pN;t.play(),this.animationLoop.attachTimeline(t),this.eventManager=new sse(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys(DU).map(a=>{var I;const[o,h,f,_]=DU[a],x=(I=this.props.eventRecognizerOptions)==null?void 0:I[a],T={...h,...x,event:a};return{recognizer:new o(T),recognizeWith:f,requestFailure:_}}),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const a in BI)this.eventManager.on(a,this._onEvent);this.viewManager=new Sle({timeline:t,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const n=this.viewManager.getViewports()[0];this.layerManager=new Tle(this.device,{deck:this,stats:this.stats,viewport:n,timeline:t}),this.effectManager=new Vle({deck:this,device:this.device}),this.deckRenderer=new $le(this.device),this.deckPicker=new Jle(this.device),this.widgetManager=new ece({deck:this,parentElement:(s=this.canvas)==null?void 0:s.parentElement}),this.widgetManager.addDefault(new rce),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,t){var a;const{device:n,gl:i}=this.layerManager.context;this.props.onBeforeRender({device:n,gl:i});const s={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...t};(a=this.deckRenderer)==null||a.renderLayers(s),s.pass==="screen"&&this.widgetManager.onRedraw({viewports:s.viewports,layers:s.layers}),this.props.onAfterRender({device:n,gl:i})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),Es.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const t=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:t},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const t=this.animationLoop.stats;e.get("GPU Time").addTime(t.get("GPU Time").lastTiming),e.get("CPU Time").addTime(t.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:t}=this;e.fps=t.get("frameRate").getHz(),e.setPropsTime=t.get("setProps Time").time,e.updateAttributesTime=t.get("Update Attributes").time,e.framesRedrawn=t.get("Redraw Count").count,e.pickTime=t.get("pickObject Time").time+t.get("pickMultipleObjects Time").time+t.get("pickObjects Time").time,e.pickCount=t.get("Pick Count").count,e.gpuTime=t.get("GPU Time").time,e.cpuTime=t.get("CPU Time").time,e.gpuTimePerFrame=t.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=t.get("CPU Time").getAverageTime();const n=eI.stats.get("Memory Usage");e.bufferMemory=n.get("Buffer Memory").count,e.textureMemory=n.get("Texture Memory").count,e.renderbufferMemory=n.get("Renderbuffer Memory").count,e.gpuMemory=n.get("GPU Memory").count}}v3.defaultProps=g6,v3.VERSION=kte;function ihe(r){switch(r){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return Fk(r)}}const she=Pk;function Ow(r,e){return{attribute:r,format:e.size>1?`${e.type}x${e.size}`:e.type,byteOffset:e.offset||0}}function Dg(r){return r.stride||r.size*r.bytesPerElement}function ohe(r,e){return r.type===e.type&&r.size===e.size&&Dg(r)===Dg(e)&&(r.offset||0)===(e.offset||0)}function x3(r,e){e.offset&&Es.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const t=Dg(r),n=e.vertexOffset!==void 0?e.vertexOffset:r.vertexOffset||0,i=e.elementOffset||0,s=n*t+i*r.bytesPerElement+(r.offset||0);return{...e,offset:s,stride:t}}function ahe(r,e){const t=x3(r,e);return{high:t,low:{...t,offset:t.offset+r.size*4}}}class lhe{constructor(e,t,n){this._buffer=null,this.device=e,this.id=t.id||"",this.size=t.size||1;const i=t.logicalType||t.type,s=i==="float64";let{defaultValue:a}=t;a=Number.isFinite(a)?[a]:a||new Array(this.size).fill(0);let o;s?o="float32":!i&&t.isIndexed?o="uint32":o=i||"float32";let h=ihe(i||o);this.doublePrecision=s,s&&t.fp64===!1&&(h=Float32Array),this.value=null,this.settings={...t,defaultType:h,defaultValue:a,logicalType:i,type:o,normalized:o.includes("norm"),size:this.size,bytesPerElement:h.BYTES_PER_ELEMENT},this.state={...n,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*Dg(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),y1.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.id,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const n={};if(this.state.constant){const i=this.value;if(t){const s=x3(this.getAccessor(),t),a=s.offset/i.BYTES_PER_ELEMENT,o=s.size||this.size;n[e]=i.subarray(a,a+o)}else n[e]=i}else n[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?n[`${e}64Low`]=n[e]:n[`${e}64Low`]=new Float32Array(this.size)),n}_getBufferLayout(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.id,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const n=this.getAccessor(),i=[],s={name:this.id,byteStride:Dg(n),attributes:i};if(this.doublePrecision){const a=ahe(n,t||{});i.push(Ow(e,{...n,...a.high}),Ow(`${e}64Low`,{...n,...a.low}))}else if(t){const a=x3(n,t);i.push(Ow(e,{...n,...a}))}else i.push(Ow(e,n));return s}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const t=Array.from(this.value);e=[t,t]}else{const{value:t,numInstances:n,size:i}=this,s=n*i;if(t&&s&&t.length>=s){const a=new Array(i).fill(1/0),o=new Array(i).fill(-1/0);for(let h=0;h<s;)for(let f=0;f<i;f++){const _=t[h++];_<a[f]&&(a[f]=_),_>o[f]&&(o[f]=_)}e=[a,o]}}return this.state.bounds=e,e}setData(e){const{state:t}=this;let n;ArrayBuffer.isView(e)?n={value:e}:e instanceof La?n={buffer:e}:n=e;const i={...this.settings,...n};if(ArrayBuffer.isView(n.value)){if(!n.type)if(this.doublePrecision&&n.value instanceof Float64Array)i.type="float32";else{const a=she(n.value);i.type=i.normalized?a.replace("int","norm"):a}i.bytesPerElement=n.value.BYTES_PER_ELEMENT,i.stride=Dg(i)}if(t.bounds=null,n.constant){let s=n.value;if(s=this._normalizeValue(s,[],0),this.settings.normalized&&(s=this.normalizeConstant(s)),!(!t.constant||!this._areValuesEqual(s,this.value)))return!1;t.externalBuffer=null,t.constant=!0,this.value=ArrayBuffer.isView(s)?s:new Float32Array(s)}else if(n.buffer){const s=n.buffer;t.externalBuffer=s,t.constant=!1,this.value=n.value||null}else if(n.value){this._checkExternalBuffer(n);let s=n.value;t.externalBuffer=null,t.constant=!1,this.value=s;let{buffer:a}=this;const o=Dg(i),h=(i.vertexOffset||0)*o;if(this.doublePrecision&&s instanceof Float64Array&&(s=$I(s,i)),this.settings.isIndexed){const _=this.settings.defaultType;s.constructor!==_&&(s=new _(s))}const f=s.byteLength+h+o*2;(!a||a.byteLength<f)&&(a=this._createBuffer(f)),a.write(s,h)}return this.setAccessor(i),!0}updateSubBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.state.bounds=null;const t=this.value,{startOffset:n=0,endOffset:i}=e;this.buffer.write(this.doublePrecision&&t instanceof Float64Array?$I(t,{size:this.size,startIndex:n,endIndex:i}):t.subarray(n,i),n*t.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const{state:n}=this,i=n.allocatedValue,s=y1.allocate(i,e+1,{size:this.size,type:this.settings.defaultType,copy:t});this.value=s;const{byteOffset:a}=this;let{buffer:o}=this;return(!o||o.byteLength<s.byteLength+a)&&(o=this._createBuffer(s.byteLength+a),t&&i&&o.write(i instanceof Float64Array?$I(i,this):i,a)),n.allocatedValue=s,n.constant=!1,n.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:t}=e;if(!ArrayBuffer.isView(t))throw new Error(`Attribute ${this.id} value is not TypedArray`);const n=this.settings.defaultType;let i=!1;if(this.doublePrecision&&(i=t.BYTES_PER_ELEMENT<4),i)throw new Error(`Attribute ${this.id} does not support ${t.constructor.name}`);!(t instanceof n)&&this.settings.normalized&&!("normalized"in e)&&Es.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(t=>(t+128)/255*2-1);case"snorm16":return new Float32Array(e).map(t=>(t+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(t=>t/255);case"unorm16":return new Float32Array(e).map(t=>t/65535);default:return e}}_normalizeValue(e,t,n){const{defaultValue:i,size:s}=this.settings;if(Number.isFinite(e))return t[n]=e,t;if(!e){let a=s;for(;--a>=0;)t[n+a]=i[a];return t}switch(s){case 4:t[n+3]=Number.isFinite(e[3])?e[3]:i[3];case 3:t[n+2]=Number.isFinite(e[2])?e[2]:i[2];case 2:t[n+1]=Number.isFinite(e[1])?e[1]:i[1];case 1:t[n+0]=Number.isFinite(e[0])?e[0]:i[0];break;default:let a=s;for(;--a>=0;)t[n+a]=Number.isFinite(e[a])?e[a]:i[a]}return t}_areValuesEqual(e,t){if(!e||!t)return!1;const{size:n}=this;for(let i=0;i<n;i++)if(e[i]!==t[i])return!1;return!0}_createBuffer(e){var i;this._buffer&&this._buffer.destroy();const{isIndexed:t,type:n}=this.settings;return this._buffer=this.device.createBuffer({...(i=this._buffer)==null?void 0:i.props,id:this.id,usage:t?La.INDEX:La.VERTEX,indexType:t?n:void 0,byteLength:e}),this._buffer}}const m6=[],_6=[];function y6(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1/0,n=m6;const i={index:-1,data:r,target:[]};return r?typeof r[Symbol.iterator]=="function"?n=r:r.length>0&&(_6.length=r.length,n=_6):n=m6,(e>0||Number.isFinite(t))&&(n=(Array.isArray(n)?n:Array.from(n)).slice(e,t),i.index=e-1),{iterable:n,objectInfo:i}}function b6(r){return r&&r[Symbol.asyncIterator]}function che(r,e){const{size:t,stride:n,offset:i,startIndices:s,nested:a}=e,o=r.BYTES_PER_ELEMENT,h=n?n/o:t,f=i?i/o:0,_=Math.floor((r.length-f)/h);return(x,T)=>{let{index:I,target:N}=T;if(!s){const ie=I*h+f;for(let ce=0;ce<t;ce++)N[ce]=r[ie+ce];return N}const $=s[I],W=s[I+1]||_;let Y;if(a){Y=new Array(W-$);for(let ie=$;ie<W;ie++){const ce=ie*h+f;N=new Array(t);for(let fe=0;fe<t;fe++)N[fe]=r[ce+fe];Y[ie-$]=N}}else if(h===t)Y=r.subarray($*t+f,W*t+f);else{Y=new r.constructor((W-$)*t);let ie=0;for(let ce=$;ce<W;ce++){const fe=ce*h+f;for(let ve=0;ve<t;ve++)Y[ie++]=r[fe+ve]}}return Y}}const uhe=[],kw=[[0,1/0]];function hhe(r,e){if(r===kw||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return r;const t=[],n=r.length;let i=0;for(let s=0;s<n;s++){const a=r[s];a[1]<e[0]?(t.push(a),i=s+1):a[0]>e[1]?t.push(a):e=[Math.min(a[0],e[0]),Math.max(a[1],e[1])]}return t.splice(i,0,e),t}const dhe={interpolation:{duration:0,easing:r=>r},spring:{stiffness:.05,damping:.5}};function v6(r,e){if(!r)return null;Number.isFinite(r)&&(r={type:"interpolation",duration:r});const t=r.type||"interpolation";return{...dhe[t],...e,...r,type:t}}class x6 extends lhe{constructor(e,t){super(e,t,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:kw}),this.constant=!1,this.settings.update=t.update||(t.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw(){let{clearChangedFlags:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=this.state.needsRedraw;return this.state.needsRedraw=t&&!e,t}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var t;(t=this.state).layoutChanged||(t.layoutChanged=!ohe(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:t}=this.settings,n=this.settings.transition,i=Array.isArray(t)?e[t.find(s=>e[s])]:e[t];return v6(i,n)}setNeedsUpdate(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.id,t=arguments.length>1?arguments[1]:void 0;if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),t){const{startRow:n=0,endRow:i=1/0}=t;this.state.updateRanges=hhe(this.state.updateRanges,[n,i])}else this.state.updateRanges=kw}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=uhe}setNeedsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.id;this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:t,settings:n}=this;return n.noAlloc?!1:n.update?(super.allocate(e,t.updateRanges!==kw),!0):!1}updateBuffer(e){let{numInstances:t,data:n,props:i,context:s}=e;if(!this.needsUpdate())return!1;const{state:{updateRanges:a},settings:{update:o,noAlloc:h}}=this;let f=!0;if(o){for(const[_,x]of a)o.call(s,this,{data:n,startRow:_,endRow:x,props:i,numInstances:t});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[_,x]of a){const T=Number.isFinite(_)?this.getVertexOffset(_):0,I=Number.isFinite(x)?this.getVertexOffset(x):h||!Number.isFinite(t)?this.value.length:t*this.size;super.updateSubBuffer({startOffset:T,endOffset:I})}this._checkAttributeArray()}else f=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),f}setConstantValue(e){return e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:t}=this;return e?(this.clearNeedsUpdate(),t.lastExternalBuffer===e||(t.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(t.lastExternalBuffer=null,!1)}setBinaryValue(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const{state:n,settings:i}=this;if(!e)return n.binaryValue=null,n.binaryAccessor=null,!1;if(i.noAlloc)return!1;if(n.binaryValue===e)return this.clearNeedsUpdate(),!0;if(n.binaryValue=e,this.setNeedsRedraw(),i.transform||t!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const a=e;Jc(ArrayBuffer.isView(a.value),`invalid ${i.accessor}`);const o=!!a.size&&a.size!==this.size;return n.binaryAccessor=che(a.value,{size:a.size||this.size,stride:a.stride,offset:a.offset,startIndices:t,nested:o}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:t}=this;return(t?e<t.length?t[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,t=super.getValue();if(!e)return t;for(const n in e)Object.assign(t,super.getValue(n,e[n]));return t}getBufferLayout(e){this.state.layoutChanged=!1;const t=this.settings.shaderAttributes,n=super._getBufferLayout(),{stepMode:i}=this.settings;if(i==="dynamic"?n.stepMode=e?e.isInstanced?"instance":"vertex":"instance":n.stepMode=i??"vertex",!t)return n;for(const s in t){const a=super._getBufferLayout(s,t[s]);n.attributes.push(...a.attributes)}return n}_autoUpdater(e,t){let{data:n,startRow:i,endRow:s,props:a,numInstances:o}=t;if(e.constant)return;const{settings:h,state:f,value:_,size:x,startIndices:T}=e,{accessor:I,transform:N}=h,$=f.binaryAccessor||(typeof I=="function"?I:a[I]);Jc(typeof $=="function",`accessor "${I}" is not a function`);let W=e.getVertexOffset(i);const{iterable:Y,objectInfo:ie}=y6(n,i,s);for(const ce of Y){ie.index++;let fe=$(ce,ie);if(N&&(fe=N.call(this,fe)),T){const ve=(ie.index<T.length-1?T[ie.index+1]:o)-T[ie.index];if(fe&&Array.isArray(fe[0])){let be=W;for(const Qe of fe)e._normalizeValue(Qe,_,be),be+=x}else fe&&fe.length>x?_.set(fe,W):(e._normalizeValue(fe,ie.target,0),xle({target:_,source:ie.target,start:W,count:ve}));W+=ve*x}else e._normalizeValue(fe,_,W),W+=x}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,t=Math.min(4,this.size);if(e&&e.length>=t){let n=!0;switch(t){case 4:n=n&&Number.isFinite(e[3]);case 3:n=n&&Number.isFinite(e[2]);case 2:n=n&&Number.isFinite(e[1]);case 1:n=n&&Number.isFinite(e[0]);break;default:n=!1}if(!n)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function w3(r){const{source:e,target:t,start:n=0,size:i,getData:s}=r,a=r.end||t.length,o=e.length,h=a-n;if(o>h){t.set(e.subarray(0,h),n);return}if(t.set(e,n),!s)return;let f=o;for(;f<h;){const _=s(f,e);for(let x=0;x<i;x++)t[n+f]=_[x]||0,f++}}function fhe(r){let{source:e,target:t,size:n,getData:i,sourceStartIndices:s,targetStartIndices:a}=r;if(!s||!a)return w3({source:e,target:t,size:n,getData:i}),t;let o=0,h=0;const f=i&&((x,T)=>i(x+h,T)),_=Math.min(s.length,a.length);for(let x=1;x<_;x++){const T=s[x]*n,I=a[x]*n;w3({source:e.subarray(o,T),target:t,start:h,end:I,size:n,getData:f}),o=T,h=I}return h<t.length&&w3({source:[],target:t,start:h,size:n,getData:f}),t}function Ahe(r){const{device:e,settings:t,value:n}=r,i=new x6(e,t);return i.setData({value:n instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:t.normalized}),i}function w6(r){switch(r){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${r}"`)}}function B6(r){switch(r){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function C6(r){r.push(r.shift())}function phe(r,e){const{doublePrecision:t,settings:n,value:i,size:s}=r,a=t&&i instanceof Float64Array?2:1;let o=0;const{shaderAttributes:h}=r.settings;if(h)for(const f of Object.values(h))o=Math.max(o,f.vertexOffset??0);return(n.noAlloc?i.length:(e+o)*s)*a}function E6(r){let{device:e,source:t,target:n}=r;return(!n||n.byteLength<t.byteLength)&&(n==null||n.destroy(),n=e.createBuffer({byteLength:t.byteLength,usage:t.usage})),n}function T6(r){let{device:e,buffer:t,attribute:n,fromLength:i,toLength:s,fromStartIndices:a,getData:o=fe=>fe}=r;const h=n.doublePrecision&&n.value instanceof Float64Array?2:1,f=n.size*h,_=n.byteOffset,x=n.settings.bytesPerElement<4?_/n.settings.bytesPerElement*4:_,T=n.startIndices,I=a&&T,N=n.isConstant;if(!I&&t&&i>=s)return t;const $=n.value instanceof Float64Array?Float32Array:n.value.constructor,W=N?n.value:new $(n.getBuffer().readSyncWebGL(_,s*$.BYTES_PER_ELEMENT).buffer);if(n.settings.normalized&&!N){const fe=o;o=(ve,be)=>n.normalizeConstant(fe(ve,be))}const Y=N?(fe,ve)=>o(W,ve):(fe,ve)=>o(W.subarray(fe+_,fe+_+f),ve),ie=t?new Float32Array(t.readSyncWebGL(x,i*4).buffer):new Float32Array(0),ce=new Float32Array(s);return fhe({source:ie,target:ce,sourceStartIndices:a,targetStartIndices:T,size:f,getData:Y}),(!t||t.byteLength<ce.byteLength+x)&&(t==null||t.destroy(),t=e.createBuffer({byteLength:ce.byteLength+x,usage:35050})),t.write(ce,x),t}class S6{constructor(e){let{device:t,attribute:n,timeline:i}=e;this.buffers=[],this.currentLength=0,this.device=t,this.transition=new Pw(i),this.attribute=n,this.attributeInTransition=Ahe(n),this.currentStartIndices=n.startIndices}get inProgress(){return this.transition.inProgress}start(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1/0;this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=phe(this.attribute,t),this.transition.start({...e,duration:n})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}class ghe extends S6{constructor(e){let{device:t,attribute:n,timeline:i}=e;super({device:t,attribute:n,timeline:i}),this.type="interpolation",this.transform=yhe(t,n)}start(e,t){const n=this.currentLength,i=this.currentStartIndices;if(super.start(e,t,e.duration),e.duration<=0){this.transition.cancel();return}const{buffers:s,attribute:a}=this;C6(s),s[0]=T6({device:this.device,buffer:s[0],attribute:a,fromLength:n,toLength:this.currentLength,fromStartIndices:i,getData:e.enter}),s[1]=E6({device:this.device,source:s[0],target:s[1]}),this.setBuffer(s[1]);const{transform:o}=this,h=o.model;let f=Math.floor(this.currentLength/a.size);M6(a)&&(f/=2),h.setVertexCount(f),a.isConstant?(h.setAttributes({aFrom:s[0]}),h.setConstantAttributes({aTo:a.value})):h.setAttributes({aFrom:s[0],aTo:a.getBuffer()}),o.transformFeedback.setBuffers({vCurrent:s[1]})}onUpdate(){const{duration:e,easing:t}=this.settings,{time:n}=this.transition;let i=n/e;t&&(i=t(i));const{model:s}=this.transform,a={time:i};s.shaderInputs.setProps({interpolation:a}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const I6={name:"interpolation",vs:`uniform interpolationUniforms {
  float time;
} interpolation;
`,uniformTypes:{time:"f32"}},mhe=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, interpolation.time);
  gl_Position = vec4(0.0);
}
`,_he=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function M6(r){return r.doublePrecision&&r.value instanceof Float64Array}function yhe(r,e){const t=e.size,n=w6(t),i=B6(t),s=e.getBufferLayout();return M6(e)?new w1(r,{vs:_he,bufferLayout:[{name:"aFrom",byteStride:8*t,attributes:[{attribute:"aFrom",format:i,byteOffset:0},{attribute:"aFrom64Low",format:i,byteOffset:4*t}]},{name:"aTo",byteStride:8*t,attributes:[{attribute:"aTo",format:i,byteOffset:0},{attribute:"aTo64Low",format:i,byteOffset:4*t}]}],modules:[tie,I6],defines:{ATTRIBUTE_TYPE:n,ATTRIBUTE_SIZE:t},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new w1(r,{vs:mhe,bufferLayout:[{name:"aFrom",format:i},{name:"aTo",format:s.attributes[0].format}],modules:[I6],defines:{ATTRIBUTE_TYPE:n},varyings:["vCurrent"],disableWarnings:!0})}class bhe extends S6{constructor(e){let{device:t,attribute:n,timeline:i}=e;super({device:t,attribute:n,timeline:i}),this.type="spring",this.texture=Che(t),this.framebuffer=Ehe(t,this.texture),this.transform=Bhe(t,n)}start(e,t){const n=this.currentLength,i=this.currentStartIndices;super.start(e,t);const{buffers:s,attribute:a}=this;for(let h=0;h<2;h++)s[h]=T6({device:this.device,buffer:s[h],attribute:a,fromLength:n,toLength:this.currentLength,fromStartIndices:i,getData:e.enter});s[2]=E6({device:this.device,source:s[0],target:s[2]}),this.setBuffer(s[1]);const{model:o}=this.transform;o.setVertexCount(Math.floor(this.currentLength/a.size)),a.isConstant?o.setConstantAttributes({aTo:a.value}):o.setAttributes({aTo:a.getBuffer()})}onUpdate(){const{buffers:e,transform:t,framebuffer:n,transition:i}=this,s=this.settings;t.model.setAttributes({aPrev:e[0],aCur:e[1]}),t.transformFeedback.setBuffers({vNext:e[2]});const a={stiffness:s.stiffness,damping:s.damping};t.model.shaderInputs.setProps({spring:a}),t.run({framebuffer:n,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),C6(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(n)[0]>0||i.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const vhe={name:"spring",vs:`uniform springUniforms {
  float damping;
  float stiffness;
} spring;
`,uniformTypes:{damping:"f32",stiffness:"f32"}},xhe=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE force = delta * spring.stiffness;
  ATTRIBUTE_TYPE resistance = velocity * spring.damping;
  return force - resistance + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,whe=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function Bhe(r,e){const t=w6(e.size),n=B6(e.size);return new w1(r,{vs:xhe,fs:whe,bufferLayout:[{name:"aPrev",format:n},{name:"aCur",format:n},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[vhe],defines:{ATTRIBUTE_TYPE:t},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function Che(r){return r.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function Ehe(r,e){return r.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}const The={interpolation:ghe,spring:bhe};class She{constructor(e,t){let{id:n,timeline:i}=t;if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=n,this.device=e,this.timeline=i,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update(e){let{attributes:t,transitions:n,numInstances:i}=e;this.numInstances=i||1;for(const s in t){const a=t[s],o=a.getTransitionSetting(n);o&&this._updateAttribute(s,a,o)}for(const s in this.transitions){const a=t[s];(!a||!a.getTransitionSetting(n))&&this._removeTransition(s)}}hasAttribute(e){const t=this.transitions[e];return t&&t.inProgress}getAttributes(){const e={};for(const t in this.transitions){const n=this.transitions[t];n.inProgress&&(e[t]=n.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(const t in this.transitions)this.transitions[t].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,t,n){const i=this.transitions[e];let s=!i||i.type!==n.type;if(s){i&&this._removeTransition(e);const a=The[n.type];a?this.transitions[e]=new a({attribute:t,timeline:this.timeline,device:this.device}):(Es.error(`unsupported transition type '${n.type}'`)(),s=!1)}(s||t.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(n,this.numInstances))}}const P6="attributeManager.invalidate",Ihe="attributeManager.updateStart",Mhe="attributeManager.updateEnd",Phe="attribute.updateStart",Fhe="attribute.allocate",Rhe="attribute.updateEnd";class Lhe{constructor(e){let{id:t="attribute-manager",stats:n,timeline:i}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.mergeBoundsMemoized=m1(Yoe),this.id=t,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=n,this.attributeTransitionManager=new She(e,{id:`${t}-transitions`,timeline:i}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};const t=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,t&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const t of e)this.attributes[t]!==void 0&&(this.attributes[t].delete(),delete this.attributes[t])}invalidate(e,t){const n=this._invalidateTrigger(e,t);Wc(P6,this,e,n)}invalidateAll(e){for(const t in this.attributes)this.attributes[t].setNeedsUpdate(t,e);Wc(P6,this,"all")}update(e){let{data:t,numInstances:n,startIndices:i=null,transitions:s,props:a={},buffers:o={},context:h={}}=e,f=!1;Wc(Ihe,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const _ in this.attributes){const x=this.attributes[_],T=x.settings.accessor;x.startIndices=i,x.numInstances=n,a[_]&&Es.removed(`props.${_}`,`data.attributes.${_}`)(),x.setExternalBuffer(o[_])||x.setBinaryValue(typeof T=="string"?o[T]:void 0,t.startIndices)||typeof T=="string"&&!o[T]&&x.setConstantValue(a[T])||x.needsUpdate()&&(f=!0,this._updateAttribute({attribute:x,numInstances:n,data:t,props:a,context:h})),this.needsRedraw=this.needsRedraw||x.needsRedraw()}f&&Wc(Mhe,this,n),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:n,transitions:s})}updateTransition(){const{attributeTransitionManager:e}=this,t=e.run();return this.needsRedraw=this.needsRedraw||t,t}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const t=e.map(n=>{var i;return(i=this.attributes[n])==null?void 0:i.getBounds()});return this.mergeBoundsMemoized(t)}getChangedAttributes(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearChangedFlags:!1};const{attributes:t,attributeTransitionManager:n}=this,i={...n.getAttributes()};for(const s in t){const a=t[s];a.needsRedraw(e)&&!n.hasAttribute(s)&&(i[s]=a)}return i}getBufferLayouts(e){return Object.values(this.getAttributes()).map(t=>t.getBufferLayout(e))}_add(e,t){for(const n in e){const i=e[n],s={...i,id:n,size:i.isIndexed&&1||i.size||1,...t};this.attributes[n]=new x6(this.device,s)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const t in this.attributes)this.attributes[t].getUpdateTriggers().forEach(i=>{e[i]||(e[i]=[]),e[i].push(t)});this.updateTriggers=e}_invalidateTrigger(e,t){const{attributes:n,updateTriggers:i}=this,s=i[e];return s&&s.forEach(a=>{const o=n[a];o&&o.setNeedsUpdate(o.id,t)}),s}_updateAttribute(e){const{attribute:t,numInstances:n}=e;if(Wc(Phe,t),t.constant){t.setConstantValue(t.value);return}t.allocate(n)&&Wc(Fhe,t,n),t.updateBuffer(e)&&(this.needsRedraw=!0,Wc(Rhe,t,n))}}class Dhe extends Pw{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:t,toValue:n,duration:i,easing:s}}=this,a=s(e/i);this._value=pw(t,n,a)}}const F6=1e-5;function R6(r,e,t,n,i){const s=e-r,o=(t-e)*i,h=-s*n;return o+h+s+e}function Ohe(r,e,t,n,i){if(Array.isArray(t)){const s=[];for(let a=0;a<t.length;a++)s[a]=R6(r[a],e[a],t[a],n,i);return s}return R6(r,e,t,n,i)}function L6(r,e){if(Array.isArray(r)){let t=0;for(let n=0;n<r.length;n++){const i=r[n]-e[n];t+=i*i}return Math.sqrt(t)}return Math.abs(r-e)}class khe extends Pw{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:t,damping:n,stiffness:i}=this.settings,{_prevValue:s=e,_currValue:a=e}=this;let o=Ohe(s,a,t,n,i);const h=L6(o,t),f=L6(o,a);h<F6&&f<F6&&(o=t,this.end()),this._prevValue=a,this._currValue=o}}const Uhe={interpolation:Dhe,spring:khe};class Nhe{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,t,n,i){const{transitions:s}=this;if(s.has(e)){const h=s.get(e),{value:f=h.settings.fromValue}=h;t=f,this.remove(e)}if(i=v6(i),!i)return;const a=Uhe[i.type];if(!a){Es.error(`unsupported transition type '${i.type}'`)();return}const o=new a(this.timeline);o.start({...i,fromValue:t,toValue:n}),s.set(e,o)}remove(e){const{transitions:t}=this;t.has(e)&&(t.get(e).cancel(),t.delete(e))}update(){const e={};for(const[t,n]of this.transitions)n.update(),e[t]=n.value,n.inProgress||this.remove(t);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function zhe(r){const e=r[cp];for(const t in e){const n=e[t],{validate:i}=n;if(i&&!i(r[t],n))throw new Error(`Invalid prop ${t}: ${r[t]}`)}}function Hhe(r,e){const t=D6({newProps:r,oldProps:e,propTypes:r[cp],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),n=Ghe(r,e);let i=!1;return n||(i=Qhe(r,e)),{dataChanged:n,propsChanged:t,updateTriggersChanged:i,extensionsChanged:$he(r,e),transitionsChanged:Vhe(r,e)}}function Vhe(r,e){if(!r.transitions)return!1;const t={},n=r[cp];let i=!1;for(const s in r.transitions){const a=n[s],o=a&&a.type;(o==="number"||o==="color"||o==="array")&&B3(r[s],e[s],a)&&(t[s]=!0,i=!0)}return i?t:!1}function D6(r){let{newProps:e,oldProps:t,ignoreProps:n={},propTypes:i={},triggerName:s="props"}=r;if(t===e)return!1;if(typeof e!="object"||e===null)return`${s} changed shallowly`;if(typeof t!="object"||t===null)return`${s} changed shallowly`;for(const a of Object.keys(e))if(!(a in n)){if(!(a in t))return`${s}.${a} added`;const o=B3(e[a],t[a],i[a]);if(o)return`${s}.${a} ${o}`}for(const a of Object.keys(t))if(!(a in n)){if(!(a in e))return`${s}.${a} dropped`;if(!Object.hasOwnProperty.call(e,a)){const o=B3(e[a],t[a],i[a]);if(o)return`${s}.${a} ${o}`}}return!1}function B3(r,e,t){let n=t&&t.equal;return n&&!n(r,e,t)||!n&&(n=r&&e&&r.equals,n&&!n.call(r,e))?"changed deeply":!n&&e!==r?"changed shallowly":null}function Ghe(r,e){if(e===null)return"oldProps is null, initial diff";let t=!1;const{dataComparator:n,_dataDiff:i}=r;return n?n(r.data,e.data)||(t="Data comparator detected a change"):r.data!==e.data&&(t="A new data container was supplied"),t&&i&&(t=i(r.data,e.data)||t),t}function Qhe(r,e){if(e===null)return{all:!0};if("all"in r.updateTriggers&&O6(r,e,"all"))return{all:!0};const t={};let n=!1;for(const i in r.updateTriggers)i!=="all"&&O6(r,e,i)&&(t[i]=!0,n=!0);return n?t:!1}function $he(r,e){if(e===null)return!0;const t=e.extensions,{extensions:n}=r;if(n===t)return!1;if(!t||!n||n.length!==t.length)return!0;for(let i=0;i<n.length;i++)if(!n[i].equals(t[i]))return!0;return!1}function O6(r,e,t){let n=r.updateTriggers[t];n=n??{};let i=e.updateTriggers[t];return i=i??{},D6({oldProps:i,newProps:n,triggerName:t})}const jhe="count(): argument not an object",qhe="count(): argument not a container";function Khe(r){if(!Xhe(r))throw new Error(jhe);if(typeof r.count=="function")return r.count();if(Number.isFinite(r.size))return r.size;if(Number.isFinite(r.length))return r.length;if(Whe(r))return Object.keys(r).length;throw new Error(qhe)}function Whe(r){return r!==null&&typeof r=="object"&&r.constructor===Object}function Xhe(r){return r!==null&&typeof r=="object"}function k6(r,e){if(!e)return r;const t={...r,...e};if("defines"in e&&(t.defines={...r.defines,...e.defines}),"modules"in e&&(t.modules=(r.modules||[]).concat(e.modules),e.modules.some(n=>n.name==="project64"))){const n=t.modules.findIndex(i=>i.name==="project32");n>=0&&t.modules.splice(n,1)}if("inject"in e)if(!r.inject)t.inject=e.inject;else{const n={...r.inject};for(const i in e.inject)n[i]=(n[i]||"")+e.inject[i];t.inject=n}return t}const Jhe={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},C3={};function Zhe(r,e,t,n){if(t instanceof ia)return t;t.constructor&&t.constructor.name!=="Object"&&(t={data:t});let i=null;t.compressed&&(i={minFilter:"linear",mipmapFilter:t.data.length>1?"nearest":"linear"});const s=e.createTexture({...t,sampler:{...Jhe,...i,...n},mipmaps:!0});return C3[s.id]=r,s}function Yhe(r,e){!e||!(e instanceof ia)||C3[e.id]===r&&(e.delete(),delete C3[e.id])}const ede={boolean:{validate(r,e){return!0},equal(r,e,t){return!!r==!!e}},number:{validate(r,e){return Number.isFinite(r)&&(!("max"in e)||r<=e.max)&&(!("min"in e)||r>=e.min)}},color:{validate(r,e){return e.optional&&!r||E3(r)&&(r.length===3||r.length===4)},equal(r,e,t){return zd(r,e,1)}},accessor:{validate(r,e){const t=Uw(r);return t==="function"||t===Uw(e.value)},equal(r,e,t){return typeof e=="function"?!0:zd(r,e,1)}},array:{validate(r,e){return e.optional&&!r||E3(r)},equal(r,e,t){const{compare:n}=t,i=Number.isInteger(n)?n:n?1:0;return n?zd(r,e,i):r===e}},object:{equal(r,e,t){if(t.ignore)return!0;const{compare:n}=t,i=Number.isInteger(n)?n:n?1:0;return n?zd(r,e,i):r===e}},function:{validate(r,e){return e.optional&&!r||typeof r=="function"},equal(r,e,t){return!t.compare&&t.ignore!==!1||r===e}},data:{transform:(r,e,t)=>{if(!r)return r;const{dataTransform:n}=t.props;return n?n(r):typeof r.shape=="string"&&r.shape.endsWith("-table")&&Array.isArray(r.data)?r.data:r}},image:{transform:(r,e,t)=>{const n=t.context;return!n||!n.device?null:Zhe(t.id,n.device,r,{...e.parameters,...t.props.textureParameters})},release:(r,e,t)=>{Yhe(t.id,r)}}};function tde(r){const e={},t={},n={};for(const[i,s]of Object.entries(r)){const a=s==null?void 0:s.deprecatedFor;if(a)n[i]=Array.isArray(a)?a:[a];else{const o=rde(i,s);e[i]=o,t[i]=o.value}}return{propTypes:e,defaultProps:t,deprecatedProps:n}}function rde(r,e){switch(Uw(e)){case"object":return M1(r,e);case"array":return M1(r,{type:"array",value:e,compare:!1});case"boolean":return M1(r,{type:"boolean",value:e});case"number":return M1(r,{type:"number",value:e});case"function":return M1(r,{type:"function",value:e,compare:!0});default:return{name:r,type:"unknown",value:e}}}function M1(r,e){return"type"in e?{name:r,...ede[e.type],...e}:"value"in e?{name:r,type:Uw(e.value),...e}:{name:r,type:"object",value:e}}function E3(r){return Array.isArray(r)||ArrayBuffer.isView(r)}function Uw(r){return E3(r)?"array":r===null?"null":typeof r}function nde(r,e){let t;for(let s=e.length-1;s>=0;s--){const a=e[s];"extensions"in a&&(t=a.extensions)}const n=T3(r.constructor,t),i=Object.create(n);i[Iw]=r,i[Pg]={},i[up]={};for(let s=0;s<e.length;++s){const a=e[s];for(const o in a)i[o]=a[o]}return Object.freeze(i),i}const ide="_mergedDefaultProps";function T3(r,e){if(!(r instanceof Nw.constructor))return{};let t=ide;if(e)for(const i of e){const s=i.constructor;s&&(t+=`:${s.extensionName||s.name}`)}const n=U6(r,t);return n||(r[t]=sde(r,e||[]))}function sde(r,e){if(!r.prototype)return null;const n=Object.getPrototypeOf(r),i=T3(n),s=U6(r,"defaultProps")||{},a=tde(s),o=Object.assign(Object.create(null),i,a.defaultProps),h=Object.assign(Object.create(null),i==null?void 0:i[cp],a.propTypes),f=Object.assign(Object.create(null),i==null?void 0:i[s3],a.deprecatedProps);for(const _ of e){const x=T3(_.constructor);x&&(Object.assign(o,x),Object.assign(h,x[cp]),Object.assign(f,x[s3]))}return ode(o,r),lde(o,h),ade(o,f),o[cp]=h,o[s3]=f,e.length===0&&!S3(r,"_propTypes")&&(r._propTypes=h),o}function ode(r,e){const t=ude(e);Object.defineProperties(r,{id:{writable:!0,value:t}})}function ade(r,e){for(const t in e)Object.defineProperty(r,t,{enumerable:!1,set(n){const i=`${this.id}: ${t}`;for(const s of e[t])S3(this,s)||(this[s]=n);Es.deprecated(i,e[t].join("/"))()}})}function lde(r,e){const t={},n={};for(const i in e){const s=e[i],{name:a,value:o}=s;s.async&&(t[a]=o,n[a]=cde(a))}r[N_]=t,r[Pg]={},Object.defineProperties(r,n)}function cde(r){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||b6(e)?this[Pg][r]=e:this[up][r]=e},get(){if(this[up]){if(r in this[up])return this[up][r]||this[N_][r];if(r in this[Pg]){const e=this[Iw]&&this[Iw].internalState;if(e&&e.hasAsyncProp(r))return e.getAsyncProp(r)||this[N_][r]}}return this[N_][r]}}}function S3(r,e){return Object.prototype.hasOwnProperty.call(r,e)}function U6(r,e){return S3(r,e)&&r[e]}function ude(r){const e=r.componentName;return e||Es.warn(`${r.name}.componentName not specified`)(),e||r.name}let hde=0;class Nw{constructor(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.props=nde(this,t),this.id=this.props.id,this.count=hde++}clone(e){const{props:t}=this,n={};for(const i in t[N_])i in t[up]?n[i]=t[up][i]:i in t[Pg]&&(n[i]=t[Pg][i]);return new this.constructor({...t,...n,...e})}}Nw.componentName="Component",Nw.defaultProps={};const dde=Object.freeze({});class fde{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const t=this.asyncProps[e];t&&t.type&&t.type.release&&t.type.release(t.resolvedValue,t.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||dde}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const t=this.asyncProps[e];return t&&t.resolvedValue}isAsyncPropLoading(e){if(e){const t=this.asyncProps[e];return!!(t&&t.pendingLoadCount>0&&t.pendingLoadCount!==t.resolvedLoadCount)}for(const t in this.asyncProps)if(this.isAsyncPropLoading(t))return!0;return!1}reloadAsyncProp(e,t){this._watchPromise(e,Promise.resolve(t))}setAsyncProps(e){this.component=e[Iw]||this.component;const t=e[up]||{},n=e[Pg]||e,i=e[N_]||{};for(const s in t){const a=t[s];this._createAsyncPropData(s,i[s]),this._updateAsyncProp(s,a),t[s]=this.getAsyncProp(s)}for(const s in n){const a=n[s];this._createAsyncPropData(s,i[s]),this._updateAsyncProp(s,a)}}_fetch(e,t){return null}_onResolve(e,t){}_onError(e,t){}_updateAsyncProp(e,t){if(this._didAsyncInputValueChange(e,t)){if(typeof t=="string"&&(t=this._fetch(e,t)),t instanceof Promise){this._watchPromise(e,t);return}if(b6(t)){this._resolveAsyncIterable(e,t);return}this._setPropValue(e,t)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,t){const n=this.asyncProps[e];return t===n.resolvedValue||t===n.lastValue?!1:(n.lastValue=t,!0)}_setPropValue(e,t){this._freezeAsyncOldProps();const n=this.asyncProps[e];n&&(t=this._postProcessValue(n,t),n.resolvedValue=t,n.pendingLoadCount++,n.resolvedLoadCount=n.pendingLoadCount)}_setAsyncPropValue(e,t,n){const i=this.asyncProps[e];i&&n>=i.resolvedLoadCount&&t!==void 0&&(this._freezeAsyncOldProps(),i.resolvedValue=t,i.resolvedLoadCount=n,this.onAsyncPropUpdated(e,t))}_watchPromise(e,t){const n=this.asyncProps[e];if(n){n.pendingLoadCount++;const i=n.pendingLoadCount;t.then(s=>{this.component&&(s=this._postProcessValue(n,s),this._setAsyncPropValue(e,s,i),this._onResolve(e,s))}).catch(s=>{this._onError(e,s)})}}async _resolveAsyncIterable(e,t){if(e!=="data"){this._setPropValue(e,t);return}const n=this.asyncProps[e];if(!n)return;n.pendingLoadCount++;const i=n.pendingLoadCount;let s=[],a=0;for await(const o of t){if(!this.component)return;const{dataTransform:h}=this.component.props;h?s=h(o,s):s=s.concat(o),Object.defineProperty(s,"__diff",{enumerable:!1,value:[{startRow:a,endRow:s.length}]}),a=s.length,this._setAsyncPropValue(e,s,i)}this._onResolve(e,s)}_postProcessValue(e,t){const n=e.type;return n&&this.component&&(n.release&&n.release(e.resolvedValue,n,this.component),n.transform)?n.transform(t,n,this.component):t}_createAsyncPropData(e,t){if(!this.asyncProps[e]){const i=this.component&&this.component.props[cp];this.asyncProps[e]={type:i&&i[e],lastValue:null,resolvedValue:t,pendingLoadCount:0,resolvedLoadCount:0}}}}class Ade extends fde{constructor(e){let{attributeManager:t,layer:n}=e;super(n),this.attributeManager=t,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,t){const n=this.layer,i=n==null?void 0:n.props.fetch;return i?i(t,{propName:e,layer:n}):super._fetch(e,t)}_onResolve(e,t){const n=this.layer;if(n){const i=n.props.onDataLoad;e==="data"&&i&&i(t,{propName:e,layer:n})}}_onError(e,t){const n=this.layer;n&&n.raiseError(t,`loading ${e} of ${this.layer}`)}}const pde="layer.changeFlag",gde="layer.initialize",mde="layer.update",_de="layer.finalize",yde="layer.matched",N6=2**24-1,bde=Object.freeze([]),vde=m1(r=>{let{oldViewport:e,viewport:t}=r;return e.equals(t)});let Hd=new Uint8ClampedArray(0);const xde={data:{type:"data",value:bde,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:r=>r&&r.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(r,e)=>{let{propName:t,layer:n,loaders:i,loadOptions:s,signal:a}=e;const{resourceManager:o}=n.context;s=s||n.getLoadOptions(),i=i||n.props.loaders,a&&(s={...s,fetch:{...s==null?void 0:s.fetch,signal:a}});let h=o.contains(r);return!h&&!s&&(o.add({resourceId:r,data:RS(r,i),persistent:!1}),h=!0),h?o.subscribe({resourceId:r,onChange:f=>{var _;return(_=n.internalState)==null?void 0:_.reloadAsyncProp(t,f)},consumerId:n.id,requestId:t}):RS(r,i,s)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:is.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:r=>{let{layerIndex:e}=r;return[0,-e*100]}},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class q_ extends Nw{constructor(){super(...arguments),this.internalState=null,this.lifecycle=U_.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){Jc(this.internalState);const t=this.internalState.viewport||this.context.viewport,n=AN(e,{viewport:t,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[i,s,a]=eN(n,t.pixelProjectionMatrix);return e.length===2?[i,s]:[i,s,a]}unproject(e){return Jc(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,t){Jc(this.internalState);const n=this.internalState.viewport||this.context.viewport;return sae(e,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...t})}get isComposite(){return!1}get isDrawable(){return!0}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setShaderModuleProps(){for(const e of this.getModels())e.shaderInputs.setProps(...arguments)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===is.DEFAULT||e===is.LNGLAT||e===is.CARTESIAN}onHover(e,t){return this.props.onHover&&this.props.onHover(e,t)||!1}onClick(e,t){return this.props.onClick&&this.props.onClick(e,t)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return t[0]=e+1&255,t[1]=e+1>>8&255,t[2]=e+1>>8>>8&255,t}decodePickingColor(e){Jc(e instanceof Uint8Array);const[t,n,i]=e;return t+n*256+i*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:Khe(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){e=k6(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const t of this.props.extensions)e=k6(e,t.getShaders.call(this,t));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const t=this.getAttributeManager(),{dataChanged:n}=e.changeFlags;if(n&&t)if(Array.isArray(n))for(const i of n)t.invalidateAll(i);else t.invalidateAll();if(t){const{props:i}=e,s=this.internalState.hasPickingBuffer,a=Number.isInteger(i.highlightedObjectIndex)||i.pickable||i.extensions.some(o=>o.getNeedsPickingBuffer.call(this,o));if(s!==a){this.internalState.hasPickingBuffer=a;const{pickingColors:o,instancePickingColors:h}=t.attributes,f=o||h;f&&(a&&f.constant&&(f.constant=!1,t.invalidate(f.id)),!f.value&&!a&&(f.constant=!0,f.value=[0,0,0]))}}}finalizeState(e){for(const n of this.getModels())n.destroy();const t=this.getAttributeManager();t&&t.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const t of this.getModels())t.draw(e.renderPass)}getPickingInfo(e){let{info:t,mode:n,sourceLayer:i}=e;const{index:s}=t;return s>=0&&Array.isArray(this.props.data)&&(t.object=this.props.data[s]),t}raiseError(e,t){var n,i,s,a;t&&(e=new Error(`${t}: ${e.message}`,{cause:e})),(i=(n=this.props).onError)!=null&&i.call(n,e)||(a=(s=this.context)==null?void 0:s.onError)==null||a.call(s,e,this)}getNeedsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)==null?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const t=this.internalState.viewport;this.internalState.viewport=e,(!t||!vde({oldViewport:t,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"all";const t=this.getAttributeManager();t&&(e==="all"?t.invalidateAll():t.invalidate(e))}updateAttributes(e){let t=!1;for(const n in e)e[n].layoutChanged()&&(t=!0);for(const n of this.getModels())this._setModelAttributes(n,e,t)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const t=this.props,n=this.getNumInstances(),i=this.getStartIndices();e.update({data:t.data,numInstances:n,startIndices:i,props:t,transitions:t.transitions,buffers:t.data.attributes,context:this});const s=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(s)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const t=e.update(),n=Object.create(this.props);for(const i in t)Object.defineProperty(n,i,{value:t[i]});return n}return this.props}calculateInstancePickingColors(e,t){let{numInstances:n}=t;if(e.constant)return;const i=Math.floor(Hd.length/4);if(this.internalState.usesPickingColorCache=!0,i<n){n>N6&&Es.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),Hd=y1.allocate(Hd,n,{size:4,copy:!0,maxCount:Math.max(n,N6)});const s=Math.floor(Hd.length/4),a=[0,0,0];for(let o=i;o<s;o++)this.encodePickingColor(o,a),Hd[o*4+0]=a[0],Hd[o*4+1]=a[1],Hd[o*4+2]=a[2],Hd[o*4+3]=0}e.value=Hd.subarray(0,n*4)}_setModelAttributes(e,t){var o;let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(!Object.keys(t).length)return;if(n){const h=this.getAttributeManager();e.setBufferLayout(h.getBufferLayouts(e)),t=h.getAttributes()}const i=((o=e.userData)==null?void 0:o.excludeAttributes)||{},s={},a={};for(const h in t){if(i[h])continue;const f=t[h].getValue();for(const _ in f){const x=f[_];x instanceof La?t[h].settings.isIndexed?e.setIndexBuffer(x):s[_]=x:x&&(a[_]=x)}}e.setAttributes(s),e.setConstantAttributes(a)}disablePickingIndex(e){const t=this.props.data;if(!("attributes"in t)){this._disablePickingIndex(e);return}const{pickingColors:n,instancePickingColors:i}=this.getAttributeManager().attributes,s=n||i,a=s&&t.attributes&&t.attributes[s.id];if(a&&a.value){const o=a.value,h=this.encodePickingColor(e);for(let f=0;f<t.length;f++){const _=s.getVertexOffset(f);o[_]===h[0]&&o[_+1]===h[1]&&o[_+2]===h[2]&&this._disablePickingIndex(f)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:t,instancePickingColors:n}=this.getAttributeManager().attributes,i=t||n;if(!i)return;const s=i.getVertexOffset(e),a=i.getVertexOffset(e+1);i.buffer.write(new Uint8Array(a-s),s)}restorePickingColors(){const{pickingColors:e,instancePickingColors:t}=this.getAttributeManager().attributes,n=e||t;n&&(this.internalState.usesPickingColorCache&&n.value.buffer!==Hd.buffer&&(n.value=Hd.subarray(0,n.value.length)),n.updateSubBuffer({startOffset:0}))}_initialize(){Jc(!this.internalState),Jc(Number.isFinite(this.props.coordinateSystem)),Wc(gde,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new Ade({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(Es.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new Nhe(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const t of this.props.extensions)t.initializeState.call(this,this.context,t);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){Wc(yde,this,this===e);const{state:t,internalState:n}=e;this!==e&&(this.internalState=n,this.state=t,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(Wc(mde,this,e),!e)return;const t=this.props,n=this.context,i=this.internalState,s=n.viewport,a=this._updateUniformTransition();i.propsInTransition=a,n.viewport=i.viewport||s,this.props=a;try{const o=this._getUpdateParams(),h=this.getModels();if(n.device)this.updateState(o);else try{this.updateState(o)}catch{}for(const _ of this.props.extensions)_.updateState.call(this,o,_);this.setNeedsRedraw(),this._updateAttributes();const f=this.getModels()[0]!==h[0];this._postUpdate(o,f)}finally{n.viewport=s,this.props=t,this._clearChangeFlags(),i.needsUpdate=!1,i.resetOldProps()}}_finalize(){Wc(_de,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer(e){let{renderPass:t,shaderModuleProps:n=null,uniforms:i={},parameters:s={}}=e;this._updateAttributeTransition();const a=this.props,o=this.context;this.props=this.internalState.propsInTransition||a;try{n&&this.setShaderModuleProps(n);const{getPolygonOffset:h}=this.props,f=h&&h(i)||[0,0];o.device instanceof Ap&&o.device.setParametersWebGL({polygonOffset:f});for(const _ of this.getModels())_.setParameters(s);if(o.device instanceof Ap)o.device.withParametersWebGL(s,()=>{const _={renderPass:t,shaderModuleProps:n,uniforms:i,parameters:s,context:o};for(const x of this.props.extensions)x.draw.call(this,_,x);this.draw(_)});else{const _={renderPass:t,shaderModuleProps:n,uniforms:i,parameters:s,context:o};for(const x of this.props.extensions)x.draw.call(this,_,x);this.draw(_)}}finally{this.props=a}}getChangeFlags(){var e;return(e=this.internalState)==null?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:t}=this.internalState;for(const i in e)if(e[i]){let s=!1;switch(i){case"dataChanged":const a=e[i],o=t[i];a&&Array.isArray(o)&&(t.dataChanged=Array.isArray(a)?o.concat(a):a,s=!0);default:t[i]||(t[i]=e[i],s=!0)}s&&Wc(pde,this,i,e)}const n=!!(t.dataChanged||t.updateTriggersChanged||t.propsChanged||t.extensionsChanged);t.propsOrDataChanged=n,t.somethingChanged=n||t.viewportChanged||t.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,t){var i;const n=Hhe(e,t);if(n.updateTriggersChanged)for(const s in n.updateTriggersChanged)n.updateTriggersChanged[s]&&this.invalidateAttribute(s);if(n.transitionsChanged)for(const s in n.transitionsChanged)this.internalState.uniformTransitions.add(s,t[s],e[s],(i=e.transitions)==null?void 0:i[s]);return this.setChangeFlags(n)}validateProps(){zhe(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const t={highlightedObjectColor:e.picked?e.color:null},{highlightColor:n}=this.props;e.picked&&typeof n=="function"&&(t.highlightColor=n(e)),this.setShaderModuleProps({picking:t}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new Lhe(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,t){const{props:n,oldProps:i}=e,s=this.state.model;s!=null&&s.isInstanced&&s.setInstanceCount(this.getNumInstances());const{autoHighlight:a,highlightedObjectIndex:o,highlightColor:h}=n;if(t||i.autoHighlight!==a||i.highlightedObjectIndex!==o||i.highlightColor!==h){const f={};Array.isArray(h)&&(f.highlightColor=h),(t||i.autoHighlight!==a||o!==i.highlightedObjectIndex)&&(f.highlightedObjectColor=Number.isFinite(o)&&o>=0?this.encodePickingColor(o):null),this.setShaderModuleProps({picking:f})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let t=!1;t=t||this.internalState.needsRedraw&&this.id;const n=this.getAttributeManager(),i=n?n.getNeedsRedraw(e):!1;if(t=t||i,t)for(const s of this.props.extensions)s.onNeedsRedraw.call(this,s);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,t}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}q_.defaultProps=xde,q_.layerName="Layer";const wde="compositeLayer.renderLayers";class z6 extends q_{get isComposite(){return!0}get isDrawable(){return!1}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo(e){let{info:t}=e;const{object:n}=t;return n&&n.__source&&n.__source.parent&&n.__source.parent.id===this.id&&(t.object=n.__source.object,t.index=n.__source.index),t}filterSubLayer(e){return!0}shouldRenderSubLayer(e,t){return t&&t.length}getSubLayerClass(e,t){const{_subLayerProps:n}=this.props;return n&&n[e]&&n[e].type||t}getSubLayerRow(e,t,n){return e.__source={parent:this,object:t,index:n},e}getSubLayerAccessor(e){if(typeof e=="function"){const t={index:-1,data:this.props.data,target:[]};return(n,i)=>n&&n.__source?(t.index=n.__source.index,e(n.__source.object,t)):e(n,i)}return e}getSubLayerProps(){var Qe;let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{opacity:t,pickable:n,visible:i,parameters:s,getPolygonOffset:a,highlightedObjectIndex:o,autoHighlight:h,highlightColor:f,coordinateSystem:_,coordinateOrigin:x,wrapLongitude:T,positionFormat:I,modelMatrix:N,extensions:$,fetch:W,operation:Y,_subLayerProps:ie}=this.props,ce={id:"",updateTriggers:{},opacity:t,pickable:n,visible:i,parameters:s,getPolygonOffset:a,highlightedObjectIndex:o,autoHighlight:h,highlightColor:f,coordinateSystem:_,coordinateOrigin:x,wrapLongitude:T,positionFormat:I,modelMatrix:N,extensions:$,fetch:W,operation:Y},fe=ie&&e.id&&ie[e.id],ve=fe&&fe.updateTriggers,be=e.id||"sublayer";if(fe){const Ue=this.props[cp],st=e.type?e.type._propTypes:{};for(const at in fe){const Le=st[at]||Ue[at];Le&&Le.type==="accessor"&&(fe[at]=this.getSubLayerAccessor(fe[at]))}}Object.assign(ce,e,fe),ce.id=`${this.props.id}-${be}`,ce.updateTriggers={all:(Qe=this.props.updateTriggers)==null?void 0:Qe.all,...e.updateTriggers,...ve};for(const Ue of $){const st=Ue.getSubLayerProps.call(this,Ue);st&&Object.assign(ce,st,{updateTriggers:Object.assign(ce.updateTriggers,st.updateTriggers)})}return ce}_updateAutoHighlight(e){for(const t of this.getSubLayers())t.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,t){let n=this.internalState.subLayers;const i=!n||this.needsUpdate();if(i){const s=this.renderLayers();n=Mw(s,Boolean),this.internalState.subLayers=n}Wc(wde,this,i,n);for(const s of n)s.parent=this}}z6.layerName="CompositeLayer";const zw=Math.PI/180,H6=180/Math.PI,Hw=6370972,K_=256;function Bde(){const r=K_/Hw,e=Math.PI/180*K_;return{unitsPerMeter:[r,r,r],unitsPerMeter2:[0,0,0],metersPerUnit:[1/r,1/r,1/r],unitsPerDegree:[e,e,r],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/e,1/e,1/r]}}class Cde extends F_{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{longitude:t=0,zoom:n=0,nearZMultiplier:i=.5,farZMultiplier:s=1,resolution:a=10}=e;let{latitude:o=0,height:h,altitude:f=1.5,fovy:_}=e;o=Math.max(Math.min(o,ap),-ap),h=h||1,_?f=zI(_):_=_1(f);const x=1/Math.PI/Math.cos(o*Math.PI/180),T=Math.pow(2,n)*x,I=e.nearZ??i,N=e.farZ??(f+K_*2*T/h)*s,$=new Ud().lookAt({eye:[0,-f,0],up:[0,0,1]});$.rotateX(o*zw),$.rotateZ(-t*zw),$.scale(T/h),super({...e,height:h,viewMatrix:$,longitude:t,latitude:o,zoom:n,distanceScales:Bde(),fovy:_,focalDistance:f,near:I,far:N}),this.scale=T,this.latitude=o,this.longitude=t,this.resolution=a}get projectionMode(){return kd.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(){const t={targetZ:(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{}).z||0},n=this.unproject([0,this.height/2],t),i=this.unproject([this.width/2,0],t),s=this.unproject([this.width,this.height/2],t),a=this.unproject([this.width/2,this.height],t);return s[0]<this.longitude&&(s[0]+=360),n[0]>this.longitude&&(n[0]-=360),[Math.min(n[0],s[0],i[0],a[0]),Math.min(n[1],s[1],i[1],a[1]),Math.max(n[0],s[0],i[0],a[0]),Math.max(n[1],s[1],i[1],a[1])]}unproject(e){let{topLeft:t=!0,targetZ:n}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const[i,s,a]=e,o=t?s:this.height-s,{pixelUnprojectionMatrix:h}=this;let f;if(Number.isFinite(a))f=I3(h,[i,o,a,1]);else{const I=I3(h,[i,o,-1,1]),N=I3(h,[i,o,1,1]),$=((n||0)/Hw+1)*K_,W=EI(VU([],I,N)),Y=EI(I),ie=EI(N),fe=4*((4*Y*ie-(W-Y-ie)**2)/16)/W,ve=Math.sqrt(Y-fe),be=Math.sqrt(Math.max(0,$*$-fe)),Qe=(ve-be)/Math.sqrt(W);f=Ise([],I,N,Qe)}const[_,x,T]=this.unprojectPosition(f);return Number.isFinite(a)?[_,x,T]:Number.isFinite(n)?[_,x,n]:[_,x]}projectPosition(e){const[t,n,i=0]=e,s=t*zw,a=n*zw,o=Math.cos(a),h=(i/Hw+1)*K_;return[Math.sin(s)*o*h,-Math.cos(s)*o*h,Math.sin(a)*h]}unprojectPosition(e){const[t,n,i]=e,s=Ose(e),a=Math.asin(i/s),h=Math.atan2(t,-n)*H6,f=a*H6,_=(s/K_-1)*Hw;return[h,f,_]}projectFlat(e){return e}unprojectFlat(e){return e}panByPosition(e,t){const n=this.unproject(t);return{longitude:e[0]-n[0]+this.longitude,latitude:e[1]-n[1]+this.latitude}}}function I3(r,e){const t=T_([],e,r);return $U(t,t,1/t[3]),t}class Ede extends LN{applyConstraints(e){const{maxZoom:t,minZoom:n,zoom:i}=e;e.zoom=Uf(i,n,t);const{longitude:s,latitude:a}=e;return(s<-180||s>180)&&(e.longitude=Woe(s+180,360)-180),e.latitude=Uf(a,-ap,ap),e}}class Tde extends FN{constructor(){super(...arguments),this.ControllerState=Ede,this.transition={transitionDuration:300,transitionInterpolator:new a3(["longitude","latitude","zoom"])},this.dragMode="pan"}setProps(e){super.setProps(e),this.dragRotate=!1,this.touchRotate=!1}}class V6 extends MN{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(e)}getViewportType(e){return e.zoom>12?Sg:Cde}get ControllerType(){return Tde}}V6.displayName="GlobeView";function G6(r,e){if(!r)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const W_=Math.PI,Sde=W_/4,M3=W_/180,P3=512,Ide=4003e4;function Mde(r){const[e,t]=r;G6(Number.isFinite(e)),G6(Number.isFinite(t)&&t>=-90&&t<=90,"invalid latitude");const n=e*M3,i=t*M3,s=P3*(n+W_)/(2*W_),a=P3*(W_+Math.log(Math.tan(Sde+i*.5)))/(2*W_);return[s,a]}function Pde(r){const e=Math.cos(r*M3);return P3/Ide/e}const F3=512,Fde=Math.PI/180;function Rde(r){let{map:e,gl:t,deck:n}=r;if(e.__deck)return e.__deck;const i=n==null?void 0:n.props._customRender,s=n==null?void 0:n.props.onLoad,a={...n==null?void 0:n.props,_customRender:()=>{e.triggerRepaint(),i==null||i("")}};a.parameters={...Dde(e,!0),...a.parameters},a.views||(a.views=j6(e));let o;return(!n||n.props.gl===t)&&(Object.assign(a,{gl:t,width:null,height:null,touchAction:"unset",viewState:R3(e)}),n!=null&&n.isInitialized?Q6(n,e):a.onLoad=()=>{s==null||s(),Q6(o,e)}),n?(o=n,n.setProps(a),n.userData.isExternal=!0):(o=new v3(a),e.on("remove",()=>{Lde(e)})),o.userData.mapboxLayers=new Set,e.__deck=o,e.on("render",()=>{o.isInitialized&&Hde(o,e)}),o}function Q6(r,e){const t=()=>{r.isInitialized?Vde(r,e):e.off("move",t)};e.on("move",t)}function Lde(r){var e;(e=r.__deck)==null||e.finalize(),r.__deck=null}function Dde(r,e){const t=e?{depthWriteEnabled:!0,depthCompare:"less-equal",depthBias:0,blend:!0,blendColorSrcFactor:"src-alpha",blendColorDstFactor:"one-minus-src-alpha",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one-minus-src-alpha",blendColorOperation:"add",blendAlphaOperation:"add"}:{};return $6(r)==="globe"&&(t.cullMode="back"),t}function Ode(r,e){r.userData.mapboxLayers.add(e),L3(r)}function kde(r,e){r.userData.mapboxLayers.delete(e),L3(r)}function Ude(r,e){L3(r)}function Nde(r,e,t,n){let{currentViewport:i}=r.userData,s=!1;i||(i=q6(r,e,n),r.userData.currentViewport=i,s=!0),r.isInitialized&&r._drawLayers("mapbox-repaint",{viewports:[i],layerFilter:a=>{let{layer:o}=a;return t.id===o.id||o.props.operation.includes("terrain")},clearStack:s,clearCanvas:!1})}function $6(r){var n;const e=(n=r.getProjection)==null?void 0:n.call(r),t=(e==null?void 0:e.type)||(e==null?void 0:e.name);if(t==="globe")return"globe";if(t&&t!=="mercator")throw new Error("Unsupported projection");return"mercator"}function j6(r){return $6(r)==="globe"?new V6({id:"mapbox"}):new l3({id:"mapbox"})}function R3(r){var i;const{lng:e,lat:t}=r.getCenter(),n={longitude:(e+540)%360-180,latitude:t,zoom:r.getZoom(),bearing:r.getBearing(),pitch:r.getPitch(),padding:r.getPadding(),repeat:r.getRenderWorldCopies()};return(i=r.getTerrain)!=null&&i.call(r)&&zde(r,n),n}function zde(r,e){if(r.getFreeCameraOptions){const{position:t}=r.getFreeCameraOptions();if(!t||t.z===void 0)return;const n=r.transform.height,{longitude:i,latitude:s,pitch:a}=e,o=t.x*F3,h=(1-t.y)*F3,f=t.z*F3,_=Mde([i,s]),x=o-_[0],T=h-_[1],I=Math.sqrt(x*x+T*T),N=a*Fde,$=1.5*n,W=N<.001?$*Math.cos(N)/f:$*Math.sin(N)/I;e.zoom=Math.log2(W);const Y=$*Math.cos(N)/W,ie=f-Y;e.position=[0,0,ie/Pde(s)]}else typeof r.transform.elevation=="number"&&(e.position=[0,0,r.transform.elevation])}function q6(r,e,t){const n=R3(e),i=j6(e);t&&(i.props.nearZMultiplier=.2);const s=(t==null?void 0:t.nearZ)??e.transform._nearZ,a=(t==null?void 0:t.farZ)??e.transform._farZ;return Number.isFinite(s)&&(n.nearZ=s/e.transform.height,n.farZ=a/e.transform.height),i.makeViewport({width:r.width,height:r.height,viewState:n})}function Hde(r,e){const{mapboxLayers:t,isExternal:n}=r.userData;if(n){const i=Array.from(t,_=>_.id),a=Mw(r.props.layers,Boolean).some(_=>_&&!i.includes(_.id));let o=r.getViewports();const h=o.findIndex(_=>_.id==="mapbox"),f=o.length>1||h<0;(a||f)&&(h>=0&&(o=o.slice(),o[h]=q6(r,e)),r._drawLayers("mapbox-repaint",{viewports:o,layerFilter:_=>(!r.props.layerFilter||r.props.layerFilter(_))&&(_.viewport.id!=="mapbox"||!i.includes(_.layer.id)),clearCanvas:!1}))}r.userData.currentViewport=null}function Vde(r,e){r.setProps({viewState:R3(e)}),r.needsRedraw({clearRedrawFlags:!0})}function L3(r){if(r.userData.isExternal)return;const e=[];r.userData.mapboxLayers.forEach(t=>{const n=t.props.type,i=new n(t.props);e.push(i)}),r.setProps({layers:e})}class Gde{constructor(e){if(!e.id)throw new Error("Layer must have an unique id");this.id=e.id,this.type="custom",this.renderingMode=e.renderingMode||"3d",this.map=null,this.deck=null,this.props=e}onAdd(e,t){this.map=e,this.deck=Rde({map:e,gl:t,deck:this.props.deck}),Ode(this.deck,this)}onRemove(){this.deck&&kde(this.deck,this)}setProps(e){Object.assign(this.props,e,{id:this.id}),this.deck&&Ude(this.deck)}render(e,t){Nde(this.deck,this.map,this,t)}}function al(r,e){if(!r)throw new Error(e||"loader assertion failed.")}const Vw=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),K6=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);K6&&parseFloat(K6[1]);const Qde="3.4.15";function zf(r,e){if(!r)throw new Error(e||"loaders.gl assertion failed.")}const D3={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document},$de=D3.global||D3.self||D3.window||{},gA=typeof process!="object"||String(process)!=="[object process]"||process.browser,O3=typeof importScripts=="function",jde=typeof window<"u"&&typeof window.orientation<"u",W6=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);W6&&parseFloat(W6[1]);function P1(r){"@babel/helpers - typeof";return P1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},P1(r)}function qde(r,e){if(P1(r)!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var n=t.call(r,e||"default");if(P1(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function Kde(r){var e=qde(r,"string");return P1(e)=="symbol"?e:e+""}function cn(r,e,t){return e=Kde(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}class Wde{constructor(e,t){cn(this,"name",void 0),cn(this,"workerThread",void 0),cn(this,"isRunning",!0),cn(this,"result",void 0),cn(this,"_resolve",()=>{}),cn(this,"_reject",()=>{}),this.name=e,this.workerThread=t,this.result=new Promise((n,i)=>{this._resolve=n,this._reject=i})}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){zf(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){zf(this.isRunning),this.isRunning=!1,this._reject(e)}}let k3=class{terminate(){}};const U3=new Map;function Xde(r){zf(r.source&&!r.url||!r.source&&r.url);let e=U3.get(r.source||r.url);return e||(r.url&&(e=Jde(r.url),U3.set(r.url,e)),r.source&&(e=X6(r.source),U3.set(r.source,e))),zf(e),e}function Jde(r){if(!r.startsWith("http"))return r;const e=Zde(r);return X6(e)}function X6(r){const e=new Blob([r],{type:"application/javascript"});return URL.createObjectURL(e)}function Zde(r){return`try {
  importScripts('`.concat(r,`');
} catch (error) {
  console.error(error);
  throw error;
}`)}function J6(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,t=arguments.length>2?arguments[2]:void 0;const n=t||new Set;if(r){if(Z6(r))n.add(r);else if(Z6(r.buffer))n.add(r.buffer);else if(!ArrayBuffer.isView(r)){if(e&&typeof r=="object")for(const i in r)J6(r[i],e,n)}}return t===void 0?Array.from(n):[]}function Z6(r){return r?r instanceof ArrayBuffer||typeof MessagePort<"u"&&r instanceof MessagePort||typeof ImageBitmap<"u"&&r instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&r instanceof OffscreenCanvas:!1}const N3=()=>{};class z3{static isSupported(){return typeof Worker<"u"&&gA||typeof k3<"u"&&!gA}constructor(e){cn(this,"name",void 0),cn(this,"source",void 0),cn(this,"url",void 0),cn(this,"terminated",!1),cn(this,"worker",void 0),cn(this,"onMessage",void 0),cn(this,"onError",void 0),cn(this,"_loadableURL","");const{name:t,source:n,url:i}=e;zf(n||i),this.name=t,this.source=n,this.url=i,this.onMessage=N3,this.onError=s=>console.log(s),this.worker=gA?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=N3,this.onError=N3,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,t){t=t||J6(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+="worker ".concat(this.name," from ").concat(this.url,". "),e.message&&(t+="".concat(e.message," in ")),e.lineno&&(t+=":".concat(e.lineno,":").concat(e.colno)),new Error(t)}_createBrowserWorker(){this._loadableURL=Xde({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=t=>{t.data?this.onMessage(t.data):this.onError(new Error("No data received"))},e.onerror=t=>{this.onError(this._getErrorFromErrorEvent(t)),this.terminated=!0},e.onmessageerror=t=>console.error(t),e}_createNodeWorker(){let e;if(this.url){const n=this.url.includes(":/")||this.url.startsWith("/")?this.url:"./".concat(this.url);e=new k3(n,{eval:!1})}else if(this.source)e=new k3(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",t=>{this.onMessage(t)}),e.on("error",t=>{this.onError(t)}),e.on("exit",t=>{}),e}}class Yde{static isSupported(){return z3.isSupported()}constructor(e){cn(this,"name","unnamed"),cn(this,"source",void 0),cn(this,"url",void 0),cn(this,"maxConcurrency",1),cn(this,"maxMobileConcurrency",1),cn(this,"onDebug",()=>{}),cn(this,"reuseWorkers",!0),cn(this,"props",{}),cn(this,"jobQueue",[]),cn(this,"idleQueue",[]),cn(this,"count",0),cn(this,"isDestroyed",!1),this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:(s,a,o)=>s.done(o),n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:(s,a)=>s.error(a);const i=new Promise(s=>(this.jobQueue.push({name:e,onMessage:t,onError:n,onStart:s}),this));return this._startQueuedJob(),await i}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});const n=new Wde(t.name,e);e.onMessage=i=>t.onMessage(n,i.type,i.payload),e.onError=i=>t.onError(n,i),t.onStart(n);try{await n.result}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new z3({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return jde?this.maxMobileConcurrency:this.maxConcurrency}}const efe={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class mA{static isSupported(){return z3.isSupported()}static getWorkerFarm(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return mA._workerFarm=mA._workerFarm||new mA({}),mA._workerFarm.setProps(e),mA._workerFarm}constructor(e){cn(this,"props",void 0),cn(this,"workerPools",new Map),this.props={...efe},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const t of this.workerPools.values())t.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:t,source:n,url:i}=e;let s=this.workerPools.get(t);return s||(s=new Yde({name:t,source:n,url:i}),s.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,s)),s}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}cn(mA,"_workerFarm",void 0);const tfe="latest";function rfe(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const t=e[r.id]||{},n="".concat(r.id,"-worker.js");let i=t.workerUrl;if(!i&&r.id==="compression"&&(i=e.workerUrl),e._workerType==="test"&&(i="modules/".concat(r.module,"/dist/").concat(n)),!i){let s=r.version;s==="latest"&&(s=tfe);const a=s?"@".concat(s):"";i="https://unpkg.com/@loaders.gl/".concat(r.module).concat(a,"/dist/").concat(n)}return zf(i),i}function nfe(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Qde;zf(r,"no worker provided");const t=r.version;return!(!e||!t)}const ife=null,sfe=null,H3=null,Y6=null,ofe=Object.freeze(Object.defineProperty({__proto__:null,readFileAsArrayBuffer:ife,readFileAsText:sfe,requireFromFile:H3,requireFromString:Y6},Symbol.toStringTag,{value:"Module"})),afe="3.4.15",V3={};async function Og(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return e&&(r=lfe(r,e,t)),V3[r]=V3[r]||cfe(r),await V3[r]}function lfe(r,e,t){if(r.startsWith("http"))return r;const n=t.modules||{};return n[r]?n[r]:gA?t.CDN?(zf(t.CDN.startsWith("http")),"".concat(t.CDN,"/").concat(e,"@").concat(afe,"/dist/libs/").concat(r)):O3?"../src/libs/".concat(r):"modules/".concat(e,"/src/libs/").concat(r):"modules/".concat(e,"/dist/libs/").concat(r)}async function cfe(r){if(r.endsWith("wasm"))return await(await fetch(r)).arrayBuffer();if(!gA)try{return ofe&&H3&&await H3(r)}catch{return null}if(O3)return importScripts(r);const t=await(await fetch(r)).text();return ufe(t,r)}function ufe(r,e){if(!gA)return Y6;if(O3)return eval.call($de,r),null;const t=document.createElement("script");t.id=e;try{t.appendChild(document.createTextNode(r))}catch{t.text=r}return document.body.appendChild(t),null}function hfe(r,e){return!mA.isSupported()||!gA&&!(e!=null&&e._nodeWorkers)?!1:r.worker&&(e==null?void 0:e.worker)}async function dfe(r,e,t,n,i){const s=r.id,a=rfe(r,t),h=mA.getWorkerFarm(t).getWorkerPool({name:s,url:a});t=JSON.parse(JSON.stringify(t)),n=JSON.parse(JSON.stringify(n||{}));const f=await h.startJob("process-on-worker",ffe.bind(null,i));return f.postMessage("process",{input:e,options:t,context:n}),await(await f.result).result}async function ffe(r,e,t,n){switch(t){case"done":e.done(n);break;case"error":e.error(new Error(n.error));break;case"process":const{id:i,input:s,options:a}=n;try{const o=await r(s,a);e.postMessage("done",{id:i,result:o})}catch(o){const h=o instanceof Error?o.message:"unknown error";e.postMessage("error",{id:i,error:h})}break;default:console.warn("parse-with-worker unknown message ".concat(t))}}function Afe(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof r=="string"?r.slice(0,e):ArrayBuffer.isView(r)?e8(r.buffer,r.byteOffset,e):r instanceof ArrayBuffer?e8(r,0,e):""}function e8(r,e,t){if(r.byteLength<=e+t)return"";const n=new DataView(r);let i="";for(let s=0;s<t;s++)i+=String.fromCharCode(n.getUint8(e+s));return i}function pfe(r){try{return JSON.parse(r)}catch{throw new Error('Failed to parse JSON from data starting with "'.concat(Afe(r),'"'))}}function gfe(r,e,t){if(t=t||r.byteLength,r.byteLength<t||e.byteLength<t)return!1;const n=new Uint8Array(r),i=new Uint8Array(e);for(let s=0;s<n.length;++s)if(n[s]!==i[s])return!1;return!0}function mfe(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];const n=e.map(o=>o instanceof ArrayBuffer?new Uint8Array(o):o),i=n.reduce((o,h)=>o+h.byteLength,0),s=new Uint8Array(i);let a=0;for(const o of n)s.set(o,a),a+=o.byteLength;return s.buffer}function G3(r,e,t){const n=t!==void 0?new Uint8Array(r).subarray(e,e+t):new Uint8Array(r).subarray(e);return new Uint8Array(n).buffer}function F1(r,e){return al(r>=0),al(e>0),r+(e-1)&~(e-1)}function _fe(r,e,t){let n;if(r instanceof ArrayBuffer)n=new Uint8Array(r);else{const i=r.byteOffset,s=r.byteLength;n=new Uint8Array(r.buffer||r.arrayBuffer,i,s)}return e.set(n,t),t+F1(n.byteLength,4)}async function yfe(r){const e=[];for await(const t of r)e.push(t);return mfe(...e)}let bfe="";const t8={};function vfe(r){for(const e in t8)if(r.startsWith(e)){const t=t8[e];r=r.replace(e,t)}return!r.startsWith("http://")&&!r.startsWith("https://")&&(r="".concat(bfe).concat(r)),r}function eXe(r){return r}function xfe(r){return r&&typeof r=="object"&&r.isBuffer}function r8(r){if(xfe(r))return r;if(r instanceof ArrayBuffer)return r;if(ArrayBuffer.isView(r))return r.byteOffset===0&&r.byteLength===r.buffer.byteLength?r.buffer:r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength);if(typeof r=="string"){const e=r;return new TextEncoder().encode(e).buffer}if(r&&typeof r=="object"&&r._toArrayBuffer)return r._toArrayBuffer();throw new Error("toArrayBuffer")}function n8(r){const e=r?r.lastIndexOf("/"):-1;return e>=0?r.substr(e+1):""}function i8(r){const e=r?r.lastIndexOf("/"):-1;return e>=0?r.substr(0,e):""}const wfe=r=>typeof r=="boolean",R1=r=>typeof r=="function",L1=r=>r!==null&&typeof r=="object",s8=r=>L1(r)&&r.constructor==={}.constructor,Bfe=r=>r&&typeof r[Symbol.iterator]=="function",Cfe=r=>r&&typeof r[Symbol.asyncIterator]=="function",kg=r=>typeof Response<"u"&&r instanceof Response||r&&r.arrayBuffer&&r.text&&r.json,Ug=r=>typeof Blob<"u"&&r instanceof Blob,Efe=r=>r&&typeof r=="object"&&r.isBuffer,Tfe=r=>typeof ReadableStream<"u"&&r instanceof ReadableStream||L1(r)&&R1(r.tee)&&R1(r.cancel)&&R1(r.getReader),Sfe=r=>L1(r)&&R1(r.read)&&R1(r.pipe)&&wfe(r.readable),o8=r=>Tfe(r)||Sfe(r),Ife=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,Mfe=/^([-\w.]+\/[-\w.+]+)/;function Pfe(r){const e=Mfe.exec(r);return e?e[1]:r}function a8(r){const e=Ife.exec(r);return e?e[1]:""}const l8=/\?.*/;function Ffe(r){const e=r.match(l8);return e&&e[0]}function Q3(r){return r.replace(l8,"")}function Gw(r){return kg(r)?r.url:Ug(r)?r.name||"":typeof r=="string"?r:""}function $3(r){if(kg(r)){const e=r,t=e.headers.get("content-type")||"",n=Q3(e.url);return Pfe(t)||a8(n)}return Ug(r)?r.type||"":typeof r=="string"?a8(r):""}function Rfe(r){return kg(r)?r.headers["content-length"]||-1:Ug(r)?r.size:typeof r=="string"?r.length:r instanceof ArrayBuffer||ArrayBuffer.isView(r)?r.byteLength:-1}async function c8(r){if(kg(r))return r;const e={},t=Rfe(r);t>=0&&(e["content-length"]=String(t));const n=Gw(r),i=$3(r);i&&(e["content-type"]=i);const s=await Ofe(r);s&&(e["x-first-bytes"]=s),typeof r=="string"&&(r=new TextEncoder().encode(r));const a=new Response(r,{headers:e});return Object.defineProperty(a,"url",{value:n}),a}async function Lfe(r){if(!r.ok){const e=await Dfe(r);throw new Error(e)}}async function Dfe(r){let e="Failed to fetch resource ".concat(r.url," (").concat(r.status,"): ");try{const t=r.headers.get("Content-Type");let n=r.statusText;t.includes("application/json")&&(n+=" ".concat(await r.text())),e+=n,e=e.length>60?"".concat(e.slice(0,60),"..."):e}catch{}return e}async function Ofe(r){if(typeof r=="string")return"data:,".concat(r.slice(0,5));if(r instanceof Blob){const t=r.slice(0,5);return await new Promise(n=>{const i=new FileReader;i.onload=s=>{var a;return n(s==null||(a=s.target)===null||a===void 0?void 0:a.result)},i.readAsDataURL(t)})}if(r instanceof ArrayBuffer){const t=r.slice(0,5),n=kfe(t);return"data:base64,".concat(n)}return null}function kfe(r){let e="";const t=new Uint8Array(r);for(let n=0;n<t.byteLength;n++)e+=String.fromCharCode(t[n]);return btoa(e)}async function u8(r,e){if(typeof r=="string"){r=vfe(r);let t=e;return e!=null&&e.fetch&&typeof(e==null?void 0:e.fetch)!="function"&&(t=e.fetch),await fetch(r,t)}return await c8(r)}function Ufe(r){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron)return!0;const t=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent;return!!(t&&t.indexOf("Electron")>=0)}function D1(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||Ufe()}const Qw={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document,process:typeof process=="object"&&process},$w=Qw.window||Qw.self||Qw.global,O1=Qw.process||{},h8=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";D1();function Nfe(r){try{const e=window[r],t="__storage_test__";return e.setItem(t,t),e.removeItem(t),e}catch{return null}}let zfe=class{constructor(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";cn(this,"storage",void 0),cn(this,"id",void 0),cn(this,"config",void 0),this.storage=Nfe(n),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}};function Hfe(r){let e;return r<10?e="".concat(r.toFixed(2),"ms"):r<100?e="".concat(r.toFixed(1),"ms"):r<1e3?e="".concat(r.toFixed(0),"ms"):e="".concat((r/1e3).toFixed(2),"s"),e}function Vfe(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const t=Math.max(e-r.length,0);return"".concat(" ".repeat(t)).concat(r)}function j3(r,e,t){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const i=r.src.replace(/\(/g,"%28").replace(/\)/g,"%29");r.width>n&&(t=Math.min(t,n/r.width));const s=r.width*t,a=r.height*t,o=["font-size:1px;","padding:".concat(Math.floor(a/2),"px ").concat(Math.floor(s/2),"px;"),"line-height:".concat(a,"px;"),"background:url(".concat(i,");"),"background-size:".concat(s,"px ").concat(a,"px;"),"color:transparent;"].join("");return["".concat(e," %c+"),o]}let jw;(function(r){r[r.BLACK=30]="BLACK",r[r.RED=31]="RED",r[r.GREEN=32]="GREEN",r[r.YELLOW=33]="YELLOW",r[r.BLUE=34]="BLUE",r[r.MAGENTA=35]="MAGENTA",r[r.CYAN=36]="CYAN",r[r.WHITE=37]="WHITE",r[r.BRIGHT_BLACK=90]="BRIGHT_BLACK",r[r.BRIGHT_RED=91]="BRIGHT_RED",r[r.BRIGHT_GREEN=92]="BRIGHT_GREEN",r[r.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",r[r.BRIGHT_BLUE=94]="BRIGHT_BLUE",r[r.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",r[r.BRIGHT_CYAN=96]="BRIGHT_CYAN",r[r.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(jw||(jw={}));function d8(r){return typeof r=="string"?jw[r.toUpperCase()]||jw.WHITE:r}function Gfe(r,e,t){return!D1&&typeof r=="string"&&(e&&(e=d8(e),r="\x1B[".concat(e,"m").concat(r,"\x1B[39m")),t&&(e=d8(t),r="\x1B[".concat(t+10,"m").concat(r,"\x1B[49m"))),r}function Qfe(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const t=Object.getPrototypeOf(r),n=Object.getOwnPropertyNames(t);for(const i of n)typeof r[i]=="function"&&(e.find(s=>i===s)||(r[i]=r[i].bind(r)))}function qw(r,e){if(!r)throw new Error(e||"Assertion failed")}function X_(){let r;if(D1&&"performance"in $w){var e,t;r=$w==null||(e=$w.performance)===null||e===void 0||(t=e.now)===null||t===void 0?void 0:t.call(e)}else if("hrtime"in O1){var n;const i=O1==null||(n=O1.hrtime)===null||n===void 0?void 0:n.call(O1);r=i[0]*1e3+i[1]/1e6}else r=Date.now();return r}const J_={debug:D1&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},$fe={enabled:!0,level:0};function od(){}const f8={},A8={once:!0};let q3=class{constructor(){let{id:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};cn(this,"id",void 0),cn(this,"VERSION",h8),cn(this,"_startTs",X_()),cn(this,"_deltaTs",X_()),cn(this,"_storage",void 0),cn(this,"userData",{}),cn(this,"LOG_THROTTLE_TIMEOUT",0),this.id=e,this.userData={},this._storage=new zfe("__probe-".concat(this.id,"__"),$fe),this.timeStamp("".concat(this.id," started")),Qfe(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((X_()-this._startTs).toPrecision(10))}getDelta(){return Number((X_()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){qw(e,t)}warn(e){return this._getLogFunction(0,e,J_.warn,arguments,A8)}error(e){return this._getLogFunction(0,e,J_.error,arguments)}deprecated(e,t){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(t,"` instead"))}removed(e,t){return this.error("`".concat(e,"` has been removed. Use `").concat(t,"` instead"))}probe(e,t){return this._getLogFunction(e,t,J_.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,J_.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){for(var n=arguments.length,i=new Array(n>2?n-2:0),s=2;s<n;s++)i[s-2]=arguments[s];return this._getLogFunction(e,t,J_.debug||J_.info,arguments,A8)}table(e,t,n){return t?this._getLogFunction(e,t,console.table||od,n&&[n],{tag:Wfe(t)}):od}image(e){let{logLevel:t,priority:n,image:i,message:s="",scale:a=1}=e;return this._shouldLog(t||n)?D1?Kfe({image:i,message:s,scale:a}):qfe():od}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||od)}group(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const i=g8({logLevel:e,message:t,opts:n}),{collapsed:s}=n;return i.method=(s?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(e,t,Object.assign({},n,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||od)}withGroup(e,t,n){this.group(e,t)();try{n()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=p8(e)}_getLogFunction(e,t,n,i,s){if(this._shouldLog(e)){s=g8({logLevel:e,message:t,args:i,opts:s}),n=n||s.method,qw(n),s.total=this.getTotal(),s.delta=this.getDelta(),this._deltaTs=X_();const a=s.tag||s.message;if(s.once)if(!f8[a])f8[a]=X_();else return od;return t=jfe(this.id,s.message,s),n.bind(console,t,...s.args)}return od}};cn(q3,"VERSION",h8);function p8(r){if(!r)return 0;let e;switch(typeof r){case"number":e=r;break;case"object":e=r.logLevel||r.priority||0;break;default:return 0}return qw(Number.isFinite(e)&&e>=0),e}function g8(r){const{logLevel:e,message:t}=r;r.logLevel=p8(e);const n=r.args?Array.from(r.args):[];for(;n.length&&n.shift()!==t;);switch(typeof e){case"string":case"function":t!==void 0&&n.unshift(t),r.message=e;break;case"object":Object.assign(r,e);break}typeof r.message=="function"&&(r.message=r.message());const i=typeof r.message;return qw(i==="string"||i==="object"),Object.assign(r,{args:n},r.opts)}function jfe(r,e,t){if(typeof e=="string"){const n=t.time?Vfe(Hfe(t.total)):"";e=t.time?"".concat(r,": ").concat(n,"  ").concat(e):"".concat(r,": ").concat(e),e=Gfe(e,t.color,t.background)}return e}function qfe(r){return console.warn("removed"),od}function Kfe(r){let{image:e,message:t="",scale:n=1}=r;if(typeof e=="string"){const s=new Image;return s.onload=()=>{const a=j3(s,t,n);console.log(...a)},s.src=e,od}const i=e.nodeName||"";if(i.toLowerCase()==="img")return console.log(...j3(e,t,n)),od;if(i.toLowerCase()==="canvas"){const s=new Image;return s.onload=()=>console.log(...j3(s,t,n)),s.src=e.toDataURL(),od}return od}function Wfe(r){for(const e in r)for(const t in r[e])return t||"untitled";return"empty"}const m8=new q3({id:"loaders.gl"});class Xfe{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class Jfe{constructor(){cn(this,"console",void 0),this.console=console}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.console.log.bind(this.console,...t)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.console.info.bind(this.console,...t)}warn(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.console.warn.bind(this.console,...t)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.console.error.bind(this.console,...t)}}const _8={fetch:null,mimeType:void 0,nothrow:!1,log:new Jfe,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:Vw,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},Zfe={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function y8(){globalThis.loaders=globalThis.loaders||{};const{loaders:r}=globalThis;return r._state=r._state||{},r._state}const b8=()=>{const r=y8();return r.globalOptions=r.globalOptions||{..._8},r.globalOptions};function Yfe(r,e,t,n){return t=t||[],t=Array.isArray(t)?t:[t],eAe(r,t),rAe(e,r,n)}function eAe(r,e){v8(r,null,_8,Zfe,e);for(const t of e){const n=r&&r[t.id]||{},i=t.options&&t.options[t.id]||{},s=t.deprecatedOptions&&t.deprecatedOptions[t.id]||{};v8(n,t.id,i,s,e)}}function v8(r,e,t,n,i){const s=e||"Top level",a=e?"".concat(e,"."):"";for(const o in r){const h=!e&&L1(r[o]),f=o==="baseUri"&&!e,_=o==="workerUrl"&&e;if(!(o in t)&&!f&&!_){if(o in n)m8.warn("".concat(s," loader option '").concat(a).concat(o,"' no longer supported, use '").concat(n[o],"'"))();else if(!h){const x=tAe(o,i);m8.warn("".concat(s," loader option '").concat(a).concat(o,"' not recognized. ").concat(x))()}}}}function tAe(r,e){const t=r.toLowerCase();let n="";for(const i of e)for(const s in i.options){if(r===s)return"Did you mean '".concat(i.id,".").concat(s,"'?");const a=s.toLowerCase();(t.startsWith(a)||a.startsWith(t))&&(n=n||"Did you mean '".concat(i.id,".").concat(s,"'?"))}return n}function rAe(r,e,t){const i={...r.options||{}};return nAe(i,t),i.log===null&&(i.log=new Xfe),x8(i,b8()),x8(i,e),i}function x8(r,e){for(const t in e)if(t in e){const n=e[t];s8(n)&&s8(r[t])?r[t]={...r[t],...e[t]}:r[t]=e[t]}}function nAe(r,e){e&&!("baseUri"in r)&&(r.baseUri=e)}function K3(r){var e;return r?(Array.isArray(r)&&(r=r[0]),Array.isArray((e=r)===null||e===void 0?void 0:e.extensions)):!1}function w8(r){var e,t;al(r,"null loader"),al(K3(r),"invalid loader");let n;return Array.isArray(r)&&(n=r[1],r=r[0],r={...r,options:{...r.options,...n}}),((e=r)!==null&&e!==void 0&&e.parseTextSync||(t=r)!==null&&t!==void 0&&t.parseText)&&(r.text=!0),r.text||(r.binary=!0),r}const iAe=()=>{const r=y8();return r.loaderRegistry=r.loaderRegistry||[],r.loaderRegistry};function sAe(){return iAe()}const oAe=new q3({id:"loaders.gl"}),aAe=/\.([^.]+)$/;async function lAe(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],t=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;if(!C8(r))return null;let i=B8(r,e,{...t,nothrow:!0},n);if(i)return i;if(Ug(r)&&(r=await r.slice(0,10).arrayBuffer(),i=B8(r,e,t,n)),!i&&!(t!=null&&t.nothrow))throw new Error(E8(r));return i}function B8(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],t=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;if(!C8(r))return null;if(e&&!Array.isArray(e))return w8(e);let i=[];e&&(i=i.concat(e)),t!=null&&t.ignoreRegisteredLoaders||i.push(...sAe()),uAe(i);const s=cAe(r,i,t,n);if(!s&&!(t!=null&&t.nothrow))throw new Error(E8(r));return s}function cAe(r,e,t,n){const i=Gw(r),s=$3(r),a=Q3(i)||(n==null?void 0:n.url);let o=null,h="";if(t!=null&&t.mimeType&&(o=W3(e,t==null?void 0:t.mimeType),h="match forced by supplied MIME type ".concat(t==null?void 0:t.mimeType)),o=o||hAe(e,a),h=h||(o?"matched url ".concat(a):""),o=o||W3(e,s),h=h||(o?"matched MIME type ".concat(s):""),o=o||fAe(e,r),h=h||(o?"matched initial data ".concat(S8(r)):""),o=o||W3(e,t==null?void 0:t.fallbackMimeType),h=h||(o?"matched fallback MIME type ".concat(s):""),h){var f;oAe.log(1,"selectLoader selected ".concat((f=o)===null||f===void 0?void 0:f.name,": ").concat(h,"."))}return o}function C8(r){return!(r instanceof Response&&r.status===204)}function E8(r){const e=Gw(r),t=$3(r);let n="No valid loader found (";n+=e?"".concat(n8(e),", "):"no url provided, ",n+="MIME type: ".concat(t?'"'.concat(t,'"'):"not provided",", ");const i=r?S8(r):"";return n+=i?' first bytes: "'.concat(i,'"'):"first bytes: not available",n+=")",n}function uAe(r){for(const e of r)w8(e)}function hAe(r,e){const t=e&&aAe.exec(e),n=t&&t[1];return n?dAe(r,n):null}function dAe(r,e){e=e.toLowerCase();for(const t of r)for(const n of t.extensions)if(n.toLowerCase()===e)return t;return null}function W3(r,e){for(const t of r)if(t.mimeTypes&&t.mimeTypes.includes(e)||e==="application/x.".concat(t.id))return t;return null}function fAe(r,e){if(!e)return null;for(const t of r)if(typeof e=="string"){if(AAe(e,t))return t}else if(ArrayBuffer.isView(e)){if(T8(e.buffer,e.byteOffset,t))return t}else if(e instanceof ArrayBuffer&&T8(e,0,t))return t;return null}function AAe(r,e){return e.testText?e.testText(r):(Array.isArray(e.tests)?e.tests:[e.tests]).some(n=>r.startsWith(n))}function T8(r,e,t){return(Array.isArray(t.tests)?t.tests:[t.tests]).some(i=>pAe(r,e,t,i))}function pAe(r,e,t,n){if(n instanceof ArrayBuffer)return gfe(n,r,n.byteLength);switch(typeof n){case"function":return n(r,t);case"string":const i=X3(r,e,n.length);return n===i;default:return!1}}function S8(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof r=="string"?r.slice(0,e):ArrayBuffer.isView(r)?X3(r.buffer,r.byteOffset,e):r instanceof ArrayBuffer?X3(r,0,e):""}function X3(r,e,t){if(r.byteLength<e+t)return"";const n=new DataView(r);let i="";for(let s=0;s<t;s++)i+=String.fromCharCode(n.getUint8(e+s));return i}const gAe=256*1024;function*mAe(r,e){const t=(e==null?void 0:e.chunkSize)||gAe;let n=0;const i=new TextEncoder;for(;n<r.length;){const s=Math.min(r.length-n,t),a=r.slice(n,n+s);n+=s,yield i.encode(a)}}const _Ae=256*1024;function yAe(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){const{chunkSize:t=_Ae}=e;let n=0;for(;n<r.byteLength;){const i=Math.min(r.byteLength-n,t),s=new ArrayBuffer(i),a=new Uint8Array(r,n,i);new Uint8Array(s).set(a),n+=i,yield s}}()}const bAe=1024*1024;async function*vAe(r,e){const t=(e==null?void 0:e.chunkSize)||bAe;let n=0;for(;n<r.size;){const i=n+t,s=await r.slice(n,i).arrayBuffer();n=i,yield s}}function I8(r,e){return Vw?xAe(r,e):wAe(r)}async function*xAe(r,e){const t=r.getReader();let n;try{for(;;){const i=n||t.read();e!=null&&e._streamReadAhead&&(n=t.read());const{done:s,value:a}=await i;if(s)return;yield r8(a)}}catch{t.releaseLock()}}async function*wAe(r,e){for await(const t of r)yield r8(t)}function BAe(r,e){if(typeof r=="string")return mAe(r,e);if(r instanceof ArrayBuffer)return yAe(r,e);if(Ug(r))return vAe(r,e);if(o8(r))return I8(r,e);if(kg(r))return I8(r.body,e);throw new Error("makeIterator")}const M8="Cannot convert supplied data type";function CAe(r,e,t){if(e.text&&typeof r=="string")return r;if(Efe(r)&&(r=r.buffer),r instanceof ArrayBuffer){const n=r;return e.text&&!e.binary?new TextDecoder("utf8").decode(n):n}if(ArrayBuffer.isView(r)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(r);let n=r.buffer;const i=r.byteLength||r.length;return(r.byteOffset!==0||i!==n.byteLength)&&(n=n.slice(r.byteOffset,r.byteOffset+i)),n}throw new Error(M8)}async function EAe(r,e,t){const n=r instanceof ArrayBuffer||ArrayBuffer.isView(r);if(typeof r=="string"||n)return CAe(r,e);if(Ug(r)&&(r=await c8(r)),kg(r)){const i=r;return await Lfe(i),e.binary?await i.arrayBuffer():await i.text()}if(o8(r)&&(r=BAe(r,t)),Bfe(r)||Cfe(r))return yfe(r);throw new Error(M8)}function P8(r,e){const t=b8(),n=r||t;return typeof n.fetch=="function"?n.fetch:L1(n.fetch)?i=>u8(i,n):e!=null&&e.fetch?e==null?void 0:e.fetch:u8}function TAe(r,e,t){if(t)return t;const n={fetch:P8(e,r),...r};if(n.url){const i=Q3(n.url);n.baseUrl=i,n.queryString=Ffe(n.url),n.filename=n8(i),n.baseUrl=i8(i)}return Array.isArray(n.loaders)||(n.loaders=null),n}function SAe(r,e){if(!e&&r&&!Array.isArray(r))return r;let t;if(r&&(t=Array.isArray(r)?r:[r]),e&&e.loaders){const n=Array.isArray(e.loaders)?e.loaders:[e.loaders];t=t?[...t,...n]:n}return t&&t.length?t:null}async function J3(r,e,t,n){zf(!n||typeof n=="object"),e&&!Array.isArray(e)&&!K3(e)&&(n=void 0,t=e,e=void 0),r=await r,t=t||{};const i=Gw(r),a=SAe(e,n),o=await lAe(r,a,t);return o?(t=Yfe(t,o,a,i),n=TAe({url:i,parse:J3,loaders:a},t,n||null),await IAe(o,r,t,n)):null}async function IAe(r,e,t,n){if(nfe(r),kg(e)){const i=e,{ok:s,redirected:a,status:o,statusText:h,type:f,url:_}=i,x=Object.fromEntries(i.headers.entries());n.response={headers:x,ok:s,redirected:a,status:o,statusText:h,type:f,url:_}}if(e=await EAe(e,r,t),r.parseTextSync&&typeof e=="string")return t.dataType="text",r.parseTextSync(e,t,n,r);if(hfe(r,t))return await dfe(r,e,t,n,J3);if(r.parseText&&typeof e=="string")return await r.parseText(e,t,n,r);if(r.parse)return await r.parse(e,t,n,r);throw zf(!r.parseSync),new Error("".concat(r.id," loader - no parser found and worker is disabled"))}async function Ng(r,e,t,n){!Array.isArray(e)&&!K3(e)&&(t=e,e=void 0);const i=P8(t);let s=r;return typeof r=="string"&&(s=await i(r)),Ug(r)&&(s=await i(r)),await J3(s,e,t)}const F8=`uniform pointCloudUniforms {
  float radiusPixels;
  highp int sizeUnits;
} pointCloud;
`,MAe={name:"pointCloud",vs:F8,fs:F8,uniformTypes:{radiusPixels:"f32",sizeUnits:"i32"}},PAe=`#version 300 es
#define SHADER_NAME point-cloud-layer-vertex-shader
in vec3 positions;
in vec3 instanceNormals;
in vec4 instanceColors;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec3 instancePickingColors;
out vec4 vColor;
out vec2 unitPosition;
void main(void) {
geometry.worldPosition = instancePositions;
geometry.normal = project_normal(instanceNormals);
unitPosition = positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
vec3 offset = vec3(positions.xy * project_size_to_pixel(pointCloud.radiusPixels, pointCloud.sizeUnits), 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, instanceColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,FAe=`#version 300 es
#define SHADER_NAME point-cloud-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 unitPosition;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition.xy;
float distToCenter = length(unitPosition);
if (distToCenter > 1.0) {
discard;
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,R8=[0,0,0,255],L8=[0,0,1],RAe={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:r=>r.position},getNormal:{type:"accessor",value:L8},getColor:{type:"accessor",value:R8},material:!0,radiusPixels:{deprecatedFor:"pointSize"}};function LAe(r){const{header:e,attributes:t}=r;if(!(!e||!t)&&(r.length=e.vertexCount,t.POSITION&&(t.instancePositions=t.POSITION),t.NORMAL&&(t.instanceNormals=t.NORMAL),t.COLOR_0)){const{size:n,value:i}=t.COLOR_0;t.instanceColors={size:n,type:"unorm8",value:i}}}class Z3 extends q_{getShaders(){return super.getShaders({vs:PAe,fs:FAe,modules:[LI,cU,VI,MAe]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:L8},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:R8}})}updateState(e){var i;const{changeFlags:t,props:n}=e;super.updateState(e),t.extensionsChanged&&((i=this.state.model)==null||i.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll()),t.dataChanged&&LAe(n.data)}draw(e){const{pointSize:t,sizeUnits:n}=this.props,i=this.state.model,s={sizeUnits:wI[n],radiusPixels:t};i.shaderInputs.setProps({pointCloud:s}),i.draw(this.context.renderPass)}_getModel(){const e=[];for(let t=0;t<3;t++){const n=t/3*Math.PI*2;e.push(Math.cos(n)*2,Math.sin(n)*2,0)}return new lp(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new R_({topology:"triangle-list",attributes:{positions:new Float32Array(e)}}),isInstanced:!0})}}Z3.layerName="PointCloudLayer",Z3.defaultProps=RAe;async function k1(r,e,t,n){return n._parse(r,e,t,n)}function Po(r,e){if(!r)throw new Error(e||"loader assertion failed.")}const D8=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),O8=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);O8&&parseFloat(O8[1]);const Kw=globalThis,Z_=globalThis.process||{};function DAe(r){var n,i;if(typeof window<"u"&&((n=window.process)==null?void 0:n.type)==="renderer"||typeof process<"u"&&((i=process.versions)!=null&&i.electron))return!0;const t=typeof navigator<"u"&&navigator.userAgent;return!!(t&&t.indexOf("Electron")>=0)}function Y3(){return!(typeof process=="object"&&String(process)==="[object process]"&&!(process!=null&&process.browser))||DAe()}const k8="4.0.7";function OAe(r){try{const e=window[r],t="__storage_test__";return e.setItem(t,t),e.removeItem(t),e}catch{return null}}class kAe{constructor(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";this.storage=OAe(n),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}function UAe(r){let e;return r<10?e=`${r.toFixed(2)}ms`:r<100?e=`${r.toFixed(1)}ms`:r<1e3?e=`${r.toFixed(0)}ms`:e=`${(r/1e3).toFixed(2)}s`,e}function NAe(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const t=Math.max(e-r.length,0);return`${" ".repeat(t)}${r}`}var Ww;(function(r){r[r.BLACK=30]="BLACK",r[r.RED=31]="RED",r[r.GREEN=32]="GREEN",r[r.YELLOW=33]="YELLOW",r[r.BLUE=34]="BLUE",r[r.MAGENTA=35]="MAGENTA",r[r.CYAN=36]="CYAN",r[r.WHITE=37]="WHITE",r[r.BRIGHT_BLACK=90]="BRIGHT_BLACK",r[r.BRIGHT_RED=91]="BRIGHT_RED",r[r.BRIGHT_GREEN=92]="BRIGHT_GREEN",r[r.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",r[r.BRIGHT_BLUE=94]="BRIGHT_BLUE",r[r.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",r[r.BRIGHT_CYAN=96]="BRIGHT_CYAN",r[r.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Ww||(Ww={}));const zAe=10;function U8(r){return typeof r!="string"?r:(r=r.toUpperCase(),Ww[r]||Ww.WHITE)}function HAe(r,e,t){return!Y3&&typeof r=="string"&&(e&&(r=`\x1B[${U8(e)}m${r}\x1B[39m`),t&&(r=`\x1B[${U8(t)+zAe}m${r}\x1B[49m`)),r}function VAe(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const t=Object.getPrototypeOf(r),n=Object.getOwnPropertyNames(t),i=r;for(const s of n){const a=i[s];typeof a=="function"&&(e.find(o=>s===o)||(i[s]=a.bind(r)))}}function eM(r,e){if(!r)throw new Error("Assertion failed")}function Y_(){var e,t,n;let r;if(Y3()&&Kw.performance)r=(t=(e=Kw==null?void 0:Kw.performance)==null?void 0:e.now)==null?void 0:t.call(e);else if("hrtime"in Z_){const i=(n=Z_==null?void 0:Z_.hrtime)==null?void 0:n.call(Z_);r=i[0]*1e3+i[1]/1e6}else r=Date.now();return r}const e0={debug:Y3()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},GAe={enabled:!0,level:0};function t0(){}const N8={},z8={once:!0};class H8{constructor(){let{id:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};this.VERSION=k8,this._startTs=Y_(),this._deltaTs=Y_(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new kAe(`__probe-${this.id}__`,GAe),this.timeStamp(`${this.id} started`),VAe(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Y_()-this._startTs).toPrecision(10))}getDelta(){return Number((Y_()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){if(!e)throw new Error(t||"Assertion failed")}warn(e){return this._getLogFunction(0,e,e0.warn,arguments,z8)}error(e){return this._getLogFunction(0,e,e0.error,arguments)}deprecated(e,t){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${t}\` instead`)}removed(e,t){return this.error(`\`${e}\` has been removed. Use \`${t}\` instead`)}probe(e,t){return this._getLogFunction(e,t,e0.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,e0.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){return this._getLogFunction(e,t,e0.debug||e0.info,arguments,z8)}table(e,t,n){return t?this._getLogFunction(e,t,console.table||t0,n&&[n],{tag:$Ae(t)}):t0}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||t0)}group(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const i=G8({logLevel:e,message:t,opts:n}),{collapsed:s}=n;return i.method=(s?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(e,t,Object.assign({},n,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||t0)}withGroup(e,t,n){this.group(e,t)();try{n()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=V8(e)}_getLogFunction(e,t,n,i,s){if(this._shouldLog(e)){s=G8({logLevel:e,message:t,args:i,opts:s}),n=n||s.method,eM(n),s.total=this.getTotal(),s.delta=this.getDelta(),this._deltaTs=Y_();const a=s.tag||s.message;if(s.once&&a)if(!N8[a])N8[a]=Y_();else return t0;return t=QAe(this.id,s.message,s),n.bind(console,t,...s.args)}return t0}}H8.VERSION=k8;function V8(r){if(!r)return 0;let e;switch(typeof r){case"number":e=r;break;case"object":e=r.logLevel||r.priority||0;break;default:return 0}return eM(Number.isFinite(e)&&e>=0),e}function G8(r){const{logLevel:e,message:t}=r;r.logLevel=V8(e);const n=r.args?Array.from(r.args):[];for(;n.length&&n.shift()!==t;);switch(typeof e){case"string":case"function":t!==void 0&&n.unshift(t),r.message=e;break;case"object":Object.assign(r,e);break}typeof r.message=="function"&&(r.message=r.message());const i=typeof r.message;return eM(i==="string"||i==="object"),Object.assign(r,{args:n},r.opts)}function QAe(r,e,t){if(typeof e=="string"){const n=t.time?NAe(UAe(t.total)):"";e=t.time?`${r}: ${n}  ${e}`:`${r}: ${e}`,e=HAe(e,t.color,t.background)}return e}function $Ae(r){for(const e in r)for(const t in r[e])return t||"untitled";return"empty"}globalThis.probe={};const Q8=new H8({id:"@probe.gl/log"});function jAe(r){var e;globalThis.loaders||(globalThis.loaders={}),(e=globalThis.loaders).modules||(e.modules={}),Object.assign(globalThis.loaders.modules,r)}function qAe(r){var t,n;return((n=(t=globalThis.loaders)==null?void 0:t.modules)==null?void 0:n[r])||null}function KAe(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof r=="string"?r.slice(0,e):ArrayBuffer.isView(r)?$8(r.buffer,r.byteOffset,e):r instanceof ArrayBuffer?$8(r,0,e):""}function $8(r,e,t){if(r.byteLength<=e+t)return"";const n=new DataView(r);let i="";for(let s=0;s<t;s++)i+=String.fromCharCode(n.getUint8(e+s));return i}function WAe(r){try{return JSON.parse(r)}catch{throw new Error(`Failed to parse JSON from data starting with "${KAe(r)}"`)}}function tM(r,e,t){const n=t!==void 0?new Uint8Array(r).subarray(e,e+t):new Uint8Array(r).subarray(e);return new Uint8Array(n).buffer}function U1(r,e){return Po(r>=0),Po(e>0),r+(e-1)&~(e-1)}function XAe(r,e,t){let n;if(r instanceof ArrayBuffer)n=new Uint8Array(r);else{const i=r.byteOffset,s=r.byteLength;n=new Uint8Array(r.buffer||r.arrayBuffer,i,s)}return e.set(n,t),t+U1(n.byteLength,4)}function j8(){let r;if(typeof window<"u"&&window.performance)r=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();r=e[0]*1e3+e[1]/1e6}else r=Date.now();return r}class q8{constructor(e,t){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=j8(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(j8()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class K8{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const t of Object.values(this.stats))e(t)}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(t=>this._getOrCreate(t))}_getOrCreate(e){const{name:t,type:n}=e;let i=this.stats[t];return i||(e instanceof q8?i=e:i=new q8(t,n),this.stats[t]=i),i}}const JAe="Queued Requests",ZAe="Active Requests",YAe="Cancelled Requests",epe="Queued Requests Ever",tpe="Active Requests Ever",rpe={id:"request-scheduler",throttleRequests:!0,maxRequests:6,debounceTime:0};class npe{constructor(){xe(this,"props");xe(this,"stats");xe(this,"activeRequestCount",0);xe(this,"requestQueue",[]);xe(this,"requestMap",new Map);xe(this,"updateTimer",null);let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.props={...rpe,...e},this.stats=new K8({id:this.props.id}),this.stats.get(JAe),this.stats.get(ZAe),this.stats.get(YAe),this.stats.get(epe),this.stats.get(tpe)}scheduleRequest(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:()=>0;if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(e))return this.requestMap.get(e);const n={handle:e,priority:0,getPriority:t},i=new Promise(s=>(n.resolve=s,n));return this.requestQueue.push(n),this.requestMap.set(e,i),this._issueNewRequests(),i}_issueRequest(e){const{handle:t,resolve:n}=e;let i=!1;const s=()=>{i||(i=!0,this.requestMap.delete(t),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,n?n({done:s}):Promise.resolve({done:s})}_issueNewRequests(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=setTimeout(()=>this._issueNewRequestsAsync(),this.props.debounceTime)}_issueNewRequestsAsync(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=null;const e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(e!==0){this._updateAllRequests();for(let t=0;t<e;++t){const n=this.requestQueue.shift();n&&this._issueRequest(n)}}}_updateAllRequests(){const e=this.requestQueue;for(let t=0;t<e.length;++t){const n=e[t];this._updateRequest(n)||(e.splice(t,1),this.requestMap.delete(n.handle),t--)}e.sort((t,n)=>t.priority-n.priority)}_updateRequest(e){return e.priority=e.getPriority(e.handle),e.priority<0?(e.resolve(null),!1):!0}}function ipe(){var e;if(typeof process<"u"&&typeof process.cwd<"u")return process.cwd();const r=(e=window.location)==null?void 0:e.pathname;return(r==null?void 0:r.slice(0,r.lastIndexOf("/")+1))||""}function W8(r){const e=r?r.lastIndexOf("/"):-1;return e>=0?r.substr(0,e):""}function spe(){const r=[];for(let i=0;i<arguments.length;i++)r[i]=i<0||arguments.length<=i?void 0:arguments[i];let e="",t=!1,n;for(let i=r.length-1;i>=-1&&!t;i--){let s;i>=0?s=r[i]:(n===void 0&&(n=ipe()),s=n),s.length!==0&&(e=`${s}/${e}`,t=s.charCodeAt(0)===N1)}return e=ope(e,!t),t?`/${e}`:e.length>0?e:"."}const N1=47,rM=46;function ope(r,e){let t="",n=-1,i=0,s,a=!1;for(let o=0;o<=r.length;++o){if(o<r.length)s=r.charCodeAt(o);else{if(s===N1)break;s=N1}if(s===N1){if(!(n===o-1||i===1))if(n!==o-1&&i===2){if(t.length<2||!a||t.charCodeAt(t.length-1)!==rM||t.charCodeAt(t.length-2)!==rM){if(t.length>2){const h=t.length-1;let f=h;for(;f>=0&&t.charCodeAt(f)!==N1;--f);if(f!==h){t=f===-1?"":t.slice(0,f),n=o,i=0,a=!1;continue}}else if(t.length===2||t.length===1){t="",n=o,i=0,a=!1;continue}}e&&(t.length>0?t+="/..":t="..",a=!0)}else{const h=r.slice(n+1,o);t.length>0?t+=`/${h}`:t=h,a=!1}n=o,i=0}else s===rM&&i!==-1?++i:i=-1}return t}const ape=1/Math.PI*180,lpe=1/180*Math.PI,cpe={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...cpe}};const Fl=globalThis.mathgl.config;function upe(r){let{precision:e=Fl.precision}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return r=ppe(r),`${parseFloat(r.toPrecision(e))}`}function zg(r){return Array.isArray(r)||ArrayBuffer.isView(r)&&!(r instanceof DataView)}function hpe(r){return fpe(r)}function dpe(r){return Vd(r)}function fpe(r,e){return nM(r,t=>t*lpe,e)}function Vd(r,e){return nM(r,t=>t*ape,e)}function Ape(r,e,t){return nM(r,n=>Math.max(e,Math.min(t,n)))}function gp(r,e,t){const n=Fl.EPSILON;t&&(Fl.EPSILON=t);try{if(r===e)return!0;if(zg(r)&&zg(e)){if(r.length!==e.length)return!1;for(let i=0;i<r.length;++i)if(!gp(r[i],e[i]))return!1;return!0}return r&&r.equals?r.equals(e):e&&e.equals?e.equals(r):typeof r=="number"&&typeof e=="number"?Math.abs(r-e)<=Fl.EPSILON*Math.max(1,Math.abs(r),Math.abs(e)):!1}finally{Fl.EPSILON=n}}function ppe(r){return Math.round(r/Fl.EPSILON)*Fl.EPSILON}function gpe(r){return r.clone?r.clone():new Array(r.length)}function nM(r,e,t){if(zg(r)){const n=r;t=t||gpe(n);for(let i=0;i<t.length&&i<n.length;++i){const s=typeof r=="number"?r:r[i];t[i]=e(s,i,t)}return t}return e(r)}let iM=class extends Array{clone(){return new this.constructor().copy(this)}fromArray(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;for(let n=0;n<this.ELEMENTS;++n)this[n]=e[n+t];return this.check()}toArray(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;for(let n=0;n<this.ELEMENTS;++n)e[t+n]=this[n];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:zg(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(Fl)}formatString(e){let t="";for(let n=0;n<this.ELEMENTS;++n)t+=(n>0?", ":"")+upe(this[n],e);return`${e.printTypes?this.constructor.name:""}[${t}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(!gp(this[t],e[t]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(this[t]!==e[t])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,t,n){if(n===void 0)return this.lerp(this,e,t);for(let i=0;i<this.ELEMENTS;++i){const s=e[i],a=typeof t=="number"?t:t[i];this[i]=s+n*(a-s)}return this.check()}min(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}max(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}clamp(e,t){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e[n]),t[n]);return this.check()}add(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(const i of t)for(let s=0;s<this.ELEMENTS;++s)this[s]+=i[s];return this.check()}subtract(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(const i of t)for(let s=0;s<this.ELEMENTS;++s)this[s]-=i[s];return this.check()}scale(e){if(typeof e=="number")for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;else for(let t=0;t<this.ELEMENTS&&t<e.length;++t)this[t]*=e[t];return this.check()}multiplyByScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}check(){if(Fl.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let t=0;t<this.ELEMENTS;++t)e=e&&Number.isFinite(this[t]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}addScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,t){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e),t);return this.check()}get elements(){return this}};function mpe(r,e){if(r.length!==e)return!1;for(let t=0;t<r.length;++t)if(!Number.isFinite(r[t]))return!1;return!0}function Ds(r){if(!Number.isFinite(r))throw new Error(`Invalid number ${JSON.stringify(r)}`);return r}function z1(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";if(Fl.debug&&!mpe(r,e))throw new Error(`math.gl: ${t} some fields set to invalid numbers'`);return r}function Gd(r,e){if(!r)throw new Error(`math.gl assertion ${e}`)}let sM=class extends iM{get x(){return this[0]}set x(e){this[0]=Ds(e)}get y(){return this[1]}set y(e){this[1]=Ds(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let t=0;for(let n=0;n<this.ELEMENTS;++n){const i=this[n]-e[n];t+=i*i}return Ds(t)}dot(e){let t=0;for(let n=0;n<this.ELEMENTS;++n)t+=this[n]*e[n];return Ds(t)}normalize(){const e=this.magnitude();if(e!==0)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}multiply(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(const i of t)for(let s=0;s<this.ELEMENTS;++s)this[s]*=i[s];return this.check()}divide(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(const i of t)for(let s=0;s<this.ELEMENTS;++s)this[s]/=i[s];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return Gd(e>=0&&e<this.ELEMENTS,"index is out of range"),Ds(this[e])}setComponent(e,t){return Gd(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=t,this.check()}addVectors(e,t){return this.copy(e).add(t)}subVectors(e,t){return this.copy(e).subtract(t)}multiplyVectors(e,t){return this.copy(e).multiply(t)}addScaledVector(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}};const H1=1e-6;let Qd=typeof Float32Array<"u"?Float32Array:Array;function _pe(){const r=new Qd(2);return Qd!=Float32Array&&(r[0]=0,r[1]=0),r}function ype(r,e,t){const n=e[0],i=e[1];return r[0]=t[0]*n+t[2]*i,r[1]=t[1]*n+t[3]*i,r}function bpe(r,e,t){const n=e[0],i=e[1];return r[0]=t[0]*n+t[2]*i+t[4],r[1]=t[1]*n+t[3]*i+t[5],r}function X8(r,e,t){const n=e[0],i=e[1];return r[0]=t[0]*n+t[3]*i+t[6],r[1]=t[1]*n+t[4]*i+t[7],r}function J8(r,e,t){const n=e[0],i=e[1];return r[0]=t[0]*n+t[4]*i+t[12],r[1]=t[1]*n+t[5]*i+t[13],r}(function(){const r=_pe();return function(e,t,n,i,s,a){let o,h;for(t||(t=2),n||(n=0),i?h=Math.min(i*t+n,e.length):h=e.length,o=n;o<h;o+=t)r[0]=e[o],r[1]=e[o+1],s(r,r,a),e[o]=r[0],e[o+1]=r[1];return e}})();function Z8(r,e,t){const n=e[0],i=e[1],s=t[3]*n+t[7]*i||1;return r[0]=(t[0]*n+t[4]*i)/s,r[1]=(t[1]*n+t[5]*i)/s,r}function Y8(r,e,t){const n=e[0],i=e[1],s=e[2],a=t[3]*n+t[7]*i+t[11]*s||1;return r[0]=(t[0]*n+t[4]*i+t[8]*s)/a,r[1]=(t[1]*n+t[5]*i+t[9]*s)/a,r[2]=(t[2]*n+t[6]*i+t[10]*s)/a,r}function vpe(r,e,t){const n=e[0],i=e[1];return r[0]=t[0]*n+t[2]*i,r[1]=t[1]*n+t[3]*i,r[2]=e[2],r}function xpe(r,e,t){const n=e[0],i=e[1];return r[0]=t[0]*n+t[2]*i,r[1]=t[1]*n+t[3]*i,r[2]=e[2],r[3]=e[3],r}function ez(r,e,t){const n=e[0],i=e[1],s=e[2];return r[0]=t[0]*n+t[3]*i+t[6]*s,r[1]=t[1]*n+t[4]*i+t[7]*s,r[2]=t[2]*n+t[5]*i+t[8]*s,r[3]=e[3],r}let oM=class extends sM{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;super(2),zg(e)&&arguments.length===1?this.copy(e):(Fl.debug&&(Ds(e),Ds(t)),this[0]=e,this[1]=t)}set(e,t){return this[0]=e,this[1]=t,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this.check()}fromObject(e){return Fl.debug&&(Ds(e.x),Ds(e.y)),this[0]=e.x,this[1]=e.y,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return J8(this,this,e),this.check()}transformAsVector(e){return Z8(this,this,e),this.check()}transformByMatrix3(e){return X8(this,this,e),this.check()}transformByMatrix2x3(e){return bpe(this,this,e),this.check()}transformByMatrix2(e){return ype(this,this,e),this.check()}};function tz(){const r=new Qd(3);return Qd!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function rz(r){const e=r[0],t=r[1],n=r[2];return Math.sqrt(e*e+t*t+n*n)}function nz(r,e,t){const n=new Qd(3);return n[0]=r,n[1]=e,n[2]=t,n}function wpe(r,e){const t=e[0],n=e[1],i=e[2];let s=t*t+n*n+i*i;return s>0&&(s=1/Math.sqrt(s)),r[0]=e[0]*s,r[1]=e[1]*s,r[2]=e[2]*s,r}function aM(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]}function Xw(r,e,t){const n=e[0],i=e[1],s=e[2],a=t[0],o=t[1],h=t[2];return r[0]=i*h-s*o,r[1]=s*a-n*h,r[2]=n*o-i*a,r}function lM(r,e,t){const n=e[0],i=e[1],s=e[2];let a=t[3]*n+t[7]*i+t[11]*s+t[15];return a=a||1,r[0]=(t[0]*n+t[4]*i+t[8]*s+t[12])/a,r[1]=(t[1]*n+t[5]*i+t[9]*s+t[13])/a,r[2]=(t[2]*n+t[6]*i+t[10]*s+t[14])/a,r}function iz(r,e,t){const n=e[0],i=e[1],s=e[2];return r[0]=n*t[0]+i*t[3]+s*t[6],r[1]=n*t[1]+i*t[4]+s*t[7],r[2]=n*t[2]+i*t[5]+s*t[8],r}function sz(r,e,t){const n=t[0],i=t[1],s=t[2],a=t[3],o=e[0],h=e[1],f=e[2];let _=i*f-s*h,x=s*o-n*f,T=n*h-i*o,I=i*T-s*x,N=s*_-n*T,$=n*x-i*_;const W=a*2;return _*=W,x*=W,T*=W,I*=2,N*=2,$*=2,r[0]=o+_+I,r[1]=h+x+N,r[2]=f+T+$,r}function Bpe(r,e,t,n){const i=[],s=[];return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],s[0]=i[0],s[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),s[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),r[0]=s[0]+t[0],r[1]=s[1]+t[1],r[2]=s[2]+t[2],r}function Cpe(r,e,t,n){const i=[],s=[];return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],s[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),s[1]=i[1],s[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),r[0]=s[0]+t[0],r[1]=s[1]+t[1],r[2]=s[2]+t[2],r}function Epe(r,e,t,n){const i=[],s=[];return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],s[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),s[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),s[2]=i[2],r[0]=s[0]+t[0],r[1]=s[1]+t[1],r[2]=s[2]+t[2],r}function Tpe(r,e){const t=r[0],n=r[1],i=r[2],s=e[0],a=e[1],o=e[2],h=Math.sqrt((t*t+n*n+i*i)*(s*s+a*a+o*o)),f=h&&aM(r,e)/h;return Math.acos(Math.min(Math.max(f,-1),1))}const Spe=rz;(function(){const r=tz();return function(e,t,n,i,s,a){let o,h;for(t||(t=3),n||(n=0),i?h=Math.min(i*t+n,e.length):h=e.length,o=n;o<h;o+=t)r[0]=e[o],r[1]=e[o+1],r[2]=e[o+2],s(r,r,a),e[o]=r[0],e[o+1]=r[1],e[o+2]=r[2];return e}})();const cM=[0,0,0];let Jw,yr=class LZ extends sM{static get ZERO(){return Jw||(Jw=new LZ(0,0,0),Object.freeze(Jw)),Jw}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;super(-0,-0,-0),arguments.length===1&&zg(e)?this.copy(e):(Fl.debug&&(Ds(e),Ds(t),Ds(n)),this[0]=e,this[1]=t,this[2]=n)}set(e,t,n){return this[0]=e,this[1]=t,this[2]=n,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return Fl.debug&&(Ds(e.x),Ds(e.y),Ds(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=Ds(e)}angle(e){return Tpe(this,e)}cross(e){return Xw(this,this,e),this.check()}rotateX(e){let{radians:t,origin:n=cM}=e;return Bpe(this,this,n,t),this.check()}rotateY(e){let{radians:t,origin:n=cM}=e;return Cpe(this,this,n,t),this.check()}rotateZ(e){let{radians:t,origin:n=cM}=e;return Epe(this,this,n,t),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return lM(this,this,e),this.check()}transformAsVector(e){return Y8(this,this,e),this.check()}transformByMatrix3(e){return iz(this,this,e),this.check()}transformByMatrix2(e){return vpe(this,this,e),this.check()}transformByQuaternion(e){return sz(this,this,e),this.check()}},Zw,Ipe=class DZ extends sM{static get ZERO(){return Zw||(Zw=new DZ(0,0,0,0),Object.freeze(Zw)),Zw}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;super(-0,-0,-0,-0),zg(e)&&arguments.length===1?this.copy(e):(Fl.debug&&(Ds(e),Ds(t),Ds(n),Ds(i)),this[0]=e,this[1]=t,this[2]=n,this[3]=i)}set(e,t,n,i){return this[0]=e,this[1]=t,this[2]=n,this[3]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}fromObject(e){return Fl.debug&&(Ds(e.x),Ds(e.y),Ds(e.z),Ds(e.w)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e.w=this[3],e}get ELEMENTS(){return 4}get z(){return this[2]}set z(e){this[2]=Ds(e)}get w(){return this[3]}set w(e){this[3]=Ds(e)}transform(e){return lM(this,this,e),this.check()}transformByMatrix3(e){return ez(this,this,e),this.check()}transformByMatrix2(e){return xpe(this,this,e),this.check()}transformByQuaternion(e){return sz(this,this,e),this.check()}applyMatrix4(e){return e.transform(this,this),this}},oz=class extends iM{toString(){let e="[";if(Fl.printRowMajor){e+="row-major:";for(let t=0;t<this.RANK;++t)for(let n=0;n<this.RANK;++n)e+=` ${this[n*this.RANK+t]}`}else{e+="column-major:";for(let t=0;t<this.ELEMENTS;++t)e+=` ${this[t]}`}return e+="]",e}getElementIndex(e,t){return t*this.RANK+e}getElement(e,t){return this[t*this.RANK+e]}setElement(e,t,n){return this[t*this.RANK+e]=Ds(n),this}getColumn(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Array(this.RANK).fill(-0);const n=e*this.RANK;for(let i=0;i<this.RANK;++i)t[i]=this[n+i];return t}setColumn(e,t){const n=e*this.RANK;for(let i=0;i<this.RANK;++i)this[n+i]=t[i];return this}};function Mpe(){const r=new Qd(9);return Qd!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r}function Ppe(r,e){if(r===e){const t=e[1],n=e[2],i=e[5];r[1]=e[3],r[2]=e[6],r[3]=t,r[5]=e[7],r[6]=n,r[7]=i}else r[0]=e[0],r[1]=e[3],r[2]=e[6],r[3]=e[1],r[4]=e[4],r[5]=e[7],r[6]=e[2],r[7]=e[5],r[8]=e[8];return r}function Fpe(r,e){const t=e[0],n=e[1],i=e[2],s=e[3],a=e[4],o=e[5],h=e[6],f=e[7],_=e[8],x=_*a-o*f,T=-_*s+o*h,I=f*s-a*h;let N=t*x+n*T+i*I;return N?(N=1/N,r[0]=x*N,r[1]=(-_*n+i*f)*N,r[2]=(o*n-i*a)*N,r[3]=T*N,r[4]=(_*t-i*h)*N,r[5]=(-o*t+i*s)*N,r[6]=I*N,r[7]=(-f*t+n*h)*N,r[8]=(a*t-n*s)*N,r):null}function Rpe(r){const e=r[0],t=r[1],n=r[2],i=r[3],s=r[4],a=r[5],o=r[6],h=r[7],f=r[8];return e*(f*s-a*h)+t*(-f*i+a*o)+n*(h*i-s*o)}function az(r,e,t){const n=e[0],i=e[1],s=e[2],a=e[3],o=e[4],h=e[5],f=e[6],_=e[7],x=e[8],T=t[0],I=t[1],N=t[2],$=t[3],W=t[4],Y=t[5],ie=t[6],ce=t[7],fe=t[8];return r[0]=T*n+I*a+N*f,r[1]=T*i+I*o+N*_,r[2]=T*s+I*h+N*x,r[3]=$*n+W*a+Y*f,r[4]=$*i+W*o+Y*_,r[5]=$*s+W*h+Y*x,r[6]=ie*n+ce*a+fe*f,r[7]=ie*i+ce*o+fe*_,r[8]=ie*s+ce*h+fe*x,r}function Lpe(r,e,t){const n=e[0],i=e[1],s=e[2],a=e[3],o=e[4],h=e[5],f=e[6],_=e[7],x=e[8],T=t[0],I=t[1];return r[0]=n,r[1]=i,r[2]=s,r[3]=a,r[4]=o,r[5]=h,r[6]=T*n+I*a+f,r[7]=T*i+I*o+_,r[8]=T*s+I*h+x,r}function Dpe(r,e,t){const n=e[0],i=e[1],s=e[2],a=e[3],o=e[4],h=e[5],f=e[6],_=e[7],x=e[8],T=Math.sin(t),I=Math.cos(t);return r[0]=I*n+T*a,r[1]=I*i+T*o,r[2]=I*s+T*h,r[3]=I*a-T*n,r[4]=I*o-T*i,r[5]=I*h-T*s,r[6]=f,r[7]=_,r[8]=x,r}function lz(r,e,t){const n=t[0],i=t[1];return r[0]=n*e[0],r[1]=n*e[1],r[2]=n*e[2],r[3]=i*e[3],r[4]=i*e[4],r[5]=i*e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r}function Ope(r,e){const t=e[0],n=e[1],i=e[2],s=e[3],a=t+t,o=n+n,h=i+i,f=t*a,_=n*a,x=n*o,T=i*a,I=i*o,N=i*h,$=s*a,W=s*o,Y=s*h;return r[0]=1-x-N,r[3]=_-Y,r[6]=T+W,r[1]=_+Y,r[4]=1-f-N,r[7]=I-$,r[2]=T-W,r[5]=I+$,r[8]=1-f-x,r}var uM;(function(r){r[r.COL0ROW0=0]="COL0ROW0",r[r.COL0ROW1=1]="COL0ROW1",r[r.COL0ROW2=2]="COL0ROW2",r[r.COL1ROW0=3]="COL1ROW0",r[r.COL1ROW1=4]="COL1ROW1",r[r.COL1ROW2=5]="COL1ROW2",r[r.COL2ROW0=6]="COL2ROW0",r[r.COL2ROW1=7]="COL2ROW1",r[r.COL2ROW2=8]="COL2ROW2"})(uM||(uM={}));const kpe=Object.freeze([1,0,0,0,1,0,0,0,1]);let ma=class extends oz{static get IDENTITY(){return Npe()}static get ZERO(){return Upe()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return uM}constructor(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):n.length>0?this.copy([e,...n]):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}identity(){return this.copy(kpe)}fromObject(e){return this.check()}fromQuaternion(e){return Ope(this,e),this.check()}set(e,t,n,i,s,a,o,h,f){return this[0]=e,this[1]=t,this[2]=n,this[3]=i,this[4]=s,this[5]=a,this[6]=o,this[7]=h,this[8]=f,this.check()}setRowMajor(e,t,n,i,s,a,o,h,f){return this[0]=e,this[1]=i,this[2]=o,this[3]=t,this[4]=s,this[5]=h,this[6]=n,this[7]=a,this[8]=f,this.check()}determinant(){return Rpe(this)}transpose(){return Ppe(this,this),this.check()}invert(){return Fpe(this,this),this.check()}multiplyLeft(e){return az(this,e,this),this.check()}multiplyRight(e){return az(this,this,e),this.check()}rotate(e){return Dpe(this,this,e),this.check()}scale(e){return Array.isArray(e)?lz(this,this,e):lz(this,this,[e,e]),this.check()}translate(e){return Lpe(this,this,e),this.check()}transform(e,t){let n;switch(e.length){case 2:n=X8(t||[-0,-0],e,this);break;case 3:n=iz(t||[-0,-0,-0],e,this);break;case 4:n=ez(t||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return z1(n,e.length),n}transformVector(e,t){return this.transform(e,t)}transformVector2(e,t){return this.transform(e,t)}transformVector3(e,t){return this.transform(e,t)}},Yw,e2=null;function Upe(){return Yw||(Yw=new ma([0,0,0,0,0,0,0,0,0]),Object.freeze(Yw)),Yw}function Npe(){return e2||(e2=new ma,Object.freeze(e2)),e2}function zpe(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Hpe(r,e){if(r===e){const t=e[1],n=e[2],i=e[3],s=e[6],a=e[7],o=e[11];r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=t,r[6]=e[9],r[7]=e[13],r[8]=n,r[9]=s,r[11]=e[14],r[12]=i,r[13]=a,r[14]=o}else r[0]=e[0],r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=e[1],r[5]=e[5],r[6]=e[9],r[7]=e[13],r[8]=e[2],r[9]=e[6],r[10]=e[10],r[11]=e[14],r[12]=e[3],r[13]=e[7],r[14]=e[11],r[15]=e[15];return r}function Vpe(r,e){const t=e[0],n=e[1],i=e[2],s=e[3],a=e[4],o=e[5],h=e[6],f=e[7],_=e[8],x=e[9],T=e[10],I=e[11],N=e[12],$=e[13],W=e[14],Y=e[15],ie=t*o-n*a,ce=t*h-i*a,fe=t*f-s*a,ve=n*h-i*o,be=n*f-s*o,Qe=i*f-s*h,Ue=_*$-x*N,st=_*W-T*N,at=_*Y-I*N,Le=x*W-T*$,ze=x*Y-I*$,tt=T*Y-I*W;let Ne=ie*tt-ce*ze+fe*Le+ve*at-be*st+Qe*Ue;return Ne?(Ne=1/Ne,r[0]=(o*tt-h*ze+f*Le)*Ne,r[1]=(i*ze-n*tt-s*Le)*Ne,r[2]=($*Qe-W*be+Y*ve)*Ne,r[3]=(T*be-x*Qe-I*ve)*Ne,r[4]=(h*at-a*tt-f*st)*Ne,r[5]=(t*tt-i*at+s*st)*Ne,r[6]=(W*fe-N*Qe-Y*ce)*Ne,r[7]=(_*Qe-T*fe+I*ce)*Ne,r[8]=(a*ze-o*at+f*Ue)*Ne,r[9]=(n*at-t*ze-s*Ue)*Ne,r[10]=(N*be-$*fe+Y*ie)*Ne,r[11]=(x*fe-_*be-I*ie)*Ne,r[12]=(o*st-a*Le-h*Ue)*Ne,r[13]=(t*Le-n*st+i*Ue)*Ne,r[14]=($*ce-N*ve-W*ie)*Ne,r[15]=(_*ve-x*ce+T*ie)*Ne,r):null}function Gpe(r){const e=r[0],t=r[1],n=r[2],i=r[3],s=r[4],a=r[5],o=r[6],h=r[7],f=r[8],_=r[9],x=r[10],T=r[11],I=r[12],N=r[13],$=r[14],W=r[15],Y=e*a-t*s,ie=e*o-n*s,ce=t*o-n*a,fe=f*N-_*I,ve=f*$-x*I,be=_*$-x*N,Qe=e*be-t*ve+n*fe,Ue=s*be-a*ve+o*fe,st=f*ce-_*ie+x*Y,at=I*ce-N*ie+$*Y;return h*Qe-i*Ue+W*st-T*at}function cz(r,e,t){const n=e[0],i=e[1],s=e[2],a=e[3],o=e[4],h=e[5],f=e[6],_=e[7],x=e[8],T=e[9],I=e[10],N=e[11],$=e[12],W=e[13],Y=e[14],ie=e[15];let ce=t[0],fe=t[1],ve=t[2],be=t[3];return r[0]=ce*n+fe*o+ve*x+be*$,r[1]=ce*i+fe*h+ve*T+be*W,r[2]=ce*s+fe*f+ve*I+be*Y,r[3]=ce*a+fe*_+ve*N+be*ie,ce=t[4],fe=t[5],ve=t[6],be=t[7],r[4]=ce*n+fe*o+ve*x+be*$,r[5]=ce*i+fe*h+ve*T+be*W,r[6]=ce*s+fe*f+ve*I+be*Y,r[7]=ce*a+fe*_+ve*N+be*ie,ce=t[8],fe=t[9],ve=t[10],be=t[11],r[8]=ce*n+fe*o+ve*x+be*$,r[9]=ce*i+fe*h+ve*T+be*W,r[10]=ce*s+fe*f+ve*I+be*Y,r[11]=ce*a+fe*_+ve*N+be*ie,ce=t[12],fe=t[13],ve=t[14],be=t[15],r[12]=ce*n+fe*o+ve*x+be*$,r[13]=ce*i+fe*h+ve*T+be*W,r[14]=ce*s+fe*f+ve*I+be*Y,r[15]=ce*a+fe*_+ve*N+be*ie,r}function Qpe(r,e,t){const n=t[0],i=t[1],s=t[2];let a,o,h,f,_,x,T,I,N,$,W,Y;return e===r?(r[12]=e[0]*n+e[4]*i+e[8]*s+e[12],r[13]=e[1]*n+e[5]*i+e[9]*s+e[13],r[14]=e[2]*n+e[6]*i+e[10]*s+e[14],r[15]=e[3]*n+e[7]*i+e[11]*s+e[15]):(a=e[0],o=e[1],h=e[2],f=e[3],_=e[4],x=e[5],T=e[6],I=e[7],N=e[8],$=e[9],W=e[10],Y=e[11],r[0]=a,r[1]=o,r[2]=h,r[3]=f,r[4]=_,r[5]=x,r[6]=T,r[7]=I,r[8]=N,r[9]=$,r[10]=W,r[11]=Y,r[12]=a*n+_*i+N*s+e[12],r[13]=o*n+x*i+$*s+e[13],r[14]=h*n+T*i+W*s+e[14],r[15]=f*n+I*i+Y*s+e[15]),r}function $pe(r,e,t){const n=t[0],i=t[1],s=t[2];return r[0]=e[0]*n,r[1]=e[1]*n,r[2]=e[2]*n,r[3]=e[3]*n,r[4]=e[4]*i,r[5]=e[5]*i,r[6]=e[6]*i,r[7]=e[7]*i,r[8]=e[8]*s,r[9]=e[9]*s,r[10]=e[10]*s,r[11]=e[11]*s,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function jpe(r,e,t,n){let i=n[0],s=n[1],a=n[2],o=Math.sqrt(i*i+s*s+a*a),h,f,_,x,T,I,N,$,W,Y,ie,ce,fe,ve,be,Qe,Ue,st,at,Le,ze,tt,Ne,Ht;return o<H1?null:(o=1/o,i*=o,s*=o,a*=o,f=Math.sin(t),h=Math.cos(t),_=1-h,x=e[0],T=e[1],I=e[2],N=e[3],$=e[4],W=e[5],Y=e[6],ie=e[7],ce=e[8],fe=e[9],ve=e[10],be=e[11],Qe=i*i*_+h,Ue=s*i*_+a*f,st=a*i*_-s*f,at=i*s*_-a*f,Le=s*s*_+h,ze=a*s*_+i*f,tt=i*a*_+s*f,Ne=s*a*_-i*f,Ht=a*a*_+h,r[0]=x*Qe+$*Ue+ce*st,r[1]=T*Qe+W*Ue+fe*st,r[2]=I*Qe+Y*Ue+ve*st,r[3]=N*Qe+ie*Ue+be*st,r[4]=x*at+$*Le+ce*ze,r[5]=T*at+W*Le+fe*ze,r[6]=I*at+Y*Le+ve*ze,r[7]=N*at+ie*Le+be*ze,r[8]=x*tt+$*Ne+ce*Ht,r[9]=T*tt+W*Ne+fe*Ht,r[10]=I*tt+Y*Ne+ve*Ht,r[11]=N*tt+ie*Ne+be*Ht,e!==r&&(r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r)}function qpe(r,e,t){const n=Math.sin(t),i=Math.cos(t),s=e[4],a=e[5],o=e[6],h=e[7],f=e[8],_=e[9],x=e[10],T=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=s*i+f*n,r[5]=a*i+_*n,r[6]=o*i+x*n,r[7]=h*i+T*n,r[8]=f*i-s*n,r[9]=_*i-a*n,r[10]=x*i-o*n,r[11]=T*i-h*n,r}function Kpe(r,e,t){const n=Math.sin(t),i=Math.cos(t),s=e[0],a=e[1],o=e[2],h=e[3],f=e[8],_=e[9],x=e[10],T=e[11];return e!==r&&(r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=s*i-f*n,r[1]=a*i-_*n,r[2]=o*i-x*n,r[3]=h*i-T*n,r[8]=s*n+f*i,r[9]=a*n+_*i,r[10]=o*n+x*i,r[11]=h*n+T*i,r}function Wpe(r,e,t){const n=Math.sin(t),i=Math.cos(t),s=e[0],a=e[1],o=e[2],h=e[3],f=e[4],_=e[5],x=e[6],T=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=s*i+f*n,r[1]=a*i+_*n,r[2]=o*i+x*n,r[3]=h*i+T*n,r[4]=f*i-s*n,r[5]=_*i-a*n,r[6]=x*i-o*n,r[7]=T*i-h*n,r}function Xpe(r,e){const t=e[0],n=e[1],i=e[2],s=e[4],a=e[5],o=e[6],h=e[8],f=e[9],_=e[10];return r[0]=Math.sqrt(t*t+n*n+i*i),r[1]=Math.sqrt(s*s+a*a+o*o),r[2]=Math.sqrt(h*h+f*f+_*_),r}function Jpe(r,e){const t=e[0],n=e[1],i=e[2],s=e[3],a=t+t,o=n+n,h=i+i,f=t*a,_=n*a,x=n*o,T=i*a,I=i*o,N=i*h,$=s*a,W=s*o,Y=s*h;return r[0]=1-x-N,r[1]=_+Y,r[2]=T-W,r[3]=0,r[4]=_-Y,r[5]=1-f-N,r[6]=I+$,r[7]=0,r[8]=T+W,r[9]=I-$,r[10]=1-f-x,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Zpe(r,e,t,n,i,s,a){const o=1/(t-e),h=1/(i-n),f=1/(s-a);return r[0]=s*2*o,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=s*2*h,r[6]=0,r[7]=0,r[8]=(t+e)*o,r[9]=(i+n)*h,r[10]=(a+s)*f,r[11]=-1,r[12]=0,r[13]=0,r[14]=a*s*2*f,r[15]=0,r}function Ype(r,e,t,n,i){const s=1/Math.tan(e/2);if(r[0]=s/t,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=s,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,i!=null&&i!==1/0){const a=1/(n-i);r[10]=(i+n)*a,r[14]=2*i*n*a}else r[10]=-1,r[14]=-2*n;return r}const ege=Ype;function tge(r,e,t,n,i,s,a){const o=1/(e-t),h=1/(n-i),f=1/(s-a);return r[0]=-2*o,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*h,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*f,r[11]=0,r[12]=(e+t)*o,r[13]=(i+n)*h,r[14]=(a+s)*f,r[15]=1,r}const rge=tge;function nge(r,e,t,n){let i,s,a,o,h,f,_,x,T,I;const N=e[0],$=e[1],W=e[2],Y=n[0],ie=n[1],ce=n[2],fe=t[0],ve=t[1],be=t[2];return Math.abs(N-fe)<H1&&Math.abs($-ve)<H1&&Math.abs(W-be)<H1?zpe(r):(x=N-fe,T=$-ve,I=W-be,i=1/Math.sqrt(x*x+T*T+I*I),x*=i,T*=i,I*=i,s=ie*I-ce*T,a=ce*x-Y*I,o=Y*T-ie*x,i=Math.sqrt(s*s+a*a+o*o),i?(i=1/i,s*=i,a*=i,o*=i):(s=0,a=0,o=0),h=T*o-I*a,f=I*s-x*o,_=x*a-T*s,i=Math.sqrt(h*h+f*f+_*_),i?(i=1/i,h*=i,f*=i,_*=i):(h=0,f=0,_=0),r[0]=s,r[1]=h,r[2]=x,r[3]=0,r[4]=a,r[5]=f,r[6]=T,r[7]=0,r[8]=o,r[9]=_,r[10]=I,r[11]=0,r[12]=-(s*N+a*$+o*W),r[13]=-(h*N+f*$+_*W),r[14]=-(x*N+T*$+I*W),r[15]=1,r)}function ige(){const r=new Qd(4);return Qd!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0,r[3]=0),r}function sge(r,e,t){return r[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2],r[3]=e[3]+t[3],r}function oge(r,e,t){return r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r[3]=e[3]*t,r}function age(r){const e=r[0],t=r[1],n=r[2],i=r[3];return Math.sqrt(e*e+t*t+n*n+i*i)}function lge(r){const e=r[0],t=r[1],n=r[2],i=r[3];return e*e+t*t+n*n+i*i}function cge(r,e){const t=e[0],n=e[1],i=e[2],s=e[3];let a=t*t+n*n+i*i+s*s;return a>0&&(a=1/Math.sqrt(a)),r[0]=t*a,r[1]=n*a,r[2]=i*a,r[3]=s*a,r}function uge(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]*e[3]}function hge(r,e,t,n){const i=e[0],s=e[1],a=e[2],o=e[3];return r[0]=i+n*(t[0]-i),r[1]=s+n*(t[1]-s),r[2]=a+n*(t[2]-a),r[3]=o+n*(t[3]-o),r}function dge(r,e,t){const n=e[0],i=e[1],s=e[2],a=e[3];return r[0]=t[0]*n+t[4]*i+t[8]*s+t[12]*a,r[1]=t[1]*n+t[5]*i+t[9]*s+t[13]*a,r[2]=t[2]*n+t[6]*i+t[10]*s+t[14]*a,r[3]=t[3]*n+t[7]*i+t[11]*s+t[15]*a,r}function fge(r,e,t){const n=e[0],i=e[1],s=e[2],a=t[0],o=t[1],h=t[2],f=t[3],_=f*n+o*s-h*i,x=f*i+h*n-a*s,T=f*s+a*i-o*n,I=-a*n-o*i-h*s;return r[0]=_*f+I*-a+x*-h-T*-o,r[1]=x*f+I*-o+T*-a-_*-h,r[2]=T*f+I*-h+_*-o-x*-a,r[3]=e[3],r}(function(){const r=ige();return function(e,t,n,i,s,a){let o,h;for(t||(t=4),n||(n=0),i?h=Math.min(i*t+n,e.length):h=e.length,o=n;o<h;o+=t)r[0]=e[o],r[1]=e[o+1],r[2]=e[o+2],r[3]=e[o+3],s(r,r,a),e[o]=r[0],e[o+1]=r[1],e[o+2]=r[2],e[o+3]=r[3];return e}})();var hM;(function(r){r[r.COL0ROW0=0]="COL0ROW0",r[r.COL0ROW1=1]="COL0ROW1",r[r.COL0ROW2=2]="COL0ROW2",r[r.COL0ROW3=3]="COL0ROW3",r[r.COL1ROW0=4]="COL1ROW0",r[r.COL1ROW1=5]="COL1ROW1",r[r.COL1ROW2=6]="COL1ROW2",r[r.COL1ROW3=7]="COL1ROW3",r[r.COL2ROW0=8]="COL2ROW0",r[r.COL2ROW1=9]="COL2ROW1",r[r.COL2ROW2=10]="COL2ROW2",r[r.COL2ROW3=11]="COL2ROW3",r[r.COL3ROW0=12]="COL3ROW0",r[r.COL3ROW1=13]="COL3ROW1",r[r.COL3ROW2=14]="COL3ROW2",r[r.COL3ROW3=15]="COL3ROW3"})(hM||(hM={}));const Age=45*Math.PI/180,pge=1,dM=.1,fM=500,gge=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);let _a=class extends oz{static get IDENTITY(){return _ge()}static get ZERO(){return mge()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return hM}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,t,n,i,s,a,o,h,f,_,x,T,I,N,$,W){return this[0]=e,this[1]=t,this[2]=n,this[3]=i,this[4]=s,this[5]=a,this[6]=o,this[7]=h,this[8]=f,this[9]=_,this[10]=x,this[11]=T,this[12]=I,this[13]=N,this[14]=$,this[15]=W,this.check()}setRowMajor(e,t,n,i,s,a,o,h,f,_,x,T,I,N,$,W){return this[0]=e,this[1]=s,this[2]=f,this[3]=I,this[4]=t,this[5]=a,this[6]=_,this[7]=N,this[8]=n,this[9]=o,this[10]=x,this[11]=$,this[12]=i,this[13]=h,this[14]=T,this[15]=W,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(gge)}fromObject(e){return this.check()}fromQuaternion(e){return Jpe(this,e),this.check()}frustum(e){const{left:t,right:n,bottom:i,top:s,near:a=dM,far:o=fM}=e;return o===1/0?yge(this,t,n,i,s,a):Zpe(this,t,n,i,s,a,o),this.check()}lookAt(e){const{eye:t,center:n=[0,0,0],up:i=[0,1,0]}=e;return nge(this,t,n,i),this.check()}ortho(e){const{left:t,right:n,bottom:i,top:s,near:a=dM,far:o=fM}=e;return rge(this,t,n,i,s,a,o),this.check()}orthographic(e){const{fovy:t=Age,aspect:n=pge,focalDistance:i=1,near:s=dM,far:a=fM}=e;uz(t);const o=t/2,h=i*Math.tan(o),f=h*n;return this.ortho({left:-f,right:f,bottom:-h,top:h,near:s,far:a})}perspective(e){const{fovy:t=45*Math.PI/180,aspect:n=1,near:i=.1,far:s=500}=e;return uz(t),ege(this,t,n,i,s),this.check()}determinant(){return Gpe(this)}getScale(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[-0,-0,-0];return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[-0,-0,-0];return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const n=this.getScale(t),i=1/n[0],s=1/n[1],a=1/n[2];return e[0]=this[0]*i,e[1]=this[1]*s,e[2]=this[2]*a,e[3]=0,e[4]=this[4]*i,e[5]=this[5]*s,e[6]=this[6]*a,e[7]=0,e[8]=this[8]*i,e[9]=this[9]*s,e[10]=this[10]*a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const n=this.getScale(t),i=1/n[0],s=1/n[1],a=1/n[2];return e[0]=this[0]*i,e[1]=this[1]*s,e[2]=this[2]*a,e[3]=this[4]*i,e[4]=this[5]*s,e[5]=this[6]*a,e[6]=this[8]*i,e[7]=this[9]*s,e[8]=this[10]*a,e}transpose(){return Hpe(this,this),this.check()}invert(){return Vpe(this,this),this.check()}multiplyLeft(e){return cz(this,e,this),this.check()}multiplyRight(e){return cz(this,this,e),this.check()}rotateX(e){return qpe(this,this,e),this.check()}rotateY(e){return Kpe(this,this,e),this.check()}rotateZ(e){return Wpe(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,t){return jpe(this,this,e,t),this.check()}scale(e){return $pe(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return Qpe(this,this,e),this.check()}transform(e,t){return e.length===4?(t=dge(t||[-0,-0,-0,-0],e,this),z1(t,4),t):this.transformAsPoint(e,t)}transformAsPoint(e,t){const{length:n}=e;let i;switch(n){case 2:i=J8(t||[-0,-0],e,this);break;case 3:i=lM(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return z1(i,e.length),i}transformAsVector(e,t){let n;switch(e.length){case 2:n=Z8(t||[-0,-0],e,this);break;case 3:n=Y8(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return z1(n,e.length),n}transformPoint(e,t){return this.transformAsPoint(e,t)}transformVector(e,t){return this.transformAsPoint(e,t)}transformDirection(e,t){return this.transformAsVector(e,t)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,t,n){return this.identity().translate([e,t,n])}},t2,r2;function mge(){return t2||(t2=new _a([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(t2)),t2}function _ge(){return r2||(r2=new _a,Object.freeze(r2)),r2}function uz(r){if(r>Math.PI*2)throw Error("expected radians")}function yge(r,e,t,n,i,s){const a=2*s/(t-e),o=2*s/(i-n),h=(t+e)/(t-e),f=(i+n)/(i-n),_=-1,x=-1,T=-2*s;return r[0]=a,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=o,r[6]=0,r[7]=0,r[8]=h,r[9]=f,r[10]=_,r[11]=x,r[12]=0,r[13]=0,r[14]=T,r[15]=0,r}function hz(){const r=new Qd(4);return Qd!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function bge(r){return r[0]=0,r[1]=0,r[2]=0,r[3]=1,r}function dz(r,e,t){t=t*.5;const n=Math.sin(t);return r[0]=n*e[0],r[1]=n*e[1],r[2]=n*e[2],r[3]=Math.cos(t),r}function fz(r,e,t){const n=e[0],i=e[1],s=e[2],a=e[3],o=t[0],h=t[1],f=t[2],_=t[3];return r[0]=n*_+a*o+i*f-s*h,r[1]=i*_+a*h+s*o-n*f,r[2]=s*_+a*f+n*h-i*o,r[3]=a*_-n*o-i*h-s*f,r}function vge(r,e,t){t*=.5;const n=e[0],i=e[1],s=e[2],a=e[3],o=Math.sin(t),h=Math.cos(t);return r[0]=n*h+a*o,r[1]=i*h+s*o,r[2]=s*h-i*o,r[3]=a*h-n*o,r}function xge(r,e,t){t*=.5;const n=e[0],i=e[1],s=e[2],a=e[3],o=Math.sin(t),h=Math.cos(t);return r[0]=n*h-s*o,r[1]=i*h+a*o,r[2]=s*h+n*o,r[3]=a*h-i*o,r}function wge(r,e,t){t*=.5;const n=e[0],i=e[1],s=e[2],a=e[3],o=Math.sin(t),h=Math.cos(t);return r[0]=n*h+i*o,r[1]=i*h-n*o,r[2]=s*h+a*o,r[3]=a*h-s*o,r}function Bge(r,e){const t=e[0],n=e[1],i=e[2];return r[0]=t,r[1]=n,r[2]=i,r[3]=Math.sqrt(Math.abs(1-t*t-n*n-i*i)),r}function n2(r,e,t,n){const i=e[0],s=e[1],a=e[2],o=e[3];let h=t[0],f=t[1],_=t[2],x=t[3],T,I,N,$,W;return T=i*h+s*f+a*_+o*x,T<0&&(T=-T,h=-h,f=-f,_=-_,x=-x),1-T>H1?(I=Math.acos(T),W=Math.sin(I),N=Math.sin((1-n)*I)/W,$=Math.sin(n*I)/W):(N=1-n,$=n),r[0]=N*i+$*h,r[1]=N*s+$*f,r[2]=N*a+$*_,r[3]=N*o+$*x,r}function Cge(r,e){const t=e[0],n=e[1],i=e[2],s=e[3],a=t*t+n*n+i*i+s*s,o=a?1/a:0;return r[0]=-t*o,r[1]=-n*o,r[2]=-i*o,r[3]=s*o,r}function Ege(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r[3]=e[3],r}function Az(r,e){const t=e[0]+e[4]+e[8];let n;if(t>0)n=Math.sqrt(t+1),r[3]=.5*n,n=.5/n,r[0]=(e[5]-e[7])*n,r[1]=(e[6]-e[2])*n,r[2]=(e[1]-e[3])*n;else{let i=0;e[4]>e[0]&&(i=1),e[8]>e[i*3+i]&&(i=2);const s=(i+1)%3,a=(i+2)%3;n=Math.sqrt(e[i*3+i]-e[s*3+s]-e[a*3+a]+1),r[i]=.5*n,n=.5/n,r[3]=(e[s*3+a]-e[a*3+s])*n,r[s]=(e[s*3+i]+e[i*3+s])*n,r[a]=(e[a*3+i]+e[i*3+a])*n}return r}const Tge=sge,Sge=oge,Ige=uge,Mge=hge,Pge=age,Fge=lge,pz=cge,Rge=function(){const r=tz(),e=nz(1,0,0),t=nz(0,1,0);return function(n,i,s){const a=aM(i,s);return a<-.999999?(Xw(r,e,i),Spe(r)<1e-6&&Xw(r,t,i),wpe(r,r),dz(n,r,Math.PI),n):a>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(Xw(r,i,s),n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=1+a,pz(n,n))}}();(function(){const r=hz(),e=hz();return function(t,n,i,s,a,o){return n2(r,n,a,o),n2(e,i,s,o),n2(t,r,e,2*o*(1-o)),t}})(),function(){const r=Mpe();return function(e,t,n,i){return r[0]=n[0],r[3]=n[1],r[6]=n[2],r[1]=i[0],r[4]=i[1],r[7]=i[2],r[2]=-t[0],r[5]=-t[1],r[8]=-t[2],pz(e,Az(e,r))}}();const Lge=[0,0,0,1];let i2=class extends iM{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;super(-0,-0,-0,-0),Array.isArray(e)&&arguments.length===1?this.copy(e):this.set(e,t,n,i)}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}set(e,t,n,i){return this[0]=e,this[1]=t,this[2]=n,this[3]=i,this.check()}fromObject(e){return this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this.check()}fromMatrix3(e){return Az(this,e),this.check()}fromAxisRotation(e,t){return dz(this,e,t),this.check()}identity(){return bge(this),this.check()}setAxisAngle(e,t){return this.fromAxisRotation(e,t)}get ELEMENTS(){return 4}get x(){return this[0]}set x(e){this[0]=Ds(e)}get y(){return this[1]}set y(e){this[1]=Ds(e)}get z(){return this[2]}set z(e){this[2]=Ds(e)}get w(){return this[3]}set w(e){this[3]=Ds(e)}len(){return Pge(this)}lengthSquared(){return Fge(this)}dot(e){return Ige(this,e)}rotationTo(e,t){return Rge(this,e,t),this.check()}add(e){return Tge(this,this,e),this.check()}calculateW(){return Bge(this,this),this.check()}conjugate(){return Ege(this,this),this.check()}invert(){return Cge(this,this),this.check()}lerp(e,t,n){return n===void 0?this.lerp(this,e,t):(Mge(this,e,t,n),this.check())}multiplyRight(e){return fz(this,this,e),this.check()}multiplyLeft(e){return fz(this,e,this),this.check()}normalize(){const e=this.len(),t=e>0?1/e:0;return this[0]=this[0]*t,this[1]=this[1]*t,this[2]=this[2]*t,this[3]=this[3]*t,e===0&&(this[3]=1),this.check()}rotateX(e){return vge(this,this,e),this.check()}rotateY(e){return xge(this,this,e),this.check()}rotateZ(e){return wge(this,this,e),this.check()}scale(e){return Sge(this,this,e),this.check()}slerp(e,t,n){let i,s,a;switch(arguments.length){case 1:({start:i=Lge,target:s,ratio:a}=e);break;case 2:i=this,s=e,a=t;break;default:i=e,s=t,a=n}return n2(this,i,s,a),this.check()}transformVector4(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Ipe;return fge(t,e,this),z1(t,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(e,t){return this.setAxisAngle(e,t)}premultiply(e){return this.multiplyLeft(e)}multiply(e){return this.multiplyRight(e)}};const Dge=.1,Oge=1e-12,gz=1e-15,kge=1e-20,Bh={OUTSIDE:-1,INTERSECTING:0,INSIDE:1};new yr,new yr;const V1=new yr,mz=new yr;let AM=class OZ{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,0],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;this.radius=-0,this.center=new yr,this.fromCenterRadius(e,t)}fromCenterRadius(e,t){return this.center.from(e),this.radius=t,this}fromCornerPoints(e,t){return t=V1.from(t),this.center=new yr().from(e).add(t).scale(.5),this.radius=this.center.distance(t),this}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.radius===e.radius}clone(){return new OZ(this.center,this.radius)}union(e){const t=this.center,n=this.radius,i=e.center,s=e.radius,a=V1.copy(i).subtract(t),o=a.magnitude();if(n>=o+s)return this.clone();if(s>=o+n)return e.clone();const h=(n+o+s)*.5;return mz.copy(a).scale((-n+h)/o).add(t),this.center.copy(mz),this.radius=h,this}expand(e){const n=V1.from(e).subtract(this.center).magnitude();return n>this.radius&&(this.radius=n),this}transform(e){this.center.transform(e);const t=Xpe(V1,e);return this.radius=Math.max(t[0],Math.max(t[1],t[2]))*this.radius,this}distanceSquaredTo(e){const t=this.distanceTo(e);return t*t}distanceTo(e){const n=V1.from(e).subtract(this.center);return Math.max(0,n.len()-this.radius)}intersectPlane(e){const t=this.center,n=this.radius,s=e.normal.dot(t)+e.distance;return s<-n?Bh.OUTSIDE:s<n?Bh.INTERSECTING:Bh.INSIDE}};const Uge=new yr,Nge=new yr,s2=new yr,o2=new yr,a2=new yr,zge=new yr,Hge=new yr,_A={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};let pM=class kZ{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,0],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0,0,0,0,0,0,0];this.center=new yr().from(e),this.halfAxes=new ma(t)}get halfSize(){const e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),n=this.halfAxes.getColumn(2);return[new yr(e).len(),new yr(t).len(),new yr(n).len()]}get quaternion(){const e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),n=this.halfAxes.getColumn(2),i=new yr(e).normalize(),s=new yr(t).normalize(),a=new yr(n).normalize();return new i2().fromMatrix3(new ma([...i,...s,...a]))}fromCenterHalfSizeQuaternion(e,t,n){const i=new i2(n),s=new ma().fromQuaternion(i);return s[0]=s[0]*t[0],s[1]=s[1]*t[0],s[2]=s[2]*t[0],s[3]=s[3]*t[1],s[4]=s[4]*t[1],s[5]=s[5]*t[1],s[6]=s[6]*t[2],s[7]=s[7]*t[2],s[8]=s[8]*t[2],this.center=new yr().from(e),this.halfAxes=s,this}clone(){return new kZ(this.center,this.halfAxes)}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.halfAxes.equals(e.halfAxes)}getBoundingSphere(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:new AM;const t=this.halfAxes,n=t.getColumn(0,s2),i=t.getColumn(1,o2),s=t.getColumn(2,a2),a=Uge.copy(n).add(i).add(s);return e.center.copy(this.center),e.radius=a.magnitude(),e}intersectPlane(e){const t=this.center,n=e.normal,i=this.halfAxes,s=n.x,a=n.y,o=n.z,h=Math.abs(s*i[_A.COLUMN0ROW0]+a*i[_A.COLUMN0ROW1]+o*i[_A.COLUMN0ROW2])+Math.abs(s*i[_A.COLUMN1ROW0]+a*i[_A.COLUMN1ROW1]+o*i[_A.COLUMN1ROW2])+Math.abs(s*i[_A.COLUMN2ROW0]+a*i[_A.COLUMN2ROW1]+o*i[_A.COLUMN2ROW2]),f=n.dot(t)+e.distance;return f<=-h?Bh.OUTSIDE:f>=h?Bh.INSIDE:Bh.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const t=Nge.from(e).subtract(this.center),n=this.halfAxes,i=n.getColumn(0,s2),s=n.getColumn(1,o2),a=n.getColumn(2,a2),o=i.magnitude(),h=s.magnitude(),f=a.magnitude();i.normalize(),s.normalize(),a.normalize();let _=0,x;return x=Math.abs(t.dot(i))-o,x>0&&(_+=x*x),x=Math.abs(t.dot(s))-h,x>0&&(_+=x*x),x=Math.abs(t.dot(a))-f,x>0&&(_+=x*x),_}computePlaneDistances(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[-0,-0],i=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY;const a=this.center,o=this.halfAxes,h=o.getColumn(0,s2),f=o.getColumn(1,o2),_=o.getColumn(2,a2),x=zge.copy(h).add(f).add(_).add(a),T=Hge.copy(x).subtract(e);let I=t.dot(T);return i=Math.min(I,i),s=Math.max(I,s),x.copy(a).add(h).add(f).subtract(_),T.copy(x).subtract(e),I=t.dot(T),i=Math.min(I,i),s=Math.max(I,s),x.copy(a).add(h).subtract(f).add(_),T.copy(x).subtract(e),I=t.dot(T),i=Math.min(I,i),s=Math.max(I,s),x.copy(a).add(h).subtract(f).subtract(_),T.copy(x).subtract(e),I=t.dot(T),i=Math.min(I,i),s=Math.max(I,s),a.copy(x).subtract(h).add(f).add(_),T.copy(x).subtract(e),I=t.dot(T),i=Math.min(I,i),s=Math.max(I,s),a.copy(x).subtract(h).add(f).subtract(_),T.copy(x).subtract(e),I=t.dot(T),i=Math.min(I,i),s=Math.max(I,s),a.copy(x).subtract(h).subtract(f).add(_),T.copy(x).subtract(e),I=t.dot(T),i=Math.min(I,i),s=Math.max(I,s),a.copy(x).subtract(h).subtract(f).subtract(_),T.copy(x).subtract(e),I=t.dot(T),i=Math.min(I,i),s=Math.max(I,s),n[0]=i,n[1]=s,n}transform(e){this.center.transformAsPoint(e);const t=this.halfAxes.getColumn(0,s2);t.transformAsPoint(e);const n=this.halfAxes.getColumn(1,o2);n.transformAsPoint(e);const i=this.halfAxes.getColumn(2,a2);return i.transformAsPoint(e),this.halfAxes=new ma([...t,...n,...i]),this}getTransform(){throw new Error("not implemented")}};const _z=new yr,yz=new yr;let mp=class UZ{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,1],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;this.normal=new yr,this.distance=-0,this.fromNormalDistance(e,t)}fromNormalDistance(e,t){return Gd(Number.isFinite(t)),this.normal.from(e).normalize(),this.distance=t,this}fromPointNormal(e,t){e=_z.from(e),this.normal.from(t).normalize();const n=-this.normal.dot(e);return this.distance=n,this}fromCoefficients(e,t,n,i){return this.normal.set(e,t,n),Gd(gp(this.normal.len(),1)),this.distance=i,this}clone(){return new UZ(this.normal,this.distance)}equals(e){return gp(this.distance,e.distance)&&gp(this.normal,e.normal)}getPointDistance(e){return this.normal.dot(e)+this.distance}transform(e){const t=yz.copy(this.normal).transformAsVector(e).normalize(),n=this.normal.scale(-this.distance).transform(e);return this.fromPointNormal(n,t)}projectPointOntoPlane(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];const n=_z.from(e),i=this.getPointDistance(n),s=yz.copy(this.normal).scale(i);return n.subtract(s).to(t)}};const bz=[new yr([1,0,0]),new yr([0,1,0]),new yr([0,0,1])],vz=new yr,Vge=new yr;let Hg=class _x{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];this.planes=e}fromBoundingSphere(e){this.planes.length=2*bz.length;const t=e.center,n=e.radius;let i=0;for(const s of bz){let a=this.planes[i],o=this.planes[i+1];a||(a=this.planes[i]=new mp),o||(o=this.planes[i+1]=new mp);const h=vz.copy(s).scale(-n).add(t);a.fromPointNormal(h,s);const f=vz.copy(s).scale(n).add(t),_=Vge.copy(s).negate();o.fromPointNormal(f,_),i+=2}return this}computeVisibility(e){let t=Bh.INSIDE;for(const n of this.planes)switch(e.intersectPlane(n)){case Bh.OUTSIDE:return Bh.OUTSIDE;case Bh.INTERSECTING:t=Bh.INTERSECTING;break}return t}computeVisibilityWithPlaneMask(e,t){if(Gd(Number.isFinite(t),"parentPlaneMask is required."),t===_x.MASK_OUTSIDE||t===_x.MASK_INSIDE)return t;let n=_x.MASK_INSIDE;const i=this.planes;for(let s=0;s<this.planes.length;++s){const a=s<31?1<<s:0;if(s<31&&!(t&a))continue;const o=i[s],h=e.intersectPlane(o);if(h===Bh.OUTSIDE)return _x.MASK_OUTSIDE;h===Bh.INTERSECTING&&(n|=a)}return n}};Hg.MASK_OUTSIDE=4294967295,Hg.MASK_INSIDE=0,Hg.MASK_INDETERMINATE=2147483647,new yr,new yr,new yr,new yr,new yr,new yr,new yr,new yr,new yr,new yr,new yr,new yr,new yr,new yr,new yr,new yr,new yr;const Hf=new ma,Gge=new ma,Qge=new ma,l2=new ma,xz=new ma;function $ge(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const t=kge,n=10;let i=0,s=0;const a=Gge,o=Qge;a.identity(),o.copy(r);const h=t*jge(o);for(;s<n&&qge(o)>h;)Kge(o,l2),xz.copy(l2).transpose(),o.multiplyRight(l2),o.multiplyLeft(xz),a.multiplyRight(l2),++i>2&&(++s,i=0);return e.unitary=a.toTarget(e.unitary),e.diagonal=o.toTarget(e.diagonal),e}function jge(r){let e=0;for(let t=0;t<9;++t){const n=r[t];e+=n*n}return Math.sqrt(e)}const gM=[1,0,0],mM=[2,2,1];function qge(r){let e=0;for(let t=0;t<3;++t){const n=r[Hf.getElementIndex(mM[t],gM[t])];e+=2*n*n}return Math.sqrt(e)}function Kge(r,e){const t=gz;let n=0,i=1;for(let f=0;f<3;++f){const _=Math.abs(r[Hf.getElementIndex(mM[f],gM[f])]);_>n&&(i=f,n=_)}const s=gM[i],a=mM[i];let o=1,h=0;if(Math.abs(r[Hf.getElementIndex(a,s)])>t){const f=r[Hf.getElementIndex(a,a)],_=r[Hf.getElementIndex(s,s)],x=r[Hf.getElementIndex(a,s)],T=(f-_)/2/x;let I;T<0?I=-1/(-T+Math.sqrt(1+T*T)):I=1/(T+Math.sqrt(1+T*T)),o=1/Math.sqrt(1+I*I),h=I*o}return ma.IDENTITY.to(e),e[Hf.getElementIndex(s,s)]=e[Hf.getElementIndex(a,a)]=o,e[Hf.getElementIndex(a,s)]=h,e[Hf.getElementIndex(s,a)]=-h,e}const _p=new yr,Wge=new yr,Xge=new yr,Jge=new yr,Zge=new yr,Yge=new ma,eme={diagonal:new ma,unitary:new ma};function tme(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new pM;if(!r||r.length===0)return e.halfAxes=new ma([0,0,0,0,0,0,0,0,0]),e.center=new yr,e;const t=r.length,n=new yr(0,0,0);for(const st of r)n.add(st);const i=1/t;n.multiplyByScalar(i);let s=0,a=0,o=0,h=0,f=0,_=0;for(const st of r){const at=_p.copy(st).subtract(n);s+=at.x*at.x,a+=at.x*at.y,o+=at.x*at.z,h+=at.y*at.y,f+=at.y*at.z,_+=at.z*at.z}s*=i,a*=i,o*=i,h*=i,f*=i,_*=i;const x=Yge;x[0]=s,x[1]=a,x[2]=o,x[3]=a,x[4]=h,x[5]=f,x[6]=o,x[7]=f,x[8]=_;const{unitary:T}=$ge(x,eme),I=e.halfAxes.copy(T);let N=I.getColumn(0,Xge),$=I.getColumn(1,Jge),W=I.getColumn(2,Zge),Y=-Number.MAX_VALUE,ie=-Number.MAX_VALUE,ce=-Number.MAX_VALUE,fe=Number.MAX_VALUE,ve=Number.MAX_VALUE,be=Number.MAX_VALUE;for(const st of r)_p.copy(st),Y=Math.max(_p.dot(N),Y),ie=Math.max(_p.dot($),ie),ce=Math.max(_p.dot(W),ce),fe=Math.min(_p.dot(N),fe),ve=Math.min(_p.dot($),ve),be=Math.min(_p.dot(W),be);N=N.multiplyByScalar(.5*(fe+Y)),$=$.multiplyByScalar(.5*(ve+ie)),W=W.multiplyByScalar(.5*(be+ce)),e.center.copy(N).add($).add(W);const Qe=Wge.set(Y-fe,ie-ve,ce-be).multiplyByScalar(.5),Ue=new ma([Qe[0],0,0,0,Qe[1],0,0,0,Qe[2]]);return e.halfAxes.multiplyRight(Ue),e}const _M=Math.PI/180,c2=new Float32Array(16),wz=new Float32Array(12);function Bz(r,e,t){const n=e[0]*_M,i=e[1]*_M,s=e[2]*_M,a=Math.sin(s),o=Math.sin(n),h=Math.sin(i),f=Math.cos(s),_=Math.cos(n),x=Math.cos(i),T=t[0],I=t[1],N=t[2];r[0]=T*x*_,r[1]=T*h*_,r[2]=T*-o,r[3]=I*(-h*f+x*o*a),r[4]=I*(x*f+h*o*a),r[5]=I*_*a,r[6]=N*(h*a+x*o*f),r[7]=N*(-x*a+h*o*f),r[8]=N*_*f}function Cz(r){return r[0]=r[0],r[1]=r[1],r[2]=r[2],r[3]=r[4],r[4]=r[5],r[5]=r[6],r[6]=r[8],r[7]=r[9],r[8]=r[10],r[9]=r[12],r[10]=r[13],r[11]=r[14],r.subarray(0,12)}const Ez={size:12,accessor:["getOrientation","getScale","getTranslation","getTransformMatrix"],shaderAttributes:{instanceModelMatrixCol0:{size:3,elementOffset:0},instanceModelMatrixCol1:{size:3,elementOffset:3},instanceModelMatrixCol2:{size:3,elementOffset:6},instanceTranslation:{size:3,elementOffset:9}},update(r,e){let{startRow:t,endRow:n}=e;const{data:i,getOrientation:s,getScale:a,getTranslation:o,getTransformMatrix:h}=this.props,f=Array.isArray(h),_=f&&h.length===16,x=Array.isArray(a),T=Array.isArray(s),I=Array.isArray(o),N=_||!f&&!!h(i[0]);N?r.constant=_:r.constant=T&&x&&I;const $=r.value;if(r.constant){let W;N?(c2.set(h),W=Cz(c2)):(W=wz,Bz(W,s,a),W.set(o,9)),r.value=new Float32Array(W)}else{let W=t*r.size;const{iterable:Y,objectInfo:ie}=y6(i,t,n);for(const ce of Y){ie.index++;let fe;if(N)c2.set(_?h:h(ce,ie)),fe=Cz(c2);else{fe=wz;const ve=T?s:s(ce,ie),be=x?a:a(ce,ie);Bz(fe,ve,be),fe.set(I?o:o(ce,ie),9)}$[W++]=fe[0],$[W++]=fe[1],$[W++]=fe[2],$[W++]=fe[3],$[W++]=fe[4],$[W++]=fe[5],$[W++]=fe[6],$[W++]=fe[7],$[W++]=fe[8],$[W++]=fe[9],$[W++]=fe[10],$[W++]=fe[11]}}}};function Tz(r,e){return e===is.CARTESIAN||e===is.METER_OFFSETS||e===is.DEFAULT&&!r.isGeospatial}const Sz=`uniform simpleMeshUniforms {
  float sizeScale;
  bool composeModelMatrix;
  bool hasTexture;
  bool flatShading;
} simpleMesh;
`,rme={name:"simpleMesh",vs:Sz,fs:Sz,uniformTypes:{sizeScale:"f32",composeModelMatrix:"f32",hasTexture:"f32",flatShading:"f32"}},nme=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
in vec3 instanceTranslation;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = texCoords;
geometry.pickingColor = instancePickingColors;
vTexCoord = texCoords;
cameraPosition = project.cameraPosition;
vColor = vec4(colors * instanceColors.rgb, instanceColors.a);
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vec3 pos = (instanceModelMatrix * positions) * simpleMesh.sizeScale + instanceTranslation;
if (simpleMesh.composeModelMatrix) {
DECKGL_FILTER_SIZE(pos, geometry);
normals_commonspace = project_normal(instanceModelMatrix * normals);
geometry.worldPosition += pos;
gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), position_commonspace);
geometry.position = position_commonspace;
}
else {
pos = project_size(pos);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, position_commonspace);
geometry.position = position_commonspace;
normals_commonspace = project_normal(instanceModelMatrix * normals);
}
geometry.normal = normals_commonspace;
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,ime=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs
precision highp float;
uniform sampler2D sampler;
in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
geometry.uv = vTexCoord;
vec3 normal;
if (simpleMesh.flatShading) {
normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
} else {
normal = normals_commonspace;
}
vec4 color = simpleMesh.hasTexture ? texture(sampler, vTexCoord) : vColor;
DECKGL_FILTER_COLOR(color, geometry);
vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
fragColor = vec4(lightColor, color.a * layer.opacity);
}
`;function sme(r){switch(r.constructor){case Int8Array:return"int8";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int16Array:return"int16";case Uint16Array:return"uint16";case Int32Array:return"int32";case Uint32Array:return"uint32";case Float32Array:return"float32";case Float64Array:return"float64";default:return"null"}}function Iz(r){let e=1/0,t=1/0,n=1/0,i=-1/0,s=-1/0,a=-1/0;const o=r.POSITION?r.POSITION.value:[],h=o&&o.length;for(let f=0;f<h;f+=3){const _=o[f],x=o[f+1],T=o[f+2];e=_<e?_:e,t=x<t?x:t,n=T<n?T:n,i=_>i?_:i,s=x>s?x:s,a=T>a?T:a}return[[e,t,n],[i,s,a]]}function ome(r,e,t){const n=sme(e.value),i=t||ame(e);return{name:r,type:{type:"fixed-size-list",listSize:e.size,children:[{name:"value",type:n}]},nullable:!1,metadata:i}}function ame(r){const e={};return"byteOffset"in r&&(e.byteOffset=r.byteOffset.toString(10)),"byteStride"in r&&(e.byteStride=r.byteStride.toString(10)),"normalized"in r&&(e.normalized=r.normalized.toString()),e}function yM(r){const e=r.positions||r.POSITION;Es.assert(e,'no "postions" or "POSITION" attribute in mesh');const t=e.value.length/e.size;let n=r.COLOR_0||r.colors;n||(n={size:3,value:new Float32Array(t*3).fill(1)});let i=r.NORMAL||r.normals;i||(i={size:3,value:new Float32Array(t*3).fill(0)});let s=r.TEXCOORD_0||r.texCoords;return s||(s={size:2,value:new Float32Array(t*2).fill(0)}),{positions:e,colors:n,normals:i,texCoords:s}}function Mz(r){return r instanceof R_?(r.attributes=yM(r.attributes),r):r.attributes?new R_({...r,topology:"triangle-list",attributes:yM(r.attributes)}):new R_({topology:"triangle-list",attributes:yM(r)})}const lme={mesh:{type:"object",value:null,async:!0},texture:{type:"image",value:null,async:!0},sizeScale:{type:"number",value:1,min:0},_instanced:!0,wireframe:!1,material:!0,getPosition:{type:"accessor",value:r=>r.position},getColor:{type:"accessor",value:[0,0,0,255]},getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},textureParameters:{type:"object",ignore:!0,value:null}};class bM extends q_{getShaders(){return super.getShaders({vs:nme,fs:ime,modules:[LI,uU,VI,rme]})}getBounds(){var n;if(this.props._instanced)return super.getBounds();let e=this.state.positionBounds;if(e)return e;const{mesh:t}=this.props;if(!t)return null;if(e=(n=t.header)==null?void 0:n.boundingBox,!e){const{attributes:i}=Mz(t);i.POSITION=i.POSITION||i.positions,e=Iz(i)}return this.state.positionBounds=e,e}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{transition:!0,type:"float64",fp64:this.use64bitPositions(),size:3,accessor:"getPosition"},instanceColors:{type:"unorm8",transition:!0,size:this.props.colorFormat.length,accessor:"getColor",defaultValue:[0,0,0,255]},instanceModelMatrix:Ez}),this.setState({emptyTexture:this.context.device.createTexture({data:new Uint8Array(4),width:1,height:1})})}updateState(e){var s;super.updateState(e);const{props:t,oldProps:n,changeFlags:i}=e;if(t.mesh!==n.mesh||i.extensionsChanged){if(this.state.positionBounds=null,(s=this.state.model)==null||s.destroy(),t.mesh){this.state.model=this.getModel(t.mesh);const a=t.mesh.attributes||t.mesh;this.setState({hasNormals:!!(a.NORMAL||a.normals)})}this.getAttributeManager().invalidateAll()}t.texture!==n.texture&&t.texture instanceof ia&&this.setTexture(t.texture),this.state.model&&this.state.model.setTopology(this.props.wireframe?"line-strip":"triangle-list")}finalizeState(e){super.finalizeState(e),this.state.emptyTexture.delete()}draw(e){const{model:t}=this.state;if(!t)return;const{viewport:n,renderPass:i}=this.context,{sizeScale:s,coordinateSystem:a,_instanced:o}=this.props,h={sizeScale:s,composeModelMatrix:!o||Tz(n,a),flatShading:!this.state.hasNormals};t.shaderInputs.setProps({simpleMesh:h}),t.draw(i)}get isLoaded(){var e;return!!((e=this.state)!=null&&e.model&&super.isLoaded)}getModel(e){const t=new lp(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:Mz(e),isInstanced:!0}),{texture:n}=this.props,{emptyTexture:i}=this.state,s={sampler:n||i,hasTexture:!!n};return t.shaderInputs.setProps({simpleMesh:s}),t}setTexture(e){const{emptyTexture:t,model:n}=this.state;if(n){const i={sampler:e||t,hasTexture:!!e};n.shaderInputs.setProps({simpleMesh:i})}}}bM.defaultProps=lme,bM.layerName="SimpleMeshLayer";var $d;(function(r){r[r.FUNC_ADD=32774]="FUNC_ADD",r[r.ONE=1]="ONE",r[r.SRC_ALPHA=770]="SRC_ALPHA",r[r.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",r[r.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",r[r.LINEAR=9729]="LINEAR",r[r.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",r[r.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL"})($d||($d={}));function Pz(r,e,t,n){const i={defines:{MANUAL_SRGB:1,SRGB_FAST_APPROXIMATION:1},bindings:{},uniforms:{camera:[0,0,0],metallicRoughnessValues:[1,1]},parameters:{},glParameters:{},generatedTextures:[]};i.defines.USE_TEX_LOD=1;const{imageBasedLightingEnvironment:s}=n;return s&&(i.bindings.pbr_diffuseEnvSampler=s.diffuseEnvSampler.texture,i.bindings.pbr_specularEnvSampler=s.specularEnvSampler.texture,i.bindings.pbr_BrdfLUT=s.brdfLutTexture.texture,i.uniforms.scaleIBLAmbient=[1,1]),n!=null&&n.pbrDebug&&(i.defines.PBR_DEBUG=1,i.uniforms.scaleDiffBaseMR=[0,0,0,0],i.uniforms.scaleFGDSpec=[0,0,0,0]),t.NORMAL&&(i.defines.HAS_NORMALS=1),t.TANGENT&&(n!=null&&n.useTangents)&&(i.defines.HAS_TANGENTS=1),t.TEXCOORD_0&&(i.defines.HAS_UV=1),n!=null&&n.imageBasedLightingEnvironment&&(i.defines.USE_IBL=1),n!=null&&n.lights&&(i.defines.USE_LIGHTS=1),e&&cme(r,e,i),i}function cme(r,e,t){if(t.uniforms.unlit=!!e.unlit,e.pbrMetallicRoughness&&ume(r,e.pbrMetallicRoughness,t),e.normalTexture){G1(r,e.normalTexture,"pbr_normalSampler","HAS_NORMALMAP",t);const{scale:n=1}=e.normalTexture;t.uniforms.normalScale=n}if(e.occlusionTexture){G1(r,e.occlusionTexture,"pbr_occlusionSampler","HAS_OCCLUSIONMAP",t);const{strength:n=1}=e.occlusionTexture;t.uniforms.occlusionStrength=n}switch(e.emissiveTexture&&(G1(r,e.emissiveTexture,"pbr_emissiveSampler","HAS_EMISSIVEMAP",t),t.uniforms.emissiveFactor=e.emissiveFactor||[0,0,0]),e.alphaMode){case"MASK":const{alphaCutoff:n=.5}=e;t.defines.ALPHA_CUTOFF=1,t.uniforms.alphaCutoff=n;break;case"BLEND":an.warn("glTF BLEND alphaMode might not work well because it requires mesh sorting")(),t.parameters.blendColorOperation="add",t.parameters.blendColorSrcFactor="src-alpha",t.parameters.blendColorDstFactor="one-minus-src-alpha",t.parameters.blendAlphaOperation="add",t.parameters.blendAlphaSrcFactor="one",t.parameters.blendAlphaDstFactor="one-minus-src-alpha",t.glParameters.blend=!0,t.glParameters.blendEquation=$d.FUNC_ADD,t.glParameters.blendFunc=[$d.SRC_ALPHA,$d.ONE_MINUS_SRC_ALPHA,$d.ONE,$d.ONE_MINUS_SRC_ALPHA];break}}function ume(r,e,t){e.baseColorTexture&&G1(r,e.baseColorTexture,"pbr_baseColorSampler","HAS_BASECOLORMAP",t),t.uniforms.baseColorFactor=e.baseColorFactor||[1,1,1,1],e.metallicRoughnessTexture&&G1(r,e.metallicRoughnessTexture,"pbr_metallicRoughnessSampler","HAS_METALROUGHNESSMAP",t);const{metallicFactor:n=1,roughnessFactor:i=1}=e;t.uniforms.metallicRoughnessValues=[n,i]}function G1(r,e,t){var _,x;let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,i=arguments.length>4?arguments[4]:void 0;const s=((x=(_=e==null?void 0:e.texture)==null?void 0:_.sampler)==null?void 0:x.parameters)||{},a=e.texture.source.image;let o,h={};a.compressed?(o=a,h={[$d.TEXTURE_MIN_FILTER]:a.data.length>1?$d.LINEAR_MIPMAP_NEAREST:$d.LINEAR}):o={data:a};const f=r.createTexture({id:e.uniformName||e.id,parameters:{...s,...h},pixelStore:{[$d.UNPACK_FLIP_Y_WEBGL]:!1},...o});i.bindings[t]=f,n&&(i.defines[n]=1),i.generatedTextures.push(f)}const hme={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...hme}};const ad=globalThis.mathgl.config;function dme(r){let{precision:e=ad.precision}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return r=fme(r),`${parseFloat(r.toPrecision(e))}`}function u2(r){return Array.isArray(r)||ArrayBuffer.isView(r)&&!(r instanceof DataView)}function Fz(r,e,t){const n=ad.EPSILON;try{if(r===e)return!0;if(u2(r)&&u2(e)){if(r.length!==e.length)return!1;for(let i=0;i<r.length;++i)if(!Fz(r[i],e[i]))return!1;return!0}return r&&r.equals?r.equals(e):e&&e.equals?e.equals(r):typeof r=="number"&&typeof e=="number"?Math.abs(r-e)<=ad.EPSILON*Math.max(1,Math.abs(r),Math.abs(e)):!1}finally{ad.EPSILON=n}}function fme(r){return Math.round(r/ad.EPSILON)*ad.EPSILON}let vM=class extends Array{clone(){return new this.constructor().copy(this)}fromArray(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;for(let n=0;n<this.ELEMENTS;++n)this[n]=e[n+t];return this.check()}toArray(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;for(let n=0;n<this.ELEMENTS;++n)e[t+n]=this[n];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:u2(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(ad)}formatString(e){let t="";for(let n=0;n<this.ELEMENTS;++n)t+=(n>0?", ":"")+dme(this[n],e);return`${e.printTypes?this.constructor.name:""}[${t}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(!Fz(this[t],e[t]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(this[t]!==e[t])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,t,n){if(n===void 0)return this.lerp(this,e,t);for(let i=0;i<this.ELEMENTS;++i){const s=e[i],a=typeof t=="number"?t:t[i];this[i]=s+n*(a-s)}return this.check()}min(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}max(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}clamp(e,t){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e[n]),t[n]);return this.check()}add(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(const i of t)for(let s=0;s<this.ELEMENTS;++s)this[s]+=i[s];return this.check()}subtract(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(const i of t)for(let s=0;s<this.ELEMENTS;++s)this[s]-=i[s];return this.check()}scale(e){if(typeof e=="number")for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;else for(let t=0;t<this.ELEMENTS&&t<e.length;++t)this[t]*=e[t];return this.check()}multiplyByScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}check(){if(ad.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let t=0;t<this.ELEMENTS;++t)e=e&&Number.isFinite(this[t]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}addScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,t){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e),t);return this.check()}get elements(){return this}};function Ame(r,e){if(r.length!==e)return!1;for(let t=0;t<r.length;++t)if(!Number.isFinite(r[t]))return!1;return!0}function ll(r){if(!Number.isFinite(r))throw new Error(`Invalid number ${JSON.stringify(r)}`);return r}function h2(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";if(ad.debug&&!Ame(r,e))throw new Error(`math.gl: ${t} some fields set to invalid numbers'`);return r}function Rz(r,e){if(!r)throw new Error(`math.gl assertion ${e}`)}let pme=class extends vM{get x(){return this[0]}set x(e){this[0]=ll(e)}get y(){return this[1]}set y(e){this[1]=ll(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let t=0;for(let n=0;n<this.ELEMENTS;++n){const i=this[n]-e[n];t+=i*i}return ll(t)}dot(e){let t=0;for(let n=0;n<this.ELEMENTS;++n)t+=this[n]*e[n];return ll(t)}normalize(){const e=this.magnitude();if(e!==0)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}multiply(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(const i of t)for(let s=0;s<this.ELEMENTS;++s)this[s]*=i[s];return this.check()}divide(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(const i of t)for(let s=0;s<this.ELEMENTS;++s)this[s]/=i[s];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return Rz(e>=0&&e<this.ELEMENTS,"index is out of range"),ll(this[e])}setComponent(e,t){return Rz(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=t,this.check()}addVectors(e,t){return this.copy(e).add(t)}subVectors(e,t){return this.copy(e).subtract(t)}multiplyVectors(e,t){return this.copy(e).multiply(t)}addScaledVector(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}};const Q1=1e-6;let jd=typeof Float32Array<"u"?Float32Array:Array;function gme(){const r=new jd(2);return jd!=Float32Array&&(r[0]=0,r[1]=0),r}function mme(r,e,t){const n=e[0],i=e[1];return r[0]=t[0]*n+t[4]*i+t[12],r[1]=t[1]*n+t[5]*i+t[13],r}(function(){const r=gme();return function(e,t,n,i,s,a){let o,h;for(t||(t=2),n||(n=0),i?h=Math.min(i*t+n,e.length):h=e.length,o=n;o<h;o+=t)r[0]=e[o],r[1]=e[o+1],s(r,r,a),e[o]=r[0],e[o+1]=r[1];return e}})();function _me(r,e,t){const n=e[0],i=e[1],s=t[3]*n+t[7]*i||1;return r[0]=(t[0]*n+t[4]*i)/s,r[1]=(t[1]*n+t[5]*i)/s,r}function yme(r,e,t){const n=e[0],i=e[1],s=e[2],a=t[3]*n+t[7]*i+t[11]*s||1;return r[0]=(t[0]*n+t[4]*i+t[8]*s)/a,r[1]=(t[1]*n+t[5]*i+t[9]*s)/a,r[2]=(t[2]*n+t[6]*i+t[10]*s)/a,r}function bme(r,e,t){const n=e[0],i=e[1];return r[0]=t[0]*n+t[2]*i,r[1]=t[1]*n+t[3]*i,r[2]=e[2],r[3]=e[3],r}function vme(r,e,t){const n=e[0],i=e[1],s=e[2];return r[0]=t[0]*n+t[3]*i+t[6]*s,r[1]=t[1]*n+t[4]*i+t[7]*s,r[2]=t[2]*n+t[5]*i+t[8]*s,r[3]=e[3],r}function Lz(){const r=new jd(3);return jd!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function xme(r){const e=r[0],t=r[1],n=r[2];return Math.sqrt(e*e+t*t+n*n)}function Dz(r,e,t){const n=new jd(3);return n[0]=r,n[1]=e,n[2]=t,n}function wme(r,e){const t=e[0],n=e[1],i=e[2];let s=t*t+n*n+i*i;return s>0&&(s=1/Math.sqrt(s)),r[0]=e[0]*s,r[1]=e[1]*s,r[2]=e[2]*s,r}function Bme(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]}function xM(r,e,t){const n=e[0],i=e[1],s=e[2],a=t[0],o=t[1],h=t[2];return r[0]=i*h-s*o,r[1]=s*a-n*h,r[2]=n*o-i*a,r}function Oz(r,e,t){const n=e[0],i=e[1],s=e[2];let a=t[3]*n+t[7]*i+t[11]*s+t[15];return a=a||1,r[0]=(t[0]*n+t[4]*i+t[8]*s+t[12])/a,r[1]=(t[1]*n+t[5]*i+t[9]*s+t[13])/a,r[2]=(t[2]*n+t[6]*i+t[10]*s+t[14])/a,r}function Cme(r,e,t){const n=t[0],i=t[1],s=t[2],a=t[3],o=e[0],h=e[1],f=e[2];let _=i*f-s*h,x=s*o-n*f,T=n*h-i*o,I=i*T-s*x,N=s*_-n*T,$=n*x-i*_;const W=a*2;return _*=W,x*=W,T*=W,I*=2,N*=2,$*=2,r[0]=o+_+I,r[1]=h+x+N,r[2]=f+T+$,r}const Eme=xme;(function(){const r=Lz();return function(e,t,n,i,s,a){let o,h;for(t||(t=3),n||(n=0),i?h=Math.min(i*t+n,e.length):h=e.length,o=n;o<h;o+=t)r[0]=e[o],r[1]=e[o+1],r[2]=e[o+2],s(r,r,a),e[o]=r[0],e[o+1]=r[1],e[o+2]=r[2];return e}})();let d2,Tme=class NZ extends pme{static get ZERO(){return d2||(d2=new NZ(0,0,0,0),Object.freeze(d2)),d2}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;super(-0,-0,-0,-0),u2(e)&&arguments.length===1?this.copy(e):(ad.debug&&(ll(e),ll(t),ll(n),ll(i)),this[0]=e,this[1]=t,this[2]=n,this[3]=i)}set(e,t,n,i){return this[0]=e,this[1]=t,this[2]=n,this[3]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}fromObject(e){return ad.debug&&(ll(e.x),ll(e.y),ll(e.z),ll(e.w)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e.w=this[3],e}get ELEMENTS(){return 4}get z(){return this[2]}set z(e){this[2]=ll(e)}get w(){return this[3]}set w(e){this[3]=ll(e)}transform(e){return Oz(this,this,e),this.check()}transformByMatrix3(e){return vme(this,this,e),this.check()}transformByMatrix2(e){return bme(this,this,e),this.check()}transformByQuaternion(e){return Cme(this,this,e),this.check()}applyMatrix4(e){return e.transform(this,this),this}},Sme=class extends vM{toString(){let e="[";if(ad.printRowMajor){e+="row-major:";for(let t=0;t<this.RANK;++t)for(let n=0;n<this.RANK;++n)e+=` ${this[n*this.RANK+t]}`}else{e+="column-major:";for(let t=0;t<this.ELEMENTS;++t)e+=` ${this[t]}`}return e+="]",e}getElementIndex(e,t){return t*this.RANK+e}getElement(e,t){return this[t*this.RANK+e]}setElement(e,t,n){return this[t*this.RANK+e]=ll(n),this}getColumn(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Array(this.RANK).fill(-0);const n=e*this.RANK;for(let i=0;i<this.RANK;++i)t[i]=this[n+i];return t}setColumn(e,t){const n=e*this.RANK;for(let i=0;i<this.RANK;++i)this[n+i]=t[i];return this}};function Ime(){const r=new jd(9);return jd!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r}function Mme(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Pme(r,e){if(r===e){const t=e[1],n=e[2],i=e[3],s=e[6],a=e[7],o=e[11];r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=t,r[6]=e[9],r[7]=e[13],r[8]=n,r[9]=s,r[11]=e[14],r[12]=i,r[13]=a,r[14]=o}else r[0]=e[0],r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=e[1],r[5]=e[5],r[6]=e[9],r[7]=e[13],r[8]=e[2],r[9]=e[6],r[10]=e[10],r[11]=e[14],r[12]=e[3],r[13]=e[7],r[14]=e[11],r[15]=e[15];return r}function Fme(r,e){const t=e[0],n=e[1],i=e[2],s=e[3],a=e[4],o=e[5],h=e[6],f=e[7],_=e[8],x=e[9],T=e[10],I=e[11],N=e[12],$=e[13],W=e[14],Y=e[15],ie=t*o-n*a,ce=t*h-i*a,fe=t*f-s*a,ve=n*h-i*o,be=n*f-s*o,Qe=i*f-s*h,Ue=_*$-x*N,st=_*W-T*N,at=_*Y-I*N,Le=x*W-T*$,ze=x*Y-I*$,tt=T*Y-I*W;let Ne=ie*tt-ce*ze+fe*Le+ve*at-be*st+Qe*Ue;return Ne?(Ne=1/Ne,r[0]=(o*tt-h*ze+f*Le)*Ne,r[1]=(i*ze-n*tt-s*Le)*Ne,r[2]=($*Qe-W*be+Y*ve)*Ne,r[3]=(T*be-x*Qe-I*ve)*Ne,r[4]=(h*at-a*tt-f*st)*Ne,r[5]=(t*tt-i*at+s*st)*Ne,r[6]=(W*fe-N*Qe-Y*ce)*Ne,r[7]=(_*Qe-T*fe+I*ce)*Ne,r[8]=(a*ze-o*at+f*Ue)*Ne,r[9]=(n*at-t*ze-s*Ue)*Ne,r[10]=(N*be-$*fe+Y*ie)*Ne,r[11]=(x*fe-_*be-I*ie)*Ne,r[12]=(o*st-a*Le-h*Ue)*Ne,r[13]=(t*Le-n*st+i*Ue)*Ne,r[14]=($*ce-N*ve-W*ie)*Ne,r[15]=(_*ve-x*ce+T*ie)*Ne,r):null}function Rme(r){const e=r[0],t=r[1],n=r[2],i=r[3],s=r[4],a=r[5],o=r[6],h=r[7],f=r[8],_=r[9],x=r[10],T=r[11],I=r[12],N=r[13],$=r[14],W=r[15],Y=e*a-t*s,ie=e*o-n*s,ce=t*o-n*a,fe=f*N-_*I,ve=f*$-x*I,be=_*$-x*N,Qe=e*be-t*ve+n*fe,Ue=s*be-a*ve+o*fe,st=f*ce-_*ie+x*Y,at=I*ce-N*ie+$*Y;return h*Qe-i*Ue+W*st-T*at}function kz(r,e,t){const n=e[0],i=e[1],s=e[2],a=e[3],o=e[4],h=e[5],f=e[6],_=e[7],x=e[8],T=e[9],I=e[10],N=e[11],$=e[12],W=e[13],Y=e[14],ie=e[15];let ce=t[0],fe=t[1],ve=t[2],be=t[3];return r[0]=ce*n+fe*o+ve*x+be*$,r[1]=ce*i+fe*h+ve*T+be*W,r[2]=ce*s+fe*f+ve*I+be*Y,r[3]=ce*a+fe*_+ve*N+be*ie,ce=t[4],fe=t[5],ve=t[6],be=t[7],r[4]=ce*n+fe*o+ve*x+be*$,r[5]=ce*i+fe*h+ve*T+be*W,r[6]=ce*s+fe*f+ve*I+be*Y,r[7]=ce*a+fe*_+ve*N+be*ie,ce=t[8],fe=t[9],ve=t[10],be=t[11],r[8]=ce*n+fe*o+ve*x+be*$,r[9]=ce*i+fe*h+ve*T+be*W,r[10]=ce*s+fe*f+ve*I+be*Y,r[11]=ce*a+fe*_+ve*N+be*ie,ce=t[12],fe=t[13],ve=t[14],be=t[15],r[12]=ce*n+fe*o+ve*x+be*$,r[13]=ce*i+fe*h+ve*T+be*W,r[14]=ce*s+fe*f+ve*I+be*Y,r[15]=ce*a+fe*_+ve*N+be*ie,r}function Lme(r,e,t){const n=t[0],i=t[1],s=t[2];let a,o,h,f,_,x,T,I,N,$,W,Y;return e===r?(r[12]=e[0]*n+e[4]*i+e[8]*s+e[12],r[13]=e[1]*n+e[5]*i+e[9]*s+e[13],r[14]=e[2]*n+e[6]*i+e[10]*s+e[14],r[15]=e[3]*n+e[7]*i+e[11]*s+e[15]):(a=e[0],o=e[1],h=e[2],f=e[3],_=e[4],x=e[5],T=e[6],I=e[7],N=e[8],$=e[9],W=e[10],Y=e[11],r[0]=a,r[1]=o,r[2]=h,r[3]=f,r[4]=_,r[5]=x,r[6]=T,r[7]=I,r[8]=N,r[9]=$,r[10]=W,r[11]=Y,r[12]=a*n+_*i+N*s+e[12],r[13]=o*n+x*i+$*s+e[13],r[14]=h*n+T*i+W*s+e[14],r[15]=f*n+I*i+Y*s+e[15]),r}function Dme(r,e,t){const n=t[0],i=t[1],s=t[2];return r[0]=e[0]*n,r[1]=e[1]*n,r[2]=e[2]*n,r[3]=e[3]*n,r[4]=e[4]*i,r[5]=e[5]*i,r[6]=e[6]*i,r[7]=e[7]*i,r[8]=e[8]*s,r[9]=e[9]*s,r[10]=e[10]*s,r[11]=e[11]*s,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function Ome(r,e,t,n){let i=n[0],s=n[1],a=n[2],o=Math.sqrt(i*i+s*s+a*a),h,f,_,x,T,I,N,$,W,Y,ie,ce,fe,ve,be,Qe,Ue,st,at,Le,ze,tt,Ne,Ht;return o<Q1?null:(o=1/o,i*=o,s*=o,a*=o,f=Math.sin(t),h=Math.cos(t),_=1-h,x=e[0],T=e[1],I=e[2],N=e[3],$=e[4],W=e[5],Y=e[6],ie=e[7],ce=e[8],fe=e[9],ve=e[10],be=e[11],Qe=i*i*_+h,Ue=s*i*_+a*f,st=a*i*_-s*f,at=i*s*_-a*f,Le=s*s*_+h,ze=a*s*_+i*f,tt=i*a*_+s*f,Ne=s*a*_-i*f,Ht=a*a*_+h,r[0]=x*Qe+$*Ue+ce*st,r[1]=T*Qe+W*Ue+fe*st,r[2]=I*Qe+Y*Ue+ve*st,r[3]=N*Qe+ie*Ue+be*st,r[4]=x*at+$*Le+ce*ze,r[5]=T*at+W*Le+fe*ze,r[6]=I*at+Y*Le+ve*ze,r[7]=N*at+ie*Le+be*ze,r[8]=x*tt+$*Ne+ce*Ht,r[9]=T*tt+W*Ne+fe*Ht,r[10]=I*tt+Y*Ne+ve*Ht,r[11]=N*tt+ie*Ne+be*Ht,e!==r&&(r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r)}function kme(r,e,t){const n=Math.sin(t),i=Math.cos(t),s=e[4],a=e[5],o=e[6],h=e[7],f=e[8],_=e[9],x=e[10],T=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=s*i+f*n,r[5]=a*i+_*n,r[6]=o*i+x*n,r[7]=h*i+T*n,r[8]=f*i-s*n,r[9]=_*i-a*n,r[10]=x*i-o*n,r[11]=T*i-h*n,r}function Ume(r,e,t){const n=Math.sin(t),i=Math.cos(t),s=e[0],a=e[1],o=e[2],h=e[3],f=e[8],_=e[9],x=e[10],T=e[11];return e!==r&&(r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=s*i-f*n,r[1]=a*i-_*n,r[2]=o*i-x*n,r[3]=h*i-T*n,r[8]=s*n+f*i,r[9]=a*n+_*i,r[10]=o*n+x*i,r[11]=h*n+T*i,r}function Nme(r,e,t){const n=Math.sin(t),i=Math.cos(t),s=e[0],a=e[1],o=e[2],h=e[3],f=e[4],_=e[5],x=e[6],T=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=s*i+f*n,r[1]=a*i+_*n,r[2]=o*i+x*n,r[3]=h*i+T*n,r[4]=f*i-s*n,r[5]=_*i-a*n,r[6]=x*i-o*n,r[7]=T*i-h*n,r}function zme(r,e){const t=e[0],n=e[1],i=e[2],s=e[3],a=t+t,o=n+n,h=i+i,f=t*a,_=n*a,x=n*o,T=i*a,I=i*o,N=i*h,$=s*a,W=s*o,Y=s*h;return r[0]=1-x-N,r[1]=_+Y,r[2]=T-W,r[3]=0,r[4]=_-Y,r[5]=1-f-N,r[6]=I+$,r[7]=0,r[8]=T+W,r[9]=I-$,r[10]=1-f-x,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Hme(r,e,t,n,i,s,a){const o=1/(t-e),h=1/(i-n),f=1/(s-a);return r[0]=s*2*o,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=s*2*h,r[6]=0,r[7]=0,r[8]=(t+e)*o,r[9]=(i+n)*h,r[10]=(a+s)*f,r[11]=-1,r[12]=0,r[13]=0,r[14]=a*s*2*f,r[15]=0,r}function Vme(r,e,t,n,i){const s=1/Math.tan(e/2);if(r[0]=s/t,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=s,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,i!=null&&i!==1/0){const a=1/(n-i);r[10]=(i+n)*a,r[14]=2*i*n*a}else r[10]=-1,r[14]=-2*n;return r}const Gme=Vme;function Qme(r,e,t,n,i,s,a){const o=1/(e-t),h=1/(n-i),f=1/(s-a);return r[0]=-2*o,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*h,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*f,r[11]=0,r[12]=(e+t)*o,r[13]=(i+n)*h,r[14]=(a+s)*f,r[15]=1,r}const $me=Qme;function jme(r,e,t,n){let i,s,a,o,h,f,_,x,T,I;const N=e[0],$=e[1],W=e[2],Y=n[0],ie=n[1],ce=n[2],fe=t[0],ve=t[1],be=t[2];return Math.abs(N-fe)<Q1&&Math.abs($-ve)<Q1&&Math.abs(W-be)<Q1?Mme(r):(x=N-fe,T=$-ve,I=W-be,i=1/Math.sqrt(x*x+T*T+I*I),x*=i,T*=i,I*=i,s=ie*I-ce*T,a=ce*x-Y*I,o=Y*T-ie*x,i=Math.sqrt(s*s+a*a+o*o),i?(i=1/i,s*=i,a*=i,o*=i):(s=0,a=0,o=0),h=T*o-I*a,f=I*s-x*o,_=x*a-T*s,i=Math.sqrt(h*h+f*f+_*_),i?(i=1/i,h*=i,f*=i,_*=i):(h=0,f=0,_=0),r[0]=s,r[1]=h,r[2]=x,r[3]=0,r[4]=a,r[5]=f,r[6]=T,r[7]=0,r[8]=o,r[9]=_,r[10]=I,r[11]=0,r[12]=-(s*N+a*$+o*W),r[13]=-(h*N+f*$+_*W),r[14]=-(x*N+T*$+I*W),r[15]=1,r)}function qme(){const r=new jd(4);return jd!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0,r[3]=0),r}function Kme(r,e,t){return r[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2],r[3]=e[3]+t[3],r}function Wme(r,e,t){return r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r[3]=e[3]*t,r}function Xme(r){const e=r[0],t=r[1],n=r[2],i=r[3];return Math.sqrt(e*e+t*t+n*n+i*i)}function Jme(r){const e=r[0],t=r[1],n=r[2],i=r[3];return e*e+t*t+n*n+i*i}function Zme(r,e){const t=e[0],n=e[1],i=e[2],s=e[3];let a=t*t+n*n+i*i+s*s;return a>0&&(a=1/Math.sqrt(a)),r[0]=t*a,r[1]=n*a,r[2]=i*a,r[3]=s*a,r}function Yme(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]*e[3]}function e_e(r,e,t,n){const i=e[0],s=e[1],a=e[2],o=e[3];return r[0]=i+n*(t[0]-i),r[1]=s+n*(t[1]-s),r[2]=a+n*(t[2]-a),r[3]=o+n*(t[3]-o),r}function t_e(r,e,t){const n=e[0],i=e[1],s=e[2],a=e[3];return r[0]=t[0]*n+t[4]*i+t[8]*s+t[12]*a,r[1]=t[1]*n+t[5]*i+t[9]*s+t[13]*a,r[2]=t[2]*n+t[6]*i+t[10]*s+t[14]*a,r[3]=t[3]*n+t[7]*i+t[11]*s+t[15]*a,r}function r_e(r,e,t){const n=e[0],i=e[1],s=e[2],a=t[0],o=t[1],h=t[2],f=t[3],_=f*n+o*s-h*i,x=f*i+h*n-a*s,T=f*s+a*i-o*n,I=-a*n-o*i-h*s;return r[0]=_*f+I*-a+x*-h-T*-o,r[1]=x*f+I*-o+T*-a-_*-h,r[2]=T*f+I*-h+_*-o-x*-a,r[3]=e[3],r}(function(){const r=qme();return function(e,t,n,i,s,a){let o,h;for(t||(t=4),n||(n=0),i?h=Math.min(i*t+n,e.length):h=e.length,o=n;o<h;o+=t)r[0]=e[o],r[1]=e[o+1],r[2]=e[o+2],r[3]=e[o+3],s(r,r,a),e[o]=r[0],e[o+1]=r[1],e[o+2]=r[2],e[o+3]=r[3];return e}})();var wM;(function(r){r[r.COL0ROW0=0]="COL0ROW0",r[r.COL0ROW1=1]="COL0ROW1",r[r.COL0ROW2=2]="COL0ROW2",r[r.COL0ROW3=3]="COL0ROW3",r[r.COL1ROW0=4]="COL1ROW0",r[r.COL1ROW1=5]="COL1ROW1",r[r.COL1ROW2=6]="COL1ROW2",r[r.COL1ROW3=7]="COL1ROW3",r[r.COL2ROW0=8]="COL2ROW0",r[r.COL2ROW1=9]="COL2ROW1",r[r.COL2ROW2=10]="COL2ROW2",r[r.COL2ROW3=11]="COL2ROW3",r[r.COL3ROW0=12]="COL3ROW0",r[r.COL3ROW1=13]="COL3ROW1",r[r.COL3ROW2=14]="COL3ROW2",r[r.COL3ROW3=15]="COL3ROW3"})(wM||(wM={}));const n_e=45*Math.PI/180,i_e=1,BM=.1,CM=500,s_e=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);let f2=class extends Sme{static get IDENTITY(){return a_e()}static get ZERO(){return o_e()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return wM}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,t,n,i,s,a,o,h,f,_,x,T,I,N,$,W){return this[0]=e,this[1]=t,this[2]=n,this[3]=i,this[4]=s,this[5]=a,this[6]=o,this[7]=h,this[8]=f,this[9]=_,this[10]=x,this[11]=T,this[12]=I,this[13]=N,this[14]=$,this[15]=W,this.check()}setRowMajor(e,t,n,i,s,a,o,h,f,_,x,T,I,N,$,W){return this[0]=e,this[1]=s,this[2]=f,this[3]=I,this[4]=t,this[5]=a,this[6]=_,this[7]=N,this[8]=n,this[9]=o,this[10]=x,this[11]=$,this[12]=i,this[13]=h,this[14]=T,this[15]=W,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(s_e)}fromObject(e){return this.check()}fromQuaternion(e){return zme(this,e),this.check()}frustum(e){const{left:t,right:n,bottom:i,top:s,near:a=BM,far:o=CM}=e;return o===1/0?l_e(this,t,n,i,s,a):Hme(this,t,n,i,s,a,o),this.check()}lookAt(e){const{eye:t,center:n=[0,0,0],up:i=[0,1,0]}=e;return jme(this,t,n,i),this.check()}ortho(e){const{left:t,right:n,bottom:i,top:s,near:a=BM,far:o=CM}=e;return $me(this,t,n,i,s,a,o),this.check()}orthographic(e){const{fovy:t=n_e,aspect:n=i_e,focalDistance:i=1,near:s=BM,far:a=CM}=e;Uz(t);const o=t/2,h=i*Math.tan(o),f=h*n;return this.ortho({left:-f,right:f,bottom:-h,top:h,near:s,far:a})}perspective(e){const{fovy:t=45*Math.PI/180,aspect:n=1,near:i=.1,far:s=500}=e;return Uz(t),Gme(this,t,n,i,s),this.check()}determinant(){return Rme(this)}getScale(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[-0,-0,-0];return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[-0,-0,-0];return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const n=this.getScale(t),i=1/n[0],s=1/n[1],a=1/n[2];return e[0]=this[0]*i,e[1]=this[1]*s,e[2]=this[2]*a,e[3]=0,e[4]=this[4]*i,e[5]=this[5]*s,e[6]=this[6]*a,e[7]=0,e[8]=this[8]*i,e[9]=this[9]*s,e[10]=this[10]*a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const n=this.getScale(t),i=1/n[0],s=1/n[1],a=1/n[2];return e[0]=this[0]*i,e[1]=this[1]*s,e[2]=this[2]*a,e[3]=this[4]*i,e[4]=this[5]*s,e[5]=this[6]*a,e[6]=this[8]*i,e[7]=this[9]*s,e[8]=this[10]*a,e}transpose(){return Pme(this,this),this.check()}invert(){return Fme(this,this),this.check()}multiplyLeft(e){return kz(this,e,this),this.check()}multiplyRight(e){return kz(this,this,e),this.check()}rotateX(e){return kme(this,this,e),this.check()}rotateY(e){return Ume(this,this,e),this.check()}rotateZ(e){return Nme(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,t){return Ome(this,this,e,t),this.check()}scale(e){return Dme(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return Lme(this,this,e),this.check()}transform(e,t){return e.length===4?(t=t_e(t||[-0,-0,-0,-0],e,this),h2(t,4),t):this.transformAsPoint(e,t)}transformAsPoint(e,t){const{length:n}=e;let i;switch(n){case 2:i=mme(t||[-0,-0],e,this);break;case 3:i=Oz(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return h2(i,e.length),i}transformAsVector(e,t){let n;switch(e.length){case 2:n=_me(t||[-0,-0],e,this);break;case 3:n=yme(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return h2(n,e.length),n}transformPoint(e,t){return this.transformAsPoint(e,t)}transformVector(e,t){return this.transformAsPoint(e,t)}transformDirection(e,t){return this.transformAsVector(e,t)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,t,n){return this.identity().translate([e,t,n])}},A2,p2;function o_e(){return A2||(A2=new f2([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(A2)),A2}function a_e(){return p2||(p2=new f2,Object.freeze(p2)),p2}function Uz(r){if(r>Math.PI*2)throw Error("expected radians")}function l_e(r,e,t,n,i,s){const a=2*s/(t-e),o=2*s/(i-n),h=(t+e)/(t-e),f=(i+n)/(i-n),_=-1,x=-1,T=-2*s;return r[0]=a,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=o,r[6]=0,r[7]=0,r[8]=h,r[9]=f,r[10]=_,r[11]=x,r[12]=0,r[13]=0,r[14]=T,r[15]=0,r}function Nz(){const r=new jd(4);return jd!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function c_e(r){return r[0]=0,r[1]=0,r[2]=0,r[3]=1,r}function zz(r,e,t){t=t*.5;const n=Math.sin(t);return r[0]=n*e[0],r[1]=n*e[1],r[2]=n*e[2],r[3]=Math.cos(t),r}function Hz(r,e,t){const n=e[0],i=e[1],s=e[2],a=e[3],o=t[0],h=t[1],f=t[2],_=t[3];return r[0]=n*_+a*o+i*f-s*h,r[1]=i*_+a*h+s*o-n*f,r[2]=s*_+a*f+n*h-i*o,r[3]=a*_-n*o-i*h-s*f,r}function u_e(r,e,t){t*=.5;const n=e[0],i=e[1],s=e[2],a=e[3],o=Math.sin(t),h=Math.cos(t);return r[0]=n*h+a*o,r[1]=i*h+s*o,r[2]=s*h-i*o,r[3]=a*h-n*o,r}function h_e(r,e,t){t*=.5;const n=e[0],i=e[1],s=e[2],a=e[3],o=Math.sin(t),h=Math.cos(t);return r[0]=n*h-s*o,r[1]=i*h+a*o,r[2]=s*h+n*o,r[3]=a*h-i*o,r}function d_e(r,e,t){t*=.5;const n=e[0],i=e[1],s=e[2],a=e[3],o=Math.sin(t),h=Math.cos(t);return r[0]=n*h+i*o,r[1]=i*h-n*o,r[2]=s*h+a*o,r[3]=a*h-s*o,r}function f_e(r,e){const t=e[0],n=e[1],i=e[2];return r[0]=t,r[1]=n,r[2]=i,r[3]=Math.sqrt(Math.abs(1-t*t-n*n-i*i)),r}function g2(r,e,t,n){const i=e[0],s=e[1],a=e[2],o=e[3];let h=t[0],f=t[1],_=t[2],x=t[3],T,I,N,$,W;return T=i*h+s*f+a*_+o*x,T<0&&(T=-T,h=-h,f=-f,_=-_,x=-x),1-T>Q1?(I=Math.acos(T),W=Math.sin(I),N=Math.sin((1-n)*I)/W,$=Math.sin(n*I)/W):(N=1-n,$=n),r[0]=N*i+$*h,r[1]=N*s+$*f,r[2]=N*a+$*_,r[3]=N*o+$*x,r}function A_e(r,e){const t=e[0],n=e[1],i=e[2],s=e[3],a=t*t+n*n+i*i+s*s,o=a?1/a:0;return r[0]=-t*o,r[1]=-n*o,r[2]=-i*o,r[3]=s*o,r}function p_e(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r[3]=e[3],r}function Vz(r,e){const t=e[0]+e[4]+e[8];let n;if(t>0)n=Math.sqrt(t+1),r[3]=.5*n,n=.5/n,r[0]=(e[5]-e[7])*n,r[1]=(e[6]-e[2])*n,r[2]=(e[1]-e[3])*n;else{let i=0;e[4]>e[0]&&(i=1),e[8]>e[i*3+i]&&(i=2);const s=(i+1)%3,a=(i+2)%3;n=Math.sqrt(e[i*3+i]-e[s*3+s]-e[a*3+a]+1),r[i]=.5*n,n=.5/n,r[3]=(e[s*3+a]-e[a*3+s])*n,r[s]=(e[s*3+i]+e[i*3+s])*n,r[a]=(e[a*3+i]+e[i*3+a])*n}return r}const g_e=Kme,m_e=Wme,__e=Yme,y_e=e_e,b_e=Xme,v_e=Jme,Gz=Zme,x_e=function(){const r=Lz(),e=Dz(1,0,0),t=Dz(0,1,0);return function(n,i,s){const a=Bme(i,s);return a<-.999999?(xM(r,e,i),Eme(r)<1e-6&&xM(r,t,i),wme(r,r),zz(n,r,Math.PI),n):a>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(xM(r,i,s),n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=1+a,Gz(n,n))}}();(function(){const r=Nz(),e=Nz();return function(t,n,i,s,a,o){return g2(r,n,a,o),g2(e,i,s,o),g2(t,r,e,2*o*(1-o)),t}})(),function(){const r=Ime();return function(e,t,n,i){return r[0]=n[0],r[3]=n[1],r[6]=n[2],r[1]=i[0],r[4]=i[1],r[7]=i[2],r[2]=-t[0],r[5]=-t[1],r[8]=-t[2],Gz(e,Vz(e,r))}}();const w_e=[0,0,0,1];let B_e=class extends vM{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;super(-0,-0,-0,-0),Array.isArray(e)&&arguments.length===1?this.copy(e):this.set(e,t,n,i)}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}set(e,t,n,i){return this[0]=e,this[1]=t,this[2]=n,this[3]=i,this.check()}fromObject(e){return this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this.check()}fromMatrix3(e){return Vz(this,e),this.check()}fromAxisRotation(e,t){return zz(this,e,t),this.check()}identity(){return c_e(this),this.check()}setAxisAngle(e,t){return this.fromAxisRotation(e,t)}get ELEMENTS(){return 4}get x(){return this[0]}set x(e){this[0]=ll(e)}get y(){return this[1]}set y(e){this[1]=ll(e)}get z(){return this[2]}set z(e){this[2]=ll(e)}get w(){return this[3]}set w(e){this[3]=ll(e)}len(){return b_e(this)}lengthSquared(){return v_e(this)}dot(e){return __e(this,e)}rotationTo(e,t){return x_e(this,e,t),this.check()}add(e){return g_e(this,this,e),this.check()}calculateW(){return f_e(this,this),this.check()}conjugate(){return p_e(this,this),this.check()}invert(){return A_e(this,this),this.check()}lerp(e,t,n){return n===void 0?this.lerp(this,e,t):(y_e(this,e,t,n),this.check())}multiplyRight(e){return Hz(this,this,e),this.check()}multiplyLeft(e){return Hz(this,e,this),this.check()}normalize(){const e=this.len(),t=e>0?1/e:0;return this[0]=this[0]*t,this[1]=this[1]*t,this[2]=this[2]*t,this[3]=this[3]*t,e===0&&(this[3]=1),this.check()}rotateX(e){return u_e(this,this,e),this.check()}rotateY(e){return h_e(this,this,e),this.check()}rotateZ(e){return d_e(this,this,e),this.check()}scale(e){return m_e(this,this,e),this.check()}slerp(e,t,n){let i,s,a;switch(arguments.length){case 1:({start:i=w_e,target:s,ratio:a}=e);break;case 2:i=this,s=e,a=t;break;default:i=e,s=t,a=n}return g2(this,i,s,a),this.check()}transformVector4(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Tme;return r_e(t,e,this),h2(t,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(e,t){return this.setAxisAngle(e,t)}premultiply(e){return this.multiplyLeft(e)}multiply(e){return this.multiplyRight(e)}};const C_e={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},E_e={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};class T_e{constructor(e){xe(this,"name");xe(this,"startTime",0);xe(this,"playing",!0);xe(this,"speed",1);xe(this,"channels",[]);Object.assign(this,e)}animate(e){if(!this.playing)return;const n=(e/1e3-this.startTime)*this.speed;this.channels.forEach(i=>{let{sampler:s,target:a,path:o}=i;L_e(n,s,a,o),M_e(a,a._node)})}}class S_e{constructor(e){xe(this,"animations");this.animations=e.animations.map((t,n)=>{const i=t.name||`Animation-${n}`,s=t.samplers.map(o=>{let{input:h,interpolation:f="LINEAR",output:_}=o;return{input:Qz(e.accessors[h]),interpolation:f,output:Qz(e.accessors[_])}}),a=t.channels.map(o=>{let{sampler:h,target:f}=o;return{sampler:s[h],target:e.nodes[f.node],path:f.path}});return new T_e({name:i,channels:a})})}animate(e){this.setTime(e)}setTime(e){this.animations.forEach(t=>t.animate(e))}getAnimations(){return this.animations}}function Qz(r){if(!r._animation){const e=E_e[r.componentType],t=C_e[r.type],n=t*r.count,{buffer:i,byteOffset:s}=r.bufferView.data,a=new e(i,s+(r.byteOffset||0),n);if(t===1)r._animation=Array.from(a);else{const o=[];for(let h=0;h<a.length;h+=t)o.push(Array.from(a.slice(h,h+t)));r._animation=o}}return r._animation}const I_e=new f2;function M_e(r,e){if(e.matrix.identity(),r.translation&&e.matrix.translate(r.translation),r.rotation){const t=I_e.fromQuaternion(r.rotation);e.matrix.multiplyRight(t)}r.scale&&e.matrix.scale(r.scale)}const EM=new B_e;function P_e(r,e,t,n,i){if(e==="rotation"){EM.slerp({start:t,target:n,ratio:i});for(let s=0;s<EM.length;s++)r[e][s]=EM[s]}else for(let s=0;s<t.length;s++)r[e][s]=i*n[s]+(1-i)*t[s]}function F_e(r,e,t){let{p0:n,outTangent0:i,inTangent1:s,p1:a,tDiff:o,ratio:h}=t;for(let f=0;f<r[e].length;f++){const _=i[f]*o,x=s[f]*o;r[e][f]=(2*Math.pow(h,3)-3*Math.pow(h,2)+1)*n[f]+(Math.pow(h,3)-2*Math.pow(h,2)+h)*_+(-2*Math.pow(h,3)+3*Math.pow(h,2))*a[f]+(Math.pow(h,3)-Math.pow(h,2))*x}}function R_e(r,e,t){for(let n=0;n<t.length;n++)r[e][n]=t[n]}function L_e(r,e,t,n){let{input:i,interpolation:s,output:a}=e;const o=i[i.length-1],h=r%o,f=i.findIndex(I=>I>=h),_=Math.max(0,f-1);if(!Array.isArray(t[n]))switch(n){case"translation":t[n]=[0,0,0];break;case"rotation":t[n]=[0,0,0,1];break;case"scale":t[n]=[1,1,1];break;default:an.warn(`Bad animation path ${n}`)()}const x=i[_],T=i[f];switch(s){case"STEP":R_e(t,n,a[_]);break;case"LINEAR":if(T>x){const I=(h-x)/(T-x);P_e(t,n,a[_],a[f],I)}break;case"CUBICSPLINE":if(T>x){const I=(h-x)/(T-x),N=T-x,$=a[3*_+1],W=a[3*_+2],Y=a[3*f+0],ie=a[3*f+1];F_e(t,n,{p0:$,outTangent0:W,inTangent1:Y,p1:ie,tDiff:N,ratio:I})}break;default:an.warn(`Interpolation ${s} not supported`)();break}}const D_e=`
layout(0) positions: vec4; // in vec4 POSITION;

  #ifdef HAS_NORMALS
    in vec4 normals; // in vec4 NORMAL;
  #endif

  #ifdef HAS_TANGENTS
    in vec4 TANGENT;
  #endif

  #ifdef HAS_UV
    // in vec2 TEXCOORD_0;
    in vec2 texCoords;
  #endif

@vertex
  void main(void) {
    vec4 _NORMAL = vec4(0.);
    vec4 _TANGENT = vec4(0.);
    vec2 _TEXCOORD_0 = vec2(0.);

    #ifdef HAS_NORMALS
      _NORMAL = normals;
    #endif

    #ifdef HAS_TANGENTS
      _TANGENT = TANGENT;
    #endif

    #ifdef HAS_UV
      _TEXCOORD_0 = texCoords;
    #endif

    pbr_setPositionNormalTangentUV(positions, _NORMAL, _TANGENT, _TEXCOORD_0);
    gl_Position = u_MVPMatrix * positions;
  }

@fragment
  out vec4 fragmentColor;

  void main(void) {
    vec3 pos = pbr_vPosition;
    fragmentColor = pbr_filterColor(vec4(1.0));
  }
`,O_e=`#version 300 es

  // in vec4 POSITION;
  in vec4 positions;

  #ifdef HAS_NORMALS
    // in vec4 NORMAL;
    in vec4 normals;
  #endif

  #ifdef HAS_TANGENTS
    in vec4 TANGENT;
  #endif

  #ifdef HAS_UV
    // in vec2 TEXCOORD_0;
    in vec2 texCoords;
  #endif

  void main(void) {
    vec4 _NORMAL = vec4(0.);
    vec4 _TANGENT = vec4(0.);
    vec2 _TEXCOORD_0 = vec2(0.);

    #ifdef HAS_NORMALS
      _NORMAL = normals;
    #endif

    #ifdef HAS_TANGENTS
      _TANGENT = TANGENT;
    #endif

    #ifdef HAS_UV
      _TEXCOORD_0 = texCoords;
    #endif

    pbr_setPositionNormalTangentUV(positions, _NORMAL, _TANGENT, _TEXCOORD_0);
    gl_Position = pbrProjection.modelViewProjectionMatrix * positions;
  }
`,k_e=`#version 300 es
  out vec4 fragmentColor;

  void main(void) {
    vec3 pos = pbr_vPosition;
    fragmentColor = pbr_filterColor(vec4(1.0));
  }
`;function U_e(r,e){const{id:t,geometry:n,material:i,vertexCount:s,materialOptions:a,modelOptions:o}=e,h=Pz(r,i,n.attributes,a);an.info(4,"createGLTFModel defines: ",h.defines)();const f=[],_={depthWriteEnabled:!0,depthCompare:"less",depthFormat:"depth24plus",cullMode:"back"},x={id:t,source:D_e,vs:O_e,fs:k_e,geometry:n,topology:n.topology,vertexCount:s,modules:[gI],...o,defines:{...h.defines,...o.defines},parameters:{..._,...h.parameters,...o.parameters}},T=new lp(r,x),{camera:I,...N}={...h.uniforms,...o.uniforms,...h.bindings,...o.bindings};return T.shaderInputs.setProps({pbrMaterial:N,pbrProjection:{camera:I}}),new i3({managedResources:f,model:T})}var Vg;(function(r){r[r.POINTS=0]="POINTS",r[r.LINES=1]="LINES",r[r.LINE_LOOP=2]="LINE_LOOP",r[r.LINE_STRIP=3]="LINE_STRIP",r[r.TRIANGLES=4]="TRIANGLES",r[r.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",r[r.TRIANGLE_FAN=6]="TRIANGLE_FAN"})(Vg||(Vg={}));function N_e(r){switch(r){case Vg.POINTS:return"point-list";case Vg.LINES:return"line-list";case Vg.LINE_STRIP:return"line-strip";case Vg.TRIANGLES:return"triangle-list";case Vg.TRIANGLE_STRIP:return"triangle-strip";default:throw new Error(String(r))}}const z_e={modelOptions:{},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1};class H_e{constructor(e){xe(this,"device");xe(this,"options");xe(this,"gltf");let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.device=e,this.options={...z_e,...t}}instantiate(e){return this.gltf=TM(e),(this.gltf.scenes||[]).map(n=>this.createScene(n))}createAnimator(){return Array.isArray(this.gltf.animations)?new S_e(this.gltf):null}createScene(e){const n=(e.nodes||[]).map(s=>this.createNode(s));return new k_({id:e.name||e.id,children:n})}createNode(e){if(!e._node){const i=(e.children||[]).map(a=>this.createNode(a));e.mesh&&i.push(this.createMesh(e.mesh));const s=new k_({id:e.name||e.id,children:i});if(e.matrix)s.setMatrix(e.matrix);else{if(s.matrix.identity(),e.translation&&s.matrix.translate(e.translation),e.rotation){const a=new f2().fromQuaternion(e.rotation);s.matrix.multiplyRight(a)}e.scale&&s.matrix.scale(e.scale)}e._node=s}const t=this.gltf.nodes.find(n=>n.id===e.id);return t._node=e._node,e._node}createMesh(e){if(!e._mesh){const n=(e.primitives||[]).map((s,a)=>this.createPrimitive(s,a,e)),i=new k_({id:e.name||e.id,children:n});e._mesh=i}return e._mesh}createPrimitive(e,t,n){const i=e.name||`${n.name||n.id}-primitive-${t}`,s=N_e(e.mode||4),a=e.indices?e.indices.count:this.getVertexCount(e.attributes),o=U_e(this.device,{id:i,geometry:this.createGeometry(i,e,s),material:e.material,materialOptions:this.options,modelOptions:this.options.modelOptions,vertexCount:a});return o.bounds=[e.attributes.POSITION.min,e.attributes.POSITION.max],o}getVertexCount(e){throw new Error("getVertexCount not implemented")}createGeometry(e,t,n){const i={};for(const[s,a]of Object.entries(t.attributes)){const{components:o,size:h,value:f}=a;i[s]={size:h??o,value:f}}return new R_({id:e,topology:n,indices:t.indices.value,attributes:i})}createBuffer(e,t){e.bufferView||(e.bufferView={});const{bufferView:n}=e;return n.lumaBuffers||(n.lumaBuffers={}),n.lumaBuffers[t]||(n.lumaBuffers[t]=this.device.createBuffer({id:`from-${n.id}`,data:n.data||e.value})),n.lumaBuffers[t]}createSampler(e){return e}needsPOT(){return!1}}function TM(r){if(ArrayBuffer.isView(r)||r instanceof ArrayBuffer||r instanceof ImageBitmap)return r;if(Array.isArray(r))return r.map(TM);if(r&&typeof r=="object"){const e={};for(const t in r)e[t]=TM(r[t]);return e}return r}function V_e(r,e,t){const n=new H_e(r,t),i=n.instantiate(e),s=n.createAnimator();return{scenes:i,animator:s}}const G_e="4.3.2";async function $z(r,e,t,n){return n._parse(r,e,t,n)}function Gg(r,e){if(!r)throw new Error("loader assertion failed.")}const jz=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),qz=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);qz&&parseFloat(qz[1]);function Q_e(r){var e;globalThis.loaders||(globalThis.loaders={}),(e=globalThis.loaders).modules||(e.modules={}),Object.assign(globalThis.loaders.modules,r)}function $_e(r){var t,n;return((n=(t=globalThis.loaders)==null?void 0:t.modules)==null?void 0:n[r])||null}function j_e(){var r;return(r=globalThis._loadersgl_)!=null&&r.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.2"),globalThis._loadersgl_.version}const q_e=j_e();function K_e(r,e){if(!r)throw new Error("loaders.gl assertion failed.")}const $1=typeof process!="object"||String(process)!=="[object process]"||process.browser,SM=typeof importScripts=="function",Kz=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);Kz&&parseFloat(Kz[1]);const IM={};async function Qg(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;return e&&(r=W_e(r,e,t,n)),IM[r]=IM[r]||X_e(r),await IM[r]}function W_e(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(!t.useLocalLibraries&&r.startsWith("http"))return r;n=n||r;const i=t.modules||{};return i[n]?i[n]:$1?t.CDN?(K_e(t.CDN.startsWith("http")),`${t.CDN}/${e}@${q_e}/dist/libs/${n}`):SM?`../src/libs/${n}`:`modules/${e}/src/libs/${n}`:`modules/${e}/dist/libs/${n}`}async function X_e(r){if(r.endsWith("wasm"))return await Z_e(r);if(!$1)try{const{requireFromFile:t}=globalThis.loaders||{};return await(t==null?void 0:t(r))}catch(t){return console.error(t),null}if(SM)return importScripts(r);const e=await Y_e(r);return J_e(e,r)}function J_e(r,e){if(!$1){const{requireFromString:n}=globalThis.loaders||{};return n==null?void 0:n(r,e)}if(SM)return eval.call(globalThis,r),null;const t=document.createElement("script");t.id=e;try{t.appendChild(document.createTextNode(r))}catch{t.text=r}return document.body.appendChild(t),null}async function Z_e(r){const{readFileAsArrayBuffer:e}=globalThis.loaders||{};return $1||!e||r.startsWith("http")?await(await fetch(r)).arrayBuffer():await e(r)}async function Y_e(r){const{readFileAsText:e}=globalThis.loaders||{};return $1||!e||r.startsWith("http")?await(await fetch(r)).text():await e(r)}function e0e(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof r=="string"?r.slice(0,e):ArrayBuffer.isView(r)?Wz(r.buffer,r.byteOffset,e):r instanceof ArrayBuffer?Wz(r,0,e):""}function Wz(r,e,t){if(r.byteLength<=e+t)return"";const n=new DataView(r);let i="";for(let s=0;s<t;s++)i+=String.fromCharCode(n.getUint8(e+s));return i}function t0e(r){try{return JSON.parse(r)}catch{throw new Error(`Failed to parse JSON from data starting with "${e0e(r)}"`)}}function Xz(r,e,t){const n=t!==void 0?new Uint8Array(r).subarray(e,e+t):new Uint8Array(r).subarray(e);return new Uint8Array(n).buffer}function j1(r,e){return Gg(r>=0),Gg(e>0),r+(e-1)&~(e-1)}function r0e(r,e,t){let n;if(r instanceof ArrayBuffer)n=new Uint8Array(r);else{const i=r.byteOffset,s=r.byteLength;n=new Uint8Array(r.buffer||r.arrayBuffer,i,s)}return e.set(n,t),t+j1(n.byteLength,4)}const n0e=(vZ=globalThis.loaders)==null?void 0:vZ.parseImageNode,MM=typeof Image<"u",PM=typeof ImageBitmap<"u",FM=jz?!0:!!n0e;function i0e(r){switch(r){case"auto":return PM||MM||FM;case"imagebitmap":return PM;case"image":return MM;case"data":return FM;default:throw new Error(`@loaders.gl/images: image ${r} not supported in this environment`)}}function s0e(){if(PM)return"imagebitmap";if(MM)return"image";if(FM)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function o0e(r){const e=a0e(r);if(!e)throw new Error("Not an image");return e}function Jz(r){switch(o0e(r)){case"data":return r;case"image":case"imagebitmap":const e=document.createElement("canvas"),t=e.getContext("2d");if(!t)throw new Error("getImageData");return e.width=r.width,e.height=r.height,t.drawImage(r,0,0),t.getImageData(0,0,r.width,r.height);default:throw new Error("getImageData")}}function a0e(r){return typeof ImageBitmap<"u"&&r instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&r instanceof Image?"image":r&&typeof r=="object"&&r.data&&r.width&&r.height?"data":null}const l0e=/^data:image\/svg\+xml/,c0e=/\.svg((\?|#).*)?$/;function RM(r){return r&&(l0e.test(r)||c0e.test(r))}function u0e(r,e){if(RM(e)){let n=new TextDecoder().decode(r);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(n=unescape(encodeURIComponent(n)))}catch(s){throw new Error(s.message)}return`data:image/svg+xml;base64,${btoa(n)}`}return Zz(r,e)}function Zz(r,e){if(RM(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(r)])}async function Yz(r,e,t){const n=u0e(r,t),i=self.URL||self.webkitURL,s=typeof n!="string"&&i.createObjectURL(n);try{return await h0e(s||n,e)}finally{s&&i.revokeObjectURL(s)}}async function h0e(r,e){const t=new Image;return t.src=r,e.image&&e.image.decode&&t.decode?(await t.decode(),t):await new Promise((n,i)=>{try{t.onload=()=>n(t),t.onerror=s=>{const a=s instanceof Error?s.message:"error";i(new Error(a))}}catch(s){i(s)}})}const d0e={};let e9=!0;async function f0e(r,e,t){let n;RM(t)?n=await Yz(r,e,t):n=Zz(r,t);const i=e&&e.imagebitmap;return await A0e(n,i)}async function A0e(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if((p0e(e)||!e9)&&(e=null),e)try{return await createImageBitmap(r,e)}catch(t){console.warn(t),e9=!1}return await createImageBitmap(r)}function p0e(r){for(const e in r||d0e)return!1;return!0}function g0e(r){return!b0e(r,"ftyp",4)||!(r[8]&96)?null:m0e(r)}function m0e(r){switch(_0e(r,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function _0e(r,e,t){return String.fromCharCode(...r.slice(e,t))}function y0e(r){return[...r].map(e=>e.charCodeAt(0))}function b0e(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const n=y0e(e);for(let i=0;i<n.length;++i)if(n[i]!==r[i+t])return!1;return!0}const Vf=!1,q1=!0;function LM(r){const e=K1(r);return x0e(e)||C0e(e)||w0e(e)||B0e(e)||v0e(e)}function v0e(r){const e=new Uint8Array(r instanceof DataView?r.buffer:r),t=g0e(e);return t?{mimeType:t.mimeType,width:0,height:0}:null}function x0e(r){const e=K1(r);return e.byteLength>=24&&e.getUint32(0,Vf)===2303741511?{mimeType:"image/png",width:e.getUint32(16,Vf),height:e.getUint32(20,Vf)}:null}function w0e(r){const e=K1(r);return e.byteLength>=10&&e.getUint32(0,Vf)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,q1),height:e.getUint16(8,q1)}:null}function B0e(r){const e=K1(r);return e.byteLength>=14&&e.getUint16(0,Vf)===16973&&e.getUint32(2,q1)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,q1),height:e.getUint32(22,q1)}:null}function C0e(r){const e=K1(r);if(!(e.byteLength>=3&&e.getUint16(0,Vf)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:n,sofMarkers:i}=E0e();let s=2;for(;s+9<e.byteLength;){const a=e.getUint16(s,Vf);if(i.has(a))return{mimeType:"image/jpeg",height:e.getUint16(s+5,Vf),width:e.getUint16(s+7,Vf)};if(!n.has(a))return null;s+=2,s+=e.getUint16(s,Vf)}return null}function E0e(){const r=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)r.add(t);return{tableMarkers:r,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function K1(r){if(r instanceof DataView)return r;if(ArrayBuffer.isView(r))return new DataView(r.buffer);if(r instanceof ArrayBuffer)return new DataView(r);throw new Error("toDataView")}async function T0e(r,e){var i;const{mimeType:t}=LM(r)||{},n=(i=globalThis.loaders)==null?void 0:i.parseImageNode;return Gg(n),await n(r,t)}async function S0e(r,e,t){e=e||{};const i=(e.image||{}).type||"auto",{url:s}=t||{},a=I0e(i);let o;switch(a){case"imagebitmap":o=await f0e(r,e,s);break;case"image":o=await Yz(r,e,s);break;case"data":o=await T0e(r);break;default:Gg(!1)}return i==="data"&&(o=Jz(o)),o}function I0e(r){switch(r){case"auto":case"data":return s0e();default:return i0e(r),r}}const M0e={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:G_e,mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],parse:S0e,tests:[r=>!!LM(new DataView(r))],options:{image:{type:"auto",decode:!0}}},DM={};function P0e(r){if(DM[r]===void 0){const e=jz?R0e(r):F0e(r);DM[r]=e}return DM[r]}function F0e(r){var i,s;const e=["image/png","image/jpeg","image/gif"],t=((i=globalThis.loaders)==null?void 0:i.imageFormatsNode)||e;return!!((s=globalThis.loaders)==null?void 0:s.parseImageNode)&&t.includes(r)}function R0e(r){switch(r){case"image/avif":case"image/webp":return L0e(r);default:return!0}}function L0e(r){try{return document.createElement("canvas").toDataURL(r).indexOf(`data:${r}`)===0}catch{return!1}}function Ch(r,e){if(!r)throw new Error(e||"assert failed: gltf")}const t9={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},r9={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},n9=["SCALAR","VEC2","VEC3","VEC4"],D0e=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],O0e=new Map(D0e),k0e={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},U0e={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},N0e={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function i9(r){return n9[r-1]||n9[0]}function m2(r){const e=O0e.get(r.constructor);if(!e)throw new Error("Illegal typed array");return e}function OM(r,e){const t=N0e[r.componentType],n=k0e[r.type],i=U0e[r.componentType],s=r.count*n,a=r.count*n*i;Ch(a>=0&&a<=e.byteLength);const o=r9[r.componentType],h=t9[r.type];return{ArrayType:t,length:s,byteLength:a,componentByteSize:o,numberOfComponentsInElement:h}}function z0e(r,e,t){const n=r.bufferViews[t];Ch(n);const i=n.buffer,s=e[i];Ch(s);const a=(n.byteOffset||0)+s.byteOffset;return new Uint8Array(s.arrayBuffer,a,n.byteLength)}function H0e(r,e,t){var $,W;const n=typeof t=="number"?($=r.accessors)==null?void 0:$[t]:t;if(!n)throw new Error(`No gltf accessor ${JSON.stringify(t)}`);const i=(W=r.bufferViews)==null?void 0:W[n.bufferView||0];if(!i)throw new Error(`No gltf buffer view for accessor ${i}`);const{arrayBuffer:s,byteOffset:a}=e[i.buffer],o=(a||0)+(n.byteOffset||0)+(i.byteOffset||0),{ArrayType:h,length:f,componentByteSize:_,numberOfComponentsInElement:x}=OM(n,i),T=_*x,I=i.byteStride||T;if(typeof i.byteStride>"u"||i.byteStride===T)return new h(s,o,f);const N=new h(f);for(let Y=0;Y<n.count;Y++){const ie=new h(s,o+Y*I,x);N.set(ie,Y*x)}return N}function V0e(){return{asset:{version:"2.0",generator:"loaders.gl"},buffers:[],extensions:{},extensionsRequired:[],extensionsUsed:[]}}let tc=class{constructor(e){xe(this,"gltf");xe(this,"sourceBuffers");xe(this,"byteLength");this.gltf={json:(e==null?void 0:e.json)||V0e(),buffers:(e==null?void 0:e.buffers)||[],images:(e==null?void 0:e.images)||[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(e){return this.json[e]}getExtraData(e){return(this.json.extras||{})[e]}hasExtension(e){const t=this.getUsedExtensions().find(i=>i===e),n=this.getRequiredExtensions().find(i=>i===e);return typeof t=="string"||typeof n=="string"}getExtension(e){const t=this.getUsedExtensions().find(i=>i===e),n=this.json.extensions||{};return t?n[e]:null}getRequiredExtension(e){return this.getRequiredExtensions().find(n=>n===e)?this.getExtension(e):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(e,t){return(e.extensions||{})[t]}getScene(e){return this.getObject("scenes",e)}getNode(e){return this.getObject("nodes",e)}getSkin(e){return this.getObject("skins",e)}getMesh(e){return this.getObject("meshes",e)}getMaterial(e){return this.getObject("materials",e)}getAccessor(e){return this.getObject("accessors",e)}getTexture(e){return this.getObject("textures",e)}getSampler(e){return this.getObject("samplers",e)}getImage(e){return this.getObject("images",e)}getBufferView(e){return this.getObject("bufferViews",e)}getBuffer(e){return this.getObject("buffers",e)}getObject(e,t){if(typeof t=="object")return t;const n=this.json[e]&&this.json[e][t];if(!n)throw new Error(`glTF file error: Could not find ${e}[${t}]`);return n}getTypedArrayForBufferView(e){e=this.getBufferView(e);const t=e.buffer,n=this.gltf.buffers[t];Ch(n);const i=(e.byteOffset||0)+n.byteOffset;return new Uint8Array(n.arrayBuffer,i,e.byteLength)}getTypedArrayForAccessor(e){const t=this.getAccessor(e);return H0e(this.gltf.json,this.gltf.buffers,t)}getTypedArrayForImageData(e){e=this.getAccessor(e);const t=this.getBufferView(e.bufferView),i=this.getBuffer(t.buffer).data,s=t.byteOffset||0;return new Uint8Array(i,s,t.byteLength)}addApplicationData(e,t){return this.json[e]=t,this}addExtraData(e,t){return this.json.extras=this.json.extras||{},this.json.extras[e]=t,this}addObjectExtension(e,t,n){return e.extensions=e.extensions||{},e.extensions[t]=n,this.registerUsedExtension(t),this}setObjectExtension(e,t,n){const i=e.extensions||{};i[t]=n}removeObjectExtension(e,t){const n=(e==null?void 0:e.extensions)||{};if(n[t]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const i=this.json.extensionsRemoved;i.includes(t)||i.push(t)}delete n[t]}addExtension(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Ch(t),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=t,this.registerUsedExtension(e),t}addRequiredExtension(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Ch(t),this.addExtension(e,t),this.registerRequiredExtension(e),t}registerUsedExtension(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(t=>t===e)||this.json.extensionsUsed.push(e)}registerRequiredExtension(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(t=>t===e)||this.json.extensionsRequired.push(e)}removeExtension(e){var t;if((t=this.json.extensions)!=null&&t[e]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const n=this.json.extensionsRemoved;n.includes(e)||n.push(e)}this.json.extensions&&delete this.json.extensions[e],this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e)}setDefaultScene(e){this.json.scene=e}addScene(e){const{nodeIndices:t}=e;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:t}),this.json.scenes.length-1}addNode(e){const{meshIndex:t,matrix:n}=e;this.json.nodes=this.json.nodes||[];const i={mesh:t};return n&&(i.matrix=n),this.json.nodes.push(i),this.json.nodes.length-1}addMesh(e){const{attributes:t,indices:n,material:i,mode:s=4}=e,o={primitives:[{attributes:this._addAttributes(t),mode:s}]};if(n){const h=this._addIndices(n);o.primitives[0].indices=h}return Number.isFinite(i)&&(o.primitives[0].material=i),this.json.meshes=this.json.meshes||[],this.json.meshes.push(o),this.json.meshes.length-1}addPointCloud(e){const n={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(n),this.json.meshes.length-1}addImage(e,t){const n=LM(e),i=t||(n==null?void 0:n.mimeType),a={bufferView:this.addBufferView(e),mimeType:i};return this.json.images=this.json.images||[],this.json.images.push(a),this.json.images.length-1}addBufferView(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.byteLength;const i=e.byteLength;Ch(Number.isFinite(i)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);const s={buffer:t,byteOffset:n,byteLength:i};return this.byteLength+=j1(i,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(s),this.json.bufferViews.length-1}addAccessor(e,t){const n={bufferView:e,type:i9(t.size),componentType:t.componentType,count:t.count,max:t.max,min:t.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(n),this.json.accessors.length-1}addBinaryBuffer(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{size:3};const n=this.addBufferView(e);let i={min:t.min,max:t.max};(!i.min||!i.max)&&(i=this._getAccessorMinMax(e,t.size));const s={size:t.size,componentType:m2(e),count:Math.round(e.length/t.size),min:i.min,max:i.max};return this.addAccessor(n,Object.assign(s,t))}addTexture(e){const{imageIndex:t}=e,n={source:t};return this.json.textures=this.json.textures||[],this.json.textures.push(n),this.json.textures.length-1}addMaterial(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}createBinaryChunk(){var s,a;const e=this.byteLength,t=new ArrayBuffer(e),n=new Uint8Array(t);let i=0;for(const o of this.sourceBuffers||[])i=r0e(o,n,i);(a=(s=this.json)==null?void 0:s.buffers)!=null&&a[0]?this.json.buffers[0].byteLength=e:this.json.buffers=[{byteLength:e}],this.gltf.binary=t,this.sourceBuffers=[t],this.gltf.buffers=[{arrayBuffer:t,byteOffset:0,byteLength:t.byteLength}]}_removeStringFromArray(e,t){let n=!0;for(;n;){const i=e.indexOf(t);i>-1?e.splice(i,1):n=!1}}_addAttributes(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t={};for(const n in e){const i=e[n],s=this._getGltfAttributeName(n),a=this.addBinaryBuffer(i.value,i);t[s]=a}return t}_addIndices(e){return this.addBinaryBuffer(e,{size:1})}_getGltfAttributeName(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return e}}_getAccessorMinMax(e,t){const n={min:null,max:null};if(e.length<t)return n;n.min=[],n.max=[];const i=e.subarray(0,t);for(const s of i)n.min.push(s),n.max.push(s);for(let s=t;s<e.length;s+=t)for(let a=0;a<t;a++)n.min[0+a]=Math.min(n.min[0+a],e[s+a]),n.max[0+a]=Math.max(n.max[0+a],e[s+a]);return n}};function s9(r){return(r%1+1)%1}const o9={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16,BOOLEAN:1,STRING:1,ENUM:1},G0e={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:BigInt64Array,UINT64:BigUint64Array,FLOAT32:Float32Array,FLOAT64:Float64Array},a9={INT8:1,UINT8:1,INT16:2,UINT16:2,INT32:4,UINT32:4,INT64:8,UINT64:8,FLOAT32:4,FLOAT64:8};function kM(r,e){return a9[e]*o9[r]}function _2(r,e,t,n){if(t!=="UINT8"&&t!=="UINT16"&&t!=="UINT32"&&t!=="UINT64")return null;const i=r.getTypedArrayForBufferView(e),s=y2(i,"SCALAR",t,n+1);return s instanceof BigInt64Array||s instanceof BigUint64Array?null:s}function y2(r,e,t){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;const i=o9[e],s=G0e[t],a=a9[t],o=n*i,h=o*a;let f=r.buffer,_=r.byteOffset;return _%a!==0&&(f=new Uint8Array(f).slice(_,_+h).buffer,_=0),new s(f,_,o)}function UM(r,e,t){var f,_,x,T,I;const n=`TEXCOORD_${e.texCoord||0}`,i=t.attributes[n],s=r.getTypedArrayForAccessor(i),a=r.gltf.json,o=e.index,h=(_=(f=a.textures)==null?void 0:f[o])==null?void 0:_.source;if(typeof h<"u"){const N=(T=(x=a.images)==null?void 0:x[h])==null?void 0:T.mimeType,$=(I=r.gltf.images)==null?void 0:I[h];if($&&typeof $.width<"u"){const W=[];for(let Y=0;Y<s.length;Y+=2){const ie=Q0e($,N,s,Y,e.channels);W.push(ie)}return W}}return[]}function l9(r,e,t,n,i){if(!(t!=null&&t.length))return;const s=[];for(const _ of t){let x=n.findIndex(T=>T===_);x===-1&&(x=n.push(_)-1),s.push(x)}const a=new Uint32Array(s),o=r.gltf.buffers.push({arrayBuffer:a.buffer,byteOffset:a.byteOffset,byteLength:a.byteLength})-1,h=r.addBufferView(a,o,0),f=r.addAccessor(h,{size:1,componentType:m2(a),count:a.length});i.attributes[e]=f}function Q0e(r,e,t,n){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:[0];const s={r:{offset:0,shift:0},g:{offset:1,shift:8},b:{offset:2,shift:16},a:{offset:3,shift:24}},a=t[n],o=t[n+1];let h=1;e&&(e.indexOf("image/jpeg")!==-1||e.indexOf("image/png")!==-1)&&(h=4);const f=$0e(a,o,r,h);let _=0;for(const x of i){const T=typeof x=="number"?Object.values(s)[x]:s[x],I=f+T.offset,N=Jz(r);if(N.data.length<=I)throw new Error(`${N.data.length} <= ${I}`);const $=N.data[I];_|=$<<T.shift}return _}function $0e(r,e,t){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;const i=t.width,s=s9(r)*(i-1),a=Math.round(s),o=t.height,h=s9(e)*(o-1),f=Math.round(h),_=t.components?t.components:n;return(f*i+a)*_}function c9(r,e,t,n,i){const s=[];for(let a=0;a<e;a++){const o=t[a],h=t[a+1]-t[a];if(h+o>n)break;const f=o/i,_=h/i;s.push(r.slice(f,f+_))}return s}function u9(r,e,t){const n=[];for(let i=0;i<e;i++){const s=i*t;n.push(r.slice(s,s+t))}return n}function h9(r,e,t,n){if(t)throw new Error("Not implemented - arrayOffsets for strings is specified");if(n){const i=[],s=new TextDecoder("utf8");let a=0;for(let o=0;o<r;o++){const h=n[o+1]-n[o];if(h+a<=e.length){const f=e.subarray(a,h+a),_=s.decode(f);i.push(_),a+=h}}return i}return[]}const r0="EXT_mesh_features",j0e=r0;async function q0e(r,e){const t=new tc(r);W0e(t,e)}function K0e(r,e){const t=new tc(r);return J0e(t),t.createBinaryChunk(),t.gltf}function W0e(r,e){const t=r.gltf.json;if(t.meshes)for(const n of t.meshes)for(const i of n.primitives)X0e(r,i,e)}function X0e(r,e,t){var s,a,o;if(!((s=t==null?void 0:t.gltf)!=null&&s.loadBuffers))return;const n=(a=e.extensions)==null?void 0:a[r0],i=n==null?void 0:n.featureIds;if(i)for(const h of i){let f;if(typeof h.attribute<"u"){const _=`_FEATURE_ID_${h.attribute}`,x=e.attributes[_];f=r.getTypedArrayForAccessor(x)}else typeof h.texture<"u"&&((o=t==null?void 0:t.gltf)!=null&&o.loadImages)?f=UM(r,h.texture,e):f=[];h.data=f}}function J0e(r,e){const t=r.gltf.json.meshes;if(t)for(const n of t)for(const i of n.primitives)Y0e(r,i)}function Z0e(r,e,t,n){e.extensions||(e.extensions={});let i=e.extensions[r0];i||(i={featureIds:[]},e.extensions[r0]=i);const{featureIds:s}=i,a={featureCount:t.length,propertyTable:n,data:t};s.push(a),r.addObjectExtension(e,r0,i)}function Y0e(r,e){var i;const t=(i=e.extensions)==null?void 0:i[r0];if(!t)return;const n=t.featureIds;n.forEach((s,a)=>{if(s.data){const{accessorKey:o,index:h}=eye(e.attributes),f=new Uint32Array(s.data);n[a]={featureCount:f.length,propertyTable:s.propertyTable,attribute:h},r.gltf.buffers.push({arrayBuffer:f.buffer,byteOffset:f.byteOffset,byteLength:f.byteLength});const _=r.addBufferView(f),x=r.addAccessor(_,{size:1,componentType:m2(f),count:f.length});e.attributes[o]=x}})}function eye(r){const e="_FEATURE_ID_",t=Object.keys(r).filter(s=>s.indexOf(e)===0);let n=-1;for(const s of t){const a=Number(s.substring(e.length));a>n&&(n=a)}return n++,{accessorKey:`${e}${n}`,index:n}}const tye=Object.freeze(Object.defineProperty({__proto__:null,createExtMeshFeatures:Z0e,decode:q0e,encode:K0e,name:j0e},Symbol.toStringTag,{value:"Module"})),n0="EXT_structural_metadata",rye=n0;async function nye(r,e){const t=new tc(r);sye(t,e)}function iye(r,e){const t=new tc(r);return vye(t),t.createBinaryChunk(),t.gltf}function sye(r,e){var n,i;if(!((n=e.gltf)!=null&&n.loadBuffers))return;const t=r.getExtension(n0);t&&((i=e.gltf)!=null&&i.loadImages&&oye(r,t),aye(r,t))}function oye(r,e){const t=e.propertyTextures,n=r.gltf.json;if(t&&n.meshes)for(const i of n.meshes)for(const s of i.primitives)cye(r,t,s,e)}function aye(r,e){const t=e.schema;if(!t)return;const n=t.classes,i=e.propertyTables;if(n&&i)for(const s in n){const a=lye(i,s);a&&hye(r,t,a)}}function lye(r,e){for(const t of r)if(t.class===e)return t;return null}function cye(r,e,t,n){var a;if(!e)return;const i=(a=t.extensions)==null?void 0:a[n0],s=i==null?void 0:i.propertyTextures;if(s)for(const o of s){const h=e[o];uye(r,h,t,n)}}function uye(r,e,t,n){var s;if(!e.properties)return;n.dataAttributeNames||(n.dataAttributeNames=[]);const i=e.class;for(const a in e.properties){const o=`${i}_${a}`,h=(s=e.properties)==null?void 0:s[a];if(!h)continue;h.data||(h.data=[]);const f=h.data,_=UM(r,h,t);_!==null&&(l9(r,o,_,f,t),h.data=f,n.dataAttributeNames.push(o))}}function hye(r,e,t){var s,a;const n=(s=e.classes)==null?void 0:s[t.class];if(!n)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${t.class}`);const i=t.count;for(const o in n.properties){const h=n.properties[o],f=(a=t.properties)==null?void 0:a[o];if(f){const _=dye(r,e,h,i,f);f.data=_}}}function dye(r,e,t,n,i){let s=[];const a=i.values,o=r.getTypedArrayForBufferView(a),h=fye(r,t,i,n),f=Aye(r,i,n);switch(t.type){case"SCALAR":case"VEC2":case"VEC3":case"VEC4":case"MAT2":case"MAT3":case"MAT4":{s=pye(t,n,o,h);break}case"BOOLEAN":throw new Error(`Not implemented - classProperty.type=${t.type}`);case"STRING":{s=h9(n,o,h,f);break}case"ENUM":{s=gye(e,t,n,o,h);break}default:throw new Error(`Unknown classProperty type ${t.type}`)}return s}function fye(r,e,t,n){return e.array&&typeof e.count>"u"&&typeof t.arrayOffsets<"u"?_2(r,t.arrayOffsets,t.arrayOffsetType||"UINT32",n):null}function Aye(r,e,t){return typeof e.stringOffsets<"u"?_2(r,e.stringOffsets,e.stringOffsetType||"UINT32",t):null}function pye(r,e,t,n){const i=r.array,s=r.count,a=kM(r.type,r.componentType),o=t.byteLength/a;let h;return r.componentType?h=y2(t,r.type,r.componentType,o):h=t,i?n?c9(h,e,n,t.length,a):s?u9(h,e,s):[]:h}function gye(r,e,t,n,i){var x;const s=e.enumType;if(!s)throw new Error("Incorrect data in the EXT_structural_metadata extension: classProperty.enumType is not set for type ENUM");const a=(x=r.enums)==null?void 0:x[s];if(!a)throw new Error(`Incorrect data in the EXT_structural_metadata extension: schema.enums does't contain ${s}`);const o=a.valueType||"UINT16",h=kM(e.type,o),f=n.byteLength/h;let _=y2(n,e.type,o,f);if(_||(_=n),e.array){if(i)return mye({valuesData:_,numberOfElements:t,arrayOffsets:i,valuesDataBytesLength:n.length,elementSize:h,enumEntry:a});const T=e.count;return T?_ye(_,t,T,a):[]}return NM(_,0,t,a)}function mye(r){const{valuesData:e,numberOfElements:t,arrayOffsets:n,valuesDataBytesLength:i,elementSize:s,enumEntry:a}=r,o=[];for(let h=0;h<t;h++){const f=n[h],_=n[h+1]-n[h];if(_+f>i)break;const x=f/s,T=_/s,I=NM(e,x,T,a);o.push(I)}return o}function _ye(r,e,t,n){const i=[];for(let s=0;s<e;s++){const a=t*s,o=NM(r,a,t,n);i.push(o)}return i}function NM(r,e,t,n){const i=[];for(let s=0;s<t;s++)if(r instanceof BigInt64Array||r instanceof BigUint64Array)i.push("");else{const a=r[e+s],o=yye(n,a);o?i.push(o.name):i.push("")}return i}function yye(r,e){for(const t of r.values)if(t.value===e)return t;return null}const bye="schemaClassId";function vye(r,e){var n,i;const t=r.getExtension(n0);if(t&&t.propertyTables)for(const s of t.propertyTables){const a=s.class,o=(i=(n=t.schema)==null?void 0:n.classes)==null?void 0:i[a];s.properties&&o&&xye(s,o,r)}}function xye(r,e,t){for(const n in r.properties){const i=r.properties[n].data;if(i){const s=e.properties[n];if(s){const a=Eye(i,s,t);r.properties[n]=a}}}}function wye(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:bye,n=r.getExtension(n0);n||(n=r.addExtension(n0)),n.schema=Bye(e,t,n.schema);const i=Cye(e,t,n.schema);return n.propertyTables||(n.propertyTables=[]),n.propertyTables.push(i)-1}function Bye(r,e,t){const n=t??{id:"schema_id"},i={properties:{}};for(const s of r){const a={type:s.elementType,componentType:s.componentType};i.properties[s.name]=a}return n.classes={},n.classes[e]=i,n}function Cye(r,e,t){var a;const n={class:e,count:0};let i=0;const s=(a=t.classes)==null?void 0:a[e];for(const o of r){if(i===0&&(i=o.values.length),i!==o.values.length&&o.values.length)throw new Error("Illegal values in attributes");(s==null?void 0:s.properties[o.name])&&(n.properties||(n.properties={}),n.properties[o.name]={values:0,data:o.values})}return n.count=i,n}function Eye(r,e,t){const n={values:0};if(e.type==="STRING"){const{stringData:i,stringOffsets:s}=Iye(r);n.stringOffsets=zM(s,t),n.values=zM(i,t)}else if(e.type==="SCALAR"&&e.componentType){const i=Sye(r,e.componentType);n.values=zM(i,t)}return n}const Tye={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:Int32Array,UINT64:Uint32Array,FLOAT32:Float32Array,FLOAT64:Float64Array};function Sye(r,e){const t=[];for(const i of r)t.push(Number(i));const n=Tye[e];if(!n)throw new Error("Illegal component type");return new n(t)}function Iye(r){const e=new TextEncoder,t=[];let n=0;for(const h of r){const f=e.encode(h);n+=f.length,t.push(f)}const i=new Uint8Array(n),s=[];let a=0;for(const h of t)i.set(h,a),s.push(a),a+=h.length;s.push(a);const o=new Uint32Array(s);return{stringData:i,stringOffsets:o}}function zM(r,e){return e.gltf.buffers.push({arrayBuffer:r.buffer,byteOffset:r.byteOffset,byteLength:r.byteLength}),e.addBufferView(r)}const Mye=Object.freeze(Object.defineProperty({__proto__:null,createExtStructuralMetadata:wye,decode:nye,encode:iye,name:rye},Symbol.toStringTag,{value:"Module"})),d9="EXT_feature_metadata",Pye=d9;async function Fye(r,e){const t=new tc(r);Rye(t,e)}function Rye(r,e){var n,i;if(!((n=e.gltf)!=null&&n.loadBuffers))return;const t=r.getExtension(d9);t&&((i=e.gltf)!=null&&i.loadImages&&Lye(r,t),Dye(r,t))}function Lye(r,e){const t=e.schema;if(!t)return;const n=t.classes,{featureTextures:i}=e;if(n&&i)for(const s in n){const a=n[s],o=kye(i,s);o&&Nye(r,o,a)}}function Dye(r,e){const t=e.schema;if(!t)return;const n=t.classes,i=e.featureTables;if(n&&i)for(const s in n){const a=Oye(i,s);a&&Uye(r,t,a)}}function Oye(r,e){for(const t in r){const n=r[t];if(n.class===e)return n}return null}function kye(r,e){for(const t in r){const n=r[t];if(n.class===e)return n}return null}function Uye(r,e,t){var s,a;if(!t.class)return;const n=(s=e.classes)==null?void 0:s[t.class];if(!n)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${t.class}`);const i=t.count;for(const o in n.properties){const h=n.properties[o],f=(a=t.properties)==null?void 0:a[o];if(f){const _=zye(r,e,h,i,f);f.data=_}}}function Nye(r,e,t){var i;const n=e.class;for(const s in t.properties){const a=(i=e==null?void 0:e.properties)==null?void 0:i[s];if(a){const o=$ye(r,a,n);a.data=o}}}function zye(r,e,t,n,i){let s=[];const a=i.bufferView,o=r.getTypedArrayForBufferView(a),h=Hye(r,t,i,n),f=Vye(r,t,i,n);return t.type==="STRING"||t.componentType==="STRING"?s=h9(n,o,h,f):Gye(t)&&(s=Qye(t,n,o,h)),s}function Hye(r,e,t,n){return e.type==="ARRAY"&&typeof e.componentCount>"u"&&typeof t.arrayOffsetBufferView<"u"?_2(r,t.arrayOffsetBufferView,t.offsetType||"UINT32",n):null}function Vye(r,e,t,n){return typeof t.stringOffsetBufferView<"u"?_2(r,t.stringOffsetBufferView,t.offsetType||"UINT32",n):null}function Gye(r){const e=["UINT8","INT16","UINT16","INT32","UINT32","INT64","UINT64","FLOAT32","FLOAT64"];return e.includes(r.type)||typeof r.componentType<"u"&&e.includes(r.componentType)}function Qye(r,e,t,n){const i=r.type==="ARRAY",s=r.componentCount,a="SCALAR",o=r.componentType||r.type,h=kM(a,o),f=t.byteLength/h,_=y2(t,a,o,f);return i?n?c9(_,e,n,t.length,h):s?u9(_,e,s):[]:_}function $ye(r,e,t){const n=r.gltf.json;if(!n.meshes)return[];const i=[];for(const s of n.meshes)for(const a of s.primitives)jye(r,t,e,i,a);return i}function jye(r,e,t,n,i){const s={channels:t.channels,...t.texture},a=UM(r,s,i);a&&l9(r,e,a,n,i)}const qye=Object.freeze(Object.defineProperty({__proto__:null,decode:Fye,name:Pye},Symbol.toStringTag,{value:"Module"})),Kye="4.3.2",Wye="4.3.2",b2={TRANSCODER:"basis_transcoder.js",TRANSCODER_WASM:"basis_transcoder.wasm",ENCODER:"basis_encoder.js",ENCODER_WASM:"basis_encoder.wasm"};let f9;async function A9(r){Q_e(r.modules);const e=$_e("basis");return e||(f9||(f9=Xye(r)),await f9)}async function Xye(r){let e=null,t=null;return[e,t]=await Promise.all([await Qg(b2.TRANSCODER,"textures",r),await Qg(b2.TRANSCODER_WASM,"textures",r)]),e=e||globalThis.BASIS,await Jye(e,t)}function Jye(r,e){const t={};return e&&(t.wasmBinary=e),new Promise(n=>{r(t).then(i=>{const{BasisFile:s,initializeBasis:a}=i;a(),n({BasisFile:s})})})}let HM;async function p9(r){const e=r.modules||{};return e.basisEncoder?e.basisEncoder:(HM=HM||Zye(r),await HM)}async function Zye(r){let e=null,t=null;return[e,t]=await Promise.all([await Qg(b2.ENCODER,"textures",r),await Qg(b2.ENCODER_WASM,"textures",r)]),e=e||globalThis.BASIS,await Yye(e,t)}function Yye(r,e){const t={};return e&&(t.wasmBinary=e),new Promise(n=>{r(t).then(i=>{const{BasisFile:s,KTX2File:a,initializeBasis:o,BasisEncoder:h}=i;o(),n({BasisFile:s,KTX2File:a,BasisEncoder:h})})})}const i0={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35987,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,COMPRESSED_RGBA_ASTC_4X4_KHR:37808,COMPRESSED_RGBA_ASTC_5X4_KHR:37809,COMPRESSED_RGBA_ASTC_5X5_KHR:37810,COMPRESSED_RGBA_ASTC_6X5_KHR:37811,COMPRESSED_RGBA_ASTC_6X6_KHR:37812,COMPRESSED_RGBA_ASTC_8X5_KHR:37813,COMPRESSED_RGBA_ASTC_8X6_KHR:37814,COMPRESSED_RGBA_ASTC_8X8_KHR:37815,COMPRESSED_RGBA_ASTC_10X5_KHR:37816,COMPRESSED_RGBA_ASTC_10X6_KHR:37817,COMPRESSED_RGBA_ASTC_10X8_KHR:37818,COMPRESSED_RGBA_ASTC_10X10_KHR:37819,COMPRESSED_RGBA_ASTC_12X10_KHR:37820,COMPRESSED_RGBA_ASTC_12X12_KHR:37821,COMPRESSED_SRGB8_ALPHA8_ASTC_4X4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5X4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5X5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6X5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6X6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8X5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8X6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8X8_KHR:37847,COMPRESSED_SRGB8_ALPHA8_ASTC_10X5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10X6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10X8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_10X10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_12X10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12X12_KHR:37853,COMPRESSED_RED_RGTC1_EXT:36283,COMPRESSED_SIGNED_RED_RGTC1_EXT:36284,COMPRESSED_RED_GREEN_RGTC2_EXT:36285,COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT:36286,COMPRESSED_SRGB_S3TC_DXT1_EXT:35916,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:35919},e1e=["","WEBKIT_","MOZ_"],g9={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let v2=null;function t1e(r){if(!v2){r=r||r1e()||void 0,v2=new Set;for(const e of e1e)for(const t in g9)if(r&&r.getExtension(`${e}${t}`)){const n=g9[t];v2.add(n)}}return v2}function r1e(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}const Eh=[171,75,84,88,32,50,48,187,13,10,26,10];function n1e(r){const e=new Uint8Array(r);return!(e.byteLength<Eh.length||e[0]!==Eh[0]||e[1]!==Eh[1]||e[2]!==Eh[2]||e[3]!==Eh[3]||e[4]!==Eh[4]||e[5]!==Eh[5]||e[6]!==Eh[6]||e[7]!==Eh[7]||e[8]!==Eh[8]||e[9]!==Eh[9]||e[10]!==Eh[10]||e[11]!==Eh[11])}const i1e={etc1:{basisFormat:0,compressed:!0,format:i0.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:i0.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:i0.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:i0.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:i0.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:i0.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function s1e(r,e){if(e.basis.containerFormat==="auto"){if(n1e(r)){const n=await p9(e);return m9(n.KTX2File,r,e)}const{BasisFile:t}=await A9(e);return VM(t,r,e)}switch(e.basis.module){case"encoder":const t=await p9(e);switch(e.basis.containerFormat){case"ktx2":return m9(t.KTX2File,r,e);case"basis":default:return VM(t.BasisFile,r,e)}case"transcoder":default:const{BasisFile:n}=await A9(e);return VM(n,r,e)}}function VM(r,e,t){const n=new r(new Uint8Array(e));try{if(!n.startTranscoding())throw new Error("Failed to start basis transcoding");const i=n.getNumImages(),s=[];for(let a=0;a<i;a++){const o=n.getNumLevels(a),h=[];for(let f=0;f<o;f++)h.push(o1e(n,a,f,t));s.push(h)}return s}finally{n.close(),n.delete()}}function o1e(r,e,t,n){const i=r.getImageWidth(e,t),s=r.getImageHeight(e,t),a=r.getHasAlpha(),{compressed:o,format:h,basisFormat:f}=_9(n,a),_=r.getImageTranscodedSizeInBytes(e,t,f),x=new Uint8Array(_);if(!r.transcodeImage(x,e,t,f,0,0))throw new Error("failed to start Basis transcoding");return{width:i,height:s,data:x,compressed:o,format:h,hasAlpha:a}}function m9(r,e,t){const n=new r(new Uint8Array(e));try{if(!n.startTranscoding())throw new Error("failed to start KTX2 transcoding");const i=n.getLevels(),s=[];for(let a=0;a<i;a++)s.push(a1e(n,a,t));return[s]}finally{n.close(),n.delete()}}function a1e(r,e,t){const{alphaFlag:n,height:i,width:s}=r.getImageLevelInfo(e,0,0),{compressed:a,format:o,basisFormat:h}=_9(t,n),f=r.getImageTranscodedSizeInBytes(e,0,0,h),_=new Uint8Array(f);if(!r.transcodeImage(_,e,0,0,h,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:s,height:i,data:_,compressed:a,levelSize:f,hasAlpha:n,format:o}}function _9(r,e){let t=r&&r.basis&&r.basis.format;return t==="auto"&&(t=y9()),typeof t=="object"&&(t=e?t.alpha:t.noAlpha),t=t.toLowerCase(),i1e[t]}function y9(){const r=t1e();return r.has("astc")?"astc-4x4":r.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:r.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:r.has("etc1")?"etc1":r.has("etc2")?"etc2":"rgb565"}const l1e={...{dataType:null,batchType:null,name:"Basis",id:"basis",module:"textures",version:Wye,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},parse:s1e},s0=!0,b9=1735152710,GM=12,x2=8,c1e=1313821514,u1e=5130562,h1e=0,d1e=0,f1e=1;function A1e(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return`${String.fromCharCode(r.getUint8(e+0))}${String.fromCharCode(r.getUint8(e+1))}${String.fromCharCode(r.getUint8(e+2))}${String.fromCharCode(r.getUint8(e+3))}`}function p1e(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const n=new DataView(r),{magic:i=b9}=t,s=n.getUint32(e,!1);return s===i||s===b9}function g1e(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const n=new DataView(e),i=A1e(n,t+0),s=n.getUint32(t+4,s0),a=n.getUint32(t+8,s0);switch(Object.assign(r,{header:{byteOffset:t,byteLength:a,hasBinChunk:!1},type:i,version:s,json:{},binChunks:[]}),t+=GM,r.version){case 1:return m1e(r,n,t);case 2:return _1e(r,n,t,{});default:throw new Error(`Invalid GLB version ${r.version}. Only supports version 1 and 2.`)}}function m1e(r,e,t){Gg(r.header.byteLength>GM+x2);const n=e.getUint32(t+0,s0),i=e.getUint32(t+4,s0);return t+=x2,Gg(i===h1e),QM(r,e,t,n),t+=n,t+=$M(r,e,t,r.header.byteLength),t}function _1e(r,e,t,n){return Gg(r.header.byteLength>GM+x2),y1e(r,e,t,n),t+r.header.byteLength}function y1e(r,e,t,n){for(;t+8<=r.header.byteLength;){const i=e.getUint32(t+0,s0),s=e.getUint32(t+4,s0);switch(t+=x2,s){case c1e:QM(r,e,t,i);break;case u1e:$M(r,e,t,i);break;case d1e:n.strict||QM(r,e,t,i);break;case f1e:n.strict||$M(r,e,t,i);break}t+=j1(i,4)}return t}function QM(r,e,t,n){const i=new Uint8Array(e.buffer,t,n),a=new TextDecoder("utf8").decode(i);return r.json=JSON.parse(a),j1(n,4)}function $M(r,e,t,n){return r.header.hasBinChunk=!0,r.binChunks.push({byteOffset:t,byteLength:n,arrayBuffer:e.buffer}),j1(n,4)}function v9(r,e){if(r.startsWith("data:")||r.startsWith("http:")||r.startsWith("https:"))return r;const n=e.baseUri||e.uri;if(!n)throw new Error(`'baseUri' must be provided to resolve relative url ${r}`);return n.substr(0,n.lastIndexOf("/")+1)+r}const b1e="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",v1e="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",x1e=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),w1e=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),B1e={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},C1e={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function E1e(r,e,t,n,i){let s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"NONE";const a=await T1e();M1e(a,a.exports[C1e[i]],r,e,t,n,a.exports[B1e[s||"NONE"]])}let jM;async function T1e(){return jM||(jM=S1e()),jM}async function S1e(){let r=b1e;WebAssembly.validate(x1e)&&(r=v1e,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const e=await WebAssembly.instantiate(I1e(r),{});return await e.instance.exports.__wasm_call_ctors(),e.instance}function I1e(r){const e=new Uint8Array(r.length);for(let n=0;n<r.length;++n){const i=r.charCodeAt(n);e[n]=i>96?i-71:i>64?i-65:i>47?i+4:i>46?63:62}let t=0;for(let n=0;n<r.length;++n)e[t++]=e[n]<60?w1e[e[n]]:(e[n]-60)*64+e[++n];return e.buffer.slice(0,t)}function M1e(r,e,t,n,i,s,a){const o=r.exports.sbrk,h=n+3&-4,f=o(h*i),_=o(s.length),x=new Uint8Array(r.exports.memory.buffer);x.set(s,_);const T=e(f,n,i,_,s.length);if(T===0&&a&&a(f,h,i),t.set(x.subarray(f,f+n*i)),o(f-o(0)),T!==0)throw new Error(`Malformed buffer data: ${T}`)}const w2="EXT_meshopt_compression",P1e=w2;async function F1e(r,e){var i,s;const t=new tc(r);if(!((i=e==null?void 0:e.gltf)!=null&&i.decompressMeshes)||!((s=e.gltf)!=null&&s.loadBuffers))return;const n=[];for(const a of r.json.bufferViews||[])n.push(R1e(t,a));await Promise.all(n),t.removeExtension(w2)}async function R1e(r,e){const t=r.getObjectExtension(e,w2);if(t){const{byteOffset:n=0,byteLength:i=0,byteStride:s,count:a,mode:o,filter:h="NONE",buffer:f}=t,_=r.gltf.buffers[f],x=new Uint8Array(_.arrayBuffer,_.byteOffset+n,i),T=new Uint8Array(r.gltf.buffers[e.buffer].arrayBuffer,e.byteOffset,e.byteLength);await E1e(T,a,s,x,o,h),r.removeObjectExtension(e,w2)}}const L1e=Object.freeze(Object.defineProperty({__proto__:null,decode:F1e,name:P1e},Symbol.toStringTag,{value:"Module"})),o0="EXT_texture_webp",D1e=o0;function O1e(r,e){const t=new tc(r);if(!P0e("image/webp")){if(t.getRequiredExtensions().includes(o0))throw new Error(`gltf: Required extension ${o0} not supported by browser`);return}const{json:n}=t;for(const i of n.textures||[]){const s=t.getObjectExtension(i,o0);s&&(i.source=s.source),t.removeObjectExtension(i,o0)}t.removeExtension(o0)}const k1e=Object.freeze(Object.defineProperty({__proto__:null,name:D1e,preprocess:O1e},Symbol.toStringTag,{value:"Module"})),B2="KHR_texture_basisu",U1e=B2;function N1e(r,e){const t=new tc(r),{json:n}=t;for(const i of n.textures||[]){const s=t.getObjectExtension(i,B2);s&&(i.source=s.source,t.removeObjectExtension(i,B2))}t.removeExtension(B2)}const z1e=Object.freeze(Object.defineProperty({__proto__:null,name:U1e,preprocess:N1e},Symbol.toStringTag,{value:"Module"})),H1e={dataType:null,batchType:null,name:"Draco",id:"draco",module:"draco",version:"4.3.2",worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};function V1e(r,e,t){const n=w9(e.metadata),i=[],s=G1e(e.attributes);for(const a in r){const o=r[a],h=x9(a,o,s[a]);i.push(h)}if(t){const a=x9("indices",t);i.push(a)}return{fields:i,metadata:n}}function G1e(r){const e={};for(const t in r){const n=r[t];e[n.name||"undefined"]=n}return e}function x9(r,e,t){const n=t?w9(t.metadata):void 0;return ome(r,e,n)}function w9(r){Object.entries(r);const e={};for(const t in r)e[`${t}.string`]=JSON.stringify(r[t]);return e}const B9={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},Q1e={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},$1e=4;let j1e=class{constructor(e){xe(this,"draco");xe(this,"decoder");xe(this,"metadataQuerier");this.draco=e,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=new this.draco.DecoderBuffer;n.Init(new Int8Array(e),e.byteLength),this._disableAttributeTransforms(t);const i=this.decoder.GetEncodedGeometryType(n),s=i===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let a;switch(i){case this.draco.TRIANGULAR_MESH:a=this.decoder.DecodeBufferToMesh(n,s);break;case this.draco.POINT_CLOUD:a=this.decoder.DecodeBufferToPointCloud(n,s);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!a.ok()||!s.ptr){const T=`DRACO decompression failed: ${a.error_msg()}`;throw new Error(T)}const o=this._getDracoLoaderData(s,i,t),h=this._getMeshData(s,o,t),f=Iz(h.attributes),_=V1e(h.attributes,o,h.indices);return{loader:"draco",loaderData:o,header:{vertexCount:s.num_points(),boundingBox:f},...h,schema:_}}finally{this.draco.destroy(n),s&&this.draco.destroy(s)}}_getDracoLoaderData(e,t,n){const i=this._getTopLevelMetadata(e),s=this._getDracoAttributes(e,n);return{geometry_type:t,num_attributes:e.num_attributes(),num_points:e.num_points(),num_faces:e instanceof this.draco.Mesh?e.num_faces():0,metadata:i,attributes:s}}_getDracoAttributes(e,t){const n={};for(let i=0;i<e.num_attributes();i++){const s=this.decoder.GetAttribute(e,i),a=this._getAttributeMetadata(e,i);n[s.unique_id()]={unique_id:s.unique_id(),attribute_type:s.attribute_type(),data_type:s.data_type(),num_components:s.num_components(),byte_offset:s.byte_offset(),byte_stride:s.byte_stride(),normalized:s.normalized(),attribute_index:i,metadata:a};const o=this._getQuantizationTransform(s,t);o&&(n[s.unique_id()].quantization_transform=o);const h=this._getOctahedronTransform(s,t);h&&(n[s.unique_id()].octahedron_transform=h)}return n}_getMeshData(e,t,n){const i=this._getMeshAttributes(t,e,n);if(!i.POSITION)throw new Error("DRACO: No position attribute found.");if(e instanceof this.draco.Mesh)switch(n.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:i,indices:{value:this._getTriangleStripIndices(e),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:i,indices:{value:this._getTriangleListIndices(e),size:1}}}return{topology:"point-list",mode:0,attributes:i}}_getMeshAttributes(e,t,n){const i={};for(const s of Object.values(e.attributes)){const a=this._deduceAttributeName(s,n);s.name=a;const o=this._getAttributeValues(t,s);if(o){const{value:h,size:f}=o;i[a]={value:h,size:f,byteOffset:s.byte_offset,byteStride:s.byte_stride,normalized:s.normalized}}}return i}_getTriangleListIndices(e){const n=e.num_faces()*3,i=n*$1e,s=this.draco._malloc(i);try{return this.decoder.GetTrianglesUInt32Array(e,i,s),new Uint32Array(this.draco.HEAPF32.buffer,s,n).slice()}finally{this.draco._free(s)}}_getTriangleStripIndices(e){const t=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(e,t),W1e(t)}finally{this.draco.destroy(t)}}_getAttributeValues(e,t){const n=Q1e[t.data_type];if(!n)return console.warn(`DRACO: Unsupported attribute type ${t.data_type}`),null;const i=t.num_components,a=e.num_points()*i,o=a*n.BYTES_PER_ELEMENT,h=q1e(this.draco,n);let f;const _=this.draco._malloc(o);try{const x=this.decoder.GetAttribute(e,t.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(e,x,h,o,_),f=new n(this.draco.HEAPF32.buffer,_,a).slice()}finally{this.draco._free(_)}return{value:f,size:i}}_deduceAttributeName(e,t){const n=e.unique_id;for(const[a,o]of Object.entries(t.extraAttributes||{}))if(o===n)return a;const i=e.attribute_type;for(const a in B9)if(this.draco[a]===i)return B9[a];const s=t.attributeNameEntry||"name";return e.metadata[s]?e.metadata[s].string:`CUSTOM_ATTRIBUTE_${n}`}_getTopLevelMetadata(e){const t=this.decoder.GetMetadata(e);return this._getDracoMetadata(t)}_getAttributeMetadata(e,t){const n=this.decoder.GetAttributeMetadata(e,t);return this._getDracoMetadata(n)}_getDracoMetadata(e){if(!e||!e.ptr)return{};const t={},n=this.metadataQuerier.NumEntries(e);for(let i=0;i<n;i++){const s=this.metadataQuerier.GetEntryName(e,i);t[s]=this._getDracoMetadataField(e,s)}return t}_getDracoMetadataField(e,t){const n=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(e,t,n);const i=K1e(n);return{int:this.metadataQuerier.GetIntEntry(e,t),string:this.metadataQuerier.GetStringEntry(e,t),double:this.metadataQuerier.GetDoubleEntry(e,t),intArray:i}}finally{this.draco.destroy(n)}}_disableAttributeTransforms(e){const{quantizedAttributes:t=[],octahedronAttributes:n=[]}=e,i=[...t,...n];for(const s of i)this.decoder.SkipAttributeTransform(this.draco[s])}_getQuantizationTransform(e,t){const{quantizedAttributes:n=[]}=t,i=e.attribute_type();if(n.map(a=>this.decoder[a]).includes(i)){const a=new this.draco.AttributeQuantizationTransform;try{if(a.InitFromAttribute(e))return{quantization_bits:a.quantization_bits(),range:a.range(),min_values:new Float32Array([1,2,3]).map(o=>a.min_value(o))}}finally{this.draco.destroy(a)}}return null}_getOctahedronTransform(e,t){const{octahedronAttributes:n=[]}=t,i=e.attribute_type();if(n.map(a=>this.decoder[a]).includes(i)){const a=new this.draco.AttributeQuantizationTransform;try{if(a.InitFromAttribute(e))return{quantization_bits:a.quantization_bits()}}finally{this.draco.destroy(a)}}return null}};function q1e(r,e){switch(e){case Float32Array:return r.DT_FLOAT32;case Int8Array:return r.DT_INT8;case Int16Array:return r.DT_INT16;case Int32Array:return r.DT_INT32;case Uint8Array:return r.DT_UINT8;case Uint16Array:return r.DT_UINT16;case Uint32Array:return r.DT_UINT32;default:return r.DT_INVALID}}function K1e(r){const e=r.size(),t=new Int32Array(e);for(let n=0;n<e;n++)t[n]=r.GetValue(n);return t}function W1e(r){const e=r.size(),t=new Int32Array(e);for(let n=0;n<e;n++)t[n]=r.GetValue(n);return t}const X1e="1.5.6",J1e="1.4.1",qM=`https://www.gstatic.com/draco/versioned/decoders/${X1e}`,Xu={DECODER:"draco_wasm_wrapper.js",DECODER_WASM:"draco_decoder.wasm",FALLBACK_DECODER:"draco_decoder.js",ENCODER:"draco_encoder.js"},KM={[Xu.DECODER]:`${qM}/${Xu.DECODER}`,[Xu.DECODER_WASM]:`${qM}/${Xu.DECODER_WASM}`,[Xu.FALLBACK_DECODER]:`${qM}/${Xu.FALLBACK_DECODER}`,[Xu.ENCODER]:`https://raw.githubusercontent.com/google/draco/${J1e}/javascript/${Xu.ENCODER}`};let WM;async function Z1e(r){const e=r.modules||{};return e.draco3d?WM||(WM=e.draco3d.createDecoderModule({}).then(t=>({draco:t}))):WM||(WM=Y1e(r)),await WM}async function Y1e(r){let e,t;switch(r.draco&&r.draco.decoderType){case"js":e=await Qg(KM[Xu.FALLBACK_DECODER],"draco",r,Xu.FALLBACK_DECODER);break;case"wasm":default:[e,t]=await Promise.all([await Qg(KM[Xu.DECODER],"draco",r,Xu.DECODER),await Qg(KM[Xu.DECODER_WASM],"draco",r,Xu.DECODER_WASM)])}return e=e||globalThis.DracoDecoderModule,await ebe(e,t)}function ebe(r,e){const t={};return e&&(t.wasmBinary=e),new Promise(n=>{r({...t,onModuleLoaded:i=>n({draco:i})})})}const tbe={...H1e,parse:rbe};async function rbe(r,e){const{draco:t}=await Z1e(e),n=new j1e(t);try{return n.parseSync(r,e==null?void 0:e.draco)}finally{n.destroy()}}function nbe(r){const e={};for(const t in r){const n=r[t];if(t!=="indices"){const i=C9(n);e[t]=i}}return e}function C9(r){const{buffer:e,size:t,count:n}=ibe(r);return{value:e,size:t,byteOffset:0,count:n,type:i9(t),componentType:m2(e)}}function ibe(r){let e=r,t=1,n=0;return r&&r.value&&(e=r.value,t=r.size||1),e&&(ArrayBuffer.isView(e)||(e=sbe(e,Float32Array)),n=e.length/t),{buffer:e,size:t,count:n}}function sbe(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return r?Array.isArray(r)?new e(r):t&&!(r instanceof e)?new e(r):r:null}const yp="KHR_draco_mesh_compression",obe=yp;function abe(r,e,t){const n=new tc(r);for(const i of E9(n))n.getObjectExtension(i,yp)}async function lbe(r,e,t){var s;if(!((s=e==null?void 0:e.gltf)!=null&&s.decompressMeshes))return;const n=new tc(r),i=[];for(const a of E9(n))n.getObjectExtension(a,yp)&&i.push(ube(n,a,e,t));await Promise.all(i),n.removeExtension(yp)}function cbe(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const t=new tc(r);for(const n of t.json.meshes||[])hbe(n,e),t.addRequiredExtension(yp)}async function ube(r,e,t,n){const i=r.getObjectExtension(e,yp);if(!i)return;const s=r.getTypedArrayForBufferView(i.bufferView),a=Xz(s.buffer,s.byteOffset),o={...t};delete o["3d-tiles"];const h=await $z(a,tbe,o,n),f=nbe(h.attributes);for(const[_,x]of Object.entries(f))if(_ in e.attributes){const T=e.attributes[_],I=r.getAccessor(T);I!=null&&I.min&&(I!=null&&I.max)&&(x.min=I.min,x.max=I.max)}e.attributes=f,h.indices&&(e.indices=C9(h.indices)),r.removeObjectExtension(e,yp),dbe(e)}function hbe(r,e){var _;let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:4,n=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0;if(!n.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const s=n.DracoWriter.encodeSync({attributes:r}),a=(_=i==null?void 0:i.parseSync)==null?void 0:_.call(i,{attributes:r}),o=n._addFauxAttributes(a.attributes),h=n.addBufferView(s);return{primitives:[{attributes:o,mode:t,extensions:{[yp]:{bufferView:h,attributes:o}}}]}}function dbe(r){if(!r.attributes&&Object.keys(r.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*E9(r){for(const e of r.json.meshes||[])for(const t of e.primitives)yield t}const fbe=Object.freeze(Object.defineProperty({__proto__:null,decode:lbe,encode:cbe,name:obe,preprocess:abe},Symbol.toStringTag,{value:"Module"})),Abe={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...Abe}};const ld=globalThis.mathgl.config;function pbe(r){let{precision:e=ld.precision}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return r=gbe(r),`${parseFloat(r.toPrecision(e))}`}function C2(r){return Array.isArray(r)||ArrayBuffer.isView(r)&&!(r instanceof DataView)}function T9(r,e,t){const n=ld.EPSILON;try{if(r===e)return!0;if(C2(r)&&C2(e)){if(r.length!==e.length)return!1;for(let i=0;i<r.length;++i)if(!T9(r[i],e[i]))return!1;return!0}return r&&r.equals?r.equals(e):e&&e.equals?e.equals(r):typeof r=="number"&&typeof e=="number"?Math.abs(r-e)<=ld.EPSILON*Math.max(1,Math.abs(r),Math.abs(e)):!1}finally{ld.EPSILON=n}}function gbe(r){return Math.round(r/ld.EPSILON)*ld.EPSILON}let S9=class extends Array{clone(){return new this.constructor().copy(this)}fromArray(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;for(let n=0;n<this.ELEMENTS;++n)this[n]=e[n+t];return this.check()}toArray(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;for(let n=0;n<this.ELEMENTS;++n)e[t+n]=this[n];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:C2(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(ld)}formatString(e){let t="";for(let n=0;n<this.ELEMENTS;++n)t+=(n>0?", ":"")+pbe(this[n],e);return`${e.printTypes?this.constructor.name:""}[${t}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(!T9(this[t],e[t]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(this[t]!==e[t])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,t,n){if(n===void 0)return this.lerp(this,e,t);for(let i=0;i<this.ELEMENTS;++i){const s=e[i],a=typeof t=="number"?t:t[i];this[i]=s+n*(a-s)}return this.check()}min(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}max(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}clamp(e,t){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e[n]),t[n]);return this.check()}add(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(const i of t)for(let s=0;s<this.ELEMENTS;++s)this[s]+=i[s];return this.check()}subtract(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(const i of t)for(let s=0;s<this.ELEMENTS;++s)this[s]-=i[s];return this.check()}scale(e){if(typeof e=="number")for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;else for(let t=0;t<this.ELEMENTS&&t<e.length;++t)this[t]*=e[t];return this.check()}multiplyByScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}check(){if(ld.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let t=0;t<this.ELEMENTS;++t)e=e&&Number.isFinite(this[t]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}addScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,t){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e),t);return this.check()}get elements(){return this}};function mbe(r,e){if(r.length!==e)return!1;for(let t=0;t<r.length;++t)if(!Number.isFinite(r[t]))return!1;return!0}function Th(r){if(!Number.isFinite(r))throw new Error(`Invalid number ${JSON.stringify(r)}`);return r}function _be(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";if(ld.debug&&!mbe(r,e))throw new Error(`math.gl: ${t} some fields set to invalid numbers'`);return r}function I9(r,e){if(!r)throw new Error(`math.gl assertion ${e}`)}let ybe=class extends S9{get x(){return this[0]}set x(e){this[0]=Th(e)}get y(){return this[1]}set y(e){this[1]=Th(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let t=0;for(let n=0;n<this.ELEMENTS;++n){const i=this[n]-e[n];t+=i*i}return Th(t)}dot(e){let t=0;for(let n=0;n<this.ELEMENTS;++n)t+=this[n]*e[n];return Th(t)}normalize(){const e=this.magnitude();if(e!==0)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}multiply(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(const i of t)for(let s=0;s<this.ELEMENTS;++s)this[s]*=i[s];return this.check()}divide(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(const i of t)for(let s=0;s<this.ELEMENTS;++s)this[s]/=i[s];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return I9(e>=0&&e<this.ELEMENTS,"index is out of range"),Th(this[e])}setComponent(e,t){return I9(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=t,this.check()}addVectors(e,t){return this.copy(e).add(t)}subVectors(e,t){return this.copy(e).subtract(t)}multiplyVectors(e,t){return this.copy(e).multiply(t)}addScaledVector(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}},E2=typeof Float32Array<"u"?Float32Array:Array;function bbe(){const r=new E2(2);return E2!=Float32Array&&(r[0]=0,r[1]=0),r}function vbe(r,e,t){const n=e[0],i=e[1];return r[0]=t[0]*n+t[3]*i+t[6],r[1]=t[1]*n+t[4]*i+t[7],r}(function(){const r=bbe();return function(e,t,n,i,s,a){let o,h;for(t||(t=2),n||(n=0),i?h=Math.min(i*t+n,e.length):h=e.length,o=n;o<h;o+=t)r[0]=e[o],r[1]=e[o+1],s(r,r,a),e[o]=r[0],e[o+1]=r[1];return e}})();function xbe(r,e,t){const n=e[0],i=e[1],s=e[2],a=t[3]*n+t[7]*i+t[11]*s||1;return r[0]=(t[0]*n+t[4]*i+t[8]*s)/a,r[1]=(t[1]*n+t[5]*i+t[9]*s)/a,r[2]=(t[2]*n+t[6]*i+t[10]*s)/a,r}function wbe(r,e,t){const n=e[0],i=e[1];return r[0]=t[0]*n+t[2]*i,r[1]=t[1]*n+t[3]*i,r[2]=e[2],r}function Bbe(r,e,t){const n=e[0],i=e[1],s=e[2];return r[0]=t[0]*n+t[3]*i+t[6]*s,r[1]=t[1]*n+t[4]*i+t[7]*s,r[2]=t[2]*n+t[5]*i+t[8]*s,r[3]=e[3],r}function Cbe(){const r=new E2(3);return E2!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function Ebe(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]}function Tbe(r,e,t){const n=e[0],i=e[1],s=e[2],a=t[0],o=t[1],h=t[2];return r[0]=i*h-s*o,r[1]=s*a-n*h,r[2]=n*o-i*a,r}function Sbe(r,e,t){const n=e[0],i=e[1],s=e[2];let a=t[3]*n+t[7]*i+t[11]*s+t[15];return a=a||1,r[0]=(t[0]*n+t[4]*i+t[8]*s+t[12])/a,r[1]=(t[1]*n+t[5]*i+t[9]*s+t[13])/a,r[2]=(t[2]*n+t[6]*i+t[10]*s+t[14])/a,r}function M9(r,e,t){const n=e[0],i=e[1],s=e[2];return r[0]=n*t[0]+i*t[3]+s*t[6],r[1]=n*t[1]+i*t[4]+s*t[7],r[2]=n*t[2]+i*t[5]+s*t[8],r}function Ibe(r,e,t){const n=t[0],i=t[1],s=t[2],a=t[3],o=e[0],h=e[1],f=e[2];let _=i*f-s*h,x=s*o-n*f,T=n*h-i*o,I=i*T-s*x,N=s*_-n*T,$=n*x-i*_;const W=a*2;return _*=W,x*=W,T*=W,I*=2,N*=2,$*=2,r[0]=o+_+I,r[1]=h+x+N,r[2]=f+T+$,r}function Mbe(r,e,t,n){const i=[],s=[];return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],s[0]=i[0],s[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),s[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),r[0]=s[0]+t[0],r[1]=s[1]+t[1],r[2]=s[2]+t[2],r}function Pbe(r,e,t,n){const i=[],s=[];return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],s[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),s[1]=i[1],s[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),r[0]=s[0]+t[0],r[1]=s[1]+t[1],r[2]=s[2]+t[2],r}function Fbe(r,e,t,n){const i=[],s=[];return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],s[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),s[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),s[2]=i[2],r[0]=s[0]+t[0],r[1]=s[1]+t[1],r[2]=s[2]+t[2],r}function Rbe(r,e){const t=r[0],n=r[1],i=r[2],s=e[0],a=e[1],o=e[2],h=Math.sqrt((t*t+n*n+i*i)*(s*s+a*a+o*o)),f=h&&Ebe(r,e)/h;return Math.acos(Math.min(Math.max(f,-1),1))}(function(){const r=Cbe();return function(e,t,n,i,s,a){let o,h;for(t||(t=3),n||(n=0),i?h=Math.min(i*t+n,e.length):h=e.length,o=n;o<h;o+=t)r[0]=e[o],r[1]=e[o+1],r[2]=e[o+2],s(r,r,a),e[o]=r[0],e[o+1]=r[1],e[o+2]=r[2];return e}})();const XM=[0,0,0];let T2,Lbe=class zZ extends ybe{static get ZERO(){return T2||(T2=new zZ(0,0,0),Object.freeze(T2)),T2}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;super(-0,-0,-0),arguments.length===1&&C2(e)?this.copy(e):(ld.debug&&(Th(e),Th(t),Th(n)),this[0]=e,this[1]=t,this[2]=n)}set(e,t,n){return this[0]=e,this[1]=t,this[2]=n,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return ld.debug&&(Th(e.x),Th(e.y),Th(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=Th(e)}angle(e){return Rbe(this,e)}cross(e){return Tbe(this,this,e),this.check()}rotateX(e){let{radians:t,origin:n=XM}=e;return Mbe(this,this,n,t),this.check()}rotateY(e){let{radians:t,origin:n=XM}=e;return Pbe(this,this,n,t),this.check()}rotateZ(e){let{radians:t,origin:n=XM}=e;return Fbe(this,this,n,t),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return Sbe(this,this,e),this.check()}transformAsVector(e){return xbe(this,this,e),this.check()}transformByMatrix3(e){return M9(this,this,e),this.check()}transformByMatrix2(e){return wbe(this,this,e),this.check()}transformByQuaternion(e){return Ibe(this,this,e),this.check()}},Dbe=class extends S9{toString(){let e="[";if(ld.printRowMajor){e+="row-major:";for(let t=0;t<this.RANK;++t)for(let n=0;n<this.RANK;++n)e+=` ${this[n*this.RANK+t]}`}else{e+="column-major:";for(let t=0;t<this.ELEMENTS;++t)e+=` ${this[t]}`}return e+="]",e}getElementIndex(e,t){return t*this.RANK+e}getElement(e,t){return this[t*this.RANK+e]}setElement(e,t,n){return this[t*this.RANK+e]=Th(n),this}getColumn(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Array(this.RANK).fill(-0);const n=e*this.RANK;for(let i=0;i<this.RANK;++i)t[i]=this[n+i];return t}setColumn(e,t){const n=e*this.RANK;for(let i=0;i<this.RANK;++i)this[n+i]=t[i];return this}};function Obe(r,e){if(r===e){const t=e[1],n=e[2],i=e[5];r[1]=e[3],r[2]=e[6],r[3]=t,r[5]=e[7],r[6]=n,r[7]=i}else r[0]=e[0],r[1]=e[3],r[2]=e[6],r[3]=e[1],r[4]=e[4],r[5]=e[7],r[6]=e[2],r[7]=e[5],r[8]=e[8];return r}function kbe(r,e){const t=e[0],n=e[1],i=e[2],s=e[3],a=e[4],o=e[5],h=e[6],f=e[7],_=e[8],x=_*a-o*f,T=-_*s+o*h,I=f*s-a*h;let N=t*x+n*T+i*I;return N?(N=1/N,r[0]=x*N,r[1]=(-_*n+i*f)*N,r[2]=(o*n-i*a)*N,r[3]=T*N,r[4]=(_*t-i*h)*N,r[5]=(-o*t+i*s)*N,r[6]=I*N,r[7]=(-f*t+n*h)*N,r[8]=(a*t-n*s)*N,r):null}function Ube(r){const e=r[0],t=r[1],n=r[2],i=r[3],s=r[4],a=r[5],o=r[6],h=r[7],f=r[8];return e*(f*s-a*h)+t*(-f*i+a*o)+n*(h*i-s*o)}function P9(r,e,t){const n=e[0],i=e[1],s=e[2],a=e[3],o=e[4],h=e[5],f=e[6],_=e[7],x=e[8],T=t[0],I=t[1],N=t[2],$=t[3],W=t[4],Y=t[5],ie=t[6],ce=t[7],fe=t[8];return r[0]=T*n+I*a+N*f,r[1]=T*i+I*o+N*_,r[2]=T*s+I*h+N*x,r[3]=$*n+W*a+Y*f,r[4]=$*i+W*o+Y*_,r[5]=$*s+W*h+Y*x,r[6]=ie*n+ce*a+fe*f,r[7]=ie*i+ce*o+fe*_,r[8]=ie*s+ce*h+fe*x,r}function Nbe(r,e,t){const n=e[0],i=e[1],s=e[2],a=e[3],o=e[4],h=e[5],f=e[6],_=e[7],x=e[8],T=t[0],I=t[1];return r[0]=n,r[1]=i,r[2]=s,r[3]=a,r[4]=o,r[5]=h,r[6]=T*n+I*a+f,r[7]=T*i+I*o+_,r[8]=T*s+I*h+x,r}function zbe(r,e,t){const n=e[0],i=e[1],s=e[2],a=e[3],o=e[4],h=e[5],f=e[6],_=e[7],x=e[8],T=Math.sin(t),I=Math.cos(t);return r[0]=I*n+T*a,r[1]=I*i+T*o,r[2]=I*s+T*h,r[3]=I*a-T*n,r[4]=I*o-T*i,r[5]=I*h-T*s,r[6]=f,r[7]=_,r[8]=x,r}function F9(r,e,t){const n=t[0],i=t[1];return r[0]=n*e[0],r[1]=n*e[1],r[2]=n*e[2],r[3]=i*e[3],r[4]=i*e[4],r[5]=i*e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r}function Hbe(r,e){const t=e[0],n=e[1],i=e[2],s=e[3],a=t+t,o=n+n,h=i+i,f=t*a,_=n*a,x=n*o,T=i*a,I=i*o,N=i*h,$=s*a,W=s*o,Y=s*h;return r[0]=1-x-N,r[3]=_-Y,r[6]=T+W,r[1]=_+Y,r[4]=1-f-N,r[7]=I-$,r[2]=T-W,r[5]=I+$,r[8]=1-f-x,r}var JM;(function(r){r[r.COL0ROW0=0]="COL0ROW0",r[r.COL0ROW1=1]="COL0ROW1",r[r.COL0ROW2=2]="COL0ROW2",r[r.COL1ROW0=3]="COL1ROW0",r[r.COL1ROW1=4]="COL1ROW1",r[r.COL1ROW2=5]="COL1ROW2",r[r.COL2ROW0=6]="COL2ROW0",r[r.COL2ROW1=7]="COL2ROW1",r[r.COL2ROW2=8]="COL2ROW2"})(JM||(JM={}));const Vbe=Object.freeze([1,0,0,0,1,0,0,0,1]);let W1=class extends Dbe{static get IDENTITY(){return Qbe()}static get ZERO(){return Gbe()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return JM}constructor(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):n.length>0?this.copy([e,...n]):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}identity(){return this.copy(Vbe)}fromObject(e){return this.check()}fromQuaternion(e){return Hbe(this,e),this.check()}set(e,t,n,i,s,a,o,h,f){return this[0]=e,this[1]=t,this[2]=n,this[3]=i,this[4]=s,this[5]=a,this[6]=o,this[7]=h,this[8]=f,this.check()}setRowMajor(e,t,n,i,s,a,o,h,f){return this[0]=e,this[1]=i,this[2]=o,this[3]=t,this[4]=s,this[5]=h,this[6]=n,this[7]=a,this[8]=f,this.check()}determinant(){return Ube(this)}transpose(){return Obe(this,this),this.check()}invert(){return kbe(this,this),this.check()}multiplyLeft(e){return P9(this,e,this),this.check()}multiplyRight(e){return P9(this,this,e),this.check()}rotate(e){return zbe(this,this,e),this.check()}scale(e){return Array.isArray(e)?F9(this,this,e):F9(this,this,[e,e]),this.check()}translate(e){return Nbe(this,this,e),this.check()}transform(e,t){let n;switch(e.length){case 2:n=vbe(t||[-0,-0],e,this);break;case 3:n=M9(t||[-0,-0,-0],e,this);break;case 4:n=Bbe(t||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return _be(n,e.length),n}transformVector(e,t){return this.transform(e,t)}transformVector2(e,t){return this.transform(e,t)}transformVector3(e,t){return this.transform(e,t)}},S2,I2=null;function Gbe(){return S2||(S2=new W1([0,0,0,0,0,0,0,0,0]),Object.freeze(S2)),S2}function Qbe(){return I2||(I2=new W1,Object.freeze(I2)),I2}const M2="KHR_texture_transform",$be=M2,P2=new Lbe,jbe=new W1,qbe=new W1;async function Kbe(r,e){var s;if(!new tc(r).hasExtension(M2)||!((s=e.gltf)!=null&&s.loadBuffers))return;const i=r.json.materials||[];for(let a=0;a<i.length;a++)Wbe(a,r)}function Wbe(r,e){var s,a,o,h;const t=(s=e.json.materials)==null?void 0:s[r],n=[(a=t==null?void 0:t.pbrMetallicRoughness)==null?void 0:a.baseColorTexture,t==null?void 0:t.emissiveTexture,t==null?void 0:t.normalTexture,t==null?void 0:t.occlusionTexture,(o=t==null?void 0:t.pbrMetallicRoughness)==null?void 0:o.metallicRoughnessTexture],i=[];for(const f of n)f&&((h=f==null?void 0:f.extensions)!=null&&h[M2])&&Xbe(e,r,f,i)}function Xbe(r,e,t,n){const i=Jbe(t,n);if(!i)return;const s=r.json.meshes||[];for(const a of s)for(const o of a.primitives){const h=o.material;Number.isFinite(h)&&e===h&&Zbe(r,o,i)}}function Jbe(r,e){var a;const t=(a=r.extensions)==null?void 0:a[M2],{texCoord:n=0}=r,{texCoord:i=n}=t;if(!(e.findIndex(o=>{let[h,f]=o;return h===n&&f===i})!==-1)){const o=tve(t);return n!==i&&(r.texCoord=i),e.push([n,i]),{originalTexCoord:n,texCoord:i,matrix:o}}return null}function Zbe(r,e,t){var o,h;const{originalTexCoord:n,texCoord:i,matrix:s}=t,a=e.attributes[`TEXCOORD_${n}`];if(Number.isFinite(a)){const f=(o=r.json.accessors)==null?void 0:o[a];if(f&&f.bufferView){const _=(h=r.json.bufferViews)==null?void 0:h[f.bufferView];if(_){const{arrayBuffer:x,byteOffset:T}=r.buffers[_.buffer],I=(T||0)+(f.byteOffset||0)+(_.byteOffset||0),{ArrayType:N,length:$}=OM(f,_),W=r9[f.componentType],Y=t9[f.type],ie=_.byteStride||W*Y,ce=new Float32Array($);for(let fe=0;fe<f.count;fe++){const ve=new N(x,I+fe*ie,2);P2.set(ve[0],ve[1],1),P2.transformByMatrix3(s),ce.set([P2[0],P2[1]],fe*Y)}n===i?Ybe(f,_,r.buffers,ce):eve(i,f,e,r,ce)}}}}function Ybe(r,e,t,n){r.componentType=5126,t.push({arrayBuffer:n.buffer,byteOffset:0,byteLength:n.buffer.byteLength}),e.buffer=t.length-1,e.byteLength=n.buffer.byteLength,e.byteOffset=0,delete e.byteStride}function eve(r,e,t,n,i){n.buffers.push({arrayBuffer:i.buffer,byteOffset:0,byteLength:i.buffer.byteLength});const s=n.json.bufferViews;if(!s)return;s.push({buffer:n.buffers.length-1,byteLength:i.buffer.byteLength,byteOffset:0});const a=n.json.accessors;a&&(a.push({bufferView:(s==null?void 0:s.length)-1,byteOffset:0,componentType:5126,count:e.count,type:"VEC2"}),t.attributes[`TEXCOORD_${r}`]=a.length-1)}function tve(r){const{offset:e=[0,0],rotation:t=0,scale:n=[1,1]}=r,i=new W1().set(1,0,0,0,1,0,e[0],e[1],1),s=jbe.set(Math.cos(t),Math.sin(t),0,-Math.sin(t),Math.cos(t),0,0,0,1),a=qbe.set(n[0],0,0,0,n[1],0,0,0,1);return i.multiplyRight(s).multiplyRight(a)}const rve=Object.freeze(Object.defineProperty({__proto__:null,decode:Kbe,name:$be},Symbol.toStringTag,{value:"Module"})),$g="KHR_lights_punctual",nve=$g;async function ive(r){const e=new tc(r),{json:t}=e,n=e.getExtension($g);n&&(e.json.lights=n.lights,e.removeExtension($g));for(const i of t.nodes||[]){const s=e.getObjectExtension(i,$g);s&&(i.light=s.light),e.removeObjectExtension(i,$g)}}async function sve(r){const e=new tc(r),{json:t}=e;if(t.lights){const n=e.addExtension($g);Ch(!n.lights),n.lights=t.lights,delete t.lights}if(e.json.lights){for(const n of e.json.lights){const i=n.node;e.addObjectExtension(i,$g,n)}delete e.json.lights}}const ove=Object.freeze(Object.defineProperty({__proto__:null,decode:ive,encode:sve,name:nve},Symbol.toStringTag,{value:"Module"})),X1="KHR_materials_unlit",ave=X1;async function lve(r){const e=new tc(r),{json:t}=e;for(const n of t.materials||[])n.extensions&&n.extensions.KHR_materials_unlit&&(n.unlit=!0),e.removeObjectExtension(n,X1);e.removeExtension(X1)}function cve(r){const e=new tc(r),{json:t}=e;if(e.materials)for(const n of t.materials||[])n.unlit&&(delete n.unlit,e.addObjectExtension(n,X1,{}),e.addExtension(X1))}const uve=Object.freeze(Object.defineProperty({__proto__:null,decode:lve,encode:cve,name:ave},Symbol.toStringTag,{value:"Module"})),J1="KHR_techniques_webgl",hve=J1;async function dve(r){const e=new tc(r),{json:t}=e,n=e.getExtension(J1);if(n){const i=Ave(n,e);for(const s of t.materials||[]){const a=e.getObjectExtension(s,J1);a&&(s.technique=Object.assign({},a,i[a.technique]),s.technique.values=pve(s.technique,e)),e.removeObjectExtension(s,J1)}e.removeExtension(J1)}}async function fve(r,e){}function Ave(r,e){const{programs:t=[],shaders:n=[],techniques:i=[]}=r,s=new TextDecoder;return n.forEach(a=>{if(Number.isFinite(a.bufferView))a.code=s.decode(e.getTypedArrayForBufferView(a.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),t.forEach(a=>{a.fragmentShader=n[a.fragmentShader],a.vertexShader=n[a.vertexShader]}),i.forEach(a=>{a.program=t[a.program]}),i}function pve(r,e){const t=Object.assign({},r.values);return Object.keys(r.uniforms||{}).forEach(n=>{r.uniforms[n].value&&!(n in t)&&(t[n]=r.uniforms[n].value)}),Object.keys(t).forEach(n=>{typeof t[n]=="object"&&t[n].index!==void 0&&(t[n].texture=e.getTexture(t[n].index))}),t}const R9=[Mye,tye,L1e,k1e,z1e,fbe,ove,uve,Object.freeze(Object.defineProperty({__proto__:null,decode:dve,encode:fve,name:hve},Symbol.toStringTag,{value:"Module"})),rve,qye];function gve(r){var i;let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=arguments.length>2?arguments[2]:void 0;const n=R9.filter(s=>L9(s.name,e));for(const s of n)(i=s.preprocess)==null||i.call(s,r,e,t)}async function mve(r){var i;let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=arguments.length>2?arguments[2]:void 0;const n=R9.filter(s=>L9(s.name,e));for(const s of n)await((i=s.decode)==null?void 0:i.call(s,r,e,t))}function L9(r,e){var i;const t=((i=e==null?void 0:e.gltf)==null?void 0:i.excludeExtensions)||{};return!(r in t&&!t[r])}const ZM="KHR_binary_glTF";function _ve(r){const e=new tc(r),{json:t}=e;for(const n of t.images||[]){const i=e.getObjectExtension(n,ZM);i&&Object.assign(n,i),e.removeObjectExtension(n,ZM)}t.buffers&&t.buffers[0]&&delete t.buffers[0].uri,e.removeExtension(ZM)}const D9={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},yve={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};let bve=class{constructor(){xe(this,"idToIndexMap",{animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}});xe(this,"json")}normalize(e,t){this.json=e.json;const n=e.json;switch(n.asset&&n.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn(`glTF: Unknown version ${n.asset.version}`);return}if(!t.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(n),this._convertTopLevelObjectsToArrays(n),_ve(e),this._convertObjectIdsToArrayIndices(n),this._updateObjects(n),this._updateMaterial(n)}_addAsset(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(e){for(const t in D9)this._convertTopLevelObjectToArray(e,t)}_convertTopLevelObjectToArray(e,t){const n=e[t];if(!(!n||Array.isArray(n))){e[t]=[];for(const i in n){const s=n[i];s.id=s.id||i;const a=e[t].length;e[t].push(s),this.idToIndexMap[t][i]=a}}}_convertObjectIdsToArrayIndices(e){for(const t in D9)this._convertIdsToIndices(e,t);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));for(const t of e.textures)this._convertTextureIds(t);for(const t of e.meshes)this._convertMeshIds(t);for(const t of e.nodes)this._convertNodeIds(t);for(const t of e.scenes)this._convertSceneIds(t)}_convertTextureIds(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}_convertMeshIds(e){for(const t of e.primitives){const{attributes:n,indices:i,material:s}=t;for(const a in n)n[a]=this._convertIdToIndex(n[a],"accessor");i&&(t.indices=this._convertIdToIndex(i,"accessor")),s&&(t.material=this._convertIdToIndex(s,"material"))}}_convertNodeIds(e){e.children&&(e.children=e.children.map(t=>this._convertIdToIndex(t,"node"))),e.meshes&&(e.meshes=e.meshes.map(t=>this._convertIdToIndex(t,"mesh")))}_convertSceneIds(e){e.nodes&&(e.nodes=e.nodes.map(t=>this._convertIdToIndex(t,"node")))}_convertIdsToIndices(e,t){e[t]||(console.warn(`gltf v1: json doesn't contain attribute ${t}`),e[t]=[]);for(const n of e[t])for(const i in n){const s=n[i],a=this._convertIdToIndex(s,i);n[i]=a}}_convertIdToIndex(e,t){const n=yve[t];if(n in this.idToIndexMap){const i=this.idToIndexMap[n][e];if(!Number.isFinite(i))throw new Error(`gltf v1: failed to resolve ${t} with id ${e}`);return i}return e}_updateObjects(e){for(const t of this.json.buffers)delete t.type}_updateMaterial(e){var t,n,i;for(const s of e.materials){s.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const a=((t=s.values)==null?void 0:t.tex)||((n=s.values)==null?void 0:n.texture2d_0)||((i=s.values)==null?void 0:i.diffuseTex),o=e.textures.findIndex(h=>h.id===a);o!==-1&&(s.pbrMetallicRoughness.baseColorTexture={index:o})}}};function vve(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new bve().normalize(r,e)}async function xve(r,e){var s,a,o;let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0;return wve(r,e,t,n),vve(r,{normalize:(s=n==null?void 0:n.gltf)==null?void 0:s.normalize}),gve(r,n,i),(a=n==null?void 0:n.gltf)!=null&&a.loadBuffers&&r.json.buffers&&await Bve(r,n,i),(o=n==null?void 0:n.gltf)!=null&&o.loadImages&&await Cve(r,n,i),await mve(r,n,i),r}function wve(r,e,t,n){if(n.uri&&(r.baseUri=n.uri),e instanceof ArrayBuffer&&!p1e(e,t,n)&&(e=new TextDecoder().decode(e)),typeof e=="string")r.json=t0e(e);else if(e instanceof ArrayBuffer){const a={};t=g1e(a,e,t,n.glb),Ch(a.type==="glTF",`Invalid GLB magic string ${a.type}`),r._glb=a,r.json=a.json}else Ch(!1,"GLTF: must be ArrayBuffer or string");const i=r.json.buffers||[];if(r.buffers=new Array(i.length).fill(null),r._glb&&r._glb.header.hasBinChunk){const{binChunks:a}=r._glb;r.buffers[0]={arrayBuffer:a[0].arrayBuffer,byteOffset:a[0].byteOffset,byteLength:a[0].byteLength}}const s=r.json.images||[];r.images=new Array(s.length).fill({})}async function Bve(r,e,t){var i,s;const n=r.json.buffers||[];for(let a=0;a<n.length;++a){const o=n[a];if(o.uri){const{fetch:h}=t;Ch(h);const f=v9(o.uri,e),_=await((i=t==null?void 0:t.fetch)==null?void 0:i.call(t,f)),x=await((s=_==null?void 0:_.arrayBuffer)==null?void 0:s.call(_));r.buffers[a]={arrayBuffer:x,byteOffset:0,byteLength:x.byteLength},delete o.uri}else r.buffers[a]===null&&(r.buffers[a]={arrayBuffer:new ArrayBuffer(o.byteLength),byteOffset:0,byteLength:o.byteLength})}}async function Cve(r,e,t){const n=Eve(r),i=r.json.images||[],s=[];for(const a of n)s.push(Tve(r,i[a],a,e,t));return await Promise.all(s)}function Eve(r){const e=new Set,t=r.json.textures||[];for(const n of t)n.source!==void 0&&e.add(n.source);return Array.from(e).sort()}async function Tve(r,e,t,n,i){let s;if(e.uri&&!e.hasOwnProperty("bufferView")){const o=v9(e.uri,n),{fetch:h}=i;s=await(await h(o)).arrayBuffer(),e.bufferView={data:s}}if(Number.isFinite(e.bufferView)){const o=z0e(r.json,r.buffers,e.bufferView);s=Xz(o.buffer,o.byteOffset,o.byteLength)}Ch(s,"glTF image has no data");let a=await $z(s,[M0e,l1e],{...n,mimeType:e.mimeType,basis:n.basis||{format:y9()}},i);a&&a[0]&&(a={compressed:!0,mipmaps:!1,width:a[0].width,height:a[0].height,data:a[0]}),r.images=r.images||[],r.images[t]=a}const YM={dataType:null,batchType:null,name:"glTF",id:"gltf",module:"gltf",version:Kye,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:Sve,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0},log:console}};async function Sve(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=arguments.length>2?arguments[2]:void 0;e={...YM.options,...e},e.gltf={...YM.options.gltf,...e.gltf};const{byteOffset:n=0}=e;return await xve({},r,n,e,t)}const Ive={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Mve={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},cd={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},Pve={magFilter:cd.TEXTURE_MAG_FILTER,minFilter:cd.TEXTURE_MIN_FILTER,wrapS:cd.TEXTURE_WRAP_S,wrapT:cd.TEXTURE_WRAP_T},Fve={[cd.TEXTURE_MAG_FILTER]:cd.LINEAR,[cd.TEXTURE_MIN_FILTER]:cd.NEAREST_MIPMAP_LINEAR,[cd.TEXTURE_WRAP_S]:cd.REPEAT,[cd.TEXTURE_WRAP_T]:cd.REPEAT};function Rve(){return{id:"default-sampler",parameters:Fve}}function Lve(r){return Mve[r]}function Dve(r){return Ive[r]}let Ove=class{constructor(){xe(this,"baseUri","");xe(this,"jsonUnprocessed");xe(this,"json");xe(this,"buffers",[]);xe(this,"images",[])}postProcess(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{json:n,buffers:i=[],images:s=[]}=e,{baseUri:a=""}=e;return Ch(n),this.baseUri=a,this.buffers=i,this.images=s,this.jsonUnprocessed=n,this.json=this._resolveTree(e.json,t),this.json}_resolveTree(e){const t={...e};return this.json=t,e.bufferViews&&(t.bufferViews=e.bufferViews.map((n,i)=>this._resolveBufferView(n,i))),e.images&&(t.images=e.images.map((n,i)=>this._resolveImage(n,i))),e.samplers&&(t.samplers=e.samplers.map((n,i)=>this._resolveSampler(n,i))),e.textures&&(t.textures=e.textures.map((n,i)=>this._resolveTexture(n,i))),e.accessors&&(t.accessors=e.accessors.map((n,i)=>this._resolveAccessor(n,i))),e.materials&&(t.materials=e.materials.map((n,i)=>this._resolveMaterial(n,i))),e.meshes&&(t.meshes=e.meshes.map((n,i)=>this._resolveMesh(n,i))),e.nodes&&(t.nodes=e.nodes.map((n,i)=>this._resolveNode(n,i)),t.nodes=t.nodes.map((n,i)=>this._resolveNodeChildren(n))),e.skins&&(t.skins=e.skins.map((n,i)=>this._resolveSkin(n,i))),e.scenes&&(t.scenes=e.scenes.map((n,i)=>this._resolveScene(n,i))),typeof this.json.scene=="number"&&t.scenes&&(t.scene=t.scenes[this.json.scene]),t}getScene(e){return this._get(this.json.scenes,e)}getNode(e){return this._get(this.json.nodes,e)}getSkin(e){return this._get(this.json.skins,e)}getMesh(e){return this._get(this.json.meshes,e)}getMaterial(e){return this._get(this.json.materials,e)}getAccessor(e){return this._get(this.json.accessors,e)}getCamera(e){return this._get(this.json.cameras,e)}getTexture(e){return this._get(this.json.textures,e)}getSampler(e){return this._get(this.json.samplers,e)}getImage(e){return this._get(this.json.images,e)}getBufferView(e){return this._get(this.json.bufferViews,e)}getBuffer(e){return this._get(this.json.buffers,e)}_get(e,t){if(typeof t=="object")return t;const n=e&&e[t];return n||console.warn(`glTF file error: Could not find ${e}[${t}]`),n}_resolveScene(e,t){return{...e,id:e.id||`scene-${t}`,nodes:(e.nodes||[]).map(n=>this.getNode(n))}}_resolveNode(e,t){const n={...e,id:(e==null?void 0:e.id)||`node-${t}`};return e.mesh!==void 0&&(n.mesh=this.getMesh(e.mesh)),e.camera!==void 0&&(n.camera=this.getCamera(e.camera)),e.skin!==void 0&&(n.skin=this.getSkin(e.skin)),e.meshes!==void 0&&e.meshes.length&&(n.mesh=e.meshes.reduce((i,s)=>{const a=this.getMesh(s);return i.id=a.id,i.primitives=i.primitives.concat(a.primitives),i},{primitives:[]})),n}_resolveNodeChildren(e){return e.children&&(e.children=e.children.map(t=>this.getNode(t))),e}_resolveSkin(e,t){const n=typeof e.inverseBindMatrices=="number"?this.getAccessor(e.inverseBindMatrices):void 0;return{...e,id:e.id||`skin-${t}`,inverseBindMatrices:n}}_resolveMesh(e,t){const n={...e,id:e.id||`mesh-${t}`,primitives:[]};return e.primitives&&(n.primitives=e.primitives.map(i=>{const s={...i,attributes:{},indices:void 0,material:void 0},a=i.attributes;for(const o in a)s.attributes[o]=this.getAccessor(a[o]);return i.indices!==void 0&&(s.indices=this.getAccessor(i.indices)),i.material!==void 0&&(s.material=this.getMaterial(i.material)),s})),n}_resolveMaterial(e,t){const n={...e,id:e.id||`material-${t}`};if(n.normalTexture&&(n.normalTexture={...n.normalTexture},n.normalTexture.texture=this.getTexture(n.normalTexture.index)),n.occlusionTexture&&(n.occlusionTexture={...n.occlusionTexture},n.occlusionTexture.texture=this.getTexture(n.occlusionTexture.index)),n.emissiveTexture&&(n.emissiveTexture={...n.emissiveTexture},n.emissiveTexture.texture=this.getTexture(n.emissiveTexture.index)),n.emissiveFactor||(n.emissiveFactor=n.emissiveTexture?[1,1,1]:[0,0,0]),n.pbrMetallicRoughness){n.pbrMetallicRoughness={...n.pbrMetallicRoughness};const i=n.pbrMetallicRoughness;i.baseColorTexture&&(i.baseColorTexture={...i.baseColorTexture},i.baseColorTexture.texture=this.getTexture(i.baseColorTexture.index)),i.metallicRoughnessTexture&&(i.metallicRoughnessTexture={...i.metallicRoughnessTexture},i.metallicRoughnessTexture.texture=this.getTexture(i.metallicRoughnessTexture.index))}return n}_resolveAccessor(e,t){const n=Lve(e.componentType),i=Dve(e.type),s=n*i,a={...e,id:e.id||`accessor-${t}`,bytesPerComponent:n,components:i,bytesPerElement:s,value:void 0,bufferView:void 0,sparse:void 0};if(e.bufferView!==void 0&&(a.bufferView=this.getBufferView(e.bufferView)),a.bufferView){const o=a.bufferView.buffer,{ArrayType:h,byteLength:f}=OM(a,a.bufferView),_=(a.bufferView.byteOffset||0)+(a.byteOffset||0)+o.byteOffset;let x=o.arrayBuffer.slice(_,_+f);a.bufferView.byteStride&&(x=this._getValueFromInterleavedBuffer(o,_,a.bufferView.byteStride,a.bytesPerElement,a.count)),a.value=new h(x)}return a}_getValueFromInterleavedBuffer(e,t,n,i,s){const a=new Uint8Array(s*i);for(let o=0;o<s;o++){const h=t+o*n;a.set(new Uint8Array(e.arrayBuffer.slice(h,h+i)),o*i)}return a.buffer}_resolveTexture(e,t){return{...e,id:e.id||`texture-${t}`,sampler:typeof e.sampler=="number"?this.getSampler(e.sampler):Rve(),source:typeof e.source=="number"?this.getImage(e.source):void 0}}_resolveSampler(e,t){const n={id:e.id||`sampler-${t}`,...e,parameters:{}};for(const i in n){const s=this._enumSamplerParameter(i);s!==void 0&&(n.parameters[s]=n[i])}return n}_enumSamplerParameter(e){return Pve[e]}_resolveImage(e,t){const n={...e,id:e.id||`image-${t}`,image:null,bufferView:e.bufferView!==void 0?this.getBufferView(e.bufferView):void 0},i=this.images[t];return i&&(n.image=i),n}_resolveBufferView(e,t){const n=e.buffer,i=this.buffers[n].arrayBuffer;let s=this.buffers[n].byteOffset||0;return e.byteOffset&&(s+=e.byteOffset),{id:`bufferView-${t}`,...e,buffer:this.buffers[n],data:new Uint8Array(i,s,e.byteLength)}}_resolveCamera(e,t){const n={...e,id:e.id||`camera-${t}`};return n.perspective,n.orthographic,n}};function kve(r,e){return new Ove().postProcess(r,e)}async function Uve(r){const e=[];return r.scenes.forEach(t=>{t.traverse(n=>{Object.values(n.model.uniforms).forEach(i=>{i.loaded===!1&&e.push(i)})})}),await Nve(()=>e.some(t=>!t.loaded))}async function Nve(r){for(;r();)await new Promise(e=>requestAnimationFrame(e))}const O9=`uniform scenegraphUniforms {
  float sizeScale;
  float sizeMinPixels;
  float sizeMaxPixels;
  mat4 sceneModelMatrix;
  bool composeModelMatrix;
} scenegraph;
`,zve={name:"scenegraph",vs:O9,fs:O9,uniformTypes:{sizeScale:"f32",sizeMinPixels:"f32",sizeMaxPixels:"f32",sceneModelMatrix:"mat4x4<f32>",composeModelMatrix:"f32"}},Hve=`#version 300 es
#define SHADER_NAME scenegraph-layer-vertex-shader
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
in vec3 instanceTranslation;
in vec3 positions;
#ifdef HAS_UV
in vec2 texCoords;
#endif
#ifdef LIGHTING_PBR
#ifdef HAS_NORMALS
in vec3 normals;
#endif
#endif
out vec4 vColor;
#ifndef LIGHTING_PBR
#ifdef HAS_UV
out vec2 vTEXCOORD_0;
#endif
#endif
void main(void) {
#if defined(HAS_UV) && !defined(LIGHTING_PBR)
vTEXCOORD_0 = texCoords;
geometry.uv = texCoords;
#endif
geometry.worldPosition = instancePositions;
geometry.pickingColor = instancePickingColors;
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vec3 normal = vec3(0.0, 0.0, 1.0);
#ifdef LIGHTING_PBR
#ifdef HAS_NORMALS
normal = instanceModelMatrix * (scenegraph.sceneModelMatrix * vec4(normals, 0.0)).xyz;
#endif
#endif
float originalSize = project_size_to_pixel(scenegraph.sizeScale);
float clampedSize = clamp(originalSize, scenegraph.sizeMinPixels, scenegraph.sizeMaxPixels);
vec3 pos = (instanceModelMatrix * (scenegraph.sceneModelMatrix * vec4(positions, 1.0)).xyz) * scenegraph.sizeScale * (clampedSize / originalSize) + instanceTranslation;
if(scenegraph.composeModelMatrix) {
DECKGL_FILTER_SIZE(pos, geometry);
geometry.normal = project_normal(normal);
geometry.worldPosition += pos;
gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
}
else {
pos = project_size(pos);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, geometry.position);
geometry.normal = project_normal(normal);
}
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
#ifdef LIGHTING_PBR
pbr_vPosition = geometry.position.xyz;
#ifdef HAS_NORMALS
pbr_vNormal = geometry.normal;
#endif
#ifdef HAS_UV
pbr_vUV = texCoords;
#else
pbr_vUV = vec2(0., 0.);
#endif
geometry.uv = pbr_vUV;
#endif
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Vve=`#version 300 es
#define SHADER_NAME scenegraph-layer-fragment-shader
in vec4 vColor;
out vec4 fragColor;
#ifndef LIGHTING_PBR
#if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
in vec2 vTEXCOORD_0;
uniform sampler2D pbr_baseColorSampler;
#endif
#endif
void main(void) {
#ifdef LIGHTING_PBR
fragColor = vColor * pbr_filterColor(vec4(0));
geometry.uv = pbr_vUV;
#else
#if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
fragColor = vColor * texture(pbr_baseColorSampler, vTEXCOORD_0);
geometry.uv = vTEXCOORD_0;
#else
fragColor = vColor;
#endif
#endif
fragColor.a *= layer.opacity;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,k9=[255,255,255,255],Gve={scenegraph:{type:"object",value:null,async:!0},getScene:r=>r&&r.scenes?typeof r.scene=="object"?r.scene:r.scenes[r.scene||0]:r,getAnimator:r=>r&&r.animator,_animations:null,sizeScale:{type:"number",value:1,min:0},sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},getPosition:{type:"accessor",value:r=>r.position},getColor:{type:"accessor",value:k9},_lighting:"flat",_imageBasedLightingEnvironment:void 0,getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},loaders:[YM]};class eP extends q_{getShaders(){const e={};let t;this.props._lighting==="pbr"?(t=gI,e.LIGHTING_PBR=1):t={name:"pbrMaterial"};const n=[LI,VI,zve,t];return super.getShaders({defines:e,vs:Hve,fs:Vve,modules:n})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),accessor:"getPosition",transition:!0},instanceColors:{type:"unorm8",size:this.props.colorFormat.length,accessor:"getColor",defaultValue:k9,transition:!0},instanceModelMatrix:Ez})}updateState(e){super.updateState(e);const{props:t,oldProps:n}=e;t.scenegraph!==n.scenegraph?this._updateScenegraph():t._animations!==n._animations&&this._applyAnimationsProp(this.state.animator,t._animations)}finalizeState(e){var t;super.finalizeState(e),(t=this.state.scenegraph)==null||t.destroy()}get isLoaded(){var e;return!!((e=this.state)!=null&&e.scenegraph&&super.isLoaded)}_updateScenegraph(){var o;const e=this.props,{device:t}=this.context;let n=null;if(e.scenegraph instanceof Sw)n={scenes:[e.scenegraph]};else if(e.scenegraph&&typeof e.scenegraph=="object"){const h=e.scenegraph,f=h.json?kve(h):h,_=V_e(t,f,this._getModelOptions());n={gltf:f,..._},Uve(_).then(()=>{this.setNeedsRedraw()}).catch(x=>{this.raiseError(x,"loading glTF")})}const i={layer:this,device:this.context.device},s=e.getScene(n,i),a=e.getAnimator(n,i);if(s instanceof k_){(o=this.state.scenegraph)==null||o.destroy(),this._applyAnimationsProp(a,e._animations);const h=[];s.traverse(f=>{f instanceof i3&&h.push(f.model)}),this.setState({scenegraph:s,animator:a,models:h}),this.getAttributeManager().invalidateAll()}else s!==null&&Es.warn("invalid scenegraph:",s)()}_applyAnimationsProp(e,t){if(!e||!t)return;const n=e.getAnimations();Object.keys(t).sort().forEach(i=>{const s=t[i];if(i==="*")n.forEach(a=>{Object.assign(a,s)});else if(Number.isFinite(Number(i))){const a=Number(i);a>=0&&a<n.length?Object.assign(n[a],s):Es.warn(`animation ${i} not found`)()}else{const a=n.find(o=>{let{name:h}=o;return h===i});a?Object.assign(a,s):Es.warn(`animation ${i} not found`)()}})}_getModelOptions(){const{_imageBasedLightingEnvironment:e}=this.props;let t;return e&&(typeof e=="function"?t=e({gl:this.context.gl,layer:this}):t=e),{imageBasedLightingEnvironment:t,modelOptions:{id:this.props.id,isInstanced:!0,bufferLayout:this.getAttributeManager().getBufferLayouts(),...this.getShaders()},useTangents:!1}}draw(e){let{context:t}=e;if(!this.state.scenegraph)return;this.props._animations&&this.state.animator&&(this.state.animator.animate(t.timeline.getTime()),this.setNeedsRedraw());const{viewport:n,renderPass:i}=this.context,{sizeScale:s,sizeMinPixels:a,sizeMaxPixels:o,coordinateSystem:h}=this.props,f=this.getNumInstances();this.state.scenegraph.traverse((_,x)=>{let{worldMatrix:T}=x;if(_ instanceof i3){const{model:I}=_;I.setInstanceCount(f);const N={camera:I.uniforms.cameraPosition},$={sizeScale:s,sizeMinPixels:a,sizeMaxPixels:o,composeModelMatrix:Tz(n,h),sceneModelMatrix:T};I.shaderInputs.setProps({pbrProjection:N,scenegraph:$}),I.draw(i)}})}}eP.defaultProps=Gve,eP.layerName="ScenegraphLayer";const U9=`uniform meshUniforms {
  bool pickFeatureIds;
} mesh;
`,Qve={name:"mesh",vs:U9,fs:U9,uniformTypes:{pickFeatureIds:"f32"}},$ve=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec4 uvRegions;
in vec3 featureIdsPickingColors;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;
vec2 applyUVRegion(vec2 uv) {
#ifdef HAS_UV_REGIONS
return fract(uv) * (uvRegions.zw - uvRegions.xy) + uvRegions.xy;
#else
return uv;
#endif
}
void main(void) {
vec2 uv = applyUVRegion(texCoords);
geometry.uv = uv;
if (mesh.pickFeatureIds) {
geometry.pickingColor = featureIdsPickingColors;
} else {
geometry.pickingColor = instancePickingColors;
}
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vTexCoord = uv;
cameraPosition = project.cameraPosition;
vColor = vec4(colors * instanceColors.rgb, instanceColors.a);
vec3 pos = (instanceModelMatrix * positions) * simpleMesh.sizeScale;
vec3 projectedPosition = project_position(positions);
position_commonspace = vec4(projectedPosition, 1.0);
gl_Position = project_common_position_to_clipspace(position_commonspace);
geometry.position = position_commonspace;
normals_commonspace = project_normal(instanceModelMatrix * normals);
geometry.normal = normals_commonspace;
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
#ifdef MODULE_PBRMATERIAL
pbr_vPosition = geometry.position.xyz;
#ifdef HAS_NORMALS
pbr_vNormal = geometry.normal;
#endif
#ifdef HAS_UV
pbr_vUV = uv;
#else
pbr_vUV = vec2(0., 0.);
#endif
geometry.uv = pbr_vUV;
#endif
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,jve=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs
precision highp float;
uniform sampler2D sampler;
in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
#ifdef MODULE_PBRMATERIAL
fragColor = vColor * pbr_filterColor(vec4(0));
geometry.uv = pbr_vUV;
fragColor.a *= layer.opacity;
#else
geometry.uv = vTexCoord;
vec3 normal;
if (simpleMesh.flatShading) {
normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
} else {
normal = normals_commonspace;
}
vec4 color = simpleMesh.hasTexture ? texture(sampler, vTexCoord) : vColor;
vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
fragColor = vec4(lightColor, color.a * layer.opacity);
#endif
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;function qve(r){const e=r.positions||r.POSITION,t=e.value.length/e.size;r.COLOR_0||r.colors||(r.colors={size:4,value:new Uint8Array(t*4).fill(255),normalized:!0})}const Kve={pbrMaterial:{type:"object",value:null},featureIds:{type:"array",value:null,optional:!0}};class tP extends bM{getShaders(){const e=super.getShaders();return e.modules.push(gI,Qve),{...e,vs:$ve,fs:jve}}initializeState(){const{featureIds:e}=this.props;super.initializeState();const t=this.getAttributeManager();e&&t.add({featureIdsPickingColors:{type:"uint8",size:3,noAlloc:!0,update:this.calculateFeatureIdsPickingColors}})}updateState(e){super.updateState(e);const{props:t,oldProps:n}=e;t.pbrMaterial!==n.pbrMaterial&&this.updatePbrMaterialUniforms(t.pbrMaterial)}draw(e){const{featureIds:t}=this.props,{model:n}=this.state;if(!n)return;const i={pickFeatureIds:!!t},s={camera:n.uniforms.cameraPosition};n.shaderInputs.setProps({pbrProjection:s,mesh:i}),super.draw(e)}getModel(e){const{id:t}=this.props,n=this.parseMaterial(this.props.pbrMaterial,e);this.setState({parsedPBRMaterial:n});const i=this.getShaders();return qve(e.attributes),new lp(this.context.device,{...this.getShaders(),id:t,geometry:e,bufferLayout:this.getAttributeManager().getBufferLayouts(),defines:{...i.defines,...n==null?void 0:n.defines,HAS_UV_REGIONS:e.attributes.uvRegions?1:0},parameters:n==null?void 0:n.parameters,isInstanced:!0})}updatePbrMaterialUniforms(e){const{model:t}=this.state;if(t){const{mesh:n}=this.props,i=this.parseMaterial(e,n);this.setState({parsedPBRMaterial:i});const{pbr_baseColorSampler:s}=i.bindings,{emptyTexture:a}=this.state,o={sampler:s||a,hasTexture:!!s},{camera:h,...f}={...i.bindings,...i.uniforms};t.shaderInputs.setProps({simpleMesh:o,pbrMaterial:f})}}parseMaterial(e,t){const n=!!(e.pbrMetallicRoughness&&e.pbrMetallicRoughness.baseColorTexture);return Pz(this.context.device,{unlit:n,...e},{NORMAL:t.attributes.normals,TEXCOORD_0:t.attributes.texCoords},{pbrDebug:!1,lights:!0,useTangents:!1})}calculateFeatureIdsPickingColors(e){const t=this.props.featureIds,n=new Uint8ClampedArray(t.length*e.size),i=[];for(let s=0;s<t.length;s++)this.encodePickingColor(t[s],i),n[s*3]=i[0],n[s*3+1]=i[1],n[s*3+2]=i[2];e.value=n}finalizeState(e){var t;super.finalizeState(e),(t=this.state.parsedPBRMaterial)==null||t.generatedTextures.forEach(n=>n.destroy()),this.setState({parsedPBRMaterial:null})}}tP.layerName="MeshLayer",tP.defaultProps=Kve;const Wve=6378137,Xve=6378137,Jve=6356752314245179e-9;function F2(r){return r}new yr;function Zve(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:F2;return"longitude"in r?(e[0]=t(r.longitude),e[1]=t(r.latitude),e[2]=r.height):"x"in r?(e[0]=t(r.x),e[1]=t(r.y),e[2]=r.z):(e[0]=t(r[0]),e[1]=t(r[1]),e[2]=r[2]),e}function Yve(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return Zve(r,e,Fl._cartographicRadians?F2:hpe)}function exe(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:F2;return"longitude"in e?(e.longitude=t(r[0]),e.latitude=t(r[1]),e.height=r[2]):"x"in e?(e.x=t(r[0]),e.y=t(r[1]),e.z=r[2]):(e[0]=t(r[0]),e[1]=t(r[1]),e[2]=r[2]),e}function txe(r,e){return exe(r,e,Fl._cartographicRadians?F2:dpe)}const N9=1e-14,rxe=new yr,z9={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},rP={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},Z1={east:new yr,north:new yr,up:new yr,west:new yr,south:new yr,down:new yr},nxe=new yr,ixe=new yr,sxe=new yr;function H9(r,e,t,n,i,s){const a=z9[e]&&z9[e][t];Gd(a&&(!n||n===a));let o,h,f;const _=rxe.copy(i);if(gp(_.x,0,N9)&&gp(_.y,0,N9)){const T=Math.sign(_.z);o=nxe.fromArray(rP[e]),e!=="east"&&e!=="west"&&o.scale(T),h=ixe.fromArray(rP[t]),t!=="east"&&t!=="west"&&h.scale(T),f=sxe.fromArray(rP[n]),n!=="east"&&n!=="west"&&f.scale(T)}else{const{up:T,east:I,north:N}=Z1;I.set(-_.y,_.x,0).normalize(),r.geodeticSurfaceNormal(_,T),N.copy(T).cross(I);const{down:$,west:W,south:Y}=Z1;$.copy(T).scale(-1),W.copy(I).scale(-1),Y.copy(N).scale(-1),o=Z1[e],h=Z1[t],f=Z1[n]}return s[0]=o.x,s[1]=o.y,s[2]=o.z,s[3]=0,s[4]=h.x,s[5]=h.y,s[6]=h.z,s[7]=0,s[8]=f.x,s[9]=f.y,s[10]=f.z,s[11]=0,s[12]=_.x,s[13]=_.y,s[14]=_.z,s[15]=1,s}const a0=new yr,oxe=new yr,axe=new yr;function lxe(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];const{oneOverRadii:n,oneOverRadiiSquared:i,centerToleranceSquared:s}=e;a0.from(r);const a=a0.x,o=a0.y,h=a0.z,f=n.x,_=n.y,x=n.z,T=a*a*f*f,I=o*o*_*_,N=h*h*x*x,$=T+I+N,W=Math.sqrt(1/$);if(!Number.isFinite(W))return;const Y=oxe;if(Y.copy(r).scale(W),$<s)return Y.to(t);const ie=i.x,ce=i.y,fe=i.z,ve=axe;ve.set(Y.x*ie*2,Y.y*ce*2,Y.z*fe*2);let be=(1-W)*a0.len()/(.5*ve.len()),Qe=0,Ue,st,at,Le;do{be-=Qe,Ue=1/(1+be*ie),st=1/(1+be*ce),at=1/(1+be*fe);const ze=Ue*Ue,tt=st*st,Ne=at*at,Ht=ze*Ue,Vt=tt*st,Jt=Ne*at;Le=T*ze+I*tt+N*Ne-1;const er=-2*(T*Ht*ie+I*Vt*ce+N*Jt*fe);Qe=Le/er}while(Math.abs(Le)>Oge);return a0.scale([Ue,st,at]).to(t)}const R2=new yr,V9=new yr,cxe=new yr,qd=new yr,uxe=new yr,L2=new yr;let Ao=class{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;this.centerToleranceSquared=Dge,Gd(e>=0),Gd(t>=0),Gd(n>=0),this.radii=new yr(e,t,n),this.radiiSquared=new yr(e*e,t*t,n*n),this.radiiToTheFourth=new yr(e*e*e*e,t*t*t*t,n*n*n*n),this.oneOverRadii=new yr(e===0?0:1/e,t===0?0:1/t,n===0?0:1/n),this.oneOverRadiiSquared=new yr(e===0?0:1/(e*e),t===0?0:1/(t*t),n===0?0:1/(n*n)),this.minimumRadius=Math.min(e,t,n),this.maximumRadius=Math.max(e,t,n),this.radiiSquared.z!==0&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}equals(e){return this===e||!!(e&&this.radii.equals(e.radii))}toString(){return this.radii.toString()}cartographicToCartesian(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];const n=V9,i=cxe,[,,s]=e;this.geodeticSurfaceNormalCartographic(e,n),i.copy(this.radiiSquared).scale(n);const a=Math.sqrt(n.dot(i));return i.scale(1/a),n.scale(s),i.add(n),i.to(t)}cartesianToCartographic(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];L2.from(e);const n=this.scaleToGeodeticSurface(L2,qd);if(!n)return;const i=this.geodeticSurfaceNormal(n,V9),s=uxe;s.copy(L2).subtract(n);const a=Math.atan2(i.y,i.x),o=Math.asin(i.z),h=Math.sign(aM(s,L2))*rz(s);return txe([a,o,h],t)}eastNorthUpToFixedFrame(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new _a;return H9(this,"east","north","up",e,t)}localFrameToFixedFrame(e,t,n,i){let s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:new _a;return H9(this,e,t,n,i,s)}geocentricSurfaceNormal(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return R2.from(e).normalize().to(t)}geodeticSurfaceNormalCartographic(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];const n=Yve(e),i=n[0],s=n[1],a=Math.cos(s);return R2.set(a*Math.cos(i),a*Math.sin(i),Math.sin(s)).normalize(),R2.to(t)}geodeticSurfaceNormal(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return R2.from(e).scale(this.oneOverRadiiSquared).normalize().to(t)}scaleToGeodeticSurface(e,t){return lxe(e,this,t)}scaleToGeocentricSurface(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];qd.from(e);const n=qd.x,i=qd.y,s=qd.z,a=this.oneOverRadiiSquared,o=1/Math.sqrt(n*n*a.x+i*i*a.y+s*s*a.z);return qd.multiplyScalar(o).to(t)}transformPositionToScaledSpace(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return qd.from(e).scale(this.oneOverRadii).to(t)}transformPositionFromScaledSpace(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return qd.from(e).scale(this.radii).to(t)}getSurfaceNormalIntersectionWithZAxis(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[0,0,0];Gd(gp(this.radii.x,this.radii.y,gz)),Gd(this.radii.z>0),qd.from(e);const i=qd.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(i)>=this.radii.z-t))return qd.set(0,0,i).to(n)}};Ao.WGS84=new Ao(Wve,Xve,Jve);class hxe{constructor(e,t,n){xe(this,"item");xe(this,"previous");xe(this,"next");this.item=e,this.previous=t,this.next=n}}class dxe{constructor(){xe(this,"head",null);xe(this,"tail",null);xe(this,"_length",0)}get length(){return this._length}add(e){const t=new hxe(e,this.tail,null);return this.tail?(this.tail.next=t,this.tail=t):(this.head=t,this.tail=t),++this._length,t}remove(e){e&&(e.previous&&e.next?(e.previous.next=e.next,e.next.previous=e.previous):e.previous?(e.previous.next=null,this.tail=e.previous):e.next?(e.next.previous=null,this.head=e.next):(this.head=null,this.tail=null),e.next=null,e.previous=null,--this._length)}splice(e,t){e!==t&&(this.remove(t),this._insert(e,t))}_insert(e,t){const n=e.next;e.next=t,this.tail===e?this.tail=t:n.previous=t,t.next=n,t.previous=e,++this._length}}class fxe{constructor(){xe(this,"_list");xe(this,"_sentinel");xe(this,"_trimTiles");this._list=new dxe,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(e){const t=e._cacheNode;t&&this._list.splice(this._sentinel,t)}add(e,t,n){t._cacheNode||(t._cacheNode=this._list.add(t),n&&n(e,t))}unloadTile(e,t,n){const i=t._cacheNode;i&&(this._list.remove(i),t._cacheNode=null,n&&n(e,t))}unloadTiles(e,t){const n=this._trimTiles;this._trimTiles=!1;const i=this._list,s=e.maximumMemoryUsage*1024*1024,a=this._sentinel;let o=i.head;for(;o!==a&&(e.gpuMemoryUsageInBytes>s||n);){const h=o.item;o=o.next,this.unloadTile(e,h,t)}}trim(){this._trimTiles=!0}}function Axe(r,e){Po(r),Po(e);const{rtcCenter:t,gltfUpAxis:n}=e,{computedTransform:i,boundingVolume:{center:s}}=r;let a=new _a(i);switch(t&&a.translate(t),n){case"Z":break;case"Y":const x=new _a().rotateX(Math.PI/2);a=a.multiplyRight(x);break;case"X":const T=new _a().rotateY(-Math.PI/2);a=a.multiplyRight(T);break}e.isQuantized&&a.translate(e.quantizedVolumeOffset).scale(e.quantizedVolumeScale);const o=new yr(s);e.cartesianModelMatrix=a,e.cartesianOrigin=o;const h=Ao.WGS84.cartesianToCartographic(o,new yr),_=Ao.WGS84.eastNorthUpToFixedFrame(o).invert();e.cartographicModelMatrix=_.multiplyRight(a),e.cartographicOrigin=h,e.coordinateSystem||(e.modelMatrix=e.cartographicModelMatrix)}const G9=new yr,nP=new yr,iP=new Hg([new mp,new mp,new mp,new mp,new mp,new mp]);function pxe(r,e){const{cameraDirection:t,cameraUp:n,height:i}=r,{metersPerUnit:s}=r.distanceScales,a=D2(r,r.center),o=Ao.WGS84.eastNorthUpToFixedFrame(a),h=r.unprojectPosition(r.cameraPosition),f=Ao.WGS84.cartographicToCartesian(h,new yr),_=new yr(o.transformAsVector(new yr(t).scale(s))).normalize(),x=new yr(o.transformAsVector(new yr(n).scale(s))).normalize();mxe(r);const T=r.constructor,{longitude:I,latitude:N,width:$,bearing:W,zoom:Y}=r,ie=new T({longitude:I,latitude:N,height:i,width:$,bearing:W,zoom:Y,pitch:0});return{camera:{position:f,direction:_,up:x},viewport:r,topDownViewport:ie,height:i,cullingVolume:iP,frameNumber:e,sseDenominator:1.15}}function gxe(r,e,t){if(t===0||r.length<=t)return[r,[]];const n=[],{longitude:i,latitude:s}=e.viewport;for(const[f,_]of r.entries()){const[x,T]=_.header.mbs,I=Math.abs(i-x),N=Math.abs(s-T),$=Math.sqrt(N*N+I*I);n.push([f,$])}const a=n.sort((f,_)=>f[1]-_[1]),o=[];for(let f=0;f<t;f++)o.push(r[a[f][0]]);const h=[];for(let f=t;f<a.length;f++)h.push(r[a[f][0]]);return[o,h]}function mxe(r){const e=r.getFrustumPlanes(),t=Q9(e.near,r.cameraPosition),n=D2(r,t),i=D2(r,r.cameraPosition,nP);let s=0;iP.planes[s++].fromPointNormal(n,G9.copy(n).subtract(i));for(const a in e){if(a==="near")continue;const o=e[a],h=Q9(o,t,nP),f=D2(r,h,nP);iP.planes[s++].fromPointNormal(f,G9.copy(n).subtract(f))}}function Q9(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new yr;const n=r.normal.dot(e);return t.copy(r.normal).scale(r.distance-n).add(e),t}function D2(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new yr;const n=r.unprojectPosition(e);return Ao.WGS84.cartographicToCartesian(n,t)}const _xe=6378137,yxe=6378137,sP=6356752314245179e-9,l0=new yr;function bxe(r,e){if(r instanceof pM){const{halfAxes:t}=r,n=xxe(t);return Math.log2(sP/(n+e[2]))}else if(r instanceof AM){const{radius:t}=r;return Math.log2(sP/(t+e[2]))}else if(r.width&&r.height){const{width:t,height:n}=r,i=Math.log2(_xe/t),s=Math.log2(yxe/n);return(i+s)/2}return 1}function $9(r,e,t){Ao.WGS84.cartographicToCartesian([r.xmax,r.ymax,r.zmax],l0);const n=Math.sqrt(Math.pow(l0[0]-t[0],2)+Math.pow(l0[1]-t[1],2)+Math.pow(l0[2]-t[2],2));return Math.log2(sP/(n+e[2]))}function vxe(r,e,t){const[n,i,s,a]=r;return $9({xmin:n,xmax:s,ymin:i,ymax:a,zmin:0,zmax:0},e,t)}function xxe(r){r.getColumn(0,l0);const e=r.getColumn(1),t=r.getColumn(2);return l0.add(e).add(t).len()}const Sh={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5};var Kd;(function(r){r[r.ADD=1]="ADD",r[r.REPLACE=2]="REPLACE"})(Kd||(Kd={}));var yA;(function(r){r.EMPTY="empty",r.SCENEGRAPH="scenegraph",r.POINTCLOUD="pointcloud",r.MESH="mesh"})(yA||(yA={}));var Ju;(function(r){r.I3S="I3S",r.TILES3D="TILES3D"})(Ju||(Ju={}));var c0;(function(r){r.GEOMETRIC_ERROR="geometricError",r.MAX_SCREEN_THRESHOLD="maxScreenThreshold"})(c0||(c0={}));const wxe={NOT_COMPUTED:-1,USE_OPTIMIZATION:1,SKIP_OPTIMIZATION:0};function j9(r){return r!=null}const Zc=new yr,O2=new yr,Bxe=new yr,Cxe=new yr,jg=new yr,q9=new yr,K9=new yr,W9=new yr;function oP(r,e,t){if(Po(r,"3D Tile: boundingVolume must be defined"),r.box)return X9(r.box,e,t);if(r.region)return Sxe(r.region);if(r.sphere)return Txe(r.sphere,e,t);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function Exe(r,e){if(r.box)return Ixe(e);if(r.region){const[t,n,i,s,a,o]=r.region;return[[Vd(t),Vd(n),a],[Vd(i),Vd(s),o]]}if(r.sphere)return Mxe(e);throw new Error("Unkown boundingVolume type")}function X9(r,e,t){const n=new yr(r[0],r[1],r[2]);e.transform(n,n);let i=[];if(r.length===10){const f=r.slice(3,6),_=new i2;_.fromArray(r,6);const x=new yr([1,0,0]),T=new yr([0,1,0]),I=new yr([0,0,1]);x.transformByQuaternion(_),x.scale(f[0]),T.transformByQuaternion(_),T.scale(f[1]),I.transformByQuaternion(_),I.scale(f[2]),i=[...x.toArray(),...T.toArray(),...I.toArray()]}else i=[...r.slice(3,6),...r.slice(6,9),...r.slice(9,12)];const s=e.transformAsVector(i.slice(0,3)),a=e.transformAsVector(i.slice(3,6)),o=e.transformAsVector(i.slice(6,9)),h=new ma([s[0],s[1],s[2],a[0],a[1],a[2],o[0],o[1],o[2]]);return j9(t)?(t.center=n,t.halfAxes=h,t):new pM(n,h)}function Txe(r,e,t){const n=new yr(r[0],r[1],r[2]);e.transform(n,n);const i=e.getScale(O2),s=Math.max(Math.max(i[0],i[1]),i[2]),a=r[3]*s;return j9(t)?(t.center=n,t.radius=a,t):new AM(n,a)}function Sxe(r){const[e,t,n,i,s,a]=r,o=Ao.WGS84.cartographicToCartesian([Vd(e),Vd(i),s],Bxe),h=Ao.WGS84.cartographicToCartesian([Vd(n),Vd(t),a],Cxe),f=new yr().addVectors(o,h).multiplyByScalar(.5);return Ao.WGS84.cartesianToCartographic(f,jg),Ao.WGS84.cartographicToCartesian([Vd(n),jg[1],jg[2]],q9),Ao.WGS84.cartographicToCartesian([jg[0],Vd(i),jg[2]],K9),Ao.WGS84.cartographicToCartesian([jg[0],jg[1],a],W9),X9([...f,...q9.subtract(f),...K9.subtract(f),...W9.subtract(f)],new _a)}function Ixe(r){const e=J9(),{halfAxes:t}=r,n=new yr(t.getColumn(0)),i=new yr(t.getColumn(1)),s=new yr(t.getColumn(2));for(let a=0;a<2;a++){for(let o=0;o<2;o++){for(let h=0;h<2;h++)Zc.copy(r.center),Zc.add(n),Zc.add(i),Zc.add(s),Z9(e,Zc),s.negate();i.negate()}n.negate()}return e}function Mxe(r){const e=J9(),{center:t,radius:n}=r,i=Ao.WGS84.scaleToGeodeticSurface(t,Zc);let s;i?s=Ao.WGS84.geodeticSurfaceNormal(i):s=new yr(0,0,1);let a=new yr(s[2],-s[1],0);a.len()>0?a.normalize():a=new yr(0,1,0);const o=a.clone().cross(s);for(const h of[a,o,s]){O2.copy(h).scale(n);for(let f=0;f<2;f++)Zc.copy(t),Zc.add(O2),Z9(e,Zc),O2.negate()}return e}function J9(){return[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]]}function Z9(r,e){Ao.WGS84.cartesianToCartographic(e,Zc),r[0][0]=Math.min(r[0][0],Zc[0]),r[0][1]=Math.min(r[0][1],Zc[1]),r[0][2]=Math.min(r[0][2],Zc[2]),r[1][0]=Math.max(r[1][0],Zc[0]),r[1][1]=Math.max(r[1][1],Zc[1]),r[1][2]=Math.max(r[1][2],Zc[2])}new yr,new yr,new _a,new yr,new yr,new yr;function Pxe(r,e){const t=r*e;return 1-Math.exp(-(t*t))}function Fxe(r,e){if(r.dynamicScreenSpaceError&&r.dynamicScreenSpaceErrorComputedDensity){const t=r.dynamicScreenSpaceErrorComputedDensity,n=r.dynamicScreenSpaceErrorFactor;return Pxe(e,t)*n}return 0}function Rxe(r,e,t){const n=r.tileset,i=r.parent&&r.parent.lodMetricValue||r.lodMetricValue,s=t?i:r.lodMetricValue;if(s===0)return 0;const a=Math.max(r._distanceToCamera,1e-7),{height:o,sseDenominator:h}=e,{viewDistanceScale:f}=n.options;let _=s*o*(f||1)/(a*h);return _-=Fxe(n,a),_}const aP=new yr,Y9=new yr,bp=new yr,eH=new yr,Lxe=new yr,lP=new _a,tH=new _a;function Dxe(r,e){if(r.lodMetricValue===0||isNaN(r.lodMetricValue))return"DIG";const t=2*rH(r,e);return t<2?"OUT":!r.header.children||t<=r.lodMetricValue?"DRAW":r.header.children?"DIG":"OUT"}function rH(r,e){const{topDownViewport:t}=e,n=r.header.mbs[1],i=r.header.mbs[0],s=r.header.mbs[2],a=r.header.mbs[3],o=[...r.boundingVolume.center],h=t.unprojectPosition(t.cameraPosition);Ao.WGS84.cartographicToCartesian(h,aP),Y9.copy(aP).subtract(o).normalize(),Ao.WGS84.eastNorthUpToFixedFrame(o,lP),tH.copy(lP).invert(),bp.copy(aP).transform(tH);const f=Math.sqrt(bp[0]*bp[0]+bp[1]*bp[1]),_=f*f/bp[2];eH.copy([bp[0],bp[1],_]);const T=eH.transform(lP).subtract(o).normalize(),N=Y9.cross(T).normalize().scale(a).add(o),$=Ao.WGS84.cartesianToCartographic(N),W=t.project([i,n,s]),Y=t.project($);return Lxe.copy(W).subtract(Y).magnitude()}function Oxe(r){return{assetGltfUpAxis:r.asset&&r.asset.gltfUpAxis||"Y"}}class nH{constructor(){xe(this,"_map",new Map);xe(this,"_array");xe(this,"_length");let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;this._array=new Array(e),this._length=e}get length(){return this._length}set length(e){this._length=e,e>this._array.length&&(this._array.length=e)}get values(){return this._array}get(e){return Po(e<this._array.length),this._array[e]}set(e,t){Po(e>=0),e>=this.length&&(this.length=e+1),this._map.has(this._array[e])&&this._map.delete(this._array[e]),this._array[e]=t,this._map.set(t,e)}delete(e){const t=this._map.get(e);t>=0&&(this._array.splice(t,1),this._map.delete(e),this.length--)}peek(){return this._array[this._length-1]}push(e){if(!this._map.has(e)){const t=this.length++;this._array[t]=e,this._map.set(e,t)}}pop(){const e=this._array[--this.length];return this._map.delete(e),e}reserve(e){Po(e>=0),e>this._array.length&&(this._array.length=e)}resize(e){Po(e>=0),this.length=e}trim(e){e==null&&(e=this.length),this._array.length=e}reset(){this._array=[],this._map=new Map,this._length=0}find(e){return this._map.has(e)}}const kxe={loadSiblings:!1,skipLevelOfDetail:!1,updateTransforms:!0,onTraversalEnd:()=>{},viewportTraversersMap:{},basePath:""};class k2{constructor(e){xe(this,"options");xe(this,"root",null);xe(this,"selectedTiles",{});xe(this,"requestedTiles",{});xe(this,"emptyTiles",{});xe(this,"lastUpdate",new Date().getTime());xe(this,"updateDebounceTime",1e3);xe(this,"_traversalStack",new nH);xe(this,"_emptyTraversalStack",new nH);xe(this,"_frameNumber",null);this.options={...kxe,...e}}traversalFinished(e){return!0}traverse(e,t,n){this.root=e,this.options={...this.options,...n},this.reset(),this.updateTile(e,t),this._frameNumber=t.frameNumber,this.executeTraversal(e,t)}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}executeTraversal(e,t){const n=this._traversalStack;for(e._selectionDepth=1,n.push(e);n.length>0;){const s=n.pop();let a=!1;this.canTraverse(s,t)&&(this.updateChildTiles(s,t),a=this.updateAndPushChildren(s,t,n,s.hasRenderContent?s._selectionDepth+1:s._selectionDepth));const o=s.parent,h=!!(!o||o._shouldRefine),f=!a;s.hasRenderContent?s.refine===Kd.ADD?(this.loadTile(s,t),this.selectTile(s,t)):s.refine===Kd.REPLACE&&(this.loadTile(s,t),f&&this.selectTile(s,t)):(this.emptyTiles[s.id]=s,this.loadTile(s,t),f&&this.selectTile(s,t)),this.touchTile(s,t),s._shouldRefine=a&&h}const i=new Date().getTime();(this.traversalFinished(t)||i-this.lastUpdate>this.updateDebounceTime)&&(this.lastUpdate=i,this.options.onTraversalEnd(t))}updateChildTiles(e,t){const n=e.children;for(const i of n)this.updateTile(i,t)}updateAndPushChildren(e,t,n,i){const{loadSiblings:s,skipLevelOfDetail:a}=this.options,o=e.children;o.sort(this.compareDistanceToCamera.bind(this));const h=e.refine===Kd.REPLACE&&e.hasRenderContent&&!a;let f=!1,_=!0;for(const x of o)if(x._selectionDepth=i,x.isVisibleAndInRequestVolume?(n.find(x)&&n.delete(x),n.push(x),f=!0):(h||s)&&(this.loadTile(x,t),this.touchTile(x,t)),h){let T;if(x._inRequestVolume?x.hasRenderContent?T=x.contentAvailable:T=this.executeEmptyTraversal(x,t):T=!1,_=_&&T,!_)return!1}return f||(_=!1),_}updateTile(e,t){this.updateTileVisibility(e,t)}selectTile(e,t){this.shouldSelectTile(e)&&(e._selectedFrame=t.frameNumber,this.selectedTiles[e.id]=e)}loadTile(e,t){this.shouldLoadTile(e)&&(e._requestedFrame=t.frameNumber,e._priority=e._getPriority(),this.requestedTiles[e.id]=e)}touchTile(e,t){e.tileset._cache.touch(e),e._touchedFrame=t.frameNumber}canTraverse(e,t){return e.hasChildren?e.hasTilesetContent?!e.contentExpired:this.shouldRefine(e,t):!1}shouldLoadTile(e){return e.hasUnloadedContent||e.contentExpired}shouldSelectTile(e){return e.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=e._screenSpaceError;return n&&(i=e.getScreenSpaceError(t,!0)),i>e.tileset.memoryAdjustedScreenSpaceError}updateTileVisibility(e,t){const n=[];if(this.options.viewportTraversersMap)for(const i in this.options.viewportTraversersMap)this.options.viewportTraversersMap[i]===t.viewport.id&&n.push(i);else n.push(t.viewport.id);e.updateVisibility(t,n)}compareDistanceToCamera(e,t){return e._distanceToCamera-t._distanceToCamera}anyChildrenVisible(e,t){let n=!1;for(const i of e.children)i.updateVisibility(t),n=n||i.isVisibleAndInRequestVolume;return n}executeEmptyTraversal(e,t){let n=!0;const i=this._emptyTraversalStack;for(i.push(e);i.length>0;){const s=i.pop(),a=!s.hasRenderContent&&this.canTraverse(s,t),o=!s.hasRenderContent&&s.children.length===0;if(!a&&!s.contentAvailable&&!o&&(n=!1),this.updateTile(s,t),s.isVisibleAndInRequestVolume||(this.loadTile(s,t),this.touchTile(s,t)),a){const h=s.children;for(const f of h)i.push(f)}}return n}}const iH=new yr;function Uxe(r){return r!=null}class cP{constructor(e,t,n){xe(this,"tileset");xe(this,"header");xe(this,"id");xe(this,"url");xe(this,"parent");xe(this,"refine");xe(this,"type");xe(this,"contentUrl");xe(this,"lodMetricType","geometricError");xe(this,"lodMetricValue",0);xe(this,"boundingVolume",null);xe(this,"content",null);xe(this,"contentState",Sh.UNLOADED);xe(this,"gpuMemoryUsageInBytes",0);xe(this,"children",[]);xe(this,"depth",0);xe(this,"viewportIds",[]);xe(this,"transform",new _a);xe(this,"extensions",null);xe(this,"implicitTiling",null);xe(this,"userData",{});xe(this,"computedTransform");xe(this,"hasEmptyContent",!1);xe(this,"hasTilesetContent",!1);xe(this,"traverser",new k2({}));xe(this,"_cacheNode",null);xe(this,"_frameNumber",null);xe(this,"_expireDate",null);xe(this,"_expiredContent",null);xe(this,"_boundingBox");xe(this,"_distanceToCamera",0);xe(this,"_screenSpaceError",0);xe(this,"_visibilityPlaneMask");xe(this,"_visible");xe(this,"_contentBoundingVolume");xe(this,"_viewerRequestVolume");xe(this,"_initialTransform",new _a);xe(this,"_priority",0);xe(this,"_selectedFrame",0);xe(this,"_requestedFrame",0);xe(this,"_selectionDepth",0);xe(this,"_touchedFrame",0);xe(this,"_centerZDepth",0);xe(this,"_shouldRefine",!1);xe(this,"_stackLength",0);xe(this,"_visitedFrame",0);xe(this,"_inRequestVolume",!1);xe(this,"_lodJudge",null);let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"";this.header=t,this.tileset=e,this.id=i||t.id,this.url=t.url,this.parent=n,this.refine=this._getRefine(t.refine),this.type=t.type,this.contentUrl=t.contentUrl,this._initializeLodMetric(t),this._initializeTransforms(t),this._initializeBoundingVolumes(t),this._initializeContent(t),this._initializeRenderingState(t),Object.seal(this)}destroy(){this.header=null}isDestroyed(){return this.header===null}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return this.contentState===Sh.READY||this.hasEmptyContent}get contentAvailable(){return!!(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return this.contentState===Sh.UNLOADED}get contentExpired(){return this.contentState===Sh.EXPIRED}get contentFailed(){return this.contentState===Sh.FAILED}get distanceToCamera(){return this._distanceToCamera}get screenSpaceError(){return this._screenSpaceError}get boundingBox(){return this._boundingBox||(this._boundingBox=Exe(this.header.boundingVolume,this.boundingVolume)),this._boundingBox}getScreenSpaceError(e,t){switch(this.tileset.type){case Ju.I3S:return rH(this,e);case Ju.TILES3D:return Rxe(this,e,t);default:throw new Error("Unsupported tileset type")}}unselect(){this._selectedFrame=0}_getGpuMemoryUsageInBytes(){return this.content.gpuMemoryUsageInBytes||this.content.byteLength||0}_getPriority(){const e=this.tileset._traverser,{skipLevelOfDetail:t}=e.options,n=this.refine===Kd.ADD||t;if(n&&!this.isVisible&&this._visible!==void 0||this.tileset._frameNumber-this._touchedFrame>=1||this.contentState===Sh.UNLOADED)return-1;const i=this.parent,a=i&&(!n||this._screenSpaceError===0||i.hasTilesetContent)?i._screenSpaceError:this._screenSpaceError,o=e.root?e.root._screenSpaceError:0;return Math.max(o-a,0)}async loadContent(){if(this.hasEmptyContent)return!1;if(this.content)return!0;this.contentExpired&&(this._expireDate=null),this.contentState=Sh.LOADING;const t=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));if(!t)return this.contentState=Sh.UNLOADED,!1;try{const n=this.tileset.getTileUrl(this.contentUrl),i=this.tileset.loader,s={...this.tileset.loadOptions,[i.id]:{...this.tileset.loadOptions[i.id],isTileset:this.type==="json",...this._getLoaderSpecificOptions(i.id)}};return this.content=await Ng(n,i,s),this.tileset.options.contentLoader&&await this.tileset.options.contentLoader(this),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=Sh.READY,this._onContentLoaded(),!0}catch(n){throw this.contentState=Sh.FAILED,n}finally{t.done()}}unloadContent(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=Sh.UNLOADED,!0}updateVisibility(e,t){if(this._frameNumber===e.frameNumber)return;const n=this.parent,i=n?n._visibilityPlaneMask:Hg.MASK_INDETERMINATE;if(this.tileset._traverser.options.updateTransforms){const s=n?n.computedTransform:this.tileset.modelMatrix;this._updateTransform(s)}this._distanceToCamera=this.distanceToTile(e),this._screenSpaceError=this.getScreenSpaceError(e,!1),this._visibilityPlaneMask=this.visibility(e,i),this._visible=this._visibilityPlaneMask!==Hg.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(e),this._frameNumber=e.frameNumber,this.viewportIds=t}visibility(e,t){const{cullingVolume:n}=e,{boundingVolume:i}=this;return n.computeVisibilityWithPlaneMask(i,t)}contentVisibility(){return!0}distanceToTile(e){const t=this.boundingVolume;return Math.sqrt(Math.max(t.distanceSquaredTo(e.camera.position),0))}cameraSpaceZDepth(e){let{camera:t}=e;const n=this.boundingVolume;return iH.subVectors(n.center,t.position),t.direction.dot(iH)}insideViewerRequestVolume(e){const t=this._viewerRequestVolume;return!t||t.distanceSquaredTo(e.camera.position)<=0}updateExpiration(){if(Uxe(this._expireDate)&&this.contentReady&&!this.hasEmptyContent){const e=Date.now();Date.lessThan(this._expireDate,e)&&(this.contentState=Sh.EXPIRED,this._expiredContent=this.content)}}get extras(){return this.header.extras}_initializeLodMetric(e){"lodMetricType"in e?this.lodMetricType=e.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in e?this.lodMetricValue=e.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}_initializeTransforms(e){this.transform=e.transform?new _a(e.transform):new _a;const t=this.parent,n=this.tileset,i=t&&t.computedTransform?t.computedTransform.clone():n.modelMatrix.clone();this.computedTransform=new _a(i).multiplyRight(this.transform);const s=t&&t._initialTransform?t._initialTransform.clone():new _a;this._initialTransform=new _a(s).multiplyRight(this.transform)}_initializeBoundingVolumes(e){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(e)}_initializeContent(e){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=Sh.UNLOADED,this.hasTilesetContent=!1,e.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}_initializeRenderingState(e){this.depth=e.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=Hg.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}_getRefine(e){return e||this.parent&&this.parent.refine||Kd.REPLACE}_isTileset(){return this.contentUrl.indexOf(".json")!==-1}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0;break}this._isTileset()?this.hasTilesetContent=!0:this.gpuMemoryUsageInBytes=this._getGpuMemoryUsageInBytes()}_updateBoundingVolume(e){this.boundingVolume=oP(e.boundingVolume,this.computedTransform,this.boundingVolume);const t=e.content;t&&(t.boundingVolume&&(this._contentBoundingVolume=oP(t.boundingVolume,this.computedTransform,this._contentBoundingVolume)),e.viewerRequestVolume&&(this._viewerRequestVolume=oP(e.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}_updateTransform(){const t=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:new _a).clone().multiplyRight(this.transform);t.equals(this.computedTransform)||(this.computedTransform=t,this._updateBoundingVolume(this.header))}_getLoaderSpecificOptions(e){switch(e){case"i3s":return{...this.tileset.options.i3s,_tileOptions:{attributeUrls:this.header.attributeUrls,textureUrl:this.header.textureUrl,textureFormat:this.header.textureFormat,textureLoaderOptions:this.header.textureLoaderOptions,materialDefinition:this.header.materialDefinition,isDracoGeometry:this.header.isDracoGeometry,mbs:this.header.mbs},_tilesetOptions:{store:this.tileset.tileset.store,attributeStorageInfo:this.tileset.tileset.attributeStorageInfo,fields:this.tileset.tileset.fields},isTileHeader:!1};case"3d-tiles":case"cesium-ion":default:return Oxe(this.tileset.tileset)}}}class Nxe extends k2{compareDistanceToCamera(e,t){return t._distanceToCamera===0&&e._distanceToCamera===0?t._centerZDepth-e._centerZDepth:t._distanceToCamera-e._distanceToCamera}updateTileVisibility(e,t){if(super.updateTileVisibility(e,t),!e.isVisibleAndInRequestVolume)return;const n=e.children.length>0;if(e.hasTilesetContent&&n){const a=e.children[0];this.updateTileVisibility(a,t),e._visible=a._visible;return}if(this.meetsScreenSpaceErrorEarly(e,t)){e._visible=!1;return}const i=e.refine===Kd.REPLACE,s=e._optimChildrenWithinParent===wxe.USE_OPTIMIZATION;if(i&&s&&n&&!this.anyChildrenVisible(e,t)){e._visible=!1;return}}meetsScreenSpaceErrorEarly(e,t){const{parent:n}=e;return!n||n.hasTilesetContent||n.refine!==Kd.ADD?!1:!this.shouldRefine(e,t,!0)}}class zxe{constructor(){xe(this,"frameNumberMap",new Map)}register(e,t){const n=this.frameNumberMap.get(e)||new Map,i=n.get(t)||0;n.set(t,i+1),this.frameNumberMap.set(e,n)}deregister(e,t){const n=this.frameNumberMap.get(e);if(!n)return;const i=n.get(t)||1;n.set(t,i-1)}isZero(e,t){var i;return(((i=this.frameNumberMap.get(e))==null?void 0:i.get(t))||0)===0}}const uP={REQUESTED:"REQUESTED",COMPLETED:"COMPLETED",ERROR:"ERROR"};class Hxe{constructor(){xe(this,"_statusMap");xe(this,"pendingTilesRegister",new zxe);this._statusMap={}}add(e,t,n,i){if(!this._statusMap[t]){const{frameNumber:s,viewport:{id:a}}=i;this._statusMap[t]={request:e,callback:n,key:t,frameState:i,status:uP.REQUESTED},this.pendingTilesRegister.register(a,s),e().then(o=>{this._statusMap[t].status=uP.COMPLETED;const{frameNumber:h,viewport:{id:f}}=this._statusMap[t].frameState;this.pendingTilesRegister.deregister(f,h),this._statusMap[t].callback(o,i)}).catch(o=>{this._statusMap[t].status=uP.ERROR;const{frameNumber:h,viewport:{id:f}}=this._statusMap[t].frameState;this.pendingTilesRegister.deregister(f,h),n(o)})}}update(e,t){if(this._statusMap[e]){const{frameNumber:n,viewport:{id:i}}=this._statusMap[e].frameState;this.pendingTilesRegister.deregister(i,n);const{frameNumber:s,viewport:{id:a}}=t;this.pendingTilesRegister.register(a,s),this._statusMap[e].frameState=t}}find(e){return this._statusMap[e]}hasPendingTiles(e,t){return!this.pendingTilesRegister.isZero(e,t)}}class Vxe extends k2{constructor(t){super(t);xe(this,"_tileManager");this._tileManager=new Hxe}traversalFinished(t){return!this._tileManager.hasPendingTiles(t.viewport.id,this._frameNumber||0)}shouldRefine(t,n){return t._lodJudge=Dxe(t,n),t._lodJudge==="DIG"}updateChildTiles(t,n){const i=t.header.children||[],s=t.children,a=t.tileset;for(const o of i){const h=`${o.id}-${n.viewport.id}`,f=s&&s.find(_=>_.id===h);if(f)f&&this.updateTile(f,n);else{let _=()=>this._loadTile(o.id,a);this._tileManager.find(h)?this._tileManager.update(h,n):(a.tileset.nodePages&&(_=()=>a.tileset.nodePagesTile.formTileFromNodePages(o.id)),this._tileManager.add(_,h,T=>this._onTileLoad(T,t,h),n))}}return!1}async _loadTile(t,n){const{loader:i}=n,s=n.getTileUrl(`${n.url}/nodes/${t}`),a={...n.loadOptions,i3s:{...n.loadOptions.i3s,isTileHeader:!0}};return await Ng(s,i,a)}_onTileLoad(t,n,i){const s=new cP(n.tileset,t,n,i);n.children.push(s);const a=this._tileManager.find(s.id).frameState;this.updateTile(s,a),this._frameNumber===a.frameNumber&&(this.traversalFinished(a)||new Date().getTime()-this.lastUpdate>this.updateDebounceTime)&&this.executeTraversal(s,a)}}const Gxe={description:"",ellipsoid:Ao.WGS84,modelMatrix:new _a,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,memoryCacheOverflow:1,maximumTilesSelected:0,debounceTime:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{},onTraversalComplete:r=>r,contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,memoryAdjustedScreenSpaceError:!1,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},U2="Tiles In Tileset(s)",hP="Tiles In Memory",sH="Tiles In View",oH="Tiles To Render",aH="Tiles Loaded",dP="Tiles Loading",lH="Tiles Unloaded",cH="Failed Tile Loads",uH="Points/Vertices",fP="Tile Memory Use",hH="Maximum Screen Space Error";class Qxe{constructor(e,t){xe(this,"options");xe(this,"loadOptions");xe(this,"type");xe(this,"tileset");xe(this,"loader");xe(this,"url");xe(this,"basePath");xe(this,"modelMatrix");xe(this,"ellipsoid");xe(this,"lodMetricType");xe(this,"lodMetricValue");xe(this,"refine");xe(this,"root",null);xe(this,"roots",{});xe(this,"asset",{});xe(this,"description","");xe(this,"properties");xe(this,"extras",null);xe(this,"attributions",{});xe(this,"credits",{});xe(this,"stats");xe(this,"contentFormats",{draco:!1,meshopt:!1,dds:!1,ktx2:!1});xe(this,"cartographicCenter",null);xe(this,"cartesianCenter",null);xe(this,"zoom",1);xe(this,"boundingVolume",null);xe(this,"dynamicScreenSpaceErrorComputedDensity",0);xe(this,"maximumMemoryUsage",32);xe(this,"gpuMemoryUsageInBytes",0);xe(this,"memoryAdjustedScreenSpaceError",0);xe(this,"_cacheBytes",0);xe(this,"_cacheOverflowBytes",0);xe(this,"_frameNumber",0);xe(this,"_queryParams",{});xe(this,"_extensionsUsed",[]);xe(this,"_tiles",{});xe(this,"_pendingCount",0);xe(this,"selectedTiles",[]);xe(this,"traverseCounter",0);xe(this,"geometricError",0);xe(this,"lastUpdatedVieports",null);xe(this,"_requestedTiles",[]);xe(this,"_emptyTiles",[]);xe(this,"frameStateData",{});xe(this,"_traverser");xe(this,"_cache",new fxe);xe(this,"_requestScheduler");xe(this,"updatePromise",null);xe(this,"tilesetInitializationPromise");this.options={...Gxe,...t},this.tileset=e,this.loader=e.loader,this.type=e.type,this.url=e.url,this.basePath=e.basePath||W8(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=e.lodMetricType,this.lodMetricValue=e.lodMetricValue,this.refine=e.root.refine,this.loadOptions=this.options.loadOptions||{},this._traverser=this._initializeTraverser(),this._requestScheduler=new npe({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this.memoryAdjustedScreenSpaceError=this.options.maximumScreenSpaceError,this._cacheBytes=this.options.maximumMemoryUsage*1024*1024,this._cacheOverflowBytes=this.options.memoryCacheOverflow*1024*1024,this.stats=new K8({id:this.url}),this._initializeStats(),this.tilesetInitializationPromise=this._initializeTileSet(e)}destroy(){this._destroy()}isLoaded(){return this._pendingCount===0&&this._frameNumber!==0&&this._requestedTiles.length===0}get tiles(){return Object.values(this._tiles)}get frameNumber(){return this._frameNumber}get queryParams(){return new URLSearchParams(this._queryParams).toString()}setProps(e){this.options={...this.options,...e}}getTileUrl(e){if(e.startsWith("data:"))return e;let n=e;return this.queryParams.length&&(n=`${e}${e.includes("?")?"&":"?"}${this.queryParams}`),n}hasExtension(e){return this._extensionsUsed.indexOf(e)>-1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;this.tilesetInitializationPromise.then(()=>{!e&&this.lastUpdatedVieports?e=this.lastUpdatedVieports:this.lastUpdatedVieports=e,e&&this.doUpdate(e)})}async selectTiles(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return await this.tilesetInitializationPromise,e&&(this.lastUpdatedVieports=e),this.updatePromise||(this.updatePromise=new Promise(t=>{setTimeout(()=>{this.lastUpdatedVieports&&this.doUpdate(this.lastUpdatedVieports),t(this._frameNumber),this.updatePromise=null},this.options.debounceTime)})),this.updatePromise}adjustScreenSpaceError(){this.gpuMemoryUsageInBytes<this._cacheBytes?this.memoryAdjustedScreenSpaceError=Math.max(this.memoryAdjustedScreenSpaceError/1.02,this.options.maximumScreenSpaceError):this.gpuMemoryUsageInBytes>this._cacheBytes+this._cacheOverflowBytes&&(this.memoryAdjustedScreenSpaceError*=1.02)}doUpdate(e){if("loadTiles"in this.options&&!this.options.loadTiles||this.traverseCounter>0)return;const t=e instanceof Array?e:[e];this._cache.reset(),this._frameNumber++,this.traverseCounter=t.length;const n=[];for(const i of t){const s=i.id;this._needTraverse(s)?n.push(s):this.traverseCounter--}for(const i of t){const s=i.id;if(this.roots[s]||(this.roots[s]=this._initializeTileHeaders(this.tileset,null)),!n.includes(s))continue;const a=pxe(i,this._frameNumber);this._traverser.traverse(this.roots[s],a,this.options)}}_needTraverse(e){let t=e;return this.options.viewportTraversersMap&&(t=this.options.viewportTraversersMap[e]),t===e}_onTraversalEnd(e){const t=e.viewport.id;this.frameStateData[t]||(this.frameStateData[t]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});const n=this.frameStateData[t],i=Object.values(this._traverser.selectedTiles),[s,a]=gxe(i,e,this.options.maximumTilesSelected);n.selectedTiles=s;for(const o of a)o.unselect();n._requestedTiles=Object.values(this._traverser.requestedTiles),n._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,!(this.traverseCounter>0)&&this._updateTiles()}_updateTiles(){this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[];for(const e in this.frameStateData){const t=this.frameStateData[e];this.selectedTiles=this.selectedTiles.concat(t.selectedTiles),this._requestedTiles=this._requestedTiles.concat(t._requestedTiles),this._emptyTiles=this._emptyTiles.concat(t._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);for(const e of this.selectedTiles)this._tiles[e.id]=e;this._loadTiles(),this._unloadTiles(),this._updateStats()}_tilesChanged(e,t){if(e.length!==t.length)return!0;const n=new Set(e.map(a=>a.id)),i=new Set(t.map(a=>a.id));let s=e.filter(a=>!i.has(a.id)).length>0;return s=s||t.filter(a=>!n.has(a.id)).length>0,s}_loadTiles(){for(const e of this._requestedTiles)e.contentUnloaded&&this._loadTile(e)}_unloadTiles(){this._cache.unloadTiles(this,(e,t)=>e._unloadTile(t))}_updateStats(){let e=0,t=0;for(const n of this.selectedTiles)n.contentAvailable&&n.content&&(e++,n.content.pointCount?t+=n.content.pointCount:t+=n.content.vertexCount);this.stats.get(sH).count=this.selectedTiles.length,this.stats.get(oH).count=e,this.stats.get(uH).count=t,this.stats.get(hH).count=this.memoryAdjustedScreenSpaceError}async _initializeTileSet(e){this.type===Ju.I3S&&(this.calculateViewPropsI3S(),e.root=await e.root),this.root=this._initializeTileHeaders(e,null),this.type===Ju.TILES3D&&(this._initializeTiles3DTileset(e),this.calculateViewPropsTiles3D()),this.type===Ju.I3S&&this._initializeI3STileset()}calculateViewPropsI3S(){var n;const e=this.tileset.fullExtent;if(e){const{xmin:i,xmax:s,ymin:a,ymax:o,zmin:h,zmax:f}=e;this.cartographicCenter=new yr(i+(s-i)/2,a+(o-a)/2,h+(f-h)/2),this.cartesianCenter=new yr,Ao.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),this.zoom=$9(e,this.cartographicCenter,this.cartesianCenter);return}const t=(n=this.tileset.store)==null?void 0:n.extent;if(t){const[i,s,a,o]=t;this.cartographicCenter=new yr(i+(a-i)/2,s+(o-s)/2,0),this.cartesianCenter=new yr,Ao.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),this.zoom=vxe(t,this.cartographicCenter,this.cartesianCenter);return}console.warn("Extent is not defined in the tileset header"),this.cartographicCenter=new yr,this.zoom=1}calculateViewPropsTiles3D(){const e=this.root,{center:t}=e.boundingVolume;if(!t){console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new yr,this.zoom=1;return}t[0]!==0||t[1]!==0||t[2]!==0?(this.cartographicCenter=new yr,Ao.WGS84.cartesianToCartographic(t,this.cartographicCenter)):this.cartographicCenter=new yr(0,0,-Ao.WGS84.radii[0]),this.cartesianCenter=t,this.zoom=bxe(e.boundingVolume,this.cartographicCenter)}_initializeStats(){this.stats.get(U2),this.stats.get(dP),this.stats.get(hP),this.stats.get(sH),this.stats.get(oH),this.stats.get(aH),this.stats.get(lH),this.stats.get(cH),this.stats.get(uH),this.stats.get(fP,"memory"),this.stats.get(hH)}_initializeTileHeaders(e,t){var i;const n=new cP(this,e.root,t);if(t&&(t.children.push(n),n.depth=t.depth+1),this.type===Ju.TILES3D){const s=[];for(s.push(n);s.length>0;){const a=s.pop();this.stats.get(U2).incrementCount();const o=a.header.children||[];for(const h of o){const f=new cP(this,h,a);if((i=f.contentUrl)!=null&&i.includes("?session=")){const x=new URL(f.contentUrl).searchParams.get("session");x&&(this._queryParams.session=x)}a.children.push(f),f.depth=a.depth+1,s.push(f)}}}return n}_initializeTraverser(){let e;switch(this.type){case Ju.TILES3D:e=Nxe;break;case Ju.I3S:e=Vxe;break;default:e=k2}return new e({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(e){this._destroySubtree(e)}async _loadTile(e){let t;try{this._onStartTileLoading(),t=await e.loadContent()}catch(n){this._onTileLoadError(e,n instanceof Error?n:new Error("load failed"))}finally{this._onEndTileLoading(),this._onTileLoad(e,t)}}_onTileLoadError(e,t){this.stats.get(cH).incrementCount();const n=t.message||t.toString(),i=e.url;console.error(`A 3D tile failed to load: ${e.url} ${n}`),this.options.onTileError(e,n,i)}_onTileLoad(e,t){var n,i;if(t){if(this.type===Ju.I3S){const s=((i=(n=this.tileset)==null?void 0:n.nodePagesTile)==null?void 0:i.nodesInNodePages)||0;this.stats.get(U2).reset(),this.stats.get(U2).addCount(s)}e&&e.content&&Axe(e,e.content),this.updateContentTypes(e),this._addTileToCache(e),this.options.onTileLoad(e)}}updateContentTypes(e){var t;if(this.type===Ju.I3S)switch(e.header.isDracoGeometry&&(this.contentFormats.draco=!0),e.header.textureFormat){case"dds":this.contentFormats.dds=!0;break;case"ktx2":this.contentFormats.ktx2=!0;break}else if(this.type===Ju.TILES3D){const{extensionsRemoved:n=[]}=((t=e.content)==null?void 0:t.gltf)||{};n.includes("KHR_draco_mesh_compression")&&(this.contentFormats.draco=!0),n.includes("EXT_meshopt_compression")&&(this.contentFormats.meshopt=!0),n.includes("KHR_texture_basisu")&&(this.contentFormats.ktx2=!0)}}_onStartTileLoading(){this._pendingCount++,this.stats.get(dP).incrementCount()}_onEndTileLoading(){this._pendingCount--,this.stats.get(dP).decrementCount()}_addTileToCache(e){this._cache.add(this,e,t=>t._updateCacheStats(e))}_updateCacheStats(e){this.stats.get(aH).incrementCount(),this.stats.get(hP).incrementCount(),this.gpuMemoryUsageInBytes+=e.gpuMemoryUsageInBytes||0,this.stats.get(fP).count=this.gpuMemoryUsageInBytes,this.options.memoryAdjustedScreenSpaceError&&this.adjustScreenSpaceError()}_unloadTile(e){this.gpuMemoryUsageInBytes-=e.gpuMemoryUsageInBytes||0,this.stats.get(hP).decrementCount(),this.stats.get(lH).incrementCount(),this.stats.get(fP).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(e),e.unloadContent()}_destroy(){const e=[];for(this.root&&e.push(this.root);e.length>0;){const t=e.pop();for(const n of t.children)e.push(n);this._destroyTile(t)}this.root=null}_destroySubtree(e){const t=e,n=[];for(n.push(t);n.length>0;){e=n.pop();for(const i of e.children)n.push(i);e!==t&&this._destroyTile(e)}t.children=[]}_destroyTile(e){this._cache.unloadTile(this,e),this._unloadTile(e),e.destroy()}_initializeTiles3DTileset(e){if(e.queryString){const t=new URLSearchParams(e.queryString),n=Object.fromEntries(t.entries());this._queryParams={...this._queryParams,...n}}if(this.asset=e.asset,!this.asset)throw new Error("Tileset must have an asset property.");if(this.asset.version!=="0.0"&&this.asset.version!=="1.0"&&this.asset.version!=="1.1")throw new Error("The tileset must be 3D Tiles version either 0.0 or 1.0 or 1.1.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=e.properties,this.geometricError=e.geometricError,this._extensionsUsed=e.extensionsUsed||[],this.extras=e.extras}_initializeI3STileset(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}}const dH="4.3.2",Y1={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GEOMETRY:"geom",VECTOR:"vect",GLTF:"glTF"};function fH(r,e,t){Po(r instanceof ArrayBuffer);const n=new TextDecoder("utf8"),i=new Uint8Array(r,e,t);return n.decode(i)}function $xe(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const t=new DataView(r);return`${String.fromCharCode(t.getUint8(e+0))}${String.fromCharCode(t.getUint8(e+1))}${String.fromCharCode(t.getUint8(e+2))}${String.fromCharCode(t.getUint8(e+3))}`}const jxe={dataType:null,batchType:null,name:"Draco",id:"draco",module:"draco",version:"4.3.2",worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};function qxe(r){switch(r.constructor){case Int8Array:return"int8";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int16Array:return"int16";case Uint16Array:return"uint16";case Int32Array:return"int32";case Uint32Array:return"uint32";case Float32Array:return"float32";case Float64Array:return"float64";default:return"null"}}function Kxe(r){let e=1/0,t=1/0,n=1/0,i=-1/0,s=-1/0,a=-1/0;const o=r.POSITION?r.POSITION.value:[],h=o&&o.length;for(let f=0;f<h;f+=3){const _=o[f],x=o[f+1],T=o[f+2];e=_<e?_:e,t=x<t?x:t,n=T<n?T:n,i=_>i?_:i,s=x>s?x:s,a=T>a?T:a}return[[e,t,n],[i,s,a]]}function Wxe(r,e,t){const n=qxe(e.value),i=t||Xxe(e);return{name:r,type:{type:"fixed-size-list",listSize:e.size,children:[{name:"value",type:n}]},nullable:!1,metadata:i}}function Xxe(r){const e={};return"byteOffset"in r&&(e.byteOffset=r.byteOffset.toString(10)),"byteStride"in r&&(e.byteStride=r.byteStride.toString(10)),"normalized"in r&&(e.normalized=r.normalized.toString()),e}function Jxe(r,e,t){const n=pH(e.metadata),i=[],s=Zxe(e.attributes);for(const a in r){const o=r[a],h=AH(a,o,s[a]);i.push(h)}if(t){const a=AH("indices",t);i.push(a)}return{fields:i,metadata:n}}function Zxe(r){const e={};for(const t in r){const n=r[t];e[n.name||"undefined"]=n}return e}function AH(r,e,t){const n=t?pH(t.metadata):void 0;return Wxe(r,e,n)}function pH(r){Object.entries(r);const e={};for(const t in r)e[`${t}.string`]=JSON.stringify(r[t]);return e}const gH={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},Yxe={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},ewe=4;let twe=class{constructor(e){xe(this,"draco");xe(this,"decoder");xe(this,"metadataQuerier");this.draco=e,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=new this.draco.DecoderBuffer;n.Init(new Int8Array(e),e.byteLength),this._disableAttributeTransforms(t);const i=this.decoder.GetEncodedGeometryType(n),s=i===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let a;switch(i){case this.draco.TRIANGULAR_MESH:a=this.decoder.DecodeBufferToMesh(n,s);break;case this.draco.POINT_CLOUD:a=this.decoder.DecodeBufferToPointCloud(n,s);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!a.ok()||!s.ptr){const T=`DRACO decompression failed: ${a.error_msg()}`;throw new Error(T)}const o=this._getDracoLoaderData(s,i,t),h=this._getMeshData(s,o,t),f=Kxe(h.attributes),_=Jxe(h.attributes,o,h.indices);return{loader:"draco",loaderData:o,header:{vertexCount:s.num_points(),boundingBox:f},...h,schema:_}}finally{this.draco.destroy(n),s&&this.draco.destroy(s)}}_getDracoLoaderData(e,t,n){const i=this._getTopLevelMetadata(e),s=this._getDracoAttributes(e,n);return{geometry_type:t,num_attributes:e.num_attributes(),num_points:e.num_points(),num_faces:e instanceof this.draco.Mesh?e.num_faces():0,metadata:i,attributes:s}}_getDracoAttributes(e,t){const n={};for(let i=0;i<e.num_attributes();i++){const s=this.decoder.GetAttribute(e,i),a=this._getAttributeMetadata(e,i);n[s.unique_id()]={unique_id:s.unique_id(),attribute_type:s.attribute_type(),data_type:s.data_type(),num_components:s.num_components(),byte_offset:s.byte_offset(),byte_stride:s.byte_stride(),normalized:s.normalized(),attribute_index:i,metadata:a};const o=this._getQuantizationTransform(s,t);o&&(n[s.unique_id()].quantization_transform=o);const h=this._getOctahedronTransform(s,t);h&&(n[s.unique_id()].octahedron_transform=h)}return n}_getMeshData(e,t,n){const i=this._getMeshAttributes(t,e,n);if(!i.POSITION)throw new Error("DRACO: No position attribute found.");if(e instanceof this.draco.Mesh)switch(n.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:i,indices:{value:this._getTriangleStripIndices(e),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:i,indices:{value:this._getTriangleListIndices(e),size:1}}}return{topology:"point-list",mode:0,attributes:i}}_getMeshAttributes(e,t,n){const i={};for(const s of Object.values(e.attributes)){const a=this._deduceAttributeName(s,n);s.name=a;const o=this._getAttributeValues(t,s);if(o){const{value:h,size:f}=o;i[a]={value:h,size:f,byteOffset:s.byte_offset,byteStride:s.byte_stride,normalized:s.normalized}}}return i}_getTriangleListIndices(e){const n=e.num_faces()*3,i=n*ewe,s=this.draco._malloc(i);try{return this.decoder.GetTrianglesUInt32Array(e,i,s),new Uint32Array(this.draco.HEAPF32.buffer,s,n).slice()}finally{this.draco._free(s)}}_getTriangleStripIndices(e){const t=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(e,t),iwe(t)}finally{this.draco.destroy(t)}}_getAttributeValues(e,t){const n=Yxe[t.data_type];if(!n)return console.warn(`DRACO: Unsupported attribute type ${t.data_type}`),null;const i=t.num_components,a=e.num_points()*i,o=a*n.BYTES_PER_ELEMENT,h=rwe(this.draco,n);let f;const _=this.draco._malloc(o);try{const x=this.decoder.GetAttribute(e,t.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(e,x,h,o,_),f=new n(this.draco.HEAPF32.buffer,_,a).slice()}finally{this.draco._free(_)}return{value:f,size:i}}_deduceAttributeName(e,t){const n=e.unique_id;for(const[a,o]of Object.entries(t.extraAttributes||{}))if(o===n)return a;const i=e.attribute_type;for(const a in gH)if(this.draco[a]===i)return gH[a];const s=t.attributeNameEntry||"name";return e.metadata[s]?e.metadata[s].string:`CUSTOM_ATTRIBUTE_${n}`}_getTopLevelMetadata(e){const t=this.decoder.GetMetadata(e);return this._getDracoMetadata(t)}_getAttributeMetadata(e,t){const n=this.decoder.GetAttributeMetadata(e,t);return this._getDracoMetadata(n)}_getDracoMetadata(e){if(!e||!e.ptr)return{};const t={},n=this.metadataQuerier.NumEntries(e);for(let i=0;i<n;i++){const s=this.metadataQuerier.GetEntryName(e,i);t[s]=this._getDracoMetadataField(e,s)}return t}_getDracoMetadataField(e,t){const n=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(e,t,n);const i=nwe(n);return{int:this.metadataQuerier.GetIntEntry(e,t),string:this.metadataQuerier.GetStringEntry(e,t),double:this.metadataQuerier.GetDoubleEntry(e,t),intArray:i}}finally{this.draco.destroy(n)}}_disableAttributeTransforms(e){const{quantizedAttributes:t=[],octahedronAttributes:n=[]}=e,i=[...t,...n];for(const s of i)this.decoder.SkipAttributeTransform(this.draco[s])}_getQuantizationTransform(e,t){const{quantizedAttributes:n=[]}=t,i=e.attribute_type();if(n.map(a=>this.decoder[a]).includes(i)){const a=new this.draco.AttributeQuantizationTransform;try{if(a.InitFromAttribute(e))return{quantization_bits:a.quantization_bits(),range:a.range(),min_values:new Float32Array([1,2,3]).map(o=>a.min_value(o))}}finally{this.draco.destroy(a)}}return null}_getOctahedronTransform(e,t){const{octahedronAttributes:n=[]}=t,i=e.attribute_type();if(n.map(a=>this.decoder[a]).includes(i)){const a=new this.draco.AttributeQuantizationTransform;try{if(a.InitFromAttribute(e))return{quantization_bits:a.quantization_bits()}}finally{this.draco.destroy(a)}}return null}};function rwe(r,e){switch(e){case Float32Array:return r.DT_FLOAT32;case Int8Array:return r.DT_INT8;case Int16Array:return r.DT_INT16;case Int32Array:return r.DT_INT32;case Uint8Array:return r.DT_UINT8;case Uint16Array:return r.DT_UINT16;case Uint32Array:return r.DT_UINT32;default:return r.DT_INVALID}}function nwe(r){const e=r.size(),t=new Int32Array(e);for(let n=0;n<e;n++)t[n]=r.GetValue(n);return t}function iwe(r){const e=r.size(),t=new Int32Array(e);for(let n=0;n<e;n++)t[n]=r.GetValue(n);return t}function swe(){var r;return(r=globalThis._loadersgl_)!=null&&r.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.2"),globalThis._loadersgl_.version}const owe=swe();function awe(r,e){if(!r)throw new Error("loaders.gl assertion failed.")}const eb=typeof process!="object"||String(process)!=="[object process]"||process.browser,AP=typeof importScripts=="function",mH=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);mH&&parseFloat(mH[1]);const pP={};async function gP(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;return e&&(r=lwe(r,e,t,n)),pP[r]=pP[r]||cwe(r),await pP[r]}function lwe(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(!t.useLocalLibraries&&r.startsWith("http"))return r;n=n||r;const i=t.modules||{};return i[n]?i[n]:eb?t.CDN?(awe(t.CDN.startsWith("http")),`${t.CDN}/${e}@${owe}/dist/libs/${n}`):AP?`../src/libs/${n}`:`modules/${e}/src/libs/${n}`:`modules/${e}/dist/libs/${n}`}async function cwe(r){if(r.endsWith("wasm"))return await hwe(r);if(!eb)try{const{requireFromFile:t}=globalThis.loaders||{};return await(t==null?void 0:t(r))}catch(t){return console.error(t),null}if(AP)return importScripts(r);const e=await dwe(r);return uwe(e,r)}function uwe(r,e){if(!eb){const{requireFromString:n}=globalThis.loaders||{};return n==null?void 0:n(r,e)}if(AP)return eval.call(globalThis,r),null;const t=document.createElement("script");t.id=e;try{t.appendChild(document.createTextNode(r))}catch{t.text=r}return document.body.appendChild(t),null}async function hwe(r){const{readFileAsArrayBuffer:e}=globalThis.loaders||{};return eb||!e||r.startsWith("http")?await(await fetch(r)).arrayBuffer():await e(r)}async function dwe(r){const{readFileAsText:e}=globalThis.loaders||{};return eb||!e||r.startsWith("http")?await(await fetch(r)).text():await e(r)}const fwe="1.5.6",Awe="1.4.1",mP=`https://www.gstatic.com/draco/versioned/decoders/${fwe}`,Zu={DECODER:"draco_wasm_wrapper.js",DECODER_WASM:"draco_decoder.wasm",FALLBACK_DECODER:"draco_decoder.js",ENCODER:"draco_encoder.js"},_P={[Zu.DECODER]:`${mP}/${Zu.DECODER}`,[Zu.DECODER_WASM]:`${mP}/${Zu.DECODER_WASM}`,[Zu.FALLBACK_DECODER]:`${mP}/${Zu.FALLBACK_DECODER}`,[Zu.ENCODER]:`https://raw.githubusercontent.com/google/draco/${Awe}/javascript/${Zu.ENCODER}`};let yP;async function pwe(r){const e=r.modules||{};return e.draco3d?yP||(yP=e.draco3d.createDecoderModule({}).then(t=>({draco:t}))):yP||(yP=gwe(r)),await yP}async function gwe(r){let e,t;switch(r.draco&&r.draco.decoderType){case"js":e=await gP(_P[Zu.FALLBACK_DECODER],"draco",r,Zu.FALLBACK_DECODER);break;case"wasm":default:[e,t]=await Promise.all([await gP(_P[Zu.DECODER],"draco",r,Zu.DECODER),await gP(_P[Zu.DECODER_WASM],"draco",r,Zu.DECODER_WASM)])}return e=e||globalThis.DracoDecoderModule,await mwe(e,t)}function mwe(r,e){const t={};return e&&(t.wasmBinary=e),new Promise(n=>{r({...t,onModuleLoaded:i=>n({draco:i})})})}const _H={...jxe,parse:_we};async function _we(r,e){const{draco:t}=await pwe(e),n=new twe(t);try{return n.parseSync(r,e==null?void 0:e.draco)}finally{n.destroy()}}const ywe={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},cl={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},ms={...ywe,...cl},bP={[cl.DOUBLE]:Float64Array,[cl.FLOAT]:Float32Array,[cl.UNSIGNED_SHORT]:Uint16Array,[cl.UNSIGNED_INT]:Uint32Array,[cl.UNSIGNED_BYTE]:Uint8Array,[cl.BYTE]:Int8Array,[cl.SHORT]:Int16Array,[cl.INT]:Int32Array},bwe={DOUBLE:cl.DOUBLE,FLOAT:cl.FLOAT,UNSIGNED_SHORT:cl.UNSIGNED_SHORT,UNSIGNED_INT:cl.UNSIGNED_INT,UNSIGNED_BYTE:cl.UNSIGNED_BYTE,BYTE:cl.BYTE,SHORT:cl.SHORT,INT:cl.INT},vP="Failed to convert GL type";let tb=class yx{static fromTypedArray(e){e=ArrayBuffer.isView(e)?e.constructor:e;for(const t in bP)if(bP[t]===e)return t;throw new Error(vP)}static fromName(e){const t=bwe[e];if(!t)throw new Error(vP);return t}static getArrayType(e){switch(e){case cl.UNSIGNED_SHORT_5_6_5:case cl.UNSIGNED_SHORT_4_4_4_4:case cl.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:const t=bP[e];if(!t)throw new Error(vP);return t}}static getByteSize(e){return yx.getArrayType(e).BYTES_PER_ELEMENT}static validate(e){return!!yx.getArrayType(e)}static createTypedArray(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0;i===void 0&&(i=(t.byteLength-n)/yx.getByteSize(e));const s=yx.getArrayType(e);return new s(t,n,i)}};function vwe(r,e){if(!r)throw new Error(`math.gl assertion failed. ${e}`)}function xwe(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];const t=r>>11&31,n=r>>5&63,i=r&31;return e[0]=t<<3,e[1]=n<<2,e[2]=i<<3,e}new oM,new yr,new oM,new oM;function yH(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:255;return Ape(r,0,e)/e*2-1}function bH(r){return r<0?-1:1}function wwe(r,e,t,n){if(vwe(n),r<0||r>t||e<0||e>t)throw new Error(`x and y must be unsigned normalized integers between 0 and ${t}`);if(n.x=yH(r,t),n.y=yH(e,t),n.z=1-(Math.abs(n.x)+Math.abs(n.y)),n.z<0){const i=n.x;n.x=(1-Math.abs(n.y))*bH(i),n.y=(1-Math.abs(i))*bH(n.y)}return n.normalize()}function Bwe(r,e,t){return wwe(r,e,255,t)}let xP=class{constructor(e,t){xe(this,"json");xe(this,"buffer");xe(this,"featuresLength",0);xe(this,"_cachedTypedArrays",{});this.json=e,this.buffer=t}getExtension(e){return this.json.extensions&&this.json.extensions[e]}hasProperty(e){return!!this.json[e]}getGlobalProperty(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ms.UNSIGNED_INT,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const i=this.json[e];return i&&Number.isFinite(i.byteOffset)?this._getTypedArrayFromBinary(e,t,n,1,i.byteOffset):i}getPropertyArray(e,t,n){const i=this.json[e];return i&&Number.isFinite(i.byteOffset)?("componentType"in i&&(t=tb.fromName(i.componentType)),this._getTypedArrayFromBinary(e,t,n,this.featuresLength,i.byteOffset)):this._getTypedArrayFromArray(e,t,i)}getProperty(e,t,n,i,s){const a=this.json[e];if(!a)return a;const o=this.getPropertyArray(e,t,n);if(n===1)return o[i];for(let h=0;h<n;++h)s[h]=o[n*i+h];return s}_getTypedArrayFromBinary(e,t,n,i,s){const a=this._cachedTypedArrays;let o=a[e];return o||(o=tb.createTypedArray(t,this.buffer.buffer,this.buffer.byteOffset+s,i*n),a[e]=o),o}_getTypedArrayFromArray(e,t,n){const i=this._cachedTypedArrays;let s=i[e];return s||(s=tb.createTypedArray(t,n),i[e]=s),s}};const Cwe={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Ewe={SCALAR:(r,e)=>r[e],VEC2:(r,e)=>[r[2*e+0],r[2*e+1]],VEC3:(r,e)=>[r[3*e+0],r[3*e+1],r[3*e+2]],VEC4:(r,e)=>[r[4*e+0],r[4*e+1],r[4*e+2],r[4*e+3]],MAT2:(r,e)=>[r[4*e+0],r[4*e+1],r[4*e+2],r[4*e+3]],MAT3:(r,e)=>[r[9*e+0],r[9*e+1],r[9*e+2],r[9*e+3],r[9*e+4],r[9*e+5],r[9*e+6],r[9*e+7],r[9*e+8]],MAT4:(r,e)=>[r[16*e+0],r[16*e+1],r[16*e+2],r[16*e+3],r[16*e+4],r[16*e+5],r[16*e+6],r[16*e+7],r[16*e+8],r[16*e+9],r[16*e+10],r[16*e+11],r[16*e+12],r[16*e+13],r[16*e+14],r[16*e+15]]},Twe={SCALAR:(r,e,t)=>{e[t]=r},VEC2:(r,e,t)=>{e[2*t+0]=r[0],e[2*t+1]=r[1]},VEC3:(r,e,t)=>{e[3*t+0]=r[0],e[3*t+1]=r[1],e[3*t+2]=r[2]},VEC4:(r,e,t)=>{e[4*t+0]=r[0],e[4*t+1]=r[1],e[4*t+2]=r[2],e[4*t+3]=r[3]},MAT2:(r,e,t)=>{e[4*t+0]=r[0],e[4*t+1]=r[1],e[4*t+2]=r[2],e[4*t+3]=r[3]},MAT3:(r,e,t)=>{e[9*t+0]=r[0],e[9*t+1]=r[1],e[9*t+2]=r[2],e[9*t+3]=r[3],e[9*t+4]=r[4],e[9*t+5]=r[5],e[9*t+6]=r[6],e[9*t+7]=r[7],e[9*t+8]=r[8],e[9*t+9]=r[9]},MAT4:(r,e,t)=>{e[16*t+0]=r[0],e[16*t+1]=r[1],e[16*t+2]=r[2],e[16*t+3]=r[3],e[16*t+4]=r[4],e[16*t+5]=r[5],e[16*t+6]=r[6],e[16*t+7]=r[7],e[16*t+8]=r[8],e[16*t+9]=r[9],e[16*t+10]=r[10],e[16*t+11]=r[11],e[16*t+12]=r[12],e[16*t+13]=r[13],e[16*t+14]=r[14],e[16*t+15]=r[15]}};function Swe(r,e,t,n){const{componentType:i}=r;Po(r.componentType);const s=typeof i=="string"?tb.fromName(i):i,a=Cwe[r.type],o=Ewe[r.type],h=Twe[r.type];return t+=r.byteOffset,{values:tb.createTypedArray(s,e,t,a*n),type:s,size:a,unpacker:o,packer:h}}const Gf=r=>r!==void 0;function Iwe(r,e,t){if(!e)return null;let n=r.getExtension("3DTILES_batch_table_hierarchy");const i=e.HIERARCHY;return i&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),e.extensions=e.extensions||{},e.extensions["3DTILES_batch_table_hierarchy"]=i,n=i),n?Mwe(n,t):null}function Mwe(r,e){let t,n,i;const s=r.instancesLength,a=r.classes;let o=r.classIds,h=r.parentCounts,f=r.parentIds,_=s;Gf(o.byteOffset)&&(o.componentType=defaultValue(o.componentType,GL.UNSIGNED_SHORT),o.type=AttributeType.SCALAR,i=getBinaryAccessor(o),o=i.createArrayBufferView(e.buffer,e.byteOffset+o.byteOffset,s));let x;if(Gf(h))for(Gf(h.byteOffset)&&(h.componentType=defaultValue(h.componentType,GL.UNSIGNED_SHORT),h.type=AttributeType.SCALAR,i=getBinaryAccessor(h),h=i.createArrayBufferView(e.buffer,e.byteOffset+h.byteOffset,s)),x=new Uint16Array(s),_=0,t=0;t<s;++t)x[t]=_,_+=h[t];Gf(f)&&Gf(f.byteOffset)&&(f.componentType=defaultValue(f.componentType,GL.UNSIGNED_SHORT),f.type=AttributeType.SCALAR,i=getBinaryAccessor(f),f=i.createArrayBufferView(e.buffer,e.byteOffset+f.byteOffset,_));const T=a.length;for(t=0;t<T;++t){const W=a[t].length,Y=a[t].instances,ie=getBinaryProperties(W,Y,e);a[t].instances=combine(ie,Y)}const I=new Array(T).fill(0),N=new Uint16Array(s);for(t=0;t<s;++t)n=o[t],N[t]=I[n],++I[n];const $={classes:a,classIds:o,classIndexes:N,parentCounts:h,parentIndexes:x,parentIds:f};return Rwe($),$}function rb(r,e,t){if(!r)return;const n=r.parentCounts;return r.parentIds?t(r,e):n>0?Pwe(r,e,t):Fwe(r,e,t)}function Pwe(r,e,t){const n=r.classIds,i=r.parentCounts,s=r.parentIds,a=r.parentIndexes,o=n.length,h=scratchVisited;h.length=Math.max(h.length,o);const f=++marker,_=scratchStack;for(_.length=0,_.push(e);_.length>0;){if(e=_.pop(),h[e]===f)continue;h[e]=f;const x=t(r,e);if(Gf(x))return x;const T=i[e],I=a[e];for(let N=0;N<T;++N){const $=s[I+N];$!==e&&_.push($)}}return null}function Fwe(r,e,t){let n=!0;for(;n;){const i=t(r,e);if(Gf(i))return i;const s=r.parentIds[e];n=s!==e,e=s}throw new Error("traverseHierarchySingleParent")}function Rwe(r){const t=r.classIds.length;for(let n=0;n<t;++n)vH(r,n,stack)}function vH(r,e,t){const n=r.parentCounts,i=r.parentIds,s=r.parentIndexes,o=r.classIds.length;if(!Gf(i))return;assert(e<o,`Parent index ${e} exceeds the total number of instances: ${o}`),assert(t.indexOf(e)===-1,"Circular dependency detected in the batch table hierarchy."),t.push(e);const h=Gf(n)?n[e]:1,f=Gf(n)?s[e]:e;for(let _=0;_<h;++_){const x=i[f+_];x!==e&&vH(r,x,t)}t.pop(e)}function Yu(r){return r!=null}const N2=(r,e)=>r,Lwe={HIERARCHY:!0,extensions:!0,extras:!0};let xH=class{constructor(e,t,n){xe(this,"json");xe(this,"binary");xe(this,"featureCount");xe(this,"_extensions");xe(this,"_properties");xe(this,"_binaryProperties");xe(this,"_hierarchy");var s;let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};Po(n>=0),this.json=e||{},this.binary=t,this.featureCount=n,this._extensions=((s=this.json)==null?void 0:s.extensions)||{},this._properties={};for(const a in this.json)Lwe[a]||(this._properties[a]=this.json[a]);this._binaryProperties=this._initializeBinaryProperties(),i["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=Iwe(this,this.json,this.binary))}getExtension(e){return this.json&&this.json.extensions&&this.json.extensions[e]}memorySizeInBytes(){return 0}isClass(e,t){if(this._checkBatchId(e),Po(typeof t=="string",t),this._hierarchy){const n=rb(this._hierarchy,e,(i,s)=>{const a=i.classIds[s];return i.classes[a].name===t});return Yu(n)}return!1}isExactClass(e,t){return Po(typeof t=="string",t),this.getExactClassName(e)===t}getExactClassName(e){if(this._checkBatchId(e),this._hierarchy){const t=this._hierarchy.classIds[e];return this._hierarchy.classes[t].name}}hasProperty(e,t){return this._checkBatchId(e),Po(typeof t=="string",t),Yu(this._properties[t])||this._hasPropertyInHierarchy(e,t)}getPropertyNames(e,t){this._checkBatchId(e),t=Yu(t)?t:[],t.length=0;const n=Object.keys(this._properties);return t.push(...n),this._hierarchy&&this._getPropertyNamesInHierarchy(e,t),t}getProperty(e,t){if(this._checkBatchId(e),Po(typeof t=="string",t),this._binaryProperties){const i=this._binaryProperties[t];if(Yu(i))return this._getBinaryProperty(i,e)}const n=this._properties[t];if(Yu(n))return N2(n[e]);if(this._hierarchy){const i=this._getHierarchyProperty(e,t);if(Yu(i))return i}}setProperty(e,t,n){const i=this.featureCount;if(this._checkBatchId(e),Po(typeof t=="string",t),this._binaryProperties){const a=this._binaryProperties[t];if(a){this._setBinaryProperty(a,e,n);return}}if(this._hierarchy&&this._setHierarchyProperty(this,e,t,n))return;let s=this._properties[t];Yu(s)||(this._properties[t]=new Array(i),s=this._properties[t]),s[e]=N2(n)}_checkBatchId(e){if(!(e>=0&&e<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(e,t){return e.unpack(e.typedArray,t)}_setBinaryProperty(e,t,n){e.pack(n,e.typedArray,t)}_initializeBinaryProperties(){let e=null;for(const t in this._properties){const n=this._properties[t],i=this._initializeBinaryProperty(t,n);i&&(e=e||{},e[t]=i)}return e}_initializeBinaryProperty(e,t){if("byteOffset"in t){const n=t;Po(this.binary,`Property ${e} requires a batch table binary.`),Po(n.type,`Property ${e} requires a type.`);const i=Swe(n,this.binary.buffer,this.binary.byteOffset|0,this.featureCount);return{typedArray:i.values,componentCount:i.size,unpack:i.unpacker,pack:i.packer}}return null}_hasPropertyInHierarchy(e,t){if(!this._hierarchy)return!1;const n=rb(this._hierarchy,e,(i,s)=>{const a=i.classIds[s],o=i.classes[a].instances;return Yu(o[t])});return Yu(n)}_getPropertyNamesInHierarchy(e,t){rb(this._hierarchy,e,(n,i)=>{const s=n.classIds[i],a=n.classes[s].instances;for(const o in a)a.hasOwnProperty(o)&&t.indexOf(o)===-1&&t.push(o)})}_getHierarchyProperty(e,t){return rb(this._hierarchy,e,(n,i)=>{const s=n.classIds[i],a=n.classes[s],o=n.classIndexes[i],h=a.instances[t];return Yu(h)?Yu(h.typedArray)?this._getBinaryProperty(h,o):N2(h[o]):null})}_setHierarchyProperty(e,t,n,i){const s=rb(this._hierarchy,t,(a,o)=>{const h=a.classIds[o],f=a.classes[h],_=a.classIndexes[o],x=f.instances[n];return Yu(x)?(Po(o===t,`Inherited property "${n}" is read-only.`),Yu(x.typedArray)?this._setBinaryProperty(x,_,i):x[_]=N2(i),!0):!1});return Yu(s)}};const wP=4;function z2(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const n=new DataView(e);if(r.magic=n.getUint32(t,!0),t+=wP,r.version=n.getUint32(t,!0),t+=wP,r.byteLength=n.getUint32(t,!0),t+=wP,r.version!==1)throw new Error(`3D Tile Version ${r.version} not supported`);return t}const u0=4,wH="b3dm tile in legacy format.";function BP(r,e,t){const n=new DataView(e);let i;r.header=r.header||{};let s=n.getUint32(t,!0);t+=u0;let a=n.getUint32(t,!0);t+=u0;let o=n.getUint32(t,!0);t+=u0;let h=n.getUint32(t,!0);return t+=u0,o>=570425344?(t-=u0*2,i=s,o=a,h=0,s=0,a=0,console.warn(wH)):h>=570425344&&(t-=u0,i=o,o=s,h=a,s=0,a=0,console.warn(wH)),r.header.featureTableJsonByteLength=s,r.header.featureTableBinaryByteLength=a,r.header.batchTableJsonByteLength=o,r.header.batchTableBinaryByteLength=h,r.header.batchLength=i,t}function CP(r,e,t,n){return t=Dwe(r,e,t),t=Owe(r,e,t),t}function Dwe(r,e,t,n){const{featureTableJsonByteLength:i,featureTableBinaryByteLength:s,batchLength:a}=r.header||{};if(r.featureTableJson={BATCH_LENGTH:a||0},i&&i>0){const o=fH(e,t,i);r.featureTableJson=JSON.parse(o)}return t+=i||0,r.featureTableBinary=new Uint8Array(e,t,s),t+=s||0,t}function Owe(r,e,t,n){const{batchTableJsonByteLength:i,batchTableBinaryByteLength:s}=r.header||{};if(i&&i>0){const a=fH(e,t,i);r.batchTableJson=JSON.parse(a),t+=i,s&&s>0&&(r.batchTableBinary=new Uint8Array(e,t,s),r.batchTableBinary=new Uint8Array(r.batchTableBinary),t+=s)}return t}function BH(r,e,t){if(!e&&(!r||!r.batchIds||!t))return null;const{batchIds:n,isRGB565:i,pointCount:s=0}=r;if(n&&t){const a=new Uint8ClampedArray(s*3);for(let o=0;o<s;o++){const h=n[o],_=t.getProperty(h,"dimensions").map(x=>x*255);a[o*3]=_[0],a[o*3+1]=_[1],a[o*3+2]=_[2]}return{type:ms.UNSIGNED_BYTE,value:a,size:3,normalized:!0}}if(e&&i){const a=new Uint8ClampedArray(s*3);for(let o=0;o<s;o++){const h=xwe(e[o]);a[o*3]=h[0],a[o*3+1]=h[1],a[o*3+2]=h[2]}return{type:ms.UNSIGNED_BYTE,value:a,size:3,normalized:!0}}return e&&e.length===s*3?{type:ms.UNSIGNED_BYTE,value:e,size:3,normalized:!0}:{type:ms.UNSIGNED_BYTE,value:e||new Uint8ClampedArray,size:4,normalized:!0}}const CH=new yr;function kwe(r,e){if(!e)return null;if(r.isOctEncoded16P){const t=new Float32Array((r.pointsLength||0)*3);for(let n=0;n<(r.pointsLength||0);n++)Bwe(e[n*2],e[n*2+1],CH),CH.toArray(t,n*3);return{type:ms.FLOAT,size:2,value:t}}return{type:ms.FLOAT,size:2,value:e}}function Uwe(r,e,t){return r.isQuantized?t["3d-tiles"]&&t["3d-tiles"].decodeQuantizedPositions?(r.isQuantized=!1,Nwe(r,e)):{type:ms.UNSIGNED_SHORT,value:e,size:3,normalized:!0}:e}function Nwe(r,e){const t=new yr,n=new Float32Array(r.pointCount*3);for(let i=0;i<r.pointCount;i++)t.set(e[i*3],e[i*3+1],e[i*3+2]).scale(1/r.quantizedRange).multiply(r.quantizedVolumeScale).add(r.quantizedVolumeOffset).toArray(n,i*3);return n}async function zwe(r,e,t,n,i){t=z2(r,e,t),t=BP(r,e,t),t=CP(r,e,t),Hwe(r);const{featureTable:s,batchTable:a}=Vwe(r);return await qwe(r,s,a,n,i),Gwe(r,s,n),Qwe(r,s,a),$we(r,s),t}function Hwe(r){r.attributes={positions:null,colors:null,normals:null,batchIds:null},r.isQuantized=!1,r.isTranslucent=!1,r.isRGB565=!1,r.isOctEncoded16P=!1}function Vwe(r){const e=new xP(r.featureTableJson,r.featureTableBinary),t=e.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(t))throw new Error("POINTS_LENGTH must be defined");e.featuresLength=t,r.featuresLength=t,r.pointsLength=t,r.pointCount=t,r.rtcCenter=e.getGlobalProperty("RTC_CENTER",ms.FLOAT,3);const n=jwe(r,e);return{featureTable:e,batchTable:n}}function Gwe(r,e,t){if(r.attributes=r.attributes||{positions:null,colors:null,normals:null,batchIds:null},!r.attributes.positions){if(e.hasProperty("POSITION"))r.attributes.positions=e.getPropertyArray("POSITION",ms.FLOAT,3);else if(e.hasProperty("POSITION_QUANTIZED")){const n=e.getPropertyArray("POSITION_QUANTIZED",ms.UNSIGNED_SHORT,3);if(r.isQuantized=!0,r.quantizedRange=65535,r.quantizedVolumeScale=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",ms.FLOAT,3),!r.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(r.quantizedVolumeOffset=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",ms.FLOAT,3),!r.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");r.attributes.positions=Uwe(r,n,t)}}if(!r.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}function Qwe(r,e,t){if(r.attributes=r.attributes||{positions:null,colors:null,normals:null,batchIds:null},!r.attributes.colors){let n=null;e.hasProperty("RGBA")?(n=e.getPropertyArray("RGBA",ms.UNSIGNED_BYTE,4),r.isTranslucent=!0):e.hasProperty("RGB")?n=e.getPropertyArray("RGB",ms.UNSIGNED_BYTE,3):e.hasProperty("RGB565")&&(n=e.getPropertyArray("RGB565",ms.UNSIGNED_SHORT,1),r.isRGB565=!0),r.attributes.colors=BH(r,n,t)}e.hasProperty("CONSTANT_RGBA")&&(r.constantRGBA=e.getGlobalProperty("CONSTANT_RGBA",ms.UNSIGNED_BYTE,4))}function $we(r,e){if(r.attributes=r.attributes||{positions:null,colors:null,normals:null,batchIds:null},!r.attributes.normals){let t=null;e.hasProperty("NORMAL")?t=e.getPropertyArray("NORMAL",ms.FLOAT,3):e.hasProperty("NORMAL_OCT16P")&&(t=e.getPropertyArray("NORMAL_OCT16P",ms.UNSIGNED_BYTE,2),r.isOctEncoded16P=!0),r.attributes.normals=kwe(r,t)}}function jwe(r,e){let t=null;if(!r.batchIds&&e.hasProperty("BATCH_ID")&&(r.batchIds=e.getPropertyArray("BATCH_ID",ms.UNSIGNED_SHORT,1),r.batchIds)){const n=e.getGlobalProperty("BATCH_LENGTH");if(!n)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");const{batchTableJson:i,batchTableBinary:s}=r;t=new xH(i,s,n)}return t}async function qwe(r,e,t,n,i){let s,a,o;const h=r.batchTableJson&&r.batchTableJson.extensions&&r.batchTableJson.extensions["3DTILES_draco_point_compression"];h&&(o=h.properties);const f=e.getExtension("3DTILES_draco_point_compression");if(f){a=f.properties;const x=f.byteOffset,T=f.byteLength;if(!a||!Number.isFinite(x)||!T)throw new Error("Draco properties, byteOffset, and byteLength must be defined");s=(r.featureTableBinary||[]).slice(x,x+T),r.hasPositions=Number.isFinite(a.POSITION),r.hasColors=Number.isFinite(a.RGB)||Number.isFinite(a.RGBA),r.hasNormals=Number.isFinite(a.NORMAL),r.hasBatchIds=Number.isFinite(a.BATCH_ID),r.isTranslucent=Number.isFinite(a.RGBA)}if(!s)return!0;const _={buffer:s,properties:{...a,...o},featureTableProperties:a,batchTableProperties:o,dequantizeInShader:!1};return await Kwe(r,_,n,i)}async function Kwe(r,e,t,n){if(!n)return;const i={...t,draco:{...t==null?void 0:t.draco,extraAttributes:e.batchTableProperties||{}}};delete i["3d-tiles"];const s=await k1(e.buffer,_H,i,n),a=s.attributes.POSITION&&s.attributes.POSITION.value,o=s.attributes.COLOR_0&&s.attributes.COLOR_0.value,h=s.attributes.NORMAL&&s.attributes.NORMAL.value,f=s.attributes.BATCH_ID&&s.attributes.BATCH_ID.value,_=a&&s.attributes.POSITION.value.quantization,x=h&&s.attributes.NORMAL.value.quantization;if(_){const I=s.POSITION.data.quantization,N=I.range;r.quantizedVolumeScale=new yr(N,N,N),r.quantizedVolumeOffset=new yr(I.minValues),r.quantizedRange=(1<<I.quantizationBits)-1,r.isQuantizedDraco=!0}x&&(r.octEncodedRange=(1<<s.NORMAL.data.quantization.quantizationBits)-1,r.isOctEncodedDraco=!0);const T={};if(e.batchTableProperties)for(const I of Object.keys(e.batchTableProperties))s.attributes[I]&&s.attributes[I].value&&(T[I.toLowerCase()]=s.attributes[I].value);r.attributes={positions:a,colors:BH(r,o,void 0),normals:h,batchIds:f,...T}}const Wwe="4.3.2",Xwe=(xZ=globalThis.loaders)==null?void 0:xZ.parseImageNode,EP=typeof Image<"u",TP=typeof ImageBitmap<"u",SP=D8?!0:!!Xwe;function Jwe(r){switch(r){case"auto":return TP||EP||SP;case"imagebitmap":return TP;case"image":return EP;case"data":return SP;default:throw new Error(`@loaders.gl/images: image ${r} not supported in this environment`)}}function Zwe(){if(TP)return"imagebitmap";if(EP)return"image";if(SP)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function Ywe(r){const e=e2e(r);if(!e)throw new Error("Not an image");return e}function EH(r){switch(Ywe(r)){case"data":return r;case"image":case"imagebitmap":const e=document.createElement("canvas"),t=e.getContext("2d");if(!t)throw new Error("getImageData");return e.width=r.width,e.height=r.height,t.drawImage(r,0,0),t.getImageData(0,0,r.width,r.height);default:throw new Error("getImageData")}}function e2e(r){return typeof ImageBitmap<"u"&&r instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&r instanceof Image?"image":r&&typeof r=="object"&&r.data&&r.width&&r.height?"data":null}const t2e=/^data:image\/svg\+xml/,r2e=/\.svg((\?|#).*)?$/;function IP(r){return r&&(t2e.test(r)||r2e.test(r))}function n2e(r,e){if(IP(e)){let n=new TextDecoder().decode(r);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(n=unescape(encodeURIComponent(n)))}catch(s){throw new Error(s.message)}return`data:image/svg+xml;base64,${btoa(n)}`}return TH(r,e)}function TH(r,e){if(IP(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(r)])}async function SH(r,e,t){const n=n2e(r,t),i=self.URL||self.webkitURL,s=typeof n!="string"&&i.createObjectURL(n);try{return await i2e(s||n,e)}finally{s&&i.revokeObjectURL(s)}}async function i2e(r,e){const t=new Image;return t.src=r,e.image&&e.image.decode&&t.decode?(await t.decode(),t):await new Promise((n,i)=>{try{t.onload=()=>n(t),t.onerror=s=>{const a=s instanceof Error?s.message:"error";i(new Error(a))}}catch(s){i(s)}})}const s2e={};let IH=!0;async function o2e(r,e,t){let n;IP(t)?n=await SH(r,e,t):n=TH(r,t);const i=e&&e.imagebitmap;return await a2e(n,i)}async function a2e(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if((l2e(e)||!IH)&&(e=null),e)try{return await createImageBitmap(r,e)}catch(t){console.warn(t),IH=!1}return await createImageBitmap(r)}function l2e(r){for(const e in r||s2e)return!1;return!0}function c2e(r){return!f2e(r,"ftyp",4)||!(r[8]&96)?null:u2e(r)}function u2e(r){switch(h2e(r,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function h2e(r,e,t){return String.fromCharCode(...r.slice(e,t))}function d2e(r){return[...r].map(e=>e.charCodeAt(0))}function f2e(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const n=d2e(e);for(let i=0;i<n.length;++i)if(n[i]!==r[i+t])return!1;return!0}const Qf=!1,nb=!0;function MP(r){const e=ib(r);return p2e(e)||_2e(e)||g2e(e)||m2e(e)||A2e(e)}function A2e(r){const e=new Uint8Array(r instanceof DataView?r.buffer:r),t=c2e(e);return t?{mimeType:t.mimeType,width:0,height:0}:null}function p2e(r){const e=ib(r);return e.byteLength>=24&&e.getUint32(0,Qf)===2303741511?{mimeType:"image/png",width:e.getUint32(16,Qf),height:e.getUint32(20,Qf)}:null}function g2e(r){const e=ib(r);return e.byteLength>=10&&e.getUint32(0,Qf)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,nb),height:e.getUint16(8,nb)}:null}function m2e(r){const e=ib(r);return e.byteLength>=14&&e.getUint16(0,Qf)===16973&&e.getUint32(2,nb)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,nb),height:e.getUint32(22,nb)}:null}function _2e(r){const e=ib(r);if(!(e.byteLength>=3&&e.getUint16(0,Qf)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:n,sofMarkers:i}=y2e();let s=2;for(;s+9<e.byteLength;){const a=e.getUint16(s,Qf);if(i.has(a))return{mimeType:"image/jpeg",height:e.getUint16(s+5,Qf),width:e.getUint16(s+7,Qf)};if(!n.has(a))return null;s+=2,s+=e.getUint16(s,Qf)}return null}function y2e(){const r=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)r.add(t);return{tableMarkers:r,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function ib(r){if(r instanceof DataView)return r;if(ArrayBuffer.isView(r))return new DataView(r.buffer);if(r instanceof ArrayBuffer)return new DataView(r);throw new Error("toDataView")}async function b2e(r,e){var i;const{mimeType:t}=MP(r)||{},n=(i=globalThis.loaders)==null?void 0:i.parseImageNode;return Po(n),await n(r,t)}async function v2e(r,e,t){e=e||{};const i=(e.image||{}).type||"auto",{url:s}=t||{},a=x2e(i);let o;switch(a){case"imagebitmap":o=await o2e(r,e,s);break;case"image":o=await SH(r,e,s);break;case"data":o=await b2e(r);break;default:Po(!1)}return i==="data"&&(o=EH(o)),o}function x2e(r){switch(r){case"auto":case"data":return Zwe();default:return Jwe(r),r}}const w2e={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:Wwe,mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],parse:v2e,tests:[r=>!!MP(new DataView(r))],options:{image:{type:"auto",decode:!0}}},PP={};function B2e(r){if(PP[r]===void 0){const e=D8?E2e(r):C2e(r);PP[r]=e}return PP[r]}function C2e(r){var i,s;const e=["image/png","image/jpeg","image/gif"],t=((i=globalThis.loaders)==null?void 0:i.imageFormatsNode)||e;return!!((s=globalThis.loaders)==null?void 0:s.parseImageNode)&&t.includes(r)}function E2e(r){switch(r){case"image/avif":case"image/webp":return T2e(r);default:return!0}}function T2e(r){try{return document.createElement("canvas").toDataURL(r).indexOf(`data:${r}`)===0}catch{return!1}}function Ih(r,e){if(!r)throw new Error(e||"assert failed: gltf")}const MH={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},PH={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},S2e=1.33,FH=["SCALAR","VEC2","VEC3","VEC4"],I2e=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],M2e=new Map(I2e),P2e={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},F2e={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},R2e={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function RH(r){return FH[r-1]||FH[0]}function H2(r){const e=M2e.get(r.constructor);if(!e)throw new Error("Illegal typed array");return e}function FP(r,e){const t=R2e[r.componentType],n=P2e[r.type],i=F2e[r.componentType],s=r.count*n,a=r.count*n*i;Ih(a>=0&&a<=e.byteLength);const o=PH[r.componentType],h=MH[r.type];return{ArrayType:t,length:s,byteLength:a,componentByteSize:o,numberOfComponentsInElement:h}}function LH(r){let{images:e,bufferViews:t}=r;e=e||[],t=t||[];const n=e.map(a=>a.bufferView);t=t.filter(a=>!n.includes(a));const i=t.reduce((a,o)=>a+o.byteLength,0),s=e.reduce((a,o)=>{const{width:h,height:f}=o.image;return a+h*f},0);return i+Math.ceil(4*s*S2e)}function L2e(r,e,t){const n=r.bufferViews[t];Ih(n);const i=n.buffer,s=e[i];Ih(s);const a=(n.byteOffset||0)+s.byteOffset;return new Uint8Array(s.arrayBuffer,a,n.byteLength)}function D2e(r,e,t){var $,W;const n=typeof t=="number"?($=r.accessors)==null?void 0:$[t]:t;if(!n)throw new Error(`No gltf accessor ${JSON.stringify(t)}`);const i=(W=r.bufferViews)==null?void 0:W[n.bufferView||0];if(!i)throw new Error(`No gltf buffer view for accessor ${i}`);const{arrayBuffer:s,byteOffset:a}=e[i.buffer],o=(a||0)+(n.byteOffset||0)+(i.byteOffset||0),{ArrayType:h,length:f,componentByteSize:_,numberOfComponentsInElement:x}=FP(n,i),T=_*x,I=i.byteStride||T;if(typeof i.byteStride>"u"||i.byteStride===T)return new h(s,o,f);const N=new h(f);for(let Y=0;Y<n.count;Y++){const ie=new h(s,o+Y*I,x);N.set(ie,Y*x)}return N}function O2e(){return{asset:{version:"2.0",generator:"loaders.gl"},buffers:[],extensions:{},extensionsRequired:[],extensionsUsed:[]}}let rc=class{constructor(e){xe(this,"gltf");xe(this,"sourceBuffers");xe(this,"byteLength");this.gltf={json:(e==null?void 0:e.json)||O2e(),buffers:(e==null?void 0:e.buffers)||[],images:(e==null?void 0:e.images)||[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(e){return this.json[e]}getExtraData(e){return(this.json.extras||{})[e]}hasExtension(e){const t=this.getUsedExtensions().find(i=>i===e),n=this.getRequiredExtensions().find(i=>i===e);return typeof t=="string"||typeof n=="string"}getExtension(e){const t=this.getUsedExtensions().find(i=>i===e),n=this.json.extensions||{};return t?n[e]:null}getRequiredExtension(e){return this.getRequiredExtensions().find(n=>n===e)?this.getExtension(e):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(e,t){return(e.extensions||{})[t]}getScene(e){return this.getObject("scenes",e)}getNode(e){return this.getObject("nodes",e)}getSkin(e){return this.getObject("skins",e)}getMesh(e){return this.getObject("meshes",e)}getMaterial(e){return this.getObject("materials",e)}getAccessor(e){return this.getObject("accessors",e)}getTexture(e){return this.getObject("textures",e)}getSampler(e){return this.getObject("samplers",e)}getImage(e){return this.getObject("images",e)}getBufferView(e){return this.getObject("bufferViews",e)}getBuffer(e){return this.getObject("buffers",e)}getObject(e,t){if(typeof t=="object")return t;const n=this.json[e]&&this.json[e][t];if(!n)throw new Error(`glTF file error: Could not find ${e}[${t}]`);return n}getTypedArrayForBufferView(e){e=this.getBufferView(e);const t=e.buffer,n=this.gltf.buffers[t];Ih(n);const i=(e.byteOffset||0)+n.byteOffset;return new Uint8Array(n.arrayBuffer,i,e.byteLength)}getTypedArrayForAccessor(e){const t=this.getAccessor(e);return D2e(this.gltf.json,this.gltf.buffers,t)}getTypedArrayForImageData(e){e=this.getAccessor(e);const t=this.getBufferView(e.bufferView),i=this.getBuffer(t.buffer).data,s=t.byteOffset||0;return new Uint8Array(i,s,t.byteLength)}addApplicationData(e,t){return this.json[e]=t,this}addExtraData(e,t){return this.json.extras=this.json.extras||{},this.json.extras[e]=t,this}addObjectExtension(e,t,n){return e.extensions=e.extensions||{},e.extensions[t]=n,this.registerUsedExtension(t),this}setObjectExtension(e,t,n){const i=e.extensions||{};i[t]=n}removeObjectExtension(e,t){const n=(e==null?void 0:e.extensions)||{};if(n[t]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const i=this.json.extensionsRemoved;i.includes(t)||i.push(t)}delete n[t]}addExtension(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Ih(t),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=t,this.registerUsedExtension(e),t}addRequiredExtension(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Ih(t),this.addExtension(e,t),this.registerRequiredExtension(e),t}registerUsedExtension(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(t=>t===e)||this.json.extensionsUsed.push(e)}registerRequiredExtension(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(t=>t===e)||this.json.extensionsRequired.push(e)}removeExtension(e){var t;if((t=this.json.extensions)!=null&&t[e]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const n=this.json.extensionsRemoved;n.includes(e)||n.push(e)}this.json.extensions&&delete this.json.extensions[e],this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e)}setDefaultScene(e){this.json.scene=e}addScene(e){const{nodeIndices:t}=e;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:t}),this.json.scenes.length-1}addNode(e){const{meshIndex:t,matrix:n}=e;this.json.nodes=this.json.nodes||[];const i={mesh:t};return n&&(i.matrix=n),this.json.nodes.push(i),this.json.nodes.length-1}addMesh(e){const{attributes:t,indices:n,material:i,mode:s=4}=e,o={primitives:[{attributes:this._addAttributes(t),mode:s}]};if(n){const h=this._addIndices(n);o.primitives[0].indices=h}return Number.isFinite(i)&&(o.primitives[0].material=i),this.json.meshes=this.json.meshes||[],this.json.meshes.push(o),this.json.meshes.length-1}addPointCloud(e){const n={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(n),this.json.meshes.length-1}addImage(e,t){const n=MP(e),i=t||(n==null?void 0:n.mimeType),a={bufferView:this.addBufferView(e),mimeType:i};return this.json.images=this.json.images||[],this.json.images.push(a),this.json.images.length-1}addBufferView(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.byteLength;const i=e.byteLength;Ih(Number.isFinite(i)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);const s={buffer:t,byteOffset:n,byteLength:i};return this.byteLength+=U1(i,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(s),this.json.bufferViews.length-1}addAccessor(e,t){const n={bufferView:e,type:RH(t.size),componentType:t.componentType,count:t.count,max:t.max,min:t.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(n),this.json.accessors.length-1}addBinaryBuffer(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{size:3};const n=this.addBufferView(e);let i={min:t.min,max:t.max};(!i.min||!i.max)&&(i=this._getAccessorMinMax(e,t.size));const s={size:t.size,componentType:H2(e),count:Math.round(e.length/t.size),min:i.min,max:i.max};return this.addAccessor(n,Object.assign(s,t))}addTexture(e){const{imageIndex:t}=e,n={source:t};return this.json.textures=this.json.textures||[],this.json.textures.push(n),this.json.textures.length-1}addMaterial(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}createBinaryChunk(){var s,a;const e=this.byteLength,t=new ArrayBuffer(e),n=new Uint8Array(t);let i=0;for(const o of this.sourceBuffers||[])i=XAe(o,n,i);(a=(s=this.json)==null?void 0:s.buffers)!=null&&a[0]?this.json.buffers[0].byteLength=e:this.json.buffers=[{byteLength:e}],this.gltf.binary=t,this.sourceBuffers=[t],this.gltf.buffers=[{arrayBuffer:t,byteOffset:0,byteLength:t.byteLength}]}_removeStringFromArray(e,t){let n=!0;for(;n;){const i=e.indexOf(t);i>-1?e.splice(i,1):n=!1}}_addAttributes(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t={};for(const n in e){const i=e[n],s=this._getGltfAttributeName(n),a=this.addBinaryBuffer(i.value,i);t[s]=a}return t}_addIndices(e){return this.addBinaryBuffer(e,{size:1})}_getGltfAttributeName(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return e}}_getAccessorMinMax(e,t){const n={min:null,max:null};if(e.length<t)return n;n.min=[],n.max=[];const i=e.subarray(0,t);for(const s of i)n.min.push(s),n.max.push(s);for(let s=t;s<e.length;s+=t)for(let a=0;a<t;a++)n.min[0+a]=Math.min(n.min[0+a],e[s+a]),n.max[0+a]=Math.max(n.max[0+a],e[s+a]);return n}};function DH(r){return(r%1+1)%1}const OH={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16,BOOLEAN:1,STRING:1,ENUM:1},k2e={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:BigInt64Array,UINT64:BigUint64Array,FLOAT32:Float32Array,FLOAT64:Float64Array},kH={INT8:1,UINT8:1,INT16:2,UINT16:2,INT32:4,UINT32:4,INT64:8,UINT64:8,FLOAT32:4,FLOAT64:8};function RP(r,e){return kH[e]*OH[r]}function V2(r,e,t,n){if(t!=="UINT8"&&t!=="UINT16"&&t!=="UINT32"&&t!=="UINT64")return null;const i=r.getTypedArrayForBufferView(e),s=G2(i,"SCALAR",t,n+1);return s instanceof BigInt64Array||s instanceof BigUint64Array?null:s}function G2(r,e,t){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;const i=OH[e],s=k2e[t],a=kH[t],o=n*i,h=o*a;let f=r.buffer,_=r.byteOffset;return _%a!==0&&(f=new Uint8Array(f).slice(_,_+h).buffer,_=0),new s(f,_,o)}function LP(r,e,t){var f,_,x,T,I;const n=`TEXCOORD_${e.texCoord||0}`,i=t.attributes[n],s=r.getTypedArrayForAccessor(i),a=r.gltf.json,o=e.index,h=(_=(f=a.textures)==null?void 0:f[o])==null?void 0:_.source;if(typeof h<"u"){const N=(T=(x=a.images)==null?void 0:x[h])==null?void 0:T.mimeType,$=(I=r.gltf.images)==null?void 0:I[h];if($&&typeof $.width<"u"){const W=[];for(let Y=0;Y<s.length;Y+=2){const ie=U2e($,N,s,Y,e.channels);W.push(ie)}return W}}return[]}function UH(r,e,t,n,i){if(!(t!=null&&t.length))return;const s=[];for(const _ of t){let x=n.findIndex(T=>T===_);x===-1&&(x=n.push(_)-1),s.push(x)}const a=new Uint32Array(s),o=r.gltf.buffers.push({arrayBuffer:a.buffer,byteOffset:a.byteOffset,byteLength:a.byteLength})-1,h=r.addBufferView(a,o,0),f=r.addAccessor(h,{size:1,componentType:H2(a),count:a.length});i.attributes[e]=f}function U2e(r,e,t,n){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:[0];const s={r:{offset:0,shift:0},g:{offset:1,shift:8},b:{offset:2,shift:16},a:{offset:3,shift:24}},a=t[n],o=t[n+1];let h=1;e&&(e.indexOf("image/jpeg")!==-1||e.indexOf("image/png")!==-1)&&(h=4);const f=N2e(a,o,r,h);let _=0;for(const x of i){const T=typeof x=="number"?Object.values(s)[x]:s[x],I=f+T.offset,N=EH(r);if(N.data.length<=I)throw new Error(`${N.data.length} <= ${I}`);const $=N.data[I];_|=$<<T.shift}return _}function N2e(r,e,t){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;const i=t.width,s=DH(r)*(i-1),a=Math.round(s),o=t.height,h=DH(e)*(o-1),f=Math.round(h),_=t.components?t.components:n;return(f*i+a)*_}function NH(r,e,t,n,i){const s=[];for(let a=0;a<e;a++){const o=t[a],h=t[a+1]-t[a];if(h+o>n)break;const f=o/i,_=h/i;s.push(r.slice(f,f+_))}return s}function zH(r,e,t){const n=[];for(let i=0;i<e;i++){const s=i*t;n.push(r.slice(s,s+t))}return n}function HH(r,e,t,n){if(t)throw new Error("Not implemented - arrayOffsets for strings is specified");if(n){const i=[],s=new TextDecoder("utf8");let a=0;for(let o=0;o<r;o++){const h=n[o+1]-n[o];if(h+a<=e.length){const f=e.subarray(a,h+a),_=s.decode(f);i.push(_),a+=h}}return i}return[]}const h0="EXT_mesh_features",z2e=h0;async function H2e(r,e){const t=new rc(r);G2e(t,e)}function V2e(r,e){const t=new rc(r);return $2e(t),t.createBinaryChunk(),t.gltf}function G2e(r,e){const t=r.gltf.json;if(t.meshes)for(const n of t.meshes)for(const i of n.primitives)Q2e(r,i,e)}function Q2e(r,e,t){var s,a,o;if(!((s=t==null?void 0:t.gltf)!=null&&s.loadBuffers))return;const n=(a=e.extensions)==null?void 0:a[h0],i=n==null?void 0:n.featureIds;if(i)for(const h of i){let f;if(typeof h.attribute<"u"){const _=`_FEATURE_ID_${h.attribute}`,x=e.attributes[_];f=r.getTypedArrayForAccessor(x)}else typeof h.texture<"u"&&((o=t==null?void 0:t.gltf)!=null&&o.loadImages)?f=LP(r,h.texture,e):f=[];h.data=f}}function $2e(r,e){const t=r.gltf.json.meshes;if(t)for(const n of t)for(const i of n.primitives)q2e(r,i)}function j2e(r,e,t,n){e.extensions||(e.extensions={});let i=e.extensions[h0];i||(i={featureIds:[]},e.extensions[h0]=i);const{featureIds:s}=i,a={featureCount:t.length,propertyTable:n,data:t};s.push(a),r.addObjectExtension(e,h0,i)}function q2e(r,e){var i;const t=(i=e.extensions)==null?void 0:i[h0];if(!t)return;const n=t.featureIds;n.forEach((s,a)=>{if(s.data){const{accessorKey:o,index:h}=K2e(e.attributes),f=new Uint32Array(s.data);n[a]={featureCount:f.length,propertyTable:s.propertyTable,attribute:h},r.gltf.buffers.push({arrayBuffer:f.buffer,byteOffset:f.byteOffset,byteLength:f.byteLength});const _=r.addBufferView(f),x=r.addAccessor(_,{size:1,componentType:H2(f),count:f.length});e.attributes[o]=x}})}function K2e(r){const e="_FEATURE_ID_",t=Object.keys(r).filter(s=>s.indexOf(e)===0);let n=-1;for(const s of t){const a=Number(s.substring(e.length));a>n&&(n=a)}return n++,{accessorKey:`${e}${n}`,index:n}}const W2e=Object.freeze(Object.defineProperty({__proto__:null,createExtMeshFeatures:j2e,decode:H2e,encode:V2e,name:z2e},Symbol.toStringTag,{value:"Module"})),d0="EXT_structural_metadata",X2e=d0;async function J2e(r,e){const t=new rc(r);Y2e(t,e)}function Z2e(r,e){const t=new rc(r);return pBe(t),t.createBinaryChunk(),t.gltf}function Y2e(r,e){var n,i;if(!((n=e.gltf)!=null&&n.loadBuffers))return;const t=r.getExtension(d0);t&&((i=e.gltf)!=null&&i.loadImages&&eBe(r,t),tBe(r,t))}function eBe(r,e){const t=e.propertyTextures,n=r.gltf.json;if(t&&n.meshes)for(const i of n.meshes)for(const s of i.primitives)nBe(r,t,s,e)}function tBe(r,e){const t=e.schema;if(!t)return;const n=t.classes,i=e.propertyTables;if(n&&i)for(const s in n){const a=rBe(i,s);a&&sBe(r,t,a)}}function rBe(r,e){for(const t of r)if(t.class===e)return t;return null}function nBe(r,e,t,n){var a;if(!e)return;const i=(a=t.extensions)==null?void 0:a[d0],s=i==null?void 0:i.propertyTextures;if(s)for(const o of s){const h=e[o];iBe(r,h,t,n)}}function iBe(r,e,t,n){var s;if(!e.properties)return;n.dataAttributeNames||(n.dataAttributeNames=[]);const i=e.class;for(const a in e.properties){const o=`${i}_${a}`,h=(s=e.properties)==null?void 0:s[a];if(!h)continue;h.data||(h.data=[]);const f=h.data,_=LP(r,h,t);_!==null&&(UH(r,o,_,f,t),h.data=f,n.dataAttributeNames.push(o))}}function sBe(r,e,t){var s,a;const n=(s=e.classes)==null?void 0:s[t.class];if(!n)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${t.class}`);const i=t.count;for(const o in n.properties){const h=n.properties[o],f=(a=t.properties)==null?void 0:a[o];if(f){const _=oBe(r,e,h,i,f);f.data=_}}}function oBe(r,e,t,n,i){let s=[];const a=i.values,o=r.getTypedArrayForBufferView(a),h=aBe(r,t,i,n),f=lBe(r,i,n);switch(t.type){case"SCALAR":case"VEC2":case"VEC3":case"VEC4":case"MAT2":case"MAT3":case"MAT4":{s=cBe(t,n,o,h);break}case"BOOLEAN":throw new Error(`Not implemented - classProperty.type=${t.type}`);case"STRING":{s=HH(n,o,h,f);break}case"ENUM":{s=uBe(e,t,n,o,h);break}default:throw new Error(`Unknown classProperty type ${t.type}`)}return s}function aBe(r,e,t,n){return e.array&&typeof e.count>"u"&&typeof t.arrayOffsets<"u"?V2(r,t.arrayOffsets,t.arrayOffsetType||"UINT32",n):null}function lBe(r,e,t){return typeof e.stringOffsets<"u"?V2(r,e.stringOffsets,e.stringOffsetType||"UINT32",t):null}function cBe(r,e,t,n){const i=r.array,s=r.count,a=RP(r.type,r.componentType),o=t.byteLength/a;let h;return r.componentType?h=G2(t,r.type,r.componentType,o):h=t,i?n?NH(h,e,n,t.length,a):s?zH(h,e,s):[]:h}function uBe(r,e,t,n,i){var x;const s=e.enumType;if(!s)throw new Error("Incorrect data in the EXT_structural_metadata extension: classProperty.enumType is not set for type ENUM");const a=(x=r.enums)==null?void 0:x[s];if(!a)throw new Error(`Incorrect data in the EXT_structural_metadata extension: schema.enums does't contain ${s}`);const o=a.valueType||"UINT16",h=RP(e.type,o),f=n.byteLength/h;let _=G2(n,e.type,o,f);if(_||(_=n),e.array){if(i)return hBe({valuesData:_,numberOfElements:t,arrayOffsets:i,valuesDataBytesLength:n.length,elementSize:h,enumEntry:a});const T=e.count;return T?dBe(_,t,T,a):[]}return DP(_,0,t,a)}function hBe(r){const{valuesData:e,numberOfElements:t,arrayOffsets:n,valuesDataBytesLength:i,elementSize:s,enumEntry:a}=r,o=[];for(let h=0;h<t;h++){const f=n[h],_=n[h+1]-n[h];if(_+f>i)break;const x=f/s,T=_/s,I=DP(e,x,T,a);o.push(I)}return o}function dBe(r,e,t,n){const i=[];for(let s=0;s<e;s++){const a=t*s,o=DP(r,a,t,n);i.push(o)}return i}function DP(r,e,t,n){const i=[];for(let s=0;s<t;s++)if(r instanceof BigInt64Array||r instanceof BigUint64Array)i.push("");else{const a=r[e+s],o=fBe(n,a);o?i.push(o.name):i.push("")}return i}function fBe(r,e){for(const t of r.values)if(t.value===e)return t;return null}const ABe="schemaClassId";function pBe(r,e){var n,i;const t=r.getExtension(d0);if(t&&t.propertyTables)for(const s of t.propertyTables){const a=s.class,o=(i=(n=t.schema)==null?void 0:n.classes)==null?void 0:i[a];s.properties&&o&&gBe(s,o,r)}}function gBe(r,e,t){for(const n in r.properties){const i=r.properties[n].data;if(i){const s=e.properties[n];if(s){const a=bBe(i,s,t);r.properties[n]=a}}}}function mBe(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:ABe,n=r.getExtension(d0);n||(n=r.addExtension(d0)),n.schema=_Be(e,t,n.schema);const i=yBe(e,t,n.schema);return n.propertyTables||(n.propertyTables=[]),n.propertyTables.push(i)-1}function _Be(r,e,t){const n=t??{id:"schema_id"},i={properties:{}};for(const s of r){const a={type:s.elementType,componentType:s.componentType};i.properties[s.name]=a}return n.classes={},n.classes[e]=i,n}function yBe(r,e,t){var a;const n={class:e,count:0};let i=0;const s=(a=t.classes)==null?void 0:a[e];for(const o of r){if(i===0&&(i=o.values.length),i!==o.values.length&&o.values.length)throw new Error("Illegal values in attributes");(s==null?void 0:s.properties[o.name])&&(n.properties||(n.properties={}),n.properties[o.name]={values:0,data:o.values})}return n.count=i,n}function bBe(r,e,t){const n={values:0};if(e.type==="STRING"){const{stringData:i,stringOffsets:s}=wBe(r);n.stringOffsets=OP(s,t),n.values=OP(i,t)}else if(e.type==="SCALAR"&&e.componentType){const i=xBe(r,e.componentType);n.values=OP(i,t)}return n}const vBe={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:Int32Array,UINT64:Uint32Array,FLOAT32:Float32Array,FLOAT64:Float64Array};function xBe(r,e){const t=[];for(const i of r)t.push(Number(i));const n=vBe[e];if(!n)throw new Error("Illegal component type");return new n(t)}function wBe(r){const e=new TextEncoder,t=[];let n=0;for(const h of r){const f=e.encode(h);n+=f.length,t.push(f)}const i=new Uint8Array(n),s=[];let a=0;for(const h of t)i.set(h,a),s.push(a),a+=h.length;s.push(a);const o=new Uint32Array(s);return{stringData:i,stringOffsets:o}}function OP(r,e){return e.gltf.buffers.push({arrayBuffer:r.buffer,byteOffset:r.byteOffset,byteLength:r.byteLength}),e.addBufferView(r)}const BBe=Object.freeze(Object.defineProperty({__proto__:null,createExtStructuralMetadata:mBe,decode:J2e,encode:Z2e,name:X2e},Symbol.toStringTag,{value:"Module"})),VH="EXT_feature_metadata",CBe=VH;async function EBe(r,e){const t=new rc(r);TBe(t,e)}function TBe(r,e){var n,i;if(!((n=e.gltf)!=null&&n.loadBuffers))return;const t=r.getExtension(VH);t&&((i=e.gltf)!=null&&i.loadImages&&SBe(r,t),IBe(r,t))}function SBe(r,e){const t=e.schema;if(!t)return;const n=t.classes,{featureTextures:i}=e;if(n&&i)for(const s in n){const a=n[s],o=PBe(i,s);o&&RBe(r,o,a)}}function IBe(r,e){const t=e.schema;if(!t)return;const n=t.classes,i=e.featureTables;if(n&&i)for(const s in n){const a=MBe(i,s);a&&FBe(r,t,a)}}function MBe(r,e){for(const t in r){const n=r[t];if(n.class===e)return n}return null}function PBe(r,e){for(const t in r){const n=r[t];if(n.class===e)return n}return null}function FBe(r,e,t){var s,a;if(!t.class)return;const n=(s=e.classes)==null?void 0:s[t.class];if(!n)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${t.class}`);const i=t.count;for(const o in n.properties){const h=n.properties[o],f=(a=t.properties)==null?void 0:a[o];if(f){const _=LBe(r,e,h,i,f);f.data=_}}}function RBe(r,e,t){var i;const n=e.class;for(const s in t.properties){const a=(i=e==null?void 0:e.properties)==null?void 0:i[s];if(a){const o=NBe(r,a,n);a.data=o}}}function LBe(r,e,t,n,i){let s=[];const a=i.bufferView,o=r.getTypedArrayForBufferView(a),h=DBe(r,t,i,n),f=OBe(r,t,i,n);return t.type==="STRING"||t.componentType==="STRING"?s=HH(n,o,h,f):kBe(t)&&(s=UBe(t,n,o,h)),s}function DBe(r,e,t,n){return e.type==="ARRAY"&&typeof e.componentCount>"u"&&typeof t.arrayOffsetBufferView<"u"?V2(r,t.arrayOffsetBufferView,t.offsetType||"UINT32",n):null}function OBe(r,e,t,n){return typeof t.stringOffsetBufferView<"u"?V2(r,t.stringOffsetBufferView,t.offsetType||"UINT32",n):null}function kBe(r){const e=["UINT8","INT16","UINT16","INT32","UINT32","INT64","UINT64","FLOAT32","FLOAT64"];return e.includes(r.type)||typeof r.componentType<"u"&&e.includes(r.componentType)}function UBe(r,e,t,n){const i=r.type==="ARRAY",s=r.componentCount,a="SCALAR",o=r.componentType||r.type,h=RP(a,o),f=t.byteLength/h,_=G2(t,a,o,f);return i?n?NH(_,e,n,t.length,h):s?zH(_,e,s):[]:_}function NBe(r,e,t){const n=r.gltf.json;if(!n.meshes)return[];const i=[];for(const s of n.meshes)for(const a of s.primitives)zBe(r,t,e,i,a);return i}function zBe(r,e,t,n,i){const s={channels:t.channels,...t.texture},a=LP(r,s,i);a&&UH(r,e,a,n,i)}const HBe=Object.freeze(Object.defineProperty({__proto__:null,decode:EBe,name:CBe},Symbol.toStringTag,{value:"Module"})),VBe="4.3.2",GBe="4.3.2";function QBe(){var r;return(r=globalThis._loadersgl_)!=null&&r.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.2"),globalThis._loadersgl_.version}const $Be=QBe();function jBe(r,e){if(!r)throw new Error("loaders.gl assertion failed.")}const sb=typeof process!="object"||String(process)!=="[object process]"||process.browser,kP=typeof importScripts=="function",GH=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);GH&&parseFloat(GH[1]);const UP={};async function Q2(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;return e&&(r=qBe(r,e,t,n)),UP[r]=UP[r]||KBe(r),await UP[r]}function qBe(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(!t.useLocalLibraries&&r.startsWith("http"))return r;n=n||r;const i=t.modules||{};return i[n]?i[n]:sb?t.CDN?(jBe(t.CDN.startsWith("http")),`${t.CDN}/${e}@${$Be}/dist/libs/${n}`):kP?`../src/libs/${n}`:`modules/${e}/src/libs/${n}`:`modules/${e}/dist/libs/${n}`}async function KBe(r){if(r.endsWith("wasm"))return await XBe(r);if(!sb)try{const{requireFromFile:t}=globalThis.loaders||{};return await(t==null?void 0:t(r))}catch(t){return console.error(t),null}if(kP)return importScripts(r);const e=await JBe(r);return WBe(e,r)}function WBe(r,e){if(!sb){const{requireFromString:n}=globalThis.loaders||{};return n==null?void 0:n(r,e)}if(kP)return eval.call(globalThis,r),null;const t=document.createElement("script");t.id=e;try{t.appendChild(document.createTextNode(r))}catch{t.text=r}return document.body.appendChild(t),null}async function XBe(r){const{readFileAsArrayBuffer:e}=globalThis.loaders||{};return sb||!e||r.startsWith("http")?await(await fetch(r)).arrayBuffer():await e(r)}async function JBe(r){const{readFileAsText:e}=globalThis.loaders||{};return sb||!e||r.startsWith("http")?await(await fetch(r)).text():await e(r)}const $2={TRANSCODER:"basis_transcoder.js",TRANSCODER_WASM:"basis_transcoder.wasm",ENCODER:"basis_encoder.js",ENCODER_WASM:"basis_encoder.wasm"};let QH;async function $H(r){jAe(r.modules);const e=qAe("basis");return e||(QH||(QH=ZBe(r)),await QH)}async function ZBe(r){let e=null,t=null;return[e,t]=await Promise.all([await Q2($2.TRANSCODER,"textures",r),await Q2($2.TRANSCODER_WASM,"textures",r)]),e=e||globalThis.BASIS,await YBe(e,t)}function YBe(r,e){const t={};return e&&(t.wasmBinary=e),new Promise(n=>{r(t).then(i=>{const{BasisFile:s,initializeBasis:a}=i;a(),n({BasisFile:s})})})}let NP;async function jH(r){const e=r.modules||{};return e.basisEncoder?e.basisEncoder:(NP=NP||eCe(r),await NP)}async function eCe(r){let e=null,t=null;return[e,t]=await Promise.all([await Q2($2.ENCODER,"textures",r),await Q2($2.ENCODER_WASM,"textures",r)]),e=e||globalThis.BASIS,await tCe(e,t)}function tCe(r,e){const t={};return e&&(t.wasmBinary=e),new Promise(n=>{r(t).then(i=>{const{BasisFile:s,KTX2File:a,initializeBasis:o,BasisEncoder:h}=i;o(),n({BasisFile:s,KTX2File:a,BasisEncoder:h})})})}const f0={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35987,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,COMPRESSED_RGBA_ASTC_4X4_KHR:37808,COMPRESSED_RGBA_ASTC_5X4_KHR:37809,COMPRESSED_RGBA_ASTC_5X5_KHR:37810,COMPRESSED_RGBA_ASTC_6X5_KHR:37811,COMPRESSED_RGBA_ASTC_6X6_KHR:37812,COMPRESSED_RGBA_ASTC_8X5_KHR:37813,COMPRESSED_RGBA_ASTC_8X6_KHR:37814,COMPRESSED_RGBA_ASTC_8X8_KHR:37815,COMPRESSED_RGBA_ASTC_10X5_KHR:37816,COMPRESSED_RGBA_ASTC_10X6_KHR:37817,COMPRESSED_RGBA_ASTC_10X8_KHR:37818,COMPRESSED_RGBA_ASTC_10X10_KHR:37819,COMPRESSED_RGBA_ASTC_12X10_KHR:37820,COMPRESSED_RGBA_ASTC_12X12_KHR:37821,COMPRESSED_SRGB8_ALPHA8_ASTC_4X4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5X4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5X5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6X5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6X6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8X5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8X6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8X8_KHR:37847,COMPRESSED_SRGB8_ALPHA8_ASTC_10X5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10X6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10X8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_10X10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_12X10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12X12_KHR:37853,COMPRESSED_RED_RGTC1_EXT:36283,COMPRESSED_SIGNED_RED_RGTC1_EXT:36284,COMPRESSED_RED_GREEN_RGTC2_EXT:36285,COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT:36286,COMPRESSED_SRGB_S3TC_DXT1_EXT:35916,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:35919},rCe=["","WEBKIT_","MOZ_"],qH={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let j2=null;function nCe(r){if(!j2){r=r||iCe()||void 0,j2=new Set;for(const e of rCe)for(const t in qH)if(r&&r.getExtension(`${e}${t}`)){const n=qH[t];j2.add(n)}}return j2}function iCe(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}const Mh=[171,75,84,88,32,50,48,187,13,10,26,10];function sCe(r){const e=new Uint8Array(r);return!(e.byteLength<Mh.length||e[0]!==Mh[0]||e[1]!==Mh[1]||e[2]!==Mh[2]||e[3]!==Mh[3]||e[4]!==Mh[4]||e[5]!==Mh[5]||e[6]!==Mh[6]||e[7]!==Mh[7]||e[8]!==Mh[8]||e[9]!==Mh[9]||e[10]!==Mh[10]||e[11]!==Mh[11])}const oCe={etc1:{basisFormat:0,compressed:!0,format:f0.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:f0.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:f0.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:f0.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:f0.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:f0.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function aCe(r,e){if(e.basis.containerFormat==="auto"){if(sCe(r)){const n=await jH(e);return KH(n.KTX2File,r,e)}const{BasisFile:t}=await $H(e);return zP(t,r,e)}switch(e.basis.module){case"encoder":const t=await jH(e);switch(e.basis.containerFormat){case"ktx2":return KH(t.KTX2File,r,e);case"basis":default:return zP(t.BasisFile,r,e)}case"transcoder":default:const{BasisFile:n}=await $H(e);return zP(n,r,e)}}function zP(r,e,t){const n=new r(new Uint8Array(e));try{if(!n.startTranscoding())throw new Error("Failed to start basis transcoding");const i=n.getNumImages(),s=[];for(let a=0;a<i;a++){const o=n.getNumLevels(a),h=[];for(let f=0;f<o;f++)h.push(lCe(n,a,f,t));s.push(h)}return s}finally{n.close(),n.delete()}}function lCe(r,e,t,n){const i=r.getImageWidth(e,t),s=r.getImageHeight(e,t),a=r.getHasAlpha(),{compressed:o,format:h,basisFormat:f}=WH(n,a),_=r.getImageTranscodedSizeInBytes(e,t,f),x=new Uint8Array(_);if(!r.transcodeImage(x,e,t,f,0,0))throw new Error("failed to start Basis transcoding");return{width:i,height:s,data:x,compressed:o,format:h,hasAlpha:a}}function KH(r,e,t){const n=new r(new Uint8Array(e));try{if(!n.startTranscoding())throw new Error("failed to start KTX2 transcoding");const i=n.getLevels(),s=[];for(let a=0;a<i;a++)s.push(cCe(n,a,t));return[s]}finally{n.close(),n.delete()}}function cCe(r,e,t){const{alphaFlag:n,height:i,width:s}=r.getImageLevelInfo(e,0,0),{compressed:a,format:o,basisFormat:h}=WH(t,n),f=r.getImageTranscodedSizeInBytes(e,0,0,h),_=new Uint8Array(f);if(!r.transcodeImage(_,e,0,0,h,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:s,height:i,data:_,compressed:a,levelSize:f,hasAlpha:n,format:o}}function WH(r,e){let t=r&&r.basis&&r.basis.format;return t==="auto"&&(t=XH()),typeof t=="object"&&(t=e?t.alpha:t.noAlpha),t=t.toLowerCase(),oCe[t]}function XH(){const r=nCe();return r.has("astc")?"astc-4x4":r.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:r.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:r.has("etc1")?"etc1":r.has("etc2")?"etc2":"rgb565"}const uCe={...{dataType:null,batchType:null,name:"Basis",id:"basis",module:"textures",version:GBe,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},parse:aCe},A0=!0,JH=1735152710,HP=12,q2=8,hCe=1313821514,dCe=5130562,fCe=0,ACe=0,pCe=1;function gCe(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return`${String.fromCharCode(r.getUint8(e+0))}${String.fromCharCode(r.getUint8(e+1))}${String.fromCharCode(r.getUint8(e+2))}${String.fromCharCode(r.getUint8(e+3))}`}function mCe(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const n=new DataView(r),{magic:i=JH}=t,s=n.getUint32(e,!1);return s===i||s===JH}function _Ce(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const n=new DataView(e),i=gCe(n,t+0),s=n.getUint32(t+4,A0),a=n.getUint32(t+8,A0);switch(Object.assign(r,{header:{byteOffset:t,byteLength:a,hasBinChunk:!1},type:i,version:s,json:{},binChunks:[]}),t+=HP,r.version){case 1:return yCe(r,n,t);case 2:return bCe(r,n,t,{});default:throw new Error(`Invalid GLB version ${r.version}. Only supports version 1 and 2.`)}}function yCe(r,e,t){Po(r.header.byteLength>HP+q2);const n=e.getUint32(t+0,A0),i=e.getUint32(t+4,A0);return t+=q2,Po(i===fCe),VP(r,e,t,n),t+=n,t+=GP(r,e,t,r.header.byteLength),t}function bCe(r,e,t,n){return Po(r.header.byteLength>HP+q2),vCe(r,e,t,n),t+r.header.byteLength}function vCe(r,e,t,n){for(;t+8<=r.header.byteLength;){const i=e.getUint32(t+0,A0),s=e.getUint32(t+4,A0);switch(t+=q2,s){case hCe:VP(r,e,t,i);break;case dCe:GP(r,e,t,i);break;case ACe:n.strict||VP(r,e,t,i);break;case pCe:n.strict||GP(r,e,t,i);break}t+=U1(i,4)}return t}function VP(r,e,t,n){const i=new Uint8Array(e.buffer,t,n),a=new TextDecoder("utf8").decode(i);return r.json=JSON.parse(a),U1(n,4)}function GP(r,e,t,n){return r.header.hasBinChunk=!0,r.binChunks.push({byteOffset:t,byteLength:n,arrayBuffer:e.buffer}),U1(n,4)}function ZH(r,e){if(r.startsWith("data:")||r.startsWith("http:")||r.startsWith("https:"))return r;const n=e.baseUri||e.uri;if(!n)throw new Error(`'baseUri' must be provided to resolve relative url ${r}`);return n.substr(0,n.lastIndexOf("/")+1)+r}const xCe="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",wCe="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",BCe=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),CCe=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),ECe={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},TCe={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function SCe(r,e,t,n,i){let s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"NONE";const a=await ICe();FCe(a,a.exports[TCe[i]],r,e,t,n,a.exports[ECe[s||"NONE"]])}let QP;async function ICe(){return QP||(QP=MCe()),QP}async function MCe(){let r=xCe;WebAssembly.validate(BCe)&&(r=wCe,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const e=await WebAssembly.instantiate(PCe(r),{});return await e.instance.exports.__wasm_call_ctors(),e.instance}function PCe(r){const e=new Uint8Array(r.length);for(let n=0;n<r.length;++n){const i=r.charCodeAt(n);e[n]=i>96?i-71:i>64?i-65:i>47?i+4:i>46?63:62}let t=0;for(let n=0;n<r.length;++n)e[t++]=e[n]<60?CCe[e[n]]:(e[n]-60)*64+e[++n];return e.buffer.slice(0,t)}function FCe(r,e,t,n,i,s,a){const o=r.exports.sbrk,h=n+3&-4,f=o(h*i),_=o(s.length),x=new Uint8Array(r.exports.memory.buffer);x.set(s,_);const T=e(f,n,i,_,s.length);if(T===0&&a&&a(f,h,i),t.set(x.subarray(f,f+n*i)),o(f-o(0)),T!==0)throw new Error(`Malformed buffer data: ${T}`)}const K2="EXT_meshopt_compression",RCe=K2;async function LCe(r,e){var i,s;const t=new rc(r);if(!((i=e==null?void 0:e.gltf)!=null&&i.decompressMeshes)||!((s=e.gltf)!=null&&s.loadBuffers))return;const n=[];for(const a of r.json.bufferViews||[])n.push(DCe(t,a));await Promise.all(n),t.removeExtension(K2)}async function DCe(r,e){const t=r.getObjectExtension(e,K2);if(t){const{byteOffset:n=0,byteLength:i=0,byteStride:s,count:a,mode:o,filter:h="NONE",buffer:f}=t,_=r.gltf.buffers[f],x=new Uint8Array(_.arrayBuffer,_.byteOffset+n,i),T=new Uint8Array(r.gltf.buffers[e.buffer].arrayBuffer,e.byteOffset,e.byteLength);await SCe(T,a,s,x,o,h),r.removeObjectExtension(e,K2)}}const OCe=Object.freeze(Object.defineProperty({__proto__:null,decode:LCe,name:RCe},Symbol.toStringTag,{value:"Module"})),p0="EXT_texture_webp",kCe=p0;function UCe(r,e){const t=new rc(r);if(!B2e("image/webp")){if(t.getRequiredExtensions().includes(p0))throw new Error(`gltf: Required extension ${p0} not supported by browser`);return}const{json:n}=t;for(const i of n.textures||[]){const s=t.getObjectExtension(i,p0);s&&(i.source=s.source),t.removeObjectExtension(i,p0)}t.removeExtension(p0)}const NCe=Object.freeze(Object.defineProperty({__proto__:null,name:kCe,preprocess:UCe},Symbol.toStringTag,{value:"Module"})),W2="KHR_texture_basisu",zCe=W2;function HCe(r,e){const t=new rc(r),{json:n}=t;for(const i of n.textures||[]){const s=t.getObjectExtension(i,W2);s&&(i.source=s.source,t.removeObjectExtension(i,W2))}t.removeExtension(W2)}const VCe=Object.freeze(Object.defineProperty({__proto__:null,name:zCe,preprocess:HCe},Symbol.toStringTag,{value:"Module"}));function GCe(r){const e={};for(const t in r){const n=r[t];if(t!=="indices"){const i=YH(n);e[t]=i}}return e}function YH(r){const{buffer:e,size:t,count:n}=QCe(r);return{value:e,size:t,byteOffset:0,count:n,type:RH(t),componentType:H2(e)}}function QCe(r){let e=r,t=1,n=0;return r&&r.value&&(e=r.value,t=r.size||1),e&&(ArrayBuffer.isView(e)||(e=$Ce(e,Float32Array)),n=e.length/t),{buffer:e,size:t,count:n}}function $Ce(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return r?Array.isArray(r)?new e(r):t&&!(r instanceof e)?new e(r):r:null}const vp="KHR_draco_mesh_compression",jCe=vp;function qCe(r,e,t){const n=new rc(r);for(const i of eV(n))n.getObjectExtension(i,vp)}async function KCe(r,e,t){var s;if(!((s=e==null?void 0:e.gltf)!=null&&s.decompressMeshes))return;const n=new rc(r),i=[];for(const a of eV(n))n.getObjectExtension(a,vp)&&i.push(XCe(n,a,e,t));await Promise.all(i),n.removeExtension(vp)}function WCe(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const t=new rc(r);for(const n of t.json.meshes||[])JCe(n,e),t.addRequiredExtension(vp)}async function XCe(r,e,t,n){const i=r.getObjectExtension(e,vp);if(!i)return;const s=r.getTypedArrayForBufferView(i.bufferView),a=tM(s.buffer,s.byteOffset),o={...t};delete o["3d-tiles"];const h=await k1(a,_H,o,n),f=GCe(h.attributes);for(const[_,x]of Object.entries(f))if(_ in e.attributes){const T=e.attributes[_],I=r.getAccessor(T);I!=null&&I.min&&(I!=null&&I.max)&&(x.min=I.min,x.max=I.max)}e.attributes=f,h.indices&&(e.indices=YH(h.indices)),r.removeObjectExtension(e,vp),ZCe(e)}function JCe(r,e){var _;let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:4,n=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0;if(!n.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const s=n.DracoWriter.encodeSync({attributes:r}),a=(_=i==null?void 0:i.parseSync)==null?void 0:_.call(i,{attributes:r}),o=n._addFauxAttributes(a.attributes),h=n.addBufferView(s);return{primitives:[{attributes:o,mode:t,extensions:{[vp]:{bufferView:h,attributes:o}}}]}}function ZCe(r){if(!r.attributes&&Object.keys(r.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*eV(r){for(const e of r.json.meshes||[])for(const t of e.primitives)yield t}const YCe=Object.freeze(Object.defineProperty({__proto__:null,decode:KCe,encode:WCe,name:jCe,preprocess:qCe},Symbol.toStringTag,{value:"Module"})),X2="KHR_texture_transform",eEe=X2,J2=new yr,tEe=new ma,rEe=new ma;async function nEe(r,e){var s;if(!new rc(r).hasExtension(X2)||!((s=e.gltf)!=null&&s.loadBuffers))return;const i=r.json.materials||[];for(let a=0;a<i.length;a++)iEe(a,r)}function iEe(r,e){var s,a,o,h;const t=(s=e.json.materials)==null?void 0:s[r],n=[(a=t==null?void 0:t.pbrMetallicRoughness)==null?void 0:a.baseColorTexture,t==null?void 0:t.emissiveTexture,t==null?void 0:t.normalTexture,t==null?void 0:t.occlusionTexture,(o=t==null?void 0:t.pbrMetallicRoughness)==null?void 0:o.metallicRoughnessTexture],i=[];for(const f of n)f&&((h=f==null?void 0:f.extensions)!=null&&h[X2])&&sEe(e,r,f,i)}function sEe(r,e,t,n){const i=oEe(t,n);if(!i)return;const s=r.json.meshes||[];for(const a of s)for(const o of a.primitives){const h=o.material;Number.isFinite(h)&&e===h&&aEe(r,o,i)}}function oEe(r,e){var a;const t=(a=r.extensions)==null?void 0:a[X2],{texCoord:n=0}=r,{texCoord:i=n}=t;if(!(e.findIndex(o=>{let[h,f]=o;return h===n&&f===i})!==-1)){const o=uEe(t);return n!==i&&(r.texCoord=i),e.push([n,i]),{originalTexCoord:n,texCoord:i,matrix:o}}return null}function aEe(r,e,t){var o,h;const{originalTexCoord:n,texCoord:i,matrix:s}=t,a=e.attributes[`TEXCOORD_${n}`];if(Number.isFinite(a)){const f=(o=r.json.accessors)==null?void 0:o[a];if(f&&f.bufferView){const _=(h=r.json.bufferViews)==null?void 0:h[f.bufferView];if(_){const{arrayBuffer:x,byteOffset:T}=r.buffers[_.buffer],I=(T||0)+(f.byteOffset||0)+(_.byteOffset||0),{ArrayType:N,length:$}=FP(f,_),W=PH[f.componentType],Y=MH[f.type],ie=_.byteStride||W*Y,ce=new Float32Array($);for(let fe=0;fe<f.count;fe++){const ve=new N(x,I+fe*ie,2);J2.set(ve[0],ve[1],1),J2.transformByMatrix3(s),ce.set([J2[0],J2[1]],fe*Y)}n===i?lEe(f,_,r.buffers,ce):cEe(i,f,e,r,ce)}}}}function lEe(r,e,t,n){r.componentType=5126,t.push({arrayBuffer:n.buffer,byteOffset:0,byteLength:n.buffer.byteLength}),e.buffer=t.length-1,e.byteLength=n.buffer.byteLength,e.byteOffset=0,delete e.byteStride}function cEe(r,e,t,n,i){n.buffers.push({arrayBuffer:i.buffer,byteOffset:0,byteLength:i.buffer.byteLength});const s=n.json.bufferViews;if(!s)return;s.push({buffer:n.buffers.length-1,byteLength:i.buffer.byteLength,byteOffset:0});const a=n.json.accessors;a&&(a.push({bufferView:(s==null?void 0:s.length)-1,byteOffset:0,componentType:5126,count:e.count,type:"VEC2"}),t.attributes[`TEXCOORD_${r}`]=a.length-1)}function uEe(r){const{offset:e=[0,0],rotation:t=0,scale:n=[1,1]}=r,i=new ma().set(1,0,0,0,1,0,e[0],e[1],1),s=tEe.set(Math.cos(t),Math.sin(t),0,-Math.sin(t),Math.cos(t),0,0,0,1),a=rEe.set(n[0],0,0,0,n[1],0,0,0,1);return i.multiplyRight(s).multiplyRight(a)}const hEe=Object.freeze(Object.defineProperty({__proto__:null,decode:nEe,name:eEe},Symbol.toStringTag,{value:"Module"})),qg="KHR_lights_punctual",dEe=qg;async function fEe(r){const e=new rc(r),{json:t}=e,n=e.getExtension(qg);n&&(e.json.lights=n.lights,e.removeExtension(qg));for(const i of t.nodes||[]){const s=e.getObjectExtension(i,qg);s&&(i.light=s.light),e.removeObjectExtension(i,qg)}}async function AEe(r){const e=new rc(r),{json:t}=e;if(t.lights){const n=e.addExtension(qg);Ih(!n.lights),n.lights=t.lights,delete t.lights}if(e.json.lights){for(const n of e.json.lights){const i=n.node;e.addObjectExtension(i,qg,n)}delete e.json.lights}}const pEe=Object.freeze(Object.defineProperty({__proto__:null,decode:fEe,encode:AEe,name:dEe},Symbol.toStringTag,{value:"Module"})),ob="KHR_materials_unlit",gEe=ob;async function mEe(r){const e=new rc(r),{json:t}=e;for(const n of t.materials||[])n.extensions&&n.extensions.KHR_materials_unlit&&(n.unlit=!0),e.removeObjectExtension(n,ob);e.removeExtension(ob)}function _Ee(r){const e=new rc(r),{json:t}=e;if(e.materials)for(const n of t.materials||[])n.unlit&&(delete n.unlit,e.addObjectExtension(n,ob,{}),e.addExtension(ob))}const yEe=Object.freeze(Object.defineProperty({__proto__:null,decode:mEe,encode:_Ee,name:gEe},Symbol.toStringTag,{value:"Module"})),ab="KHR_techniques_webgl",bEe=ab;async function vEe(r){const e=new rc(r),{json:t}=e,n=e.getExtension(ab);if(n){const i=wEe(n,e);for(const s of t.materials||[]){const a=e.getObjectExtension(s,ab);a&&(s.technique=Object.assign({},a,i[a.technique]),s.technique.values=BEe(s.technique,e)),e.removeObjectExtension(s,ab)}e.removeExtension(ab)}}async function xEe(r,e){}function wEe(r,e){const{programs:t=[],shaders:n=[],techniques:i=[]}=r,s=new TextDecoder;return n.forEach(a=>{if(Number.isFinite(a.bufferView))a.code=s.decode(e.getTypedArrayForBufferView(a.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),t.forEach(a=>{a.fragmentShader=n[a.fragmentShader],a.vertexShader=n[a.vertexShader]}),i.forEach(a=>{a.program=t[a.program]}),i}function BEe(r,e){const t=Object.assign({},r.values);return Object.keys(r.uniforms||{}).forEach(n=>{r.uniforms[n].value&&!(n in t)&&(t[n]=r.uniforms[n].value)}),Object.keys(t).forEach(n=>{typeof t[n]=="object"&&t[n].index!==void 0&&(t[n].texture=e.getTexture(t[n].index))}),t}const tV=[BBe,W2e,OCe,NCe,VCe,YCe,pEe,yEe,Object.freeze(Object.defineProperty({__proto__:null,decode:vEe,encode:xEe,name:bEe},Symbol.toStringTag,{value:"Module"})),hEe,HBe];function CEe(r){var i;let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=arguments.length>2?arguments[2]:void 0;const n=tV.filter(s=>rV(s.name,e));for(const s of n)(i=s.preprocess)==null||i.call(s,r,e,t)}async function EEe(r){var i;let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=arguments.length>2?arguments[2]:void 0;const n=tV.filter(s=>rV(s.name,e));for(const s of n)await((i=s.decode)==null?void 0:i.call(s,r,e,t))}function rV(r,e){var i;const t=((i=e==null?void 0:e.gltf)==null?void 0:i.excludeExtensions)||{};return!(r in t&&!t[r])}const $P="KHR_binary_glTF";function TEe(r){const e=new rc(r),{json:t}=e;for(const n of t.images||[]){const i=e.getObjectExtension(n,$P);i&&Object.assign(n,i),e.removeObjectExtension(n,$P)}t.buffers&&t.buffers[0]&&delete t.buffers[0].uri,e.removeExtension($P)}const nV={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},SEe={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};let IEe=class{constructor(){xe(this,"idToIndexMap",{animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}});xe(this,"json")}normalize(e,t){this.json=e.json;const n=e.json;switch(n.asset&&n.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn(`glTF: Unknown version ${n.asset.version}`);return}if(!t.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(n),this._convertTopLevelObjectsToArrays(n),TEe(e),this._convertObjectIdsToArrayIndices(n),this._updateObjects(n),this._updateMaterial(n)}_addAsset(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(e){for(const t in nV)this._convertTopLevelObjectToArray(e,t)}_convertTopLevelObjectToArray(e,t){const n=e[t];if(!(!n||Array.isArray(n))){e[t]=[];for(const i in n){const s=n[i];s.id=s.id||i;const a=e[t].length;e[t].push(s),this.idToIndexMap[t][i]=a}}}_convertObjectIdsToArrayIndices(e){for(const t in nV)this._convertIdsToIndices(e,t);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));for(const t of e.textures)this._convertTextureIds(t);for(const t of e.meshes)this._convertMeshIds(t);for(const t of e.nodes)this._convertNodeIds(t);for(const t of e.scenes)this._convertSceneIds(t)}_convertTextureIds(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}_convertMeshIds(e){for(const t of e.primitives){const{attributes:n,indices:i,material:s}=t;for(const a in n)n[a]=this._convertIdToIndex(n[a],"accessor");i&&(t.indices=this._convertIdToIndex(i,"accessor")),s&&(t.material=this._convertIdToIndex(s,"material"))}}_convertNodeIds(e){e.children&&(e.children=e.children.map(t=>this._convertIdToIndex(t,"node"))),e.meshes&&(e.meshes=e.meshes.map(t=>this._convertIdToIndex(t,"mesh")))}_convertSceneIds(e){e.nodes&&(e.nodes=e.nodes.map(t=>this._convertIdToIndex(t,"node")))}_convertIdsToIndices(e,t){e[t]||(console.warn(`gltf v1: json doesn't contain attribute ${t}`),e[t]=[]);for(const n of e[t])for(const i in n){const s=n[i],a=this._convertIdToIndex(s,i);n[i]=a}}_convertIdToIndex(e,t){const n=SEe[t];if(n in this.idToIndexMap){const i=this.idToIndexMap[n][e];if(!Number.isFinite(i))throw new Error(`gltf v1: failed to resolve ${t} with id ${e}`);return i}return e}_updateObjects(e){for(const t of this.json.buffers)delete t.type}_updateMaterial(e){var t,n,i;for(const s of e.materials){s.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const a=((t=s.values)==null?void 0:t.tex)||((n=s.values)==null?void 0:n.texture2d_0)||((i=s.values)==null?void 0:i.diffuseTex),o=e.textures.findIndex(h=>h.id===a);o!==-1&&(s.pbrMetallicRoughness.baseColorTexture={index:o})}}};function MEe(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new IEe().normalize(r,e)}async function PEe(r,e){var s,a,o;let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0;return FEe(r,e,t,n),MEe(r,{normalize:(s=n==null?void 0:n.gltf)==null?void 0:s.normalize}),CEe(r,n,i),(a=n==null?void 0:n.gltf)!=null&&a.loadBuffers&&r.json.buffers&&await REe(r,n,i),(o=n==null?void 0:n.gltf)!=null&&o.loadImages&&await LEe(r,n,i),await EEe(r,n,i),r}function FEe(r,e,t,n){if(n.uri&&(r.baseUri=n.uri),e instanceof ArrayBuffer&&!mCe(e,t,n)&&(e=new TextDecoder().decode(e)),typeof e=="string")r.json=WAe(e);else if(e instanceof ArrayBuffer){const a={};t=_Ce(a,e,t,n.glb),Ih(a.type==="glTF",`Invalid GLB magic string ${a.type}`),r._glb=a,r.json=a.json}else Ih(!1,"GLTF: must be ArrayBuffer or string");const i=r.json.buffers||[];if(r.buffers=new Array(i.length).fill(null),r._glb&&r._glb.header.hasBinChunk){const{binChunks:a}=r._glb;r.buffers[0]={arrayBuffer:a[0].arrayBuffer,byteOffset:a[0].byteOffset,byteLength:a[0].byteLength}}const s=r.json.images||[];r.images=new Array(s.length).fill({})}async function REe(r,e,t){var i,s;const n=r.json.buffers||[];for(let a=0;a<n.length;++a){const o=n[a];if(o.uri){const{fetch:h}=t;Ih(h);const f=ZH(o.uri,e),_=await((i=t==null?void 0:t.fetch)==null?void 0:i.call(t,f)),x=await((s=_==null?void 0:_.arrayBuffer)==null?void 0:s.call(_));r.buffers[a]={arrayBuffer:x,byteOffset:0,byteLength:x.byteLength},delete o.uri}else r.buffers[a]===null&&(r.buffers[a]={arrayBuffer:new ArrayBuffer(o.byteLength),byteOffset:0,byteLength:o.byteLength})}}async function LEe(r,e,t){const n=DEe(r),i=r.json.images||[],s=[];for(const a of n)s.push(OEe(r,i[a],a,e,t));return await Promise.all(s)}function DEe(r){const e=new Set,t=r.json.textures||[];for(const n of t)n.source!==void 0&&e.add(n.source);return Array.from(e).sort()}async function OEe(r,e,t,n,i){let s;if(e.uri&&!e.hasOwnProperty("bufferView")){const o=ZH(e.uri,n),{fetch:h}=i;s=await(await h(o)).arrayBuffer(),e.bufferView={data:s}}if(Number.isFinite(e.bufferView)){const o=L2e(r.json,r.buffers,e.bufferView);s=tM(o.buffer,o.byteOffset,o.byteLength)}Ih(s,"glTF image has no data");let a=await k1(s,[w2e,uCe],{...n,mimeType:e.mimeType,basis:n.basis||{format:XH()}},i);a&&a[0]&&(a={compressed:!0,mipmaps:!1,width:a[0].width,height:a[0].height,data:a[0]}),r.images=r.images||[],r.images[t]=a}const Z2={dataType:null,batchType:null,name:"glTF",id:"gltf",module:"gltf",version:VBe,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:kEe,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0},log:console}};async function kEe(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=arguments.length>2?arguments[2]:void 0;e={...Z2.options,...e},e.gltf={...Z2.options.gltf,...e.gltf};const{byteOffset:n=0}=e;return await PEe({},r,n,e,t)}const UEe={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},NEe={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},ud={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},zEe={magFilter:ud.TEXTURE_MAG_FILTER,minFilter:ud.TEXTURE_MIN_FILTER,wrapS:ud.TEXTURE_WRAP_S,wrapT:ud.TEXTURE_WRAP_T},HEe={[ud.TEXTURE_MAG_FILTER]:ud.LINEAR,[ud.TEXTURE_MIN_FILTER]:ud.NEAREST_MIPMAP_LINEAR,[ud.TEXTURE_WRAP_S]:ud.REPEAT,[ud.TEXTURE_WRAP_T]:ud.REPEAT};function VEe(){return{id:"default-sampler",parameters:HEe}}function GEe(r){return NEe[r]}function QEe(r){return UEe[r]}let $Ee=class{constructor(){xe(this,"baseUri","");xe(this,"jsonUnprocessed");xe(this,"json");xe(this,"buffers",[]);xe(this,"images",[])}postProcess(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{json:n,buffers:i=[],images:s=[]}=e,{baseUri:a=""}=e;return Ih(n),this.baseUri=a,this.buffers=i,this.images=s,this.jsonUnprocessed=n,this.json=this._resolveTree(e.json,t),this.json}_resolveTree(e){const t={...e};return this.json=t,e.bufferViews&&(t.bufferViews=e.bufferViews.map((n,i)=>this._resolveBufferView(n,i))),e.images&&(t.images=e.images.map((n,i)=>this._resolveImage(n,i))),e.samplers&&(t.samplers=e.samplers.map((n,i)=>this._resolveSampler(n,i))),e.textures&&(t.textures=e.textures.map((n,i)=>this._resolveTexture(n,i))),e.accessors&&(t.accessors=e.accessors.map((n,i)=>this._resolveAccessor(n,i))),e.materials&&(t.materials=e.materials.map((n,i)=>this._resolveMaterial(n,i))),e.meshes&&(t.meshes=e.meshes.map((n,i)=>this._resolveMesh(n,i))),e.nodes&&(t.nodes=e.nodes.map((n,i)=>this._resolveNode(n,i)),t.nodes=t.nodes.map((n,i)=>this._resolveNodeChildren(n))),e.skins&&(t.skins=e.skins.map((n,i)=>this._resolveSkin(n,i))),e.scenes&&(t.scenes=e.scenes.map((n,i)=>this._resolveScene(n,i))),typeof this.json.scene=="number"&&t.scenes&&(t.scene=t.scenes[this.json.scene]),t}getScene(e){return this._get(this.json.scenes,e)}getNode(e){return this._get(this.json.nodes,e)}getSkin(e){return this._get(this.json.skins,e)}getMesh(e){return this._get(this.json.meshes,e)}getMaterial(e){return this._get(this.json.materials,e)}getAccessor(e){return this._get(this.json.accessors,e)}getCamera(e){return this._get(this.json.cameras,e)}getTexture(e){return this._get(this.json.textures,e)}getSampler(e){return this._get(this.json.samplers,e)}getImage(e){return this._get(this.json.images,e)}getBufferView(e){return this._get(this.json.bufferViews,e)}getBuffer(e){return this._get(this.json.buffers,e)}_get(e,t){if(typeof t=="object")return t;const n=e&&e[t];return n||console.warn(`glTF file error: Could not find ${e}[${t}]`),n}_resolveScene(e,t){return{...e,id:e.id||`scene-${t}`,nodes:(e.nodes||[]).map(n=>this.getNode(n))}}_resolveNode(e,t){const n={...e,id:(e==null?void 0:e.id)||`node-${t}`};return e.mesh!==void 0&&(n.mesh=this.getMesh(e.mesh)),e.camera!==void 0&&(n.camera=this.getCamera(e.camera)),e.skin!==void 0&&(n.skin=this.getSkin(e.skin)),e.meshes!==void 0&&e.meshes.length&&(n.mesh=e.meshes.reduce((i,s)=>{const a=this.getMesh(s);return i.id=a.id,i.primitives=i.primitives.concat(a.primitives),i},{primitives:[]})),n}_resolveNodeChildren(e){return e.children&&(e.children=e.children.map(t=>this.getNode(t))),e}_resolveSkin(e,t){const n=typeof e.inverseBindMatrices=="number"?this.getAccessor(e.inverseBindMatrices):void 0;return{...e,id:e.id||`skin-${t}`,inverseBindMatrices:n}}_resolveMesh(e,t){const n={...e,id:e.id||`mesh-${t}`,primitives:[]};return e.primitives&&(n.primitives=e.primitives.map(i=>{const s={...i,attributes:{},indices:void 0,material:void 0},a=i.attributes;for(const o in a)s.attributes[o]=this.getAccessor(a[o]);return i.indices!==void 0&&(s.indices=this.getAccessor(i.indices)),i.material!==void 0&&(s.material=this.getMaterial(i.material)),s})),n}_resolveMaterial(e,t){const n={...e,id:e.id||`material-${t}`};if(n.normalTexture&&(n.normalTexture={...n.normalTexture},n.normalTexture.texture=this.getTexture(n.normalTexture.index)),n.occlusionTexture&&(n.occlusionTexture={...n.occlusionTexture},n.occlusionTexture.texture=this.getTexture(n.occlusionTexture.index)),n.emissiveTexture&&(n.emissiveTexture={...n.emissiveTexture},n.emissiveTexture.texture=this.getTexture(n.emissiveTexture.index)),n.emissiveFactor||(n.emissiveFactor=n.emissiveTexture?[1,1,1]:[0,0,0]),n.pbrMetallicRoughness){n.pbrMetallicRoughness={...n.pbrMetallicRoughness};const i=n.pbrMetallicRoughness;i.baseColorTexture&&(i.baseColorTexture={...i.baseColorTexture},i.baseColorTexture.texture=this.getTexture(i.baseColorTexture.index)),i.metallicRoughnessTexture&&(i.metallicRoughnessTexture={...i.metallicRoughnessTexture},i.metallicRoughnessTexture.texture=this.getTexture(i.metallicRoughnessTexture.index))}return n}_resolveAccessor(e,t){const n=GEe(e.componentType),i=QEe(e.type),s=n*i,a={...e,id:e.id||`accessor-${t}`,bytesPerComponent:n,components:i,bytesPerElement:s,value:void 0,bufferView:void 0,sparse:void 0};if(e.bufferView!==void 0&&(a.bufferView=this.getBufferView(e.bufferView)),a.bufferView){const o=a.bufferView.buffer,{ArrayType:h,byteLength:f}=FP(a,a.bufferView),_=(a.bufferView.byteOffset||0)+(a.byteOffset||0)+o.byteOffset;let x=o.arrayBuffer.slice(_,_+f);a.bufferView.byteStride&&(x=this._getValueFromInterleavedBuffer(o,_,a.bufferView.byteStride,a.bytesPerElement,a.count)),a.value=new h(x)}return a}_getValueFromInterleavedBuffer(e,t,n,i,s){const a=new Uint8Array(s*i);for(let o=0;o<s;o++){const h=t+o*n;a.set(new Uint8Array(e.arrayBuffer.slice(h,h+i)),o*i)}return a.buffer}_resolveTexture(e,t){return{...e,id:e.id||`texture-${t}`,sampler:typeof e.sampler=="number"?this.getSampler(e.sampler):VEe(),source:typeof e.source=="number"?this.getImage(e.source):void 0}}_resolveSampler(e,t){const n={id:e.id||`sampler-${t}`,...e,parameters:{}};for(const i in n){const s=this._enumSamplerParameter(i);s!==void 0&&(n.parameters[s]=n[i])}return n}_enumSamplerParameter(e){return zEe[e]}_resolveImage(e,t){const n={...e,id:e.id||`image-${t}`,image:null,bufferView:e.bufferView!==void 0?this.getBufferView(e.bufferView):void 0},i=this.images[t];return i&&(n.image=i),n}_resolveBufferView(e,t){const n=e.buffer,i=this.buffers[n].arrayBuffer;let s=this.buffers[n].byteOffset||0;return e.byteOffset&&(s+=e.byteOffset),{id:`bufferView-${t}`,...e,buffer:this.buffers[n],data:new Uint8Array(i,s,e.byteLength)}}_resolveCamera(e,t){const n={...e,id:e.id||`camera-${t}`};return n.perspective,n.orthographic,n}};function iV(r,e){return new $Ee().postProcess(r,e)}const jP={URI:0,EMBEDDED:1};function sV(r,e,t,n){r.rotateYtoZ=!0;const i=(r.byteOffset||0)+(r.byteLength||0)-t;if(i===0)throw new Error("glTF byte length must be greater than 0.");return r.gltfUpAxis=n!=null&&n["3d-tiles"]&&n["3d-tiles"].assetGltfUpAxis?n["3d-tiles"].assetGltfUpAxis:"Y",r.gltfArrayBuffer=tM(e,t,i),r.gltfByteOffset=0,r.gltfByteLength=i,t%4===0||console.warn(`${r.type}: embedded glb is not aligned to a 4-byte boundary.`),(r.byteOffset||0)+(r.byteLength||0)}async function oV(r,e,t,n){const i=(t==null?void 0:t["3d-tiles"])||{};if(jEe(r,e),i.loadGLTF){if(!n)return;if(r.gltfUrl){const{fetch:s}=n,a=await s(r.gltfUrl,t);r.gltfArrayBuffer=await a.arrayBuffer(),r.gltfByteOffset=0}if(r.gltfArrayBuffer){const s=await k1(r.gltfArrayBuffer,Z2,t,n);r.gltf=iV(s),r.gpuMemoryUsageInBytes=LH(r.gltf),delete r.gltfArrayBuffer,delete r.gltfByteOffset,delete r.gltfByteLength}}}function jEe(r,e,t){switch(e){case jP.URI:if(r.gltfArrayBuffer){const n=new Uint8Array(r.gltfArrayBuffer,r.gltfByteOffset),s=new TextDecoder().decode(n);r.gltfUrl=s.replace(/[\s\0]+$/,"")}delete r.gltfArrayBuffer,delete r.gltfByteOffset,delete r.gltfByteLength;break;case jP.EMBEDDED:break;default:throw new Error("b3dm: Illegal glTF format field")}}async function qEe(r,e,t,n,i){var a;t=KEe(r,e,t,n),await oV(r,jP.EMBEDDED,n,i);const s=(a=r==null?void 0:r.gltf)==null?void 0:a.extensions;return s&&s.CESIUM_RTC&&(r.rtcCenter=s.CESIUM_RTC.center),t}function KEe(r,e,t,n,i){t=z2(r,e,t),t=BP(r,e,t),t=CP(r,e,t),t=sV(r,e,t,n);const s=new xP(r.featureTableJson,r.featureTableBinary);return r.rtcCenter=s.getGlobalProperty("RTC_CENTER",ms.FLOAT,3),t}async function WEe(r,e,t,n,i){return t=XEe(r,e,t,n),await oV(r,r.gltfFormat||0,n,i),t}function XEe(r,e,t,n,i){var f;if(t=z2(r,e,t),r.version!==1)throw new Error(`Instanced 3D Model version ${r.version} is not supported`);t=BP(r,e,t);const s=new DataView(e);if(r.gltfFormat=s.getUint32(t,!0),t+=4,t=CP(r,e,t),t=sV(r,e,t,n),!((f=r==null?void 0:r.header)!=null&&f.featureTableJsonByteLength)||r.header.featureTableJsonByteLength===0)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");const a=new xP(r.featureTableJson,r.featureTableBinary),o=a.getGlobalProperty("INSTANCES_LENGTH");if(a.featuresLength=o,!Number.isFinite(o))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");r.eastNorthUp=a.getGlobalProperty("EAST_NORTH_UP"),r.rtcCenter=a.getGlobalProperty("RTC_CENTER",ms.FLOAT,3);const h=new xH(r.batchTableJson,r.batchTableBinary,o);return JEe(r,a,h,o),t}function JEe(r,e,t,n){const i=new Array(n),s=new yr;new yr,new yr,new yr;const a=new ma,o=new i2,h=new yr,f={},_=new _a,x=[],T=[],I=[],N=[];for(let $=0;$<n;$++){let W;if(e.hasProperty("POSITION"))W=e.getProperty("POSITION",ms.FLOAT,3,$,s);else if(e.hasProperty("POSITION_QUANTIZED")){W=e.getProperty("POSITION_QUANTIZED",ms.UNSIGNED_SHORT,3,$,s);const be=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",ms.FLOAT,3);if(!be)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const Qe=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",ms.FLOAT,3);if(!Qe)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const Ue=65535;for(let st=0;st<3;st++)W[st]=W[st]/Ue*Qe[st]+be[st]}if(!W)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");if(s.copy(W),f.translation=s,r.normalUp=e.getProperty("NORMAL_UP",ms.FLOAT,3,$,x),r.normalRight=e.getProperty("NORMAL_RIGHT",ms.FLOAT,3,$,T),r.normalUp){if(!r.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");r.hasCustomOrientation=!0}else{if(r.octNormalUp=e.getProperty("NORMAL_UP_OCT32P",ms.UNSIGNED_SHORT,2,$,x),r.octNormalRight=e.getProperty("NORMAL_RIGHT_OCT32P",ms.UNSIGNED_SHORT,2,$,T),r.octNormalUp)throw r.octNormalRight?new Error("i3dm: oct-encoded orientation not implemented"):new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");r.eastNorthUp?(Ao.WGS84.eastNorthUpToFixedFrame(s,_),_.getRotationMatrix3(a)):a.identity()}o.fromMatrix3(a),f.rotation=o,h.set(1,1,1);const Y=e.getProperty("SCALE",ms.FLOAT,1,$,I);Number.isFinite(Y)&&h.multiplyByScalar(Y);const ie=e.getProperty("SCALE_NON_UNIFORM",ms.FLOAT,3,$,x);ie&&h.scale(ie),f.scale=h;let ce=e.getProperty("BATCH_ID",ms.UNSIGNED_SHORT,1,$,N);ce===void 0&&(ce=$);const fe=new _a().fromQuaternion(f.rotation);_.identity(),_.translate(f.translation),_.multiplyRight(fe),_.scale(f.scale);const ve=_.clone();i[$]={modelMatrix:ve,batchId:ce}}r.instances=i}async function ZEe(r,e,t,n,i,s){t=z2(r,e,t);const a=new DataView(e);for(r.tilesLength=a.getUint32(t,!0),t+=4,r.tiles=[];r.tiles.length<r.tilesLength&&(r.byteLength||0)-t>12;){const o={shape:"tile3d"};r.tiles.push(o),t=await s(e,t,n,i,o)}return t}async function YEe(r,e,t,n){var i,s;if(r.rotateYtoZ=!0,r.gltfUpAxis=(i=t==null?void 0:t["3d-tiles"])!=null&&i.assetGltfUpAxis?t["3d-tiles"].assetGltfUpAxis:"Y",(s=t==null?void 0:t["3d-tiles"])!=null&&s.loadGLTF){if(!n)return e.byteLength;const a=await k1(e,Z2,t,n);r.gltf=iV(a),r.gpuMemoryUsageInBytes=LH(r.gltf)}else r.gltfArrayBuffer=e;return e.byteLength}async function aV(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{shape:"tile3d"};switch(i.byteOffset=e,i.type=$xe(r,e),i.type){case Y1.COMPOSITE:return await ZEe(i,r,e,t,n,aV);case Y1.BATCHED_3D_MODEL:return await qEe(i,r,e,t,n);case Y1.GLTF:return await YEe(i,r,t,n);case Y1.INSTANCED_3D_MODEL:return await WEe(i,r,e,t,n);case Y1.POINT_CLOUD:return await zwe(i,r,e,t,n);default:throw new Error(`3DTileLoader: unknown type ${i.type}`)}}const eTe=1952609651,tTe=1;async function rTe(r,e,t){if(new Uint32Array(r.slice(0,4))[0]!==eTe)throw new Error("Wrong subtree file magic number");if(new Uint32Array(r.slice(4,8))[0]!==tTe)throw new Error("Wrong subtree file verson, must be 1");const s=lV(r.slice(8,16)),a=new Uint8Array(r,24,s),h=new TextDecoder("utf8").decode(a),f=JSON.parse(h),_=lV(r.slice(16,24));let x=new ArrayBuffer(0);if(_&&(x=r.slice(24+s)),await Y2(f,f.tileAvailability,x,t),Array.isArray(f.contentAvailability))for(const T of f.contentAvailability)await Y2(f,T,x,t);else await Y2(f,f.contentAvailability,x,t);return await Y2(f,f.childSubtreeAvailability,x,t),f}async function Y2(r,e,t,n){const i=Number.isFinite(e.bitstream)?e.bitstream:e.bufferView;if(typeof i!="number")return;const s=r.bufferViews[i],a=r.buffers[s.buffer];if(!(n!=null&&n.baseUrl))throw new Error("Url is not provided");if(!n.fetch)throw new Error("fetch is not provided");if(a.uri){const h=`${(n==null?void 0:n.baseUrl)||""}/${a.uri}`,_=await(await n.fetch(h)).arrayBuffer();e.explicitBitstream=new Uint8Array(_,s.byteOffset,s.byteLength);return}const o=r.buffers.slice(0,s.buffer).reduce((h,f)=>h+f.byteLength,0);e.explicitBitstream=new Uint8Array(t.slice(o,o+a.byteLength),s.byteOffset,s.byteLength)}function lV(r){const e=new DataView(r),t=e.getUint32(0,!0),n=e.getUint32(4,!0);return t+2**32*n}const cV={dataType:null,batchType:null,id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:dH,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:rTe,options:{}};/**
 * @license
 * Copyright 2009 The Closure Library Authors
 * Copyright 2020 Daniel Wirtz / The long.js Authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * SPDX-License-Identifier: Apache-2.0
 */var hd=null;try{hd=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function Zs(r,e,t){this.low=r|0,this.high=e|0,this.unsigned=!!t}Zs.prototype.__isLong__,Object.defineProperty(Zs.prototype,"__isLong__",{value:!0});function Yc(r){return(r&&r.__isLong__)===!0}function uV(r){var e=Math.clz32(r&-r);return r?31-e:e}Zs.isLong=Yc;var hV={},dV={};function Kg(r,e){var t,n,i;return e?(r>>>=0,(i=0<=r&&r<256)&&(n=dV[r],n)?n:(t=Ts(r,0,!0),i&&(dV[r]=t),t)):(r|=0,(i=-128<=r&&r<128)&&(n=hV[r],n)?n:(t=Ts(r,r<0?-1:0,!1),i&&(hV[r]=t),t))}Zs.fromInt=Kg;function dd(r,e){if(isNaN(r))return e?bA:Xd;if(e){if(r<0)return bA;if(r>=AV)return yV}else{if(r<=-pV)return eh;if(r+1>=pV)return _V}return r<0?dd(-r,e).neg():Ts(r%g0|0,r/g0|0,e)}Zs.fromNumber=dd;function Ts(r,e,t){return new Zs(r,e,t)}Zs.fromBits=Ts;var eB=Math.pow;function qP(r,e,t){if(r.length===0)throw Error("empty string");if(typeof e=="number"?(t=e,e=!1):e=!!e,r==="NaN"||r==="Infinity"||r==="+Infinity"||r==="-Infinity")return e?bA:Xd;if(t=t||10,t<2||36<t)throw RangeError("radix");var n;if((n=r.indexOf("-"))>0)throw Error("interior hyphen");if(n===0)return qP(r.substring(1),e,t).neg();for(var i=dd(eB(t,8)),s=Xd,a=0;a<r.length;a+=8){var o=Math.min(8,r.length-a),h=parseInt(r.substring(a,a+o),t);if(o<8){var f=dd(eB(t,o));s=s.mul(f).add(dd(h))}else s=s.mul(i),s=s.add(dd(h))}return s.unsigned=e,s}Zs.fromString=qP;function Wd(r,e){return typeof r=="number"?dd(r,e):typeof r=="string"?qP(r,e):Ts(r.low,r.high,typeof e=="boolean"?e:r.unsigned)}Zs.fromValue=Wd;var fV=65536,nTe=1<<24,g0=fV*fV,AV=g0*g0,pV=AV/2,gV=Kg(nTe),Xd=Kg(0);Zs.ZERO=Xd;var bA=Kg(0,!0);Zs.UZERO=bA;var m0=Kg(1);Zs.ONE=m0;var mV=Kg(1,!0);Zs.UONE=mV;var KP=Kg(-1);Zs.NEG_ONE=KP;var _V=Ts(-1,2147483647,!1);Zs.MAX_VALUE=_V;var yV=Ts(-1,-1,!0);Zs.MAX_UNSIGNED_VALUE=yV;var eh=Ts(0,-2147483648,!1);Zs.MIN_VALUE=eh;var fn=Zs.prototype;fn.toInt=function(){return this.unsigned?this.low>>>0:this.low},fn.toNumber=function(){return this.unsigned?(this.high>>>0)*g0+(this.low>>>0):this.high*g0+(this.low>>>0)},fn.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(eh)){var t=dd(e),n=this.div(t),i=n.mul(t).sub(this);return n.toString(e)+i.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var s=dd(eB(e,6),this.unsigned),a=this,o="";;){var h=a.div(s),f=a.sub(h.mul(s)).toInt()>>>0,_=f.toString(e);if(a=h,a.isZero())return _+o;for(;_.length<6;)_="0"+_;o=""+_+o}},fn.getHighBits=function(){return this.high},fn.getHighBitsUnsigned=function(){return this.high>>>0},fn.getLowBits=function(){return this.low},fn.getLowBitsUnsigned=function(){return this.low>>>0},fn.getNumBitsAbs=function(){if(this.isNegative())return this.eq(eh)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&!(e&1<<t);t--);return this.high!=0?t+33:t+1},fn.isZero=function(){return this.high===0&&this.low===0},fn.eqz=fn.isZero,fn.isNegative=function(){return!this.unsigned&&this.high<0},fn.isPositive=function(){return this.unsigned||this.high>=0},fn.isOdd=function(){return(this.low&1)===1},fn.isEven=function(){return(this.low&1)===0},fn.equals=function(e){return Yc(e)||(e=Wd(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low},fn.eq=fn.equals,fn.notEquals=function(e){return!this.eq(e)},fn.neq=fn.notEquals,fn.ne=fn.notEquals,fn.lessThan=function(e){return this.comp(e)<0},fn.lt=fn.lessThan,fn.lessThanOrEqual=function(e){return this.comp(e)<=0},fn.lte=fn.lessThanOrEqual,fn.le=fn.lessThanOrEqual,fn.greaterThan=function(e){return this.comp(e)>0},fn.gt=fn.greaterThan,fn.greaterThanOrEqual=function(e){return this.comp(e)>=0},fn.gte=fn.greaterThanOrEqual,fn.ge=fn.greaterThanOrEqual,fn.compare=function(e){if(Yc(e)||(e=Wd(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},fn.comp=fn.compare,fn.negate=function(){return!this.unsigned&&this.eq(eh)?eh:this.not().add(m0)},fn.neg=fn.negate,fn.add=function(e){Yc(e)||(e=Wd(e));var t=this.high>>>16,n=this.high&65535,i=this.low>>>16,s=this.low&65535,a=e.high>>>16,o=e.high&65535,h=e.low>>>16,f=e.low&65535,_=0,x=0,T=0,I=0;return I+=s+f,T+=I>>>16,I&=65535,T+=i+h,x+=T>>>16,T&=65535,x+=n+o,_+=x>>>16,x&=65535,_+=t+a,_&=65535,Ts(T<<16|I,_<<16|x,this.unsigned)},fn.subtract=function(e){return Yc(e)||(e=Wd(e)),this.add(e.neg())},fn.sub=fn.subtract,fn.multiply=function(e){if(this.isZero())return this;if(Yc(e)||(e=Wd(e)),hd){var t=hd.mul(this.low,this.high,e.low,e.high);return Ts(t,hd.get_high(),this.unsigned)}if(e.isZero())return this.unsigned?bA:Xd;if(this.eq(eh))return e.isOdd()?eh:Xd;if(e.eq(eh))return this.isOdd()?eh:Xd;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(gV)&&e.lt(gV))return dd(this.toNumber()*e.toNumber(),this.unsigned);var n=this.high>>>16,i=this.high&65535,s=this.low>>>16,a=this.low&65535,o=e.high>>>16,h=e.high&65535,f=e.low>>>16,_=e.low&65535,x=0,T=0,I=0,N=0;return N+=a*_,I+=N>>>16,N&=65535,I+=s*_,T+=I>>>16,I&=65535,I+=a*f,T+=I>>>16,I&=65535,T+=i*_,x+=T>>>16,T&=65535,T+=s*f,x+=T>>>16,T&=65535,T+=a*h,x+=T>>>16,T&=65535,x+=n*_+i*f+s*h+a*o,x&=65535,Ts(I<<16|N,x<<16|T,this.unsigned)},fn.mul=fn.multiply,fn.divide=function(e){if(Yc(e)||(e=Wd(e)),e.isZero())throw Error("division by zero");if(hd){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?hd.div_u:hd.div_s)(this.low,this.high,e.low,e.high);return Ts(t,hd.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?bA:Xd;var n,i,s;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return bA;if(e.gt(this.shru(1)))return mV;s=bA}else{if(this.eq(eh)){if(e.eq(m0)||e.eq(KP))return eh;if(e.eq(eh))return m0;var a=this.shr(1);return n=a.div(e).shl(1),n.eq(Xd)?e.isNegative()?m0:KP:(i=this.sub(e.mul(n)),s=n.add(i.div(e)),s)}else if(e.eq(eh))return this.unsigned?bA:Xd;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();s=Xd}for(i=this;i.gte(e);){n=Math.max(1,Math.floor(i.toNumber()/e.toNumber()));for(var o=Math.ceil(Math.log(n)/Math.LN2),h=o<=48?1:eB(2,o-48),f=dd(n),_=f.mul(e);_.isNegative()||_.gt(i);)n-=h,f=dd(n,this.unsigned),_=f.mul(e);f.isZero()&&(f=m0),s=s.add(f),i=i.sub(_)}return s},fn.div=fn.divide,fn.modulo=function(e){if(Yc(e)||(e=Wd(e)),hd){var t=(this.unsigned?hd.rem_u:hd.rem_s)(this.low,this.high,e.low,e.high);return Ts(t,hd.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))},fn.mod=fn.modulo,fn.rem=fn.modulo,fn.not=function(){return Ts(~this.low,~this.high,this.unsigned)},fn.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},fn.clz=fn.countLeadingZeros,fn.countTrailingZeros=function(){return this.low?uV(this.low):uV(this.high)+32},fn.ctz=fn.countTrailingZeros,fn.and=function(e){return Yc(e)||(e=Wd(e)),Ts(this.low&e.low,this.high&e.high,this.unsigned)},fn.or=function(e){return Yc(e)||(e=Wd(e)),Ts(this.low|e.low,this.high|e.high,this.unsigned)},fn.xor=function(e){return Yc(e)||(e=Wd(e)),Ts(this.low^e.low,this.high^e.high,this.unsigned)},fn.shiftLeft=function(e){return Yc(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Ts(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):Ts(0,this.low<<e-32,this.unsigned)},fn.shl=fn.shiftLeft,fn.shiftRight=function(e){return Yc(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Ts(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):Ts(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},fn.shr=fn.shiftRight,fn.shiftRightUnsigned=function(e){return Yc(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Ts(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):e===32?Ts(this.high,0,this.unsigned):Ts(this.high>>>e-32,0,this.unsigned)},fn.shru=fn.shiftRightUnsigned,fn.shr_u=fn.shiftRightUnsigned,fn.rotateLeft=function(e){var t;return Yc(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?Ts(this.high,this.low,this.unsigned):e<32?(t=32-e,Ts(this.low<<e|this.high>>>t,this.high<<e|this.low>>>t,this.unsigned)):(e-=32,t=32-e,Ts(this.high<<e|this.low>>>t,this.low<<e|this.high>>>t,this.unsigned))},fn.rotl=fn.rotateLeft,fn.rotateRight=function(e){var t;return Yc(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?Ts(this.high,this.low,this.unsigned):e<32?(t=32-e,Ts(this.high<<t|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned)):(e-=32,t=32-e,Ts(this.low<<t|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned))},fn.rotr=fn.rotateRight,fn.toSigned=function(){return this.unsigned?Ts(this.low,this.high,!1):this},fn.toUnsigned=function(){return this.unsigned?this:Ts(this.low,this.high,!0)},fn.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},fn.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]},fn.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]},Zs.fromBytes=function(e,t,n){return n?Zs.fromBytesLE(e,t):Zs.fromBytesBE(e,t)},Zs.fromBytesLE=function(e,t){return new Zs(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},Zs.fromBytesBE=function(e,t){return new Zs(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};const iTe=16;function bV(r){r==="X"&&(r="");const e=r.padEnd(iTe,"0");return Zs.fromString(e,!0,16)}function sTe(r){if(r.isZero())return"X";let e=r.countTrailingZeros();const t=e%4;e=(e-t)/4;const n=e;e*=4;const s=r.shiftRightUnsigned(e).toString(16).replace(/0+$/,"");return Array(17-n-s.length).join("0")+s}function oTe(r,e){const t=aTe(r).shiftRightUnsigned(2);return r.add(Zs.fromNumber(2*e+1-4).multiply(t))}function aTe(r){return r.and(r.not().add(1))}const lTe=3,cTe=2*30+1,vV=180/Math.PI;function uTe(r){if(r.length===0)throw new Error(`Invalid Hilbert quad key ${r}`);const e=r.split("/"),t=parseInt(e[0],10),n=e[1],i=n.length;let s=0;const a=[0,0];for(let o=i-1;o>=0;o--){s=i-o;const h=n[o];let f=0,_=0;h==="1"?_=1:h==="2"?(f=1,_=1):h==="3"&&(f=1);const x=Math.pow(2,s-1);dTe(x,a,f,_),a[0]+=x*f,a[1]+=x*_}if(t%2===1){const o=a[0];a[0]=a[1],a[1]=o}return{face:t,ij:a,level:s}}function hTe(r){if(r.isZero())return"";let e=r.toString(2);for(;e.length<lTe+cTe;)e="0"+e;const t=e.lastIndexOf("1"),n=e.substring(0,3),i=e.substring(3,t),s=i.length/2,a=Zs.fromString(n,!0,2).toString(10);let o="";if(s!==0)for(o=Zs.fromString(i,!0,2).toString(4);o.length<s;)o="0"+o;return`${a}/${o}`}function xV(r,e,t){const n=1<<e;return[(r[0]+t[0])/n,(r[1]+t[1])/n]}function wV(r){return r>=.5?1/3*(4*r*r-1):1/3*(1-4*(1-r)*(1-r))}function BV(r){return[wV(r[0]),wV(r[1])]}function CV(r,e){let[t,n]=e;switch(r){case 0:return[1,t,n];case 1:return[-t,1,n];case 2:return[-t,-n,1];case 3:return[-1,-n,-t];case 4:return[n,-1,-t];case 5:return[n,t,-1];default:throw new Error("Invalid face")}}function EV(r){let[e,t,n]=r;const i=Math.atan2(n,Math.sqrt(e*e+t*t));return[Math.atan2(t,e)*vV,i*vV]}function dTe(r,e,t,n){if(n===0){t===1&&(e[0]=r-1-e[0],e[1]=r-1-e[1]);const i=e[0];e[0]=e[1],e[1]=i}}function fTe(r){const e=xV(r.ij,r.level,[.5,.5]),t=BV(e),n=CV(r.face,t);return EV(n)}const ATe=100;function TV(r){const{face:e,ij:t,level:n}=r,i=[[0,0],[0,1],[1,1],[1,0],[0,0]],s=Math.max(1,Math.ceil(ATe*Math.pow(2,-n))),a=new Float64Array(4*s*2+2);let o=0,h=0;for(let f=0;f<4;f++){const _=i[f].slice(0),x=i[f+1],T=(x[0]-_[0])/s,I=(x[1]-_[1])/s;for(let N=0;N<s;N++){_[0]+=T,_[1]+=I;const $=xV(t,n,_),W=BV($),Y=CV(e,W),ie=EV(Y);Math.abs(ie[1])>89.999&&(ie[0]=h);const ce=ie[0]-h;ie[0]+=ce>180?-360:ce<-180?360:0,a[o++]=ie[0],a[o++]=ie[1],h=ie[0]}}return a[o++]=a[0],a[o++]=a[1],a}function WP(r){const e=pTe(r);return uTe(e)}function pTe(r){if(r.indexOf("/")>0)return r;const e=bV(r);return hTe(e)}function gTe(r){const e=WP(r);return fTe(e)}function mTe(r){let e;if(r.face===2||r.face===5){let t=null,n=0;for(let i=0;i<4;i++){const s=`${r.face}/${i}`,a=WP(s),o=TV(a);(typeof t>"u"||t===null)&&(t=new Float64Array(4*o.length)),t.set(o,n),n+=o.length}e=SV(t)}else{const t=TV(r);e=SV(t)}return e}function SV(r){if(r.length%2!==0)throw new Error("Invalid corners");const e=[],t=[];for(let n=0;n<r.length;n+=2)e.push(r[n]),t.push(r[n+1]);return e.sort((n,i)=>n-i),t.sort((n,i)=>n-i),{west:e[0],east:e[e.length-1],north:t[t.length-1],south:t[0]}}function _Te(r,e){const t=(e==null?void 0:e.minimumHeight)||0,n=(e==null?void 0:e.maximumHeight)||0,i=WP(r),s=mTe(i),a=s.west,o=s.south,h=s.east,f=s.north,_=[];return _.push(new yr(a,f,t)),_.push(new yr(h,f,t)),_.push(new yr(h,o,t)),_.push(new yr(a,o,t)),_.push(new yr(a,f,n)),_.push(new yr(h,f,n)),_.push(new yr(h,o,n)),_.push(new yr(a,o,n)),_}function IV(r){const e=r.token,t={minimumHeight:r.minimumHeight,maximumHeight:r.maximumHeight},n=_Te(e,t),i=gTe(e),s=i[0],a=i[1],o=Ao.WGS84.cartographicToCartesian([s,a,t.maximumHeight]),h=new yr(o[0],o[1],o[2]);n.push(h);const f=tme(n);return[...f.center,...f.halfAxes]}const yTe={QUADTREE:4,OCTREE:8};function bTe(r,e,t){if(r!=null&&r.box){const n=bV(r.s2VolumeInfo.token),i=oTe(n,e),s=sTe(i),a={...r.s2VolumeInfo};switch(a.token=s,t){case"OCTREE":const f=r.s2VolumeInfo,_=f.maximumHeight-f.minimumHeight,x=_/2,T=f.minimumHeight+_/2;f.minimumHeight=T-x,f.maximumHeight=T+x;break}return{box:IV(a),s2VolumeInfo:a}}}async function MV(r){const{subtree:e,subtreeData:t={level:0,x:0,y:0,z:0},parentData:n={mortonIndex:0,localLevel:-1,localX:0,localY:0,localZ:0},childIndex:i=0,implicitOptions:s,loaderOptions:a,s2VolumeBox:o}=r,{subdivisionScheme:h,subtreeLevels:f,maximumLevel:_,contentUrlTemplate:x,subtreesUriTemplate:T,basePath:I}=s,N={children:[],lodMetricValue:0,contentUrl:""};if(!_)return Q8.once(`Missing 'maximumLevel' or 'availableLevels' property. The subtree ${x} won't be loaded...`),N;const $=n.localLevel+1,W=t.level+$;if(W>_)return N;const Y=yTe[h],ie=Math.log2(Y),ce=i&1,fe=i>>1&1,ve=i>>2&1,be=Wg(n.localX,ce,1),Qe=Wg(n.localY,fe,1),Ue=Wg(n.localZ,ve,1),st=Wg(t.x,be,$),at=Wg(t.y,Qe,$),Le=Wg(t.z,Ue,$),ze=Wg(n.mortonIndex,i,ie),tt=$===f&&XP(e.childSubtreeAvailability,ze);let Ne,Ht,Vt,Jt;if(tt){const Xt=`${I}/${T}`,Fr=JP(Xt,W,st,at,Le);Ne=await Ng(Fr,cV,a),Jt=0,Ht={level:W,x:st,y:at,z:Le},Vt={mortonIndex:0,localLevel:0,localX:0,localY:0,localZ:0}}else Ne=e,Jt=(Y**$-1)/(Y-1)+ze,Ht=t,Vt={mortonIndex:ze,localLevel:$,localX:be,localY:Qe,localZ:Ue};if(!XP(Ne.tileAvailability,Jt))return N;XP(Ne.contentAvailability,Jt)&&(N.contentUrl=JP(x,W,st,at,Le));for(let Xt=0;Xt<Y;Xt++){const Fr=bTe(o,Xt,h),$e=await MV({subtree:Ne,subtreeData:Ht,parentData:Vt,childIndex:Xt,implicitOptions:s,loaderOptions:a,s2VolumeBox:Fr});($e.contentUrl||$e.children.length)&&N.children.push($e)}return N.contentUrl||N.children.length?vTe(N,{level:W,x:st,y:at,z:Le},s,o):N}function XP(r,e){let t;return Array.isArray(r)?(t=r[0],r.length>1&&Q8.once('Not supported extension "3DTILES_multiple_contents" has been detected')):t=r,"constant"in t?!!t.constant:t.explicitBitstream?BTe(e,t.explicitBitstream):!1}function vTe(r,e,t,n){const{basePath:i,refine:s,getRefine:a,lodMetricType:o,getTileType:h,rootLodMetricValue:f,rootBoundingVolume:_}=t,x=r.contentUrl&&r.contentUrl.replace(`${i}/`,""),T=f/2**e.level,I=n!=null&&n.box?{box:n.box}:_,N=xTe(I,e,t.subdivisionScheme);return{children:r.children,contentUrl:r.contentUrl,content:{uri:x},id:r.contentUrl,refine:a(s),type:h(r),lodMetricType:o,lodMetricValue:T,geometricError:T,transform:r.transform,boundingVolume:N}}function xTe(r,e,t){if(r.region){const{level:n,x:i,y:s,z:a}=e,[o,h,f,_,x,T]=r.region,I=2**n,N=(f-o)/I,[$,W]=[o+N*i,o+N*(i+1)],Y=(_-h)/I,[ie,ce]=[h+Y*s,h+Y*(s+1)];let fe,ve;if(t==="OCTREE"){const be=(T-x)/I;[fe,ve]=[x+be*a,x+be*(a+1)]}else[fe,ve]=[x,T];return{region:[$,ie,W,ce,fe,ve]}}if(r.box)return r;throw new Error(`Unsupported bounding volume type ${JSON.stringify(r)}`)}function Wg(r,e,t){return(r<<t)+e}function JP(r,e,t,n,i){const s=wTe({level:e,x:t,y:n,z:i});return r.replace(/{level}|{x}|{y}|{z}/gi,a=>s[a])}function wTe(r){const e={};for(const t in r)e[`{${t}}`]=r[t];return e}function BTe(r,e){const t=Math.floor(r/8),n=r%8;return(e[t]>>n&1)===1}function ZP(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(!e)return yA.EMPTY;const n=e.split("?")[0].split(".").pop();switch(n){case"pnts":return yA.POINTCLOUD;case"i3dm":case"b3dm":case"glb":case"gltf":return yA.SCENEGRAPH;default:return n||yA.EMPTY}}function YP(r){switch(r){case"REPLACE":case"replace":return Kd.REPLACE;case"ADD":case"add":return Kd.ADD;default:return r}}function eF(r,e){if(/^[a-z][0-9a-z+.-]*:/i.test(e)){const n=new URL(r,`${e}/`);return decodeURI(n.toString())}else if(r.startsWith("/"))return r;return spe(e,r)}function PV(r,e){var i;if(!r)return null;let t;if(r.content){const s=r.content.uri||((i=r.content)==null?void 0:i.url);typeof s<"u"&&(t=eF(s,e))}return{...r,id:t,contentUrl:t,lodMetricType:c0.GEOMETRIC_ERROR,lodMetricValue:r.geometricError,transformMatrix:r.transform,type:ZP(r,t),refine:YP(r.refine)}}async function CTe(r,e,t){let n=null;const i=RV(r.root);i&&r.root?n=await FV(r.root,r,e,i,t):n=PV(r.root,e);const s=[];for(s.push(n);s.length>0;){const a=s.pop()||{},o=a.children||[],h=[];for(const f of o){const _=RV(f);let x;_?x=await FV(f,r,e,_,t):x=PV(f,e),x&&(h.push(x),s.push(x))}a.children=h}return n}async function FV(r,e,t,n,i){var fe,ve,be;const{subdivisionScheme:s,maximumLevel:a,availableLevels:o,subtreeLevels:h,subtrees:{uri:f}}=n,_=JP(f,0,0,0,0),x=eF(_,t),T=await Ng(x,cV,i),I=(fe=r.content)==null?void 0:fe.uri,N=I?eF(I,t):"",$=(ve=e==null?void 0:e.root)==null?void 0:ve.refine,W=r.geometricError,Y=(be=r.boundingVolume.extensions)==null?void 0:be["3DTILES_bounding_volume_S2"];if(Y){const Ue={box:IV(Y),s2VolumeInfo:Y};r.boundingVolume=Ue}const ie=r.boundingVolume,ce={contentUrlTemplate:N,subtreesUriTemplate:f,subdivisionScheme:s,subtreeLevels:h,maximumLevel:Number.isFinite(o)?o-1:a,refine:$,basePath:t,lodMetricType:c0.GEOMETRIC_ERROR,rootLodMetricValue:W,rootBoundingVolume:ie,getTileType:ZP,getRefine:YP};return await ETe(r,t,T,ce,i)}async function ETe(r,e,t,n,i){if(!r)return null;const{children:s,contentUrl:a}=await MV({subtree:t,implicitOptions:n,loaderOptions:i});let o,h=null;return a&&(o=a,h={uri:a.replace(`${e}/`,"")}),{...r,id:o,contentUrl:o,lodMetricType:c0.GEOMETRIC_ERROR,lodMetricValue:r.geometricError,transformMatrix:r.transform,type:ZP(r,o),refine:YP(r.refine),content:h||r.content,children:s}}function RV(r){var e;return((e=r==null?void 0:r.extensions)==null?void 0:e["3DTILES_implicit_tiling"])||(r==null?void 0:r.implicitTiling)}const LV={dataType:null,batchType:null,id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:dH,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:TTe,options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}};async function TTe(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=arguments.length>2?arguments[2]:void 0;const n=e["3d-tiles"]||{};let i;return n.isTileset==="auto"?i=(t==null?void 0:t.url)&&t.url.indexOf(".json")!==-1:i=n.isTileset,i?STe(r,e,t):ITe(r,e,t)}async function STe(r,e,t){var h;const n=JSON.parse(new TextDecoder().decode(r)),i=(t==null?void 0:t.url)||"",s=MTe(i),a=await CTe(n,s,e||{});return{...n,shape:"tileset3d",loader:LV,url:i,queryString:(t==null?void 0:t.queryString)||"",basePath:s,root:a||n.root,type:Ju.TILES3D,lodMetricType:c0.GEOMETRIC_ERROR,lodMetricValue:((h=n.root)==null?void 0:h.geometricError)||0}}async function ITe(r,e,t){const n={content:{shape:"tile3d",featureIds:null}};return await aV(r,0,e,t,n.content),n.content}function MTe(r){return W8(r)}const DV=[0],PTe={getPointColor:{type:"accessor",value:[0,0,0,255]},pointSize:1,data:"",loader:LV,onTilesetLoad:{type:"function",value:r=>{}},onTileLoad:{type:"function",value:r=>{}},onTileUnload:{type:"function",value:r=>{}},onTileError:{type:"function",value:(r,e,t)=>{}},_getMeshColor:{type:"function",value:r=>[255,255,255]}};class tF extends z6{initializeState(){"onTileLoadFail"in this.props&&Es.removed("onTileLoadFail","onTileError")(),this.state={layerMap:{},tileset3d:null,activeViewports:{},lastUpdatedViewports:null}}get isLoaded(){var e,t;return!!((t=(e=this.state)==null?void 0:e.tileset3d)!=null&&t.isLoaded()&&super.isLoaded)}shouldUpdateState(e){let{changeFlags:t}=e;return t.somethingChanged}updateState(e){let{props:t,oldProps:n,changeFlags:i}=e;if(t.data&&t.data!==n.data&&this._loadTileset(t.data),i.viewportChanged){const{activeViewports:s}=this.state;Object.keys(s).length&&(this._updateTileset(s),this.state.lastUpdatedViewports=s,this.state.activeViewports={})}if(i.propsChanged){const{layerMap:s}=this.state;for(const a in s)s[a].needsUpdate=!0}}activateViewport(e){const{activeViewports:t,lastUpdatedViewports:n}=this.state;this.internalState.viewport=e,t[e.id]=e;const i=n==null?void 0:n[e.id];(!i||!e.equals(i))&&(this.setChangeFlags({viewportChanged:!0}),this.setNeedsUpdate())}getPickingInfo(e){let{info:t,sourceLayer:n}=e;const i=n&&n.props.tile;return t.picked&&(t.object=i),t.sourceTile=i,t}filterSubLayer(e){let{layer:t,viewport:n}=e;const{tile:i}=t.props,{id:s}=n;return i.selected&&i.viewportIds.includes(s)}_updateAutoHighlight(e){const t=e.sourceTile,n=this.state.layerMap[t==null?void 0:t.id];n&&n.layer&&n.layer.updateAutoHighlight(e)}async _loadTileset(e){const{loadOptions:t={}}=this.props,n=this.props.loader||this.props.loaders,i=Array.isArray(n)?n[0]:n,s={loadOptions:{...t}};let a=e;if(i.preload){const f=await i.preload(e,t);f.url&&(a=f.url),f.headers&&(s.loadOptions.fetch={...s.loadOptions.fetch,headers:f.headers}),Object.assign(s,f)}const o=await Ng(a,i,s.loadOptions),h=new Qxe(o,{onTileLoad:this._onTileLoad.bind(this),onTileUnload:this._onTileUnload.bind(this),onTileError:this.props.onTileError,...s});this.setState({tileset3d:h,layerMap:{}}),this._updateTileset(this.state.activeViewports),this.props.onTilesetLoad(h)}_onTileLoad(e){const{lastUpdatedViewports:t}=this.state;this.props.onTileLoad(e),this._updateTileset(t),this.setNeedsUpdate()}_onTileUnload(e){delete this.state.layerMap[e.id],this.props.onTileUnload(e)}_updateTileset(e){if(!e)return;const{tileset3d:t}=this.state,{timeline:n}=this.context,i=Object.keys(e).length;!n||!i||!t||t.selectTiles(Object.values(e)).then(s=>{this.state.frameNumber!==s&&this.setState({frameNumber:s})})}_getSubLayer(e,t){if(!e.content)return null;switch(e.type){case yA.POINTCLOUD:return this._makePointCloudLayer(e,t);case yA.SCENEGRAPH:return this._make3DModelLayer(e);case yA.MESH:return this._makeSimpleMeshLayer(e,t);default:throw new Error(`Tile3DLayer: Failed to render layer of type ${e.content.type}`)}}_makePointCloudLayer(e,t){const{attributes:n,pointCount:i,constantRGBA:s,cartographicOrigin:a,modelMatrix:o}=e.content,{positions:h,normals:f,colors:_}=n;if(!h)return null;const x=t&&t.props.data||{header:{vertexCount:i},attributes:{POSITION:h,NORMAL:f,COLOR_0:_}},{pointSize:T,getPointColor:I}=this.props,N=this.getSubLayerClass("pointcloud",Z3);return new N({pointSize:T},this.getSubLayerProps({id:"pointcloud"}),{id:`${this.id}-pointcloud-${e.id}`,tile:e,data:x,coordinateSystem:is.METER_OFFSETS,coordinateOrigin:a,modelMatrix:o,getColor:s||I,_offset:0})}_make3DModelLayer(e){const{gltf:t,instances:n,cartographicOrigin:i,modelMatrix:s}=e.content,a=this.getSubLayerClass("scenegraph",eP);return new a({_lighting:"pbr"},this.getSubLayerProps({id:"scenegraph"}),{id:`${this.id}-scenegraph-${e.id}`,tile:e,data:n||DV,scenegraph:t,coordinateSystem:is.METER_OFFSETS,coordinateOrigin:i,modelMatrix:s,getTransformMatrix:o=>o.modelMatrix,getPosition:[0,0,0],_offset:0})}_makeSimpleMeshLayer(e,t){const n=e.content,{attributes:i,indices:s,modelMatrix:a,cartographicOrigin:o,coordinateSystem:h=is.METER_OFFSETS,material:f,featureIds:_}=n,{_getMeshColor:x}=this.props,T=t&&t.props.mesh||new R_({topology:"triangle-list",attributes:FTe(i),indices:s}),I=this.getSubLayerClass("mesh",tP);return new I(this.getSubLayerProps({id:"mesh"}),{id:`${this.id}-mesh-${e.id}`,tile:e,mesh:T,data:DV,getColor:x(e),pbrMaterial:f,modelMatrix:a,coordinateOrigin:o,coordinateSystem:h,featureIds:_,_offset:0})}renderLayers(){const{tileset3d:e,layerMap:t}=this.state;return e?e.tiles.map(n=>{const i=t[n.id]=t[n.id]||{tile:n};let{layer:s}=i;return n.selected&&(s?i.needsUpdate&&(s=this._getSubLayer(n,s),i.needsUpdate=!1):s=this._getSubLayer(n)),i.layer=s,s}).filter(Boolean):null}}tF.defaultProps=PTe,tF.layerName="Tile3DLayer";function FTe(r){const e={};return e.positions={...r.positions,value:new Float32Array(r.positions.value)},r.normals&&(e.normals=r.normals),r.texCoords&&(e.texCoords=r.texCoords),r.colors&&(e.colors=r.colors),r.uvRegions&&(e.uvRegions=r.uvRegions),e}function Jd(r,e){if(!r)throw new Error("math.gl assertion ".concat(e))}const RTe=1/Math.PI*180,LTe=1/180*Math.PI,Rl={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0};function DTe(r){let{precision:e=Rl.precision}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return r=HTe(r),"".concat(parseFloat(r.toPrecision(e)))}function Xg(r){return Array.isArray(r)||ArrayBuffer.isView(r)&&!(r instanceof DataView)}function OTe(r){return UTe(r)}function kTe(r){return NTe(r)}function UTe(r,e){return rF(r,t=>t*LTe,e)}function NTe(r,e){return rF(r,t=>t*RTe,e)}function zTe(r,e,t){return rF(r,n=>Math.max(e,Math.min(t,n)))}function xp(r,e,t){const n=Rl.EPSILON;t&&(Rl.EPSILON=t);try{if(r===e)return!0;if(Xg(r)&&Xg(e)){if(r.length!==e.length)return!1;for(let i=0;i<r.length;++i)if(!xp(r[i],e[i]))return!1;return!0}return r&&r.equals?r.equals(e):e&&e.equals?e.equals(r):typeof r=="number"&&typeof e=="number"?Math.abs(r-e)<=Rl.EPSILON*Math.max(1,Math.abs(r),Math.abs(e)):!1}finally{Rl.EPSILON=n}}function HTe(r){return Math.round(r/Rl.EPSILON)*Rl.EPSILON}function VTe(r){return r.clone?r.clone():new Array(r.length)}function rF(r,e,t){if(Xg(r)){const n=r;t=t||VTe(n);for(let i=0;i<t.length&&i<n.length;++i)t[i]=e(r[i],i,t);return t}return e(r)}function GTe(r){function e(){var t=Reflect.construct(r,Array.from(arguments));return Object.setPrototypeOf(t,Object.getPrototypeOf(this)),t}return e.prototype=Object.create(r.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(e,r):e.__proto__=r,e}class nF extends GTe(Array){clone(){return new this.constructor().copy(this)}fromArray(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;for(let n=0;n<this.ELEMENTS;++n)this[n]=e[n+t];return this.check()}toArray(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;for(let n=0;n<this.ELEMENTS;++n)e[t+n]=this[n];return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:Xg(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(Rl)}formatString(e){let t="";for(let n=0;n<this.ELEMENTS;++n)t+=(n>0?", ":"")+DTe(this[n],e);return"".concat(e.printTypes?this.constructor.name:"","[").concat(t,"]")}equals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(!xp(this[t],e[t]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(this[t]!==e[t])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,t,n){if(n===void 0)return this.lerp(this,e,t);for(let i=0;i<this.ELEMENTS;++i){const s=e[i];this[i]=s+n*(t[i]-s)}return this.check()}min(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}max(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}clamp(e,t){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e[n]),t[n]);return this.check()}add(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(const i of t)for(let s=0;s<this.ELEMENTS;++s)this[s]+=i[s];return this.check()}subtract(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(const i of t)for(let s=0;s<this.ELEMENTS;++s)this[s]-=i[s];return this.check()}scale(e){if(typeof e=="number")for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;else for(let t=0;t<this.ELEMENTS&&t<e.length;++t)this[t]*=e[t];return this.check()}multiplyByScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}check(){if(Rl.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let e=this.length===this.ELEMENTS;for(let t=0;t<this.ELEMENTS;++t)e=e&&Number.isFinite(this[t]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}addScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,t){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e),t);return this.check()}get elements(){return this}}function QTe(r,e){if(r.length!==e)return!1;for(let t=0;t<r.length;++t)if(!Number.isFinite(r[t]))return!1;return!0}function Os(r){if(!Number.isFinite(r))throw new Error("Invalid number ".concat(r));return r}function lb(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";if(Rl.debug&&!QTe(r,e))throw new Error("math.gl: ".concat(t," some fields set to invalid numbers'"));return r}class iF extends nF{get x(){return this[0]}set x(e){this[0]=Os(e)}get y(){return this[1]}set y(e){this[1]=Os(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let t=0;for(let n=0;n<this.ELEMENTS;++n){const i=this[n]-e[n];t+=i*i}return Os(t)}dot(e){let t=0;for(let n=0;n<this.ELEMENTS;++n)t+=this[n]*e[n];return Os(t)}normalize(){const e=this.magnitude();if(e!==0)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}multiply(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(const i of t)for(let s=0;s<this.ELEMENTS;++s)this[s]*=i[s];return this.check()}divide(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(const i of t)for(let s=0;s<this.ELEMENTS;++s)this[s]/=i[s];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return Jd(e>=0&&e<this.ELEMENTS,"index is out of range"),Os(this[e])}setComponent(e,t){return Jd(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=t,this.check()}addVectors(e,t){return this.copy(e).add(t)}subVectors(e,t){return this.copy(e).subtract(t)}multiplyVectors(e,t){return this.copy(e).multiply(t)}addScaledVector(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}}var cb=1e-6,Zd=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var r=0,e=arguments.length;e--;)r+=arguments[e]*arguments[e];return Math.sqrt(r)});function $Te(){var r=new Zd(2);return Zd!=Float32Array&&(r[0]=0,r[1]=0),r}function jTe(r,e,t){var n=e[0],i=e[1];return r[0]=t[0]*n+t[2]*i,r[1]=t[1]*n+t[3]*i,r}function qTe(r,e,t){var n=e[0],i=e[1];return r[0]=t[0]*n+t[2]*i+t[4],r[1]=t[1]*n+t[3]*i+t[5],r}function OV(r,e,t){var n=e[0],i=e[1];return r[0]=t[0]*n+t[3]*i+t[6],r[1]=t[1]*n+t[4]*i+t[7],r}function kV(r,e,t){var n=e[0],i=e[1];return r[0]=t[0]*n+t[4]*i+t[12],r[1]=t[1]*n+t[5]*i+t[13],r}(function(){var r=$Te();return function(e,t,n,i,s,a){var o,h;for(t||(t=2),n||(n=0),i?h=Math.min(i*t+n,e.length):h=e.length,o=n;o<h;o+=t)r[0]=e[o],r[1]=e[o+1],s(r,r,a),e[o]=r[0],e[o+1]=r[1];return e}})();function UV(r,e,t){const n=e[0],i=e[1],s=t[3]*n+t[7]*i||1;return r[0]=(t[0]*n+t[4]*i)/s,r[1]=(t[1]*n+t[5]*i)/s,r}function NV(r,e,t){const n=e[0],i=e[1],s=e[2],a=t[3]*n+t[7]*i+t[11]*s||1;return r[0]=(t[0]*n+t[4]*i+t[8]*s)/a,r[1]=(t[1]*n+t[5]*i+t[9]*s)/a,r[2]=(t[2]*n+t[6]*i+t[10]*s)/a,r}function KTe(r,e,t){const n=e[0],i=e[1];return r[0]=t[0]*n+t[2]*i,r[1]=t[1]*n+t[3]*i,r[2]=e[2],r}function WTe(r,e,t){const n=e[0],i=e[1];return r[0]=t[0]*n+t[2]*i,r[1]=t[1]*n+t[3]*i,r[2]=e[2],r[3]=e[3],r}function zV(r,e,t){const n=e[0],i=e[1],s=e[2];return r[0]=t[0]*n+t[3]*i+t[6]*s,r[1]=t[1]*n+t[4]*i+t[7]*s,r[2]=t[2]*n+t[5]*i+t[8]*s,r[3]=e[3],r}class sF extends iF{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;super(2),Xg(e)&&arguments.length===1?this.copy(e):(Rl.debug&&(Os(e),Os(t)),this[0]=e,this[1]=t)}set(e,t){return this[0]=e,this[1]=t,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this.check()}fromObject(e){return Rl.debug&&(Os(e.x),Os(e.y)),this[0]=e.x,this[1]=e.y,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return kV(this,this,e),this.check()}transformAsVector(e){return UV(this,this,e),this.check()}transformByMatrix3(e){return OV(this,this,e),this.check()}transformByMatrix2x3(e){return qTe(this,this,e),this.check()}transformByMatrix2(e){return jTe(this,this,e),this.check()}}function HV(){var r=new Zd(3);return Zd!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function VV(r){var e=r[0],t=r[1],n=r[2];return Math.hypot(e,t,n)}function GV(r,e,t){var n=new Zd(3);return n[0]=r,n[1]=e,n[2]=t,n}function XTe(r,e){var t=e[0],n=e[1],i=e[2],s=t*t+n*n+i*i;return s>0&&(s=1/Math.sqrt(s)),r[0]=e[0]*s,r[1]=e[1]*s,r[2]=e[2]*s,r}function oF(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]}function tB(r,e,t){var n=e[0],i=e[1],s=e[2],a=t[0],o=t[1],h=t[2];return r[0]=i*h-s*o,r[1]=s*a-n*h,r[2]=n*o-i*a,r}function aF(r,e,t){var n=e[0],i=e[1],s=e[2],a=t[3]*n+t[7]*i+t[11]*s+t[15];return a=a||1,r[0]=(t[0]*n+t[4]*i+t[8]*s+t[12])/a,r[1]=(t[1]*n+t[5]*i+t[9]*s+t[13])/a,r[2]=(t[2]*n+t[6]*i+t[10]*s+t[14])/a,r}function QV(r,e,t){var n=e[0],i=e[1],s=e[2];return r[0]=n*t[0]+i*t[3]+s*t[6],r[1]=n*t[1]+i*t[4]+s*t[7],r[2]=n*t[2]+i*t[5]+s*t[8],r}function $V(r,e,t){var n=t[0],i=t[1],s=t[2],a=t[3],o=e[0],h=e[1],f=e[2],_=i*f-s*h,x=s*o-n*f,T=n*h-i*o,I=i*T-s*x,N=s*_-n*T,$=n*x-i*_,W=a*2;return _*=W,x*=W,T*=W,I*=2,N*=2,$*=2,r[0]=o+_+I,r[1]=h+x+N,r[2]=f+T+$,r}function JTe(r,e,t,n){var i=[],s=[];return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],s[0]=i[0],s[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),s[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),r[0]=s[0]+t[0],r[1]=s[1]+t[1],r[2]=s[2]+t[2],r}function ZTe(r,e,t,n){var i=[],s=[];return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],s[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),s[1]=i[1],s[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),r[0]=s[0]+t[0],r[1]=s[1]+t[1],r[2]=s[2]+t[2],r}function YTe(r,e,t,n){var i=[],s=[];return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],s[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),s[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),s[2]=i[2],r[0]=s[0]+t[0],r[1]=s[1]+t[1],r[2]=s[2]+t[2],r}function eSe(r,e){var t=r[0],n=r[1],i=r[2],s=e[0],a=e[1],o=e[2],h=Math.sqrt(t*t+n*n+i*i),f=Math.sqrt(s*s+a*a+o*o),_=h*f,x=_&&oF(r,e)/_;return Math.acos(Math.min(Math.max(x,-1),1))}var tSe=VV;(function(){var r=HV();return function(e,t,n,i,s,a){var o,h;for(t||(t=3),n||(n=0),i?h=Math.min(i*t+n,e.length):h=e.length,o=n;o<h;o+=t)r[0]=e[o],r[1]=e[o+1],r[2]=e[o+2],s(r,r,a),e[o]=r[0],e[o+1]=r[1],e[o+2]=r[2];return e}})();const lF=[0,0,0];let rB;class Yr extends iF{static get ZERO(){return rB||(rB=new Yr(0,0,0),Object.freeze(rB)),rB}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;super(-0,-0,-0),arguments.length===1&&Xg(e)?this.copy(e):(Rl.debug&&(Os(e),Os(t),Os(n)),this[0]=e,this[1]=t,this[2]=n)}set(e,t,n){return this[0]=e,this[1]=t,this[2]=n,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return Rl.debug&&(Os(e.x),Os(e.y),Os(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=Os(e)}angle(e){return eSe(this,e)}cross(e){return tB(this,this,e),this.check()}rotateX(e){let{radians:t,origin:n=lF}=e;return JTe(this,this,n,t),this.check()}rotateY(e){let{radians:t,origin:n=lF}=e;return ZTe(this,this,n,t),this.check()}rotateZ(e){let{radians:t,origin:n=lF}=e;return YTe(this,this,n,t),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return aF(this,this,e),this.check()}transformAsVector(e){return NV(this,this,e),this.check()}transformByMatrix3(e){return QV(this,this,e),this.check()}transformByMatrix2(e){return KTe(this,this,e),this.check()}transformByQuaternion(e){return $V(this,this,e),this.check()}}let nB;class cF extends iF{static get ZERO(){return nB||(nB=new cF(0,0,0,0),Object.freeze(nB)),nB}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;super(-0,-0,-0,-0),Xg(e)&&arguments.length===1?this.copy(e):(Rl.debug&&(Os(e),Os(t),Os(n),Os(i)),this[0]=e,this[1]=t,this[2]=n,this[3]=i)}set(e,t,n,i){return this[0]=e,this[1]=t,this[2]=n,this[3]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}fromObject(e){return Rl.debug&&(Os(e.x),Os(e.y),Os(e.z),Os(e.w)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e.w=this[3],e}get ELEMENTS(){return 4}get z(){return this[2]}set z(e){this[2]=Os(e)}get w(){return this[3]}set w(e){this[3]=Os(e)}transform(e){return aF(this,this,e),this.check()}transformByMatrix3(e){return zV(this,this,e),this.check()}transformByMatrix2(e){return WTe(this,this,e),this.check()}transformByQuaternion(e){return $V(this,this,e),this.check()}applyMatrix4(e){return e.transform(this,this),this}}class jV extends nF{toString(){let e="[";if(Rl.printRowMajor){e+="row-major:";for(let t=0;t<this.RANK;++t)for(let n=0;n<this.RANK;++n)e+=" ".concat(this[n*this.RANK+t])}else{e+="column-major:";for(let t=0;t<this.ELEMENTS;++t)e+=" ".concat(this[t])}return e+="]",e}getElementIndex(e,t){return t*this.RANK+e}getElement(e,t){return this[t*this.RANK+e]}setElement(e,t,n){return this[t*this.RANK+e]=Os(n),this}getColumn(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Array(this.RANK).fill(-0);const n=e*this.RANK;for(let i=0;i<this.RANK;++i)t[i]=this[n+i];return t}setColumn(e,t){const n=e*this.RANK;for(let i=0;i<this.RANK;++i)this[n+i]=t[i];return this}}function rSe(){var r=new Zd(9);return Zd!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r}function nSe(r,e){if(r===e){var t=e[1],n=e[2],i=e[5];r[1]=e[3],r[2]=e[6],r[3]=t,r[5]=e[7],r[6]=n,r[7]=i}else r[0]=e[0],r[1]=e[3],r[2]=e[6],r[3]=e[1],r[4]=e[4],r[5]=e[7],r[6]=e[2],r[7]=e[5],r[8]=e[8];return r}function iSe(r,e){var t=e[0],n=e[1],i=e[2],s=e[3],a=e[4],o=e[5],h=e[6],f=e[7],_=e[8],x=_*a-o*f,T=-_*s+o*h,I=f*s-a*h,N=t*x+n*T+i*I;return N?(N=1/N,r[0]=x*N,r[1]=(-_*n+i*f)*N,r[2]=(o*n-i*a)*N,r[3]=T*N,r[4]=(_*t-i*h)*N,r[5]=(-o*t+i*s)*N,r[6]=I*N,r[7]=(-f*t+n*h)*N,r[8]=(a*t-n*s)*N,r):null}function sSe(r){var e=r[0],t=r[1],n=r[2],i=r[3],s=r[4],a=r[5],o=r[6],h=r[7],f=r[8];return e*(f*s-a*h)+t*(-f*i+a*o)+n*(h*i-s*o)}function qV(r,e,t){var n=e[0],i=e[1],s=e[2],a=e[3],o=e[4],h=e[5],f=e[6],_=e[7],x=e[8],T=t[0],I=t[1],N=t[2],$=t[3],W=t[4],Y=t[5],ie=t[6],ce=t[7],fe=t[8];return r[0]=T*n+I*a+N*f,r[1]=T*i+I*o+N*_,r[2]=T*s+I*h+N*x,r[3]=$*n+W*a+Y*f,r[4]=$*i+W*o+Y*_,r[5]=$*s+W*h+Y*x,r[6]=ie*n+ce*a+fe*f,r[7]=ie*i+ce*o+fe*_,r[8]=ie*s+ce*h+fe*x,r}function oSe(r,e,t){var n=e[0],i=e[1],s=e[2],a=e[3],o=e[4],h=e[5],f=e[6],_=e[7],x=e[8],T=t[0],I=t[1];return r[0]=n,r[1]=i,r[2]=s,r[3]=a,r[4]=o,r[5]=h,r[6]=T*n+I*a+f,r[7]=T*i+I*o+_,r[8]=T*s+I*h+x,r}function aSe(r,e,t){var n=e[0],i=e[1],s=e[2],a=e[3],o=e[4],h=e[5],f=e[6],_=e[7],x=e[8],T=Math.sin(t),I=Math.cos(t);return r[0]=I*n+T*a,r[1]=I*i+T*o,r[2]=I*s+T*h,r[3]=I*a-T*n,r[4]=I*o-T*i,r[5]=I*h-T*s,r[6]=f,r[7]=_,r[8]=x,r}function KV(r,e,t){var n=t[0],i=t[1];return r[0]=n*e[0],r[1]=n*e[1],r[2]=n*e[2],r[3]=i*e[3],r[4]=i*e[4],r[5]=i*e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r}function lSe(r,e){var t=e[0],n=e[1],i=e[2],s=e[3],a=t+t,o=n+n,h=i+i,f=t*a,_=n*a,x=n*o,T=i*a,I=i*o,N=i*h,$=s*a,W=s*o,Y=s*h;return r[0]=1-x-N,r[3]=_-Y,r[6]=T+W,r[1]=_+Y,r[4]=1-f-N,r[7]=I-$,r[2]=T-W,r[5]=I+$,r[8]=1-f-x,r}var uF;(function(r){r[r.COL0ROW0=0]="COL0ROW0",r[r.COL0ROW1=1]="COL0ROW1",r[r.COL0ROW2=2]="COL0ROW2",r[r.COL1ROW0=3]="COL1ROW0",r[r.COL1ROW1=4]="COL1ROW1",r[r.COL1ROW2=5]="COL1ROW2",r[r.COL2ROW0=6]="COL2ROW0",r[r.COL2ROW1=7]="COL2ROW1",r[r.COL2ROW2=8]="COL2ROW2"})(uF||(uF={}));const cSe=Object.freeze([1,0,0,0,1,0,0,0,1]);class Da extends jV{static get IDENTITY(){return hSe()}static get ZERO(){return uSe()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return uF}constructor(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):n.length>0?this.copy([e,...n]):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}identity(){return this.copy(cSe)}fromObject(e){return this.check()}fromQuaternion(e){return lSe(this,e),this.check()}set(e,t,n,i,s,a,o,h,f){return this[0]=e,this[1]=t,this[2]=n,this[3]=i,this[4]=s,this[5]=a,this[6]=o,this[7]=h,this[8]=f,this.check()}setRowMajor(e,t,n,i,s,a,o,h,f){return this[0]=e,this[1]=i,this[2]=o,this[3]=t,this[4]=s,this[5]=h,this[6]=n,this[7]=a,this[8]=f,this.check()}determinant(){return sSe(this)}transpose(){return nSe(this,this),this.check()}invert(){return iSe(this,this),this.check()}multiplyLeft(e){return qV(this,e,this),this.check()}multiplyRight(e){return qV(this,this,e),this.check()}rotate(e){return aSe(this,this,e),this.check()}scale(e){return Array.isArray(e)?KV(this,this,e):KV(this,this,[e,e]),this.check()}translate(e){return oSe(this,this,e),this.check()}transform(e,t){let n;switch(e.length){case 2:n=OV(t||[-0,-0],e,this);break;case 3:n=QV(t||[-0,-0,-0],e,this);break;case 4:n=zV(t||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return lb(n,e.length),n}transformVector(e,t){return this.transform(e,t)}transformVector2(e,t){return this.transform(e,t)}transformVector3(e,t){return this.transform(e,t)}}let iB,sB;function uSe(){return iB||(iB=new Da([0,0,0,0,0,0,0,0,0]),Object.freeze(iB)),iB}function hSe(){return sB||(sB=new Da,Object.freeze(sB)),sB}function dSe(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function fSe(r,e){if(r===e){var t=e[1],n=e[2],i=e[3],s=e[6],a=e[7],o=e[11];r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=t,r[6]=e[9],r[7]=e[13],r[8]=n,r[9]=s,r[11]=e[14],r[12]=i,r[13]=a,r[14]=o}else r[0]=e[0],r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=e[1],r[5]=e[5],r[6]=e[9],r[7]=e[13],r[8]=e[2],r[9]=e[6],r[10]=e[10],r[11]=e[14],r[12]=e[3],r[13]=e[7],r[14]=e[11],r[15]=e[15];return r}function ASe(r,e){var t=e[0],n=e[1],i=e[2],s=e[3],a=e[4],o=e[5],h=e[6],f=e[7],_=e[8],x=e[9],T=e[10],I=e[11],N=e[12],$=e[13],W=e[14],Y=e[15],ie=t*o-n*a,ce=t*h-i*a,fe=t*f-s*a,ve=n*h-i*o,be=n*f-s*o,Qe=i*f-s*h,Ue=_*$-x*N,st=_*W-T*N,at=_*Y-I*N,Le=x*W-T*$,ze=x*Y-I*$,tt=T*Y-I*W,Ne=ie*tt-ce*ze+fe*Le+ve*at-be*st+Qe*Ue;return Ne?(Ne=1/Ne,r[0]=(o*tt-h*ze+f*Le)*Ne,r[1]=(i*ze-n*tt-s*Le)*Ne,r[2]=($*Qe-W*be+Y*ve)*Ne,r[3]=(T*be-x*Qe-I*ve)*Ne,r[4]=(h*at-a*tt-f*st)*Ne,r[5]=(t*tt-i*at+s*st)*Ne,r[6]=(W*fe-N*Qe-Y*ce)*Ne,r[7]=(_*Qe-T*fe+I*ce)*Ne,r[8]=(a*ze-o*at+f*Ue)*Ne,r[9]=(n*at-t*ze-s*Ue)*Ne,r[10]=(N*be-$*fe+Y*ie)*Ne,r[11]=(x*fe-_*be-I*ie)*Ne,r[12]=(o*st-a*Le-h*Ue)*Ne,r[13]=(t*Le-n*st+i*Ue)*Ne,r[14]=($*ce-N*ve-W*ie)*Ne,r[15]=(_*ve-x*ce+T*ie)*Ne,r):null}function pSe(r){var e=r[0],t=r[1],n=r[2],i=r[3],s=r[4],a=r[5],o=r[6],h=r[7],f=r[8],_=r[9],x=r[10],T=r[11],I=r[12],N=r[13],$=r[14],W=r[15],Y=e*a-t*s,ie=e*o-n*s,ce=e*h-i*s,fe=t*o-n*a,ve=t*h-i*a,be=n*h-i*o,Qe=f*N-_*I,Ue=f*$-x*I,st=f*W-T*I,at=_*$-x*N,Le=_*W-T*N,ze=x*W-T*$;return Y*ze-ie*Le+ce*at+fe*st-ve*Ue+be*Qe}function WV(r,e,t){var n=e[0],i=e[1],s=e[2],a=e[3],o=e[4],h=e[5],f=e[6],_=e[7],x=e[8],T=e[9],I=e[10],N=e[11],$=e[12],W=e[13],Y=e[14],ie=e[15],ce=t[0],fe=t[1],ve=t[2],be=t[3];return r[0]=ce*n+fe*o+ve*x+be*$,r[1]=ce*i+fe*h+ve*T+be*W,r[2]=ce*s+fe*f+ve*I+be*Y,r[3]=ce*a+fe*_+ve*N+be*ie,ce=t[4],fe=t[5],ve=t[6],be=t[7],r[4]=ce*n+fe*o+ve*x+be*$,r[5]=ce*i+fe*h+ve*T+be*W,r[6]=ce*s+fe*f+ve*I+be*Y,r[7]=ce*a+fe*_+ve*N+be*ie,ce=t[8],fe=t[9],ve=t[10],be=t[11],r[8]=ce*n+fe*o+ve*x+be*$,r[9]=ce*i+fe*h+ve*T+be*W,r[10]=ce*s+fe*f+ve*I+be*Y,r[11]=ce*a+fe*_+ve*N+be*ie,ce=t[12],fe=t[13],ve=t[14],be=t[15],r[12]=ce*n+fe*o+ve*x+be*$,r[13]=ce*i+fe*h+ve*T+be*W,r[14]=ce*s+fe*f+ve*I+be*Y,r[15]=ce*a+fe*_+ve*N+be*ie,r}function gSe(r,e,t){var n=t[0],i=t[1],s=t[2],a,o,h,f,_,x,T,I,N,$,W,Y;return e===r?(r[12]=e[0]*n+e[4]*i+e[8]*s+e[12],r[13]=e[1]*n+e[5]*i+e[9]*s+e[13],r[14]=e[2]*n+e[6]*i+e[10]*s+e[14],r[15]=e[3]*n+e[7]*i+e[11]*s+e[15]):(a=e[0],o=e[1],h=e[2],f=e[3],_=e[4],x=e[5],T=e[6],I=e[7],N=e[8],$=e[9],W=e[10],Y=e[11],r[0]=a,r[1]=o,r[2]=h,r[3]=f,r[4]=_,r[5]=x,r[6]=T,r[7]=I,r[8]=N,r[9]=$,r[10]=W,r[11]=Y,r[12]=a*n+_*i+N*s+e[12],r[13]=o*n+x*i+$*s+e[13],r[14]=h*n+T*i+W*s+e[14],r[15]=f*n+I*i+Y*s+e[15]),r}function mSe(r,e,t){var n=t[0],i=t[1],s=t[2];return r[0]=e[0]*n,r[1]=e[1]*n,r[2]=e[2]*n,r[3]=e[3]*n,r[4]=e[4]*i,r[5]=e[5]*i,r[6]=e[6]*i,r[7]=e[7]*i,r[8]=e[8]*s,r[9]=e[9]*s,r[10]=e[10]*s,r[11]=e[11]*s,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function _Se(r,e,t,n){var i=n[0],s=n[1],a=n[2],o=Math.hypot(i,s,a),h,f,_,x,T,I,N,$,W,Y,ie,ce,fe,ve,be,Qe,Ue,st,at,Le,ze,tt,Ne,Ht;return o<cb?null:(o=1/o,i*=o,s*=o,a*=o,h=Math.sin(t),f=Math.cos(t),_=1-f,x=e[0],T=e[1],I=e[2],N=e[3],$=e[4],W=e[5],Y=e[6],ie=e[7],ce=e[8],fe=e[9],ve=e[10],be=e[11],Qe=i*i*_+f,Ue=s*i*_+a*h,st=a*i*_-s*h,at=i*s*_-a*h,Le=s*s*_+f,ze=a*s*_+i*h,tt=i*a*_+s*h,Ne=s*a*_-i*h,Ht=a*a*_+f,r[0]=x*Qe+$*Ue+ce*st,r[1]=T*Qe+W*Ue+fe*st,r[2]=I*Qe+Y*Ue+ve*st,r[3]=N*Qe+ie*Ue+be*st,r[4]=x*at+$*Le+ce*ze,r[5]=T*at+W*Le+fe*ze,r[6]=I*at+Y*Le+ve*ze,r[7]=N*at+ie*Le+be*ze,r[8]=x*tt+$*Ne+ce*Ht,r[9]=T*tt+W*Ne+fe*Ht,r[10]=I*tt+Y*Ne+ve*Ht,r[11]=N*tt+ie*Ne+be*Ht,e!==r&&(r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r)}function ySe(r,e,t){var n=Math.sin(t),i=Math.cos(t),s=e[4],a=e[5],o=e[6],h=e[7],f=e[8],_=e[9],x=e[10],T=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=s*i+f*n,r[5]=a*i+_*n,r[6]=o*i+x*n,r[7]=h*i+T*n,r[8]=f*i-s*n,r[9]=_*i-a*n,r[10]=x*i-o*n,r[11]=T*i-h*n,r}function bSe(r,e,t){var n=Math.sin(t),i=Math.cos(t),s=e[0],a=e[1],o=e[2],h=e[3],f=e[8],_=e[9],x=e[10],T=e[11];return e!==r&&(r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=s*i-f*n,r[1]=a*i-_*n,r[2]=o*i-x*n,r[3]=h*i-T*n,r[8]=s*n+f*i,r[9]=a*n+_*i,r[10]=o*n+x*i,r[11]=h*n+T*i,r}function vSe(r,e,t){var n=Math.sin(t),i=Math.cos(t),s=e[0],a=e[1],o=e[2],h=e[3],f=e[4],_=e[5],x=e[6],T=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=s*i+f*n,r[1]=a*i+_*n,r[2]=o*i+x*n,r[3]=h*i+T*n,r[4]=f*i-s*n,r[5]=_*i-a*n,r[6]=x*i-o*n,r[7]=T*i-h*n,r}function xSe(r,e){var t=e[0],n=e[1],i=e[2],s=e[4],a=e[5],o=e[6],h=e[8],f=e[9],_=e[10];return r[0]=Math.hypot(t,n,i),r[1]=Math.hypot(s,a,o),r[2]=Math.hypot(h,f,_),r}function wSe(r,e){var t=e[0],n=e[1],i=e[2],s=e[3],a=t+t,o=n+n,h=i+i,f=t*a,_=n*a,x=n*o,T=i*a,I=i*o,N=i*h,$=s*a,W=s*o,Y=s*h;return r[0]=1-x-N,r[1]=_+Y,r[2]=T-W,r[3]=0,r[4]=_-Y,r[5]=1-f-N,r[6]=I+$,r[7]=0,r[8]=T+W,r[9]=I-$,r[10]=1-f-x,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function BSe(r,e,t,n,i,s,a){var o=1/(t-e),h=1/(i-n),f=1/(s-a);return r[0]=s*2*o,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=s*2*h,r[6]=0,r[7]=0,r[8]=(t+e)*o,r[9]=(i+n)*h,r[10]=(a+s)*f,r[11]=-1,r[12]=0,r[13]=0,r[14]=a*s*2*f,r[15]=0,r}function CSe(r,e,t,n,i){var s=1/Math.tan(e/2),a;return r[0]=s/t,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=s,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,i!=null&&i!==1/0?(a=1/(n-i),r[10]=(i+n)*a,r[14]=2*i*n*a):(r[10]=-1,r[14]=-2*n),r}var ESe=CSe;function TSe(r,e,t,n,i,s,a){var o=1/(e-t),h=1/(n-i),f=1/(s-a);return r[0]=-2*o,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*h,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*f,r[11]=0,r[12]=(e+t)*o,r[13]=(i+n)*h,r[14]=(a+s)*f,r[15]=1,r}var SSe=TSe;function ISe(r,e,t,n){var i,s,a,o,h,f,_,x,T,I,N=e[0],$=e[1],W=e[2],Y=n[0],ie=n[1],ce=n[2],fe=t[0],ve=t[1],be=t[2];return Math.abs(N-fe)<cb&&Math.abs($-ve)<cb&&Math.abs(W-be)<cb?dSe(r):(_=N-fe,x=$-ve,T=W-be,I=1/Math.hypot(_,x,T),_*=I,x*=I,T*=I,i=ie*T-ce*x,s=ce*_-Y*T,a=Y*x-ie*_,I=Math.hypot(i,s,a),I?(I=1/I,i*=I,s*=I,a*=I):(i=0,s=0,a=0),o=x*a-T*s,h=T*i-_*a,f=_*s-x*i,I=Math.hypot(o,h,f),I?(I=1/I,o*=I,h*=I,f*=I):(o=0,h=0,f=0),r[0]=i,r[1]=o,r[2]=_,r[3]=0,r[4]=s,r[5]=h,r[6]=x,r[7]=0,r[8]=a,r[9]=f,r[10]=T,r[11]=0,r[12]=-(i*N+s*$+a*W),r[13]=-(o*N+h*$+f*W),r[14]=-(_*N+x*$+T*W),r[15]=1,r)}function MSe(){var r=new Zd(4);return Zd!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0,r[3]=0),r}function PSe(r,e,t){return r[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2],r[3]=e[3]+t[3],r}function FSe(r,e,t){return r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r[3]=e[3]*t,r}function RSe(r){var e=r[0],t=r[1],n=r[2],i=r[3];return Math.hypot(e,t,n,i)}function LSe(r){var e=r[0],t=r[1],n=r[2],i=r[3];return e*e+t*t+n*n+i*i}function DSe(r,e){var t=e[0],n=e[1],i=e[2],s=e[3],a=t*t+n*n+i*i+s*s;return a>0&&(a=1/Math.sqrt(a)),r[0]=t*a,r[1]=n*a,r[2]=i*a,r[3]=s*a,r}function OSe(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]*e[3]}function kSe(r,e,t,n){var i=e[0],s=e[1],a=e[2],o=e[3];return r[0]=i+n*(t[0]-i),r[1]=s+n*(t[1]-s),r[2]=a+n*(t[2]-a),r[3]=o+n*(t[3]-o),r}function USe(r,e,t){var n=e[0],i=e[1],s=e[2],a=e[3];return r[0]=t[0]*n+t[4]*i+t[8]*s+t[12]*a,r[1]=t[1]*n+t[5]*i+t[9]*s+t[13]*a,r[2]=t[2]*n+t[6]*i+t[10]*s+t[14]*a,r[3]=t[3]*n+t[7]*i+t[11]*s+t[15]*a,r}function NSe(r,e,t){var n=e[0],i=e[1],s=e[2],a=t[0],o=t[1],h=t[2],f=t[3],_=f*n+o*s-h*i,x=f*i+h*n-a*s,T=f*s+a*i-o*n,I=-a*n-o*i-h*s;return r[0]=_*f+I*-a+x*-h-T*-o,r[1]=x*f+I*-o+T*-a-_*-h,r[2]=T*f+I*-h+_*-o-x*-a,r[3]=e[3],r}(function(){var r=MSe();return function(e,t,n,i,s,a){var o,h;for(t||(t=4),n||(n=0),i?h=Math.min(i*t+n,e.length):h=e.length,o=n;o<h;o+=t)r[0]=e[o],r[1]=e[o+1],r[2]=e[o+2],r[3]=e[o+3],s(r,r,a),e[o]=r[0],e[o+1]=r[1],e[o+2]=r[2],e[o+3]=r[3];return e}})();var hF;(function(r){r[r.COL0ROW0=0]="COL0ROW0",r[r.COL0ROW1=1]="COL0ROW1",r[r.COL0ROW2=2]="COL0ROW2",r[r.COL0ROW3=3]="COL0ROW3",r[r.COL1ROW0=4]="COL1ROW0",r[r.COL1ROW1=5]="COL1ROW1",r[r.COL1ROW2=6]="COL1ROW2",r[r.COL1ROW3=7]="COL1ROW3",r[r.COL2ROW0=8]="COL2ROW0",r[r.COL2ROW1=9]="COL2ROW1",r[r.COL2ROW2=10]="COL2ROW2",r[r.COL2ROW3=11]="COL2ROW3",r[r.COL3ROW0=12]="COL3ROW0",r[r.COL3ROW1=13]="COL3ROW1",r[r.COL3ROW2=14]="COL3ROW2",r[r.COL3ROW3=15]="COL3ROW3"})(hF||(hF={}));const zSe=45*Math.PI/180,HSe=1,dF=.1,fF=500,VSe=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class _0 extends jV{static get IDENTITY(){return QSe()}static get ZERO(){return GSe()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return hF}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,t,n,i,s,a,o,h,f,_,x,T,I,N,$,W){return this[0]=e,this[1]=t,this[2]=n,this[3]=i,this[4]=s,this[5]=a,this[6]=o,this[7]=h,this[8]=f,this[9]=_,this[10]=x,this[11]=T,this[12]=I,this[13]=N,this[14]=$,this[15]=W,this.check()}setRowMajor(e,t,n,i,s,a,o,h,f,_,x,T,I,N,$,W){return this[0]=e,this[1]=s,this[2]=f,this[3]=I,this[4]=t,this[5]=a,this[6]=_,this[7]=N,this[8]=n,this[9]=o,this[10]=x,this[11]=$,this[12]=i,this[13]=h,this[14]=T,this[15]=W,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(VSe)}fromObject(e){return this.check()}fromQuaternion(e){return wSe(this,e),this.check()}frustum(e){const{left:t,right:n,bottom:i,top:s,near:a=dF,far:o=fF}=e;return o===1/0?$Se(this,t,n,i,s,a):BSe(this,t,n,i,s,a,o),this.check()}lookAt(e){const{eye:t,center:n=[0,0,0],up:i=[0,1,0]}=e;return ISe(this,t,n,i),this.check()}ortho(e){const{left:t,right:n,bottom:i,top:s,near:a=dF,far:o=fF}=e;return SSe(this,t,n,i,s,a,o),this.check()}orthographic(e){const{fovy:t=zSe,aspect:n=HSe,focalDistance:i=1,near:s=dF,far:a=fF}=e;XV(t);const o=t/2,h=i*Math.tan(o),f=h*n;return this.ortho({left:-f,right:f,bottom:-h,top:h,near:s,far:a})}perspective(e){const{fovy:t=45*Math.PI/180,aspect:n=1,near:i=.1,far:s=500}=e;return XV(t),ESe(this,t,n,i,s),this.check()}determinant(){return pSe(this)}getScale(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[-0,-0,-0];return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[-0,-0,-0];return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const n=this.getScale(t),i=1/n[0],s=1/n[1],a=1/n[2];return e[0]=this[0]*i,e[1]=this[1]*s,e[2]=this[2]*a,e[3]=0,e[4]=this[4]*i,e[5]=this[5]*s,e[6]=this[6]*a,e[7]=0,e[8]=this[8]*i,e[9]=this[9]*s,e[10]=this[10]*a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const n=this.getScale(t),i=1/n[0],s=1/n[1],a=1/n[2];return e[0]=this[0]*i,e[1]=this[1]*s,e[2]=this[2]*a,e[3]=this[4]*i,e[4]=this[5]*s,e[5]=this[6]*a,e[6]=this[8]*i,e[7]=this[9]*s,e[8]=this[10]*a,e}transpose(){return fSe(this,this),this.check()}invert(){return ASe(this,this),this.check()}multiplyLeft(e){return WV(this,e,this),this.check()}multiplyRight(e){return WV(this,this,e),this.check()}rotateX(e){return ySe(this,this,e),this.check()}rotateY(e){return bSe(this,this,e),this.check()}rotateZ(e){return vSe(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,t){return _Se(this,this,e,t),this.check()}scale(e){return mSe(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return gSe(this,this,e),this.check()}transform(e,t){return e.length===4?(t=USe(t||[-0,-0,-0,-0],e,this),lb(t,4),t):this.transformAsPoint(e,t)}transformAsPoint(e,t){const{length:n}=e;let i;switch(n){case 2:i=kV(t||[-0,-0],e,this);break;case 3:i=aF(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return lb(i,e.length),i}transformAsVector(e,t){let n;switch(e.length){case 2:n=UV(t||[-0,-0],e,this);break;case 3:n=NV(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return lb(n,e.length),n}transformPoint(e,t){return this.transformAsPoint(e,t)}transformVector(e,t){return this.transformAsPoint(e,t)}transformDirection(e,t){return this.transformAsVector(e,t)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,t,n){return this.identity().translate([e,t,n])}}let oB,aB;function GSe(){return oB||(oB=new _0([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(oB)),oB}function QSe(){return aB||(aB=new _0,Object.freeze(aB)),aB}function XV(r){if(r>Math.PI*2)throw Error("expected radians")}function $Se(r,e,t,n,i,s){const a=2*s/(t-e),o=2*s/(i-n),h=(t+e)/(t-e),f=(i+n)/(i-n),_=-1,x=-1,T=-2*s;return r[0]=a,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=o,r[6]=0,r[7]=0,r[8]=h,r[9]=f,r[10]=_,r[11]=x,r[12]=0,r[13]=0,r[14]=T,r[15]=0,r}function JV(){var r=new Zd(4);return Zd!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function jSe(r){return r[0]=0,r[1]=0,r[2]=0,r[3]=1,r}function ZV(r,e,t){t=t*.5;var n=Math.sin(t);return r[0]=n*e[0],r[1]=n*e[1],r[2]=n*e[2],r[3]=Math.cos(t),r}function YV(r,e,t){var n=e[0],i=e[1],s=e[2],a=e[3],o=t[0],h=t[1],f=t[2],_=t[3];return r[0]=n*_+a*o+i*f-s*h,r[1]=i*_+a*h+s*o-n*f,r[2]=s*_+a*f+n*h-i*o,r[3]=a*_-n*o-i*h-s*f,r}function qSe(r,e,t){t*=.5;var n=e[0],i=e[1],s=e[2],a=e[3],o=Math.sin(t),h=Math.cos(t);return r[0]=n*h+a*o,r[1]=i*h+s*o,r[2]=s*h-i*o,r[3]=a*h-n*o,r}function KSe(r,e,t){t*=.5;var n=e[0],i=e[1],s=e[2],a=e[3],o=Math.sin(t),h=Math.cos(t);return r[0]=n*h-s*o,r[1]=i*h+a*o,r[2]=s*h+n*o,r[3]=a*h-i*o,r}function WSe(r,e,t){t*=.5;var n=e[0],i=e[1],s=e[2],a=e[3],o=Math.sin(t),h=Math.cos(t);return r[0]=n*h+i*o,r[1]=i*h-n*o,r[2]=s*h+a*o,r[3]=a*h-s*o,r}function XSe(r,e){var t=e[0],n=e[1],i=e[2];return r[0]=t,r[1]=n,r[2]=i,r[3]=Math.sqrt(Math.abs(1-t*t-n*n-i*i)),r}function lB(r,e,t,n){var i=e[0],s=e[1],a=e[2],o=e[3],h=t[0],f=t[1],_=t[2],x=t[3],T,I,N,$,W;return I=i*h+s*f+a*_+o*x,I<0&&(I=-I,h=-h,f=-f,_=-_,x=-x),1-I>cb?(T=Math.acos(I),N=Math.sin(T),$=Math.sin((1-n)*T)/N,W=Math.sin(n*T)/N):($=1-n,W=n),r[0]=$*i+W*h,r[1]=$*s+W*f,r[2]=$*a+W*_,r[3]=$*o+W*x,r}function JSe(r,e){var t=e[0],n=e[1],i=e[2],s=e[3],a=t*t+n*n+i*i+s*s,o=a?1/a:0;return r[0]=-t*o,r[1]=-n*o,r[2]=-i*o,r[3]=s*o,r}function ZSe(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r[3]=e[3],r}function eG(r,e){var t=e[0]+e[4]+e[8],n;if(t>0)n=Math.sqrt(t+1),r[3]=.5*n,n=.5/n,r[0]=(e[5]-e[7])*n,r[1]=(e[6]-e[2])*n,r[2]=(e[1]-e[3])*n;else{var i=0;e[4]>e[0]&&(i=1),e[8]>e[i*3+i]&&(i=2);var s=(i+1)%3,a=(i+2)%3;n=Math.sqrt(e[i*3+i]-e[s*3+s]-e[a*3+a]+1),r[i]=.5*n,n=.5/n,r[3]=(e[s*3+a]-e[a*3+s])*n,r[s]=(e[s*3+i]+e[i*3+s])*n,r[a]=(e[a*3+i]+e[i*3+a])*n}return r}var YSe=PSe,eIe=FSe,tIe=OSe,rIe=kSe,nIe=RSe,iIe=LSe,tG=DSe,sIe=function(){var r=HV(),e=GV(1,0,0),t=GV(0,1,0);return function(n,i,s){var a=oF(i,s);return a<-.999999?(tB(r,e,i),tSe(r)<1e-6&&tB(r,t,i),XTe(r,r),ZV(n,r,Math.PI),n):a>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(tB(r,i,s),n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=1+a,tG(n,n))}}();(function(){var r=JV(),e=JV();return function(t,n,i,s,a,o){return lB(r,n,a,o),lB(e,i,s,o),lB(t,r,e,2*o*(1-o)),t}})(),function(){var r=rSe();return function(e,t,n,i){return r[0]=n[0],r[3]=n[1],r[6]=n[2],r[1]=i[0],r[4]=i[1],r[7]=i[2],r[2]=-t[0],r[5]=-t[1],r[8]=-t[2],tG(e,eG(e,r))}}();const oIe=[0,0,0,1];class AF extends nF{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;super(-0,-0,-0,-0),Array.isArray(e)&&arguments.length===1?this.copy(e):this.set(e,t,n,i)}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}set(e,t,n,i){return this[0]=e,this[1]=t,this[2]=n,this[3]=i,this.check()}fromObject(e){return this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this.check()}fromMatrix3(e){return eG(this,e),this.check()}fromAxisRotation(e,t){return ZV(this,e,t),this.check()}identity(){return jSe(this),this.check()}setAxisAngle(e,t){return this.fromAxisRotation(e,t)}get ELEMENTS(){return 4}get x(){return this[0]}set x(e){this[0]=Os(e)}get y(){return this[1]}set y(e){this[1]=Os(e)}get z(){return this[2]}set z(e){this[2]=Os(e)}get w(){return this[3]}set w(e){this[3]=Os(e)}len(){return nIe(this)}lengthSquared(){return iIe(this)}dot(e){return tIe(this,e)}rotationTo(e,t){return sIe(this,e,t),this.check()}add(e){return YSe(this,this,e),this.check()}calculateW(){return XSe(this,this),this.check()}conjugate(){return ZSe(this,this),this.check()}invert(){return JSe(this,this),this.check()}lerp(e,t,n){return n===void 0?this.lerp(this,e,t):(rIe(this,e,t,n),this.check())}multiplyRight(e){return YV(this,this,e),this.check()}multiplyLeft(e){return YV(this,e,this),this.check()}normalize(){const e=this.len(),t=e>0?1/e:0;return this[0]=this[0]*t,this[1]=this[1]*t,this[2]=this[2]*t,this[3]=this[3]*t,e===0&&(this[3]=1),this.check()}rotateX(e){return qSe(this,this,e),this.check()}rotateY(e){return KSe(this,this,e),this.check()}rotateZ(e){return WSe(this,this,e),this.check()}scale(e){return eIe(this,this,e),this.check()}slerp(e,t,n){let i,s,a;switch(arguments.length){case 1:({start:i=oIe,target:s,ratio:a}=e);break;case 2:i=this,s=e,a=t;break;default:i=e,s=t,a=n}return lB(this,i,s,a),this.check()}transformVector4(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new cF;return NSe(t,e,this),lb(t,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(e,t){return this.setAxisAngle(e,t)}premultiply(e){return this.multiplyLeft(e)}multiply(e){return this.multiplyRight(e)}}const ub={EPSILON1:.1,EPSILON2:.01,EPSILON3:.001,EPSILON4:1e-4,EPSILON5:1e-5,EPSILON6:1e-6,EPSILON7:1e-7,EPSILON8:1e-8,EPSILON9:1e-9,EPSILON10:1e-10,EPSILON11:1e-11,EPSILON12:1e-12,EPSILON13:1e-13,EPSILON14:1e-14,EPSILON15:1e-15,EPSILON16:1e-16,EPSILON17:1e-17,EPSILON18:1e-18,EPSILON19:1e-19,EPSILON20:1e-20,PI_OVER_TWO:Math.PI/2,PI_OVER_FOUR:Math.PI/4,PI_OVER_SIX:Math.PI/6,TWO_PI:Math.PI*2},aIe=6378137,lIe=6378137,cIe=6356752314245179e-9;function cB(r){return r}new Yr;function uIe(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:cB;return"longitude"in r?(e[0]=t(r.longitude),e[1]=t(r.latitude),e[2]=r.height):"x"in r?(e[0]=t(r.x),e[1]=t(r.y),e[2]=r.z):(e[0]=t(r[0]),e[1]=t(r[1]),e[2]=r[2]),e}function hIe(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return uIe(r,e,Rl._cartographicRadians?cB:OTe)}function dIe(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:cB;return"longitude"in e?(e.longitude=t(r[0]),e.latitude=t(r[1]),e.height=r[2]):"x"in e?(e.x=t(r[0]),e.y=t(r[1]),e.z=r[2]):(e[0]=t(r[0]),e[1]=t(r[1]),e[2]=r[2]),e}function fIe(r,e){return dIe(r,e,Rl._cartographicRadians?cB:kTe)}const y0=new Yr,AIe=new Yr,pIe=new Yr;function gIe(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];const{oneOverRadii:n,oneOverRadiiSquared:i,centerToleranceSquared:s}=e;y0.from(r);const a=y0.x,o=y0.y,h=y0.z,f=n.x,_=n.y,x=n.z,T=a*a*f*f,I=o*o*_*_,N=h*h*x*x,$=T+I+N,W=Math.sqrt(1/$);if(!Number.isFinite(W))return;const Y=AIe;if(Y.copy(r).scale(W),$<s)return Y.to(t);const ie=i.x,ce=i.y,fe=i.z,ve=pIe;ve.set(Y.x*ie*2,Y.y*ce*2,Y.z*fe*2);let be=(1-W)*y0.len()/(.5*ve.len()),Qe=0,Ue,st,at,Le;do{be-=Qe,Ue=1/(1+be*ie),st=1/(1+be*ce),at=1/(1+be*fe);const ze=Ue*Ue,tt=st*st,Ne=at*at,Ht=ze*Ue,Vt=tt*st,Jt=Ne*at;Le=T*ze+I*tt+N*Ne-1;const er=-2*(T*Ht*ie+I*Vt*ce+N*Jt*fe);Qe=Le/er}while(Math.abs(Le)>ub.EPSILON12);return y0.scale([Ue,st,at]).to(t)}const rG=1e-14,mIe=new Yr,nG={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},pF={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},hb={east:new Yr,north:new Yr,up:new Yr,west:new Yr,south:new Yr,down:new Yr},_Ie=new Yr,yIe=new Yr,bIe=new Yr;function iG(r,e,t,n,i,s){const a=nG[e]&&nG[e][t];Jd(a&&(!n||n===a));let o,h,f;const _=mIe.copy(i);if(xp(_.x,0,rG)&&xp(_.y,0,rG)){const T=Math.sign(_.z);o=_Ie.fromArray(pF[e]),e!=="east"&&e!=="west"&&o.scale(T),h=yIe.fromArray(pF[t]),t!=="east"&&t!=="west"&&h.scale(T),f=bIe.fromArray(pF[n]),n!=="east"&&n!=="west"&&f.scale(T)}else{const{up:T,east:I,north:N}=hb;I.set(-_.y,_.x,0).normalize(),r.geodeticSurfaceNormal(_,T),N.copy(T).cross(I);const{down:$,west:W,south:Y}=hb;$.copy(T).scale(-1),W.copy(I).scale(-1),Y.copy(N).scale(-1),o=hb[e],h=hb[t],f=hb[n]}return s[0]=o.x,s[1]=o.y,s[2]=o.z,s[3]=0,s[4]=h.x,s[5]=h.y,s[6]=h.z,s[7]=0,s[8]=f.x,s[9]=f.y,s[10]=f.z,s[11]=0,s[12]=_.x,s[13]=_.y,s[14]=_.z,s[15]=1,s}const uB=new Yr,sG=new Yr,vIe=new Yr,Yd=new Yr,xIe=new Yr,hB=new Yr;class dB{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;cn(this,"radii",void 0),cn(this,"radiiSquared",void 0),cn(this,"radiiToTheFourth",void 0),cn(this,"oneOverRadii",void 0),cn(this,"oneOverRadiiSquared",void 0),cn(this,"minimumRadius",void 0),cn(this,"maximumRadius",void 0),cn(this,"centerToleranceSquared",ub.EPSILON1),cn(this,"squaredXOverSquaredZ",void 0),Jd(e>=0),Jd(t>=0),Jd(n>=0),this.radii=new Yr(e,t,n),this.radiiSquared=new Yr(e*e,t*t,n*n),this.radiiToTheFourth=new Yr(e*e*e*e,t*t*t*t,n*n*n*n),this.oneOverRadii=new Yr(e===0?0:1/e,t===0?0:1/t,n===0?0:1/n),this.oneOverRadiiSquared=new Yr(e===0?0:1/(e*e),t===0?0:1/(t*t),n===0?0:1/(n*n)),this.minimumRadius=Math.min(e,t,n),this.maximumRadius=Math.max(e,t,n),this.radiiSquared.z!==0&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}equals(e){return this===e||!!(e&&this.radii.equals(e.radii))}toString(){return this.radii.toString()}cartographicToCartesian(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];const n=sG,i=vIe,[,,s]=e;this.geodeticSurfaceNormalCartographic(e,n),i.copy(this.radiiSquared).scale(n);const a=Math.sqrt(n.dot(i));return i.scale(1/a),n.scale(s),i.add(n),i.to(t)}cartesianToCartographic(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];hB.from(e);const n=this.scaleToGeodeticSurface(hB,Yd);if(!n)return;const i=this.geodeticSurfaceNormal(n,sG),s=xIe;s.copy(hB).subtract(n);const a=Math.atan2(i.y,i.x),o=Math.asin(i.z),h=Math.sign(oF(s,hB))*VV(s);return fIe([a,o,h],t)}eastNorthUpToFixedFrame(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new _0;return iG(this,"east","north","up",e,t)}localFrameToFixedFrame(e,t,n,i){let s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:new _0;return iG(this,e,t,n,i,s)}geocentricSurfaceNormal(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return uB.from(e).normalize().to(t)}geodeticSurfaceNormalCartographic(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];const n=hIe(e),i=n[0],s=n[1],a=Math.cos(s);return uB.set(a*Math.cos(i),a*Math.sin(i),Math.sin(s)).normalize(),uB.to(t)}geodeticSurfaceNormal(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return uB.from(e).scale(this.oneOverRadiiSquared).normalize().to(t)}scaleToGeodeticSurface(e,t){return gIe(e,this,t)}scaleToGeocentricSurface(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];Yd.from(e);const n=Yd.x,i=Yd.y,s=Yd.z,a=this.oneOverRadiiSquared,o=1/Math.sqrt(n*n*a.x+i*i*a.y+s*s*a.z);return Yd.multiplyScalar(o).to(t)}transformPositionToScaledSpace(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return Yd.from(e).scale(this.oneOverRadii).to(t)}transformPositionFromScaledSpace(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return Yd.from(e).scale(this.radii).to(t)}getSurfaceNormalIntersectionWithZAxis(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[0,0,0];Jd(xp(this.radii.x,this.radii.y,ub.EPSILON15)),Jd(this.radii.z>0),Yd.from(e);const i=Yd.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(i)>=this.radii.z-t))return Yd.set(0,0,i).to(n)}}cn(dB,"WGS84",new dB(aIe,lIe,cIe));const Ph={OUTSIDE:-1,INTERSECTING:0,INSIDE:1};new Yr,new Yr;const db=new Yr,oG=new Yr;class gF{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,0],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;cn(this,"center",void 0),cn(this,"radius",void 0),this.radius=-0,this.center=new Yr,this.fromCenterRadius(e,t)}fromCenterRadius(e,t){return this.center.from(e),this.radius=t,this}fromCornerPoints(e,t){return t=db.from(t),this.center=new Yr().from(e).add(t).scale(.5),this.radius=this.center.distance(t),this}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.radius===e.radius}clone(){return new gF(this.center,this.radius)}union(e){const t=this.center,n=this.radius,i=e.center,s=e.radius,a=db.copy(i).subtract(t),o=a.magnitude();if(n>=o+s)return this.clone();if(s>=o+n)return e.clone();const h=(n+o+s)*.5;return oG.copy(a).scale((-n+h)/o).add(t),this.center.copy(oG),this.radius=h,this}expand(e){const n=db.from(e).subtract(this.center).magnitude();return n>this.radius&&(this.radius=n),this}transform(e){this.center.transform(e);const t=xSe(db,e);return this.radius=Math.max(t[0],Math.max(t[1],t[2]))*this.radius,this}distanceSquaredTo(e){const t=this.distanceTo(e);return t*t}distanceTo(e){const n=db.from(e).subtract(this.center);return Math.max(0,n.len()-this.radius)}intersectPlane(e){const t=this.center,n=this.radius,s=e.normal.dot(t)+e.distance;return s<-n?Ph.OUTSIDE:s<n?Ph.INTERSECTING:Ph.INSIDE}}const wIe=new Yr,BIe=new Yr,fB=new Yr,AB=new Yr,pB=new Yr,CIe=new Yr,EIe=new Yr,vA={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class mF{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,0],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0,0,0,0,0,0,0];cn(this,"center",void 0),cn(this,"halfAxes",void 0),this.center=new Yr().from(e),this.halfAxes=new Da(t)}get halfSize(){const e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),n=this.halfAxes.getColumn(2);return[new Yr(e).len(),new Yr(t).len(),new Yr(n).len()]}get quaternion(){const e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),n=this.halfAxes.getColumn(2),i=new Yr(e).normalize(),s=new Yr(t).normalize(),a=new Yr(n).normalize();return new AF().fromMatrix3(new Da([...i,...s,...a]))}fromCenterHalfSizeQuaternion(e,t,n){const i=new AF(n),s=new Da().fromQuaternion(i);return s[0]=s[0]*t[0],s[1]=s[1]*t[0],s[2]=s[2]*t[0],s[3]=s[3]*t[1],s[4]=s[4]*t[1],s[5]=s[5]*t[1],s[6]=s[6]*t[2],s[7]=s[7]*t[2],s[8]=s[8]*t[2],this.center=new Yr().from(e),this.halfAxes=s,this}clone(){return new mF(this.center,this.halfAxes)}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.halfAxes.equals(e.halfAxes)}getBoundingSphere(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:new gF;const t=this.halfAxes,n=t.getColumn(0,fB),i=t.getColumn(1,AB),s=t.getColumn(2,pB),a=wIe.copy(n).add(i).add(s);return e.center.copy(this.center),e.radius=a.magnitude(),e}intersectPlane(e){const t=this.center,n=e.normal,i=this.halfAxes,s=n.x,a=n.y,o=n.z,h=Math.abs(s*i[vA.COLUMN0ROW0]+a*i[vA.COLUMN0ROW1]+o*i[vA.COLUMN0ROW2])+Math.abs(s*i[vA.COLUMN1ROW0]+a*i[vA.COLUMN1ROW1]+o*i[vA.COLUMN1ROW2])+Math.abs(s*i[vA.COLUMN2ROW0]+a*i[vA.COLUMN2ROW1]+o*i[vA.COLUMN2ROW2]),f=n.dot(t)+e.distance;return f<=-h?Ph.OUTSIDE:f>=h?Ph.INSIDE:Ph.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const t=BIe.from(e).subtract(this.center),n=this.halfAxes,i=n.getColumn(0,fB),s=n.getColumn(1,AB),a=n.getColumn(2,pB),o=i.magnitude(),h=s.magnitude(),f=a.magnitude();i.normalize(),s.normalize(),a.normalize();let _=0,x;return x=Math.abs(t.dot(i))-o,x>0&&(_+=x*x),x=Math.abs(t.dot(s))-h,x>0&&(_+=x*x),x=Math.abs(t.dot(a))-f,x>0&&(_+=x*x),_}computePlaneDistances(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[-0,-0],i=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY;const a=this.center,o=this.halfAxes,h=o.getColumn(0,fB),f=o.getColumn(1,AB),_=o.getColumn(2,pB),x=CIe.copy(h).add(f).add(_).add(a),T=EIe.copy(x).subtract(e);let I=t.dot(T);return i=Math.min(I,i),s=Math.max(I,s),x.copy(a).add(h).add(f).subtract(_),T.copy(x).subtract(e),I=t.dot(T),i=Math.min(I,i),s=Math.max(I,s),x.copy(a).add(h).subtract(f).add(_),T.copy(x).subtract(e),I=t.dot(T),i=Math.min(I,i),s=Math.max(I,s),x.copy(a).add(h).subtract(f).subtract(_),T.copy(x).subtract(e),I=t.dot(T),i=Math.min(I,i),s=Math.max(I,s),a.copy(x).subtract(h).add(f).add(_),T.copy(x).subtract(e),I=t.dot(T),i=Math.min(I,i),s=Math.max(I,s),a.copy(x).subtract(h).add(f).subtract(_),T.copy(x).subtract(e),I=t.dot(T),i=Math.min(I,i),s=Math.max(I,s),a.copy(x).subtract(h).subtract(f).add(_),T.copy(x).subtract(e),I=t.dot(T),i=Math.min(I,i),s=Math.max(I,s),a.copy(x).subtract(h).subtract(f).subtract(_),T.copy(x).subtract(e),I=t.dot(T),i=Math.min(I,i),s=Math.max(I,s),n[0]=i,n[1]=s,n}transform(e){this.center.transformAsPoint(e);const t=this.halfAxes.getColumn(0,fB);t.transformAsPoint(e);const n=this.halfAxes.getColumn(1,AB);n.transformAsPoint(e);const i=this.halfAxes.getColumn(2,pB);return i.transformAsPoint(e),this.halfAxes=new Da([...t,...n,...i]),this}getTransform(){throw new Error("not implemented")}}const aG=new Yr,lG=new Yr;class fb{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,1],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;cn(this,"normal",void 0),cn(this,"distance",void 0),this.normal=new Yr,this.distance=-0,this.fromNormalDistance(e,t)}fromNormalDistance(e,t){return Jd(Number.isFinite(t)),this.normal.from(e).normalize(),this.distance=t,this}fromPointNormal(e,t){e=aG.from(e),this.normal.from(t).normalize();const n=-this.normal.dot(e);return this.distance=n,this}fromCoefficients(e,t,n,i){return this.normal.set(e,t,n),Jd(xp(this.normal.len(),1)),this.distance=i,this}clone(){return new fb(this.normal,this.distance)}equals(e){return xp(this.distance,e.distance)&&xp(this.normal,e.normal)}getPointDistance(e){return this.normal.dot(e)+this.distance}transform(e){const t=lG.copy(this.normal).transformAsVector(e).normalize(),n=this.normal.scale(-this.distance).transform(e);return this.fromPointNormal(n,t)}projectPointOntoPlane(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];e=aG.from(e);const n=this.getPointDistance(e),i=lG.copy(this.normal).scale(n);return e.subtract(i).to(t)}}const cG=[new Yr([1,0,0]),new Yr([0,1,0]),new Yr([0,0,1])],uG=new Yr,TIe=new Yr;new fb(new Yr(1,0,0),0);class wp{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];cn(this,"planes",void 0),this.planes=e}fromBoundingSphere(e){this.planes.length=2*cG.length;const t=e.center,n=e.radius;let i=0;for(const s of cG){let a=this.planes[i],o=this.planes[i+1];a||(a=this.planes[i]=new fb),o||(o=this.planes[i+1]=new fb);const h=uG.copy(s).scale(-n).add(t);-s.dot(h),a.fromPointNormal(h,s);const f=uG.copy(s).scale(n).add(t),_=TIe.copy(s).negate();-_.dot(f),o.fromPointNormal(f,_),i+=2}return this}computeVisibility(e){let t=Ph.INSIDE;for(const n of this.planes)switch(e.intersectPlane(n)){case Ph.OUTSIDE:return Ph.OUTSIDE;case Ph.INTERSECTING:t=Ph.INTERSECTING;break}return t}computeVisibilityWithPlaneMask(e,t){if(Jd(Number.isFinite(t),"parentPlaneMask is required."),t===wp.MASK_OUTSIDE||t===wp.MASK_INSIDE)return t;let n=wp.MASK_INSIDE;const i=this.planes;for(let s=0;s<this.planes.length;++s){const a=s<31?1<<s:0;if(s<31&&!(t&a))continue;const o=i[s],h=e.intersectPlane(o);if(h===Ph.OUTSIDE)return wp.MASK_OUTSIDE;h===Ph.INTERSECTING&&(n|=a)}return n}}cn(wp,"MASK_OUTSIDE",4294967295),cn(wp,"MASK_INSIDE",0),cn(wp,"MASK_INDETERMINATE",2147483647),new Yr,new Yr,new Yr,new Yr,new Yr,new Yr,new Yr,new Yr,new Yr,new Yr,new Yr,new Yr,new Yr,new Yr,new Yr,new Yr,new Yr;const $f=new Da,SIe=new Da,IIe=new Da,gB=new Da,hG=new Da;function MIe(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const t=ub.EPSILON20,n=10;let i=0,s=0;const a=SIe,o=IIe;a.identity(),o.copy(r);const h=t*PIe(o);for(;s<n&&FIe(o)>h;)RIe(o,gB),hG.copy(gB).transpose(),o.multiplyRight(gB),o.multiplyLeft(hG),a.multiplyRight(gB),++i>2&&(++s,i=0);return e.unitary=a.toTarget(e.unitary),e.diagonal=o.toTarget(e.diagonal),e}function PIe(r){let e=0;for(let t=0;t<9;++t){const n=r[t];e+=n*n}return Math.sqrt(e)}const _F=[1,0,0],yF=[2,2,1];function FIe(r){let e=0;for(let t=0;t<3;++t){const n=r[$f.getElementIndex(yF[t],_F[t])];e+=2*n*n}return Math.sqrt(e)}function RIe(r,e){const t=ub.EPSILON15;let n=0,i=1;for(let f=0;f<3;++f){const _=Math.abs(r[$f.getElementIndex(yF[f],_F[f])]);_>n&&(i=f,n=_)}const s=_F[i],a=yF[i];let o=1,h=0;if(Math.abs(r[$f.getElementIndex(a,s)])>t){const f=r[$f.getElementIndex(a,a)],_=r[$f.getElementIndex(s,s)],x=r[$f.getElementIndex(a,s)],T=(f-_)/2/x;let I;T<0?I=-1/(-T+Math.sqrt(1+T*T)):I=1/(T+Math.sqrt(1+T*T)),o=1/Math.sqrt(1+I*I),h=I*o}return Da.IDENTITY.to(e),e[$f.getElementIndex(s,s)]=e[$f.getElementIndex(a,a)]=o,e[$f.getElementIndex(a,s)]=h,e[$f.getElementIndex(s,a)]=-h,e}const Bp=new Yr,LIe=new Yr,DIe=new Yr,OIe=new Yr,kIe=new Yr,UIe=new Da,NIe={diagonal:new Da,unitary:new Da};function zIe(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new mF;if(!r||r.length===0)return e.halfAxes=new Da([0,0,0,0,0,0,0,0,0]),e.center=new Yr,e;const t=r.length,n=new Yr(0,0,0);for(const st of r)n.add(st);const i=1/t;n.multiplyByScalar(i);let s=0,a=0,o=0,h=0,f=0,_=0;for(const st of r){const at=Bp.copy(st).subtract(n);s+=at.x*at.x,a+=at.x*at.y,o+=at.x*at.z,h+=at.y*at.y,f+=at.y*at.z,_+=at.z*at.z}s*=i,a*=i,o*=i,h*=i,f*=i,_*=i;const x=UIe;x[0]=s,x[1]=a,x[2]=o,x[3]=a,x[4]=h,x[5]=f,x[6]=o,x[7]=f,x[8]=_;const{unitary:T}=MIe(x,NIe),I=e.halfAxes.copy(T);let N=I.getColumn(0,DIe),$=I.getColumn(1,OIe),W=I.getColumn(2,kIe),Y=-Number.MAX_VALUE,ie=-Number.MAX_VALUE,ce=-Number.MAX_VALUE,fe=Number.MAX_VALUE,ve=Number.MAX_VALUE,be=Number.MAX_VALUE;for(const st of r)Bp.copy(st),Y=Math.max(Bp.dot(N),Y),ie=Math.max(Bp.dot($),ie),ce=Math.max(Bp.dot(W),ce),fe=Math.min(Bp.dot(N),fe),ve=Math.min(Bp.dot($),ve),be=Math.min(Bp.dot(W),be);N=N.multiplyByScalar(.5*(fe+Y)),$=$.multiplyByScalar(.5*(ve+ie)),W=W.multiplyByScalar(.5*(be+ce)),e.center.copy(N).add($).add(W);const Qe=LIe.set(Y-fe,ie-ve,ce-be).multiplyByScalar(.5),Ue=new Da([Qe[0],0,0,0,Qe[1],0,0,0,Qe[2]]);return e.halfAxes.multiplyRight(Ue),e}const dG={ADD:1,REPLACE:2},bF={EMPTY:"empty",SCENEGRAPH:"scenegraph",POINTCLOUD:"pointcloud",MESH:"mesh"},HIe={I3S:"I3S",TILES3D:"TILES3D"},mB={GEOMETRIC_ERROR:"geometricError",MAX_SCREEN_THRESHOLD:"maxScreenThreshold"},fG="3.4.15",Ab={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GEOMETRY:"geom",VECTOR:"vect",GLTF:"glTF"};function AG(r,e,t){al(r instanceof ArrayBuffer);const n=new TextDecoder("utf8"),i=new Uint8Array(r,e,t);return n.decode(i)}function VIe(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const t=new DataView(r);return"".concat(String.fromCharCode(t.getUint8(e+0))).concat(String.fromCharCode(t.getUint8(e+1))).concat(String.fromCharCode(t.getUint8(e+2))).concat(String.fromCharCode(t.getUint8(e+3)))}const GIe={name:"Draco",id:gA?"draco":"draco-nodejs",module:"draco",shapes:["mesh"],version:"3.4.15",worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};function QIe(r){let e=1/0,t=1/0,n=1/0,i=-1/0,s=-1/0,a=-1/0;const o=r.POSITION?r.POSITION.value:[],h=o&&o.length;for(let f=0;f<h;f+=3){const _=o[f],x=o[f+1],T=o[f+2];e=_<e?_:e,t=x<t?x:t,n=T<n?T:n,i=_>i?_:i,s=x>s?x:s,a=T>a?T:a}return[[e,t,n],[i,s,a]]}function $Ie(r,e){if(!r)throw new Error("loader assertion failed.")}class b0{constructor(e,t){cn(this,"fields",void 0),cn(this,"metadata",void 0),$Ie(Array.isArray(e)),jIe(e),this.fields=e,this.metadata=t||new Map}compareTo(e){if(this.metadata!==e.metadata||this.fields.length!==e.fields.length)return!1;for(let t=0;t<this.fields.length;++t)if(!this.fields[t].compareTo(e.fields[t]))return!1;return!0}select(){const e=Object.create(null);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];for(const a of n)e[a]=!0;const s=this.fields.filter(a=>e[a.name]);return new b0(s,this.metadata)}selectAt(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=t.map(s=>this.fields[s]).filter(Boolean);return new b0(i,this.metadata)}assign(e){let t,n=this.metadata;if(e instanceof b0){const a=e;t=a.fields,n=pG(pG(new Map,this.metadata),a.metadata)}else t=e;const i=Object.create(null);for(const a of this.fields)i[a.name]=a;for(const a of t)i[a.name]=a;const s=Object.values(i);return new b0(s,n)}}function jIe(r){const e={};for(const t of r)e[t.name]&&console.warn("Schema: duplicated field name",t.name,t),e[t.name]=!0}function pG(r,e){return new Map([...r||new Map,...e||new Map])}class _B{constructor(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:new Map;cn(this,"name",void 0),cn(this,"type",void 0),cn(this,"nullable",void 0),cn(this,"metadata",void 0),this.name=e,this.type=t,this.nullable=n,this.metadata=i}get typeId(){return this.type&&this.type.typeId}clone(){return new _B(this.name,this.type,this.nullable,this.metadata)}compareTo(e){return this.name===e.name&&this.type===e.type&&this.nullable===e.nullable&&this.metadata===e.metadata}toString(){return"".concat(this.type).concat(this.nullable?", nullable":"").concat(this.metadata?", metadata: ".concat(this.metadata):"")}}let ya=function(r){return r[r.NONE=0]="NONE",r[r.Null=1]="Null",r[r.Int=2]="Int",r[r.Float=3]="Float",r[r.Binary=4]="Binary",r[r.Utf8=5]="Utf8",r[r.Bool=6]="Bool",r[r.Decimal=7]="Decimal",r[r.Date=8]="Date",r[r.Time=9]="Time",r[r.Timestamp=10]="Timestamp",r[r.Interval=11]="Interval",r[r.List=12]="List",r[r.Struct=13]="Struct",r[r.Union=14]="Union",r[r.FixedSizeBinary=15]="FixedSizeBinary",r[r.FixedSizeList=16]="FixedSizeList",r[r.Map=17]="Map",r[r.Dictionary=-1]="Dictionary",r[r.Int8=-2]="Int8",r[r.Int16=-3]="Int16",r[r.Int32=-4]="Int32",r[r.Int64=-5]="Int64",r[r.Uint8=-6]="Uint8",r[r.Uint16=-7]="Uint16",r[r.Uint32=-8]="Uint32",r[r.Uint64=-9]="Uint64",r[r.Float16=-10]="Float16",r[r.Float32=-11]="Float32",r[r.Float64=-12]="Float64",r[r.DateDay=-13]="DateDay",r[r.DateMillisecond=-14]="DateMillisecond",r[r.TimestampSecond=-15]="TimestampSecond",r[r.TimestampMillisecond=-16]="TimestampMillisecond",r[r.TimestampMicrosecond=-17]="TimestampMicrosecond",r[r.TimestampNanosecond=-18]="TimestampNanosecond",r[r.TimeSecond=-19]="TimeSecond",r[r.TimeMillisecond=-20]="TimeMillisecond",r[r.TimeMicrosecond=-21]="TimeMicrosecond",r[r.TimeNanosecond=-22]="TimeNanosecond",r[r.DenseUnion=-23]="DenseUnion",r[r.SparseUnion=-24]="SparseUnion",r[r.IntervalDayTime=-25]="IntervalDayTime",r[r.IntervalYearMonth=-26]="IntervalYearMonth",r}({}),gG,mG,_G;class vF{static isNull(e){return e&&e.typeId===ya.Null}static isInt(e){return e&&e.typeId===ya.Int}static isFloat(e){return e&&e.typeId===ya.Float}static isBinary(e){return e&&e.typeId===ya.Binary}static isUtf8(e){return e&&e.typeId===ya.Utf8}static isBool(e){return e&&e.typeId===ya.Bool}static isDecimal(e){return e&&e.typeId===ya.Decimal}static isDate(e){return e&&e.typeId===ya.Date}static isTime(e){return e&&e.typeId===ya.Time}static isTimestamp(e){return e&&e.typeId===ya.Timestamp}static isInterval(e){return e&&e.typeId===ya.Interval}static isList(e){return e&&e.typeId===ya.List}static isStruct(e){return e&&e.typeId===ya.Struct}static isUnion(e){return e&&e.typeId===ya.Union}static isFixedSizeBinary(e){return e&&e.typeId===ya.FixedSizeBinary}static isFixedSizeList(e){return e&&e.typeId===ya.FixedSizeList}static isMap(e){return e&&e.typeId===ya.Map}static isDictionary(e){return e&&e.typeId===ya.Dictionary}get typeId(){return ya.NONE}compareTo(e){return this===e}}gG=Symbol.toStringTag;class v0 extends vF{constructor(e,t){super(),cn(this,"isSigned",void 0),cn(this,"bitWidth",void 0),this.isSigned=e,this.bitWidth=t}get typeId(){return ya.Int}get[gG](){return"Int"}toString(){return"".concat(this.isSigned?"I":"Ui","nt").concat(this.bitWidth)}}class qIe extends v0{constructor(){super(!0,8)}}class KIe extends v0{constructor(){super(!0,16)}}class WIe extends v0{constructor(){super(!0,32)}}class XIe extends v0{constructor(){super(!1,8)}}class JIe extends v0{constructor(){super(!1,16)}}class ZIe extends v0{constructor(){super(!1,32)}}const yG={HALF:16,SINGLE:32,DOUBLE:64};mG=Symbol.toStringTag;class bG extends vF{constructor(e){super(),cn(this,"precision",void 0),this.precision=e}get typeId(){return ya.Float}get[mG](){return"Float"}toString(){return"Float".concat(this.precision)}}class YIe extends bG{constructor(){super(yG.SINGLE)}}class e3e extends bG{constructor(){super(yG.DOUBLE)}}_G=Symbol.toStringTag;class t3e extends vF{constructor(e,t){super(),cn(this,"listSize",void 0),cn(this,"children",void 0),this.listSize=e,this.children=[t]}get typeId(){return ya.FixedSizeList}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get[_G](){return"FixedSizeList"}toString(){return"FixedSizeList[".concat(this.listSize,"]<").concat(this.valueType,">")}}function r3e(r){switch(r.constructor){case Int8Array:return new qIe;case Uint8Array:return new XIe;case Int16Array:return new KIe;case Uint16Array:return new JIe;case Int32Array:return new WIe;case Uint32Array:return new ZIe;case Float32Array:return new YIe;case Float64Array:return new e3e;default:throw new Error("array type not supported")}}function n3e(r,e,t){const n=r3e(e.value),i=t||i3e(e);return new _B(r,new t3e(e.size,new _B("value",n)),!1,i)}function i3e(r){const e=new Map;return"byteOffset"in r&&e.set("byteOffset",r.byteOffset.toString(10)),"byteStride"in r&&e.set("byteStride",r.byteStride.toString(10)),"normalized"in r&&e.set("normalized",r.normalized.toString()),e}function s3e(r,e,t){const n=xG(e.metadata),i=[],s=o3e(e.attributes);for(const a in r){const o=r[a],h=vG(a,o,s[a]);i.push(h)}if(t){const a=vG("indices",t);i.push(a)}return new b0(i,n)}function o3e(r){const e={};for(const t in r){const n=r[t];e[n.name||"undefined"]=n}return e}function vG(r,e,t){const n=t?xG(t.metadata):void 0;return n3e(r,e,n)}function xG(r){const e=new Map;for(const t in r)e.set("".concat(t,".string"),JSON.stringify(r[t]));return e}const wG={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},a3e={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},l3e=4;class c3e{constructor(e){cn(this,"draco",void 0),cn(this,"decoder",void 0),cn(this,"metadataQuerier",void 0),this.draco=e,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=new this.draco.DecoderBuffer;n.Init(new Int8Array(e),e.byteLength),this._disableAttributeTransforms(t);const i=this.decoder.GetEncodedGeometryType(n),s=i===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let a;switch(i){case this.draco.TRIANGULAR_MESH:a=this.decoder.DecodeBufferToMesh(n,s);break;case this.draco.POINT_CLOUD:a=this.decoder.DecodeBufferToPointCloud(n,s);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!a.ok()||!s.ptr){const T="DRACO decompression failed: ".concat(a.error_msg());throw new Error(T)}const o=this._getDracoLoaderData(s,i,t),h=this._getMeshData(s,o,t),f=QIe(h.attributes),_=s3e(h.attributes,o,h.indices);return{loader:"draco",loaderData:o,header:{vertexCount:s.num_points(),boundingBox:f},...h,schema:_}}finally{this.draco.destroy(n),s&&this.draco.destroy(s)}}_getDracoLoaderData(e,t,n){const i=this._getTopLevelMetadata(e),s=this._getDracoAttributes(e,n);return{geometry_type:t,num_attributes:e.num_attributes(),num_points:e.num_points(),num_faces:e instanceof this.draco.Mesh?e.num_faces():0,metadata:i,attributes:s}}_getDracoAttributes(e,t){const n={};for(let i=0;i<e.num_attributes();i++){const s=this.decoder.GetAttribute(e,i),a=this._getAttributeMetadata(e,i);n[s.unique_id()]={unique_id:s.unique_id(),attribute_type:s.attribute_type(),data_type:s.data_type(),num_components:s.num_components(),byte_offset:s.byte_offset(),byte_stride:s.byte_stride(),normalized:s.normalized(),attribute_index:i,metadata:a};const o=this._getQuantizationTransform(s,t);o&&(n[s.unique_id()].quantization_transform=o);const h=this._getOctahedronTransform(s,t);h&&(n[s.unique_id()].octahedron_transform=h)}return n}_getMeshData(e,t,n){const i=this._getMeshAttributes(t,e,n);if(!i.POSITION)throw new Error("DRACO: No position attribute found.");if(e instanceof this.draco.Mesh)switch(n.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:i,indices:{value:this._getTriangleStripIndices(e),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:i,indices:{value:this._getTriangleListIndices(e),size:1}}}return{topology:"point-list",mode:0,attributes:i}}_getMeshAttributes(e,t,n){const i={};for(const s of Object.values(e.attributes)){const a=this._deduceAttributeName(s,n);s.name=a;const{value:o,size:h}=this._getAttributeValues(t,s);i[a]={value:o,size:h,byteOffset:s.byte_offset,byteStride:s.byte_stride,normalized:s.normalized}}return i}_getTriangleListIndices(e){const n=e.num_faces()*3,i=n*l3e,s=this.draco._malloc(i);try{return this.decoder.GetTrianglesUInt32Array(e,i,s),new Uint32Array(this.draco.HEAPF32.buffer,s,n).slice()}finally{this.draco._free(s)}}_getTriangleStripIndices(e){const t=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(e,t),d3e(t)}finally{this.draco.destroy(t)}}_getAttributeValues(e,t){const n=a3e[t.data_type],i=t.num_components,a=e.num_points()*i,o=a*n.BYTES_PER_ELEMENT,h=u3e(this.draco,n);let f;const _=this.draco._malloc(o);try{const x=this.decoder.GetAttribute(e,t.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(e,x,h,o,_),f=new n(this.draco.HEAPF32.buffer,_,a).slice()}finally{this.draco._free(_)}return{value:f,size:i}}_deduceAttributeName(e,t){const n=e.unique_id;for(const[a,o]of Object.entries(t.extraAttributes||{}))if(o===n)return a;const i=e.attribute_type;for(const a in wG)if(this.draco[a]===i)return wG[a];const s=t.attributeNameEntry||"name";return e.metadata[s]?e.metadata[s].string:"CUSTOM_ATTRIBUTE_".concat(n)}_getTopLevelMetadata(e){const t=this.decoder.GetMetadata(e);return this._getDracoMetadata(t)}_getAttributeMetadata(e,t){const n=this.decoder.GetAttributeMetadata(e,t);return this._getDracoMetadata(n)}_getDracoMetadata(e){if(!e||!e.ptr)return{};const t={},n=this.metadataQuerier.NumEntries(e);for(let i=0;i<n;i++){const s=this.metadataQuerier.GetEntryName(e,i);t[s]=this._getDracoMetadataField(e,s)}return t}_getDracoMetadataField(e,t){const n=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(e,t,n);const i=h3e(n);return{int:this.metadataQuerier.GetIntEntry(e,t),string:this.metadataQuerier.GetStringEntry(e,t),double:this.metadataQuerier.GetDoubleEntry(e,t),intArray:i}}finally{this.draco.destroy(n)}}_disableAttributeTransforms(e){const{quantizedAttributes:t=[],octahedronAttributes:n=[]}=e,i=[...t,...n];for(const s of i)this.decoder.SkipAttributeTransform(this.draco[s])}_getQuantizationTransform(e,t){const{quantizedAttributes:n=[]}=t,i=e.attribute_type();if(n.map(a=>this.decoder[a]).includes(i)){const a=new this.draco.AttributeQuantizationTransform;try{if(a.InitFromAttribute(e))return{quantization_bits:a.quantization_bits(),range:a.range(),min_values:new Float32Array([1,2,3]).map(o=>a.min_value(o))}}finally{this.draco.destroy(a)}}return null}_getOctahedronTransform(e,t){const{octahedronAttributes:n=[]}=t,i=e.attribute_type();if(n.map(a=>this.decoder[a]).includes(i)){const a=new this.draco.AttributeQuantizationTransform;try{if(a.InitFromAttribute(e))return{quantization_bits:a.quantization_bits()}}finally{this.draco.destroy(a)}}return null}}function u3e(r,e){switch(e){case Float32Array:return r.DT_FLOAT32;case Int8Array:return r.DT_INT8;case Int16Array:return r.DT_INT16;case Int32Array:return r.DT_INT32;case Uint8Array:return r.DT_UINT8;case Uint16Array:return r.DT_UINT16;case Uint32Array:return r.DT_UINT32;default:return r.DT_INVALID}}function h3e(r){const e=r.size(),t=new Int32Array(e);for(let n=0;n<e;n++)t[n]=r.GetValue(n);return t}function d3e(r){const e=r.size(),t=new Int32Array(e);for(let n=0;n<e;n++)t[n]=r.GetValue(n);return t}const xF="https://www.gstatic.com/draco/versioned/decoders/".concat("1.5.5"),f3e="".concat(xF,"/draco_decoder.js"),A3e="".concat(xF,"/draco_wasm_wrapper.js"),p3e="".concat(xF,"/draco_decoder.wasm");let pb;async function g3e(r){const e=r.modules||{};return e.draco3d?pb=pb||e.draco3d.createDecoderModule({}).then(t=>({draco:t})):pb=pb||m3e(r),await pb}async function m3e(r){let e,t;switch(r.draco&&r.draco.decoderType){case"js":e=await Og(f3e,"draco",r);break;case"wasm":default:[e,t]=await Promise.all([await Og(A3e,"draco",r),await Og(p3e,"draco",r)])}return e=e||globalThis.DracoDecoderModule,await _3e(e,t)}function _3e(r,e){const t={};return e&&(t.wasmBinary=e),new Promise(n=>{r({...t,onModuleLoaded:i=>n({draco:i})})})}const BG={...GIe,parse:y3e};async function y3e(r,e){const{draco:t}=await g3e(e),n=new c3e(t);try{return n.parseSync(r,e==null?void 0:e.draco)}finally{n.destroy()}}const b3e={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},ul={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},_s={...b3e,...ul},wF={[ul.DOUBLE]:Float64Array,[ul.FLOAT]:Float32Array,[ul.UNSIGNED_SHORT]:Uint16Array,[ul.UNSIGNED_INT]:Uint32Array,[ul.UNSIGNED_BYTE]:Uint8Array,[ul.BYTE]:Int8Array,[ul.SHORT]:Int16Array,[ul.INT]:Int32Array},v3e={DOUBLE:ul.DOUBLE,FLOAT:ul.FLOAT,UNSIGNED_SHORT:ul.UNSIGNED_SHORT,UNSIGNED_INT:ul.UNSIGNED_INT,UNSIGNED_BYTE:ul.UNSIGNED_BYTE,BYTE:ul.BYTE,SHORT:ul.SHORT,INT:ul.INT},BF="Failed to convert GL type";class jf{static fromTypedArray(e){e=ArrayBuffer.isView(e)?e.constructor:e;for(const t in wF)if(wF[t]===e)return t;throw new Error(BF)}static fromName(e){const t=v3e[e];if(!t)throw new Error(BF);return t}static getArrayType(e){switch(e){case ul.UNSIGNED_SHORT_5_6_5:case ul.UNSIGNED_SHORT_4_4_4_4:case ul.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:const t=wF[e];if(!t)throw new Error(BF);return t}}static getByteSize(e){return jf.getArrayType(e).BYTES_PER_ELEMENT}static validate(e){return!!jf.getArrayType(e)}static createTypedArray(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0;i===void 0&&(i=(t.byteLength-n)/jf.getByteSize(e));const s=jf.getArrayType(e);return new s(t,n,i)}}function x3e(r,e){if(!r)throw new Error("math.gl assertion failed. ".concat(e))}function w3e(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];const t=r>>11&31,n=r>>5&63,i=r&31;return e[0]=t<<3,e[1]=n<<2,e[2]=i<<3,e}new sF,new Yr,new sF,new sF;function CG(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:255;return zTe(r,0,e)/e*2-1}function EG(r){return r<0?-1:1}function B3e(r,e,t,n){if(x3e(n),r<0||r>t||e<0||e>t)throw new Error("x and y must be unsigned normalized integers between 0 and ".concat(t));if(n.x=CG(r,t),n.y=CG(e,t),n.z=1-(Math.abs(n.x)+Math.abs(n.y)),n.z<0){const i=n.x;n.x=(1-Math.abs(n.y))*EG(i),n.y=(1-Math.abs(i))*EG(n.y)}return n.normalize()}function C3e(r,e,t){return B3e(r,e,255,t)}class CF{constructor(e,t){cn(this,"json",void 0),cn(this,"buffer",void 0),cn(this,"featuresLength",0),cn(this,"_cachedTypedArrays",{}),this.json=e,this.buffer=t}getExtension(e){return this.json.extensions&&this.json.extensions[e]}hasProperty(e){return!!this.json[e]}getGlobalProperty(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_s.UNSIGNED_INT,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const i=this.json[e];return i&&Number.isFinite(i.byteOffset)?this._getTypedArrayFromBinary(e,t,n,1,i.byteOffset):i}getPropertyArray(e,t,n){const i=this.json[e];return i&&Number.isFinite(i.byteOffset)?("componentType"in i&&(t=jf.fromName(i.componentType)),this._getTypedArrayFromBinary(e,t,n,this.featuresLength,i.byteOffset)):this._getTypedArrayFromArray(e,t,i)}getProperty(e,t,n,i,s){const a=this.json[e];if(!a)return a;const o=this.getPropertyArray(e,t,n);if(n===1)return o[i];for(let h=0;h<n;++h)s[h]=o[n*i+h];return s}_getTypedArrayFromBinary(e,t,n,i,s){const a=this._cachedTypedArrays;let o=a[e];return o||(o=jf.createTypedArray(t,this.buffer.buffer,this.buffer.byteOffset+s,i*n),a[e]=o),o}_getTypedArrayFromArray(e,t,n){const i=this._cachedTypedArrays;let s=i[e];return s||(s=jf.createTypedArray(t,n),i[e]=s),s}}const E3e={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},T3e={SCALAR:(r,e)=>r[e],VEC2:(r,e)=>[r[2*e+0],r[2*e+1]],VEC3:(r,e)=>[r[3*e+0],r[3*e+1],r[3*e+2]],VEC4:(r,e)=>[r[4*e+0],r[4*e+1],r[4*e+2],r[4*e+3]],MAT2:(r,e)=>[r[4*e+0],r[4*e+1],r[4*e+2],r[4*e+3]],MAT3:(r,e)=>[r[9*e+0],r[9*e+1],r[9*e+2],r[9*e+3],r[9*e+4],r[9*e+5],r[9*e+6],r[9*e+7],r[9*e+8]],MAT4:(r,e)=>[r[16*e+0],r[16*e+1],r[16*e+2],r[16*e+3],r[16*e+4],r[16*e+5],r[16*e+6],r[16*e+7],r[16*e+8],r[16*e+9],r[16*e+10],r[16*e+11],r[16*e+12],r[16*e+13],r[16*e+14],r[16*e+15]]},S3e={SCALAR:(r,e,t)=>{e[t]=r},VEC2:(r,e,t)=>{e[2*t+0]=r[0],e[2*t+1]=r[1]},VEC3:(r,e,t)=>{e[3*t+0]=r[0],e[3*t+1]=r[1],e[3*t+2]=r[2]},VEC4:(r,e,t)=>{e[4*t+0]=r[0],e[4*t+1]=r[1],e[4*t+2]=r[2],e[4*t+3]=r[3]},MAT2:(r,e,t)=>{e[4*t+0]=r[0],e[4*t+1]=r[1],e[4*t+2]=r[2],e[4*t+3]=r[3]},MAT3:(r,e,t)=>{e[9*t+0]=r[0],e[9*t+1]=r[1],e[9*t+2]=r[2],e[9*t+3]=r[3],e[9*t+4]=r[4],e[9*t+5]=r[5],e[9*t+6]=r[6],e[9*t+7]=r[7],e[9*t+8]=r[8],e[9*t+9]=r[9]},MAT4:(r,e,t)=>{e[16*t+0]=r[0],e[16*t+1]=r[1],e[16*t+2]=r[2],e[16*t+3]=r[3],e[16*t+4]=r[4],e[16*t+5]=r[5],e[16*t+6]=r[6],e[16*t+7]=r[7],e[16*t+8]=r[8],e[16*t+9]=r[9],e[16*t+10]=r[10],e[16*t+11]=r[11],e[16*t+12]=r[12],e[16*t+13]=r[13],e[16*t+14]=r[14],e[16*t+15]=r[15]}};function I3e(r,e,t,n){const{componentType:i}=r;al(r.componentType);const s=typeof i=="string"?jf.fromName(i):i,a=E3e[r.type],o=T3e[r.type],h=S3e[r.type];return t+=r.byteOffset,{values:jf.createTypedArray(s,e,t,a*n),type:s,size:a,unpacker:o,packer:h}}const qf=r=>r!==void 0;function M3e(r,e,t){if(!e)return null;let n=r.getExtension("3DTILES_batch_table_hierarchy");const i=e.HIERARCHY;return i&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),e.extensions=e.extensions||{},e.extensions["3DTILES_batch_table_hierarchy"]=i,n=i),n?P3e(n,t):null}function P3e(r,e){let t,n,i;const s=r.instancesLength,a=r.classes;let o=r.classIds,h=r.parentCounts,f=r.parentIds,_=s;qf(o.byteOffset)&&(o.componentType=defaultValue(o.componentType,GL.UNSIGNED_SHORT),o.type=AttributeType.SCALAR,i=getBinaryAccessor(o),o=i.createArrayBufferView(e.buffer,e.byteOffset+o.byteOffset,s));let x;if(qf(h))for(qf(h.byteOffset)&&(h.componentType=defaultValue(h.componentType,GL.UNSIGNED_SHORT),h.type=AttributeType.SCALAR,i=getBinaryAccessor(h),h=i.createArrayBufferView(e.buffer,e.byteOffset+h.byteOffset,s)),x=new Uint16Array(s),_=0,t=0;t<s;++t)x[t]=_,_+=h[t];qf(f)&&qf(f.byteOffset)&&(f.componentType=defaultValue(f.componentType,GL.UNSIGNED_SHORT),f.type=AttributeType.SCALAR,i=getBinaryAccessor(f),f=i.createArrayBufferView(e.buffer,e.byteOffset+f.byteOffset,_));const T=a.length;for(t=0;t<T;++t){const W=a[t].length,Y=a[t].instances,ie=getBinaryProperties(W,Y,e);a[t].instances=combine(ie,Y)}const I=new Array(T).fill(0),N=new Uint16Array(s);for(t=0;t<s;++t)n=o[t],N[t]=I[n],++I[n];const $={classes:a,classIds:o,classIndexes:N,parentCounts:h,parentIndexes:x,parentIds:f};return L3e($),$}function gb(r,e,t){if(!r)return;const n=r.parentCounts;return r.parentIds?t(r,e):n>0?F3e(r,e,t):R3e(r,e,t)}function F3e(r,e,t){const n=r.classIds,i=r.parentCounts,s=r.parentIds,a=r.parentIndexes,o=n.length,h=scratchVisited;h.length=Math.max(h.length,o);const f=++marker,_=scratchStack;for(_.length=0,_.push(e);_.length>0;){if(e=_.pop(),h[e]===f)continue;h[e]=f;const x=t(r,e);if(qf(x))return x;const T=i[e],I=a[e];for(let N=0;N<T;++N){const $=s[I+N];$!==e&&_.push($)}}return null}function R3e(r,e,t){let n=!0;for(;n;){const i=t(r,e);if(qf(i))return i;const s=r.parentIds[e];n=s!==e,e=s}throw new Error("traverseHierarchySingleParent")}function L3e(r){const t=r.classIds.length;for(let n=0;n<t;++n)TG(r,n,stack)}function TG(r,e,t){const n=r.parentCounts,i=r.parentIds,s=r.parentIndexes,o=r.classIds.length;if(!qf(i))return;assert(e<o,"Parent index ".concat(e," exceeds the total number of instances: ").concat(o)),assert(t.indexOf(e)===-1,"Circular dependency detected in the batch table hierarchy."),t.push(e);const h=qf(n)?n[e]:1,f=qf(n)?s[e]:e;for(let _=0;_<h;++_){const x=i[f+_];x!==e&&TG(r,x,t)}t.pop(e)}function th(r){return r!=null}const yB=(r,e)=>r,D3e={HIERARCHY:!0,extensions:!0,extras:!0};class SG{constructor(e,t,n){var i;let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};cn(this,"json",void 0),cn(this,"binary",void 0),cn(this,"featureCount",void 0),cn(this,"_extensions",void 0),cn(this,"_properties",void 0),cn(this,"_binaryProperties",void 0),cn(this,"_hierarchy",void 0),al(n>=0),this.json=e||{},this.binary=t,this.featureCount=n,this._extensions=((i=this.json)===null||i===void 0?void 0:i.extensions)||{},this._properties={};for(const a in this.json)D3e[a]||(this._properties[a]=this.json[a]);this._binaryProperties=this._initializeBinaryProperties(),s["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=M3e(this,this.json,this.binary))}getExtension(e){return this.json&&this.json.extensions&&this.json.extensions[e]}memorySizeInBytes(){return 0}isClass(e,t){if(this._checkBatchId(e),al(typeof t=="string",t),this._hierarchy){const n=gb(this._hierarchy,e,(i,s)=>{const a=i.classIds[s];return i.classes[a].name===t});return th(n)}return!1}isExactClass(e,t){return al(typeof t=="string",t),this.getExactClassName(e)===t}getExactClassName(e){if(this._checkBatchId(e),this._hierarchy){const t=this._hierarchy.classIds[e];return this._hierarchy.classes[t].name}}hasProperty(e,t){return this._checkBatchId(e),al(typeof t=="string",t),th(this._properties[t])||this._hasPropertyInHierarchy(e,t)}getPropertyNames(e,t){this._checkBatchId(e),t=th(t)?t:[],t.length=0;const n=Object.keys(this._properties);return t.push(...n),this._hierarchy&&this._getPropertyNamesInHierarchy(e,t),t}getProperty(e,t){if(this._checkBatchId(e),al(typeof t=="string",t),this._binaryProperties){const i=this._binaryProperties[t];if(th(i))return this._getBinaryProperty(i,e)}const n=this._properties[t];if(th(n))return yB(n[e]);if(this._hierarchy){const i=this._getHierarchyProperty(e,t);if(th(i))return i}}setProperty(e,t,n){const i=this.featureCount;if(this._checkBatchId(e),al(typeof t=="string",t),this._binaryProperties){const a=this._binaryProperties[t];if(a){this._setBinaryProperty(a,e,n);return}}if(this._hierarchy&&this._setHierarchyProperty(this,e,t,n))return;let s=this._properties[t];th(s)||(this._properties[t]=new Array(i),s=this._properties[t]),s[e]=yB(n)}_checkBatchId(e){if(!(e>=0&&e<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(e,t){return e.unpack(e.typedArray,t)}_setBinaryProperty(e,t,n){e.pack(n,e.typedArray,t)}_initializeBinaryProperties(){let e=null;for(const t in this._properties){const n=this._properties[t],i=this._initializeBinaryProperty(t,n);i&&(e=e||{},e[t]=i)}return e}_initializeBinaryProperty(e,t){if("byteOffset"in t){const n=t;al(this.binary,"Property ".concat(e," requires a batch table binary.")),al(n.type,"Property ".concat(e," requires a type."));const i=I3e(n,this.binary.buffer,this.binary.byteOffset|0,this.featureCount);return{typedArray:i.values,componentCount:i.size,unpack:i.unpacker,pack:i.packer}}return null}_hasPropertyInHierarchy(e,t){if(!this._hierarchy)return!1;const n=gb(this._hierarchy,e,(i,s)=>{const a=i.classIds[s],o=i.classes[a].instances;return th(o[t])});return th(n)}_getPropertyNamesInHierarchy(e,t){gb(this._hierarchy,e,(n,i)=>{const s=n.classIds[i],a=n.classes[s].instances;for(const o in a)a.hasOwnProperty(o)&&t.indexOf(o)===-1&&t.push(o)})}_getHierarchyProperty(e,t){return gb(this._hierarchy,e,(n,i)=>{const s=n.classIds[i],a=n.classes[s],o=n.classIndexes[i],h=a.instances[t];return th(h)?th(h.typedArray)?this._getBinaryProperty(h,o):yB(h[o]):null})}_setHierarchyProperty(e,t,n,i){const s=gb(this._hierarchy,t,(a,o)=>{const h=a.classIds[o],f=a.classes[h],_=a.classIndexes[o],x=f.instances[n];return th(x)?(al(o===t,'Inherited property "'.concat(n,'" is read-only.')),th(x.typedArray)?this._setBinaryProperty(x,_,i):x[_]=yB(i),!0):!1});return th(s)}}const EF=4;function bB(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const n=new DataView(e);if(r.magic=n.getUint32(t,!0),t+=EF,r.version=n.getUint32(t,!0),t+=EF,r.byteLength=n.getUint32(t,!0),t+=EF,r.version!==1)throw new Error("3D Tile Version ".concat(r.version," not supported"));return t}const x0=4,IG="b3dm tile in legacy format.";function TF(r,e,t){const n=new DataView(e);let i;r.header=r.header||{};let s=n.getUint32(t,!0);t+=x0;let a=n.getUint32(t,!0);t+=x0;let o=n.getUint32(t,!0);t+=x0;let h=n.getUint32(t,!0);return t+=x0,o>=570425344?(t-=x0*2,i=s,o=a,h=0,s=0,a=0,console.warn(IG)):h>=570425344&&(t-=x0,i=o,o=s,h=a,s=0,a=0,console.warn(IG)),r.header.featureTableJsonByteLength=s,r.header.featureTableBinaryByteLength=a,r.header.batchTableJsonByteLength=o,r.header.batchTableBinaryByteLength=h,r.header.batchLength=i,t}function SF(r,e,t,n){return t=O3e(r,e,t),t=k3e(r,e,t),t}function O3e(r,e,t,n){const{featureTableJsonByteLength:i,featureTableBinaryByteLength:s,batchLength:a}=r.header;if(r.featureTableJson={BATCH_LENGTH:a||0},i>0){const o=AG(e,t,i);r.featureTableJson=JSON.parse(o)}return t+=i,r.featureTableBinary=new Uint8Array(e,t,s),t+=s,t}function k3e(r,e,t,n){const{batchTableJsonByteLength:i,batchTableBinaryByteLength:s}=r.header;if(i>0){const a=AG(e,t,i);r.batchTableJson=JSON.parse(a),t+=i,s>0&&(r.batchTableBinary=new Uint8Array(e,t,s),r.batchTableBinary=new Uint8Array(r.batchTableBinary),t+=s)}return t}function MG(r,e,t){if(!e&&(!r||!r.batchIds||!t))return null;const{batchIds:n,isRGB565:i,pointCount:s}=r;if(n&&t){const a=new Uint8ClampedArray(s*3);for(let o=0;o<s;o++){const h=n[o],_=t.getProperty(h,"dimensions").map(x=>x*255);a[o*3]=_[0],a[o*3+1]=_[1],a[o*3+2]=_[2]}return{type:_s.UNSIGNED_BYTE,value:a,size:3,normalized:!0}}if(i){const a=new Uint8ClampedArray(s*3);for(let o=0;o<s;o++){const h=w3e(e[o]);a[o*3]=h[0],a[o*3+1]=h[1],a[o*3+2]=h[2]}return{type:_s.UNSIGNED_BYTE,value:a,size:3,normalized:!0}}return e&&e.length===s*3?{type:_s.UNSIGNED_BYTE,value:e,size:3,normalized:!0}:{type:_s.UNSIGNED_BYTE,value:e,size:4,normalized:!0}}const PG=new Yr;function U3e(r,e){if(!e)return null;if(r.isOctEncoded16P){const t=new Float32Array(r.pointsLength*3);for(let n=0;n<r.pointsLength;n++)C3e(e[n*2],e[n*2+1],PG),PG.toArray(t,n*3);return{type:_s.FLOAT,size:2,value:t}}return{type:_s.FLOAT,size:2,value:e}}function N3e(r,e,t){return r.isQuantized?t["3d-tiles"]&&t["3d-tiles"].decodeQuantizedPositions?(r.isQuantized=!1,z3e(r,e)):{type:_s.UNSIGNED_SHORT,value:e,size:3,normalized:!0}:e}function z3e(r,e){const t=new Yr,n=new Float32Array(r.pointCount*3);for(let i=0;i<r.pointCount;i++)t.set(e[i*3],e[i*3+1],e[i*3+2]).scale(1/r.quantizedRange).multiply(r.quantizedVolumeScale).add(r.quantizedVolumeOffset).toArray(n,i*3);return n}async function H3e(r,e,t,n,i){t=bB(r,e,t),t=TF(r,e,t),t=SF(r,e,t),V3e(r);const{featureTable:s,batchTable:a}=G3e(r);return await K3e(r,s,a,n,i),Q3e(r,s,n),$3e(r,s,a),j3e(r,s),t}function V3e(r){r.attributes={positions:null,colors:null,normals:null,batchIds:null},r.isQuantized=!1,r.isTranslucent=!1,r.isRGB565=!1,r.isOctEncoded16P=!1}function G3e(r){const e=new CF(r.featureTableJson,r.featureTableBinary),t=e.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(t))throw new Error("POINTS_LENGTH must be defined");e.featuresLength=t,r.featuresLength=t,r.pointsLength=t,r.pointCount=t,r.rtcCenter=e.getGlobalProperty("RTC_CENTER",_s.FLOAT,3);const n=q3e(r,e);return{featureTable:e,batchTable:n}}function Q3e(r,e,t){if(!r.attributes.positions){if(e.hasProperty("POSITION"))r.attributes.positions=e.getPropertyArray("POSITION",_s.FLOAT,3);else if(e.hasProperty("POSITION_QUANTIZED")){const n=e.getPropertyArray("POSITION_QUANTIZED",_s.UNSIGNED_SHORT,3);if(r.isQuantized=!0,r.quantizedRange=65535,r.quantizedVolumeScale=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",_s.FLOAT,3),!r.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(r.quantizedVolumeOffset=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",_s.FLOAT,3),!r.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");r.attributes.positions=N3e(r,n,t)}}if(!r.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}function $3e(r,e,t){if(!r.attributes.colors){let n=null;e.hasProperty("RGBA")?(n=e.getPropertyArray("RGBA",_s.UNSIGNED_BYTE,4),r.isTranslucent=!0):e.hasProperty("RGB")?n=e.getPropertyArray("RGB",_s.UNSIGNED_BYTE,3):e.hasProperty("RGB565")&&(n=e.getPropertyArray("RGB565",_s.UNSIGNED_SHORT,1),r.isRGB565=!0),r.attributes.colors=MG(r,n,t)}e.hasProperty("CONSTANT_RGBA")&&(r.constantRGBA=e.getGlobalProperty("CONSTANT_RGBA",_s.UNSIGNED_BYTE,4))}function j3e(r,e){if(!r.attributes.normals){let t=null;e.hasProperty("NORMAL")?t=e.getPropertyArray("NORMAL",_s.FLOAT,3):e.hasProperty("NORMAL_OCT16P")&&(t=e.getPropertyArray("NORMAL_OCT16P",_s.UNSIGNED_BYTE,2),r.isOctEncoded16P=!0),r.attributes.normals=U3e(r,t)}}function q3e(r,e){let t=null;if(!r.batchIds&&e.hasProperty("BATCH_ID")&&(r.batchIds=e.getPropertyArray("BATCH_ID",_s.UNSIGNED_SHORT,1),r.batchIds)){const n=e.getGlobalProperty("BATCH_LENGTH");if(!n)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");const{batchTableJson:i,batchTableBinary:s}=r;t=new SG(i,s,n)}return t}async function K3e(r,e,t,n,i){let s,a,o;const h=r.batchTableJson&&r.batchTableJson.extensions&&r.batchTableJson.extensions["3DTILES_draco_point_compression"];h&&(o=h.properties);const f=e.getExtension("3DTILES_draco_point_compression");if(f){a=f.properties;const x=f.byteOffset,T=f.byteLength;if(!a||!Number.isFinite(x)||!T)throw new Error("Draco properties, byteOffset, and byteLength must be defined");s=r.featureTableBinary.slice(x,x+T),r.hasPositions=Number.isFinite(a.POSITION),r.hasColors=Number.isFinite(a.RGB)||Number.isFinite(a.RGBA),r.hasNormals=Number.isFinite(a.NORMAL),r.hasBatchIds=Number.isFinite(a.BATCH_ID),r.isTranslucent=Number.isFinite(a.RGBA)}if(!s)return!0;const _={buffer:s,properties:{...a,...o},featureTableProperties:a,batchTableProperties:o,dequantizeInShader:!1};return await W3e(r,_,n,i)}async function W3e(r,e,t,n){const{parse:i}=n,s={...t,draco:{...t.draco,extraAttributes:e.batchTableProperties||{}}};delete s["3d-tiles"];const a=await i(e.buffer,BG,s),o=a.attributes.POSITION&&a.attributes.POSITION.value,h=a.attributes.COLOR_0&&a.attributes.COLOR_0.value,f=a.attributes.NORMAL&&a.attributes.NORMAL.value,_=a.attributes.BATCH_ID&&a.attributes.BATCH_ID.value,x=o&&a.attributes.POSITION.value.quantization,T=f&&a.attributes.NORMAL.value.quantization;if(x){const N=a.POSITION.data.quantization,$=N.range;r.quantizedVolumeScale=new Yr($,$,$),r.quantizedVolumeOffset=new Yr(N.minValues),r.quantizedRange=(1<<N.quantizationBits)-1,r.isQuantizedDraco=!0}T&&(r.octEncodedRange=(1<<a.NORMAL.data.quantization.quantizationBits)-1,r.isOctEncodedDraco=!0);const I={};if(e.batchTableProperties)for(const N of Object.keys(e.batchTableProperties))a.attributes[N]&&a.attributes[N].value&&(I[N.toLowerCase()]=a.attributes[N].value);r.attributes={positions:o,colors:MG(r,h,void 0),normals:f,batchIds:_,...I}}const X3e="3.4.15",J3e="3.4.15",FG="3.4.15",Z3e="https://unpkg.com/@loaders.gl/textures@".concat(FG,"/dist/libs/basis_encoder.wasm"),Y3e="https://unpkg.com/@loaders.gl/textures@".concat(FG,"/dist/libs/basis_encoder.js");let IF;async function RG(r){const e=r.modules||{};return e.basis?e.basis:(IF=IF||eMe(r),await IF)}async function eMe(r){let e=null,t=null;return[e,t]=await Promise.all([await Og("basis_transcoder.js","textures",r),await Og("basis_transcoder.wasm","textures",r)]),e=e||globalThis.BASIS,await tMe(e,t)}function tMe(r,e){const t={};return e&&(t.wasmBinary=e),new Promise(n=>{r(t).then(i=>{const{BasisFile:s,initializeBasis:a}=i;a(),n({BasisFile:s})})})}let MF;async function LG(r){const e=r.modules||{};return e.basisEncoder?e.basisEncoder:(MF=MF||rMe(r),await MF)}async function rMe(r){let e=null,t=null;return[e,t]=await Promise.all([await Og(Y3e,"textures",r),await Og(Z3e,"textures",r)]),e=e||globalThis.BASIS,await nMe(e,t)}function nMe(r,e){const t={};return e&&(t.wasmBinary=e),new Promise(n=>{r(t).then(i=>{const{BasisFile:s,KTX2File:a,initializeBasis:o,BasisEncoder:h}=i;o(),n({BasisFile:s,KTX2File:a,BasisEncoder:h})})})}const w0={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35987,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,COMPRESSED_RGBA_ASTC_4X4_KHR:37808,COMPRESSED_RGBA_ASTC_5X4_KHR:37809,COMPRESSED_RGBA_ASTC_5X5_KHR:37810,COMPRESSED_RGBA_ASTC_6X5_KHR:37811,COMPRESSED_RGBA_ASTC_6X6_KHR:37812,COMPRESSED_RGBA_ASTC_8X5_KHR:37813,COMPRESSED_RGBA_ASTC_8X6_KHR:37814,COMPRESSED_RGBA_ASTC_8X8_KHR:37815,COMPRESSED_RGBA_ASTC_10X5_KHR:37816,COMPRESSED_RGBA_ASTC_10X6_KHR:37817,COMPRESSED_RGBA_ASTC_10X8_KHR:37818,COMPRESSED_RGBA_ASTC_10X10_KHR:37819,COMPRESSED_RGBA_ASTC_12X10_KHR:37820,COMPRESSED_RGBA_ASTC_12X12_KHR:37821,COMPRESSED_SRGB8_ALPHA8_ASTC_4X4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5X4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5X5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6X5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6X6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8X5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8X6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8X8_KHR:37847,COMPRESSED_SRGB8_ALPHA8_ASTC_10X5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10X6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10X8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_10X10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_12X10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12X12_KHR:37853,COMPRESSED_RED_RGTC1_EXT:36283,COMPRESSED_SIGNED_RED_RGTC1_EXT:36284,COMPRESSED_RED_GREEN_RGTC2_EXT:36285,COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT:36286,COMPRESSED_SRGB_S3TC_DXT1_EXT:35916,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:35919},iMe=["","WEBKIT_","MOZ_"],DG={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let vB=null;function sMe(r){if(!vB){r=r||oMe()||void 0,vB=new Set;for(const e of iMe)for(const t in DG)if(r&&r.getExtension("".concat(e).concat(t))){const n=DG[t];vB.add(n)}}return vB}function oMe(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}var OG,kG,UG,NG,zG,HG,VG,GG;(function(r){r[r.NONE=0]="NONE",r[r.BASISLZ=1]="BASISLZ",r[r.ZSTD=2]="ZSTD",r[r.ZLIB=3]="ZLIB"})(OG||(OG={})),function(r){r[r.BASICFORMAT=0]="BASICFORMAT"}(kG||(kG={})),function(r){r[r.UNSPECIFIED=0]="UNSPECIFIED",r[r.ETC1S=163]="ETC1S",r[r.UASTC=166]="UASTC"}(UG||(UG={})),function(r){r[r.UNSPECIFIED=0]="UNSPECIFIED",r[r.SRGB=1]="SRGB"}(NG||(NG={})),function(r){r[r.UNSPECIFIED=0]="UNSPECIFIED",r[r.LINEAR=1]="LINEAR",r[r.SRGB=2]="SRGB",r[r.ITU=3]="ITU",r[r.NTSC=4]="NTSC",r[r.SLOG=5]="SLOG",r[r.SLOG2=6]="SLOG2"}(zG||(zG={})),function(r){r[r.ALPHA_STRAIGHT=0]="ALPHA_STRAIGHT",r[r.ALPHA_PREMULTIPLIED=1]="ALPHA_PREMULTIPLIED"}(HG||(HG={})),function(r){r[r.RGB=0]="RGB",r[r.RRR=3]="RRR",r[r.GGG=4]="GGG",r[r.AAA=15]="AAA"}(VG||(VG={})),function(r){r[r.RGB=0]="RGB",r[r.RGBA=3]="RGBA",r[r.RRR=4]="RRR",r[r.RRRG=5]="RRRG"}(GG||(GG={}));const Fh=[171,75,84,88,32,50,48,187,13,10,26,10];function aMe(r){const e=new Uint8Array(r);return!(e.byteLength<Fh.length||e[0]!==Fh[0]||e[1]!==Fh[1]||e[2]!==Fh[2]||e[3]!==Fh[3]||e[4]!==Fh[4]||e[5]!==Fh[5]||e[6]!==Fh[6]||e[7]!==Fh[7]||e[8]!==Fh[8]||e[9]!==Fh[9]||e[10]!==Fh[10]||e[11]!==Fh[11])}const lMe={etc1:{basisFormat:0,compressed:!0,format:w0.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:w0.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:w0.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:w0.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:w0.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:w0.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function cMe(r,e){if(e.basis.containerFormat==="auto"){if(aMe(r)){const n=await LG(e);return QG(n.KTX2File,r,e)}const{BasisFile:t}=await RG(e);return PF(t,r,e)}switch(e.basis.module){case"encoder":const t=await LG(e);switch(e.basis.containerFormat){case"ktx2":return QG(t.KTX2File,r,e);case"basis":default:return PF(t.BasisFile,r,e)}case"transcoder":default:const{BasisFile:n}=await RG(e);return PF(n,r,e)}}function PF(r,e,t){const n=new r(new Uint8Array(e));try{if(!n.startTranscoding())throw new Error("Failed to start basis transcoding");const i=n.getNumImages(),s=[];for(let a=0;a<i;a++){const o=n.getNumLevels(a),h=[];for(let f=0;f<o;f++)h.push(uMe(n,a,f,t));s.push(h)}return s}finally{n.close(),n.delete()}}function uMe(r,e,t,n){const i=r.getImageWidth(e,t),s=r.getImageHeight(e,t),a=r.getHasAlpha(),{compressed:o,format:h,basisFormat:f}=$G(n,a),_=r.getImageTranscodedSizeInBytes(e,t,f),x=new Uint8Array(_);if(!r.transcodeImage(x,e,t,f,0,0))throw new Error("failed to start Basis transcoding");return{width:i,height:s,data:x,compressed:o,format:h,hasAlpha:a}}function QG(r,e,t){const n=new r(new Uint8Array(e));try{if(!n.startTranscoding())throw new Error("failed to start KTX2 transcoding");const i=n.getLevels(),s=[];for(let a=0;a<i;a++){s.push(hMe(n,a,t));break}return[s]}finally{n.close(),n.delete()}}function hMe(r,e,t){const{alphaFlag:n,height:i,width:s}=r.getImageLevelInfo(e,0,0),{compressed:a,format:o,basisFormat:h}=$G(t,n),f=r.getImageTranscodedSizeInBytes(e,0,0,h),_=new Uint8Array(f);if(!r.transcodeImage(_,e,0,0,h,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:s,height:i,data:_,compressed:a,levelSize:f,hasAlpha:n,format:o}}function $G(r,e){let t=r&&r.basis&&r.basis.format;return t==="auto"&&(t=jG()),typeof t=="object"&&(t=e?t.alpha:t.noAlpha),t=t.toLowerCase(),lMe[t]}function jG(){const r=sMe();return r.has("astc")?"astc-4x4":r.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:r.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:r.has("etc1")?"etc1":r.has("etc2")?"etc2":"rgb565"}const dMe={...{name:"Basis",id:gA?"basis":"basis-nodejs",module:"textures",version:J3e,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},parse:cMe},fMe="3.4.15",{_parseImageNode:AMe}=globalThis,FF=typeof Image<"u",RF=typeof ImageBitmap<"u",LF=Vw?!0:!!AMe;function pMe(r){switch(r){case"auto":return RF||FF||LF;case"imagebitmap":return RF;case"image":return FF;case"data":return LF;default:throw new Error("@loaders.gl/images: image ".concat(r," not supported in this environment"))}}function gMe(){if(RF)return"imagebitmap";if(FF)return"image";if(LF)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function mMe(r){const e=yMe(r);if(!e)throw new Error("Not an image");return e}function _Me(r){switch(mMe(r)){case"data":return r;case"image":case"imagebitmap":const e=document.createElement("canvas"),t=e.getContext("2d");if(!t)throw new Error("getImageData");return e.width=r.width,e.height=r.height,t.drawImage(r,0,0),t.getImageData(0,0,r.width,r.height);default:throw new Error("getImageData")}}function yMe(r){return typeof ImageBitmap<"u"&&r instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&r instanceof Image?"image":r&&typeof r=="object"&&r.data&&r.width&&r.height?"data":null}const bMe=/^data:image\/svg\+xml/,vMe=/\.svg((\?|#).*)?$/;function DF(r){return r&&(bMe.test(r)||vMe.test(r))}function xMe(r,e){if(DF(e)){let n=new TextDecoder().decode(r);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(n=unescape(encodeURIComponent(n)))}catch(s){throw new Error(s.message)}return"data:image/svg+xml;base64,".concat(btoa(n))}return qG(r,e)}function qG(r,e){if(DF(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(r)])}async function KG(r,e,t){const n=xMe(r,t),i=self.URL||self.webkitURL,s=typeof n!="string"&&i.createObjectURL(n);try{return await wMe(s||n,e)}finally{s&&i.revokeObjectURL(s)}}async function wMe(r,e){const t=new Image;return t.src=r,e.image&&e.image.decode&&t.decode?(await t.decode(),t):await new Promise((n,i)=>{try{t.onload=()=>n(t),t.onerror=s=>i(new Error("Could not load image ".concat(r,": ").concat(s)))}catch(s){i(s)}})}const BMe={};let WG=!0;async function CMe(r,e,t){let n;DF(t)?n=await KG(r,e,t):n=qG(r,t);const i=e&&e.imagebitmap;return await EMe(n,i)}async function EMe(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if((TMe(e)||!WG)&&(e=null),e)try{return await createImageBitmap(r,e)}catch(t){console.warn(t),WG=!1}return await createImageBitmap(r)}function TMe(r){for(const e in r||BMe)return!1;return!0}function SMe(r){return!FMe(r,"ftyp",4)||!(r[8]&96)?null:IMe(r)}function IMe(r){switch(MMe(r,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function MMe(r,e,t){return String.fromCharCode(...r.slice(e,t))}function PMe(r){return[...r].map(e=>e.charCodeAt(0))}function FMe(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const n=PMe(e);for(let i=0;i<n.length;++i)if(n[i]!==r[i+t])return!1;return!0}const Kf=!1,mb=!0;function OF(r){const e=_b(r);return LMe(e)||kMe(e)||DMe(e)||OMe(e)||RMe(e)}function RMe(r){const e=new Uint8Array(r instanceof DataView?r.buffer:r),t=SMe(e);return t?{mimeType:t.mimeType,width:0,height:0}:null}function LMe(r){const e=_b(r);return e.byteLength>=24&&e.getUint32(0,Kf)===2303741511?{mimeType:"image/png",width:e.getUint32(16,Kf),height:e.getUint32(20,Kf)}:null}function DMe(r){const e=_b(r);return e.byteLength>=10&&e.getUint32(0,Kf)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,mb),height:e.getUint16(8,mb)}:null}function OMe(r){const e=_b(r);return e.byteLength>=14&&e.getUint16(0,Kf)===16973&&e.getUint32(2,mb)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,mb),height:e.getUint32(22,mb)}:null}function kMe(r){const e=_b(r);if(!(e.byteLength>=3&&e.getUint16(0,Kf)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:n,sofMarkers:i}=UMe();let s=2;for(;s+9<e.byteLength;){const a=e.getUint16(s,Kf);if(i.has(a))return{mimeType:"image/jpeg",height:e.getUint16(s+5,Kf),width:e.getUint16(s+7,Kf)};if(!n.has(a))return null;s+=2,s+=e.getUint16(s,Kf)}return null}function UMe(){const r=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)r.add(t);return{tableMarkers:r,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function _b(r){if(r instanceof DataView)return r;if(ArrayBuffer.isView(r))return new DataView(r.buffer);if(r instanceof ArrayBuffer)return new DataView(r);throw new Error("toDataView")}async function NMe(r,e){const{mimeType:t}=OF(r)||{},n=globalThis._parseImageNode;return al(n),await n(r,t)}async function zMe(r,e,t){e=e||{};const i=(e.image||{}).type||"auto",{url:s}=t||{},a=HMe(i);let o;switch(a){case"imagebitmap":o=await CMe(r,e,s);break;case"image":o=await KG(r,e,s);break;case"data":o=await NMe(r);break;default:al(!1)}return i==="data"&&(o=_Me(o)),o}function HMe(r){switch(r){case"auto":case"data":return gMe();default:return pMe(r),r}}const VMe={id:"image",module:"images",name:"Images",version:fMe,mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],parse:zMe,tests:[r=>!!OF(new DataView(r))],options:{image:{type:"auto",decode:!0}}},kF={};function GMe(r){if(kF[r]===void 0){const e=Vw?$Me(r):QMe(r);kF[r]=e}return kF[r]}function QMe(r){const e=["image/png","image/jpeg","image/gif"],{_parseImageNode:t,_imageFormatsNode:n=e}=globalThis;return!!t&&n.includes(r)}function $Me(r){switch(r){case"image/avif":case"image/webp":return jMe(r);default:return!0}}function jMe(r){try{return document.createElement("canvas").toDataURL(r).indexOf("data:".concat(r))===0}catch{return!1}}function Rh(r,e){if(!r)throw new Error(e||"assert failed: gltf")}function XG(r,e){if(r.startsWith("data:")||r.startsWith("http:")||r.startsWith("https:"))return r;const n=e.baseUri||e.uri;if(!n)throw new Error("'baseUri' must be provided to resolve relative url ".concat(r));return n.substr(0,n.lastIndexOf("/")+1)+r}function qMe(r,e,t){const n=r.bufferViews[t];Rh(n);const i=n.buffer,s=e[i];Rh(s);const a=(n.byteOffset||0)+s.byteOffset;return new Uint8Array(s.arrayBuffer,a,n.byteLength)}const JG=["SCALAR","VEC2","VEC3","VEC4"],KMe=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],WMe=new Map(KMe),XMe={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},JMe={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},ZMe={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function ZG(r){return JG[r-1]||JG[0]}function YG(r){const e=WMe.get(r.constructor);if(!e)throw new Error("Illegal typed array");return e}function UF(r,e){const t=ZMe[r.componentType],n=XMe[r.type],i=JMe[r.componentType],s=r.count*n,a=r.count*n*i;return Rh(a>=0&&a<=e.byteLength),{ArrayType:t,length:s,byteLength:a}}function eQ(r){let{images:e,bufferViews:t}=r;e=e||[],t=t||[];const n=e.map(a=>a.bufferView);t=t.filter(a=>!n.includes(a));const i=t.reduce((a,o)=>a+o.byteLength,0),s=e.reduce((a,o)=>{const{width:h,height:f}=o.image;return a+h*f},0);return i+Math.ceil(4*s*1.33)}const YMe={asset:{version:"2.0",generator:"loaders.gl"},buffers:[]};class rh{constructor(e){cn(this,"gltf",void 0),cn(this,"sourceBuffers",void 0),cn(this,"byteLength",void 0),this.gltf=e||{json:{...YMe},buffers:[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(e){return this.json[e]}getExtraData(e){return(this.json.extras||{})[e]}getExtension(e){const t=this.getUsedExtensions().find(i=>i===e),n=this.json.extensions||{};return t?n[e]||!0:null}getRequiredExtension(e){return this.getRequiredExtensions().find(n=>n===e)?this.getExtension(e):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(e,t){return(e.extensions||{})[t]}getScene(e){return this.getObject("scenes",e)}getNode(e){return this.getObject("nodes",e)}getSkin(e){return this.getObject("skins",e)}getMesh(e){return this.getObject("meshes",e)}getMaterial(e){return this.getObject("materials",e)}getAccessor(e){return this.getObject("accessors",e)}getTexture(e){return this.getObject("textures",e)}getSampler(e){return this.getObject("samplers",e)}getImage(e){return this.getObject("images",e)}getBufferView(e){return this.getObject("bufferViews",e)}getBuffer(e){return this.getObject("buffers",e)}getObject(e,t){if(typeof t=="object")return t;const n=this.json[e]&&this.json[e][t];if(!n)throw new Error("glTF file error: Could not find ".concat(e,"[").concat(t,"]"));return n}getTypedArrayForBufferView(e){e=this.getBufferView(e);const t=e.buffer,n=this.gltf.buffers[t];Rh(n);const i=(e.byteOffset||0)+n.byteOffset;return new Uint8Array(n.arrayBuffer,i,e.byteLength)}getTypedArrayForAccessor(e){e=this.getAccessor(e);const t=this.getBufferView(e.bufferView),i=this.getBuffer(t.buffer).data,{ArrayType:s,length:a}=UF(e,t),o=t.byteOffset+e.byteOffset;return new s(i,o,a)}getTypedArrayForImageData(e){e=this.getAccessor(e);const t=this.getBufferView(e.bufferView),i=this.getBuffer(t.buffer).data,s=t.byteOffset||0;return new Uint8Array(i,s,t.byteLength)}addApplicationData(e,t){return this.json[e]=t,this}addExtraData(e,t){return this.json.extras=this.json.extras||{},this.json.extras[e]=t,this}addObjectExtension(e,t,n){return e.extensions=e.extensions||{},e.extensions[t]=n,this.registerUsedExtension(t),this}setObjectExtension(e,t,n){const i=e.extensions||{};i[t]=n}removeObjectExtension(e,t){const n=e.extensions||{},i=n[t];return delete n[t],i}addExtension(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Rh(t),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=t,this.registerUsedExtension(e),t}addRequiredExtension(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Rh(t),this.addExtension(e,t),this.registerRequiredExtension(e),t}registerUsedExtension(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(t=>t===e)||this.json.extensionsUsed.push(e)}registerRequiredExtension(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(t=>t===e)||this.json.extensionsRequired.push(e)}removeExtension(e){if(!this.getExtension(e))return;this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e),this.json.extensions&&delete this.json.extensions[e],Array.isArray(this.json.extensionsRemoved)||(this.json.extensionsRemoved=[]);const t=this.json.extensionsRemoved;t.includes(e)||t.push(e)}setDefaultScene(e){this.json.scene=e}addScene(e){const{nodeIndices:t}=e;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:t}),this.json.scenes.length-1}addNode(e){const{meshIndex:t,matrix:n}=e;this.json.nodes=this.json.nodes||[];const i={mesh:t};return n&&(i.matrix=n),this.json.nodes.push(i),this.json.nodes.length-1}addMesh(e){const{attributes:t,indices:n,material:i,mode:s=4}=e,o={primitives:[{attributes:this._addAttributes(t),mode:s}]};if(n){const h=this._addIndices(n);o.primitives[0].indices=h}return Number.isFinite(i)&&(o.primitives[0].material=i),this.json.meshes=this.json.meshes||[],this.json.meshes.push(o),this.json.meshes.length-1}addPointCloud(e){const n={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(n),this.json.meshes.length-1}addImage(e,t){const n=OF(e),i=t||(n==null?void 0:n.mimeType),a={bufferView:this.addBufferView(e),mimeType:i};return this.json.images=this.json.images||[],this.json.images.push(a),this.json.images.length-1}addBufferView(e){const t=e.byteLength;Rh(Number.isFinite(t)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);const n={buffer:0,byteOffset:this.byteLength,byteLength:t};return this.byteLength+=F1(t,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(n),this.json.bufferViews.length-1}addAccessor(e,t){const n={bufferView:e,type:ZG(t.size),componentType:t.componentType,count:t.count,max:t.max,min:t.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(n),this.json.accessors.length-1}addBinaryBuffer(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{size:3};const n=this.addBufferView(e);let i={min:t.min,max:t.max};(!i.min||!i.max)&&(i=this._getAccessorMinMax(e,t.size));const s={size:t.size,componentType:YG(e),count:Math.round(e.length/t.size),min:i.min,max:i.max};return this.addAccessor(n,Object.assign(s,t))}addTexture(e){const{imageIndex:t}=e,n={source:t};return this.json.textures=this.json.textures||[],this.json.textures.push(n),this.json.textures.length-1}addMaterial(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}createBinaryChunk(){var e,t;this.gltf.buffers=[];const n=this.byteLength,i=new ArrayBuffer(n),s=new Uint8Array(i);let a=0;for(const o of this.sourceBuffers||[])a=_fe(o,s,a);(e=this.json)!==null&&e!==void 0&&(t=e.buffers)!==null&&t!==void 0&&t[0]?this.json.buffers[0].byteLength=n:this.json.buffers=[{byteLength:n}],this.gltf.binary=i,this.sourceBuffers=[i]}_removeStringFromArray(e,t){let n=!0;for(;n;){const i=e.indexOf(t);i>-1?e.splice(i,1):n=!1}}_addAttributes(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t={};for(const n in e){const i=e[n],s=this._getGltfAttributeName(n),a=this.addBinaryBuffer(i.value,i);t[s]=a}return t}_addIndices(e){return this.addBinaryBuffer(e,{size:1})}_getGltfAttributeName(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return e}}_getAccessorMinMax(e,t){const n={min:null,max:null};if(e.length<t)return n;n.min=[],n.max=[];const i=e.subarray(0,t);for(const s of i)n.min.push(s),n.max.push(s);for(let s=t;s<e.length;s+=t)for(let a=0;a<t;a++)n.min[0+a]=Math.min(n.min[0+a],e[s+a]),n.max[0+a]=Math.max(n.max[0+a],e[s+a]);return n}}const ePe="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",tPe="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",rPe=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),nPe=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),iPe={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},sPe={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function oPe(r,e,t,n,i){let s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"NONE";const a=await aPe();uPe(a,a.exports[sPe[i]],r,e,t,n,a.exports[iPe[s||"NONE"]])}let NF;async function aPe(){return NF||(NF=lPe()),NF}async function lPe(){let r=ePe;WebAssembly.validate(rPe)&&(r=tPe,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const e=await WebAssembly.instantiate(cPe(r),{});return await e.instance.exports.__wasm_call_ctors(),e.instance}function cPe(r){const e=new Uint8Array(r.length);for(let n=0;n<r.length;++n){const i=r.charCodeAt(n);e[n]=i>96?i-71:i>64?i-65:i>47?i+4:i>46?63:62}let t=0;for(let n=0;n<r.length;++n)e[t++]=e[n]<60?nPe[e[n]]:(e[n]-60)*64+e[++n];return e.buffer.slice(0,t)}function uPe(r,e,t,n,i,s,a){const o=r.exports.sbrk,h=n+3&-4,f=o(h*i),_=o(s.length),x=new Uint8Array(r.exports.memory.buffer);x.set(s,_);const T=e(f,n,i,_,s.length);if(T===0&&a&&a(f,h,i),t.set(x.subarray(f,f+n*i)),o(f-o(0)),T!==0)throw new Error("Malformed buffer data: ".concat(T))}const zF="EXT_meshopt_compression",hPe=zF;async function dPe(r,e){var t;const n=new rh(r);if(!(e!=null&&(t=e.gltf)!==null&&t!==void 0&&t.decompressMeshes))return;const i=[];for(const s of r.json.bufferViews||[])i.push(fPe(n,s));await Promise.all(i),n.removeExtension(zF)}async function fPe(r,e){const t=r.getObjectExtension(e,zF);if(t){const{byteOffset:n=0,byteLength:i=0,byteStride:s,count:a,mode:o,filter:h="NONE",buffer:f}=t,_=r.gltf.buffers[f],x=new Uint8Array(_.arrayBuffer,_.byteOffset+n,i),T=new Uint8Array(r.gltf.buffers[e.buffer].arrayBuffer,e.byteOffset,e.byteLength);return await oPe(T,a,s,x,o,h),T}return null}const APe=Object.freeze(Object.defineProperty({__proto__:null,decode:dPe,name:hPe},Symbol.toStringTag,{value:"Module"})),B0="EXT_texture_webp",pPe=B0;function gPe(r,e){const t=new rh(r);if(!GMe("image/webp")){if(t.getRequiredExtensions().includes(B0))throw new Error("gltf: Required extension ".concat(B0," not supported by browser"));return}const{json:n}=t;for(const i of n.textures||[]){const s=t.getObjectExtension(i,B0);s&&(i.source=s.source),t.removeObjectExtension(i,B0)}t.removeExtension(B0)}const mPe=Object.freeze(Object.defineProperty({__proto__:null,name:pPe,preprocess:gPe},Symbol.toStringTag,{value:"Module"})),xB="KHR_texture_basisu",_Pe=xB;function yPe(r,e){const t=new rh(r),{json:n}=t;for(const i of n.textures||[]){const s=t.getObjectExtension(i,xB);s&&(i.source=s.source),t.removeObjectExtension(i,xB)}t.removeExtension(xB)}const bPe=Object.freeze(Object.defineProperty({__proto__:null,name:_Pe,preprocess:yPe},Symbol.toStringTag,{value:"Module"}));function vPe(r){const e={};for(const t in r){const n=r[t];if(t!=="indices"){const i=tQ(n);e[t]=i}}return e}function tQ(r){const{buffer:e,size:t,count:n}=xPe(r);return{value:e,size:t,byteOffset:0,count:n,type:ZG(t),componentType:YG(e)}}function xPe(r){let e=r,t=1,n=0;return r&&r.value&&(e=r.value,t=r.size||1),e&&(ArrayBuffer.isView(e)||(e=wPe(e,Float32Array)),n=e.length/t),{buffer:e,size:t,count:n}}function wPe(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return r?Array.isArray(r)?new e(r):t&&!(r instanceof e)?new e(r):r:null}const Jg="KHR_draco_mesh_compression",BPe=Jg;function CPe(r,e,t){const n=new rh(r);for(const i of rQ(n))n.getObjectExtension(i,Jg)}async function EPe(r,e,t){var n;if(!(e!=null&&(n=e.gltf)!==null&&n!==void 0&&n.decompressMeshes))return;const i=new rh(r),s=[];for(const a of rQ(i))i.getObjectExtension(a,Jg)&&s.push(SPe(i,a,e,t));await Promise.all(s),i.removeExtension(Jg)}function TPe(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const t=new rh(r);for(const n of t.json.meshes||[])IPe(n,e),t.addRequiredExtension(Jg)}async function SPe(r,e,t,n){const i=r.getObjectExtension(e,Jg);if(!i)return;const s=r.getTypedArrayForBufferView(i.bufferView),a=G3(s.buffer,s.byteOffset),{parse:o}=n,h={...t};delete h["3d-tiles"];const f=await o(a,BG,h,n),_=vPe(f.attributes);for(const[x,T]of Object.entries(_))if(x in e.attributes){const I=e.attributes[x],N=r.getAccessor(I);N!=null&&N.min&&N!==null&&N!==void 0&&N.max&&(T.min=N.min,T.max=N.max)}e.attributes=_,f.indices&&(e.indices=tQ(f.indices)),MPe(e)}function IPe(r,e){var t;let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:4,i=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0;if(!i.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const a=i.DracoWriter.encodeSync({attributes:r}),o=s==null||(t=s.parseSync)===null||t===void 0?void 0:t.call(s,{attributes:r}),h=i._addFauxAttributes(o.attributes),f=i.addBufferView(a);return{primitives:[{attributes:h,mode:n,extensions:{[Jg]:{bufferView:f,attributes:h}}}]}}function MPe(r){if(!r.attributes&&Object.keys(r.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*rQ(r){for(const e of r.json.meshes||[])for(const t of e.primitives)yield t}const PPe=Object.freeze(Object.defineProperty({__proto__:null,decode:EPe,encode:TPe,name:BPe,preprocess:CPe},Symbol.toStringTag,{value:"Module"})),FPe={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},RPe={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},HF="KHR_texture_transform",LPe=HF,wB=new Yr,DPe=new Da,OPe=new Da;async function kPe(r,e){if(!new rh(r).getExtension(HF))return;const i=r.json.materials||[];for(let s=0;s<i.length;s++)UPe(s,r)}function UPe(r,e){var t,n,i;const s=[],a=(t=e.json.materials)===null||t===void 0?void 0:t[r],o=a==null||(n=a.pbrMetallicRoughness)===null||n===void 0?void 0:n.baseColorTexture;o&&yb(e,r,o,s);const h=a==null?void 0:a.emissiveTexture;h&&yb(e,r,h,s);const f=a==null?void 0:a.normalTexture;f&&yb(e,r,f,s);const _=a==null?void 0:a.occlusionTexture;_&&yb(e,r,_,s);const x=a==null||(i=a.pbrMetallicRoughness)===null||i===void 0?void 0:i.metallicRoughnessTexture;x&&yb(e,r,x,s)}function yb(r,e,t,n){const i=NPe(t,n);if(!i)return;const s=r.json.meshes||[];for(const a of s)for(const o of a.primitives){const h=o.material;Number.isFinite(h)&&e===h&&zPe(r,o,i)}}function NPe(r,e){var t;const n=(t=r.extensions)===null||t===void 0?void 0:t[HF],{texCoord:i=0}=r,{texCoord:s=i}=n;if(!(e.findIndex(o=>{let[h,f]=o;return h===i&&f===s})!==-1)){const o=GPe(n);return i!==s&&(r.texCoord=s),e.push([i,s]),{originalTexCoord:i,texCoord:s,matrix:o}}return null}function zPe(r,e,t){const{originalTexCoord:n,texCoord:i,matrix:s}=t,a=e.attributes["TEXCOORD_".concat(n)];if(Number.isFinite(a)){var o;const f=(o=r.json.accessors)===null||o===void 0?void 0:o[a];if(f&&f.bufferView){var h;const _=(h=r.json.bufferViews)===null||h===void 0?void 0:h[f.bufferView];if(_){const{arrayBuffer:x,byteOffset:T}=r.buffers[_.buffer],I=(T||0)+(f.byteOffset||0)+(_.byteOffset||0),{ArrayType:N,length:$}=UF(f,_),W=RPe[f.componentType],Y=FPe[f.type],ie=_.byteStride||W*Y,ce=new Float32Array($);for(let fe=0;fe<f.count;fe++){const ve=new N(x,I+fe*ie,2);wB.set(ve[0],ve[1],1),wB.transformByMatrix3(s),ce.set([wB[0],wB[1]],fe*Y)}n===i?HPe(f,_,r.buffers,ce):VPe(i,f,e,r,ce)}}}}function HPe(r,e,t,n){r.componentType=5126,t.push({arrayBuffer:n.buffer,byteOffset:0,byteLength:n.buffer.byteLength}),e.buffer=t.length-1,e.byteLength=n.buffer.byteLength,e.byteOffset=0,delete e.byteStride}function VPe(r,e,t,n,i){n.buffers.push({arrayBuffer:i.buffer,byteOffset:0,byteLength:i.buffer.byteLength});const s=n.json.bufferViews;if(!s)return;s.push({buffer:n.buffers.length-1,byteLength:i.buffer.byteLength,byteOffset:0});const a=n.json.accessors;a&&(a.push({bufferView:(s==null?void 0:s.length)-1,byteOffset:0,componentType:5126,count:e.count,type:"VEC2"}),t.attributes["TEXCOORD_".concat(r)]=a.length-1)}function GPe(r){const{offset:e=[0,0],rotation:t=0,scale:n=[1,1]}=r,i=new Da().set(1,0,0,0,1,0,e[0],e[1],1),s=DPe.set(Math.cos(t),Math.sin(t),0,-Math.sin(t),Math.cos(t),0,0,0,1),a=OPe.set(n[0],0,0,0,n[1],0,0,0,1);return i.multiplyRight(s).multiplyRight(a)}const QPe=Object.freeze(Object.defineProperty({__proto__:null,decode:kPe,name:LPe},Symbol.toStringTag,{value:"Module"})),Zg="KHR_lights_punctual",$Pe=Zg;async function jPe(r){const e=new rh(r),{json:t}=e,n=e.getExtension(Zg);n&&(e.json.lights=n.lights,e.removeExtension(Zg));for(const i of t.nodes||[]){const s=e.getObjectExtension(i,Zg);s&&(i.light=s.light),e.removeObjectExtension(i,Zg)}}async function qPe(r){const e=new rh(r),{json:t}=e;if(t.lights){const n=e.addExtension(Zg);Rh(!n.lights),n.lights=t.lights,delete t.lights}if(e.json.lights){for(const n of e.json.lights){const i=n.node;e.addObjectExtension(i,Zg,n)}delete e.json.lights}}const KPe=Object.freeze(Object.defineProperty({__proto__:null,decode:jPe,encode:qPe,name:$Pe},Symbol.toStringTag,{value:"Module"})),bb="KHR_materials_unlit",WPe=bb;async function XPe(r){const e=new rh(r),{json:t}=e;for(const n of t.materials||[])n.extensions&&n.extensions.KHR_materials_unlit&&(n.unlit=!0),e.removeObjectExtension(n,bb);e.removeExtension(bb)}function JPe(r){const e=new rh(r),{json:t}=e;if(e.materials)for(const n of t.materials||[])n.unlit&&(delete n.unlit,e.addObjectExtension(n,bb,{}),e.addExtension(bb))}const ZPe=Object.freeze(Object.defineProperty({__proto__:null,decode:XPe,encode:JPe,name:WPe},Symbol.toStringTag,{value:"Module"})),vb="KHR_techniques_webgl",YPe=vb;async function eFe(r){const e=new rh(r),{json:t}=e,n=e.getExtension(vb);if(n){const i=rFe(n,e);for(const s of t.materials||[]){const a=e.getObjectExtension(s,vb);a&&(s.technique=Object.assign({},a,i[a.technique]),s.technique.values=nFe(s.technique,e)),e.removeObjectExtension(s,vb)}e.removeExtension(vb)}}async function tFe(r,e){}function rFe(r,e){const{programs:t=[],shaders:n=[],techniques:i=[]}=r,s=new TextDecoder;return n.forEach(a=>{if(Number.isFinite(a.bufferView))a.code=s.decode(e.getTypedArrayForBufferView(a.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),t.forEach(a=>{a.fragmentShader=n[a.fragmentShader],a.vertexShader=n[a.vertexShader]}),i.forEach(a=>{a.program=t[a.program]}),i}function nFe(r,e){const t=Object.assign({},r.values);return Object.keys(r.uniforms||{}).forEach(n=>{r.uniforms[n].value&&!(n in t)&&(t[n]=r.uniforms[n].value)}),Object.keys(t).forEach(n=>{typeof t[n]=="object"&&t[n].index!==void 0&&(t[n].texture=e.getTexture(t[n].index))}),t}const iFe=Object.freeze(Object.defineProperty({__proto__:null,decode:eFe,encode:tFe,name:YPe},Symbol.toStringTag,{value:"Module"})),nQ="EXT_feature_metadata",sFe=nQ;async function oFe(r){const e=new rh(r);aFe(e)}function aFe(r){var e;const t=r.getExtension(nQ),n=t==null||(e=t.schema)===null||e===void 0?void 0:e.classes,i=t==null?void 0:t.featureTables;if((t==null?void 0:t.featureTextures)&&console.warn('featureTextures is not yet supported in the "EXT_feature_metadata" extension.'),n&&i)for(const a in n){const o=n[a],h=uFe(i,a);h&&lFe(r,h,o)}}function lFe(r,e,t){for(const i in t.properties){var n;const s=t.properties[i],a=e==null||(n=e.properties)===null||n===void 0?void 0:n[i],o=e.count;if(a){const h=cFe(r,s,o,a);a.data=h}}}function cFe(r,e,t,n){const i=n.bufferView;let s=r.getTypedArrayForBufferView(i);switch(e.type){case"STRING":{const a=n.stringOffsetBufferView,o=r.getTypedArrayForBufferView(a);s=hFe(s,o,t);break}}return s}function uFe(r,e){for(const t in r){const n=r[t];if(n.class===e)return n}return null}function hFe(r,e,t){const n=[],i=new TextDecoder("utf8");let s=0;const a=4;for(let o=0;o<t;o++){const h=e[(o+1)*a]-e[o*a],f=r.subarray(s,h+s),_=i.decode(f);n.push(_),s+=h}return n}const iQ=[APe,mPe,bPe,PPe,KPe,ZPe,iFe,QPe,Object.freeze(Object.defineProperty({__proto__:null,decode:oFe,name:sFe},Symbol.toStringTag,{value:"Module"}))];function dFe(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=arguments.length>2?arguments[2]:void 0;const n=iQ.filter(s=>sQ(s.name,e));for(const s of n){var i;(i=s.preprocess)===null||i===void 0||i.call(s,r,e,t)}}async function fFe(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=arguments.length>2?arguments[2]:void 0;const n=iQ.filter(s=>sQ(s.name,e));for(const s of n){var i;await((i=s.decode)===null||i===void 0?void 0:i.call(s,r,e,t))}}function sQ(r,e){var t;const n=(e==null||(t=e.gltf)===null||t===void 0?void 0:t.excludeExtensions)||{};return!(r in n&&!n[r])}const VF="KHR_binary_glTF";function AFe(r){const e=new rh(r),{json:t}=e;for(const n of t.images||[]){const i=e.getObjectExtension(n,VF);i&&Object.assign(n,i),e.removeObjectExtension(n,VF)}t.buffers&&t.buffers[0]&&delete t.buffers[0].uri,e.removeExtension(VF)}const oQ={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},pFe={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class gFe{constructor(){cn(this,"idToIndexMap",{animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}}),cn(this,"json",void 0)}normalize(e,t){this.json=e.json;const n=e.json;switch(n.asset&&n.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn("glTF: Unknown version ".concat(n.asset.version));return}if(!t.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(n),this._convertTopLevelObjectsToArrays(n),AFe(e),this._convertObjectIdsToArrayIndices(n),this._updateObjects(n),this._updateMaterial(n)}_addAsset(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(e){for(const t in oQ)this._convertTopLevelObjectToArray(e,t)}_convertTopLevelObjectToArray(e,t){const n=e[t];if(!(!n||Array.isArray(n))){e[t]=[];for(const i in n){const s=n[i];s.id=s.id||i;const a=e[t].length;e[t].push(s),this.idToIndexMap[t][i]=a}}}_convertObjectIdsToArrayIndices(e){for(const t in oQ)this._convertIdsToIndices(e,t);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));for(const t of e.textures)this._convertTextureIds(t);for(const t of e.meshes)this._convertMeshIds(t);for(const t of e.nodes)this._convertNodeIds(t);for(const t of e.scenes)this._convertSceneIds(t)}_convertTextureIds(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}_convertMeshIds(e){for(const t of e.primitives){const{attributes:n,indices:i,material:s}=t;for(const a in n)n[a]=this._convertIdToIndex(n[a],"accessor");i&&(t.indices=this._convertIdToIndex(i,"accessor")),s&&(t.material=this._convertIdToIndex(s,"material"))}}_convertNodeIds(e){e.children&&(e.children=e.children.map(t=>this._convertIdToIndex(t,"node"))),e.meshes&&(e.meshes=e.meshes.map(t=>this._convertIdToIndex(t,"mesh")))}_convertSceneIds(e){e.nodes&&(e.nodes=e.nodes.map(t=>this._convertIdToIndex(t,"node")))}_convertIdsToIndices(e,t){e[t]||(console.warn("gltf v1: json doesn't contain attribute ".concat(t)),e[t]=[]);for(const n of e[t])for(const i in n){const s=n[i],a=this._convertIdToIndex(s,i);n[i]=a}}_convertIdToIndex(e,t){const n=pFe[t];if(n in this.idToIndexMap){const i=this.idToIndexMap[n][e];if(!Number.isFinite(i))throw new Error("gltf v1: failed to resolve ".concat(t," with id ").concat(e));return i}return e}_updateObjects(e){for(const t of this.json.buffers)delete t.type}_updateMaterial(e){for(const s of e.materials){var t,n,i;s.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const a=((t=s.values)===null||t===void 0?void 0:t.tex)||((n=s.values)===null||n===void 0?void 0:n.texture2d_0)||((i=s.values)===null||i===void 0?void 0:i.diffuseTex),o=e.textures.findIndex(h=>h.id===a);o!==-1&&(s.pbrMetallicRoughness.baseColorTexture={index:o})}}}function mFe(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new gFe().normalize(r,e)}const _Fe={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},yFe={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},fd={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},bFe={magFilter:fd.TEXTURE_MAG_FILTER,minFilter:fd.TEXTURE_MIN_FILTER,wrapS:fd.TEXTURE_WRAP_S,wrapT:fd.TEXTURE_WRAP_T},vFe={[fd.TEXTURE_MAG_FILTER]:fd.LINEAR,[fd.TEXTURE_MIN_FILTER]:fd.NEAREST_MIPMAP_LINEAR,[fd.TEXTURE_WRAP_S]:fd.REPEAT,[fd.TEXTURE_WRAP_T]:fd.REPEAT};function xFe(r){return yFe[r]}function wFe(r){return _Fe[r]}class BFe{constructor(){cn(this,"baseUri",""),cn(this,"json",{}),cn(this,"buffers",[]),cn(this,"images",[])}postProcess(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{json:n,buffers:i=[],images:s=[],baseUri:a=""}=e;return Rh(n),this.baseUri=a,this.json=n,this.buffers=i,this.images=s,this._resolveTree(this.json,t),this.json}_resolveTree(e){e.bufferViews&&(e.bufferViews=e.bufferViews.map((t,n)=>this._resolveBufferView(t,n))),e.images&&(e.images=e.images.map((t,n)=>this._resolveImage(t,n))),e.samplers&&(e.samplers=e.samplers.map((t,n)=>this._resolveSampler(t,n))),e.textures&&(e.textures=e.textures.map((t,n)=>this._resolveTexture(t,n))),e.accessors&&(e.accessors=e.accessors.map((t,n)=>this._resolveAccessor(t,n))),e.materials&&(e.materials=e.materials.map((t,n)=>this._resolveMaterial(t,n))),e.meshes&&(e.meshes=e.meshes.map((t,n)=>this._resolveMesh(t,n))),e.nodes&&(e.nodes=e.nodes.map((t,n)=>this._resolveNode(t,n))),e.skins&&(e.skins=e.skins.map((t,n)=>this._resolveSkin(t,n))),e.scenes&&(e.scenes=e.scenes.map((t,n)=>this._resolveScene(t,n))),e.scene!==void 0&&(e.scene=e.scenes[this.json.scene])}getScene(e){return this._get("scenes",e)}getNode(e){return this._get("nodes",e)}getSkin(e){return this._get("skins",e)}getMesh(e){return this._get("meshes",e)}getMaterial(e){return this._get("materials",e)}getAccessor(e){return this._get("accessors",e)}getCamera(e){return null}getTexture(e){return this._get("textures",e)}getSampler(e){return this._get("samplers",e)}getImage(e){return this._get("images",e)}getBufferView(e){return this._get("bufferViews",e)}getBuffer(e){return this._get("buffers",e)}_get(e,t){if(typeof t=="object")return t;const n=this.json[e]&&this.json[e][t];return n||console.warn("glTF file error: Could not find ".concat(e,"[").concat(t,"]")),n}_resolveScene(e,t){return e.id=e.id||"scene-".concat(t),e.nodes=(e.nodes||[]).map(n=>this.getNode(n)),e}_resolveNode(e,t){return e.id=e.id||"node-".concat(t),e.children&&(e.children=e.children.map(n=>this.getNode(n))),e.mesh!==void 0?e.mesh=this.getMesh(e.mesh):e.meshes!==void 0&&e.meshes.length&&(e.mesh=e.meshes.reduce((n,i)=>{const s=this.getMesh(i);return n.id=s.id,n.primitives=n.primitives.concat(s.primitives),n},{primitives:[]})),e.camera!==void 0&&(e.camera=this.getCamera(e.camera)),e.skin!==void 0&&(e.skin=this.getSkin(e.skin)),e}_resolveSkin(e,t){return e.id=e.id||"skin-".concat(t),e.inverseBindMatrices=this.getAccessor(e.inverseBindMatrices),e}_resolveMesh(e,t){return e.id=e.id||"mesh-".concat(t),e.primitives&&(e.primitives=e.primitives.map(n=>{n={...n};const i=n.attributes;n.attributes={};for(const s in i)n.attributes[s]=this.getAccessor(i[s]);return n.indices!==void 0&&(n.indices=this.getAccessor(n.indices)),n.material!==void 0&&(n.material=this.getMaterial(n.material)),n})),e}_resolveMaterial(e,t){if(e.id=e.id||"material-".concat(t),e.normalTexture&&(e.normalTexture={...e.normalTexture},e.normalTexture.texture=this.getTexture(e.normalTexture.index)),e.occlusionTexture&&(e.occlustionTexture={...e.occlustionTexture},e.occlusionTexture.texture=this.getTexture(e.occlusionTexture.index)),e.emissiveTexture&&(e.emmisiveTexture={...e.emmisiveTexture},e.emissiveTexture.texture=this.getTexture(e.emissiveTexture.index)),e.emissiveFactor||(e.emissiveFactor=e.emmisiveTexture?[1,1,1]:[0,0,0]),e.pbrMetallicRoughness){e.pbrMetallicRoughness={...e.pbrMetallicRoughness};const n=e.pbrMetallicRoughness;n.baseColorTexture&&(n.baseColorTexture={...n.baseColorTexture},n.baseColorTexture.texture=this.getTexture(n.baseColorTexture.index)),n.metallicRoughnessTexture&&(n.metallicRoughnessTexture={...n.metallicRoughnessTexture},n.metallicRoughnessTexture.texture=this.getTexture(n.metallicRoughnessTexture.index))}return e}_resolveAccessor(e,t){if(e.id=e.id||"accessor-".concat(t),e.bufferView!==void 0&&(e.bufferView=this.getBufferView(e.bufferView)),e.bytesPerComponent=xFe(e.componentType),e.components=wFe(e.type),e.bytesPerElement=e.bytesPerComponent*e.components,e.bufferView){const n=e.bufferView.buffer,{ArrayType:i,byteLength:s}=UF(e,e.bufferView),a=(e.bufferView.byteOffset||0)+(e.byteOffset||0)+n.byteOffset;let o=n.arrayBuffer.slice(a,a+s);e.bufferView.byteStride&&(o=this._getValueFromInterleavedBuffer(n,a,e.bufferView.byteStride,e.bytesPerElement,e.count)),e.value=new i(o)}return e}_getValueFromInterleavedBuffer(e,t,n,i,s){const a=new Uint8Array(s*i);for(let o=0;o<s;o++){const h=t+o*n;a.set(new Uint8Array(e.arrayBuffer.slice(h,h+i)),o*i)}return a.buffer}_resolveTexture(e,t){return e.id=e.id||"texture-".concat(t),e.sampler="sampler"in e?this.getSampler(e.sampler):vFe,e.source=this.getImage(e.source),e}_resolveSampler(e,t){e.id=e.id||"sampler-".concat(t),e.parameters={};for(const n in e){const i=this._enumSamplerParameter(n);i!==void 0&&(e.parameters[i]=e[n])}return e}_enumSamplerParameter(e){return bFe[e]}_resolveImage(e,t){e.id=e.id||"image-".concat(t),e.bufferView!==void 0&&(e.bufferView=this.getBufferView(e.bufferView));const n=this.images[t];return n&&(e.image=n),e}_resolveBufferView(e,t){const n=e.buffer,i={id:"bufferView-".concat(t),...e,buffer:this.buffers[n]},s=this.buffers[n].arrayBuffer;let a=this.buffers[n].byteOffset||0;return"byteOffset"in e&&(a+=e.byteOffset),i.data=new Uint8Array(s,a,e.byteLength),i}_resolveCamera(e,t){return e.id=e.id||"camera-".concat(t),e.perspective,e.orthographic,e}}function CFe(r,e){return new BFe().postProcess(r,e)}const aQ=1735152710,GF=12,BB=8,EFe=1313821514,TFe=5130562,SFe=0,IFe=1,MFe=0,C0=!0;function PFe(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return"".concat(String.fromCharCode(r.getUint8(e+0))).concat(String.fromCharCode(r.getUint8(e+1))).concat(String.fromCharCode(r.getUint8(e+2))).concat(String.fromCharCode(r.getUint8(e+3)))}function FFe(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const n=new DataView(r),{magic:i=aQ}=t,s=n.getUint32(e,!1);return s===i||s===aQ}function RFe(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const n=new DataView(e),i=PFe(n,t+0),s=n.getUint32(t+4,C0),a=n.getUint32(t+8,C0);switch(Object.assign(r,{header:{byteOffset:t,byteLength:a,hasBinChunk:!1},type:i,version:s,json:{},binChunks:[]}),t+=GF,r.version){case 1:return LFe(r,n,t);case 2:return DFe(r,n,t,{});default:throw new Error("Invalid GLB version ".concat(r.version,". Only supports v1 and v2."))}}function LFe(r,e,t){al(r.header.byteLength>GF+BB);const n=e.getUint32(t+0,C0),i=e.getUint32(t+4,C0);return t+=BB,al(i===MFe),QF(r,e,t,n),t+=n,t+=$F(r,e,t,r.header.byteLength),t}function DFe(r,e,t,n){return al(r.header.byteLength>GF+BB),OFe(r,e,t,n),t+r.header.byteLength}function OFe(r,e,t,n){for(;t+8<=r.header.byteLength;){const i=e.getUint32(t+0,C0),s=e.getUint32(t+4,C0);switch(t+=BB,s){case EFe:QF(r,e,t,i);break;case TFe:$F(r,e,t,i);break;case SFe:n.strict||QF(r,e,t,i);break;case IFe:n.strict||$F(r,e,t,i);break}t+=F1(i,4)}return t}function QF(r,e,t,n){const i=new Uint8Array(e.buffer,t,n),a=new TextDecoder("utf8").decode(i);return r.json=JSON.parse(a),F1(n,4)}function $F(r,e,t,n){return r.header.hasBinChunk=!0,r.binChunks.push({byteOffset:t,byteLength:n,arrayBuffer:e.buffer}),F1(n,4)}async function kFe(r,e){var t,n,i,s;let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,o=arguments.length>3?arguments[3]:void 0,h=arguments.length>4?arguments[4]:void 0;UFe(r,e,a,o),mFe(r,{normalize:o==null||(t=o.gltf)===null||t===void 0?void 0:t.normalize}),dFe(r,o,h);const f=[];if(o!=null&&(n=o.gltf)!==null&&n!==void 0&&n.loadBuffers&&r.json.buffers&&await NFe(r,o,h),o!=null&&(i=o.gltf)!==null&&i!==void 0&&i.loadImages){const x=zFe(r,o,h);f.push(x)}const _=fFe(r,o,h);return f.push(_),await Promise.all(f),o!=null&&(s=o.gltf)!==null&&s!==void 0&&s.postProcess?CFe(r,o):r}function UFe(r,e,t,n){if(n.uri&&(r.baseUri=n.uri),e instanceof ArrayBuffer&&!FFe(e,t,n)&&(e=new TextDecoder().decode(e)),typeof e=="string")r.json=pfe(e);else if(e instanceof ArrayBuffer){const a={};t=RFe(a,e,t,n.glb),Rh(a.type==="glTF","Invalid GLB magic string ".concat(a.type)),r._glb=a,r.json=a.json}else Rh(!1,"GLTF: must be ArrayBuffer or string");const i=r.json.buffers||[];if(r.buffers=new Array(i.length).fill(null),r._glb&&r._glb.header.hasBinChunk){const{binChunks:a}=r._glb;r.buffers[0]={arrayBuffer:a[0].arrayBuffer,byteOffset:a[0].byteOffset,byteLength:a[0].byteLength}}const s=r.json.images||[];r.images=new Array(s.length).fill({})}async function NFe(r,e,t){const n=r.json.buffers||[];for(let a=0;a<n.length;++a){const o=n[a];if(o.uri){var i,s;const{fetch:h}=t;Rh(h);const f=XG(o.uri,e),_=await(t==null||(i=t.fetch)===null||i===void 0?void 0:i.call(t,f)),x=await(_==null||(s=_.arrayBuffer)===null||s===void 0?void 0:s.call(_));r.buffers[a]={arrayBuffer:x,byteOffset:0,byteLength:x.byteLength},delete o.uri}else r.buffers[a]===null&&(r.buffers[a]={arrayBuffer:new ArrayBuffer(o.byteLength),byteOffset:0,byteLength:o.byteLength})}}async function zFe(r,e,t){const n=HFe(r),i=r.json.images||[],s=[];for(const a of n)s.push(VFe(r,i[a],a,e,t));return await Promise.all(s)}function HFe(r){const e=new Set,t=r.json.textures||[];for(const n of t)n.source!==void 0&&e.add(n.source);return Array.from(e).sort()}async function VFe(r,e,t,n,i){const{fetch:s,parse:a}=i;let o;if(e.uri&&!e.hasOwnProperty("bufferView")){const f=XG(e.uri,n);o=await(await s(f)).arrayBuffer(),e.bufferView={data:o}}if(Number.isFinite(e.bufferView)){const f=qMe(r.json,r.buffers,e.bufferView);o=G3(f.buffer,f.byteOffset,f.byteLength)}Rh(o,"glTF image has no data");let h=await a(o,[VMe,dMe],{mimeType:e.mimeType,basis:n.basis||{format:jG()}},i);h&&h[0]&&(h={compressed:!0,mipmaps:!1,width:h[0].width,height:h[0].height,data:h[0]}),r.images=r.images||[],r.images[t]=h}const CB={name:"glTF",id:"gltf",module:"gltf",version:X3e,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:GFe,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0,postProcess:!0},log:console},deprecatedOptions:{fetchImages:"gltf.loadImages",createImages:"gltf.loadImages",decompress:"gltf.decompressMeshes",postProcess:"gltf.postProcess",gltf:{decompress:"gltf.decompressMeshes"}}};async function GFe(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=arguments.length>2?arguments[2]:void 0;e={...CB.options,...e},e.gltf={...CB.options.gltf,...e.gltf};const{byteOffset:n=0}=e;return await kFe({},r,n,e,t)}const jF={URI:0,EMBEDDED:1};function lQ(r,e,t,n){r.rotateYtoZ=!0;const i=r.byteOffset+r.byteLength-t;if(i===0)throw new Error("glTF byte length must be greater than 0.");return r.gltfUpAxis=n["3d-tiles"]&&n["3d-tiles"].assetGltfUpAxis?n["3d-tiles"].assetGltfUpAxis:"Y",r.gltfArrayBuffer=G3(e,t,i),r.gltfByteOffset=0,r.gltfByteLength=i,t%4===0||console.warn("".concat(r.type,": embedded glb is not aligned to a 4-byte boundary.")),r.byteOffset+r.byteLength}async function cQ(r,e,t,n){const i=t["3d-tiles"]||{};if(QFe(r,e),i.loadGLTF){const{parse:s,fetch:a}=n;r.gltfUrl&&(r.gltfArrayBuffer=await a(r.gltfUrl,t),r.gltfByteOffset=0),r.gltfArrayBuffer&&(r.gltf=await s(r.gltfArrayBuffer,CB,t,n),r.gpuMemoryUsageInBytes=eQ(r.gltf),delete r.gltfArrayBuffer,delete r.gltfByteOffset,delete r.gltfByteLength)}}function QFe(r,e,t){switch(e){case jF.URI:const n=new Uint8Array(r.gltfArrayBuffer,r.gltfByteOffset),s=new TextDecoder().decode(n);r.gltfUrl=s.replace(/[\s\0]+$/,""),delete r.gltfArrayBuffer,delete r.gltfByteOffset,delete r.gltfByteLength;break;case jF.EMBEDDED:break;default:throw new Error("b3dm: Illegal glTF format field")}}async function $Fe(r,e,t,n,i){var s;t=jFe(r,e,t,n),await cQ(r,jF.EMBEDDED,n,i);const a=r==null||(s=r.gltf)===null||s===void 0?void 0:s.extensions;return a&&a.CESIUM_RTC&&(r.rtcCenter=a.CESIUM_RTC.center),t}function jFe(r,e,t,n,i){t=bB(r,e,t),t=TF(r,e,t),t=SF(r,e,t),t=lQ(r,e,t,n);const s=new CF(r.featureTableJson,r.featureTableBinary);return r.rtcCenter=s.getGlobalProperty("RTC_CENTER",_s.FLOAT,3),t}async function qFe(r,e,t,n,i){return t=KFe(r,e,t,n),await cQ(r,r.gltfFormat,n,i),t}function KFe(r,e,t,n,i){if(t=bB(r,e,t),r.version!==1)throw new Error("Instanced 3D Model version ".concat(r.version," is not supported"));t=TF(r,e,t);const s=new DataView(e);if(r.gltfFormat=s.getUint32(t,!0),t+=4,t=SF(r,e,t),t=lQ(r,e,t,n),r.featureTableJsonByteLength===0)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");const a=new CF(r.featureTableJson,r.featureTableBinary),o=a.getGlobalProperty("INSTANCES_LENGTH");if(a.featuresLength=o,!Number.isFinite(o))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");r.eastNorthUp=a.getGlobalProperty("EAST_NORTH_UP"),r.rtcCenter=a.getGlobalProperty("RTC_CENTER",_s.FLOAT,3);const h=new SG(r.batchTableJson,r.batchTableBinary,o);return WFe(r,a,h,o),t}function WFe(r,e,t,n){const s={instances:new Array(n),batchTable:r._batchTable,cull:!1,url:void 0,gltf:void 0,basePath:void 0,incrementallyLoadTextures:!1,forwardAxis:[1,0,0]}.instances,a=new Yr;new Yr,new Yr,new Yr;const o=new Da,h=new AF,f=new Yr,_={},x=new _0,T=[],I=[],N=new Yr,$=new Yr;for(let W=0;W<n;W++){let Y;if(e.hasProperty("POSITION"))Y=e.getProperty("POSITION",_s.FLOAT,3,W,a);else if(e.hasProperty("POSITION_QUANTIZED")){Y=e.getProperty("POSITION_QUANTIZED",_s.UNSIGNED_SHORT,3,W,a);const Qe=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",_s.FLOAT,3,N);if(!Qe)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const Ue=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",_s.FLOAT,3,$);if(!Ue)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const st=65535;for(let at=0;at<3;at++)Y[at]=Y[at]/st*Ue[at]+Qe[at]}if(!Y)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");if(a.copy(Y),_.translation=a,r.normalUp=e.getProperty("NORMAL_UP",_s.FLOAT,3,W,T),r.normalRight=e.getProperty("NORMAL_RIGHT",_s.FLOAT,3,W,I),r.normalUp){if(!r.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");r.hasCustomOrientation=!0}else{if(r.octNormalUp=e.getProperty("NORMAL_UP_OCT32P",_s.UNSIGNED_SHORT,2,T),r.octNormalRight=e.getProperty("NORMAL_RIGHT_OCT32P",_s.UNSIGNED_SHORT,2,I),r.octNormalUp)throw r.octNormalRight?new Error("i3dm: oct-encoded orientation not implemented"):new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");r.eastNorthUp?(dB.WGS84.eastNorthUpToFixedFrame(a,x),x.getRotationMatrix3(o)):o.identity()}h.fromMatrix3(o),_.rotation=h,f.set(1,1,1);const ie=e.getProperty("SCALE",_s.FLOAT,1,W);Number.isFinite(ie)&&f.multiplyByScalar(ie);const ce=e.getProperty("SCALE_NON_UNIFORM",_s.FLOAT,3,W,T);ce&&f.scale(ce),_.scale=f;let fe=e.getProperty("BATCH_ID",_s.UNSIGNED_SHORT,1,W);fe===void 0&&(fe=W);const ve=new _0().fromQuaternion(_.rotation);x.identity(),x.translate(_.translation),x.multiplyRight(ve),x.scale(_.scale);const be=x.clone();s[W]={modelMatrix:be,batchId:fe}}r.instances=s}async function XFe(r,e,t,n,i,s){t=bB(r,e,t);const a=new DataView(e);for(r.tilesLength=a.getUint32(t,!0),t+=4,r.tiles=[];r.tiles.length<r.tilesLength&&r.byteLength-t>12;){const o={};r.tiles.push(o),t=await s(e,t,n,i,o)}return t}async function JFe(r,e,t,n){r.rotateYtoZ=!0,r.gltfUpAxis=t["3d-tiles"]&&t["3d-tiles"].assetGltfUpAxis?t["3d-tiles"].assetGltfUpAxis:"Y";const{parse:i}=n;r.gltf=await i(e,CB,t,n),r.gpuMemoryUsageInBytes=eQ(r.gltf)}async function uQ(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};switch(i.byteOffset=e,i.type=VIe(r,e),i.type){case Ab.COMPOSITE:return await XFe(i,r,e,t,n,uQ);case Ab.BATCHED_3D_MODEL:return await $Fe(i,r,e,t,n);case Ab.GLTF:return await JFe(i,r,t,n);case Ab.INSTANCED_3D_MODEL:return await qFe(i,r,e,t,n);case Ab.POINT_CLOUD:return await H3e(i,r,e,t,n);default:throw new Error("3DTileLoader: unknown type ".concat(i.type))}}const ZFe=1952609651,YFe=1;async function eRe(r,e,t){if(new Uint32Array(r.slice(0,4))[0]!==ZFe)throw new Error("Wrong subtree file magic number");if(new Uint32Array(r.slice(4,8))[0]!==YFe)throw new Error("Wrong subtree file verson, must be 1");const s=hQ(r.slice(8,16)),a=new Uint8Array(r,24,s),h=new TextDecoder("utf8").decode(a),f=JSON.parse(h),_=hQ(r.slice(16,24));let x=new ArrayBuffer(0);return _&&(x=r.slice(24+s)),"bufferView"in f.tileAvailability&&(f.tileAvailability.explicitBitstream=await qF(f,"tileAvailability",x,t)),"bufferView"in f.contentAvailability&&(f.contentAvailability.explicitBitstream=await qF(f,"contentAvailability",x,t)),"bufferView"in f.childSubtreeAvailability&&(f.childSubtreeAvailability.explicitBitstream=await qF(f,"childSubtreeAvailability",x,t)),f}function tRe(r,e){if(e.startsWith("http")){const s=new URL(r,e);return decodeURI(s.toString())}const n="http://".concat(e),i=new URL(r,n);return"/".concat(i.host).concat(i.pathname)}async function qF(r,e,t,n){const i=r[e].bufferView,s=r.bufferViews[i],a=r.buffers[s.buffer];if(!(n!=null&&n.url)||!n.fetch)throw new Error("Url is not provided");if(!n.fetch)throw new Error("fetch is not provided");if(a.uri){const o=tRe(a.uri,n==null?void 0:n.url),f=await(await n.fetch(o)).arrayBuffer();return new Uint8Array(f,s.byteOffset,s.byteLength)}return new Uint8Array(t,s.byteOffset,s.byteLength)}function hQ(r){const e=new DataView(r),t=e.getUint32(0,!0),n=e.getUint32(4,!0);return t+2**32*n}const dQ={id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:fG,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:eRe,options:{}};/**
 * @license
 * Copyright 2009 The Closure Library Authors
 * Copyright 2020 Daniel Wirtz / The long.js Authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * SPDX-License-Identifier: Apache-2.0
 */var Ad=null;try{Ad=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function Ys(r,e,t){this.low=r|0,this.high=e|0,this.unsigned=!!t}Ys.prototype.__isLong__,Object.defineProperty(Ys.prototype,"__isLong__",{value:!0});function eu(r){return(r&&r.__isLong__)===!0}function fQ(r){var e=Math.clz32(r&-r);return r?31-e:e}Ys.isLong=eu;var AQ={},pQ={};function Yg(r,e){var t,n,i;return e?(r>>>=0,(i=0<=r&&r<256)&&(n=pQ[r],n)?n:(t=Ss(r,0,!0),i&&(pQ[r]=t),t)):(r|=0,(i=-128<=r&&r<128)&&(n=AQ[r],n)?n:(t=Ss(r,r<0?-1:0,!1),i&&(AQ[r]=t),t))}Ys.fromInt=Yg;function pd(r,e){if(isNaN(r))return e?xA:tf;if(e){if(r<0)return xA;if(r>=mQ)return xQ}else{if(r<=-_Q)return nh;if(r+1>=_Q)return vQ}return r<0?pd(-r,e).neg():Ss(r%E0|0,r/E0|0,e)}Ys.fromNumber=pd;function Ss(r,e,t){return new Ys(r,e,t)}Ys.fromBits=Ss;var EB=Math.pow;function KF(r,e,t){if(r.length===0)throw Error("empty string");if(typeof e=="number"?(t=e,e=!1):e=!!e,r==="NaN"||r==="Infinity"||r==="+Infinity"||r==="-Infinity")return e?xA:tf;if(t=t||10,t<2||36<t)throw RangeError("radix");var n;if((n=r.indexOf("-"))>0)throw Error("interior hyphen");if(n===0)return KF(r.substring(1),e,t).neg();for(var i=pd(EB(t,8)),s=tf,a=0;a<r.length;a+=8){var o=Math.min(8,r.length-a),h=parseInt(r.substring(a,a+o),t);if(o<8){var f=pd(EB(t,o));s=s.mul(f).add(pd(h))}else s=s.mul(i),s=s.add(pd(h))}return s.unsigned=e,s}Ys.fromString=KF;function ef(r,e){return typeof r=="number"?pd(r,e):typeof r=="string"?KF(r,e):Ss(r.low,r.high,typeof e=="boolean"?e:r.unsigned)}Ys.fromValue=ef;var gQ=65536,rRe=1<<24,E0=gQ*gQ,mQ=E0*E0,_Q=mQ/2,yQ=Yg(rRe),tf=Yg(0);Ys.ZERO=tf;var xA=Yg(0,!0);Ys.UZERO=xA;var T0=Yg(1);Ys.ONE=T0;var bQ=Yg(1,!0);Ys.UONE=bQ;var WF=Yg(-1);Ys.NEG_ONE=WF;var vQ=Ss(-1,2147483647,!1);Ys.MAX_VALUE=vQ;var xQ=Ss(-1,-1,!0);Ys.MAX_UNSIGNED_VALUE=xQ;var nh=Ss(0,-2147483648,!1);Ys.MIN_VALUE=nh;var An=Ys.prototype;An.toInt=function(){return this.unsigned?this.low>>>0:this.low},An.toNumber=function(){return this.unsigned?(this.high>>>0)*E0+(this.low>>>0):this.high*E0+(this.low>>>0)},An.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(nh)){var t=pd(e),n=this.div(t),i=n.mul(t).sub(this);return n.toString(e)+i.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var s=pd(EB(e,6),this.unsigned),a=this,o="";;){var h=a.div(s),f=a.sub(h.mul(s)).toInt()>>>0,_=f.toString(e);if(a=h,a.isZero())return _+o;for(;_.length<6;)_="0"+_;o=""+_+o}},An.getHighBits=function(){return this.high},An.getHighBitsUnsigned=function(){return this.high>>>0},An.getLowBits=function(){return this.low},An.getLowBitsUnsigned=function(){return this.low>>>0},An.getNumBitsAbs=function(){if(this.isNegative())return this.eq(nh)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&!(e&1<<t);t--);return this.high!=0?t+33:t+1},An.isZero=function(){return this.high===0&&this.low===0},An.eqz=An.isZero,An.isNegative=function(){return!this.unsigned&&this.high<0},An.isPositive=function(){return this.unsigned||this.high>=0},An.isOdd=function(){return(this.low&1)===1},An.isEven=function(){return(this.low&1)===0},An.equals=function(e){return eu(e)||(e=ef(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low},An.eq=An.equals,An.notEquals=function(e){return!this.eq(e)},An.neq=An.notEquals,An.ne=An.notEquals,An.lessThan=function(e){return this.comp(e)<0},An.lt=An.lessThan,An.lessThanOrEqual=function(e){return this.comp(e)<=0},An.lte=An.lessThanOrEqual,An.le=An.lessThanOrEqual,An.greaterThan=function(e){return this.comp(e)>0},An.gt=An.greaterThan,An.greaterThanOrEqual=function(e){return this.comp(e)>=0},An.gte=An.greaterThanOrEqual,An.ge=An.greaterThanOrEqual,An.compare=function(e){if(eu(e)||(e=ef(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},An.comp=An.compare,An.negate=function(){return!this.unsigned&&this.eq(nh)?nh:this.not().add(T0)},An.neg=An.negate,An.add=function(e){eu(e)||(e=ef(e));var t=this.high>>>16,n=this.high&65535,i=this.low>>>16,s=this.low&65535,a=e.high>>>16,o=e.high&65535,h=e.low>>>16,f=e.low&65535,_=0,x=0,T=0,I=0;return I+=s+f,T+=I>>>16,I&=65535,T+=i+h,x+=T>>>16,T&=65535,x+=n+o,_+=x>>>16,x&=65535,_+=t+a,_&=65535,Ss(T<<16|I,_<<16|x,this.unsigned)},An.subtract=function(e){return eu(e)||(e=ef(e)),this.add(e.neg())},An.sub=An.subtract,An.multiply=function(e){if(this.isZero())return this;if(eu(e)||(e=ef(e)),Ad){var t=Ad.mul(this.low,this.high,e.low,e.high);return Ss(t,Ad.get_high(),this.unsigned)}if(e.isZero())return this.unsigned?xA:tf;if(this.eq(nh))return e.isOdd()?nh:tf;if(e.eq(nh))return this.isOdd()?nh:tf;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(yQ)&&e.lt(yQ))return pd(this.toNumber()*e.toNumber(),this.unsigned);var n=this.high>>>16,i=this.high&65535,s=this.low>>>16,a=this.low&65535,o=e.high>>>16,h=e.high&65535,f=e.low>>>16,_=e.low&65535,x=0,T=0,I=0,N=0;return N+=a*_,I+=N>>>16,N&=65535,I+=s*_,T+=I>>>16,I&=65535,I+=a*f,T+=I>>>16,I&=65535,T+=i*_,x+=T>>>16,T&=65535,T+=s*f,x+=T>>>16,T&=65535,T+=a*h,x+=T>>>16,T&=65535,x+=n*_+i*f+s*h+a*o,x&=65535,Ss(I<<16|N,x<<16|T,this.unsigned)},An.mul=An.multiply,An.divide=function(e){if(eu(e)||(e=ef(e)),e.isZero())throw Error("division by zero");if(Ad){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?Ad.div_u:Ad.div_s)(this.low,this.high,e.low,e.high);return Ss(t,Ad.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?xA:tf;var n,i,s;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return xA;if(e.gt(this.shru(1)))return bQ;s=xA}else{if(this.eq(nh)){if(e.eq(T0)||e.eq(WF))return nh;if(e.eq(nh))return T0;var a=this.shr(1);return n=a.div(e).shl(1),n.eq(tf)?e.isNegative()?T0:WF:(i=this.sub(e.mul(n)),s=n.add(i.div(e)),s)}else if(e.eq(nh))return this.unsigned?xA:tf;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();s=tf}for(i=this;i.gte(e);){n=Math.max(1,Math.floor(i.toNumber()/e.toNumber()));for(var o=Math.ceil(Math.log(n)/Math.LN2),h=o<=48?1:EB(2,o-48),f=pd(n),_=f.mul(e);_.isNegative()||_.gt(i);)n-=h,f=pd(n,this.unsigned),_=f.mul(e);f.isZero()&&(f=T0),s=s.add(f),i=i.sub(_)}return s},An.div=An.divide,An.modulo=function(e){if(eu(e)||(e=ef(e)),Ad){var t=(this.unsigned?Ad.rem_u:Ad.rem_s)(this.low,this.high,e.low,e.high);return Ss(t,Ad.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))},An.mod=An.modulo,An.rem=An.modulo,An.not=function(){return Ss(~this.low,~this.high,this.unsigned)},An.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},An.clz=An.countLeadingZeros,An.countTrailingZeros=function(){return this.low?fQ(this.low):fQ(this.high)+32},An.ctz=An.countTrailingZeros,An.and=function(e){return eu(e)||(e=ef(e)),Ss(this.low&e.low,this.high&e.high,this.unsigned)},An.or=function(e){return eu(e)||(e=ef(e)),Ss(this.low|e.low,this.high|e.high,this.unsigned)},An.xor=function(e){return eu(e)||(e=ef(e)),Ss(this.low^e.low,this.high^e.high,this.unsigned)},An.shiftLeft=function(e){return eu(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Ss(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):Ss(0,this.low<<e-32,this.unsigned)},An.shl=An.shiftLeft,An.shiftRight=function(e){return eu(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Ss(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):Ss(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},An.shr=An.shiftRight,An.shiftRightUnsigned=function(e){return eu(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Ss(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):e===32?Ss(this.high,0,this.unsigned):Ss(this.high>>>e-32,0,this.unsigned)},An.shru=An.shiftRightUnsigned,An.shr_u=An.shiftRightUnsigned,An.rotateLeft=function(e){var t;return eu(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?Ss(this.high,this.low,this.unsigned):e<32?(t=32-e,Ss(this.low<<e|this.high>>>t,this.high<<e|this.low>>>t,this.unsigned)):(e-=32,t=32-e,Ss(this.high<<e|this.low>>>t,this.low<<e|this.high>>>t,this.unsigned))},An.rotl=An.rotateLeft,An.rotateRight=function(e){var t;return eu(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?Ss(this.high,this.low,this.unsigned):e<32?(t=32-e,Ss(this.high<<t|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned)):(e-=32,t=32-e,Ss(this.low<<t|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned))},An.rotr=An.rotateRight,An.toSigned=function(){return this.unsigned?Ss(this.low,this.high,!1):this},An.toUnsigned=function(){return this.unsigned?this:Ss(this.low,this.high,!0)},An.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},An.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]},An.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]},Ys.fromBytes=function(e,t,n){return n?Ys.fromBytesLE(e,t):Ys.fromBytesBE(e,t)},Ys.fromBytesLE=function(e,t){return new Ys(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},Ys.fromBytesBE=function(e,t){return new Ys(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};const nRe=16;function wQ(r){r==="X"&&(r="");const e=r.padEnd(nRe,"0");return Ys.fromString(e,!0,16)}function iRe(r){if(r.isZero())return"X";let e=r.countTrailingZeros();const t=e%4;e=(e-t)/4;const n=e;e*=4;const s=r.shiftRightUnsigned(e).toString(16).replace(/0+$/,"");return Array(17-n-s.length).join("0")+s}function sRe(r,e){const t=oRe(r).shiftRightUnsigned(2);return r.add(Ys.fromNumber(2*e+1-4).multiply(t))}function oRe(r){return r.and(r.not().add(1))}const aRe=3,lRe=2*30+1,BQ=180/Math.PI;function cRe(r){if(r.length===0)throw new Error("Invalid Hilbert quad key ".concat(r));const e=r.split("/"),t=parseInt(e[0],10),n=e[1],i=n.length;let s=0;const a=[0,0];for(let o=i-1;o>=0;o--){s=i-o;const h=n[o];let f=0,_=0;h==="1"?_=1:h==="2"?(f=1,_=1):h==="3"&&(f=1);const x=Math.pow(2,s-1);hRe(x,a,f,_),a[0]+=x*f,a[1]+=x*_}if(t%2===1){const o=a[0];a[0]=a[1],a[1]=o}return{face:t,ij:a,level:s}}function uRe(r){if(r.isZero())return"";let e=r.toString(2);for(;e.length<aRe+lRe;)e="0"+e;const t=e.lastIndexOf("1"),n=e.substring(0,3),i=e.substring(3,t),s=i.length/2,a=Ys.fromString(n,!0,2).toString(10);let o="";if(s!==0)for(o=Ys.fromString(i,!0,2).toString(4);o.length<s;)o="0"+o;return"".concat(a,"/").concat(o)}function CQ(r,e,t){const n=1<<e;return[(r[0]+t[0])/n,(r[1]+t[1])/n]}function EQ(r){return r>=.5?1/3*(4*r*r-1):1/3*(1-4*(1-r)*(1-r))}function TQ(r){return[EQ(r[0]),EQ(r[1])]}function SQ(r,e){let[t,n]=e;switch(r){case 0:return[1,t,n];case 1:return[-t,1,n];case 2:return[-t,-n,1];case 3:return[-1,-n,-t];case 4:return[n,-1,-t];case 5:return[n,t,-1];default:throw new Error("Invalid face")}}function IQ(r){let[e,t,n]=r;const i=Math.atan2(n,Math.sqrt(e*e+t*t));return[Math.atan2(t,e)*BQ,i*BQ]}function hRe(r,e,t,n){if(n===0){t===1&&(e[0]=r-1-e[0],e[1]=r-1-e[1]);const i=e[0];e[0]=e[1],e[1]=i}}function dRe(r){const e=CQ(r.ij,r.level,[.5,.5]),t=TQ(e),n=SQ(r.face,t);return IQ(n)}const fRe=100;function MQ(r){const{face:e,ij:t,level:n}=r,i=[[0,0],[0,1],[1,1],[1,0],[0,0]],s=Math.max(1,Math.ceil(fRe*Math.pow(2,-n))),a=new Float64Array(4*s*2+2);let o=0,h=0;for(let f=0;f<4;f++){const _=i[f].slice(0),x=i[f+1],T=(x[0]-_[0])/s,I=(x[1]-_[1])/s;for(let N=0;N<s;N++){_[0]+=T,_[1]+=I;const $=CQ(t,n,_),W=TQ($),Y=SQ(e,W),ie=IQ(Y);Math.abs(ie[1])>89.999&&(ie[0]=h);const ce=ie[0]-h;ie[0]+=ce>180?-360:ce<-180?360:0,a[o++]=ie[0],a[o++]=ie[1],h=ie[0]}}return a[o++]=a[0],a[o++]=a[1],a}function XF(r){const e=ARe(r);return cRe(e)}function ARe(r){if(r.indexOf("/")>0)return r;const e=wQ(r);return uRe(e)}function pRe(r){const e=XF(r);return dRe(e)}function gRe(r){let e;if(r.face===2||r.face===5){let t=null,n=0;for(let i=0;i<4;i++){const s="".concat(r.face,"/").concat(i),a=XF(s),o=MQ(a);(typeof t>"u"||t===null)&&(t=new Float64Array(4*o.length)),t.set(o,n),n+=o.length}e=PQ(t)}else{const t=MQ(r);e=PQ(t)}return e}function PQ(r){if(r.length%2!==0)throw new Error("Invalid corners");const e=[],t=[];for(let n=0;n<r.length;n+=2)e.push(r[n]),t.push(r[n+1]);return e.sort((n,i)=>n-i),t.sort((n,i)=>n-i),{west:e[0],east:e[e.length-1],north:t[t.length-1],south:t[0]}}function mRe(r,e){const t=(e==null?void 0:e.minimumHeight)||0,n=(e==null?void 0:e.maximumHeight)||0,i=XF(r),s=gRe(i),a=s.west,o=s.south,h=s.east,f=s.north,_=[];return _.push(new Yr(a,f,t)),_.push(new Yr(h,f,t)),_.push(new Yr(h,o,t)),_.push(new Yr(a,o,t)),_.push(new Yr(a,f,n)),_.push(new Yr(h,f,n)),_.push(new Yr(h,o,n)),_.push(new Yr(a,o,n)),_}function FQ(r){const e=r.token,t={minimumHeight:r.minimumHeight,maximumHeight:r.maximumHeight},n=mRe(e,t),i=pRe(e),s=i[0],a=i[1],o=dB.WGS84.cartographicToCartesian([s,a,t.maximumHeight]),h=new Yr(o[0],o[1],o[2]);n.push(h);const f=zIe(n);return[...f.center,...f.halfAxes]}const _Re={QUADTREE:4,OCTREE:8};function yRe(r,e,t){if(r!=null&&r.box){const n=wQ(r.s2VolumeInfo.token),i=sRe(n,e),s=iRe(i),a={...r.s2VolumeInfo};switch(a.token=s,t){case"OCTREE":const f=r.s2VolumeInfo,_=f.maximumHeight-f.minimumHeight,x=_/2,T=f.minimumHeight+_/2;f.minimumHeight=T-x,f.maximumHeight=T+x;break}return{box:FQ(a),s2VolumeInfo:a}}}async function RQ(r){const{options:e,parentData:t={mortonIndex:0,x:0,y:0,z:0},childIndex:n=0,globalData:i={level:0,mortonIndex:0,x:0,y:0,z:0},s2VolumeBox:s}=r;let{subtree:a,level:o=0}=r;const{subdivisionScheme:h,subtreeLevels:f,maximumLevel:_,contentUrlTemplate:x,subtreesUriTemplate:T,basePath:I}=e,N={children:[],lodMetricValue:0,contentUrl:""},$=_Re[h],W=n&1,Y=n>>1&1,ie=n>>2&1,ce=($**o-1)/($-1);let fe=em(t.mortonIndex,n),ve=ce+fe,be=em(t.x,W),Qe=em(t.y,Y),Ue=em(t.z,ie),st=!1;o+1>f&&(st=JF(a.childSubtreeAvailability,fe));const at=em(i.x,be),Le=em(i.y,Qe),ze=em(i.z,Ue),tt=o+i.level;if(st){const Kt="".concat(I,"/").concat(T),er=ZF(Kt,tt,at,Le,ze);a=await Ng(er,dQ),i.mortonIndex=fe,i.x=be,i.y=Qe,i.z=Ue,i.level=o,fe=0,ve=0,be=0,Qe=0,Ue=0,o=0}if(!JF(a.tileAvailability,ve)||o>_)return N;JF(a.contentAvailability,ve)&&(N.contentUrl=ZF(x,tt,at,Le,ze));const Vt=o+1,Jt={mortonIndex:fe,x:be,y:Qe,z:Ue};for(let Kt=0;Kt<$;Kt++){const er=yRe(s,Kt,h),Xt=await RQ({subtree:a,options:e,parentData:Jt,childIndex:Kt,level:Vt,globalData:i,s2VolumeBox:er});if(Xt.contentUrl||Xt.children.length){const Fr=tt+1,ut=bRe(Xt,Fr,{childTileX:be,childTileY:Qe,childTileZ:Ue},e,s);N.children.push(ut)}}return N}function JF(r,e){return"constant"in r?!!r.constant:r.explicitBitstream?wRe(e,r.explicitBitstream):!1}function bRe(r,e,t,n,i){const{basePath:s,refine:a,getRefine:o,lodMetricType:h,getTileType:f,rootLodMetricValue:_,rootBoundingVolume:x}=n,T=r.contentUrl&&r.contentUrl.replace("".concat(s,"/"),""),I=_/2**e,N=i!=null&&i.box?{box:i.box}:x,$=vRe(e,N,t);return{children:r.children,contentUrl:r.contentUrl,content:{uri:T},id:r.contentUrl,refine:o(a),type:f(r),lodMetricType:h,lodMetricValue:I,geometricError:I,transform:r.transform,boundingVolume:$}}function vRe(r,e,t){if(e.region){const{childTileX:n,childTileY:i,childTileZ:s}=t,[a,o,h,f,_,x]=e.region,T=2**r,I=(h-a)/T,N=(f-o)/T,$=(x-_)/T,[W,Y]=[a+I*n,a+I*(n+1)],[ie,ce]=[o+N*i,o+N*(i+1)],[fe,ve]=[_+$*s,_+$*(s+1)];return{region:[W,ie,Y,ce,fe,ve]}}if(e.box)return e;throw new Error("Unsupported bounding volume type ".concat(e))}function em(r,e){return parseInt(r.toString(2)+e.toString(2),2)}function ZF(r,e,t,n,i){const s=xRe({level:e,x:t,y:n,z:i});return r.replace(/{level}|{x}|{y}|{z}/gi,a=>s[a])}function xRe(r){const e={};for(const t in r)e["{".concat(t,"}")]=r[t];return e}function wRe(r,e){const t=Math.floor(r/8),n=r%8;return(e[t]>>n&1)===1}function YF(r){if(!r.contentUrl)return bF.EMPTY;const t=r.contentUrl.split("?")[0].split(".").pop();switch(t){case"pnts":return bF.POINTCLOUD;case"i3dm":case"b3dm":case"glb":case"gltf":return bF.SCENEGRAPH;default:return t}}function eR(r){switch(r){case"REPLACE":case"replace":return dG.REPLACE;case"ADD":case"add":return dG.ADD;default:return r}}function tR(r,e){if(/^[a-z][0-9a-z+.-]*:/i.test(e)){const n=new URL(r,"".concat(e,"/"));return decodeURI(n.toString())}else if(r.startsWith("/"))return r;return"".concat(e,"/").concat(r)}function LQ(r,e){if(!r)return null;if(r.content){const t=r.content.uri||r.content.url;r.contentUrl=tR(t,e.basePath)}return r.id=r.contentUrl,r.lodMetricType=mB.GEOMETRIC_ERROR,r.lodMetricValue=r.geometricError,r.transformMatrix=r.transform,r.type=YF(r),r.refine=eR(r.refine),r}async function BRe(r,e){const t=r.basePath;let n;const i=OQ(r==null?void 0:r.root);i&&r.root?n=await DQ(r.root,r,i,e):n=LQ(r.root,r);const s=[];for(s.push(n);s.length>0;){const o=(s.pop()||{}).children||[];for(let h of o){const f=OQ(h);f?h=await DQ(h,r,f,e):LQ(h,{basePath:t}),s.push(h)}}return n}async function DQ(r,e,t,n){var i,s;const a=e.basePath,{subdivisionScheme:o,maximumLevel:h,subtreeLevels:f,subtrees:{uri:_}}=t,x=ZF(_,0,0,0,0),T=tR(x,a),I=await Ng(T,dQ,n),N=tR(r.content.uri,a),$=e==null||(i=e.root)===null||i===void 0?void 0:i.refine,W=r.geometricError,Y=(s=r.boundingVolume.extensions)===null||s===void 0?void 0:s["3DTILES_bounding_volume_S2"];if(Y){const ve={box:FQ(Y),s2VolumeInfo:Y};r.boundingVolume=ve}const ie=r.boundingVolume,ce={contentUrlTemplate:N,subtreesUriTemplate:_,subdivisionScheme:o,subtreeLevels:f,maximumLevel:h,refine:$,basePath:a,lodMetricType:mB.GEOMETRIC_ERROR,rootLodMetricValue:W,rootBoundingVolume:ie,getTileType:YF,getRefine:eR};return await CRe(r,I,ce)}async function CRe(r,e,t){if(!r)return null;r.lodMetricType=mB.GEOMETRIC_ERROR,r.lodMetricValue=r.geometricError,r.transformMatrix=r.transform;const{children:n,contentUrl:i}=await RQ({subtree:e,options:t,s2VolumeBox:r});return i&&(r.contentUrl=i,r.content={uri:i.replace("".concat(t.basePath,"/"),"")}),r.refine=eR(r.refine),r.type=YF(r),r.children=n,r.id=r.contentUrl,r}function OQ(r){var e;return(r==null||(e=r.extensions)===null||e===void 0?void 0:e["3DTILES_implicit_tiling"])||(r==null?void 0:r.implicitTiling)}const kQ={id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:fG,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:IRe,options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}};function ERe(r){return i8(r.url)}async function TRe(r,e,t){const n={content:{featureIds:null}};return await uQ(r,0,e,t,n.content),n.content}async function SRe(r,e,t){var n;const i=JSON.parse(new TextDecoder().decode(r));return i.loader=e.loader||kQ,i.url=t.url,i.queryString=t.queryString,i.basePath=ERe(i),i.root=await BRe(i,e),i.type=HIe.TILES3D,i.lodMetricType=mB.GEOMETRIC_ERROR,i.lodMetricValue=((n=i.root)===null||n===void 0?void 0:n.lodMetricValue)||0,i}async function IRe(r,e,t){const n=e["3d-tiles"]||{};let i;return n.isTileset==="auto"?i=t.url&&t.url.indexOf(".json")!==-1:i=n.isTileset,i?r=await SRe(r,e,t):r=await TRe(r,e,t),r}var UQ={exports:{}};(function(r,e){(function(t,n){r.exports=n()})(Il,function(){var t={},n={};function i(a,o,h){if(n[a]=h,a==="index"){var f="var sharedModule = {}; ("+n.shared+")(sharedModule); ("+n.worker+")(sharedModule);",_={};return n.shared(_),n.index(t,_),typeof window<"u"&&t.setWorkerUrl(window.URL.createObjectURL(new Blob([f],{type:"text/javascript"}))),t}}i("shared",["exports"],function(a){function o(g,d,b,C){return new(b||(b=Promise))(function(R,U){function V(le){try{ee(C.next(le))}catch(_e){U(_e)}}function K(le){try{ee(C.throw(le))}catch(_e){U(_e)}}function ee(le){var _e;le.done?R(le.value):(_e=le.value,_e instanceof b?_e:new b(function(Be){Be(_e)})).then(V,K)}ee((C=C.apply(g,d||[])).next())})}function h(g){return g&&g.__esModule&&Object.prototype.hasOwnProperty.call(g,"default")?g.default:g}typeof SuppressedError=="function"&&SuppressedError;var f=_;function _(g,d){this.x=g,this.y=d}_.prototype={clone:function(){return new _(this.x,this.y)},add:function(g){return this.clone()._add(g)},sub:function(g){return this.clone()._sub(g)},multByPoint:function(g){return this.clone()._multByPoint(g)},divByPoint:function(g){return this.clone()._divByPoint(g)},mult:function(g){return this.clone()._mult(g)},div:function(g){return this.clone()._div(g)},rotate:function(g){return this.clone()._rotate(g)},rotateAround:function(g,d){return this.clone()._rotateAround(g,d)},matMult:function(g){return this.clone()._matMult(g)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(g){return this.x===g.x&&this.y===g.y},dist:function(g){return Math.sqrt(this.distSqr(g))},distSqr:function(g){var d=g.x-this.x,b=g.y-this.y;return d*d+b*b},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(g){return Math.atan2(this.y-g.y,this.x-g.x)},angleWith:function(g){return this.angleWithSep(g.x,g.y)},angleWithSep:function(g,d){return Math.atan2(this.x*d-this.y*g,this.x*g+this.y*d)},_matMult:function(g){var d=g[2]*this.x+g[3]*this.y;return this.x=g[0]*this.x+g[1]*this.y,this.y=d,this},_add:function(g){return this.x+=g.x,this.y+=g.y,this},_sub:function(g){return this.x-=g.x,this.y-=g.y,this},_mult:function(g){return this.x*=g,this.y*=g,this},_div:function(g){return this.x/=g,this.y/=g,this},_multByPoint:function(g){return this.x*=g.x,this.y*=g.y,this},_divByPoint:function(g){return this.x/=g.x,this.y/=g.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var g=this.y;return this.y=this.x,this.x=-g,this},_rotate:function(g){var d=Math.cos(g),b=Math.sin(g),C=b*this.x+d*this.y;return this.x=d*this.x-b*this.y,this.y=C,this},_rotateAround:function(g,d){var b=Math.cos(g),C=Math.sin(g),R=d.y+C*(this.x-d.x)+b*(this.y-d.y);return this.x=d.x+b*(this.x-d.x)-C*(this.y-d.y),this.y=R,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},_.convert=function(g){return g instanceof _?g:Array.isArray(g)?new _(g[0],g[1]):g};var x=h(f),T=I;function I(g,d,b,C){this.cx=3*g,this.bx=3*(b-g)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*d,this.by=3*(C-d)-this.cy,this.ay=1-this.cy-this.by,this.p1x=g,this.p1y=d,this.p2x=b,this.p2y=C}I.prototype={sampleCurveX:function(g){return((this.ax*g+this.bx)*g+this.cx)*g},sampleCurveY:function(g){return((this.ay*g+this.by)*g+this.cy)*g},sampleCurveDerivativeX:function(g){return(3*this.ax*g+2*this.bx)*g+this.cx},solveCurveX:function(g,d){if(d===void 0&&(d=1e-6),g<0)return 0;if(g>1)return 1;for(var b=g,C=0;C<8;C++){var R=this.sampleCurveX(b)-g;if(Math.abs(R)<d)return b;var U=this.sampleCurveDerivativeX(b);if(Math.abs(U)<1e-6)break;b-=R/U}var V=0,K=1;for(b=g,C=0;C<20&&(R=this.sampleCurveX(b),!(Math.abs(R-g)<d));C++)g>R?V=b:K=b,b=.5*(K-V)+V;return b},solve:function(g,d){return this.sampleCurveY(this.solveCurveX(g,d))}};var N=h(T);let $,W;function Y(){return $==null&&($=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),$}function ie(){if(W==null&&(W=!1,Y())){const d=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(d){for(let C=0;C<5*5;C++){const R=4*C;d.fillStyle=`rgb(${R},${R+1},${R+2})`,d.fillRect(C%5,Math.floor(C/5),1,1)}const b=d.getImageData(0,0,5,5).data;for(let C=0;C<5*5*4;C++)if(C%4!=3&&b[C]!==C){W=!0;break}}}return W||!1}function ce(g,d,b,C){const R=new N(g,d,b,C);return U=>R.solve(U)}const fe=ce(.25,.1,.25,1);function ve(g,d,b){return Math.min(b,Math.max(d,g))}function be(g,d,b){const C=b-d,R=((g-d)%C+C)%C+d;return R===d?b:R}function Qe(g){for(var d=arguments.length,b=new Array(d>1?d-1:0),C=1;C<d;C++)b[C-1]=arguments[C];for(const R of b)for(const U in R)g[U]=R[U];return g}let Ue=1;function st(g,d,b){const C={};for(const R in g)C[R]=d.call(this,g[R],R,g);return C}function at(g,d,b){const C={};for(const R in g)d.call(this,g[R],R,g)&&(C[R]=g[R]);return C}function Le(g){return Array.isArray(g)?g.map(Le):typeof g=="object"&&g?st(g,Le):g}const ze={};function tt(g){ze[g]||(typeof console<"u"&&console.warn(g),ze[g]=!0)}function Ne(g,d,b){return(b.y-g.y)*(d.x-g.x)>(d.y-g.y)*(b.x-g.x)}function Ht(g){return typeof WorkerGlobalScope<"u"&&g!==void 0&&g instanceof WorkerGlobalScope}let Vt=null;function Jt(g){return typeof ImageBitmap<"u"&&g instanceof ImageBitmap}const Kt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function er(g,d,b,C,R){return o(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const U=new VideoFrame(g,{timestamp:0});try{const V=U==null?void 0:U.format;if(!V||!V.startsWith("BGR")&&!V.startsWith("RGB"))throw new Error(`Unrecognized format ${V}`);const K=V.startsWith("BGR"),ee=new Uint8ClampedArray(C*R*4);if(yield U.copyTo(ee,function(le,_e,Be,De,Ge){const et=4*Math.max(-_e,0),lt=(Math.max(0,Be)-Be)*De*4+et,Ct=4*De,p=Math.max(0,_e),u=Math.max(0,Be);return{rect:{x:p,y:u,width:Math.min(le.width,_e+De)-p,height:Math.min(le.height,Be+Ge)-u},layout:[{offset:lt,stride:Ct}]}}(g,d,b,C,R)),K)for(let le=0;le<ee.length;le+=4){const _e=ee[le];ee[le]=ee[le+2],ee[le+2]=_e}return ee}finally{U.close()}})}let Xt,Fr;const $e="AbortError";function ut(){return new Error($e)}const Bt={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function St(g){return Bt.REGISTERED_PROTOCOLS[g.substring(0,g.indexOf("://"))]}const jt="global-dispatcher";class qt extends Error{constructor(d,b,C,R){super(`AJAXError: ${b} (${d}): ${C}`),this.status=d,this.statusText=b,this.url=C,this.body=R}}const nr=()=>Ht(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,ar=function(g,d){if(/:\/\//.test(g.url)&&!/^https?:|^file:/.test(g.url)){const C=St(g.url);if(C)return C(g,d);if(Ht(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:g,targetMapId:jt},d)}if(!(/^file:/.test(b=g.url)||/^file:/.test(nr())&&!/^\w+:/.test(b))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(C,R){return o(this,void 0,void 0,function*(){const U=new Request(C.url,{method:C.method||"GET",body:C.body,credentials:C.credentials,headers:C.headers,cache:C.cache,referrer:nr(),signal:R.signal});C.type!=="json"||U.headers.has("Accept")||U.headers.set("Accept","application/json");const V=yield fetch(U);if(!V.ok){const le=yield V.blob();throw new qt(V.status,V.statusText,C.url,le)}let K;K=C.type==="arrayBuffer"||C.type==="image"?V.arrayBuffer():C.type==="json"?V.json():V.text();const ee=yield K;if(R.signal.aborted)throw ut();return{data:ee,cacheControl:V.headers.get("Cache-Control"),expires:V.headers.get("Expires")}})}(g,d);if(Ht(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:g,mustQueue:!0,targetMapId:jt},d)}var b;return function(C,R){return new Promise((U,V)=>{var K;const ee=new XMLHttpRequest;ee.open(C.method||"GET",C.url,!0),C.type!=="arrayBuffer"&&C.type!=="image"||(ee.responseType="arraybuffer");for(const le in C.headers)ee.setRequestHeader(le,C.headers[le]);C.type==="json"&&(ee.responseType="text",!((K=C.headers)===null||K===void 0)&&K.Accept||ee.setRequestHeader("Accept","application/json")),ee.withCredentials=C.credentials==="include",ee.onerror=()=>{V(new Error(ee.statusText))},ee.onload=()=>{if(!R.signal.aborted)if((ee.status>=200&&ee.status<300||ee.status===0)&&ee.response!==null){let le=ee.response;if(C.type==="json")try{le=JSON.parse(ee.response)}catch(_e){return void V(_e)}U({data:le,cacheControl:ee.getResponseHeader("Cache-Control"),expires:ee.getResponseHeader("Expires")})}else{const le=new Blob([ee.response],{type:ee.getResponseHeader("Content-Type")});V(new qt(ee.status,ee.statusText,C.url,le))}},R.signal.addEventListener("abort",()=>{ee.abort(),V(ut())}),ee.send(C.body)})}(g,d)};function $r(g){if(!g||g.indexOf("://")<=0||g.indexOf("data:image/")===0||g.indexOf("blob:")===0)return!0;const d=new URL(g),b=window.location;return d.protocol===b.protocol&&d.host===b.host}function kr(g,d,b){b[g]&&b[g].indexOf(d)!==-1||(b[g]=b[g]||[],b[g].push(d))}function Gr(g,d,b){if(b&&b[g]){const C=b[g].indexOf(d);C!==-1&&b[g].splice(C,1)}}class sn{constructor(d){let b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Qe(this,b),this.type=d}}class on extends sn{constructor(d){let b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super("error",Qe({error:d},b))}}class pr{on(d,b){return this._listeners=this._listeners||{},kr(d,b,this._listeners),this}off(d,b){return Gr(d,b,this._listeners),Gr(d,b,this._oneTimeListeners),this}once(d,b){return b?(this._oneTimeListeners=this._oneTimeListeners||{},kr(d,b,this._oneTimeListeners),this):new Promise(C=>this.once(d,C))}fire(d,b){typeof d=="string"&&(d=new sn(d,b||{}));const C=d.type;if(this.listens(C)){d.target=this;const R=this._listeners&&this._listeners[C]?this._listeners[C].slice():[];for(const K of R)K.call(this,d);const U=this._oneTimeListeners&&this._oneTimeListeners[C]?this._oneTimeListeners[C].slice():[];for(const K of U)Gr(C,K,this._oneTimeListeners),K.call(this,d);const V=this._eventedParent;V&&(Qe(d,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),V.fire(d))}else d instanceof on&&console.error(d.error);return this}listens(d){return this._listeners&&this._listeners[d]&&this._listeners[d].length>0||this._oneTimeListeners&&this._oneTimeListeners[d]&&this._oneTimeListeners[d].length>0||this._eventedParent&&this._eventedParent.listens(d)}setEventedParent(d,b){return this._eventedParent=d,this._eventedParentData=b,this}}var We={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Pn=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function mn(g,d){const b={};for(const C in g)C!=="ref"&&(b[C]=g[C]);return Pn.forEach(C=>{C in d&&(b[C]=d[C])}),b}function mr(g,d){if(Array.isArray(g)){if(!Array.isArray(d)||g.length!==d.length)return!1;for(let b=0;b<g.length;b++)if(!mr(g[b],d[b]))return!1;return!0}if(typeof g=="object"&&g!==null&&d!==null){if(typeof d!="object"||Object.keys(g).length!==Object.keys(d).length)return!1;for(const b in g)if(!mr(g[b],d[b]))return!1;return!0}return g===d}function Mr(g,d){g.push(d)}function en(g,d,b){Mr(b,{command:"addSource",args:[g,d[g]]})}function Wr(g,d,b){Mr(d,{command:"removeSource",args:[g]}),b[g]=!0}function gn(g,d,b,C){Wr(g,b,C),en(g,d,b)}function Bn(g,d,b){let C;for(C in g[b])if(Object.prototype.hasOwnProperty.call(g[b],C)&&C!=="data"&&!mr(g[b][C],d[b][C]))return!1;for(C in d[b])if(Object.prototype.hasOwnProperty.call(d[b],C)&&C!=="data"&&!mr(g[b][C],d[b][C]))return!1;return!0}function Fn(g,d,b,C,R,U){g=g||{},d=d||{};for(const V in g)Object.prototype.hasOwnProperty.call(g,V)&&(mr(g[V],d[V])||b.push({command:U,args:[C,V,d[V],R]}));for(const V in d)Object.prototype.hasOwnProperty.call(d,V)&&!Object.prototype.hasOwnProperty.call(g,V)&&(mr(g[V],d[V])||b.push({command:U,args:[C,V,d[V],R]}))}function $n(g){return g.id}function ei(g,d){return g[d.id]=d,g}class br{constructor(d,b,C,R){this.message=(d?`${d}: `:"")+C,R&&(this.identifier=R),b!=null&&b.__line__&&(this.line=b.__line__)}}function Cn(g){for(var d=arguments.length,b=new Array(d>1?d-1:0),C=1;C<d;C++)b[C-1]=arguments[C];for(const R of b)for(const U in R)g[U]=R[U];return g}class Rn extends Error{constructor(d,b){super(b),this.message=b,this.key=d}}class nn{constructor(d){let b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.parent=d,this.bindings={};for(const[C,R]of b)this.bindings[C]=R}concat(d){return new nn(this,d)}get(d){if(this.bindings[d])return this.bindings[d];if(this.parent)return this.parent.get(d);throw new Error(`${d} not found in scope.`)}has(d){return!!this.bindings[d]||!!this.parent&&this.parent.has(d)}}const Ci={kind:"null"},Cr={kind:"number"},Tn={kind:"string"},Xe={kind:"boolean"},He={kind:"color"},Je={kind:"object"},Ve={kind:"value"},bt={kind:"collator"},Mt={kind:"formatted"},$t={kind:"padding"},Wt={kind:"resolvedImage"},Pe={kind:"variableAnchorOffsetCollection"};function Ae(g,d){return{kind:"array",itemType:g,N:d}}function ge(g){if(g.kind==="array"){const d=ge(g.itemType);return typeof g.N=="number"?`array<${d}, ${g.N}>`:g.itemType.kind==="value"?"array":`array<${d}>`}return g.kind}const we=[Ci,Cr,Tn,Xe,He,Mt,Je,Ae(Ve),$t,Wt,Pe];function Se(g,d){if(d.kind==="error")return null;if(g.kind==="array"){if(d.kind==="array"&&(d.N===0&&d.itemType.kind==="value"||!Se(g.itemType,d.itemType))&&(typeof g.N!="number"||g.N===d.N))return null}else{if(g.kind===d.kind)return null;if(g.kind==="value"){for(const b of we)if(!Se(b,d))return null}}return`Expected ${ge(g)} but found ${ge(d)} instead.`}function ht(g,d){return d.some(b=>b.kind===g.kind)}function At(g,d){return d.some(b=>b==="null"?g===null:b==="array"?Array.isArray(g):b==="object"?g&&!Array.isArray(g)&&typeof g=="object":b===typeof g)}function _t(g,d){return g.kind==="array"&&d.kind==="array"?g.itemType.kind===d.itemType.kind&&typeof g.N=="number":g.kind===d.kind}const dt=.96422,yt=.82521,Nt=4/29,Rt=6/29,dr=3*Rt*Rt,zr=Rt*Rt*Rt,Pr=Math.PI/180,Rr=180/Math.PI;function ln(g){return(g%=360)<0&&(g+=360),g}function Jn(g){let[d,b,C,R]=g,U,V;const K=jn((.2225045*(d=_n(d))+.7168786*(b=_n(b))+.0606169*(C=_n(C)))/1);d===b&&b===C?U=V=K:(U=jn((.4360747*d+.3850649*b+.1430804*C)/dt),V=jn((.0139322*d+.0971045*b+.7141733*C)/yt));const ee=116*K-16;return[ee<0?0:ee,500*(U-K),200*(K-V),R]}function _n(g){return g<=.04045?g/12.92:Math.pow((g+.055)/1.055,2.4)}function jn(g){return g>zr?Math.pow(g,1/3):g/dr+Nt}function Gn(g){let[d,b,C,R]=g,U=(d+16)/116,V=isNaN(b)?U:U+b/500,K=isNaN(C)?U:U-C/200;return U=1*Un(U),V=dt*Un(V),K=yt*Un(K),[Ln(3.1338561*V-1.6168667*U-.4906146*K),Ln(-.9787684*V+1.9161415*U+.033454*K),Ln(.0719453*V-.2289914*U+1.4052427*K),R]}function Ln(g){return(g=g<=.00304?12.92*g:1.055*Math.pow(g,1/2.4)-.055)<0?0:g>1?1:g}function Un(g){return g>Rt?g*g*g:dr*(g-Nt)}function Ei(g){return parseInt(g.padEnd(2,g),16)/255}function zi(g,d){return Pt(d?g/100:g,0,1)}function Pt(g,d,b){return Math.min(Math.max(d,g),b)}function Zr(g){return!g.some(Number.isNaN)}const Ur={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class On{constructor(d,b,C){let R=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1,U=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0;this.r=d,this.g=b,this.b=C,this.a=R,U||(this.r*=R,this.g*=R,this.b*=R,R||this.overwriteGetter("rgb",[d,b,C,R]))}static parse(d){if(d instanceof On)return d;if(typeof d!="string")return;const b=function(C){if((C=C.toLowerCase().trim())==="transparent")return[0,0,0,0];const R=Ur[C];if(R){const[V,K,ee]=R;return[V/255,K/255,ee/255,1]}if(C.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(C)){const V=C.length<6?1:2;let K=1;return[Ei(C.slice(K,K+=V)),Ei(C.slice(K,K+=V)),Ei(C.slice(K,K+=V)),Ei(C.slice(K,K+V)||"ff")]}if(C.startsWith("rgb")){const V=C.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(V){const[K,ee,le,_e,Be,De,Ge,et,lt,Ct,p,u]=V,A=[_e||" ",Ge||" ",Ct].join("");if(A==="  "||A==="  /"||A===",,"||A===",,,"){const v=[le,De,lt].join(""),M=v==="%%%"?100:v===""?255:0;if(M){const L=[Pt(+ee/M,0,1),Pt(+Be/M,0,1),Pt(+et/M,0,1),p?zi(+p,u):1];if(Zr(L))return L}}return}}const U=C.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(U){const[V,K,ee,le,_e,Be,De,Ge,et]=U,lt=[ee||" ",_e||" ",De].join("");if(lt==="  "||lt==="  /"||lt===",,"||lt===",,,"){const Ct=[+K,Pt(+le,0,100),Pt(+Be,0,100),Ge?zi(+Ge,et):1];if(Zr(Ct))return function(p){let[u,A,v,M]=p;function L(k){const Q=(k+u/30)%12,q=A*Math.min(v,1-v);return v-q*Math.max(-1,Math.min(Q-3,9-Q,1))}return u=ln(u),A/=100,v/=100,[L(0),L(8),L(4),M]}(Ct)}}}(d);return b?new On(...b,!1):void 0}get rgb(){const{r:d,g:b,b:C,a:R}=this,U=R||1/0;return this.overwriteGetter("rgb",[d/U,b/U,C/U,R])}get hcl(){return this.overwriteGetter("hcl",function(d){const[b,C,R,U]=Jn(d),V=Math.sqrt(C*C+R*R);return[Math.round(1e4*V)?ln(Math.atan2(R,C)*Rr):NaN,V,b,U]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Jn(this.rgb))}overwriteGetter(d,b){return Object.defineProperty(this,d,{value:b}),b}toString(){const[d,b,C,R]=this.rgb;return`rgba(${[d,b,C].map(U=>Math.round(255*U)).join(",")},${R})`}}On.black=new On(0,0,0,1),On.white=new On(1,1,1,1),On.transparent=new On(0,0,0,0),On.red=new On(1,0,0,1);class di{constructor(d,b,C){this.sensitivity=d?b?"variant":"case":b?"accent":"base",this.locale=C,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(d,b){return this.collator.compare(d,b)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class ks{constructor(d,b,C,R,U){this.text=d,this.image=b,this.scale=C,this.fontStack=R,this.textColor=U}}class bi{constructor(d){this.sections=d}static fromString(d){return new bi([new ks(d,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(d=>d.text.length!==0||d.image&&d.image.name.length!==0)}static factory(d){return d instanceof bi?d:bi.fromString(d)}toString(){return this.sections.length===0?"":this.sections.map(d=>d.text).join("")}}class bs{constructor(d){this.values=d.slice()}static parse(d){if(d instanceof bs)return d;if(typeof d=="number")return new bs([d,d,d,d]);if(Array.isArray(d)&&!(d.length<1||d.length>4)){for(const b of d)if(typeof b!="number")return;switch(d.length){case 1:d=[d[0],d[0],d[0],d[0]];break;case 2:d=[d[0],d[1],d[0],d[1]];break;case 3:d=[d[0],d[1],d[2],d[1]]}return new bs(d)}}toString(){return JSON.stringify(this.values)}}const jo=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Ks{constructor(d){this.values=d.slice()}static parse(d){if(d instanceof Ks)return d;if(Array.isArray(d)&&!(d.length<1)&&d.length%2==0){for(let b=0;b<d.length;b+=2){const C=d[b],R=d[b+1];if(typeof C!="string"||!jo.has(C)||!Array.isArray(R)||R.length!==2||typeof R[0]!="number"||typeof R[1]!="number")return}return new Ks(d)}}toString(){return JSON.stringify(this.values)}}class Hi{constructor(d){this.name=d.name,this.available=d.available}toString(){return this.name}static fromString(d){return d?new Hi({name:d,available:!1}):null}}function Mc(g,d,b,C){return typeof g=="number"&&g>=0&&g<=255&&typeof d=="number"&&d>=0&&d<=255&&typeof b=="number"&&b>=0&&b<=255?C===void 0||typeof C=="number"&&C>=0&&C<=1?null:`Invalid rgba value [${[g,d,b,C].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof C=="number"?[g,d,b,C]:[g,d,b]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function wa(g){if(g===null||typeof g=="string"||typeof g=="boolean"||typeof g=="number"||g instanceof On||g instanceof di||g instanceof bi||g instanceof bs||g instanceof Ks||g instanceof Hi)return!0;if(Array.isArray(g)){for(const d of g)if(!wa(d))return!1;return!0}if(typeof g=="object"){for(const d in g)if(!wa(g[d]))return!1;return!0}return!1}function ts(g){if(g===null)return Ci;if(typeof g=="string")return Tn;if(typeof g=="boolean")return Xe;if(typeof g=="number")return Cr;if(g instanceof On)return He;if(g instanceof di)return bt;if(g instanceof bi)return Mt;if(g instanceof bs)return $t;if(g instanceof Ks)return Pe;if(g instanceof Hi)return Wt;if(Array.isArray(g)){const d=g.length;let b;for(const C of g){const R=ts(C);if(b){if(b===R)continue;b=Ve;break}b=R}return Ae(b||Ve,d)}return Je}function ss(g){const d=typeof g;return g===null?"":d==="string"||d==="number"||d==="boolean"?String(g):g instanceof On||g instanceof bi||g instanceof bs||g instanceof Ks||g instanceof Hi?g.toString():JSON.stringify(g)}class sa{constructor(d,b){this.type=d,this.value=b}static parse(d,b){if(d.length!==2)return b.error(`'literal' expression requires exactly one argument, but found ${d.length-1} instead.`);if(!wa(d[1]))return b.error("invalid value");const C=d[1];let R=ts(C);const U=b.expectedType;return R.kind!=="array"||R.N!==0||!U||U.kind!=="array"||typeof U.N=="number"&&U.N!==0||(R=U),new sa(R,C)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Vi{constructor(d){this.name="ExpressionEvaluationError",this.message=d}toJSON(){return this.message}}const Pc={string:Tn,number:Cr,boolean:Xe,object:Je};class vo{constructor(d,b){this.type=d,this.args=b}static parse(d,b){if(d.length<2)return b.error("Expected at least one argument.");let C,R=1;const U=d[0];if(U==="array"){let K,ee;if(d.length>2){const le=d[1];if(typeof le!="string"||!(le in Pc)||le==="object")return b.error('The item type argument of "array" must be one of string, number, boolean',1);K=Pc[le],R++}else K=Ve;if(d.length>3){if(d[2]!==null&&(typeof d[2]!="number"||d[2]<0||d[2]!==Math.floor(d[2])))return b.error('The length argument to "array" must be a positive integer literal',2);ee=d[2],R++}C=Ae(K,ee)}else{if(!Pc[U])throw new Error(`Types doesn't contain name = ${U}`);C=Pc[U]}const V=[];for(;R<d.length;R++){const K=b.parse(d[R],R,Ve);if(!K)return null;V.push(K)}return new vo(C,V)}evaluate(d){for(let b=0;b<this.args.length;b++){const C=this.args[b].evaluate(d);if(!Se(this.type,ts(C)))return C;if(b===this.args.length-1)throw new Vi(`Expected value to be of type ${ge(this.type)}, but found ${ge(ts(C))} instead.`)}throw new Error}eachChild(d){this.args.forEach(d)}outputDefined(){return this.args.every(d=>d.outputDefined())}}const uh={"to-boolean":Xe,"to-color":He,"to-number":Cr,"to-string":Tn};class os{constructor(d,b){this.type=d,this.args=b}static parse(d,b){if(d.length<2)return b.error("Expected at least one argument.");const C=d[0];if(!uh[C])throw new Error(`Can't parse ${C} as it is not part of the known types`);if((C==="to-boolean"||C==="to-string")&&d.length!==2)return b.error("Expected one argument.");const R=uh[C],U=[];for(let V=1;V<d.length;V++){const K=b.parse(d[V],V,Ve);if(!K)return null;U.push(K)}return new os(R,U)}evaluate(d){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(d);case"color":{let b,C;for(const R of this.args){if(b=R.evaluate(d),C=null,b instanceof On)return b;if(typeof b=="string"){const U=d.parseColor(b);if(U)return U}else if(Array.isArray(b)&&(C=b.length<3||b.length>4?`Invalid rbga value ${JSON.stringify(b)}: expected an array containing either three or four numeric values.`:Mc(b[0],b[1],b[2],b[3]),!C))return new On(b[0]/255,b[1]/255,b[2]/255,b[3])}throw new Vi(C||`Could not parse color from value '${typeof b=="string"?b:JSON.stringify(b)}'`)}case"padding":{let b;for(const C of this.args){b=C.evaluate(d);const R=bs.parse(b);if(R)return R}throw new Vi(`Could not parse padding from value '${typeof b=="string"?b:JSON.stringify(b)}'`)}case"variableAnchorOffsetCollection":{let b;for(const C of this.args){b=C.evaluate(d);const R=Ks.parse(b);if(R)return R}throw new Vi(`Could not parse variableAnchorOffsetCollection from value '${typeof b=="string"?b:JSON.stringify(b)}'`)}case"number":{let b=null;for(const C of this.args){if(b=C.evaluate(d),b===null)return 0;const R=Number(b);if(!isNaN(R))return R}throw new Vi(`Could not convert ${JSON.stringify(b)} to number.`)}case"formatted":return bi.fromString(ss(this.args[0].evaluate(d)));case"resolvedImage":return Hi.fromString(ss(this.args[0].evaluate(d)));default:return ss(this.args[0].evaluate(d))}}eachChild(d){this.args.forEach(d)}outputDefined(){return this.args.every(d=>d.outputDefined())}}const cu=["Unknown","Point","LineString","Polygon"];class ds{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?cu[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(d){let b=this._parseColorCache[d];return b||(b=this._parseColorCache[d]=On.parse(d)),b}}class ri{constructor(d,b){let C=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],R=arguments.length>3?arguments[3]:void 0,U=arguments.length>4&&arguments[4]!==void 0?arguments[4]:new nn,V=arguments.length>5&&arguments[5]!==void 0?arguments[5]:[];this.registry=d,this.path=C,this.key=C.map(K=>`[${K}]`).join(""),this.scope=U,this.errors=V,this.expectedType=R,this._isConstant=b}parse(d,b,C,R){let U=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};return b?this.concat(b,C,R)._parse(d,U):this._parse(d,U)}_parse(d,b){function C(R,U,V){return V==="assert"?new vo(U,[R]):V==="coerce"?new os(U,[R]):R}if(d!==null&&typeof d!="string"&&typeof d!="boolean"&&typeof d!="number"||(d=["literal",d]),Array.isArray(d)){if(d.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const R=d[0];if(typeof R!="string")return this.error(`Expression name must be a string, but found ${typeof R} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const U=this.registry[R];if(U){let V=U.parse(d,this);if(!V)return null;if(this.expectedType){const K=this.expectedType,ee=V.type;if(K.kind!=="string"&&K.kind!=="number"&&K.kind!=="boolean"&&K.kind!=="object"&&K.kind!=="array"||ee.kind!=="value")if(K.kind!=="color"&&K.kind!=="formatted"&&K.kind!=="resolvedImage"||ee.kind!=="value"&&ee.kind!=="string")if(K.kind!=="padding"||ee.kind!=="value"&&ee.kind!=="number"&&ee.kind!=="array")if(K.kind!=="variableAnchorOffsetCollection"||ee.kind!=="value"&&ee.kind!=="array"){if(this.checkSubtype(K,ee))return null}else V=C(V,K,b.typeAnnotation||"coerce");else V=C(V,K,b.typeAnnotation||"coerce");else V=C(V,K,b.typeAnnotation||"coerce");else V=C(V,K,b.typeAnnotation||"assert")}if(!(V instanceof sa)&&V.type.kind!=="resolvedImage"&&this._isConstant(V)){const K=new ds;try{V=new sa(V.type,V.evaluate(K))}catch(ee){return this.error(ee.message),null}}return V}return this.error(`Unknown expression "${R}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(d===void 0?"'undefined' value invalid. Use null instead.":typeof d=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof d} instead.`)}concat(d,b,C){const R=typeof d=="number"?this.path.concat(d):this.path,U=C?this.scope.concat(C):this.scope;return new ri(this.registry,this._isConstant,R,b||null,U,this.errors)}error(d){for(var b=arguments.length,C=new Array(b>1?b-1:0),R=1;R<b;R++)C[R-1]=arguments[R];const U=`${this.key}${C.map(V=>`[${V}]`).join("")}`;this.errors.push(new Rn(U,d))}checkSubtype(d,b){const C=Se(d,b);return C&&this.error(C),C}}class lo{constructor(d,b){this.type=b.type,this.bindings=[].concat(d),this.result=b}evaluate(d){return this.result.evaluate(d)}eachChild(d){for(const b of this.bindings)d(b[1]);d(this.result)}static parse(d,b){if(d.length<4)return b.error(`Expected at least 3 arguments, but found ${d.length-1} instead.`);const C=[];for(let U=1;U<d.length-1;U+=2){const V=d[U];if(typeof V!="string")return b.error(`Expected string, but found ${typeof V} instead.`,U);if(/[^a-zA-Z0-9_]/.test(V))return b.error("Variable names must contain only alphanumeric characters or '_'.",U);const K=b.parse(d[U+1],U+1);if(!K)return null;C.push([V,K])}const R=b.parse(d[d.length-1],d.length-1,b.expectedType,C);return R?new lo(C,R):null}outputDefined(){return this.result.outputDefined()}}class yn{constructor(d,b){this.type=b.type,this.name=d,this.boundExpression=b}static parse(d,b){if(d.length!==2||typeof d[1]!="string")return b.error("'var' expression requires exactly one string literal argument.");const C=d[1];return b.scope.has(C)?new yn(C,b.scope.get(C)):b.error(`Unknown variable "${C}". Make sure "${C}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(d){return this.boundExpression.evaluate(d)}eachChild(){}outputDefined(){return!1}}class Fc{constructor(d,b,C){this.type=d,this.index=b,this.input=C}static parse(d,b){if(d.length!==3)return b.error(`Expected 2 arguments, but found ${d.length-1} instead.`);const C=b.parse(d[1],1,Cr),R=b.parse(d[2],2,Ae(b.expectedType||Ve));return C&&R?new Fc(R.type.itemType,C,R):null}evaluate(d){const b=this.index.evaluate(d),C=this.input.evaluate(d);if(b<0)throw new Vi(`Array index out of bounds: ${b} < 0.`);if(b>=C.length)throw new Vi(`Array index out of bounds: ${b} > ${C.length-1}.`);if(b!==Math.floor(b))throw new Vi(`Array index must be an integer, but found ${b} instead.`);return C[b]}eachChild(d){d(this.index),d(this.input)}outputDefined(){return!1}}class hh{constructor(d,b){this.type=Xe,this.needle=d,this.haystack=b}static parse(d,b){if(d.length!==3)return b.error(`Expected 2 arguments, but found ${d.length-1} instead.`);const C=b.parse(d[1],1,Ve),R=b.parse(d[2],2,Ve);return C&&R?ht(C.type,[Xe,Tn,Cr,Ci,Ve])?new hh(C,R):b.error(`Expected first argument to be of type boolean, string, number or null, but found ${ge(C.type)} instead`):null}evaluate(d){const b=this.needle.evaluate(d),C=this.haystack.evaluate(d);if(!C)return!1;if(!At(b,["boolean","string","number","null"]))throw new Vi(`Expected first argument to be of type boolean, string, number or null, but found ${ge(ts(b))} instead.`);if(!At(C,["string","array"]))throw new Vi(`Expected second argument to be of type array or string, but found ${ge(ts(C))} instead.`);return C.indexOf(b)>=0}eachChild(d){d(this.needle),d(this.haystack)}outputDefined(){return!0}}class $a{constructor(d,b,C){this.type=Cr,this.needle=d,this.haystack=b,this.fromIndex=C}static parse(d,b){if(d.length<=2||d.length>=5)return b.error(`Expected 3 or 4 arguments, but found ${d.length-1} instead.`);const C=b.parse(d[1],1,Ve),R=b.parse(d[2],2,Ve);if(!C||!R)return null;if(!ht(C.type,[Xe,Tn,Cr,Ci,Ve]))return b.error(`Expected first argument to be of type boolean, string, number or null, but found ${ge(C.type)} instead`);if(d.length===4){const U=b.parse(d[3],3,Cr);return U?new $a(C,R,U):null}return new $a(C,R)}evaluate(d){const b=this.needle.evaluate(d),C=this.haystack.evaluate(d);if(!At(b,["boolean","string","number","null"]))throw new Vi(`Expected first argument to be of type boolean, string, number or null, but found ${ge(ts(b))} instead.`);let R;if(this.fromIndex&&(R=this.fromIndex.evaluate(d)),At(C,["string"])){const U=C.indexOf(b,R);return U===-1?-1:[...C.slice(0,U)].length}if(At(C,["array"]))return C.indexOf(b,R);throw new Vi(`Expected second argument to be of type array or string, but found ${ge(ts(C))} instead.`)}eachChild(d){d(this.needle),d(this.haystack),this.fromIndex&&d(this.fromIndex)}outputDefined(){return!1}}class fs{constructor(d,b,C,R,U,V){this.inputType=d,this.type=b,this.input=C,this.cases=R,this.outputs=U,this.otherwise=V}static parse(d,b){if(d.length<5)return b.error(`Expected at least 4 arguments, but found only ${d.length-1}.`);if(d.length%2!=1)return b.error("Expected an even number of arguments.");let C,R;b.expectedType&&b.expectedType.kind!=="value"&&(R=b.expectedType);const U={},V=[];for(let le=2;le<d.length-1;le+=2){let _e=d[le];const Be=d[le+1];Array.isArray(_e)||(_e=[_e]);const De=b.concat(le);if(_e.length===0)return De.error("Expected at least one branch label.");for(const et of _e){if(typeof et!="number"&&typeof et!="string")return De.error("Branch labels must be numbers or strings.");if(typeof et=="number"&&Math.abs(et)>Number.MAX_SAFE_INTEGER)return De.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof et=="number"&&Math.floor(et)!==et)return De.error("Numeric branch labels must be integer values.");if(C){if(De.checkSubtype(C,ts(et)))return null}else C=ts(et);if(U[String(et)]!==void 0)return De.error("Branch labels must be unique.");U[String(et)]=V.length}const Ge=b.parse(Be,le,R);if(!Ge)return null;R=R||Ge.type,V.push(Ge)}const K=b.parse(d[1],1,Ve);if(!K)return null;const ee=b.parse(d[d.length-1],d.length-1,R);return ee?K.type.kind!=="value"&&b.concat(1).checkSubtype(C,K.type)?null:new fs(C,R,K,U,V,ee):null}evaluate(d){const b=this.input.evaluate(d);return(ts(b)===this.inputType&&this.outputs[this.cases[b]]||this.otherwise).evaluate(d)}eachChild(d){d(this.input),this.outputs.forEach(d),d(this.otherwise)}outputDefined(){return this.outputs.every(d=>d.outputDefined())&&this.otherwise.outputDefined()}}class As{constructor(d,b,C){this.type=d,this.branches=b,this.otherwise=C}static parse(d,b){if(d.length<4)return b.error(`Expected at least 3 arguments, but found only ${d.length-1}.`);if(d.length%2!=0)return b.error("Expected an odd number of arguments.");let C;b.expectedType&&b.expectedType.kind!=="value"&&(C=b.expectedType);const R=[];for(let V=1;V<d.length-1;V+=2){const K=b.parse(d[V],V,Xe);if(!K)return null;const ee=b.parse(d[V+1],V+1,C);if(!ee)return null;R.push([K,ee]),C=C||ee.type}const U=b.parse(d[d.length-1],d.length-1,C);if(!U)return null;if(!C)throw new Error("Can't infer output type");return new As(C,R,U)}evaluate(d){for(const[b,C]of this.branches)if(b.evaluate(d))return C.evaluate(d);return this.otherwise.evaluate(d)}eachChild(d){for(const[b,C]of this.branches)d(b),d(C);d(this.otherwise)}outputDefined(){return this.branches.every(d=>{let[b,C]=d;return C.outputDefined()})&&this.otherwise.outputDefined()}}class Gi{constructor(d,b,C,R){this.type=d,this.input=b,this.beginIndex=C,this.endIndex=R}static parse(d,b){if(d.length<=2||d.length>=5)return b.error(`Expected 3 or 4 arguments, but found ${d.length-1} instead.`);const C=b.parse(d[1],1,Ve),R=b.parse(d[2],2,Cr);if(!C||!R)return null;if(!ht(C.type,[Ae(Ve),Tn,Ve]))return b.error(`Expected first argument to be of type array or string, but found ${ge(C.type)} instead`);if(d.length===4){const U=b.parse(d[3],3,Cr);return U?new Gi(C.type,C,R,U):null}return new Gi(C.type,C,R)}evaluate(d){const b=this.input.evaluate(d),C=this.beginIndex.evaluate(d);let R;if(this.endIndex&&(R=this.endIndex.evaluate(d)),At(b,["string"]))return[...b].slice(C,R).join("");if(At(b,["array"]))return b.slice(C,R);throw new Vi(`Expected first argument to be of type array or string, but found ${ge(ts(b))} instead.`)}eachChild(d){d(this.input),d(this.beginIndex),this.endIndex&&d(this.endIndex)}outputDefined(){return!1}}function uu(g,d){const b=g.length-1;let C,R,U=0,V=b,K=0;for(;U<=V;)if(K=Math.floor((U+V)/2),C=g[K],R=g[K+1],C<=d){if(K===b||d<R)return K;U=K+1}else{if(!(C>d))throw new Vi("Input is not a number.");V=K-1}return 0}class Us{constructor(d,b,C){this.type=d,this.input=b,this.labels=[],this.outputs=[];for(const[R,U]of C)this.labels.push(R),this.outputs.push(U)}static parse(d,b){if(d.length-1<4)return b.error(`Expected at least 4 arguments, but found only ${d.length-1}.`);if((d.length-1)%2!=0)return b.error("Expected an even number of arguments.");const C=b.parse(d[1],1,Cr);if(!C)return null;const R=[];let U=null;b.expectedType&&b.expectedType.kind!=="value"&&(U=b.expectedType);for(let V=1;V<d.length;V+=2){const K=V===1?-1/0:d[V],ee=d[V+1],le=V,_e=V+1;if(typeof K!="number")return b.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',le);if(R.length&&R[R.length-1][0]>=K)return b.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',le);const Be=b.parse(ee,_e,U);if(!Be)return null;U=U||Be.type,R.push([K,Be])}return new Us(U,C,R)}evaluate(d){const b=this.labels,C=this.outputs;if(b.length===1)return C[0].evaluate(d);const R=this.input.evaluate(d);if(R<=b[0])return C[0].evaluate(d);const U=b.length;return R>=b[U-1]?C[U-1].evaluate(d):C[uu(b,R)].evaluate(d)}eachChild(d){d(this.input);for(const b of this.outputs)d(b)}outputDefined(){return this.outputs.every(d=>d.outputDefined())}}function vs(g){return g&&g.__esModule&&Object.prototype.hasOwnProperty.call(g,"default")?g.default:g}var eo=Rc;function Rc(g,d,b,C){this.cx=3*g,this.bx=3*(b-g)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*d,this.by=3*(C-d)-this.cy,this.ay=1-this.cy-this.by,this.p1x=g,this.p1y=d,this.p2x=b,this.p2y=C}Rc.prototype={sampleCurveX:function(g){return((this.ax*g+this.bx)*g+this.cx)*g},sampleCurveY:function(g){return((this.ay*g+this.by)*g+this.cy)*g},sampleCurveDerivativeX:function(g){return(3*this.ax*g+2*this.bx)*g+this.cx},solveCurveX:function(g,d){if(d===void 0&&(d=1e-6),g<0)return 0;if(g>1)return 1;for(var b=g,C=0;C<8;C++){var R=this.sampleCurveX(b)-g;if(Math.abs(R)<d)return b;var U=this.sampleCurveDerivativeX(b);if(Math.abs(U)<1e-6)break;b-=R/U}var V=0,K=1;for(b=g,C=0;C<20&&(R=this.sampleCurveX(b),!(Math.abs(R-g)<d));C++)g>R?V=b:K=b,b=.5*(K-V)+V;return b},solve:function(g,d){return this.sampleCurveY(this.solveCurveX(g,d))}};var oc=vs(eo);function ai(g,d,b){return g+b*(d-g)}function Dl(g,d,b){return g.map((C,R)=>ai(C,d[R],b))}const ps={number:ai,color:function(g,d,b){switch(arguments.length>3&&arguments[3]!==void 0?arguments[3]:"rgb"){case"rgb":{const[R,U,V,K]=Dl(g.rgb,d.rgb,b);return new On(R,U,V,K,!1)}case"hcl":{const[R,U,V,K]=g.hcl,[ee,le,_e,Be]=d.hcl;let De,Ge;if(isNaN(R)||isNaN(ee))isNaN(R)?isNaN(ee)?De=NaN:(De=ee,V!==1&&V!==0||(Ge=le)):(De=R,_e!==1&&_e!==0||(Ge=U));else{let u=ee-R;ee>R&&u>180?u-=360:ee<R&&R-ee>180&&(u+=360),De=R+b*u}const[et,lt,Ct,p]=function(u){let[A,v,M,L]=u;return A=isNaN(A)?0:A*Pr,Gn([M,Math.cos(A)*v,Math.sin(A)*v,L])}([De,Ge??ai(U,le,b),ai(V,_e,b),ai(K,Be,b)]);return new On(et,lt,Ct,p,!1)}case"lab":{const[R,U,V,K]=Gn(Dl(g.lab,d.lab,b));return new On(R,U,V,K,!1)}}},array:Dl,padding:function(g,d,b){return new bs(Dl(g.values,d.values,b))},variableAnchorOffsetCollection:function(g,d,b){const C=g.values,R=d.values;if(C.length!==R.length)throw new Vi(`Cannot interpolate values of different length. from: ${g.toString()}, to: ${d.toString()}`);const U=[];for(let V=0;V<C.length;V+=2){if(C[V]!==R[V])throw new Vi(`Cannot interpolate values containing mismatched anchors. from[${V}]: ${C[V]}, to[${V}]: ${R[V]}`);U.push(C[V]);const[K,ee]=C[V+1],[le,_e]=R[V+1];U.push([ai(K,le,b),ai(ee,_e,b)])}return new Ks(U)}};class Dn{constructor(d,b,C,R,U){this.type=d,this.operator=b,this.interpolation=C,this.input=R,this.labels=[],this.outputs=[];for(const[V,K]of U)this.labels.push(V),this.outputs.push(K)}static interpolationFactor(d,b,C,R){let U=0;if(d.name==="exponential")U=Ro(b,d.base,C,R);else if(d.name==="linear")U=Ro(b,1,C,R);else if(d.name==="cubic-bezier"){const V=d.controlPoints;U=new oc(V[0],V[1],V[2],V[3]).solve(Ro(b,1,C,R))}return U}static parse(d,b){let[C,R,U,...V]=d;if(!Array.isArray(R)||R.length===0)return b.error("Expected an interpolation type expression.",1);if(R[0]==="linear")R={name:"linear"};else if(R[0]==="exponential"){const le=R[1];if(typeof le!="number")return b.error("Exponential interpolation requires a numeric base.",1,1);R={name:"exponential",base:le}}else{if(R[0]!=="cubic-bezier")return b.error(`Unknown interpolation type ${String(R[0])}`,1,0);{const le=R.slice(1);if(le.length!==4||le.some(_e=>typeof _e!="number"||_e<0||_e>1))return b.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);R={name:"cubic-bezier",controlPoints:le}}}if(d.length-1<4)return b.error(`Expected at least 4 arguments, but found only ${d.length-1}.`);if((d.length-1)%2!=0)return b.error("Expected an even number of arguments.");if(U=b.parse(U,2,Cr),!U)return null;const K=[];let ee=null;C==="interpolate-hcl"||C==="interpolate-lab"?ee=He:b.expectedType&&b.expectedType.kind!=="value"&&(ee=b.expectedType);for(let le=0;le<V.length;le+=2){const _e=V[le],Be=V[le+1],De=le+3,Ge=le+4;if(typeof _e!="number")return b.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',De);if(K.length&&K[K.length-1][0]>=_e)return b.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',De);const et=b.parse(Be,Ge,ee);if(!et)return null;ee=ee||et.type,K.push([_e,et])}return _t(ee,Cr)||_t(ee,He)||_t(ee,$t)||_t(ee,Pe)||_t(ee,Ae(Cr))?new Dn(ee,C,R,U,K):b.error(`Type ${ge(ee)} is not interpolatable.`)}evaluate(d){const b=this.labels,C=this.outputs;if(b.length===1)return C[0].evaluate(d);const R=this.input.evaluate(d);if(R<=b[0])return C[0].evaluate(d);const U=b.length;if(R>=b[U-1])return C[U-1].evaluate(d);const V=uu(b,R),K=Dn.interpolationFactor(this.interpolation,R,b[V],b[V+1]),ee=C[V].evaluate(d),le=C[V+1].evaluate(d);switch(this.operator){case"interpolate":return ps[this.type.kind](ee,le,K);case"interpolate-hcl":return ps.color(ee,le,K,"hcl");case"interpolate-lab":return ps.color(ee,le,K,"lab")}}eachChild(d){d(this.input);for(const b of this.outputs)d(b)}outputDefined(){return this.outputs.every(d=>d.outputDefined())}}function Ro(g,d,b,C){const R=C-b,U=g-b;return R===0?0:d===1?U/R:(Math.pow(d,U)-1)/(Math.pow(d,R)-1)}class hu{constructor(d,b){this.type=d,this.args=b}static parse(d,b){if(d.length<2)return b.error("Expectected at least one argument.");let C=null;const R=b.expectedType;R&&R.kind!=="value"&&(C=R);const U=[];for(const K of d.slice(1)){const ee=b.parse(K,1+U.length,C,void 0,{typeAnnotation:"omit"});if(!ee)return null;C=C||ee.type,U.push(ee)}if(!C)throw new Error("No output type");const V=R&&U.some(K=>Se(R,K.type));return new hu(V?Ve:C,U)}evaluate(d){let b,C=null,R=0;for(const U of this.args)if(R++,C=U.evaluate(d),C&&C instanceof Hi&&!C.available&&(b||(b=C.name),C=null,R===this.args.length&&(C=b)),C!==null)break;return C}eachChild(d){this.args.forEach(d)}outputDefined(){return this.args.every(d=>d.outputDefined())}}function to(g,d){return g==="=="||g==="!="?d.kind==="boolean"||d.kind==="string"||d.kind==="number"||d.kind==="null"||d.kind==="value":d.kind==="string"||d.kind==="number"||d.kind==="value"}function du(g,d,b,C){return C.compare(d,b)===0}function Li(g,d,b){const C=g!=="=="&&g!=="!=";return class HZ{constructor(U,V,K){this.type=Xe,this.lhs=U,this.rhs=V,this.collator=K,this.hasUntypedArgument=U.type.kind==="value"||V.type.kind==="value"}static parse(U,V){if(U.length!==3&&U.length!==4)return V.error("Expected two or three arguments.");const K=U[0];let ee=V.parse(U[1],1,Ve);if(!ee)return null;if(!to(K,ee.type))return V.concat(1).error(`"${K}" comparisons are not supported for type '${ge(ee.type)}'.`);let le=V.parse(U[2],2,Ve);if(!le)return null;if(!to(K,le.type))return V.concat(2).error(`"${K}" comparisons are not supported for type '${ge(le.type)}'.`);if(ee.type.kind!==le.type.kind&&ee.type.kind!=="value"&&le.type.kind!=="value")return V.error(`Cannot compare types '${ge(ee.type)}' and '${ge(le.type)}'.`);C&&(ee.type.kind==="value"&&le.type.kind!=="value"?ee=new vo(le.type,[ee]):ee.type.kind!=="value"&&le.type.kind==="value"&&(le=new vo(ee.type,[le])));let _e=null;if(U.length===4){if(ee.type.kind!=="string"&&le.type.kind!=="string"&&ee.type.kind!=="value"&&le.type.kind!=="value")return V.error("Cannot use collator to compare non-string types.");if(_e=V.parse(U[3],3,bt),!_e)return null}return new HZ(ee,le,_e)}evaluate(U){const V=this.lhs.evaluate(U),K=this.rhs.evaluate(U);if(C&&this.hasUntypedArgument){const ee=ts(V),le=ts(K);if(ee.kind!==le.kind||ee.kind!=="string"&&ee.kind!=="number")throw new Vi(`Expected arguments for "${g}" to be (string, string) or (number, number), but found (${ee.kind}, ${le.kind}) instead.`)}if(this.collator&&!C&&this.hasUntypedArgument){const ee=ts(V),le=ts(K);if(ee.kind!=="string"||le.kind!=="string")return d(U,V,K)}return this.collator?b(U,V,K,this.collator.evaluate(U)):d(U,V,K)}eachChild(U){U(this.lhs),U(this.rhs),this.collator&&U(this.collator)}outputDefined(){return!0}}}const Ol=Li("==",function(g,d,b){return d===b},du),Ai=Li("!=",function(g,d,b){return d!==b},function(g,d,b,C){return!du(0,d,b,C)}),si=Li("<",function(g,d,b){return d<b},function(g,d,b,C){return C.compare(d,b)<0}),ku=Li(">",function(g,d,b){return d>b},function(g,d,b,C){return C.compare(d,b)>0}),wi=Li("<=",function(g,d,b){return d<=b},function(g,d,b,C){return C.compare(d,b)<=0}),kl=Li(">=",function(g,d,b){return d>=b},function(g,d,b,C){return C.compare(d,b)>=0});class ro{constructor(d,b,C){this.type=bt,this.locale=C,this.caseSensitive=d,this.diacriticSensitive=b}static parse(d,b){if(d.length!==2)return b.error("Expected one argument.");const C=d[1];if(typeof C!="object"||Array.isArray(C))return b.error("Collator options argument must be an object.");const R=b.parse(C["case-sensitive"]!==void 0&&C["case-sensitive"],1,Xe);if(!R)return null;const U=b.parse(C["diacritic-sensitive"]!==void 0&&C["diacritic-sensitive"],1,Xe);if(!U)return null;let V=null;return C.locale&&(V=b.parse(C.locale,1,Tn),!V)?null:new ro(R,U,V)}evaluate(d){return new di(this.caseSensitive.evaluate(d),this.diacriticSensitive.evaluate(d),this.locale?this.locale.evaluate(d):null)}eachChild(d){d(this.caseSensitive),d(this.diacriticSensitive),this.locale&&d(this.locale)}outputDefined(){return!1}}class Ba{constructor(d,b,C,R,U){this.type=Tn,this.number=d,this.locale=b,this.currency=C,this.minFractionDigits=R,this.maxFractionDigits=U}static parse(d,b){if(d.length!==3)return b.error("Expected two arguments.");const C=b.parse(d[1],1,Cr);if(!C)return null;const R=d[2];if(typeof R!="object"||Array.isArray(R))return b.error("NumberFormat options argument must be an object.");let U=null;if(R.locale&&(U=b.parse(R.locale,1,Tn),!U))return null;let V=null;if(R.currency&&(V=b.parse(R.currency,1,Tn),!V))return null;let K=null;if(R["min-fraction-digits"]&&(K=b.parse(R["min-fraction-digits"],1,Cr),!K))return null;let ee=null;return R["max-fraction-digits"]&&(ee=b.parse(R["max-fraction-digits"],1,Cr),!ee)?null:new Ba(C,U,V,K,ee)}evaluate(d){return new Intl.NumberFormat(this.locale?this.locale.evaluate(d):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(d):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(d):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(d):void 0}).format(this.number.evaluate(d))}eachChild(d){d(this.number),this.locale&&d(this.locale),this.currency&&d(this.currency),this.minFractionDigits&&d(this.minFractionDigits),this.maxFractionDigits&&d(this.maxFractionDigits)}outputDefined(){return!1}}class ac{constructor(d){this.type=Mt,this.sections=d}static parse(d,b){if(d.length<2)return b.error("Expected at least one argument.");const C=d[1];if(!Array.isArray(C)&&typeof C=="object")return b.error("First argument must be an image or text section.");const R=[];let U=!1;for(let V=1;V<=d.length-1;++V){const K=d[V];if(U&&typeof K=="object"&&!Array.isArray(K)){U=!1;let ee=null;if(K["font-scale"]&&(ee=b.parse(K["font-scale"],1,Cr),!ee))return null;let le=null;if(K["text-font"]&&(le=b.parse(K["text-font"],1,Ae(Tn)),!le))return null;let _e=null;if(K["text-color"]&&(_e=b.parse(K["text-color"],1,He),!_e))return null;const Be=R[R.length-1];Be.scale=ee,Be.font=le,Be.textColor=_e}else{const ee=b.parse(d[V],1,Ve);if(!ee)return null;const le=ee.type.kind;if(le!=="string"&&le!=="value"&&le!=="null"&&le!=="resolvedImage")return b.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");U=!0,R.push({content:ee,scale:null,font:null,textColor:null})}}return new ac(R)}evaluate(d){return new bi(this.sections.map(b=>{const C=b.content.evaluate(d);return ts(C)===Wt?new ks("",C,null,null,null):new ks(ss(C),null,b.scale?b.scale.evaluate(d):null,b.font?b.font.evaluate(d).join(","):null,b.textColor?b.textColor.evaluate(d):null)}))}eachChild(d){for(const b of this.sections)d(b.content),b.scale&&d(b.scale),b.font&&d(b.font),b.textColor&&d(b.textColor)}outputDefined(){return!1}}class ja{constructor(d){this.type=Wt,this.input=d}static parse(d,b){if(d.length!==2)return b.error("Expected two arguments.");const C=b.parse(d[1],1,Tn);return C?new ja(C):b.error("No image name provided.")}evaluate(d){const b=this.input.evaluate(d),C=Hi.fromString(b);return C&&d.availableImages&&(C.available=d.availableImages.indexOf(b)>-1),C}eachChild(d){d(this.input)}outputDefined(){return!1}}class qa{constructor(d){this.type=Cr,this.input=d}static parse(d,b){if(d.length!==2)return b.error(`Expected 1 argument, but found ${d.length-1} instead.`);const C=b.parse(d[1],1);return C?C.type.kind!=="array"&&C.type.kind!=="string"&&C.type.kind!=="value"?b.error(`Expected argument of type string or array, but found ${ge(C.type)} instead.`):new qa(C):null}evaluate(d){const b=this.input.evaluate(d);if(typeof b=="string")return[...b].length;if(Array.isArray(b))return b.length;throw new Vi(`Expected value to be of type string or array, but found ${ge(ts(b))} instead.`)}eachChild(d){d(this.input)}outputDefined(){return!1}}const qo=8192;function dh(g,d){const b=(180+g[0])/360,C=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+g[1]*Math.PI/360)))/360,R=Math.pow(2,d.z);return[Math.round(b*R*qo),Math.round(C*R*qo)]}function fu(g,d){const b=Math.pow(2,d.z);return[(R=(g[0]/qo+d.x)/b,360*R-180),(C=(g[1]/qo+d.y)/b,360/Math.PI*Math.atan(Math.exp((180-360*C)*Math.PI/180))-90)];var C,R}function Ul(g,d){g[0]=Math.min(g[0],d[0]),g[1]=Math.min(g[1],d[1]),g[2]=Math.max(g[2],d[0]),g[3]=Math.max(g[3],d[1])}function oa(g,d){return!(g[0]<=d[0]||g[2]>=d[2]||g[1]<=d[1]||g[3]>=d[3])}function Sn(g,d,b){const C=g[0]-d[0],R=g[1]-d[1],U=g[0]-b[0],V=g[1]-b[1];return C*V-U*R==0&&C*U<=0&&R*V<=0}function Ko(g,d,b,C){return(R=[C[0]-b[0],C[1]-b[1]])[0]*(U=[d[0]-g[0],d[1]-g[1]])[1]-R[1]*U[0]!=0&&!(!Nh(g,d,b,C)||!Nh(b,C,g,d));var R,U}function Ka(g,d,b){for(const C of b)for(let R=0;R<C.length-1;++R)if(Ko(g,d,C[R],C[R+1]))return!0;return!1}function go(g,d){let b=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,C=!1;for(const K of d)for(let ee=0;ee<K.length-1;ee++){if(Sn(g,K[ee],K[ee+1]))return b;(U=K[ee])[1]>(R=g)[1]!=(V=K[ee+1])[1]>R[1]&&R[0]<(V[0]-U[0])*(R[1]-U[1])/(V[1]-U[1])+U[0]&&(C=!C)}var R,U,V;return C}function $i(g,d){for(const b of d)if(go(g,b))return!0;return!1}function Au(g,d){for(const b of g)if(!go(b,d))return!1;for(let b=0;b<g.length-1;++b)if(Ka(g[b],g[b+1],d))return!1;return!0}function Ca(g,d){for(const b of d)if(Au(g,b))return!0;return!1}function Nh(g,d,b,C){const R=C[0]-b[0],U=C[1]-b[1],V=(g[0]-b[0])*U-R*(g[1]-b[1]),K=(d[0]-b[0])*U-R*(d[1]-b[1]);return V>0&&K<0||V<0&&K>0}function pu(g,d,b){const C=[];for(let R=0;R<g.length;R++){const U=[];for(let V=0;V<g[R].length;V++){const K=dh(g[R][V],b);Ul(d,K),U.push(K)}C.push(U)}return C}function Uu(g,d,b){const C=[];for(let R=0;R<g.length;R++){const U=pu(g[R],d,b);C.push(U)}return C}function gu(g,d,b,C){if(g[0]<b[0]||g[0]>b[2]){const R=.5*C;let U=g[0]-b[0]>R?-C:b[0]-g[0]>R?C:0;U===0&&(U=g[0]-b[2]>R?-C:b[2]-g[0]>R?C:0),g[0]+=U}Ul(d,g)}function fh(g,d,b,C){const R=Math.pow(2,C.z)*qo,U=[C.x*qo,C.y*qo],V=[];for(const K of g)for(const ee of K){const le=[ee.x+U[0],ee.y+U[1]];gu(le,d,b,R),V.push(le)}return V}function mu(g,d,b,C){const R=Math.pow(2,C.z)*qo,U=[C.x*qo,C.y*qo],V=[];for(const ee of g){const le=[];for(const _e of ee){const Be=[_e.x+U[0],_e.y+U[1]];Ul(d,Be),le.push(Be)}V.push(le)}if(d[2]-d[0]<=R/2){(K=d)[0]=K[1]=1/0,K[2]=K[3]=-1/0;for(const ee of V)for(const le of ee)gu(le,d,b,R)}var K;return V}class xo{constructor(d,b){this.type=Xe,this.geojson=d,this.geometries=b}static parse(d,b){if(d.length!==2)return b.error(`'within' expression requires exactly one argument, but found ${d.length-1} instead.`);if(wa(d[1])){const C=d[1];if(C.type==="FeatureCollection"){const R=[];for(const U of C.features){const{type:V,coordinates:K}=U.geometry;V==="Polygon"&&R.push(K),V==="MultiPolygon"&&R.push(...K)}if(R.length)return new xo(C,{type:"MultiPolygon",coordinates:R})}else if(C.type==="Feature"){const R=C.geometry.type;if(R==="Polygon"||R==="MultiPolygon")return new xo(C,C.geometry)}else if(C.type==="Polygon"||C.type==="MultiPolygon")return new xo(C,C)}return b.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(d){if(d.geometry()!=null&&d.canonicalID()!=null){if(d.geometryType()==="Point")return function(b,C){const R=[1/0,1/0,-1/0,-1/0],U=[1/0,1/0,-1/0,-1/0],V=b.canonicalID();if(C.type==="Polygon"){const K=pu(C.coordinates,U,V),ee=fh(b.geometry(),R,U,V);if(!oa(R,U))return!1;for(const le of ee)if(!go(le,K))return!1}if(C.type==="MultiPolygon"){const K=Uu(C.coordinates,U,V),ee=fh(b.geometry(),R,U,V);if(!oa(R,U))return!1;for(const le of ee)if(!$i(le,K))return!1}return!0}(d,this.geometries);if(d.geometryType()==="LineString")return function(b,C){const R=[1/0,1/0,-1/0,-1/0],U=[1/0,1/0,-1/0,-1/0],V=b.canonicalID();if(C.type==="Polygon"){const K=pu(C.coordinates,U,V),ee=mu(b.geometry(),R,U,V);if(!oa(R,U))return!1;for(const le of ee)if(!Au(le,K))return!1}if(C.type==="MultiPolygon"){const K=Uu(C.coordinates,U,V),ee=mu(b.geometry(),R,U,V);if(!oa(R,U))return!1;for(const le of ee)if(!Ca(le,K))return!1}return!0}(d,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let wo=class{constructor(){let g=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:(b,C)=>b<C?-1:b>C?1:0;if(this.data=g,this.length=this.data.length,this.compare=d,this.length>0)for(let b=(this.length>>1)-1;b>=0;b--)this._down(b)}push(g){this.data.push(g),this._up(this.length++)}pop(){if(this.length===0)return;const g=this.data[0],d=this.data.pop();return--this.length>0&&(this.data[0]=d,this._down(0)),g}peek(){return this.data[0]}_up(g){const{data:d,compare:b}=this,C=d[g];for(;g>0;){const R=g-1>>1,U=d[R];if(b(C,U)>=0)break;d[g]=U,g=R}d[g]=C}_down(g){const{data:d,compare:b}=this,C=this.length>>1,R=d[g];for(;g<C;){let U=1+(g<<1);const V=U+1;if(V<this.length&&b(d[V],d[U])<0&&(U=V),b(d[U],R)>=0)break;d[g]=d[U],g=U}d[g]=R}};function Lc(g,d,b,C,R){lc(g,d,b,C||g.length-1,R||Lo)}function lc(g,d,b,C,R){for(;C>b;){if(C-b>600){var U=C-b+1,V=d-b+1,K=Math.log(U),ee=.5*Math.exp(2*K/3),le=.5*Math.sqrt(K*ee*(U-ee)/U)*(V-U/2<0?-1:1);lc(g,d,Math.max(b,Math.floor(d-V*ee/U+le)),Math.min(C,Math.floor(d+(U-V)*ee/U+le)),R)}var _e=g[d],Be=b,De=C;for(Dc(g,b,d),R(g[C],_e)>0&&Dc(g,b,C);Be<De;){for(Dc(g,Be,De),Be++,De--;R(g[Be],_e)<0;)Be++;for(;R(g[De],_e)>0;)De--}R(g[b],_e)===0?Dc(g,b,De):Dc(g,++De,C),De<=d&&(b=De+1),d<=De&&(C=De-1)}}function Dc(g,d,b){var C=g[d];g[d]=g[b],g[b]=C}function Lo(g,d){return g<d?-1:g>d?1:0}function cc(g,d){if(g.length<=1)return[g];const b=[];let C,R;for(const U of g){const V=gl(U);V!==0&&(U.area=Math.abs(V),R===void 0&&(R=V<0),R===V<0?(C&&b.push(C),C=[U]):C.push(U))}if(C&&b.push(C),d>1)for(let U=0;U<b.length;U++)b[U].length<=d||(Lc(b[U],d,1,b[U].length-1,Nu),b[U]=b[U].slice(0,d));return b}function Nu(g,d){return d.area-g.area}function gl(g){let d=0;for(let b,C,R=0,U=g.length,V=U-1;R<U;V=R++)b=g[R],C=g[V],d+=(C.x-b.x)*(b.y+C.y);return d}const uc=1/298.257223563,ne=uc*(2-uc),je=Math.PI/180;class Tt{constructor(d){const b=6378.137*je*1e3,C=Math.cos(d*je),R=1/(1-ne*(1-C*C)),U=Math.sqrt(R);this.kx=b*U*C,this.ky=b*U*R*(1-ne)}distance(d,b){const C=this.wrap(d[0]-b[0])*this.kx,R=(d[1]-b[1])*this.ky;return Math.sqrt(C*C+R*R)}pointOnLine(d,b){let C,R,U,V,K=1/0;for(let ee=0;ee<d.length-1;ee++){let le=d[ee][0],_e=d[ee][1],Be=this.wrap(d[ee+1][0]-le)*this.kx,De=(d[ee+1][1]-_e)*this.ky,Ge=0;Be===0&&De===0||(Ge=(this.wrap(b[0]-le)*this.kx*Be+(b[1]-_e)*this.ky*De)/(Be*Be+De*De),Ge>1?(le=d[ee+1][0],_e=d[ee+1][1]):Ge>0&&(le+=Be/this.kx*Ge,_e+=De/this.ky*Ge)),Be=this.wrap(b[0]-le)*this.kx,De=(b[1]-_e)*this.ky;const et=Be*Be+De*De;et<K&&(K=et,C=le,R=_e,U=ee,V=Ge)}return{point:[C,R],index:U,t:Math.max(0,Math.min(1,V))}}wrap(d){for(;d<-180;)d+=360;for(;d>180;)d-=360;return d}}function Qt(g,d){return d[0]-g[0]}function rr(g){return g[1]-g[0]+1}function vr(g,d){return g[1]>=g[0]&&g[1]<d}function Xr(g,d){if(g[0]>g[1])return[null,null];const b=rr(g);if(d){if(b===2)return[g,null];const R=Math.floor(b/2);return[[g[0],g[0]+R],[g[0]+R,g[1]]]}if(b===1)return[g,null];const C=Math.floor(b/2)-1;return[[g[0],g[0]+C],[g[0]+C+1,g[1]]]}function bn(g,d){if(!vr(d,g.length))return[1/0,1/0,-1/0,-1/0];const b=[1/0,1/0,-1/0,-1/0];for(let C=d[0];C<=d[1];++C)Ul(b,g[C]);return b}function qn(g){const d=[1/0,1/0,-1/0,-1/0];for(const b of g)for(const C of b)Ul(d,C);return d}function li(g){return g[0]!==-1/0&&g[1]!==-1/0&&g[2]!==1/0&&g[3]!==1/0}function fi(g,d,b){if(!li(g)||!li(d))return NaN;let C=0,R=0;return g[2]<d[0]&&(C=d[0]-g[2]),g[0]>d[2]&&(C=g[0]-d[2]),g[1]>d[3]&&(R=g[1]-d[3]),g[3]<d[1]&&(R=d[1]-g[3]),b.distance([0,0],[C,R])}function pi(g,d,b){const C=b.pointOnLine(d,g);return b.distance(g,C.point)}function as(g,d,b,C,R){const U=Math.min(pi(g,[b,C],R),pi(d,[b,C],R)),V=Math.min(pi(b,[g,d],R),pi(C,[g,d],R));return Math.min(U,V)}function rs(g,d,b,C,R){if(!vr(d,g.length)||!vr(C,b.length))return 1/0;let U=1/0;for(let V=d[0];V<d[1];++V){const K=g[V],ee=g[V+1];for(let le=C[0];le<C[1];++le){const _e=b[le],Be=b[le+1];if(Ko(K,ee,_e,Be))return 0;U=Math.min(U,as(K,ee,_e,Be,R))}}return U}function gi(g,d,b,C,R){if(!vr(d,g.length)||!vr(C,b.length))return NaN;let U=1/0;for(let V=d[0];V<=d[1];++V)for(let K=C[0];K<=C[1];++K)if(U=Math.min(U,R.distance(g[V],b[K])),U===0)return U;return U}function Do(g,d,b){if(go(g,d,!0))return 0;let C=1/0;for(const R of d){const U=R[0],V=R[R.length-1];if(U!==V&&(C=Math.min(C,pi(g,[V,U],b)),C===0))return C;const K=b.pointOnLine(R,g);if(C=Math.min(C,b.distance(g,K.point)),C===0)return C}return C}function zn(g,d,b,C){if(!vr(d,g.length))return NaN;for(let U=d[0];U<=d[1];++U)if(go(g[U],b,!0))return 0;let R=1/0;for(let U=d[0];U<d[1];++U){const V=g[U],K=g[U+1];for(const ee of b)for(let le=0,_e=ee.length,Be=_e-1;le<_e;Be=le++){const De=ee[Be],Ge=ee[le];if(Ko(V,K,De,Ge))return 0;R=Math.min(R,as(V,K,De,Ge,C))}}return R}function Wo(g,d){for(const b of g)for(const C of b)if(go(C,d,!0))return!0;return!1}function vi(g,d,b){let C=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1/0;const R=qn(g),U=qn(d);if(C!==1/0&&fi(R,U,b)>=C)return C;if(oa(R,U)){if(Wo(g,d))return 0}else if(Wo(d,g))return 0;let V=1/0;for(const K of g)for(let ee=0,le=K.length,_e=le-1;ee<le;_e=ee++){const Be=K[_e],De=K[ee];for(const Ge of d)for(let et=0,lt=Ge.length,Ct=lt-1;et<lt;Ct=et++){const p=Ge[Ct],u=Ge[et];if(Ko(Be,De,p,u))return 0;V=Math.min(V,as(Be,De,p,u,b))}}return V}function Ti(g,d,b,C,R,U){if(!U)return;const V=fi(bn(C,U),R,b);V<d&&g.push([V,U,[0,0]])}function hc(g,d,b,C,R,U,V){if(!U||!V)return;const K=fi(bn(C,U),bn(R,V),b);K<d&&g.push([K,U,V])}function Nl(g,d,b,C){let R=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1/0,U=Math.min(C.distance(g[0],b[0][0]),R);if(U===0)return U;const V=new wo([[0,[0,g.length-1],[0,0]]],Qt),K=qn(b);for(;V.length>0;){const ee=V.pop();if(ee[0]>=U)continue;const le=ee[1],_e=d?50:100;if(rr(le)<=_e){if(!vr(le,g.length))return NaN;if(d){const Be=zn(g,le,b,C);if(isNaN(Be)||Be===0)return Be;U=Math.min(U,Be)}else for(let Be=le[0];Be<=le[1];++Be){const De=Do(g[Be],b,C);if(U=Math.min(U,De),U===0)return 0}}else{const Be=Xr(le,d);Ti(V,U,C,g,K,Be[0]),Ti(V,U,C,g,K,Be[1])}}return U}function zl(g,d,b,C,R){let U=arguments.length>5&&arguments[5]!==void 0?arguments[5]:1/0,V=Math.min(U,R.distance(g[0],b[0]));if(V===0)return V;const K=new wo([[0,[0,g.length-1],[0,b.length-1]]],Qt);for(;K.length>0;){const ee=K.pop();if(ee[0]>=V)continue;const le=ee[1],_e=ee[2],Be=d?50:100,De=C?50:100;if(rr(le)<=Be&&rr(_e)<=De){if(!vr(le,g.length)&&vr(_e,b.length))return NaN;let Ge;if(d&&C)Ge=rs(g,le,b,_e,R),V=Math.min(V,Ge);else if(d&&!C){const et=g.slice(le[0],le[1]+1);for(let lt=_e[0];lt<=_e[1];++lt)if(Ge=pi(b[lt],et,R),V=Math.min(V,Ge),V===0)return V}else if(!d&&C){const et=b.slice(_e[0],_e[1]+1);for(let lt=le[0];lt<=le[1];++lt)if(Ge=pi(g[lt],et,R),V=Math.min(V,Ge),V===0)return V}else Ge=gi(g,le,b,_e,R),V=Math.min(V,Ge)}else{const Ge=Xr(le,d),et=Xr(_e,C);hc(K,V,R,g,b,Ge[0],et[0]),hc(K,V,R,g,b,Ge[0],et[1]),hc(K,V,R,g,b,Ge[1],et[0]),hc(K,V,R,g,b,Ge[1],et[1])}}return V}function Oc(g){return g.type==="MultiPolygon"?g.coordinates.map(d=>({type:"Polygon",coordinates:d})):g.type==="MultiLineString"?g.coordinates.map(d=>({type:"LineString",coordinates:d})):g.type==="MultiPoint"?g.coordinates.map(d=>({type:"Point",coordinates:d})):[g]}class Wa{constructor(d,b){this.type=Cr,this.geojson=d,this.geometries=b}static parse(d,b){if(d.length!==2)return b.error(`'distance' expression requires exactly one argument, but found ${d.length-1} instead.`);if(wa(d[1])){const C=d[1];if(C.type==="FeatureCollection")return new Wa(C,C.features.map(R=>Oc(R.geometry)).flat());if(C.type==="Feature")return new Wa(C,Oc(C.geometry));if("type"in C&&"coordinates"in C)return new Wa(C,Oc(C))}return b.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(d){if(d.geometry()!=null&&d.canonicalID()!=null){if(d.geometryType()==="Point")return function(b,C){const R=b.geometry(),U=R.flat().map(ee=>fu([ee.x,ee.y],b.canonical));if(R.length===0)return NaN;const V=new Tt(U[0][1]);let K=1/0;for(const ee of C){switch(ee.type){case"Point":K=Math.min(K,zl(U,!1,[ee.coordinates],!1,V,K));break;case"LineString":K=Math.min(K,zl(U,!1,ee.coordinates,!0,V,K));break;case"Polygon":K=Math.min(K,Nl(U,!1,ee.coordinates,V,K))}if(K===0)return K}return K}(d,this.geometries);if(d.geometryType()==="LineString")return function(b,C){const R=b.geometry(),U=R.flat().map(ee=>fu([ee.x,ee.y],b.canonical));if(R.length===0)return NaN;const V=new Tt(U[0][1]);let K=1/0;for(const ee of C){switch(ee.type){case"Point":K=Math.min(K,zl(U,!0,[ee.coordinates],!1,V,K));break;case"LineString":K=Math.min(K,zl(U,!0,ee.coordinates,!0,V,K));break;case"Polygon":K=Math.min(K,Nl(U,!0,ee.coordinates,V,K))}if(K===0)return K}return K}(d,this.geometries);if(d.geometryType()==="Polygon")return function(b,C){const R=b.geometry();if(R.length===0||R[0].length===0)return NaN;const U=cc(R,0).map(ee=>ee.map(le=>le.map(_e=>fu([_e.x,_e.y],b.canonical)))),V=new Tt(U[0][0][0][1]);let K=1/0;for(const ee of C)for(const le of U){switch(ee.type){case"Point":K=Math.min(K,Nl([ee.coordinates],!1,le,V,K));break;case"LineString":K=Math.min(K,Nl(ee.coordinates,!0,le,V,K));break;case"Polygon":K=Math.min(K,vi(le,ee.coordinates,V,K))}if(K===0)return K}return K}(d,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const ml={"==":Ol,"!=":Ai,">":ku,"<":si,">=":kl,"<=":wi,array:vo,at:Fc,boolean:vo,case:As,coalesce:hu,collator:ro,format:ac,image:ja,in:hh,"index-of":$a,interpolate:Dn,"interpolate-hcl":Dn,"interpolate-lab":Dn,length:qa,let:lo,literal:sa,match:fs,number:vo,"number-format":Ba,object:vo,slice:Gi,step:Us,string:vo,"to-boolean":os,"to-color":os,"to-number":os,"to-string":os,var:yn,within:xo,distance:Wa};class no{constructor(d,b,C,R){this.name=d,this.type=b,this._evaluate=C,this.args=R}evaluate(d){return this._evaluate(d,this.args)}eachChild(d){this.args.forEach(d)}outputDefined(){return!1}static parse(d,b){const C=d[0],R=no.definitions[C];if(!R)return b.error(`Unknown expression "${C}". If you wanted a literal array, use ["literal", [...]].`,0);const U=Array.isArray(R)?R[0]:R.type,V=Array.isArray(R)?[[R[1],R[2]]]:R.overloads,K=V.filter(le=>{let[_e]=le;return!Array.isArray(_e)||_e.length===d.length-1});let ee=null;for(const[le,_e]of K){ee=new ri(b.registry,Ac,b.path,null,b.scope);const Be=[];let De=!1;for(let Ge=1;Ge<d.length;Ge++){const et=d[Ge],lt=Array.isArray(le)?le[Ge-1]:le.type,Ct=ee.parse(et,1+Be.length,lt);if(!Ct){De=!0;break}Be.push(Ct)}if(!De)if(Array.isArray(le)&&le.length!==Be.length)ee.error(`Expected ${le.length} arguments, but found ${Be.length} instead.`);else{for(let Ge=0;Ge<Be.length;Ge++){const et=Array.isArray(le)?le[Ge]:le.type,lt=Be[Ge];ee.concat(Ge+1).checkSubtype(et,lt.type)}if(ee.errors.length===0)return new no(C,U,_e,Be)}}if(K.length===1)b.errors.push(...ee.errors);else{const le=(K.length?K:V).map(Be=>{let[De]=Be;return Ge=De,Array.isArray(Ge)?`(${Ge.map(ge).join(", ")})`:`(${ge(Ge.type)}...)`;var Ge}).join(" | "),_e=[];for(let Be=1;Be<d.length;Be++){const De=b.parse(d[Be],1+_e.length);if(!De)return null;_e.push(ge(De.type))}b.error(`Expected arguments of type ${le}, but found (${_e.join(", ")}) instead.`)}return null}static register(d,b){no.definitions=b;for(const C in b)d[C]=no}}function Ps(g,d){let[b,C,R,U]=d;b=b.evaluate(g),C=C.evaluate(g),R=R.evaluate(g);const V=U?U.evaluate(g):1,K=Mc(b,C,R,V);if(K)throw new Vi(K);return new On(b/255,C/255,R/255,V,!1)}function dc(g,d){return g in d}function fc(g,d){const b=d[g];return b===void 0?null:b}function aa(g){return{type:g}}function Ac(g){if(g instanceof yn)return Ac(g.boundExpression);if(g instanceof no&&g.name==="error"||g instanceof ro||g instanceof xo||g instanceof Wa)return!1;const d=g instanceof os||g instanceof vo;let b=!0;return g.eachChild(C=>{b=d?b&&Ac(C):b&&C instanceof sa}),!!b&&co(g)&&Hl(g,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function co(g){if(g instanceof no&&(g.name==="get"&&g.args.length===1||g.name==="feature-state"||g.name==="has"&&g.args.length===1||g.name==="properties"||g.name==="geometry-type"||g.name==="id"||/^filter-/.test(g.name))||g instanceof xo||g instanceof Wa)return!1;let d=!0;return g.eachChild(b=>{d&&!co(b)&&(d=!1)}),d}function Ea(g){if(g instanceof no&&g.name==="feature-state")return!1;let d=!0;return g.eachChild(b=>{d&&!Ea(b)&&(d=!1)}),d}function Hl(g,d){if(g instanceof no&&d.indexOf(g.name)>=0)return!1;let b=!0;return g.eachChild(C=>{b&&!Hl(C,d)&&(b=!1)}),b}function Bi(g){return{result:"success",value:g}}function Xo(g){return{result:"error",value:g}}function pc(g){return g["property-type"]==="data-driven"||g["property-type"]==="cross-faded-data-driven"}function vd(g){return!!g.expression&&g.expression.parameters.indexOf("zoom")>-1}function Ah(g){return!!g.expression&&g.expression.interpolated}function xi(g){return g instanceof Number?"number":g instanceof String?"string":g instanceof Boolean?"boolean":Array.isArray(g)?"array":g===null?"null":typeof g}function Jo(g){return typeof g=="object"&&g!==null&&!Array.isArray(g)}function Ta(g){return g}function _l(g,d){const b=d.type==="color",C=g.stops&&typeof g.stops[0][0]=="object",R=C||!(C||g.property!==void 0),U=g.type||(Ah(d)?"exponential":"interval");if(b||d.type==="padding"){const _e=b?On.parse:bs.parse;(g=Cn({},g)).stops&&(g.stops=g.stops.map(Be=>[Be[0],_e(Be[1])])),g.default=_e(g.default?g.default:d.default)}if(g.colorSpace&&(V=g.colorSpace)!=="rgb"&&V!=="hcl"&&V!=="lab")throw new Error(`Unknown color space: "${g.colorSpace}"`);var V;let K,ee,le;if(U==="exponential")K=Oo;else if(U==="interval")K=la;else if(U==="categorical"){K=yl,ee=Object.create(null);for(const _e of g.stops)ee[_e[0]]=_e[1];le=typeof g.stops[0][0]}else{if(U!=="identity")throw new Error(`Unknown function type "${U}"`);K=Co}if(C){const _e={},Be=[];for(let et=0;et<g.stops.length;et++){const lt=g.stops[et],Ct=lt[0].zoom;_e[Ct]===void 0&&(_e[Ct]={zoom:Ct,type:g.type,property:g.property,default:g.default,stops:[]},Be.push(Ct)),_e[Ct].stops.push([lt[0].value,lt[1]])}const De=[];for(const et of Be)De.push([_e[et].zoom,_l(_e[et],d)]);const Ge={name:"linear"};return{kind:"composite",interpolationType:Ge,interpolationFactor:Dn.interpolationFactor.bind(void 0,Ge),zoomStops:De.map(et=>et[0]),evaluate:(et,lt)=>{let{zoom:Ct}=et;return Oo({stops:De,base:g.base},d,Ct).evaluate(Ct,lt)}}}if(R){const _e=U==="exponential"?{name:"exponential",base:g.base!==void 0?g.base:1}:null;return{kind:"camera",interpolationType:_e,interpolationFactor:Dn.interpolationFactor.bind(void 0,_e),zoomStops:g.stops.map(Be=>Be[0]),evaluate:Be=>{let{zoom:De}=Be;return K(g,d,De,ee,le)}}}return{kind:"source",evaluate(_e,Be){const De=Be&&Be.properties?Be.properties[g.property]:void 0;return De===void 0?Bo(g.default,d.default):K(g,d,De,ee,le)}}}function Bo(g,d,b){return g!==void 0?g:d!==void 0?d:b!==void 0?b:void 0}function yl(g,d,b,C,R){return Bo(typeof b===R?C[b]:void 0,g.default,d.default)}function la(g,d,b){if(xi(b)!=="number")return Bo(g.default,d.default);const C=g.stops.length;if(C===1||b<=g.stops[0][0])return g.stops[0][1];if(b>=g.stops[C-1][0])return g.stops[C-1][1];const R=uu(g.stops.map(U=>U[0]),b);return g.stops[R][1]}function Oo(g,d,b){const C=g.base!==void 0?g.base:1;if(xi(b)!=="number")return Bo(g.default,d.default);const R=g.stops.length;if(R===1||b<=g.stops[0][0])return g.stops[0][1];if(b>=g.stops[R-1][0])return g.stops[R-1][1];const U=uu(g.stops.map(_e=>_e[0]),b),V=function(_e,Be,De,Ge){const et=Ge-De,lt=_e-De;return et===0?0:Be===1?lt/et:(Math.pow(Be,lt)-1)/(Math.pow(Be,et)-1)}(b,C,g.stops[U][0],g.stops[U+1][0]),K=g.stops[U][1],ee=g.stops[U+1][1],le=ps[d.type]||Ta;return typeof K.evaluate=="function"?{evaluate(){for(var _e=arguments.length,Be=new Array(_e),De=0;De<_e;De++)Be[De]=arguments[De];const Ge=K.evaluate.apply(void 0,Be),et=ee.evaluate.apply(void 0,Be);if(Ge!==void 0&&et!==void 0)return le(Ge,et,V,g.colorSpace)}}:le(K,ee,V,g.colorSpace)}function Co(g,d,b){switch(d.type){case"color":b=On.parse(b);break;case"formatted":b=bi.fromString(b.toString());break;case"resolvedImage":b=Hi.fromString(b.toString());break;case"padding":b=bs.parse(b);break;default:xi(b)===d.type||d.type==="enum"&&d.values[b]||(b=void 0)}return Bo(b,g.default,d.default)}no.register(ml,{error:[{kind:"error"},[Tn],(g,d)=>{let[b]=d;throw new Vi(b.evaluate(g))}],typeof:[Tn,[Ve],(g,d)=>{let[b]=d;return ge(ts(b.evaluate(g)))}],"to-rgba":[Ae(Cr,4),[He],(g,d)=>{let[b]=d;const[C,R,U,V]=b.evaluate(g).rgb;return[255*C,255*R,255*U,V]}],rgb:[He,[Cr,Cr,Cr],Ps],rgba:[He,[Cr,Cr,Cr,Cr],Ps],has:{type:Xe,overloads:[[[Tn],(g,d)=>{let[b]=d;return dc(b.evaluate(g),g.properties())}],[[Tn,Je],(g,d)=>{let[b,C]=d;return dc(b.evaluate(g),C.evaluate(g))}]]},get:{type:Ve,overloads:[[[Tn],(g,d)=>{let[b]=d;return fc(b.evaluate(g),g.properties())}],[[Tn,Je],(g,d)=>{let[b,C]=d;return fc(b.evaluate(g),C.evaluate(g))}]]},"feature-state":[Ve,[Tn],(g,d)=>{let[b]=d;return fc(b.evaluate(g),g.featureState||{})}],properties:[Je,[],g=>g.properties()],"geometry-type":[Tn,[],g=>g.geometryType()],id:[Ve,[],g=>g.id()],zoom:[Cr,[],g=>g.globals.zoom],"heatmap-density":[Cr,[],g=>g.globals.heatmapDensity||0],"line-progress":[Cr,[],g=>g.globals.lineProgress||0],accumulated:[Ve,[],g=>g.globals.accumulated===void 0?null:g.globals.accumulated],"+":[Cr,aa(Cr),(g,d)=>{let b=0;for(const C of d)b+=C.evaluate(g);return b}],"*":[Cr,aa(Cr),(g,d)=>{let b=1;for(const C of d)b*=C.evaluate(g);return b}],"-":{type:Cr,overloads:[[[Cr,Cr],(g,d)=>{let[b,C]=d;return b.evaluate(g)-C.evaluate(g)}],[[Cr],(g,d)=>{let[b]=d;return-b.evaluate(g)}]]},"/":[Cr,[Cr,Cr],(g,d)=>{let[b,C]=d;return b.evaluate(g)/C.evaluate(g)}],"%":[Cr,[Cr,Cr],(g,d)=>{let[b,C]=d;return b.evaluate(g)%C.evaluate(g)}],ln2:[Cr,[],()=>Math.LN2],pi:[Cr,[],()=>Math.PI],e:[Cr,[],()=>Math.E],"^":[Cr,[Cr,Cr],(g,d)=>{let[b,C]=d;return Math.pow(b.evaluate(g),C.evaluate(g))}],sqrt:[Cr,[Cr],(g,d)=>{let[b]=d;return Math.sqrt(b.evaluate(g))}],log10:[Cr,[Cr],(g,d)=>{let[b]=d;return Math.log(b.evaluate(g))/Math.LN10}],ln:[Cr,[Cr],(g,d)=>{let[b]=d;return Math.log(b.evaluate(g))}],log2:[Cr,[Cr],(g,d)=>{let[b]=d;return Math.log(b.evaluate(g))/Math.LN2}],sin:[Cr,[Cr],(g,d)=>{let[b]=d;return Math.sin(b.evaluate(g))}],cos:[Cr,[Cr],(g,d)=>{let[b]=d;return Math.cos(b.evaluate(g))}],tan:[Cr,[Cr],(g,d)=>{let[b]=d;return Math.tan(b.evaluate(g))}],asin:[Cr,[Cr],(g,d)=>{let[b]=d;return Math.asin(b.evaluate(g))}],acos:[Cr,[Cr],(g,d)=>{let[b]=d;return Math.acos(b.evaluate(g))}],atan:[Cr,[Cr],(g,d)=>{let[b]=d;return Math.atan(b.evaluate(g))}],min:[Cr,aa(Cr),(g,d)=>Math.min(...d.map(b=>b.evaluate(g)))],max:[Cr,aa(Cr),(g,d)=>Math.max(...d.map(b=>b.evaluate(g)))],abs:[Cr,[Cr],(g,d)=>{let[b]=d;return Math.abs(b.evaluate(g))}],round:[Cr,[Cr],(g,d)=>{let[b]=d;const C=b.evaluate(g);return C<0?-Math.round(-C):Math.round(C)}],floor:[Cr,[Cr],(g,d)=>{let[b]=d;return Math.floor(b.evaluate(g))}],ceil:[Cr,[Cr],(g,d)=>{let[b]=d;return Math.ceil(b.evaluate(g))}],"filter-==":[Xe,[Tn,Ve],(g,d)=>{let[b,C]=d;return g.properties()[b.value]===C.value}],"filter-id-==":[Xe,[Ve],(g,d)=>{let[b]=d;return g.id()===b.value}],"filter-type-==":[Xe,[Tn],(g,d)=>{let[b]=d;return g.geometryType()===b.value}],"filter-<":[Xe,[Tn,Ve],(g,d)=>{let[b,C]=d;const R=g.properties()[b.value],U=C.value;return typeof R==typeof U&&R<U}],"filter-id-<":[Xe,[Ve],(g,d)=>{let[b]=d;const C=g.id(),R=b.value;return typeof C==typeof R&&C<R}],"filter->":[Xe,[Tn,Ve],(g,d)=>{let[b,C]=d;const R=g.properties()[b.value],U=C.value;return typeof R==typeof U&&R>U}],"filter-id->":[Xe,[Ve],(g,d)=>{let[b]=d;const C=g.id(),R=b.value;return typeof C==typeof R&&C>R}],"filter-<=":[Xe,[Tn,Ve],(g,d)=>{let[b,C]=d;const R=g.properties()[b.value],U=C.value;return typeof R==typeof U&&R<=U}],"filter-id-<=":[Xe,[Ve],(g,d)=>{let[b]=d;const C=g.id(),R=b.value;return typeof C==typeof R&&C<=R}],"filter->=":[Xe,[Tn,Ve],(g,d)=>{let[b,C]=d;const R=g.properties()[b.value],U=C.value;return typeof R==typeof U&&R>=U}],"filter-id->=":[Xe,[Ve],(g,d)=>{let[b]=d;const C=g.id(),R=b.value;return typeof C==typeof R&&C>=R}],"filter-has":[Xe,[Ve],(g,d)=>{let[b]=d;return b.value in g.properties()}],"filter-has-id":[Xe,[],g=>g.id()!==null&&g.id()!==void 0],"filter-type-in":[Xe,[Ae(Tn)],(g,d)=>{let[b]=d;return b.value.indexOf(g.geometryType())>=0}],"filter-id-in":[Xe,[Ae(Ve)],(g,d)=>{let[b]=d;return b.value.indexOf(g.id())>=0}],"filter-in-small":[Xe,[Tn,Ae(Ve)],(g,d)=>{let[b,C]=d;return C.value.indexOf(g.properties()[b.value])>=0}],"filter-in-large":[Xe,[Tn,Ae(Ve)],(g,d)=>{let[b,C]=d;return function(R,U,V,K){for(;V<=K;){const ee=V+K>>1;if(U[ee]===R)return!0;U[ee]>R?K=ee-1:V=ee+1}return!1}(g.properties()[b.value],C.value,0,C.value.length-1)}],all:{type:Xe,overloads:[[[Xe,Xe],(g,d)=>{let[b,C]=d;return b.evaluate(g)&&C.evaluate(g)}],[aa(Xe),(g,d)=>{for(const b of d)if(!b.evaluate(g))return!1;return!0}]]},any:{type:Xe,overloads:[[[Xe,Xe],(g,d)=>{let[b,C]=d;return b.evaluate(g)||C.evaluate(g)}],[aa(Xe),(g,d)=>{for(const b of d)if(b.evaluate(g))return!0;return!1}]]},"!":[Xe,[Xe],(g,d)=>{let[b]=d;return!b.evaluate(g)}],"is-supported-script":[Xe,[Tn],(g,d)=>{let[b]=d;const C=g.globals&&g.globals.isSupportedScript;return!C||C(b.evaluate(g))}],upcase:[Tn,[Tn],(g,d)=>{let[b]=d;return b.evaluate(g).toUpperCase()}],downcase:[Tn,[Tn],(g,d)=>{let[b]=d;return b.evaluate(g).toLowerCase()}],concat:[Tn,aa(Ve),(g,d)=>d.map(b=>ss(b.evaluate(g))).join("")],"resolved-locale":[Tn,[bt],(g,d)=>{let[b]=d;return b.evaluate(g).resolvedLocale()}]});class kc{constructor(d,b){var C;this.expression=d,this._warningHistory={},this._evaluator=new ds,this._defaultValue=b?(C=b).type==="color"&&Jo(C.default)?new On(0,0,0,0):C.type==="color"?On.parse(C.default)||null:C.type==="padding"?bs.parse(C.default)||null:C.type==="variableAnchorOffsetCollection"?Ks.parse(C.default)||null:C.default===void 0?null:C.default:null,this._enumValues=b&&b.type==="enum"?b.values:null}evaluateWithoutErrorHandling(d,b,C,R,U,V){return this._evaluator.globals=d,this._evaluator.feature=b,this._evaluator.featureState=C,this._evaluator.canonical=R,this._evaluator.availableImages=U||null,this._evaluator.formattedSection=V,this.expression.evaluate(this._evaluator)}evaluate(d,b,C,R,U,V){this._evaluator.globals=d,this._evaluator.feature=b||null,this._evaluator.featureState=C||null,this._evaluator.canonical=R,this._evaluator.availableImages=U||null,this._evaluator.formattedSection=V||null;try{const K=this.expression.evaluate(this._evaluator);if(K==null||typeof K=="number"&&K!=K)return this._defaultValue;if(this._enumValues&&!(K in this._enumValues))throw new Vi(`Expected value to be one of ${Object.keys(this._enumValues).map(ee=>JSON.stringify(ee)).join(", ")}, but found ${JSON.stringify(K)} instead.`);return K}catch(K){return this._warningHistory[K.message]||(this._warningHistory[K.message]=!0,typeof console<"u"&&console.warn(K.message)),this._defaultValue}}}function bl(g){return Array.isArray(g)&&g.length>0&&typeof g[0]=="string"&&g[0]in ml}function Eo(g,d){const b=new ri(ml,Ac,[],d?function(R){const U={color:He,string:Tn,number:Cr,enum:Tn,boolean:Xe,formatted:Mt,padding:$t,resolvedImage:Wt,variableAnchorOffsetCollection:Pe};return R.type==="array"?Ae(U[R.value]||Ve,R.length):U[R.type]}(d):void 0),C=b.parse(g,void 0,void 0,void 0,d&&d.type==="string"?{typeAnnotation:"coerce"}:void 0);return C?Bi(new kc(C,d)):Xo(b.errors)}class uo{constructor(d,b){this.kind=d,this._styleExpression=b,this.isStateDependent=d!=="constant"&&!Ea(b.expression)}evaluateWithoutErrorHandling(d,b,C,R,U,V){return this._styleExpression.evaluateWithoutErrorHandling(d,b,C,R,U,V)}evaluate(d,b,C,R,U,V){return this._styleExpression.evaluate(d,b,C,R,U,V)}}class ca{constructor(d,b,C,R){this.kind=d,this.zoomStops=C,this._styleExpression=b,this.isStateDependent=d!=="camera"&&!Ea(b.expression),this.interpolationType=R}evaluateWithoutErrorHandling(d,b,C,R,U,V){return this._styleExpression.evaluateWithoutErrorHandling(d,b,C,R,U,V)}evaluate(d,b,C,R,U,V){return this._styleExpression.evaluate(d,b,C,R,U,V)}interpolationFactor(d,b,C){return this.interpolationType?Dn.interpolationFactor(this.interpolationType,d,b,C):0}}function Vl(g,d){const b=Eo(g,d);if(b.result==="error")return b;const C=b.value.expression,R=co(C);if(!R&&!pc(d))return Xo([new Rn("","data expressions not supported")]);const U=Hl(C,["zoom"]);if(!U&&!vd(d))return Xo([new Rn("","zoom expressions not supported")]);const V=ua(C);return V||U?V instanceof Rn?Xo([V]):V instanceof Dn&&!Ah(d)?Xo([new Rn("",'"interpolate" expressions cannot be used with this property')]):Bi(V?new ca(R?"camera":"composite",b.value,V.labels,V instanceof Dn?V.interpolation:void 0):new uo(R?"constant":"source",b.value)):Xo([new Rn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Zo{constructor(d,b){this._parameters=d,this._specification=b,Cn(this,_l(this._parameters,this._specification))}static deserialize(d){return new Zo(d._parameters,d._specification)}static serialize(d){return{_parameters:d._parameters,_specification:d._specification}}}function ua(g){let d=null;if(g instanceof lo)d=ua(g.result);else if(g instanceof hu){for(const b of g.args)if(d=ua(b),d)break}else(g instanceof Us||g instanceof Dn)&&g.input instanceof no&&g.input.name==="zoom"&&(d=g);return d instanceof Rn||g.eachChild(b=>{const C=ua(b);C instanceof Rn?d=C:!d&&C?d=new Rn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):d&&C&&d!==C&&(d=new Rn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),d}function Uc(g){if(g===!0||g===!1)return!0;if(!Array.isArray(g)||g.length===0)return!1;switch(g[0]){case"has":return g.length>=2&&g[1]!=="$id"&&g[1]!=="$type";case"in":return g.length>=3&&(typeof g[1]!="string"||Array.isArray(g[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return g.length!==3||Array.isArray(g[1])||Array.isArray(g[2]);case"any":case"all":for(const d of g.slice(1))if(!Uc(d)&&typeof d!="boolean")return!1;return!0;default:return!0}}const ho={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Yo(g){if(g==null)return{filter:()=>!0,needGeometry:!1};Uc(g)||(g=Kn(g));const d=Eo(g,ho);if(d.result==="error")throw new Error(d.value.map(b=>`${b.key}: ${b.message}`).join(", "));return{filter:(b,C,R)=>d.value.evaluate(b,C,{},R),needGeometry:ji(g)}}function ls(g,d){return g<d?-1:g>d?1:0}function ji(g){if(!Array.isArray(g))return!1;if(g[0]==="within"||g[0]==="distance")return!0;for(let d=1;d<g.length;d++)if(ji(g[d]))return!0;return!1}function Kn(g){if(!g)return!0;const d=g[0];return g.length<=1?d!=="any":d==="=="?Fs(g[1],g[2],"=="):d==="!="?xs(Fs(g[1],g[2],"==")):d==="<"||d===">"||d==="<="||d===">="?Fs(g[1],g[2],d):d==="any"?(b=g.slice(1),["any"].concat(b.map(Kn))):d==="all"?["all"].concat(g.slice(1).map(Kn)):d==="none"?["all"].concat(g.slice(1).map(Kn).map(xs)):d==="in"?Xa(g[1],g.slice(2)):d==="!in"?xs(Xa(g[1],g.slice(2))):d==="has"?Ja(g[1]):d!=="!has"||xs(Ja(g[1]));var b}function Fs(g,d,b){switch(g){case"$type":return[`filter-type-${b}`,d];case"$id":return[`filter-id-${b}`,d];default:return[`filter-${b}`,g,d]}}function Xa(g,d){if(d.length===0)return!1;switch(g){case"$type":return["filter-type-in",["literal",d]];case"$id":return["filter-id-in",["literal",d]];default:return d.length>200&&!d.some(b=>typeof b!=typeof d[0])?["filter-in-large",g,["literal",d.sort(ls)]]:["filter-in-small",g,["literal",d]]}}function Ja(g){switch(g){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",g]}}function xs(g){return["!",g]}function vl(g){const d=typeof g;if(d==="number"||d==="boolean"||d==="string"||g==null)return JSON.stringify(g);if(Array.isArray(g)){let R="[";for(const U of g)R+=`${vl(U)},`;return`${R}]`}const b=Object.keys(g).sort();let C="{";for(let R=0;R<b.length;R++)C+=`${JSON.stringify(b[R])}:${vl(g[b[R]])},`;return`${C}}`}function vf(g){let d="";for(const b of Pn)d+=`/${vl(g[b])}`;return d}function xd(g){const d=g.value;return d?[new br(g.key,d,"constants have been deprecated as of v8")]:[]}function Ns(g){return g instanceof Number||g instanceof String||g instanceof Boolean?g.valueOf():g}function ha(g){if(Array.isArray(g))return g.map(ha);if(g instanceof Object&&!(g instanceof Number||g instanceof String||g instanceof Boolean)){const d={};for(const b in g)d[b]=ha(g[b]);return d}return Ns(g)}function ko(g){const d=g.key,b=g.value,C=g.valueSpec||{},R=g.objectElementValidators||{},U=g.style,V=g.styleSpec,K=g.validateSpec;let ee=[];const le=xi(b);if(le!=="object")return[new br(d,b,`object expected, ${le} found`)];for(const _e in b){const Be=_e.split(".")[0],De=C[Be]||C["*"];let Ge;if(R[Be])Ge=R[Be];else if(C[Be])Ge=K;else if(R["*"])Ge=R["*"];else{if(!C["*"]){ee.push(new br(d,b[_e],`unknown property "${_e}"`));continue}Ge=K}ee=ee.concat(Ge({key:(d&&`${d}.`)+_e,value:b[_e],valueSpec:De,style:U,styleSpec:V,object:b,objectKey:_e,validateSpec:K},b))}for(const _e in C)R[_e]||C[_e].required&&C[_e].default===void 0&&b[_e]===void 0&&ee.push(new br(d,b,`missing required property "${_e}"`));return ee}function Nc(g){const d=g.value,b=g.valueSpec,C=g.style,R=g.styleSpec,U=g.key,V=g.arrayElementValidator||g.validateSpec;if(xi(d)!=="array")return[new br(U,d,`array expected, ${xi(d)} found`)];if(b.length&&d.length!==b.length)return[new br(U,d,`array length ${b.length} expected, length ${d.length} found`)];if(b["min-length"]&&d.length<b["min-length"])return[new br(U,d,`array length at least ${b["min-length"]} expected, length ${d.length} found`)];let K={type:b.value,values:b.values};R.$version<7&&(K.function=b.function),xi(b.value)==="object"&&(K=b.value);let ee=[];for(let le=0;le<d.length;le++)ee=ee.concat(V({array:d,arrayIndex:le,value:d[le],valueSpec:K,validateSpec:g.validateSpec,style:C,styleSpec:R,key:`${U}[${le}]`}));return ee}function gc(g){const d=g.key,b=g.value,C=g.valueSpec;let R=xi(b);return R==="number"&&b!=b&&(R="NaN"),R!=="number"?[new br(d,b,`number expected, ${R} found`)]:"minimum"in C&&b<C.minimum?[new br(d,b,`${b} is less than the minimum value ${C.minimum}`)]:"maximum"in C&&b>C.maximum?[new br(d,b,`${b} is greater than the maximum value ${C.maximum}`)]:[]}function mc(g){const d=g.valueSpec,b=Ns(g.value.type);let C,R,U,V={};const K=b!=="categorical"&&g.value.property===void 0,ee=!K,le=xi(g.value.stops)==="array"&&xi(g.value.stops[0])==="array"&&xi(g.value.stops[0][0])==="object",_e=ko({key:g.key,value:g.value,valueSpec:g.styleSpec.function,validateSpec:g.validateSpec,style:g.style,styleSpec:g.styleSpec,objectElementValidators:{stops:function(Ge){if(b==="identity")return[new br(Ge.key,Ge.value,'identity function may not have a "stops" property')];let et=[];const lt=Ge.value;return et=et.concat(Nc({key:Ge.key,value:lt,valueSpec:Ge.valueSpec,validateSpec:Ge.validateSpec,style:Ge.style,styleSpec:Ge.styleSpec,arrayElementValidator:Be})),xi(lt)==="array"&&lt.length===0&&et.push(new br(Ge.key,lt,"array must have at least one stop")),et},default:function(Ge){return Ge.validateSpec({key:Ge.key,value:Ge.value,valueSpec:d,validateSpec:Ge.validateSpec,style:Ge.style,styleSpec:Ge.styleSpec})}}});return b==="identity"&&K&&_e.push(new br(g.key,g.value,'missing required property "property"')),b==="identity"||g.value.stops||_e.push(new br(g.key,g.value,'missing required property "stops"')),b==="exponential"&&g.valueSpec.expression&&!Ah(g.valueSpec)&&_e.push(new br(g.key,g.value,"exponential functions not supported")),g.styleSpec.$version>=8&&(ee&&!pc(g.valueSpec)?_e.push(new br(g.key,g.value,"property functions not supported")):K&&!vd(g.valueSpec)&&_e.push(new br(g.key,g.value,"zoom functions not supported"))),b!=="categorical"&&!le||g.value.property!==void 0||_e.push(new br(g.key,g.value,'"property" property is required')),_e;function Be(Ge){let et=[];const lt=Ge.value,Ct=Ge.key;if(xi(lt)!=="array")return[new br(Ct,lt,`array expected, ${xi(lt)} found`)];if(lt.length!==2)return[new br(Ct,lt,`array length 2 expected, length ${lt.length} found`)];if(le){if(xi(lt[0])!=="object")return[new br(Ct,lt,`object expected, ${xi(lt[0])} found`)];if(lt[0].zoom===void 0)return[new br(Ct,lt,"object stop key must have zoom")];if(lt[0].value===void 0)return[new br(Ct,lt,"object stop key must have value")];if(U&&U>Ns(lt[0].zoom))return[new br(Ct,lt[0].zoom,"stop zoom values must appear in ascending order")];Ns(lt[0].zoom)!==U&&(U=Ns(lt[0].zoom),R=void 0,V={}),et=et.concat(ko({key:`${Ct}[0]`,value:lt[0],valueSpec:{zoom:{}},validateSpec:Ge.validateSpec,style:Ge.style,styleSpec:Ge.styleSpec,objectElementValidators:{zoom:gc,value:De}}))}else et=et.concat(De({key:`${Ct}[0]`,value:lt[0],valueSpec:{},validateSpec:Ge.validateSpec,style:Ge.style,styleSpec:Ge.styleSpec},lt));return bl(ha(lt[1]))?et.concat([new br(`${Ct}[1]`,lt[1],"expressions are not allowed in function stops.")]):et.concat(Ge.validateSpec({key:`${Ct}[1]`,value:lt[1],valueSpec:d,validateSpec:Ge.validateSpec,style:Ge.style,styleSpec:Ge.styleSpec}))}function De(Ge,et){const lt=xi(Ge.value),Ct=Ns(Ge.value),p=Ge.value!==null?Ge.value:et;if(C){if(lt!==C)return[new br(Ge.key,p,`${lt} stop domain type must match previous stop domain type ${C}`)]}else C=lt;if(lt!=="number"&&lt!=="string"&&lt!=="boolean")return[new br(Ge.key,p,"stop domain value must be a number, string, or boolean")];if(lt!=="number"&&b!=="categorical"){let u=`number expected, ${lt} found`;return pc(d)&&b===void 0&&(u+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new br(Ge.key,p,u)]}return b!=="categorical"||lt!=="number"||isFinite(Ct)&&Math.floor(Ct)===Ct?b!=="categorical"&&lt==="number"&&R!==void 0&&Ct<R?[new br(Ge.key,p,"stop domain values must appear in ascending order")]:(R=Ct,b==="categorical"&&Ct in V?[new br(Ge.key,p,"stop domain values must be unique")]:(V[Ct]=!0,[])):[new br(Ge.key,p,`integer expected, found ${Ct}`)]}}function mo(g){const d=(g.expressionContext==="property"?Vl:Eo)(ha(g.value),g.valueSpec);if(d.result==="error")return d.value.map(C=>new br(`${g.key}${C.key}`,g.value,C.message));const b=d.value.expression||d.value._styleExpression.expression;if(g.expressionContext==="property"&&g.propertyKey==="text-font"&&!b.outputDefined())return[new br(g.key,g.value,`Invalid data expression for "${g.propertyKey}". Output values must be contained as literals within the expression.`)];if(g.expressionContext==="property"&&g.propertyType==="layout"&&!Ea(b))return[new br(g.key,g.value,'"feature-state" data expressions are not supported with layout properties.')];if(g.expressionContext==="filter"&&!Ea(b))return[new br(g.key,g.value,'"feature-state" data expressions are not supported with filters.')];if(g.expressionContext&&g.expressionContext.indexOf("cluster")===0){if(!Hl(b,["zoom","feature-state"]))return[new br(g.key,g.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(g.expressionContext==="cluster-initial"&&!co(b))return[new br(g.key,g.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function zs(g){const d=g.key,b=g.value,C=g.valueSpec,R=[];return Array.isArray(C.values)?C.values.indexOf(Ns(b))===-1&&R.push(new br(d,b,`expected one of [${C.values.join(", ")}], ${JSON.stringify(b)} found`)):Object.keys(C.values).indexOf(Ns(b))===-1&&R.push(new br(d,b,`expected one of [${Object.keys(C.values).join(", ")}], ${JSON.stringify(b)} found`)),R}function zc(g){return Uc(ha(g.value))?mo(Cn({},g,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Hc(g)}function Hc(g){const d=g.value,b=g.key;if(xi(d)!=="array")return[new br(b,d,`array expected, ${xi(d)} found`)];const C=g.styleSpec;let R,U=[];if(d.length<1)return[new br(b,d,"filter array must have at least 1 element")];switch(U=U.concat(zs({key:`${b}[0]`,value:d[0],valueSpec:C.filter_operator,style:g.style,styleSpec:g.styleSpec})),Ns(d[0])){case"<":case"<=":case">":case">=":d.length>=2&&Ns(d[1])==="$type"&&U.push(new br(b,d,`"$type" cannot be use with operator "${d[0]}"`));case"==":case"!=":d.length!==3&&U.push(new br(b,d,`filter array for operator "${d[0]}" must have 3 elements`));case"in":case"!in":d.length>=2&&(R=xi(d[1]),R!=="string"&&U.push(new br(`${b}[1]`,d[1],`string expected, ${R} found`)));for(let V=2;V<d.length;V++)R=xi(d[V]),Ns(d[1])==="$type"?U=U.concat(zs({key:`${b}[${V}]`,value:d[V],valueSpec:C.geometry_type,style:g.style,styleSpec:g.styleSpec})):R!=="string"&&R!=="number"&&R!=="boolean"&&U.push(new br(`${b}[${V}]`,d[V],`string, number, or boolean expected, ${R} found`));break;case"any":case"all":case"none":for(let V=1;V<d.length;V++)U=U.concat(Hc({key:`${b}[${V}]`,value:d[V],style:g.style,styleSpec:g.styleSpec}));break;case"has":case"!has":R=xi(d[1]),d.length!==2?U.push(new br(b,d,`filter array for "${d[0]}" operator must have 2 elements`)):R!=="string"&&U.push(new br(`${b}[1]`,d[1],`string expected, ${R} found`))}return U}function wd(g,d){const b=g.key,C=g.validateSpec,R=g.style,U=g.styleSpec,V=g.value,K=g.objectKey,ee=U[`${d}_${g.layerType}`];if(!ee)return[];const le=K.match(/^(.*)-transition$/);if(d==="paint"&&le&&ee[le[1]]&&ee[le[1]].transition)return C({key:b,value:V,valueSpec:U.transition,style:R,styleSpec:U});const _e=g.valueSpec||ee[K];if(!_e)return[new br(b,V,`unknown property "${K}"`)];let Be;if(xi(V)==="string"&&pc(_e)&&!_e.tokens&&(Be=/^{([^}]+)}$/.exec(V)))return[new br(b,V,`"${K}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(Be[1])} }\`.`)];const De=[];return g.layerType==="symbol"&&(K==="text-field"&&R&&!R.glyphs&&De.push(new br(b,V,'use of "text-field" requires a style "glyphs" property')),K==="text-font"&&Jo(ha(V))&&Ns(V.type)==="identity"&&De.push(new br(b,V,'"text-font" does not support identity functions'))),De.concat(C({key:g.key,value:V,valueSpec:_e,style:R,styleSpec:U,expressionContext:"property",propertyType:d,propertyKey:K}))}function _c(g){return wd(g,"paint")}function zu(g){return wd(g,"layout")}function ph(g){let d=[];const b=g.value,C=g.key,R=g.style,U=g.styleSpec;b.type||b.ref||d.push(new br(C,b,'either "type" or "ref" is required'));let V=Ns(b.type);const K=Ns(b.ref);if(b.id){const ee=Ns(b.id);for(let le=0;le<g.arrayIndex;le++){const _e=R.layers[le];Ns(_e.id)===ee&&d.push(new br(C,b.id,`duplicate layer id "${b.id}", previously used at line ${_e.id.__line__}`))}}if("ref"in b){let ee;["type","source","source-layer","filter","layout"].forEach(le=>{le in b&&d.push(new br(C,b[le],`"${le}" is prohibited for ref layers`))}),R.layers.forEach(le=>{Ns(le.id)===K&&(ee=le)}),ee?ee.ref?d.push(new br(C,b.ref,"ref cannot reference another ref layer")):V=Ns(ee.type):d.push(new br(C,b.ref,`ref layer "${K}" not found`))}else if(V!=="background")if(b.source){const ee=R.sources&&R.sources[b.source],le=ee&&Ns(ee.type);ee?le==="vector"&&V==="raster"?d.push(new br(C,b.source,`layer "${b.id}" requires a raster source`)):le!=="raster-dem"&&V==="hillshade"?d.push(new br(C,b.source,`layer "${b.id}" requires a raster-dem source`)):le==="raster"&&V!=="raster"?d.push(new br(C,b.source,`layer "${b.id}" requires a vector source`)):le!=="vector"||b["source-layer"]?le==="raster-dem"&&V!=="hillshade"?d.push(new br(C,b.source,"raster-dem source can only be used with layer type 'hillshade'.")):V!=="line"||!b.paint||!b.paint["line-gradient"]||le==="geojson"&&ee.lineMetrics||d.push(new br(C,b,`layer "${b.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):d.push(new br(C,b,`layer "${b.id}" must specify a "source-layer"`)):d.push(new br(C,b.source,`source "${b.source}" not found`))}else d.push(new br(C,b,'missing required property "source"'));return d=d.concat(ko({key:C,value:b,valueSpec:U.layer,style:g.style,styleSpec:g.styleSpec,validateSpec:g.validateSpec,objectElementValidators:{"*":()=>[],type:()=>g.validateSpec({key:`${C}.type`,value:b.type,valueSpec:U.layer.type,style:g.style,styleSpec:g.styleSpec,validateSpec:g.validateSpec,object:b,objectKey:"type"}),filter:zc,layout:ee=>ko({layer:b,key:ee.key,value:ee.value,style:ee.style,styleSpec:ee.styleSpec,validateSpec:ee.validateSpec,objectElementValidators:{"*":le=>zu(Cn({layerType:V},le))}}),paint:ee=>ko({layer:b,key:ee.key,value:ee.value,style:ee.style,styleSpec:ee.styleSpec,validateSpec:ee.validateSpec,objectElementValidators:{"*":le=>_c(Cn({layerType:V},le))}})}})),d}function Gl(g){const d=g.value,b=g.key,C=xi(d);return C!=="string"?[new br(b,d,`string expected, ${C} found`)]:[]}const Vc={promoteId:function(g){let{key:d,value:b}=g;if(xi(b)==="string")return Gl({key:d,value:b});{const C=[];for(const R in b)C.push(...Gl({key:`${d}.${R}`,value:b[R]}));return C}}};function Gc(g){const d=g.value,b=g.key,C=g.styleSpec,R=g.style,U=g.validateSpec;if(!d.type)return[new br(b,d,'"type" is required')];const V=Ns(d.type);let K;switch(V){case"vector":case"raster":return K=ko({key:b,value:d,valueSpec:C[`source_${V.replace("-","_")}`],style:g.style,styleSpec:C,objectElementValidators:Vc,validateSpec:U}),K;case"raster-dem":return K=function(ee){var le;const _e=(le=ee.sourceName)!==null&&le!==void 0?le:"",Be=ee.value,De=ee.styleSpec,Ge=De.source_raster_dem,et=ee.style;let lt=[];const Ct=xi(Be);if(Be===void 0)return lt;if(Ct!=="object")return lt.push(new br("source_raster_dem",Be,`object expected, ${Ct} found`)),lt;const p=Ns(Be.encoding)==="custom",u=["redFactor","greenFactor","blueFactor","baseShift"],A=ee.value.encoding?`"${ee.value.encoding}"`:"Default";for(const v in Be)!p&&u.includes(v)?lt.push(new br(v,Be[v],`In "${_e}": "${v}" is only valid when "encoding" is set to "custom". ${A} encoding found`)):Ge[v]?lt=lt.concat(ee.validateSpec({key:v,value:Be[v],valueSpec:Ge[v],validateSpec:ee.validateSpec,style:et,styleSpec:De})):lt.push(new br(v,Be[v],`unknown property "${v}"`));return lt}({sourceName:b,value:d,style:g.style,styleSpec:C,validateSpec:U}),K;case"geojson":if(K=ko({key:b,value:d,valueSpec:C.source_geojson,style:R,styleSpec:C,validateSpec:U,objectElementValidators:Vc}),d.cluster)for(const ee in d.clusterProperties){const[le,_e]=d.clusterProperties[ee],Be=typeof le=="string"?[le,["accumulated"],["get",ee]]:le;K.push(...mo({key:`${b}.${ee}.map`,value:_e,validateSpec:U,expressionContext:"cluster-map"})),K.push(...mo({key:`${b}.${ee}.reduce`,value:Be,validateSpec:U,expressionContext:"cluster-reduce"}))}return K;case"video":return ko({key:b,value:d,valueSpec:C.source_video,style:R,validateSpec:U,styleSpec:C});case"image":return ko({key:b,value:d,valueSpec:C.source_image,style:R,validateSpec:U,styleSpec:C});case"canvas":return[new br(b,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return zs({key:`${b}.type`,value:d.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:R,validateSpec:U,styleSpec:C})}}function _u(g){const d=g.value,b=g.styleSpec,C=b.light,R=g.style;let U=[];const V=xi(d);if(d===void 0)return U;if(V!=="object")return U=U.concat([new br("light",d,`object expected, ${V} found`)]),U;for(const K in d){const ee=K.match(/^(.*)-transition$/);U=U.concat(ee&&C[ee[1]]&&C[ee[1]].transition?g.validateSpec({key:K,value:d[K],valueSpec:b.transition,validateSpec:g.validateSpec,style:R,styleSpec:b}):C[K]?g.validateSpec({key:K,value:d[K],valueSpec:C[K],validateSpec:g.validateSpec,style:R,styleSpec:b}):[new br(K,d[K],`unknown property "${K}"`)])}return U}function Qc(g){const d=g.value,b=g.styleSpec,C=b.sky,R=g.style,U=xi(d);if(d===void 0)return[];if(U!=="object")return[new br("sky",d,`object expected, ${U} found`)];let V=[];for(const K in d)V=V.concat(C[K]?g.validateSpec({key:K,value:d[K],valueSpec:C[K],style:R,styleSpec:b}):[new br(K,d[K],`unknown property "${K}"`)]);return V}function Hu(g){const d=g.value,b=g.styleSpec,C=b.terrain,R=g.style;let U=[];const V=xi(d);if(d===void 0)return U;if(V!=="object")return U=U.concat([new br("terrain",d,`object expected, ${V} found`)]),U;for(const K in d)U=U.concat(C[K]?g.validateSpec({key:K,value:d[K],valueSpec:C[K],validateSpec:g.validateSpec,style:R,styleSpec:b}):[new br(K,d[K],`unknown property "${K}"`)]);return U}function zh(g){let d=[];const b=g.value,C=g.key;if(Array.isArray(b)){const R=[],U=[];for(const V in b)b[V].id&&R.includes(b[V].id)&&d.push(new br(C,b,`all the sprites' ids must be unique, but ${b[V].id} is duplicated`)),R.push(b[V].id),b[V].url&&U.includes(b[V].url)&&d.push(new br(C,b,`all the sprites' URLs must be unique, but ${b[V].url} is duplicated`)),U.push(b[V].url),d=d.concat(ko({key:`${C}[${V}]`,value:b[V],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:g.validateSpec}));return d}return Gl({key:C,value:b})}const yu={"*":()=>[],array:Nc,boolean:function(g){const d=g.value,b=g.key,C=xi(d);return C!=="boolean"?[new br(b,d,`boolean expected, ${C} found`)]:[]},number:gc,color:function(g){const d=g.key,b=g.value,C=xi(b);return C!=="string"?[new br(d,b,`color expected, ${C} found`)]:On.parse(String(b))?[]:[new br(d,b,`color expected, "${b}" found`)]},constants:xd,enum:zs,filter:zc,function:mc,layer:ph,object:ko,source:Gc,light:_u,sky:Qc,terrain:Hu,projection:function(g){const d=g.value,b=g.styleSpec,C=b.projection,R=g.style,U=xi(d);if(d===void 0)return[];if(U!=="object")return[new br("projection",d,`object expected, ${U} found`)];let V=[];for(const K in d)V=V.concat(C[K]?g.validateSpec({key:K,value:d[K],valueSpec:C[K],style:R,styleSpec:b}):[new br(K,d[K],`unknown property "${K}"`)]);return V},string:Gl,formatted:function(g){return Gl(g).length===0?[]:mo(g)},resolvedImage:function(g){return Gl(g).length===0?[]:mo(g)},padding:function(g){const d=g.key,b=g.value;if(xi(b)==="array"){if(b.length<1||b.length>4)return[new br(d,b,`padding requires 1 to 4 values; ${b.length} values found`)];const C={type:"number"};let R=[];for(let U=0;U<b.length;U++)R=R.concat(g.validateSpec({key:`${d}[${U}]`,value:b[U],validateSpec:g.validateSpec,valueSpec:C}));return R}return gc({key:d,value:b,valueSpec:{}})},variableAnchorOffsetCollection:function(g){const d=g.key,b=g.value,C=xi(b),R=g.styleSpec;if(C!=="array"||b.length<1||b.length%2!=0)return[new br(d,b,"variableAnchorOffsetCollection requires a non-empty array of even length")];let U=[];for(let V=0;V<b.length;V+=2)U=U.concat(zs({key:`${d}[${V}]`,value:b[V],valueSpec:R.layout_symbol["text-anchor"]})),U=U.concat(Nc({key:`${d}[${V+1}]`,value:b[V+1],valueSpec:{length:2,value:"number"},validateSpec:g.validateSpec,style:g.style,styleSpec:R}));return U},sprite:zh};function Qi(g){const d=g.value,b=g.valueSpec,C=g.styleSpec;return g.validateSpec=Qi,b.expression&&Jo(Ns(d))?mc(g):b.expression&&bl(ha(d))?mo(g):b.type&&yu[b.type]?yu[b.type](g):ko(Cn({},g,{valueSpec:b.type?C[b.type]:b}))}function bu(g){const d=g.value,b=g.key,C=Gl(g);return C.length||(d.indexOf("{fontstack}")===-1&&C.push(new br(b,d,'"glyphs" url must include a "{fontstack}" token')),d.indexOf("{range}")===-1&&C.push(new br(b,d,'"glyphs" url must include a "{range}" token'))),C}function Hs(g){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:We,b=[];return b=b.concat(Qi({key:"",value:g,valueSpec:d.$root,styleSpec:d,style:g,validateSpec:Qi,objectElementValidators:{glyphs:bu,"*":()=>[]}})),g.constants&&(b=b.concat(xd({key:"constants",value:g.constants,style:g,styleSpec:d,validateSpec:Qi}))),Hh(b)}function xl(g){return function(d){return g({...d,validateSpec:Qi})}}function Hh(g){return[].concat(g).sort((d,b)=>d.line-b.line)}function Sa(g){return function(){for(var d=arguments.length,b=new Array(d),C=0;C<d;C++)b[C]=arguments[C];return Hh(g.apply(this,b))}}Hs.source=Sa(xl(Gc)),Hs.sprite=Sa(xl(zh)),Hs.glyphs=Sa(xl(bu)),Hs.light=Sa(xl(_u)),Hs.sky=Sa(xl(Qc)),Hs.terrain=Sa(xl(Hu)),Hs.layer=Sa(xl(ph)),Hs.filter=Sa(xl(zc)),Hs.paintProperty=Sa(xl(_c)),Hs.layoutProperty=Sa(xl(zu));const Ia=Hs,yc=Ia.light,Bd=Ia.sky,gh=Ia.paintProperty,Cd=Ia.layoutProperty;function Vh(g,d){let b=!1;if(d&&d.length)for(const C of d)g.fire(new on(new Error(C.message))),b=!0;return b}class vu{constructor(d,b,C){const R=this.cells=[];if(d instanceof ArrayBuffer){this.arrayBuffer=d;const V=new Int32Array(this.arrayBuffer);d=V[0],this.d=(b=V[1])+2*(C=V[2]);for(let ee=0;ee<this.d*this.d;ee++){const le=V[3+ee],_e=V[3+ee+1];R.push(le===_e?null:V.subarray(le,_e))}const K=V[3+R.length+1];this.keys=V.subarray(V[3+R.length],K),this.bboxes=V.subarray(K),this.insert=this._insertReadonly}else{this.d=b+2*C;for(let V=0;V<this.d*this.d;V++)R.push([]);this.keys=[],this.bboxes=[]}this.n=b,this.extent=d,this.padding=C,this.scale=b/d,this.uid=0;const U=C/b*d;this.min=-U,this.max=d+U}insert(d,b,C,R,U){this._forEachCell(b,C,R,U,this._insertCell,this.uid++,void 0,void 0),this.keys.push(d),this.bboxes.push(b),this.bboxes.push(C),this.bboxes.push(R),this.bboxes.push(U)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(d,b,C,R,U,V){this.cells[U].push(V)}query(d,b,C,R,U){const V=this.min,K=this.max;if(d<=V&&b<=V&&K<=C&&K<=R&&!U)return Array.prototype.slice.call(this.keys);{const ee=[];return this._forEachCell(d,b,C,R,this._queryCell,ee,{},U),ee}}_queryCell(d,b,C,R,U,V,K,ee){const le=this.cells[U];if(le!==null){const _e=this.keys,Be=this.bboxes;for(let De=0;De<le.length;De++){const Ge=le[De];if(K[Ge]===void 0){const et=4*Ge;(ee?ee(Be[et+0],Be[et+1],Be[et+2],Be[et+3]):d<=Be[et+2]&&b<=Be[et+3]&&C>=Be[et+0]&&R>=Be[et+1])?(K[Ge]=!0,V.push(_e[Ge])):K[Ge]=!1}}}}_forEachCell(d,b,C,R,U,V,K,ee){const le=this._convertToCellCoord(d),_e=this._convertToCellCoord(b),Be=this._convertToCellCoord(C),De=this._convertToCellCoord(R);for(let Ge=le;Ge<=Be;Ge++)for(let et=_e;et<=De;et++){const lt=this.d*et+Ge;if((!ee||ee(this._convertFromCellCoord(Ge),this._convertFromCellCoord(et),this._convertFromCellCoord(Ge+1),this._convertFromCellCoord(et+1)))&&U.call(this,d,b,C,R,lt,V,K,ee))return}}_convertFromCellCoord(d){return(d-this.padding)/this.scale}_convertToCellCoord(d){return Math.max(0,Math.min(this.d-1,Math.floor(d*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const d=this.cells,b=3+this.cells.length+1+1;let C=0;for(let V=0;V<this.cells.length;V++)C+=this.cells[V].length;const R=new Int32Array(b+C+this.keys.length+this.bboxes.length);R[0]=this.extent,R[1]=this.n,R[2]=this.padding;let U=b;for(let V=0;V<d.length;V++){const K=d[V];R[3+V]=U,R.set(K,U),U+=K.length}return R[3+d.length]=U,R.set(this.keys,U),U+=this.keys.length,R[3+d.length+1]=U,R.set(this.bboxes,U),U+=this.bboxes.length,R.buffer}static serialize(d,b){const C=d.toArrayBuffer();return b&&b.push(C),{buffer:C}}static deserialize(d){return new vu(d.buffer)}}const Za={};function pn(g,d){let b=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(Za[g])throw new Error(`${g} is already registered.`);Object.defineProperty(d,"_classRegistryKey",{value:g,writeable:!1}),Za[g]={klass:d,omit:b.omit||[],shallow:b.shallow||[]}}pn("Object",Object),pn("TransferableGridIndex",vu),pn("Color",On),pn("Error",Error),pn("AJAXError",qt),pn("ResolvedImage",Hi),pn("StylePropertyFunction",Zo),pn("StyleExpression",kc,{omit:["_evaluator"]}),pn("ZoomDependentExpression",ca),pn("ZoomConstantExpression",uo),pn("CompoundExpression",no,{omit:["_evaluate"]});for(const g in ml)ml[g]._classRegistryKey||pn(`Expression_${g}`,ml[g]);function Ya(g){return g&&typeof ArrayBuffer<"u"&&(g instanceof ArrayBuffer||g.constructor&&g.constructor.name==="ArrayBuffer")}function To(g){return g.$name||g.constructor._classRegistryKey}function Ql(g){return!function(d){if(d===null||typeof d!="object")return!1;const b=To(d);return!(!b||b==="Object")}(g)&&(g==null||typeof g=="boolean"||typeof g=="number"||typeof g=="string"||g instanceof Boolean||g instanceof Number||g instanceof String||g instanceof Date||g instanceof RegExp||g instanceof Blob||g instanceof Error||Ya(g)||Jt(g)||ArrayBuffer.isView(g)||g instanceof ImageData)}function Vu(g,d){if(Ql(g))return(Ya(g)||Jt(g))&&d&&d.push(g),ArrayBuffer.isView(g)&&d&&d.push(g.buffer),g instanceof ImageData&&d&&d.push(g.data.buffer),g;if(Array.isArray(g)){const U=[];for(const V of g)U.push(Vu(V,d));return U}if(typeof g!="object")throw new Error("can't serialize object of type "+typeof g);const b=To(g);if(!b)throw new Error(`can't serialize object of unregistered class ${g.constructor.name}`);if(!Za[b])throw new Error(`${b} is not registered.`);const{klass:C}=Za[b],R=C.serialize?C.serialize(g,d):{};if(C.serialize){if(d&&R===d[d.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const U in g){if(!g.hasOwnProperty(U)||Za[b].omit.indexOf(U)>=0)continue;const V=g[U];R[U]=Za[b].shallow.indexOf(U)>=0?V:Vu(V,d)}g instanceof Error&&(R.message=g.message)}if(R.$name)throw new Error("$name property is reserved for worker serialization logic.");return b!=="Object"&&(R.$name=b),R}function xu(g){if(Ql(g))return g;if(Array.isArray(g))return g.map(xu);if(typeof g!="object")throw new Error("can't deserialize object of type "+typeof g);const d=To(g)||"Object";if(!Za[d])throw new Error(`can't deserialize unregistered class ${d}`);const{klass:b}=Za[d];if(!b)throw new Error(`can't deserialize unregistered class ${d}`);if(b.deserialize)return b.deserialize(g);const C=Object.create(b.prototype);for(const R of Object.keys(g)){if(R==="$name")continue;const U=g[R];C[R]=Za[d].shallow.indexOf(R)>=0?U:xu(U)}return C}class $l{constructor(){this.first=!0}update(d,b){const C=Math.floor(d);return this.first?(this.first=!1,this.lastIntegerZoom=C,this.lastIntegerZoomTime=0,this.lastZoom=d,this.lastFloorZoom=C,!0):(this.lastFloorZoom>C?(this.lastIntegerZoom=C+1,this.lastIntegerZoomTime=b):this.lastFloorZoom<C&&(this.lastIntegerZoom=C,this.lastIntegerZoomTime=b),d!==this.lastZoom&&(this.lastZoom=d,this.lastFloorZoom=C,!0))}}const ni={"Latin-1 Supplement":g=>g>=128&&g<=255,"Hangul Jamo":g=>g>=4352&&g<=4607,Khmer:g=>g>=6016&&g<=6143,"General Punctuation":g=>g>=8192&&g<=8303,"Letterlike Symbols":g=>g>=8448&&g<=8527,"Number Forms":g=>g>=8528&&g<=8591,"Miscellaneous Technical":g=>g>=8960&&g<=9215,"Control Pictures":g=>g>=9216&&g<=9279,"Optical Character Recognition":g=>g>=9280&&g<=9311,"Enclosed Alphanumerics":g=>g>=9312&&g<=9471,"Geometric Shapes":g=>g>=9632&&g<=9727,"Miscellaneous Symbols":g=>g>=9728&&g<=9983,"Miscellaneous Symbols and Arrows":g=>g>=11008&&g<=11263,"Ideographic Description Characters":g=>g>=12272&&g<=12287,"CJK Symbols and Punctuation":g=>g>=12288&&g<=12351,Katakana:g=>g>=12448&&g<=12543,Kanbun:g=>g>=12688&&g<=12703,"CJK Strokes":g=>g>=12736&&g<=12783,"Enclosed CJK Letters and Months":g=>g>=12800&&g<=13055,"CJK Compatibility":g=>g>=13056&&g<=13311,"Yijing Hexagram Symbols":g=>g>=19904&&g<=19967,"Private Use Area":g=>g>=57344&&g<=63743,"Vertical Forms":g=>g>=65040&&g<=65055,"CJK Compatibility Forms":g=>g>=65072&&g<=65103,"Small Form Variants":g=>g>=65104&&g<=65135,"Halfwidth and Fullwidth Forms":g=>g>=65280&&g<=65519};function Gu(g){for(const d of g)if(wu(d.charCodeAt(0)))return!0;return!1}function mh(g){for(const d of g)if(!wl(d.charCodeAt(0)))return!1;return!0}function So(g){const d=g.map(b=>{try{return new RegExp(`\\p{sc=${b}}`,"u").source}catch{return null}}).filter(b=>b);return new RegExp(d.join("|"),"u")}const Vs=So(["Arab","Dupl","Mong","Ougr","Syrc"]);function wl(g){return!Vs.test(String.fromCodePoint(g))}const el=So(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function wu(g){return!(g!==746&&g!==747&&(g<4352||!(ni["CJK Compatibility Forms"](g)&&!(g>=65097&&g<=65103)||ni["CJK Compatibility"](g)||ni["CJK Strokes"](g)||!(!ni["CJK Symbols and Punctuation"](g)||g>=12296&&g<=12305||g>=12308&&g<=12319||g===12336)||ni["Enclosed CJK Letters and Months"](g)||ni["Ideographic Description Characters"](g)||ni.Kanbun(g)||ni.Katakana(g)&&g!==12540||!(!ni["Halfwidth and Fullwidth Forms"](g)||g===65288||g===65289||g===65293||g>=65306&&g<=65310||g===65339||g===65341||g===65343||g>=65371&&g<=65503||g===65507||g>=65512&&g<=65519)||!(!ni["Small Form Variants"](g)||g>=65112&&g<=65118||g>=65123&&g<=65126)||ni["Vertical Forms"](g)||ni["Yijing Hexagram Symbols"](g)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(g))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(g))||el.test(String.fromCodePoint(g)))))}function Gh(g){return!(wu(g)||function(d){return!!(ni["Latin-1 Supplement"](d)&&(d===167||d===169||d===174||d===177||d===188||d===189||d===190||d===215||d===247)||ni["General Punctuation"](d)&&(d===8214||d===8224||d===8225||d===8240||d===8241||d===8251||d===8252||d===8258||d===8263||d===8264||d===8265||d===8273)||ni["Letterlike Symbols"](d)||ni["Number Forms"](d)||ni["Miscellaneous Technical"](d)&&(d>=8960&&d<=8967||d>=8972&&d<=8991||d>=8996&&d<=9e3||d===9003||d>=9085&&d<=9114||d>=9150&&d<=9165||d===9167||d>=9169&&d<=9179||d>=9186&&d<=9215)||ni["Control Pictures"](d)&&d!==9251||ni["Optical Character Recognition"](d)||ni["Enclosed Alphanumerics"](d)||ni["Geometric Shapes"](d)||ni["Miscellaneous Symbols"](d)&&!(d>=9754&&d<=9759)||ni["Miscellaneous Symbols and Arrows"](d)&&(d>=11026&&d<=11055||d>=11088&&d<=11097||d>=11192&&d<=11243)||ni["CJK Symbols and Punctuation"](d)||ni.Katakana(d)||ni["Private Use Area"](d)||ni["CJK Compatibility Forms"](d)||ni["Small Form Variants"](d)||ni["Halfwidth and Fullwidth Forms"](d)||d===8734||d===8756||d===8757||d>=9984&&d<=10087||d>=10102&&d<=10131||d===65532||d===65533)}(g))}const Bu=So(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Cu(g){return Bu.test(String.fromCodePoint(g))}function Qh(g,d){return!(!d&&Cu(g)||g>=2304&&g<=3583||g>=3840&&g<=4255||ni.Khmer(g))}function xf(g){for(const d of g)if(Cu(d.charCodeAt(0)))return!0;return!1}const _o=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(g){this.pluginStatus=g.pluginStatus,this.pluginURL=g.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(g){this.applyArabicShaping=g.applyArabicShaping,this.processBidirectionalText=g.processBidirectionalText,this.processStyledBidirectionalText=g.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class Fi{constructor(d,b){this.zoom=d,b?(this.now=b.now,this.fadeDuration=b.fadeDuration,this.zoomHistory=b.zoomHistory,this.transition=b.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new $l,this.transition={})}isSupportedScript(d){return function(b,C){for(const R of b)if(!Qh(R.charCodeAt(0),C))return!1;return!0}(d,_o.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const d=this.zoom,b=d-Math.floor(d),C=this.crossFadingFactor();return d>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:b+(1-b)*C}:{fromScale:.5,toScale:1,t:1-(1-C)*b}}}class un{constructor(d,b){this.property=d,this.value=b,this.expression=function(C,R){if(Jo(C))return new Zo(C,R);if(bl(C)){const U=Vl(C,R);if(U.result==="error")throw new Error(U.value.map(V=>`${V.key}: ${V.message}`).join(", "));return U.value}{let U=C;return R.type==="color"&&typeof C=="string"?U=On.parse(C):R.type!=="padding"||typeof C!="number"&&!Array.isArray(C)?R.type==="variableAnchorOffsetCollection"&&Array.isArray(C)&&(U=Ks.parse(C)):U=bs.parse(C),{kind:"constant",evaluate:()=>U}}}(b===void 0?d.specification.default:b,d.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(d,b,C){return this.property.possiblyEvaluate(this,d,b,C)}}class $h{constructor(d){this.property=d,this.value=new un(d,void 0)}transitioned(d,b){return new wf(this.property,this.value,b,Qe({},d.transition,this.transition),d.now)}untransitioned(){return new wf(this.property,this.value,null,{},0)}}class bc{constructor(d){this._properties=d,this._values=Object.create(d.defaultTransitionablePropertyValues)}getValue(d){return Le(this._values[d].value.value)}setValue(d,b){Object.prototype.hasOwnProperty.call(this._values,d)||(this._values[d]=new $h(this._values[d].property)),this._values[d].value=new un(this._values[d].property,b===null?void 0:Le(b))}getTransition(d){return Le(this._values[d].transition)}setTransition(d,b){Object.prototype.hasOwnProperty.call(this._values,d)||(this._values[d]=new $h(this._values[d].property)),this._values[d].transition=Le(b)||void 0}serialize(){const d={};for(const b of Object.keys(this._values)){const C=this.getValue(b);C!==void 0&&(d[b]=C);const R=this.getTransition(b);R!==void 0&&(d[`${b}-transition`]=R)}return d}transitioned(d,b){const C=new $c(this._properties);for(const R of Object.keys(this._values))C._values[R]=this._values[R].transitioned(d,b._values[R]);return C}untransitioned(){const d=new $c(this._properties);for(const b of Object.keys(this._values))d._values[b]=this._values[b].untransitioned();return d}}class wf{constructor(d,b,C,R,U){this.property=d,this.value=b,this.begin=U+R.delay||0,this.end=this.begin+R.duration||0,d.specification.transition&&(R.delay||R.duration)&&(this.prior=C)}possiblyEvaluate(d,b,C){const R=d.now||0,U=this.value.possiblyEvaluate(d,b,C),V=this.prior;if(V){if(R>this.end)return this.prior=null,U;if(this.value.isDataDriven())return this.prior=null,U;if(R<this.begin)return V.possiblyEvaluate(d,b,C);{const K=(R-this.begin)/(this.end-this.begin);return this.property.interpolate(V.possiblyEvaluate(d,b,C),U,function(ee){if(ee<=0)return 0;if(ee>=1)return 1;const le=ee*ee,_e=le*ee;return 4*(ee<.5?_e:3*(ee-le)+_e-.75)}(K))}}return U}}class $c{constructor(d){this._properties=d,this._values=Object.create(d.defaultTransitioningPropertyValues)}possiblyEvaluate(d,b,C){const R=new ci(this._properties);for(const U of Object.keys(this._values))R._values[U]=this._values[U].possiblyEvaluate(d,b,C);return R}hasTransition(){for(const d of Object.keys(this._values))if(this._values[d].prior)return!0;return!1}}class Bl{constructor(d){this._properties=d,this._values=Object.create(d.defaultPropertyValues)}hasValue(d){return this._values[d].value!==void 0}getValue(d){return Le(this._values[d].value)}setValue(d,b){this._values[d]=new un(this._values[d].property,b===null?void 0:Le(b))}serialize(){const d={};for(const b of Object.keys(this._values)){const C=this.getValue(b);C!==void 0&&(d[b]=C)}return d}possiblyEvaluate(d,b,C){const R=new ci(this._properties);for(const U of Object.keys(this._values))R._values[U]=this._values[U].possiblyEvaluate(d,b,C);return R}}class Cl{constructor(d,b,C){this.property=d,this.value=b,this.parameters=C}isConstant(){return this.value.kind==="constant"}constantOr(d){return this.value.kind==="constant"?this.value.value:d}evaluate(d,b,C,R){return this.property.evaluate(this.value,this.parameters,d,b,C,R)}}class ci{constructor(d){this._properties=d,this._values=Object.create(d.defaultPossiblyEvaluatedValues)}get(d){return this._values[d]}}class vn{constructor(d){this.specification=d}possiblyEvaluate(d,b){if(d.isDataDriven())throw new Error("Value should not be data driven");return d.expression.evaluate(b)}interpolate(d,b,C){const R=ps[this.specification.type];return R?R(d,b,C):d}}class Wn{constructor(d,b){this.specification=d,this.overrides=b}possiblyEvaluate(d,b,C,R){return new Cl(this,d.expression.kind==="constant"||d.expression.kind==="camera"?{kind:"constant",value:d.expression.evaluate(b,null,{},C,R)}:d.expression,b)}interpolate(d,b,C){if(d.value.kind!=="constant"||b.value.kind!=="constant")return d;if(d.value.value===void 0||b.value.value===void 0)return new Cl(this,{kind:"constant",value:void 0},d.parameters);const R=ps[this.specification.type];if(R){const U=R(d.value.value,b.value.value,C);return new Cl(this,{kind:"constant",value:U},d.parameters)}return d}evaluate(d,b,C,R,U,V){return d.kind==="constant"?d.value:d.evaluate(b,C,R,U,V)}}class Eu extends Wn{possiblyEvaluate(d,b,C,R){if(d.value===void 0)return new Cl(this,{kind:"constant",value:void 0},b);if(d.expression.kind==="constant"){const U=d.expression.evaluate(b,null,{},C,R),V=d.property.specification.type==="resolvedImage"&&typeof U!="string"?U.name:U,K=this._calculate(V,V,V,b);return new Cl(this,{kind:"constant",value:K},b)}if(d.expression.kind==="camera"){const U=this._calculate(d.expression.evaluate({zoom:b.zoom-1}),d.expression.evaluate({zoom:b.zoom}),d.expression.evaluate({zoom:b.zoom+1}),b);return new Cl(this,{kind:"constant",value:U},b)}return new Cl(this,d.expression,b)}evaluate(d,b,C,R,U,V){if(d.kind==="source"){const K=d.evaluate(b,C,R,U,V);return this._calculate(K,K,K,b)}return d.kind==="composite"?this._calculate(d.evaluate({zoom:Math.floor(b.zoom)-1},C,R),d.evaluate({zoom:Math.floor(b.zoom)},C,R),d.evaluate({zoom:Math.floor(b.zoom)+1},C,R),b):d.value}_calculate(d,b,C,R){return R.zoom>R.zoomHistory.lastIntegerZoom?{from:d,to:b}:{from:C,to:b}}interpolate(d){return d}}class z{constructor(d){this.specification=d}possiblyEvaluate(d,b,C,R){if(d.value!==void 0){if(d.expression.kind==="constant"){const U=d.expression.evaluate(b,null,{},C,R);return this._calculate(U,U,U,b)}return this._calculate(d.expression.evaluate(new Fi(Math.floor(b.zoom-1),b)),d.expression.evaluate(new Fi(Math.floor(b.zoom),b)),d.expression.evaluate(new Fi(Math.floor(b.zoom+1),b)),b)}}_calculate(d,b,C,R){return R.zoom>R.zoomHistory.lastIntegerZoom?{from:d,to:b}:{from:C,to:b}}interpolate(d){return d}}class X{constructor(d){this.specification=d}possiblyEvaluate(d,b,C,R){return!!d.expression.evaluate(b,null,{},C,R)}interpolate(){return!1}}class E{constructor(d){this.properties=d,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const b in d){const C=d[b];C.specification.overridable&&this.overridableProperties.push(b);const R=this.defaultPropertyValues[b]=new un(C,void 0),U=this.defaultTransitionablePropertyValues[b]=new $h(C);this.defaultTransitioningPropertyValues[b]=U.untransitioned(),this.defaultPossiblyEvaluatedValues[b]=R.possiblyEvaluate({})}}}pn("DataDrivenProperty",Wn),pn("DataConstantProperty",vn),pn("CrossFadedDataDrivenProperty",Eu),pn("CrossFadedProperty",z),pn("ColorRampProperty",X);const c="-transition";class y extends pr{constructor(d,b){if(super(),this.id=d.id,this.type=d.type,this._featureFilter={filter:()=>!0,needGeometry:!1},d.type!=="custom"&&(this.metadata=d.metadata,this.minzoom=d.minzoom,this.maxzoom=d.maxzoom,d.type!=="background"&&(this.source=d.source,this.sourceLayer=d["source-layer"],this.filter=d.filter),b.layout&&(this._unevaluatedLayout=new Bl(b.layout)),b.paint)){this._transitionablePaint=new bc(b.paint);for(const C in d.paint)this.setPaintProperty(C,d.paint[C],{validate:!1});for(const C in d.layout)this.setLayoutProperty(C,d.layout[C],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ci(b.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(d){return d==="visibility"?this.visibility:this._unevaluatedLayout.getValue(d)}setLayoutProperty(d,b){let C=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};b!=null&&this._validate(Cd,`layers.${this.id}.layout.${d}`,d,b,C)||(d!=="visibility"?this._unevaluatedLayout.setValue(d,b):this.visibility=b)}getPaintProperty(d){return d.endsWith(c)?this._transitionablePaint.getTransition(d.slice(0,-11)):this._transitionablePaint.getValue(d)}setPaintProperty(d,b){let C=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(b!=null&&this._validate(gh,`layers.${this.id}.paint.${d}`,d,b,C))return!1;if(d.endsWith(c))return this._transitionablePaint.setTransition(d.slice(0,-11),b||void 0),!1;{const R=this._transitionablePaint._values[d],U=R.property.specification["property-type"]==="cross-faded-data-driven",V=R.value.isDataDriven(),K=R.value;this._transitionablePaint.setValue(d,b),this._handleSpecialPaintPropertyUpdate(d);const ee=this._transitionablePaint._values[d].value;return ee.isDataDriven()||V||U||this._handleOverridablePaintPropertyUpdate(d,K,ee)}}_handleSpecialPaintPropertyUpdate(d){}_handleOverridablePaintPropertyUpdate(d,b,C){return!1}isHidden(d){return!!(this.minzoom&&d<this.minzoom)||!!(this.maxzoom&&d>=this.maxzoom)||this.visibility==="none"}updateTransitions(d){this._transitioningPaint=this._transitionablePaint.transitioned(d,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(d,b){d.getCrossfadeParameters&&(this._crossfadeParameters=d.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(d,void 0,b)),this.paint=this._transitioningPaint.possiblyEvaluate(d,void 0,b)}serialize(){const d={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(d.layout=d.layout||{},d.layout.visibility=this.visibility),at(d,(b,C)=>!(b===void 0||C==="layout"&&!Object.keys(b).length||C==="paint"&&!Object.keys(b).length))}_validate(d,b,C,R){let U=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};return(!U||U.validate!==!1)&&Vh(this,d.call(Ia,{key:b,layerType:this.type,objectKey:C,value:R,styleSpec:We,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const d in this.paint._values){const b=this.paint.get(d);if(b instanceof Cl&&pc(b.property.specification)&&(b.value.kind==="source"||b.value.kind==="composite")&&b.value.isStateDependent)return!0}return!1}}const B={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class S{constructor(d,b){this._structArray=d,this._pos1=b*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class F{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(d,b){return d._trim(),b&&(d.isTransferred=!0,b.push(d.arrayBuffer)),{length:d.length,arrayBuffer:d.arrayBuffer}}static deserialize(d){const b=Object.create(this.prototype);return b.arrayBuffer=d.arrayBuffer,b.length=d.length,b.capacity=d.arrayBuffer.byteLength/b.bytesPerElement,b._refreshViews(),b}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(d){this.reserve(d),this.length=d}reserve(d){if(d>this.capacity){this.capacity=Math.max(d,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const b=this.uint8;this._refreshViews(),b&&this.uint8.set(b)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function H(g){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,b=0,C=0;return{members:g.map(R=>{const U=B[R.type].BYTES_PER_ELEMENT,V=b=j(b,Math.max(d,U)),K=R.components||1;return C=Math.max(C,U),b+=U*K,{name:R.name,type:R.type,components:K,offset:V}}),size:j(b,Math.max(C,d)),alignment:d}}function j(g,d){return Math.ceil(g/d)*d}class Z extends F{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(d,b){const C=this.length;return this.resize(C+1),this.emplace(C,d,b)}emplace(d,b,C){const R=2*d;return this.int16[R+0]=b,this.int16[R+1]=C,d}}Z.prototype.bytesPerElement=4,pn("StructArrayLayout2i4",Z);class se extends F{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(d,b,C){const R=this.length;return this.resize(R+1),this.emplace(R,d,b,C)}emplace(d,b,C,R){const U=3*d;return this.int16[U+0]=b,this.int16[U+1]=C,this.int16[U+2]=R,d}}se.prototype.bytesPerElement=6,pn("StructArrayLayout3i6",se);class he extends F{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(d,b,C,R){const U=this.length;return this.resize(U+1),this.emplace(U,d,b,C,R)}emplace(d,b,C,R,U){const V=4*d;return this.int16[V+0]=b,this.int16[V+1]=C,this.int16[V+2]=R,this.int16[V+3]=U,d}}he.prototype.bytesPerElement=8,pn("StructArrayLayout4i8",he);class ue extends F{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(d,b,C,R,U,V){const K=this.length;return this.resize(K+1),this.emplace(K,d,b,C,R,U,V)}emplace(d,b,C,R,U,V,K){const ee=6*d;return this.int16[ee+0]=b,this.int16[ee+1]=C,this.int16[ee+2]=R,this.int16[ee+3]=U,this.int16[ee+4]=V,this.int16[ee+5]=K,d}}ue.prototype.bytesPerElement=12,pn("StructArrayLayout2i4i12",ue);class Te extends F{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(d,b,C,R,U,V){const K=this.length;return this.resize(K+1),this.emplace(K,d,b,C,R,U,V)}emplace(d,b,C,R,U,V,K){const ee=4*d,le=8*d;return this.int16[ee+0]=b,this.int16[ee+1]=C,this.uint8[le+4]=R,this.uint8[le+5]=U,this.uint8[le+6]=V,this.uint8[le+7]=K,d}}Te.prototype.bytesPerElement=8,pn("StructArrayLayout2i4ub8",Te);class Fe extends F{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(d,b){const C=this.length;return this.resize(C+1),this.emplace(C,d,b)}emplace(d,b,C){const R=2*d;return this.float32[R+0]=b,this.float32[R+1]=C,d}}Fe.prototype.bytesPerElement=8,pn("StructArrayLayout2f8",Fe);class Ee extends F{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(d,b,C,R,U,V,K,ee,le,_e){const Be=this.length;return this.resize(Be+1),this.emplace(Be,d,b,C,R,U,V,K,ee,le,_e)}emplace(d,b,C,R,U,V,K,ee,le,_e,Be){const De=10*d;return this.uint16[De+0]=b,this.uint16[De+1]=C,this.uint16[De+2]=R,this.uint16[De+3]=U,this.uint16[De+4]=V,this.uint16[De+5]=K,this.uint16[De+6]=ee,this.uint16[De+7]=le,this.uint16[De+8]=_e,this.uint16[De+9]=Be,d}}Ee.prototype.bytesPerElement=20,pn("StructArrayLayout10ui20",Ee);class Oe extends F{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(d,b,C,R,U,V,K,ee,le,_e,Be,De){const Ge=this.length;return this.resize(Ge+1),this.emplace(Ge,d,b,C,R,U,V,K,ee,le,_e,Be,De)}emplace(d,b,C,R,U,V,K,ee,le,_e,Be,De,Ge){const et=12*d;return this.int16[et+0]=b,this.int16[et+1]=C,this.int16[et+2]=R,this.int16[et+3]=U,this.uint16[et+4]=V,this.uint16[et+5]=K,this.uint16[et+6]=ee,this.uint16[et+7]=le,this.int16[et+8]=_e,this.int16[et+9]=Be,this.int16[et+10]=De,this.int16[et+11]=Ge,d}}Oe.prototype.bytesPerElement=24,pn("StructArrayLayout4i4ui4i24",Oe);class rt extends F{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(d,b,C){const R=this.length;return this.resize(R+1),this.emplace(R,d,b,C)}emplace(d,b,C,R){const U=3*d;return this.float32[U+0]=b,this.float32[U+1]=C,this.float32[U+2]=R,d}}rt.prototype.bytesPerElement=12,pn("StructArrayLayout3f12",rt);class qe extends F{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(d){const b=this.length;return this.resize(b+1),this.emplace(b,d)}emplace(d,b){return this.uint32[1*d+0]=b,d}}qe.prototype.bytesPerElement=4,pn("StructArrayLayout1ul4",qe);class Ze extends F{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(d,b,C,R,U,V,K,ee,le){const _e=this.length;return this.resize(_e+1),this.emplace(_e,d,b,C,R,U,V,K,ee,le)}emplace(d,b,C,R,U,V,K,ee,le,_e){const Be=10*d,De=5*d;return this.int16[Be+0]=b,this.int16[Be+1]=C,this.int16[Be+2]=R,this.int16[Be+3]=U,this.int16[Be+4]=V,this.int16[Be+5]=K,this.uint32[De+3]=ee,this.uint16[Be+8]=le,this.uint16[Be+9]=_e,d}}Ze.prototype.bytesPerElement=20,pn("StructArrayLayout6i1ul2ui20",Ze);class ot extends F{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(d,b,C,R,U,V){const K=this.length;return this.resize(K+1),this.emplace(K,d,b,C,R,U,V)}emplace(d,b,C,R,U,V,K){const ee=6*d;return this.int16[ee+0]=b,this.int16[ee+1]=C,this.int16[ee+2]=R,this.int16[ee+3]=U,this.int16[ee+4]=V,this.int16[ee+5]=K,d}}ot.prototype.bytesPerElement=12,pn("StructArrayLayout2i2i2i12",ot);class vt extends F{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(d,b,C,R,U){const V=this.length;return this.resize(V+1),this.emplace(V,d,b,C,R,U)}emplace(d,b,C,R,U,V){const K=4*d,ee=8*d;return this.float32[K+0]=b,this.float32[K+1]=C,this.float32[K+2]=R,this.int16[ee+6]=U,this.int16[ee+7]=V,d}}vt.prototype.bytesPerElement=16,pn("StructArrayLayout2f1f2i16",vt);class kt extends F{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(d,b,C,R,U,V){const K=this.length;return this.resize(K+1),this.emplace(K,d,b,C,R,U,V)}emplace(d,b,C,R,U,V,K){const ee=16*d,le=4*d,_e=8*d;return this.uint8[ee+0]=b,this.uint8[ee+1]=C,this.float32[le+1]=R,this.float32[le+2]=U,this.int16[_e+6]=V,this.int16[_e+7]=K,d}}kt.prototype.bytesPerElement=16,pn("StructArrayLayout2ub2f2i16",kt);class It extends F{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(d,b,C){const R=this.length;return this.resize(R+1),this.emplace(R,d,b,C)}emplace(d,b,C,R){const U=3*d;return this.uint16[U+0]=b,this.uint16[U+1]=C,this.uint16[U+2]=R,d}}It.prototype.bytesPerElement=6,pn("StructArrayLayout3ui6",It);class ur extends F{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(d,b,C,R,U,V,K,ee,le,_e,Be,De,Ge,et,lt,Ct,p){const u=this.length;return this.resize(u+1),this.emplace(u,d,b,C,R,U,V,K,ee,le,_e,Be,De,Ge,et,lt,Ct,p)}emplace(d,b,C,R,U,V,K,ee,le,_e,Be,De,Ge,et,lt,Ct,p,u){const A=24*d,v=12*d,M=48*d;return this.int16[A+0]=b,this.int16[A+1]=C,this.uint16[A+2]=R,this.uint16[A+3]=U,this.uint32[v+2]=V,this.uint32[v+3]=K,this.uint32[v+4]=ee,this.uint16[A+10]=le,this.uint16[A+11]=_e,this.uint16[A+12]=Be,this.float32[v+7]=De,this.float32[v+8]=Ge,this.uint8[M+36]=et,this.uint8[M+37]=lt,this.uint8[M+38]=Ct,this.uint32[v+10]=p,this.int16[A+22]=u,d}}ur.prototype.bytesPerElement=48,pn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",ur);class wr extends F{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(d,b,C,R,U,V,K,ee,le,_e,Be,De,Ge,et,lt,Ct,p,u,A,v,M,L,k,Q,q,te,ae,de){const ye=this.length;return this.resize(ye+1),this.emplace(ye,d,b,C,R,U,V,K,ee,le,_e,Be,De,Ge,et,lt,Ct,p,u,A,v,M,L,k,Q,q,te,ae,de)}emplace(d,b,C,R,U,V,K,ee,le,_e,Be,De,Ge,et,lt,Ct,p,u,A,v,M,L,k,Q,q,te,ae,de,ye){const me=32*d,Ie=16*d;return this.int16[me+0]=b,this.int16[me+1]=C,this.int16[me+2]=R,this.int16[me+3]=U,this.int16[me+4]=V,this.int16[me+5]=K,this.int16[me+6]=ee,this.int16[me+7]=le,this.uint16[me+8]=_e,this.uint16[me+9]=Be,this.uint16[me+10]=De,this.uint16[me+11]=Ge,this.uint16[me+12]=et,this.uint16[me+13]=lt,this.uint16[me+14]=Ct,this.uint16[me+15]=p,this.uint16[me+16]=u,this.uint16[me+17]=A,this.uint16[me+18]=v,this.uint16[me+19]=M,this.uint16[me+20]=L,this.uint16[me+21]=k,this.uint16[me+22]=Q,this.uint32[Ie+12]=q,this.float32[Ie+13]=te,this.float32[Ie+14]=ae,this.uint16[me+30]=de,this.uint16[me+31]=ye,d}}wr.prototype.bytesPerElement=64,pn("StructArrayLayout8i15ui1ul2f2ui64",wr);class Dr extends F{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(d){const b=this.length;return this.resize(b+1),this.emplace(b,d)}emplace(d,b){return this.float32[1*d+0]=b,d}}Dr.prototype.bytesPerElement=4,pn("StructArrayLayout1f4",Dr);class Or extends F{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(d,b,C){const R=this.length;return this.resize(R+1),this.emplace(R,d,b,C)}emplace(d,b,C,R){const U=3*d;return this.uint16[6*d+0]=b,this.float32[U+1]=C,this.float32[U+2]=R,d}}Or.prototype.bytesPerElement=12,pn("StructArrayLayout1ui2f12",Or);class _r extends F{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(d,b,C){const R=this.length;return this.resize(R+1),this.emplace(R,d,b,C)}emplace(d,b,C,R){const U=4*d;return this.uint32[2*d+0]=b,this.uint16[U+2]=C,this.uint16[U+3]=R,d}}_r.prototype.bytesPerElement=8,pn("StructArrayLayout1ul2ui8",_r);class xr extends F{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(d,b){const C=this.length;return this.resize(C+1),this.emplace(C,d,b)}emplace(d,b,C){const R=2*d;return this.uint16[R+0]=b,this.uint16[R+1]=C,d}}xr.prototype.bytesPerElement=4,pn("StructArrayLayout2ui4",xr);class Vr extends F{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(d){const b=this.length;return this.resize(b+1),this.emplace(b,d)}emplace(d,b){return this.uint16[1*d+0]=b,d}}Vr.prototype.bytesPerElement=2,pn("StructArrayLayout1ui2",Vr);class xn extends F{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(d,b,C,R){const U=this.length;return this.resize(U+1),this.emplace(U,d,b,C,R)}emplace(d,b,C,R,U){const V=4*d;return this.float32[V+0]=b,this.float32[V+1]=C,this.float32[V+2]=R,this.float32[V+3]=U,d}}xn.prototype.bytesPerElement=16,pn("StructArrayLayout4f16",xn);class Qr extends S{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new x(this.anchorPointX,this.anchorPointY)}}Qr.prototype.size=20;class jr extends Ze{get(d){return new Qr(this,d)}}pn("CollisionBoxArray",jr);class In extends S{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(d){this._structArray.uint8[this._pos1+37]=d}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(d){this._structArray.uint8[this._pos1+38]=d}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(d){this._structArray.uint32[this._pos4+10]=d}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}In.prototype.size=48;class Hn extends ur{get(d){return new In(this,d)}}pn("PlacedSymbolArray",Hn);class Qn extends S{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(d){this._structArray.uint32[this._pos4+12]=d}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}Qn.prototype.size=64;class Zn extends wr{get(d){return new Qn(this,d)}}pn("SymbolInstanceArray",Zn);class ui extends Dr{getoffsetX(d){return this.float32[1*d+0]}}pn("GlyphOffsetArray",ui);class Ii extends se{getx(d){return this.int16[3*d+0]}gety(d){return this.int16[3*d+1]}gettileUnitDistanceFromAnchor(d){return this.int16[3*d+2]}}pn("SymbolLineVertexArray",Ii);class cs extends S{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}cs.prototype.size=12;class mi extends Or{get(d){return new cs(this,d)}}pn("TextAnchorOffsetArray",mi);class qi extends S{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}qi.prototype.size=8;class Di extends _r{get(d){return new qi(this,d)}}pn("FeatureIndexArray",Di);class us extends Z{}class ns extends Z{}class Uo extends Z{}class da extends ue{}class Ki extends Te{}class vc extends Fe{}class D extends Ee{}class l extends Oe{}class m extends rt{}class w extends qe{}class P extends ot{}class O extends kt{}class G extends It{}class J extends xr{}const re=H([{name:"a_pos",components:2,type:"Int16"}],4),{members:oe}=re;class pe{constructor(){let d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];this.segments=d}prepareSegment(d,b,C,R){let U=this.segments[this.segments.length-1];return d>pe.MAX_VERTEX_ARRAY_LENGTH&&tt(`Max vertices per segment is ${pe.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${d}`),(!U||U.vertexLength+d>pe.MAX_VERTEX_ARRAY_LENGTH||U.sortKey!==R)&&(U={vertexOffset:b.length,primitiveOffset:C.length,vertexLength:0,primitiveLength:0},R!==void 0&&(U.sortKey=R),this.segments.push(U)),U}get(){return this.segments}destroy(){for(const d of this.segments)for(const b in d.vaos)d.vaos[b].destroy()}static simpleSegment(d,b,C,R){return new pe([{vertexOffset:d,primitiveOffset:b,vertexLength:C,primitiveLength:R,vaos:{},sortKey:0}])}}function Ce(g,d){return 256*(g=ve(Math.floor(g),0,255))+ve(Math.floor(d),0,255)}pe.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,pn("SegmentVector",pe);const Me=H([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Ke={exports:{}},Ye={exports:{}};Ye.exports=function(g,d){var b,C,R,U,V,K,ee,le;for(C=g.length-(b=3&g.length),R=d,V=3432918353,K=461845907,le=0;le<C;)ee=255&g.charCodeAt(le)|(255&g.charCodeAt(++le))<<8|(255&g.charCodeAt(++le))<<16|(255&g.charCodeAt(++le))<<24,++le,R=27492+(65535&(U=5*(65535&(R=(R^=ee=(65535&(ee=(ee=(65535&ee)*V+(((ee>>>16)*V&65535)<<16)&4294967295)<<15|ee>>>17))*K+(((ee>>>16)*K&65535)<<16)&4294967295)<<13|R>>>19))+((5*(R>>>16)&65535)<<16)&4294967295))+((58964+(U>>>16)&65535)<<16);switch(ee=0,b){case 3:ee^=(255&g.charCodeAt(le+2))<<16;case 2:ee^=(255&g.charCodeAt(le+1))<<8;case 1:R^=ee=(65535&(ee=(ee=(65535&(ee^=255&g.charCodeAt(le)))*V+(((ee>>>16)*V&65535)<<16)&4294967295)<<15|ee>>>17))*K+(((ee>>>16)*K&65535)<<16)&4294967295}return R^=g.length,R=2246822507*(65535&(R^=R>>>16))+((2246822507*(R>>>16)&65535)<<16)&4294967295,R=3266489909*(65535&(R^=R>>>13))+((3266489909*(R>>>16)&65535)<<16)&4294967295,(R^=R>>>16)>>>0};var gt=Ye.exports,ft={exports:{}};ft.exports=function(g,d){for(var b,C=g.length,R=d^C,U=0;C>=4;)b=1540483477*(65535&(b=255&g.charCodeAt(U)|(255&g.charCodeAt(++U))<<8|(255&g.charCodeAt(++U))<<16|(255&g.charCodeAt(++U))<<24))+((1540483477*(b>>>16)&65535)<<16),R=1540483477*(65535&R)+((1540483477*(R>>>16)&65535)<<16)^(b=1540483477*(65535&(b^=b>>>24))+((1540483477*(b>>>16)&65535)<<16)),C-=4,++U;switch(C){case 3:R^=(255&g.charCodeAt(U+2))<<16;case 2:R^=(255&g.charCodeAt(U+1))<<8;case 1:R=1540483477*(65535&(R^=255&g.charCodeAt(U)))+((1540483477*(R>>>16)&65535)<<16)}return R=1540483477*(65535&(R^=R>>>13))+((1540483477*(R>>>16)&65535)<<16),(R^=R>>>15)>>>0};var mt=gt,xt=ft.exports;Ke.exports=mt,Ke.exports.murmur3=mt,Ke.exports.murmur2=xt;var Ft=h(Ke.exports);class Dt{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(d,b,C,R){this.ids.push(Ut(d)),this.positions.push(b,C,R)}getPositions(d){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const b=Ut(d);let C=0,R=this.ids.length-1;for(;C<R;){const V=C+R>>1;this.ids[V]>=b?R=V:C=V+1}const U=[];for(;this.ids[C]===b;)U.push({index:this.positions[3*C],start:this.positions[3*C+1],end:this.positions[3*C+2]}),C++;return U}static serialize(d,b){const C=new Float64Array(d.ids),R=new Uint32Array(d.positions);return Gt(C,R,0,C.length-1),b&&b.push(C.buffer,R.buffer),{ids:C,positions:R}}static deserialize(d){const b=new Dt;return b.ids=d.ids,b.positions=d.positions,b.indexed=!0,b}}function Ut(g){const d=+g;return!isNaN(d)&&d<=Number.MAX_SAFE_INTEGER?d:Ft(String(g))}function Gt(g,d,b,C){for(;b<C;){const R=g[b+C>>1];let U=b-1,V=C+1;for(;;){do U++;while(g[U]<R);do V--;while(g[V]>R);if(U>=V)break;zt(g,U,V),zt(d,3*U,3*V),zt(d,3*U+1,3*V+1),zt(d,3*U+2,3*V+2)}V-b<C-V?(Gt(g,d,b,V),b=V+1):(Gt(g,d,V+1,C),C=V)}}function zt(g,d,b){const C=g[d];g[d]=g[b],g[b]=C}pn("FeaturePositionMap",Dt);class ir{constructor(d,b){this.gl=d.gl,this.location=b}}class sr extends ir{constructor(d,b){super(d,b),this.current=0}set(d){this.current!==d&&(this.current=d,this.gl.uniform1f(this.location,d))}}class gr extends ir{constructor(d,b){super(d,b),this.current=[0,0,0,0]}set(d){d[0]===this.current[0]&&d[1]===this.current[1]&&d[2]===this.current[2]&&d[3]===this.current[3]||(this.current=d,this.gl.uniform4f(this.location,d[0],d[1],d[2],d[3]))}}class Er extends ir{constructor(d,b){super(d,b),this.current=On.transparent}set(d){d.r===this.current.r&&d.g===this.current.g&&d.b===this.current.b&&d.a===this.current.a||(this.current=d,this.gl.uniform4f(this.location,d.r,d.g,d.b,d.a))}}const fr=new Float32Array(16);function qr(g){return[Ce(255*g.r,255*g.g),Ce(255*g.b,255*g.a)]}class Jr{constructor(d,b,C){this.value=d,this.uniformNames=b.map(R=>`u_${R}`),this.type=C}setUniform(d,b,C){d.set(C.constantOr(this.value))}getBinding(d,b,C){return this.type==="color"?new Er(d,b):new sr(d,b)}}class Sr{constructor(d,b){this.uniformNames=b.map(C=>`u_${C}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(d,b){this.pixelRatioFrom=b.pixelRatio,this.pixelRatioTo=d.pixelRatio,this.patternFrom=b.tlbr,this.patternTo=d.tlbr}setUniform(d,b,C,R){const U=R==="u_pattern_to"?this.patternTo:R==="u_pattern_from"?this.patternFrom:R==="u_pixel_ratio_to"?this.pixelRatioTo:R==="u_pixel_ratio_from"?this.pixelRatioFrom:null;U&&d.set(U)}getBinding(d,b,C){return C.substr(0,9)==="u_pattern"?new gr(d,b):new sr(d,b)}}class tn{constructor(d,b,C,R){this.expression=d,this.type=C,this.maxValue=0,this.paintVertexAttributes=b.map(U=>({name:`a_${U}`,type:"Float32",components:C==="color"?2:1,offset:0})),this.paintVertexArray=new R}populatePaintArray(d,b,C,R,U){const V=this.paintVertexArray.length,K=this.expression.evaluate(new Fi(0),b,{},R,[],U);this.paintVertexArray.resize(d),this._setPaintValue(V,d,K)}updatePaintArray(d,b,C,R){const U=this.expression.evaluate({zoom:0},C,R);this._setPaintValue(d,b,U)}_setPaintValue(d,b,C){if(this.type==="color"){const R=qr(C);for(let U=d;U<b;U++)this.paintVertexArray.emplace(U,R[0],R[1])}else{for(let R=d;R<b;R++)this.paintVertexArray.emplace(R,C);this.maxValue=Math.max(this.maxValue,Math.abs(C))}}upload(d){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=d.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Yn{constructor(d,b,C,R,U,V){this.expression=d,this.uniformNames=b.map(K=>`u_${K}_t`),this.type=C,this.useIntegerZoom=R,this.zoom=U,this.maxValue=0,this.paintVertexAttributes=b.map(K=>({name:`a_${K}`,type:"Float32",components:C==="color"?4:2,offset:0})),this.paintVertexArray=new V}populatePaintArray(d,b,C,R,U){const V=this.expression.evaluate(new Fi(this.zoom),b,{},R,[],U),K=this.expression.evaluate(new Fi(this.zoom+1),b,{},R,[],U),ee=this.paintVertexArray.length;this.paintVertexArray.resize(d),this._setPaintValue(ee,d,V,K)}updatePaintArray(d,b,C,R){const U=this.expression.evaluate({zoom:this.zoom},C,R),V=this.expression.evaluate({zoom:this.zoom+1},C,R);this._setPaintValue(d,b,U,V)}_setPaintValue(d,b,C,R){if(this.type==="color"){const U=qr(C),V=qr(R);for(let K=d;K<b;K++)this.paintVertexArray.emplace(K,U[0],U[1],V[0],V[1])}else{for(let U=d;U<b;U++)this.paintVertexArray.emplace(U,C,R);this.maxValue=Math.max(this.maxValue,Math.abs(C),Math.abs(R))}}upload(d){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=d.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(d,b){const C=this.useIntegerZoom?Math.floor(b.zoom):b.zoom,R=ve(this.expression.interpolationFactor(C,this.zoom,this.zoom+1),0,1);d.set(R)}getBinding(d,b,C){return new sr(d,b)}}class oi{constructor(d,b,C,R,U,V){this.expression=d,this.type=b,this.useIntegerZoom=C,this.zoom=R,this.layerId=V,this.zoomInPaintVertexArray=new U,this.zoomOutPaintVertexArray=new U}populatePaintArray(d,b,C){const R=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(d),this.zoomOutPaintVertexArray.resize(d),this._setPaintValues(R,d,b.patterns&&b.patterns[this.layerId],C)}updatePaintArray(d,b,C,R,U){this._setPaintValues(d,b,C.patterns&&C.patterns[this.layerId],U)}_setPaintValues(d,b,C,R){if(!R||!C)return;const{min:U,mid:V,max:K}=C,ee=R[U],le=R[V],_e=R[K];if(ee&&le&&_e)for(let Be=d;Be<b;Be++)this.zoomInPaintVertexArray.emplace(Be,le.tl[0],le.tl[1],le.br[0],le.br[1],ee.tl[0],ee.tl[1],ee.br[0],ee.br[1],le.pixelRatio,ee.pixelRatio),this.zoomOutPaintVertexArray.emplace(Be,le.tl[0],le.tl[1],le.br[0],le.br[1],_e.tl[0],_e.tl[1],_e.br[0],_e.br[1],le.pixelRatio,_e.pixelRatio)}upload(d){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=d.createVertexBuffer(this.zoomInPaintVertexArray,Me.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=d.createVertexBuffer(this.zoomOutPaintVertexArray,Me.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class ws{constructor(d,b,C){this.binders={},this._buffers=[];const R=[];for(const U in d.paint._values){if(!C(U))continue;const V=d.paint.get(U);if(!(V instanceof Cl&&pc(V.property.specification)))continue;const K=Gs(U,d.type),ee=V.value,le=V.property.specification.type,_e=V.property.useIntegerZoom,Be=V.property.specification["property-type"],De=Be==="cross-faded"||Be==="cross-faded-data-driven";if(ee.kind==="constant")this.binders[U]=De?new Sr(ee.value,K):new Jr(ee.value,K,le),R.push(`/u_${U}`);else if(ee.kind==="source"||De){const Ge=Wi(U,le,"source");this.binders[U]=De?new oi(ee,le,_e,b,Ge,d.id):new tn(ee,K,le,Ge),R.push(`/a_${U}`)}else{const Ge=Wi(U,le,"composite");this.binders[U]=new Yn(ee,K,le,_e,b,Ge),R.push(`/z_${U}`)}}this.cacheKey=R.sort().join("")}getMaxValue(d){const b=this.binders[d];return b instanceof tn||b instanceof Yn?b.maxValue:0}populatePaintArrays(d,b,C,R,U){for(const V in this.binders){const K=this.binders[V];(K instanceof tn||K instanceof Yn||K instanceof oi)&&K.populatePaintArray(d,b,C,R,U)}}setConstantPatternPositions(d,b){for(const C in this.binders){const R=this.binders[C];R instanceof Sr&&R.setConstantPatternPositions(d,b)}}updatePaintArrays(d,b,C,R,U){let V=!1;for(const K in d){const ee=b.getPositions(K);for(const le of ee){const _e=C.feature(le.index);for(const Be in this.binders){const De=this.binders[Be];if((De instanceof tn||De instanceof Yn||De instanceof oi)&&De.expression.isStateDependent===!0){const Ge=R.paint.get(Be);De.expression=Ge.value,De.updatePaintArray(le.start,le.end,_e,d[K],U),V=!0}}}}return V}defines(){const d=[];for(const b in this.binders){const C=this.binders[b];(C instanceof Jr||C instanceof Sr)&&d.push(...C.uniformNames.map(R=>`#define HAS_UNIFORM_${R}`))}return d}getBinderAttributes(){const d=[];for(const b in this.binders){const C=this.binders[b];if(C instanceof tn||C instanceof Yn)for(let R=0;R<C.paintVertexAttributes.length;R++)d.push(C.paintVertexAttributes[R].name);else if(C instanceof oi)for(let R=0;R<Me.members.length;R++)d.push(Me.members[R].name)}return d}getBinderUniforms(){const d=[];for(const b in this.binders){const C=this.binders[b];if(C instanceof Jr||C instanceof Sr||C instanceof Yn)for(const R of C.uniformNames)d.push(R)}return d}getPaintVertexBuffers(){return this._buffers}getUniforms(d,b){const C=[];for(const R in this.binders){const U=this.binders[R];if(U instanceof Jr||U instanceof Sr||U instanceof Yn){for(const V of U.uniformNames)if(b[V]){const K=U.getBinding(d,b[V],V);C.push({name:V,property:R,binding:K})}}}return C}setUniforms(d,b,C,R){for(const{name:U,property:V,binding:K}of b)this.binders[V].setUniform(K,R,C.get(V),U)}updatePaintBuffers(d){this._buffers=[];for(const b in this.binders){const C=this.binders[b];if(d&&C instanceof oi){const R=d.fromScale===2?C.zoomInPaintVertexBuffer:C.zoomOutPaintVertexBuffer;R&&this._buffers.push(R)}else(C instanceof tn||C instanceof Yn)&&C.paintVertexBuffer&&this._buffers.push(C.paintVertexBuffer)}}upload(d){for(const b in this.binders){const C=this.binders[b];(C instanceof tn||C instanceof Yn||C instanceof oi)&&C.upload(d)}this.updatePaintBuffers()}destroy(){for(const d in this.binders){const b=this.binders[d];(b instanceof tn||b instanceof Yn||b instanceof oi)&&b.destroy()}}}class Oi{constructor(d,b){let C=arguments.length>2&&arguments[2]!==void 0?arguments[2]:()=>!0;this.programConfigurations={};for(const R of d)this.programConfigurations[R.id]=new ws(R,b,C);this.needsUpload=!1,this._featureMap=new Dt,this._bufferOffset=0}populatePaintArrays(d,b,C,R,U,V){for(const K in this.programConfigurations)this.programConfigurations[K].populatePaintArrays(d,b,R,U,V);b.id!==void 0&&this._featureMap.add(b.id,C,this._bufferOffset,d),this._bufferOffset=d,this.needsUpload=!0}updatePaintArrays(d,b,C,R){for(const U of C)this.needsUpload=this.programConfigurations[U.id].updatePaintArrays(d,this._featureMap,b,U,R)||this.needsUpload}get(d){return this.programConfigurations[d]}upload(d){if(this.needsUpload){for(const b in this.programConfigurations)this.programConfigurations[b].upload(d);this.needsUpload=!1}}destroy(){for(const d in this.programConfigurations)this.programConfigurations[d].destroy()}}function Gs(g,d){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[g]||[g.replace(`${d}-`,"").replace(/-/g,"_")]}function Wi(g,d,b){const C={color:{source:Fe,composite:xn},number:{source:Dr,composite:Fe}},R=function(U){return{"line-pattern":{source:D,composite:D},"fill-pattern":{source:D,composite:D},"fill-extrusion-pattern":{source:D,composite:D}}[U]}(g);return R&&R[b]||C[d][b]}pn("ConstantBinder",Jr),pn("CrossFadedConstantBinder",Sr),pn("SourceExpressionBinder",tn),pn("CrossFadedCompositeBinder",oi),pn("CompositeExpressionBinder",Yn),pn("ProgramConfiguration",ws,{omit:["_buffers"]}),pn("ProgramConfigurationSet",Oi);const ti=8192,Xi=Math.pow(2,14)-1,No=-Xi-1;function Rs(g){const d=ti/g.extent,b=g.loadGeometry();for(let C=0;C<b.length;C++){const R=b[C];for(let U=0;U<R.length;U++){const V=R[U],K=Math.round(V.x*d),ee=Math.round(V.y*d);V.x=ve(K,No,Xi),V.y=ve(ee,No,Xi),(K<V.x||K>V.x+1||ee<V.y||ee>V.y+1)&&tt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return b}function Bs(g,d){return{type:g.type,id:g.id,properties:g.properties,geometry:d?Rs(g):[]}}function ea(g,d,b,C,R){g.emplaceBack(2*d+(C+1)/2,2*b+(R+1)/2)}class tl{constructor(d){this.zoom=d.zoom,this.overscaling=d.overscaling,this.layers=d.layers,this.layerIds=this.layers.map(b=>b.id),this.index=d.index,this.hasPattern=!1,this.layoutVertexArray=new ns,this.indexArray=new G,this.segments=new pe,this.programConfigurations=new Oi(d.layers,d.zoom),this.stateDependentLayerIds=this.layers.filter(b=>b.isStateDependent()).map(b=>b.id)}populate(d,b,C){const R=this.layers[0],U=[];let V=null,K=!1;R.type==="circle"&&(V=R.layout.get("circle-sort-key"),K=!V.isConstant());for(const{feature:ee,id:le,index:_e,sourceLayerIndex:Be}of d){const De=this.layers[0]._featureFilter.needGeometry,Ge=Bs(ee,De);if(!this.layers[0]._featureFilter.filter(new Fi(this.zoom),Ge,C))continue;const et=K?V.evaluate(Ge,{},C):void 0,lt={id:le,properties:ee.properties,type:ee.type,sourceLayerIndex:Be,index:_e,geometry:De?Ge.geometry:Rs(ee),patterns:{},sortKey:et};U.push(lt)}K&&U.sort((ee,le)=>ee.sortKey-le.sortKey);for(const ee of U){const{geometry:le,index:_e,sourceLayerIndex:Be}=ee,De=d[_e].feature;this.addFeature(ee,le,_e,C),b.featureIndex.insert(De,le,_e,Be,this.index)}}update(d,b,C){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(d,b,this.stateDependentLayers,C)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(d){this.uploaded||(this.layoutVertexBuffer=d.createVertexBuffer(this.layoutVertexArray,oe),this.indexBuffer=d.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(d),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(d,b,C,R){for(const U of b)for(const V of U){const K=V.x,ee=V.y;if(K<0||K>=ti||ee<0||ee>=ti)continue;const le=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,d.sortKey),_e=le.vertexLength;ea(this.layoutVertexArray,K,ee,-1,-1),ea(this.layoutVertexArray,K,ee,1,-1),ea(this.layoutVertexArray,K,ee,1,1),ea(this.layoutVertexArray,K,ee,-1,1),this.indexArray.emplaceBack(_e,_e+1,_e+2),this.indexArray.emplaceBack(_e,_e+3,_e+2),le.vertexLength+=4,le.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,d,C,{},R)}}function jl(g,d){for(let b=0;b<g.length;b++)if(Io(d,g[b]))return!0;for(let b=0;b<d.length;b++)if(Io(g,d[b]))return!0;return!!El(g,d)}function Ma(g,d,b){return!!Io(g,d)||!!ra(d,g,b)}function ta(g,d){if(g.length===1)return ql(d,g[0]);for(let b=0;b<d.length;b++){const C=d[b];for(let R=0;R<C.length;R++)if(Io(g,C[R]))return!0}for(let b=0;b<g.length;b++)if(ql(d,g[b]))return!0;for(let b=0;b<d.length;b++)if(El(g,d[b]))return!0;return!1}function xc(g,d,b){if(g.length>1){if(El(g,d))return!0;for(let C=0;C<d.length;C++)if(ra(d[C],g,b))return!0}for(let C=0;C<g.length;C++)if(ra(g[C],d,b))return!0;return!1}function El(g,d){if(g.length===0||d.length===0)return!1;for(let b=0;b<g.length-1;b++){const C=g[b],R=g[b+1];for(let U=0;U<d.length-1;U++)if(Qu(C,R,d[U],d[U+1]))return!0}return!1}function Qu(g,d,b,C){return Ne(g,b,C)!==Ne(d,b,C)&&Ne(g,d,b)!==Ne(g,d,C)}function ra(g,d,b){const C=b*b;if(d.length===1)return g.distSqr(d[0])<C;for(let R=1;R<d.length;R++)if(Tl(g,d[R-1],d[R])<C)return!0;return!1}function Tl(g,d,b){const C=d.distSqr(b);if(C===0)return g.distSqr(d);const R=((g.x-d.x)*(b.x-d.x)+(g.y-d.y)*(b.y-d.y))/C;return g.distSqr(R<0?d:R>1?b:b.sub(d)._mult(R)._add(d))}function ql(g,d){let b,C,R,U=!1;for(let V=0;V<g.length;V++){b=g[V];for(let K=0,ee=b.length-1;K<b.length;ee=K++)C=b[K],R=b[ee],C.y>d.y!=R.y>d.y&&d.x<(R.x-C.x)*(d.y-C.y)/(R.y-C.y)+C.x&&(U=!U)}return U}function Io(g,d){let b=!1;for(let C=0,R=g.length-1;C<g.length;R=C++){const U=g[C],V=g[R];U.y>d.y!=V.y>d.y&&d.x<(V.x-U.x)*(d.y-U.y)/(V.y-U.y)+U.x&&(b=!b)}return b}function Ji(g,d,b){const C=b[0],R=b[2];if(g.x<C.x&&d.x<C.x||g.x>R.x&&d.x>R.x||g.y<C.y&&d.y<C.y||g.y>R.y&&d.y>R.y)return!1;const U=Ne(g,d,b[0]);return U!==Ne(g,d,b[1])||U!==Ne(g,d,b[2])||U!==Ne(g,d,b[3])}function Cs(g,d,b){const C=d.paint.get(g).value;return C.kind==="constant"?C.value:b.programConfigurations.get(d.id).getMaxValue(g)}function Sl(g){return Math.sqrt(g[0]*g[0]+g[1]*g[1])}function Qs(g,d,b,C,R){if(!d[0]&&!d[1])return g;const U=x.convert(d)._mult(R);b==="viewport"&&U._rotate(-C);const V=[];for(let K=0;K<g.length;K++)V.push(g[K].sub(U));return V}let yy,Pm;pn("CircleBucket",tl,{omit:["layers"]});var Fm={get paint(){return Pm=Pm||new E({"circle-radius":new Wn(We.paint_circle["circle-radius"]),"circle-color":new Wn(We.paint_circle["circle-color"]),"circle-blur":new Wn(We.paint_circle["circle-blur"]),"circle-opacity":new Wn(We.paint_circle["circle-opacity"]),"circle-translate":new vn(We.paint_circle["circle-translate"]),"circle-translate-anchor":new vn(We.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new vn(We.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new vn(We.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Wn(We.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Wn(We.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Wn(We.paint_circle["circle-stroke-opacity"])})},get layout(){return yy=yy||new E({"circle-sort-key":new Wn(We.layout_circle["circle-sort-key"])})}},rl=1e-6,Tu=typeof Float32Array<"u"?Float32Array:Array;function jh(g){return g[0]=1,g[1]=0,g[2]=0,g[3]=0,g[4]=0,g[5]=1,g[6]=0,g[7]=0,g[8]=0,g[9]=0,g[10]=1,g[11]=0,g[12]=0,g[13]=0,g[14]=0,g[15]=1,g}function qh(g,d,b){var C=d[0],R=d[1],U=d[2],V=d[3],K=d[4],ee=d[5],le=d[6],_e=d[7],Be=d[8],De=d[9],Ge=d[10],et=d[11],lt=d[12],Ct=d[13],p=d[14],u=d[15],A=b[0],v=b[1],M=b[2],L=b[3];return g[0]=A*C+v*K+M*Be+L*lt,g[1]=A*R+v*ee+M*De+L*Ct,g[2]=A*U+v*le+M*Ge+L*p,g[3]=A*V+v*_e+M*et+L*u,g[4]=(A=b[4])*C+(v=b[5])*K+(M=b[6])*Be+(L=b[7])*lt,g[5]=A*R+v*ee+M*De+L*Ct,g[6]=A*U+v*le+M*Ge+L*p,g[7]=A*V+v*_e+M*et+L*u,g[8]=(A=b[8])*C+(v=b[9])*K+(M=b[10])*Be+(L=b[11])*lt,g[9]=A*R+v*ee+M*De+L*Ct,g[10]=A*U+v*le+M*Ge+L*p,g[11]=A*V+v*_e+M*et+L*u,g[12]=(A=b[12])*C+(v=b[13])*K+(M=b[14])*Be+(L=b[15])*lt,g[13]=A*R+v*ee+M*De+L*Ct,g[14]=A*U+v*le+M*Ge+L*p,g[15]=A*V+v*_e+M*et+L*u,g}Math.hypot||(Math.hypot=function(){for(var g=0,d=arguments.length;d--;)g+=arguments[d]*arguments[d];return Math.sqrt(g)});var sA,$p=qh;function oA(g,d,b){var C=d[0],R=d[1],U=d[2],V=d[3];return g[0]=b[0]*C+b[4]*R+b[8]*U+b[12]*V,g[1]=b[1]*C+b[5]*R+b[9]*U+b[13]*V,g[2]=b[2]*C+b[6]*R+b[10]*U+b[14]*V,g[3]=b[3]*C+b[7]*R+b[11]*U+b[15]*V,g}sA=new Tu(4),Tu!=Float32Array&&(sA[0]=0,sA[1]=0,sA[2]=0,sA[3]=0);class Rm extends y{constructor(d){super(d,Fm)}createBucket(d){return new tl(d)}queryRadius(d){const b=d;return Cs("circle-radius",this,b)+Cs("circle-stroke-width",this,b)+Sl(this.paint.get("circle-translate"))}queryIntersectsFeature(d,b,C,R,U,V,K,ee){const le=Qs(d,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),V.angle,K),_e=this.paint.get("circle-radius").evaluate(b,C)+this.paint.get("circle-stroke-width").evaluate(b,C),Be=this.paint.get("circle-pitch-alignment")==="map",De=Be?le:function(et,lt){return et.map(Ct=>jp(Ct,lt))}(le,ee),Ge=Be?_e*K:_e;for(const et of R)for(const lt of et){const Ct=Be?lt:jp(lt,ee);let p=Ge;const u=oA([],[lt.x,lt.y,0,1],ee);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?p*=u[3]/V.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(p*=V.cameraToCenterDistance/u[3]),Ma(De,Ct,p))return!0}return!1}}function jp(g,d){const b=oA([],[g.x,g.y,0,1],d);return new x(b[0]/b[3],b[1]/b[3])}class qp extends tl{}let by;pn("HeatmapBucket",qp,{omit:["layers"]});var bD={get paint(){return by=by||new E({"heatmap-radius":new Wn(We.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Wn(We.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new vn(We.paint_heatmap["heatmap-intensity"]),"heatmap-color":new X(We.paint_heatmap["heatmap-color"]),"heatmap-opacity":new vn(We.paint_heatmap["heatmap-opacity"])})}};function Lm(g,d,b,C){let{width:R,height:U}=d;if(C){if(C instanceof Uint8ClampedArray)C=new Uint8Array(C.buffer);else if(C.length!==R*U*b)throw new RangeError(`mismatched image size. expected: ${C.length} but got: ${R*U*b}`)}else C=new Uint8Array(R*U*b);return g.width=R,g.height=U,g.data=C,g}function Ev(g,d,b){let{width:C,height:R}=d;if(C===g.width&&R===g.height)return;const U=Lm({},{width:C,height:R},b);vy(g,U,{x:0,y:0},{x:0,y:0},{width:Math.min(g.width,C),height:Math.min(g.height,R)},b),g.width=C,g.height=R,g.data=U.data}function vy(g,d,b,C,R,U){if(R.width===0||R.height===0)return d;if(R.width>g.width||R.height>g.height||b.x>g.width-R.width||b.y>g.height-R.height)throw new RangeError("out of range source coordinates for image copy");if(R.width>d.width||R.height>d.height||C.x>d.width-R.width||C.y>d.height-R.height)throw new RangeError("out of range destination coordinates for image copy");const V=g.data,K=d.data;if(V===K)throw new Error("srcData equals dstData, so image is already copied");for(let ee=0;ee<R.height;ee++){const le=((b.y+ee)*g.width+b.x)*U,_e=((C.y+ee)*d.width+C.x)*U;for(let Be=0;Be<R.width*U;Be++)K[_e+Be]=V[le+Be]}return d}class Ed{constructor(d,b){Lm(this,d,1,b)}resize(d){Ev(this,d,1)}clone(){return new Ed({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(d,b,C,R,U){vy(d,b,C,R,U,1)}}class $u{constructor(d,b){Lm(this,d,4,b)}resize(d){Ev(this,d,4)}replace(d,b){b?this.data.set(d):this.data=d instanceof Uint8ClampedArray?new Uint8Array(d.buffer):d}clone(){return new $u({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(d,b,C,R,U){vy(d,b,C,R,U,4)}}function Kp(g){const d={},b=g.resolution||256,C=g.clips?g.clips.length:1,R=g.image||new $u({width:b,height:C});if(Math.log(b)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${b}`);const U=(V,K,ee)=>{d[g.evaluationKey]=ee;const le=g.expression.evaluate(d);R.data[V+K+0]=Math.floor(255*le.r/le.a),R.data[V+K+1]=Math.floor(255*le.g/le.a),R.data[V+K+2]=Math.floor(255*le.b/le.a),R.data[V+K+3]=Math.floor(255*le.a)};if(g.clips)for(let V=0,K=0;V<C;++V,K+=4*b)for(let ee=0,le=0;ee<b;ee++,le+=4){const _e=ee/(b-1),{start:Be,end:De}=g.clips[V];U(K,le,Be*(1-_e)+De*_e)}else for(let V=0,K=0;V<b;V++,K+=4)U(0,K,V/(b-1));return R}pn("AlphaImage",Ed),pn("RGBAImage",$u);const Wp="big-fb";class xy extends y{createBucket(d){return new qp(d)}constructor(d){super(d,bD),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(d){d==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Kp({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(Wp)&&this.heatmapFbos.delete(Wp)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Tv;var lT={get paint(){return Tv=Tv||new E({"hillshade-illumination-direction":new vn(We.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new vn(We.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new vn(We.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new vn(We.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new vn(We.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new vn(We.paint_hillshade["hillshade-accent-color"])})}};class vD extends y{constructor(d){super(d,lT)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const xD=H([{name:"a_pos",components:2,type:"Int16"}],4),{members:cT}=xD;function Sv(g,d){let b=arguments.length>2&&arguments[2]!==void 0?arguments[2]:2;const C=d&&d.length,R=C?d[0]*b:g.length;let U=Iv(g,0,R,b,!0);const V=[];if(!U||U.next===U.prev)return V;let K,ee,le;if(C&&(U=function(_e,Be,De,Ge){const et=[];for(let lt=0,Ct=Be.length;lt<Ct;lt++){const p=Iv(_e,Be[lt]*Ge,lt<Ct-1?Be[lt+1]*Ge:_e.length,Ge,!1);p===p.next&&(p.steiner=!0),et.push(BD(p))}et.sort(hT);for(let lt=0;lt<et.length;lt++)De=Pv(et[lt],De);return De}(g,d,U,b)),g.length>80*b){K=1/0,ee=1/0;let _e=-1/0,Be=-1/0;for(let De=b;De<R;De+=b){const Ge=g[De],et=g[De+1];Ge<K&&(K=Ge),et<ee&&(ee=et),Ge>_e&&(_e=Ge),et>Be&&(Be=et)}le=Math.max(_e-K,Be-ee),le=le!==0?32767/le:0}return UA(U,V,b,K,ee,le,0),V}function Iv(g,d,b,C,R){let U;if(R===function(V,K,ee,le){let _e=0;for(let Be=K,De=ee-le;Be<ee;Be+=le)_e+=(V[De]-V[Be])*(V[Be+1]+V[De+1]),De=Be;return _e}(g,d,b,C)>0)for(let V=d;V<b;V+=C)U=fT(V/C|0,g[V],g[V+1],U);else for(let V=b-C;V>=d;V-=C)U=fT(V/C|0,g[V],g[V+1],U);return U&&Jp(U,U.next)&&(km(U),U=U.next),U}function kA(g,d){if(!g)return g;d||(d=g);let b,C=g;do if(b=!1,C.steiner||!Jp(C,C.next)&&zo(C.prev,C,C.next)!==0)C=C.next;else{if(km(C),C=d=C.prev,C===C.next)break;b=!0}while(b||C!==d);return d}function UA(g,d,b,C,R,U,V){if(!g)return;!V&&U&&function(ee,le,_e,Be){let De=ee;do De.z===0&&(De.z=wy(De.x,De.y,le,_e,Be)),De.prevZ=De.prev,De.nextZ=De.next,De=De.next;while(De!==ee);De.prevZ.nextZ=null,De.prevZ=null,function(Ge){let et,lt=1;do{let Ct,p=Ge;Ge=null;let u=null;for(et=0;p;){et++;let A=p,v=0;for(let L=0;L<lt&&(v++,A=A.nextZ,A);L++);let M=lt;for(;v>0||M>0&&A;)v!==0&&(M===0||!A||p.z<=A.z)?(Ct=p,p=p.nextZ,v--):(Ct=A,A=A.nextZ,M--),u?u.nextZ=Ct:Ge=Ct,Ct.prevZ=u,u=Ct;p=A}u.nextZ=null,lt*=2}while(et>1)}(De)}(g,C,R,U);let K=g;for(;g.prev!==g.next;){const ee=g.prev,le=g.next;if(U?Mv(g,C,R,U):uT(g))d.push(ee.i,g.i,le.i),km(g),g=le.next,K=le.next;else if((g=le)===K){V?V===1?UA(g=Dm(kA(g),d),d,b,C,R,U,2):V===2&&ju(g,d,b,C,R,U):UA(kA(g),d,b,C,R,U,1);break}}}function uT(g){const d=g.prev,b=g,C=g.next;if(zo(d,b,C)>=0)return!1;const R=d.x,U=b.x,V=C.x,K=d.y,ee=b.y,le=C.y,_e=R<U?R<V?R:V:U<V?U:V,Be=K<ee?K<le?K:le:ee<le?ee:le,De=R>U?R>V?R:V:U>V?U:V,Ge=K>ee?K>le?K:le:ee>le?ee:le;let et=C.next;for(;et!==d;){if(et.x>=_e&&et.x<=De&&et.y>=Be&&et.y<=Ge&&Xp(R,K,U,ee,V,le,et.x,et.y)&&zo(et.prev,et,et.next)>=0)return!1;et=et.next}return!0}function Mv(g,d,b,C){const R=g.prev,U=g,V=g.next;if(zo(R,U,V)>=0)return!1;const K=R.x,ee=U.x,le=V.x,_e=R.y,Be=U.y,De=V.y,Ge=K<ee?K<le?K:le:ee<le?ee:le,et=_e<Be?_e<De?_e:De:Be<De?Be:De,lt=K>ee?K>le?K:le:ee>le?ee:le,Ct=_e>Be?_e>De?_e:De:Be>De?Be:De,p=wy(Ge,et,d,b,C),u=wy(lt,Ct,d,b,C);let A=g.prevZ,v=g.nextZ;for(;A&&A.z>=p&&v&&v.z<=u;){if(A.x>=Ge&&A.x<=lt&&A.y>=et&&A.y<=Ct&&A!==R&&A!==V&&Xp(K,_e,ee,Be,le,De,A.x,A.y)&&zo(A.prev,A,A.next)>=0||(A=A.prevZ,v.x>=Ge&&v.x<=lt&&v.y>=et&&v.y<=Ct&&v!==R&&v!==V&&Xp(K,_e,ee,Be,le,De,v.x,v.y)&&zo(v.prev,v,v.next)>=0))return!1;v=v.nextZ}for(;A&&A.z>=p;){if(A.x>=Ge&&A.x<=lt&&A.y>=et&&A.y<=Ct&&A!==R&&A!==V&&Xp(K,_e,ee,Be,le,De,A.x,A.y)&&zo(A.prev,A,A.next)>=0)return!1;A=A.prevZ}for(;v&&v.z<=u;){if(v.x>=Ge&&v.x<=lt&&v.y>=et&&v.y<=Ct&&v!==R&&v!==V&&Xp(K,_e,ee,Be,le,De,v.x,v.y)&&zo(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}function Dm(g,d){let b=g;do{const C=b.prev,R=b.next.next;!Jp(C,R)&&By(C,b,b.next,R)&&Bf(C,R)&&Bf(R,C)&&(d.push(C.i,b.i,R.i),km(b),km(b.next),b=g=R),b=b.next}while(b!==g);return kA(b)}function ju(g,d,b,C,R,U){let V=g;do{let K=V.next.next;for(;K!==V.prev;){if(V.i!==K.i&&CD(V,K)){let ee=dT(V,K);return V=kA(V,V.next),ee=kA(ee,ee.next),UA(V,d,b,C,R,U,0),void UA(ee,d,b,C,R,U,0)}K=K.next}V=V.next}while(V!==g)}function hT(g,d){return g.x-d.x}function Pv(g,d){const b=function(R,U){let V=U;const K=R.x,ee=R.y;let le,_e=-1/0;do{if(ee<=V.y&&ee>=V.next.y&&V.next.y!==V.y){const lt=V.x+(ee-V.y)*(V.next.x-V.x)/(V.next.y-V.y);if(lt<=K&&lt>_e&&(_e=lt,le=V.x<V.next.x?V:V.next,lt===K))return le}V=V.next}while(V!==U);if(!le)return null;const Be=le,De=le.x,Ge=le.y;let et=1/0;V=le;do{if(K>=V.x&&V.x>=De&&K!==V.x&&Xp(ee<Ge?K:_e,ee,De,Ge,ee<Ge?_e:K,ee,V.x,V.y)){const lt=Math.abs(ee-V.y)/(K-V.x);Bf(V,R)&&(lt<et||lt===et&&(V.x>le.x||V.x===le.x&&wD(le,V)))&&(le=V,et=lt)}V=V.next}while(V!==Be);return le}(g,d);if(!b)return d;const C=dT(b,g);return kA(C,C.next),kA(b,b.next)}function wD(g,d){return zo(g.prev,g,d.prev)<0&&zo(d.next,g,g.next)<0}function wy(g,d,b,C,R){return(g=1431655765&((g=858993459&((g=252645135&((g=16711935&((g=(g-b)*R|0)|g<<8))|g<<4))|g<<2))|g<<1))|(d=1431655765&((d=858993459&((d=252645135&((d=16711935&((d=(d-C)*R|0)|d<<8))|d<<4))|d<<2))|d<<1))<<1}function BD(g){let d=g,b=g;do(d.x<b.x||d.x===b.x&&d.y<b.y)&&(b=d),d=d.next;while(d!==g);return b}function Xp(g,d,b,C,R,U,V,K){return(R-V)*(d-K)>=(g-V)*(U-K)&&(g-V)*(C-K)>=(b-V)*(d-K)&&(b-V)*(U-K)>=(R-V)*(C-K)}function CD(g,d){return g.next.i!==d.i&&g.prev.i!==d.i&&!function(b,C){let R=b;do{if(R.i!==b.i&&R.next.i!==b.i&&R.i!==C.i&&R.next.i!==C.i&&By(R,R.next,b,C))return!0;R=R.next}while(R!==b);return!1}(g,d)&&(Bf(g,d)&&Bf(d,g)&&function(b,C){let R=b,U=!1;const V=(b.x+C.x)/2,K=(b.y+C.y)/2;do R.y>K!=R.next.y>K&&R.next.y!==R.y&&V<(R.next.x-R.x)*(K-R.y)/(R.next.y-R.y)+R.x&&(U=!U),R=R.next;while(R!==b);return U}(g,d)&&(zo(g.prev,g,d.prev)||zo(g,d.prev,d))||Jp(g,d)&&zo(g.prev,g,g.next)>0&&zo(d.prev,d,d.next)>0)}function zo(g,d,b){return(d.y-g.y)*(b.x-d.x)-(d.x-g.x)*(b.y-d.y)}function Jp(g,d){return g.x===d.x&&g.y===d.y}function By(g,d,b,C){const R=Td(zo(g,d,b)),U=Td(zo(g,d,C)),V=Td(zo(b,C,g)),K=Td(zo(b,C,d));return R!==U&&V!==K||!(R!==0||!Om(g,b,d))||!(U!==0||!Om(g,C,d))||!(V!==0||!Om(b,g,C))||!(K!==0||!Om(b,d,C))}function Om(g,d,b){return d.x<=Math.max(g.x,b.x)&&d.x>=Math.min(g.x,b.x)&&d.y<=Math.max(g.y,b.y)&&d.y>=Math.min(g.y,b.y)}function Td(g){return g>0?1:g<0?-1:0}function Bf(g,d){return zo(g.prev,g,g.next)<0?zo(g,d,g.next)>=0&&zo(g,g.prev,d)>=0:zo(g,d,g.prev)<0||zo(g,g.next,d)<0}function dT(g,d){const b=Fv(g.i,g.x,g.y),C=Fv(d.i,d.x,d.y),R=g.next,U=d.prev;return g.next=d,d.prev=g,b.next=R,R.prev=b,C.next=b,b.prev=C,U.next=C,C.prev=U,C}function fT(g,d,b,C){const R=Fv(g,d,b);return C?(R.next=C.next,R.prev=C,C.next.prev=R,C.next=R):(R.prev=R,R.next=R),R}function km(g){g.next.prev=g.prev,g.prev.next=g.next,g.prevZ&&(g.prevZ.nextZ=g.nextZ),g.nextZ&&(g.nextZ.prevZ=g.prevZ)}function Fv(g,d,b){return{i:g,x:d,y:b,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Rv(g,d,b){const C=b.patternDependencies;let R=!1;for(const U of d){const V=U.paint.get(`${g}-pattern`);V.isConstant()||(R=!0);const K=V.constantOr(null);K&&(R=!0,C[K.to]=!0,C[K.from]=!0)}return R}function Lv(g,d,b,C,R){const U=R.patternDependencies;for(const V of d){const K=V.paint.get(`${g}-pattern`).value;if(K.kind!=="constant"){let ee=K.evaluate({zoom:C-1},b,{},R.availableImages),le=K.evaluate({zoom:C},b,{},R.availableImages),_e=K.evaluate({zoom:C+1},b,{},R.availableImages);ee=ee&&ee.name?ee.name:ee,le=le&&le.name?le.name:le,_e=_e&&_e.name?_e.name:_e,U[ee]=!0,U[le]=!0,U[_e]=!0,b.patterns[V.id]={min:ee,mid:le,max:_e}}}return b}class Dv{constructor(d){this.zoom=d.zoom,this.overscaling=d.overscaling,this.layers=d.layers,this.layerIds=this.layers.map(b=>b.id),this.index=d.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Uo,this.indexArray=new G,this.indexArray2=new J,this.programConfigurations=new Oi(d.layers,d.zoom),this.segments=new pe,this.segments2=new pe,this.stateDependentLayerIds=this.layers.filter(b=>b.isStateDependent()).map(b=>b.id)}populate(d,b,C){this.hasPattern=Rv("fill",this.layers,b);const R=this.layers[0].layout.get("fill-sort-key"),U=!R.isConstant(),V=[];for(const{feature:K,id:ee,index:le,sourceLayerIndex:_e}of d){const Be=this.layers[0]._featureFilter.needGeometry,De=Bs(K,Be);if(!this.layers[0]._featureFilter.filter(new Fi(this.zoom),De,C))continue;const Ge=U?R.evaluate(De,{},C,b.availableImages):void 0,et={id:ee,properties:K.properties,type:K.type,sourceLayerIndex:_e,index:le,geometry:Be?De.geometry:Rs(K),patterns:{},sortKey:Ge};V.push(et)}U&&V.sort((K,ee)=>K.sortKey-ee.sortKey);for(const K of V){const{geometry:ee,index:le,sourceLayerIndex:_e}=K;if(this.hasPattern){const Be=Lv("fill",this.layers,K,this.zoom,b);this.patternFeatures.push(Be)}else this.addFeature(K,ee,le,C,{});b.featureIndex.insert(d[le].feature,ee,le,_e,this.index)}}update(d,b,C){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(d,b,this.stateDependentLayers,C)}addFeatures(d,b,C){for(const R of this.patternFeatures)this.addFeature(R,R.geometry,R.index,b,C)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(d){this.uploaded||(this.layoutVertexBuffer=d.createVertexBuffer(this.layoutVertexArray,cT),this.indexBuffer=d.createIndexBuffer(this.indexArray),this.indexBuffer2=d.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(d),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(d,b,C,R,U){for(const V of cc(b,500)){let K=0;for(const Ge of V)K+=Ge.length;const ee=this.segments.prepareSegment(K,this.layoutVertexArray,this.indexArray),le=ee.vertexLength,_e=[],Be=[];for(const Ge of V){if(Ge.length===0)continue;Ge!==V[0]&&Be.push(_e.length/2);const et=this.segments2.prepareSegment(Ge.length,this.layoutVertexArray,this.indexArray2),lt=et.vertexLength;this.layoutVertexArray.emplaceBack(Ge[0].x,Ge[0].y),this.indexArray2.emplaceBack(lt+Ge.length-1,lt),_e.push(Ge[0].x),_e.push(Ge[0].y);for(let Ct=1;Ct<Ge.length;Ct++)this.layoutVertexArray.emplaceBack(Ge[Ct].x,Ge[Ct].y),this.indexArray2.emplaceBack(lt+Ct-1,lt+Ct),_e.push(Ge[Ct].x),_e.push(Ge[Ct].y);et.vertexLength+=Ge.length,et.primitiveLength+=Ge.length}const De=Sv(_e,Be);for(let Ge=0;Ge<De.length;Ge+=3)this.indexArray.emplaceBack(le+De[Ge],le+De[Ge+1],le+De[Ge+2]);ee.vertexLength+=K,ee.primitiveLength+=De.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,d,C,U,R)}}let Cy,AT;pn("FillBucket",Dv,{omit:["layers","patternFeatures"]});var pT={get paint(){return AT=AT||new E({"fill-antialias":new vn(We.paint_fill["fill-antialias"]),"fill-opacity":new Wn(We.paint_fill["fill-opacity"]),"fill-color":new Wn(We.paint_fill["fill-color"]),"fill-outline-color":new Wn(We.paint_fill["fill-outline-color"]),"fill-translate":new vn(We.paint_fill["fill-translate"]),"fill-translate-anchor":new vn(We.paint_fill["fill-translate-anchor"]),"fill-pattern":new Eu(We.paint_fill["fill-pattern"])})},get layout(){return Cy=Cy||new E({"fill-sort-key":new Wn(We.layout_fill["fill-sort-key"])})}};class Um extends y{constructor(d){super(d,pT)}recalculate(d,b){super.recalculate(d,b);const C=this.paint._values["fill-outline-color"];C.value.kind==="constant"&&C.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(d){return new Dv(d)}queryRadius(){return Sl(this.paint.get("fill-translate"))}queryIntersectsFeature(d,b,C,R,U,V,K){return ta(Qs(d,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),V.angle,K),R)}isTileClipped(){return!0}}const ED=H([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Ho=H([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Zp}=ED;var Cf={},Ey=f,Nm=Sd;function Sd(g,d,b,C,R){this.properties={},this.extent=b,this.type=0,this._pbf=g,this._geometry=-1,this._keys=C,this._values=R,g.readFields(gT,this,d)}function gT(g,d,b){g==1?d.id=b.readVarint():g==2?function(C,R){for(var U=C.readVarint()+C.pos;C.pos<U;){var V=R._keys[C.readVarint()],K=R._values[C.readVarint()];R.properties[V]=K}}(b,d):g==3?d.type=b.readVarint():g==4&&(d._geometry=b.pos)}function mT(g){for(var d,b,C=0,R=0,U=g.length,V=U-1;R<U;V=R++)C+=((b=g[V]).x-(d=g[R]).x)*(d.y+b.y);return C}Sd.types=["Unknown","Point","LineString","Polygon"],Sd.prototype.loadGeometry=function(){var g=this._pbf;g.pos=this._geometry;for(var d,b=g.readVarint()+g.pos,C=1,R=0,U=0,V=0,K=[];g.pos<b;){if(R<=0){var ee=g.readVarint();C=7&ee,R=ee>>3}if(R--,C===1||C===2)U+=g.readSVarint(),V+=g.readSVarint(),C===1&&(d&&K.push(d),d=[]),d.push(new Ey(U,V));else{if(C!==7)throw new Error("unknown command "+C);d&&d.push(d[0].clone())}}return d&&K.push(d),K},Sd.prototype.bbox=function(){var g=this._pbf;g.pos=this._geometry;for(var d=g.readVarint()+g.pos,b=1,C=0,R=0,U=0,V=1/0,K=-1/0,ee=1/0,le=-1/0;g.pos<d;){if(C<=0){var _e=g.readVarint();b=7&_e,C=_e>>3}if(C--,b===1||b===2)(R+=g.readSVarint())<V&&(V=R),R>K&&(K=R),(U+=g.readSVarint())<ee&&(ee=U),U>le&&(le=U);else if(b!==7)throw new Error("unknown command "+b)}return[V,ee,K,le]},Sd.prototype.toGeoJSON=function(g,d,b){var C,R,U=this.extent*Math.pow(2,b),V=this.extent*g,K=this.extent*d,ee=this.loadGeometry(),le=Sd.types[this.type];function _e(Ge){for(var et=0;et<Ge.length;et++){var lt=Ge[et];Ge[et]=[360*(lt.x+V)/U-180,360/Math.PI*Math.atan(Math.exp((180-360*(lt.y+K)/U)*Math.PI/180))-90]}}switch(this.type){case 1:var Be=[];for(C=0;C<ee.length;C++)Be[C]=ee[C][0];_e(ee=Be);break;case 2:for(C=0;C<ee.length;C++)_e(ee[C]);break;case 3:for(ee=function(Ge){var et=Ge.length;if(et<=1)return[Ge];for(var lt,Ct,p=[],u=0;u<et;u++){var A=mT(Ge[u]);A!==0&&(Ct===void 0&&(Ct=A<0),Ct===A<0?(lt&&p.push(lt),lt=[Ge[u]]):lt.push(Ge[u]))}return lt&&p.push(lt),p}(ee),C=0;C<ee.length;C++)for(R=0;R<ee[C].length;R++)_e(ee[C][R])}ee.length===1?ee=ee[0]:le="Multi"+le;var De={type:"Feature",geometry:{type:le,coordinates:ee},properties:this.properties};return"id"in this&&(De.id=this.id),De};var zm=Nm,Ty=NA;function NA(g,d){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=g,this._keys=[],this._values=[],this._features=[],g.readFields(Sy,this,d),this.length=this._features.length}function Sy(g,d,b){g===15?d.version=b.readVarint():g===1?d.name=b.readString():g===5?d.extent=b.readVarint():g===2?d._features.push(b.pos):g===3?d._keys.push(b.readString()):g===4&&d._values.push(function(C){for(var R=null,U=C.readVarint()+C.pos;C.pos<U;){var V=C.readVarint()>>3;R=V===1?C.readString():V===2?C.readFloat():V===3?C.readDouble():V===4?C.readVarint64():V===5?C.readVarint():V===6?C.readSVarint():V===7?C.readBoolean():null}return R}(b))}NA.prototype.feature=function(g){if(g<0||g>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[g];var d=this._pbf.readVarint()+this._pbf.pos;return new zm(this._pbf,d,this.extent,this._keys,this._values)};var Yp=Ty;function Hm(g,d,b){if(g===3){var C=new Yp(b,b.readVarint()+b.pos);C.length&&(d[C.name]=C)}}Cf.VectorTile=function(g,d){this.layers=g.readFields(Hm,{},d)},Cf.VectorTileFeature=Nm,Cf.VectorTileLayer=Ty;const TD=Cf.VectorTileFeature.types,Iy=Math.pow(2,13);function Kh(g,d,b,C,R,U,V,K){g.emplaceBack(d,b,2*Math.floor(C*Iy)+V,R*Iy*2,U*Iy*2,Math.round(K))}class Ov{constructor(d){this.zoom=d.zoom,this.overscaling=d.overscaling,this.layers=d.layers,this.layerIds=this.layers.map(b=>b.id),this.index=d.index,this.hasPattern=!1,this.layoutVertexArray=new da,this.centroidVertexArray=new us,this.indexArray=new G,this.programConfigurations=new Oi(d.layers,d.zoom),this.segments=new pe,this.stateDependentLayerIds=this.layers.filter(b=>b.isStateDependent()).map(b=>b.id)}populate(d,b,C){this.features=[],this.hasPattern=Rv("fill-extrusion",this.layers,b);for(const{feature:R,id:U,index:V,sourceLayerIndex:K}of d){const ee=this.layers[0]._featureFilter.needGeometry,le=Bs(R,ee);if(!this.layers[0]._featureFilter.filter(new Fi(this.zoom),le,C))continue;const _e={id:U,sourceLayerIndex:K,index:V,geometry:ee?le.geometry:Rs(R),properties:R.properties,type:R.type,patterns:{}};this.hasPattern?this.features.push(Lv("fill-extrusion",this.layers,_e,this.zoom,b)):this.addFeature(_e,_e.geometry,V,C,{}),b.featureIndex.insert(R,_e.geometry,V,K,this.index,!0)}}addFeatures(d,b,C){for(const R of this.features){const{geometry:U}=R;this.addFeature(R,U,R.index,b,C)}}update(d,b,C){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(d,b,this.stateDependentLayers,C)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(d){this.uploaded||(this.layoutVertexBuffer=d.createVertexBuffer(this.layoutVertexArray,Zp),this.centroidVertexBuffer=d.createVertexBuffer(this.centroidVertexArray,Ho.members,!0),this.indexBuffer=d.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(d),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(d,b,C,R,U){for(const V of cc(b,500)){const K={x:0,y:0,vertexCount:0};let ee=0;for(const et of V)ee+=et.length;let le=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const et of V){if(et.length===0||Vm(et))continue;let lt=0;for(let Ct=0;Ct<et.length;Ct++){const p=et[Ct];if(Ct>=1){const u=et[Ct-1];if(!_T(p,u)){le.vertexLength+4>pe.MAX_VERTEX_ARRAY_LENGTH&&(le=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const A=p.sub(u)._perp()._unit(),v=u.dist(p);lt+v>32768&&(lt=0),Kh(this.layoutVertexArray,p.x,p.y,A.x,A.y,0,0,lt),Kh(this.layoutVertexArray,p.x,p.y,A.x,A.y,0,1,lt),K.x+=2*p.x,K.y+=2*p.y,K.vertexCount+=2,lt+=v,Kh(this.layoutVertexArray,u.x,u.y,A.x,A.y,0,0,lt),Kh(this.layoutVertexArray,u.x,u.y,A.x,A.y,0,1,lt),K.x+=2*u.x,K.y+=2*u.y,K.vertexCount+=2;const M=le.vertexLength;this.indexArray.emplaceBack(M,M+2,M+1),this.indexArray.emplaceBack(M+1,M+2,M+3),le.vertexLength+=4,le.primitiveLength+=2}}}}if(le.vertexLength+ee>pe.MAX_VERTEX_ARRAY_LENGTH&&(le=this.segments.prepareSegment(ee,this.layoutVertexArray,this.indexArray)),TD[d.type]!=="Polygon")continue;const _e=[],Be=[],De=le.vertexLength;for(const et of V)if(et.length!==0){et!==V[0]&&Be.push(_e.length/2);for(let lt=0;lt<et.length;lt++){const Ct=et[lt];Kh(this.layoutVertexArray,Ct.x,Ct.y,0,0,1,1,0),K.x+=Ct.x,K.y+=Ct.y,K.vertexCount+=1,_e.push(Ct.x),_e.push(Ct.y)}}const Ge=Sv(_e,Be);for(let et=0;et<Ge.length;et+=3)this.indexArray.emplaceBack(De+Ge[et],De+Ge[et+2],De+Ge[et+1]);le.primitiveLength+=Ge.length/3,le.vertexLength+=ee;for(let et=0;et<K.vertexCount;et++){const lt=Math.floor(K.x/K.vertexCount),Ct=Math.floor(K.y/K.vertexCount);this.centroidVertexArray.emplaceBack(lt,Ct)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,d,C,U,R)}}function _T(g,d){return g.x===d.x&&(g.x<0||g.x>ti)||g.y===d.y&&(g.y<0||g.y>ti)}function Vm(g){return g.every(d=>d.x<0)||g.every(d=>d.x>ti)||g.every(d=>d.y<0)||g.every(d=>d.y>ti)}let My;pn("FillExtrusionBucket",Ov,{omit:["layers","features"]});var yT={get paint(){return My=My||new E({"fill-extrusion-opacity":new vn(We["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Wn(We["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new vn(We["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new vn(We["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Eu(We["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Wn(We["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Wn(We["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new vn(We["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class bT extends y{constructor(d){super(d,yT)}createBucket(d){return new Ov(d)}queryRadius(){return Sl(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(d,b,C,R,U,V,K,ee){const le=Qs(d,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),V.angle,K),_e=this.paint.get("fill-extrusion-height").evaluate(b,C),Be=this.paint.get("fill-extrusion-base").evaluate(b,C),De=function(et,lt,Ct,p){const u=[];for(const A of et){const v=[A.x,A.y,0,1];oA(v,v,lt),u.push(new x(v[0]/v[3],v[1]/v[3]))}return u}(le,ee),Ge=function(et,lt,Ct,p){const u=[],A=[],v=p[8]*lt,M=p[9]*lt,L=p[10]*lt,k=p[11]*lt,Q=p[8]*Ct,q=p[9]*Ct,te=p[10]*Ct,ae=p[11]*Ct;for(const de of et){const ye=[],me=[];for(const Ie of de){const ke=Ie.x,nt=Ie.y,ct=p[0]*ke+p[4]*nt+p[12],Ot=p[1]*ke+p[5]*nt+p[13],wt=p[2]*ke+p[6]*nt+p[14],Re=p[3]*ke+p[7]*nt+p[15],it=wt+L,Et=Re+k,Zt=ct+Q,Br=Ot+q,or=wt+te,lr=Re+ae,Lr=new x((ct+v)/Et,(Ot+M)/Et);Lr.z=it/Et,ye.push(Lr);const Tr=new x(Zt/lr,Br/lr);Tr.z=or/lr,me.push(Tr)}u.push(ye),A.push(me)}return[u,A]}(R,Be,_e,ee);return function(et,lt,Ct){let p=1/0;ta(Ct,lt)&&(p=vT(Ct,lt[0]));for(let u=0;u<lt.length;u++){const A=lt[u],v=et[u];for(let M=0;M<A.length-1;M++){const L=A[M],k=[L,A[M+1],v[M+1],v[M],L];jl(Ct,k)&&(p=Math.min(p,vT(Ct,k)))}}return p!==1/0&&p}(Ge[0],Ge[1],De)}}function Gm(g,d){return g.x*d.x+g.y*d.y}function vT(g,d){if(g.length===1){let b=0;const C=d[b++];let R;for(;!R||C.equals(R);)if(R=d[b++],!R)return 1/0;for(;b<d.length;b++){const U=d[b],V=g[0],K=R.sub(C),ee=U.sub(C),le=V.sub(C),_e=Gm(K,K),Be=Gm(K,ee),De=Gm(ee,ee),Ge=Gm(le,K),et=Gm(le,ee),lt=_e*De-Be*Be,Ct=(De*Ge-Be*et)/lt,p=(_e*et-Be*Ge)/lt,u=C.z*(1-Ct-p)+R.z*Ct+U.z*p;if(isFinite(u))return u}return 1/0}{let b=1/0;for(const C of d)b=Math.min(b,C.z);return b}}const SD=H([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:ID}=SD,MD=H([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:kv}=MD,xT=Cf.VectorTileFeature.types,Uv=Math.cos(Math.PI/180*37.5),Nv=Math.pow(2,14)/.5;class Qm{constructor(d){this.zoom=d.zoom,this.overscaling=d.overscaling,this.layers=d.layers,this.layerIds=this.layers.map(b=>b.id),this.index=d.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(b=>{this.gradients[b.id]={}}),this.layoutVertexArray=new Ki,this.layoutVertexArray2=new vc,this.indexArray=new G,this.programConfigurations=new Oi(d.layers,d.zoom),this.segments=new pe,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(b=>b.isStateDependent()).map(b=>b.id)}populate(d,b,C){this.hasPattern=Rv("line",this.layers,b);const R=this.layers[0].layout.get("line-sort-key"),U=!R.isConstant(),V=[];for(const{feature:K,id:ee,index:le,sourceLayerIndex:_e}of d){const Be=this.layers[0]._featureFilter.needGeometry,De=Bs(K,Be);if(!this.layers[0]._featureFilter.filter(new Fi(this.zoom),De,C))continue;const Ge=U?R.evaluate(De,{},C):void 0,et={id:ee,properties:K.properties,type:K.type,sourceLayerIndex:_e,index:le,geometry:Be?De.geometry:Rs(K),patterns:{},sortKey:Ge};V.push(et)}U&&V.sort((K,ee)=>K.sortKey-ee.sortKey);for(const K of V){const{geometry:ee,index:le,sourceLayerIndex:_e}=K;if(this.hasPattern){const Be=Lv("line",this.layers,K,this.zoom,b);this.patternFeatures.push(Be)}else this.addFeature(K,ee,le,C,{});b.featureIndex.insert(d[le].feature,ee,le,_e,this.index)}}update(d,b,C){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(d,b,this.stateDependentLayers,C)}addFeatures(d,b,C){for(const R of this.patternFeatures)this.addFeature(R,R.geometry,R.index,b,C)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(d){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=d.createVertexBuffer(this.layoutVertexArray2,kv)),this.layoutVertexBuffer=d.createVertexBuffer(this.layoutVertexArray,ID),this.indexBuffer=d.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(d),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(d){if(d.properties&&Object.prototype.hasOwnProperty.call(d.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(d.properties,"mapbox_clip_end"))return{start:+d.properties.mapbox_clip_start,end:+d.properties.mapbox_clip_end}}addFeature(d,b,C,R,U){const V=this.layers[0].layout,K=V.get("line-join").evaluate(d,{}),ee=V.get("line-cap"),le=V.get("line-miter-limit"),_e=V.get("line-round-limit");this.lineClips=this.lineFeatureClips(d);for(const Be of b)this.addLine(Be,d,K,ee,le,_e);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,d,C,U,R)}addLine(d,b,C,R,U,V){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let p=0;p<d.length-1;p++)this.totalDistance+=d[p].dist(d[p+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const K=xT[b.type]==="Polygon";let ee=d.length;for(;ee>=2&&d[ee-1].equals(d[ee-2]);)ee--;let le=0;for(;le<ee-1&&d[le].equals(d[le+1]);)le++;if(ee<(K?3:2))return;C==="bevel"&&(U=1.05);const _e=this.overscaling<=16?15*ti/(512*this.overscaling):0,Be=this.segments.prepareSegment(10*ee,this.layoutVertexArray,this.indexArray);let De,Ge,et,lt,Ct;this.e1=this.e2=-1,K&&(De=d[ee-2],Ct=d[le].sub(De)._unit()._perp());for(let p=le;p<ee;p++){if(et=p===ee-1?K?d[le+1]:void 0:d[p+1],et&&d[p].equals(et))continue;Ct&&(lt=Ct),De&&(Ge=De),De=d[p],Ct=et?et.sub(De)._unit()._perp():lt,lt=lt||Ct;let u=lt.add(Ct);u.x===0&&u.y===0||u._unit();const A=lt.x*Ct.x+lt.y*Ct.y,v=u.x*Ct.x+u.y*Ct.y,M=v!==0?1/v:1/0,L=2*Math.sqrt(2-2*v),k=v<Uv&&Ge&&et,Q=lt.x*Ct.y-lt.y*Ct.x>0;if(k&&p>le){const ae=De.dist(Ge);if(ae>2*_e){const de=De.sub(De.sub(Ge)._mult(_e/ae)._round());this.updateDistance(Ge,de),this.addCurrentVertex(de,lt,0,0,Be),Ge=de}}const q=Ge&&et;let te=q?C:K?"butt":R;if(q&&te==="round"&&(M<V?te="miter":M<=2&&(te="fakeround")),te==="miter"&&M>U&&(te="bevel"),te==="bevel"&&(M>2&&(te="flipbevel"),M<U&&(te="miter")),Ge&&this.updateDistance(Ge,De),te==="miter")u._mult(M),this.addCurrentVertex(De,u,0,0,Be);else if(te==="flipbevel"){if(M>100)u=Ct.mult(-1);else{const ae=M*lt.add(Ct).mag()/lt.sub(Ct).mag();u._perp()._mult(ae*(Q?-1:1))}this.addCurrentVertex(De,u,0,0,Be),this.addCurrentVertex(De,u.mult(-1),0,0,Be)}else if(te==="bevel"||te==="fakeround"){const ae=-Math.sqrt(M*M-1),de=Q?ae:0,ye=Q?0:ae;if(Ge&&this.addCurrentVertex(De,lt,de,ye,Be),te==="fakeround"){const me=Math.round(180*L/Math.PI/20);for(let Ie=1;Ie<me;Ie++){let ke=Ie/me;if(ke!==.5){const ct=ke-.5;ke+=ke*ct*(ke-1)*((1.0904+A*(A*(3.55645-1.43519*A)-3.2452))*ct*ct+(.848013+A*(.215638*A-1.06021)))}const nt=Ct.sub(lt)._mult(ke)._add(lt)._unit()._mult(Q?-1:1);this.addHalfVertex(De,nt.x,nt.y,!1,Q,0,Be)}}et&&this.addCurrentVertex(De,Ct,-de,-ye,Be)}else if(te==="butt")this.addCurrentVertex(De,u,0,0,Be);else if(te==="square"){const ae=Ge?1:-1;this.addCurrentVertex(De,u,ae,ae,Be)}else te==="round"&&(Ge&&(this.addCurrentVertex(De,lt,0,0,Be),this.addCurrentVertex(De,lt,1,1,Be,!0)),et&&(this.addCurrentVertex(De,Ct,-1,-1,Be,!0),this.addCurrentVertex(De,Ct,0,0,Be)));if(k&&p<ee-1){const ae=De.dist(et);if(ae>2*_e){const de=De.add(et.sub(De)._mult(_e/ae)._round());this.updateDistance(De,de),this.addCurrentVertex(de,Ct,0,0,Be),De=de}}}}addCurrentVertex(d,b,C,R,U){let V=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!1;const K=b.y*R-b.x,ee=-b.y-b.x*R;this.addHalfVertex(d,b.x+b.y*C,b.y-b.x*C,V,!1,C,U),this.addHalfVertex(d,K,ee,V,!0,-R,U),this.distance>Nv/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(d,b,C,R,U,V))}addHalfVertex(d,b,C,R,U,V,K){let{x:ee,y:le}=d;const _e=.5*(this.lineClips?this.scaledDistance*(Nv-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((ee<<1)+(R?1:0),(le<<1)+(U?1:0),Math.round(63*b)+128,Math.round(63*C)+128,1+(V===0?0:V<0?-1:1)|(63&_e)<<2,_e>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const Be=K.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,Be),K.primitiveLength++),U?this.e2=Be:this.e1=Be}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(d,b){this.distance+=d.dist(b),this.updateScaledDistance()}}let zv,Hv;pn("LineBucket",Qm,{omit:["layers","patternFeatures"]});var $m={get paint(){return Hv=Hv||new E({"line-opacity":new Wn(We.paint_line["line-opacity"]),"line-color":new Wn(We.paint_line["line-color"]),"line-translate":new vn(We.paint_line["line-translate"]),"line-translate-anchor":new vn(We.paint_line["line-translate-anchor"]),"line-width":new Wn(We.paint_line["line-width"]),"line-gap-width":new Wn(We.paint_line["line-gap-width"]),"line-offset":new Wn(We.paint_line["line-offset"]),"line-blur":new Wn(We.paint_line["line-blur"]),"line-dasharray":new z(We.paint_line["line-dasharray"]),"line-pattern":new Eu(We.paint_line["line-pattern"]),"line-gradient":new X(We.paint_line["line-gradient"])})},get layout(){return zv=zv||new E({"line-cap":new vn(We.layout_line["line-cap"]),"line-join":new Wn(We.layout_line["line-join"]),"line-miter-limit":new vn(We.layout_line["line-miter-limit"]),"line-round-limit":new vn(We.layout_line["line-round-limit"]),"line-sort-key":new Wn(We.layout_line["line-sort-key"])})}};class wT extends Wn{possiblyEvaluate(d,b){return b=new Fi(Math.floor(b.zoom),{now:b.now,fadeDuration:b.fadeDuration,zoomHistory:b.zoomHistory,transition:b.transition}),super.possiblyEvaluate(d,b)}evaluate(d,b,C,R){return b=Qe({},b,{zoom:Math.floor(b.zoom)}),super.evaluate(d,b,C,R)}}let jm;class BT extends y{constructor(d){super(d,$m),this.gradientVersion=0,jm||(jm=new wT($m.paint.properties["line-width"].specification),jm.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(d){if(d==="line-gradient"){const b=this.gradientExpression();this.stepInterpolant=!!function(C){return C._styleExpression!==void 0}(b)&&b._styleExpression.expression instanceof Us,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(d,b){super.recalculate(d,b),this.paint._values["line-floorwidth"]=jm.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,d)}createBucket(d){return new Qm(d)}queryRadius(d){const b=d,C=eg(Cs("line-width",this,b),Cs("line-gap-width",this,b)),R=Cs("line-offset",this,b);return C/2+Math.abs(R)+Sl(this.paint.get("line-translate"))}queryIntersectsFeature(d,b,C,R,U,V,K){const ee=Qs(d,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),V.angle,K),le=K/2*eg(this.paint.get("line-width").evaluate(b,C),this.paint.get("line-gap-width").evaluate(b,C)),_e=this.paint.get("line-offset").evaluate(b,C);return _e&&(R=function(Be,De){const Ge=[];for(let et=0;et<Be.length;et++){const lt=Be[et],Ct=[];for(let p=0;p<lt.length;p++){const u=lt[p-1],A=lt[p],v=lt[p+1],M=p===0?new x(0,0):A.sub(u)._unit()._perp(),L=p===lt.length-1?new x(0,0):v.sub(A)._unit()._perp(),k=M._add(L)._unit(),Q=k.x*L.x+k.y*L.y;Q!==0&&k._mult(1/Q),Ct.push(k._mult(De)._add(A))}Ge.push(Ct)}return Ge}(R,_e*K)),function(Be,De,Ge){for(let et=0;et<De.length;et++){const lt=De[et];if(Be.length>=3){for(let Ct=0;Ct<lt.length;Ct++)if(Io(Be,lt[Ct]))return!0}if(xc(Be,lt,Ge))return!0}return!1}(ee,R,le)}isTileClipped(){return!0}}function eg(g,d){return d>0?d+2*g:g}const PD=H([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Vv=H([{name:"a_projected_pos",components:3,type:"Float32"}],4);H([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const qm=H([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);H([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Py=H([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),FD=H([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function RD(g,d,b){return g.sections.forEach(C=>{C.text=function(R,U,V){const K=U.layout.get("text-transform").evaluate(V,{});return K==="uppercase"?R=R.toLocaleUpperCase():K==="lowercase"&&(R=R.toLocaleLowerCase()),_o.applyArabicShaping&&(R=_o.applyArabicShaping(R)),R}(C.text,d,b)}),g}H([{name:"triangle",components:3,type:"Uint16"}]),H([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),H([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),H([{type:"Float32",name:"offsetX"}]),H([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),H([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const tg={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var na=24,CT=gs,ET=function(g,d,b,C,R){var U,V,K=8*R-C-1,ee=(1<<K)-1,le=ee>>1,_e=-7,Be=R-1,De=-1,Ge=g[d+Be];for(Be+=De,U=Ge&(1<<-_e)-1,Ge>>=-_e,_e+=K;_e>0;U=256*U+g[d+Be],Be+=De,_e-=8);for(V=U&(1<<-_e)-1,U>>=-_e,_e+=C;_e>0;V=256*V+g[d+Be],Be+=De,_e-=8);if(U===0)U=1-le;else{if(U===ee)return V?NaN:1/0*(Ge?-1:1);V+=Math.pow(2,C),U-=le}return(Ge?-1:1)*V*Math.pow(2,U-C)},rg=function(g,d,b,C,R,U){var V,K,ee,le=8*U-R-1,_e=(1<<le)-1,Be=_e>>1,De=R===23?Math.pow(2,-24)-Math.pow(2,-77):0,Ge=0,et=1,lt=d<0||d===0&&1/d<0?1:0;for(d=Math.abs(d),isNaN(d)||d===1/0?(K=isNaN(d)?1:0,V=_e):(V=Math.floor(Math.log(d)/Math.LN2),d*(ee=Math.pow(2,-V))<1&&(V--,ee*=2),(d+=V+Be>=1?De/ee:De*Math.pow(2,1-Be))*ee>=2&&(V++,ee/=2),V+Be>=_e?(K=0,V=_e):V+Be>=1?(K=(d*ee-1)*Math.pow(2,R),V+=Be):(K=d*Math.pow(2,Be-1)*Math.pow(2,R),V=0));R>=8;g[b+Ge]=255&K,Ge+=et,K/=256,R-=8);for(V=V<<R|K,le+=R;le>0;g[b+Ge]=255&V,Ge+=et,V/=256,le-=8);g[b+Ge-et]|=128*lt};function gs(g){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(g)?g:new Uint8Array(g||0),this.pos=0,this.type=0,this.length=this.buf.length}gs.Varint=0,gs.Fixed64=1,gs.Bytes=2,gs.Fixed32=5;var Gv=4294967296,TT=1/Gv,ST=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function Ef(g){return g.type===gs.Bytes?g.readVarint()+g.pos:g.pos+1}function ng(g,d,b){return b?4294967296*d+(g>>>0):4294967296*(d>>>0)+(g>>>0)}function IT(g,d,b){var C=d<=16383?1:d<=2097151?2:d<=268435455?3:Math.floor(Math.log(d)/(7*Math.LN2));b.realloc(C);for(var R=b.pos-1;R>=g;R--)b.buf[R+C]=b.buf[R]}function MT(g,d){for(var b=0;b<g.length;b++)d.writeVarint(g[b])}function Qv(g,d){for(var b=0;b<g.length;b++)d.writeSVarint(g[b])}function PT(g,d){for(var b=0;b<g.length;b++)d.writeFloat(g[b])}function FT(g,d){for(var b=0;b<g.length;b++)d.writeDouble(g[b])}function RT(g,d){for(var b=0;b<g.length;b++)d.writeBoolean(g[b])}function LD(g,d){for(var b=0;b<g.length;b++)d.writeFixed32(g[b])}function Fy(g,d){for(var b=0;b<g.length;b++)d.writeSFixed32(g[b])}function DD(g,d){for(var b=0;b<g.length;b++)d.writeFixed64(g[b])}function LT(g,d){for(var b=0;b<g.length;b++)d.writeSFixed64(g[b])}function Ry(g,d){return(g[d]|g[d+1]<<8|g[d+2]<<16)+16777216*g[d+3]}function ig(g,d,b){g[b]=d,g[b+1]=d>>>8,g[b+2]=d>>>16,g[b+3]=d>>>24}function DT(g,d){return(g[d]|g[d+1]<<8|g[d+2]<<16)+(g[d+3]<<24)}gs.prototype={destroy:function(){this.buf=null},readFields:function(g,d,b){for(b=b||this.length;this.pos<b;){var C=this.readVarint(),R=C>>3,U=this.pos;this.type=7&C,g(R,d,this),this.pos===U&&this.skip(C)}return d},readMessage:function(g,d){return this.readFields(g,d,this.readVarint()+this.pos)},readFixed32:function(){var g=Ry(this.buf,this.pos);return this.pos+=4,g},readSFixed32:function(){var g=DT(this.buf,this.pos);return this.pos+=4,g},readFixed64:function(){var g=Ry(this.buf,this.pos)+Ry(this.buf,this.pos+4)*Gv;return this.pos+=8,g},readSFixed64:function(){var g=Ry(this.buf,this.pos)+DT(this.buf,this.pos+4)*Gv;return this.pos+=8,g},readFloat:function(){var g=ET(this.buf,this.pos,!0,23,4);return this.pos+=4,g},readDouble:function(){var g=ET(this.buf,this.pos,!0,52,8);return this.pos+=8,g},readVarint:function(g){var d,b,C=this.buf;return d=127&(b=C[this.pos++]),b<128?d:(d|=(127&(b=C[this.pos++]))<<7,b<128?d:(d|=(127&(b=C[this.pos++]))<<14,b<128?d:(d|=(127&(b=C[this.pos++]))<<21,b<128?d:function(R,U,V){var K,ee,le=V.buf;if(K=(112&(ee=le[V.pos++]))>>4,ee<128||(K|=(127&(ee=le[V.pos++]))<<3,ee<128)||(K|=(127&(ee=le[V.pos++]))<<10,ee<128)||(K|=(127&(ee=le[V.pos++]))<<17,ee<128)||(K|=(127&(ee=le[V.pos++]))<<24,ee<128)||(K|=(1&(ee=le[V.pos++]))<<31,ee<128))return ng(R,K,U);throw new Error("Expected varint not more than 10 bytes")}(d|=(15&(b=C[this.pos]))<<28,g,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var g=this.readVarint();return g%2==1?(g+1)/-2:g/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var g=this.readVarint()+this.pos,d=this.pos;return this.pos=g,g-d>=12&&ST?function(b,C,R){return ST.decode(b.subarray(C,R))}(this.buf,d,g):function(b,C,R){for(var U="",V=C;V<R;){var K,ee,le,_e=b[V],Be=null,De=_e>239?4:_e>223?3:_e>191?2:1;if(V+De>R)break;De===1?_e<128&&(Be=_e):De===2?(192&(K=b[V+1]))==128&&(Be=(31&_e)<<6|63&K)<=127&&(Be=null):De===3?(ee=b[V+2],(192&(K=b[V+1]))==128&&(192&ee)==128&&((Be=(15&_e)<<12|(63&K)<<6|63&ee)<=2047||Be>=55296&&Be<=57343)&&(Be=null)):De===4&&(ee=b[V+2],le=b[V+3],(192&(K=b[V+1]))==128&&(192&ee)==128&&(192&le)==128&&((Be=(15&_e)<<18|(63&K)<<12|(63&ee)<<6|63&le)<=65535||Be>=1114112)&&(Be=null)),Be===null?(Be=65533,De=1):Be>65535&&(Be-=65536,U+=String.fromCharCode(Be>>>10&1023|55296),Be=56320|1023&Be),U+=String.fromCharCode(Be),V+=De}return U}(this.buf,d,g)},readBytes:function(){var g=this.readVarint()+this.pos,d=this.buf.subarray(this.pos,g);return this.pos=g,d},readPackedVarint:function(g,d){if(this.type!==gs.Bytes)return g.push(this.readVarint(d));var b=Ef(this);for(g=g||[];this.pos<b;)g.push(this.readVarint(d));return g},readPackedSVarint:function(g){if(this.type!==gs.Bytes)return g.push(this.readSVarint());var d=Ef(this);for(g=g||[];this.pos<d;)g.push(this.readSVarint());return g},readPackedBoolean:function(g){if(this.type!==gs.Bytes)return g.push(this.readBoolean());var d=Ef(this);for(g=g||[];this.pos<d;)g.push(this.readBoolean());return g},readPackedFloat:function(g){if(this.type!==gs.Bytes)return g.push(this.readFloat());var d=Ef(this);for(g=g||[];this.pos<d;)g.push(this.readFloat());return g},readPackedDouble:function(g){if(this.type!==gs.Bytes)return g.push(this.readDouble());var d=Ef(this);for(g=g||[];this.pos<d;)g.push(this.readDouble());return g},readPackedFixed32:function(g){if(this.type!==gs.Bytes)return g.push(this.readFixed32());var d=Ef(this);for(g=g||[];this.pos<d;)g.push(this.readFixed32());return g},readPackedSFixed32:function(g){if(this.type!==gs.Bytes)return g.push(this.readSFixed32());var d=Ef(this);for(g=g||[];this.pos<d;)g.push(this.readSFixed32());return g},readPackedFixed64:function(g){if(this.type!==gs.Bytes)return g.push(this.readFixed64());var d=Ef(this);for(g=g||[];this.pos<d;)g.push(this.readFixed64());return g},readPackedSFixed64:function(g){if(this.type!==gs.Bytes)return g.push(this.readSFixed64());var d=Ef(this);for(g=g||[];this.pos<d;)g.push(this.readSFixed64());return g},skip:function(g){var d=7&g;if(d===gs.Varint)for(;this.buf[this.pos++]>127;);else if(d===gs.Bytes)this.pos=this.readVarint()+this.pos;else if(d===gs.Fixed32)this.pos+=4;else{if(d!==gs.Fixed64)throw new Error("Unimplemented type: "+d);this.pos+=8}},writeTag:function(g,d){this.writeVarint(g<<3|d)},realloc:function(g){for(var d=this.length||16;d<this.pos+g;)d*=2;if(d!==this.length){var b=new Uint8Array(d);b.set(this.buf),this.buf=b,this.length=d}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(g){this.realloc(4),ig(this.buf,g,this.pos),this.pos+=4},writeSFixed32:function(g){this.realloc(4),ig(this.buf,g,this.pos),this.pos+=4},writeFixed64:function(g){this.realloc(8),ig(this.buf,-1&g,this.pos),ig(this.buf,Math.floor(g*TT),this.pos+4),this.pos+=8},writeSFixed64:function(g){this.realloc(8),ig(this.buf,-1&g,this.pos),ig(this.buf,Math.floor(g*TT),this.pos+4),this.pos+=8},writeVarint:function(g){(g=+g||0)>268435455||g<0?function(d,b){var C,R;if(d>=0?(C=d%4294967296|0,R=d/4294967296|0):(R=~(-d/4294967296),4294967295^(C=~(-d%4294967296))?C=C+1|0:(C=0,R=R+1|0)),d>=18446744073709552e3||d<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");b.realloc(10),function(U,V,K){K.buf[K.pos++]=127&U|128,U>>>=7,K.buf[K.pos++]=127&U|128,U>>>=7,K.buf[K.pos++]=127&U|128,U>>>=7,K.buf[K.pos++]=127&U|128,K.buf[K.pos]=127&(U>>>=7)}(C,0,b),function(U,V){var K=(7&U)<<4;V.buf[V.pos++]|=K|((U>>>=3)?128:0),U&&(V.buf[V.pos++]=127&U|((U>>>=7)?128:0),U&&(V.buf[V.pos++]=127&U|((U>>>=7)?128:0),U&&(V.buf[V.pos++]=127&U|((U>>>=7)?128:0),U&&(V.buf[V.pos++]=127&U|((U>>>=7)?128:0),U&&(V.buf[V.pos++]=127&U)))))}(R,b)}(g,this):(this.realloc(4),this.buf[this.pos++]=127&g|(g>127?128:0),g<=127||(this.buf[this.pos++]=127&(g>>>=7)|(g>127?128:0),g<=127||(this.buf[this.pos++]=127&(g>>>=7)|(g>127?128:0),g<=127||(this.buf[this.pos++]=g>>>7&127))))},writeSVarint:function(g){this.writeVarint(g<0?2*-g-1:2*g)},writeBoolean:function(g){this.writeVarint(!!g)},writeString:function(g){g=String(g),this.realloc(4*g.length),this.pos++;var d=this.pos;this.pos=function(C,R,U){for(var V,K,ee=0;ee<R.length;ee++){if((V=R.charCodeAt(ee))>55295&&V<57344){if(!K){V>56319||ee+1===R.length?(C[U++]=239,C[U++]=191,C[U++]=189):K=V;continue}if(V<56320){C[U++]=239,C[U++]=191,C[U++]=189,K=V;continue}V=K-55296<<10|V-56320|65536,K=null}else K&&(C[U++]=239,C[U++]=191,C[U++]=189,K=null);V<128?C[U++]=V:(V<2048?C[U++]=V>>6|192:(V<65536?C[U++]=V>>12|224:(C[U++]=V>>18|240,C[U++]=V>>12&63|128),C[U++]=V>>6&63|128),C[U++]=63&V|128)}return U}(this.buf,g,this.pos);var b=this.pos-d;b>=128&&IT(d,b,this),this.pos=d-1,this.writeVarint(b),this.pos+=b},writeFloat:function(g){this.realloc(4),rg(this.buf,g,this.pos,!0,23,4),this.pos+=4},writeDouble:function(g){this.realloc(8),rg(this.buf,g,this.pos,!0,52,8),this.pos+=8},writeBytes:function(g){var d=g.length;this.writeVarint(d),this.realloc(d);for(var b=0;b<d;b++)this.buf[this.pos++]=g[b]},writeRawMessage:function(g,d){this.pos++;var b=this.pos;g(d,this);var C=this.pos-b;C>=128&&IT(b,C,this),this.pos=b-1,this.writeVarint(C),this.pos+=C},writeMessage:function(g,d,b){this.writeTag(g,gs.Bytes),this.writeRawMessage(d,b)},writePackedVarint:function(g,d){d.length&&this.writeMessage(g,MT,d)},writePackedSVarint:function(g,d){d.length&&this.writeMessage(g,Qv,d)},writePackedBoolean:function(g,d){d.length&&this.writeMessage(g,RT,d)},writePackedFloat:function(g,d){d.length&&this.writeMessage(g,PT,d)},writePackedDouble:function(g,d){d.length&&this.writeMessage(g,FT,d)},writePackedFixed32:function(g,d){d.length&&this.writeMessage(g,LD,d)},writePackedSFixed32:function(g,d){d.length&&this.writeMessage(g,Fy,d)},writePackedFixed64:function(g,d){d.length&&this.writeMessage(g,DD,d)},writePackedSFixed64:function(g,d){d.length&&this.writeMessage(g,LT,d)},writeBytesField:function(g,d){this.writeTag(g,gs.Bytes),this.writeBytes(d)},writeFixed32Field:function(g,d){this.writeTag(g,gs.Fixed32),this.writeFixed32(d)},writeSFixed32Field:function(g,d){this.writeTag(g,gs.Fixed32),this.writeSFixed32(d)},writeFixed64Field:function(g,d){this.writeTag(g,gs.Fixed64),this.writeFixed64(d)},writeSFixed64Field:function(g,d){this.writeTag(g,gs.Fixed64),this.writeSFixed64(d)},writeVarintField:function(g,d){this.writeTag(g,gs.Varint),this.writeVarint(d)},writeSVarintField:function(g,d){this.writeTag(g,gs.Varint),this.writeSVarint(d)},writeStringField:function(g,d){this.writeTag(g,gs.Bytes),this.writeString(d)},writeFloatField:function(g,d){this.writeTag(g,gs.Fixed32),this.writeFloat(d)},writeDoubleField:function(g,d){this.writeTag(g,gs.Fixed64),this.writeDouble(d)},writeBooleanField:function(g,d){this.writeVarintField(g,!!d)}};var Ly=h(CT);const $v=3;function OD(g,d,b){g===1&&b.readMessage(Km,d)}function Km(g,d,b){if(g===3){const{id:C,bitmap:R,width:U,height:V,left:K,top:ee,advance:le}=b.readMessage(OT,{});d.push({id:C,bitmap:new Ed({width:U+2*$v,height:V+2*$v},R),metrics:{width:U,height:V,left:K,top:ee,advance:le}})}}function OT(g,d,b){g===1?d.id=b.readVarint():g===2?d.bitmap=b.readBytes():g===3?d.width=b.readVarint():g===4?d.height=b.readVarint():g===5?d.left=b.readSVarint():g===6?d.top=b.readSVarint():g===7&&(d.advance=b.readVarint())}const Dy=$v;function jv(g){let d=0,b=0;for(const V of g)d+=V.w*V.h,b=Math.max(b,V.w);g.sort((V,K)=>K.h-V.h);const C=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(d/.95)),b),h:1/0}];let R=0,U=0;for(const V of g)for(let K=C.length-1;K>=0;K--){const ee=C[K];if(!(V.w>ee.w||V.h>ee.h)){if(V.x=ee.x,V.y=ee.y,U=Math.max(U,V.y+V.h),R=Math.max(R,V.x+V.w),V.w===ee.w&&V.h===ee.h){const le=C.pop();K<C.length&&(C[K]=le)}else V.h===ee.h?(ee.x+=V.w,ee.w-=V.w):V.w===ee.w?(ee.y+=V.h,ee.h-=V.h):(C.push({x:ee.x+V.w,y:ee.y,w:ee.w-V.w,h:V.h}),ee.y+=V.h,ee.h-=V.h);break}}return{w:R,h:U,fill:d/(R*U)||0}}const Zi=1;class Wm{constructor(d,b){let{pixelRatio:C,version:R,stretchX:U,stretchY:V,content:K,textFitWidth:ee,textFitHeight:le}=b;this.paddedRect=d,this.pixelRatio=C,this.stretchX=U,this.stretchY=V,this.content=K,this.version=R,this.textFitWidth=ee,this.textFitHeight=le}get tl(){return[this.paddedRect.x+Zi,this.paddedRect.y+Zi]}get br(){return[this.paddedRect.x+this.paddedRect.w-Zi,this.paddedRect.y+this.paddedRect.h-Zi]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Zi)/this.pixelRatio,(this.paddedRect.h-2*Zi)/this.pixelRatio]}}class kT{constructor(d,b){const C={},R={};this.haveRenderCallbacks=[];const U=[];this.addImages(d,C,U),this.addImages(b,R,U);const{w:V,h:K}=jv(U),ee=new $u({width:V||1,height:K||1});for(const le in d){const _e=d[le],Be=C[le].paddedRect;$u.copy(_e.data,ee,{x:0,y:0},{x:Be.x+Zi,y:Be.y+Zi},_e.data)}for(const le in b){const _e=b[le],Be=R[le].paddedRect,De=Be.x+Zi,Ge=Be.y+Zi,et=_e.data.width,lt=_e.data.height;$u.copy(_e.data,ee,{x:0,y:0},{x:De,y:Ge},_e.data),$u.copy(_e.data,ee,{x:0,y:lt-1},{x:De,y:Ge-1},{width:et,height:1}),$u.copy(_e.data,ee,{x:0,y:0},{x:De,y:Ge+lt},{width:et,height:1}),$u.copy(_e.data,ee,{x:et-1,y:0},{x:De-1,y:Ge},{width:1,height:lt}),$u.copy(_e.data,ee,{x:0,y:0},{x:De+et,y:Ge},{width:1,height:lt})}this.image=ee,this.iconPositions=C,this.patternPositions=R}addImages(d,b,C){for(const R in d){const U=d[R],V={x:0,y:0,w:U.data.width+2*Zi,h:U.data.height+2*Zi};C.push(V),b[R]=new Wm(V,U),U.hasRenderCallback&&this.haveRenderCallbacks.push(R)}}patchUpdatedImages(d,b){d.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const C in d.updatedImages)this.patchUpdatedImage(this.iconPositions[C],d.getImage(C),b),this.patchUpdatedImage(this.patternPositions[C],d.getImage(C),b)}patchUpdatedImage(d,b,C){if(!d||!b||d.version===b.version)return;d.version=b.version;const[R,U]=d.tl;C.update(b.data,void 0,{x:R,y:U})}}var Tf;pn("ImagePosition",Wm),pn("ImageAtlas",kT),a.ah=void 0,(Tf=a.ah||(a.ah={}))[Tf.none=0]="none",Tf[Tf.horizontal=1]="horizontal",Tf[Tf.vertical=2]="vertical",Tf[Tf.horizontalOnly=3]="horizontalOnly";const zA=-17;class HA{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(d,b){const C=new HA;return C.scale=d||1,C.fontStack=b,C}static forImage(d){const b=new HA;return b.imageName=d,b}}class sg{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(d,b){const C=new sg;for(let R=0;R<d.sections.length;R++){const U=d.sections[R];U.image?C.addImageSection(U):C.addTextSection(U,b)}return C}length(){return this.text.length}getSection(d){return this.sections[this.sectionIndex[d]]}getSectionIndex(d){return this.sectionIndex[d]}getCharCode(d){return this.text.charCodeAt(d)}verticalizePunctuation(){this.text=function(d){let b="";for(let C=0;C<d.length;C++){const R=d.charCodeAt(C+1)||null,U=d.charCodeAt(C-1)||null;b+=R&&Gh(R)&&!tg[d[C+1]]||U&&Gh(U)&&!tg[d[C-1]]||!tg[d[C]]?d[C]:tg[d[C]]}return b}(this.text)}trim(){let d=0;for(let C=0;C<this.text.length&&ky[this.text.charCodeAt(C)];C++)d++;let b=this.text.length;for(let C=this.text.length-1;C>=0&&C>=d&&ky[this.text.charCodeAt(C)];C--)b--;this.text=this.text.substring(d,b),this.sectionIndex=this.sectionIndex.slice(d,b)}substring(d,b){const C=new sg;return C.text=this.text.substring(d,b),C.sectionIndex=this.sectionIndex.slice(d,b),C.sections=this.sections,C}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((d,b)=>Math.max(d,this.sections[b].scale),0)}addTextSection(d,b){this.text+=d.text,this.sections.push(HA.forText(d.scale,d.fontStack||b));const C=this.sections.length-1;for(let R=0;R<d.text.length;++R)this.sectionIndex.push(C)}addImageSection(d){const b=d.image?d.image.name:"";if(b.length===0)return void tt("Can't add FormattedSection with an empty image.");const C=this.getNextImageSectionCharCode();C?(this.text+=String.fromCharCode(C),this.sections.push(HA.forImage(b)),this.sectionIndex.push(this.sections.length-1)):tt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Oy(g,d,b,C,R,U,V,K,ee,le,_e,Be,De,Ge,et){const lt=sg.fromFeature(g,R);let Ct;Be===a.ah.vertical&&lt.verticalizePunctuation();const{processBidirectionalText:p,processStyledBidirectionalText:u}=_o;if(p&&lt.sections.length===1){Ct=[];const M=p(lt.toString(),VA(lt,le,U,d,C,Ge));for(const L of M){const k=new sg;k.text=L,k.sections=lt.sections;for(let Q=0;Q<L.length;Q++)k.sectionIndex.push(0);Ct.push(k)}}else if(u){Ct=[];const M=u(lt.text,lt.sectionIndex,VA(lt,le,U,d,C,Ge));for(const L of M){const k=new sg;k.text=L[0],k.sectionIndex=L[1],k.sections=lt.sections,Ct.push(k)}}else Ct=function(M,L){const k=[],Q=M.text;let q=0;for(const te of L)k.push(M.substring(q,te)),q=te;return q<Q.length&&k.push(M.substring(q,Q.length)),k}(lt,VA(lt,le,U,d,C,Ge));const A=[],v={positionedLines:A,text:lt.toString(),top:_e[1],bottom:_e[1],left:_e[0],right:_e[0],writingMode:Be,iconsInText:!1,verticalizable:!1};return function(M,L,k,Q,q,te,ae,de,ye,me,Ie,ke){let nt=0,ct=zA,Ot=0,wt=0;const Re=de==="right"?1:de==="left"?0:.5;let it=0;for(const lr of q){lr.trim();const Lr=lr.getMaxScale(),Tr=(Lr-1)*na,Hr={positionedGlyphs:[],lineOffset:0};M.positionedLines[it]=Hr;const Ar=Hr.positionedGlyphs;let hn=0;if(!lr.length()){ct+=te,++it;continue}for(let wn=0;wn<lr.length();wn++){const Kr=lr.getSection(wn),Nn=lr.getSectionIndex(wn),hi=lr.getCharCode(wn);let Yi=0,ki=null,Fa=null,Mo=null,Ws=na;const es=!(ye===a.ah.horizontal||!Ie&&!wu(hi)||Ie&&(ky[hi]||(Et=hi,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(Et)))));if(Kr.imageName){const hs=Q[Kr.imageName];if(!hs)continue;Mo=Kr.imageName,M.iconsInText=M.iconsInText||!0,Fa=hs.paddedRect;const Ni=hs.displaySize;Kr.scale=Kr.scale*na/ke,ki={width:Ni[0],height:Ni[1],left:Zi,top:-Dy,advance:es?Ni[1]:Ni[0]},Yi=Tr+(na-Ni[1]*Kr.scale),Ws=ki.advance;const Ls=es?Ni[0]*Kr.scale-na*Lr:Ni[1]*Kr.scale-na*Lr;Ls>0&&Ls>hn&&(hn=Ls)}else{const hs=k[Kr.fontStack],Ni=hs&&hs[hi];if(Ni&&Ni.rect)Fa=Ni.rect,ki=Ni.metrics;else{const Ls=L[Kr.fontStack],Ra=Ls&&Ls[hi];if(!Ra)continue;ki=Ra.metrics}Yi=(Lr-Kr.scale)*na}es?(M.verticalizable=!0,Ar.push({glyph:hi,imageName:Mo,x:nt,y:ct+Yi,vertical:es,scale:Kr.scale,fontStack:Kr.fontStack,sectionIndex:Nn,metrics:ki,rect:Fa}),nt+=Ws*Kr.scale+me):(Ar.push({glyph:hi,imageName:Mo,x:nt,y:ct+Yi,vertical:es,scale:Kr.scale,fontStack:Kr.fontStack,sectionIndex:Nn,metrics:ki,rect:Fa}),nt+=ki.advance*Kr.scale+me)}Ar.length!==0&&(Ot=Math.max(nt-me,Ot),Ny(Ar,0,Ar.length-1,Re,hn)),nt=0;const Mn=te*Lr+hn;Hr.lineOffset=Math.max(hn,Tr),ct+=Mn,wt=Math.max(Mn,wt),++it}var Et;const Zt=ct-zA,{horizontalAlign:Br,verticalAlign:or}=aA(ae);(function(lr,Lr,Tr,Hr,Ar,hn,Mn,wn,Kr){const Nn=(Lr-Tr)*Ar;let hi=0;hi=hn!==Mn?-wn*Hr-zA:(-Hr*Kr+.5)*Mn;for(const Yi of lr)for(const ki of Yi.positionedGlyphs)ki.x+=Nn,ki.y+=hi})(M.positionedLines,Re,Br,or,Ot,wt,te,Zt,q.length),M.top+=-or*Zt,M.bottom=M.top+Zt,M.left+=-Br*Ot,M.right=M.left+Ot}(v,d,b,C,Ct,V,K,ee,Be,le,De,et),!function(M){for(const L of M)if(L.positionedGlyphs.length!==0)return!1;return!0}(A)&&v}const ky={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},kD={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},UT={40:!0};function wc(g,d,b,C,R,U){if(d.imageName){const V=C[d.imageName];return V?V.displaySize[0]*d.scale*na/U+R:0}{const V=b[d.fontStack],K=V&&V[g];return K?K.metrics.advance*d.scale+R:0}}function Uy(g,d,b,C){const R=Math.pow(g-d,2);return C?g<d?R/2:2*R:R+Math.abs(b)*b}function NT(g,d,b){let C=0;return g===10&&(C-=1e4),b&&(C+=150),g!==40&&g!==65288||(C+=50),d!==41&&d!==65289||(C+=50),C}function Sf(g,d,b,C,R,U){let V=null,K=Uy(d,b,R,U);for(const ee of C){const le=Uy(d-ee.x,b,R,U)+ee.badness;le<=K&&(V=ee,K=le)}return{index:g,x:d,priorBreak:V,badness:K}}function Xm(g){return g?Xm(g.priorBreak).concat(g.index):[]}function VA(g,d,b,C,R,U){if(!g)return[];const V=[],K=function(Be,De,Ge,et,lt,Ct){let p=0;for(let u=0;u<Be.length();u++){const A=Be.getSection(u);p+=wc(Be.getCharCode(u),A,et,lt,De,Ct)}return p/Math.max(1,Math.ceil(p/Ge))}(g,d,b,C,R,U),ee=g.text.indexOf("")>=0;let le=0;for(let Be=0;Be<g.length();Be++){const De=g.getSection(Be),Ge=g.getCharCode(Be);if(ky[Ge]||(le+=wc(Ge,De,C,R,d,U)),Be<g.length()-1){const et=!((_e=Ge)<11904)&&(!!ni["CJK Compatibility Forms"](_e)||!!ni["CJK Compatibility"](_e)||!!ni["CJK Strokes"](_e)||!!ni["CJK Symbols and Punctuation"](_e)||!!ni["Enclosed CJK Letters and Months"](_e)||!!ni["Halfwidth and Fullwidth Forms"](_e)||!!ni["Ideographic Description Characters"](_e)||!!ni["Vertical Forms"](_e)||el.test(String.fromCodePoint(_e)));(kD[Ge]||et||De.imageName||Be!==g.length()-2&&UT[g.getCharCode(Be+1)])&&V.push(Sf(Be+1,le,K,V,NT(Ge,g.getCharCode(Be+1),et&&ee),!1))}}var _e;return Xm(Sf(g.length(),le,K,V,0,!0))}function aA(g){let d=.5,b=.5;switch(g){case"right":case"top-right":case"bottom-right":d=1;break;case"left":case"top-left":case"bottom-left":d=0}switch(g){case"bottom":case"bottom-right":case"bottom-left":b=1;break;case"top":case"top-right":case"top-left":b=0}return{horizontalAlign:d,verticalAlign:b}}function Ny(g,d,b,C,R){if(!C&&!R)return;const U=g[b],V=(g[b].x+U.metrics.advance*U.scale)*C;for(let K=d;K<=b;K++)g[K].x-=V,g[K].y+=R}function zy(g,d,b){const{horizontalAlign:C,verticalAlign:R}=aA(b),U=d[0]-g.displaySize[0]*C,V=d[1]-g.displaySize[1]*R;return{image:g,top:V,bottom:V+g.displaySize[1],left:U,right:U+g.displaySize[0]}}function zT(g){var d,b;let C=g.left,R=g.top,U=g.right-C,V=g.bottom-R;const K=(d=g.image.textFitWidth)!==null&&d!==void 0?d:"stretchOrShrink",ee=(b=g.image.textFitHeight)!==null&&b!==void 0?b:"stretchOrShrink",le=(g.image.content[2]-g.image.content[0])/(g.image.content[3]-g.image.content[1]);if(ee==="proportional"){if(K==="stretchOnly"&&U/V<le||K==="proportional"){const _e=Math.ceil(V*le);C*=_e/U,U=_e}}else if(K==="proportional"&&ee==="stretchOnly"&&le!==0&&U/V>le){const _e=Math.ceil(U/le);R*=_e/V,V=_e}return{x1:C,y1:R,x2:C+U,y2:R+V}}function HT(g,d,b,C,R,U){const V=g.image;let K;if(V.content){const Ct=V.content,p=V.pixelRatio||1;K=[Ct[0]/p,Ct[1]/p,V.displaySize[0]-Ct[2]/p,V.displaySize[1]-Ct[3]/p]}const ee=d.left*U,le=d.right*U;let _e,Be,De,Ge;b==="width"||b==="both"?(Ge=R[0]+ee-C[3],Be=R[0]+le+C[1]):(Ge=R[0]+(ee+le-V.displaySize[0])/2,Be=Ge+V.displaySize[0]);const et=d.top*U,lt=d.bottom*U;return b==="height"||b==="both"?(_e=R[1]+et-C[0],De=R[1]+lt+C[2]):(_e=R[1]+(et+lt-V.displaySize[1])/2,De=_e+V.displaySize[1]),{image:V,top:_e,right:Be,bottom:De,left:Ge,collisionPadding:K}}const og=255,Wh=128,lA=og*Wh;function qv(g,d){const{expression:b}=d;if(b.kind==="constant")return{kind:"constant",layoutSize:b.evaluate(new Fi(g+1))};if(b.kind==="source")return{kind:"source"};{const{zoomStops:C,interpolationType:R}=b;let U=0;for(;U<C.length&&C[U]<=g;)U++;U=Math.max(0,U-1);let V=U;for(;V<C.length&&C[V]<g+1;)V++;V=Math.min(C.length-1,V);const K=C[U],ee=C[V];return b.kind==="composite"?{kind:"composite",minZoom:K,maxZoom:ee,interpolationType:R}:{kind:"camera",minZoom:K,maxZoom:ee,minSize:b.evaluate(new Fi(K)),maxSize:b.evaluate(new Fi(ee)),interpolationType:R}}}function Hy(g,d,b){let C="never";const R=g.get(d);return R?C=R:g.get(b)&&(C="always"),C}const Kv=Cf.VectorTileFeature.types,Wv=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Vy(g,d,b,C,R,U,V,K,ee,le,_e,Be,De){const Ge=K?Math.min(lA,Math.round(K[0])):0,et=K?Math.min(lA,Math.round(K[1])):0;g.emplaceBack(d,b,Math.round(32*C),Math.round(32*R),U,V,(Ge<<1)+(ee?1:0),et,16*le,16*_e,256*Be,256*De)}function Gy(g,d,b){g.emplaceBack(d.x,d.y,b),g.emplaceBack(d.x,d.y,b),g.emplaceBack(d.x,d.y,b),g.emplaceBack(d.x,d.y,b)}function UD(g){for(const d of g.sections)if(xf(d.text))return!0;return!1}class Xv{constructor(d){this.layoutVertexArray=new l,this.indexArray=new G,this.programConfigurations=d,this.segments=new pe,this.dynamicLayoutVertexArray=new m,this.opacityVertexArray=new w,this.hasVisibleVertices=!1,this.placedSymbolArray=new Hn}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(d,b,C,R){this.isEmpty()||(C&&(this.layoutVertexBuffer=d.createVertexBuffer(this.layoutVertexArray,PD.members),this.indexBuffer=d.createIndexBuffer(this.indexArray,b),this.dynamicLayoutVertexBuffer=d.createVertexBuffer(this.dynamicLayoutVertexArray,Vv.members,!0),this.opacityVertexBuffer=d.createVertexBuffer(this.opacityVertexArray,Wv,!0),this.opacityVertexBuffer.itemSize=1),(C||R)&&this.programConfigurations.upload(d))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}pn("SymbolBuffers",Xv);class Jv{constructor(d,b,C){this.layoutVertexArray=new d,this.layoutAttributes=b,this.indexArray=new C,this.segments=new pe,this.collisionVertexArray=new O}upload(d){this.layoutVertexBuffer=d.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=d.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=d.createVertexBuffer(this.collisionVertexArray,qm.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}pn("CollisionBuffers",Jv);class ag{constructor(d){this.collisionBoxArray=d.collisionBoxArray,this.zoom=d.zoom,this.overscaling=d.overscaling,this.layers=d.layers,this.layerIds=this.layers.map(V=>V.id),this.index=d.index,this.pixelRatio=d.pixelRatio,this.sourceLayerIndex=d.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=jh([]),this.placementViewportMatrix=jh([]);const b=this.layers[0]._unevaluatedLayout._values;this.textSizeData=qv(this.zoom,b["text-size"]),this.iconSizeData=qv(this.zoom,b["icon-size"]);const C=this.layers[0].layout,R=C.get("symbol-sort-key"),U=C.get("symbol-z-order");this.canOverlap=Hy(C,"text-overlap","text-allow-overlap")!=="never"||Hy(C,"icon-overlap","icon-allow-overlap")!=="never"||C.get("text-ignore-placement")||C.get("icon-ignore-placement"),this.sortFeaturesByKey=U!=="viewport-y"&&!R.isConstant(),this.sortFeaturesByY=(U==="viewport-y"||U==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,C.get("symbol-placement")==="point"&&(this.writingModes=C.get("text-writing-mode").map(V=>a.ah[V])),this.stateDependentLayerIds=this.layers.filter(V=>V.isStateDependent()).map(V=>V.id),this.sourceID=d.sourceID}createArrays(){this.text=new Xv(new Oi(this.layers,this.zoom,d=>/^text/.test(d))),this.icon=new Xv(new Oi(this.layers,this.zoom,d=>/^icon/.test(d))),this.glyphOffsetArray=new ui,this.lineVertexArray=new Ii,this.symbolInstances=new Zn,this.textAnchorOffsets=new mi}calculateGlyphDependencies(d,b,C,R,U){for(let V=0;V<d.length;V++)if(b[d.charCodeAt(V)]=!0,(C||R)&&U){const K=tg[d.charAt(V)];K&&(b[K.charCodeAt(0)]=!0)}}populate(d,b,C){const R=this.layers[0],U=R.layout,V=U.get("text-font"),K=U.get("text-field"),ee=U.get("icon-image"),le=(K.value.kind!=="constant"||K.value.value instanceof bi&&!K.value.value.isEmpty()||K.value.value.toString().length>0)&&(V.value.kind!=="constant"||V.value.value.length>0),_e=ee.value.kind!=="constant"||!!ee.value.value||Object.keys(ee.parameters).length>0,Be=U.get("symbol-sort-key");if(this.features=[],!le&&!_e)return;const De=b.iconDependencies,Ge=b.glyphDependencies,et=b.availableImages,lt=new Fi(this.zoom);for(const{feature:Ct,id:p,index:u,sourceLayerIndex:A}of d){const v=R._featureFilter.needGeometry,M=Bs(Ct,v);if(!R._featureFilter.filter(lt,M,C))continue;let L,k;if(v||(M.geometry=Rs(Ct)),le){const q=R.getValueAndResolveTokens("text-field",M,C,et),te=bi.factory(q),ae=this.hasRTLText=this.hasRTLText||UD(te);(!ae||_o.getRTLTextPluginStatus()==="unavailable"||ae&&_o.isParsed())&&(L=RD(te,R,M))}if(_e){const q=R.getValueAndResolveTokens("icon-image",M,C,et);k=q instanceof Hi?q:Hi.fromString(q)}if(!L&&!k)continue;const Q=this.sortFeaturesByKey?Be.evaluate(M,{},C):void 0;if(this.features.push({id:p,text:L,icon:k,index:u,sourceLayerIndex:A,geometry:M.geometry,properties:Ct.properties,type:Kv[Ct.type],sortKey:Q}),k&&(De[k.name]=!0),L){const q=V.evaluate(M,{},C).join(","),te=U.get("text-rotation-alignment")!=="viewport"&&U.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(a.ah.vertical)>=0;for(const ae of L.sections)if(ae.image)De[ae.image.name]=!0;else{const de=Gu(L.toString()),ye=ae.fontStack||q,me=Ge[ye]=Ge[ye]||{};this.calculateGlyphDependencies(ae.text,me,te,this.allowVerticalPlacement,de)}}}U.get("symbol-placement")==="line"&&(this.features=function(Ct){const p={},u={},A=[];let v=0;function M(q){A.push(Ct[q]),v++}function L(q,te,ae){const de=u[q];return delete u[q],u[te]=de,A[de].geometry[0].pop(),A[de].geometry[0]=A[de].geometry[0].concat(ae[0]),de}function k(q,te,ae){const de=p[te];return delete p[te],p[q]=de,A[de].geometry[0].shift(),A[de].geometry[0]=ae[0].concat(A[de].geometry[0]),de}function Q(q,te,ae){const de=ae?te[0][te[0].length-1]:te[0][0];return`${q}:${de.x}:${de.y}`}for(let q=0;q<Ct.length;q++){const te=Ct[q],ae=te.geometry,de=te.text?te.text.toString():null;if(!de){M(q);continue}const ye=Q(de,ae),me=Q(de,ae,!0);if(ye in u&&me in p&&u[ye]!==p[me]){const Ie=k(ye,me,ae),ke=L(ye,me,A[Ie].geometry);delete p[ye],delete u[me],u[Q(de,A[ke].geometry,!0)]=ke,A[Ie].geometry=null}else ye in u?L(ye,me,ae):me in p?k(ye,me,ae):(M(q),p[ye]=v-1,u[me]=v-1)}return A.filter(q=>q.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Ct,p)=>Ct.sortKey-p.sortKey)}update(d,b,C){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(d,b,this.layers,C),this.icon.programConfigurations.updatePaintArrays(d,b,this.layers,C))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(d){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(d),this.iconCollisionBox.upload(d)),this.text.upload(d,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(d,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(d,b){const C=this.lineVertexArray.length;if(d.segment!==void 0){let R=d.dist(b[d.segment+1]),U=d.dist(b[d.segment]);const V={};for(let K=d.segment+1;K<b.length;K++)V[K]={x:b[K].x,y:b[K].y,tileUnitDistanceFromAnchor:R},K<b.length-1&&(R+=b[K+1].dist(b[K]));for(let K=d.segment||0;K>=0;K--)V[K]={x:b[K].x,y:b[K].y,tileUnitDistanceFromAnchor:U},K>0&&(U+=b[K-1].dist(b[K]));for(let K=0;K<b.length;K++){const ee=V[K];this.lineVertexArray.emplaceBack(ee.x,ee.y,ee.tileUnitDistanceFromAnchor)}}return{lineStartIndex:C,lineLength:this.lineVertexArray.length-C}}addSymbols(d,b,C,R,U,V,K,ee,le,_e,Be,De){const Ge=d.indexArray,et=d.layoutVertexArray,lt=d.segments.prepareSegment(4*b.length,et,Ge,this.canOverlap?V.sortKey:void 0),Ct=this.glyphOffsetArray.length,p=lt.vertexLength,u=this.allowVerticalPlacement&&K===a.ah.vertical?Math.PI/2:0,A=V.text&&V.text.sections;for(let v=0;v<b.length;v++){const{tl:M,tr:L,bl:k,br:Q,tex:q,pixelOffsetTL:te,pixelOffsetBR:ae,minFontScaleX:de,minFontScaleY:ye,glyphOffset:me,isSDF:Ie,sectionIndex:ke}=b[v],nt=lt.vertexLength,ct=me[1];Vy(et,ee.x,ee.y,M.x,ct+M.y,q.x,q.y,C,Ie,te.x,te.y,de,ye),Vy(et,ee.x,ee.y,L.x,ct+L.y,q.x+q.w,q.y,C,Ie,ae.x,te.y,de,ye),Vy(et,ee.x,ee.y,k.x,ct+k.y,q.x,q.y+q.h,C,Ie,te.x,ae.y,de,ye),Vy(et,ee.x,ee.y,Q.x,ct+Q.y,q.x+q.w,q.y+q.h,C,Ie,ae.x,ae.y,de,ye),Gy(d.dynamicLayoutVertexArray,ee,u),Ge.emplaceBack(nt,nt+1,nt+2),Ge.emplaceBack(nt+1,nt+2,nt+3),lt.vertexLength+=4,lt.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(me[0]),v!==b.length-1&&ke===b[v+1].sectionIndex||d.programConfigurations.populatePaintArrays(et.length,V,V.index,{},De,A&&A[ke])}d.placedSymbolArray.emplaceBack(ee.x,ee.y,Ct,this.glyphOffsetArray.length-Ct,p,le,_e,ee.segment,C?C[0]:0,C?C[1]:0,R[0],R[1],K,0,!1,0,Be)}_addCollisionDebugVertex(d,b,C,R,U,V){return b.emplaceBack(0,0),d.emplaceBack(C.x,C.y,R,U,Math.round(V.x),Math.round(V.y))}addCollisionDebugVertices(d,b,C,R,U,V,K){const ee=U.segments.prepareSegment(4,U.layoutVertexArray,U.indexArray),le=ee.vertexLength,_e=U.layoutVertexArray,Be=U.collisionVertexArray,De=K.anchorX,Ge=K.anchorY;this._addCollisionDebugVertex(_e,Be,V,De,Ge,new x(d,b)),this._addCollisionDebugVertex(_e,Be,V,De,Ge,new x(C,b)),this._addCollisionDebugVertex(_e,Be,V,De,Ge,new x(C,R)),this._addCollisionDebugVertex(_e,Be,V,De,Ge,new x(d,R)),ee.vertexLength+=4;const et=U.indexArray;et.emplaceBack(le,le+1),et.emplaceBack(le+1,le+2),et.emplaceBack(le+2,le+3),et.emplaceBack(le+3,le),ee.primitiveLength+=4}addDebugCollisionBoxes(d,b,C,R){for(let U=d;U<b;U++){const V=this.collisionBoxArray.get(U);this.addCollisionDebugVertices(V.x1,V.y1,V.x2,V.y2,R?this.textCollisionBox:this.iconCollisionBox,V.anchorPoint,C)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Jv(P,Py.members,J),this.iconCollisionBox=new Jv(P,Py.members,J);for(let d=0;d<this.symbolInstances.length;d++){const b=this.symbolInstances.get(d);this.addDebugCollisionBoxes(b.textBoxStartIndex,b.textBoxEndIndex,b,!0),this.addDebugCollisionBoxes(b.verticalTextBoxStartIndex,b.verticalTextBoxEndIndex,b,!0),this.addDebugCollisionBoxes(b.iconBoxStartIndex,b.iconBoxEndIndex,b,!1),this.addDebugCollisionBoxes(b.verticalIconBoxStartIndex,b.verticalIconBoxEndIndex,b,!1)}}_deserializeCollisionBoxesForSymbol(d,b,C,R,U,V,K,ee,le){const _e={};for(let Be=b;Be<C;Be++){const De=d.get(Be);_e.textBox={x1:De.x1,y1:De.y1,x2:De.x2,y2:De.y2,anchorPointX:De.anchorPointX,anchorPointY:De.anchorPointY},_e.textFeatureIndex=De.featureIndex;break}for(let Be=R;Be<U;Be++){const De=d.get(Be);_e.verticalTextBox={x1:De.x1,y1:De.y1,x2:De.x2,y2:De.y2,anchorPointX:De.anchorPointX,anchorPointY:De.anchorPointY},_e.verticalTextFeatureIndex=De.featureIndex;break}for(let Be=V;Be<K;Be++){const De=d.get(Be);_e.iconBox={x1:De.x1,y1:De.y1,x2:De.x2,y2:De.y2,anchorPointX:De.anchorPointX,anchorPointY:De.anchorPointY},_e.iconFeatureIndex=De.featureIndex;break}for(let Be=ee;Be<le;Be++){const De=d.get(Be);_e.verticalIconBox={x1:De.x1,y1:De.y1,x2:De.x2,y2:De.y2,anchorPointX:De.anchorPointX,anchorPointY:De.anchorPointY},_e.verticalIconFeatureIndex=De.featureIndex;break}return _e}deserializeCollisionBoxes(d){this.collisionArrays=[];for(let b=0;b<this.symbolInstances.length;b++){const C=this.symbolInstances.get(b);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(d,C.textBoxStartIndex,C.textBoxEndIndex,C.verticalTextBoxStartIndex,C.verticalTextBoxEndIndex,C.iconBoxStartIndex,C.iconBoxEndIndex,C.verticalIconBoxStartIndex,C.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(d,b){const C=d.placedSymbolArray.get(b),R=C.vertexStartIndex+4*C.numGlyphs;for(let U=C.vertexStartIndex;U<R;U+=4)d.indexArray.emplaceBack(U,U+1,U+2),d.indexArray.emplaceBack(U+1,U+2,U+3)}getSortedSymbolIndexes(d){if(this.sortedAngle===d&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const b=Math.sin(d),C=Math.cos(d),R=[],U=[],V=[];for(let K=0;K<this.symbolInstances.length;++K){V.push(K);const ee=this.symbolInstances.get(K);R.push(0|Math.round(b*ee.anchorX+C*ee.anchorY)),U.push(ee.featureIndex)}return V.sort((K,ee)=>R[K]-R[ee]||U[ee]-U[K]),V}addToSortKeyRanges(d,b){const C=this.sortKeyRanges[this.sortKeyRanges.length-1];C&&C.sortKey===b?C.symbolInstanceEnd=d+1:this.sortKeyRanges.push({sortKey:b,symbolInstanceStart:d,symbolInstanceEnd:d+1})}sortFeatures(d){if(this.sortFeaturesByY&&this.sortedAngle!==d&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(d),this.sortedAngle=d,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const b of this.symbolInstanceIndexes){const C=this.symbolInstances.get(b);this.featureSortOrder.push(C.featureIndex),[C.rightJustifiedTextSymbolIndex,C.centerJustifiedTextSymbolIndex,C.leftJustifiedTextSymbolIndex].forEach((R,U,V)=>{R>=0&&V.indexOf(R)===U&&this.addIndicesForPlacedSymbol(this.text,R)}),C.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,C.verticalPlacedTextSymbolIndex),C.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,C.placedIconSymbolIndex),C.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,C.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let VT,Zv;pn("SymbolBucket",ag,{omit:["layers","collisionBoxArray","features","compareText"]}),ag.MAX_GLYPHS=65535,ag.addDynamicAttributes=Gy;var Qy={get paint(){return Zv=Zv||new E({"icon-opacity":new Wn(We.paint_symbol["icon-opacity"]),"icon-color":new Wn(We.paint_symbol["icon-color"]),"icon-halo-color":new Wn(We.paint_symbol["icon-halo-color"]),"icon-halo-width":new Wn(We.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Wn(We.paint_symbol["icon-halo-blur"]),"icon-translate":new vn(We.paint_symbol["icon-translate"]),"icon-translate-anchor":new vn(We.paint_symbol["icon-translate-anchor"]),"text-opacity":new Wn(We.paint_symbol["text-opacity"]),"text-color":new Wn(We.paint_symbol["text-color"],{runtimeType:He,getOverride:g=>g.textColor,hasOverride:g=>!!g.textColor}),"text-halo-color":new Wn(We.paint_symbol["text-halo-color"]),"text-halo-width":new Wn(We.paint_symbol["text-halo-width"]),"text-halo-blur":new Wn(We.paint_symbol["text-halo-blur"]),"text-translate":new vn(We.paint_symbol["text-translate"]),"text-translate-anchor":new vn(We.paint_symbol["text-translate-anchor"])})},get layout(){return VT=VT||new E({"symbol-placement":new vn(We.layout_symbol["symbol-placement"]),"symbol-spacing":new vn(We.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new vn(We.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Wn(We.layout_symbol["symbol-sort-key"]),"symbol-z-order":new vn(We.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new vn(We.layout_symbol["icon-allow-overlap"]),"icon-overlap":new vn(We.layout_symbol["icon-overlap"]),"icon-ignore-placement":new vn(We.layout_symbol["icon-ignore-placement"]),"icon-optional":new vn(We.layout_symbol["icon-optional"]),"icon-rotation-alignment":new vn(We.layout_symbol["icon-rotation-alignment"]),"icon-size":new Wn(We.layout_symbol["icon-size"]),"icon-text-fit":new vn(We.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new vn(We.layout_symbol["icon-text-fit-padding"]),"icon-image":new Wn(We.layout_symbol["icon-image"]),"icon-rotate":new Wn(We.layout_symbol["icon-rotate"]),"icon-padding":new Wn(We.layout_symbol["icon-padding"]),"icon-keep-upright":new vn(We.layout_symbol["icon-keep-upright"]),"icon-offset":new Wn(We.layout_symbol["icon-offset"]),"icon-anchor":new Wn(We.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new vn(We.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new vn(We.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new vn(We.layout_symbol["text-rotation-alignment"]),"text-field":new Wn(We.layout_symbol["text-field"]),"text-font":new Wn(We.layout_symbol["text-font"]),"text-size":new Wn(We.layout_symbol["text-size"]),"text-max-width":new Wn(We.layout_symbol["text-max-width"]),"text-line-height":new vn(We.layout_symbol["text-line-height"]),"text-letter-spacing":new Wn(We.layout_symbol["text-letter-spacing"]),"text-justify":new Wn(We.layout_symbol["text-justify"]),"text-radial-offset":new Wn(We.layout_symbol["text-radial-offset"]),"text-variable-anchor":new vn(We.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Wn(We.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Wn(We.layout_symbol["text-anchor"]),"text-max-angle":new vn(We.layout_symbol["text-max-angle"]),"text-writing-mode":new vn(We.layout_symbol["text-writing-mode"]),"text-rotate":new Wn(We.layout_symbol["text-rotate"]),"text-padding":new vn(We.layout_symbol["text-padding"]),"text-keep-upright":new vn(We.layout_symbol["text-keep-upright"]),"text-transform":new Wn(We.layout_symbol["text-transform"]),"text-offset":new Wn(We.layout_symbol["text-offset"]),"text-allow-overlap":new vn(We.layout_symbol["text-allow-overlap"]),"text-overlap":new vn(We.layout_symbol["text-overlap"]),"text-ignore-placement":new vn(We.layout_symbol["text-ignore-placement"]),"text-optional":new vn(We.layout_symbol["text-optional"])})}};class lg{constructor(d){if(d.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=d.property.overrides?d.property.overrides.runtimeType:Ci,this.defaultValue=d}evaluate(d){if(d.formattedSection){const b=this.defaultValue.property.overrides;if(b&&b.hasOverride(d.formattedSection))return b.getOverride(d.formattedSection)}return d.feature&&d.featureState?this.defaultValue.evaluate(d.feature,d.featureState):this.defaultValue.property.specification.default}eachChild(d){this.defaultValue.isConstant()||d(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}pn("FormatSectionOverride",lg,{omit:["defaultValue"]});class qu extends y{constructor(d){super(d,Qy)}recalculate(d,b){if(super.recalculate(d,b),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const C=this.layout.get("text-writing-mode");if(C){const R=[];for(const U of C)R.indexOf(U)<0&&R.push(U);this.layout._values["text-writing-mode"]=R}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(d,b,C,R){const U=this.layout.get(d).evaluate(b,{},C,R),V=this._unevaluatedLayout._values[d];return V.isDataDriven()||bl(V.value)||!U?U:function(K,ee){return ee.replace(/{([^{}]+)}/g,(le,_e)=>K&&_e in K?String(K[_e]):"")}(b.properties,U)}createBucket(d){return new ag(d)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const d of Qy.paint.overridableProperties){if(!qu.hasPaintOverride(this.layout,d))continue;const b=this.paint.get(d),C=new lg(b),R=new kc(C,b.property.specification);let U=null;U=b.value.kind==="constant"||b.value.kind==="source"?new uo("source",R):new ca("composite",R,b.value.zoomStops),this.paint._values[d]=new Cl(b.property,U,b.parameters)}}_handleOverridablePaintPropertyUpdate(d,b,C){return!(!this.layout||b.isDataDriven()||C.isDataDriven())&&qu.hasPaintOverride(this.layout,d)}static hasPaintOverride(d,b){const C=d.get("text-field"),R=Qy.paint.properties[b];let U=!1;const V=K=>{for(const ee of K)if(R.overrides&&R.overrides.hasOverride(ee))return void(U=!0)};if(C.value.kind==="constant"&&C.value.value instanceof bi)V(C.value.value.sections);else if(C.value.kind==="source"){const K=le=>{U||(le instanceof sa&&ts(le.value)===Mt?V(le.value.sections):le instanceof ac?V(le.sections):le.eachChild(K))},ee=C.value;ee._styleExpression&&K(ee._styleExpression.expression)}return U}}let If;var GT={get paint(){return If=If||new E({"background-color":new vn(We.paint_background["background-color"]),"background-pattern":new z(We.paint_background["background-pattern"]),"background-opacity":new vn(We.paint_background["background-opacity"])})}};class Yv extends y{constructor(d){super(d,GT)}}let QT;var ND={get paint(){return QT=QT||new E({"raster-opacity":new vn(We.paint_raster["raster-opacity"]),"raster-hue-rotate":new vn(We.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new vn(We.paint_raster["raster-brightness-min"]),"raster-brightness-max":new vn(We.paint_raster["raster-brightness-max"]),"raster-saturation":new vn(We.paint_raster["raster-saturation"]),"raster-contrast":new vn(We.paint_raster["raster-contrast"]),"raster-resampling":new vn(We.paint_raster["raster-resampling"]),"raster-fade-duration":new vn(We.paint_raster["raster-fade-duration"])})}};class $y extends y{constructor(d){super(d,ND)}}class ex extends y{constructor(d){super(d,{}),this.onAdd=b=>{this.implementation.onAdd&&this.implementation.onAdd(b,b.painter.context.gl)},this.onRemove=b=>{this.implementation.onRemove&&this.implementation.onRemove(b,b.painter.context.gl)},this.implementation=d}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class zD{constructor(d){this._methodToThrottle=d,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Jm=63710088e-1;class Id{constructor(d,b){if(isNaN(d)||isNaN(b))throw new Error(`Invalid LngLat object: (${d}, ${b})`);if(this.lng=+d,this.lat=+b,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Id(be(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(d){const b=Math.PI/180,C=this.lat*b,R=d.lat*b,U=Math.sin(C)*Math.sin(R)+Math.cos(C)*Math.cos(R)*Math.cos((d.lng-this.lng)*b);return Jm*Math.acos(Math.min(U,1))}static convert(d){if(d instanceof Id)return d;if(Array.isArray(d)&&(d.length===2||d.length===3))return new Id(Number(d[0]),Number(d[1]));if(!Array.isArray(d)&&typeof d=="object"&&d!==null)return new Id(Number("lng"in d?d.lng:d.lon),Number(d.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const GA=2*Math.PI*Jm;function tx(g){return GA*Math.cos(g*Math.PI/180)}function rx(g){return(180+g)/360}function jy(g){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+g*Math.PI/360)))/360}function nx(g,d){return g/tx(d)}function cg(g){return 360/Math.PI*Math.atan(Math.exp((180-360*g)*Math.PI/180))-90}class ug{constructor(d,b){let C=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;this.x=+d,this.y=+b,this.z=+C}static fromLngLat(d){let b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const C=Id.convert(d);return new ug(rx(C.lng),jy(C.lat),nx(b,C.lat))}toLngLat(){return new Id(360*this.x-180,cg(this.y))}toAltitude(){return this.z*tx(cg(this.y))}meterInMercatorCoordinateUnits(){return 1/GA*(d=cg(this.y),1/Math.cos(d*Math.PI/180));var d}}function $T(g,d,b){var C=2*Math.PI*6378137/256/Math.pow(2,b);return[g*C-2*Math.PI*6378137/2,d*C-2*Math.PI*6378137/2]}class ix{constructor(d,b,C){if(!function(R,U,V){return!(R<0||R>25||V<0||V>=Math.pow(2,R)||U<0||U>=Math.pow(2,R))}(d,b,C))throw new Error(`x=${b}, y=${C}, z=${d} outside of bounds. 0<=x<${Math.pow(2,d)}, 0<=y<${Math.pow(2,d)} 0<=z<=25 `);this.z=d,this.x=b,this.y=C,this.key=Zm(0,d,d,b,C)}equals(d){return this.z===d.z&&this.x===d.x&&this.y===d.y}url(d,b,C){const R=(V=this.y,K=this.z,ee=$T(256*(U=this.x),256*(V=Math.pow(2,K)-V-1),K),le=$T(256*(U+1),256*(V+1),K),ee[0]+","+ee[1]+","+le[0]+","+le[1]);var U,V,K,ee,le;const _e=function(Be,De,Ge){let et,lt="";for(let Ct=Be;Ct>0;Ct--)et=1<<Ct-1,lt+=(De&et?1:0)+(Ge&et?2:0);return lt}(this.z,this.x,this.y);return d[(this.x+this.y)%d.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(C==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,b>1?"@2x":"").replace(/{quadkey}/g,_e).replace(/{bbox-epsg-3857}/g,R)}isChildOf(d){const b=this.z-d.z;return b>0&&d.x===this.x>>b&&d.y===this.y>>b}getTilePoint(d){const b=Math.pow(2,this.z);return new x((d.x*b-this.x)*ti,(d.y*b-this.y)*ti)}toString(){return`${this.z}/${this.x}/${this.y}`}}class sx{constructor(d,b){this.wrap=d,this.canonical=b,this.key=Zm(d,b.z,b.z,b.x,b.y)}}class Ku{constructor(d,b,C,R,U){if(d<C)throw new Error(`overscaledZ should be >= z; overscaledZ = ${d}; z = ${C}`);this.overscaledZ=d,this.wrap=b,this.canonical=new ix(C,+R,+U),this.key=Zm(b,d,C,R,U)}clone(){return new Ku(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(d){return this.overscaledZ===d.overscaledZ&&this.wrap===d.wrap&&this.canonical.equals(d.canonical)}scaledTo(d){if(d>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${d}; overscaledZ = ${this.overscaledZ}`);const b=this.canonical.z-d;return d>this.canonical.z?new Ku(d,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ku(d,this.wrap,d,this.canonical.x>>b,this.canonical.y>>b)}calculateScaledKey(d,b){if(d>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${d}; overscaledZ = ${this.overscaledZ}`);const C=this.canonical.z-d;return d>this.canonical.z?Zm(this.wrap*+b,d,this.canonical.z,this.canonical.x,this.canonical.y):Zm(this.wrap*+b,d,d,this.canonical.x>>C,this.canonical.y>>C)}isChildOf(d){if(d.wrap!==this.wrap)return!1;const b=this.canonical.z-d.canonical.z;return d.overscaledZ===0||d.overscaledZ<this.overscaledZ&&d.canonical.x===this.canonical.x>>b&&d.canonical.y===this.canonical.y>>b}children(d){if(this.overscaledZ>=d)return[new Ku(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const b=this.canonical.z+1,C=2*this.canonical.x,R=2*this.canonical.y;return[new Ku(b,this.wrap,b,C,R),new Ku(b,this.wrap,b,C+1,R),new Ku(b,this.wrap,b,C,R+1),new Ku(b,this.wrap,b,C+1,R+1)]}isLessThan(d){return this.wrap<d.wrap||!(this.wrap>d.wrap)&&(this.overscaledZ<d.overscaledZ||!(this.overscaledZ>d.overscaledZ)&&(this.canonical.x<d.canonical.x||!(this.canonical.x>d.canonical.x)&&this.canonical.y<d.canonical.y))}wrapped(){return new Ku(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(d){return new Ku(this.overscaledZ,d,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new sx(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(d){return this.canonical.getTilePoint(new ug(d.x-this.wrap,d.y))}}function Zm(g,d,b,C,R){(g*=2)<0&&(g=-1*g-1);const U=1<<b;return(U*U*g+U*R+C).toString(36)+b.toString(36)+d.toString(36)}pn("CanonicalTileID",ix),pn("OverscaledTileID",Ku,{omit:["posMatrix"]});class jT{constructor(d,b,C){let R=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1,U=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1,V=arguments.length>5&&arguments[5]!==void 0?arguments[5]:1,K=arguments.length>6&&arguments[6]!==void 0?arguments[6]:0;if(this.uid=d,b.height!==b.width)throw new RangeError("DEM tiles must be square");if(C&&!["mapbox","terrarium","custom"].includes(C))return void tt(`"${C}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=b.height;const ee=this.dim=b.height-2;switch(this.data=new Uint32Array(b.data.buffer),C){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=R,this.greenFactor=U,this.blueFactor=V,this.baseShift=K;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let le=0;le<ee;le++)this.data[this._idx(-1,le)]=this.data[this._idx(0,le)],this.data[this._idx(ee,le)]=this.data[this._idx(ee-1,le)],this.data[this._idx(le,-1)]=this.data[this._idx(le,0)],this.data[this._idx(le,ee)]=this.data[this._idx(le,ee-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(ee,-1)]=this.data[this._idx(ee-1,0)],this.data[this._idx(-1,ee)]=this.data[this._idx(0,ee-1)],this.data[this._idx(ee,ee)]=this.data[this._idx(ee-1,ee-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let le=0;le<ee;le++)for(let _e=0;_e<ee;_e++){const Be=this.get(le,_e);Be>this.max&&(this.max=Be),Be<this.min&&(this.min=Be)}}get(d,b){const C=new Uint8Array(this.data.buffer),R=4*this._idx(d,b);return this.unpack(C[R],C[R+1],C[R+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(d,b){if(d<-1||d>=this.dim+1||b<-1||b>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(b+1)*this.stride+(d+1)}unpack(d,b,C){return d*this.redFactor+b*this.greenFactor+C*this.blueFactor-this.baseShift}getPixels(){return new $u({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(d,b,C){if(this.dim!==d.dim)throw new Error("dem dimension mismatch");let R=b*this.dim,U=b*this.dim+this.dim,V=C*this.dim,K=C*this.dim+this.dim;switch(b){case-1:R=U-1;break;case 1:U=R+1}switch(C){case-1:V=K-1;break;case 1:K=V+1}const ee=-b*this.dim,le=-C*this.dim;for(let _e=V;_e<K;_e++)for(let Be=R;Be<U;Be++)this.data[this._idx(Be,_e)]=d.data[this._idx(Be+ee,_e+le)]}}pn("DEMData",jT);class qT{constructor(d){this._stringToNumber={},this._numberToString=[];for(let b=0;b<d.length;b++){const C=d[b];this._stringToNumber[C]=b,this._numberToString[b]=C}}encode(d){return this._stringToNumber[d]}decode(d){if(d>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${d} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[d]}}class qy{constructor(d,b,C,R,U){this.type="Feature",this._vectorTileFeature=d,d._z=b,d._x=C,d._y=R,this.properties=d.properties,this.id=U}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(d){this._geometry=d}toJSON(){const d={geometry:this.geometry};for(const b in this)b!=="_geometry"&&b!=="_vectorTileFeature"&&(d[b]=this[b]);return d}}class Mf{constructor(d,b){this.tileID=d,this.x=d.canonical.x,this.y=d.canonical.y,this.z=d.canonical.z,this.grid=new vu(ti,16,0),this.grid3D=new vu(ti,16,0),this.featureIndexArray=new Di,this.promoteId=b}insert(d,b,C,R,U,V){const K=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(C,R,U);const ee=V?this.grid3D:this.grid;for(let le=0;le<b.length;le++){const _e=b[le],Be=[1/0,1/0,-1/0,-1/0];for(let De=0;De<_e.length;De++){const Ge=_e[De];Be[0]=Math.min(Be[0],Ge.x),Be[1]=Math.min(Be[1],Ge.y),Be[2]=Math.max(Be[2],Ge.x),Be[3]=Math.max(Be[3],Ge.y)}Be[0]<ti&&Be[1]<ti&&Be[2]>=0&&Be[3]>=0&&ee.insert(K,Be[0],Be[1],Be[2],Be[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Cf.VectorTile(new Ly(this.rawTileData)).layers,this.sourceLayerCoder=new qT(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(d,b,C,R){this.loadVTLayers();const U=d.params||{},V=ti/d.tileSize/d.scale,K=Yo(U.filter),ee=d.queryGeometry,le=d.queryPadding*V,_e=ax(ee),Be=this.grid.query(_e.minX-le,_e.minY-le,_e.maxX+le,_e.maxY+le),De=ax(d.cameraQueryGeometry),Ge=this.grid3D.query(De.minX-le,De.minY-le,De.maxX+le,De.maxY+le,(Ct,p,u,A)=>function(v,M,L,k,Q){for(const te of v)if(M<=te.x&&L<=te.y&&k>=te.x&&Q>=te.y)return!0;const q=[new x(M,L),new x(M,Q),new x(k,Q),new x(k,L)];if(v.length>2){for(const te of q)if(Io(v,te))return!0}for(let te=0;te<v.length-1;te++)if(Ji(v[te],v[te+1],q))return!0;return!1}(d.cameraQueryGeometry,Ct-le,p-le,u+le,A+le));for(const Ct of Ge)Be.push(Ct);Be.sort(KT);const et={};let lt;for(let Ct=0;Ct<Be.length;Ct++){const p=Be[Ct];if(p===lt)continue;lt=p;const u=this.featureIndexArray.get(p);let A=null;this.loadMatchingFeature(et,u.bucketIndex,u.sourceLayerIndex,u.featureIndex,K,U.layers,U.availableImages,b,C,R,(v,M,L)=>(A||(A=Rs(v)),M.queryIntersectsFeature(ee,v,L,A,this.z,d.transform,V,d.pixelPosMatrix)))}return et}loadMatchingFeature(d,b,C,R,U,V,K,ee,le,_e,Be){const De=this.bucketLayerIDs[b];if(V&&!function(Ct,p){for(let u=0;u<Ct.length;u++)if(p.indexOf(Ct[u])>=0)return!0;return!1}(V,De))return;const Ge=this.sourceLayerCoder.decode(C),et=this.vtLayers[Ge].feature(R);if(U.needGeometry){const Ct=Bs(et,!0);if(!U.filter(new Fi(this.tileID.overscaledZ),Ct,this.tileID.canonical))return}else if(!U.filter(new Fi(this.tileID.overscaledZ),et))return;const lt=this.getId(et,Ge);for(let Ct=0;Ct<De.length;Ct++){const p=De[Ct];if(V&&V.indexOf(p)<0)continue;const u=ee[p];if(!u)continue;let A={};lt&&_e&&(A=_e.getState(u.sourceLayer||"_geojsonTileLayer",lt));const v=Qe({},le[p]);v.paint=ox(v.paint,u.paint,et,A,K),v.layout=ox(v.layout,u.layout,et,A,K);const M=!Be||Be(et,u,A);if(!M)continue;const L=new qy(et,this.z,this.x,this.y,lt);L.layer=v;let k=d[p];k===void 0&&(k=d[p]=[]),k.push({featureIndex:R,feature:L,intersectionZ:M})}}lookupSymbolFeatures(d,b,C,R,U,V,K,ee){const le={};this.loadVTLayers();const _e=Yo(U);for(const Be of d)this.loadMatchingFeature(le,C,R,Be,_e,V,K,ee,b);return le}hasLayer(d){for(const b of this.bucketLayerIDs)for(const C of b)if(d===C)return!0;return!1}getId(d,b){let C=d.id;return this.promoteId&&(C=d.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[b]],typeof C=="boolean"&&(C=Number(C))),C}}function ox(g,d,b,C,R){return st(g,(U,V)=>{const K=d instanceof ci?d.get(V):null;return K&&K.evaluate?K.evaluate(b,C,R):K})}function ax(g){let d=1/0,b=1/0,C=-1/0,R=-1/0;for(const U of g)d=Math.min(d,U.x),b=Math.min(b,U.y),C=Math.max(C,U.x),R=Math.max(R,U.y);return{minX:d,minY:b,maxX:C,maxY:R}}function KT(g,d){return d-g}function lx(g,d,b,C,R){const U=[];for(let V=0;V<g.length;V++){const K=g[V];let ee;for(let le=0;le<K.length-1;le++){let _e=K[le],Be=K[le+1];_e.x<d&&Be.x<d||(_e.x<d?_e=new x(d,_e.y+(d-_e.x)/(Be.x-_e.x)*(Be.y-_e.y))._round():Be.x<d&&(Be=new x(d,_e.y+(d-_e.x)/(Be.x-_e.x)*(Be.y-_e.y))._round()),_e.y<b&&Be.y<b||(_e.y<b?_e=new x(_e.x+(b-_e.y)/(Be.y-_e.y)*(Be.x-_e.x),b)._round():Be.y<b&&(Be=new x(_e.x+(b-_e.y)/(Be.y-_e.y)*(Be.x-_e.x),b)._round()),_e.x>=C&&Be.x>=C||(_e.x>=C?_e=new x(C,_e.y+(C-_e.x)/(Be.x-_e.x)*(Be.y-_e.y))._round():Be.x>=C&&(Be=new x(C,_e.y+(C-_e.x)/(Be.x-_e.x)*(Be.y-_e.y))._round()),_e.y>=R&&Be.y>=R||(_e.y>=R?_e=new x(_e.x+(R-_e.y)/(Be.y-_e.y)*(Be.x-_e.x),R)._round():Be.y>=R&&(Be=new x(_e.x+(R-_e.y)/(Be.y-_e.y)*(Be.x-_e.x),R)._round()),ee&&_e.equals(ee[ee.length-1])||(ee=[_e],U.push(ee)),ee.push(Be)))))}}return U}pn("FeatureIndex",Mf,{omit:["rawTileData","sourceLayerCoder"]});class Pf extends x{constructor(d,b,C,R){super(d,b),this.angle=C,R!==void 0&&(this.segment=R)}clone(){return new Pf(this.x,this.y,this.angle,this.segment)}}function Ky(g,d,b,C,R){if(d.segment===void 0||b===0)return!0;let U=d,V=d.segment+1,K=0;for(;K>-b/2;){if(V--,V<0)return!1;K-=g[V].dist(U),U=g[V]}K+=g[V].dist(g[V+1]),V++;const ee=[];let le=0;for(;K<b/2;){const _e=g[V],Be=g[V+1];if(!Be)return!1;let De=g[V-1].angleTo(_e)-_e.angleTo(Be);for(De=Math.abs((De+3*Math.PI)%(2*Math.PI)-Math.PI),ee.push({distance:K,angleDelta:De}),le+=De;K-ee[0].distance>C;)le-=ee.shift().angleDelta;if(le>R)return!1;V++,K+=_e.dist(Be)}return!0}function cx(g){let d=0;for(let b=0;b<g.length-1;b++)d+=g[b].dist(g[b+1]);return d}function hg(g,d,b){return g?.6*d*b:0}function ux(g,d){return Math.max(g?g.right-g.left:0,d?d.right-d.left:0)}function hx(g,d,b,C,R,U){const V=hg(b,R,U),K=ux(b,C)*U;let ee=0;const le=cx(g)/2;for(let _e=0;_e<g.length-1;_e++){const Be=g[_e],De=g[_e+1],Ge=Be.dist(De);if(ee+Ge>le){const et=(le-ee)/Ge,lt=ps.number(Be.x,De.x,et),Ct=ps.number(Be.y,De.y,et),p=new Pf(lt,Ct,De.angleTo(Be),_e);return p._round(),!V||Ky(g,p,K,V,d)?p:void 0}ee+=Ge}}function WT(g,d,b,C,R,U,V,K,ee){const le=hg(C,U,V),_e=ux(C,R),Be=_e*V,De=g[0].x===0||g[0].x===ee||g[0].y===0||g[0].y===ee;return d-Be<d/4&&(d=Be+d/4),Su(g,De?d/2*K%d:(_e/2+2*U)*V*K%d,d,le,b,Be,De,!1,ee)}function Su(g,d,b,C,R,U,V,K,ee){const le=U/2,_e=cx(g);let Be=0,De=d-b,Ge=[];for(let et=0;et<g.length-1;et++){const lt=g[et],Ct=g[et+1],p=lt.dist(Ct),u=Ct.angleTo(lt);for(;De+b<Be+p;){De+=b;const A=(De-Be)/p,v=ps.number(lt.x,Ct.x,A),M=ps.number(lt.y,Ct.y,A);if(v>=0&&v<ee&&M>=0&&M<ee&&De-le>=0&&De+le<=_e){const L=new Pf(v,M,u,et);L._round(),C&&!Ky(g,L,U,C,R)||Ge.push(L)}}Be+=p}return K||Ge.length||V||(Ge=Su(g,Be/2,b,C,R,U,V,!0,ee)),Ge}pn("Anchor",Pf);const Xh=Zi;function dx(g,d,b,C){const R=[],U=g.image,V=U.pixelRatio,K=U.paddedRect.w-2*Xh,ee=U.paddedRect.h-2*Xh;let le={x1:g.left,y1:g.top,x2:g.right,y2:g.bottom};const _e=U.stretchX||[[0,K]],Be=U.stretchY||[[0,ee]],De=(me,Ie)=>me+Ie[1]-Ie[0],Ge=_e.reduce(De,0),et=Be.reduce(De,0),lt=K-Ge,Ct=ee-et;let p=0,u=Ge,A=0,v=et,M=0,L=lt,k=0,Q=Ct;if(U.content&&C){const me=U.content,Ie=me[2]-me[0],ke=me[3]-me[1];(U.textFitWidth||U.textFitHeight)&&(le=zT(g)),p=Ym(_e,0,me[0]),A=Ym(Be,0,me[1]),u=Ym(_e,me[0],me[2]),v=Ym(Be,me[1],me[3]),M=me[0]-p,k=me[1]-A,L=Ie-u,Q=ke-v}const q=le.x1,te=le.y1,ae=le.x2-q,de=le.y2-te,ye=(me,Ie,ke,nt)=>{const ct=e_(me.stretch-p,u,ae,q),Ot=t_(me.fixed-M,L,me.stretch,Ge),wt=e_(Ie.stretch-A,v,de,te),Re=t_(Ie.fixed-k,Q,Ie.stretch,et),it=e_(ke.stretch-p,u,ae,q),Et=t_(ke.fixed-M,L,ke.stretch,Ge),Zt=e_(nt.stretch-A,v,de,te),Br=t_(nt.fixed-k,Q,nt.stretch,et),or=new x(ct,wt),lr=new x(it,wt),Lr=new x(it,Zt),Tr=new x(ct,Zt),Hr=new x(Ot/V,Re/V),Ar=new x(Et/V,Br/V),hn=d*Math.PI/180;if(hn){const Kr=Math.sin(hn),Nn=Math.cos(hn),hi=[Nn,-Kr,Kr,Nn];or._matMult(hi),lr._matMult(hi),Tr._matMult(hi),Lr._matMult(hi)}const Mn=me.stretch+me.fixed,wn=Ie.stretch+Ie.fixed;return{tl:or,tr:lr,bl:Tr,br:Lr,tex:{x:U.paddedRect.x+Xh+Mn,y:U.paddedRect.y+Xh+wn,w:ke.stretch+ke.fixed-Mn,h:nt.stretch+nt.fixed-wn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Hr,pixelOffsetBR:Ar,minFontScaleX:L/V/ae,minFontScaleY:Q/V/de,isSDF:b}};if(C&&(U.stretchX||U.stretchY)){const me=fx(_e,lt,Ge),Ie=fx(Be,Ct,et);for(let ke=0;ke<me.length-1;ke++){const nt=me[ke],ct=me[ke+1];for(let Ot=0;Ot<Ie.length-1;Ot++)R.push(ye(nt,Ie[Ot],ct,Ie[Ot+1]))}}else R.push(ye({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:K+1},{fixed:0,stretch:ee+1}));return R}function Ym(g,d,b){let C=0;for(const R of g)C+=Math.max(d,Math.min(b,R[1]))-Math.max(d,Math.min(b,R[0]));return C}function fx(g,d,b){const C=[{fixed:-Xh,stretch:0}];for(const[R,U]of g){const V=C[C.length-1];C.push({fixed:R-V.stretch,stretch:V.stretch}),C.push({fixed:R-V.stretch,stretch:V.stretch+(U-R)})}return C.push({fixed:d+Xh,stretch:b}),C}function e_(g,d,b,C){return g/d*b+C}function t_(g,d,b,C){return g-d*b/C}class r_{constructor(d,b,C,R,U,V,K,ee,le,_e){var Be;if(this.boxStartIndex=d.length,le){let De=V.top,Ge=V.bottom;const et=V.collisionPadding;et&&(De-=et[1],Ge+=et[3]);let lt=Ge-De;lt>0&&(lt=Math.max(10,lt),this.circleDiameter=lt)}else{const De=!((Be=V.image)===null||Be===void 0)&&Be.content&&(V.image.textFitWidth||V.image.textFitHeight)?zT(V):{x1:V.left,y1:V.top,x2:V.right,y2:V.bottom};De.y1=De.y1*K-ee[0],De.y2=De.y2*K+ee[2],De.x1=De.x1*K-ee[3],De.x2=De.x2*K+ee[1];const Ge=V.collisionPadding;if(Ge&&(De.x1-=Ge[0]*K,De.y1-=Ge[1]*K,De.x2+=Ge[2]*K,De.y2+=Ge[3]*K),_e){const et=new x(De.x1,De.y1),lt=new x(De.x2,De.y1),Ct=new x(De.x1,De.y2),p=new x(De.x2,De.y2),u=_e*Math.PI/180;et._rotate(u),lt._rotate(u),Ct._rotate(u),p._rotate(u),De.x1=Math.min(et.x,lt.x,Ct.x,p.x),De.x2=Math.max(et.x,lt.x,Ct.x,p.x),De.y1=Math.min(et.y,lt.y,Ct.y,p.y),De.y2=Math.max(et.y,lt.y,Ct.y,p.y)}d.emplaceBack(b.x,b.y,De.x1,De.y1,De.x2,De.y2,C,R,U)}this.boxEndIndex=d.length}}class HD{constructor(){let d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:(C,R)=>C<R?-1:C>R?1:0;if(this.data=d,this.length=this.data.length,this.compare=b,this.length>0)for(let C=(this.length>>1)-1;C>=0;C--)this._down(C)}push(d){this.data.push(d),this._up(this.length++)}pop(){if(this.length===0)return;const d=this.data[0],b=this.data.pop();return--this.length>0&&(this.data[0]=b,this._down(0)),d}peek(){return this.data[0]}_up(d){const{data:b,compare:C}=this,R=b[d];for(;d>0;){const U=d-1>>1,V=b[U];if(C(R,V)>=0)break;b[d]=V,d=U}b[d]=R}_down(d){const{data:b,compare:C}=this,R=this.length>>1,U=b[d];for(;d<R;){let V=1+(d<<1);const K=V+1;if(K<this.length&&C(b[K],b[V])<0&&(V=K),C(b[V],U)>=0)break;b[d]=b[V],d=V}b[d]=U}}function XT(g){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,b=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,C=1/0,R=1/0,U=-1/0,V=-1/0;const K=g[0];for(let Ge=0;Ge<K.length;Ge++){const et=K[Ge];(!Ge||et.x<C)&&(C=et.x),(!Ge||et.y<R)&&(R=et.y),(!Ge||et.x>U)&&(U=et.x),(!Ge||et.y>V)&&(V=et.y)}const ee=Math.min(U-C,V-R);let le=ee/2;const _e=new HD([],cA);if(ee===0)return new x(C,R);for(let Ge=C;Ge<U;Ge+=ee)for(let et=R;et<V;et+=ee)_e.push(new QA(Ge+le,et+le,le,g));let Be=function(Ge){let et=0,lt=0,Ct=0;const p=Ge[0];for(let u=0,A=p.length,v=A-1;u<A;v=u++){const M=p[u],L=p[v],k=M.x*L.y-L.x*M.y;lt+=(M.x+L.x)*k,Ct+=(M.y+L.y)*k,et+=3*k}return new QA(lt/et,Ct/et,0,Ge)}(g),De=_e.length;for(;_e.length;){const Ge=_e.pop();(Ge.d>Be.d||!Be.d)&&(Be=Ge,b&&console.log("found best %d after %d probes",Math.round(1e4*Ge.d)/1e4,De)),Ge.max-Be.d<=d||(le=Ge.h/2,_e.push(new QA(Ge.p.x-le,Ge.p.y-le,le,g)),_e.push(new QA(Ge.p.x+le,Ge.p.y-le,le,g)),_e.push(new QA(Ge.p.x-le,Ge.p.y+le,le,g)),_e.push(new QA(Ge.p.x+le,Ge.p.y+le,le,g)),De+=4)}return b&&(console.log(`num probes: ${De}`),console.log(`best distance: ${Be.d}`)),Be.p}function cA(g,d){return d.max-g.max}function QA(g,d,b,C){this.p=new x(g,d),this.h=b,this.d=function(R,U){let V=!1,K=1/0;for(let ee=0;ee<U.length;ee++){const le=U[ee];for(let _e=0,Be=le.length,De=Be-1;_e<Be;De=_e++){const Ge=le[_e],et=le[De];Ge.y>R.y!=et.y>R.y&&R.x<(et.x-Ge.x)*(R.y-Ge.y)/(et.y-Ge.y)+Ge.x&&(V=!V),K=Math.min(K,Tl(R,Ge,et))}}return(V?1:-1)*Math.sqrt(K)}(this.p,C),this.max=this.d+this.h*Math.SQRT2}var nl;a.aq=void 0,(nl=a.aq||(a.aq={}))[nl.center=1]="center",nl[nl.left=2]="left",nl[nl.right=3]="right",nl[nl.top=4]="top",nl[nl.bottom=5]="bottom",nl[nl["top-left"]=6]="top-left",nl[nl["top-right"]=7]="top-right",nl[nl["bottom-left"]=8]="bottom-left",nl[nl["bottom-right"]=9]="bottom-right";const Ff=7,Wy=Number.POSITIVE_INFINITY;function JT(g,d){return d[1]!==Wy?function(b,C,R){let U=0,V=0;switch(C=Math.abs(C),R=Math.abs(R),b){case"top-right":case"top-left":case"top":V=R-Ff;break;case"bottom-right":case"bottom-left":case"bottom":V=-R+Ff}switch(b){case"top-right":case"bottom-right":case"right":U=-C;break;case"top-left":case"bottom-left":case"left":U=C}return[U,V]}(g,d[0],d[1]):function(b,C){let R=0,U=0;C<0&&(C=0);const V=C/Math.SQRT2;switch(b){case"top-right":case"top-left":U=V-Ff;break;case"bottom-right":case"bottom-left":U=-V+Ff;break;case"bottom":U=-C+Ff;break;case"top":U=C-Ff}switch(b){case"top-right":case"bottom-right":R=-V;break;case"top-left":case"bottom-left":R=V;break;case"left":R=C;break;case"right":R=-C}return[R,U]}(g,d[0])}function ZT(g,d,b){var C;const R=g.layout,U=(C=R.get("text-variable-anchor-offset"))===null||C===void 0?void 0:C.evaluate(d,{},b);if(U){const K=U.values,ee=[];for(let le=0;le<K.length;le+=2){const _e=ee[le]=K[le],Be=K[le+1].map(De=>De*na);_e.startsWith("top")?Be[1]-=Ff:_e.startsWith("bottom")&&(Be[1]+=Ff),ee[le+1]=Be}return new Ks(ee)}const V=R.get("text-variable-anchor");if(V){let K;K=g._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[R.get("text-radial-offset").evaluate(d,{},b)*na,Wy]:R.get("text-offset").evaluate(d,{},b).map(le=>le*na);const ee=[];for(const le of V)ee.push(le,JT(le,K));return new Ks(ee)}return null}function Xy(g){switch(g){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function n_(g,d,b,C,R,U,V,K,ee,le,_e){let Be=U.textMaxSize.evaluate(d,{});Be===void 0&&(Be=V);const De=g.layers[0].layout,Ge=De.get("icon-offset").evaluate(d,{},_e),et=i_(b.horizontal),lt=V/24,Ct=g.tilePixelRatio*lt,p=g.tilePixelRatio*Be/24,u=g.tilePixelRatio*K,A=g.tilePixelRatio*De.get("symbol-spacing"),v=De.get("text-padding")*g.tilePixelRatio,M=function(me,Ie,ke){let nt=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;const ct=me.get("icon-padding").evaluate(Ie,{},ke),Ot=ct&&ct.values;return[Ot[0]*nt,Ot[1]*nt,Ot[2]*nt,Ot[3]*nt]}(De,d,_e,g.tilePixelRatio),L=De.get("text-max-angle")/180*Math.PI,k=De.get("text-rotation-alignment")!=="viewport"&&De.get("symbol-placement")!=="point",Q=De.get("icon-rotation-alignment")==="map"&&De.get("symbol-placement")!=="point",q=De.get("symbol-placement"),te=A/2,ae=De.get("icon-text-fit");let de;C&&ae!=="none"&&(g.allowVerticalPlacement&&b.vertical&&(de=HT(C,b.vertical,ae,De.get("icon-text-fit-padding"),Ge,lt)),et&&(C=HT(C,et,ae,De.get("icon-text-fit-padding"),Ge,lt)));const ye=(me,Ie)=>{Ie.x<0||Ie.x>=ti||Ie.y<0||Ie.y>=ti||function(ke,nt,ct,Ot,wt,Re,it,Et,Zt,Br,or,lr,Lr,Tr,Hr,Ar,hn,Mn,wn,Kr,Nn,hi,Yi,ki,Fa){const Mo=ke.addToLineVertexArray(nt,ct);let Ws,es,hs,Ni,Ls=0,Ra=0,Iu=0,fa=0,Kl=-1,Vo=-1;const Xs={};let Aa=Ft("");if(ke.allowVerticalPlacement&&Ot.vertical){const il=Et.layout.get("text-rotate").evaluate(Nn,{},ki)+90;hs=new r_(Zt,nt,Br,or,lr,Ot.vertical,Lr,Tr,Hr,il),it&&(Ni=new r_(Zt,nt,Br,or,lr,it,hn,Mn,Hr,il))}if(wt){const il=Et.layout.get("icon-rotate").evaluate(Nn,{}),jc=Et.layout.get("icon-text-fit")!=="none",qc=dx(wt,il,Yi,jc),_h=it?dx(it,il,Yi,jc):void 0;es=new r_(Zt,nt,Br,or,lr,wt,hn,Mn,!1,il),Ls=4*qc.length;const uA=ke.iconSizeData;let Md=null;uA.kind==="source"?(Md=[Wh*Et.layout.get("icon-size").evaluate(Nn,{})],Md[0]>lA&&tt(`${ke.layerIds[0]}: Value for "icon-size" is >= ${og}. Reduce your "icon-size".`)):uA.kind==="composite"&&(Md=[Wh*hi.compositeIconSizes[0].evaluate(Nn,{},ki),Wh*hi.compositeIconSizes[1].evaluate(Nn,{},ki)],(Md[0]>lA||Md[1]>lA)&&tt(`${ke.layerIds[0]}: Value for "icon-size" is >= ${og}. Reduce your "icon-size".`)),ke.addSymbols(ke.icon,qc,Md,Kr,wn,Nn,a.ah.none,nt,Mo.lineStartIndex,Mo.lineLength,-1,ki),Kl=ke.icon.placedSymbolArray.length-1,_h&&(Ra=4*_h.length,ke.addSymbols(ke.icon,_h,Md,Kr,wn,Nn,a.ah.vertical,nt,Mo.lineStartIndex,Mo.lineLength,-1,ki),Vo=ke.icon.placedSymbolArray.length-1)}const Go=Object.keys(Ot.horizontal);for(const il of Go){const jc=Ot.horizontal[il];if(!Ws){Aa=Ft(jc.text);const _h=Et.layout.get("text-rotate").evaluate(Nn,{},ki);Ws=new r_(Zt,nt,Br,or,lr,jc,Lr,Tr,Hr,_h)}const qc=jc.positionedLines.length===1;if(Iu+=Ax(ke,nt,jc,Re,Et,Hr,Nn,Ar,Mo,Ot.vertical?a.ah.horizontal:a.ah.horizontalOnly,qc?Go:[il],Xs,Kl,hi,ki),qc)break}Ot.vertical&&(fa+=Ax(ke,nt,Ot.vertical,Re,Et,Hr,Nn,Ar,Mo,a.ah.vertical,["vertical"],Xs,Vo,hi,ki));const Js=Ws?Ws.boxStartIndex:ke.collisionBoxArray.length,Zh=Ws?Ws.boxEndIndex:ke.collisionBoxArray.length,Ag=hs?hs.boxStartIndex:ke.collisionBoxArray.length,Yh=hs?hs.boxEndIndex:ke.collisionBoxArray.length,GD=es?es.boxStartIndex:ke.collisionBoxArray.length,pg=es?es.boxEndIndex:ke.collisionBoxArray.length,qA=Ni?Ni.boxStartIndex:ke.collisionBoxArray.length,gg=Ni?Ni.boxEndIndex:ke.collisionBoxArray.length;let Bc=-1;const Rf=(il,jc)=>il&&il.circleDiameter?Math.max(il.circleDiameter,jc):jc;Bc=Rf(Ws,Bc),Bc=Rf(hs,Bc),Bc=Rf(es,Bc),Bc=Rf(Ni,Bc);const gx=Bc>-1?1:0;gx&&(Bc*=Fa/na),ke.glyphOffsetArray.length>=ag.MAX_GLYPHS&&tt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Nn.sortKey!==void 0&&ke.addToSortKeyRanges(ke.symbolInstances.length,Nn.sortKey);const tS=ZT(Et,Nn,ki),[rS,nS]=function(il,jc){const qc=il.length,_h=jc==null?void 0:jc.values;if((_h==null?void 0:_h.length)>0)for(let uA=0;uA<_h.length;uA+=2){const Md=_h[uA+1];il.emplaceBack(a.aq[_h[uA]],Md[0],Md[1])}return[qc,il.length]}(ke.textAnchorOffsets,tS);ke.symbolInstances.emplaceBack(nt.x,nt.y,Xs.right>=0?Xs.right:-1,Xs.center>=0?Xs.center:-1,Xs.left>=0?Xs.left:-1,Xs.vertical||-1,Kl,Vo,Aa,Js,Zh,Ag,Yh,GD,pg,qA,gg,Br,Iu,fa,Ls,Ra,gx,0,Lr,Bc,rS,nS)}(g,Ie,me,b,C,R,de,g.layers[0],g.collisionBoxArray,d.index,d.sourceLayerIndex,g.index,Ct,[v,v,v,v],k,ee,u,M,Q,Ge,d,U,le,_e,V)};if(q==="line")for(const me of lx(d.geometry,0,0,ti,ti)){const Ie=WT(me,A,L,b.vertical||et,C,24,p,g.overscaling,ti);for(const ke of Ie)et&&YT(g,et.text,te,ke)||ye(me,ke)}else if(q==="line-center"){for(const me of d.geometry)if(me.length>1){const Ie=hx(me,L,b.vertical||et,C,24,p);Ie&&ye(me,Ie)}}else if(d.type==="Polygon")for(const me of cc(d.geometry,0)){const Ie=XT(me,16);ye(me[0],new Pf(Ie.x,Ie.y,0))}else if(d.type==="LineString")for(const me of d.geometry)ye(me,new Pf(me[0].x,me[0].y,0));else if(d.type==="Point")for(const me of d.geometry)for(const Ie of me)ye([Ie],new Pf(Ie.x,Ie.y,0))}function Ax(g,d,b,C,R,U,V,K,ee,le,_e,Be,De,Ge,et){const lt=function(u,A,v,M,L,k,Q,q){const te=M.layout.get("text-rotate").evaluate(k,{})*Math.PI/180,ae=[];for(const de of A.positionedLines)for(const ye of de.positionedGlyphs){if(!ye.rect)continue;const me=ye.rect||{};let Ie=Dy+1,ke=!0,nt=1,ct=0;const Ot=(L||q)&&ye.vertical,wt=ye.metrics.advance*ye.scale/2;if(q&&A.verticalizable&&(ct=de.lineOffset/2-(ye.imageName?-(na-ye.metrics.width*ye.scale)/2:(ye.scale-1)*na)),ye.imageName){const Kr=Q[ye.imageName];ke=Kr.sdf,nt=Kr.pixelRatio,Ie=Zi/nt}const Re=L?[ye.x+wt,ye.y]:[0,0];let it=L?[0,0]:[ye.x+wt+v[0],ye.y+v[1]-ct],Et=[0,0];Ot&&(Et=it,it=[0,0]);const Zt=ye.metrics.isDoubleResolution?2:1,Br=(ye.metrics.left-Ie)*ye.scale-wt+it[0],or=(-ye.metrics.top-Ie)*ye.scale+it[1],lr=Br+me.w/Zt*ye.scale/nt,Lr=or+me.h/Zt*ye.scale/nt,Tr=new x(Br,or),Hr=new x(lr,or),Ar=new x(Br,Lr),hn=new x(lr,Lr);if(Ot){const Kr=new x(-wt,wt-zA),Nn=-Math.PI/2,hi=na/2-wt,Yi=new x(5-zA-hi,-(ye.imageName?hi:0)),ki=new x(...Et);Tr._rotateAround(Nn,Kr)._add(Yi)._add(ki),Hr._rotateAround(Nn,Kr)._add(Yi)._add(ki),Ar._rotateAround(Nn,Kr)._add(Yi)._add(ki),hn._rotateAround(Nn,Kr)._add(Yi)._add(ki)}if(te){const Kr=Math.sin(te),Nn=Math.cos(te),hi=[Nn,-Kr,Kr,Nn];Tr._matMult(hi),Hr._matMult(hi),Ar._matMult(hi),hn._matMult(hi)}const Mn=new x(0,0),wn=new x(0,0);ae.push({tl:Tr,tr:Hr,bl:Ar,br:hn,tex:me,writingMode:A.writingMode,glyphOffset:Re,sectionIndex:ye.sectionIndex,isSDF:ke,pixelOffsetTL:Mn,pixelOffsetBR:wn,minFontScaleX:0,minFontScaleY:0})}return ae}(0,b,K,R,U,V,C,g.allowVerticalPlacement),Ct=g.textSizeData;let p=null;Ct.kind==="source"?(p=[Wh*R.layout.get("text-size").evaluate(V,{})],p[0]>lA&&tt(`${g.layerIds[0]}: Value for "text-size" is >= ${og}. Reduce your "text-size".`)):Ct.kind==="composite"&&(p=[Wh*Ge.compositeTextSizes[0].evaluate(V,{},et),Wh*Ge.compositeTextSizes[1].evaluate(V,{},et)],(p[0]>lA||p[1]>lA)&&tt(`${g.layerIds[0]}: Value for "text-size" is >= ${og}. Reduce your "text-size".`)),g.addSymbols(g.text,lt,p,K,U,V,le,d,ee.lineStartIndex,ee.lineLength,De,et);for(const u of _e)Be[u]=g.text.placedSymbolArray.length-1;return 4*lt.length}function i_(g){for(const d in g)return g[d];return null}function YT(g,d,b,C){const R=g.compareText;if(d in R){const U=R[d];for(let V=U.length-1;V>=0;V--)if(C.dist(U[V])<b)return!0}else R[d]=[];return R[d].push(C),!1}const s_=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class dg{static from(d){if(!(d instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[b,C]=new Uint8Array(d,0,2);if(b!==219)throw new Error("Data does not appear to be in a KDBush format.");const R=C>>4;if(R!==1)throw new Error(`Got v${R} data when expected v1.`);const U=s_[15&C];if(!U)throw new Error("Unrecognized array type.");const[V]=new Uint16Array(d,2,1),[K]=new Uint32Array(d,4,1);return new dg(K,V,U,d)}constructor(d){let b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:64,C=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Float64Array,R=arguments.length>3?arguments[3]:void 0;if(isNaN(d)||d<0)throw new Error(`Unpexpected numItems value: ${d}.`);this.numItems=+d,this.nodeSize=Math.min(Math.max(+b,2),65535),this.ArrayType=C,this.IndexArrayType=d<65536?Uint16Array:Uint32Array;const U=s_.indexOf(this.ArrayType),V=2*d*this.ArrayType.BYTES_PER_ELEMENT,K=d*this.IndexArrayType.BYTES_PER_ELEMENT,ee=(8-K%8)%8;if(U<0)throw new Error(`Unexpected typed array class: ${C}.`);R&&R instanceof ArrayBuffer?(this.data=R,this.ids=new this.IndexArrayType(this.data,8,d),this.coords=new this.ArrayType(this.data,8+K+ee,2*d),this._pos=2*d,this._finished=!0):(this.data=new ArrayBuffer(8+V+K+ee),this.ids=new this.IndexArrayType(this.data,8,d),this.coords=new this.ArrayType(this.data,8+K+ee,2*d),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+U]),new Uint16Array(this.data,2,1)[0]=b,new Uint32Array(this.data,4,1)[0]=d)}add(d,b){const C=this._pos>>1;return this.ids[C]=C,this.coords[this._pos++]=d,this.coords[this._pos++]=b,C}finish(){const d=this._pos>>1;if(d!==this.numItems)throw new Error(`Added ${d} items when expected ${this.numItems}.`);return fg(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(d,b,C,R){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:U,coords:V,nodeSize:K}=this,ee=[0,U.length-1,0],le=[];for(;ee.length;){const _e=ee.pop()||0,Be=ee.pop()||0,De=ee.pop()||0;if(Be-De<=K){for(let Ct=De;Ct<=Be;Ct++){const p=V[2*Ct],u=V[2*Ct+1];p>=d&&p<=C&&u>=b&&u<=R&&le.push(U[Ct])}continue}const Ge=De+Be>>1,et=V[2*Ge],lt=V[2*Ge+1];et>=d&&et<=C&&lt>=b&&lt<=R&&le.push(U[Ge]),(_e===0?d<=et:b<=lt)&&(ee.push(De),ee.push(Ge-1),ee.push(1-_e)),(_e===0?C>=et:R>=lt)&&(ee.push(Ge+1),ee.push(Be),ee.push(1-_e))}return le}within(d,b,C){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:R,coords:U,nodeSize:V}=this,K=[0,R.length-1,0],ee=[],le=C*C;for(;K.length;){const _e=K.pop()||0,Be=K.pop()||0,De=K.pop()||0;if(Be-De<=V){for(let Ct=De;Ct<=Be;Ct++)$A(U[2*Ct],U[2*Ct+1],d,b)<=le&&ee.push(R[Ct]);continue}const Ge=De+Be>>1,et=U[2*Ge],lt=U[2*Ge+1];$A(et,lt,d,b)<=le&&ee.push(R[Ge]),(_e===0?d-C<=et:b-C<=lt)&&(K.push(De),K.push(Ge-1),K.push(1-_e)),(_e===0?d+C>=et:b+C>=lt)&&(K.push(Ge+1),K.push(Be),K.push(1-_e))}return ee}}function fg(g,d,b,C,R,U){if(R-C<=b)return;const V=C+R>>1;eS(g,d,V,C,R,U),fg(g,d,b,C,V-1,1-U),fg(g,d,b,V+1,R,1-U)}function eS(g,d,b,C,R,U){for(;R>C;){if(R-C>600){const le=R-C+1,_e=b-C+1,Be=Math.log(le),De=.5*Math.exp(2*Be/3),Ge=.5*Math.sqrt(Be*De*(le-De)/le)*(_e-le/2<0?-1:1);eS(g,d,b,Math.max(C,Math.floor(b-_e*De/le+Ge)),Math.min(R,Math.floor(b+(le-_e)*De/le+Ge)),U)}const V=d[2*b+U];let K=C,ee=R;for(o_(g,d,C,b),d[2*R+U]>V&&o_(g,d,C,R);K<ee;){for(o_(g,d,K,ee),K++,ee--;d[2*K+U]<V;)K++;for(;d[2*ee+U]>V;)ee--}d[2*C+U]===V?o_(g,d,C,ee):(ee++,o_(g,d,ee,R)),ee<=b&&(C=ee+1),b<=ee&&(R=ee-1)}}function o_(g,d,b,C){px(g,b,C),px(d,2*b,2*C),px(d,2*b+1,2*C+1)}function px(g,d,b){const C=g[d];g[d]=g[b],g[b]=C}function $A(g,d,b,C){const R=g-b,U=d-C;return R*R+U*U}var Pa;a.bg=void 0,(Pa=a.bg||(a.bg={})).create="create",Pa.load="load",Pa.fullLoad="fullLoad";let Jh=null,jA=[];const Jy=1e3/60,Zy="loadTime",a_="fullLoadTime",VD={mark(g){performance.mark(g)},frame(g){const d=g;Jh!=null&&jA.push(d-Jh),Jh=d},clearMetrics(){Jh=null,jA=[],performance.clearMeasures(Zy),performance.clearMeasures(a_);for(const g in a.bg)performance.clearMarks(a.bg[g])},getPerformanceMetrics(){performance.measure(Zy,a.bg.create,a.bg.load),performance.measure(a_,a.bg.create,a.bg.fullLoad);const g=performance.getEntriesByName(Zy)[0].duration,d=performance.getEntriesByName(a_)[0].duration,b=jA.length,C=1/(jA.reduce((U,V)=>U+V,0)/b/1e3),R=jA.filter(U=>U>Jy).reduce((U,V)=>U+(V-Jy)/Jy,0);return{loadTime:g,fullLoadTime:d,fps:C,percentDroppedFrames:R/(b+R)*100,totalFrames:b}}};a.$=class extends he{},a.A=Tu,a.B=Bd,a.C=function(g){if(Vt==null){const d=g.navigator?g.navigator.userAgent:null;Vt=!!g.safari||!(!d||!(/\b(iPad|iPhone|iPod)\b/.test(d)||d.match("Safari")&&!d.match("Chrome")))}return Vt},a.D=vn,a.E=pr,a.F=class{constructor(g,d){this.target=g,this.mapId=d,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new zD(()=>this.process()),this.subscription=function(b,C,R,U){return b.addEventListener(C,R,!1),{unsubscribe:()=>{b.removeEventListener(C,R,!1)}}}(this.target,"message",b=>this.receive(b)),this.globalScope=Ht(self)?g:window}registerMessageHandler(g,d){this.messageHandlers[g]=d}sendAsync(g,d){return new Promise((b,C)=>{const R=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[R]={resolve:b,reject:C},d&&d.signal.addEventListener("abort",()=>{delete this.resolveRejects[R];const K={id:R,type:"<cancel>",origin:location.origin,targetMapId:g.targetMapId,sourceMapId:this.mapId};this.target.postMessage(K)},{once:!0});const U=[],V=Object.assign(Object.assign({},g),{id:R,sourceMapId:this.mapId,origin:location.origin,data:Vu(g.data,U)});this.target.postMessage(V,{transfer:U})})}receive(g){const d=g.data,b=d.id;if(!(d.origin!=="file://"&&location.origin!=="file://"&&d.origin!=="resource://android"&&location.origin!=="resource://android"&&d.origin!==location.origin||d.targetMapId&&this.mapId!==d.targetMapId)){if(d.type==="<cancel>"){delete this.tasks[b];const C=this.abortControllers[b];return delete this.abortControllers[b],void(C&&C.abort())}if(Ht(self)||d.mustQueue)return this.tasks[b]=d,this.taskQueue.push(b),void this.invoker.trigger();this.processTask(b,d)}}process(){if(this.taskQueue.length===0)return;const g=this.taskQueue.shift(),d=this.tasks[g];delete this.tasks[g],this.taskQueue.length>0&&this.invoker.trigger(),d&&this.processTask(g,d)}processTask(g,d){return o(this,void 0,void 0,function*(){if(d.type==="<response>"){const R=this.resolveRejects[g];return delete this.resolveRejects[g],R?void(d.error?R.reject(xu(d.error)):R.resolve(xu(d.data))):void 0}if(!this.messageHandlers[d.type])return void this.completeTask(g,new Error(`Could not find a registered handler for ${d.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const b=xu(d.data),C=new AbortController;this.abortControllers[g]=C;try{const R=yield this.messageHandlers[d.type](d.sourceMapId,b,C);this.completeTask(g,null,R)}catch(R){this.completeTask(g,R)}})}completeTask(g,d,b){const C=[];delete this.abortControllers[g];const R={id:g,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:d?Vu(d):null,data:Vu(b,C)};this.target.postMessage(R,{transfer:C})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},a.G=jt,a.H=function(){var g=new Tu(16);return Tu!=Float32Array&&(g[1]=0,g[2]=0,g[3]=0,g[4]=0,g[6]=0,g[7]=0,g[8]=0,g[9]=0,g[11]=0,g[12]=0,g[13]=0,g[14]=0),g[0]=1,g[5]=1,g[10]=1,g[15]=1,g},a.I=Wm,a.J=function(g,d,b){var C,R,U,V,K,ee,le,_e,Be,De,Ge,et,lt=b[0],Ct=b[1],p=b[2];return d===g?(g[12]=d[0]*lt+d[4]*Ct+d[8]*p+d[12],g[13]=d[1]*lt+d[5]*Ct+d[9]*p+d[13],g[14]=d[2]*lt+d[6]*Ct+d[10]*p+d[14],g[15]=d[3]*lt+d[7]*Ct+d[11]*p+d[15]):(R=d[1],U=d[2],V=d[3],K=d[4],ee=d[5],le=d[6],_e=d[7],Be=d[8],De=d[9],Ge=d[10],et=d[11],g[0]=C=d[0],g[1]=R,g[2]=U,g[3]=V,g[4]=K,g[5]=ee,g[6]=le,g[7]=_e,g[8]=Be,g[9]=De,g[10]=Ge,g[11]=et,g[12]=C*lt+K*Ct+Be*p+d[12],g[13]=R*lt+ee*Ct+De*p+d[13],g[14]=U*lt+le*Ct+Ge*p+d[14],g[15]=V*lt+_e*Ct+et*p+d[15]),g},a.K=function(g,d,b){var C=b[0],R=b[1],U=b[2];return g[0]=d[0]*C,g[1]=d[1]*C,g[2]=d[2]*C,g[3]=d[3]*C,g[4]=d[4]*R,g[5]=d[5]*R,g[6]=d[6]*R,g[7]=d[7]*R,g[8]=d[8]*U,g[9]=d[9]*U,g[10]=d[10]*U,g[11]=d[11]*U,g[12]=d[12],g[13]=d[13],g[14]=d[14],g[15]=d[15],g},a.L=qh,a.M=function(g,d){const b={};for(let C=0;C<d.length;C++){const R=d[C];R in g&&(b[R]=g[R])}return b},a.N=Id,a.O=rx,a.P=x,a.Q=jy,a.R=$u,a.S=Ku,a.T=bc,a.U=Y,a.V=ie,a.W=er,a.X=ti,a.Y=H,a.Z=ug,a._=o,a.a=Bt,a.a$=function(g,d){var b=g[0],C=g[1],R=g[2],U=g[3],V=g[4],K=g[5],ee=g[6],le=g[7],_e=g[8],Be=g[9],De=g[10],Ge=g[11],et=g[12],lt=g[13],Ct=g[14],p=g[15],u=d[0],A=d[1],v=d[2],M=d[3],L=d[4],k=d[5],Q=d[6],q=d[7],te=d[8],ae=d[9],de=d[10],ye=d[11],me=d[12],Ie=d[13],ke=d[14],nt=d[15];return Math.abs(b-u)<=rl*Math.max(1,Math.abs(b),Math.abs(u))&&Math.abs(C-A)<=rl*Math.max(1,Math.abs(C),Math.abs(A))&&Math.abs(R-v)<=rl*Math.max(1,Math.abs(R),Math.abs(v))&&Math.abs(U-M)<=rl*Math.max(1,Math.abs(U),Math.abs(M))&&Math.abs(V-L)<=rl*Math.max(1,Math.abs(V),Math.abs(L))&&Math.abs(K-k)<=rl*Math.max(1,Math.abs(K),Math.abs(k))&&Math.abs(ee-Q)<=rl*Math.max(1,Math.abs(ee),Math.abs(Q))&&Math.abs(le-q)<=rl*Math.max(1,Math.abs(le),Math.abs(q))&&Math.abs(_e-te)<=rl*Math.max(1,Math.abs(_e),Math.abs(te))&&Math.abs(Be-ae)<=rl*Math.max(1,Math.abs(Be),Math.abs(ae))&&Math.abs(De-de)<=rl*Math.max(1,Math.abs(De),Math.abs(de))&&Math.abs(Ge-ye)<=rl*Math.max(1,Math.abs(Ge),Math.abs(ye))&&Math.abs(et-me)<=rl*Math.max(1,Math.abs(et),Math.abs(me))&&Math.abs(lt-Ie)<=rl*Math.max(1,Math.abs(lt),Math.abs(Ie))&&Math.abs(Ct-ke)<=rl*Math.max(1,Math.abs(Ct),Math.abs(ke))&&Math.abs(p-nt)<=rl*Math.max(1,Math.abs(p),Math.abs(nt))},a.a0=pe,a.a1=ix,a.a2=br,a.a3=g=>{const d=window.document.createElement("video");return d.muted=!0,new Promise(b=>{d.onloadstart=()=>{b(d)};for(const C of g){const R=window.document.createElement("source");$r(C)||(d.crossOrigin="Anonymous"),R.src=C,d.appendChild(R)}})},a.a4=function(){return Ue++},a.a5=jr,a.a6=ag,a.a7=Yo,a.a8=Bs,a.a9=qy,a.aA=function(g){if(g.type==="custom")return new ex(g);switch(g.type){case"background":return new Yv(g);case"circle":return new Rm(g);case"fill":return new Um(g);case"fill-extrusion":return new bT(g);case"heatmap":return new xy(g);case"hillshade":return new vD(g);case"line":return new BT(g);case"raster":return new $y(g);case"symbol":return new qu(g)}},a.aB=Le,a.aC=function(g,d){if(!g)return[{command:"setStyle",args:[d]}];let b=[];try{if(!mr(g.version,d.version))return[{command:"setStyle",args:[d]}];mr(g.center,d.center)||b.push({command:"setCenter",args:[d.center]}),mr(g.zoom,d.zoom)||b.push({command:"setZoom",args:[d.zoom]}),mr(g.bearing,d.bearing)||b.push({command:"setBearing",args:[d.bearing]}),mr(g.pitch,d.pitch)||b.push({command:"setPitch",args:[d.pitch]}),mr(g.sprite,d.sprite)||b.push({command:"setSprite",args:[d.sprite]}),mr(g.glyphs,d.glyphs)||b.push({command:"setGlyphs",args:[d.glyphs]}),mr(g.transition,d.transition)||b.push({command:"setTransition",args:[d.transition]}),mr(g.light,d.light)||b.push({command:"setLight",args:[d.light]}),mr(g.terrain,d.terrain)||b.push({command:"setTerrain",args:[d.terrain]}),mr(g.sky,d.sky)||b.push({command:"setSky",args:[d.sky]}),mr(g.projection,d.projection)||b.push({command:"setProjection",args:[d.projection]});const C={},R=[];(function(V,K,ee,le){let _e;for(_e in K=K||{},V=V||{})Object.prototype.hasOwnProperty.call(V,_e)&&(Object.prototype.hasOwnProperty.call(K,_e)||Wr(_e,ee,le));for(_e in K)Object.prototype.hasOwnProperty.call(K,_e)&&(Object.prototype.hasOwnProperty.call(V,_e)?mr(V[_e],K[_e])||(V[_e].type==="geojson"&&K[_e].type==="geojson"&&Bn(V,K,_e)?Mr(ee,{command:"setGeoJSONSourceData",args:[_e,K[_e].data]}):gn(_e,K,ee,le)):en(_e,K,ee))})(g.sources,d.sources,R,C);const U=[];g.layers&&g.layers.forEach(V=>{"source"in V&&C[V.source]?b.push({command:"removeLayer",args:[V.id]}):U.push(V)}),b=b.concat(R),function(V,K,ee){K=K||[];const le=(V=V||[]).map($n),_e=K.map($n),Be=V.reduce(ei,{}),De=K.reduce(ei,{}),Ge=le.slice(),et=Object.create(null);let lt,Ct,p,u,A;for(let v=0,M=0;v<le.length;v++)lt=le[v],Object.prototype.hasOwnProperty.call(De,lt)?M++:(Mr(ee,{command:"removeLayer",args:[lt]}),Ge.splice(Ge.indexOf(lt,M),1));for(let v=0,M=0;v<_e.length;v++)lt=_e[_e.length-1-v],Ge[Ge.length-1-v]!==lt&&(Object.prototype.hasOwnProperty.call(Be,lt)?(Mr(ee,{command:"removeLayer",args:[lt]}),Ge.splice(Ge.lastIndexOf(lt,Ge.length-M),1)):M++,u=Ge[Ge.length-v],Mr(ee,{command:"addLayer",args:[De[lt],u]}),Ge.splice(Ge.length-v,0,lt),et[lt]=!0);for(let v=0;v<_e.length;v++)if(lt=_e[v],Ct=Be[lt],p=De[lt],!et[lt]&&!mr(Ct,p))if(mr(Ct.source,p.source)&&mr(Ct["source-layer"],p["source-layer"])&&mr(Ct.type,p.type)){for(A in Fn(Ct.layout,p.layout,ee,lt,null,"setLayoutProperty"),Fn(Ct.paint,p.paint,ee,lt,null,"setPaintProperty"),mr(Ct.filter,p.filter)||Mr(ee,{command:"setFilter",args:[lt,p.filter]}),mr(Ct.minzoom,p.minzoom)&&mr(Ct.maxzoom,p.maxzoom)||Mr(ee,{command:"setLayerZoomRange",args:[lt,p.minzoom,p.maxzoom]}),Ct)Object.prototype.hasOwnProperty.call(Ct,A)&&A!=="layout"&&A!=="paint"&&A!=="filter"&&A!=="metadata"&&A!=="minzoom"&&A!=="maxzoom"&&(A.indexOf("paint.")===0?Fn(Ct[A],p[A],ee,lt,A.slice(6),"setPaintProperty"):mr(Ct[A],p[A])||Mr(ee,{command:"setLayerProperty",args:[lt,A,p[A]]}));for(A in p)Object.prototype.hasOwnProperty.call(p,A)&&!Object.prototype.hasOwnProperty.call(Ct,A)&&A!=="layout"&&A!=="paint"&&A!=="filter"&&A!=="metadata"&&A!=="minzoom"&&A!=="maxzoom"&&(A.indexOf("paint.")===0?Fn(Ct[A],p[A],ee,lt,A.slice(6),"setPaintProperty"):mr(Ct[A],p[A])||Mr(ee,{command:"setLayerProperty",args:[lt,A,p[A]]}))}else Mr(ee,{command:"removeLayer",args:[lt]}),u=Ge[Ge.lastIndexOf(lt)+1],Mr(ee,{command:"addLayer",args:[p,u]})}(U,d.layers,b)}catch(C){console.warn("Unable to compute style diff:",C),b=[{command:"setStyle",args:[d]}]}return b},a.aD=function(g){const d=[],b=g.id;return b===void 0&&d.push({message:`layers.${b}: missing required property "id"`}),g.render===void 0&&d.push({message:`layers.${b}: missing required method "render"`}),g.renderingMode&&g.renderingMode!=="2d"&&g.renderingMode!=="3d"&&d.push({message:`layers.${b}: property "renderingMode" must be either "2d" or "3d"`}),d},a.aE=function g(d,b){if(Array.isArray(d)){if(!Array.isArray(b)||d.length!==b.length)return!1;for(let C=0;C<d.length;C++)if(!g(d[C],b[C]))return!1;return!0}if(typeof d=="object"&&d!==null&&b!==null){if(typeof b!="object"||Object.keys(d).length!==Object.keys(b).length)return!1;for(const C in d)if(!g(d[C],b[C]))return!1;return!0}return d===b},a.aF=st,a.aG=at,a.aH=class extends ir{constructor(g,d){super(g,d),this.current=0}set(g){this.current!==g&&(this.current=g,this.gl.uniform1i(this.location,g))}},a.aI=sr,a.aJ=class extends ir{constructor(g,d){super(g,d),this.current=fr}set(g){if(g[12]!==this.current[12]||g[0]!==this.current[0])return this.current=g,void this.gl.uniformMatrix4fv(this.location,!1,g);for(let d=1;d<16;d++)if(g[d]!==this.current[d]){this.current=g,this.gl.uniformMatrix4fv(this.location,!1,g);break}}},a.aK=gr,a.aL=Er,a.aM=On,a.aN=class extends ir{constructor(g,d){super(g,d),this.current=[0,0,0]}set(g){g[0]===this.current[0]&&g[1]===this.current[1]&&g[2]===this.current[2]||(this.current=g,this.gl.uniform3f(this.location,g[0],g[1],g[2]))}},a.aO=class extends ir{constructor(g,d){super(g,d),this.current=[0,0]}set(g){g[0]===this.current[0]&&g[1]===this.current[1]||(this.current=g,this.gl.uniform2f(this.location,g[0],g[1]))}},a.aP=function(g,d,b,C,R,U,V){var K=1/(d-b),ee=1/(C-R),le=1/(U-V);return g[0]=-2*K,g[1]=0,g[2]=0,g[3]=0,g[4]=0,g[5]=-2*ee,g[6]=0,g[7]=0,g[8]=0,g[9]=0,g[10]=2*le,g[11]=0,g[12]=(d+b)*K,g[13]=(R+C)*ee,g[14]=(V+U)*le,g[15]=1,g},a.aQ=$p,a.aR=class extends vt{},a.aS=FD,a.aT=class extends It{},a.aU=Wp,a.aV=function(g){return g<=1?1:Math.pow(2,Math.ceil(Math.log(g)/Math.LN2))},a.aW=Kp,a.aX=us,a.aY=G,a.aZ=class extends Vr{},a.a_=function(g,d){return g[0]===d[0]&&g[1]===d[1]&&g[2]===d[2]&&g[3]===d[3]&&g[4]===d[4]&&g[5]===d[5]&&g[6]===d[6]&&g[7]===d[7]&&g[8]===d[8]&&g[9]===d[9]&&g[10]===d[10]&&g[11]===d[11]&&g[12]===d[12]&&g[13]===d[13]&&g[14]===d[14]&&g[15]===d[15]},a.aa=function(g){const d={};if(g.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(b,C,R,U)=>{const V=R||U;return d[C]=!V||V.toLowerCase(),""}),d["max-age"]){const b=parseInt(d["max-age"],10);isNaN(b)?delete d["max-age"]:d["max-age"]=b}return d},a.ab=function(g,d){const b=[];for(const C in g)C in d||b.push(C);return b},a.ac=ve,a.ad=function(g,d,b){var C=Math.sin(b),R=Math.cos(b),U=d[0],V=d[1],K=d[2],ee=d[3],le=d[4],_e=d[5],Be=d[6],De=d[7];return d!==g&&(g[8]=d[8],g[9]=d[9],g[10]=d[10],g[11]=d[11],g[12]=d[12],g[13]=d[13],g[14]=d[14],g[15]=d[15]),g[0]=U*R+le*C,g[1]=V*R+_e*C,g[2]=K*R+Be*C,g[3]=ee*R+De*C,g[4]=le*R-U*C,g[5]=_e*R-V*C,g[6]=Be*R-K*C,g[7]=De*R-ee*C,g},a.ae=function(g){var d=new Tu(16);return d[0]=g[0],d[1]=g[1],d[2]=g[2],d[3]=g[3],d[4]=g[4],d[5]=g[5],d[6]=g[6],d[7]=g[7],d[8]=g[8],d[9]=g[9],d[10]=g[10],d[11]=g[11],d[12]=g[12],d[13]=g[13],d[14]=g[14],d[15]=g[15],d},a.af=oA,a.ag=function(g,d){let b=0,C=0;if(g.kind==="constant")C=g.layoutSize;else if(g.kind!=="source"){const{interpolationType:R,minZoom:U,maxZoom:V}=g,K=R?ve(Dn.interpolationFactor(R,d,U,V),0,1):0;g.kind==="camera"?C=ps.number(g.minSize,g.maxSize,K):b=K}return{uSizeT:b,uSize:C}},a.ai=function(g,d,b){let{uSize:C,uSizeT:R}=d,{lowerSize:U,upperSize:V}=b;return g.kind==="source"?U/Wh:g.kind==="composite"?ps.number(U/Wh,V/Wh,R):C},a.aj=Gy,a.ak=function(g,d,b,C){const R=d.y-g.y,U=d.x-g.x,V=C.y-b.y,K=C.x-b.x,ee=V*U-K*R;if(ee===0)return null;const le=(K*(g.y-b.y)-V*(g.x-b.x))/ee;return new x(g.x+le*U,g.y+le*R)},a.al=lx,a.am=jl,a.an=jh,a.ao=function(g){let d=1/0,b=1/0,C=-1/0,R=-1/0;for(const U of g)d=Math.min(d,U.x),b=Math.min(b,U.y),C=Math.max(C,U.x),R=Math.max(R,U.y);return[d,b,C,R]},a.ap=na,a.ar=Hy,a.as=function(g,d){var b=d[0],C=d[1],R=d[2],U=d[3],V=d[4],K=d[5],ee=d[6],le=d[7],_e=d[8],Be=d[9],De=d[10],Ge=d[11],et=d[12],lt=d[13],Ct=d[14],p=d[15],u=b*K-C*V,A=b*ee-R*V,v=b*le-U*V,M=C*ee-R*K,L=C*le-U*K,k=R*le-U*ee,Q=_e*lt-Be*et,q=_e*Ct-De*et,te=_e*p-Ge*et,ae=Be*Ct-De*lt,de=Be*p-Ge*lt,ye=De*p-Ge*Ct,me=u*ye-A*de+v*ae+M*te-L*q+k*Q;return me?(g[0]=(K*ye-ee*de+le*ae)*(me=1/me),g[1]=(R*de-C*ye-U*ae)*me,g[2]=(lt*k-Ct*L+p*M)*me,g[3]=(De*L-Be*k-Ge*M)*me,g[4]=(ee*te-V*ye-le*q)*me,g[5]=(b*ye-R*te+U*q)*me,g[6]=(Ct*v-et*k-p*A)*me,g[7]=(_e*k-De*v+Ge*A)*me,g[8]=(V*de-K*te+le*Q)*me,g[9]=(C*te-b*de-U*Q)*me,g[10]=(et*L-lt*v+p*u)*me,g[11]=(Be*v-_e*L-Ge*u)*me,g[12]=(K*q-V*ae-ee*Q)*me,g[13]=(b*ae-C*q+R*Q)*me,g[14]=(lt*A-et*M-Ct*u)*me,g[15]=(_e*M-Be*A+De*u)*me,g):null},a.at=Xy,a.au=aA,a.av=dg,a.aw=function(){const g={},d=We.$version;for(const b in We.$root){const C=We.$root[b];if(C.required){let R=null;R=b==="version"?d:C.type==="array"?[]:{},R!=null&&(g[b]=R)}}return g},a.ax=$l,a.ay=nr,a.az=function(g){g=g.slice();const d=Object.create(null);for(let b=0;b<g.length;b++)d[g[b].id]=g[b];for(let b=0;b<g.length;b++)"ref"in g[b]&&(g[b]=mn(g[b],d[g[b].ref]));return g},a.b=Jt,a.b0=function(g,d){return g[0]=d[0],g[1]=d[1],g[2]=d[2],g[3]=d[3],g[4]=d[4],g[5]=d[5],g[6]=d[6],g[7]=d[7],g[8]=d[8],g[9]=d[9],g[10]=d[10],g[11]=d[11],g[12]=d[12],g[13]=d[13],g[14]=d[14],g[15]=d[15],g},a.b1=function(g,d,b){return g[0]=d[0]*b[0],g[1]=d[1]*b[1],g[2]=d[2]*b[2],g[3]=d[3]*b[3],g},a.b2=function(g,d){return g[0]*d[0]+g[1]*d[1]+g[2]*d[2]+g[3]*d[3]},a.b3=be,a.b4=sx,a.b5=nx,a.b6=function(g,d,b,C,R){var U,V=1/Math.tan(d/2);return g[0]=V/b,g[1]=0,g[2]=0,g[3]=0,g[4]=0,g[5]=V,g[6]=0,g[7]=0,g[8]=0,g[9]=0,g[11]=-1,g[12]=0,g[13]=0,g[15]=0,R!=null&&R!==1/0?(g[10]=(R+C)*(U=1/(C-R)),g[14]=2*R*C*U):(g[10]=-1,g[14]=-2*C),g},a.b7=function(g,d,b){var C=Math.sin(b),R=Math.cos(b),U=d[4],V=d[5],K=d[6],ee=d[7],le=d[8],_e=d[9],Be=d[10],De=d[11];return d!==g&&(g[0]=d[0],g[1]=d[1],g[2]=d[2],g[3]=d[3],g[12]=d[12],g[13]=d[13],g[14]=d[14],g[15]=d[15]),g[4]=U*R+le*C,g[5]=V*R+_e*C,g[6]=K*R+Be*C,g[7]=ee*R+De*C,g[8]=le*R-U*C,g[9]=_e*R-V*C,g[10]=Be*R-K*C,g[11]=De*R-ee*C,g},a.b8=ce,a.b9=fe,a.bA=CT,a.bB=function(g){return g.message===$e},a.bC=Eo,a.bD=_o,a.ba=function(g){return g*Math.PI/180},a.bb=function(g,d){const{x:b,y:C}=ug.fromLngLat(d);return!(g<0||g>25||C<0||C>=1||b<0||b>=1)},a.bc=function(g,d){return g[0]=d[0],g[1]=0,g[2]=0,g[3]=0,g[4]=0,g[5]=d[1],g[6]=0,g[7]=0,g[8]=0,g[9]=0,g[10]=d[2],g[11]=0,g[12]=0,g[13]=0,g[14]=0,g[15]=1,g},a.bd=class extends se{},a.be=Jm,a.bf=VD,a.bh=qt,a.bi=function(g,d){Bt.REGISTERED_PROTOCOLS[g]=d},a.bj=function(g){delete Bt.REGISTERED_PROTOCOLS[g]},a.bk=function(g,d){const b={};for(let R=0;R<g.length;R++){const U=d&&d[g[R].id]||vf(g[R]);d&&(d[g[R].id]=U);let V=b[U];V||(V=b[U]=[]),V.push(g[R])}const C=[];for(const R in b)C.push(b[R]);return C},a.bl=pn,a.bm=qT,a.bn=Mf,a.bo=kT,a.bp=function(g){g.bucket.createArrays(),g.bucket.tilePixelRatio=ti/(512*g.bucket.overscaling),g.bucket.compareText={},g.bucket.iconsNeedLinear=!1;const d=g.bucket.layers[0],b=d.layout,C=d._unevaluatedLayout._values,R={layoutIconSize:C["icon-size"].possiblyEvaluate(new Fi(g.bucket.zoom+1),g.canonical),layoutTextSize:C["text-size"].possiblyEvaluate(new Fi(g.bucket.zoom+1),g.canonical),textMaxSize:C["text-size"].possiblyEvaluate(new Fi(18))};if(g.bucket.textSizeData.kind==="composite"){const{minZoom:le,maxZoom:_e}=g.bucket.textSizeData;R.compositeTextSizes=[C["text-size"].possiblyEvaluate(new Fi(le),g.canonical),C["text-size"].possiblyEvaluate(new Fi(_e),g.canonical)]}if(g.bucket.iconSizeData.kind==="composite"){const{minZoom:le,maxZoom:_e}=g.bucket.iconSizeData;R.compositeIconSizes=[C["icon-size"].possiblyEvaluate(new Fi(le),g.canonical),C["icon-size"].possiblyEvaluate(new Fi(_e),g.canonical)]}const U=b.get("text-line-height")*na,V=b.get("text-rotation-alignment")!=="viewport"&&b.get("symbol-placement")!=="point",K=b.get("text-keep-upright"),ee=b.get("text-size");for(const le of g.bucket.features){const _e=b.get("text-font").evaluate(le,{},g.canonical).join(","),Be=ee.evaluate(le,{},g.canonical),De=R.layoutTextSize.evaluate(le,{},g.canonical),Ge=R.layoutIconSize.evaluate(le,{},g.canonical),et={horizontal:{},vertical:void 0},lt=le.text;let Ct,p=[0,0];if(lt){const v=lt.toString(),M=b.get("text-letter-spacing").evaluate(le,{},g.canonical)*na,L=mh(v)?M:0,k=b.get("text-anchor").evaluate(le,{},g.canonical),Q=ZT(d,le,g.canonical);if(!Q){const de=b.get("text-radial-offset").evaluate(le,{},g.canonical);p=de?JT(k,[de*na,Wy]):b.get("text-offset").evaluate(le,{},g.canonical).map(ye=>ye*na)}let q=V?"center":b.get("text-justify").evaluate(le,{},g.canonical);const te=b.get("symbol-placement")==="point"?b.get("text-max-width").evaluate(le,{},g.canonical)*na:1/0,ae=()=>{g.bucket.allowVerticalPlacement&&Gu(v)&&(et.vertical=Oy(lt,g.glyphMap,g.glyphPositions,g.imagePositions,_e,te,U,k,"left",L,p,a.ah.vertical,!0,De,Be))};if(!V&&Q){const de=new Set;if(q==="auto")for(let me=0;me<Q.values.length;me+=2)de.add(Xy(Q.values[me]));else de.add(q);let ye=!1;for(const me of de)if(!et.horizontal[me])if(ye)et.horizontal[me]=et.horizontal[0];else{const Ie=Oy(lt,g.glyphMap,g.glyphPositions,g.imagePositions,_e,te,U,"center",me,L,p,a.ah.horizontal,!1,De,Be);Ie&&(et.horizontal[me]=Ie,ye=Ie.positionedLines.length===1)}ae()}else{q==="auto"&&(q=Xy(k));const de=Oy(lt,g.glyphMap,g.glyphPositions,g.imagePositions,_e,te,U,k,q,L,p,a.ah.horizontal,!1,De,Be);de&&(et.horizontal[q]=de),ae(),Gu(v)&&V&&K&&(et.vertical=Oy(lt,g.glyphMap,g.glyphPositions,g.imagePositions,_e,te,U,k,q,L,p,a.ah.vertical,!1,De,Be))}}let u=!1;if(le.icon&&le.icon.name){const v=g.imageMap[le.icon.name];v&&(Ct=zy(g.imagePositions[le.icon.name],b.get("icon-offset").evaluate(le,{},g.canonical),b.get("icon-anchor").evaluate(le,{},g.canonical)),u=!!v.sdf,g.bucket.sdfIcons===void 0?g.bucket.sdfIcons=u:g.bucket.sdfIcons!==u&&tt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(v.pixelRatio!==g.bucket.pixelRatio||b.get("icon-rotate").constantOr(1)!==0)&&(g.bucket.iconsNeedLinear=!0))}const A=i_(et.horizontal)||et.vertical;g.bucket.iconsInText=!!A&&A.iconsInText,(A||Ct)&&n_(g.bucket,le,et,Ct,g.imageMap,R,De,Ge,p,u,g.canonical)}g.showCollisionBoxes&&g.bucket.generateCollisionDebugBuffers()},a.bq=Qm,a.br=Dv,a.bs=Ov,a.bt=Cf,a.bu=Ly,a.bv=class{constructor(g){this._marks={start:[g.url,"start"].join("#"),end:[g.url,"end"].join("#"),measure:g.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let g=performance.getEntriesByName(this._marks.measure);return g.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),g=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),g}},a.bw=function(g,d,b,C,R){return o(this,void 0,void 0,function*(){if(ie())try{return yield er(g,d,b,C,R)}catch{}return function(U,V,K,ee,le){const _e=U.width,Be=U.height;Xt&&Fr||(Xt=new OffscreenCanvas(_e,Be),Fr=Xt.getContext("2d",{willReadFrequently:!0})),Xt.width=_e,Xt.height=Be,Fr.drawImage(U,0,0,_e,Be);const De=Fr.getImageData(V,K,ee,le);return Fr.clearRect(0,0,_e,Be),De.data}(g,d,b,C,R)})},a.bx=jT,a.by=h,a.bz=f,a.c=ut,a.d=g=>o(void 0,void 0,void 0,function*(){if(g.byteLength===0)return createImageBitmap(new ImageData(1,1));const d=new Blob([new Uint8Array(g)],{type:"image/png"});try{return createImageBitmap(d)}catch(b){throw new Error(`Could not load image because of ${b.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),a.e=Qe,a.f=g=>new Promise((d,b)=>{const C=new Image;C.onload=()=>{d(C),URL.revokeObjectURL(C.src),C.onload=null,window.requestAnimationFrame(()=>{C.src=Kt})},C.onerror=()=>b(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const R=new Blob([new Uint8Array(g)],{type:"image/png"});C.src=g.byteLength?URL.createObjectURL(R):Kt}),a.g=St,a.h=(g,d)=>ar(Qe(g,{type:"json"}),d),a.i=Ht,a.j=on,a.k=sn,a.l=(g,d)=>ar(Qe(g,{type:"arrayBuffer"}),d),a.m=ar,a.n=function(g){return new Ly(g).readFields(OD,[])},a.o=Ed,a.p=jv,a.q=E,a.r=yc,a.s=$r,a.t=Vh,a.u=Ia,a.v=We,a.w=tt,a.x=function(g){let[d,b,C]=g;return b+=90,b*=Math.PI/180,C*=Math.PI/180,{x:d*Math.cos(b)*Math.sin(C),y:d*Math.sin(b)*Math.sin(C),z:d*Math.cos(C)}},a.y=ps,a.z=Fi}),i("worker",["./shared"],function(a){class o{constructor(Ae){this.keyCache={},Ae&&this.replace(Ae)}replace(Ae){this._layerConfigs={},this._layers={},this.update(Ae,[])}update(Ae,ge){for(const Se of Ae){this._layerConfigs[Se.id]=Se;const ht=this._layers[Se.id]=a.aA(Se);ht._featureFilter=a.a7(ht.filter),this.keyCache[Se.id]&&delete this.keyCache[Se.id]}for(const Se of ge)delete this.keyCache[Se],delete this._layerConfigs[Se],delete this._layers[Se];this.familiesBySource={};const we=a.bk(Object.values(this._layerConfigs),this.keyCache);for(const Se of we){const ht=Se.map(Rt=>this._layers[Rt.id]),At=ht[0];if(At.visibility==="none")continue;const _t=At.source||"";let dt=this.familiesBySource[_t];dt||(dt=this.familiesBySource[_t]={});const yt=At.sourceLayer||"_geojsonTileLayer";let Nt=dt[yt];Nt||(Nt=dt[yt]=[]),Nt.push(ht)}}}class h{constructor(Ae){const ge={},we=[];for(const _t in Ae){const dt=Ae[_t],yt=ge[_t]={};for(const Nt in dt){const Rt=dt[+Nt];if(!Rt||Rt.bitmap.width===0||Rt.bitmap.height===0)continue;const dr={x:0,y:0,w:Rt.bitmap.width+2,h:Rt.bitmap.height+2};we.push(dr),yt[Nt]={rect:dr,metrics:Rt.metrics}}}const{w:Se,h:ht}=a.p(we),At=new a.o({width:Se||1,height:ht||1});for(const _t in Ae){const dt=Ae[_t];for(const yt in dt){const Nt=dt[+yt];if(!Nt||Nt.bitmap.width===0||Nt.bitmap.height===0)continue;const Rt=ge[_t][yt].rect;a.o.copy(Nt.bitmap,At,{x:0,y:0},{x:Rt.x+1,y:Rt.y+1},Nt.bitmap)}}this.image=At,this.positions=ge}}a.bl("GlyphAtlas",h);class f{constructor(Ae){this.tileID=new a.S(Ae.tileID.overscaledZ,Ae.tileID.wrap,Ae.tileID.canonical.z,Ae.tileID.canonical.x,Ae.tileID.canonical.y),this.uid=Ae.uid,this.zoom=Ae.zoom,this.pixelRatio=Ae.pixelRatio,this.tileSize=Ae.tileSize,this.source=Ae.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Ae.showCollisionBoxes,this.collectResourceTiming=!!Ae.collectResourceTiming,this.returnDependencies=!!Ae.returnDependencies,this.promoteId=Ae.promoteId,this.inFlightDependencies=[]}parse(Ae,ge,we,Se){return a._(this,void 0,void 0,function*(){this.status="parsing",this.data=Ae,this.collisionBoxArray=new a.a5;const ht=new a.bm(Object.keys(Ae.layers).sort()),At=new a.bn(this.tileID,this.promoteId);At.bucketLayerIDs=[];const _t={},dt={featureIndex:At,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:we},yt=ge.familiesBySource[this.source];for(const Ln in yt){const Un=Ae.layers[Ln];if(!Un)continue;Un.version===1&&a.w(`Vector tile source "${this.source}" layer "${Ln}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ei=ht.encode(Ln),zi=[];for(let Pt=0;Pt<Un.length;Pt++){const Zr=Un.feature(Pt),Ur=At.getId(Zr,Ln);zi.push({feature:Zr,id:Ur,index:Pt,sourceLayerIndex:Ei})}for(const Pt of yt[Ln]){const Zr=Pt[0];Zr.source!==this.source&&a.w(`layer.source = ${Zr.source} does not equal this.source = ${this.source}`),Zr.minzoom&&this.zoom<Math.floor(Zr.minzoom)||Zr.maxzoom&&this.zoom>=Zr.maxzoom||Zr.visibility!=="none"&&(_(Pt,this.zoom,we),(_t[Zr.id]=Zr.createBucket({index:At.bucketLayerIDs.length,layers:Pt,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ei,sourceID:this.source})).populate(zi,dt,this.tileID.canonical),At.bucketLayerIDs.push(Pt.map(Ur=>Ur.id)))}}const Nt=a.aF(dt.glyphDependencies,Ln=>Object.keys(Ln).map(Number));this.inFlightDependencies.forEach(Ln=>Ln==null?void 0:Ln.abort()),this.inFlightDependencies=[];let Rt=Promise.resolve({});if(Object.keys(Nt).length){const Ln=new AbortController;this.inFlightDependencies.push(Ln),Rt=Se.sendAsync({type:"GG",data:{stacks:Nt,source:this.source,tileID:this.tileID,type:"glyphs"}},Ln)}const dr=Object.keys(dt.iconDependencies);let zr=Promise.resolve({});if(dr.length){const Ln=new AbortController;this.inFlightDependencies.push(Ln),zr=Se.sendAsync({type:"GI",data:{icons:dr,source:this.source,tileID:this.tileID,type:"icons"}},Ln)}const Pr=Object.keys(dt.patternDependencies);let Rr=Promise.resolve({});if(Pr.length){const Ln=new AbortController;this.inFlightDependencies.push(Ln),Rr=Se.sendAsync({type:"GI",data:{icons:Pr,source:this.source,tileID:this.tileID,type:"patterns"}},Ln)}const[ln,Jn,_n]=yield Promise.all([Rt,zr,Rr]),jn=new h(ln),Gn=new a.bo(Jn,_n);for(const Ln in _t){const Un=_t[Ln];Un instanceof a.a6?(_(Un.layers,this.zoom,we),a.bp({bucket:Un,glyphMap:ln,glyphPositions:jn.positions,imageMap:Jn,imagePositions:Gn.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Un.hasPattern&&(Un instanceof a.bq||Un instanceof a.br||Un instanceof a.bs)&&(_(Un.layers,this.zoom,we),Un.addFeatures(dt,this.tileID.canonical,Gn.patternPositions))}return this.status="done",{buckets:Object.values(_t).filter(Ln=>!Ln.isEmpty()),featureIndex:At,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:jn.image,imageAtlas:Gn,glyphMap:this.returnDependencies?ln:null,iconMap:this.returnDependencies?Jn:null,glyphPositions:this.returnDependencies?jn.positions:null}})}}function _(Pe,Ae,ge){const we=new a.z(Ae);for(const Se of Pe)Se.recalculate(we,ge)}class x{constructor(Ae,ge,we){this.actor=Ae,this.layerIndex=ge,this.availableImages=we,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(Ae,ge){return a._(this,void 0,void 0,function*(){const we=yield a.l(Ae.request,ge);try{return{vectorTile:new a.bt.VectorTile(new a.bu(we.data)),rawData:we.data,cacheControl:we.cacheControl,expires:we.expires}}catch(Se){const ht=new Uint8Array(we.data);let At=`Unable to parse the tile at ${Ae.request.url}, `;throw At+=ht[0]===31&&ht[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${Se.message}`,new Error(At)}})}loadTile(Ae){return a._(this,void 0,void 0,function*(){const ge=Ae.uid,we=!!(Ae&&Ae.request&&Ae.request.collectResourceTiming)&&new a.bv(Ae.request),Se=new f(Ae);this.loading[ge]=Se;const ht=new AbortController;Se.abort=ht;try{const At=yield this.loadVectorTile(Ae,ht);if(delete this.loading[ge],!At)return null;const _t=At.rawData,dt={};At.expires&&(dt.expires=At.expires),At.cacheControl&&(dt.cacheControl=At.cacheControl);const yt={};if(we){const Rt=we.finish();Rt&&(yt.resourceTiming=JSON.parse(JSON.stringify(Rt)))}Se.vectorTile=At.vectorTile;const Nt=Se.parse(At.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[ge]=Se,this.fetching[ge]={rawTileData:_t,cacheControl:dt,resourceTiming:yt};try{const Rt=yield Nt;return a.e({rawTileData:_t.slice(0)},Rt,dt,yt)}finally{delete this.fetching[ge]}}catch(At){throw delete this.loading[ge],Se.status="done",this.loaded[ge]=Se,At}})}reloadTile(Ae){return a._(this,void 0,void 0,function*(){const ge=Ae.uid;if(!this.loaded||!this.loaded[ge])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const we=this.loaded[ge];if(we.showCollisionBoxes=Ae.showCollisionBoxes,we.status==="parsing"){const Se=yield we.parse(we.vectorTile,this.layerIndex,this.availableImages,this.actor);let ht;if(this.fetching[ge]){const{rawTileData:At,cacheControl:_t,resourceTiming:dt}=this.fetching[ge];delete this.fetching[ge],ht=a.e({rawTileData:At.slice(0)},Se,_t,dt)}else ht=Se;return ht}if(we.status==="done"&&we.vectorTile)return we.parse(we.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(Ae){return a._(this,void 0,void 0,function*(){const ge=this.loading,we=Ae.uid;ge&&ge[we]&&ge[we].abort&&(ge[we].abort.abort(),delete ge[we])})}removeTile(Ae){return a._(this,void 0,void 0,function*(){this.loaded&&this.loaded[Ae.uid]&&delete this.loaded[Ae.uid]})}}class T{constructor(){this.loaded={}}loadTile(Ae){return a._(this,void 0,void 0,function*(){const{uid:ge,encoding:we,rawImageData:Se,redFactor:ht,greenFactor:At,blueFactor:_t,baseShift:dt}=Ae,yt=Se.width+2,Nt=Se.height+2,Rt=a.b(Se)?new a.R({width:yt,height:Nt},yield a.bw(Se,-1,-1,yt,Nt)):Se,dr=new a.bx(ge,Rt,we,ht,At,_t,dt);return this.loaded=this.loaded||{},this.loaded[ge]=dr,dr})}removeTile(Ae){const ge=this.loaded,we=Ae.uid;ge&&ge[we]&&delete ge[we]}}function I(Pe,Ae){if(Pe.length!==0){N(Pe[0],Ae);for(var ge=1;ge<Pe.length;ge++)N(Pe[ge],!Ae)}}function N(Pe,Ae){for(var ge=0,we=0,Se=0,ht=Pe.length,At=ht-1;Se<ht;At=Se++){var _t=(Pe[Se][0]-Pe[At][0])*(Pe[At][1]+Pe[Se][1]),dt=ge+_t;we+=Math.abs(ge)>=Math.abs(_t)?ge-dt+_t:_t-dt+ge,ge=dt}ge+we>=0!=!!Ae&&Pe.reverse()}var $=a.by(function Pe(Ae,ge){var we,Se=Ae&&Ae.type;if(Se==="FeatureCollection")for(we=0;we<Ae.features.length;we++)Pe(Ae.features[we],ge);else if(Se==="GeometryCollection")for(we=0;we<Ae.geometries.length;we++)Pe(Ae.geometries[we],ge);else if(Se==="Feature")Pe(Ae.geometry,ge);else if(Se==="Polygon")I(Ae.coordinates,ge);else if(Se==="MultiPolygon")for(we=0;we<Ae.coordinates.length;we++)I(Ae.coordinates[we],ge);return Ae});const W=a.bt.VectorTileFeature.prototype.toGeoJSON;var Y={exports:{}},ie=a.bz,ce=a.bt.VectorTileFeature,fe=ve;function ve(Pe,Ae){this.options=Ae||{},this.features=Pe,this.length=Pe.length}function be(Pe,Ae){this.id=typeof Pe.id=="number"?Pe.id:void 0,this.type=Pe.type,this.rawGeometry=Pe.type===1?[Pe.geometry]:Pe.geometry,this.properties=Pe.tags,this.extent=Ae||4096}ve.prototype.feature=function(Pe){return new be(this.features[Pe],this.options.extent)},be.prototype.loadGeometry=function(){var Pe=this.rawGeometry;this.geometry=[];for(var Ae=0;Ae<Pe.length;Ae++){for(var ge=Pe[Ae],we=[],Se=0;Se<ge.length;Se++)we.push(new ie(ge[Se][0],ge[Se][1]));this.geometry.push(we)}return this.geometry},be.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Pe=this.geometry,Ae=1/0,ge=-1/0,we=1/0,Se=-1/0,ht=0;ht<Pe.length;ht++)for(var At=Pe[ht],_t=0;_t<At.length;_t++){var dt=At[_t];Ae=Math.min(Ae,dt.x),ge=Math.max(ge,dt.x),we=Math.min(we,dt.y),Se=Math.max(Se,dt.y)}return[Ae,we,ge,Se]},be.prototype.toGeoJSON=ce.prototype.toGeoJSON;var Qe=a.bA,Ue=fe;function st(Pe){var Ae=new Qe;return function(ge,we){for(var Se in ge.layers)we.writeMessage(3,at,ge.layers[Se])}(Pe,Ae),Ae.finish()}function at(Pe,Ae){var ge;Ae.writeVarintField(15,Pe.version||1),Ae.writeStringField(1,Pe.name||""),Ae.writeVarintField(5,Pe.extent||4096);var we={keys:[],values:[],keycache:{},valuecache:{}};for(ge=0;ge<Pe.length;ge++)we.feature=Pe.feature(ge),Ae.writeMessage(2,Le,we);var Se=we.keys;for(ge=0;ge<Se.length;ge++)Ae.writeStringField(3,Se[ge]);var ht=we.values;for(ge=0;ge<ht.length;ge++)Ae.writeMessage(4,Vt,ht[ge])}function Le(Pe,Ae){var ge=Pe.feature;ge.id!==void 0&&Ae.writeVarintField(1,ge.id),Ae.writeMessage(2,ze,Pe),Ae.writeVarintField(3,ge.type),Ae.writeMessage(4,Ht,ge)}function ze(Pe,Ae){var ge=Pe.feature,we=Pe.keys,Se=Pe.values,ht=Pe.keycache,At=Pe.valuecache;for(var _t in ge.properties){var dt=ge.properties[_t],yt=ht[_t];if(dt!==null){yt===void 0&&(we.push(_t),ht[_t]=yt=we.length-1),Ae.writeVarint(yt);var Nt=typeof dt;Nt!=="string"&&Nt!=="boolean"&&Nt!=="number"&&(dt=JSON.stringify(dt));var Rt=Nt+":"+dt,dr=At[Rt];dr===void 0&&(Se.push(dt),At[Rt]=dr=Se.length-1),Ae.writeVarint(dr)}}}function tt(Pe,Ae){return(Ae<<3)+(7&Pe)}function Ne(Pe){return Pe<<1^Pe>>31}function Ht(Pe,Ae){for(var ge=Pe.loadGeometry(),we=Pe.type,Se=0,ht=0,At=ge.length,_t=0;_t<At;_t++){var dt=ge[_t],yt=1;we===1&&(yt=dt.length),Ae.writeVarint(tt(1,yt));for(var Nt=we===3?dt.length-1:dt.length,Rt=0;Rt<Nt;Rt++){Rt===1&&we!==1&&Ae.writeVarint(tt(2,Nt-1));var dr=dt[Rt].x-Se,zr=dt[Rt].y-ht;Ae.writeVarint(Ne(dr)),Ae.writeVarint(Ne(zr)),Se+=dr,ht+=zr}we===3&&Ae.writeVarint(tt(7,1))}}function Vt(Pe,Ae){var ge=typeof Pe;ge==="string"?Ae.writeStringField(1,Pe):ge==="boolean"?Ae.writeBooleanField(7,Pe):ge==="number"&&(Pe%1!=0?Ae.writeDoubleField(3,Pe):Pe<0?Ae.writeSVarintField(6,Pe):Ae.writeVarintField(5,Pe))}Y.exports=st,Y.exports.fromVectorTileJs=st,Y.exports.fromGeojsonVt=function(Pe,Ae){Ae=Ae||{};var ge={};for(var we in Pe)ge[we]=new Ue(Pe[we].features,Ae),ge[we].name=we,ge[we].version=Ae.version,ge[we].extent=Ae.extent;return st({layers:ge})},Y.exports.GeoJSONWrapper=Ue;var Jt=a.by(Y.exports);const Kt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Pe=>Pe},er=Math.fround||(Xt=new Float32Array(1),Pe=>(Xt[0]=+Pe,Xt[0]));var Xt;const Fr=3,$e=5,ut=6;class Bt{constructor(Ae){this.options=Object.assign(Object.create(Kt),Ae),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Ae){const{log:ge,minZoom:we,maxZoom:Se}=this.options;ge&&console.time("total time");const ht=`prepare ${Ae.length} points`;ge&&console.time(ht),this.points=Ae;const At=[];for(let dt=0;dt<Ae.length;dt++){const yt=Ae[dt];if(!yt.geometry)continue;const[Nt,Rt]=yt.geometry.coordinates,dr=er(qt(Nt)),zr=er(nr(Rt));At.push(dr,zr,1/0,dt,-1,1),this.options.reduce&&At.push(0)}let _t=this.trees[Se+1]=this._createTree(At);ge&&console.timeEnd(ht);for(let dt=Se;dt>=we;dt--){const yt=+Date.now();_t=this.trees[dt]=this._createTree(this._cluster(_t,dt)),ge&&console.log("z%d: %d clusters in %dms",dt,_t.numItems,+Date.now()-yt)}return ge&&console.timeEnd("total time"),this}getClusters(Ae,ge){let we=((Ae[0]+180)%360+360)%360-180;const Se=Math.max(-90,Math.min(90,Ae[1]));let ht=Ae[2]===180?180:((Ae[2]+180)%360+360)%360-180;const At=Math.max(-90,Math.min(90,Ae[3]));if(Ae[2]-Ae[0]>=360)we=-180,ht=180;else if(we>ht){const Rt=this.getClusters([we,Se,180,At],ge),dr=this.getClusters([-180,Se,ht,At],ge);return Rt.concat(dr)}const _t=this.trees[this._limitZoom(ge)],dt=_t.range(qt(we),nr(At),qt(ht),nr(Se)),yt=_t.data,Nt=[];for(const Rt of dt){const dr=this.stride*Rt;Nt.push(yt[dr+$e]>1?St(yt,dr,this.clusterProps):this.points[yt[dr+Fr]])}return Nt}getChildren(Ae){const ge=this._getOriginId(Ae),we=this._getOriginZoom(Ae),Se="No cluster with the specified id.",ht=this.trees[we];if(!ht)throw new Error(Se);const At=ht.data;if(ge*this.stride>=At.length)throw new Error(Se);const _t=this.options.radius/(this.options.extent*Math.pow(2,we-1)),dt=ht.within(At[ge*this.stride],At[ge*this.stride+1],_t),yt=[];for(const Nt of dt){const Rt=Nt*this.stride;At[Rt+4]===Ae&&yt.push(At[Rt+$e]>1?St(At,Rt,this.clusterProps):this.points[At[Rt+Fr]])}if(yt.length===0)throw new Error(Se);return yt}getLeaves(Ae,ge,we){const Se=[];return this._appendLeaves(Se,Ae,ge=ge||10,we=we||0,0),Se}getTile(Ae,ge,we){const Se=this.trees[this._limitZoom(Ae)],ht=Math.pow(2,Ae),{extent:At,radius:_t}=this.options,dt=_t/At,yt=(we-dt)/ht,Nt=(we+1+dt)/ht,Rt={features:[]};return this._addTileFeatures(Se.range((ge-dt)/ht,yt,(ge+1+dt)/ht,Nt),Se.data,ge,we,ht,Rt),ge===0&&this._addTileFeatures(Se.range(1-dt/ht,yt,1,Nt),Se.data,ht,we,ht,Rt),ge===ht-1&&this._addTileFeatures(Se.range(0,yt,dt/ht,Nt),Se.data,-1,we,ht,Rt),Rt.features.length?Rt:null}getClusterExpansionZoom(Ae){let ge=this._getOriginZoom(Ae)-1;for(;ge<=this.options.maxZoom;){const we=this.getChildren(Ae);if(ge++,we.length!==1)break;Ae=we[0].properties.cluster_id}return ge}_appendLeaves(Ae,ge,we,Se,ht){const At=this.getChildren(ge);for(const _t of At){const dt=_t.properties;if(dt&&dt.cluster?ht+dt.point_count<=Se?ht+=dt.point_count:ht=this._appendLeaves(Ae,dt.cluster_id,we,Se,ht):ht<Se?ht++:Ae.push(_t),Ae.length===we)break}return ht}_createTree(Ae){const ge=new a.av(Ae.length/this.stride|0,this.options.nodeSize,Float32Array);for(let we=0;we<Ae.length;we+=this.stride)ge.add(Ae[we],Ae[we+1]);return ge.finish(),ge.data=Ae,ge}_addTileFeatures(Ae,ge,we,Se,ht,At){for(const _t of Ae){const dt=_t*this.stride,yt=ge[dt+$e]>1;let Nt,Rt,dr;if(yt)Nt=jt(ge,dt,this.clusterProps),Rt=ge[dt],dr=ge[dt+1];else{const Rr=this.points[ge[dt+Fr]];Nt=Rr.properties;const[ln,Jn]=Rr.geometry.coordinates;Rt=qt(ln),dr=nr(Jn)}const zr={type:1,geometry:[[Math.round(this.options.extent*(Rt*ht-we)),Math.round(this.options.extent*(dr*ht-Se))]],tags:Nt};let Pr;Pr=yt||this.options.generateId?ge[dt+Fr]:this.points[ge[dt+Fr]].id,Pr!==void 0&&(zr.id=Pr),At.features.push(zr)}}_limitZoom(Ae){return Math.max(this.options.minZoom,Math.min(Math.floor(+Ae),this.options.maxZoom+1))}_cluster(Ae,ge){const{radius:we,extent:Se,reduce:ht,minPoints:At}=this.options,_t=we/(Se*Math.pow(2,ge)),dt=Ae.data,yt=[],Nt=this.stride;for(let Rt=0;Rt<dt.length;Rt+=Nt){if(dt[Rt+2]<=ge)continue;dt[Rt+2]=ge;const dr=dt[Rt],zr=dt[Rt+1],Pr=Ae.within(dt[Rt],dt[Rt+1],_t),Rr=dt[Rt+$e];let ln=Rr;for(const Jn of Pr){const _n=Jn*Nt;dt[_n+2]>ge&&(ln+=dt[_n+$e])}if(ln>Rr&&ln>=At){let Jn,_n=dr*Rr,jn=zr*Rr,Gn=-1;const Ln=((Rt/Nt|0)<<5)+(ge+1)+this.points.length;for(const Un of Pr){const Ei=Un*Nt;if(dt[Ei+2]<=ge)continue;dt[Ei+2]=ge;const zi=dt[Ei+$e];_n+=dt[Ei]*zi,jn+=dt[Ei+1]*zi,dt[Ei+4]=Ln,ht&&(Jn||(Jn=this._map(dt,Rt,!0),Gn=this.clusterProps.length,this.clusterProps.push(Jn)),ht(Jn,this._map(dt,Ei)))}dt[Rt+4]=Ln,yt.push(_n/ln,jn/ln,1/0,Ln,-1,ln),ht&&yt.push(Gn)}else{for(let Jn=0;Jn<Nt;Jn++)yt.push(dt[Rt+Jn]);if(ln>1)for(const Jn of Pr){const _n=Jn*Nt;if(!(dt[_n+2]<=ge)){dt[_n+2]=ge;for(let jn=0;jn<Nt;jn++)yt.push(dt[_n+jn])}}}}return yt}_getOriginId(Ae){return Ae-this.points.length>>5}_getOriginZoom(Ae){return(Ae-this.points.length)%32}_map(Ae,ge,we){if(Ae[ge+$e]>1){const At=this.clusterProps[Ae[ge+ut]];return we?Object.assign({},At):At}const Se=this.points[Ae[ge+Fr]].properties,ht=this.options.map(Se);return we&&ht===Se?Object.assign({},ht):ht}}function St(Pe,Ae,ge){return{type:"Feature",id:Pe[Ae+Fr],properties:jt(Pe,Ae,ge),geometry:{type:"Point",coordinates:[(we=Pe[Ae],360*(we-.5)),ar(Pe[Ae+1])]}};var we}function jt(Pe,Ae,ge){const we=Pe[Ae+$e],Se=we>=1e4?`${Math.round(we/1e3)}k`:we>=1e3?Math.round(we/100)/10+"k":we,ht=Pe[Ae+ut],At=ht===-1?{}:Object.assign({},ge[ht]);return Object.assign(At,{cluster:!0,cluster_id:Pe[Ae+Fr],point_count:we,point_count_abbreviated:Se})}function qt(Pe){return Pe/360+.5}function nr(Pe){const Ae=Math.sin(Pe*Math.PI/180),ge=.5-.25*Math.log((1+Ae)/(1-Ae))/Math.PI;return ge<0?0:ge>1?1:ge}function ar(Pe){const Ae=(180-360*Pe)*Math.PI/180;return 360*Math.atan(Math.exp(Ae))/Math.PI-90}function $r(Pe,Ae,ge,we){let Se=we;const ht=Ae+(ge-Ae>>1);let At,_t=ge-Ae;const dt=Pe[Ae],yt=Pe[Ae+1],Nt=Pe[ge],Rt=Pe[ge+1];for(let dr=Ae+3;dr<ge;dr+=3){const zr=kr(Pe[dr],Pe[dr+1],dt,yt,Nt,Rt);if(zr>Se)At=dr,Se=zr;else if(zr===Se){const Pr=Math.abs(dr-ht);Pr<_t&&(At=dr,_t=Pr)}}Se>we&&(At-Ae>3&&$r(Pe,Ae,At,we),Pe[At+2]=Se,ge-At>3&&$r(Pe,At,ge,we))}function kr(Pe,Ae,ge,we,Se,ht){let At=Se-ge,_t=ht-we;if(At!==0||_t!==0){const dt=((Pe-ge)*At+(Ae-we)*_t)/(At*At+_t*_t);dt>1?(ge=Se,we=ht):dt>0&&(ge+=At*dt,we+=_t*dt)}return At=Pe-ge,_t=Ae-we,At*At+_t*_t}function Gr(Pe,Ae,ge,we){const Se={id:Pe??null,type:Ae,geometry:ge,tags:we,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(Ae==="Point"||Ae==="MultiPoint"||Ae==="LineString")sn(Se,ge);else if(Ae==="Polygon")sn(Se,ge[0]);else if(Ae==="MultiLineString")for(const ht of ge)sn(Se,ht);else if(Ae==="MultiPolygon")for(const ht of ge)sn(Se,ht[0]);return Se}function sn(Pe,Ae){for(let ge=0;ge<Ae.length;ge+=3)Pe.minX=Math.min(Pe.minX,Ae[ge]),Pe.minY=Math.min(Pe.minY,Ae[ge+1]),Pe.maxX=Math.max(Pe.maxX,Ae[ge]),Pe.maxY=Math.max(Pe.maxY,Ae[ge+1])}function on(Pe,Ae,ge,we){if(!Ae.geometry)return;const Se=Ae.geometry.coordinates;if(Se&&Se.length===0)return;const ht=Ae.geometry.type,At=Math.pow(ge.tolerance/((1<<ge.maxZoom)*ge.extent),2);let _t=[],dt=Ae.id;if(ge.promoteId?dt=Ae.properties[ge.promoteId]:ge.generateId&&(dt=we||0),ht==="Point")pr(Se,_t);else if(ht==="MultiPoint")for(const yt of Se)pr(yt,_t);else if(ht==="LineString")We(Se,_t,At,!1);else if(ht==="MultiLineString"){if(ge.lineMetrics){for(const yt of Se)_t=[],We(yt,_t,At,!1),Pe.push(Gr(dt,"LineString",_t,Ae.properties));return}Pn(Se,_t,At,!1)}else if(ht==="Polygon")Pn(Se,_t,At,!0);else{if(ht!=="MultiPolygon"){if(ht==="GeometryCollection"){for(const yt of Ae.geometry.geometries)on(Pe,{id:dt,geometry:yt,properties:Ae.properties},ge,we);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const yt of Se){const Nt=[];Pn(yt,Nt,At,!0),_t.push(Nt)}}Pe.push(Gr(dt,ht,_t,Ae.properties))}function pr(Pe,Ae){Ae.push(mn(Pe[0]),mr(Pe[1]),0)}function We(Pe,Ae,ge,we){let Se,ht,At=0;for(let dt=0;dt<Pe.length;dt++){const yt=mn(Pe[dt][0]),Nt=mr(Pe[dt][1]);Ae.push(yt,Nt,0),dt>0&&(At+=we?(Se*Nt-yt*ht)/2:Math.sqrt(Math.pow(yt-Se,2)+Math.pow(Nt-ht,2))),Se=yt,ht=Nt}const _t=Ae.length-3;Ae[2]=1,$r(Ae,0,_t,ge),Ae[_t+2]=1,Ae.size=Math.abs(At),Ae.start=0,Ae.end=Ae.size}function Pn(Pe,Ae,ge,we){for(let Se=0;Se<Pe.length;Se++){const ht=[];We(Pe[Se],ht,ge,we),Ae.push(ht)}}function mn(Pe){return Pe/360+.5}function mr(Pe){const Ae=Math.sin(Pe*Math.PI/180),ge=.5-.25*Math.log((1+Ae)/(1-Ae))/Math.PI;return ge<0?0:ge>1?1:ge}function Mr(Pe,Ae,ge,we,Se,ht,At,_t){if(we/=Ae,ht>=(ge/=Ae)&&At<we)return Pe;if(At<ge||ht>=we)return null;const dt=[];for(const yt of Pe){const Nt=yt.geometry;let Rt=yt.type;const dr=Se===0?yt.minX:yt.minY,zr=Se===0?yt.maxX:yt.maxY;if(dr>=ge&&zr<we){dt.push(yt);continue}if(zr<ge||dr>=we)continue;let Pr=[];if(Rt==="Point"||Rt==="MultiPoint")en(Nt,Pr,ge,we,Se);else if(Rt==="LineString")Wr(Nt,Pr,ge,we,Se,!1,_t.lineMetrics);else if(Rt==="MultiLineString")Bn(Nt,Pr,ge,we,Se,!1);else if(Rt==="Polygon")Bn(Nt,Pr,ge,we,Se,!0);else if(Rt==="MultiPolygon")for(const Rr of Nt){const ln=[];Bn(Rr,ln,ge,we,Se,!0),ln.length&&Pr.push(ln)}if(Pr.length){if(_t.lineMetrics&&Rt==="LineString"){for(const Rr of Pr)dt.push(Gr(yt.id,Rt,Rr,yt.tags));continue}Rt!=="LineString"&&Rt!=="MultiLineString"||(Pr.length===1?(Rt="LineString",Pr=Pr[0]):Rt="MultiLineString"),Rt!=="Point"&&Rt!=="MultiPoint"||(Rt=Pr.length===3?"Point":"MultiPoint"),dt.push(Gr(yt.id,Rt,Pr,yt.tags))}}return dt.length?dt:null}function en(Pe,Ae,ge,we,Se){for(let ht=0;ht<Pe.length;ht+=3){const At=Pe[ht+Se];At>=ge&&At<=we&&Fn(Ae,Pe[ht],Pe[ht+1],Pe[ht+2])}}function Wr(Pe,Ae,ge,we,Se,ht,At){let _t=gn(Pe);const dt=Se===0?$n:ei;let yt,Nt,Rt=Pe.start;for(let ln=0;ln<Pe.length-3;ln+=3){const Jn=Pe[ln],_n=Pe[ln+1],jn=Pe[ln+2],Gn=Pe[ln+3],Ln=Pe[ln+4],Un=Se===0?Jn:_n,Ei=Se===0?Gn:Ln;let zi=!1;At&&(yt=Math.sqrt(Math.pow(Jn-Gn,2)+Math.pow(_n-Ln,2))),Un<ge?Ei>ge&&(Nt=dt(_t,Jn,_n,Gn,Ln,ge),At&&(_t.start=Rt+yt*Nt)):Un>we?Ei<we&&(Nt=dt(_t,Jn,_n,Gn,Ln,we),At&&(_t.start=Rt+yt*Nt)):Fn(_t,Jn,_n,jn),Ei<ge&&Un>=ge&&(Nt=dt(_t,Jn,_n,Gn,Ln,ge),zi=!0),Ei>we&&Un<=we&&(Nt=dt(_t,Jn,_n,Gn,Ln,we),zi=!0),!ht&&zi&&(At&&(_t.end=Rt+yt*Nt),Ae.push(_t),_t=gn(Pe)),At&&(Rt+=yt)}let dr=Pe.length-3;const zr=Pe[dr],Pr=Pe[dr+1],Rr=Se===0?zr:Pr;Rr>=ge&&Rr<=we&&Fn(_t,zr,Pr,Pe[dr+2]),dr=_t.length-3,ht&&dr>=3&&(_t[dr]!==_t[0]||_t[dr+1]!==_t[1])&&Fn(_t,_t[0],_t[1],_t[2]),_t.length&&Ae.push(_t)}function gn(Pe){const Ae=[];return Ae.size=Pe.size,Ae.start=Pe.start,Ae.end=Pe.end,Ae}function Bn(Pe,Ae,ge,we,Se,ht){for(const At of Pe)Wr(At,Ae,ge,we,Se,ht,!1)}function Fn(Pe,Ae,ge,we){Pe.push(Ae,ge,we)}function $n(Pe,Ae,ge,we,Se,ht){const At=(ht-Ae)/(we-Ae);return Fn(Pe,ht,ge+(Se-ge)*At,1),At}function ei(Pe,Ae,ge,we,Se,ht){const At=(ht-ge)/(Se-ge);return Fn(Pe,Ae+(we-Ae)*At,ht,1),At}function br(Pe,Ae){const ge=[];for(let we=0;we<Pe.length;we++){const Se=Pe[we],ht=Se.type;let At;if(ht==="Point"||ht==="MultiPoint"||ht==="LineString")At=Cn(Se.geometry,Ae);else if(ht==="MultiLineString"||ht==="Polygon"){At=[];for(const _t of Se.geometry)At.push(Cn(_t,Ae))}else if(ht==="MultiPolygon"){At=[];for(const _t of Se.geometry){const dt=[];for(const yt of _t)dt.push(Cn(yt,Ae));At.push(dt)}}ge.push(Gr(Se.id,ht,At,Se.tags))}return ge}function Cn(Pe,Ae){const ge=[];ge.size=Pe.size,Pe.start!==void 0&&(ge.start=Pe.start,ge.end=Pe.end);for(let we=0;we<Pe.length;we+=3)ge.push(Pe[we]+Ae,Pe[we+1],Pe[we+2]);return ge}function Rn(Pe,Ae){if(Pe.transformed)return Pe;const ge=1<<Pe.z,we=Pe.x,Se=Pe.y;for(const ht of Pe.features){const At=ht.geometry,_t=ht.type;if(ht.geometry=[],_t===1)for(let dt=0;dt<At.length;dt+=2)ht.geometry.push(nn(At[dt],At[dt+1],Ae,ge,we,Se));else for(let dt=0;dt<At.length;dt++){const yt=[];for(let Nt=0;Nt<At[dt].length;Nt+=2)yt.push(nn(At[dt][Nt],At[dt][Nt+1],Ae,ge,we,Se));ht.geometry.push(yt)}}return Pe.transformed=!0,Pe}function nn(Pe,Ae,ge,we,Se,ht){return[Math.round(ge*(Pe*we-Se)),Math.round(ge*(Ae*we-ht))]}function Ci(Pe,Ae,ge,we,Se){const ht=Ae===Se.maxZoom?0:Se.tolerance/((1<<Ae)*Se.extent),At={features:[],numPoints:0,numSimplified:0,numFeatures:Pe.length,source:null,x:ge,y:we,z:Ae,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const _t of Pe)Cr(At,_t,ht,Se);return At}function Cr(Pe,Ae,ge,we){const Se=Ae.geometry,ht=Ae.type,At=[];if(Pe.minX=Math.min(Pe.minX,Ae.minX),Pe.minY=Math.min(Pe.minY,Ae.minY),Pe.maxX=Math.max(Pe.maxX,Ae.maxX),Pe.maxY=Math.max(Pe.maxY,Ae.maxY),ht==="Point"||ht==="MultiPoint")for(let _t=0;_t<Se.length;_t+=3)At.push(Se[_t],Se[_t+1]),Pe.numPoints++,Pe.numSimplified++;else if(ht==="LineString")Tn(At,Se,Pe,ge,!1,!1);else if(ht==="MultiLineString"||ht==="Polygon")for(let _t=0;_t<Se.length;_t++)Tn(At,Se[_t],Pe,ge,ht==="Polygon",_t===0);else if(ht==="MultiPolygon")for(let _t=0;_t<Se.length;_t++){const dt=Se[_t];for(let yt=0;yt<dt.length;yt++)Tn(At,dt[yt],Pe,ge,!0,yt===0)}if(At.length){let _t=Ae.tags||null;if(ht==="LineString"&&we.lineMetrics){_t={};for(const yt in Ae.tags)_t[yt]=Ae.tags[yt];_t.mapbox_clip_start=Se.start/Se.size,_t.mapbox_clip_end=Se.end/Se.size}const dt={geometry:At,type:ht==="Polygon"||ht==="MultiPolygon"?3:ht==="LineString"||ht==="MultiLineString"?2:1,tags:_t};Ae.id!==null&&(dt.id=Ae.id),Pe.features.push(dt)}}function Tn(Pe,Ae,ge,we,Se,ht){const At=we*we;if(we>0&&Ae.size<(Se?At:we))return void(ge.numPoints+=Ae.length/3);const _t=[];for(let dt=0;dt<Ae.length;dt+=3)(we===0||Ae[dt+2]>At)&&(ge.numSimplified++,_t.push(Ae[dt],Ae[dt+1])),ge.numPoints++;Se&&function(dt,yt){let Nt=0;for(let Rt=0,dr=dt.length,zr=dr-2;Rt<dr;zr=Rt,Rt+=2)Nt+=(dt[Rt]-dt[zr])*(dt[Rt+1]+dt[zr+1]);if(Nt>0===yt)for(let Rt=0,dr=dt.length;Rt<dr/2;Rt+=2){const zr=dt[Rt],Pr=dt[Rt+1];dt[Rt]=dt[dr-2-Rt],dt[Rt+1]=dt[dr-1-Rt],dt[dr-2-Rt]=zr,dt[dr-1-Rt]=Pr}}(_t,ht),Pe.push(_t)}const Xe={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class He{constructor(Ae,ge){const we=(ge=this.options=function(ht,At){for(const _t in At)ht[_t]=At[_t];return ht}(Object.create(Xe),ge)).debug;if(we&&console.time("preprocess data"),ge.maxZoom<0||ge.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ge.promoteId&&ge.generateId)throw new Error("promoteId and generateId cannot be used together.");let Se=function(ht,At){const _t=[];if(ht.type==="FeatureCollection")for(let dt=0;dt<ht.features.length;dt++)on(_t,ht.features[dt],At,dt);else on(_t,ht.type==="Feature"?ht:{geometry:ht},At);return _t}(Ae,ge);this.tiles={},this.tileCoords=[],we&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ge.indexMaxZoom,ge.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Se=function(ht,At){const _t=At.buffer/At.extent;let dt=ht;const yt=Mr(ht,1,-1-_t,_t,0,-1,2,At),Nt=Mr(ht,1,1-_t,2+_t,0,-1,2,At);return(yt||Nt)&&(dt=Mr(ht,1,-_t,1+_t,0,-1,2,At)||[],yt&&(dt=br(yt,1).concat(dt)),Nt&&(dt=dt.concat(br(Nt,-1)))),dt}(Se,ge),Se.length&&this.splitTile(Se,0,0,0),we&&(Se.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(Ae,ge,we,Se,ht,At,_t){const dt=[Ae,ge,we,Se],yt=this.options,Nt=yt.debug;for(;dt.length;){Se=dt.pop(),we=dt.pop(),ge=dt.pop(),Ae=dt.pop();const Rt=1<<ge,dr=Je(ge,we,Se);let zr=this.tiles[dr];if(!zr&&(Nt>1&&console.time("creation"),zr=this.tiles[dr]=Ci(Ae,ge,we,Se,yt),this.tileCoords.push({z:ge,x:we,y:Se}),Nt)){Nt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ge,we,Se,zr.numFeatures,zr.numPoints,zr.numSimplified),console.timeEnd("creation"));const zi=`z${ge}`;this.stats[zi]=(this.stats[zi]||0)+1,this.total++}if(zr.source=Ae,ht==null){if(ge===yt.indexMaxZoom||zr.numPoints<=yt.indexMaxPoints)continue}else{if(ge===yt.maxZoom||ge===ht)continue;if(ht!=null){const zi=ht-ge;if(we!==At>>zi||Se!==_t>>zi)continue}}if(zr.source=null,Ae.length===0)continue;Nt>1&&console.time("clipping");const Pr=.5*yt.buffer/yt.extent,Rr=.5-Pr,ln=.5+Pr,Jn=1+Pr;let _n=null,jn=null,Gn=null,Ln=null,Un=Mr(Ae,Rt,we-Pr,we+ln,0,zr.minX,zr.maxX,yt),Ei=Mr(Ae,Rt,we+Rr,we+Jn,0,zr.minX,zr.maxX,yt);Ae=null,Un&&(_n=Mr(Un,Rt,Se-Pr,Se+ln,1,zr.minY,zr.maxY,yt),jn=Mr(Un,Rt,Se+Rr,Se+Jn,1,zr.minY,zr.maxY,yt),Un=null),Ei&&(Gn=Mr(Ei,Rt,Se-Pr,Se+ln,1,zr.minY,zr.maxY,yt),Ln=Mr(Ei,Rt,Se+Rr,Se+Jn,1,zr.minY,zr.maxY,yt),Ei=null),Nt>1&&console.timeEnd("clipping"),dt.push(_n||[],ge+1,2*we,2*Se),dt.push(jn||[],ge+1,2*we,2*Se+1),dt.push(Gn||[],ge+1,2*we+1,2*Se),dt.push(Ln||[],ge+1,2*we+1,2*Se+1)}}getTile(Ae,ge,we){Ae=+Ae,ge=+ge,we=+we;const Se=this.options,{extent:ht,debug:At}=Se;if(Ae<0||Ae>24)return null;const _t=1<<Ae,dt=Je(Ae,ge=ge+_t&_t-1,we);if(this.tiles[dt])return Rn(this.tiles[dt],ht);At>1&&console.log("drilling down to z%d-%d-%d",Ae,ge,we);let yt,Nt=Ae,Rt=ge,dr=we;for(;!yt&&Nt>0;)Nt--,Rt>>=1,dr>>=1,yt=this.tiles[Je(Nt,Rt,dr)];return yt&&yt.source?(At>1&&(console.log("found parent tile z%d-%d-%d",Nt,Rt,dr),console.time("drilling down")),this.splitTile(yt.source,Nt,Rt,dr,Ae,ge,we),At>1&&console.timeEnd("drilling down"),this.tiles[dt]?Rn(this.tiles[dt],ht):null):null}}function Je(Pe,Ae,ge){return 32*((1<<Pe)*ge+Ae)+Pe}function Ve(Pe,Ae){return Ae?Pe.properties[Ae]:Pe.id}function bt(Pe,Ae){if(Pe==null)return!0;if(Pe.type==="Feature")return Ve(Pe,Ae)!=null;if(Pe.type==="FeatureCollection"){const ge=new Set;for(const we of Pe.features){const Se=Ve(we,Ae);if(Se==null||ge.has(Se))return!1;ge.add(Se)}return!0}return!1}function Mt(Pe,Ae){const ge=new Map;if(Pe!=null)if(Pe.type==="Feature")ge.set(Ve(Pe,Ae),Pe);else for(const we of Pe.features)ge.set(Ve(we,Ae),we);return ge}class $t extends x{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(Ae,ge){return a._(this,void 0,void 0,function*(){const we=Ae.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const Se=this._geoJSONIndex.getTile(we.z,we.x,we.y);if(!Se)return null;const ht=new class{constructor(_t){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=a.X,this.length=_t.length,this._features=_t}feature(_t){return new class{constructor(dt){this._feature=dt,this.extent=a.X,this.type=dt.type,this.properties=dt.tags,"id"in dt&&!isNaN(dt.id)&&(this.id=parseInt(dt.id,10))}loadGeometry(){if(this._feature.type===1){const dt=[];for(const yt of this._feature.geometry)dt.push([new a.P(yt[0],yt[1])]);return dt}{const dt=[];for(const yt of this._feature.geometry){const Nt=[];for(const Rt of yt)Nt.push(new a.P(Rt[0],Rt[1]));dt.push(Nt)}return dt}}toGeoJSON(dt,yt,Nt){return W.call(this,dt,yt,Nt)}}(this._features[_t])}}(Se.features);let At=Jt(ht);return At.byteOffset===0&&At.byteLength===At.buffer.byteLength||(At=new Uint8Array(At)),{vectorTile:ht,rawData:At.buffer}})}loadData(Ae){return a._(this,void 0,void 0,function*(){var ge;(ge=this._pendingRequest)===null||ge===void 0||ge.abort();const we=!!(Ae&&Ae.request&&Ae.request.collectResourceTiming)&&new a.bv(Ae.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(Ae,this._pendingRequest),this._geoJSONIndex=Ae.cluster?new Bt(function(At){let{superclusterOptions:_t,clusterProperties:dt}=At;if(!dt||!_t)return _t;const yt={},Nt={},Rt={accumulated:null,zoom:0},dr={properties:null},zr=Object.keys(dt);for(const Pr of zr){const[Rr,ln]=dt[Pr],Jn=a.bC(ln),_n=a.bC(typeof Rr=="string"?[Rr,["accumulated"],["get",Pr]]:Rr);yt[Pr]=Jn.value,Nt[Pr]=_n.value}return _t.map=Pr=>{dr.properties=Pr;const Rr={};for(const ln of zr)Rr[ln]=yt[ln].evaluate(Rt,dr);return Rr},_t.reduce=(Pr,Rr)=>{dr.properties=Rr;for(const ln of zr)Rt.accumulated=Pr[ln],Pr[ln]=Nt[ln].evaluate(Rt,dr)},_t}(Ae)).load((yield this._pendingData).features):(Se=yield this._pendingData,new He(Se,Ae.geojsonVtOptions)),this.loaded={};const ht={};if(we){const At=we.finish();At&&(ht.resourceTiming={},ht.resourceTiming[Ae.source]=JSON.parse(JSON.stringify(At)))}return ht}catch(ht){if(delete this._pendingRequest,a.bB(ht))return{abandoned:!0};throw ht}var Se})}getData(){return a._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(Ae){const ge=this.loaded;return ge&&ge[Ae.uid]?super.reloadTile(Ae):this.loadTile(Ae)}loadAndProcessGeoJSON(Ae,ge){return a._(this,void 0,void 0,function*(){let we=yield this.loadGeoJSON(Ae,ge);if(delete this._pendingRequest,typeof we!="object")throw new Error(`Input data given to '${Ae.source}' is not a valid GeoJSON object.`);if($(we,!0),Ae.filter){const Se=a.bC(Ae.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Se.result==="error")throw new Error(Se.value.map(At=>`${At.key}: ${At.message}`).join(", "));we={type:"FeatureCollection",features:we.features.filter(At=>Se.value.evaluate({zoom:0},At))}}return we})}loadGeoJSON(Ae,ge){return a._(this,void 0,void 0,function*(){const{promoteId:we}=Ae;if(Ae.request){const Se=yield a.h(Ae.request,ge);return this._dataUpdateable=bt(Se.data,we)?Mt(Se.data,we):void 0,Se.data}if(typeof Ae.data=="string")try{const Se=JSON.parse(Ae.data);return this._dataUpdateable=bt(Se,we)?Mt(Se,we):void 0,Se}catch{throw new Error(`Input data given to '${Ae.source}' is not a valid GeoJSON object.`)}if(!Ae.dataDiff)throw new Error(`Input data given to '${Ae.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${Ae.source}`);return function(Se,ht,At){var _t,dt,yt,Nt;if(ht.removeAll&&Se.clear(),ht.remove)for(const Rt of ht.remove)Se.delete(Rt);if(ht.add)for(const Rt of ht.add){const dr=Ve(Rt,At);dr!=null&&Se.set(dr,Rt)}if(ht.update)for(const Rt of ht.update){let dr=Se.get(Rt.id);if(dr==null)continue;const zr=!Rt.removeAllProperties&&(((_t=Rt.removeProperties)===null||_t===void 0?void 0:_t.length)>0||((dt=Rt.addOrUpdateProperties)===null||dt===void 0?void 0:dt.length)>0);if((Rt.newGeometry||Rt.removeAllProperties||zr)&&(dr=Object.assign({},dr),Se.set(Rt.id,dr),zr&&(dr.properties=Object.assign({},dr.properties))),Rt.newGeometry&&(dr.geometry=Rt.newGeometry),Rt.removeAllProperties)dr.properties={};else if(((yt=Rt.removeProperties)===null||yt===void 0?void 0:yt.length)>0)for(const Pr of Rt.removeProperties)Object.prototype.hasOwnProperty.call(dr.properties,Pr)&&delete dr.properties[Pr];if(((Nt=Rt.addOrUpdateProperties)===null||Nt===void 0?void 0:Nt.length)>0)for(const{key:Pr,value:Rr}of Rt.addOrUpdateProperties)dr.properties[Pr]=Rr}}(this._dataUpdateable,Ae.dataDiff,we),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(Ae){return a._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(Ae){return this._geoJSONIndex.getClusterExpansionZoom(Ae.clusterId)}getClusterChildren(Ae){return this._geoJSONIndex.getChildren(Ae.clusterId)}getClusterLeaves(Ae){return this._geoJSONIndex.getLeaves(Ae.clusterId,Ae.limit,Ae.offset)}}class Wt{constructor(Ae){this.self=Ae,this.actor=new a.F(Ae),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(ge,we)=>{if(this.externalWorkerSourceTypes[ge])throw new Error(`Worker source with name "${ge}" already registered.`);this.externalWorkerSourceTypes[ge]=we},this.self.addProtocol=a.bi,this.self.removeProtocol=a.bj,this.self.registerRTLTextPlugin=ge=>{if(a.bD.isParsed())throw new Error("RTL text plugin already registered.");a.bD.setMethods(ge)},this.actor.registerMessageHandler("LDT",(ge,we)=>this._getDEMWorkerSource(ge,we.source).loadTile(we)),this.actor.registerMessageHandler("RDT",(ge,we)=>a._(this,void 0,void 0,function*(){this._getDEMWorkerSource(ge,we.source).removeTile(we)})),this.actor.registerMessageHandler("GCEZ",(ge,we)=>a._(this,void 0,void 0,function*(){return this._getWorkerSource(ge,we.type,we.source).getClusterExpansionZoom(we)})),this.actor.registerMessageHandler("GCC",(ge,we)=>a._(this,void 0,void 0,function*(){return this._getWorkerSource(ge,we.type,we.source).getClusterChildren(we)})),this.actor.registerMessageHandler("GCL",(ge,we)=>a._(this,void 0,void 0,function*(){return this._getWorkerSource(ge,we.type,we.source).getClusterLeaves(we)})),this.actor.registerMessageHandler("LD",(ge,we)=>this._getWorkerSource(ge,we.type,we.source).loadData(we)),this.actor.registerMessageHandler("GD",(ge,we)=>this._getWorkerSource(ge,we.type,we.source).getData()),this.actor.registerMessageHandler("LT",(ge,we)=>this._getWorkerSource(ge,we.type,we.source).loadTile(we)),this.actor.registerMessageHandler("RT",(ge,we)=>this._getWorkerSource(ge,we.type,we.source).reloadTile(we)),this.actor.registerMessageHandler("AT",(ge,we)=>this._getWorkerSource(ge,we.type,we.source).abortTile(we)),this.actor.registerMessageHandler("RMT",(ge,we)=>this._getWorkerSource(ge,we.type,we.source).removeTile(we)),this.actor.registerMessageHandler("RS",(ge,we)=>a._(this,void 0,void 0,function*(){if(!this.workerSources[ge]||!this.workerSources[ge][we.type]||!this.workerSources[ge][we.type][we.source])return;const Se=this.workerSources[ge][we.type][we.source];delete this.workerSources[ge][we.type][we.source],Se.removeSource!==void 0&&Se.removeSource(we)})),this.actor.registerMessageHandler("RM",ge=>a._(this,void 0,void 0,function*(){delete this.layerIndexes[ge],delete this.availableImages[ge],delete this.workerSources[ge],delete this.demWorkerSources[ge]})),this.actor.registerMessageHandler("SR",(ge,we)=>a._(this,void 0,void 0,function*(){this.referrer=we})),this.actor.registerMessageHandler("SRPS",(ge,we)=>this._syncRTLPluginState(ge,we)),this.actor.registerMessageHandler("IS",(ge,we)=>a._(this,void 0,void 0,function*(){this.self.importScripts(we)})),this.actor.registerMessageHandler("SI",(ge,we)=>this._setImages(ge,we)),this.actor.registerMessageHandler("UL",(ge,we)=>a._(this,void 0,void 0,function*(){this._getLayerIndex(ge).update(we.layers,we.removedIds)})),this.actor.registerMessageHandler("SL",(ge,we)=>a._(this,void 0,void 0,function*(){this._getLayerIndex(ge).replace(we)}))}_setImages(Ae,ge){return a._(this,void 0,void 0,function*(){this.availableImages[Ae]=ge;for(const we in this.workerSources[Ae]){const Se=this.workerSources[Ae][we];for(const ht in Se)Se[ht].availableImages=ge}})}_syncRTLPluginState(Ae,ge){return a._(this,void 0,void 0,function*(){if(a.bD.isParsed())return a.bD.getState();if(ge.pluginStatus!=="loading")return a.bD.setState(ge),ge;const we=ge.pluginURL;if(this.self.importScripts(we),a.bD.isParsed()){const Se={pluginStatus:"loaded",pluginURL:we};return a.bD.setState(Se),Se}throw a.bD.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${we}`)})}_getAvailableImages(Ae){let ge=this.availableImages[Ae];return ge||(ge=[]),ge}_getLayerIndex(Ae){let ge=this.layerIndexes[Ae];return ge||(ge=this.layerIndexes[Ae]=new o),ge}_getWorkerSource(Ae,ge,we){if(this.workerSources[Ae]||(this.workerSources[Ae]={}),this.workerSources[Ae][ge]||(this.workerSources[Ae][ge]={}),!this.workerSources[Ae][ge][we]){const Se={sendAsync:(ht,At)=>(ht.targetMapId=Ae,this.actor.sendAsync(ht,At))};switch(ge){case"vector":this.workerSources[Ae][ge][we]=new x(Se,this._getLayerIndex(Ae),this._getAvailableImages(Ae));break;case"geojson":this.workerSources[Ae][ge][we]=new $t(Se,this._getLayerIndex(Ae),this._getAvailableImages(Ae));break;default:this.workerSources[Ae][ge][we]=new this.externalWorkerSourceTypes[ge](Se,this._getLayerIndex(Ae),this._getAvailableImages(Ae))}}return this.workerSources[Ae][ge][we]}_getDEMWorkerSource(Ae,ge){return this.demWorkerSources[Ae]||(this.demWorkerSources[Ae]={}),this.demWorkerSources[Ae][ge]||(this.demWorkerSources[Ae][ge]=new T),this.demWorkerSources[Ae][ge]}}return a.i(self)&&(self.worker=new Wt(self)),Wt}),i("index",["exports","./shared"],function(a,o){var h="4.7.1";let f,_;const x={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:E=>new Promise((c,y)=>{const B=requestAnimationFrame(c);E.signal.addEventListener("abort",()=>{cancelAnimationFrame(B),y(o.c())})}),getImageData(E){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return this.getImageCanvasContext(E).getImageData(-c,-c,E.width+2*c,E.height+2*c)},getImageCanvasContext(E){const c=window.document.createElement("canvas"),y=c.getContext("2d",{willReadFrequently:!0});if(!y)throw new Error("failed to create canvas 2d context");return c.width=E.width,c.height=E.height,y.drawImage(E,0,0,E.width,E.height),y},resolveURL:E=>(f||(f=document.createElement("a")),f.href=E,f.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(_==null&&(_=matchMedia("(prefers-reduced-motion: reduce)")),_.matches)}};class T{static testProp(c){if(!T.docStyle)return c[0];for(let y=0;y<c.length;y++)if(c[y]in T.docStyle)return c[y];return c[0]}static create(c,y,B){const S=window.document.createElement(c);return y!==void 0&&(S.className=y),B&&B.appendChild(S),S}static createNS(c,y){return window.document.createElementNS(c,y)}static disableDrag(){T.docStyle&&T.selectProp&&(T.userSelect=T.docStyle[T.selectProp],T.docStyle[T.selectProp]="none")}static enableDrag(){T.docStyle&&T.selectProp&&(T.docStyle[T.selectProp]=T.userSelect)}static setTransform(c,y){c.style[T.transformProp]=y}static addEventListener(c,y,B){let S=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};c.addEventListener(y,B,"passive"in S?S:S.capture)}static removeEventListener(c,y,B){let S=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};c.removeEventListener(y,B,"passive"in S?S:S.capture)}static suppressClickInternal(c){c.preventDefault(),c.stopPropagation(),window.removeEventListener("click",T.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",T.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",T.suppressClickInternal,!0)},0)}static getScale(c){const y=c.getBoundingClientRect();return{x:y.width/c.offsetWidth||1,y:y.height/c.offsetHeight||1,boundingClientRect:y}}static getPoint(c,y,B){const S=y.boundingClientRect;return new o.P((B.clientX-S.left)/y.x-c.clientLeft,(B.clientY-S.top)/y.y-c.clientTop)}static mousePos(c,y){const B=T.getScale(c);return T.getPoint(c,B,y)}static touchPos(c,y){const B=[],S=T.getScale(c);for(let F=0;F<y.length;F++)B.push(T.getPoint(c,S,y[F]));return B}static mouseButton(c){return c.button}static remove(c){c.parentNode&&c.parentNode.removeChild(c)}}T.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,T.selectProp=T.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),T.transformProp=T.testProp(["transform","WebkitTransform"]);const I={supported:!1,testSupport:function(E){!W&&$&&(Y?ie(E):N=E)}};let N,$,W=!1,Y=!1;function ie(E){const c=E.createTexture();E.bindTexture(E.TEXTURE_2D,c);try{if(E.texImage2D(E.TEXTURE_2D,0,E.RGBA,E.RGBA,E.UNSIGNED_BYTE,$),E.isContextLost())return;I.supported=!0}catch{}E.deleteTexture(c),W=!0}var ce;typeof document<"u"&&($=document.createElement("img"),$.onload=()=>{N&&ie(N),N=null,Y=!0},$.onerror=()=>{W=!0,N=null},$.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(E){let c,y,B,S;E.resetRequestQueue=()=>{c=[],y=0,B=0,S={}},E.addThrottleControl=Z=>{const se=B++;return S[se]=Z,se},E.removeThrottleControl=Z=>{delete S[Z],H()},E.getImage=function(Z,se){let he=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return new Promise((ue,Te)=>{I.supported&&(Z.headers||(Z.headers={}),Z.headers.accept="image/webp,*/*"),o.e(Z,{type:"image"}),c.push({abortController:se,requestParameters:Z,supportImageRefresh:he,state:"queued",onError:Fe=>{Te(Fe)},onSuccess:Fe=>{ue(Fe)}}),H()})};const F=Z=>o._(this,void 0,void 0,function*(){Z.state="running";const{requestParameters:se,supportImageRefresh:he,onError:ue,onSuccess:Te,abortController:Fe}=Z,Ee=he===!1&&!o.i(self)&&!o.g(se.url)&&(!se.headers||Object.keys(se.headers).reduce((qe,Ze)=>qe&&Ze==="accept",!0));y++;const Oe=Ee?j(se,Fe):o.m(se,Fe);try{const qe=yield Oe;delete Z.abortController,Z.state="completed",qe.data instanceof HTMLImageElement||o.b(qe.data)?Te(qe):qe.data&&Te({data:yield(rt=qe.data,typeof createImageBitmap=="function"?o.d(rt):o.f(rt)),cacheControl:qe.cacheControl,expires:qe.expires})}catch(qe){delete Z.abortController,ue(qe)}finally{y--,H()}var rt}),H=()=>{const Z=(()=>{for(const se of Object.keys(S))if(S[se]())return!0;return!1})()?o.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:o.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let se=y;se<Z&&c.length>0;se++){const he=c.shift();he.abortController.signal.aborted?se--:F(he)}},j=(Z,se)=>new Promise((he,ue)=>{const Te=new Image,Fe=Z.url,Ee=Z.credentials;Ee&&Ee==="include"?Te.crossOrigin="use-credentials":(Ee&&Ee==="same-origin"||!o.s(Fe))&&(Te.crossOrigin="anonymous"),se.signal.addEventListener("abort",()=>{Te.src="",ue(o.c())}),Te.fetchPriority="high",Te.onload=()=>{Te.onerror=Te.onload=null,he({data:Te})},Te.onerror=()=>{Te.onerror=Te.onload=null,se.signal.aborted||ue(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},Te.src=Fe})}(ce||(ce={})),ce.resetRequestQueue();class fe{constructor(c){this._transformRequestFn=c}transformRequest(c,y){return this._transformRequestFn&&this._transformRequestFn(c,y)||{url:c}}setTransformRequest(c){this._transformRequestFn=c}}function ve(E){var c=new o.A(3);return c[0]=E[0],c[1]=E[1],c[2]=E[2],c}var be,Qe=function(E,c,y){return E[0]=c[0]-y[0],E[1]=c[1]-y[1],E[2]=c[2]-y[2],E};be=new o.A(3),o.A!=Float32Array&&(be[0]=0,be[1]=0,be[2]=0);var Ue=function(E){var c=E[0],y=E[1];return c*c+y*y};function st(E){const c=[];if(typeof E=="string")c.push({id:"default",url:E});else if(E&&E.length>0){const y=[];for(const{id:B,url:S}of E){const F=`${B}${S}`;y.indexOf(F)===-1&&(y.push(F),c.push({id:B,url:S}))}}return c}function at(E,c,y){const B=E.split("?");return B[0]+=`${c}${y}`,B.join("?")}(function(){var E=new o.A(2);o.A!=Float32Array&&(E[0]=0,E[1]=0)})();class Le{constructor(c,y,B,S){this.context=c,this.format=B,this.texture=c.gl.createTexture(),this.update(y,S)}update(c,y,B){const{width:S,height:F}=c,H=!(this.size&&this.size[0]===S&&this.size[1]===F||B),{context:j}=this,{gl:Z}=j;if(this.useMipmap=!!(y&&y.useMipmap),Z.bindTexture(Z.TEXTURE_2D,this.texture),j.pixelStoreUnpackFlipY.set(!1),j.pixelStoreUnpack.set(1),j.pixelStoreUnpackPremultiplyAlpha.set(this.format===Z.RGBA&&(!y||y.premultiply!==!1)),H)this.size=[S,F],c instanceof HTMLImageElement||c instanceof HTMLCanvasElement||c instanceof HTMLVideoElement||c instanceof ImageData||o.b(c)?Z.texImage2D(Z.TEXTURE_2D,0,this.format,this.format,Z.UNSIGNED_BYTE,c):Z.texImage2D(Z.TEXTURE_2D,0,this.format,S,F,0,this.format,Z.UNSIGNED_BYTE,c.data);else{const{x:se,y:he}=B||{x:0,y:0};c instanceof HTMLImageElement||c instanceof HTMLCanvasElement||c instanceof HTMLVideoElement||c instanceof ImageData||o.b(c)?Z.texSubImage2D(Z.TEXTURE_2D,0,se,he,Z.RGBA,Z.UNSIGNED_BYTE,c):Z.texSubImage2D(Z.TEXTURE_2D,0,se,he,S,F,Z.RGBA,Z.UNSIGNED_BYTE,c.data)}this.useMipmap&&this.isSizePowerOfTwo()&&Z.generateMipmap(Z.TEXTURE_2D)}bind(c,y,B){const{context:S}=this,{gl:F}=S;F.bindTexture(F.TEXTURE_2D,this.texture),B!==F.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(B=F.LINEAR),c!==this.filter&&(F.texParameteri(F.TEXTURE_2D,F.TEXTURE_MAG_FILTER,c),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_MIN_FILTER,B||c),this.filter=c),y!==this.wrap&&(F.texParameteri(F.TEXTURE_2D,F.TEXTURE_WRAP_S,y),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_WRAP_T,y),this.wrap=y)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:c}=this.context;c.deleteTexture(this.texture),this.texture=null}}function ze(E){const{userImage:c}=E;return!!(c&&c.render&&c.render())&&(E.data.replace(new Uint8Array(c.data.buffer)),!0)}class tt extends o.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(c){if(this.loaded!==c&&(this.loaded=c,c)){for(const{ids:y,promiseResolve:B}of this.requestors)B(this._getImagesForIds(y));this.requestors=[]}}getImage(c){const y=this.images[c];if(y&&!y.data&&y.spriteData){const B=y.spriteData;y.data=new o.R({width:B.width,height:B.height},B.context.getImageData(B.x,B.y,B.width,B.height).data),y.spriteData=null}return y}addImage(c,y){if(this.images[c])throw new Error(`Image id ${c} already exist, use updateImage instead`);this._validate(c,y)&&(this.images[c]=y)}_validate(c,y){let B=!0;const S=y.data||y.spriteData;return this._validateStretch(y.stretchX,S&&S.width)||(this.fire(new o.j(new Error(`Image "${c}" has invalid "stretchX" value`))),B=!1),this._validateStretch(y.stretchY,S&&S.height)||(this.fire(new o.j(new Error(`Image "${c}" has invalid "stretchY" value`))),B=!1),this._validateContent(y.content,y)||(this.fire(new o.j(new Error(`Image "${c}" has invalid "content" value`))),B=!1),B}_validateStretch(c,y){if(!c)return!0;let B=0;for(const S of c){if(S[0]<B||S[1]<S[0]||y<S[1])return!1;B=S[1]}return!0}_validateContent(c,y){if(!c)return!0;if(c.length!==4)return!1;const B=y.spriteData,S=B&&B.width||y.data.width,F=B&&B.height||y.data.height;return!(c[0]<0||S<c[0]||c[1]<0||F<c[1]||c[2]<0||S<c[2]||c[3]<0||F<c[3]||c[2]<c[0]||c[3]<c[1])}updateImage(c,y){let B=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const S=this.getImage(c);if(B&&(S.data.width!==y.data.width||S.data.height!==y.data.height))throw new Error(`size mismatch between old image (${S.data.width}x${S.data.height}) and new image (${y.data.width}x${y.data.height}).`);y.version=S.version+1,this.images[c]=y,this.updatedImages[c]=!0}removeImage(c){const y=this.images[c];delete this.images[c],delete this.patterns[c],y.userImage&&y.userImage.onRemove&&y.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(c){return new Promise((y,B)=>{let S=!0;if(!this.isLoaded())for(const F of c)this.images[F]||(S=!1);this.isLoaded()||S?y(this._getImagesForIds(c)):this.requestors.push({ids:c,promiseResolve:y})})}_getImagesForIds(c){const y={};for(const B of c){let S=this.getImage(B);S||(this.fire(new o.k("styleimagemissing",{id:B})),S=this.getImage(B)),S?y[B]={data:S.data.clone(),pixelRatio:S.pixelRatio,sdf:S.sdf,version:S.version,stretchX:S.stretchX,stretchY:S.stretchY,content:S.content,textFitWidth:S.textFitWidth,textFitHeight:S.textFitHeight,hasRenderCallback:!!(S.userImage&&S.userImage.render)}:o.w(`Image "${B}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return y}getPixelSize(){const{width:c,height:y}=this.atlasImage;return{width:c,height:y}}getPattern(c){const y=this.patterns[c],B=this.getImage(c);if(!B)return null;if(y&&y.position.version===B.version)return y.position;if(y)y.position.version=B.version;else{const S={w:B.data.width+2,h:B.data.height+2,x:0,y:0},F=new o.I(S,B);this.patterns[c]={bin:S,position:F}}return this._updatePatternAtlas(),this.patterns[c].position}bind(c){const y=c.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Le(c,this.atlasImage,y.RGBA),this.atlasTexture.bind(y.LINEAR,y.CLAMP_TO_EDGE)}_updatePatternAtlas(){const c=[];for(const F in this.patterns)c.push(this.patterns[F].bin);const{w:y,h:B}=o.p(c),S=this.atlasImage;S.resize({width:y||1,height:B||1});for(const F in this.patterns){const{bin:H}=this.patterns[F],j=H.x+1,Z=H.y+1,se=this.getImage(F).data,he=se.width,ue=se.height;o.R.copy(se,S,{x:0,y:0},{x:j,y:Z},{width:he,height:ue}),o.R.copy(se,S,{x:0,y:ue-1},{x:j,y:Z-1},{width:he,height:1}),o.R.copy(se,S,{x:0,y:0},{x:j,y:Z+ue},{width:he,height:1}),o.R.copy(se,S,{x:he-1,y:0},{x:j-1,y:Z},{width:1,height:ue}),o.R.copy(se,S,{x:0,y:0},{x:j+he,y:Z},{width:1,height:ue})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(c){for(const y of c){if(this.callbackDispatchedThisFrame[y])continue;this.callbackDispatchedThisFrame[y]=!0;const B=this.getImage(y);B||o.w(`Image with ID: "${y}" was not found`),ze(B)&&this.updateImage(y,B)}}}const Ne=1e20;function Ht(E,c,y,B,S,F,H,j,Z){for(let se=c;se<c+B;se++)Vt(E,y*F+se,F,S,H,j,Z);for(let se=y;se<y+S;se++)Vt(E,se*F+c,1,B,H,j,Z)}function Vt(E,c,y,B,S,F,H){F[0]=0,H[0]=-Ne,H[1]=Ne,S[0]=E[c];for(let j=1,Z=0,se=0;j<B;j++){S[j]=E[c+j*y];const he=j*j;do{const ue=F[Z];se=(S[j]-S[ue]+he-ue*ue)/(j-ue)/2}while(se<=H[Z]&&--Z>-1);Z++,F[Z]=j,H[Z]=se,H[Z+1]=Ne}for(let j=0,Z=0;j<B;j++){for(;H[Z+1]<j;)Z++;const se=F[Z],he=j-se;E[c+j*y]=S[se]+he*he}}class Jt{constructor(c,y){this.requestManager=c,this.localIdeographFontFamily=y,this.entries={}}setURL(c){this.url=c}getGlyphs(c){return o._(this,void 0,void 0,function*(){const y=[];for(const F in c)for(const H of c[F])y.push(this._getAndCacheGlyphsPromise(F,H));const B=yield Promise.all(y),S={};for(const{stack:F,id:H,glyph:j}of B)S[F]||(S[F]={}),S[F][H]=j&&{id:j.id,bitmap:j.bitmap.clone(),metrics:j.metrics};return S})}_getAndCacheGlyphsPromise(c,y){return o._(this,void 0,void 0,function*(){let B=this.entries[c];B||(B=this.entries[c]={glyphs:{},requests:{},ranges:{}});let S=B.glyphs[y];if(S!==void 0)return{stack:c,id:y,glyph:S};if(S=this._tinySDF(B,c,y),S)return B.glyphs[y]=S,{stack:c,id:y,glyph:S};const F=Math.floor(y/256);if(256*F>65535)throw new Error("glyphs > 65535 not supported");if(B.ranges[F])return{stack:c,id:y,glyph:S};if(!this.url)throw new Error("glyphsUrl is not set");if(!B.requests[F]){const j=Jt.loadGlyphRange(c,F,this.url,this.requestManager);B.requests[F]=j}const H=yield B.requests[F];for(const j in H)this._doesCharSupportLocalGlyph(+j)||(B.glyphs[+j]=H[+j]);return B.ranges[F]=!0,{stack:c,id:y,glyph:H[y]||null}})}_doesCharSupportLocalGlyph(c){return!!this.localIdeographFontFamily&&new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(c))}_tinySDF(c,y,B){const S=this.localIdeographFontFamily;if(!S||!this._doesCharSupportLocalGlyph(B))return;let F=c.tinySDF;if(!F){let j="400";/bold/i.test(y)?j="900":/medium/i.test(y)?j="500":/light/i.test(y)&&(j="200"),F=c.tinySDF=new Jt.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:S,fontWeight:j})}const H=F.draw(String.fromCharCode(B));return{id:B,bitmap:new o.o({width:H.width||60,height:H.height||60},H.data),metrics:{width:H.glyphWidth/2||24,height:H.glyphHeight/2||24,left:H.glyphLeft/2+.5||0,top:H.glyphTop/2-27.5||-8,advance:H.glyphAdvance/2||24,isDoubleResolution:!0}}}}Jt.loadGlyphRange=function(E,c,y,B){return o._(this,void 0,void 0,function*(){const S=256*c,F=S+255,H=B.transformRequest(y.replace("{fontstack}",E).replace("{range}",`${S}-${F}`),"Glyphs"),j=yield o.l(H,new AbortController);if(!j||!j.data)throw new Error(`Could not load glyph range. range: ${c}, ${S}-${F}`);const Z={};for(const se of o.n(j.data))Z[se.id]=se;return Z})},Jt.TinySDF=class{constructor(){let{fontSize:E=24,buffer:c=3,radius:y=8,cutoff:B=.25,fontFamily:S="sans-serif",fontWeight:F="normal",fontStyle:H="normal"}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.buffer=c,this.cutoff=B,this.radius=y;const j=this.size=E+4*c,Z=this._createCanvas(j),se=this.ctx=Z.getContext("2d",{willReadFrequently:!0});se.font=`${H} ${F} ${E}px ${S}`,se.textBaseline="alphabetic",se.textAlign="left",se.fillStyle="black",this.gridOuter=new Float64Array(j*j),this.gridInner=new Float64Array(j*j),this.f=new Float64Array(j),this.z=new Float64Array(j+1),this.v=new Uint16Array(j)}_createCanvas(E){const c=document.createElement("canvas");return c.width=c.height=E,c}draw(E){const{width:c,actualBoundingBoxAscent:y,actualBoundingBoxDescent:B,actualBoundingBoxLeft:S,actualBoundingBoxRight:F}=this.ctx.measureText(E),H=Math.ceil(y),j=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(F-S))),Z=Math.min(this.size-this.buffer,H+Math.ceil(B)),se=j+2*this.buffer,he=Z+2*this.buffer,ue=Math.max(se*he,0),Te=new Uint8ClampedArray(ue),Fe={data:Te,width:se,height:he,glyphWidth:j,glyphHeight:Z,glyphTop:H,glyphLeft:0,glyphAdvance:c};if(j===0||Z===0)return Fe;const{ctx:Ee,buffer:Oe,gridInner:rt,gridOuter:qe}=this;Ee.clearRect(Oe,Oe,j,Z),Ee.fillText(E,Oe,Oe+H);const Ze=Ee.getImageData(Oe,Oe,j,Z);qe.fill(Ne,0,ue),rt.fill(0,0,ue);for(let ot=0;ot<Z;ot++)for(let vt=0;vt<j;vt++){const kt=Ze.data[4*(ot*j+vt)+3]/255;if(kt===0)continue;const It=(ot+Oe)*se+vt+Oe;if(kt===1)qe[It]=0,rt[It]=Ne;else{const ur=.5-kt;qe[It]=ur>0?ur*ur:0,rt[It]=ur<0?ur*ur:0}}Ht(qe,0,0,se,he,se,this.f,this.v,this.z),Ht(rt,Oe,Oe,j,Z,se,this.f,this.v,this.z);for(let ot=0;ot<ue;ot++){const vt=Math.sqrt(qe[ot])-Math.sqrt(rt[ot]);Te[ot]=Math.round(255-255*(vt/this.radius+this.cutoff))}return Fe}};class Kt{constructor(){this.specification=o.v.light.position}possiblyEvaluate(c,y){return o.x(c.expression.evaluate(y))}interpolate(c,y,B){return{x:o.y.number(c.x,y.x,B),y:o.y.number(c.y,y.y,B),z:o.y.number(c.z,y.z,B)}}}let er;class Xt extends o.E{constructor(c){super(),er=er||new o.q({anchor:new o.D(o.v.light.anchor),position:new Kt,color:new o.D(o.v.light.color),intensity:new o.D(o.v.light.intensity)}),this._transitionable=new o.T(er),this.setLight(c),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(c){let y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!this._validate(o.r,c,y))for(const B in c){const S=c[B];B.endsWith("-transition")?this._transitionable.setTransition(B.slice(0,-11),S):this._transitionable.setValue(B,S)}}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}_validate(c,y,B){return(!B||B.validate!==!1)&&o.t(this,c.call(o.u,{value:y,style:{glyphs:!0,sprite:!0},styleSpec:o.v}))}}const Fr=new o.q({"sky-color":new o.D(o.v.sky["sky-color"]),"horizon-color":new o.D(o.v.sky["horizon-color"]),"fog-color":new o.D(o.v.sky["fog-color"]),"fog-ground-blend":new o.D(o.v.sky["fog-ground-blend"]),"horizon-fog-blend":new o.D(o.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new o.D(o.v.sky["sky-horizon-blend"]),"atmosphere-blend":new o.D(o.v.sky["atmosphere-blend"])});class $e extends o.E{constructor(c){super(),this._transitionable=new o.T(Fr),this.setSky(c),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new o.z(0))}setSky(c){let y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!this._validate(o.B,c,y)){c||(c={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const B in c){const S=c[B];B.endsWith("-transition")?this._transitionable.setTransition(B.slice(0,-11),S):this._transitionable.setValue(B,S)}}}getSky(){return this._transitionable.serialize()}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}_validate(c,y){let B=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return(B==null?void 0:B.validate)!==!1&&o.t(this,c.call(o.u,o.e({value:y,style:{glyphs:!0,sprite:!0},styleSpec:o.v})))}calculateFogBlendOpacity(c){return c<60?0:c<70?(c-60)/10:1}}class ut{constructor(c,y){this.width=c,this.height=y,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(c,y){const B=c.join(",")+String(y);return this.dashEntry[B]||(this.dashEntry[B]=this.addDash(c,y)),this.dashEntry[B]}getDashRanges(c,y,B){const S=[];let F=c.length%2==1?-c[c.length-1]*B:0,H=c[0]*B,j=!0;S.push({left:F,right:H,isDash:j,zeroLength:c[0]===0});let Z=c[0];for(let se=1;se<c.length;se++){j=!j;const he=c[se];F=Z*B,Z+=he,H=Z*B,S.push({left:F,right:H,isDash:j,zeroLength:he===0})}return S}addRoundDash(c,y,B){const S=y/2;for(let F=-B;F<=B;F++){const H=this.width*(this.nextRow+B+F);let j=0,Z=c[j];for(let se=0;se<this.width;se++){se/Z.right>1&&(Z=c[++j]);const he=Math.abs(se-Z.left),ue=Math.abs(se-Z.right),Te=Math.min(he,ue);let Fe;const Ee=F/B*(S+1);if(Z.isDash){const Oe=S-Math.abs(Ee);Fe=Math.sqrt(Te*Te+Oe*Oe)}else Fe=S-Math.sqrt(Te*Te+Ee*Ee);this.data[H+se]=Math.max(0,Math.min(255,Fe+128))}}}addRegularDash(c){for(let j=c.length-1;j>=0;--j){const Z=c[j],se=c[j+1];Z.zeroLength?c.splice(j,1):se&&se.isDash===Z.isDash&&(se.left=Z.left,c.splice(j,1))}const y=c[0],B=c[c.length-1];y.isDash===B.isDash&&(y.left=B.left-this.width,B.right=y.right+this.width);const S=this.width*this.nextRow;let F=0,H=c[F];for(let j=0;j<this.width;j++){j/H.right>1&&(H=c[++F]);const Z=Math.abs(j-H.left),se=Math.abs(j-H.right),he=Math.min(Z,se);this.data[S+j]=Math.max(0,Math.min(255,(H.isDash?he:-he)+128))}}addDash(c,y){const B=y?7:0,S=2*B+1;if(this.nextRow+S>this.height)return o.w("LineAtlas out of space"),null;let F=0;for(let j=0;j<c.length;j++)F+=c[j];if(F!==0){const j=this.width/F,Z=this.getDashRanges(c,this.width,j);y?this.addRoundDash(Z,j,B):this.addRegularDash(Z)}const H={y:(this.nextRow+B+.5)/this.height,height:2*B/this.height,width:F};return this.nextRow+=S,this.dirty=!0,H}bind(c){const y=c.gl;this.texture?(y.bindTexture(y.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,y.texSubImage2D(y.TEXTURE_2D,0,0,0,this.width,this.height,y.ALPHA,y.UNSIGNED_BYTE,this.data))):(this.texture=y.createTexture(),y.bindTexture(y.TEXTURE_2D,this.texture),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,y.REPEAT),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,y.REPEAT),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,y.LINEAR),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,y.LINEAR),y.texImage2D(y.TEXTURE_2D,0,y.ALPHA,this.width,this.height,0,y.ALPHA,y.UNSIGNED_BYTE,this.data))}}const Bt="maplibre_preloaded_worker_pool";class St{constructor(){this.active={}}acquire(c){if(!this.workers)for(this.workers=[];this.workers.length<St.workerCount;)this.workers.push(new Worker(o.a.WORKER_URL));return this.active[c]=!0,this.workers.slice()}release(c){delete this.active[c],this.numActive()===0&&(this.workers.forEach(y=>{y.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Bt]}numActive(){return Object.keys(this.active).length}}const jt=Math.floor(x.hardwareConcurrency/2);let qt,nr;function ar(){return qt||(qt=new St),qt}St.workerCount=o.C(globalThis)?Math.max(Math.min(jt,3),1):1;class $r{constructor(c,y){this.workerPool=c,this.actors=[],this.currentActor=0,this.id=y;const B=this.workerPool.acquire(y);for(let S=0;S<B.length;S++){const F=new o.F(B[S],y);F.name=`Worker ${S}`,this.actors.push(F)}if(!this.actors.length)throw new Error("No actors found")}broadcast(c,y){const B=[];for(const S of this.actors)B.push(S.sendAsync({type:c,data:y}));return Promise.all(B)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){let c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.actors.forEach(y=>{y.remove()}),this.actors=[],c&&this.workerPool.release(this.id)}registerMessageHandler(c,y){for(const B of this.actors)B.registerMessageHandler(c,y)}}function kr(){return nr||(nr=new $r(ar(),o.G),nr.registerMessageHandler("GR",(E,c,y)=>o.m(c,y))),nr}function Gr(E,c){const y=o.H();return o.J(y,y,[1,1,0]),o.K(y,y,[.5*E.width,.5*E.height,1]),o.L(y,y,E.calculatePosMatrix(c.toUnwrapped()))}function sn(E,c,y,B,S,F){const H=function(ue,Te,Fe){if(ue)for(const Ee of ue){const Oe=Te[Ee];if(Oe&&Oe.source===Fe&&Oe.type==="fill-extrusion")return!0}else for(const Ee in Te){const Oe=Te[Ee];if(Oe.source===Fe&&Oe.type==="fill-extrusion")return!0}return!1}(S&&S.layers,c,E.id),j=F.maxPitchScaleFactor(),Z=E.tilesIn(B,j,H);Z.sort(on);const se=[];for(const ue of Z)se.push({wrappedTileID:ue.tileID.wrapped().key,queryResults:ue.tile.queryRenderedFeatures(c,y,E._state,ue.queryGeometry,ue.cameraQueryGeometry,ue.scale,S,F,j,Gr(E.transform,ue.tileID))});const he=function(ue){const Te={},Fe={};for(const Ee of ue){const Oe=Ee.queryResults,rt=Ee.wrappedTileID,qe=Fe[rt]=Fe[rt]||{};for(const Ze in Oe){const ot=Oe[Ze],vt=qe[Ze]=qe[Ze]||{},kt=Te[Ze]=Te[Ze]||[];for(const It of ot)vt[It.featureIndex]||(vt[It.featureIndex]=!0,kt.push(It))}}return Te}(se);for(const ue in he)he[ue].forEach(Te=>{const Fe=Te.feature,Ee=E.getFeatureState(Fe.layer["source-layer"],Fe.id);Fe.source=Fe.layer.source,Fe.layer["source-layer"]&&(Fe.sourceLayer=Fe.layer["source-layer"]),Fe.state=Ee});return he}function on(E,c){const y=E.tileID,B=c.tileID;return y.overscaledZ-B.overscaledZ||y.canonical.y-B.canonical.y||y.wrap-B.wrap||y.canonical.x-B.canonical.x}function pr(E,c,y){return o._(this,void 0,void 0,function*(){let B=E;if(E.url?B=(yield o.h(c.transformRequest(E.url,"Source"),y)).data:yield x.frameAsync(y),!B)return null;const S=o.M(o.e(B,E),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in B&&B.vector_layers&&(S.vectorLayerIds=B.vector_layers.map(F=>F.id)),S})}class We{constructor(c,y){c&&(y?this.setSouthWest(c).setNorthEast(y):Array.isArray(c)&&(c.length===4?this.setSouthWest([c[0],c[1]]).setNorthEast([c[2],c[3]]):this.setSouthWest(c[0]).setNorthEast(c[1])))}setNorthEast(c){return this._ne=c instanceof o.N?new o.N(c.lng,c.lat):o.N.convert(c),this}setSouthWest(c){return this._sw=c instanceof o.N?new o.N(c.lng,c.lat):o.N.convert(c),this}extend(c){const y=this._sw,B=this._ne;let S,F;if(c instanceof o.N)S=c,F=c;else{if(!(c instanceof We))return Array.isArray(c)?c.length===4||c.every(Array.isArray)?this.extend(We.convert(c)):this.extend(o.N.convert(c)):c&&("lng"in c||"lon"in c)&&"lat"in c?this.extend(o.N.convert(c)):this;if(S=c._sw,F=c._ne,!S||!F)return this}return y||B?(y.lng=Math.min(S.lng,y.lng),y.lat=Math.min(S.lat,y.lat),B.lng=Math.max(F.lng,B.lng),B.lat=Math.max(F.lat,B.lat)):(this._sw=new o.N(S.lng,S.lat),this._ne=new o.N(F.lng,F.lat)),this}getCenter(){return new o.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new o.N(this.getWest(),this.getNorth())}getSouthEast(){return new o.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(c){const{lng:y,lat:B}=o.N.convert(c);let S=this._sw.lng<=y&&y<=this._ne.lng;return this._sw.lng>this._ne.lng&&(S=this._sw.lng>=y&&y>=this._ne.lng),this._sw.lat<=B&&B<=this._ne.lat&&S}static convert(c){return c instanceof We?c:c&&new We(c)}static fromLngLat(c){const B=360*(arguments.length>1&&arguments[1]!==void 0?arguments[1]:0)/40075017,S=B/Math.cos(Math.PI/180*c.lat);return new We(new o.N(c.lng-S,c.lat-B),new o.N(c.lng+S,c.lat+B))}adjustAntiMeridian(){const c=new o.N(this._sw.lng,this._sw.lat),y=new o.N(this._ne.lng,this._ne.lat);return new We(c,c.lng>y.lng?new o.N(y.lng+360,y.lat):y)}}class Pn{constructor(c,y,B){this.bounds=We.convert(this.validateBounds(c)),this.minzoom=y||0,this.maxzoom=B||24}validateBounds(c){return Array.isArray(c)&&c.length===4?[Math.max(-180,c[0]),Math.max(-90,c[1]),Math.min(180,c[2]),Math.min(90,c[3])]:[-180,-90,180,90]}contains(c){const y=Math.pow(2,c.z),B=Math.floor(o.O(this.bounds.getWest())*y),S=Math.floor(o.Q(this.bounds.getNorth())*y),F=Math.ceil(o.O(this.bounds.getEast())*y),H=Math.ceil(o.Q(this.bounds.getSouth())*y);return c.x>=B&&c.x<F&&c.y>=S&&c.y<H}}class mn extends o.E{constructor(c,y,B,S){if(super(),this.id=c,this.dispatcher=B,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.e(this,o.M(y,["url","scheme","tileSize","promoteId"])),this._options=o.e({type:"vector"},y),this._collectResourceTiming=y.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(S)}load(){return o._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new o.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const c=yield pr(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),c&&(o.e(this,c),c.bounds&&(this.tileBounds=new Pn(c.bounds,this.minzoom,this.maxzoom)),this.fire(new o.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.k("data",{dataType:"source",sourceDataType:"content"})))}catch(c){this._tileJSONRequest=null,this.fire(new o.j(c))}})}loaded(){return this._loaded}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}onAdd(c){this.map=c,this.load()}setSourceProperty(c){this._tileJSONRequest&&this._tileJSONRequest.abort(),c(),this.load()}setTiles(c){return this.setSourceProperty(()=>{this._options.tiles=c}),this}setUrl(c){return this.setSourceProperty(()=>{this.url=c,this._options.url=c}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return o.e({},this._options)}loadTile(c){return o._(this,void 0,void 0,function*(){const y=c.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),B={request:this.map._requestManager.transformRequest(y,"Tile"),uid:c.uid,tileID:c.tileID,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};B.request.collectResourceTiming=this._collectResourceTiming;let S="RT";if(c.actor&&c.state!=="expired"){if(c.state==="loading")return new Promise((F,H)=>{c.reloadPromise={resolve:F,reject:H}})}else c.actor=this.dispatcher.getActor(),S="LT";c.abortController=new AbortController;try{const F=yield c.actor.sendAsync({type:S,data:B},c.abortController);if(delete c.abortController,c.aborted)return;this._afterTileLoadWorkerResponse(c,F)}catch(F){if(delete c.abortController,c.aborted)return;if(F&&F.status!==404)throw F;this._afterTileLoadWorkerResponse(c,null)}})}_afterTileLoadWorkerResponse(c,y){if(y&&y.resourceTiming&&(c.resourceTiming=y.resourceTiming),y&&this.map._refreshExpiredTiles&&c.setExpiryData(y),c.loadVectorData(y,this.map.painter),c.reloadPromise){const B=c.reloadPromise;c.reloadPromise=null,this.loadTile(c).then(B.resolve).catch(B.reject)}}abortTile(c){return o._(this,void 0,void 0,function*(){c.abortController&&(c.abortController.abort(),delete c.abortController),c.actor&&(yield c.actor.sendAsync({type:"AT",data:{uid:c.uid,type:this.type,source:this.id}}))})}unloadTile(c){return o._(this,void 0,void 0,function*(){c.unloadVectorData(),c.actor&&(yield c.actor.sendAsync({type:"RMT",data:{uid:c.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class mr extends o.E{constructor(c,y,B,S){super(),this.id=c,this.dispatcher=B,this.setEventedParent(S),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.e({type:"raster"},y),o.e(this,o.M(y,["url","scheme","tileSize"]))}load(){return o._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new o.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const c=yield pr(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,c&&(o.e(this,c),c.bounds&&(this.tileBounds=new Pn(c.bounds,this.minzoom,this.maxzoom)),this.fire(new o.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.k("data",{dataType:"source",sourceDataType:"content"})))}catch(c){this._tileJSONRequest=null,this.fire(new o.j(c))}})}loaded(){return this._loaded}onAdd(c){this.map=c,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(c){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),c(),this.load()}setTiles(c){return this.setSourceProperty(()=>{this._options.tiles=c}),this}setUrl(c){return this.setSourceProperty(()=>{this.url=c,this._options.url=c}),this}serialize(){return o.e({},this._options)}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}loadTile(c){return o._(this,void 0,void 0,function*(){const y=c.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);c.abortController=new AbortController;try{const B=yield ce.getImage(this.map._requestManager.transformRequest(y,"Tile"),c.abortController,this.map._refreshExpiredTiles);if(delete c.abortController,c.aborted)return void(c.state="unloaded");if(B&&B.data){this.map._refreshExpiredTiles&&B.cacheControl&&B.expires&&c.setExpiryData({cacheControl:B.cacheControl,expires:B.expires});const S=this.map.painter.context,F=S.gl,H=B.data;c.texture=this.map.painter.getTileTexture(H.width),c.texture?c.texture.update(H,{useMipmap:!0}):(c.texture=new Le(S,H,F.RGBA,{useMipmap:!0}),c.texture.bind(F.LINEAR,F.CLAMP_TO_EDGE,F.LINEAR_MIPMAP_NEAREST)),c.state="loaded"}}catch(B){if(delete c.abortController,c.aborted)c.state="unloaded";else if(B)throw c.state="errored",B}})}abortTile(c){return o._(this,void 0,void 0,function*(){c.abortController&&(c.abortController.abort(),delete c.abortController)})}unloadTile(c){return o._(this,void 0,void 0,function*(){c.texture&&this.map.painter.saveTileTexture(c.texture)})}hasTransition(){return!1}}class Mr extends mr{constructor(c,y,B,S){super(c,y,B,S),this.type="raster-dem",this.maxzoom=22,this._options=o.e({type:"raster-dem"},y),this.encoding=y.encoding||"mapbox",this.redFactor=y.redFactor,this.greenFactor=y.greenFactor,this.blueFactor=y.blueFactor,this.baseShift=y.baseShift}loadTile(c){return o._(this,void 0,void 0,function*(){const y=c.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),B=this.map._requestManager.transformRequest(y,"Tile");c.neighboringTiles=this._getNeighboringTiles(c.tileID),c.abortController=new AbortController;try{const S=yield ce.getImage(B,c.abortController,this.map._refreshExpiredTiles);if(delete c.abortController,c.aborted)return void(c.state="unloaded");if(S&&S.data){const F=S.data;this.map._refreshExpiredTiles&&S.cacheControl&&S.expires&&c.setExpiryData({cacheControl:S.cacheControl,expires:S.expires});const H=o.b(F)&&o.U()?F:yield this.readImageNow(F),j={type:this.type,uid:c.uid,source:this.id,rawImageData:H,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!c.actor||c.state==="expired"){c.actor=this.dispatcher.getActor();const Z=yield c.actor.sendAsync({type:"LDT",data:j});c.dem=Z,c.needsHillshadePrepare=!0,c.needsTerrainPrepare=!0,c.state="loaded"}}}catch(S){if(delete c.abortController,c.aborted)c.state="unloaded";else if(S)throw c.state="errored",S}})}readImageNow(c){return o._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&o.V()){const y=c.width+2,B=c.height+2;try{return new o.R({width:y,height:B},yield o.W(c,-1,-1,y,B))}catch{}}return x.getImageData(c,1)})}_getNeighboringTiles(c){const y=c.canonical,B=Math.pow(2,y.z),S=(y.x-1+B)%B,F=y.x===0?c.wrap-1:c.wrap,H=(y.x+1+B)%B,j=y.x+1===B?c.wrap+1:c.wrap,Z={};return Z[new o.S(c.overscaledZ,F,y.z,S,y.y).key]={backfilled:!1},Z[new o.S(c.overscaledZ,j,y.z,H,y.y).key]={backfilled:!1},y.y>0&&(Z[new o.S(c.overscaledZ,F,y.z,S,y.y-1).key]={backfilled:!1},Z[new o.S(c.overscaledZ,c.wrap,y.z,y.x,y.y-1).key]={backfilled:!1},Z[new o.S(c.overscaledZ,j,y.z,H,y.y-1).key]={backfilled:!1}),y.y+1<B&&(Z[new o.S(c.overscaledZ,F,y.z,S,y.y+1).key]={backfilled:!1},Z[new o.S(c.overscaledZ,c.wrap,y.z,y.x,y.y+1).key]={backfilled:!1},Z[new o.S(c.overscaledZ,j,y.z,H,y.y+1).key]={backfilled:!1}),Z}unloadTile(c){return o._(this,void 0,void 0,function*(){c.demTexture&&this.map.painter.saveTileTexture(c.demTexture),c.fbo&&(c.fbo.destroy(),delete c.fbo),c.dem&&delete c.dem,delete c.neighboringTiles,c.state="unloaded",c.actor&&(yield c.actor.sendAsync({type:"RDT",data:{type:this.type,uid:c.uid,source:this.id}}))})}}class en extends o.E{constructor(c,y,B,S){super(),this.id=c,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=B.getActor(),this.setEventedParent(S),this._data=y.data,this._options=o.e({},y),this._collectResourceTiming=y.collectResourceTiming,y.maxzoom!==void 0&&(this.maxzoom=y.maxzoom),y.type&&(this.type=y.type),y.attribution&&(this.attribution=y.attribution),this.promoteId=y.promoteId;const F=o.X/this.tileSize;y.clusterMaxZoom!==void 0&&this.maxzoom<=y.clusterMaxZoom&&o.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${y.clusterMaxZoom}".`),this.workerOptions=o.e({source:this.id,cluster:y.cluster||!1,geojsonVtOptions:{buffer:(y.buffer!==void 0?y.buffer:128)*F,tolerance:(y.tolerance!==void 0?y.tolerance:.375)*F,extent:o.X,maxZoom:this.maxzoom,lineMetrics:y.lineMetrics||!1,generateId:y.generateId||!1},superclusterOptions:{maxZoom:y.clusterMaxZoom!==void 0?y.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,y.clusterMinPoints||2),extent:o.X,radius:(y.clusterRadius||50)*F,log:!1,generateId:y.generateId||!1},clusterProperties:y.clusterProperties,filter:y.filter},y.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return o._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(c){this.map=c,this.load()}setData(c){return this._data=c,this._updateWorkerData(),this}updateData(c){return this._updateWorkerData(c),this}getData(){return o._(this,void 0,void 0,function*(){const c=o.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:c})})}setClusterOptions(c){return this.workerOptions.cluster=c.cluster,c&&(c.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=c.clusterRadius),c.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=c.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(c){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:c,source:this.id}})}getClusterChildren(c){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:c,source:this.id}})}getClusterLeaves(c,y,B){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:c,limit:y,offset:B}})}_updateWorkerData(c){return o._(this,void 0,void 0,function*(){const y=o.e({type:this.type},this.workerOptions);c?y.dataDiff=c:typeof this._data=="string"?(y.request=this.map._requestManager.transformRequest(x.resolveURL(this._data),"Source"),y.request.collectResourceTiming=this._collectResourceTiming):y.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new o.k("dataloading",{dataType:"source"}));try{const B=yield this.actor.sendAsync({type:"LD",data:y});if(this._pendingLoads--,this._removed||B.abandoned)return void this.fire(new o.k("dataabort",{dataType:"source"}));let S=null;B.resourceTiming&&B.resourceTiming[this.id]&&(S=B.resourceTiming[this.id].slice(0));const F={dataType:"source"};this._collectResourceTiming&&S&&S.length>0&&o.e(F,{resourceTiming:S}),this.fire(new o.k("data",Object.assign(Object.assign({},F),{sourceDataType:"metadata"}))),this.fire(new o.k("data",Object.assign(Object.assign({},F),{sourceDataType:"content"})))}catch(B){if(this._pendingLoads--,this._removed)return void this.fire(new o.k("dataabort",{dataType:"source"}));this.fire(new o.j(B))}})}loaded(){return this._pendingLoads===0}loadTile(c){return o._(this,void 0,void 0,function*(){const y=c.actor?"RT":"LT";c.actor=this.actor;const B={type:this.type,uid:c.uid,tileID:c.tileID,zoom:c.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};c.abortController=new AbortController;const S=yield this.actor.sendAsync({type:y,data:B},c.abortController);delete c.abortController,c.unloadVectorData(),c.aborted||c.loadVectorData(S,this.map.painter,y==="RT")})}abortTile(c){return o._(this,void 0,void 0,function*(){c.abortController&&(c.abortController.abort(),delete c.abortController),c.aborted=!0})}unloadTile(c){return o._(this,void 0,void 0,function*(){c.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:c.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return o.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Wr=o.Y([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class gn extends o.E{constructor(c,y,B,S){super(),this.id=c,this.dispatcher=B,this.coordinates=y.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(S),this.options=y}load(c){return o._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new o.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const y=yield ce.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,y&&y.data&&(this.image=y.data,c&&(this.coordinates=c),this._finishLoading())}catch(y){this._request=null,this._loaded=!0,this.fire(new o.j(y))}})}loaded(){return this._loaded}updateImage(c){return c.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=c.url,this.load(c.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(c){this.map=c,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(c){this.coordinates=c;const y=c.map(o.Z.fromLngLat);this.tileID=function(S){let F=1/0,H=1/0,j=-1/0,Z=-1/0;for(const Te of S)F=Math.min(F,Te.x),H=Math.min(H,Te.y),j=Math.max(j,Te.x),Z=Math.max(Z,Te.y);const se=Math.max(j-F,Z-H),he=Math.max(0,Math.floor(-Math.log(se)/Math.LN2)),ue=Math.pow(2,he);return new o.a1(he,Math.floor((F+j)/2*ue),Math.floor((H+Z)/2*ue))}(y),this.minzoom=this.maxzoom=this.tileID.z;const B=y.map(S=>this.tileID.getTilePoint(S)._round());return this._boundsArray=new o.$,this._boundsArray.emplaceBack(B[0].x,B[0].y,0,0),this._boundsArray.emplaceBack(B[1].x,B[1].y,o.X,0),this._boundsArray.emplaceBack(B[3].x,B[3].y,0,o.X),this._boundsArray.emplaceBack(B[2].x,B[2].y,o.X,o.X),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new o.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const c=this.map.painter.context,y=c.gl;this.boundsBuffer||(this.boundsBuffer=c.createVertexBuffer(this._boundsArray,Wr.members)),this.boundsSegments||(this.boundsSegments=o.a0.simpleSegment(0,0,4,2)),this.texture||(this.texture=new Le(c,this.image,y.RGBA),this.texture.bind(y.LINEAR,y.CLAMP_TO_EDGE));let B=!1;for(const S in this.tiles){const F=this.tiles[S];F.state!=="loaded"&&(F.state="loaded",F.texture=this.texture,B=!0)}B&&this.fire(new o.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(c){return o._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(c.tileID.canonical)?(this.tiles[String(c.tileID.wrap)]=c,c.buckets={}):c.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Bn extends gn{constructor(c,y,B,S){super(c,y,B,S),this.roundZoom=!0,this.type="video",this.options=y}load(){return o._(this,void 0,void 0,function*(){this._loaded=!1;const c=this.options;this.urls=[];for(const y of c.urls)this.urls.push(this.map._requestManager.transformRequest(y,"Source").url);try{const y=yield o.a3(this.urls);if(this._loaded=!0,!y)return;this.video=y,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(y){this.fire(new o.j(y))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(c){if(this.video){const y=this.video.seekable;c<y.start(0)||c>y.end(0)?this.fire(new o.j(new o.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${y.start(0)} and ${y.end(0)}-second mark.`))):this.video.currentTime=c}}getVideo(){return this.video}onAdd(c){this.map||(this.map=c,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const c=this.map.painter.context,y=c.gl;this.boundsBuffer||(this.boundsBuffer=c.createVertexBuffer(this._boundsArray,Wr.members)),this.boundsSegments||(this.boundsSegments=o.a0.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(y.LINEAR,y.CLAMP_TO_EDGE),y.texSubImage2D(y.TEXTURE_2D,0,0,0,y.RGBA,y.UNSIGNED_BYTE,this.video)):(this.texture=new Le(c,this.video,y.RGBA),this.texture.bind(y.LINEAR,y.CLAMP_TO_EDGE));let B=!1;for(const S in this.tiles){const F=this.tiles[S];F.state!=="loaded"&&(F.state="loaded",F.texture=this.texture,B=!0)}B&&this.fire(new o.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Fn extends gn{constructor(c,y,B,S){super(c,y,B,S),y.coordinates?Array.isArray(y.coordinates)&&y.coordinates.length===4&&!y.coordinates.some(F=>!Array.isArray(F)||F.length!==2||F.some(H=>typeof H!="number"))||this.fire(new o.j(new o.a2(`sources.${c}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.j(new o.a2(`sources.${c}`,null,'missing required property "coordinates"'))),y.animate&&typeof y.animate!="boolean"&&this.fire(new o.j(new o.a2(`sources.${c}`,null,'optional "animate" property must be a boolean value'))),y.canvas?typeof y.canvas=="string"||y.canvas instanceof HTMLCanvasElement||this.fire(new o.j(new o.a2(`sources.${c}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.j(new o.a2(`sources.${c}`,null,'missing required property "canvas"'))),this.options=y,this.animate=y.animate===void 0||y.animate}load(){return o._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(c){this.map=c,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let c=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,c=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,c=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const y=this.map.painter.context,B=y.gl;this.boundsBuffer||(this.boundsBuffer=y.createVertexBuffer(this._boundsArray,Wr.members)),this.boundsSegments||(this.boundsSegments=o.a0.simpleSegment(0,0,4,2)),this.texture?(c||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Le(y,this.canvas,B.RGBA,{premultiply:!0});let S=!1;for(const F in this.tiles){const H=this.tiles[F];H.state!=="loaded"&&(H.state="loaded",H.texture=this.texture,S=!0)}S&&this.fire(new o.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const c of[this.canvas.width,this.canvas.height])if(isNaN(c)||c<=0)return!0;return!1}}const $n={},ei=E=>{switch(E){case"geojson":return en;case"image":return gn;case"raster":return mr;case"raster-dem":return Mr;case"vector":return mn;case"video":return Bn;case"canvas":return Fn}return $n[E]},br="RTLPluginLoaded";class Cn extends o.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=kr()}_syncState(c){return this.status=c,this.dispatcher.broadcast("SRPS",{pluginStatus:c,pluginURL:this.url}).catch(y=>{throw this.status="error",y})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(c){return o._(this,arguments,void 0,function(y){var B=this;let S=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return function*(){if(B.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(B.url=x.resolveURL(y),!B.url)throw new Error(`requested url ${y} is invalid`);if(B.status==="unavailable"){if(!S)return B._requestImport();B.status="deferred",B._syncState(B.status)}else if(B.status==="requested")return B._requestImport()}()})}_requestImport(){return o._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new o.k(br))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Rn=null;function nn(){return Rn||(Rn=new Cn),Rn}class Ci{constructor(c,y){this.timeAdded=0,this.fadeEndTime=0,this.tileID=c,this.uid=o.a4(),this.uses=0,this.tileSize=y,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(c){const y=c+this.timeAdded;y<this.fadeEndTime||(this.fadeEndTime=y)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(c){this.demTexture&&c.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(c,y,B){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",c){c.featureIndex&&(this.latestFeatureIndex=c.featureIndex,c.rawTileData?(this.latestRawTileData=c.rawTileData,this.latestFeatureIndex.rawTileData=c.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=c.collisionBoxArray,this.buckets=function(S,F){const H={};if(!F)return H;for(const j of S){const Z=j.layerIds.map(se=>F.getLayer(se)).filter(Boolean);if(Z.length!==0){j.layers=Z,j.stateDependentLayerIds&&(j.stateDependentLayers=j.stateDependentLayerIds.map(se=>Z.filter(he=>he.id===se)[0]));for(const se of Z)H[se.id]=j}}return H}(c.buckets,y.style),this.hasSymbolBuckets=!1;for(const S in this.buckets){const F=this.buckets[S];if(F instanceof o.a6){if(this.hasSymbolBuckets=!0,!B)break;F.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const S in this.buckets){const F=this.buckets[S];if(F instanceof o.a6&&F.hasRTLText){this.hasRTLText=!0,nn().lazyLoad();break}}this.queryPadding=0;for(const S in this.buckets){const F=this.buckets[S];this.queryPadding=Math.max(this.queryPadding,y.style.getLayer(S).queryRadius(F))}c.imageAtlas&&(this.imageAtlas=c.imageAtlas),c.glyphAtlasImage&&(this.glyphAtlasImage=c.glyphAtlasImage)}else this.collisionBoxArray=new o.a5}unloadVectorData(){for(const c in this.buckets)this.buckets[c].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(c){return this.buckets[c.id]}upload(c){for(const B in this.buckets){const S=this.buckets[B];S.uploadPending()&&S.upload(c)}const y=c.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Le(c,this.imageAtlas.image,y.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Le(c,this.glyphAtlasImage,y.ALPHA),this.glyphAtlasImage=null)}prepare(c){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(c,this.imageAtlasTexture)}queryRenderedFeatures(c,y,B,S,F,H,j,Z,se,he){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:S,cameraQueryGeometry:F,scale:H,tileSize:this.tileSize,pixelPosMatrix:he,transform:Z,params:j,queryPadding:this.queryPadding*se},c,y,B):{}}querySourceFeatures(c,y){const B=this.latestFeatureIndex;if(!B||!B.rawTileData)return;const S=B.loadVTLayers(),F=y&&y.sourceLayer?y.sourceLayer:"",H=S._geojsonTileLayer||S[F];if(!H)return;const j=o.a7(y&&y.filter),{z:Z,x:se,y:he}=this.tileID.canonical,ue={z:Z,x:se,y:he};for(let Te=0;Te<H.length;Te++){const Fe=H.feature(Te);if(j.needGeometry){const rt=o.a8(Fe,!0);if(!j.filter(new o.z(this.tileID.overscaledZ),rt,this.tileID.canonical))continue}else if(!j.filter(new o.z(this.tileID.overscaledZ),Fe))continue;const Ee=B.getId(Fe,F),Oe=new o.a9(Fe,Z,se,he,Ee);Oe.tile=ue,c.push(Oe)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(c){const y=this.expirationTime;if(c.cacheControl){const B=o.aa(c.cacheControl);B["max-age"]&&(this.expirationTime=Date.now()+1e3*B["max-age"])}else c.expires&&(this.expirationTime=new Date(c.expires).getTime());if(this.expirationTime){const B=Date.now();let S=!1;if(this.expirationTime>B)S=!1;else if(y)if(this.expirationTime<y)S=!0;else{const F=this.expirationTime-y;F?this.expirationTime=B+Math.max(F,3e4):S=!0}else S=!0;S?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(c,y){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(c).length===0)return;const B=this.latestFeatureIndex.loadVTLayers();for(const S in this.buckets){if(!y.style.hasLayer(S))continue;const F=this.buckets[S],H=F.layers[0].sourceLayer||"_geojsonTileLayer",j=B[H],Z=c[H];if(!j||!Z||Object.keys(Z).length===0)continue;F.update(Z,j,this.imageAtlas&&this.imageAtlas.patternPositions||{});const se=y&&y.style&&y.style.getLayer(S);se&&(this.queryPadding=Math.max(this.queryPadding,se.queryRadius(F)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<x.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(c){this.symbolFadeHoldUntil=x.now()+c}setDependencies(c,y){const B={};for(const S of y)B[S]=!0;this.dependencies[c]=B}hasDependency(c,y){for(const B of c){const S=this.dependencies[B];if(S){for(const F of y)if(S[F])return!0}}return!1}}class Cr{constructor(c,y){this.max=c,this.onRemove=y,this.reset()}reset(){for(const c in this.data)for(const y of this.data[c])y.timeout&&clearTimeout(y.timeout),this.onRemove(y.value);return this.data={},this.order=[],this}add(c,y,B){const S=c.wrapped().key;this.data[S]===void 0&&(this.data[S]=[]);const F={value:y,timeout:void 0};if(B!==void 0&&(F.timeout=setTimeout(()=>{this.remove(c,F)},B)),this.data[S].push(F),this.order.push(S),this.order.length>this.max){const H=this._getAndRemoveByKey(this.order[0]);H&&this.onRemove(H)}return this}has(c){return c.wrapped().key in this.data}getAndRemove(c){return this.has(c)?this._getAndRemoveByKey(c.wrapped().key):null}_getAndRemoveByKey(c){const y=this.data[c].shift();return y.timeout&&clearTimeout(y.timeout),this.data[c].length===0&&delete this.data[c],this.order.splice(this.order.indexOf(c),1),y.value}getByKey(c){const y=this.data[c];return y?y[0].value:null}get(c){return this.has(c)?this.data[c.wrapped().key][0].value:null}remove(c,y){if(!this.has(c))return this;const B=c.wrapped().key,S=y===void 0?0:this.data[B].indexOf(y),F=this.data[B][S];return this.data[B].splice(S,1),F.timeout&&clearTimeout(F.timeout),this.data[B].length===0&&delete this.data[B],this.onRemove(F.value),this.order.splice(this.order.indexOf(B),1),this}setMaxSize(c){for(this.max=c;this.order.length>this.max;){const y=this._getAndRemoveByKey(this.order[0]);y&&this.onRemove(y)}return this}filter(c){const y=[];for(const B in this.data)for(const S of this.data[B])c(S.value)||y.push(S);for(const B of y)this.remove(B.value.tileID,B)}}class Tn{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(c,y,B){const S=String(y);if(this.stateChanges[c]=this.stateChanges[c]||{},this.stateChanges[c][S]=this.stateChanges[c][S]||{},o.e(this.stateChanges[c][S],B),this.deletedStates[c]===null){this.deletedStates[c]={};for(const F in this.state[c])F!==S&&(this.deletedStates[c][F]=null)}else if(this.deletedStates[c]&&this.deletedStates[c][S]===null){this.deletedStates[c][S]={};for(const F in this.state[c][S])B[F]||(this.deletedStates[c][S][F]=null)}else for(const F in B)this.deletedStates[c]&&this.deletedStates[c][S]&&this.deletedStates[c][S][F]===null&&delete this.deletedStates[c][S][F]}removeFeatureState(c,y,B){if(this.deletedStates[c]===null)return;const S=String(y);if(this.deletedStates[c]=this.deletedStates[c]||{},B&&y!==void 0)this.deletedStates[c][S]!==null&&(this.deletedStates[c][S]=this.deletedStates[c][S]||{},this.deletedStates[c][S][B]=null);else if(y!==void 0)if(this.stateChanges[c]&&this.stateChanges[c][S])for(B in this.deletedStates[c][S]={},this.stateChanges[c][S])this.deletedStates[c][S][B]=null;else this.deletedStates[c][S]=null;else this.deletedStates[c]=null}getState(c,y){const B=String(y),S=o.e({},(this.state[c]||{})[B],(this.stateChanges[c]||{})[B]);if(this.deletedStates[c]===null)return{};if(this.deletedStates[c]){const F=this.deletedStates[c][y];if(F===null)return{};for(const H in F)delete S[H]}return S}initializeTileState(c,y){c.setFeatureState(this.state,y)}coalesceChanges(c,y){const B={};for(const S in this.stateChanges){this.state[S]=this.state[S]||{};const F={};for(const H in this.stateChanges[S])this.state[S][H]||(this.state[S][H]={}),o.e(this.state[S][H],this.stateChanges[S][H]),F[H]=this.state[S][H];B[S]=F}for(const S in this.deletedStates){this.state[S]=this.state[S]||{};const F={};if(this.deletedStates[S]===null)for(const H in this.state[S])F[H]={},this.state[S][H]={};else for(const H in this.deletedStates[S]){if(this.deletedStates[S][H]===null)this.state[S][H]={};else for(const j of Object.keys(this.deletedStates[S][H]))delete this.state[S][H][j];F[H]=this.state[S][H]}B[S]=B[S]||{},o.e(B[S],F)}if(this.stateChanges={},this.deletedStates={},Object.keys(B).length!==0)for(const S in c)c[S].setFeatureState(B,y)}}class Xe extends o.E{constructor(c,y,B){super(),this.id=c,this.dispatcher=B,this.on("data",S=>this._dataHandler(S)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((S,F,H,j)=>{const Z=new(ei(F.type))(S,F,H,j);if(Z.id!==S)throw new Error(`Expected Source id to be ${S} instead of ${Z.id}`);return Z})(c,y,B,this),this._tiles={},this._cache=new Cr(0,S=>this._unloadTile(S)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Tn,this._didEmitContent=!1,this._updated=!1}onAdd(c){this.map=c,this._maxTileCacheSize=c?c._maxTileCacheSize:null,this._maxTileCacheZoomLevels=c?c._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(c)}onRemove(c){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(c)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const c in this._tiles){const y=this._tiles[c];if(y.state!=="loaded"&&y.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const c=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,c&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(c,y,B){return o._(this,void 0,void 0,function*(){try{yield this._source.loadTile(c),this._tileLoaded(c,y,B)}catch(S){c.state="errored",S.status!==404?this._source.fire(new o.j(S,{tile:c})):this.update(this.transform,this.terrain)}})}_unloadTile(c){this._source.unloadTile&&this._source.unloadTile(c)}_abortTile(c){this._source.abortTile&&this._source.abortTile(c),this._source.fire(new o.k("dataabort",{tile:c,coord:c.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(c){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const y in this._tiles){const B=this._tiles[y];B.upload(c),B.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(c=>c.tileID).sort(He).map(c=>c.key)}getRenderableIds(c){const y=[];for(const B in this._tiles)this._isIdRenderable(B,c)&&y.push(this._tiles[B]);return c?y.sort((B,S)=>{const F=B.tileID,H=S.tileID,j=new o.P(F.canonical.x,F.canonical.y)._rotate(this.transform.angle),Z=new o.P(H.canonical.x,H.canonical.y)._rotate(this.transform.angle);return F.overscaledZ-H.overscaledZ||Z.y-j.y||Z.x-j.x}).map(B=>B.tileID.key):y.map(B=>B.tileID).sort(He).map(B=>B.key)}hasRenderableParent(c){const y=this.findLoadedParent(c,0);return!!y&&this._isIdRenderable(y.tileID.key)}_isIdRenderable(c,y){return this._tiles[c]&&this._tiles[c].hasData()&&!this._coveredTiles[c]&&(y||!this._tiles[c].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const c in this._tiles)this._tiles[c].state!=="errored"&&this._reloadTile(c,"reloading")}}_reloadTile(c,y){return o._(this,void 0,void 0,function*(){const B=this._tiles[c];B&&(B.state!=="loading"&&(B.state=y),yield this._loadTile(B,c,y))})}_tileLoaded(c,y,B){c.timeAdded=x.now(),B==="expired"&&(c.refreshedUponExpiration=!0),this._setTileReloadTimer(y,c),this.getSource().type==="raster-dem"&&c.dem&&this._backfillDEM(c),this._state.initializeTileState(c,this.map?this.map.painter:null),c.aborted||this._source.fire(new o.k("data",{dataType:"source",tile:c,coord:c.tileID}))}_backfillDEM(c){const y=this.getRenderableIds();for(let S=0;S<y.length;S++){const F=y[S];if(c.neighboringTiles&&c.neighboringTiles[F]){const H=this.getTileByID(F);B(c,H),B(H,c)}}function B(S,F){S.needsHillshadePrepare=!0,S.needsTerrainPrepare=!0;let H=F.tileID.canonical.x-S.tileID.canonical.x;const j=F.tileID.canonical.y-S.tileID.canonical.y,Z=Math.pow(2,S.tileID.canonical.z),se=F.tileID.key;H===0&&j===0||Math.abs(j)>1||(Math.abs(H)>1&&(Math.abs(H+Z)===1?H+=Z:Math.abs(H-Z)===1&&(H-=Z)),F.dem&&S.dem&&(S.dem.backfillBorder(F.dem,H,j),S.neighboringTiles&&S.neighboringTiles[se]&&(S.neighboringTiles[se].backfilled=!0)))}}getTile(c){return this.getTileByID(c.key)}getTileByID(c){return this._tiles[c]}_retainLoadedChildren(c,y,B,S){for(const F in this._tiles){let H=this._tiles[F];if(S[F]||!H.hasData()||H.tileID.overscaledZ<=y||H.tileID.overscaledZ>B)continue;let j=H.tileID;for(;H&&H.tileID.overscaledZ>y+1;){const se=H.tileID.scaledTo(H.tileID.overscaledZ-1);H=this._tiles[se.key],H&&H.hasData()&&(j=se)}let Z=j;for(;Z.overscaledZ>y;)if(Z=Z.scaledTo(Z.overscaledZ-1),c[Z.key]){S[j.key]=j;break}}}findLoadedParent(c,y){if(c.key in this._loadedParentTiles){const B=this._loadedParentTiles[c.key];return B&&B.tileID.overscaledZ>=y?B:null}for(let B=c.overscaledZ-1;B>=y;B--){const S=c.scaledTo(B),F=this._getLoadedTile(S);if(F)return F}}findLoadedSibling(c){return this._getLoadedTile(c)}_getLoadedTile(c){const y=this._tiles[c.key];return y&&y.hasData()?y:this._cache.getByKey(c.wrapped().key)}updateCacheSize(c){const y=Math.ceil(c.width/this._source.tileSize)+1,B=Math.ceil(c.height/this._source.tileSize)+1,S=Math.floor(y*B*(this._maxTileCacheZoomLevels===null?o.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),F=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,S):S;this._cache.setMaxSize(F)}handleWrapJump(c){const y=Math.round((c-(this._prevLng===void 0?c:this._prevLng))/360);if(this._prevLng=c,y){const B={};for(const S in this._tiles){const F=this._tiles[S];F.tileID=F.tileID.unwrapTo(F.tileID.wrap+y),B[F.tileID.key]=F}this._tiles=B;for(const S in this._timers)clearTimeout(this._timers[S]),delete this._timers[S];for(const S in this._tiles)this._setTileReloadTimer(S,this._tiles[S])}}_updateCoveredAndRetainedTiles(c,y,B,S,F,H){const j={},Z={},se=Object.keys(c),he=x.now();for(const ue of se){const Te=c[ue],Fe=this._tiles[ue];if(!Fe||Fe.fadeEndTime!==0&&Fe.fadeEndTime<=he)continue;const Ee=this.findLoadedParent(Te,y),Oe=this.findLoadedSibling(Te),rt=Ee||Oe||null;rt&&(this._addTile(rt.tileID),j[rt.tileID.key]=rt.tileID),Z[ue]=Te}this._retainLoadedChildren(Z,S,B,c);for(const ue in j)c[ue]||(this._coveredTiles[ue]=!0,c[ue]=j[ue]);if(H){const ue={},Te={};for(const Fe of F)this._tiles[Fe.key].hasData()?ue[Fe.key]=Fe:Te[Fe.key]=Fe;for(const Fe in Te){const Ee=Te[Fe].children(this._source.maxzoom);this._tiles[Ee[0].key]&&this._tiles[Ee[1].key]&&this._tiles[Ee[2].key]&&this._tiles[Ee[3].key]&&(ue[Ee[0].key]=c[Ee[0].key]=Ee[0],ue[Ee[1].key]=c[Ee[1].key]=Ee[1],ue[Ee[2].key]=c[Ee[2].key]=Ee[2],ue[Ee[3].key]=c[Ee[3].key]=Ee[3],delete Te[Fe])}for(const Fe in Te){const Ee=Te[Fe],Oe=this.findLoadedParent(Ee,this._source.minzoom),rt=this.findLoadedSibling(Ee),qe=Oe||rt||null;if(qe){ue[qe.tileID.key]=c[qe.tileID.key]=qe.tileID;for(const Ze in ue)ue[Ze].isChildOf(qe.tileID)&&delete ue[Ze]}}for(const Fe in this._tiles)ue[Fe]||(this._coveredTiles[Fe]=!0)}}update(c,y){if(!this._sourceLoaded||this._paused)return;let B;this.transform=c,this.terrain=y,this.updateCacheSize(c),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?B=c.getVisibleUnwrappedCoordinates(this._source.tileID).map(he=>new o.S(he.canonical.z,he.wrap,he.canonical.z,he.canonical.x,he.canonical.y)):(B=c.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:y}),this._source.hasTile&&(B=B.filter(he=>this._source.hasTile(he)))):B=[];const S=c.coveringZoomLevel(this._source),F=Math.max(S-Xe.maxOverzooming,this._source.minzoom),H=Math.max(S+Xe.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const he={};for(const ue of B)if(ue.canonical.z>this._source.minzoom){const Te=ue.scaledTo(ue.canonical.z-1);he[Te.key]=Te;const Fe=ue.scaledTo(Math.max(this._source.minzoom,Math.min(ue.canonical.z,5)));he[Fe.key]=Fe}B=B.concat(Object.values(he))}const j=B.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,j&&this.fire(new o.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const Z=this._updateRetainedTiles(B,S);Je(this._source.type)&&this._updateCoveredAndRetainedTiles(Z,F,H,S,B,y);for(const he in Z)this._tiles[he].clearFadeHold();const se=o.ab(this._tiles,Z);for(const he of se){const ue=this._tiles[he];ue.hasSymbolBuckets&&!ue.holdingForFade()?ue.setHoldDuration(this.map._fadeDuration):ue.hasSymbolBuckets&&!ue.symbolFadeFinished()||this._removeTile(he)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const c in this._tiles)this._tiles[c].holdingForFade()&&this._removeTile(c)}_updateRetainedTiles(c,y){var B;const S={},F={},H=Math.max(y-Xe.maxOverzooming,this._source.minzoom),j=Math.max(y+Xe.maxUnderzooming,this._source.minzoom),Z={};for(const se of c){const he=this._addTile(se);S[se.key]=se,he.hasData()||y<this._source.maxzoom&&(Z[se.key]=se)}this._retainLoadedChildren(Z,y,j,S);for(const se of c){let he=this._tiles[se.key];if(he.hasData())continue;if(y+1>this._source.maxzoom){const Te=se.children(this._source.maxzoom)[0],Fe=this.getTile(Te);if(Fe&&Fe.hasData()){S[Te.key]=Te;continue}}else{const Te=se.children(this._source.maxzoom);if(S[Te[0].key]&&S[Te[1].key]&&S[Te[2].key]&&S[Te[3].key])continue}let ue=he.wasRequested();for(let Te=se.overscaledZ-1;Te>=H;--Te){const Fe=se.scaledTo(Te);if(F[Fe.key])break;if(F[Fe.key]=!0,he=this.getTile(Fe),!he&&ue&&(he=this._addTile(Fe)),he){const Ee=he.hasData();if((Ee||!(!((B=this.map)===null||B===void 0)&&B.cancelPendingTileRequestsWhileZooming)||ue)&&(S[Fe.key]=Fe),ue=he.wasRequested(),Ee)break}}}return S}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const c in this._tiles){const y=[];let B,S=this._tiles[c].tileID;for(;S.overscaledZ>0;){if(S.key in this._loadedParentTiles){B=this._loadedParentTiles[S.key];break}y.push(S.key);const F=S.scaledTo(S.overscaledZ-1);if(B=this._getLoadedTile(F),B)break;S=F}for(const F of y)this._loadedParentTiles[F]=B}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const c in this._tiles){const y=this._tiles[c].tileID,B=this._getLoadedTile(y);this._loadedSiblingTiles[y.key]=B}}_addTile(c){let y=this._tiles[c.key];if(y)return y;y=this._cache.getAndRemove(c),y&&(this._setTileReloadTimer(c.key,y),y.tileID=c,this._state.initializeTileState(y,this.map?this.map.painter:null),this._cacheTimers[c.key]&&(clearTimeout(this._cacheTimers[c.key]),delete this._cacheTimers[c.key],this._setTileReloadTimer(c.key,y)));const B=y;return y||(y=new Ci(c,this._source.tileSize*c.overscaleFactor()),this._loadTile(y,c.key,y.state)),y.uses++,this._tiles[c.key]=y,B||this._source.fire(new o.k("dataloading",{tile:y,coord:y.tileID,dataType:"source"})),y}_setTileReloadTimer(c,y){c in this._timers&&(clearTimeout(this._timers[c]),delete this._timers[c]);const B=y.getExpiryTimeout();B&&(this._timers[c]=setTimeout(()=>{this._reloadTile(c,"expired"),delete this._timers[c]},B))}_removeTile(c){const y=this._tiles[c];y&&(y.uses--,delete this._tiles[c],this._timers[c]&&(clearTimeout(this._timers[c]),delete this._timers[c]),y.uses>0||(y.hasData()&&y.state!=="reloading"?this._cache.add(y.tileID,y,y.getExpiryTimeout()):(y.aborted=!0,this._abortTile(y),this._unloadTile(y))))}_dataHandler(c){const y=c.sourceDataType;c.dataType==="source"&&y==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&c.dataType==="source"&&y==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const c in this._tiles)this._removeTile(c);this._cache.reset()}tilesIn(c,y,B){const S=[],F=this.transform;if(!F)return S;const H=B?F.getCameraQueryGeometry(c):c,j=c.map(Ee=>F.pointCoordinate(Ee,this.terrain)),Z=H.map(Ee=>F.pointCoordinate(Ee,this.terrain)),se=this.getIds();let he=1/0,ue=1/0,Te=-1/0,Fe=-1/0;for(const Ee of Z)he=Math.min(he,Ee.x),ue=Math.min(ue,Ee.y),Te=Math.max(Te,Ee.x),Fe=Math.max(Fe,Ee.y);for(let Ee=0;Ee<se.length;Ee++){const Oe=this._tiles[se[Ee]];if(Oe.holdingForFade())continue;const rt=Oe.tileID,qe=Math.pow(2,F.zoom-Oe.tileID.overscaledZ),Ze=y*Oe.queryPadding*o.X/Oe.tileSize/qe,ot=[rt.getTilePoint(new o.Z(he,ue)),rt.getTilePoint(new o.Z(Te,Fe))];if(ot[0].x-Ze<o.X&&ot[0].y-Ze<o.X&&ot[1].x+Ze>=0&&ot[1].y+Ze>=0){const vt=j.map(It=>rt.getTilePoint(It)),kt=Z.map(It=>rt.getTilePoint(It));S.push({tile:Oe,tileID:rt,queryGeometry:vt,cameraQueryGeometry:kt,scale:qe})}}return S}getVisibleCoordinates(c){const y=this.getRenderableIds(c).map(B=>this._tiles[B].tileID);for(const B of y)B.posMatrix=this.transform.calculatePosMatrix(B.toUnwrapped());return y}hasTransition(){if(this._source.hasTransition())return!0;if(Je(this._source.type)){const c=x.now();for(const y in this._tiles)if(this._tiles[y].fadeEndTime>=c)return!0}return!1}setFeatureState(c,y,B){this._state.updateState(c=c||"_geojsonTileLayer",y,B)}removeFeatureState(c,y,B){this._state.removeFeatureState(c=c||"_geojsonTileLayer",y,B)}getFeatureState(c,y){return this._state.getState(c=c||"_geojsonTileLayer",y)}setDependencies(c,y,B){const S=this._tiles[c];S&&S.setDependencies(y,B)}reloadTilesForDependencies(c,y){for(const B in this._tiles)this._tiles[B].hasDependency(c,y)&&this._reloadTile(B,"reloading");this._cache.filter(B=>!B.hasDependency(c,y))}}function He(E,c){const y=Math.abs(2*E.wrap)-+(E.wrap<0),B=Math.abs(2*c.wrap)-+(c.wrap<0);return E.overscaledZ-c.overscaledZ||B-y||c.canonical.y-E.canonical.y||c.canonical.x-E.canonical.x}function Je(E){return E==="raster"||E==="image"||E==="video"}Xe.maxOverzooming=10,Xe.maxUnderzooming=3;class Ve{constructor(c,y){this.reset(c,y)}reset(c,y){this.points=c||[],this._distances=[0];for(let B=1;B<this.points.length;B++)this._distances[B]=this._distances[B-1]+this.points[B].dist(this.points[B-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(y||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(c){if(this.points.length===1)return this.points[0];c=o.ac(c,0,1);let y=1,B=this._distances[y];const S=c*this.paddedLength+this.padding;for(;B<S&&y<this._distances.length;)B=this._distances[++y];const F=y-1,H=this._distances[F],j=B-H,Z=j>0?(S-H)/j:0;return this.points[F].mult(1-Z).add(this.points[y].mult(Z))}}function bt(E,c){let y=!0;return E==="always"||E!=="never"&&c!=="never"||(y=!1),y}class Mt{constructor(c,y,B){const S=this.boxCells=[],F=this.circleCells=[];this.xCellCount=Math.ceil(c/B),this.yCellCount=Math.ceil(y/B);for(let H=0;H<this.xCellCount*this.yCellCount;H++)S.push([]),F.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=c,this.height=y,this.xScale=this.xCellCount/c,this.yScale=this.yCellCount/y,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(c,y,B,S,F){this._forEachCell(y,B,S,F,this._insertBoxCell,this.boxUid++),this.boxKeys.push(c),this.bboxes.push(y),this.bboxes.push(B),this.bboxes.push(S),this.bboxes.push(F)}insertCircle(c,y,B,S){this._forEachCell(y-S,B-S,y+S,B+S,this._insertCircleCell,this.circleUid++),this.circleKeys.push(c),this.circles.push(y),this.circles.push(B),this.circles.push(S)}_insertBoxCell(c,y,B,S,F,H){this.boxCells[F].push(H)}_insertCircleCell(c,y,B,S,F,H){this.circleCells[F].push(H)}_query(c,y,B,S,F,H,j){if(B<0||c>this.width||S<0||y>this.height)return[];const Z=[];if(c<=0&&y<=0&&this.width<=B&&this.height<=S){if(F)return[{key:null,x1:c,y1:y,x2:B,y2:S}];for(let se=0;se<this.boxKeys.length;se++)Z.push({key:this.boxKeys[se],x1:this.bboxes[4*se],y1:this.bboxes[4*se+1],x2:this.bboxes[4*se+2],y2:this.bboxes[4*se+3]});for(let se=0;se<this.circleKeys.length;se++){const he=this.circles[3*se],ue=this.circles[3*se+1],Te=this.circles[3*se+2];Z.push({key:this.circleKeys[se],x1:he-Te,y1:ue-Te,x2:he+Te,y2:ue+Te})}}else this._forEachCell(c,y,B,S,this._queryCell,Z,{hitTest:F,overlapMode:H,seenUids:{box:{},circle:{}}},j);return Z}query(c,y,B,S){return this._query(c,y,B,S,!1,null)}hitTest(c,y,B,S,F,H){return this._query(c,y,B,S,!0,F,H).length>0}hitTestCircle(c,y,B,S,F){const H=c-B,j=c+B,Z=y-B,se=y+B;if(j<0||H>this.width||se<0||Z>this.height)return!1;const he=[];return this._forEachCell(H,Z,j,se,this._queryCellCircle,he,{hitTest:!0,overlapMode:S,circle:{x:c,y,radius:B},seenUids:{box:{},circle:{}}},F),he.length>0}_queryCell(c,y,B,S,F,H,j,Z){const{seenUids:se,hitTest:he,overlapMode:ue}=j,Te=this.boxCells[F];if(Te!==null){const Ee=this.bboxes;for(const Oe of Te)if(!se.box[Oe]){se.box[Oe]=!0;const rt=4*Oe,qe=this.boxKeys[Oe];if(c<=Ee[rt+2]&&y<=Ee[rt+3]&&B>=Ee[rt+0]&&S>=Ee[rt+1]&&(!Z||Z(qe))&&(!he||!bt(ue,qe.overlapMode))&&(H.push({key:qe,x1:Ee[rt],y1:Ee[rt+1],x2:Ee[rt+2],y2:Ee[rt+3]}),he))return!0}}const Fe=this.circleCells[F];if(Fe!==null){const Ee=this.circles;for(const Oe of Fe)if(!se.circle[Oe]){se.circle[Oe]=!0;const rt=3*Oe,qe=this.circleKeys[Oe];if(this._circleAndRectCollide(Ee[rt],Ee[rt+1],Ee[rt+2],c,y,B,S)&&(!Z||Z(qe))&&(!he||!bt(ue,qe.overlapMode))){const Ze=Ee[rt],ot=Ee[rt+1],vt=Ee[rt+2];if(H.push({key:qe,x1:Ze-vt,y1:ot-vt,x2:Ze+vt,y2:ot+vt}),he)return!0}}}return!1}_queryCellCircle(c,y,B,S,F,H,j,Z){const{circle:se,seenUids:he,overlapMode:ue}=j,Te=this.boxCells[F];if(Te!==null){const Ee=this.bboxes;for(const Oe of Te)if(!he.box[Oe]){he.box[Oe]=!0;const rt=4*Oe,qe=this.boxKeys[Oe];if(this._circleAndRectCollide(se.x,se.y,se.radius,Ee[rt+0],Ee[rt+1],Ee[rt+2],Ee[rt+3])&&(!Z||Z(qe))&&!bt(ue,qe.overlapMode))return H.push(!0),!0}}const Fe=this.circleCells[F];if(Fe!==null){const Ee=this.circles;for(const Oe of Fe)if(!he.circle[Oe]){he.circle[Oe]=!0;const rt=3*Oe,qe=this.circleKeys[Oe];if(this._circlesCollide(Ee[rt],Ee[rt+1],Ee[rt+2],se.x,se.y,se.radius)&&(!Z||Z(qe))&&!bt(ue,qe.overlapMode))return H.push(!0),!0}}}_forEachCell(c,y,B,S,F,H,j,Z){const se=this._convertToXCellCoord(c),he=this._convertToYCellCoord(y),ue=this._convertToXCellCoord(B),Te=this._convertToYCellCoord(S);for(let Fe=se;Fe<=ue;Fe++)for(let Ee=he;Ee<=Te;Ee++)if(F.call(this,c,y,B,S,this.xCellCount*Ee+Fe,H,j,Z))return}_convertToXCellCoord(c){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(c*this.xScale)))}_convertToYCellCoord(c){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(c*this.yScale)))}_circlesCollide(c,y,B,S,F,H){const j=S-c,Z=F-y,se=B+H;return se*se>j*j+Z*Z}_circleAndRectCollide(c,y,B,S,F,H,j){const Z=(H-S)/2,se=Math.abs(c-(S+Z));if(se>Z+B)return!1;const he=(j-F)/2,ue=Math.abs(y-(F+he));if(ue>he+B)return!1;if(se<=Z||ue<=he)return!0;const Te=se-Z,Fe=ue-he;return Te*Te+Fe*Fe<=B*B}}function $t(E,c,y,B,S){const F=o.H();return c?(o.K(F,F,[1/S,1/S,1]),y||o.ad(F,F,B.angle)):o.L(F,B.labelPlaneMatrix,E),F}function Wt(E,c,y,B,S){if(c){const F=o.ae(E);return o.K(F,F,[S,S,1]),y||o.ad(F,F,-B.angle),F}return B.glCoordMatrix}function Pe(E,c,y,B){let S;B?(S=[E,c,B(E,c),1],o.af(S,S,y)):(S=[E,c,0,1],Rr(S,S,y));const F=S[3];return{point:new o.P(S[0]/F,S[1]/F),signedDistanceFromCamera:F,isOccluded:!1}}function Ae(E,c){return .5+E/c*.5}function ge(E,c){return E.x>=-c[0]&&E.x<=c[0]&&E.y>=-c[1]&&E.y<=c[1]}function we(E,c,y,B,S,F,H,j,Z,se,he,ue,Te,Fe,Ee){const Oe=B?E.textSizeData:E.iconSizeData,rt=o.ag(Oe,y.transform.zoom),qe=[256/y.width*2+1,256/y.height*2+1],Ze=B?E.text.dynamicLayoutVertexArray:E.icon.dynamicLayoutVertexArray;Ze.clear();const ot=E.lineVertexArray,vt=B?E.text.placedSymbolArray:E.icon.placedSymbolArray,kt=y.transform.width/y.transform.height;let It=!1;for(let ur=0;ur<vt.length;ur++){const wr=vt.get(ur);if(wr.hidden||wr.writingMode===o.ah.vertical&&!It){Pr(wr.numGlyphs,Ze);continue}It=!1;const Dr=Pe(wr.anchorX,wr.anchorY,c,Ee);if(!ge(Dr.point,qe)){Pr(wr.numGlyphs,Ze);continue}const Or=Ae(y.transform.cameraToCenterDistance,Dr.signedDistanceFromCamera),_r=o.ai(Oe,rt,wr),xr=H?_r/Or:_r*Or,Vr={getElevation:Ee,labelPlaneMatrix:S,lineVertexArray:ot,pitchWithMap:H,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:se,tileAnchorPoint:new o.P(wr.anchorX,wr.anchorY),unwrappedTileID:he,width:ue,height:Te,translation:Fe},xn=At(Vr,wr,xr,!1,j,c,F,E.glyphOffsetArray,Ze,kt,Z);It=xn.useVertical,(xn.notEnoughRoom||It||xn.needsFlipping&&At(Vr,wr,xr,!0,j,c,F,E.glyphOffsetArray,Ze,kt,Z).notEnoughRoom)&&Pr(wr.numGlyphs,Ze)}B?E.text.dynamicLayoutVertexBuffer.updateData(Ze):E.icon.dynamicLayoutVertexBuffer.updateData(Ze)}function Se(E,c,y,B,S,F,H,j){const Z=F.glyphStartIndex+F.numGlyphs,se=F.lineStartIndex,he=F.lineStartIndex+F.lineLength,ue=c.getoffsetX(F.glyphStartIndex),Te=c.getoffsetX(Z-1),Fe=dr(E*ue,y,B,S,F.segment,se,he,j,H);if(!Fe)return null;const Ee=dr(E*Te,y,B,S,F.segment,se,he,j,H);return Ee?j.projectionCache.anyProjectionOccluded?null:{first:Fe,last:Ee}:null}function ht(E,c,y,B){return E===o.ah.horizontal&&Math.abs(y.y-c.y)>Math.abs(y.x-c.x)*B?{useVertical:!0}:(E===o.ah.vertical?c.y<y.y:c.x>y.x)?{needsFlipping:!0}:null}function At(E,c,y,B,S,F,H,j,Z,se,he){const ue=y/24,Te=c.lineOffsetX*ue,Fe=c.lineOffsetY*ue;let Ee;if(c.numGlyphs>1){const Oe=c.glyphStartIndex+c.numGlyphs,rt=c.lineStartIndex,qe=c.lineStartIndex+c.lineLength,Ze=Se(ue,j,Te,Fe,B,c,he,E);if(!Ze)return{notEnoughRoom:!0};const ot=Pe(Ze.first.point.x,Ze.first.point.y,H,E.getElevation).point,vt=Pe(Ze.last.point.x,Ze.last.point.y,H,E.getElevation).point;if(S&&!B){const kt=ht(c.writingMode,ot,vt,se);if(kt)return kt}Ee=[Ze.first];for(let kt=c.glyphStartIndex+1;kt<Oe-1;kt++)Ee.push(dr(ue*j.getoffsetX(kt),Te,Fe,B,c.segment,rt,qe,E,he));Ee.push(Ze.last)}else{if(S&&!B){const rt=Pe(E.tileAnchorPoint.x,E.tileAnchorPoint.y,F,E.getElevation).point,qe=c.lineStartIndex+c.segment+1,Ze=new o.P(E.lineVertexArray.getx(qe),E.lineVertexArray.gety(qe)),ot=Pe(Ze.x,Ze.y,F,E.getElevation),vt=ot.signedDistanceFromCamera>0?ot.point:function(It,ur,wr,Dr,Or,_r){return _t(It,ur,wr,1,Or,_r)}(E.tileAnchorPoint,Ze,rt,0,F,E),kt=ht(c.writingMode,rt,vt,se);if(kt)return kt}const Oe=dr(ue*j.getoffsetX(c.glyphStartIndex),Te,Fe,B,c.segment,c.lineStartIndex,c.lineStartIndex+c.lineLength,E,he);if(!Oe||E.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};Ee=[Oe]}for(const Oe of Ee)o.aj(Z,Oe.point,Oe.angle);return{}}function _t(E,c,y,B,S,F){const H=E.add(E.sub(c)._unit()),j=S!==void 0?Pe(H.x,H.y,S,F.getElevation).point:yt(H.x,H.y,F).point,Z=y.sub(j);return y.add(Z._mult(B/Z.mag()))}function dt(E,c,y){const B=c.projectionCache;if(B.projections[E])return B.projections[E];const S=new o.P(c.lineVertexArray.getx(E),c.lineVertexArray.gety(E)),F=yt(S.x,S.y,c);if(F.signedDistanceFromCamera>0)return B.projections[E]=F.point,B.anyProjectionOccluded=B.anyProjectionOccluded||F.isOccluded,F.point;const H=E-y.direction;return function(j,Z,se,he,ue){return _t(j,Z,se,he,void 0,ue)}(y.distanceFromAnchor===0?c.tileAnchorPoint:new o.P(c.lineVertexArray.getx(H),c.lineVertexArray.gety(H)),S,y.previousVertex,y.absOffsetX-y.distanceFromAnchor+1,c)}function yt(E,c,y){const B=E+y.translation[0],S=c+y.translation[1];let F;return!y.pitchWithMap&&y.projection.useSpecialProjectionForSymbols?(F=y.projection.projectTileCoordinates(B,S,y.unwrappedTileID,y.getElevation),F.point.x=(.5*F.point.x+.5)*y.width,F.point.y=(.5*-F.point.y+.5)*y.height):(F=Pe(B,S,y.labelPlaneMatrix,y.getElevation),F.isOccluded=!1),F}function Nt(E,c,y){return E._unit()._perp()._mult(c*y)}function Rt(E,c,y,B,S,F,H,j,Z){if(j.projectionCache.offsets[E])return j.projectionCache.offsets[E];const se=y.add(c);if(E+Z.direction<B||E+Z.direction>=S)return j.projectionCache.offsets[E]=se,se;const he=dt(E+Z.direction,j,Z),ue=Nt(he.sub(y),H,Z.direction),Te=y.add(ue),Fe=he.add(ue);return j.projectionCache.offsets[E]=o.ak(F,se,Te,Fe)||se,j.projectionCache.offsets[E]}function dr(E,c,y,B,S,F,H,j,Z){const se=B?E-c:E+c;let he=se>0?1:-1,ue=0;B&&(he*=-1,ue=Math.PI),he<0&&(ue+=Math.PI);let Te,Fe=he>0?F+S:F+S+1;j.projectionCache.cachedAnchorPoint?Te=j.projectionCache.cachedAnchorPoint:(Te=yt(j.tileAnchorPoint.x,j.tileAnchorPoint.y,j).point,j.projectionCache.cachedAnchorPoint=Te);let Ee,Oe,rt=Te,qe=Te,Ze=0,ot=0;const vt=Math.abs(se),kt=[];let It;for(;Ze+ot<=vt;){if(Fe+=he,Fe<F||Fe>=H)return null;Ze+=ot,qe=rt,Oe=Ee;const Dr={absOffsetX:vt,direction:he,distanceFromAnchor:Ze,previousVertex:qe};if(rt=dt(Fe,j,Dr),y===0)kt.push(qe),It=rt.sub(qe);else{let Or;const _r=rt.sub(qe);Or=_r.mag()===0?Nt(dt(Fe+he,j,Dr).sub(rt),y,he):Nt(_r,y,he),Oe||(Oe=qe.add(Or)),Ee=Rt(Fe,Or,rt,F,H,Oe,y,j,Dr),kt.push(Oe),It=Ee.sub(Oe)}ot=It.mag()}const ur=It._mult((vt-Ze)/ot)._add(Oe||qe),wr=ue+Math.atan2(rt.y-qe.y,rt.x-qe.x);return kt.push(ur),{point:ur,angle:Z?wr:0,path:kt}}const zr=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Pr(E,c){for(let y=0;y<E;y++){const B=c.length;c.resize(B+4),c.float32.set(zr,3*B)}}function Rr(E,c,y){const B=c[0],S=c[1];return E[0]=y[0]*B+y[4]*S+y[12],E[1]=y[1]*B+y[5]*S+y[13],E[3]=y[3]*B+y[7]*S+y[15],E}const ln=100;class Jn{constructor(c,y){let B=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new Mt(c.width+200,c.height+200,25),S=arguments.length>3&&arguments[3]!==void 0?arguments[3]:new Mt(c.width+200,c.height+200,25);this.transform=c,this.mapProjection=y,this.grid=B,this.ignoredGrid=S,this.pitchFactor=Math.cos(c._pitch)*c.cameraToCenterDistance,this.screenRightBoundary=c.width+ln,this.screenBottomBoundary=c.height+ln,this.gridRightBoundary=c.width+200,this.gridBottomBoundary=c.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(c,y,B,S,F,H,j,Z,se,he,ue){const Te=c.anchorPointX+Z[0],Fe=c.anchorPointY+Z[1],Ee=this.projectAndGetPerspectiveRatio(S,Te,Fe,F,he),Oe=B*Ee.perspectiveRatio;let rt;if(H||j)rt=this._projectCollisionBox(c,Oe,S,F,H,j,Z,Ee,he,ue);else{const kt=Ee.point.x+(ue?ue.x*Oe:0),It=Ee.point.y+(ue?ue.y*Oe:0);rt={allPointsOccluded:!1,box:[kt+c.x1*Oe,It+c.y1*Oe,kt+c.x2*Oe,It+c.y2*Oe]}}const[qe,Ze,ot,vt]=rt.box;return this.mapProjection.useSpecialProjectionForSymbols&&(H?rt.allPointsOccluded:this.mapProjection.isOccluded(Te,Fe,F))||Ee.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(qe,Ze,ot,vt)||y!=="always"&&this.grid.hitTest(qe,Ze,ot,vt,y,se)?{box:[qe,Ze,ot,vt],placeable:!1,offscreen:!1}:{box:[qe,Ze,ot,vt],placeable:!0,offscreen:this.isOffscreen(qe,Ze,ot,vt)}}placeCollisionCircles(c,y,B,S,F,H,j,Z,se,he,ue,Te,Fe,Ee,Oe,rt){const qe=[],Ze=new o.P(y.anchorX,y.anchorY),ot=this.getPerspectiveRatio(H,Ze.x,Ze.y,j,rt),vt=(ue?F/ot:F*ot)/o.ap,kt={getElevation:rt,labelPlaneMatrix:Z,lineVertexArray:B,pitchWithMap:ue,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:Ze,unwrappedTileID:j,width:this.transform.width,height:this.transform.height,translation:Oe},It=Se(vt,S,y.lineOffsetX*vt,y.lineOffsetY*vt,!1,y,!1,kt);let ur=!1,wr=!1,Dr=!0;if(It){const Or=.5*Fe*ot+Ee,_r=new o.P(-100,-100),xr=new o.P(this.screenRightBoundary,this.screenBottomBoundary),Vr=new Ve,xn=It.first,Qr=It.last;let jr=[];for(let Qn=xn.path.length-1;Qn>=1;Qn--)jr.push(xn.path[Qn]);for(let Qn=1;Qn<Qr.path.length;Qn++)jr.push(Qr.path[Qn]);const In=2.5*Or;if(se){const Qn=this.projectPathToScreenSpace(jr,kt,se);jr=Qn.some(Zn=>Zn.signedDistanceFromCamera<=0)?[]:Qn.map(Zn=>Zn.point)}let Hn=[];if(jr.length>0){const Qn=jr[0].clone(),Zn=jr[0].clone();for(let ui=1;ui<jr.length;ui++)Qn.x=Math.min(Qn.x,jr[ui].x),Qn.y=Math.min(Qn.y,jr[ui].y),Zn.x=Math.max(Zn.x,jr[ui].x),Zn.y=Math.max(Zn.y,jr[ui].y);Hn=Qn.x>=_r.x&&Zn.x<=xr.x&&Qn.y>=_r.y&&Zn.y<=xr.y?[jr]:Zn.x<_r.x||Qn.x>xr.x||Zn.y<_r.y||Qn.y>xr.y?[]:o.al([jr],_r.x,_r.y,xr.x,xr.y)}for(const Qn of Hn){Vr.reset(Qn,.25*Or);let Zn=0;Zn=Vr.length<=.5*Or?1:Math.ceil(Vr.paddedLength/In)+1;for(let ui=0;ui<Zn;ui++){const Ii=ui/Math.max(Zn-1,1),cs=Vr.lerp(Ii),mi=cs.x+ln,qi=cs.y+ln;qe.push(mi,qi,Or,0);const Di=mi-Or,us=qi-Or,ns=mi+Or,Uo=qi+Or;if(Dr=Dr&&this.isOffscreen(Di,us,ns,Uo),wr=wr||this.isInsideGrid(Di,us,ns,Uo),c!=="always"&&this.grid.hitTestCircle(mi,qi,Or,c,Te)&&(ur=!0,!he))return{circles:[],offscreen:!1,collisionDetected:ur}}}}return{circles:!he&&ur||!wr||ot<this.perspectiveRatioCutoff?[]:qe,offscreen:Dr,collisionDetected:ur}}projectPathToScreenSpace(c,y,B){return c.map(S=>Pe(S.x,S.y,B,y.getElevation))}queryRenderedSymbols(c){if(c.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const y=[];let B=1/0,S=1/0,F=-1/0,H=-1/0;for(const he of c){const ue=new o.P(he.x+ln,he.y+ln);B=Math.min(B,ue.x),S=Math.min(S,ue.y),F=Math.max(F,ue.x),H=Math.max(H,ue.y),y.push(ue)}const j=this.grid.query(B,S,F,H).concat(this.ignoredGrid.query(B,S,F,H)),Z={},se={};for(const he of j){const ue=he.key;if(Z[ue.bucketInstanceId]===void 0&&(Z[ue.bucketInstanceId]={}),Z[ue.bucketInstanceId][ue.featureIndex])continue;const Te=[new o.P(he.x1,he.y1),new o.P(he.x2,he.y1),new o.P(he.x2,he.y2),new o.P(he.x1,he.y2)];o.am(y,Te)&&(Z[ue.bucketInstanceId][ue.featureIndex]=!0,se[ue.bucketInstanceId]===void 0&&(se[ue.bucketInstanceId]=[]),se[ue.bucketInstanceId].push(ue.featureIndex))}return se}insertCollisionBox(c,y,B,S,F,H){(B?this.ignoredGrid:this.grid).insert({bucketInstanceId:S,featureIndex:F,collisionGroupID:H,overlapMode:y},c[0],c[1],c[2],c[3])}insertCollisionCircles(c,y,B,S,F,H){const j=B?this.ignoredGrid:this.grid,Z={bucketInstanceId:S,featureIndex:F,collisionGroupID:H,overlapMode:y};for(let se=0;se<c.length;se+=4)j.insertCircle(Z,c[se],c[se+1],c[se+2])}projectAndGetPerspectiveRatio(c,y,B,S,F){let H;F?(H=[y,B,F(y,B),1],o.af(H,H,c)):(H=[y,B,0,1],Rr(H,H,c));const j=H[3];return{point:new o.P((H[0]/j+1)/2*this.transform.width+ln,(-H[1]/j+1)/2*this.transform.height+ln),perspectiveRatio:.5+this.transform.cameraToCenterDistance/j*.5,isOccluded:!1,signedDistanceFromCamera:j}}getPerspectiveRatio(c,y,B,S,F){const H=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(y,B,S,F):Pe(y,B,c,F);return .5+this.transform.cameraToCenterDistance/H.signedDistanceFromCamera*.5}isOffscreen(c,y,B,S){return B<ln||c>=this.screenRightBoundary||S<ln||y>this.screenBottomBoundary}isInsideGrid(c,y,B,S){return B>=0&&c<this.gridRightBoundary&&S>=0&&y<this.gridBottomBoundary}getViewportMatrix(){const c=o.an([]);return o.J(c,c,[-100,-100,0]),c}_projectCollisionBox(c,y,B,S,F,H,j,Z,se,he){let ue=new o.P(1,0),Te=new o.P(0,1);const Fe=new o.P(c.anchorPointX+j[0],c.anchorPointY+j[1]);if(H&&!F){const Dr=this.projectAndGetPerspectiveRatio(B,Fe.x+1,Fe.y,S,se).point.sub(Z.point).unit(),Or=Math.atan(Dr.y/Dr.x)+(Dr.x<0?Math.PI:0),_r=Math.sin(Or),xr=Math.cos(Or);ue=new o.P(xr,_r),Te=new o.P(-_r,xr)}else if(!H&&F){const Dr=-this.transform.angle,Or=Math.sin(Dr),_r=Math.cos(Dr);ue=new o.P(_r,Or),Te=new o.P(-Or,_r)}let Ee=Z.point,Oe=y;if(F){Ee=Fe;const Dr=this.transform.zoom-Math.floor(this.transform.zoom);Oe=Math.pow(2,-Dr),Oe*=this.mapProjection.getPitchedTextCorrection(this.transform,Fe,S),he||(Oe*=o.ac(.5+Z.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}he&&(Ee=Ee.add(ue.mult(he.x*Oe)).add(Te.mult(he.y*Oe)));const rt=c.x1*Oe,qe=c.x2*Oe,Ze=(rt+qe)/2,ot=c.y1*Oe,vt=c.y2*Oe,kt=(ot+vt)/2,It=[{offsetX:rt,offsetY:ot},{offsetX:Ze,offsetY:ot},{offsetX:qe,offsetY:ot},{offsetX:qe,offsetY:kt},{offsetX:qe,offsetY:vt},{offsetX:Ze,offsetY:vt},{offsetX:rt,offsetY:vt},{offsetX:rt,offsetY:kt}];let ur=[];for(const{offsetX:Dr,offsetY:Or}of It)ur.push(new o.P(Ee.x+ue.x*Dr+Te.x*Or,Ee.y+ue.y*Dr+Te.y*Or));let wr=!1;if(F){const Dr=ur.map(Or=>this.projectAndGetPerspectiveRatio(B,Or.x,Or.y,S,se));wr=Dr.some(Or=>!Or.isOccluded),ur=Dr.map(Or=>Or.point)}else wr=!0;return{box:o.ao(ur),allPointsOccluded:!wr}}}function _n(E,c,y){return c*(o.X/(E.tileSize*Math.pow(2,y-E.tileID.overscaledZ)))}class jn{constructor(c,y,B,S){this.opacity=c?Math.max(0,Math.min(1,c.opacity+(c.placed?y:-y))):S&&B?1:0,this.placed=B}isHidden(){return this.opacity===0&&!this.placed}}class Gn{constructor(c,y,B,S,F){this.text=new jn(c?c.text:null,y,B,F),this.icon=new jn(c?c.icon:null,y,S,F)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ln{constructor(c,y,B){this.text=c,this.icon=y,this.skipFade=B}}class Un{constructor(){this.invProjMatrix=o.H(),this.viewportMatrix=o.H(),this.circles=[]}}class Ei{constructor(c,y,B,S,F){this.bucketInstanceId=c,this.featureIndex=y,this.sourceLayerIndex=B,this.bucketIndex=S,this.tileID=F}}class zi{constructor(c){this.crossSourceCollisions=c,this.maxGroupID=0,this.collisionGroups={}}get(c){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[c]){const y=++this.maxGroupID;this.collisionGroups[c]={ID:y,predicate:B=>B.collisionGroupID===y}}return this.collisionGroups[c]}}function Pt(E,c,y,B,S){const{horizontalAlign:F,verticalAlign:H}=o.au(E);return new o.P(-(F-.5)*c+B[0]*S,-(H-.5)*y+B[1]*S)}class Zr{constructor(c,y,B,S,F,H){this.transform=c.clone(),this.terrain=B,this.collisionIndex=new Jn(this.transform,y),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=S,this.retainedQueryData={},this.collisionGroups=new zi(F),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=H,H&&(H.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(c){const y=this.terrain;return y?(B,S)=>y.getElevation(c,B,S):null}getBucketParts(c,y,B,S){const F=B.getBucket(y),H=B.latestFeatureIndex;if(!F||!H||y.id!==F.layerIds[0])return;const j=B.collisionBoxArray,Z=F.layers[0].layout,se=F.layers[0].paint,he=Math.pow(2,this.transform.zoom-B.tileID.overscaledZ),ue=B.tileSize/o.X,Te=B.tileID.toUnwrapped(),Fe=this.transform.calculatePosMatrix(Te),Ee=Z.get("text-pitch-alignment")==="map",Oe=Z.get("text-rotation-alignment")==="map",rt=_n(B,1,this.transform.zoom),qe=this.collisionIndex.mapProjection.translatePosition(this.transform,B,se.get("text-translate"),se.get("text-translate-anchor")),Ze=this.collisionIndex.mapProjection.translatePosition(this.transform,B,se.get("icon-translate"),se.get("icon-translate-anchor")),ot=$t(Fe,Ee,Oe,this.transform,rt);let vt=null;if(Ee){const It=Wt(Fe,Ee,Oe,this.transform,rt);vt=o.L([],this.transform.labelPlaneMatrix,It)}this.retainedQueryData[F.bucketInstanceId]=new Ei(F.bucketInstanceId,H,F.sourceLayerIndex,F.index,B.tileID);const kt={bucket:F,layout:Z,translationText:qe,translationIcon:Ze,posMatrix:Fe,unwrappedTileID:Te,textLabelPlaneMatrix:ot,labelToScreenMatrix:vt,scale:he,textPixelRatio:ue,holdingForFade:B.holdingForFade(),collisionBoxArray:j,partiallyEvaluatedTextSize:o.ag(F.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(F.sourceID)};if(S)for(const It of F.sortKeyRanges){const{sortKey:ur,symbolInstanceStart:wr,symbolInstanceEnd:Dr}=It;c.push({sortKey:ur,symbolInstanceStart:wr,symbolInstanceEnd:Dr,parameters:kt})}else c.push({symbolInstanceStart:0,symbolInstanceEnd:F.symbolInstances.length,parameters:kt})}attemptAnchorPlacement(c,y,B,S,F,H,j,Z,se,he,ue,Te,Fe,Ee,Oe,rt,qe,Ze,ot){const vt=o.aq[c.textAnchor],kt=[c.textOffset0,c.textOffset1],It=Pt(vt,B,S,kt,F),ur=this.collisionIndex.placeCollisionBox(y,Te,Z,se,he,j,H,rt,ue.predicate,ot,It);if((!Ze||this.collisionIndex.placeCollisionBox(Ze,Te,Z,se,he,j,H,qe,ue.predicate,ot,It).placeable)&&ur.placeable){let wr;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Fe.crossTileID]&&this.prevPlacement.placements[Fe.crossTileID]&&this.prevPlacement.placements[Fe.crossTileID].text&&(wr=this.prevPlacement.variableOffsets[Fe.crossTileID].anchor),Fe.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[Fe.crossTileID]={textOffset:kt,width:B,height:S,anchor:vt,textBoxScale:F,prevAnchor:wr},this.markUsedJustification(Ee,vt,Fe,Oe),Ee.allowVerticalPlacement&&(this.markUsedOrientation(Ee,Oe,Fe),this.placedOrientations[Fe.crossTileID]=Oe),{shift:It,placedGlyphBoxes:ur}}}placeLayerBucketPart(c,y,B){const{bucket:S,layout:F,translationText:H,translationIcon:j,posMatrix:Z,unwrappedTileID:se,textLabelPlaneMatrix:he,labelToScreenMatrix:ue,textPixelRatio:Te,holdingForFade:Fe,collisionBoxArray:Ee,partiallyEvaluatedTextSize:Oe,collisionGroup:rt}=c.parameters,qe=F.get("text-optional"),Ze=F.get("icon-optional"),ot=o.ar(F,"text-overlap","text-allow-overlap"),vt=ot==="always",kt=o.ar(F,"icon-overlap","icon-allow-overlap"),It=kt==="always",ur=F.get("text-rotation-alignment")==="map",wr=F.get("text-pitch-alignment")==="map",Dr=F.get("icon-text-fit")!=="none",Or=F.get("symbol-z-order")==="viewport-y",_r=vt&&(It||!S.hasIconData()||Ze),xr=It&&(vt||!S.hasTextData()||qe);!S.collisionArrays&&Ee&&S.deserializeCollisionBoxes(Ee);const Vr=this._getTerrainElevationFunc(this.retainedQueryData[S.bucketInstanceId].tileID),xn=(Qr,jr,In)=>{var Hn,Qn;if(y[Qr.crossTileID])return;if(Fe)return void(this.placements[Qr.crossTileID]=new Ln(!1,!1,!1));let Zn=!1,ui=!1,Ii=!0,cs=null,mi={box:null,placeable:!1,offscreen:null},qi={box:null,placeable:!1,offscreen:null},Di=null,us=null,ns=null,Uo=0,da=0,Ki=0;jr.textFeatureIndex?Uo=jr.textFeatureIndex:Qr.useRuntimeCollisionCircles&&(Uo=Qr.featureIndex),jr.verticalTextFeatureIndex&&(da=jr.verticalTextFeatureIndex);const vc=jr.textBox;if(vc){const w=J=>{let re=o.ah.horizontal;if(S.allowVerticalPlacement&&!J&&this.prevPlacement){const oe=this.prevPlacement.placedOrientations[Qr.crossTileID];oe&&(this.placedOrientations[Qr.crossTileID]=oe,re=oe,this.markUsedOrientation(S,re,Qr))}return re},P=(J,re)=>{if(S.allowVerticalPlacement&&Qr.numVerticalGlyphVertices>0&&jr.verticalTextBox){for(const oe of S.writingModes)if(oe===o.ah.vertical?(mi=re(),qi=mi):mi=J(),mi&&mi.placeable)break}else mi=J()},O=Qr.textAnchorOffsetStartIndex,G=Qr.textAnchorOffsetEndIndex;if(G===O){const J=(re,oe)=>{const pe=this.collisionIndex.placeCollisionBox(re,ot,Te,Z,se,wr,ur,H,rt.predicate,Vr);return pe&&pe.placeable&&(this.markUsedOrientation(S,oe,Qr),this.placedOrientations[Qr.crossTileID]=oe),pe};P(()=>J(vc,o.ah.horizontal),()=>{const re=jr.verticalTextBox;return S.allowVerticalPlacement&&Qr.numVerticalGlyphVertices>0&&re?J(re,o.ah.vertical):{box:null,offscreen:null}}),w(mi&&mi.placeable)}else{let J=o.aq[(Qn=(Hn=this.prevPlacement)===null||Hn===void 0?void 0:Hn.variableOffsets[Qr.crossTileID])===null||Qn===void 0?void 0:Qn.anchor];const re=(pe,Ce,Me)=>{const Ke=pe.x2-pe.x1,Ye=pe.y2-pe.y1,gt=Qr.textBoxScale,ft=Dr&&kt==="never"?Ce:null;let mt=null,xt=ot==="never"?1:2,Ft="never";J&&xt++;for(let Dt=0;Dt<xt;Dt++){for(let Ut=O;Ut<G;Ut++){const Gt=S.textAnchorOffsets.get(Ut);if(J&&Gt.textAnchor!==J)continue;const zt=this.attemptAnchorPlacement(Gt,pe,Ke,Ye,gt,ur,wr,Te,Z,se,rt,Ft,Qr,S,Me,H,j,ft,Vr);if(zt&&(mt=zt.placedGlyphBoxes,mt&&mt.placeable))return Zn=!0,cs=zt.shift,mt}J?J=null:Ft=ot}return B&&!mt&&(mt={box:this.collisionIndex.placeCollisionBox(vc,"always",Te,Z,se,wr,ur,H,rt.predicate,Vr,new o.P(0,0)).box,offscreen:!1,placeable:!1}),mt};P(()=>re(vc,jr.iconBox,o.ah.horizontal),()=>{const pe=jr.verticalTextBox;return S.allowVerticalPlacement&&(!mi||!mi.placeable)&&Qr.numVerticalGlyphVertices>0&&pe?re(pe,jr.verticalIconBox,o.ah.vertical):{box:null,occluded:!0,offscreen:null}}),mi&&(Zn=mi.placeable,Ii=mi.offscreen);const oe=w(mi&&mi.placeable);if(!Zn&&this.prevPlacement){const pe=this.prevPlacement.variableOffsets[Qr.crossTileID];pe&&(this.variableOffsets[Qr.crossTileID]=pe,this.markUsedJustification(S,pe.anchor,Qr,oe))}}}if(Di=mi,Zn=Di&&Di.placeable,Ii=Di&&Di.offscreen,Qr.useRuntimeCollisionCircles){const w=S.text.placedSymbolArray.get(Qr.centerJustifiedTextSymbolIndex),P=o.ai(S.textSizeData,Oe,w),O=F.get("text-padding");us=this.collisionIndex.placeCollisionCircles(ot,w,S.lineVertexArray,S.glyphOffsetArray,P,Z,se,he,ue,B,wr,rt.predicate,Qr.collisionCircleDiameter,O,H,Vr),us.circles.length&&us.collisionDetected&&!B&&o.w("Collisions detected, but collision boxes are not shown"),Zn=vt||us.circles.length>0&&!us.collisionDetected,Ii=Ii&&us.offscreen}if(jr.iconFeatureIndex&&(Ki=jr.iconFeatureIndex),jr.iconBox){const w=P=>this.collisionIndex.placeCollisionBox(P,kt,Te,Z,se,wr,ur,j,rt.predicate,Vr,Dr&&cs?cs:void 0);qi&&qi.placeable&&jr.verticalIconBox?(ns=w(jr.verticalIconBox),ui=ns.placeable):(ns=w(jr.iconBox),ui=ns.placeable),Ii=Ii&&ns.offscreen}const D=qe||Qr.numHorizontalGlyphVertices===0&&Qr.numVerticalGlyphVertices===0,l=Ze||Qr.numIconVertices===0;D||l?l?D||(ui=ui&&Zn):Zn=ui&&Zn:ui=Zn=ui&&Zn;const m=ui&&ns.placeable;if(Zn&&Di.placeable&&this.collisionIndex.insertCollisionBox(Di.box,ot,F.get("text-ignore-placement"),S.bucketInstanceId,qi&&qi.placeable&&da?da:Uo,rt.ID),m&&this.collisionIndex.insertCollisionBox(ns.box,kt,F.get("icon-ignore-placement"),S.bucketInstanceId,Ki,rt.ID),us&&Zn&&this.collisionIndex.insertCollisionCircles(us.circles,ot,F.get("text-ignore-placement"),S.bucketInstanceId,Uo,rt.ID),B&&this.storeCollisionData(S.bucketInstanceId,In,jr,Di,ns,us),Qr.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(S.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Qr.crossTileID]=new Ln(Zn||_r,ui||xr,Ii||S.justReloaded),y[Qr.crossTileID]=!0};if(Or){if(c.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Qr=S.getSortedSymbolIndexes(this.transform.angle);for(let jr=Qr.length-1;jr>=0;--jr){const In=Qr[jr];xn(S.symbolInstances.get(In),S.collisionArrays[In],In)}}else for(let Qr=c.symbolInstanceStart;Qr<c.symbolInstanceEnd;Qr++)xn(S.symbolInstances.get(Qr),S.collisionArrays[Qr],Qr);if(B&&S.bucketInstanceId in this.collisionCircleArrays){const Qr=this.collisionCircleArrays[S.bucketInstanceId];o.as(Qr.invProjMatrix,Z),Qr.viewportMatrix=this.collisionIndex.getViewportMatrix()}S.justReloaded=!1}storeCollisionData(c,y,B,S,F,H){if(B.textBox||B.iconBox){let j,Z;this.collisionBoxArrays.has(c)?j=this.collisionBoxArrays.get(c):(j=new Map,this.collisionBoxArrays.set(c,j)),j.has(y)?Z=j.get(y):(Z={text:null,icon:null},j.set(y,Z)),B.textBox&&(Z.text=S.box),B.iconBox&&(Z.icon=F.box)}if(H){let j=this.collisionCircleArrays[c];j===void 0&&(j=this.collisionCircleArrays[c]=new Un);for(let Z=0;Z<H.circles.length;Z+=4)j.circles.push(H.circles[Z+0]),j.circles.push(H.circles[Z+1]),j.circles.push(H.circles[Z+2]),j.circles.push(H.collisionDetected?1:0)}}markUsedJustification(c,y,B,S){let F;F=S===o.ah.vertical?B.verticalPlacedTextSymbolIndex:{left:B.leftJustifiedTextSymbolIndex,center:B.centerJustifiedTextSymbolIndex,right:B.rightJustifiedTextSymbolIndex}[o.at(y)];const H=[B.leftJustifiedTextSymbolIndex,B.centerJustifiedTextSymbolIndex,B.rightJustifiedTextSymbolIndex,B.verticalPlacedTextSymbolIndex];for(const j of H)j>=0&&(c.text.placedSymbolArray.get(j).crossTileID=F>=0&&j!==F?0:B.crossTileID)}markUsedOrientation(c,y,B){const S=y===o.ah.horizontal||y===o.ah.horizontalOnly?y:0,F=y===o.ah.vertical?y:0,H=[B.leftJustifiedTextSymbolIndex,B.centerJustifiedTextSymbolIndex,B.rightJustifiedTextSymbolIndex];for(const j of H)c.text.placedSymbolArray.get(j).placedOrientation=S;B.verticalPlacedTextSymbolIndex&&(c.text.placedSymbolArray.get(B.verticalPlacedTextSymbolIndex).placedOrientation=F)}commit(c){this.commitTime=c,this.zoomAtLastRecencyCheck=this.transform.zoom;const y=this.prevPlacement;let B=!1;this.prevZoomAdjustment=y?y.zoomAdjustment(this.transform.zoom):0;const S=y?y.symbolFadeChange(c):1,F=y?y.opacities:{},H=y?y.variableOffsets:{},j=y?y.placedOrientations:{};for(const Z in this.placements){const se=this.placements[Z],he=F[Z];he?(this.opacities[Z]=new Gn(he,S,se.text,se.icon),B=B||se.text!==he.text.placed||se.icon!==he.icon.placed):(this.opacities[Z]=new Gn(null,S,se.text,se.icon,se.skipFade),B=B||se.text||se.icon)}for(const Z in F){const se=F[Z];if(!this.opacities[Z]){const he=new Gn(se,S,!1,!1);he.isHidden()||(this.opacities[Z]=he,B=B||se.text.placed||se.icon.placed)}}for(const Z in H)this.variableOffsets[Z]||!this.opacities[Z]||this.opacities[Z].isHidden()||(this.variableOffsets[Z]=H[Z]);for(const Z in j)this.placedOrientations[Z]||!this.opacities[Z]||this.opacities[Z].isHidden()||(this.placedOrientations[Z]=j[Z]);if(y&&y.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");B?this.lastPlacementChangeTime=c:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=y?y.lastPlacementChangeTime:c)}updateLayerOpacities(c,y){const B={};for(const S of y){const F=S.getBucket(c);F&&S.latestFeatureIndex&&c.id===F.layerIds[0]&&this.updateBucketOpacities(F,S.tileID,B,S.collisionBoxArray)}}updateBucketOpacities(c,y,B,S){c.hasTextData()&&(c.text.opacityVertexArray.clear(),c.text.hasVisibleVertices=!1),c.hasIconData()&&(c.icon.opacityVertexArray.clear(),c.icon.hasVisibleVertices=!1),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexArray.clear(),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexArray.clear();const F=c.layers[0],H=F.layout,j=new Gn(null,0,!1,!1,!0),Z=H.get("text-allow-overlap"),se=H.get("icon-allow-overlap"),he=F._unevaluatedLayout.hasValue("text-variable-anchor")||F._unevaluatedLayout.hasValue("text-variable-anchor-offset"),ue=H.get("text-rotation-alignment")==="map",Te=H.get("text-pitch-alignment")==="map",Fe=H.get("icon-text-fit")!=="none",Ee=new Gn(null,0,Z&&(se||!c.hasIconData()||H.get("icon-optional")),se&&(Z||!c.hasTextData()||H.get("text-optional")),!0);!c.collisionArrays&&S&&(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData())&&c.deserializeCollisionBoxes(S);const Oe=(qe,Ze,ot)=>{for(let vt=0;vt<Ze/4;vt++)qe.opacityVertexArray.emplaceBack(ot);qe.hasVisibleVertices=qe.hasVisibleVertices||ot!==Mc},rt=this.collisionBoxArrays.get(c.bucketInstanceId);for(let qe=0;qe<c.symbolInstances.length;qe++){const Ze=c.symbolInstances.get(qe),{numHorizontalGlyphVertices:ot,numVerticalGlyphVertices:vt,crossTileID:kt}=Ze;let It=this.opacities[kt];B[kt]?It=j:It||(It=Ee,this.opacities[kt]=It),B[kt]=!0;const ur=Ze.numIconVertices>0,wr=this.placedOrientations[Ze.crossTileID],Dr=wr===o.ah.vertical,Or=wr===o.ah.horizontal||wr===o.ah.horizontalOnly;if(ot>0||vt>0){const xr=Hi(It.text);Oe(c.text,ot,Dr?Mc:xr),Oe(c.text,vt,Or?Mc:xr);const Vr=It.text.isHidden();[Ze.rightJustifiedTextSymbolIndex,Ze.centerJustifiedTextSymbolIndex,Ze.leftJustifiedTextSymbolIndex].forEach(jr=>{jr>=0&&(c.text.placedSymbolArray.get(jr).hidden=Vr||Dr?1:0)}),Ze.verticalPlacedTextSymbolIndex>=0&&(c.text.placedSymbolArray.get(Ze.verticalPlacedTextSymbolIndex).hidden=Vr||Or?1:0);const xn=this.variableOffsets[Ze.crossTileID];xn&&this.markUsedJustification(c,xn.anchor,Ze,wr);const Qr=this.placedOrientations[Ze.crossTileID];Qr&&(this.markUsedJustification(c,"left",Ze,Qr),this.markUsedOrientation(c,Qr,Ze))}if(ur){const xr=Hi(It.icon),Vr=!(Fe&&Ze.verticalPlacedIconSymbolIndex&&Dr);Ze.placedIconSymbolIndex>=0&&(Oe(c.icon,Ze.numIconVertices,Vr?xr:Mc),c.icon.placedSymbolArray.get(Ze.placedIconSymbolIndex).hidden=It.icon.isHidden()),Ze.verticalPlacedIconSymbolIndex>=0&&(Oe(c.icon,Ze.numVerticalIconVertices,Vr?Mc:xr),c.icon.placedSymbolArray.get(Ze.verticalPlacedIconSymbolIndex).hidden=It.icon.isHidden())}const _r=rt&&rt.has(qe)?rt.get(qe):{text:null,icon:null};if(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData()){const xr=c.collisionArrays[qe];if(xr){let Vr=new o.P(0,0);if(xr.textBox||xr.verticalTextBox){let xn=!0;if(he){const Qr=this.variableOffsets[kt];Qr?(Vr=Pt(Qr.anchor,Qr.width,Qr.height,Qr.textOffset,Qr.textBoxScale),ue&&Vr._rotate(Te?this.transform.angle:-this.transform.angle)):xn=!1}if(xr.textBox||xr.verticalTextBox){let Qr;xr.textBox&&(Qr=Dr),xr.verticalTextBox&&(Qr=Or),Ur(c.textCollisionBox.collisionVertexArray,It.text.placed,!xn||Qr,_r.text,Vr.x,Vr.y)}}if(xr.iconBox||xr.verticalIconBox){const xn=!!(!Or&&xr.verticalIconBox);let Qr;xr.iconBox&&(Qr=xn),xr.verticalIconBox&&(Qr=!xn),Ur(c.iconCollisionBox.collisionVertexArray,It.icon.placed,Qr,_r.icon,Fe?Vr.x:0,Fe?Vr.y:0)}}}}if(c.sortFeatures(this.transform.angle),this.retainedQueryData[c.bucketInstanceId]&&(this.retainedQueryData[c.bucketInstanceId].featureSortOrder=c.featureSortOrder),c.hasTextData()&&c.text.opacityVertexBuffer&&c.text.opacityVertexBuffer.updateData(c.text.opacityVertexArray),c.hasIconData()&&c.icon.opacityVertexBuffer&&c.icon.opacityVertexBuffer.updateData(c.icon.opacityVertexArray),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexBuffer&&c.iconCollisionBox.collisionVertexBuffer.updateData(c.iconCollisionBox.collisionVertexArray),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexBuffer&&c.textCollisionBox.collisionVertexBuffer.updateData(c.textCollisionBox.collisionVertexArray),c.text.opacityVertexArray.length!==c.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${c.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${c.text.layoutVertexArray.length}) / 4`);if(c.icon.opacityVertexArray.length!==c.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${c.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${c.icon.layoutVertexArray.length}) / 4`);if(c.bucketInstanceId in this.collisionCircleArrays){const qe=this.collisionCircleArrays[c.bucketInstanceId];c.placementInvProjMatrix=qe.invProjMatrix,c.placementViewportMatrix=qe.viewportMatrix,c.collisionCircleArray=qe.circles,delete this.collisionCircleArrays[c.bucketInstanceId]}}symbolFadeChange(c){return this.fadeDuration===0?1:(c-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(c){return Math.max(0,(this.transform.zoom-c)/1.5)}hasTransitions(c){return this.stale||c-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(c,y){const B=this.zoomAtLastRecencyCheck===y?1-this.zoomAdjustment(y):1;return this.zoomAtLastRecencyCheck=y,this.commitTime+this.fadeDuration*B>c}setStale(){this.stale=!0}}function Ur(E,c,y,B,S,F){B&&B.length!==0||(B=[0,0,0,0]);const H=B[0]-ln,j=B[1]-ln,Z=B[2]-ln,se=B[3]-ln;E.emplaceBack(c?1:0,y?1:0,S||0,F||0,H,j),E.emplaceBack(c?1:0,y?1:0,S||0,F||0,Z,j),E.emplaceBack(c?1:0,y?1:0,S||0,F||0,Z,se),E.emplaceBack(c?1:0,y?1:0,S||0,F||0,H,se)}const On=Math.pow(2,25),di=Math.pow(2,24),ks=Math.pow(2,17),bi=Math.pow(2,16),bs=Math.pow(2,9),jo=Math.pow(2,8),Ks=Math.pow(2,1);function Hi(E){if(E.opacity===0&&!E.placed)return 0;if(E.opacity===1&&E.placed)return 4294967295;const c=E.placed?1:0,y=Math.floor(127*E.opacity);return y*On+c*di+y*ks+c*bi+y*bs+c*jo+y*Ks+c}const Mc=0;function wa(){return{isOccluded:(E,c,y)=>!1,getPitchedTextCorrection:(E,c,y)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(E,c,y,B){throw new Error("Not implemented.")},translatePosition:(E,c,y,B)=>function(S,F,H,j){let Z=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;if(!H[0]&&!H[1])return[0,0];const se=Z?j==="map"?S.angle:0:j==="viewport"?-S.angle:0;if(se){const he=Math.sin(se),ue=Math.cos(se);H=[H[0]*ue-H[1]*he,H[0]*he+H[1]*ue]}return[Z?H[0]:_n(F,H[0],S.zoom),Z?H[1]:_n(F,H[1],S.zoom)]}(E,c,y,B),getCircleRadiusCorrection:E=>1}}class ts{constructor(c){this._sortAcrossTiles=c.layout.get("symbol-z-order")!=="viewport-y"&&!c.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(c,y,B,S,F){const H=this._bucketParts;for(;this._currentTileIndex<c.length;)if(y.getBucketParts(H,S,c[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,F())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,H.sort((j,Z)=>j.sortKey-Z.sortKey));this._currentPartIndex<H.length;)if(y.placeLayerBucketPart(H[this._currentPartIndex],this._seenCrossTileIDs,B),this._currentPartIndex++,F())return!0;return!1}}class ss{constructor(c,y,B,S,F,H,j,Z){this.placement=new Zr(c,wa(),y,H,j,Z),this._currentPlacementIndex=B.length-1,this._forceFullPlacement=S,this._showCollisionBoxes=F,this._done=!1}isDone(){return this._done}continuePlacement(c,y,B){const S=x.now(),F=()=>!this._forceFullPlacement&&x.now()-S>2;for(;this._currentPlacementIndex>=0;){const H=y[c[this._currentPlacementIndex]],j=this.placement.collisionIndex.transform.zoom;if(H.type==="symbol"&&(!H.minzoom||H.minzoom<=j)&&(!H.maxzoom||H.maxzoom>j)){if(this._inProgressLayer||(this._inProgressLayer=new ts(H)),this._inProgressLayer.continuePlacement(B[H.source],this.placement,this._showCollisionBoxes,H,F))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(c){return this.placement.commit(c),this.placement}}const sa=512/o.X/2;class Vi{constructor(c,y,B){this.tileID=c,this.bucketInstanceId=B,this._symbolsByKey={};const S=new Map;for(let F=0;F<y.length;F++){const H=y.get(F),j=H.key,Z=S.get(j);Z?Z.push(H):S.set(j,[H])}for(const[F,H]of S){const j={positions:H.map(Z=>({x:Math.floor(Z.anchorX*sa),y:Math.floor(Z.anchorY*sa)})),crossTileIDs:H.map(Z=>Z.crossTileID)};if(j.positions.length>128){const Z=new o.av(j.positions.length,16,Uint16Array);for(const{x:se,y:he}of j.positions)Z.add(se,he);Z.finish(),delete j.positions,j.index=Z}this._symbolsByKey[F]=j}}getScaledCoordinates(c,y){const{x:B,y:S,z:F}=this.tileID.canonical,{x:H,y:j,z:Z}=y.canonical,se=sa/Math.pow(2,Z-F),he=(j*o.X+c.anchorY)*se,ue=S*o.X*sa;return{x:Math.floor((H*o.X+c.anchorX)*se-B*o.X*sa),y:Math.floor(he-ue)}}findMatches(c,y,B){const S=this.tileID.canonical.z<y.canonical.z?1:Math.pow(2,this.tileID.canonical.z-y.canonical.z);for(let F=0;F<c.length;F++){const H=c.get(F);if(H.crossTileID)continue;const j=this._symbolsByKey[H.key];if(!j)continue;const Z=this.getScaledCoordinates(H,y);if(j.index){const se=j.index.range(Z.x-S,Z.y-S,Z.x+S,Z.y+S).sort();for(const he of se){const ue=j.crossTileIDs[he];if(!B[ue]){B[ue]=!0,H.crossTileID=ue;break}}}else if(j.positions)for(let se=0;se<j.positions.length;se++){const he=j.positions[se],ue=j.crossTileIDs[se];if(Math.abs(he.x-Z.x)<=S&&Math.abs(he.y-Z.y)<=S&&!B[ue]){B[ue]=!0,H.crossTileID=ue;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(c=>{let{crossTileIDs:y}=c;return y})}}class Pc{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class vo{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(c){const y=Math.round((c-this.lng)/360);if(y!==0)for(const B in this.indexes){const S=this.indexes[B],F={};for(const H in S){const j=S[H];j.tileID=j.tileID.unwrapTo(j.tileID.wrap+y),F[j.tileID.key]=j}this.indexes[B]=F}this.lng=c}addBucket(c,y,B){if(this.indexes[c.overscaledZ]&&this.indexes[c.overscaledZ][c.key]){if(this.indexes[c.overscaledZ][c.key].bucketInstanceId===y.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(c.overscaledZ,this.indexes[c.overscaledZ][c.key])}for(let F=0;F<y.symbolInstances.length;F++)y.symbolInstances.get(F).crossTileID=0;this.usedCrossTileIDs[c.overscaledZ]||(this.usedCrossTileIDs[c.overscaledZ]={});const S=this.usedCrossTileIDs[c.overscaledZ];for(const F in this.indexes){const H=this.indexes[F];if(Number(F)>c.overscaledZ)for(const j in H){const Z=H[j];Z.tileID.isChildOf(c)&&Z.findMatches(y.symbolInstances,c,S)}else{const j=H[c.scaledTo(Number(F)).key];j&&j.findMatches(y.symbolInstances,c,S)}}for(let F=0;F<y.symbolInstances.length;F++){const H=y.symbolInstances.get(F);H.crossTileID||(H.crossTileID=B.generate(),S[H.crossTileID]=!0)}return this.indexes[c.overscaledZ]===void 0&&(this.indexes[c.overscaledZ]={}),this.indexes[c.overscaledZ][c.key]=new Vi(c,y.symbolInstances,y.bucketInstanceId),!0}removeBucketCrossTileIDs(c,y){for(const B of y.getCrossTileIDsLists())for(const S of B)delete this.usedCrossTileIDs[c][S]}removeStaleBuckets(c){let y=!1;for(const B in this.indexes){const S=this.indexes[B];for(const F in S)c[S[F].bucketInstanceId]||(this.removeBucketCrossTileIDs(B,S[F]),delete S[F],y=!0)}return y}}class uh{constructor(){this.layerIndexes={},this.crossTileIDs=new Pc,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(c,y,B){let S=this.layerIndexes[c.id];S===void 0&&(S=this.layerIndexes[c.id]=new vo);let F=!1;const H={};S.handleWrapJump(B);for(const j of y){const Z=j.getBucket(c);Z&&c.id===Z.layerIds[0]&&(Z.bucketInstanceId||(Z.bucketInstanceId=++this.maxBucketInstanceId),S.addBucket(j.tileID,Z,this.crossTileIDs)&&(F=!0),H[Z.bucketInstanceId]=!0)}return S.removeStaleBuckets(H)&&(F=!0),F}pruneUnusedLayers(c){const y={};c.forEach(B=>{y[B]=!0});for(const B in this.layerIndexes)y[B]||delete this.layerIndexes[B]}}const os=(E,c)=>o.t(E,c&&c.filter(y=>y.identifier!=="source.canvas")),cu=o.aw();class ds extends o.E{constructor(c){let y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),this._rtlPluginLoaded=()=>{for(const B in this.sourceCaches){const S=this.sourceCaches[B].getSource().type;S!=="vector"&&S!=="geojson"||this.sourceCaches[B].reload()}},this.map=c,this.dispatcher=new $r(ar(),c._getMapId()),this.dispatcher.registerMessageHandler("GG",(B,S)=>this.getGlyphs(B,S)),this.dispatcher.registerMessageHandler("GI",(B,S)=>this.getImages(B,S)),this.imageManager=new tt,this.imageManager.setEventedParent(this),this.glyphManager=new Jt(c._requestManager,y.localIdeographFontFamily),this.lineAtlas=new ut(256,512),this.crossTileSymbolIndex=new uh,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new o.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",o.ay()),nn().on(br,this._rtlPluginLoaded),this.on("data",B=>{if(B.dataType!=="source"||B.sourceDataType!=="metadata")return;const S=this.sourceCaches[B.sourceId];if(!S)return;const F=S.getSource();if(F&&F.vectorLayerIds)for(const H in this._layers){const j=this._layers[H];j.source===F.id&&this._validateLayer(j)}})}loadURL(c){let y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},B=arguments.length>2?arguments[2]:void 0;this.fire(new o.k("dataloading",{dataType:"style"})),y.validate=typeof y.validate!="boolean"||y.validate;const S=this.map._requestManager.transformRequest(c,"Style");this._loadStyleRequest=new AbortController;const F=this._loadStyleRequest;o.h(S,this._loadStyleRequest).then(H=>{this._loadStyleRequest=null,this._load(H.data,y,B)}).catch(H=>{this._loadStyleRequest=null,H&&!F.signal.aborted&&this.fire(new o.j(H))})}loadJSON(c){let y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},B=arguments.length>2?arguments[2]:void 0;this.fire(new o.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,x.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,y.validate=y.validate!==!1,this._load(c,y,B)}).catch(()=>{})}loadEmpty(){this.fire(new o.k("dataloading",{dataType:"style"})),this._load(cu,{validate:!1})}_load(c,y,B){var S;const F=y.transformStyle?y.transformStyle(B,c):c;if(!y.validate||!os(this,o.u(F))){this._loaded=!0,this.stylesheet=F;for(const H in F.sources)this.addSource(H,F.sources[H],{validate:!1});F.sprite?this._loadSprite(F.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(F.glyphs),this._createLayers(),this.light=new Xt(this.stylesheet.light),this.sky=new $e(this.stylesheet.sky),this.map.setTerrain((S=this.stylesheet.terrain)!==null&&S!==void 0?S:null),this.fire(new o.k("data",{dataType:"style"})),this.fire(new o.k("style.load"))}}_createLayers(){const c=o.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",c),this._order=c.map(y=>y.id),this._layers={},this._serializedLayers=null;for(const y of c){const B=o.aA(y);B.setEventedParent(this,{layer:{id:y.id}}),this._layers[y.id]=B}}_loadSprite(c){let y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,B=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0,S;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(F,H,j,Z){return o._(this,void 0,void 0,function*(){const se=st(F),he=j>1?"@2x":"",ue={},Te={};for(const{id:Fe,url:Ee}of se){const Oe=H.transformRequest(at(Ee,he,".json"),"SpriteJSON");ue[Fe]=o.h(Oe,Z);const rt=H.transformRequest(at(Ee,he,".png"),"SpriteImage");Te[Fe]=ce.getImage(rt,Z)}return yield Promise.all([...Object.values(ue),...Object.values(Te)]),function(Fe,Ee){return o._(this,void 0,void 0,function*(){const Oe={};for(const rt in Fe){Oe[rt]={};const qe=x.getImageCanvasContext((yield Ee[rt]).data),Ze=(yield Fe[rt]).data;for(const ot in Ze){const{width:vt,height:kt,x:It,y:ur,sdf:wr,pixelRatio:Dr,stretchX:Or,stretchY:_r,content:xr,textFitWidth:Vr,textFitHeight:xn}=Ze[ot];Oe[rt][ot]={data:null,pixelRatio:Dr,sdf:wr,stretchX:Or,stretchY:_r,content:xr,textFitWidth:Vr,textFitHeight:xn,spriteData:{width:vt,height:kt,x:It,y:ur,context:qe}}}}return Oe})}(ue,Te)})}(c,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(F=>{if(this._spriteRequest=null,F)for(const H in F){this._spritesImagesIds[H]=[];const j=this._spritesImagesIds[H]?this._spritesImagesIds[H].filter(Z=>!(Z in F)):[];for(const Z of j)this.imageManager.removeImage(Z),this._changedImages[Z]=!0;for(const Z in F[H]){const se=H==="default"?Z:`${H}:${Z}`;this._spritesImagesIds[H].push(se),se in this.imageManager.images?this.imageManager.updateImage(se,F[H][Z],!1):this.imageManager.addImage(se,F[H][Z]),y&&(this._changedImages[se]=!0)}}}).catch(F=>{this._spriteRequest=null,S=F,this.fire(new o.j(S))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),y&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.k("data",{dataType:"style"})),B&&B(S)})}_unloadSprite(){for(const c of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(c),this._changedImages[c]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.k("data",{dataType:"style"}))}_validateLayer(c){const y=this.sourceCaches[c.source];if(!y)return;const B=c.sourceLayer;if(!B)return;const S=y.getSource();(S.type==="geojson"||S.vectorLayerIds&&S.vectorLayerIds.indexOf(B)===-1)&&this.fire(new o.j(new Error(`Source layer "${B}" does not exist on source "${S.id}" as specified by style layer "${c.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const c in this.sourceCaches)if(!this.sourceCaches[c].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(c){let y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const B=this._serializedAllLayers();if(!c||c.length===0)return Object.values(y?o.aB(B):B);const S=[];for(const F of c)if(B[F]){const H=y?o.aB(B[F]):B[F];S.push(H)}return S}_serializedAllLayers(){let c=this._serializedLayers;if(c)return c;c=this._serializedLayers={};const y=Object.keys(this._layers);for(const B of y){const S=this._layers[B];S.type!=="custom"&&(c[B]=S.serialize())}return c}hasTransitions(){if(this.light&&this.light.hasTransition()||this.sky&&this.sky.hasTransition())return!0;for(const c in this.sourceCaches)if(this.sourceCaches[c].hasTransition())return!0;for(const c in this._layers)if(this._layers[c].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(c){if(!this._loaded)return;const y=this._changed;if(y){const S=Object.keys(this._updatedLayers),F=Object.keys(this._removedLayers);(S.length||F.length)&&this._updateWorkerLayers(S,F);for(const H in this._updatedSources){const j=this._updatedSources[H];if(j==="reload")this._reloadSource(H);else{if(j!=="clear")throw new Error(`Invalid action ${j}`);this._clearSource(H)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const H in this._updatedPaintProps)this._layers[H].updateTransitions(c);this.light.updateTransitions(c),this.sky.updateTransitions(c),this._resetUpdates()}const B={};for(const S in this.sourceCaches){const F=this.sourceCaches[S];B[S]=F.used,F.used=!1}for(const S of this._order){const F=this._layers[S];F.recalculate(c,this._availableImages),!F.isHidden(c.zoom)&&F.source&&(this.sourceCaches[F.source].used=!0)}for(const S in B){const F=this.sourceCaches[S];!!B[S]!=!!F.used&&F.fire(new o.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:S}))}this.light.recalculate(c),this.sky.recalculate(c),this.z=c.zoom,y&&this.fire(new o.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const c=Object.keys(this._changedImages);if(c.length){for(const y in this.sourceCaches)this.sourceCaches[y].reloadTilesForDependencies(["icons","patterns"],c);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const c in this.sourceCaches)this.sourceCaches[c].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(c,y){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(c,!1),removedIds:y})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(c){let y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var B;this._checkLoaded();const S=this.serialize();if(c=y.transformStyle?y.transformStyle(S,c):c,((B=y.validate)===null||B===void 0||B)&&os(this,o.u(c)))return!1;(c=o.aB(c)).layers=o.az(c.layers);const F=o.aC(S,c),H=this._getOperationsToPerform(F);if(H.unimplemented.length>0)throw new Error(`Unimplemented: ${H.unimplemented.join(", ")}.`);if(H.operations.length===0)return!1;for(const j of H.operations)j();return this.stylesheet=c,this._serializedLayers=null,!0}_getOperationsToPerform(c){const y=[],B=[];for(const S of c)switch(S.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":y.push(()=>this.addLayer.apply(this,S.args));break;case"removeLayer":y.push(()=>this.removeLayer.apply(this,S.args));break;case"setPaintProperty":y.push(()=>this.setPaintProperty.apply(this,S.args));break;case"setLayoutProperty":y.push(()=>this.setLayoutProperty.apply(this,S.args));break;case"setFilter":y.push(()=>this.setFilter.apply(this,S.args));break;case"addSource":y.push(()=>this.addSource.apply(this,S.args));break;case"removeSource":y.push(()=>this.removeSource.apply(this,S.args));break;case"setLayerZoomRange":y.push(()=>this.setLayerZoomRange.apply(this,S.args));break;case"setLight":y.push(()=>this.setLight.apply(this,S.args));break;case"setGeoJSONSourceData":y.push(()=>this.setGeoJSONSourceData.apply(this,S.args));break;case"setGlyphs":y.push(()=>this.setGlyphs.apply(this,S.args));break;case"setSprite":y.push(()=>this.setSprite.apply(this,S.args));break;case"setSky":y.push(()=>this.setSky.apply(this,S.args));break;case"setTerrain":y.push(()=>this.map.setTerrain.apply(this,S.args));break;case"setTransition":y.push(()=>{});break;default:B.push(S.command)}return{operations:y,unimplemented:B}}addImage(c,y){if(this.getImage(c))return this.fire(new o.j(new Error(`An image named "${c}" already exists.`)));this.imageManager.addImage(c,y),this._afterImageUpdated(c)}updateImage(c,y){this.imageManager.updateImage(c,y)}getImage(c){return this.imageManager.getImage(c)}removeImage(c){if(!this.getImage(c))return this.fire(new o.j(new Error(`An image named "${c}" does not exist.`)));this.imageManager.removeImage(c),this._afterImageUpdated(c)}_afterImageUpdated(c){this._availableImages=this.imageManager.listImages(),this._changedImages[c]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(c,y){let B=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(this._checkLoaded(),this.sourceCaches[c]!==void 0)throw new Error(`Source "${c}" already exists.`);if(!y.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(y).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(y.type)>=0&&this._validate(o.u.source,`sources.${c}`,y,null,B))return;this.map&&this.map._collectResourceTiming&&(y.collectResourceTiming=!0);const S=this.sourceCaches[c]=new Xe(c,y,this.dispatcher);S.style=this,S.setEventedParent(this,()=>({isSourceLoaded:S.loaded(),source:S.serialize(),sourceId:c})),S.onAdd(this.map),this._changed=!0}removeSource(c){if(this._checkLoaded(),this.sourceCaches[c]===void 0)throw new Error("There is no source with this ID");for(const B in this._layers)if(this._layers[B].source===c)return this.fire(new o.j(new Error(`Source "${c}" cannot be removed while layer "${B}" is using it.`)));const y=this.sourceCaches[c];delete this.sourceCaches[c],delete this._updatedSources[c],y.fire(new o.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:c})),y.setEventedParent(null),y.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(c,y){if(this._checkLoaded(),this.sourceCaches[c]===void 0)throw new Error(`There is no source with this ID=${c}`);const B=this.sourceCaches[c].getSource();if(B.type!=="geojson")throw new Error(`geojsonSource.type is ${B.type}, which is !== 'geojson`);B.setData(y),this._changed=!0}getSource(c){return this.sourceCaches[c]&&this.sourceCaches[c].getSource()}addLayer(c,y){let B=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this._checkLoaded();const S=c.id;if(this.getLayer(S))return void this.fire(new o.j(new Error(`Layer "${S}" already exists on this map.`)));let F;if(c.type==="custom"){if(os(this,o.aD(c)))return;F=o.aA(c)}else{if("source"in c&&typeof c.source=="object"&&(this.addSource(S,c.source),c=o.aB(c),c=o.e(c,{source:S})),this._validate(o.u.layer,`layers.${S}`,c,{arrayIndex:-1},B))return;F=o.aA(c),this._validateLayer(F),F.setEventedParent(this,{layer:{id:S}})}const H=y?this._order.indexOf(y):this._order.length;if(y&&H===-1)this.fire(new o.j(new Error(`Cannot add layer "${S}" before non-existing layer "${y}".`)));else{if(this._order.splice(H,0,S),this._layerOrderChanged=!0,this._layers[S]=F,this._removedLayers[S]&&F.source&&F.type!=="custom"){const j=this._removedLayers[S];delete this._removedLayers[S],j.type!==F.type?this._updatedSources[F.source]="clear":(this._updatedSources[F.source]="reload",this.sourceCaches[F.source].pause())}this._updateLayer(F),F.onAdd&&F.onAdd(this.map)}}moveLayer(c,y){if(this._checkLoaded(),this._changed=!0,!this._layers[c])return void this.fire(new o.j(new Error(`The layer '${c}' does not exist in the map's style and cannot be moved.`)));if(c===y)return;const B=this._order.indexOf(c);this._order.splice(B,1);const S=y?this._order.indexOf(y):this._order.length;y&&S===-1?this.fire(new o.j(new Error(`Cannot move layer "${c}" before non-existing layer "${y}".`))):(this._order.splice(S,0,c),this._layerOrderChanged=!0)}removeLayer(c){this._checkLoaded();const y=this._layers[c];if(!y)return void this.fire(new o.j(new Error(`Cannot remove non-existing layer "${c}".`)));y.setEventedParent(null);const B=this._order.indexOf(c);this._order.splice(B,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[c]=y,delete this._layers[c],this._serializedLayers&&delete this._serializedLayers[c],delete this._updatedLayers[c],delete this._updatedPaintProps[c],y.onRemove&&y.onRemove(this.map)}getLayer(c){return this._layers[c]}getLayersOrder(){return[...this._order]}hasLayer(c){return c in this._layers}setLayerZoomRange(c,y,B){this._checkLoaded();const S=this.getLayer(c);S?S.minzoom===y&&S.maxzoom===B||(y!=null&&(S.minzoom=y),B!=null&&(S.maxzoom=B),this._updateLayer(S)):this.fire(new o.j(new Error(`Cannot set the zoom range of non-existing layer "${c}".`)))}setFilter(c,y){let B=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this._checkLoaded();const S=this.getLayer(c);if(S){if(!o.aE(S.filter,y))return y==null?(S.filter=void 0,void this._updateLayer(S)):void(this._validate(o.u.filter,`layers.${S.id}.filter`,y,null,B)||(S.filter=o.aB(y),this._updateLayer(S)))}else this.fire(new o.j(new Error(`Cannot filter non-existing layer "${c}".`)))}getFilter(c){return o.aB(this.getLayer(c).filter)}setLayoutProperty(c,y,B){let S=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};this._checkLoaded();const F=this.getLayer(c);F?o.aE(F.getLayoutProperty(y),B)||(F.setLayoutProperty(y,B,S),this._updateLayer(F)):this.fire(new o.j(new Error(`Cannot style non-existing layer "${c}".`)))}getLayoutProperty(c,y){const B=this.getLayer(c);if(B)return B.getLayoutProperty(y);this.fire(new o.j(new Error(`Cannot get style of non-existing layer "${c}".`)))}setPaintProperty(c,y,B){let S=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};this._checkLoaded();const F=this.getLayer(c);F?o.aE(F.getPaintProperty(y),B)||(F.setPaintProperty(y,B,S)&&this._updateLayer(F),this._changed=!0,this._updatedPaintProps[c]=!0,this._serializedLayers=null):this.fire(new o.j(new Error(`Cannot style non-existing layer "${c}".`)))}getPaintProperty(c,y){return this.getLayer(c).getPaintProperty(y)}setFeatureState(c,y){this._checkLoaded();const B=c.source,S=c.sourceLayer,F=this.sourceCaches[B];if(F===void 0)return void this.fire(new o.j(new Error(`The source '${B}' does not exist in the map's style.`)));const H=F.getSource().type;H==="geojson"&&S?this.fire(new o.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):H!=="vector"||S?(c.id===void 0&&this.fire(new o.j(new Error("The feature id parameter must be provided."))),F.setFeatureState(S,c.id,y)):this.fire(new o.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(c,y){this._checkLoaded();const B=c.source,S=this.sourceCaches[B];if(S===void 0)return void this.fire(new o.j(new Error(`The source '${B}' does not exist in the map's style.`)));const F=S.getSource().type,H=F==="vector"?c.sourceLayer:void 0;F!=="vector"||H?y&&typeof c.id!="string"&&typeof c.id!="number"?this.fire(new o.j(new Error("A feature id is required to remove its specific state property."))):S.removeFeatureState(H,c.id,y):this.fire(new o.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(c){this._checkLoaded();const y=c.source,B=c.sourceLayer,S=this.sourceCaches[y];if(S!==void 0)return S.getSource().type!=="vector"||B?(c.id===void 0&&this.fire(new o.j(new Error("The feature id parameter must be provided."))),S.getFeatureState(B,c.id)):void this.fire(new o.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new o.j(new Error(`The source '${y}' does not exist in the map's style.`)))}getTransition(){return o.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const c=o.aF(this.sourceCaches,F=>F.serialize()),y=this._serializeByIds(this._order,!0),B=this.map.getTerrain()||void 0,S=this.stylesheet;return o.aG({version:S.version,name:S.name,metadata:S.metadata,light:S.light,sky:S.sky,center:S.center,zoom:S.zoom,bearing:S.bearing,pitch:S.pitch,sprite:S.sprite,glyphs:S.glyphs,transition:S.transition,sources:c,layers:y,terrain:B},F=>F!==void 0)}_updateLayer(c){this._updatedLayers[c.id]=!0,c.source&&!this._updatedSources[c.source]&&this.sourceCaches[c.source].getSource().type!=="raster"&&(this._updatedSources[c.source]="reload",this.sourceCaches[c.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(c){const y=H=>this._layers[H].type==="fill-extrusion",B={},S=[];for(let H=this._order.length-1;H>=0;H--){const j=this._order[H];if(y(j)){B[j]=H;for(const Z of c){const se=Z[j];if(se)for(const he of se)S.push(he)}}}S.sort((H,j)=>j.intersectionZ-H.intersectionZ);const F=[];for(let H=this._order.length-1;H>=0;H--){const j=this._order[H];if(y(j))for(let Z=S.length-1;Z>=0;Z--){const se=S[Z].feature;if(B[se.layer.id]<H)break;F.push(se),S.pop()}else for(const Z of c){const se=Z[j];if(se)for(const he of se)F.push(he.feature)}}return F}queryRenderedFeatures(c,y,B){y&&y.filter&&this._validate(o.u.filter,"queryRenderedFeatures.filter",y.filter,null,y);const S={};if(y&&y.layers){if(!Array.isArray(y.layers))return this.fire(new o.j(new Error("parameters.layers must be an Array."))),[];for(const j of y.layers){const Z=this._layers[j];if(!Z)return this.fire(new o.j(new Error(`The layer '${j}' does not exist in the map's style and cannot be queried for features.`))),[];S[Z.source]=!0}}const F=[];y.availableImages=this._availableImages;const H=this._serializedAllLayers();for(const j in this.sourceCaches)y.layers&&!S[j]||F.push(sn(this.sourceCaches[j],this._layers,H,c,y,B));return this.placement&&F.push(function(j,Z,se,he,ue,Te,Fe){const Ee={},Oe=Te.queryRenderedSymbols(he),rt=[];for(const qe of Object.keys(Oe).map(Number))rt.push(Fe[qe]);rt.sort(on);for(const qe of rt){const Ze=qe.featureIndex.lookupSymbolFeatures(Oe[qe.bucketInstanceId],Z,qe.bucketIndex,qe.sourceLayerIndex,ue.filter,ue.layers,ue.availableImages,j);for(const ot in Ze){const vt=Ee[ot]=Ee[ot]||[],kt=Ze[ot];kt.sort((It,ur)=>{const wr=qe.featureSortOrder;if(wr){const Dr=wr.indexOf(It.featureIndex);return wr.indexOf(ur.featureIndex)-Dr}return ur.featureIndex-It.featureIndex});for(const It of kt)vt.push(It)}}for(const qe in Ee)Ee[qe].forEach(Ze=>{const ot=Ze.feature,vt=se[j[qe].source].getFeatureState(ot.layer["source-layer"],ot.id);ot.source=ot.layer.source,ot.layer["source-layer"]&&(ot.sourceLayer=ot.layer["source-layer"]),ot.state=vt});return Ee}(this._layers,H,this.sourceCaches,c,y,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(F)}querySourceFeatures(c,y){y&&y.filter&&this._validate(o.u.filter,"querySourceFeatures.filter",y.filter,null,y);const B=this.sourceCaches[c];return B?function(S,F){const H=S.getRenderableIds().map(se=>S.getTileByID(se)),j=[],Z={};for(let se=0;se<H.length;se++){const he=H[se],ue=he.tileID.canonical.key;Z[ue]||(Z[ue]=!0,he.querySourceFeatures(j,F))}return j}(B,y):[]}getLight(){return this.light.getLight()}setLight(c){let y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this._checkLoaded();const B=this.light.getLight();let S=!1;for(const H in c)if(!o.aE(c[H],B[H])){S=!0;break}if(!S)return;const F={now:x.now(),transition:o.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(c,y),this.light.updateTransitions(F)}getSky(){var c;return(c=this.stylesheet)===null||c===void 0?void 0:c.sky}setSky(c){let y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const B=this.getSky();let S=!1;if(!c&&!B)return;if(c&&!B)S=!0;else if(!c&&B)S=!0;else for(const H in c)if(!o.aE(c[H],B[H])){S=!0;break}if(!S)return;const F={now:x.now(),transition:o.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=c,this.sky.setSky(c,y),this.sky.updateTransitions(F)}_validate(c,y,B,S){let F=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};return(!F||F.validate!==!1)&&os(this,c.call(o.u,o.e({key:y,style:this.serialize(),value:B,styleSpec:o.v},S)))}_remove(){let c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),nn().off(br,this._rtlPluginLoaded);for(const y in this._layers)this._layers[y].setEventedParent(null);for(const y in this.sourceCaches){const B=this.sourceCaches[y];B.setEventedParent(null),B.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),c&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(c)}_clearSource(c){this.sourceCaches[c].clearTiles()}_reloadSource(c){this.sourceCaches[c].resume(),this.sourceCaches[c].reload()}_updateSources(c){for(const y in this.sourceCaches)this.sourceCaches[y].update(c,this.map.terrain)}_generateCollisionBoxes(){for(const c in this.sourceCaches)this._reloadSource(c)}_updatePlacement(c,y,B,S){let F=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1,H=!1,j=!1;const Z={};for(const se of this._order){const he=this._layers[se];if(he.type!=="symbol")continue;if(!Z[he.source]){const Te=this.sourceCaches[he.source];Z[he.source]=Te.getRenderableIds(!0).map(Fe=>Te.getTileByID(Fe)).sort((Fe,Ee)=>Ee.tileID.overscaledZ-Fe.tileID.overscaledZ||(Fe.tileID.isLessThan(Ee.tileID)?-1:1))}const ue=this.crossTileSymbolIndex.addLayer(he,Z[he.source],c.center.lng);H=H||ue}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((F=F||this._layerOrderChanged||B===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(x.now(),c.zoom))&&(this.pauseablePlacement=new ss(c,this.map.terrain,this._order,F,y,B,S,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,Z),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(x.now()),j=!0),H&&this.pauseablePlacement.placement.setStale()),j||H)for(const se of this._order){const he=this._layers[se];he.type==="symbol"&&this.placement.updateLayerOpacities(he,Z[he.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(x.now())}_releaseSymbolFadeTiles(){for(const c in this.sourceCaches)this.sourceCaches[c].releaseSymbolFadeTiles()}getImages(c,y){return o._(this,void 0,void 0,function*(){const B=yield this.imageManager.getImages(y.icons);this._updateTilesForChangedImages();const S=this.sourceCaches[y.source];return S&&S.setDependencies(y.tileID.key,y.type,y.icons),B})}getGlyphs(c,y){return o._(this,void 0,void 0,function*(){const B=yield this.glyphManager.getGlyphs(y.stacks),S=this.sourceCaches[y.source];return S&&S.setDependencies(y.tileID.key,y.type,[""]),B})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(c){let y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this._checkLoaded(),c&&this._validate(o.u.glyphs,"glyphs",c,null,y)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=c,this.glyphManager.entries={},this.glyphManager.setURL(c))}addSprite(c,y){let B=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},S=arguments.length>3?arguments[3]:void 0;this._checkLoaded();const F=[{id:c,url:y}],H=[...st(this.stylesheet.sprite),...F];this._validate(o.u.sprite,"sprite",H,null,B)||(this.stylesheet.sprite=H,this._loadSprite(F,!0,S))}removeSprite(c){this._checkLoaded();const y=st(this.stylesheet.sprite);if(y.find(B=>B.id===c)){if(this._spritesImagesIds[c])for(const B of this._spritesImagesIds[c])this.imageManager.removeImage(B),this._changedImages[B]=!0;y.splice(y.findIndex(B=>B.id===c),1),this.stylesheet.sprite=y.length>0?y:void 0,delete this._spritesImagesIds[c],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.k("data",{dataType:"style"}))}else this.fire(new o.j(new Error(`Sprite "${c}" doesn't exists on this map.`)))}getSprite(){return st(this.stylesheet.sprite)}setSprite(c){let y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},B=arguments.length>2?arguments[2]:void 0;this._checkLoaded(),c&&this._validate(o.u.sprite,"sprite",c,null,y)||(this.stylesheet.sprite=c,c?this._loadSprite(c,!0,B):(this._unloadSprite(),B&&B(null)))}}var ri=o.Y([{name:"a_pos",type:"Int16",components:2}]);const lo={prelude:yn(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:yn(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:yn(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:yn(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:yn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:yn(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,get_elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}`),heatmapTexture:yn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:yn("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:yn("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:yn("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:yn(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:yn(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:yn(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:yn(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:yn(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:yn(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:yn(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:yn(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:yn(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:yn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:yn(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:yn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:yn(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:yn(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:yn(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:yn(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:yn("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;varying vec2 v_texture_pos;varying float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture2D(u_texture,v_texture_pos);if (v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);gl_FragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {gl_FragColor=surface_color;}}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform mat4 u_fog_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:yn("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:yn("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);}"),sky:yn("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform float u_horizon;uniform float u_sky_horizon_blend;void main() {float y=gl_FragCoord.y;if (y > u_horizon) {float blend=y-u_horizon;if (blend < u_sky_horizon_blend) {gl_FragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {gl_FragColor=u_sky_color;}}}","attribute vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function yn(E,c){const y=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,B=c.match(/attribute ([\w]+) ([\w]+)/g),S=E.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),F=c.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),H=F?F.concat(S):S,j={};return{fragmentSource:E=E.replace(y,(Z,se,he,ue,Te)=>(j[Te]=!0,se==="define"?`
#ifndef HAS_UNIFORM_u_${Te}
varying ${he} ${ue} ${Te};
#else
uniform ${he} ${ue} u_${Te};
#endif
`:`
#ifdef HAS_UNIFORM_u_${Te}
    ${he} ${ue} ${Te} = u_${Te};
#endif
`)),vertexSource:c=c.replace(y,(Z,se,he,ue,Te)=>{const Fe=ue==="float"?"vec2":"vec4",Ee=Te.match(/color/)?"color":Fe;return j[Te]?se==="define"?`
#ifndef HAS_UNIFORM_u_${Te}
uniform lowp float u_${Te}_t;
attribute ${he} ${Fe} a_${Te};
varying ${he} ${ue} ${Te};
#else
uniform ${he} ${ue} u_${Te};
#endif
`:Ee==="vec4"?`
#ifndef HAS_UNIFORM_u_${Te}
    ${Te} = a_${Te};
#else
    ${he} ${ue} ${Te} = u_${Te};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Te}
    ${Te} = unpack_mix_${Ee}(a_${Te}, u_${Te}_t);
#else
    ${he} ${ue} ${Te} = u_${Te};
#endif
`:se==="define"?`
#ifndef HAS_UNIFORM_u_${Te}
uniform lowp float u_${Te}_t;
attribute ${he} ${Fe} a_${Te};
#else
uniform ${he} ${ue} u_${Te};
#endif
`:Ee==="vec4"?`
#ifndef HAS_UNIFORM_u_${Te}
    ${he} ${ue} ${Te} = a_${Te};
#else
    ${he} ${ue} ${Te} = u_${Te};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Te}
    ${he} ${ue} ${Te} = unpack_mix_${Ee}(a_${Te}, u_${Te}_t);
#else
    ${he} ${ue} ${Te} = u_${Te};
#endif
`}),staticAttributes:B,staticUniforms:H}}class Fc{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(c,y,B,S,F,H,j,Z,se){this.context=c;let he=this.boundPaintVertexBuffers.length!==S.length;for(let ue=0;!he&&ue<S.length;ue++)this.boundPaintVertexBuffers[ue]!==S[ue]&&(he=!0);!this.vao||this.boundProgram!==y||this.boundLayoutVertexBuffer!==B||he||this.boundIndexBuffer!==F||this.boundVertexOffset!==H||this.boundDynamicVertexBuffer!==j||this.boundDynamicVertexBuffer2!==Z||this.boundDynamicVertexBuffer3!==se?this.freshBind(y,B,S,F,H,j,Z,se):(c.bindVertexArray.set(this.vao),j&&j.bind(),F&&F.dynamicDraw&&F.bind(),Z&&Z.bind(),se&&se.bind())}freshBind(c,y,B,S,F,H,j,Z){const se=c.numAttributes,he=this.context,ue=he.gl;this.vao&&this.destroy(),this.vao=he.createVertexArray(),he.bindVertexArray.set(this.vao),this.boundProgram=c,this.boundLayoutVertexBuffer=y,this.boundPaintVertexBuffers=B,this.boundIndexBuffer=S,this.boundVertexOffset=F,this.boundDynamicVertexBuffer=H,this.boundDynamicVertexBuffer2=j,this.boundDynamicVertexBuffer3=Z,y.enableAttributes(ue,c);for(const Te of B)Te.enableAttributes(ue,c);H&&H.enableAttributes(ue,c),j&&j.enableAttributes(ue,c),Z&&Z.enableAttributes(ue,c),y.bind(),y.setVertexAttribPointers(ue,c,F);for(const Te of B)Te.bind(),Te.setVertexAttribPointers(ue,c,F);H&&(H.bind(),H.setVertexAttribPointers(ue,c,F)),S&&S.bind(),j&&(j.bind(),j.setVertexAttribPointers(ue,c,F)),Z&&(Z.bind(),Z.setVertexAttribPointers(ue,c,F)),he.currentNumAttributes=se}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const hh=(E,c,y,B,S)=>({u_matrix:E,u_texture:0,u_ele_delta:c,u_fog_matrix:y,u_fog_color:B?B.properties.get("fog-color"):o.aM.white,u_fog_ground_blend:B?B.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:B?B.calculateFogBlendOpacity(S):0,u_horizon_color:B?B.properties.get("horizon-color"):o.aM.white,u_horizon_fog_blend:B?B.properties.get("horizon-fog-blend"):1});function $a(E){const c=[];for(let y=0;y<E.length;y++){if(E[y]===null)continue;const B=E[y].split(" ");c.push(B.pop())}return c}class fs{constructor(c,y,B,S,F,H){const j=c.gl;this.program=j.createProgram();const Z=$a(y.staticAttributes),se=B?B.getBinderAttributes():[],he=Z.concat(se),ue=lo.prelude.staticUniforms?$a(lo.prelude.staticUniforms):[],Te=y.staticUniforms?$a(y.staticUniforms):[],Fe=B?B.getBinderUniforms():[],Ee=ue.concat(Te).concat(Fe),Oe=[];for(const It of Ee)Oe.indexOf(It)<0&&Oe.push(It);const rt=B?B.defines():[];F&&rt.push("#define OVERDRAW_INSPECTOR;"),H&&rt.push("#define TERRAIN3D;");const qe=rt.concat(lo.prelude.fragmentSource,y.fragmentSource).join(`
`),Ze=rt.concat(lo.prelude.vertexSource,y.vertexSource).join(`
`),ot=j.createShader(j.FRAGMENT_SHADER);if(j.isContextLost())return void(this.failedToCreate=!0);if(j.shaderSource(ot,qe),j.compileShader(ot),!j.getShaderParameter(ot,j.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${j.getShaderInfoLog(ot)}`);j.attachShader(this.program,ot);const vt=j.createShader(j.VERTEX_SHADER);if(j.isContextLost())return void(this.failedToCreate=!0);if(j.shaderSource(vt,Ze),j.compileShader(vt),!j.getShaderParameter(vt,j.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${j.getShaderInfoLog(vt)}`);j.attachShader(this.program,vt),this.attributes={};const kt={};this.numAttributes=he.length;for(let It=0;It<this.numAttributes;It++)he[It]&&(j.bindAttribLocation(this.program,It,he[It]),this.attributes[he[It]]=It);if(j.linkProgram(this.program),!j.getProgramParameter(this.program,j.LINK_STATUS))throw new Error(`Program failed to link: ${j.getProgramInfoLog(this.program)}`);j.deleteShader(vt),j.deleteShader(ot);for(let It=0;It<Oe.length;It++){const ur=Oe[It];if(ur&&!kt[ur]){const wr=j.getUniformLocation(this.program,ur);wr&&(kt[ur]=wr)}}this.fixedUniforms=S(c,kt),this.terrainUniforms=((It,ur)=>({u_depth:new o.aH(It,ur.u_depth),u_terrain:new o.aH(It,ur.u_terrain),u_terrain_dim:new o.aI(It,ur.u_terrain_dim),u_terrain_matrix:new o.aJ(It,ur.u_terrain_matrix),u_terrain_unpack:new o.aK(It,ur.u_terrain_unpack),u_terrain_exaggeration:new o.aI(It,ur.u_terrain_exaggeration)}))(c,kt),this.binderUniforms=B?B.getUniforms(c,kt):[]}draw(c,y,B,S,F,H,j,Z,se,he,ue,Te,Fe,Ee,Oe,rt,qe,Ze){const ot=c.gl;if(this.failedToCreate)return;if(c.program.set(this.program),c.setDepthMode(B),c.setStencilMode(S),c.setColorMode(F),c.setCullFace(H),Z){c.activeTexture.set(ot.TEXTURE2),ot.bindTexture(ot.TEXTURE_2D,Z.depthTexture),c.activeTexture.set(ot.TEXTURE3),ot.bindTexture(ot.TEXTURE_2D,Z.texture);for(const kt in this.terrainUniforms)this.terrainUniforms[kt].set(Z[kt])}for(const kt in this.fixedUniforms)this.fixedUniforms[kt].set(j[kt]);Oe&&Oe.setUniforms(c,this.binderUniforms,Fe,{zoom:Ee});let vt=0;switch(y){case ot.LINES:vt=2;break;case ot.TRIANGLES:vt=3;break;case ot.LINE_STRIP:vt=1}for(const kt of Te.get()){const It=kt.vaos||(kt.vaos={});(It[se]||(It[se]=new Fc)).bind(c,this,he,Oe?Oe.getPaintVertexBuffers():[],ue,kt.vertexOffset,rt,qe,Ze),ot.drawElements(y,kt.primitiveLength*vt,ot.UNSIGNED_SHORT,kt.primitiveOffset*vt*2)}}}function As(E,c,y){const B=1/_n(y,1,c.transform.tileZoom),S=Math.pow(2,y.tileID.overscaledZ),F=y.tileSize*Math.pow(2,c.transform.tileZoom)/S,H=F*(y.tileID.canonical.x+y.tileID.wrap*S),j=F*y.tileID.canonical.y;return{u_image:0,u_texsize:y.imageAtlasTexture.size,u_scale:[B,E.fromScale,E.toScale],u_fade:E.t,u_pixel_coord_upper:[H>>16,j>>16],u_pixel_coord_lower:[65535&H,65535&j]}}const Gi=(E,c,y,B)=>{const S=c.style.light,F=S.properties.get("position"),H=[F.x,F.y,F.z],j=function(){var se=new o.A(9);return o.A!=Float32Array&&(se[1]=0,se[2]=0,se[3]=0,se[5]=0,se[6]=0,se[7]=0),se[0]=1,se[4]=1,se[8]=1,se}();S.properties.get("anchor")==="viewport"&&function(se,he){var ue=Math.sin(he),Te=Math.cos(he);se[0]=Te,se[1]=ue,se[2]=0,se[3]=-ue,se[4]=Te,se[5]=0,se[6]=0,se[7]=0,se[8]=1}(j,-c.transform.angle),function(se,he,ue){var Te=he[0],Fe=he[1],Ee=he[2];se[0]=Te*ue[0]+Fe*ue[3]+Ee*ue[6],se[1]=Te*ue[1]+Fe*ue[4]+Ee*ue[7],se[2]=Te*ue[2]+Fe*ue[5]+Ee*ue[8]}(H,H,j);const Z=S.properties.get("color");return{u_matrix:E,u_lightpos:H,u_lightintensity:S.properties.get("intensity"),u_lightcolor:[Z.r,Z.g,Z.b],u_vertical_gradient:+y,u_opacity:B}},uu=(E,c,y,B,S,F,H)=>o.e(Gi(E,c,y,B),As(F,c,H),{u_height_factor:-Math.pow(2,S.overscaledZ)/H.tileSize/8}),Us=E=>({u_matrix:E}),vs=(E,c,y,B)=>o.e(Us(E),As(y,c,B)),eo=(E,c)=>({u_matrix:E,u_world:c}),Rc=(E,c,y,B,S)=>o.e(vs(E,c,y,B),{u_world:S}),oc=(E,c,y,B)=>{const S=E.transform;let F,H;if(B.paint.get("circle-pitch-alignment")==="map"){const j=_n(y,1,S.zoom);F=!0,H=[j,j]}else F=!1,H=S.pixelsToGLUnits;return{u_camera_to_center_distance:S.cameraToCenterDistance,u_scale_with_map:+(B.paint.get("circle-pitch-scale")==="map"),u_matrix:E.translatePosMatrix(c.posMatrix,y,B.paint.get("circle-translate"),B.paint.get("circle-translate-anchor")),u_pitch_with_map:+F,u_device_pixel_ratio:E.pixelRatio,u_extrude_scale:H}},ai=(E,c,y)=>({u_matrix:E,u_inv_matrix:c,u_camera_to_center_distance:y.cameraToCenterDistance,u_viewport_size:[y.width,y.height]}),Dl=function(E,c){let y=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;return{u_matrix:E,u_color:c,u_overlay:0,u_overlay_scale:y}},ps=E=>({u_matrix:E}),Dn=(E,c,y,B)=>({u_matrix:E,u_extrude_scale:_n(c,1,y),u_intensity:B}),Ro=(E,c,y,B)=>{const S=o.H();o.aP(S,0,E.width,E.height,0,0,1);const F=E.context.gl;return{u_matrix:S,u_world:[F.drawingBufferWidth,F.drawingBufferHeight],u_image:y,u_color_ramp:B,u_opacity:c.paint.get("heatmap-opacity")}};function hu(E,c){const y=Math.pow(2,c.canonical.z),B=c.canonical.y;return[new o.Z(0,B/y).toLngLat().lat,new o.Z(0,(B+1)/y).toLngLat().lat]}const to=(E,c,y,B)=>{const S=E.transform;return{u_matrix:si(E,c,y,B),u_ratio:1/_n(c,1,S.zoom),u_device_pixel_ratio:E.pixelRatio,u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]]}},du=(E,c,y,B,S)=>o.e(to(E,c,y,S),{u_image:0,u_image_height:B}),Li=(E,c,y,B,S)=>{const F=E.transform,H=Ai(c,F);return{u_matrix:si(E,c,y,S),u_texsize:c.imageAtlasTexture.size,u_ratio:1/_n(c,1,F.zoom),u_device_pixel_ratio:E.pixelRatio,u_image:0,u_scale:[H,B.fromScale,B.toScale],u_fade:B.t,u_units_to_pixels:[1/F.pixelsToGLUnits[0],1/F.pixelsToGLUnits[1]]}},Ol=(E,c,y,B,S,F)=>{const H=E.lineAtlas,j=Ai(c,E.transform),Z=y.layout.get("line-cap")==="round",se=H.getDash(B.from,Z),he=H.getDash(B.to,Z),ue=se.width*S.fromScale,Te=he.width*S.toScale;return o.e(to(E,c,y,F),{u_patternscale_a:[j/ue,-se.height/2],u_patternscale_b:[j/Te,-he.height/2],u_sdfgamma:H.width/(256*Math.min(ue,Te)*E.pixelRatio)/2,u_image:0,u_tex_y_a:se.y,u_tex_y_b:he.y,u_mix:S.t})};function Ai(E,c){return 1/_n(E,1,c.tileZoom)}function si(E,c,y,B){return E.translatePosMatrix(B?B.posMatrix:c.tileID.posMatrix,c,y.paint.get("line-translate"),y.paint.get("line-translate-anchor"))}const ku=(E,c,y,B,S)=>{return{u_matrix:E,u_tl_parent:c,u_scale_parent:y,u_buffer_scale:1,u_fade_t:B.mix,u_opacity:B.opacity*S.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:S.paint.get("raster-brightness-min"),u_brightness_high:S.paint.get("raster-brightness-max"),u_saturation_factor:(H=S.paint.get("raster-saturation"),H>0?1-1/(1.001-H):-H),u_contrast_factor:(F=S.paint.get("raster-contrast"),F>0?1/(1-F):1+F),u_spin_weights:wi(S.paint.get("raster-hue-rotate"))};var F,H};function wi(E){E*=Math.PI/180;const c=Math.sin(E),y=Math.cos(E);return[(2*y+1)/3,(-Math.sqrt(3)*c-y+1)/3,(Math.sqrt(3)*c-y+1)/3]}const kl=(E,c,y,B,S,F,H,j,Z,se,he,ue,Te,Fe)=>{const Ee=H.transform;return{u_is_size_zoom_constant:+(E==="constant"||E==="source"),u_is_size_feature_constant:+(E==="constant"||E==="camera"),u_size_t:c?c.uSizeT:0,u_size:c?c.uSize:0,u_camera_to_center_distance:Ee.cameraToCenterDistance,u_pitch:Ee.pitch/360*2*Math.PI,u_rotate_symbol:+y,u_aspect_ratio:Ee.width/Ee.height,u_fade_change:H.options.fadeDuration?H.symbolFadeChange:1,u_matrix:j,u_label_plane_matrix:Z,u_coord_matrix:se,u_is_text:+ue,u_pitch_with_map:+B,u_is_along_line:S,u_is_variable_anchor:F,u_texsize:Te,u_texture:0,u_translation:he,u_pitched_scale:Fe}},ro=(E,c,y,B,S,F,H,j,Z,se,he,ue,Te,Fe,Ee)=>{const Oe=H.transform;return o.e(kl(E,c,y,B,S,F,H,j,Z,se,he,ue,Te,Ee),{u_gamma_scale:B?Math.cos(Oe._pitch)*Oe.cameraToCenterDistance:1,u_device_pixel_ratio:H.pixelRatio,u_is_halo:+Fe})},Ba=(E,c,y,B,S,F,H,j,Z,se,he,ue,Te,Fe)=>o.e(ro(E,c,y,B,S,F,H,j,Z,se,he,!0,ue,!0,Fe),{u_texsize_icon:Te,u_texture_icon:1}),ac=(E,c,y)=>({u_matrix:E,u_opacity:c,u_color:y}),ja=(E,c,y,B,S,F)=>o.e(function(H,j,Z,se){const he=Z.imageManager.getPattern(H.from.toString()),ue=Z.imageManager.getPattern(H.to.toString()),{width:Te,height:Fe}=Z.imageManager.getPixelSize(),Ee=Math.pow(2,se.tileID.overscaledZ),Oe=se.tileSize*Math.pow(2,Z.transform.tileZoom)/Ee,rt=Oe*(se.tileID.canonical.x+se.tileID.wrap*Ee),qe=Oe*se.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:he.tl,u_pattern_br_a:he.br,u_pattern_tl_b:ue.tl,u_pattern_br_b:ue.br,u_texsize:[Te,Fe],u_mix:j.t,u_pattern_size_a:he.displaySize,u_pattern_size_b:ue.displaySize,u_scale_a:j.fromScale,u_scale_b:j.toScale,u_tile_units_to_pixels:1/_n(se,1,Z.transform.tileZoom),u_pixel_coord_upper:[rt>>16,qe>>16],u_pixel_coord_lower:[65535&rt,65535&qe]}}(B,F,y,S),{u_matrix:E,u_opacity:c}),qa={fillExtrusion:(E,c)=>({u_matrix:new o.aJ(E,c.u_matrix),u_lightpos:new o.aN(E,c.u_lightpos),u_lightintensity:new o.aI(E,c.u_lightintensity),u_lightcolor:new o.aN(E,c.u_lightcolor),u_vertical_gradient:new o.aI(E,c.u_vertical_gradient),u_opacity:new o.aI(E,c.u_opacity)}),fillExtrusionPattern:(E,c)=>({u_matrix:new o.aJ(E,c.u_matrix),u_lightpos:new o.aN(E,c.u_lightpos),u_lightintensity:new o.aI(E,c.u_lightintensity),u_lightcolor:new o.aN(E,c.u_lightcolor),u_vertical_gradient:new o.aI(E,c.u_vertical_gradient),u_height_factor:new o.aI(E,c.u_height_factor),u_image:new o.aH(E,c.u_image),u_texsize:new o.aO(E,c.u_texsize),u_pixel_coord_upper:new o.aO(E,c.u_pixel_coord_upper),u_pixel_coord_lower:new o.aO(E,c.u_pixel_coord_lower),u_scale:new o.aN(E,c.u_scale),u_fade:new o.aI(E,c.u_fade),u_opacity:new o.aI(E,c.u_opacity)}),fill:(E,c)=>({u_matrix:new o.aJ(E,c.u_matrix)}),fillPattern:(E,c)=>({u_matrix:new o.aJ(E,c.u_matrix),u_image:new o.aH(E,c.u_image),u_texsize:new o.aO(E,c.u_texsize),u_pixel_coord_upper:new o.aO(E,c.u_pixel_coord_upper),u_pixel_coord_lower:new o.aO(E,c.u_pixel_coord_lower),u_scale:new o.aN(E,c.u_scale),u_fade:new o.aI(E,c.u_fade)}),fillOutline:(E,c)=>({u_matrix:new o.aJ(E,c.u_matrix),u_world:new o.aO(E,c.u_world)}),fillOutlinePattern:(E,c)=>({u_matrix:new o.aJ(E,c.u_matrix),u_world:new o.aO(E,c.u_world),u_image:new o.aH(E,c.u_image),u_texsize:new o.aO(E,c.u_texsize),u_pixel_coord_upper:new o.aO(E,c.u_pixel_coord_upper),u_pixel_coord_lower:new o.aO(E,c.u_pixel_coord_lower),u_scale:new o.aN(E,c.u_scale),u_fade:new o.aI(E,c.u_fade)}),circle:(E,c)=>({u_camera_to_center_distance:new o.aI(E,c.u_camera_to_center_distance),u_scale_with_map:new o.aH(E,c.u_scale_with_map),u_pitch_with_map:new o.aH(E,c.u_pitch_with_map),u_extrude_scale:new o.aO(E,c.u_extrude_scale),u_device_pixel_ratio:new o.aI(E,c.u_device_pixel_ratio),u_matrix:new o.aJ(E,c.u_matrix)}),collisionBox:(E,c)=>({u_matrix:new o.aJ(E,c.u_matrix),u_pixel_extrude_scale:new o.aO(E,c.u_pixel_extrude_scale)}),collisionCircle:(E,c)=>({u_matrix:new o.aJ(E,c.u_matrix),u_inv_matrix:new o.aJ(E,c.u_inv_matrix),u_camera_to_center_distance:new o.aI(E,c.u_camera_to_center_distance),u_viewport_size:new o.aO(E,c.u_viewport_size)}),debug:(E,c)=>({u_color:new o.aL(E,c.u_color),u_matrix:new o.aJ(E,c.u_matrix),u_overlay:new o.aH(E,c.u_overlay),u_overlay_scale:new o.aI(E,c.u_overlay_scale)}),clippingMask:(E,c)=>({u_matrix:new o.aJ(E,c.u_matrix)}),heatmap:(E,c)=>({u_extrude_scale:new o.aI(E,c.u_extrude_scale),u_intensity:new o.aI(E,c.u_intensity),u_matrix:new o.aJ(E,c.u_matrix)}),heatmapTexture:(E,c)=>({u_matrix:new o.aJ(E,c.u_matrix),u_world:new o.aO(E,c.u_world),u_image:new o.aH(E,c.u_image),u_color_ramp:new o.aH(E,c.u_color_ramp),u_opacity:new o.aI(E,c.u_opacity)}),hillshade:(E,c)=>({u_matrix:new o.aJ(E,c.u_matrix),u_image:new o.aH(E,c.u_image),u_latrange:new o.aO(E,c.u_latrange),u_light:new o.aO(E,c.u_light),u_shadow:new o.aL(E,c.u_shadow),u_highlight:new o.aL(E,c.u_highlight),u_accent:new o.aL(E,c.u_accent)}),hillshadePrepare:(E,c)=>({u_matrix:new o.aJ(E,c.u_matrix),u_image:new o.aH(E,c.u_image),u_dimension:new o.aO(E,c.u_dimension),u_zoom:new o.aI(E,c.u_zoom),u_unpack:new o.aK(E,c.u_unpack)}),line:(E,c)=>({u_matrix:new o.aJ(E,c.u_matrix),u_ratio:new o.aI(E,c.u_ratio),u_device_pixel_ratio:new o.aI(E,c.u_device_pixel_ratio),u_units_to_pixels:new o.aO(E,c.u_units_to_pixels)}),lineGradient:(E,c)=>({u_matrix:new o.aJ(E,c.u_matrix),u_ratio:new o.aI(E,c.u_ratio),u_device_pixel_ratio:new o.aI(E,c.u_device_pixel_ratio),u_units_to_pixels:new o.aO(E,c.u_units_to_pixels),u_image:new o.aH(E,c.u_image),u_image_height:new o.aI(E,c.u_image_height)}),linePattern:(E,c)=>({u_matrix:new o.aJ(E,c.u_matrix),u_texsize:new o.aO(E,c.u_texsize),u_ratio:new o.aI(E,c.u_ratio),u_device_pixel_ratio:new o.aI(E,c.u_device_pixel_ratio),u_image:new o.aH(E,c.u_image),u_units_to_pixels:new o.aO(E,c.u_units_to_pixels),u_scale:new o.aN(E,c.u_scale),u_fade:new o.aI(E,c.u_fade)}),lineSDF:(E,c)=>({u_matrix:new o.aJ(E,c.u_matrix),u_ratio:new o.aI(E,c.u_ratio),u_device_pixel_ratio:new o.aI(E,c.u_device_pixel_ratio),u_units_to_pixels:new o.aO(E,c.u_units_to_pixels),u_patternscale_a:new o.aO(E,c.u_patternscale_a),u_patternscale_b:new o.aO(E,c.u_patternscale_b),u_sdfgamma:new o.aI(E,c.u_sdfgamma),u_image:new o.aH(E,c.u_image),u_tex_y_a:new o.aI(E,c.u_tex_y_a),u_tex_y_b:new o.aI(E,c.u_tex_y_b),u_mix:new o.aI(E,c.u_mix)}),raster:(E,c)=>({u_matrix:new o.aJ(E,c.u_matrix),u_tl_parent:new o.aO(E,c.u_tl_parent),u_scale_parent:new o.aI(E,c.u_scale_parent),u_buffer_scale:new o.aI(E,c.u_buffer_scale),u_fade_t:new o.aI(E,c.u_fade_t),u_opacity:new o.aI(E,c.u_opacity),u_image0:new o.aH(E,c.u_image0),u_image1:new o.aH(E,c.u_image1),u_brightness_low:new o.aI(E,c.u_brightness_low),u_brightness_high:new o.aI(E,c.u_brightness_high),u_saturation_factor:new o.aI(E,c.u_saturation_factor),u_contrast_factor:new o.aI(E,c.u_contrast_factor),u_spin_weights:new o.aN(E,c.u_spin_weights)}),symbolIcon:(E,c)=>({u_is_size_zoom_constant:new o.aH(E,c.u_is_size_zoom_constant),u_is_size_feature_constant:new o.aH(E,c.u_is_size_feature_constant),u_size_t:new o.aI(E,c.u_size_t),u_size:new o.aI(E,c.u_size),u_camera_to_center_distance:new o.aI(E,c.u_camera_to_center_distance),u_pitch:new o.aI(E,c.u_pitch),u_rotate_symbol:new o.aH(E,c.u_rotate_symbol),u_aspect_ratio:new o.aI(E,c.u_aspect_ratio),u_fade_change:new o.aI(E,c.u_fade_change),u_matrix:new o.aJ(E,c.u_matrix),u_label_plane_matrix:new o.aJ(E,c.u_label_plane_matrix),u_coord_matrix:new o.aJ(E,c.u_coord_matrix),u_is_text:new o.aH(E,c.u_is_text),u_pitch_with_map:new o.aH(E,c.u_pitch_with_map),u_is_along_line:new o.aH(E,c.u_is_along_line),u_is_variable_anchor:new o.aH(E,c.u_is_variable_anchor),u_texsize:new o.aO(E,c.u_texsize),u_texture:new o.aH(E,c.u_texture),u_translation:new o.aO(E,c.u_translation),u_pitched_scale:new o.aI(E,c.u_pitched_scale)}),symbolSDF:(E,c)=>({u_is_size_zoom_constant:new o.aH(E,c.u_is_size_zoom_constant),u_is_size_feature_constant:new o.aH(E,c.u_is_size_feature_constant),u_size_t:new o.aI(E,c.u_size_t),u_size:new o.aI(E,c.u_size),u_camera_to_center_distance:new o.aI(E,c.u_camera_to_center_distance),u_pitch:new o.aI(E,c.u_pitch),u_rotate_symbol:new o.aH(E,c.u_rotate_symbol),u_aspect_ratio:new o.aI(E,c.u_aspect_ratio),u_fade_change:new o.aI(E,c.u_fade_change),u_matrix:new o.aJ(E,c.u_matrix),u_label_plane_matrix:new o.aJ(E,c.u_label_plane_matrix),u_coord_matrix:new o.aJ(E,c.u_coord_matrix),u_is_text:new o.aH(E,c.u_is_text),u_pitch_with_map:new o.aH(E,c.u_pitch_with_map),u_is_along_line:new o.aH(E,c.u_is_along_line),u_is_variable_anchor:new o.aH(E,c.u_is_variable_anchor),u_texsize:new o.aO(E,c.u_texsize),u_texture:new o.aH(E,c.u_texture),u_gamma_scale:new o.aI(E,c.u_gamma_scale),u_device_pixel_ratio:new o.aI(E,c.u_device_pixel_ratio),u_is_halo:new o.aH(E,c.u_is_halo),u_translation:new o.aO(E,c.u_translation),u_pitched_scale:new o.aI(E,c.u_pitched_scale)}),symbolTextAndIcon:(E,c)=>({u_is_size_zoom_constant:new o.aH(E,c.u_is_size_zoom_constant),u_is_size_feature_constant:new o.aH(E,c.u_is_size_feature_constant),u_size_t:new o.aI(E,c.u_size_t),u_size:new o.aI(E,c.u_size),u_camera_to_center_distance:new o.aI(E,c.u_camera_to_center_distance),u_pitch:new o.aI(E,c.u_pitch),u_rotate_symbol:new o.aH(E,c.u_rotate_symbol),u_aspect_ratio:new o.aI(E,c.u_aspect_ratio),u_fade_change:new o.aI(E,c.u_fade_change),u_matrix:new o.aJ(E,c.u_matrix),u_label_plane_matrix:new o.aJ(E,c.u_label_plane_matrix),u_coord_matrix:new o.aJ(E,c.u_coord_matrix),u_is_text:new o.aH(E,c.u_is_text),u_pitch_with_map:new o.aH(E,c.u_pitch_with_map),u_is_along_line:new o.aH(E,c.u_is_along_line),u_is_variable_anchor:new o.aH(E,c.u_is_variable_anchor),u_texsize:new o.aO(E,c.u_texsize),u_texsize_icon:new o.aO(E,c.u_texsize_icon),u_texture:new o.aH(E,c.u_texture),u_texture_icon:new o.aH(E,c.u_texture_icon),u_gamma_scale:new o.aI(E,c.u_gamma_scale),u_device_pixel_ratio:new o.aI(E,c.u_device_pixel_ratio),u_is_halo:new o.aH(E,c.u_is_halo),u_translation:new o.aO(E,c.u_translation),u_pitched_scale:new o.aI(E,c.u_pitched_scale)}),background:(E,c)=>({u_matrix:new o.aJ(E,c.u_matrix),u_opacity:new o.aI(E,c.u_opacity),u_color:new o.aL(E,c.u_color)}),backgroundPattern:(E,c)=>({u_matrix:new o.aJ(E,c.u_matrix),u_opacity:new o.aI(E,c.u_opacity),u_image:new o.aH(E,c.u_image),u_pattern_tl_a:new o.aO(E,c.u_pattern_tl_a),u_pattern_br_a:new o.aO(E,c.u_pattern_br_a),u_pattern_tl_b:new o.aO(E,c.u_pattern_tl_b),u_pattern_br_b:new o.aO(E,c.u_pattern_br_b),u_texsize:new o.aO(E,c.u_texsize),u_mix:new o.aI(E,c.u_mix),u_pattern_size_a:new o.aO(E,c.u_pattern_size_a),u_pattern_size_b:new o.aO(E,c.u_pattern_size_b),u_scale_a:new o.aI(E,c.u_scale_a),u_scale_b:new o.aI(E,c.u_scale_b),u_pixel_coord_upper:new o.aO(E,c.u_pixel_coord_upper),u_pixel_coord_lower:new o.aO(E,c.u_pixel_coord_lower),u_tile_units_to_pixels:new o.aI(E,c.u_tile_units_to_pixels)}),terrain:(E,c)=>({u_matrix:new o.aJ(E,c.u_matrix),u_texture:new o.aH(E,c.u_texture),u_ele_delta:new o.aI(E,c.u_ele_delta),u_fog_matrix:new o.aJ(E,c.u_fog_matrix),u_fog_color:new o.aL(E,c.u_fog_color),u_fog_ground_blend:new o.aI(E,c.u_fog_ground_blend),u_fog_ground_blend_opacity:new o.aI(E,c.u_fog_ground_blend_opacity),u_horizon_color:new o.aL(E,c.u_horizon_color),u_horizon_fog_blend:new o.aI(E,c.u_horizon_fog_blend)}),terrainDepth:(E,c)=>({u_matrix:new o.aJ(E,c.u_matrix),u_ele_delta:new o.aI(E,c.u_ele_delta)}),terrainCoords:(E,c)=>({u_matrix:new o.aJ(E,c.u_matrix),u_texture:new o.aH(E,c.u_texture),u_terrain_coords_id:new o.aI(E,c.u_terrain_coords_id),u_ele_delta:new o.aI(E,c.u_ele_delta)}),sky:(E,c)=>({u_sky_color:new o.aL(E,c.u_sky_color),u_horizon_color:new o.aL(E,c.u_horizon_color),u_horizon:new o.aI(E,c.u_horizon),u_sky_horizon_blend:new o.aI(E,c.u_sky_horizon_blend)})};class qo{constructor(c,y,B){this.context=c;const S=c.gl;this.buffer=S.createBuffer(),this.dynamicDraw=!!B,this.context.unbindVAO(),c.bindElementBuffer.set(this.buffer),S.bufferData(S.ELEMENT_ARRAY_BUFFER,y.arrayBuffer,this.dynamicDraw?S.DYNAMIC_DRAW:S.STATIC_DRAW),this.dynamicDraw||delete y.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(c){const y=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),y.bufferSubData(y.ELEMENT_ARRAY_BUFFER,0,c.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const dh={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class fu{constructor(c,y,B,S){this.length=y.length,this.attributes=B,this.itemSize=y.bytesPerElement,this.dynamicDraw=S,this.context=c;const F=c.gl;this.buffer=F.createBuffer(),c.bindVertexBuffer.set(this.buffer),F.bufferData(F.ARRAY_BUFFER,y.arrayBuffer,this.dynamicDraw?F.DYNAMIC_DRAW:F.STATIC_DRAW),this.dynamicDraw||delete y.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(c){if(c.length!==this.length)throw new Error(`Length of new data is ${c.length}, which doesn't match current length of ${this.length}`);const y=this.context.gl;this.bind(),y.bufferSubData(y.ARRAY_BUFFER,0,c.arrayBuffer)}enableAttributes(c,y){for(let B=0;B<this.attributes.length;B++){const S=y.attributes[this.attributes[B].name];S!==void 0&&c.enableVertexAttribArray(S)}}setVertexAttribPointers(c,y,B){for(let S=0;S<this.attributes.length;S++){const F=this.attributes[S],H=y.attributes[F.name];H!==void 0&&c.vertexAttribPointer(H,F.components,c[dh[F.type]],!1,this.itemSize,F.offset+this.itemSize*(B||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ul=new WeakMap;function oa(E){var c;if(Ul.has(E))return Ul.get(E);{const y=(c=E.getParameter(E.VERSION))===null||c===void 0?void 0:c.startsWith("WebGL 2.0");return Ul.set(E,y),y}}class Sn{constructor(c){this.gl=c.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(c){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ko extends Sn{getDefault(){return o.aM.transparent}set(c){const y=this.current;(c.r!==y.r||c.g!==y.g||c.b!==y.b||c.a!==y.a||this.dirty)&&(this.gl.clearColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)}}class Ka extends Sn{getDefault(){return 1}set(c){(c!==this.current||this.dirty)&&(this.gl.clearDepth(c),this.current=c,this.dirty=!1)}}class go extends Sn{getDefault(){return 0}set(c){(c!==this.current||this.dirty)&&(this.gl.clearStencil(c),this.current=c,this.dirty=!1)}}class $i extends Sn{getDefault(){return[!0,!0,!0,!0]}set(c){const y=this.current;(c[0]!==y[0]||c[1]!==y[1]||c[2]!==y[2]||c[3]!==y[3]||this.dirty)&&(this.gl.colorMask(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)}}class Au extends Sn{getDefault(){return!0}set(c){(c!==this.current||this.dirty)&&(this.gl.depthMask(c),this.current=c,this.dirty=!1)}}class Ca extends Sn{getDefault(){return 255}set(c){(c!==this.current||this.dirty)&&(this.gl.stencilMask(c),this.current=c,this.dirty=!1)}}class Nh extends Sn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(c){const y=this.current;(c.func!==y.func||c.ref!==y.ref||c.mask!==y.mask||this.dirty)&&(this.gl.stencilFunc(c.func,c.ref,c.mask),this.current=c,this.dirty=!1)}}class pu extends Sn{getDefault(){const c=this.gl;return[c.KEEP,c.KEEP,c.KEEP]}set(c){const y=this.current;(c[0]!==y[0]||c[1]!==y[1]||c[2]!==y[2]||this.dirty)&&(this.gl.stencilOp(c[0],c[1],c[2]),this.current=c,this.dirty=!1)}}class Uu extends Sn{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const y=this.gl;c?y.enable(y.STENCIL_TEST):y.disable(y.STENCIL_TEST),this.current=c,this.dirty=!1}}class gu extends Sn{getDefault(){return[0,1]}set(c){const y=this.current;(c[0]!==y[0]||c[1]!==y[1]||this.dirty)&&(this.gl.depthRange(c[0],c[1]),this.current=c,this.dirty=!1)}}class fh extends Sn{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const y=this.gl;c?y.enable(y.DEPTH_TEST):y.disable(y.DEPTH_TEST),this.current=c,this.dirty=!1}}class mu extends Sn{getDefault(){return this.gl.LESS}set(c){(c!==this.current||this.dirty)&&(this.gl.depthFunc(c),this.current=c,this.dirty=!1)}}class xo extends Sn{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const y=this.gl;c?y.enable(y.BLEND):y.disable(y.BLEND),this.current=c,this.dirty=!1}}class wo extends Sn{getDefault(){const c=this.gl;return[c.ONE,c.ZERO]}set(c){const y=this.current;(c[0]!==y[0]||c[1]!==y[1]||this.dirty)&&(this.gl.blendFunc(c[0],c[1]),this.current=c,this.dirty=!1)}}class Lc extends Sn{getDefault(){return o.aM.transparent}set(c){const y=this.current;(c.r!==y.r||c.g!==y.g||c.b!==y.b||c.a!==y.a||this.dirty)&&(this.gl.blendColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)}}class lc extends Sn{getDefault(){return this.gl.FUNC_ADD}set(c){(c!==this.current||this.dirty)&&(this.gl.blendEquation(c),this.current=c,this.dirty=!1)}}class Dc extends Sn{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const y=this.gl;c?y.enable(y.CULL_FACE):y.disable(y.CULL_FACE),this.current=c,this.dirty=!1}}class Lo extends Sn{getDefault(){return this.gl.BACK}set(c){(c!==this.current||this.dirty)&&(this.gl.cullFace(c),this.current=c,this.dirty=!1)}}class cc extends Sn{getDefault(){return this.gl.CCW}set(c){(c!==this.current||this.dirty)&&(this.gl.frontFace(c),this.current=c,this.dirty=!1)}}class Nu extends Sn{getDefault(){return null}set(c){(c!==this.current||this.dirty)&&(this.gl.useProgram(c),this.current=c,this.dirty=!1)}}class gl extends Sn{getDefault(){return this.gl.TEXTURE0}set(c){(c!==this.current||this.dirty)&&(this.gl.activeTexture(c),this.current=c,this.dirty=!1)}}class uc extends Sn{getDefault(){const c=this.gl;return[0,0,c.drawingBufferWidth,c.drawingBufferHeight]}set(c){const y=this.current;(c[0]!==y[0]||c[1]!==y[1]||c[2]!==y[2]||c[3]!==y[3]||this.dirty)&&(this.gl.viewport(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)}}class ne extends Sn{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const y=this.gl;y.bindFramebuffer(y.FRAMEBUFFER,c),this.current=c,this.dirty=!1}}class je extends Sn{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const y=this.gl;y.bindRenderbuffer(y.RENDERBUFFER,c),this.current=c,this.dirty=!1}}class Tt extends Sn{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const y=this.gl;y.bindTexture(y.TEXTURE_2D,c),this.current=c,this.dirty=!1}}class Qt extends Sn{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const y=this.gl;y.bindBuffer(y.ARRAY_BUFFER,c),this.current=c,this.dirty=!1}}class rr extends Sn{getDefault(){return null}set(c){const y=this.gl;y.bindBuffer(y.ELEMENT_ARRAY_BUFFER,c),this.current=c,this.dirty=!1}}class vr extends Sn{getDefault(){return null}set(c){var y;if(c===this.current&&!this.dirty)return;const B=this.gl;oa(B)?B.bindVertexArray(c):(y=B.getExtension("OES_vertex_array_object"))===null||y===void 0||y.bindVertexArrayOES(c),this.current=c,this.dirty=!1}}class Xr extends Sn{getDefault(){return 4}set(c){if(c===this.current&&!this.dirty)return;const y=this.gl;y.pixelStorei(y.UNPACK_ALIGNMENT,c),this.current=c,this.dirty=!1}}class bn extends Sn{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const y=this.gl;y.pixelStorei(y.UNPACK_PREMULTIPLY_ALPHA_WEBGL,c),this.current=c,this.dirty=!1}}class qn extends Sn{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const y=this.gl;y.pixelStorei(y.UNPACK_FLIP_Y_WEBGL,c),this.current=c,this.dirty=!1}}class li extends Sn{constructor(c,y){super(c),this.context=c,this.parent=y}getDefault(){return null}}class fi extends li{setDirty(){this.dirty=!0}set(c){if(c===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const y=this.gl;y.framebufferTexture2D(y.FRAMEBUFFER,y.COLOR_ATTACHMENT0,y.TEXTURE_2D,c,0),this.current=c,this.dirty=!1}}class pi extends li{set(c){if(c===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const y=this.gl;y.framebufferRenderbuffer(y.FRAMEBUFFER,y.DEPTH_ATTACHMENT,y.RENDERBUFFER,c),this.current=c,this.dirty=!1}}class as extends li{set(c){if(c===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const y=this.gl;y.framebufferRenderbuffer(y.FRAMEBUFFER,y.DEPTH_STENCIL_ATTACHMENT,y.RENDERBUFFER,c),this.current=c,this.dirty=!1}}class rs{constructor(c,y,B,S,F){this.context=c,this.width=y,this.height=B;const H=c.gl,j=this.framebuffer=H.createFramebuffer();if(this.colorAttachment=new fi(c,j),S)this.depthAttachment=F?new as(c,j):new pi(c,j);else if(F)throw new Error("Stencil cannot be set without depth");if(H.checkFramebufferStatus(H.FRAMEBUFFER)!==H.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const c=this.context.gl,y=this.colorAttachment.get();if(y&&c.deleteTexture(y),this.depthAttachment){const B=this.depthAttachment.get();B&&c.deleteRenderbuffer(B)}c.deleteFramebuffer(this.framebuffer)}}class gi{constructor(c,y,B){this.blendFunction=c,this.blendColor=y,this.mask=B}}gi.Replace=[1,0],gi.disabled=new gi(gi.Replace,o.aM.transparent,[!1,!1,!1,!1]),gi.unblended=new gi(gi.Replace,o.aM.transparent,[!0,!0,!0,!0]),gi.alphaBlended=new gi([1,771],o.aM.transparent,[!0,!0,!0,!0]);class Do{constructor(c){var y,B;if(this.gl=c,this.clearColor=new Ko(this),this.clearDepth=new Ka(this),this.clearStencil=new go(this),this.colorMask=new $i(this),this.depthMask=new Au(this),this.stencilMask=new Ca(this),this.stencilFunc=new Nh(this),this.stencilOp=new pu(this),this.stencilTest=new Uu(this),this.depthRange=new gu(this),this.depthTest=new fh(this),this.depthFunc=new mu(this),this.blend=new xo(this),this.blendFunc=new wo(this),this.blendColor=new Lc(this),this.blendEquation=new lc(this),this.cullFace=new Dc(this),this.cullFaceSide=new Lo(this),this.frontFace=new cc(this),this.program=new Nu(this),this.activeTexture=new gl(this),this.viewport=new uc(this),this.bindFramebuffer=new ne(this),this.bindRenderbuffer=new je(this),this.bindTexture=new Tt(this),this.bindVertexBuffer=new Qt(this),this.bindElementBuffer=new rr(this),this.bindVertexArray=new vr(this),this.pixelStoreUnpack=new Xr(this),this.pixelStoreUnpackPremultiplyAlpha=new bn(this),this.pixelStoreUnpackFlipY=new qn(this),this.extTextureFilterAnisotropic=c.getExtension("EXT_texture_filter_anisotropic")||c.getExtension("MOZ_EXT_texture_filter_anisotropic")||c.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=c.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=c.getParameter(c.MAX_TEXTURE_SIZE),oa(c)){this.HALF_FLOAT=c.HALF_FLOAT;const S=c.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(y=c.RGBA16F)!==null&&y!==void 0?y:S==null?void 0:S.RGBA16F_EXT,this.RGB16F=(B=c.RGB16F)!==null&&B!==void 0?B:S==null?void 0:S.RGB16F_EXT,c.getExtension("EXT_color_buffer_float")}else{c.getExtension("EXT_color_buffer_half_float"),c.getExtension("OES_texture_half_float_linear");const S=c.getExtension("OES_texture_half_float");this.HALF_FLOAT=S==null?void 0:S.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(c,y){return new qo(this,c,y)}createVertexBuffer(c,y,B){return new fu(this,c,y,B)}createRenderbuffer(c,y,B){const S=this.gl,F=S.createRenderbuffer();return this.bindRenderbuffer.set(F),S.renderbufferStorage(S.RENDERBUFFER,c,y,B),this.bindRenderbuffer.set(null),F}createFramebuffer(c,y,B,S){return new rs(this,c,y,B,S)}clear(c){let{color:y,depth:B,stencil:S}=c;const F=this.gl;let H=0;y&&(H|=F.COLOR_BUFFER_BIT,this.clearColor.set(y),this.colorMask.set([!0,!0,!0,!0])),B!==void 0&&(H|=F.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(B),this.depthMask.set(!0)),S!==void 0&&(H|=F.STENCIL_BUFFER_BIT,this.clearStencil.set(S),this.stencilMask.set(255)),F.clear(H)}setCullFace(c){c.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(c.mode),this.frontFace.set(c.frontFace))}setDepthMode(c){c.func!==this.gl.ALWAYS||c.mask?(this.depthTest.set(!0),this.depthFunc.set(c.func),this.depthMask.set(c.mask),this.depthRange.set(c.range)):this.depthTest.set(!1)}setStencilMode(c){c.test.func!==this.gl.ALWAYS||c.mask?(this.stencilTest.set(!0),this.stencilMask.set(c.mask),this.stencilOp.set([c.fail,c.depthFail,c.pass]),this.stencilFunc.set({func:c.test.func,ref:c.ref,mask:c.test.mask})):this.stencilTest.set(!1)}setColorMode(c){o.aE(c.blendFunction,gi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(c.blendFunction),this.blendColor.set(c.blendColor)),this.colorMask.set(c.mask)}createVertexArray(){var c;return oa(this.gl)?this.gl.createVertexArray():(c=this.gl.getExtension("OES_vertex_array_object"))===null||c===void 0?void 0:c.createVertexArrayOES()}deleteVertexArray(c){var y;return oa(this.gl)?this.gl.deleteVertexArray(c):(y=this.gl.getExtension("OES_vertex_array_object"))===null||y===void 0?void 0:y.deleteVertexArrayOES(c)}unbindVAO(){this.bindVertexArray.set(null)}}class zn{constructor(c,y,B){this.func=c,this.mask=y,this.range=B}}zn.ReadOnly=!1,zn.ReadWrite=!0,zn.disabled=new zn(519,zn.ReadOnly,[0,1]);const Wo=7680;class vi{constructor(c,y,B,S,F,H){this.test=c,this.ref=y,this.mask=B,this.fail=S,this.depthFail=F,this.pass=H}}vi.disabled=new vi({func:519,mask:0},0,0,Wo,Wo,Wo);class Ti{constructor(c,y,B){this.enable=c,this.mode=y,this.frontFace=B}}let hc;function Nl(E,c,y,B,S){const F=E.context,H=F.gl,j=E.useProgram("collisionBox"),Z=[];let se=0,he=0;for(let qe=0;qe<B.length;qe++){const Ze=B[qe],ot=c.getTile(Ze).getBucket(y);if(!ot)continue;const vt=S?ot.textCollisionBox:ot.iconCollisionBox,kt=ot.collisionCircleArray;if(kt.length>0){const It=o.H();o.aQ(It,ot.placementInvProjMatrix,E.transform.glCoordMatrix),o.aQ(It,It,ot.placementViewportMatrix),Z.push({circleArray:kt,circleOffset:he,transform:Ze.posMatrix,invTransform:It,coord:Ze}),se+=kt.length/4,he=se}vt&&j.draw(F,H.LINES,zn.disabled,vi.disabled,E.colorModeForRenderPass(),Ti.disabled,{u_matrix:Ze.posMatrix,u_pixel_extrude_scale:[1/(ue=E.transform).width,1/ue.height]},E.style.map.terrain&&E.style.map.terrain.getTerrainData(Ze),y.id,vt.layoutVertexBuffer,vt.indexBuffer,vt.segments,null,E.transform.zoom,null,null,vt.collisionVertexBuffer)}var ue;if(!S||!Z.length)return;const Te=E.useProgram("collisionCircle"),Fe=new o.aR;Fe.resize(4*se),Fe._trim();let Ee=0;for(const qe of Z)for(let Ze=0;Ze<qe.circleArray.length/4;Ze++){const ot=4*Ze,vt=qe.circleArray[ot+0],kt=qe.circleArray[ot+1],It=qe.circleArray[ot+2],ur=qe.circleArray[ot+3];Fe.emplace(Ee++,vt,kt,It,ur,0),Fe.emplace(Ee++,vt,kt,It,ur,1),Fe.emplace(Ee++,vt,kt,It,ur,2),Fe.emplace(Ee++,vt,kt,It,ur,3)}(!hc||hc.length<2*se)&&(hc=function(qe){const Ze=2*qe,ot=new o.aT;ot.resize(Ze),ot._trim();for(let vt=0;vt<Ze;vt++){const kt=6*vt;ot.uint16[kt+0]=4*vt+0,ot.uint16[kt+1]=4*vt+1,ot.uint16[kt+2]=4*vt+2,ot.uint16[kt+3]=4*vt+2,ot.uint16[kt+4]=4*vt+3,ot.uint16[kt+5]=4*vt+0}return ot}(se));const Oe=F.createIndexBuffer(hc,!0),rt=F.createVertexBuffer(Fe,o.aS.members,!0);for(const qe of Z){const Ze=ai(qe.transform,qe.invTransform,E.transform);Te.draw(F,H.TRIANGLES,zn.disabled,vi.disabled,E.colorModeForRenderPass(),Ti.disabled,Ze,E.style.map.terrain&&E.style.map.terrain.getTerrainData(qe.coord),y.id,rt,Oe,o.a0.simpleSegment(0,2*qe.circleOffset,qe.circleArray.length,qe.circleArray.length/2),null,E.transform.zoom,null,null,null)}rt.destroy(),Oe.destroy()}Ti.disabled=new Ti(!1,1029,2305),Ti.backCCW=new Ti(!0,1029,2305);const zl=o.an(new Float32Array(16));function Oc(E,c,y,B,S,F){const{horizontalAlign:H,verticalAlign:j}=o.au(E);return new o.P((-(H-.5)*c/S+B[0])*F,(-(j-.5)*y/S+B[1])*F)}function Wa(E,c,y,B,S,F){const H=c.tileAnchorPoint.add(new o.P(c.translation[0],c.translation[1]));if(c.pitchWithMap){let j=B.mult(F);y||(j=j.rotate(-S));const Z=H.add(j);return Pe(Z.x,Z.y,c.labelPlaneMatrix,c.getElevation).point}if(y){const j=yt(c.tileAnchorPoint.x+1,c.tileAnchorPoint.y,c).point.sub(E),Z=Math.atan(j.y/j.x)+(j.x<0?Math.PI:0);return E.add(B.rotate(Z))}return E.add(B)}function ml(E,c,y,B,S,F,H,j,Z,se,he,ue,Te,Fe){const Ee=E.text.placedSymbolArray,Oe=E.text.dynamicLayoutVertexArray,rt=E.icon.dynamicLayoutVertexArray,qe={};Oe.clear();for(let Ze=0;Ze<Ee.length;Ze++){const ot=Ee.get(Ze),vt=ot.hidden||!ot.crossTileID||E.allowVerticalPlacement&&!ot.placedOrientation?null:B[ot.crossTileID];if(vt){const kt=new o.P(ot.anchorX,ot.anchorY),It={getElevation:Fe,width:S.width,height:S.height,labelPlaneMatrix:F,lineVertexArray:null,pitchWithMap:y,projection:he,projectionCache:null,tileAnchorPoint:kt,translation:ue,unwrappedTileID:Te},ur=y?Pe(kt.x,kt.y,H,Fe):yt(kt.x,kt.y,It),wr=Ae(S.cameraToCenterDistance,ur.signedDistanceFromCamera);let Dr=o.ai(E.textSizeData,Z,ot)*wr/o.ap;y&&(Dr*=E.tilePixelRatio/j);const{width:Or,height:_r,anchor:xr,textOffset:Vr,textBoxScale:xn}=vt,Qr=Oc(xr,Or,_r,Vr,xn,Dr),jr=he.getPitchedTextCorrection(S,kt.add(new o.P(ue[0],ue[1])),Te),In=Wa(ur.point,It,c,Qr,S.angle,jr),Hn=E.allowVerticalPlacement&&ot.placedOrientation===o.ah.vertical?Math.PI/2:0;for(let Qn=0;Qn<ot.numGlyphs;Qn++)o.aj(Oe,In,Hn);se&&ot.associatedIconIndex>=0&&(qe[ot.associatedIconIndex]={shiftedAnchor:In,angle:Hn})}else Pr(ot.numGlyphs,Oe)}if(se){rt.clear();const Ze=E.icon.placedSymbolArray;for(let ot=0;ot<Ze.length;ot++){const vt=Ze.get(ot);if(vt.hidden)Pr(vt.numGlyphs,rt);else{const kt=qe[ot];if(kt)for(let It=0;It<vt.numGlyphs;It++)o.aj(rt,kt.shiftedAnchor,kt.angle);else Pr(vt.numGlyphs,rt)}}E.icon.dynamicLayoutVertexBuffer.updateData(rt)}E.text.dynamicLayoutVertexBuffer.updateData(Oe)}function no(E,c,y){return y.iconsInText&&c?"symbolTextAndIcon":E?"symbolSDF":"symbolIcon"}function Ps(E,c,y,B,S,F,H,j,Z,se,he,ue){const Te=E.context,Fe=Te.gl,Ee=E.transform,Oe=wa(),rt=j==="map",qe=Z==="map",Ze=j!=="viewport"&&y.layout.get("symbol-placement")!=="point",ot=rt&&!qe&&!Ze,vt=!qe&&Ze,kt=!y.layout.get("symbol-sort-key").isConstant();let It=!1;const ur=E.depthModeForSublayer(0,zn.ReadOnly),wr=y._unevaluatedLayout.hasValue("text-variable-anchor")||y._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Dr=[],Or=Oe.getCircleRadiusCorrection(Ee);for(const _r of B){const xr=c.getTile(_r),Vr=xr.getBucket(y);if(!Vr)continue;const xn=S?Vr.text:Vr.icon;if(!xn||!xn.segments.get().length||!xn.hasVisibleVertices)continue;const Qr=xn.programConfigurations.get(y.id),jr=S||Vr.sdfIcons,In=S?Vr.textSizeData:Vr.iconSizeData,Hn=qe||Ee.pitch!==0,Qn=E.useProgram(no(jr,S,Vr),Qr),Zn=o.ag(In,Ee.zoom),ui=E.style.map.terrain&&E.style.map.terrain.getTerrainData(_r);let Ii,cs,mi,qi,Di=[0,0],us=null;if(S)cs=xr.glyphAtlasTexture,mi=Fe.LINEAR,Ii=xr.glyphAtlasTexture.size,Vr.iconsInText&&(Di=xr.imageAtlasTexture.size,us=xr.imageAtlasTexture,qi=Hn||E.options.rotating||E.options.zooming||In.kind==="composite"||In.kind==="camera"?Fe.LINEAR:Fe.NEAREST);else{const pe=y.layout.get("icon-size").constantOr(0)!==1||Vr.iconsNeedLinear;cs=xr.imageAtlasTexture,mi=jr||E.options.rotating||E.options.zooming||pe||Hn?Fe.LINEAR:Fe.NEAREST,Ii=xr.imageAtlasTexture.size}const ns=_n(xr,1,E.transform.zoom),Uo=vt?_r.posMatrix:zl,da=$t(Uo,qe,rt,E.transform,ns),Ki=Wt(Uo,qe,rt,E.transform,ns),vc=Wt(_r.posMatrix,qe,rt,E.transform,ns),D=Oe.translatePosition(E.transform,xr,F,H),l=wr&&Vr.hasTextData(),m=y.layout.get("icon-text-fit")!=="none"&&l&&Vr.hasIconData();if(Ze){const pe=E.style.map.terrain?(Me,Ke)=>E.style.map.terrain.getElevation(_r,Me,Ke):null,Ce=y.layout.get("text-rotation-alignment")==="map";we(Vr,_r.posMatrix,E,S,da,vc,qe,se,Ce,Oe,_r.toUnwrapped(),Ee.width,Ee.height,D,pe)}const w=_r.posMatrix,P=S&&wr||m,O=Ze||P?zl:da,G=Ki,J=jr&&y.paint.get(S?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let re;re=jr?Vr.iconsInText?Ba(In.kind,Zn,ot,qe,Ze,P,E,w,O,G,D,Ii,Di,Or):ro(In.kind,Zn,ot,qe,Ze,P,E,w,O,G,D,S,Ii,!0,Or):kl(In.kind,Zn,ot,qe,Ze,P,E,w,O,G,D,S,Ii,Or);const oe={program:Qn,buffers:xn,uniformValues:re,atlasTexture:cs,atlasTextureIcon:us,atlasInterpolation:mi,atlasInterpolationIcon:qi,isSDF:jr,hasHalo:J};if(kt&&Vr.canOverlap){It=!0;const pe=xn.segments.get();for(const Ce of pe)Dr.push({segments:new o.a0([Ce]),sortKey:Ce.sortKey,state:oe,terrainData:ui})}else Dr.push({segments:xn.segments,sortKey:0,state:oe,terrainData:ui})}It&&Dr.sort((_r,xr)=>_r.sortKey-xr.sortKey);for(const _r of Dr){const xr=_r.state;if(Te.activeTexture.set(Fe.TEXTURE0),xr.atlasTexture.bind(xr.atlasInterpolation,Fe.CLAMP_TO_EDGE),xr.atlasTextureIcon&&(Te.activeTexture.set(Fe.TEXTURE1),xr.atlasTextureIcon&&xr.atlasTextureIcon.bind(xr.atlasInterpolationIcon,Fe.CLAMP_TO_EDGE)),xr.isSDF){const Vr=xr.uniformValues;xr.hasHalo&&(Vr.u_is_halo=1,dc(xr.buffers,_r.segments,y,E,xr.program,ur,he,ue,Vr,_r.terrainData)),Vr.u_is_halo=0}dc(xr.buffers,_r.segments,y,E,xr.program,ur,he,ue,xr.uniformValues,_r.terrainData)}}function dc(E,c,y,B,S,F,H,j,Z,se){const he=B.context;S.draw(he,he.gl.TRIANGLES,F,H,j,Ti.disabled,Z,se,y.id,E.layoutVertexBuffer,E.indexBuffer,c,y.paint,B.transform.zoom,E.programConfigurations.get(y.id),E.dynamicLayoutVertexBuffer,E.opacityVertexBuffer)}function fc(E,c,y,B){const S=E.context,F=S.gl,H=vi.disabled,j=new gi([F.ONE,F.ONE],o.aM.transparent,[!0,!0,!0,!0]),Z=c.getBucket(y);if(!Z)return;const se=B.key;let he=y.heatmapFbos.get(se);he||(he=Ac(S,c.tileSize,c.tileSize),y.heatmapFbos.set(se,he)),S.bindFramebuffer.set(he.framebuffer),S.viewport.set([0,0,c.tileSize,c.tileSize]),S.clear({color:o.aM.transparent});const ue=Z.programConfigurations.get(y.id),Te=E.useProgram("heatmap",ue),Fe=E.style.map.terrain.getTerrainData(B);Te.draw(S,F.TRIANGLES,zn.disabled,H,j,Ti.disabled,Dn(B.posMatrix,c,E.transform.zoom,y.paint.get("heatmap-intensity")),Fe,y.id,Z.layoutVertexBuffer,Z.indexBuffer,Z.segments,y.paint,E.transform.zoom,ue)}function aa(E,c,y){const B=E.context,S=B.gl;B.setColorMode(E.colorModeForRenderPass());const F=co(B,c),H=y.key,j=c.heatmapFbos.get(H);j&&(B.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,j.colorAttachment.get()),B.activeTexture.set(S.TEXTURE1),F.bind(S.LINEAR,S.CLAMP_TO_EDGE),E.useProgram("heatmapTexture").draw(B,S.TRIANGLES,zn.disabled,vi.disabled,E.colorModeForRenderPass(),Ti.disabled,Ro(E,c,0,1),null,c.id,E.rasterBoundsBuffer,E.quadTriangleIndexBuffer,E.rasterBoundsSegments,c.paint,E.transform.zoom),j.destroy(),c.heatmapFbos.delete(H))}function Ac(E,c,y){var B,S;const F=E.gl,H=F.createTexture();F.bindTexture(F.TEXTURE_2D,H),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_WRAP_S,F.CLAMP_TO_EDGE),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_WRAP_T,F.CLAMP_TO_EDGE),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_MIN_FILTER,F.LINEAR),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_MAG_FILTER,F.LINEAR);const j=(B=E.HALF_FLOAT)!==null&&B!==void 0?B:F.UNSIGNED_BYTE,Z=(S=E.RGBA16F)!==null&&S!==void 0?S:F.RGBA;F.texImage2D(F.TEXTURE_2D,0,Z,c,y,0,F.RGBA,j,null);const se=E.createFramebuffer(c,y,!1,!1);return se.colorAttachment.set(H),se}function co(E,c){return c.colorRampTexture||(c.colorRampTexture=new Le(E,c.colorRamp,E.gl.RGBA)),c.colorRampTexture}function Ea(E,c,y,B,S){if(!y||!B||!B.imageAtlas)return;const F=B.imageAtlas.patternPositions;let H=F[y.to.toString()],j=F[y.from.toString()];if(!H&&j&&(H=j),!j&&H&&(j=H),!H||!j){const Z=S.getPaintProperty(c);H=F[Z],j=F[Z]}H&&j&&E.setConstantPatternPositions(H,j)}function Hl(E,c,y,B,S,F,H){const j=E.context.gl,Z="fill-pattern",se=y.paint.get(Z),he=se&&se.constantOr(1),ue=y.getCrossfadeParameters();let Te,Fe,Ee,Oe,rt;H?(Fe=he&&!y.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Te=j.LINES):(Fe=he?"fillPattern":"fill",Te=j.TRIANGLES);const qe=se.constantOr(null);for(const Ze of B){const ot=c.getTile(Ze);if(he&&!ot.patternsLoaded())continue;const vt=ot.getBucket(y);if(!vt)continue;const kt=vt.programConfigurations.get(y.id),It=E.useProgram(Fe,kt),ur=E.style.map.terrain&&E.style.map.terrain.getTerrainData(Ze);he&&(E.context.activeTexture.set(j.TEXTURE0),ot.imageAtlasTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),kt.updatePaintBuffers(ue)),Ea(kt,Z,qe,ot,y);const wr=ur?Ze:null,Dr=E.translatePosMatrix(wr?wr.posMatrix:Ze.posMatrix,ot,y.paint.get("fill-translate"),y.paint.get("fill-translate-anchor"));if(H){Oe=vt.indexBuffer2,rt=vt.segments2;const Or=[j.drawingBufferWidth,j.drawingBufferHeight];Ee=Fe==="fillOutlinePattern"&&he?Rc(Dr,E,ue,ot,Or):eo(Dr,Or)}else Oe=vt.indexBuffer,rt=vt.segments,Ee=he?vs(Dr,E,ue,ot):Us(Dr);It.draw(E.context,Te,S,E.stencilModeForClipping(Ze),F,Ti.disabled,Ee,ur,y.id,vt.layoutVertexBuffer,Oe,rt,y.paint,E.transform.zoom,kt)}}function Bi(E,c,y,B,S,F,H){const j=E.context,Z=j.gl,se="fill-extrusion-pattern",he=y.paint.get(se),ue=he.constantOr(1),Te=y.getCrossfadeParameters(),Fe=y.paint.get("fill-extrusion-opacity"),Ee=he.constantOr(null);for(const Oe of B){const rt=c.getTile(Oe),qe=rt.getBucket(y);if(!qe)continue;const Ze=E.style.map.terrain&&E.style.map.terrain.getTerrainData(Oe),ot=qe.programConfigurations.get(y.id),vt=E.useProgram(ue?"fillExtrusionPattern":"fillExtrusion",ot);ue&&(E.context.activeTexture.set(Z.TEXTURE0),rt.imageAtlasTexture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE),ot.updatePaintBuffers(Te)),Ea(ot,se,Ee,rt,y);const kt=E.translatePosMatrix(Oe.posMatrix,rt,y.paint.get("fill-extrusion-translate"),y.paint.get("fill-extrusion-translate-anchor")),It=y.paint.get("fill-extrusion-vertical-gradient"),ur=ue?uu(kt,E,It,Fe,Oe,Te,rt):Gi(kt,E,It,Fe);vt.draw(j,j.gl.TRIANGLES,S,F,H,Ti.backCCW,ur,Ze,y.id,qe.layoutVertexBuffer,qe.indexBuffer,qe.segments,y.paint,E.transform.zoom,ot,E.style.map.terrain&&qe.centroidVertexBuffer)}}function Xo(E,c,y,B,S,F,H){const j=E.context,Z=j.gl,se=y.fbo;if(!se)return;const he=E.useProgram("hillshade"),ue=E.style.map.terrain&&E.style.map.terrain.getTerrainData(c);j.activeTexture.set(Z.TEXTURE0),Z.bindTexture(Z.TEXTURE_2D,se.colorAttachment.get()),he.draw(j,Z.TRIANGLES,S,F,H,Ti.disabled,((Te,Fe,Ee,Oe)=>{const rt=Ee.paint.get("hillshade-shadow-color"),qe=Ee.paint.get("hillshade-highlight-color"),Ze=Ee.paint.get("hillshade-accent-color");let ot=Ee.paint.get("hillshade-illumination-direction")*(Math.PI/180);Ee.paint.get("hillshade-illumination-anchor")==="viewport"&&(ot-=Te.transform.angle);const vt=!Te.options.moving;return{u_matrix:Oe?Oe.posMatrix:Te.transform.calculatePosMatrix(Fe.tileID.toUnwrapped(),vt),u_image:0,u_latrange:hu(0,Fe.tileID),u_light:[Ee.paint.get("hillshade-exaggeration"),ot],u_shadow:rt,u_highlight:qe,u_accent:Ze}})(E,y,B,ue?c:null),ue,B.id,E.rasterBoundsBuffer,E.quadTriangleIndexBuffer,E.rasterBoundsSegments)}function pc(E,c,y,B,S,F){const H=E.context,j=H.gl,Z=c.dem;if(Z&&Z.data){const se=Z.dim,he=Z.stride,ue=Z.getPixels();if(H.activeTexture.set(j.TEXTURE1),H.pixelStoreUnpackPremultiplyAlpha.set(!1),c.demTexture=c.demTexture||E.getTileTexture(he),c.demTexture){const Fe=c.demTexture;Fe.update(ue,{premultiply:!1}),Fe.bind(j.NEAREST,j.CLAMP_TO_EDGE)}else c.demTexture=new Le(H,ue,j.RGBA,{premultiply:!1}),c.demTexture.bind(j.NEAREST,j.CLAMP_TO_EDGE);H.activeTexture.set(j.TEXTURE0);let Te=c.fbo;if(!Te){const Fe=new Le(H,{width:se,height:se,data:null},j.RGBA);Fe.bind(j.LINEAR,j.CLAMP_TO_EDGE),Te=c.fbo=H.createFramebuffer(se,se,!0,!1),Te.colorAttachment.set(Fe.texture)}H.bindFramebuffer.set(Te.framebuffer),H.viewport.set([0,0,se,se]),E.useProgram("hillshadePrepare").draw(H,j.TRIANGLES,B,S,F,Ti.disabled,((Fe,Ee)=>{const Oe=Ee.stride,rt=o.H();return o.aP(rt,0,o.X,-o.X,0,0,1),o.J(rt,rt,[0,-o.X,0]),{u_matrix:rt,u_image:1,u_dimension:[Oe,Oe],u_zoom:Fe.overscaledZ,u_unpack:Ee.getUnpackVector()}})(c.tileID,Z),null,y.id,E.rasterBoundsBuffer,E.quadTriangleIndexBuffer,E.rasterBoundsSegments),c.needsHillshadePrepare=!1}}function vd(E,c,y,B,S,F){const H=B.paint.get("raster-fade-duration");if(!F&&H>0){const j=x.now(),Z=(j-E.timeAdded)/H,se=c?(j-c.timeAdded)/H:-1,he=y.getSource(),ue=S.coveringZoomLevel({tileSize:he.tileSize,roundZoom:he.roundZoom}),Te=!c||Math.abs(c.tileID.overscaledZ-ue)>Math.abs(E.tileID.overscaledZ-ue),Fe=Te&&E.refreshedUponExpiration?1:o.ac(Te?Z:1-se,0,1);return E.refreshedUponExpiration&&Z>=1&&(E.refreshedUponExpiration=!1),c?{opacity:1,mix:1-Fe}:{opacity:Fe,mix:0}}return{opacity:1,mix:0}}const Ah=new o.aM(1,0,0,1),xi=new o.aM(0,1,0,1),Jo=new o.aM(0,0,1,1),Ta=new o.aM(1,0,1,1),_l=new o.aM(0,1,1,1);function Bo(E,c,y,B){la(E,0,c+y/2,E.transform.width,y,B)}function yl(E,c,y,B){la(E,c-y/2,0,y,E.transform.height,B)}function la(E,c,y,B,S,F){const H=E.context,j=H.gl;j.enable(j.SCISSOR_TEST),j.scissor(c*E.pixelRatio,y*E.pixelRatio,B*E.pixelRatio,S*E.pixelRatio),H.clear({color:F}),j.disable(j.SCISSOR_TEST)}function Oo(E,c,y){const B=E.context,S=B.gl,F=y.posMatrix,H=E.useProgram("debug"),j=zn.disabled,Z=vi.disabled,se=E.colorModeForRenderPass(),he="$debug",ue=E.style.map.terrain&&E.style.map.terrain.getTerrainData(y);B.activeTexture.set(S.TEXTURE0);const Te=c.getTileByID(y.key).latestRawTileData,Fe=Math.floor((Te&&Te.byteLength||0)/1024),Ee=c.getTile(y).tileSize,Oe=512/Math.min(Ee,512)*(y.overscaledZ/E.transform.zoom)*.5;let rt=y.canonical.toString();y.overscaledZ!==y.canonical.z&&(rt+=` => ${y.overscaledZ}`),function(qe,Ze){qe.initDebugOverlayCanvas();const ot=qe.debugOverlayCanvas,vt=qe.context.gl,kt=qe.debugOverlayCanvas.getContext("2d");kt.clearRect(0,0,ot.width,ot.height),kt.shadowColor="white",kt.shadowBlur=2,kt.lineWidth=1.5,kt.strokeStyle="white",kt.textBaseline="top",kt.font="bold 36px Open Sans, sans-serif",kt.fillText(Ze,5,5),kt.strokeText(Ze,5,5),qe.debugOverlayTexture.update(ot),qe.debugOverlayTexture.bind(vt.LINEAR,vt.CLAMP_TO_EDGE)}(E,`${rt} ${Fe}kB`),H.draw(B,S.TRIANGLES,j,Z,gi.alphaBlended,Ti.disabled,Dl(F,o.aM.transparent,Oe),null,he,E.debugBuffer,E.quadTriangleIndexBuffer,E.debugSegments),H.draw(B,S.LINE_STRIP,j,Z,se,Ti.disabled,Dl(F,o.aM.red),ue,he,E.debugBuffer,E.tileBorderIndexBuffer,E.debugSegments)}function Co(E,c,y){const B=E.context,S=B.gl,F=E.colorModeForRenderPass(),H=new zn(S.LEQUAL,zn.ReadWrite,E.depthRangeFor3D),j=E.useProgram("terrain"),Z=c.getTerrainMesh();B.bindFramebuffer.set(null),B.viewport.set([0,0,E.width,E.height]);for(const se of y){const he=E.renderToTexture.getTexture(se),ue=c.getTerrainData(se.tileID);B.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,he.texture);const Te=E.transform.calculatePosMatrix(se.tileID.toUnwrapped()),Fe=c.getMeshFrameDelta(E.transform.zoom),Ee=E.transform.calculateFogMatrix(se.tileID.toUnwrapped()),Oe=hh(Te,Fe,Ee,E.style.sky,E.transform.pitch);j.draw(B,S.TRIANGLES,H,vi.disabled,F,Ti.backCCW,Oe,ue,"terrain",Z.vertexBuffer,Z.indexBuffer,Z.segments)}}class kc{constructor(c,y,B){this.vertexBuffer=c,this.indexBuffer=y,this.segments=B}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}class bl{constructor(c,y){this.context=new Do(c),this.transform=y,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:o.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Xe.maxUnderzooming+Xe.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new uh}resize(c,y,B){if(this.width=Math.floor(c*B),this.height=Math.floor(y*B),this.pixelRatio=B,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const S of this.style._order)this.style._layers[S].resize()}setup(){const c=this.context,y=new o.aX;y.emplaceBack(0,0),y.emplaceBack(o.X,0),y.emplaceBack(0,o.X),y.emplaceBack(o.X,o.X),this.tileExtentBuffer=c.createVertexBuffer(y,ri.members),this.tileExtentSegments=o.a0.simpleSegment(0,0,4,2);const B=new o.aX;B.emplaceBack(0,0),B.emplaceBack(o.X,0),B.emplaceBack(0,o.X),B.emplaceBack(o.X,o.X),this.debugBuffer=c.createVertexBuffer(B,ri.members),this.debugSegments=o.a0.simpleSegment(0,0,4,5);const S=new o.$;S.emplaceBack(0,0,0,0),S.emplaceBack(o.X,0,o.X,0),S.emplaceBack(0,o.X,0,o.X),S.emplaceBack(o.X,o.X,o.X,o.X),this.rasterBoundsBuffer=c.createVertexBuffer(S,Wr.members),this.rasterBoundsSegments=o.a0.simpleSegment(0,0,4,2);const F=new o.aX;F.emplaceBack(0,0),F.emplaceBack(1,0),F.emplaceBack(0,1),F.emplaceBack(1,1),this.viewportBuffer=c.createVertexBuffer(F,ri.members),this.viewportSegments=o.a0.simpleSegment(0,0,4,2);const H=new o.aZ;H.emplaceBack(0),H.emplaceBack(1),H.emplaceBack(3),H.emplaceBack(2),H.emplaceBack(0),this.tileBorderIndexBuffer=c.createIndexBuffer(H);const j=new o.aY;j.emplaceBack(0,1,2),j.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=c.createIndexBuffer(j);const Z=this.context.gl;this.stencilClearMode=new vi({func:Z.ALWAYS,mask:0},0,255,Z.ZERO,Z.ZERO,Z.ZERO)}clearStencil(){const c=this.context,y=c.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const B=o.H();o.aP(B,0,this.width,this.height,0,0,1),o.K(B,B,[y.drawingBufferWidth,y.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(c,y.TRIANGLES,zn.disabled,this.stencilClearMode,gi.disabled,Ti.disabled,ps(B),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(c,y){if(this.currentStencilSource===c.source||!c.isTileClipped()||!y||!y.length)return;this.currentStencilSource=c.source;const B=this.context,S=B.gl;this.nextStencilID+y.length>256&&this.clearStencil(),B.setColorMode(gi.disabled),B.setDepthMode(zn.disabled);const F=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const H of y){const j=this._tileClippingMaskIDs[H.key]=this.nextStencilID++,Z=this.style.map.terrain&&this.style.map.terrain.getTerrainData(H);F.draw(B,S.TRIANGLES,zn.disabled,new vi({func:S.ALWAYS,mask:0},j,255,S.KEEP,S.KEEP,S.REPLACE),gi.disabled,Ti.disabled,ps(H.posMatrix),Z,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const c=this.nextStencilID++,y=this.context.gl;return new vi({func:y.NOTEQUAL,mask:255},c,255,y.KEEP,y.KEEP,y.REPLACE)}stencilModeForClipping(c){const y=this.context.gl;return new vi({func:y.EQUAL,mask:255},this._tileClippingMaskIDs[c.key],0,y.KEEP,y.KEEP,y.REPLACE)}stencilConfigForOverlap(c){const y=this.context.gl,B=c.sort((H,j)=>j.overscaledZ-H.overscaledZ),S=B[B.length-1].overscaledZ,F=B[0].overscaledZ-S+1;if(F>1){this.currentStencilSource=void 0,this.nextStencilID+F>256&&this.clearStencil();const H={};for(let j=0;j<F;j++)H[j+S]=new vi({func:y.GEQUAL,mask:255},j+this.nextStencilID,255,y.KEEP,y.KEEP,y.REPLACE);return this.nextStencilID+=F,[H,B]}return[{[S]:vi.disabled},B]}colorModeForRenderPass(){const c=this.context.gl;return this._showOverdrawInspector?new gi([c.CONSTANT_COLOR,c.ONE],new o.aM(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?gi.unblended:gi.alphaBlended}depthModeForSublayer(c,y,B){if(!this.opaquePassEnabledForLayer())return zn.disabled;const S=1-((1+this.currentLayer)*this.numSublayers+c)*this.depthEpsilon;return new zn(B||this.context.gl.LEQUAL,y,[S,S])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(c,y){this.style=c,this.options=y,this.lineAtlas=c.lineAtlas,this.imageManager=c.imageManager,this.glyphManager=c.glyphManager,this.symbolFadeChange=c.placement.symbolFadeChange(x.now()),this.imageManager.beginFrame();const B=this.style._order,S=this.style.sourceCaches,F={},H={},j={};for(const Z in S){const se=S[Z];se.used&&se.prepare(this.context),F[Z]=se.getVisibleCoordinates(),H[Z]=F[Z].slice().reverse(),j[Z]=se.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let Z=0;Z<B.length;Z++)if(this.style._layers[B[Z]].is3D()){this.opaquePassCutoff=Z;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const Z of B){const se=this.style._layers[Z];if(!se.hasOffscreenPass()||se.isHidden(this.transform.zoom))continue;const he=H[se.source];(se.type==="custom"||he.length)&&this.renderLayer(this,S[se.source],se,he)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:y.showOverdrawInspector?o.aM.black:o.aM.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(Z,se){const he=Z.context,ue=he.gl,Te=((qe,Ze,ot)=>({u_sky_color:qe.properties.get("sky-color"),u_horizon_color:qe.properties.get("horizon-color"),u_horizon:(Ze.height/2+Ze.getHorizon())*ot,u_sky_horizon_blend:qe.properties.get("sky-horizon-blend")*Ze.height/2*ot}))(se,Z.style.map.transform,Z.pixelRatio),Fe=new zn(ue.LEQUAL,zn.ReadWrite,[0,1]),Ee=vi.disabled,Oe=Z.colorModeForRenderPass(),rt=Z.useProgram("sky");if(!se.mesh){const qe=new o.aX;qe.emplaceBack(-1,-1),qe.emplaceBack(1,-1),qe.emplaceBack(1,1),qe.emplaceBack(-1,1);const Ze=new o.aY;Ze.emplaceBack(0,1,2),Ze.emplaceBack(0,2,3),se.mesh=new kc(he.createVertexBuffer(qe,ri.members),he.createIndexBuffer(Ze),o.a0.simpleSegment(0,0,qe.length,Ze.length))}rt.draw(he,ue.TRIANGLES,Fe,Ee,Oe,Ti.disabled,Te,void 0,"sky",se.mesh.vertexBuffer,se.mesh.indexBuffer,se.mesh.segments)}(this,this.style.sky),this._showOverdrawInspector=y.showOverdrawInspector,this.depthRangeFor3D=[0,1-(c._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=B.length-1;this.currentLayer>=0;this.currentLayer--){const Z=this.style._layers[B[this.currentLayer]],se=S[Z.source],he=F[Z.source];this._renderTileClippingMasks(Z,he),this.renderLayer(this,se,Z,he)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<B.length;this.currentLayer++){const Z=this.style._layers[B[this.currentLayer]],se=S[Z.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(Z))continue;const he=(Z.type==="symbol"?j:H)[Z.source];this._renderTileClippingMasks(Z,F[Z.source]),this.renderLayer(this,se,Z,he)}if(this.options.showTileBoundaries){const Z=function(se,he){let ue=null;const Te=Object.values(se._layers).flatMap(rt=>rt.source&&!rt.isHidden(he)?[se.sourceCaches[rt.source]]:[]),Fe=Te.filter(rt=>rt.getSource().type==="vector"),Ee=Te.filter(rt=>rt.getSource().type!=="vector"),Oe=rt=>{(!ue||ue.getSource().maxzoom<rt.getSource().maxzoom)&&(ue=rt)};return Fe.forEach(rt=>Oe(rt)),ue||Ee.forEach(rt=>Oe(rt)),ue}(this.style,this.transform.zoom);Z&&function(se,he,ue){for(let Te=0;Te<ue.length;Te++)Oo(se,he,ue[Te])}(this,Z,Z.getVisibleCoordinates())}this.options.showPadding&&function(Z){const se=Z.transform.padding;Bo(Z,Z.transform.height-(se.top||0),3,Ah),Bo(Z,se.bottom||0,3,xi),yl(Z,se.left||0,3,Jo),yl(Z,Z.transform.width-(se.right||0),3,Ta);const he=Z.transform.centerPoint;(function(ue,Te,Fe,Ee){la(ue,Te-1,Fe-10,2,20,Ee),la(ue,Te-10,Fe-1,20,2,Ee)})(Z,he.x,Z.transform.height-he.y,_l)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(c){if(!this.style||!this.style.map||!this.style.map.terrain)return;const y=this.terrainFacilitator.matrix,B=this.transform.modelViewProjectionMatrix;let S=this.terrainFacilitator.dirty;S||(S=c?!o.a_(y,B):!o.a$(y,B)),S||(S=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),S&&(o.b0(y,B),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(F,H){const j=F.context,Z=j.gl,se=gi.unblended,he=new zn(Z.LEQUAL,zn.ReadWrite,[0,1]),ue=H.getTerrainMesh(),Te=H.sourceCache.getRenderableTiles(),Fe=F.useProgram("terrainDepth");j.bindFramebuffer.set(H.getFramebuffer("depth").framebuffer),j.viewport.set([0,0,F.width/devicePixelRatio,F.height/devicePixelRatio]),j.clear({color:o.aM.transparent,depth:1});for(const Ee of Te){const Oe=H.getTerrainData(Ee.tileID),rt={u_matrix:F.transform.calculatePosMatrix(Ee.tileID.toUnwrapped()),u_ele_delta:H.getMeshFrameDelta(F.transform.zoom)};Fe.draw(j,Z.TRIANGLES,he,vi.disabled,se,Ti.backCCW,rt,Oe,"terrain",ue.vertexBuffer,ue.indexBuffer,ue.segments)}j.bindFramebuffer.set(null),j.viewport.set([0,0,F.width,F.height])}(this,this.style.map.terrain),function(F,H){const j=F.context,Z=j.gl,se=gi.unblended,he=new zn(Z.LEQUAL,zn.ReadWrite,[0,1]),ue=H.getTerrainMesh(),Te=H.getCoordsTexture(),Fe=H.sourceCache.getRenderableTiles(),Ee=F.useProgram("terrainCoords");j.bindFramebuffer.set(H.getFramebuffer("coords").framebuffer),j.viewport.set([0,0,F.width/devicePixelRatio,F.height/devicePixelRatio]),j.clear({color:o.aM.transparent,depth:1}),H.coordsIndex=[];for(const Oe of Fe){const rt=H.getTerrainData(Oe.tileID);j.activeTexture.set(Z.TEXTURE0),Z.bindTexture(Z.TEXTURE_2D,Te.texture);const qe={u_matrix:F.transform.calculatePosMatrix(Oe.tileID.toUnwrapped()),u_terrain_coords_id:(255-H.coordsIndex.length)/255,u_texture:0,u_ele_delta:H.getMeshFrameDelta(F.transform.zoom)};Ee.draw(j,Z.TRIANGLES,he,vi.disabled,se,Ti.backCCW,qe,rt,"terrain",ue.vertexBuffer,ue.indexBuffer,ue.segments),H.coordsIndex.push(Oe.tileID.key)}j.bindFramebuffer.set(null),j.viewport.set([0,0,F.width,F.height])}(this,this.style.map.terrain))}renderLayer(c,y,B,S){if(!B.isHidden(this.transform.zoom)&&(B.type==="background"||B.type==="custom"||(S||[]).length))switch(this.id=B.id,B.type){case"symbol":(function(F,H,j,Z,se){if(F.renderPass!=="translucent")return;const he=vi.disabled,ue=F.colorModeForRenderPass();(j._unevaluatedLayout.hasValue("text-variable-anchor")||j._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(Te,Fe,Ee,Oe,rt,qe,Ze,ot,vt){const kt=Fe.transform,It=wa(),ur=rt==="map",wr=qe==="map";for(const Dr of Te){const Or=Oe.getTile(Dr),_r=Or.getBucket(Ee);if(!_r||!_r.text||!_r.text.segments.get().length)continue;const xr=o.ag(_r.textSizeData,kt.zoom),Vr=_n(Or,1,Fe.transform.zoom),xn=$t(Dr.posMatrix,wr,ur,Fe.transform,Vr),Qr=Ee.layout.get("icon-text-fit")!=="none"&&_r.hasIconData();if(xr){const jr=Math.pow(2,kt.zoom-Or.tileID.overscaledZ),In=Fe.style.map.terrain?(Qn,Zn)=>Fe.style.map.terrain.getElevation(Dr,Qn,Zn):null,Hn=It.translatePosition(kt,Or,Ze,ot);ml(_r,ur,wr,vt,kt,xn,Dr.posMatrix,jr,xr,Qr,It,Hn,Dr.toUnwrapped(),In)}}}(Z,F,j,H,j.layout.get("text-rotation-alignment"),j.layout.get("text-pitch-alignment"),j.paint.get("text-translate"),j.paint.get("text-translate-anchor"),se),j.paint.get("icon-opacity").constantOr(1)!==0&&Ps(F,H,j,Z,!1,j.paint.get("icon-translate"),j.paint.get("icon-translate-anchor"),j.layout.get("icon-rotation-alignment"),j.layout.get("icon-pitch-alignment"),j.layout.get("icon-keep-upright"),he,ue),j.paint.get("text-opacity").constantOr(1)!==0&&Ps(F,H,j,Z,!0,j.paint.get("text-translate"),j.paint.get("text-translate-anchor"),j.layout.get("text-rotation-alignment"),j.layout.get("text-pitch-alignment"),j.layout.get("text-keep-upright"),he,ue),H.map.showCollisionBoxes&&(Nl(F,H,j,Z,!0),Nl(F,H,j,Z,!1))})(c,y,B,S,this.style.placement.variableOffsets);break;case"circle":(function(F,H,j,Z){if(F.renderPass!=="translucent")return;const se=j.paint.get("circle-opacity"),he=j.paint.get("circle-stroke-width"),ue=j.paint.get("circle-stroke-opacity"),Te=!j.layout.get("circle-sort-key").isConstant();if(se.constantOr(1)===0&&(he.constantOr(1)===0||ue.constantOr(1)===0))return;const Fe=F.context,Ee=Fe.gl,Oe=F.depthModeForSublayer(0,zn.ReadOnly),rt=vi.disabled,qe=F.colorModeForRenderPass(),Ze=[];for(let ot=0;ot<Z.length;ot++){const vt=Z[ot],kt=H.getTile(vt),It=kt.getBucket(j);if(!It)continue;const ur=It.programConfigurations.get(j.id),wr=F.useProgram("circle",ur),Dr=It.layoutVertexBuffer,Or=It.indexBuffer,_r=F.style.map.terrain&&F.style.map.terrain.getTerrainData(vt),xr={programConfiguration:ur,program:wr,layoutVertexBuffer:Dr,indexBuffer:Or,uniformValues:oc(F,vt,kt,j),terrainData:_r};if(Te){const Vr=It.segments.get();for(const xn of Vr)Ze.push({segments:new o.a0([xn]),sortKey:xn.sortKey,state:xr})}else Ze.push({segments:It.segments,sortKey:0,state:xr})}Te&&Ze.sort((ot,vt)=>ot.sortKey-vt.sortKey);for(const ot of Ze){const{programConfiguration:vt,program:kt,layoutVertexBuffer:It,indexBuffer:ur,uniformValues:wr,terrainData:Dr}=ot.state;kt.draw(Fe,Ee.TRIANGLES,Oe,rt,qe,Ti.disabled,wr,Dr,j.id,It,ur,ot.segments,j.paint,F.transform.zoom,vt)}})(c,y,B,S);break;case"heatmap":(function(F,H,j,Z){if(j.paint.get("heatmap-opacity")===0)return;const se=F.context;if(F.style.map.terrain){for(const he of Z){const ue=H.getTile(he);H.hasRenderableParent(he)||(F.renderPass==="offscreen"?fc(F,ue,j,he):F.renderPass==="translucent"&&aa(F,j,he))}se.viewport.set([0,0,F.width,F.height])}else F.renderPass==="offscreen"?function(he,ue,Te,Fe){const Ee=he.context,Oe=Ee.gl,rt=vi.disabled,qe=new gi([Oe.ONE,Oe.ONE],o.aM.transparent,[!0,!0,!0,!0]);(function(Ze,ot,vt){const kt=Ze.gl;Ze.activeTexture.set(kt.TEXTURE1),Ze.viewport.set([0,0,ot.width/4,ot.height/4]);let It=vt.heatmapFbos.get(o.aU);It?(kt.bindTexture(kt.TEXTURE_2D,It.colorAttachment.get()),Ze.bindFramebuffer.set(It.framebuffer)):(It=Ac(Ze,ot.width/4,ot.height/4),vt.heatmapFbos.set(o.aU,It))})(Ee,he,Te),Ee.clear({color:o.aM.transparent});for(let Ze=0;Ze<Fe.length;Ze++){const ot=Fe[Ze];if(ue.hasRenderableParent(ot))continue;const vt=ue.getTile(ot),kt=vt.getBucket(Te);if(!kt)continue;const It=kt.programConfigurations.get(Te.id),ur=he.useProgram("heatmap",It),{zoom:wr}=he.transform;ur.draw(Ee,Oe.TRIANGLES,zn.disabled,rt,qe,Ti.disabled,Dn(ot.posMatrix,vt,wr,Te.paint.get("heatmap-intensity")),null,Te.id,kt.layoutVertexBuffer,kt.indexBuffer,kt.segments,Te.paint,he.transform.zoom,It)}Ee.viewport.set([0,0,he.width,he.height])}(F,H,j,Z):F.renderPass==="translucent"&&function(he,ue){const Te=he.context,Fe=Te.gl;Te.setColorMode(he.colorModeForRenderPass());const Ee=ue.heatmapFbos.get(o.aU);Ee&&(Te.activeTexture.set(Fe.TEXTURE0),Fe.bindTexture(Fe.TEXTURE_2D,Ee.colorAttachment.get()),Te.activeTexture.set(Fe.TEXTURE1),co(Te,ue).bind(Fe.LINEAR,Fe.CLAMP_TO_EDGE),he.useProgram("heatmapTexture").draw(Te,Fe.TRIANGLES,zn.disabled,vi.disabled,he.colorModeForRenderPass(),Ti.disabled,Ro(he,ue,0,1),null,ue.id,he.viewportBuffer,he.quadTriangleIndexBuffer,he.viewportSegments,ue.paint,he.transform.zoom))}(F,j)})(c,y,B,S);break;case"line":(function(F,H,j,Z){if(F.renderPass!=="translucent")return;const se=j.paint.get("line-opacity"),he=j.paint.get("line-width");if(se.constantOr(1)===0||he.constantOr(1)===0)return;const ue=F.depthModeForSublayer(0,zn.ReadOnly),Te=F.colorModeForRenderPass(),Fe=j.paint.get("line-dasharray"),Ee=j.paint.get("line-pattern"),Oe=Ee.constantOr(1),rt=j.paint.get("line-gradient"),qe=j.getCrossfadeParameters(),Ze=Oe?"linePattern":Fe?"lineSDF":rt?"lineGradient":"line",ot=F.context,vt=ot.gl;let kt=!0;for(const It of Z){const ur=H.getTile(It);if(Oe&&!ur.patternsLoaded())continue;const wr=ur.getBucket(j);if(!wr)continue;const Dr=wr.programConfigurations.get(j.id),Or=F.context.program.get(),_r=F.useProgram(Ze,Dr),xr=kt||_r.program!==Or,Vr=F.style.map.terrain&&F.style.map.terrain.getTerrainData(It),xn=Ee.constantOr(null);if(xn&&ur.imageAtlas){const In=ur.imageAtlas,Hn=In.patternPositions[xn.to.toString()],Qn=In.patternPositions[xn.from.toString()];Hn&&Qn&&Dr.setConstantPatternPositions(Hn,Qn)}const Qr=Vr?It:null,jr=Oe?Li(F,ur,j,qe,Qr):Fe?Ol(F,ur,j,Fe,qe,Qr):rt?du(F,ur,j,wr.lineClipsArray.length,Qr):to(F,ur,j,Qr);if(Oe)ot.activeTexture.set(vt.TEXTURE0),ur.imageAtlasTexture.bind(vt.LINEAR,vt.CLAMP_TO_EDGE),Dr.updatePaintBuffers(qe);else if(Fe&&(xr||F.lineAtlas.dirty))ot.activeTexture.set(vt.TEXTURE0),F.lineAtlas.bind(ot);else if(rt){const In=wr.gradients[j.id];let Hn=In.texture;if(j.gradientVersion!==In.version){let Qn=256;if(j.stepInterpolant){const Zn=H.getSource().maxzoom,ui=It.canonical.z===Zn?Math.ceil(1<<F.transform.maxZoom-It.canonical.z):1;Qn=o.ac(o.aV(wr.maxLineLength/o.X*1024*ui),256,ot.maxTextureSize)}In.gradient=o.aW({expression:j.gradientExpression(),evaluationKey:"lineProgress",resolution:Qn,image:In.gradient||void 0,clips:wr.lineClipsArray}),In.texture?In.texture.update(In.gradient):In.texture=new Le(ot,In.gradient,vt.RGBA),In.version=j.gradientVersion,Hn=In.texture}ot.activeTexture.set(vt.TEXTURE0),Hn.bind(j.stepInterpolant?vt.NEAREST:vt.LINEAR,vt.CLAMP_TO_EDGE)}_r.draw(ot,vt.TRIANGLES,ue,F.stencilModeForClipping(It),Te,Ti.disabled,jr,Vr,j.id,wr.layoutVertexBuffer,wr.indexBuffer,wr.segments,j.paint,F.transform.zoom,Dr,wr.layoutVertexBuffer2),kt=!1}})(c,y,B,S);break;case"fill":(function(F,H,j,Z){const se=j.paint.get("fill-color"),he=j.paint.get("fill-opacity");if(he.constantOr(1)===0)return;const ue=F.colorModeForRenderPass(),Te=j.paint.get("fill-pattern"),Fe=F.opaquePassEnabledForLayer()&&!Te.constantOr(1)&&se.constantOr(o.aM.transparent).a===1&&he.constantOr(0)===1?"opaque":"translucent";if(F.renderPass===Fe){const Ee=F.depthModeForSublayer(1,F.renderPass==="opaque"?zn.ReadWrite:zn.ReadOnly);Hl(F,H,j,Z,Ee,ue,!1)}if(F.renderPass==="translucent"&&j.paint.get("fill-antialias")){const Ee=F.depthModeForSublayer(j.getPaintProperty("fill-outline-color")?2:0,zn.ReadOnly);Hl(F,H,j,Z,Ee,ue,!0)}})(c,y,B,S);break;case"fill-extrusion":(function(F,H,j,Z){const se=j.paint.get("fill-extrusion-opacity");if(se!==0&&F.renderPass==="translucent"){const he=new zn(F.context.gl.LEQUAL,zn.ReadWrite,F.depthRangeFor3D);if(se!==1||j.paint.get("fill-extrusion-pattern").constantOr(1))Bi(F,H,j,Z,he,vi.disabled,gi.disabled),Bi(F,H,j,Z,he,F.stencilModeFor3D(),F.colorModeForRenderPass());else{const ue=F.colorModeForRenderPass();Bi(F,H,j,Z,he,vi.disabled,ue)}}})(c,y,B,S);break;case"hillshade":(function(F,H,j,Z){if(F.renderPass!=="offscreen"&&F.renderPass!=="translucent")return;const se=F.context,he=F.depthModeForSublayer(0,zn.ReadOnly),ue=F.colorModeForRenderPass(),[Te,Fe]=F.renderPass==="translucent"?F.stencilConfigForOverlap(Z):[{},Z];for(const Ee of Fe){const Oe=H.getTile(Ee);Oe.needsHillshadePrepare!==void 0&&Oe.needsHillshadePrepare&&F.renderPass==="offscreen"?pc(F,Oe,j,he,vi.disabled,ue):F.renderPass==="translucent"&&Xo(F,Ee,Oe,j,he,Te[Ee.overscaledZ],ue)}se.viewport.set([0,0,F.width,F.height])})(c,y,B,S);break;case"raster":(function(F,H,j,Z){if(F.renderPass!=="translucent"||j.paint.get("raster-opacity")===0||!Z.length)return;const se=F.context,he=se.gl,ue=H.getSource(),Te=F.useProgram("raster"),Fe=F.colorModeForRenderPass(),[Ee,Oe]=ue instanceof gn?[{},Z]:F.stencilConfigForOverlap(Z),rt=Oe[Oe.length-1].overscaledZ,qe=!F.options.moving;for(const Ze of Oe){const ot=F.depthModeForSublayer(Ze.overscaledZ-rt,j.paint.get("raster-opacity")===1?zn.ReadWrite:zn.ReadOnly,he.LESS),vt=H.getTile(Ze);vt.registerFadeDuration(j.paint.get("raster-fade-duration"));const kt=H.findLoadedParent(Ze,0),It=H.findLoadedSibling(Ze),ur=vd(vt,kt||It||null,H,j,F.transform,F.style.map.terrain);let wr,Dr;const Or=j.paint.get("raster-resampling")==="nearest"?he.NEAREST:he.LINEAR;se.activeTexture.set(he.TEXTURE0),vt.texture.bind(Or,he.CLAMP_TO_EDGE,he.LINEAR_MIPMAP_NEAREST),se.activeTexture.set(he.TEXTURE1),kt?(kt.texture.bind(Or,he.CLAMP_TO_EDGE,he.LINEAR_MIPMAP_NEAREST),wr=Math.pow(2,kt.tileID.overscaledZ-vt.tileID.overscaledZ),Dr=[vt.tileID.canonical.x*wr%1,vt.tileID.canonical.y*wr%1]):vt.texture.bind(Or,he.CLAMP_TO_EDGE,he.LINEAR_MIPMAP_NEAREST),vt.texture.useMipmap&&se.extTextureFilterAnisotropic&&F.transform.pitch>20&&he.texParameterf(he.TEXTURE_2D,se.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,se.extTextureFilterAnisotropicMax);const _r=F.style.map.terrain&&F.style.map.terrain.getTerrainData(Ze),xr=_r?Ze:null,Vr=xr?xr.posMatrix:F.transform.calculatePosMatrix(Ze.toUnwrapped(),qe),xn=ku(Vr,Dr||[0,0],wr||1,ur,j);ue instanceof gn?Te.draw(se,he.TRIANGLES,ot,vi.disabled,Fe,Ti.disabled,xn,_r,j.id,ue.boundsBuffer,F.quadTriangleIndexBuffer,ue.boundsSegments):Te.draw(se,he.TRIANGLES,ot,Ee[Ze.overscaledZ],Fe,Ti.disabled,xn,_r,j.id,F.rasterBoundsBuffer,F.quadTriangleIndexBuffer,F.rasterBoundsSegments)}})(c,y,B,S);break;case"background":(function(F,H,j,Z){const se=j.paint.get("background-color"),he=j.paint.get("background-opacity");if(he===0)return;const ue=F.context,Te=ue.gl,Fe=F.transform,Ee=Fe.tileSize,Oe=j.paint.get("background-pattern");if(F.isPatternMissing(Oe))return;const rt=!Oe&&se.a===1&&he===1&&F.opaquePassEnabledForLayer()?"opaque":"translucent";if(F.renderPass!==rt)return;const qe=vi.disabled,Ze=F.depthModeForSublayer(0,rt==="opaque"?zn.ReadWrite:zn.ReadOnly),ot=F.colorModeForRenderPass(),vt=F.useProgram(Oe?"backgroundPattern":"background"),kt=Z||Fe.coveringTiles({tileSize:Ee,terrain:F.style.map.terrain});Oe&&(ue.activeTexture.set(Te.TEXTURE0),F.imageManager.bind(F.context));const It=j.getCrossfadeParameters();for(const ur of kt){const wr=Z?ur.posMatrix:F.transform.calculatePosMatrix(ur.toUnwrapped()),Dr=Oe?ja(wr,he,F,Oe,{tileID:ur,tileSize:Ee},It):ac(wr,he,se),Or=F.style.map.terrain&&F.style.map.terrain.getTerrainData(ur);vt.draw(ue,Te.TRIANGLES,Ze,qe,ot,Ti.disabled,Dr,Or,j.id,F.tileExtentBuffer,F.quadTriangleIndexBuffer,F.tileExtentSegments)}})(c,0,B,S);break;case"custom":(function(F,H,j){const Z=F.context,se=j.implementation;if(F.renderPass==="offscreen"){const he=se.prerender;he&&(F.setCustomLayerDefaults(),Z.setColorMode(F.colorModeForRenderPass()),he.call(se,Z.gl,F.transform.customLayerMatrix()),Z.setDirty(),F.setBaseState())}else if(F.renderPass==="translucent"){F.setCustomLayerDefaults(),Z.setColorMode(F.colorModeForRenderPass()),Z.setStencilMode(vi.disabled);const he=se.renderingMode==="3d"?new zn(F.context.gl.LEQUAL,zn.ReadWrite,F.depthRangeFor3D):F.depthModeForSublayer(0,zn.ReadOnly);Z.setDepthMode(he),se.render(Z.gl,F.transform.customLayerMatrix(),{farZ:F.transform.farZ,nearZ:F.transform.nearZ,fov:F.transform._fov,modelViewProjectionMatrix:F.transform.modelViewProjectionMatrix,projectionMatrix:F.transform.projectionMatrix}),Z.setDirty(),F.setBaseState(),Z.bindFramebuffer.set(null)}})(c,0,B)}}translatePosMatrix(c,y,B,S,F){if(!B[0]&&!B[1])return c;const H=F?S==="map"?this.transform.angle:0:S==="viewport"?-this.transform.angle:0;if(H){const se=Math.sin(H),he=Math.cos(H);B=[B[0]*he-B[1]*se,B[0]*se+B[1]*he]}const j=[F?B[0]:_n(y,B[0],this.transform.zoom),F?B[1]:_n(y,B[1],this.transform.zoom),0],Z=new Float32Array(16);return o.J(Z,c,j),Z}saveTileTexture(c){const y=this._tileTextures[c.size[0]];y?y.push(c):this._tileTextures[c.size[0]]=[c]}getTileTexture(c){const y=this._tileTextures[c];return y&&y.length>0?y.pop():null}isPatternMissing(c){if(!c)return!1;if(!c.from||!c.to)return!0;const y=this.imageManager.getPattern(c.from.toString()),B=this.imageManager.getPattern(c.to.toString());return!y||!B}useProgram(c,y){this.cache=this.cache||{};const B=c+(y?y.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[B]||(this.cache[B]=new fs(this.context,lo[c],y,qa[c],this._showOverdrawInspector,this.style.map.terrain)),this.cache[B]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const c=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(c.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Le(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:c,drawingBufferHeight:y}=this.context.gl;return this.width!==c||this.height!==y}}class Eo{constructor(c,y){this.points=c,this.planes=y}static fromInvProjectionMatrix(c,y,B){const S=Math.pow(2,B),F=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(j=>{const Z=1/(j=o.af([],j,c))[3]/y*S;return o.b1(j,j,[Z,Z,1/j[3],Z])}),H=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(j=>{const Z=function(Te,Fe){var Ee=Fe[0],Oe=Fe[1],rt=Fe[2],qe=Ee*Ee+Oe*Oe+rt*rt;return qe>0&&(qe=1/Math.sqrt(qe)),Te[0]=Fe[0]*qe,Te[1]=Fe[1]*qe,Te[2]=Fe[2]*qe,Te}([],function(Te,Fe,Ee){var Oe=Fe[0],rt=Fe[1],qe=Fe[2],Ze=Ee[0],ot=Ee[1],vt=Ee[2];return Te[0]=rt*vt-qe*ot,Te[1]=qe*Ze-Oe*vt,Te[2]=Oe*ot-rt*Ze,Te}([],Qe([],F[j[0]],F[j[1]]),Qe([],F[j[2]],F[j[1]]))),se=-((he=Z)[0]*(ue=F[j[1]])[0]+he[1]*ue[1]+he[2]*ue[2]);var he,ue;return Z.concat(se)});return new Eo(F,H)}}class uo{constructor(c,y){this.min=c,this.max=y,this.center=function(B,S,F){return B[0]=.5*S[0],B[1]=.5*S[1],B[2]=.5*S[2],B}([],function(B,S,F){return B[0]=S[0]+F[0],B[1]=S[1]+F[1],B[2]=S[2]+F[2],B}([],this.min,this.max))}quadrant(c){const y=[c%2==0,c<2],B=ve(this.min),S=ve(this.max);for(let F=0;F<y.length;F++)B[F]=y[F]?this.min[F]:this.center[F],S[F]=y[F]?this.center[F]:this.max[F];return S[2]=this.max[2],new uo(B,S)}distanceX(c){return Math.max(Math.min(this.max[0],c[0]),this.min[0])-c[0]}distanceY(c){return Math.max(Math.min(this.max[1],c[1]),this.min[1])-c[1]}intersects(c){const y=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let B=!0;for(let S=0;S<c.planes.length;S++){const F=c.planes[S];let H=0;for(let j=0;j<y.length;j++)o.b2(F,y[j])>=0&&H++;if(H===0)return 0;H!==y.length&&(B=!1)}if(B)return 2;for(let S=0;S<3;S++){let F=Number.MAX_VALUE,H=-Number.MAX_VALUE;for(let j=0;j<c.points.length;j++){const Z=c.points[j][S]-this.min[S];F=Math.min(F,Z),H=Math.max(H,Z)}if(H<0||F>this.max[S]-this.min[S])return 0}return 1}}class ca{constructor(){let c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,B=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,S=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;if(isNaN(c)||c<0||isNaN(y)||y<0||isNaN(B)||B<0||isNaN(S)||S<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=c,this.bottom=y,this.left=B,this.right=S}interpolate(c,y,B){return y.top!=null&&c.top!=null&&(this.top=o.y.number(c.top,y.top,B)),y.bottom!=null&&c.bottom!=null&&(this.bottom=o.y.number(c.bottom,y.bottom,B)),y.left!=null&&c.left!=null&&(this.left=o.y.number(c.left,y.left,B)),y.right!=null&&c.right!=null&&(this.right=o.y.number(c.right,y.right,B)),this}getCenter(c,y){const B=o.ac((this.left+c-this.right)/2,0,c),S=o.ac((this.top+y-this.bottom)/2,0,y);return new o.P(B,S)}equals(c){return this.top===c.top&&this.bottom===c.bottom&&this.left===c.left&&this.right===c.right}clone(){return new ca(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Vl=85.051129;class Zo{constructor(c,y,B,S,F){this.tileSize=512,this._renderWorldCopies=F===void 0||!!F,this._minZoom=c||0,this._maxZoom=y||22,this._minPitch=B??0,this._maxPitch=S??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new o.N(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new ca,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={},this.minElevationForCurrentTile=0}clone(){const c=new Zo(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return c.apply(this),c}apply(c){this.tileSize=c.tileSize,this.latRange=c.latRange,this.lngRange=c.lngRange,this.width=c.width,this.height=c.height,this._center=c._center,this._elevation=c._elevation,this.minElevationForCurrentTile=c.minElevationForCurrentTile,this.zoom=c.zoom,this.angle=c.angle,this._fov=c._fov,this._pitch=c._pitch,this._unmodified=c._unmodified,this._edgeInsets=c._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(c){this._minZoom!==c&&(this._minZoom=c,this.zoom=Math.max(this.zoom,c))}get maxZoom(){return this._maxZoom}set maxZoom(c){this._maxZoom!==c&&(this._maxZoom=c,this.zoom=Math.min(this.zoom,c))}get minPitch(){return this._minPitch}set minPitch(c){this._minPitch!==c&&(this._minPitch=c,this.pitch=Math.max(this.pitch,c))}get maxPitch(){return this._maxPitch}set maxPitch(c){this._maxPitch!==c&&(this._maxPitch=c,this.pitch=Math.min(this.pitch,c))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(c){c===void 0?c=!0:c===null&&(c=!1),this._renderWorldCopies=c}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(c){const y=-o.b3(c,-180,180)*Math.PI/180;this.angle!==y&&(this._unmodified=!1,this.angle=y,this._calcMatrices(),this.rotationMatrix=function(){var B=new o.A(4);return o.A!=Float32Array&&(B[1]=0,B[2]=0),B[0]=1,B[3]=1,B}(),function(B,S,F){var H=S[0],j=S[1],Z=S[2],se=S[3],he=Math.sin(F),ue=Math.cos(F);B[0]=H*ue+Z*he,B[1]=j*ue+se*he,B[2]=H*-he+Z*ue,B[3]=j*-he+se*ue}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(c){const y=o.ac(c,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==y&&(this._unmodified=!1,this._pitch=y,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(c){c=Math.max(.01,Math.min(60,c)),this._fov!==c&&(this._unmodified=!1,this._fov=c/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(c){const y=Math.min(Math.max(c,this.minZoom),this.maxZoom);this._zoom!==y&&(this._unmodified=!1,this._zoom=y,this.tileZoom=Math.max(0,Math.floor(y)),this.scale=this.zoomScale(y),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(c){c.lat===this._center.lat&&c.lng===this._center.lng||(this._unmodified=!1,this._center=c,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(c){c!==this._elevation&&(this._elevation=c,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(c){this._edgeInsets.equals(c)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,c,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(c){return this._edgeInsets.equals(c)}interpolatePadding(c,y,B){this._unmodified=!1,this._edgeInsets.interpolate(c,y,B),this._constrain(),this._calcMatrices()}coveringZoomLevel(c){const y=(c.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/c.tileSize));return Math.max(0,y)}getVisibleUnwrappedCoordinates(c){const y=[new o.b4(0,c)];if(this._renderWorldCopies){const B=this.pointCoordinate(new o.P(0,0)),S=this.pointCoordinate(new o.P(this.width,0)),F=this.pointCoordinate(new o.P(this.width,this.height)),H=this.pointCoordinate(new o.P(0,this.height)),j=Math.floor(Math.min(B.x,S.x,F.x,H.x)),Z=Math.floor(Math.max(B.x,S.x,F.x,H.x)),se=1;for(let he=j-se;he<=Z+se;he++)he!==0&&y.push(new o.b4(he,c))}return y}coveringTiles(c){var y,B;let S=this.coveringZoomLevel(c);const F=S;if(c.minzoom!==void 0&&S<c.minzoom)return[];c.maxzoom!==void 0&&S>c.maxzoom&&(S=c.maxzoom);const H=this.pointCoordinate(this.getCameraPoint()),j=o.Z.fromLngLat(this.center),Z=Math.pow(2,S),se=[Z*H.x,Z*H.y,0],he=[Z*j.x,Z*j.y,0],ue=Eo.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,S);let Te=c.minzoom||0;!c.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(Te=S);const Fe=c.terrain?2/Math.min(this.tileSize,c.tileSize)*this.tileSize:3,Ee=ot=>({aabb:new uo([ot*Z,0,0],[(ot+1)*Z,Z,0]),zoom:0,x:0,y:0,wrap:ot,fullyVisible:!1}),Oe=[],rt=[],qe=S,Ze=c.reparseOverscaled?F:S;if(this._renderWorldCopies)for(let ot=1;ot<=3;ot++)Oe.push(Ee(-ot)),Oe.push(Ee(ot));for(Oe.push(Ee(0));Oe.length>0;){const ot=Oe.pop(),vt=ot.x,kt=ot.y;let It=ot.fullyVisible;if(!It){const _r=ot.aabb.intersects(ue);if(_r===0)continue;It=_r===2}const ur=c.terrain?se:he,wr=ot.aabb.distanceX(ur),Dr=ot.aabb.distanceY(ur),Or=Math.max(Math.abs(wr),Math.abs(Dr));if(ot.zoom===qe||Or>Fe+(1<<qe-ot.zoom)-2&&ot.zoom>=Te){const _r=qe-ot.zoom,xr=se[0]-.5-(vt<<_r),Vr=se[1]-.5-(kt<<_r);rt.push({tileID:new o.S(ot.zoom===qe?Ze:ot.zoom,ot.wrap,ot.zoom,vt,kt),distanceSq:Ue([he[0]-.5-vt,he[1]-.5-kt]),tileDistanceToCamera:Math.sqrt(xr*xr+Vr*Vr)})}else for(let _r=0;_r<4;_r++){const xr=(vt<<1)+_r%2,Vr=(kt<<1)+(_r>>1),xn=ot.zoom+1;let Qr=ot.aabb.quadrant(_r);if(c.terrain){const jr=new o.S(xn,ot.wrap,xn,xr,Vr),In=c.terrain.getMinMaxElevation(jr),Hn=(y=In.minElevation)!==null&&y!==void 0?y:this.elevation,Qn=(B=In.maxElevation)!==null&&B!==void 0?B:this.elevation;Qr=new uo([Qr.min[0],Qr.min[1],Hn],[Qr.max[0],Qr.max[1],Qn])}Oe.push({aabb:Qr,zoom:xn,x:xr,y:Vr,wrap:ot.wrap,fullyVisible:It})}}return rt.sort((ot,vt)=>ot.distanceSq-vt.distanceSq).map(ot=>ot.tileID)}resize(c,y){this.width=c,this.height=y,this.pixelsToGLUnits=[2/c,-2/y],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(c){return Math.pow(2,c)}scaleZoom(c){return Math.log(c)/Math.LN2}project(c){const y=o.ac(c.lat,-85.051129,Vl);return new o.P(o.O(c.lng)*this.worldSize,o.Q(y)*this.worldSize)}unproject(c){return new o.Z(c.x/this.worldSize,c.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(c){const y=this.elevation,B=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,S=this.pointLocation(this.centerPoint,c),F=c.getElevationForLngLatZoom(S,this.tileZoom);if(!(this.elevation-F))return;const H=B+y-F,j=Math.cos(this._pitch)*this.cameraToCenterDistance/H/o.b5(1,S.lat),Z=this.scaleZoom(j/this.tileSize);this._elevation=F,this._center=S,this.zoom=Z}setLocationAtPoint(c,y){const B=this.pointCoordinate(y),S=this.pointCoordinate(this.centerPoint),F=this.locationCoordinate(c),H=new o.Z(F.x-(B.x-S.x),F.y-(B.y-S.y));this.center=this.coordinateLocation(H),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(c,y){return y?this.coordinatePoint(this.locationCoordinate(c),y.getElevationForLngLatZoom(c,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(c))}pointLocation(c,y){return this.coordinateLocation(this.pointCoordinate(c,y))}locationCoordinate(c){return o.Z.fromLngLat(c)}coordinateLocation(c){return c&&c.toLngLat()}pointCoordinate(c,y){if(y){const Te=y.pointCoordinate(c);if(Te!=null)return Te}const B=[c.x,c.y,0,1],S=[c.x,c.y,1,1];o.af(B,B,this.pixelMatrixInverse),o.af(S,S,this.pixelMatrixInverse);const F=B[3],H=S[3],j=B[1]/F,Z=S[1]/H,se=B[2]/F,he=S[2]/H,ue=se===he?0:(0-se)/(he-se);return new o.Z(o.y.number(B[0]/F,S[0]/H,ue)/this.worldSize,o.y.number(j,Z,ue)/this.worldSize)}coordinatePoint(c){let y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,B=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.pixelMatrix;const S=[c.x*this.worldSize,c.y*this.worldSize,y,1];return o.af(S,S,B),new o.P(S[0]/S[3],S[1]/S[3])}getBounds(){const c=Math.max(0,this.height/2-this.getHorizon());return new We().extend(this.pointLocation(new o.P(0,c))).extend(this.pointLocation(new o.P(this.width,c))).extend(this.pointLocation(new o.P(this.width,this.height))).extend(this.pointLocation(new o.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new We([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(c){c?(this.lngRange=[c.getWest(),c.getEast()],this.latRange=[c.getSouth(),c.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,Vl])}calculateTileMatrix(c){const y=c.canonical,B=this.worldSize/this.zoomScale(y.z),S=y.x+Math.pow(2,y.z)*c.wrap,F=o.an(new Float64Array(16));return o.J(F,F,[S*B,y.y*B,0]),o.K(F,F,[B/o.X,B/o.X,1]),F}calculatePosMatrix(c){let y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const B=c.key,S=y?this._alignedPosMatrixCache:this._posMatrixCache;if(S[B])return S[B];const F=this.calculateTileMatrix(c);return o.L(F,y?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,F),S[B]=new Float32Array(F),S[B]}calculateFogMatrix(c){const y=c.key,B=this._fogMatrixCache;if(B[y])return B[y];const S=this.calculateTileMatrix(c);return o.L(S,this.fogMatrix,S),B[y]=new Float32Array(S),B[y]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(c,y){y=o.ac(+y,this.minZoom,this.maxZoom);const B={center:new o.N(c.lng,c.lat),zoom:y};let S=this.lngRange;if(!this._renderWorldCopies&&S===null){const ot=179.9999999999;S=[-ot,ot]}const F=this.tileSize*this.zoomScale(B.zoom);let H=0,j=F,Z=0,se=F,he=0,ue=0;const{x:Te,y:Fe}=this.size;if(this.latRange){const ot=this.latRange;H=o.Q(ot[1])*F,j=o.Q(ot[0])*F,j-H<Fe&&(he=Fe/(j-H))}S&&(Z=o.b3(o.O(S[0])*F,0,F),se=o.b3(o.O(S[1])*F,0,F),se<Z&&(se+=F),se-Z<Te&&(ue=Te/(se-Z)));const{x:Ee,y:Oe}=this.project.call({worldSize:F},c);let rt,qe;const Ze=Math.max(ue||0,he||0);if(Ze){const ot=new o.P(ue?(se+Z)/2:Ee,he?(j+H)/2:Oe);return B.center=this.unproject.call({worldSize:F},ot).wrap(),B.zoom+=this.scaleZoom(Ze),B}if(this.latRange){const ot=Fe/2;Oe-ot<H&&(qe=H+ot),Oe+ot>j&&(qe=j-ot)}if(S){const ot=(Z+se)/2;let vt=Ee;this._renderWorldCopies&&(vt=o.b3(Ee,ot-F/2,ot+F/2));const kt=Te/2;vt-kt<Z&&(rt=Z+kt),vt+kt>se&&(rt=se-kt)}if(rt!==void 0||qe!==void 0){const ot=new o.P(rt??Ee,qe??Oe);B.center=this.unproject.call({worldSize:F},ot).wrap()}return B}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const c=this._unmodified,{center:y,zoom:B}=this.getConstrained(this.center,this.zoom);this.center=y,this.zoom=B,this._unmodified=c,this._constraining=!1}_calcMatrices(){if(!this.height)return;const c=this.centerOffset,y=this.point.x,B=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=o.b5(1,this.center.lat)*this.worldSize;let S=o.an(new Float64Array(16));o.K(S,S,[this.width/2,-this.height/2,1]),o.J(S,S,[1,-1,0]),this.labelPlaneMatrix=S,S=o.an(new Float64Array(16)),o.K(S,S,[1,-1,1]),o.J(S,S,[-1,-1,0]),o.K(S,S,[2/this.width,2/this.height,1]),this.glCoordMatrix=S;const F=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),H=Math.min(this.elevation,this.minElevationForCurrentTile),j=F-H*this._pixelPerMeter/Math.cos(this._pitch),Z=H<0?j:F,se=Math.PI/2+this._pitch,he=this._fov*(.5+c.y/this.height),ue=Math.sin(he)*Z/Math.sin(o.ac(Math.PI-se-he,.01,Math.PI-.01)),Te=this.getHorizon(),Fe=2*Math.atan(Te/this.cameraToCenterDistance)*(.5+c.y/(2*Te)),Ee=Math.sin(Fe)*Z/Math.sin(o.ac(Math.PI-se-Fe,.01,Math.PI-.01)),Oe=Math.min(ue,Ee);this.farZ=1.01*(Math.cos(Math.PI/2-this._pitch)*Oe+Z),this.nearZ=this.height/50,S=new Float64Array(16),o.b6(S,this._fov,this.width/this.height,this.nearZ,this.farZ),S[8]=2*-c.x/this.width,S[9]=2*c.y/this.height,this.projectionMatrix=o.ae(S),o.K(S,S,[1,-1,1]),o.J(S,S,[0,0,-this.cameraToCenterDistance]),o.b7(S,S,this._pitch),o.ad(S,S,this.angle),o.J(S,S,[-y,-B,0]),this.mercatorMatrix=o.K([],S,[this.worldSize,this.worldSize,this.worldSize]),o.K(S,S,[1,1,this._pixelPerMeter]),this.pixelMatrix=o.L(new Float64Array(16),this.labelPlaneMatrix,S),o.J(S,S,[0,0,-this.elevation]),this.modelViewProjectionMatrix=S,this.invModelViewProjectionMatrix=o.as([],S),this.fogMatrix=new Float64Array(16),o.b6(this.fogMatrix,this._fov,this.width/this.height,F,this.farZ),this.fogMatrix[8]=2*-c.x/this.width,this.fogMatrix[9]=2*c.y/this.height,o.K(this.fogMatrix,this.fogMatrix,[1,-1,1]),o.J(this.fogMatrix,this.fogMatrix,[0,0,-this.cameraToCenterDistance]),o.b7(this.fogMatrix,this.fogMatrix,this._pitch),o.ad(this.fogMatrix,this.fogMatrix,this.angle),o.J(this.fogMatrix,this.fogMatrix,[-y,-B,0]),o.K(this.fogMatrix,this.fogMatrix,[1,1,this._pixelPerMeter]),o.J(this.fogMatrix,this.fogMatrix,[0,0,-this.elevation]),this.pixelMatrix3D=o.L(new Float64Array(16),this.labelPlaneMatrix,S);const rt=this.width%2/2,qe=this.height%2/2,Ze=Math.cos(this.angle),ot=Math.sin(this.angle),vt=y-Math.round(y)+Ze*rt+ot*qe,kt=B-Math.round(B)+Ze*qe+ot*rt,It=new Float64Array(S);if(o.J(It,It,[vt>.5?vt-1:vt,kt>.5?kt-1:kt,0]),this.alignedModelViewProjectionMatrix=It,S=o.as(new Float64Array(16),this.pixelMatrix),!S)throw new Error("failed to invert matrix");this.pixelMatrixInverse=S,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const c=this.pointCoordinate(new o.P(0,0)),y=[c.x*this.worldSize,c.y*this.worldSize,0,1];return o.af(y,y,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const c=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(0,c))}getCameraQueryGeometry(c){const y=this.getCameraPoint();if(c.length===1)return[c[0],y];{let B=y.x,S=y.y,F=y.x,H=y.y;for(const j of c)B=Math.min(B,j.x),S=Math.min(S,j.y),F=Math.max(F,j.x),H=Math.max(H,j.y);return[new o.P(B,S),new o.P(F,S),new o.P(F,H),new o.P(B,H),new o.P(B,S)]}}lngLatToCameraDepth(c,y){const B=this.locationCoordinate(c),S=[B.x*this.worldSize,B.y*this.worldSize,y,1];return o.af(S,S,this.modelViewProjectionMatrix),S[2]/S[3]}}function ua(E,c){var y=this;let B,S=!1,F=null,H=null;const j=()=>{F=null,S&&(E.apply(H,B),F=setTimeout(j,c),S=!1)};return function(){for(var Z=arguments.length,se=new Array(Z),he=0;he<Z;he++)se[he]=arguments[he];return S=!0,H=y,B=se,F||j(),F}}class Uc{constructor(c){this._getCurrentHash=()=>{const y=window.location.hash.replace("#","");if(this._hashName){let B;return y.split("&").map(S=>S.split("=")).forEach(S=>{S[0]===this._hashName&&(B=S)}),(B&&B[1]||"").split("/")}return y.split("/")},this._onHashChange=()=>{const y=this._getCurrentHash();if(y.length>=3&&!y.some(B=>isNaN(B))){const B=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(y[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+y[2],+y[1]],zoom:+y[0],bearing:B,pitch:+(y[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const y=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,y)},this._removeHash=()=>{const y=this._getCurrentHash();if(y.length===0)return;const B=y.join("/");let S=B;S.split("&").length>0&&(S=S.split("&")[0]),this._hashName&&(S=`${this._hashName}=${B}`);let F=window.location.hash.replace(S,"");F.startsWith("#&")?F=F.slice(0,1)+F.slice(2):F==="#"&&(F="");let H=window.location.href.replace(/(#.+)?$/,F);H=H.replace("&&","&"),window.history.replaceState(window.history.state,null,H)},this._updateHash=ua(this._updateHashUnthrottled,300),this._hashName=c&&encodeURIComponent(c)}addTo(c){return this._map=c,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(c){const y=this._map.getCenter(),B=Math.round(100*this._map.getZoom())/100,S=Math.ceil((B*Math.LN2+Math.log(512/360/.5))/Math.LN10),F=Math.pow(10,S),H=Math.round(y.lng*F)/F,j=Math.round(y.lat*F)/F,Z=this._map.getBearing(),se=this._map.getPitch();let he="";if(he+=c?`/${H}/${j}/${B}`:`${B}/${j}/${H}`,(Z||se)&&(he+="/"+Math.round(10*Z)/10),se&&(he+=`/${Math.round(se)}`),this._hashName){const ue=this._hashName;let Te=!1;const Fe=window.location.hash.slice(1).split("&").map(Ee=>{const Oe=Ee.split("=")[0];return Oe===ue?(Te=!0,`${Oe}=${he}`):Ee}).filter(Ee=>Ee);return Te||Fe.push(`${ue}=${he}`),`#${Fe.join("&")}`}return`#${he}`}}const ho={linearity:.3,easing:o.b8(0,0,.3,1)},Yo=o.e({deceleration:2500,maxSpeed:1400},ho),ls=o.e({deceleration:20,maxSpeed:1400},ho),ji=o.e({deceleration:1e3,maxSpeed:360},ho),Kn=o.e({deceleration:1e3,maxSpeed:90},ho);class Fs{constructor(c){this._map=c,this.clear()}clear(){this._inertiaBuffer=[]}record(c){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:x.now(),settings:c})}_drainInertiaBuffer(){const c=this._inertiaBuffer,y=x.now();for(;c.length>0&&y-c[0].time>160;)c.shift()}_onMoveEnd(c){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const y={zoom:0,bearing:0,pitch:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:F}of this._inertiaBuffer)y.zoom+=F.zoomDelta||0,y.bearing+=F.bearingDelta||0,y.pitch+=F.pitchDelta||0,F.panDelta&&y.pan._add(F.panDelta),F.around&&(y.around=F.around),F.pinchAround&&(y.pinchAround=F.pinchAround);const B=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,S={};if(y.pan.mag()){const F=Ja(y.pan.mag(),B,o.e({},Yo,c||{}));S.offset=y.pan.mult(F.amount/y.pan.mag()),S.center=this._map.transform.center,Xa(S,F)}if(y.zoom){const F=Ja(y.zoom,B,ls);S.zoom=this._map.transform.zoom+F.amount,Xa(S,F)}if(y.bearing){const F=Ja(y.bearing,B,ji);S.bearing=this._map.transform.bearing+o.ac(F.amount,-179,179),Xa(S,F)}if(y.pitch){const F=Ja(y.pitch,B,Kn);S.pitch=this._map.transform.pitch+F.amount,Xa(S,F)}if(S.zoom||S.bearing){const F=y.pinchAround===void 0?y.around:y.pinchAround;S.around=F?this._map.unproject(F):this._map.getCenter()}return this.clear(),o.e(S,{noMoveStart:!0})}}function Xa(E,c){(!E.duration||E.duration<c.duration)&&(E.duration=c.duration,E.easing=c.easing)}function Ja(E,c,y){const{maxSpeed:B,linearity:S,deceleration:F}=y,H=o.ac(E*S/(c/1e3),-B,B),j=Math.abs(H)/(F*S);return{easing:y.easing,duration:1e3*j,amount:H*(j/2)}}class xs extends o.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,y,B){let S=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const F=T.mousePos(y.getCanvas(),B),H=y.unproject(F);super(c,o.e({point:F,lngLat:H,originalEvent:B},S)),this._defaultPrevented=!1,this.target=y}}class vl extends o.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,y,B){const S=c==="touchend"?B.changedTouches:B.touches,F=T.touchPos(y.getCanvasContainer(),S),H=F.map(Z=>y.unproject(Z)),j=F.reduce((Z,se,he,ue)=>Z.add(se.div(ue.length)),new o.P(0,0));super(c,{points:F,point:j,lngLats:H,lngLat:y.unproject(j),originalEvent:B}),this._defaultPrevented=!1}}class vf extends o.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,y,B){super(c,{originalEvent:B}),this._defaultPrevented=!1}}class xd{constructor(c,y){this._map=c,this._clickTolerance=y.clickTolerance}reset(){delete this._mousedownPos}wheel(c){return this._firePreventable(new vf(c.type,this._map,c))}mousedown(c,y){return this._mousedownPos=y,this._firePreventable(new xs(c.type,this._map,c))}mouseup(c){this._map.fire(new xs(c.type,this._map,c))}click(c,y){this._mousedownPos&&this._mousedownPos.dist(y)>=this._clickTolerance||this._map.fire(new xs(c.type,this._map,c))}dblclick(c){return this._firePreventable(new xs(c.type,this._map,c))}mouseover(c){this._map.fire(new xs(c.type,this._map,c))}mouseout(c){this._map.fire(new xs(c.type,this._map,c))}touchstart(c){return this._firePreventable(new vl(c.type,this._map,c))}touchmove(c){this._map.fire(new vl(c.type,this._map,c))}touchend(c){this._map.fire(new vl(c.type,this._map,c))}touchcancel(c){this._map.fire(new vl(c.type,this._map,c))}_firePreventable(c){if(this._map.fire(c),c.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ns{constructor(c){this._map=c}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(c){this._map.fire(new xs(c.type,this._map,c))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new xs("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(c){this._delayContextMenu?this._contextMenuEvent=c:this._ignoreContextMenu||this._map.fire(new xs(c.type,this._map,c)),this._map.listens("contextmenu")&&c.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ha{constructor(c){this._map=c}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(c){return this.transform.pointLocation(o.P.convert(c),this._map.terrain)}}class ko{constructor(c,y){this._map=c,this._tr=new ha(c),this._el=c.getCanvasContainer(),this._container=c.getContainer(),this._clickTolerance=y.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(c,y){this.isEnabled()&&c.shiftKey&&c.button===0&&(T.disableDrag(),this._startPos=this._lastPos=y,this._active=!0)}mousemoveWindow(c,y){if(!this._active)return;const B=y;if(this._lastPos.equals(B)||!this._box&&B.dist(this._startPos)<this._clickTolerance)return;const S=this._startPos;this._lastPos=B,this._box||(this._box=T.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",c));const F=Math.min(S.x,B.x),H=Math.max(S.x,B.x),j=Math.min(S.y,B.y),Z=Math.max(S.y,B.y);T.setTransform(this._box,`translate(${F}px,${j}px)`),this._box.style.width=H-F+"px",this._box.style.height=Z-j+"px"}mouseupWindow(c,y){if(!this._active||c.button!==0)return;const B=this._startPos,S=y;if(this.reset(),T.suppressClick(),B.x!==S.x||B.y!==S.y)return this._map.fire(new o.k("boxzoomend",{originalEvent:c})),{cameraAnimation:F=>F.fitScreenCoordinates(B,S,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",c)}keydown(c){this._active&&c.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",c))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(T.remove(this._box),this._box=null),T.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(c,y){return this._map.fire(new o.k(c,{originalEvent:y}))}}function Nc(E,c){if(E.length!==c.length)throw new Error(`The number of touches and points are not equal - touches ${E.length}, points ${c.length}`);const y={};for(let B=0;B<E.length;B++)y[E[B].identifier]=c[B];return y}class gc{constructor(c){this.reset(),this.numTouches=c.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(c,y,B){(this.centroid||B.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=c.timeStamp),B.length===this.numTouches&&(this.centroid=function(S){const F=new o.P(0,0);for(const H of S)F._add(H);return F.div(S.length)}(y),this.touches=Nc(B,y)))}touchmove(c,y,B){if(this.aborted||!this.centroid)return;const S=Nc(B,y);for(const F in this.touches){const H=S[F];(!H||H.dist(this.touches[F])>30)&&(this.aborted=!0)}}touchend(c,y,B){if((!this.centroid||c.timeStamp-this.startTime>500)&&(this.aborted=!0),B.length===0){const S=!this.aborted&&this.centroid;if(this.reset(),S)return S}}}class mc{constructor(c){this.singleTap=new gc(c),this.numTaps=c.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(c,y,B){this.singleTap.touchstart(c,y,B)}touchmove(c,y,B){this.singleTap.touchmove(c,y,B)}touchend(c,y,B){const S=this.singleTap.touchend(c,y,B);if(S){const F=c.timeStamp-this.lastTime<500,H=!this.lastTap||this.lastTap.dist(S)<30;if(F&&H||this.reset(),this.count++,this.lastTime=c.timeStamp,this.lastTap=S,this.count===this.numTaps)return this.reset(),S}}}class mo{constructor(c){this._tr=new ha(c),this._zoomIn=new mc({numTouches:1,numTaps:2}),this._zoomOut=new mc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(c,y,B){this._zoomIn.touchstart(c,y,B),this._zoomOut.touchstart(c,y,B)}touchmove(c,y,B){this._zoomIn.touchmove(c,y,B),this._zoomOut.touchmove(c,y,B)}touchend(c,y,B){const S=this._zoomIn.touchend(c,y,B),F=this._zoomOut.touchend(c,y,B),H=this._tr;return S?(this._active=!0,c.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:j=>j.easeTo({duration:300,zoom:H.zoom+1,around:H.unproject(S)},{originalEvent:c})}):F?(this._active=!0,c.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:j=>j.easeTo({duration:300,zoom:H.zoom-1,around:H.unproject(F)},{originalEvent:c})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class zs{constructor(c){this._enabled=!!c.enable,this._moveStateManager=c.moveStateManager,this._clickTolerance=c.clickTolerance||1,this._moveFunction=c.move,this._activateOnStart=!!c.activateOnStart,c.assignEvents(this),this.reset()}reset(c){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(c)}_move(){const c=this._moveFunction(...arguments);if(c.bearingDelta||c.pitchDelta||c.around||c.panDelta)return this._active=!0,c}dragStart(c,y){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(c)&&(this._moveStateManager.startMove(c),this._lastPoint=y.length?y[0]:y,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(c,y){if(!this.isEnabled())return;const B=this._lastPoint;if(!B)return;if(c.preventDefault(),!this._moveStateManager.isValidMoveEvent(c))return void this.reset(c);const S=y.length?y[0]:y;return!this._moved&&S.dist(B)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=S,this._move(B,S))}dragEnd(c){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(c)&&(this._moved&&T.suppressClick(),this.reset(c))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const zc={0:1,2:2};class Hc{constructor(c){this._correctEvent=c.checkCorrectEvent}startMove(c){const y=T.mouseButton(c);this._eventButton=y}endMove(c){delete this._eventButton}isValidStartEvent(c){return this._correctEvent(c)}isValidMoveEvent(c){return!function(y,B){const S=zc[B];return y.buttons===void 0||(y.buttons&S)!==S}(c,this._eventButton)}isValidEndEvent(c){return T.mouseButton(c)===this._eventButton}}class wd{constructor(){this._firstTouch=void 0}_isOneFingerTouch(c){return c.targetTouches.length===1}_isSameTouchEvent(c){return c.targetTouches[0].identifier===this._firstTouch}startMove(c){this._firstTouch=c.targetTouches[0].identifier}endMove(c){delete this._firstTouch}isValidStartEvent(c){return this._isOneFingerTouch(c)}isValidMoveEvent(c){return this._isOneFingerTouch(c)&&this._isSameTouchEvent(c)}isValidEndEvent(c){return this._isOneFingerTouch(c)&&this._isSameTouchEvent(c)}}const _c=E=>{E.mousedown=E.dragStart,E.mousemoveWindow=E.dragMove,E.mouseup=E.dragEnd,E.contextmenu=c=>{c.preventDefault()}},zu=E=>{let{enable:c,clickTolerance:y,bearingDegreesPerPixelMoved:B=.8}=E;const S=new Hc({checkCorrectEvent:F=>T.mouseButton(F)===0&&F.ctrlKey||T.mouseButton(F)===2});return new zs({clickTolerance:y,move:(F,H)=>({bearingDelta:(H.x-F.x)*B}),moveStateManager:S,enable:c,assignEvents:_c})},ph=E=>{let{enable:c,clickTolerance:y,pitchDegreesPerPixelMoved:B=-.5}=E;const S=new Hc({checkCorrectEvent:F=>T.mouseButton(F)===0&&F.ctrlKey||T.mouseButton(F)===2});return new zs({clickTolerance:y,move:(F,H)=>({pitchDelta:(H.y-F.y)*B}),moveStateManager:S,enable:c,assignEvents:_c})};class Gl{constructor(c,y){this._clickTolerance=c.clickTolerance||1,this._map=y,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0)}_shouldBePrevented(c){return c<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(c,y,B){return this._calculateTransform(c,y,B)}touchmove(c,y,B){if(this._active){if(!this._shouldBePrevented(B.length))return c.preventDefault(),this._calculateTransform(c,y,B);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",c)}}touchend(c,y,B){this._calculateTransform(c,y,B),this._active&&this._shouldBePrevented(B.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(c,y,B){B.length>0&&(this._active=!0);const S=Nc(B,y),F=new o.P(0,0),H=new o.P(0,0);let j=0;for(const se in S){const he=S[se],ue=this._touches[se];ue&&(F._add(he),H._add(he.sub(ue)),j++,S[se]=he)}if(this._touches=S,this._shouldBePrevented(j)||!H.mag())return;const Z=H.div(j);return this._sum._add(Z),this._sum.mag()<this._clickTolerance?void 0:{around:F.div(j),panDelta:Z}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Vc{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(c,y,B){this._firstTwoTouches||B.length<2||(this._firstTwoTouches=[B[0].identifier,B[1].identifier],this._start([y[0],y[1]]))}touchmove(c,y,B){if(!this._firstTwoTouches)return;c.preventDefault();const[S,F]=this._firstTwoTouches,H=Gc(B,y,S),j=Gc(B,y,F);if(!H||!j)return;const Z=this._aroundCenter?null:H.add(j).div(2);return this._move([H,j],Z,c)}touchend(c,y,B){if(!this._firstTwoTouches)return;const[S,F]=this._firstTwoTouches,H=Gc(B,y,S),j=Gc(B,y,F);H&&j||(this._active&&T.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(c){this._enabled=!0,this._aroundCenter=!!c&&c.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Gc(E,c,y){for(let B=0;B<E.length;B++)if(E[B].identifier===y)return c[B]}function _u(E,c){return Math.log(E/c)/Math.LN2}class Qc extends Vc{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(c){this._startDistance=this._distance=c[0].dist(c[1])}_move(c,y){const B=this._distance;if(this._distance=c[0].dist(c[1]),this._active||!(Math.abs(_u(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:_u(this._distance,B),pinchAround:y}}}function Hu(E,c){return 180*E.angleWith(c)/Math.PI}class zh extends Vc{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(c){this._startVector=this._vector=c[0].sub(c[1]),this._minDiameter=c[0].dist(c[1])}_move(c,y,B){const S=this._vector;if(this._vector=c[0].sub(c[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Hu(this._vector,S),pinchAround:y}}_isBelowThreshold(c){this._minDiameter=Math.min(this._minDiameter,c.mag());const y=25/(Math.PI*this._minDiameter)*360,B=Hu(c,this._startVector);return Math.abs(B)<y}}function yu(E){return Math.abs(E.y)>Math.abs(E.x)}class Qi extends Vc{constructor(c){super(),this._currentTouchCount=0,this._map=c}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(c,y,B){super.touchstart(c,y,B),this._currentTouchCount=B.length}_start(c){this._lastPoints=c,yu(c[0].sub(c[1]))&&(this._valid=!1)}_move(c,y,B){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const S=c[0].sub(this._lastPoints[0]),F=c[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(S,F,B.timeStamp),this._valid?(this._lastPoints=c,this._active=!0,{pitchDelta:(S.y+F.y)/2*-.5}):void 0}gestureBeginsVertically(c,y,B){if(this._valid!==void 0)return this._valid;const S=c.mag()>=2,F=y.mag()>=2;if(!S&&!F)return;if(!S||!F)return this._firstMove===void 0&&(this._firstMove=B),B-this._firstMove<100&&void 0;const H=c.y>0==y.y>0;return yu(c)&&yu(y)&&H}}const bu={panStep:100,bearingStep:15,pitchStep:10};class Hs{constructor(c){this._tr=new ha(c);const y=bu;this._panStep=y.panStep,this._bearingStep=y.bearingStep,this._pitchStep=y.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(c){if(c.altKey||c.ctrlKey||c.metaKey)return;let y=0,B=0,S=0,F=0,H=0;switch(c.keyCode){case 61:case 107:case 171:case 187:y=1;break;case 189:case 109:case 173:y=-1;break;case 37:c.shiftKey?B=-1:(c.preventDefault(),F=-1);break;case 39:c.shiftKey?B=1:(c.preventDefault(),F=1);break;case 38:c.shiftKey?S=1:(c.preventDefault(),H=-1);break;case 40:c.shiftKey?S=-1:(c.preventDefault(),H=1);break;default:return}return this._rotationDisabled&&(B=0,S=0),{cameraAnimation:j=>{const Z=this._tr;j.easeTo({duration:300,easeId:"keyboardHandler",easing:xl,zoom:y?Math.round(Z.zoom)+y*(c.shiftKey?2:1):Z.zoom,bearing:Z.bearing+B*this._bearingStep,pitch:Z.pitch+S*this._pitchStep,offset:[-F*this._panStep,-H*this._panStep],center:Z.center},{originalEvent:c})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function xl(E){return E*(2-E)}const Hh=4.000244140625;class Sa{constructor(c,y){this._onTimeout=B=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(B)},this._map=c,this._tr=new ha(c),this._triggerRenderFrame=y,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(c){this._defaultZoomRate=c}setWheelZoomRate(c){this._wheelZoomRate=c}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(c){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!c&&c.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(c){return!!this._map.cooperativeGestures.isEnabled()&&!(c.ctrlKey||this._map.cooperativeGestures.isBypassed(c))}wheel(c){if(!this.isEnabled())return;if(this._shouldBePrevented(c))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",c);let y=c.deltaMode===WheelEvent.DOM_DELTA_LINE?40*c.deltaY:c.deltaY;const B=x.now(),S=B-(this._lastWheelEventTime||0);this._lastWheelEventTime=B,y!==0&&y%Hh==0?this._type="wheel":y!==0&&Math.abs(y)<4?this._type="trackpad":S>400?(this._type=null,this._lastValue=y,this._timeout=setTimeout(this._onTimeout,40,c)):this._type||(this._type=Math.abs(S*y)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,y+=this._lastValue)),c.shiftKey&&y&&(y/=4),this._type&&(this._lastWheelEvent=c,this._delta-=y,this._active||this._start(c)),c.preventDefault()}_start(c){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const y=T.mousePos(this._map.getCanvas(),c),B=this._tr;this._around=y.y>B.transform.height/2-B.transform.getHorizon()?o.N.convert(this._aroundCenter?B.center:B.unproject(y)):o.N.convert(B.center),this._aroundPoint=B.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const c=this._tr.transform;if(this._delta!==0){const Z=this._type==="wheel"&&Math.abs(this._delta)>Hh?this._wheelZoomRate:this._defaultZoomRate;let se=2/(1+Math.exp(-Math.abs(this._delta*Z)));this._delta<0&&se!==0&&(se=1/se);const he=typeof this._targetZoom=="number"?c.zoomScale(this._targetZoom):c.scale;this._targetZoom=Math.min(c.maxZoom,Math.max(c.minZoom,c.scaleZoom(he*se))),this._type==="wheel"&&(this._startZoom=c.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const y=typeof this._targetZoom=="number"?this._targetZoom:c.zoom,B=this._startZoom,S=this._easing;let F,H=!1;const j=x.now()-this._lastWheelEventTime;if(this._type==="wheel"&&B&&S&&j){const Z=Math.min(j/200,1),se=S(Z);F=o.y.number(B,y,se),Z<1?this._frameId||(this._frameId=!0):H=!0}else F=y,H=!0;return this._active=!0,H&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!H,zoomDelta:F-c.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(c){let y=o.b9;if(this._prevEase){const B=this._prevEase,S=(x.now()-B.start)/B.duration,F=B.easing(S+.01)-B.easing(S),H=.27/Math.sqrt(F*F+1e-4)*.01,j=Math.sqrt(.0729-H*H);y=o.b8(H,j,.25,1)}return this._prevEase={start:x.now(),duration:c,easing:y},y}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Ia{constructor(c,y){this._clickZoom=c,this._tapZoom=y}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class yc{constructor(c){this._tr=new ha(c),this.reset()}reset(){this._active=!1}dblclick(c,y){return c.preventDefault(),{cameraAnimation:B=>{B.easeTo({duration:300,zoom:this._tr.zoom+(c.shiftKey?-1:1),around:this._tr.unproject(y)},{originalEvent:c})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Bd{constructor(){this._tap=new mc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(c,y,B){if(!this._swipePoint)if(this._tapTime){const S=y[0],F=c.timeStamp-this._tapTime<500,H=this._tapPoint.dist(S)<30;F&&H?B.length>0&&(this._swipePoint=S,this._swipeTouch=B[0].identifier):this.reset()}else this._tap.touchstart(c,y,B)}touchmove(c,y,B){if(this._tapTime){if(this._swipePoint){if(B[0].identifier!==this._swipeTouch)return;const S=y[0],F=S.y-this._swipePoint.y;return this._swipePoint=S,c.preventDefault(),this._active=!0,{zoomDelta:F/128}}}else this._tap.touchmove(c,y,B)}touchend(c,y,B){if(this._tapTime)this._swipePoint&&B.length===0&&this.reset();else{const S=this._tap.touchend(c,y,B);S&&(this._tapTime=c.timeStamp,this._tapPoint=S)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class gh{constructor(c,y,B){this._el=c,this._mousePan=y,this._touchPan=B}enable(c){this._inertiaOptions=c||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Cd{constructor(c,y,B){this._pitchWithRotate=c.pitchWithRotate,this._mouseRotate=y,this._mousePitch=B}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Vh{constructor(c,y,B,S){this._el=c,this._touchZoom=y,this._touchRotate=B,this._tapDragZoom=S,this._rotationDisabled=!1,this._enabled=!0}enable(c){this._touchZoom.enable(c),this._rotationDisabled||this._touchRotate.enable(c),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class vu{constructor(c,y){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=c,this._options=y,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const c=this._map.getCanvasContainer();c.classList.add("maplibregl-cooperative-gestures"),this._container=T.create("div","maplibregl-cooperative-gesture-screen",c);let y=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(y=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const B=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),S=document.createElement("div");S.className="maplibregl-desktop-message",S.textContent=y,this._container.appendChild(S);const F=document.createElement("div");F.className="maplibregl-mobile-message",F.textContent=B,this._container.appendChild(F),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(T.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(c){return c[this._bypassKey]}notifyGestureBlocked(c,y){this._enabled&&(this._map.fire(new o.k("cooperativegestureprevented",{gestureType:c,originalEvent:y})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const Za=E=>E.zoom||E.drag||E.pitch||E.rotate;class pn extends o.k{}function Ya(E){return E.panDelta&&E.panDelta.mag()||E.zoomDelta||E.bearingDelta||E.pitchDelta}class To{constructor(c,y){this.handleWindowEvent=S=>{this.handleEvent(S,`${S.type}Window`)},this.handleEvent=(S,F)=>{if(S.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const H=S.type==="renderFrame"?void 0:S,j={needsRenderFrame:!1},Z={},se={},he=S.touches,ue=he?this._getMapTouches(he):void 0,Te=ue?T.touchPos(this._map.getCanvas(),ue):T.mousePos(this._map.getCanvas(),S);for(const{handlerName:Oe,handler:rt,allowed:qe}of this._handlers){if(!rt.isEnabled())continue;let Ze;this._blockedByActive(se,qe,Oe)?rt.reset():rt[F||S.type]&&(Ze=rt[F||S.type](S,Te,ue),this.mergeHandlerResult(j,Z,Ze,Oe,H),Ze&&Ze.needsRenderFrame&&this._triggerRenderFrame()),(Ze||rt.isActive())&&(se[Oe]=rt)}const Fe={};for(const Oe in this._previousActiveHandlers)se[Oe]||(Fe[Oe]=H);this._previousActiveHandlers=se,(Object.keys(Fe).length||Ya(j))&&(this._changes.push([j,Z,Fe]),this._triggerRenderFrame()),(Object.keys(se).length||Ya(j))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:Ee}=j;Ee&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Ee(this._map))},this._map=c,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Fs(c),this._bearingSnap=y.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(y);const B=this._el;this._listeners=[[B,"touchstart",{passive:!0}],[B,"touchmove",{passive:!1}],[B,"touchend",void 0],[B,"touchcancel",void 0],[B,"mousedown",void 0],[B,"mousemove",void 0],[B,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[B,"mouseover",void 0],[B,"mouseout",void 0],[B,"dblclick",void 0],[B,"click",void 0],[B,"keydown",{capture:!1}],[B,"keyup",void 0],[B,"wheel",{passive:!1}],[B,"contextmenu",void 0],[window,"blur",void 0]];for(const[S,F,H]of this._listeners)T.addEventListener(S,F,S===document?this.handleWindowEvent:this.handleEvent,H)}destroy(){for(const[c,y,B]of this._listeners)T.removeEventListener(c,y,c===document?this.handleWindowEvent:this.handleEvent,B)}_addDefaultHandlers(c){const y=this._map,B=y.getCanvasContainer();this._add("mapEvent",new xd(y,c));const S=y.boxZoom=new ko(y,c);this._add("boxZoom",S),c.interactive&&c.boxZoom&&S.enable();const F=y.cooperativeGestures=new vu(y,c.cooperativeGestures);this._add("cooperativeGestures",F),c.cooperativeGestures&&F.enable();const H=new mo(y),j=new yc(y);y.doubleClickZoom=new Ia(j,H),this._add("tapZoom",H),this._add("clickZoom",j),c.interactive&&c.doubleClickZoom&&y.doubleClickZoom.enable();const Z=new Bd;this._add("tapDragZoom",Z);const se=y.touchPitch=new Qi(y);this._add("touchPitch",se),c.interactive&&c.touchPitch&&y.touchPitch.enable(c.touchPitch);const he=zu(c),ue=ph(c);y.dragRotate=new Cd(c,he,ue),this._add("mouseRotate",he,["mousePitch"]),this._add("mousePitch",ue,["mouseRotate"]),c.interactive&&c.dragRotate&&y.dragRotate.enable();const Te=(Ze=>{let{enable:ot,clickTolerance:vt}=Ze;const kt=new Hc({checkCorrectEvent:It=>T.mouseButton(It)===0&&!It.ctrlKey});return new zs({clickTolerance:vt,move:(It,ur)=>({around:ur,panDelta:ur.sub(It)}),activateOnStart:!0,moveStateManager:kt,enable:ot,assignEvents:_c})})(c),Fe=new Gl(c,y);y.dragPan=new gh(B,Te,Fe),this._add("mousePan",Te),this._add("touchPan",Fe,["touchZoom","touchRotate"]),c.interactive&&c.dragPan&&y.dragPan.enable(c.dragPan);const Ee=new zh,Oe=new Qc;y.touchZoomRotate=new Vh(B,Oe,Ee,Z),this._add("touchRotate",Ee,["touchPan","touchZoom"]),this._add("touchZoom",Oe,["touchPan","touchRotate"]),c.interactive&&c.touchZoomRotate&&y.touchZoomRotate.enable(c.touchZoomRotate);const rt=y.scrollZoom=new Sa(y,()=>this._triggerRenderFrame());this._add("scrollZoom",rt,["mousePan"]),c.interactive&&c.scrollZoom&&y.scrollZoom.enable(c.scrollZoom);const qe=y.keyboard=new Hs(y);this._add("keyboard",qe),c.interactive&&c.keyboard&&y.keyboard.enable(),this._add("blockableMapEvent",new Ns(y))}_add(c,y,B){this._handlers.push({handlerName:c,handler:y,allowed:B}),this._handlersById[c]=y}stop(c){if(!this._updatingCamera){for(const{handler:y}of this._handlers)y.reset();this._inertia.clear(),this._fireEvents({},{},c),this._changes=[]}}isActive(){for(const{handler:c}of this._handlers)if(c.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Za(this._eventsInProgress)||this.isZooming()}_blockedByActive(c,y,B){for(const S in c)if(S!==B&&(!y||y.indexOf(S)<0))return!0;return!1}_getMapTouches(c){const y=[];for(const B of c)this._el.contains(B.target)&&y.push(B);return y}mergeHandlerResult(c,y,B,S,F){if(!B)return;o.e(c,B);const H={handlerName:S,originalEvent:B.originalEvent||F};B.zoomDelta!==void 0&&(y.zoom=H),B.panDelta!==void 0&&(y.drag=H),B.pitchDelta!==void 0&&(y.pitch=H),B.bearingDelta!==void 0&&(y.rotate=H)}_applyChanges(){const c={},y={},B={};for(const[S,F,H]of this._changes)S.panDelta&&(c.panDelta=(c.panDelta||new o.P(0,0))._add(S.panDelta)),S.zoomDelta&&(c.zoomDelta=(c.zoomDelta||0)+S.zoomDelta),S.bearingDelta&&(c.bearingDelta=(c.bearingDelta||0)+S.bearingDelta),S.pitchDelta&&(c.pitchDelta=(c.pitchDelta||0)+S.pitchDelta),S.around!==void 0&&(c.around=S.around),S.pinchAround!==void 0&&(c.pinchAround=S.pinchAround),S.noInertia&&(c.noInertia=S.noInertia),o.e(y,F),o.e(B,H);this._updateMapTransform(c,y,B),this._changes=[]}_updateMapTransform(c,y,B){const S=this._map,F=S._getTransformForUpdate(),H=S.terrain;if(!(Ya(c)||H&&this._terrainMovement))return this._fireEvents(y,B,!0);let{panDelta:j,zoomDelta:Z,bearingDelta:se,pitchDelta:he,around:ue,pinchAround:Te}=c;Te!==void 0&&(ue=Te),S._stop(!0),ue=ue||S.transform.centerPoint;const Fe=F.pointLocation(j?ue.sub(j):ue);se&&(F.bearing+=se),he&&(F.pitch+=he),Z&&(F.zoom+=Z),H?this._terrainMovement||!y.drag&&!y.zoom?y.drag&&this._terrainMovement?F.center=F.pointLocation(F.centerPoint.sub(j)):F.setLocationAtPoint(Fe,ue):(this._terrainMovement=!0,this._map._elevationFreeze=!0,F.setLocationAtPoint(Fe,ue)):F.setLocationAtPoint(Fe,ue),S._applyUpdatedTransform(F),this._map._update(),c.noInertia||this._inertia.record(c),this._fireEvents(y,B,!0)}_fireEvents(c,y,B){const S=Za(this._eventsInProgress),F=Za(c),H={};for(const ue in c){const{originalEvent:Te}=c[ue];this._eventsInProgress[ue]||(H[`${ue}start`]=Te),this._eventsInProgress[ue]=c[ue]}!S&&F&&this._fireEvent("movestart",F.originalEvent);for(const ue in H)this._fireEvent(ue,H[ue]);F&&this._fireEvent("move",F.originalEvent);for(const ue in c){const{originalEvent:Te}=c[ue];this._fireEvent(ue,Te)}const j={};let Z;for(const ue in this._eventsInProgress){const{handlerName:Te,originalEvent:Fe}=this._eventsInProgress[ue];this._handlersById[Te].isActive()||(delete this._eventsInProgress[ue],Z=y[Te]||Fe,j[`${ue}end`]=Z)}for(const ue in j)this._fireEvent(ue,j[ue]);const se=Za(this._eventsInProgress),he=(S||F)&&!se;if(he&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const ue=this._map._getTransformForUpdate();ue.recalculateZoom(this._map.terrain),this._map._applyUpdatedTransform(ue)}if(B&&he){this._updatingCamera=!0;const ue=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Te=Fe=>Fe!==0&&-this._bearingSnap<Fe&&Fe<this._bearingSnap;!ue||!ue.essential&&x.prefersReducedMotion?(this._map.fire(new o.k("moveend",{originalEvent:Z})),Te(this._map.getBearing())&&this._map.resetNorth()):(Te(ue.bearing||this._map.getBearing())&&(ue.bearing=0),ue.freezeElevation=!0,this._map.easeTo(ue,{originalEvent:Z})),this._updatingCamera=!1}}_fireEvent(c,y){this._map.fire(new o.k(c,y?{originalEvent:y}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(c=>{delete this._frameId,this.handleEvent(new pn("renderFrame",{timeStamp:c})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Ql extends o.E{constructor(c,y){super(),this._renderFrameCallback=()=>{const B=Math.min((x.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(B)),B<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=c,this._bearingSnap=y.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new o.N(this.transform.center.lng,this.transform.center.lat)}setCenter(c,y){return this.jumpTo({center:c},y)}panBy(c,y,B){return c=o.P.convert(c).mult(-1),this.panTo(this.transform.center,o.e({offset:c},y),B)}panTo(c,y,B){return this.easeTo(o.e({center:c},y),B)}getZoom(){return this.transform.zoom}setZoom(c,y){return this.jumpTo({zoom:c},y),this}zoomTo(c,y,B){return this.easeTo(o.e({zoom:c},y),B)}zoomIn(c,y){return this.zoomTo(this.getZoom()+1,c,y),this}zoomOut(c,y){return this.zoomTo(this.getZoom()-1,c,y),this}getBearing(){return this.transform.bearing}setBearing(c,y){return this.jumpTo({bearing:c},y),this}getPadding(){return this.transform.padding}setPadding(c,y){return this.jumpTo({padding:c},y),this}rotateTo(c,y,B){return this.easeTo(o.e({bearing:c},y),B)}resetNorth(c,y){return this.rotateTo(0,o.e({duration:1e3},c),y),this}resetNorthPitch(c,y){return this.easeTo(o.e({bearing:0,pitch:0,duration:1e3},c),y),this}snapToNorth(c,y){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(c,y):this}getPitch(){return this.transform.pitch}setPitch(c,y){return this.jumpTo({pitch:c},y),this}cameraForBounds(c,y){c=We.convert(c).adjustAntiMeridian();const B=y&&y.bearing||0;return this._cameraForBoxAndBearing(c.getNorthWest(),c.getSouthEast(),B,y)}_cameraForBoxAndBearing(c,y,B,S){const F={top:0,bottom:0,right:0,left:0};if(typeof(S=o.e({padding:F,offset:[0,0],maxZoom:this.transform.maxZoom},S)).padding=="number"){const _r=S.padding;S.padding={top:_r,bottom:_r,right:_r,left:_r}}S.padding=o.e(F,S.padding);const H=this.transform,j=H.padding,Z=new We(c,y),se=H.project(Z.getNorthWest()),he=H.project(Z.getNorthEast()),ue=H.project(Z.getSouthEast()),Te=H.project(Z.getSouthWest()),Fe=o.ba(-B),Ee=se.rotate(Fe),Oe=he.rotate(Fe),rt=ue.rotate(Fe),qe=Te.rotate(Fe),Ze=new o.P(Math.max(Ee.x,Oe.x,qe.x,rt.x),Math.max(Ee.y,Oe.y,qe.y,rt.y)),ot=new o.P(Math.min(Ee.x,Oe.x,qe.x,rt.x),Math.min(Ee.y,Oe.y,qe.y,rt.y)),vt=Ze.sub(ot),kt=(H.width-(j.left+j.right+S.padding.left+S.padding.right))/vt.x,It=(H.height-(j.top+j.bottom+S.padding.top+S.padding.bottom))/vt.y;if(It<0||kt<0)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const ur=Math.min(H.scaleZoom(H.scale*Math.min(kt,It)),S.maxZoom),wr=o.P.convert(S.offset),Dr=new o.P((S.padding.left-S.padding.right)/2,(S.padding.top-S.padding.bottom)/2).rotate(o.ba(B)),Or=wr.add(Dr).mult(H.scale/H.zoomScale(ur));return{center:H.unproject(se.add(ue).div(2).sub(Or)),zoom:ur,bearing:B}}fitBounds(c,y,B){return this._fitInternal(this.cameraForBounds(c,y),y,B)}fitScreenCoordinates(c,y,B,S,F){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(o.P.convert(c)),this.transform.pointLocation(o.P.convert(y)),B,S),S,F)}_fitInternal(c,y,B){return c?(delete(y=o.e(c,y)).padding,y.linear?this.easeTo(y,B):this.flyTo(y,B)):this}jumpTo(c,y){this.stop();const B=this._getTransformForUpdate();let S=!1,F=!1,H=!1;return"zoom"in c&&B.zoom!==+c.zoom&&(S=!0,B.zoom=+c.zoom),c.center!==void 0&&(B.center=o.N.convert(c.center)),"bearing"in c&&B.bearing!==+c.bearing&&(F=!0,B.bearing=+c.bearing),"pitch"in c&&B.pitch!==+c.pitch&&(H=!0,B.pitch=+c.pitch),c.padding==null||B.isPaddingEqual(c.padding)||(B.padding=c.padding),this._applyUpdatedTransform(B),this.fire(new o.k("movestart",y)).fire(new o.k("move",y)),S&&this.fire(new o.k("zoomstart",y)).fire(new o.k("zoom",y)).fire(new o.k("zoomend",y)),F&&this.fire(new o.k("rotatestart",y)).fire(new o.k("rotate",y)).fire(new o.k("rotateend",y)),H&&this.fire(new o.k("pitchstart",y)).fire(new o.k("pitch",y)).fire(new o.k("pitchend",y)),this.fire(new o.k("moveend",y))}calculateCameraOptionsFromTo(c,y,B){let S=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;const F=o.Z.fromLngLat(c,y),H=o.Z.fromLngLat(B,S),j=H.x-F.x,Z=H.y-F.y,se=H.z-F.z,he=Math.hypot(j,Z,se);if(he===0)throw new Error("Can't calculate camera options with same From and To");const ue=Math.hypot(j,Z),Te=this.transform.scaleZoom(this.transform.cameraToCenterDistance/he/this.transform.tileSize),Fe=180*Math.atan2(j,-Z)/Math.PI;let Ee=180*Math.acos(ue/he)/Math.PI;return Ee=se<0?90-Ee:90+Ee,{center:H.toLngLat(),zoom:Te,pitch:Ee,bearing:Fe}}easeTo(c,y){var B;this._stop(!1,c.easeId),((c=o.e({offset:[0,0],duration:500,easing:o.b9},c)).animate===!1||!c.essential&&x.prefersReducedMotion)&&(c.duration=0);const S=this._getTransformForUpdate(),F=S.zoom,H=S.bearing,j=S.pitch,Z=S.padding,se="bearing"in c?this._normalizeBearing(c.bearing,H):H,he="pitch"in c?+c.pitch:j,ue="padding"in c?c.padding:S.padding,Te=o.P.convert(c.offset);let Fe=S.centerPoint.add(Te);const Ee=S.pointLocation(Fe),{center:Oe,zoom:rt}=S.getConstrained(o.N.convert(c.center||Ee),(B=c.zoom)!==null&&B!==void 0?B:F);this._normalizeCenter(Oe,S);const qe=S.project(Ee),Ze=S.project(Oe).sub(qe),ot=S.zoomScale(rt-F);let vt,kt;c.around&&(vt=o.N.convert(c.around),kt=S.locationPoint(vt));const It={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||rt!==F,this._rotating=this._rotating||H!==se,this._pitching=this._pitching||he!==j,this._padding=!S.isPaddingEqual(ue),this._easeId=c.easeId,this._prepareEase(y,c.noMoveStart,It),this.terrain&&this._prepareElevation(Oe),this._ease(ur=>{if(this._zooming&&(S.zoom=o.y.number(F,rt,ur)),this._rotating&&(S.bearing=o.y.number(H,se,ur)),this._pitching&&(S.pitch=o.y.number(j,he,ur)),this._padding&&(S.interpolatePadding(Z,ue,ur),Fe=S.centerPoint.add(Te)),this.terrain&&!c.freezeElevation&&this._updateElevation(ur),vt)S.setLocationAtPoint(vt,kt);else{const wr=S.zoomScale(S.zoom-F),Dr=rt>F?Math.min(2,ot):Math.max(.5,ot),Or=Math.pow(Dr,1-ur),_r=S.unproject(qe.add(Ze.mult(ur*Or)).mult(wr));S.setLocationAtPoint(S.renderWorldCopies?_r.wrap():_r,Fe)}this._applyUpdatedTransform(S),this._fireMoveEvents(y)},ur=>{this.terrain&&c.freezeElevation&&this._finalizeElevation(),this._afterEase(y,ur)},c),this}_prepareEase(c,y){let B=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this._moving=!0,y||B.moving||this.fire(new o.k("movestart",c)),this._zooming&&!B.zooming&&this.fire(new o.k("zoomstart",c)),this._rotating&&!B.rotating&&this.fire(new o.k("rotatestart",c)),this._pitching&&!B.pitching&&this.fire(new o.k("pitchstart",c))}_prepareElevation(c){this._elevationCenter=c,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(c,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(c){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const y=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(c<1&&y!==this._elevationTarget){const B=this._elevationTarget-this._elevationStart;this._elevationStart+=c*(B-(y-(B*c+this._elevationStart))/(1-c)),this._elevationTarget=y}this.transform.elevation=o.y.number(this._elevationStart,this._elevationTarget,c)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(c){const y=c.getCameraPosition(),B=this.terrain.getElevationForLngLatZoom(y.lngLat,c.zoom);if(y.altitude<B){const S=this.calculateCameraOptionsFromTo(y.lngLat,B,c.center,c.elevation);return{pitch:S.pitch,zoom:S.zoom}}return{}}_applyUpdatedTransform(c){const y=[];if(this.terrain&&y.push(S=>this._elevateCameraIfInsideTerrain(S)),this.transformCameraUpdate&&y.push(S=>this.transformCameraUpdate(S)),!y.length)return;const B=c.clone();for(const S of y){const F=B.clone(),{center:H,zoom:j,pitch:Z,bearing:se,elevation:he}=S(F);H&&(F.center=H),j!==void 0&&(F.zoom=j),Z!==void 0&&(F.pitch=Z),se!==void 0&&(F.bearing=se),he!==void 0&&(F.elevation=he),B.apply(F)}this.transform.apply(B)}_fireMoveEvents(c){this.fire(new o.k("move",c)),this._zooming&&this.fire(new o.k("zoom",c)),this._rotating&&this.fire(new o.k("rotate",c)),this._pitching&&this.fire(new o.k("pitch",c))}_afterEase(c,y){if(this._easeId&&y&&this._easeId===y)return;delete this._easeId;const B=this._zooming,S=this._rotating,F=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,B&&this.fire(new o.k("zoomend",c)),S&&this.fire(new o.k("rotateend",c)),F&&this.fire(new o.k("pitchend",c)),this.fire(new o.k("moveend",c))}flyTo(c,y){var B;if(!c.essential&&x.prefersReducedMotion){const jr=o.M(c,["center","zoom","bearing","pitch","around"]);return this.jumpTo(jr,y)}this.stop(),c=o.e({offset:[0,0],speed:1.2,curve:1.42,easing:o.b9},c);const S=this._getTransformForUpdate(),F=S.zoom,H=S.bearing,j=S.pitch,Z=S.padding,se="bearing"in c?this._normalizeBearing(c.bearing,H):H,he="pitch"in c?+c.pitch:j,ue="padding"in c?c.padding:S.padding,Te=o.P.convert(c.offset);let Fe=S.centerPoint.add(Te);const Ee=S.pointLocation(Fe),{center:Oe,zoom:rt}=S.getConstrained(o.N.convert(c.center||Ee),(B=c.zoom)!==null&&B!==void 0?B:F);this._normalizeCenter(Oe,S);const qe=S.zoomScale(rt-F),Ze=S.project(Ee),ot=S.project(Oe).sub(Ze);let vt=c.curve;const kt=Math.max(S.width,S.height),It=kt/qe,ur=ot.mag();if("minZoom"in c){const jr=o.ac(Math.min(c.minZoom,F,rt),S.minZoom,S.maxZoom),In=kt/S.zoomScale(jr-F);vt=Math.sqrt(In/ur*2)}const wr=vt*vt;function Dr(jr){const In=(It*It-kt*kt+(jr?-1:1)*wr*wr*ur*ur)/(2*(jr?It:kt)*wr*ur);return Math.log(Math.sqrt(In*In+1)-In)}function Or(jr){return(Math.exp(jr)-Math.exp(-jr))/2}function _r(jr){return(Math.exp(jr)+Math.exp(-jr))/2}const xr=Dr(!1);let Vr=function(jr){return _r(xr)/_r(xr+vt*jr)},xn=function(jr){return kt*((_r(xr)*(Or(In=xr+vt*jr)/_r(In))-Or(xr))/wr)/ur;var In},Qr=(Dr(!0)-xr)/vt;if(Math.abs(ur)<1e-6||!isFinite(Qr)){if(Math.abs(kt-It)<1e-6)return this.easeTo(c,y);const jr=It<kt?-1:1;Qr=Math.abs(Math.log(It/kt))/vt,xn=()=>0,Vr=In=>Math.exp(jr*vt*In)}return c.duration="duration"in c?+c.duration:1e3*Qr/("screenSpeed"in c?+c.screenSpeed/vt:+c.speed),c.maxDuration&&c.duration>c.maxDuration&&(c.duration=0),this._zooming=!0,this._rotating=H!==se,this._pitching=he!==j,this._padding=!S.isPaddingEqual(ue),this._prepareEase(y,!1),this.terrain&&this._prepareElevation(Oe),this._ease(jr=>{const In=jr*Qr,Hn=1/Vr(In);S.zoom=jr===1?rt:F+S.scaleZoom(Hn),this._rotating&&(S.bearing=o.y.number(H,se,jr)),this._pitching&&(S.pitch=o.y.number(j,he,jr)),this._padding&&(S.interpolatePadding(Z,ue,jr),Fe=S.centerPoint.add(Te)),this.terrain&&!c.freezeElevation&&this._updateElevation(jr);const Qn=jr===1?Oe:S.unproject(Ze.add(ot.mult(xn(In))).mult(Hn));S.setLocationAtPoint(S.renderWorldCopies?Qn.wrap():Qn,Fe),this._applyUpdatedTransform(S),this._fireMoveEvents(y)},()=>{this.terrain&&c.freezeElevation&&this._finalizeElevation(),this._afterEase(y)},c),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(c,y){var B;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const S=this._onEaseEnd;delete this._onEaseEnd,S.call(this,y)}return c||(B=this.handlers)===null||B===void 0||B.stop(!1),this}_ease(c,y,B){B.animate===!1||B.duration===0?(c(1),y()):(this._easeStart=x.now(),this._easeOptions=B,this._onEaseFrame=c,this._onEaseEnd=y,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(c,y){c=o.b3(c,-180,180);const B=Math.abs(c-y);return Math.abs(c-360-y)<B&&(c-=360),Math.abs(c+360-y)<B&&(c+=360),c}_normalizeCenter(c,y){if(!y.renderWorldCopies||y.lngRange)return;const B=c.lng-y.center.lng;c.lng+=B>180?-360:B<-180?360:0}queryTerrainElevation(c){return this.terrain?this.terrain.getElevationForLngLatZoom(o.N.convert(c),this.transform.tileZoom)-this.transform.elevation:null}}const Vu={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class xu{constructor(){let c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Vu;this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=y=>{!y||y.sourceDataType!=="metadata"&&y.sourceDataType!=="visibility"&&y.dataType!=="style"&&y.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=c}getDefaultPosition(){return"bottom-right"}onAdd(c){return this._map=c,this._compact=this.options.compact,this._container=T.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=T.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=T.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){T.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(c,y){const B=this._map._getUIString(`AttributionControl.${y}`);c.title=B,c.setAttribute("aria-label",B)}_updateAttributions(){if(!this._map.style)return;let c=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?c=c.concat(this.options.customAttribution.map(S=>typeof S!="string"?"":S)):typeof this.options.customAttribution=="string"&&c.push(this.options.customAttribution)),this._map.style.stylesheet){const S=this._map.style.stylesheet;this.styleOwner=S.owner,this.styleId=S.id}const y=this._map.style.sourceCaches;for(const S in y){const F=y[S];if(F.used||F.usedForTerrain){const H=F.getSource();H.attribution&&c.indexOf(H.attribution)<0&&c.push(H.attribution)}}c=c.filter(S=>String(S).trim()),c.sort((S,F)=>S.length-F.length),c=c.filter((S,F)=>{for(let H=F+1;H<c.length;H++)if(c[H].indexOf(S)>=0)return!1;return!0});const B=c.join(" | ");B!==this._attribHTML&&(this._attribHTML=B,c.length?(this._innerContainer.innerHTML=B,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class $l{constructor(){let c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._updateCompact=()=>{const y=this._container.children;if(y.length){const B=y[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&B.classList.add("maplibregl-compact"):B.classList.remove("maplibregl-compact")}},this.options=c}getDefaultPosition(){return"bottom-left"}onAdd(c){this._map=c,this._compact=this.options&&this.options.compact,this._container=T.create("div","maplibregl-ctrl");const y=T.create("a","maplibregl-ctrl-logo");return y.target="_blank",y.rel="noopener nofollow",y.href="https://maplibre.org/",y.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),y.setAttribute("rel","noopener nofollow"),this._container.appendChild(y),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){T.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class ni{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(c){const y=++this._id;return this._queue.push({callback:c,id:y,cancelled:!1}),y}remove(c){const y=this._currentlyRunning,B=y?this._queue.concat(y):this._queue;for(const S of B)if(S.id===c)return void(S.cancelled=!0)}run(){let c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const y=this._currentlyRunning=this._queue;this._queue=[];for(const B of y)if(!B.cancelled&&(B.callback(c),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Gu=o.Y([{name:"a_pos3d",type:"Int16",components:3}]);class mh extends o.E{constructor(c){super(),this.sourceCache=c,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,c.usedForTerrain=!0,c.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(c,y){this.sourceCache.update(c,y),this._renderableTilesKeys=[];const B={};for(const S of c.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:y}))B[S.key]=!0,this._renderableTilesKeys.push(S.key),this._tiles[S.key]||(S.posMatrix=new Float64Array(16),o.aP(S.posMatrix,0,o.X,0,o.X,0,1),this._tiles[S.key]=new Ci(S,this.tileSize));for(const S in this._tiles)B[S]||delete this._tiles[S]}freeRtt(c){for(const y in this._tiles){const B=this._tiles[y];(!c||B.tileID.equals(c)||B.tileID.isChildOf(c)||c.isChildOf(B.tileID))&&(B.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(c=>this.getTileByID(c))}getTileByID(c){return this._tiles[c]}getTerrainCoords(c){const y={};for(const B of this._renderableTilesKeys){const S=this._tiles[B].tileID;if(S.canonical.equals(c.canonical)){const F=c.clone();F.posMatrix=new Float64Array(16),o.aP(F.posMatrix,0,o.X,0,o.X,0,1),y[B]=F}else if(S.canonical.isChildOf(c.canonical)){const F=c.clone();F.posMatrix=new Float64Array(16);const H=S.canonical.z-c.canonical.z,j=S.canonical.x-(S.canonical.x>>H<<H),Z=S.canonical.y-(S.canonical.y>>H<<H),se=o.X>>H;o.aP(F.posMatrix,0,se,0,se,0,1),o.J(F.posMatrix,F.posMatrix,[-j*se,-Z*se,0]),y[B]=F}else if(c.canonical.isChildOf(S.canonical)){const F=c.clone();F.posMatrix=new Float64Array(16);const H=c.canonical.z-S.canonical.z,j=c.canonical.x-(c.canonical.x>>H<<H),Z=c.canonical.y-(c.canonical.y>>H<<H),se=o.X>>H;o.aP(F.posMatrix,0,o.X,0,o.X,0,1),o.J(F.posMatrix,F.posMatrix,[j*se,Z*se,0]),o.K(F.posMatrix,F.posMatrix,[1/2**H,1/2**H,0]),y[B]=F}}return y}getSourceTile(c,y){const B=this.sourceCache._source;let S=c.overscaledZ-this.deltaZoom;if(S>B.maxzoom&&(S=B.maxzoom),S<B.minzoom)return null;this._sourceTileCache[c.key]||(this._sourceTileCache[c.key]=c.scaledTo(S).key);let F=this.sourceCache.getTileByID(this._sourceTileCache[c.key]);if((!F||!F.dem)&&y)for(;S>=B.minzoom&&(!F||!F.dem);)F=this.sourceCache.getTileByID(c.scaledTo(S--).key);return F}tilesAfterTime(){let c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Date.now();return Object.values(this._tiles).filter(y=>y.timeAdded>=c)}}class So{constructor(c,y,B){this.painter=c,this.sourceCache=new mh(y),this.options=B,this.exaggeration=typeof B.exaggeration=="number"?B.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(c,y,B){let S=arguments.length>3&&arguments[3]!==void 0?arguments[3]:o.X;var F;if(!(y>=0&&y<S&&B>=0&&B<S))return 0;const H=this.getTerrainData(c),j=(F=H.tile)===null||F===void 0?void 0:F.dem;if(!j)return 0;const Z=function(Ee,Oe,rt){var qe=Oe[0],Ze=Oe[1];return Ee[0]=rt[0]*qe+rt[4]*Ze+rt[12],Ee[1]=rt[1]*qe+rt[5]*Ze+rt[13],Ee}([],[y/S*o.X,B/S*o.X],H.u_terrain_matrix),se=[Z[0]*j.dim,Z[1]*j.dim],he=Math.floor(se[0]),ue=Math.floor(se[1]),Te=se[0]-he,Fe=se[1]-ue;return j.get(he,ue)*(1-Te)*(1-Fe)+j.get(he+1,ue)*Te*(1-Fe)+j.get(he,ue+1)*(1-Te)*Fe+j.get(he+1,ue+1)*Te*Fe}getElevationForLngLatZoom(c,y){if(!o.bb(y,c.wrap()))return 0;const{tileID:B,mercatorX:S,mercatorY:F}=this._getOverscaledTileIDFromLngLatZoom(c,y);return this.getElevation(B,S%o.X,F%o.X,o.X)}getElevation(c,y,B){let S=arguments.length>3&&arguments[3]!==void 0?arguments[3]:o.X;return this.getDEMElevation(c,y,B,S)*this.exaggeration}getTerrainData(c){if(!this._emptyDemTexture){const S=this.painter.context,F=new o.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Le(S,F,S.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Le(S,new o.R({width:1,height:1}),S.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(S.gl.NEAREST,S.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=o.an([])}const y=this.sourceCache.getSourceTile(c,!0);if(y&&y.dem&&(!y.demTexture||y.needsTerrainPrepare)){const S=this.painter.context;y.demTexture=this.painter.getTileTexture(y.dem.stride),y.demTexture?y.demTexture.update(y.dem.getPixels(),{premultiply:!1}):y.demTexture=new Le(S,y.dem.getPixels(),S.gl.RGBA,{premultiply:!1}),y.demTexture.bind(S.gl.NEAREST,S.gl.CLAMP_TO_EDGE),y.needsTerrainPrepare=!1}const B=y&&y+y.tileID.key+c.key;if(B&&!this._demMatrixCache[B]){const S=this.sourceCache.sourceCache._source.maxzoom;let F=c.canonical.z-y.tileID.canonical.z;c.overscaledZ>c.canonical.z&&(c.canonical.z>=S?F=c.canonical.z-S:o.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const H=c.canonical.x-(c.canonical.x>>F<<F),j=c.canonical.y-(c.canonical.y>>F<<F),Z=o.bc(new Float64Array(16),[1/(o.X<<F),1/(o.X<<F),0]);o.J(Z,Z,[H*o.X,j*o.X,0]),this._demMatrixCache[c.key]={matrix:Z,coord:c}}return{u_depth:2,u_terrain:3,u_terrain_dim:y&&y.dem&&y.dem.dim||1,u_terrain_matrix:B?this._demMatrixCache[c.key].matrix:this._emptyDemMatrix,u_terrain_unpack:y&&y.dem&&y.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(y&&y.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:y}}getFramebuffer(c){const y=this.painter,B=y.width/devicePixelRatio,S=y.height/devicePixelRatio;return!this._fbo||this._fbo.width===B&&this._fbo.height===S||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Le(y.context,{width:B,height:S,data:null},y.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(y.context.gl.NEAREST,y.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Le(y.context,{width:B,height:S,data:null},y.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(y.context.gl.NEAREST,y.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=y.context.createFramebuffer(B,S,!0,!1),this._fbo.depthAttachment.set(y.context.createRenderbuffer(y.context.gl.DEPTH_COMPONENT16,B,S))),this._fbo.colorAttachment.set(c==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const c=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const y=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let F=0,H=0;F<this._coordsTextureSize;F++)for(let j=0;j<this._coordsTextureSize;j++,H+=4)y[H+0]=255&j,y[H+1]=255&F,y[H+2]=j>>8<<4|F>>8,y[H+3]=0;const B=new o.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(y.buffer)),S=new Le(c,B,c.gl.RGBA,{premultiply:!1});return S.bind(c.gl.NEAREST,c.gl.CLAMP_TO_EDGE),this._coordsTexture=S,S}pointCoordinate(c){this.painter.maybeDrawDepthAndCoords(!0);const y=new Uint8Array(4),B=this.painter.context,S=B.gl,F=Math.round(c.x*this.painter.pixelRatio/devicePixelRatio),H=Math.round(c.y*this.painter.pixelRatio/devicePixelRatio),j=Math.round(this.painter.height/devicePixelRatio);B.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),S.readPixels(F,j-H-1,1,1,S.RGBA,S.UNSIGNED_BYTE,y),B.bindFramebuffer.set(null);const Z=y[0]+(y[2]>>4<<8),se=y[1]+((15&y[2])<<8),he=this.coordsIndex[255-y[3]],ue=he&&this.sourceCache.getTileByID(he);if(!ue)return null;const Te=this._coordsTextureSize,Fe=(1<<ue.tileID.canonical.z)*Te;return new o.Z((ue.tileID.canonical.x*Te+Z)/Fe+ue.tileID.wrap,(ue.tileID.canonical.y*Te+se)/Fe,this.getElevation(ue.tileID,Z,se,Te))}depthAtPoint(c){const y=new Uint8Array(4),B=this.painter.context,S=B.gl;return B.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),S.readPixels(c.x,this.painter.height/devicePixelRatio-c.y-1,1,1,S.RGBA,S.UNSIGNED_BYTE,y),B.bindFramebuffer.set(null),(y[0]/16777216+y[1]/65536+y[2]/256+y[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const c=this.painter.context,y=new o.bd,B=new o.aY,S=this.meshSize,F=o.X/S,H=S*S;for(let ue=0;ue<=S;ue++)for(let Te=0;Te<=S;Te++)y.emplaceBack(Te*F,ue*F,0);for(let ue=0;ue<H;ue+=S+1)for(let Te=0;Te<S;Te++)B.emplaceBack(Te+ue,S+Te+ue+1,S+Te+ue+2),B.emplaceBack(Te+ue,S+Te+ue+2,Te+ue+1);const j=y.length,Z=j+2*(S+1);for(const ue of[0,1])for(let Te=0;Te<=S;Te++)for(const Fe of[0,1])y.emplaceBack(Te*F,ue*o.X,Fe);for(let ue=0;ue<2*S;ue+=2)B.emplaceBack(Z+ue,Z+ue+1,Z+ue+3),B.emplaceBack(Z+ue,Z+ue+3,Z+ue+2),B.emplaceBack(j+ue,j+ue+3,j+ue+1),B.emplaceBack(j+ue,j+ue+2,j+ue+3);const se=y.length,he=se+2*(S+1);for(const ue of[0,1])for(let Te=0;Te<=S;Te++)for(const Fe of[0,1])y.emplaceBack(ue*o.X,Te*F,Fe);for(let ue=0;ue<2*S;ue+=2)B.emplaceBack(se+ue,se+ue+1,se+ue+3),B.emplaceBack(se+ue,se+ue+3,se+ue+2),B.emplaceBack(he+ue,he+ue+3,he+ue+1),B.emplaceBack(he+ue,he+ue+2,he+ue+3);return this._mesh=new kc(c.createVertexBuffer(y,Gu.members),c.createIndexBuffer(B),o.a0.simpleSegment(0,0,y.length,B.length)),this._mesh}getMeshFrameDelta(c){return 2*Math.PI*o.be/Math.pow(2,c)/5}getMinTileElevationForLngLatZoom(c,y){var B;const{tileID:S}=this._getOverscaledTileIDFromLngLatZoom(c,y);return(B=this.getMinMaxElevation(S).minElevation)!==null&&B!==void 0?B:0}getMinMaxElevation(c){const y=this.getTerrainData(c).tile,B={minElevation:null,maxElevation:null};return y&&y.dem&&(B.minElevation=y.dem.min*this.exaggeration,B.maxElevation=y.dem.max*this.exaggeration),B}_getOverscaledTileIDFromLngLatZoom(c,y){const B=o.Z.fromLngLat(c.wrap()),S=(1<<y)*o.X,F=B.x*S,H=B.y*S,j=Math.floor(F/o.X),Z=Math.floor(H/o.X);return{tileID:new o.S(y,0,y,j,Z),mercatorX:F,mercatorY:H}}}class Vs{constructor(c,y,B){this._context=c,this._size=y,this._tileSize=B,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const c of this._objects)c.texture.destroy(),c.fbo.destroy()}_createObject(c){const y=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),B=new Le(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return B.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),y.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),y.colorAttachment.set(B.texture),{id:c,fbo:y,texture:B,stamp:-1,inUse:!1}}getObjectForId(c){return this._objects[c]}useObject(c){c.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(y=>c.id!==y),this._recentlyUsed.push(c.id)}stampObject(c){c.stamp=++this._stamp}getOrCreateFreeObject(){for(const y of this._recentlyUsed)if(!this._objects[y].inUse)return this._objects[y];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const c=this._createObject(this._objects.length);return this._objects.push(c),c}freeObject(c){c.inUse=!1}freeAllObjects(){for(const c of this._objects)this.freeObject(c)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(c=>!c.inUse)===!1}}const wl={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class el{constructor(c,y){this.painter=c,this.terrain=y,this.pool=new Vs(c.context,30,y.sourceCache.tileSize*y.qualityFactor)}destruct(){this.pool.destruct()}getTexture(c){return this.pool.getObjectForId(c.rtt[this._stacks.length-1].id).texture}prepareForRender(c,y){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=c._order.filter(B=>!c._layers[B].isHidden(y)),this._coordsDescendingInv={};for(const B in c.sourceCaches){this._coordsDescendingInv[B]={};const S=c.sourceCaches[B].getVisibleCoordinates();for(const F of S){const H=this.terrain.sourceCache.getTerrainCoords(F);for(const j in H)this._coordsDescendingInv[B][j]||(this._coordsDescendingInv[B][j]=[]),this._coordsDescendingInv[B][j].push(H[j])}}this._coordsDescendingInvStr={};for(const B of c._order){const S=c._layers[B],F=S.source;if(wl[S.type]&&!this._coordsDescendingInvStr[F]){this._coordsDescendingInvStr[F]={};for(const H in this._coordsDescendingInv[F])this._coordsDescendingInvStr[F][H]=this._coordsDescendingInv[F][H].map(j=>j.key).sort().join()}}for(const B of this._renderableTiles)for(const S in this._coordsDescendingInvStr){const F=this._coordsDescendingInvStr[S][B.tileID.key];F&&F!==B.rttCoords[S]&&(B.rtt=[])}}renderLayer(c){if(c.isHidden(this.painter.transform.zoom))return!1;const y=c.type,B=this.painter,S=this._renderableLayerIds[this._renderableLayerIds.length-1]===c.id;if(wl[y]&&(this._prevType&&wl[this._prevType]||this._stacks.push([]),this._prevType=y,this._stacks[this._stacks.length-1].push(c.id),!S))return!0;if(wl[this._prevType]||wl[y]&&S){this._prevType=y;const F=this._stacks.length-1,H=this._stacks[F]||[];for(const j of this._renderableTiles){if(this.pool.isFull()&&(Co(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(j),j.rtt[F]){const se=this.pool.getObjectForId(j.rtt[F].id);if(se.stamp===j.rtt[F].stamp){this.pool.useObject(se);continue}}const Z=this.pool.getOrCreateFreeObject();this.pool.useObject(Z),this.pool.stampObject(Z),j.rtt[F]={id:Z.id,stamp:Z.stamp},B.context.bindFramebuffer.set(Z.fbo.framebuffer),B.context.clear({color:o.aM.transparent,stencil:0}),B.currentStencilSource=void 0;for(let se=0;se<H.length;se++){const he=B.style._layers[H[se]],ue=he.source?this._coordsDescendingInv[he.source][j.tileID.key]:[j.tileID];B.context.viewport.set([0,0,Z.fbo.width,Z.fbo.height]),B._renderTileClippingMasks(he,ue),B.renderLayer(B,B.style.sourceCaches[he.source],he,ue),he.source&&(j.rttCoords[he.source]=this._coordsDescendingInvStr[he.source][j.tileID.key])}}return Co(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),wl[y]}return!1}}const wu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Gh=h,Bu={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Vu,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:o.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},Cu=E=>{E.touchstart=E.dragStart,E.touchmoveWindow=E.dragMove,E.touchend=E.dragEnd},Qh={showCompass:!0,showZoom:!0,visualizePitch:!1};class xf{constructor(c,y){let B=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;this.mousedown=H=>{this.startMouse(o.e({},H,{ctrlKey:!0,preventDefault:()=>H.preventDefault()}),T.mousePos(this.element,H)),T.addEventListener(window,"mousemove",this.mousemove),T.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=H=>{this.moveMouse(H,T.mousePos(this.element,H))},this.mouseup=H=>{this.mouseRotate.dragEnd(H),this.mousePitch&&this.mousePitch.dragEnd(H),this.offTemp()},this.touchstart=H=>{H.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=T.touchPos(this.element,H.targetTouches)[0],this.startTouch(H,this._startPos),T.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),T.addEventListener(window,"touchend",this.touchend))},this.touchmove=H=>{H.targetTouches.length!==1?this.reset():(this._lastPos=T.touchPos(this.element,H.targetTouches)[0],this.moveTouch(H,this._lastPos))},this.touchend=H=>{H.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const S=c.dragRotate._mouseRotate.getClickTolerance(),F=c.dragRotate._mousePitch.getClickTolerance();this.element=y,this.mouseRotate=zu({clickTolerance:S,enable:!0}),this.touchRotate=(H=>{let{enable:j,clickTolerance:Z,bearingDegreesPerPixelMoved:se=.8}=H;const he=new wd;return new zs({clickTolerance:Z,move:(ue,Te)=>({bearingDelta:(Te.x-ue.x)*se}),moveStateManager:he,enable:j,assignEvents:Cu})})({clickTolerance:S,enable:!0}),this.map=c,B&&(this.mousePitch=ph({clickTolerance:F,enable:!0}),this.touchPitch=(H=>{let{enable:j,clickTolerance:Z,pitchDegreesPerPixelMoved:se=-.5}=H;const he=new wd;return new zs({clickTolerance:Z,move:(ue,Te)=>({pitchDelta:(Te.y-ue.y)*se}),moveStateManager:he,enable:j,assignEvents:Cu})})({clickTolerance:F,enable:!0})),T.addEventListener(y,"mousedown",this.mousedown),T.addEventListener(y,"touchstart",this.touchstart,{passive:!1}),T.addEventListener(y,"touchcancel",this.reset)}startMouse(c,y){this.mouseRotate.dragStart(c,y),this.mousePitch&&this.mousePitch.dragStart(c,y),T.disableDrag()}startTouch(c,y){this.touchRotate.dragStart(c,y),this.touchPitch&&this.touchPitch.dragStart(c,y),T.disableDrag()}moveMouse(c,y){const B=this.map,{bearingDelta:S}=this.mouseRotate.dragMove(c,y)||{};if(S&&B.setBearing(B.getBearing()+S),this.mousePitch){const{pitchDelta:F}=this.mousePitch.dragMove(c,y)||{};F&&B.setPitch(B.getPitch()+F)}}moveTouch(c,y){const B=this.map,{bearingDelta:S}=this.touchRotate.dragMove(c,y)||{};if(S&&B.setBearing(B.getBearing()+S),this.touchPitch){const{pitchDelta:F}=this.touchPitch.dragMove(c,y)||{};F&&B.setPitch(B.getPitch()+F)}}off(){const c=this.element;T.removeEventListener(c,"mousedown",this.mousedown),T.removeEventListener(c,"touchstart",this.touchstart,{passive:!1}),T.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),T.removeEventListener(window,"touchend",this.touchend),T.removeEventListener(c,"touchcancel",this.reset),this.offTemp()}offTemp(){T.enableDrag(),T.removeEventListener(window,"mousemove",this.mousemove),T.removeEventListener(window,"mouseup",this.mouseup),T.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),T.removeEventListener(window,"touchend",this.touchend)}}let _o;function Fi(E,c,y){const B=new o.N(E.lng,E.lat);if(E=new o.N(E.lng,E.lat),c){const S=new o.N(E.lng-360,E.lat),F=new o.N(E.lng+360,E.lat),H=y.locationPoint(E).distSqr(c);y.locationPoint(S).distSqr(c)<H?E=S:y.locationPoint(F).distSqr(c)<H&&(E=F)}for(;Math.abs(E.lng-y.center.lng)>180;){const S=y.locationPoint(E);if(S.x>=0&&S.y>=0&&S.x<=y.width&&S.y<=y.height)break;E.lng>y.center.lng?E.lng-=360:E.lng+=360}return E.lng!==B.lng&&y.locationPoint(E).y>y.height/2-y.getHorizon()?E:B}const un={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function $h(E,c,y){const B=E.classList;for(const S in un)B.remove(`maplibregl-${y}-anchor-${S}`);B.add(`maplibregl-${y}-anchor-${c}`)}class bc extends o.E{constructor(c){if(super(),this._onKeyPress=y=>{const B=y.code,S=y.charCode||y.keyCode;B!=="Space"&&B!=="Enter"&&S!==32&&S!==13||this.togglePopup()},this._onMapClick=y=>{const B=y.originalEvent.target,S=this._element;this._popup&&(B===S||S.contains(B))&&this.togglePopup()},this._update=y=>{var B;if(!this._map)return;const S=this._map.loaded()&&!this._map.isMoving();((y==null?void 0:y.type)==="terrain"||(y==null?void 0:y.type)==="render"&&!S)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Fi(this._lngLat,this._flatPos,this._map.transform):(B=this._lngLat)===null||B===void 0?void 0:B.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let F="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?F=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(F=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let H="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?H="rotateX(0deg)":this._pitchAlignment==="map"&&(H=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||y&&y.type!=="moveend"||(this._pos=this._pos.round()),T.setTransform(this._element,`${un[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${H} ${F}`),x.frameAsync(new AbortController).then(()=>{this._updateOpacity(y&&y.type==="moveend")}).catch(()=>{})},this._onMove=y=>{if(!this._isDragging){const B=this._clickTolerance||this._map._clickTolerance;this._isDragging=y.point.dist(this._pointerdownPos)>=B}this._isDragging&&(this._pos=y.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.k("dragstart"))),this.fire(new o.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new o.k("dragend")),this._state="inactive"},this._addDragHandler=y=>{this._element.contains(y.originalEvent.target)&&(y.preventDefault(),this._positionDelta=y.point.sub(this._pos).add(this._offset),this._pointerdownPos=y.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=c&&c.anchor||"center",this._color=c&&c.color||"#3FB1CE",this._scale=c&&c.scale||1,this._draggable=c&&c.draggable||!1,this._clickTolerance=c&&c.clickTolerance||0,this._subpixelPositioning=c&&c.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=c&&c.rotation||0,this._rotationAlignment=c&&c.rotationAlignment||"auto",this._pitchAlignment=c&&c.pitchAlignment&&c.pitchAlignment!=="auto"?c.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(c==null?void 0:c.opacity,c==null?void 0:c.opacityWhenCovered),c&&c.element)this._element=c.element,this._offset=o.P.convert(c&&c.offset||[0,0]);else{this._defaultMarker=!0,this._element=T.create("div");const y=T.createNS("http://www.w3.org/2000/svg","svg"),B=41,S=27;y.setAttributeNS(null,"display","block"),y.setAttributeNS(null,"height",`${B}px`),y.setAttributeNS(null,"width",`${S}px`),y.setAttributeNS(null,"viewBox",`0 0 ${S} ${B}`);const F=T.createNS("http://www.w3.org/2000/svg","g");F.setAttributeNS(null,"stroke","none"),F.setAttributeNS(null,"stroke-width","1"),F.setAttributeNS(null,"fill","none"),F.setAttributeNS(null,"fill-rule","evenodd");const H=T.createNS("http://www.w3.org/2000/svg","g");H.setAttributeNS(null,"fill-rule","nonzero");const j=T.createNS("http://www.w3.org/2000/svg","g");j.setAttributeNS(null,"transform","translate(3.0, 29.0)"),j.setAttributeNS(null,"fill","#000000");const Z=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const qe of Z){const Ze=T.createNS("http://www.w3.org/2000/svg","ellipse");Ze.setAttributeNS(null,"opacity","0.04"),Ze.setAttributeNS(null,"cx","10.5"),Ze.setAttributeNS(null,"cy","5.80029008"),Ze.setAttributeNS(null,"rx",qe.rx),Ze.setAttributeNS(null,"ry",qe.ry),j.appendChild(Ze)}const se=T.createNS("http://www.w3.org/2000/svg","g");se.setAttributeNS(null,"fill",this._color);const he=T.createNS("http://www.w3.org/2000/svg","path");he.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),se.appendChild(he);const ue=T.createNS("http://www.w3.org/2000/svg","g");ue.setAttributeNS(null,"opacity","0.25"),ue.setAttributeNS(null,"fill","#000000");const Te=T.createNS("http://www.w3.org/2000/svg","path");Te.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),ue.appendChild(Te);const Fe=T.createNS("http://www.w3.org/2000/svg","g");Fe.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Fe.setAttributeNS(null,"fill","#FFFFFF");const Ee=T.createNS("http://www.w3.org/2000/svg","g");Ee.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Oe=T.createNS("http://www.w3.org/2000/svg","circle");Oe.setAttributeNS(null,"fill","#000000"),Oe.setAttributeNS(null,"opacity","0.25"),Oe.setAttributeNS(null,"cx","5.5"),Oe.setAttributeNS(null,"cy","5.5"),Oe.setAttributeNS(null,"r","5.4999962");const rt=T.createNS("http://www.w3.org/2000/svg","circle");rt.setAttributeNS(null,"fill","#FFFFFF"),rt.setAttributeNS(null,"cx","5.5"),rt.setAttributeNS(null,"cy","5.5"),rt.setAttributeNS(null,"r","5.4999962"),Ee.appendChild(Oe),Ee.appendChild(rt),H.appendChild(j),H.appendChild(se),H.appendChild(ue),H.appendChild(Fe),H.appendChild(Ee),y.appendChild(H),y.setAttributeNS(null,"height",B*this._scale+"px"),y.setAttributeNS(null,"width",S*this._scale+"px"),this._element.appendChild(y),this._offset=o.P.convert(c&&c.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",y=>{y.preventDefault()}),this._element.addEventListener("mousedown",y=>{y.preventDefault()}),$h(this._element,this._anchor,"marker"),c&&c.className)for(const y of c.className.split(" "))this._element.classList.add(y);this._popup=null}addTo(c){return this.remove(),this._map=c,this._element.setAttribute("aria-label",c._getUIString("Marker.Title")),c.getCanvasContainer().appendChild(this._element),c.on("move",this._update),c.on("moveend",this._update),c.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),T.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(c){return this._lngLat=o.N.convert(c),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(c){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),c){if(!("offset"in c.options)){const S=Math.abs(13.5)/Math.SQRT2;c.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[S,-1*(38.1-13.5+S)],"bottom-right":[-S,-1*(38.1-13.5+S)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=c,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(c){return this._subpixelPositioning=c,this}getPopup(){return this._popup}togglePopup(){const c=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:c?(c.isOpen()?c.remove():(c.setLngLat(this._lngLat),c.addTo(this._map)),this):this}_updateOpacity(){let c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;var y,B;if(!(!((y=this._map)===null||y===void 0)&&y.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(c)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const S=this._map,F=S.terrain.depthAtPoint(this._pos),H=S.terrain.getElevationForLngLatZoom(this._lngLat,S.transform.tileZoom);if(S.transform.lngLatToCameraDepth(this._lngLat,H)-F<.006)return void(this._element.style.opacity=this._opacity);const j=-this._offset.y/S.transform._pixelPerMeter,Z=Math.sin(S.getPitch()*Math.PI/180)*j,se=S.terrain.depthAtPoint(new o.P(this._pos.x,this._pos.y-this._offset.y)),he=S.transform.lngLatToCameraDepth(this._lngLat,H+Z)-se>.006;!((B=this._popup)===null||B===void 0)&&B.isOpen()&&he&&this._popup.remove(),this._element.style.opacity=he?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(c){return this._offset=o.P.convert(c),this._update(),this}addClassName(c){this._element.classList.add(c)}removeClassName(c){this._element.classList.remove(c)}toggleClassName(c){return this._element.classList.toggle(c)}setDraggable(c){return this._draggable=!!c,this._map&&(c?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(c){return this._rotation=c||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(c){return this._rotationAlignment=c||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(c){return this._pitchAlignment=c&&c!=="auto"?c:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(c,y){return c===void 0&&y===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),c!==void 0&&(this._opacity=c),y!==void 0&&(this._opacityWhenCovered=y),this._map&&this._updateOpacity(!0),this}}const wf={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let $c=0,Bl=!1;const Cl={maxWidth:100,unit:"metric"};function ci(E,c,y){const B=y&&y.maxWidth||100,S=E._container.clientHeight/2,F=E.unproject([0,S]),H=E.unproject([B,S]),j=F.distanceTo(H);if(y&&y.unit==="imperial"){const Z=3.2808*j;Z>5280?vn(c,B,Z/5280,E._getUIString("ScaleControl.Miles")):vn(c,B,Z,E._getUIString("ScaleControl.Feet"))}else y&&y.unit==="nautical"?vn(c,B,j/1852,E._getUIString("ScaleControl.NauticalMiles")):j>=1e3?vn(c,B,j/1e3,E._getUIString("ScaleControl.Kilometers")):vn(c,B,j,E._getUIString("ScaleControl.Meters"))}function vn(E,c,y,B){const S=function(F){const H=Math.pow(10,`${Math.floor(F)}`.length-1);let j=F/H;return j=j>=10?10:j>=5?5:j>=3?3:j>=2?2:j>=1?1:function(Z){const se=Math.pow(10,Math.ceil(-Math.log(Z)/Math.LN10));return Math.round(Z*se)/se}(j),H*j}(y);E.style.width=c*(S/y)+"px",E.innerHTML=`${S}&nbsp;${B}`}const Wn={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},Eu=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function z(E){if(E){if(typeof E=="number"){const c=Math.round(Math.abs(E)/Math.SQRT2);return{center:new o.P(0,0),top:new o.P(0,E),"top-left":new o.P(c,c),"top-right":new o.P(-c,c),bottom:new o.P(0,-E),"bottom-left":new o.P(c,-c),"bottom-right":new o.P(-c,-c),left:new o.P(E,0),right:new o.P(-E,0)}}if(E instanceof o.P||Array.isArray(E)){const c=o.P.convert(E);return{center:c,top:c,"top-left":c,"top-right":c,bottom:c,"bottom-left":c,"bottom-right":c,left:c,right:c}}return{center:o.P.convert(E.center||[0,0]),top:o.P.convert(E.top||[0,0]),"top-left":o.P.convert(E["top-left"]||[0,0]),"top-right":o.P.convert(E["top-right"]||[0,0]),bottom:o.P.convert(E.bottom||[0,0]),"bottom-left":o.P.convert(E["bottom-left"]||[0,0]),"bottom-right":o.P.convert(E["bottom-right"]||[0,0]),left:o.P.convert(E.left||[0,0]),right:o.P.convert(E.right||[0,0])}}return z(new o.P(0,0))}const X=h;a.AJAXError=o.bh,a.Evented=o.E,a.LngLat=o.N,a.MercatorCoordinate=o.Z,a.Point=o.P,a.addProtocol=o.bi,a.config=o.a,a.removeProtocol=o.bj,a.AttributionControl=xu,a.BoxZoomHandler=ko,a.CanvasSource=Fn,a.CooperativeGesturesHandler=vu,a.DoubleClickZoomHandler=Ia,a.DragPanHandler=gh,a.DragRotateHandler=Cd,a.EdgeInsets=ca,a.FullscreenControl=class extends o.E{constructor(){let E=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this._onFullscreenChange=()=>{var c;let y=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((c=y==null?void 0:y.shadowRoot)===null||c===void 0)&&c.fullscreenElement;)y=y.shadowRoot.fullscreenElement;y===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,E&&E.container&&(E.container instanceof HTMLElement?this._container=E.container:o.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(E){return this._map=E,this._container||(this._container=this._map.getContainer()),this._controlContainer=T.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){T.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const E=this._fullscreenButton=T.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);T.create("span","maplibregl-ctrl-icon",E).setAttribute("aria-hidden","true"),E.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const E=this._getTitle();this._fullscreenButton.setAttribute("aria-label",E),this._fullscreenButton.title=E}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new o.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new o.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},a.GeoJSONSource=en,a.GeolocateControl=class extends o.E{constructor(E){super(),this._onSuccess=c=>{if(this._map){if(this._isOutOfMapMaxBounds(c))return this._setErrorState(),this.fire(new o.k("outofmaxbounds",c)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=c,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(c),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(c),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new o.k("geolocate",c)),this._finish()}},this._updateCamera=c=>{const y=new o.N(c.coords.longitude,c.coords.latitude),B=c.coords.accuracy,S=this._map.getBearing(),F=o.e({bearing:S},this.options.fitBoundsOptions),H=We.fromLngLat(y,B);this._map.fitBounds(H,F,{geolocateSource:!0})},this._updateMarker=c=>{if(c){const y=new o.N(c.coords.longitude,c.coords.latitude);this._accuracyCircleMarker.setLngLat(y).addTo(this._map),this._userLocationDotMarker.setLngLat(y).addTo(this._map),this._accuracy=c.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=c=>{if(this._map){if(this.options.trackUserLocation)if(c.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const y=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=y,this._geolocateButton.setAttribute("aria-label",y),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(c.code===3&&Bl)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new o.k("error",c)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",c=>c.preventDefault()),this._geolocateButton=T.create("button","maplibregl-ctrl-geolocate",this._container),T.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=c=>{if(this._map){if(c===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");const y=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=y,this._geolocateButton.setAttribute("aria-label",y)}else{const y=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=y,this._geolocateButton.setAttribute("aria-label",y)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=T.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new bc({element:this._dotElement}),this._circleElement=T.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new bc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",y=>{y.geolocateSource||this._watchState!=="ACTIVE_LOCK"||y.originalEvent&&y.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new o.k("trackuserlocationend")),this.fire(new o.k("userlocationlostfocus")))})}},this.options=o.e({},wf,E)}onAdd(E){return this._map=E,this._container=T.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return o._(this,arguments,void 0,function(){let c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;return function*(){if(_o!==void 0&&!c)return _o;if(window.navigator.permissions===void 0)return _o=!!window.navigator.geolocation,_o;try{_o=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{_o=!!window.navigator.geolocation}return _o}()})}().then(c=>this._finishSetupUI(c)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),T.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,$c=0,Bl=!1}_isOutOfMapMaxBounds(E){const c=this._map.getMaxBounds(),y=E.coords;return c&&(y.longitude<c.getWest()||y.longitude>c.getEast()||y.latitude<c.getSouth()||y.latitude>c.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const E=this._map.getBounds(),c=E.getSouthEast(),y=E.getNorthEast(),B=c.distanceTo(y),S=Math.ceil(this._accuracy/(B/this._map._container.clientHeight)*2);this._circleElement.style.width=`${S}px`,this._circleElement.style.height=`${S}px`}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":$c--,Bl=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new o.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.k("trackuserlocationstart")),this.fire(new o.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let E;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),$c++,$c>1?(E={maximumAge:6e5,timeout:0},Bl=!0):(E=this.options.positionOptions,Bl=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,E)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},a.Hash=Uc,a.ImageSource=gn,a.KeyboardHandler=Hs,a.LngLatBounds=We,a.LogoControl=$l,a.Map=class extends Ql{constructor(E){o.bf.mark(o.bg.create);const c=Object.assign(Object.assign({},Bu),E);if(c.minZoom!=null&&c.maxZoom!=null&&c.minZoom>c.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(c.minPitch!=null&&c.maxPitch!=null&&c.minPitch>c.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(c.minPitch!=null&&c.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(c.maxPitch!=null&&c.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Zo(c.minZoom,c.maxZoom,c.minPitch,c.maxPitch,c.renderWorldCopies),{bearingSnap:c.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new ni,this._controls=[],this._mapId=o.a4(),this._contextLost=y=>{y.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new o.k("webglcontextlost",{originalEvent:y}))},this._contextRestored=y=>{this._setupPainter(),this.resize(),this._update(),this.fire(new o.k("webglcontextrestored",{originalEvent:y}))},this._onMapScroll=y=>{if(y.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=c.interactive,this._maxTileCacheSize=c.maxTileCacheSize,this._maxTileCacheZoomLevels=c.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=c.failIfMajorPerformanceCaveat===!0,this._preserveDrawingBuffer=c.preserveDrawingBuffer===!0,this._antialias=c.antialias===!0,this._trackResize=c.trackResize===!0,this._bearingSnap=c.bearingSnap,this._refreshExpiredTiles=c.refreshExpiredTiles===!0,this._fadeDuration=c.fadeDuration,this._crossSourceCollisions=c.crossSourceCollisions===!0,this._collectResourceTiming=c.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},wu),c.locale),this._clickTolerance=c.clickTolerance,this._overridePixelRatio=c.pixelRatio,this._maxCanvasSize=c.maxCanvasSize,this.transformCameraUpdate=c.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=c.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=ce.addThrottleControl(()=>this.isMoving()),this._requestManager=new fe(c.transformRequest),typeof c.container=="string"){if(this._container=document.getElementById(c.container),!this._container)throw new Error(`Container '${c.container}' not found.`)}else{if(!(c.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=c.container}if(c.maxBounds&&this.setMaxBounds(c.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)).on("moveend",()=>this._update(!1)).on("zoom",()=>this._update(!0)).on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}).once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let y=!1;const B=ua(S=>{this._trackResize&&!this._removed&&(this.resize(S),this.redraw())},50);this._resizeObserver=new ResizeObserver(S=>{y?B(S):y=!0}),this._resizeObserver.observe(this._container)}this.handlers=new To(this,c),this._hash=c.hash&&new Uc(typeof c.hash=="string"&&c.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:c.center,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch}),c.bounds&&(this.resize(),this.fitBounds(c.bounds,o.e({},c.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=c.localIdeographFontFamily,this._validateStyle=c.validateStyle,c.style&&this.setStyle(c.style,{localIdeographFontFamily:c.localIdeographFontFamily}),c.attributionControl&&this.addControl(new xu(typeof c.attributionControl=="boolean"?void 0:c.attributionControl)),c.maplibreLogo&&this.addControl(new $l,c.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",y=>{this._update(y.dataType==="style"),this.fire(new o.k(`${y.dataType}data`,y))}),this.on("dataloading",y=>{this.fire(new o.k(`${y.dataType}dataloading`,y))}),this.on("dataabort",y=>{this.fire(new o.k("sourcedataabort",y))})}_getMapId(){return this._mapId}addControl(E,c){if(c===void 0&&(c=E.getDefaultPosition?E.getDefaultPosition():"top-right"),!E||!E.onAdd)return this.fire(new o.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const y=E.onAdd(this);this._controls.push(E);const B=this._controlPositions[c];return c.indexOf("bottom")!==-1?B.insertBefore(y,B.firstChild):B.appendChild(y),this}removeControl(E){if(!E||!E.onRemove)return this.fire(new o.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const c=this._controls.indexOf(E);return c>-1&&this._controls.splice(c,1),E.onRemove(this),this}hasControl(E){return this._controls.indexOf(E)>-1}calculateCameraOptionsFromTo(E,c,y,B){return B==null&&this.terrain&&(B=this.terrain.getElevationForLngLatZoom(y,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(E,c,y,B)}resize(E){var c;const y=this._containerDimensions(),B=y[0],S=y[1],F=this._getClampedPixelRatio(B,S);if(this._resizeCanvas(B,S,F),this.painter.resize(B,S,F),this.painter.overLimit()){const j=this.painter.context.gl;this._maxCanvasSize=[j.drawingBufferWidth,j.drawingBufferHeight];const Z=this._getClampedPixelRatio(B,S);this._resizeCanvas(B,S,Z),this.painter.resize(B,S,Z)}this.transform.resize(B,S),(c=this._requestedCameraState)===null||c===void 0||c.resize(B,S);const H=!this._moving;return H&&(this.stop(),this.fire(new o.k("movestart",E)).fire(new o.k("move",E))),this.fire(new o.k("resize",E)),H&&this.fire(new o.k("moveend",E)),this}_getClampedPixelRatio(E,c){const{0:y,1:B}=this._maxCanvasSize,S=this.getPixelRatio(),F=E*S,H=c*S;return Math.min(F>y?y/F:1,H>B?B/H:1)*S}getPixelRatio(){var E;return(E=this._overridePixelRatio)!==null&&E!==void 0?E:devicePixelRatio}setPixelRatio(E){this._overridePixelRatio=E,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(E){return this.transform.setMaxBounds(We.convert(E)),this._update()}setMinZoom(E){if((E=E??-2)>=-2&&E<=this.transform.maxZoom)return this.transform.minZoom=E,this._update(),this.getZoom()<E&&this.setZoom(E),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(E){if((E=E??22)>=this.transform.minZoom)return this.transform.maxZoom=E,this._update(),this.getZoom()>E&&this.setZoom(E),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(E){if((E=E??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(E>=0&&E<=this.transform.maxPitch)return this.transform.minPitch=E,this._update(),this.getPitch()<E&&this.setPitch(E),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(E){if((E=E??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(E>=this.transform.minPitch)return this.transform.maxPitch=E,this._update(),this.getPitch()>E&&this.setPitch(E),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(E){return this.transform.renderWorldCopies=E,this._update()}project(E){return this.transform.locationPoint(o.N.convert(E),this.style&&this.terrain)}unproject(E){return this.transform.pointLocation(o.P.convert(E),this.terrain)}isMoving(){var E;return this._moving||((E=this.handlers)===null||E===void 0?void 0:E.isMoving())}isZooming(){var E;return this._zooming||((E=this.handlers)===null||E===void 0?void 0:E.isZooming())}isRotating(){var E;return this._rotating||((E=this.handlers)===null||E===void 0?void 0:E.isRotating())}_createDelegatedListener(E,c,y){if(E==="mouseenter"||E==="mouseover"){let B=!1;return{layers:c,listener:y,delegates:{mousemove:F=>{const H=c.filter(Z=>this.getLayer(Z)),j=H.length!==0?this.queryRenderedFeatures(F.point,{layers:H}):[];j.length?B||(B=!0,y.call(this,new xs(E,this,F.originalEvent,{features:j}))):B=!1},mouseout:()=>{B=!1}}}}if(E==="mouseleave"||E==="mouseout"){let B=!1;return{layers:c,listener:y,delegates:{mousemove:H=>{const j=c.filter(Z=>this.getLayer(Z));(j.length!==0?this.queryRenderedFeatures(H.point,{layers:j}):[]).length?B=!0:B&&(B=!1,y.call(this,new xs(E,this,H.originalEvent)))},mouseout:H=>{B&&(B=!1,y.call(this,new xs(E,this,H.originalEvent)))}}}}{const B=S=>{const F=c.filter(j=>this.getLayer(j)),H=F.length!==0?this.queryRenderedFeatures(S.point,{layers:F}):[];H.length&&(S.features=H,y.call(this,S),delete S.features)};return{layers:c,listener:y,delegates:{[E]:B}}}}_saveDelegatedListener(E,c){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[E]=this._delegatedListeners[E]||[],this._delegatedListeners[E].push(c)}_removeDelegatedListener(E,c,y){if(!this._delegatedListeners||!this._delegatedListeners[E])return;const B=this._delegatedListeners[E];for(let S=0;S<B.length;S++){const F=B[S];if(F.listener===y&&F.layers.length===c.length&&F.layers.every(H=>c.includes(H))){for(const H in F.delegates)this.off(H,F.delegates[H]);return void B.splice(S,1)}}}on(E,c,y){if(y===void 0)return super.on(E,c);const B=this._createDelegatedListener(E,typeof c=="string"?[c]:c,y);this._saveDelegatedListener(E,B);for(const S in B.delegates)this.on(S,B.delegates[S]);return this}once(E,c,y){var B=this;if(y===void 0)return super.once(E,c);const S=typeof c=="string"?[c]:c,F=this._createDelegatedListener(E,S,y);for(const H in F.delegates){const j=F.delegates[H];F.delegates[H]=function(){B._removeDelegatedListener(E,S,y),j(...arguments)}}this._saveDelegatedListener(E,F);for(const H in F.delegates)this.once(H,F.delegates[H]);return this}off(E,c,y){return y===void 0?super.off(E,c):(this._removeDelegatedListener(E,typeof c=="string"?[c]:c,y),this)}queryRenderedFeatures(E,c){if(!this.style)return[];let y;const B=E instanceof o.P||Array.isArray(E),S=B?E:[[0,0],[this.transform.width,this.transform.height]];if(c=c||(B?{}:E)||{},S instanceof o.P||typeof S[0]=="number")y=[o.P.convert(S)];else{const F=o.P.convert(S[0]),H=o.P.convert(S[1]);y=[F,new o.P(H.x,F.y),H,new o.P(F.x,H.y),F]}return this.style.queryRenderedFeatures(y,c,this.transform)}querySourceFeatures(E,c){return this.style.querySourceFeatures(E,c)}setStyle(E,c){return(c=o.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},c)).diff!==!1&&c.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&E?(this._diffStyle(E,c),this):(this._localIdeographFontFamily=c.localIdeographFontFamily,this._updateStyle(E,c))}setTransformRequest(E){return this._requestManager.setTransformRequest(E),this}_getUIString(E){const c=this._locale[E];if(c==null)throw new Error(`Missing UI string '${E}'`);return c}_updateStyle(E,c){if(c.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(E,c));const y=this.style&&c.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!E)),E?(this.style=new ds(this,c||{}),this.style.setEventedParent(this,{style:this.style}),typeof E=="string"?this.style.loadURL(E,c,y):this.style.loadJSON(E,c,y),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new ds(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(E,c){if(typeof E=="string"){const y=this._requestManager.transformRequest(E,"Style");o.h(y,new AbortController).then(B=>{this._updateDiff(B.data,c)}).catch(B=>{B&&this.fire(new o.j(B))})}else typeof E=="object"&&this._updateDiff(E,c)}_updateDiff(E,c){try{this.style.setState(E,c)&&this._update(!0)}catch(y){o.w(`Unable to perform style diff: ${y.message||y.error||y}.  Rebuilding the style from scratch.`),this._updateStyle(E,c)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():o.w("There is no style added to the map.")}addSource(E,c){return this._lazyInitEmptyStyle(),this.style.addSource(E,c),this._update(!0)}isSourceLoaded(E){const c=this.style&&this.style.sourceCaches[E];if(c!==void 0)return c.loaded();this.fire(new o.j(new Error(`There is no source with ID '${E}'`)))}setTerrain(E){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),E){const c=this.style.sourceCaches[E.source];if(!c)throw new Error(`cannot load terrain, because there exists no source with ID: ${E.source}`);this.terrain===null&&c.reload();for(const y in this.style._layers){const B=this.style._layers[y];B.type==="hillshade"&&B.source===E.source&&o.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new So(this.painter,c,E),this.painter.renderToTexture=new el(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=y=>{y.dataType==="style"?this.terrain.sourceCache.freeRtt():y.dataType==="source"&&y.tile&&(y.sourceId!==E.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(y.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new o.k("terrain",{terrain:E})),this}getTerrain(){var E,c;return(c=(E=this.terrain)===null||E===void 0?void 0:E.options)!==null&&c!==void 0?c:null}areTilesLoaded(){const E=this.style&&this.style.sourceCaches;for(const c in E){const y=E[c]._tiles;for(const B in y){const S=y[B];if(S.state!=="loaded"&&S.state!=="errored")return!1}}return!0}removeSource(E){return this.style.removeSource(E),this._update(!0)}getSource(E){return this.style.getSource(E)}addImage(E,c){let y=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{pixelRatio:B=1,sdf:S=!1,stretchX:F,stretchY:H,content:j,textFitWidth:Z,textFitHeight:se}=y;if(this._lazyInitEmptyStyle(),!(c instanceof HTMLImageElement||o.b(c))){if(c.width===void 0||c.height===void 0)return this.fire(new o.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:he,height:ue,data:Te}=c,Fe=c;return this.style.addImage(E,{data:new o.R({width:he,height:ue},new Uint8Array(Te)),pixelRatio:B,stretchX:F,stretchY:H,content:j,textFitWidth:Z,textFitHeight:se,sdf:S,version:0,userImage:Fe}),Fe.onAdd&&Fe.onAdd(this,E),this}}{const{width:he,height:ue,data:Te}=x.getImageData(c);this.style.addImage(E,{data:new o.R({width:he,height:ue},Te),pixelRatio:B,stretchX:F,stretchY:H,content:j,textFitWidth:Z,textFitHeight:se,sdf:S,version:0})}}updateImage(E,c){const y=this.style.getImage(E);if(!y)return this.fire(new o.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const B=c instanceof HTMLImageElement||o.b(c)?x.getImageData(c):c,{width:S,height:F,data:H}=B;if(S===void 0||F===void 0)return this.fire(new o.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(S!==y.data.width||F!==y.data.height)return this.fire(new o.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const j=!(c instanceof HTMLImageElement||o.b(c));return y.data.replace(H,j),this.style.updateImage(E,y),this}getImage(E){return this.style.getImage(E)}hasImage(E){return E?!!this.style.getImage(E):(this.fire(new o.j(new Error("Missing required image id"))),!1)}removeImage(E){this.style.removeImage(E)}loadImage(E){return ce.getImage(this._requestManager.transformRequest(E,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(E,c){return this._lazyInitEmptyStyle(),this.style.addLayer(E,c),this._update(!0)}moveLayer(E,c){return this.style.moveLayer(E,c),this._update(!0)}removeLayer(E){return this.style.removeLayer(E),this._update(!0)}getLayer(E){return this.style.getLayer(E)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(E,c,y){return this.style.setLayerZoomRange(E,c,y),this._update(!0)}setFilter(E,c){let y=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.style.setFilter(E,c,y),this._update(!0)}getFilter(E){return this.style.getFilter(E)}setPaintProperty(E,c,y){let B=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return this.style.setPaintProperty(E,c,y,B),this._update(!0)}getPaintProperty(E,c){return this.style.getPaintProperty(E,c)}setLayoutProperty(E,c,y){let B=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return this.style.setLayoutProperty(E,c,y,B),this._update(!0)}getLayoutProperty(E,c){return this.style.getLayoutProperty(E,c)}setGlyphs(E){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setGlyphs(E,c),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(E,c){let y=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this._lazyInitEmptyStyle(),this.style.addSprite(E,c,y,B=>{B||this._update(!0)}),this}removeSprite(E){return this._lazyInitEmptyStyle(),this.style.removeSprite(E),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(E){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setSprite(E,c,y=>{y||this._update(!0)}),this}setLight(E){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setLight(E,c),this._update(!0)}getLight(){return this.style.getLight()}setSky(E){return this._lazyInitEmptyStyle(),this.style.setSky(E),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(E,c){return this.style.setFeatureState(E,c),this._update()}removeFeatureState(E,c){return this.style.removeFeatureState(E,c),this._update()}getFeatureState(E){return this.style.getFeatureState(E)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let E=0,c=0;return this._container&&(E=this._container.clientWidth||400,c=this._container.clientHeight||300),[E,c]}_setupContainer(){const E=this._container;E.classList.add("maplibregl-map");const c=this._canvasContainer=T.create("div","maplibregl-canvas-container",E);this._interactive&&c.classList.add("maplibregl-interactive"),this._canvas=T.create("canvas","maplibregl-canvas",c),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const y=this._containerDimensions(),B=this._getClampedPixelRatio(y[0],y[1]);this._resizeCanvas(y[0],y[1],B);const S=this._controlContainer=T.create("div","maplibregl-control-container",E),F=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(H=>{F[H]=T.create("div",`maplibregl-ctrl-${H} `,S)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(E,c,y){this._canvas.width=Math.floor(y*E),this._canvas.height=Math.floor(y*c),this._canvas.style.width=`${E}px`,this._canvas.style.height=`${c}px`}_setupPainter(){const E={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let c=null;this._canvas.addEventListener("webglcontextcreationerror",B=>{c={requestedAttributes:E},B&&(c.statusMessage=B.statusMessage,c.type=B.type)},{once:!0});const y=this._canvas.getContext("webgl2",E)||this._canvas.getContext("webgl",E);if(!y){const B="Failed to initialize WebGL";throw c?(c.message=B,new Error(JSON.stringify(c))):new Error(B)}this.painter=new bl(y,this.transform),I.testSupport(y)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(E){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||E,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(E){return this._update(),this._renderTaskQueue.add(E)}_cancelRenderFrame(E){this._renderTaskQueue.remove(E)}_render(E){const c=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(E),this._removed)return;let y=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const S=this.transform.zoom,F=x.now();this.style.zoomHistory.update(S,F);const H=new o.z(S,{now:F,fadeDuration:c,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),j=H.crossFadingFactor();j===1&&j===this._crossFadingFactor||(y=!0,this._crossFadingFactor=j),this.style.update(H)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,c,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:c,showPadding:this.showPadding}),this.fire(new o.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,o.bf.mark(o.bg.load),this.fire(new o.k("load"))),this.style&&(this.style.hasTransitions()||y)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const B=this._sourcesDirty||this._styleDirty||this._placementDirty;return B||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new o.k("idle")),!this._loaded||this._fullyLoaded||B||(this._fullyLoaded=!0,o.bf.mark(o.bg.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var E;this._hash&&this._hash.remove();for(const y of this._controls)y.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),ce.removeThrottleControl(this._imageQueueHandle),(E=this._resizeObserver)===null||E===void 0||E.disconnect();const c=this.painter.context.gl.getExtension("WEBGL_lose_context");c!=null&&c.loseContext&&c.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),T.remove(this._canvasContainer),T.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),o.bf.clearMetrics(),this._removed=!0,this.fire(new o.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,x.frameAsync(this._frameRequest).then(E=>{o.bf.frame(E),this._frameRequest=null,this._render(E)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(E){this._showTileBoundaries!==E&&(this._showTileBoundaries=E,this._update())}get showPadding(){return!!this._showPadding}set showPadding(E){this._showPadding!==E&&(this._showPadding=E,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(E){this._showCollisionBoxes!==E&&(this._showCollisionBoxes=E,E?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(E){this._showOverdrawInspector!==E&&(this._showOverdrawInspector=E,this._update())}get repaint(){return!!this._repaint}set repaint(E){this._repaint!==E&&(this._repaint=E,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(E){this._vertices=E,this._update()}get version(){return Gh}getCameraTargetElevation(){return this.transform.elevation}},a.MapMouseEvent=xs,a.MapTouchEvent=vl,a.MapWheelEvent=vf,a.Marker=bc,a.NavigationControl=class{constructor(E){this._updateZoomButtons=()=>{const c=this._map.getZoom(),y=c===this._map.getMaxZoom(),B=c===this._map.getMinZoom();this._zoomInButton.disabled=y,this._zoomOutButton.disabled=B,this._zoomInButton.setAttribute("aria-disabled",y.toString()),this._zoomOutButton.setAttribute("aria-disabled",B.toString())},this._rotateCompassArrow=()=>{const c=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=c},this._setButtonTitle=(c,y)=>{const B=this._map._getUIString(`NavigationControl.${y}`);c.title=B,c.setAttribute("aria-label",B)},this.options=o.e({},Qh,E),this._container=T.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",c=>c.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",c=>this._map.zoomIn({},{originalEvent:c})),T.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",c=>this._map.zoomOut({},{originalEvent:c})),T.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",c=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:c}):this._map.resetNorth({},{originalEvent:c})}),this._compassIcon=T.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(E){return this._map=E,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new xf(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){T.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(E,c){const y=T.create("button",E,this._container);return y.type="button",y.addEventListener("click",c),y}},a.Popup=class extends o.E{constructor(E){super(),this.remove=()=>(this._content&&T.remove(this._content),this._container&&(T.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new o.k("close"))),this),this._onMouseUp=c=>{this._update(c.point)},this._onMouseMove=c=>{this._update(c.point)},this._onDrag=c=>{this._update(c.point)},this._update=c=>{var y;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=T.create("div","maplibregl-popup",this._map.getContainer()),this._tip=T.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const j of this.options.className.split(" "))this._container.classList.add(j);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Fi(this._lngLat,this._flatPos,this._map.transform):(y=this._lngLat)===null||y===void 0?void 0:y.wrap(),this._trackPointer&&!c)return;const B=this._flatPos=this._pos=this._trackPointer&&c?c:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&c?c:this._map.transform.locationPoint(this._lngLat));let S=this.options.anchor;const F=z(this.options.offset);if(!S){const j=this._container.offsetWidth,Z=this._container.offsetHeight;let se;se=B.y+F.bottom.y<Z?["top"]:B.y>this._map.transform.height-Z?["bottom"]:[],B.x<j/2?se.push("left"):B.x>this._map.transform.width-j/2&&se.push("right"),S=se.length===0?"bottom":se.join("-")}let H=B.add(F[S]);this.options.subpixelPositioning||(H=H.round()),T.setTransform(this._container,`${un[S]} translate(${H.x}px,${H.y}px)`),$h(this._container,S,"popup")},this._onClose=()=>{this.remove()},this.options=o.e(Object.create(Wn),E)}addTo(E){return this._map&&this.remove(),this._map=E,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new o.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(E){return this._lngLat=o.N.convert(E),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(E){return this.setDOMContent(document.createTextNode(E))}setHTML(E){const c=document.createDocumentFragment(),y=document.createElement("body");let B;for(y.innerHTML=E;B=y.firstChild,B;)c.appendChild(B);return this.setDOMContent(c)}getMaxWidth(){var E;return(E=this._container)===null||E===void 0?void 0:E.style.maxWidth}setMaxWidth(E){return this.options.maxWidth=E,this._update(),this}setDOMContent(E){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=T.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(E),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(E){return this._container&&this._container.classList.add(E),this}removeClassName(E){return this._container&&this._container.classList.remove(E),this}setOffset(E){return this.options.offset=E,this._update(),this}toggleClassName(E){if(this._container)return this._container.classList.toggle(E)}setSubpixelPositioning(E){this.options.subpixelPositioning=E}_createCloseButton(){this.options.closeButton&&(this._closeButton=T.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const E=this._container.querySelector(Eu);E&&E.focus()}},a.RasterDEMTileSource=Mr,a.RasterTileSource=mr,a.ScaleControl=class{constructor(E){this._onMove=()=>{ci(this._map,this._container,this.options)},this.setUnit=c=>{this.options.unit=c,ci(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Cl),E)}getDefaultPosition(){return"bottom-left"}onAdd(E){return this._map=E,this._container=T.create("div","maplibregl-ctrl maplibregl-ctrl-scale",E.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){T.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},a.ScrollZoomHandler=Sa,a.Style=ds,a.TerrainControl=class{constructor(E){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=E}onAdd(E){return this._map=E,this._container=T.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=T.create("button","maplibregl-ctrl-terrain",this._container),T.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){T.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},a.TwoFingersTouchPitchHandler=Qi,a.TwoFingersTouchRotateHandler=zh,a.TwoFingersTouchZoomHandler=Qc,a.TwoFingersTouchZoomRotateHandler=Vh,a.VectorTileSource=mn,a.VideoSource=Bn,a.addSourceType=(E,c)=>o._(void 0,void 0,void 0,function*(){if(ei(E))throw new Error(`A source type called "${E}" already exists.`);((y,B)=>{$n[y]=B})(E,c)}),a.clearPrewarmedResources=function(){const E=qt;E&&(E.isPreloaded()&&E.numActive()===1?(E.release(Bt),qt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},a.getMaxParallelImageRequests=function(){return o.a.MAX_PARALLEL_IMAGE_REQUESTS},a.getRTLTextPluginStatus=function(){return nn().getRTLTextPluginStatus()},a.getVersion=function(){return X},a.getWorkerCount=function(){return St.workerCount},a.getWorkerUrl=function(){return o.a.WORKER_URL},a.importScriptInWorkers=function(E){return kr().broadcast("IS",E)},a.prewarm=function(){ar().acquire(Bt)},a.setMaxParallelImageRequests=function(E){o.a.MAX_PARALLEL_IMAGE_REQUESTS=E},a.setRTLTextPlugin=function(E,c){return nn().setRTLTextPlugin(E,c)},a.setWorkerCount=function(E){St.workerCount=E},a.setWorkerUrl=function(E){o.a.WORKER_URL=E}});var s=t;return s})})(UQ);var MRe=UQ.exports,PRe=Object.defineProperty,FRe=(r,e,t)=>e in r?PRe(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Is=(r,e,t)=>(FRe(r,typeof e!="symbol"?e+"":e,t),t);let RRe=class{constructor(e){Is(this,"map"),Is(this,"width"),Is(this,"height"),Is(this,"svgCanvas"),Is(this,"xLine"),Is(this,"yLine"),Is(this,"color","#535353"),this.map=e,this.mapResize=this.mapResize.bind(this)}create(){this.updateValues(),this.map!==void 0?(this.map.on("resize",this.mapResize),this.createCanvas(this.map.getCanvasContainer())):console.error("map object is null")}updateValues(){var e,t;this.width=(e=this.map)==null?void 0:e.getCanvas().clientWidth,this.height=(t=this.map)==null?void 0:t.getCanvas().clientHeight}mapResize(){this.updateValues(),this.updateCanvas()}updateCanvas(){if(this.svgCanvas!==void 0&&this.yLine!==void 0&&this.xLine!==void 0&&this.width!==void 0&&this.height!==void 0){this.svgCanvas.setAttribute("width",`${this.width}px`),this.svgCanvas.setAttribute("height",`${this.height}px`);const e=this.width/2,t=this.height/2;this.yLine.setAttribute("x1",`${e}px`),this.yLine.setAttribute("y1","0px"),this.yLine.setAttribute("x2",`${e}px`),this.yLine.setAttribute("y2",`${this.height}px`),this.xLine.setAttribute("x1","0px"),this.xLine.setAttribute("y1",`${t}px`),this.xLine.setAttribute("x2",`${this.width}px`),this.xLine.setAttribute("y2",`${t}px`)}else console.error("element value is null")}createCanvas(e){if(this.width!==void 0&&this.height!==void 0){const t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.style.position="relative",t.setAttribute("width",`${this.width}px`),t.setAttribute("height",`${this.height}px`);const n=this.width/2,i=this.height/2;this.yLine=t.appendChild(this.createLine(n,0,n,this.height,this.color,"2px")),this.xLine=t.appendChild(this.createLine(0,i,this.width,i,this.color,"2px")),e==null||e.appendChild(t),this.svgCanvas=t}}createLine(e,t,n,i,s,a){const o=document.createElementNS("http://www.w3.org/2000/svg","line");return o.setAttribute("x1",e),o.setAttribute("y1",t),o.setAttribute("x2",n),o.setAttribute("y2",i),o.setAttribute("stroke-dasharray","5,5"),o.setAttribute("stroke",s),o.setAttribute("stroke-width",a),o}destroy(){this.xLine!==void 0&&(this.xLine.remove(),this.xLine=void 0),this.yLine!==void 0&&(this.yLine.remove(),this.yLine=void 0),this.svgCanvas!==void 0&&(this.svgCanvas.remove(),this.svgCanvas=void 0),this.map!==void 0&&(this.map.off("resize",this.mapResize),this.map=void 0)}};const rR={72:72,96:96,200:200,300:300,400:400},wA={JPEG:"jpg",PNG:"png",PDF:"pdf",SVG:"svg"},xb={Landscape:"landscape",Portrait:"portrait"},tm={LETTER:[279,216],A2:[594,420],A3:[420,297],A4:[297,210],A5:[210,148],A6:[148,105],B2:[707,500],B3:[500,353],B4:[353,250],B5:[250,176],B6:[176,125]},S0={in:"in",mm:"mm"};let LRe=class{constructor(e){Is(this,"map"),Is(this,"width"),Is(this,"height"),Is(this,"unit"),Is(this,"svgCanvas"),Is(this,"svgPath");var t,n,i;if(this.map=e,this.map===void 0)return;this.mapResize=this.mapResize.bind(this),this.map.on("resize",this.mapResize);const s=(t=this.map)==null?void 0:t.getCanvas().clientWidth,a=(n=this.map)==null?void 0:n.getCanvas().clientHeight,o=document.createElementNS("http://www.w3.org/2000/svg","svg");o.style.position="absolute",o.style.top="0px",o.style.left="0px",o.setAttribute("width",`${s}px`),o.setAttribute("height",`${a}px`);const h=document.createElementNS("http://www.w3.org/2000/svg","path");h.setAttribute("style","fill:#888888;stroke-width:0"),h.setAttribute("fill-opacity","0.5"),o.append(h),(i=this.map)==null||i.getCanvasContainer().appendChild(o),this.svgCanvas=o,this.svgPath=h}mapResize(){this.generateCutOut()}updateArea(e,t){this.width=e,this.height=t,this.unit=S0.mm,this.generateCutOut()}generateCutOut(){var e,t;if(this.map===void 0||this.svgCanvas===void 0||this.svgPath===void 0)return;const n=this.toPixels(this.width),i=this.toPixels(this.height),s=(e=this.map)==null?void 0:e.getCanvas().clientWidth,a=(t=this.map)==null?void 0:t.getCanvas().clientHeight,o=s/2-n/2,h=o+n,f=a/2-i/2,_=f+i;this.svgCanvas.setAttribute("width",`${s}px`),this.svgCanvas.setAttribute("height",`${a}px`),this.svgPath.setAttribute("d",`M 0 0 L ${s} 0 L ${s} ${a} L 0 ${a} M ${o} ${f} L ${o} ${_} L ${h} ${_} L ${h} ${f}`)}destroy(){this.svgCanvas!==void 0&&(this.svgCanvas.remove(),this.svgCanvas=void 0),this.map!==void 0&&(this.map=void 0)}toPixels(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:96;return this.unit===S0.mm&&(t/=25.4),t*e}};const NQ={PageSize:"Page Size",PageOrientation:"Page Orientation",Format:"Format",DPI:"DPI",Generate:"Generate",LanguageName:"English",LanguageCode:"en"},DRe={PageSize:"Taille de page",PageOrientation:"Orientation de la page",Format:"Format",DPI:"DPI",Generate:"Gnrer",LanguageName:"Franais",LanguageCode:"fr"},ORe={PageSize:"Sivukoko",PageOrientation:"Sivun suunta",Format:"Muoto",DPI:"DPI",Generate:"Generoi",LanguageName:"Suomalainen",LanguageCode:"fi"},kRe={PageSize:"Papierformat",PageOrientation:"Papierausrichtung",Format:"Dateiformat",DPI:"Druckauflsung",Generate:"Erstellen",LanguageName:"Deutsch",LanguageCode:"de"},URe={PageSize:"Sidstorlek",PageOrientation:"Sidorientering",Format:"Format",DPI:"DPI",Generate:"Generera",LanguageName:"Svenska",LanguageCode:"sv"},NRe={PageSize:"Tamao de pgina",PageOrientation:"Orientacin de pgina",Format:"Formato",DPI:"DPI",Generate:"Generar",LanguageName:"Espaola",LanguageCode:"es"},zRe={PageSize:"Mida",PageOrientation:"Orientaci",Format:"Format",DPI:"DPI",Generate:"Genera",LanguageName:"Catalan",LanguageCode:"ca"},HRe={PageSize:"Kch thc trang",PageOrientation:"Loi trang",Format:"nh dng",DPI:"Mt  im nh (DPI)",Generate:"To",LanguageName:"Ting Vit",LanguageCode:"vi"},VRe={PageSize:" ",PageOrientation:" ",Format:"",DPI:"DPI",Generate:"",LanguageName:"",LanguageCode:"uk"},GRe={PageSize:"",PageOrientation:"",Format:"",DPI:"",Generate:"",LanguageName:"",LanguageCode:"zhHans"},QRe={PageSize:"",PageOrientation:"",Format:"",DPI:"",Generate:"",LanguageName:"",LanguageCode:"zhHant"},$Re={PageSize:"",PageOrientation:"",Format:"",DPI:"DPI",Generate:"",LanguageName:"",LanguageCode:"ja"},jRe={PageSize:"Tamanho da pgina",PageOrientation:"Orientao da pgina",Format:"Formato",DPI:"DPI",Generate:"Gerar",LanguageName:"Portugus",LanguageCode:"pt"},qRe=[NQ,DRe,ORe,kRe,URe,NRe,zRe,HRe,VRe,GRe,QRe,$Re,jRe],KRe=r=>qRe.find(e=>e.LanguageCode===r)??NQ;(function(r){var e={};function t(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return r[n].call(i.exports,i,i.exports,t),i.l=!0,i.exports}t.m=r,t.c=e,t.d=function(n,i,s){t.o(n,i)||Object.defineProperty(n,i,{enumerable:!0,get:s})},t.r=function(n){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},t.t=function(n,i){if(1&i&&(n=t(n)),8&i||4&i&&typeof n=="object"&&n&&n.__esModule)return n;var s=Object.create(null);if(t.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:n}),2&i&&typeof n!="string")for(var a in n)t.d(s,a,(function(o){return n[o]}).bind(null,a));return s},t.n=function(n){var i=n&&n.__esModule?function(){return n.default}:function(){return n};return t.d(i,"a",i),i},t.o=function(n,i){return Object.prototype.hasOwnProperty.call(n,i)},t.p="",t(t.s=0)})([function(r,e,t){r.exports=t(1)},function(r,e){function t(i,s){for(var a=0;a<s.length;a++){var o=s[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(i,o.key,o)}}var n=function(){function i(){(function(o,h){if(!(o instanceof h))throw new TypeError("Cannot call a class as a function")})(this,i),this.options={overlayBackgroundColor:"#666666",overlayOpacity:.6,spinnerIcon:"ball-circus",spinnerColor:"#000",spinnerSize:"3x",overlayIDName:"overlay",spinnerIDName:"spinner",offsetY:0,offsetX:0,lockScroll:!1,containerID:null,spinnerZIndex:99999,overlayZIndex:99998},this.stylesheetBaseURL="https://cdn.jsdelivr.net/npm/load-awesome@1.1.0/css/",this.spinner=null,this.spinnerStylesheetURL=null,this.numberOfEmptyDivForSpinner={"ball-8bits":16,"ball-atom":4,"ball-beat":3,"ball-circus":5,"ball-climbing-dot":1,"ball-clip-rotate":1,"ball-clip-rotate-multiple":2,"ball-clip-rotate-pulse":2,"ball-elastic-dots":5,"ball-fall":3,"ball-fussion":4,"ball-grid-beat":9,"ball-grid-pulse":9,"ball-newton-cradle":4,"ball-pulse":3,"ball-pulse-rise":5,"ball-pulse-sync":3,"ball-rotate":1,"ball-running-dots":5,"ball-scale":1,"ball-scale-multiple":3,"ball-scale-pulse":2,"ball-scale-ripple":1,"ball-scale-ripple-multiple":3,"ball-spin":8,"ball-spin-clockwise":8,"ball-spin-clockwise-fade":8,"ball-spin-clockwise-fade-rotating":8,"ball-spin-fade":8,"ball-spin-fade-rotating":8,"ball-spin-rotate":2,"ball-square-clockwise-spin":8,"ball-square-spin":8,"ball-triangle-path":3,"ball-zig-zag":2,"ball-zig-zag-deflect":2,cog:1,"cube-transition":2,fire:3,"line-scale":5,"line-scale-party":5,"line-scale-pulse-out":5,"line-scale-pulse-out-rapid":5,"line-spin-clockwise-fade":8,"line-spin-clockwise-fade-rotating":8,"line-spin-fade":8,"line-spin-fade-rotating":8,pacman:6,"square-jelly-box":2,"square-loader":1,"square-spin":1,timer:1,"triangle-skew-spin":1}}var s,a;return s=i,(a=[{key:"show",value:function(o){this.setOptions(o),this.addSpinnerStylesheet(),this.generateSpinnerElement(),this.options.lockScroll&&(document.body.style.overflow="hidden",document.documentElement.style.overflow="hidden"),this.generateAndAddOverlayElement()}},{key:"hide",value:function(){this.options.lockScroll&&(document.body.style.overflow="",document.documentElement.style.overflow="");var o=document.getElementById("loading-overlay-stylesheet");o&&(o.disabled=!0,o.parentNode.removeChild(o),document.getElementById(this.options.overlayIDName).remove(),document.getElementById(this.options.spinnerIDName).remove())}},{key:"setOptions",value:function(o){if(o!==void 0)for(var h in o)this.options[h]=o[h]}},{key:"generateAndAddOverlayElement",value:function(){var o="50%";this.options.offsetX!==0&&(o="calc(50% + "+this.options.offsetX+")");var h="50%";if(this.options.offsetY!==0&&(h="calc(50% + "+this.options.offsetY+")"),this.options.containerID&&document.body.contains(document.getElementById(this.options.containerID))){var f='<div id="'.concat(this.options.overlayIDName,'" style="display: block !important; position: absolute; top: 0; left: 0; overflow: auto; opacity: ').concat(this.options.overlayOpacity,"; background: ").concat(this.options.overlayBackgroundColor,'; z-index: 50; width: 100%; height: 100%;"></div><div id="').concat(this.options.spinnerIDName,'" style="display: block !important; position: absolute; top: ').concat(h,"; left: ").concat(o,'; -webkit-transform: translate(-50%); -ms-transform: translate(-50%); transform: translate(-50%); z-index: 9999;">').concat(this.spinner,"</div>"),_=document.getElementById(this.options.containerID);return _.style.position="relative",void _.insertAdjacentHTML("beforeend",f)}var x='<div id="'.concat(this.options.overlayIDName,'" style="display: block !important; position: fixed; top: 0; left: 0; overflow: auto; opacity: ').concat(this.options.overlayOpacity,"; background: ").concat(this.options.overlayBackgroundColor,"; z-index: ").concat(this.options.overlayZIndex,'; width: 100%; height: 100%;"></div><div id="').concat(this.options.spinnerIDName,'" style="display: block !important; position: fixed; top: ').concat(h,"; left: ").concat(o,"; -webkit-transform: translate(-50%); -ms-transform: translate(-50%); transform: translate(-50%); z-index: ").concat(this.options.spinnerZIndex,';">').concat(this.spinner,"</div>");document.body.insertAdjacentHTML("beforeend",x)}},{key:"generateSpinnerElement",value:function(){var o=this,h=Object.keys(this.numberOfEmptyDivForSpinner).find(function(_){return _===o.options.spinnerIcon}),f=this.generateEmptyDivElement(this.numberOfEmptyDivForSpinner[h]);this.spinner='<div style="color: '.concat(this.options.spinnerColor,'" class="la-').concat(this.options.spinnerIcon," la-").concat(this.options.spinnerSize,'">').concat(f,"</div>")}},{key:"addSpinnerStylesheet",value:function(){this.setSpinnerStylesheetURL();var o=document.createElement("link");o.setAttribute("id","loading-overlay-stylesheet"),o.setAttribute("rel","stylesheet"),o.setAttribute("type","text/css"),o.setAttribute("href",this.spinnerStylesheetURL),document.getElementsByTagName("head")[0].appendChild(o)}},{key:"setSpinnerStylesheetURL",value:function(){this.spinnerStylesheetURL=this.stylesheetBaseURL+this.options.spinnerIcon+".min.css"}},{key:"generateEmptyDivElement",value:function(o){for(var h="",f=1;f<=o;f++)h+="<div></div>";return h}}])&&t(s.prototype,a),i}();window.JsLoadingOverlay=new n,r.exports=JsLoadingOverlay}]);function Ms(r){"@babel/helpers - typeof";return Ms=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ms(r)}var ih=Uint8Array,Mu=Uint16Array,wb=Uint32Array,TB=new ih([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),SB=new ih([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),nR=new ih([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),zQ=function(r,e){for(var t=new Mu(31),n=0;n<31;++n)t[n]=e+=1<<r[n-1];for(var i=new wb(t[30]),n=1;n<30;++n)for(var s=t[n];s<t[n+1];++s)i[s]=s-t[n]<<5|n;return[t,i]},HQ=zQ(TB,2),VQ=HQ[0],iR=HQ[1];VQ[28]=258,iR[258]=28;for(var GQ=zQ(SB,0),WRe=GQ[0],QQ=GQ[1],sR=new Mu(32768),Fo=0;Fo<32768;++Fo){var Cp=(Fo&43690)>>>1|(Fo&21845)<<1;Cp=(Cp&52428)>>>2|(Cp&13107)<<2,Cp=(Cp&61680)>>>4|(Cp&3855)<<4,sR[Fo]=((Cp&65280)>>>8|(Cp&255)<<8)>>>1}for(var Wf=function(r,e,t){for(var n=r.length,i=0,s=new Mu(e);i<n;++i)++s[r[i]-1];var a=new Mu(e);for(i=0;i<e;++i)a[i]=a[i-1]+s[i-1]<<1;var o;if(t){o=new Mu(1<<e);var h=15-e;for(i=0;i<n;++i)if(r[i])for(var f=i<<4|r[i],_=e-r[i],x=a[r[i]-1]++<<_,T=x|(1<<_)-1;x<=T;++x)o[sR[x]>>>h]=f}else for(o=new Mu(n),i=0;i<n;++i)o[i]=sR[a[r[i]-1]++]>>>15-r[i];return o},Ep=new ih(288),Fo=0;Fo<144;++Fo)Ep[Fo]=8;for(var Fo=144;Fo<256;++Fo)Ep[Fo]=9;for(var Fo=256;Fo<280;++Fo)Ep[Fo]=7;for(var Fo=280;Fo<288;++Fo)Ep[Fo]=8;for(var Bb=new ih(32),Fo=0;Fo<32;++Fo)Bb[Fo]=5;var XRe=Wf(Ep,9,0),JRe=Wf(Ep,9,1),ZRe=Wf(Bb,5,0),YRe=Wf(Bb,5,1),oR=function(r){for(var e=r[0],t=1;t<r.length;++t)r[t]>e&&(e=r[t]);return e},rf=function(r,e,t){var n=e/8>>0;return(r[n]|r[n+1]<<8)>>>(e&7)&t},aR=function(r,e){var t=e/8>>0;return(r[t]|r[t+1]<<8|r[t+2]<<16)>>>(e&7)},lR=function(r){return(r/8>>0)+(r&7&&1)},$Q=function(r,e,t){(t==null||t>r.length)&&(t=r.length);var n=new(r instanceof Mu?Mu:r instanceof wb?wb:ih)(t-e);return n.set(r.subarray(e,t)),n},e5e=function(r,e,t){var n=r.length,i=!e||t,s=!t||t.i;t||(t={}),e||(e=new ih(n*3));var a=function(jt){var qt=e.length;if(jt>qt){var nr=new ih(Math.max(qt*2,jt));nr.set(e),e=nr}},o=t.f||0,h=t.p||0,f=t.b||0,_=t.l,x=t.d,T=t.m,I=t.n,N=n*8;do{if(!_){t.f=o=rf(r,h,1);var $=rf(r,h+1,3);if(h+=3,$)if($==1)_=JRe,x=YRe,T=9,I=5;else if($==2){var W=rf(r,h,31)+257,Y=rf(r,h+10,15)+4,ie=W+rf(r,h+5,31)+1;h+=14;for(var ce=new ih(ie),fe=new ih(19),ve=0;ve<Y;++ve)fe[nR[ve]]=rf(r,h+ve*3,7);h+=Y*3;var be=oR(fe),Qe=(1<<be)-1;if(!s&&h+ie*(be+7)>N)break;for(var Ue=Wf(fe,be,1),ve=0;ve<ie;){var st=Ue[rf(r,h,Qe)];h+=st&15;var at=st>>>4;if(at<16)ce[ve++]=at;else{var Le=0,ze=0;for(at==16?(ze=3+rf(r,h,3),h+=2,Le=ce[ve-1]):at==17?(ze=3+rf(r,h,7),h+=3):at==18&&(ze=11+rf(r,h,127),h+=7);ze--;)ce[ve++]=Le}}var tt=ce.subarray(0,W),Ne=ce.subarray(W);T=oR(tt),I=oR(Ne),_=Wf(tt,T,1),x=Wf(Ne,I,1)}else throw"invalid block type";else{var at=lR(h)+4,Ht=r[at-4]|r[at-3]<<8,Vt=at+Ht;if(Vt>n){if(s)throw"unexpected EOF";break}i&&a(f+Ht),e.set(r.subarray(at,Vt),f),t.b=f+=Ht,t.p=h=Vt*8;continue}if(h>N)throw"unexpected EOF"}i&&a(f+131072);for(var Jt=(1<<T)-1,Kt=(1<<I)-1,er=T+I+18;s||h+er<N;){var Le=_[aR(r,h)&Jt],Xt=Le>>>4;if(h+=Le&15,h>N)throw"unexpected EOF";if(!Le)throw"invalid length/literal";if(Xt<256)e[f++]=Xt;else if(Xt==256){_=null;break}else{var Fr=Xt-254;if(Xt>264){var ve=Xt-257,$e=TB[ve];Fr=rf(r,h,(1<<$e)-1)+VQ[ve],h+=$e}var ut=x[aR(r,h)&Kt],Bt=ut>>>4;if(!ut)throw"invalid distance";h+=ut&15;var Ne=WRe[Bt];if(Bt>3){var $e=SB[Bt];Ne+=aR(r,h)&(1<<$e)-1,h+=$e}if(h>N)throw"unexpected EOF";i&&a(f+131072);for(var St=f+Fr;f<St;f+=4)e[f]=e[f-Ne],e[f+1]=e[f+1-Ne],e[f+2]=e[f+2-Ne],e[f+3]=e[f+3-Ne];f=St}}t.l=_,t.p=h,t.b=f,_&&(o=1,t.m=T,t.d=x,t.n=I)}while(!o);return f==e.length?e:$Q(e,0,f)},BA=function(r,e,t){t<<=e&7;var n=e/8>>0;r[n]|=t,r[n+1]|=t>>>8},Cb=function(r,e,t){t<<=e&7;var n=e/8>>0;r[n]|=t,r[n+1]|=t>>>8,r[n+2]|=t>>>16},cR=function(r,e){for(var t=[],n=0;n<r.length;++n)r[n]&&t.push({s:n,f:r[n]});var i=t.length,s=t.slice();if(!i)return[new ih(0),0];if(i==1){var a=new ih(t[0].s+1);return a[t[0].s]=1,[a,1]}t.sort(function(ve,be){return ve.f-be.f}),t.push({s:-1,f:25001});var o=t[0],h=t[1],f=0,_=1,x=2;for(t[0]={s:-1,f:o.f+h.f,l:o,r:h};_!=i-1;)o=t[t[f].f<t[x].f?f++:x++],h=t[f!=_&&t[f].f<t[x].f?f++:x++],t[_++]={s:-1,f:o.f+h.f,l:o,r:h};for(var T=s[0].s,n=1;n<i;++n)s[n].s>T&&(T=s[n].s);var I=new Mu(T+1),N=uR(t[_-1],I,0);if(N>e){var n=0,$=0,W=N-e,Y=1<<W;for(s.sort(function(be,Qe){return I[Qe.s]-I[be.s]||be.f-Qe.f});n<i;++n){var ie=s[n].s;if(I[ie]>e)$+=Y-(1<<N-I[ie]),I[ie]=e;else break}for($>>>=W;$>0;){var ce=s[n].s;I[ce]<e?$-=1<<e-I[ce]++-1:++n}for(;n>=0&&$;--n){var fe=s[n].s;I[fe]==e&&(--I[fe],++$)}N=e}return[new ih(I),N]},uR=function(r,e,t){return r.s==-1?Math.max(uR(r.l,e,t+1),uR(r.r,e,t+1)):e[r.s]=t},jQ=function(r){for(var e=r.length;e&&!r[--e];);for(var t=new Mu(++e),n=0,i=r[0],s=1,a=function(h){t[n++]=h},o=1;o<=e;++o)if(r[o]==i&&o!=e)++s;else{if(!i&&s>2){for(;s>138;s-=138)a(32754);s>2&&(a(s>10?s-11<<5|28690:s-3<<5|12305),s=0)}else if(s>3){for(a(i),--s;s>6;s-=6)a(8304);s>2&&(a(s-3<<5|8208),s=0)}for(;s--;)a(i);s=1,i=r[o]}return[t.subarray(0,n),e]},Eb=function(r,e){for(var t=0,n=0;n<e.length;++n)t+=r[n]*e[n];return t},hR=function(r,e,t){var n=t.length,i=lR(e+2);r[i]=n&255,r[i+1]=n>>>8,r[i+2]=r[i]^255,r[i+3]=r[i+1]^255;for(var s=0;s<n;++s)r[i+s+4]=t[s];return(i+4+n)*8},qQ=function(r,e,t,n,i,s,a,o,h,f,_){BA(e,_++,t),++i[256];for(var x=cR(i,15),T=x[0],I=x[1],N=cR(s,15),$=N[0],W=N[1],Y=jQ(T),ie=Y[0],ce=Y[1],fe=jQ($),ve=fe[0],be=fe[1],Qe=new Mu(19),Ue=0;Ue<ie.length;++Ue)Qe[ie[Ue]&31]++;for(var Ue=0;Ue<ve.length;++Ue)Qe[ve[Ue]&31]++;for(var st=cR(Qe,7),at=st[0],Le=st[1],ze=19;ze>4&&!at[nR[ze-1]];--ze);var tt=f+5<<3,Ne=Eb(i,Ep)+Eb(s,Bb)+a,Ht=Eb(i,T)+Eb(s,$)+a+14+3*ze+Eb(Qe,at)+(2*Qe[16]+3*Qe[17]+7*Qe[18]);if(tt<=Ne&&tt<=Ht)return hR(e,_,r.subarray(h,h+f));var Vt,Jt,Kt,er;if(BA(e,_,1+(Ht<Ne)),_+=2,Ht<Ne){Vt=Wf(T,I,0),Jt=T,Kt=Wf($,W,0),er=$;var Xt=Wf(at,Le,0);BA(e,_,ce-257),BA(e,_+5,be-1),BA(e,_+10,ze-4),_+=14;for(var Ue=0;Ue<ze;++Ue)BA(e,_+3*Ue,at[nR[Ue]]);_+=3*ze;for(var Fr=[ie,ve],$e=0;$e<2;++$e)for(var ut=Fr[$e],Ue=0;Ue<ut.length;++Ue){var Bt=ut[Ue]&31;BA(e,_,Xt[Bt]),_+=at[Bt],Bt>15&&(BA(e,_,ut[Ue]>>>5&127),_+=ut[Ue]>>>12)}}else Vt=XRe,Jt=Ep,Kt=ZRe,er=Bb;for(var Ue=0;Ue<o;++Ue)if(n[Ue]>255){var Bt=n[Ue]>>>18&31;Cb(e,_,Vt[Bt+257]),_+=Jt[Bt+257],Bt>7&&(BA(e,_,n[Ue]>>>23&31),_+=TB[Bt]);var St=n[Ue]&31;Cb(e,_,Kt[St]),_+=er[St],St>3&&(Cb(e,_,n[Ue]>>>5&8191),_+=SB[St])}else Cb(e,_,Vt[n[Ue]]),_+=Jt[n[Ue]];return Cb(e,_,Vt[256]),_+Jt[256]},t5e=new wb([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),r5e=function(r,e,t,n,i,s){var a=r.length,o=new ih(n+a+5*(1+Math.floor(a/7e3))+i),h=o.subarray(n,o.length-i),f=0;if(!e||a<8)for(var _=0;_<=a;_+=65535){var x=_+65535;x<a?f=hR(h,f,r.subarray(_,x)):(h[_]=s,f=hR(h,f,r.subarray(_,a)))}else{for(var T=t5e[e-1],I=T>>>13,N=T&8191,$=(1<<t)-1,W=new Mu(32768),Y=new Mu($+1),ie=Math.ceil(t/3),ce=2*ie,fe=function(on){return(r[on]^r[on+1]<<ie^r[on+2]<<ce)&$},ve=new wb(25e3),be=new Mu(288),Qe=new Mu(32),Ue=0,st=0,_=0,at=0,Le=0,ze=0;_<a;++_){var tt=fe(_),Ne=_&32767,Ht=Y[tt];if(W[Ne]=Ht,Y[tt]=Ne,Le<=_){var Vt=a-_;if((Ue>7e3||at>24576)&&Vt>423){f=qQ(r,h,0,ve,be,Qe,st,at,ze,_-ze,f),at=Ue=st=0,ze=_;for(var Jt=0;Jt<286;++Jt)be[Jt]=0;for(var Jt=0;Jt<30;++Jt)Qe[Jt]=0}var Kt=2,er=0,Xt=N,Fr=Ne-Ht&32767;if(Vt>2&&tt==fe(_-Fr))for(var $e=Math.min(I,Vt)-1,ut=Math.min(32767,_),Bt=Math.min(258,Vt);Fr<=ut&&--Xt&&Ne!=Ht;){if(r[_+Kt]==r[_+Kt-Fr]){for(var St=0;St<Bt&&r[_+St]==r[_+St-Fr];++St);if(St>Kt){if(Kt=St,er=Fr,St>$e)break;for(var jt=Math.min(Fr,St-2),qt=0,Jt=0;Jt<jt;++Jt){var nr=_-Fr+Jt+32768&32767,ar=W[nr],$r=nr-ar+32768&32767;$r>qt&&(qt=$r,Ht=nr)}}}Ne=Ht,Ht=W[Ne],Fr+=Ne-Ht+32768&32767}if(er){ve[at++]=268435456|iR[Kt]<<18|QQ[er];var kr=iR[Kt]&31,Gr=QQ[er]&31;st+=TB[kr]+SB[Gr],++be[257+kr],++Qe[Gr],Le=_+Kt,++Ue}else ve[at++]=r[_],++be[r[_]]}}f=qQ(r,h,s,ve,be,Qe,st,at,ze,_-ze,f)}return $Q(o,0,n+lR(f)+i)},n5e=function(){var r=1,e=0;return{p:function(t){for(var n=r,i=e,s=t.length,a=0;a!=s;){for(var o=Math.min(a+5552,s);a<o;++a)n+=t[a],i+=n;n%=65521,i%=65521}r=n,e=i},d:function(){return(r>>>8<<16|(e&255)<<8|e>>>8)+((r&255)<<23)*2}}},i5e=function(r,e,t,n,i){return r5e(r,e.level==null?6:e.level,e.mem==null?Math.ceil(Math.max(8,Math.min(13,Math.log(r.length)))*1.5):12+e.mem,t,n,!i)},s5e=function(r,e,t){for(;t;++e)r[e]=t,t>>>=8},o5e=function(r,e){var t=e.level,n=t==0?0:t<6?1:t==9?3:2;r[0]=120,r[1]=n<<6|(n?32-2*n:1)},a5e=function(r){if((r[0]&15)!=8||r[0]>>>4>7||(r[0]<<8|r[1])%31)throw"invalid zlib data";if(r[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function dR(r,e){e===void 0&&(e={});var t=n5e();t.p(r);var n=i5e(r,e,2,4);return o5e(n,e),s5e(n,n.length-4,t.d()),n}function l5e(r,e){return e5e((a5e(r),r.subarray(2,-4)),e)}/** @license
*
* jsPDF - PDF Document creation from JavaScript
* Version 2.5.1 Built on 2022-01-28T15:37:57.791Z
*                      CommitID 00000000
*
* Copyright (c) 2010-2021 James Hall <james@parall.ax>, https://github.com/MrRio/jsPDF
*               2015-2021 yWorks GmbH, http://www.yworks.com
*               2015-2021 Lukas Hollnder <lukas.hollaender@yworks.com>, https://github.com/HackbrettXXX
*               2016-2018 Aras Abbasi <aras.abbasi@gmail.com>
*               2010 Aaron Spike, https://github.com/acspike
*               2012 Willow Systems Corporation, https://github.com/willowsystems
*               2012 Pablo Hess, https://github.com/pablohess
*               2012 Florian Jenett, https://github.com/fjenett
*               2013 Warren Weckesser, https://github.com/warrenweckesser
*               2013 Youssef Beddad, https://github.com/lifof
*               2013 Lee Driscoll, https://github.com/lsdriscoll
*               2013 Stefan Slonevskiy, https://github.com/stefslon
*               2013 Jeremy Morel, https://github.com/jmorel
*               2013 Christoph Hartmann, https://github.com/chris-rock
*               2014 Juan Pablo Gaviria, https://github.com/juanpgaviria
*               2014 James Makes, https://github.com/dollaruw
*               2014 Diego Casorran, https://github.com/diegocr
*               2014 Steven Spungin, https://github.com/Flamenco
*               2014 Kenneth Glassey, https://github.com/Gavvers
*
* Permission is hereby granted, free of charge, to any person obtaining
* a copy of this software and associated documentation files (the
* "Software"), to deal in the Software without restriction, including
* without limitation the rights to use, copy, modify, merge, publish,
* distribute, sublicense, and/or sell copies of the Software, and to
* permit persons to whom the Software is furnished to do so, subject to
* the following conditions:
*
* The above copyright notice and this permission notice shall be
* included in all copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
* MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
* LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
* OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
* WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
*
* Contributor(s):
*    siefkenj, ahwolf, rickygu, Midnith, saintclair, eaparango,
*    kim3er, mfo, alnorth, Flamenco
*/var _i=function(){return typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:this}();function fR(){_i.console&&typeof _i.console.log=="function"&&_i.console.log.apply(_i.console,arguments)}var po={log:fR,warn:function(r){_i.console&&(typeof _i.console.warn=="function"?_i.console.warn.apply(_i.console,arguments):fR.call(null,arguments))},error:function(r){_i.console&&(typeof _i.console.error=="function"?_i.console.error.apply(_i.console,arguments):fR(r))}};function AR(r,e,t){var n=new XMLHttpRequest;n.open("GET",r),n.responseType="blob",n.onload=function(){rm(n.response,e,t)},n.onerror=function(){po.error("could not download file")},n.send()}function KQ(r){var e=new XMLHttpRequest;e.open("HEAD",r,!1);try{e.send()}catch{}return e.status>=200&&e.status<=299}function IB(r){try{r.dispatchEvent(new MouseEvent("click"))}catch{var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),r.dispatchEvent(e)}}var Tb,pR,rm=_i.saveAs||((typeof window>"u"?"undefined":Ms(window))!=="object"||window!==_i?function(){}:typeof HTMLAnchorElement<"u"&&"download"in HTMLAnchorElement.prototype?function(r,e,t){var n=_i.URL||_i.webkitURL,i=document.createElement("a");e=e||r.name||"download",i.download=e,i.rel="noopener",typeof r=="string"?(i.href=r,i.origin!==location.origin?KQ(i.href)?AR(r,e,t):IB(i,i.target="_blank"):IB(i)):(i.href=n.createObjectURL(r),setTimeout(function(){n.revokeObjectURL(i.href)},4e4),setTimeout(function(){IB(i)},0))}:"msSaveOrOpenBlob"in navigator?function(r,e,t){if(e=e||r.name||"download",typeof r=="string")if(KQ(r))AR(r,e,t);else{var n=document.createElement("a");n.href=r,n.target="_blank",setTimeout(function(){IB(n)})}else navigator.msSaveOrOpenBlob(function(i,s){return s===void 0?s={autoBom:!1}:Ms(s)!=="object"&&(po.warn("Deprecated: Expected third argument to be a object"),s={autoBom:!s}),s.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(i.type)?new Blob(["\uFEFF",i],{type:i.type}):i}(r,t),e)}:function(r,e,t,n){if((n=n||open("","_blank"))&&(n.document.title=n.document.body.innerText="downloading..."),typeof r=="string")return AR(r,e,t);var i=r.type==="application/octet-stream",s=/constructor/i.test(_i.HTMLElement)||_i.safari,a=/CriOS\/[\d]+/.test(navigator.userAgent);if((a||i&&s)&&(typeof FileReader>"u"?"undefined":Ms(FileReader))==="object"){var o=new FileReader;o.onloadend=function(){var _=o.result;_=a?_:_.replace(/^data:[^;]*;/,"data:attachment/file;"),n?n.location.href=_:location=_,n=null},o.readAsDataURL(r)}else{var h=_i.URL||_i.webkitURL,f=h.createObjectURL(r);n?n.location=f:location.href=f,n=null,setTimeout(function(){h.revokeObjectURL(f)},4e4)}});/**
* A class to parse color values
* @author Stoyan Stefanov <sstoo@gmail.com>
* {@link   http://www.phpied.com/rgb-color-parser-in-javascript/}
* @license Use it if you like it
*/function WQ(r){var e;r=r||"",this.ok=!1,r.charAt(0)=="#"&&(r=r.substr(1,6)),r={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"}[r=(r=r.replace(/ /g,"")).toLowerCase()]||r;for(var t=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(o){return[parseInt(o[1]),parseInt(o[2]),parseInt(o[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(o){return[parseInt(o[1],16),parseInt(o[2],16),parseInt(o[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(o){return[parseInt(o[1]+o[1],16),parseInt(o[2]+o[2],16),parseInt(o[3]+o[3],16)]}}],n=0;n<t.length;n++){var i=t[n].re,s=t[n].process,a=i.exec(r);a&&(e=s(a),this.r=e[0],this.g=e[1],this.b=e[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var o=this.r.toString(16),h=this.g.toString(16),f=this.b.toString(16);return o.length==1&&(o="0"+o),h.length==1&&(h="0"+h),f.length==1&&(f="0"+f),"#"+o+h+f}}/**
* @license
* Joseph Myers does not specify a particular license for his work.
*
* Author: Joseph Myers
* Accessed from: http://www.myersdaily.org/joseph/javascript/md5.js
*
* Modified by: Owen Leong
*/function gR(r,e){var t=r[0],n=r[1],i=r[2],s=r[3];t=tu(t,n,i,s,e[0],7,-680876936),s=tu(s,t,n,i,e[1],12,-389564586),i=tu(i,s,t,n,e[2],17,606105819),n=tu(n,i,s,t,e[3],22,-1044525330),t=tu(t,n,i,s,e[4],7,-176418897),s=tu(s,t,n,i,e[5],12,1200080426),i=tu(i,s,t,n,e[6],17,-1473231341),n=tu(n,i,s,t,e[7],22,-45705983),t=tu(t,n,i,s,e[8],7,1770035416),s=tu(s,t,n,i,e[9],12,-1958414417),i=tu(i,s,t,n,e[10],17,-42063),n=tu(n,i,s,t,e[11],22,-1990404162),t=tu(t,n,i,s,e[12],7,1804603682),s=tu(s,t,n,i,e[13],12,-40341101),i=tu(i,s,t,n,e[14],17,-1502002290),t=ru(t,n=tu(n,i,s,t,e[15],22,1236535329),i,s,e[1],5,-165796510),s=ru(s,t,n,i,e[6],9,-1069501632),i=ru(i,s,t,n,e[11],14,643717713),n=ru(n,i,s,t,e[0],20,-373897302),t=ru(t,n,i,s,e[5],5,-701558691),s=ru(s,t,n,i,e[10],9,38016083),i=ru(i,s,t,n,e[15],14,-660478335),n=ru(n,i,s,t,e[4],20,-405537848),t=ru(t,n,i,s,e[9],5,568446438),s=ru(s,t,n,i,e[14],9,-1019803690),i=ru(i,s,t,n,e[3],14,-187363961),n=ru(n,i,s,t,e[8],20,1163531501),t=ru(t,n,i,s,e[13],5,-1444681467),s=ru(s,t,n,i,e[2],9,-51403784),i=ru(i,s,t,n,e[7],14,1735328473),t=nu(t,n=ru(n,i,s,t,e[12],20,-1926607734),i,s,e[5],4,-378558),s=nu(s,t,n,i,e[8],11,-2022574463),i=nu(i,s,t,n,e[11],16,1839030562),n=nu(n,i,s,t,e[14],23,-35309556),t=nu(t,n,i,s,e[1],4,-1530992060),s=nu(s,t,n,i,e[4],11,1272893353),i=nu(i,s,t,n,e[7],16,-155497632),n=nu(n,i,s,t,e[10],23,-1094730640),t=nu(t,n,i,s,e[13],4,681279174),s=nu(s,t,n,i,e[0],11,-358537222),i=nu(i,s,t,n,e[3],16,-722521979),n=nu(n,i,s,t,e[6],23,76029189),t=nu(t,n,i,s,e[9],4,-640364487),s=nu(s,t,n,i,e[12],11,-421815835),i=nu(i,s,t,n,e[15],16,530742520),t=iu(t,n=nu(n,i,s,t,e[2],23,-995338651),i,s,e[0],6,-198630844),s=iu(s,t,n,i,e[7],10,1126891415),i=iu(i,s,t,n,e[14],15,-1416354905),n=iu(n,i,s,t,e[5],21,-57434055),t=iu(t,n,i,s,e[12],6,1700485571),s=iu(s,t,n,i,e[3],10,-1894986606),i=iu(i,s,t,n,e[10],15,-1051523),n=iu(n,i,s,t,e[1],21,-2054922799),t=iu(t,n,i,s,e[8],6,1873313359),s=iu(s,t,n,i,e[15],10,-30611744),i=iu(i,s,t,n,e[6],15,-1560198380),n=iu(n,i,s,t,e[13],21,1309151649),t=iu(t,n,i,s,e[4],6,-145523070),s=iu(s,t,n,i,e[11],10,-1120210379),i=iu(i,s,t,n,e[2],15,718787259),n=iu(n,i,s,t,e[9],21,-343485551),r[0]=Tp(t,r[0]),r[1]=Tp(n,r[1]),r[2]=Tp(i,r[2]),r[3]=Tp(s,r[3])}function MB(r,e,t,n,i,s){return e=Tp(Tp(e,r),Tp(n,s)),Tp(e<<i|e>>>32-i,t)}function tu(r,e,t,n,i,s,a){return MB(e&t|~e&n,r,e,i,s,a)}function ru(r,e,t,n,i,s,a){return MB(e&n|t&~n,r,e,i,s,a)}function nu(r,e,t,n,i,s,a){return MB(e^t^n,r,e,i,s,a)}function iu(r,e,t,n,i,s,a){return MB(t^(e|~n),r,e,i,s,a)}function XQ(r){var e,t=r.length,n=[1732584193,-271733879,-1732584194,271733878];for(e=64;e<=r.length;e+=64)gR(n,c5e(r.substring(e-64,e)));r=r.substring(e-64);var i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<r.length;e++)i[e>>2]|=r.charCodeAt(e)<<(e%4<<3);if(i[e>>2]|=128<<(e%4<<3),e>55)for(gR(n,i),e=0;e<16;e++)i[e]=0;return i[14]=8*t,gR(n,i),n}function c5e(r){var e,t=[];for(e=0;e<64;e+=4)t[e>>2]=r.charCodeAt(e)+(r.charCodeAt(e+1)<<8)+(r.charCodeAt(e+2)<<16)+(r.charCodeAt(e+3)<<24);return t}Tb=_i.atob.bind(_i),pR=_i.btoa.bind(_i);var JQ="0123456789abcdef".split("");function u5e(r){for(var e="",t=0;t<4;t++)e+=JQ[r>>8*t+4&15]+JQ[r>>8*t&15];return e}function h5e(r){return String.fromCharCode((255&r)>>0,(65280&r)>>8,(16711680&r)>>16,(4278190080&r)>>24)}function mR(r){return XQ(r).map(h5e).join("")}var d5e=function(r){for(var e=0;e<r.length;e++)r[e]=u5e(r[e]);return r.join("")}(XQ("hello"))!="5d41402abc4b2a76b9719d911017c592";function Tp(r,e){if(d5e){var t=(65535&r)+(65535&e);return(r>>16)+(e>>16)+(t>>16)<<16|65535&t}return r+e&4294967295}/**
* @license
* FPDF is released under a permissive license: there is no usage restriction.
* You may embed it freely in your application (commercial or not), with or
* without modifications.
*
* Reference: http://www.fpdf.org/en/script/script37.php
*/function _R(r,e){var t,n,i,s;if(r!==t){for(var a=(i=r,s=1+(256/r.length>>0),new Array(s+1).join(i)),o=[],h=0;h<256;h++)o[h]=h;var f=0;for(h=0;h<256;h++){var _=o[h];f=(f+_+a.charCodeAt(h))%256,o[h]=o[f],o[f]=_}t=r,n=o}else o=n;var x=e.length,T=0,I=0,N="";for(h=0;h<x;h++)I=(I+(_=o[T=(T+1)%256]))%256,o[T]=o[I],o[I]=_,a=o[(o[T]+o[I])%256],N+=String.fromCharCode(e.charCodeAt(h)^a);return N}/**
* @license
* Licensed under the MIT License.
* http://opensource.org/licenses/mit-license
* Author: Owen Leong (@owenl131)
* Date: 15 Oct 2020
* References:
* https://www.cs.cmu.edu/~dst/Adobe/Gallery/anon21jul01-pdf-encryption.txt
* https://github.com/foliojs/pdfkit/blob/master/lib/security.js
* http://www.fpdf.org/en/script/script37.php
*/var ZQ={print:4,modify:8,copy:16,"annot-forms":32};function I0(r,e,t,n){this.v=1,this.r=2;var i=192;r.forEach(function(o){if(ZQ.perm!==void 0)throw new Error("Invalid permission: "+o);i+=ZQ[o]}),this.padding="(N^NuAd\0NV\b..\0h>/\fdSiz";var s=(e+this.padding).substr(0,32),a=(t+this.padding).substr(0,32);this.O=this.processOwnerPassword(s,a),this.P=-(1+(255^i)),this.encryptionKey=mR(s+this.O+this.lsbFirstWord(this.P)+this.hexToBytes(n)).substr(0,5),this.U=_R(this.encryptionKey,this.padding)}function M0(r){if(/[^\u0000-\u00ff]/.test(r))throw new Error("Invalid PDF Name Object: "+r+", Only accept ASCII characters.");for(var e="",t=r.length,n=0;n<t;n++){var i=r.charCodeAt(n);i<33||i===35||i===37||i===40||i===41||i===47||i===60||i===62||i===91||i===93||i===123||i===125||i>126?e+="#"+("0"+i.toString(16)).slice(-2):e+=r[n]}return e}function YQ(r){if(Ms(r)!=="object")throw new Error("Invalid Context passed to initialize PubSub (jsPDF-module)");var e={};this.subscribe=function(t,n,i){if(i=i||!1,typeof t!="string"||typeof n!="function"||typeof i!="boolean")throw new Error("Invalid arguments passed to PubSub.subscribe (jsPDF-module)");e.hasOwnProperty(t)||(e[t]={});var s=Math.random().toString(35);return e[t][s]=[n,!!i],s},this.unsubscribe=function(t){for(var n in e)if(e[n][t])return delete e[n][t],Object.keys(e[n]).length===0&&delete e[n],!0;return!1},this.publish=function(t){if(e.hasOwnProperty(t)){var n=Array.prototype.slice.call(arguments,1),i=[];for(var s in e[t]){var a=e[t][s];try{a[0].apply(r,n)}catch(o){_i.console&&po.error("jsPDF PubSub Error",o.message,o)}a[1]&&i.push(s)}i.length&&i.forEach(this.unsubscribe)}},this.getTopics=function(){return e}}function PB(r){if(!(this instanceof PB))return new PB(r);var e="opacity,stroke-opacity".split(",");for(var t in r)r.hasOwnProperty(t)&&e.indexOf(t)>=0&&(this[t]=r[t]);this.id="",this.objectNumber=-1}function e$(r,e){this.gState=r,this.matrix=e,this.id="",this.objectNumber=-1}function nm(r,e,t,n,i){if(!(this instanceof nm))return new nm(r,e,t,n,i);this.type=r==="axial"?2:3,this.coords=e,this.colors=t,e$.call(this,n,i)}function P0(r,e,t,n,i){if(!(this instanceof P0))return new P0(r,e,t,n,i);this.boundingBox=r,this.xStep=e,this.yStep=t,this.stream="",this.cloneIndex=0,e$.call(this,n,i)}function yi(r){var e,t=typeof arguments[0]=="string"?arguments[0]:"p",n=arguments[1],i=arguments[2],s=arguments[3],a=[],o=1,h=16,f="S",_=null;Ms(r=r||{})==="object"&&(t=r.orientation,n=r.unit||n,i=r.format||i,s=r.compress||r.compressPdf||s,(_=r.encryption||null)!==null&&(_.userPassword=_.userPassword||"",_.ownerPassword=_.ownerPassword||"",_.userPermissions=_.userPermissions||[]),o=typeof r.userUnit=="number"?Math.abs(r.userUnit):1,r.precision!==void 0&&(e=r.precision),r.floatPrecision!==void 0&&(h=r.floatPrecision),f=r.defaultPathOperation||"S"),a=r.filters||(s===!0?["FlateEncode"]:a),n=n||"mm",t=(""+(t||"P")).toLowerCase();var x=r.putOnlyUsedFonts||!1,T={},I={internal:{},__private__:{}};I.__private__.PubSub=YQ;var N="1.3",$=I.__private__.getPdfVersion=function(){return N};I.__private__.setPdfVersion=function(ne){N=ne};var W={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};I.__private__.getPageFormats=function(){return W};var Y=I.__private__.getPageFormat=function(ne){return W[ne]};i=i||"a4";var ie={COMPAT:"compat",ADVANCED:"advanced"},ce=ie.COMPAT;function fe(){this.saveGraphicsState(),We(new _t(nn,0,0,-nn,0,gl()*nn).toString()+" cm"),this.setFontSize(this.getFontSize()/nn),f="n",ce=ie.ADVANCED}function ve(){this.restoreGraphicsState(),f="S",ce=ie.COMPAT}var be=I.__private__.combineFontStyleAndFontWeight=function(ne,je){if(ne=="bold"&&je=="normal"||ne=="bold"&&je==400||ne=="normal"&&je=="italic"||ne=="bold"&&je=="italic")throw new Error("Invalid Combination of fontweight and fontstyle");return je&&(ne=je==400||je==="normal"?ne==="italic"?"italic":"normal":je!=700&&je!=="bold"||ne!=="normal"?(je==700?"bold":je)+""+ne:"bold"),ne};I.advancedAPI=function(ne){var je=ce===ie.COMPAT;return je&&fe.call(this),typeof ne!="function"||(ne(this),je&&ve.call(this)),this},I.compatAPI=function(ne){var je=ce===ie.ADVANCED;return je&&ve.call(this),typeof ne!="function"||(ne(this),je&&fe.call(this)),this},I.isAdvancedAPI=function(){return ce===ie.ADVANCED};var Qe,Ue=function(ne){if(ce!==ie.ADVANCED)throw new Error(ne+" is only available in 'advanced' API mode. You need to call advancedAPI() first.")},st=I.roundToPrecision=I.__private__.roundToPrecision=function(ne,je){var Tt=e||je;if(isNaN(ne)||isNaN(Tt))throw new Error("Invalid argument passed to jsPDF.roundToPrecision");return ne.toFixed(Tt).replace(/0+$/,"")};Qe=I.hpf=I.__private__.hpf=typeof h=="number"?function(ne){if(isNaN(ne))throw new Error("Invalid argument passed to jsPDF.hpf");return st(ne,h)}:h==="smart"?function(ne){if(isNaN(ne))throw new Error("Invalid argument passed to jsPDF.hpf");return st(ne,ne>-1&&ne<1?16:5)}:function(ne){if(isNaN(ne))throw new Error("Invalid argument passed to jsPDF.hpf");return st(ne,16)};var at=I.f2=I.__private__.f2=function(ne){if(isNaN(ne))throw new Error("Invalid argument passed to jsPDF.f2");return st(ne,2)},Le=I.__private__.f3=function(ne){if(isNaN(ne))throw new Error("Invalid argument passed to jsPDF.f3");return st(ne,3)},ze=I.scale=I.__private__.scale=function(ne){if(isNaN(ne))throw new Error("Invalid argument passed to jsPDF.scale");return ce===ie.COMPAT?ne*nn:ce===ie.ADVANCED?ne:void 0},tt=function(ne){return ce===ie.COMPAT?gl()-ne:ce===ie.ADVANCED?ne:void 0},Ne=function(ne){return ze(tt(ne))};I.__private__.setPrecision=I.setPrecision=function(ne){typeof parseInt(ne,10)=="number"&&(e=parseInt(ne,10))};var Ht,Vt="00000000000000000000000000000000",Jt=I.__private__.getFileId=function(){return Vt},Kt=I.__private__.setFileId=function(ne){return Vt=ne!==void 0&&/^[a-fA-F0-9]{32}$/.test(ne)?ne.toUpperCase():Vt.split("").map(function(){return"ABCDEF0123456789".charAt(Math.floor(16*Math.random()))}).join(""),_!==null&&(ai=new I0(_.userPermissions,_.userPassword,_.ownerPassword,Vt)),Vt};I.setFileId=function(ne){return Kt(ne),this},I.getFileId=function(){return Jt()};var er=I.__private__.convertDateToPDFDate=function(ne){var je=ne.getTimezoneOffset(),Tt=je<0?"+":"-",Qt=Math.floor(Math.abs(je/60)),rr=Math.abs(je%60),vr=[Tt,Bt(Qt),"'",Bt(rr),"'"].join("");return["D:",ne.getFullYear(),Bt(ne.getMonth()+1),Bt(ne.getDate()),Bt(ne.getHours()),Bt(ne.getMinutes()),Bt(ne.getSeconds()),vr].join("")},Xt=I.__private__.convertPDFDateToDate=function(ne){var je=parseInt(ne.substr(2,4),10),Tt=parseInt(ne.substr(6,2),10)-1,Qt=parseInt(ne.substr(8,2),10),rr=parseInt(ne.substr(10,2),10),vr=parseInt(ne.substr(12,2),10),Xr=parseInt(ne.substr(14,2),10);return new Date(je,Tt,Qt,rr,vr,Xr,0)},Fr=I.__private__.setCreationDate=function(ne){var je;if(ne===void 0&&(ne=new Date),ne instanceof Date)je=er(ne);else{if(!/^D:(20[0-2][0-9]|203[0-7]|19[7-9][0-9])(0[0-9]|1[0-2])([0-2][0-9]|3[0-1])(0[0-9]|1[0-9]|2[0-3])(0[0-9]|[1-5][0-9])(0[0-9]|[1-5][0-9])(\+0[0-9]|\+1[0-4]|-0[0-9]|-1[0-1])'(0[0-9]|[1-5][0-9])'?$/.test(ne))throw new Error("Invalid argument passed to jsPDF.setCreationDate");je=ne}return Ht=je},$e=I.__private__.getCreationDate=function(ne){var je=Ht;return ne==="jsDate"&&(je=Xt(Ht)),je};I.setCreationDate=function(ne){return Fr(ne),this},I.getCreationDate=function(ne){return $e(ne)};var ut,Bt=I.__private__.padd2=function(ne){return("0"+parseInt(ne)).slice(-2)},St=I.__private__.padd2Hex=function(ne){return("00"+(ne=ne.toString())).substr(ne.length)},jt=0,qt=[],nr=[],ar=0,$r=[],kr=[],Gr=!1,sn=nr,on=function(){jt=0,ar=0,nr=[],qt=[],$r=[],Rr=dr(),ln=dr()};I.__private__.setCustomOutputDestination=function(ne){Gr=!0,sn=ne};var pr=function(ne){Gr||(sn=ne)};I.__private__.resetCustomOutputDestination=function(){Gr=!1,sn=nr};var We=I.__private__.out=function(ne){return ne=ne.toString(),ar+=ne.length+1,sn.push(ne),sn},Pn=I.__private__.write=function(ne){return We(arguments.length===1?ne.toString():Array.prototype.join.call(arguments," "))},mn=I.__private__.getArrayBuffer=function(ne){for(var je=ne.length,Tt=new ArrayBuffer(je),Qt=new Uint8Array(Tt);je--;)Qt[je]=ne.charCodeAt(je);return Tt},mr=[["Helvetica","helvetica","normal","WinAnsiEncoding"],["Helvetica-Bold","helvetica","bold","WinAnsiEncoding"],["Helvetica-Oblique","helvetica","italic","WinAnsiEncoding"],["Helvetica-BoldOblique","helvetica","bolditalic","WinAnsiEncoding"],["Courier","courier","normal","WinAnsiEncoding"],["Courier-Bold","courier","bold","WinAnsiEncoding"],["Courier-Oblique","courier","italic","WinAnsiEncoding"],["Courier-BoldOblique","courier","bolditalic","WinAnsiEncoding"],["Times-Roman","times","normal","WinAnsiEncoding"],["Times-Bold","times","bold","WinAnsiEncoding"],["Times-Italic","times","italic","WinAnsiEncoding"],["Times-BoldItalic","times","bolditalic","WinAnsiEncoding"],["ZapfDingbats","zapfdingbats","normal",null],["Symbol","symbol","normal",null]];I.__private__.getStandardFonts=function(){return mr};var Mr=r.fontSize||16;I.__private__.setFontSize=I.setFontSize=function(ne){return Mr=ce===ie.ADVANCED?ne/nn:ne,this};var en,Wr=I.__private__.getFontSize=I.getFontSize=function(){return ce===ie.COMPAT?Mr:Mr*nn},gn=r.R2L||!1;I.__private__.setR2L=I.setR2L=function(ne){return gn=ne,this},I.__private__.getR2L=I.getR2L=function(){return gn};var Bn,Fn=I.__private__.setZoomMode=function(ne){var je=[void 0,null,"fullwidth","fullheight","fullpage","original"];if(/^(?:\d+\.\d*|\d*\.\d+|\d+)%$/.test(ne))en=ne;else if(isNaN(ne)){if(je.indexOf(ne)===-1)throw new Error('zoom must be Integer (e.g. 2), a percentage Value (e.g. 300%) or fullwidth, fullheight, fullpage, original. "'+ne+'" is not recognized.');en=ne}else en=parseInt(ne,10)};I.__private__.getZoomMode=function(){return en};var $n,ei=I.__private__.setPageMode=function(ne){if([void 0,null,"UseNone","UseOutlines","UseThumbs","FullScreen"].indexOf(ne)==-1)throw new Error('Page mode must be one of UseNone, UseOutlines, UseThumbs, or FullScreen. "'+ne+'" is not recognized.');Bn=ne};I.__private__.getPageMode=function(){return Bn};var br=I.__private__.setLayoutMode=function(ne){if([void 0,null,"continuous","single","twoleft","tworight","two"].indexOf(ne)==-1)throw new Error('Layout mode must be one of continuous, single, twoleft, tworight. "'+ne+'" is not recognized.');$n=ne};I.__private__.getLayoutMode=function(){return $n},I.__private__.setDisplayMode=I.setDisplayMode=function(ne,je,Tt){return Fn(ne),br(je),ei(Tt),this};var Cn={title:"",subject:"",author:"",keywords:"",creator:""};I.__private__.getDocumentProperty=function(ne){if(Object.keys(Cn).indexOf(ne)===-1)throw new Error("Invalid argument passed to jsPDF.getDocumentProperty");return Cn[ne]},I.__private__.getDocumentProperties=function(){return Cn},I.__private__.setDocumentProperties=I.setProperties=I.setDocumentProperties=function(ne){for(var je in Cn)Cn.hasOwnProperty(je)&&ne[je]&&(Cn[je]=ne[je]);return this},I.__private__.setDocumentProperty=function(ne,je){if(Object.keys(Cn).indexOf(ne)===-1)throw new Error("Invalid arguments passed to jsPDF.setDocumentProperty");return Cn[ne]=je};var Rn,nn,Ci,Cr,Tn,Xe={},He={},Je=[],Ve={},bt={},Mt={},$t={},Wt=null,Pe=0,Ae=[],ge=new YQ(I),we=r.hotfixes||[],Se={},ht={},At=[],_t=function ne(je,Tt,Qt,rr,vr,Xr){if(!(this instanceof ne))return new ne(je,Tt,Qt,rr,vr,Xr);isNaN(je)&&(je=1),isNaN(Tt)&&(Tt=0),isNaN(Qt)&&(Qt=0),isNaN(rr)&&(rr=1),isNaN(vr)&&(vr=0),isNaN(Xr)&&(Xr=0),this._matrix=[je,Tt,Qt,rr,vr,Xr]};Object.defineProperty(_t.prototype,"sx",{get:function(){return this._matrix[0]},set:function(ne){this._matrix[0]=ne}}),Object.defineProperty(_t.prototype,"shy",{get:function(){return this._matrix[1]},set:function(ne){this._matrix[1]=ne}}),Object.defineProperty(_t.prototype,"shx",{get:function(){return this._matrix[2]},set:function(ne){this._matrix[2]=ne}}),Object.defineProperty(_t.prototype,"sy",{get:function(){return this._matrix[3]},set:function(ne){this._matrix[3]=ne}}),Object.defineProperty(_t.prototype,"tx",{get:function(){return this._matrix[4]},set:function(ne){this._matrix[4]=ne}}),Object.defineProperty(_t.prototype,"ty",{get:function(){return this._matrix[5]},set:function(ne){this._matrix[5]=ne}}),Object.defineProperty(_t.prototype,"a",{get:function(){return this._matrix[0]},set:function(ne){this._matrix[0]=ne}}),Object.defineProperty(_t.prototype,"b",{get:function(){return this._matrix[1]},set:function(ne){this._matrix[1]=ne}}),Object.defineProperty(_t.prototype,"c",{get:function(){return this._matrix[2]},set:function(ne){this._matrix[2]=ne}}),Object.defineProperty(_t.prototype,"d",{get:function(){return this._matrix[3]},set:function(ne){this._matrix[3]=ne}}),Object.defineProperty(_t.prototype,"e",{get:function(){return this._matrix[4]},set:function(ne){this._matrix[4]=ne}}),Object.defineProperty(_t.prototype,"f",{get:function(){return this._matrix[5]},set:function(ne){this._matrix[5]=ne}}),Object.defineProperty(_t.prototype,"rotation",{get:function(){return Math.atan2(this.shx,this.sx)}}),Object.defineProperty(_t.prototype,"scaleX",{get:function(){return this.decompose().scale.sx}}),Object.defineProperty(_t.prototype,"scaleY",{get:function(){return this.decompose().scale.sy}}),Object.defineProperty(_t.prototype,"isIdentity",{get:function(){return this.sx===1&&this.shy===0&&this.shx===0&&this.sy===1&&this.tx===0&&this.ty===0}}),_t.prototype.join=function(ne){return[this.sx,this.shy,this.shx,this.sy,this.tx,this.ty].map(Qe).join(ne)},_t.prototype.multiply=function(ne){var je=ne.sx*this.sx+ne.shy*this.shx,Tt=ne.sx*this.shy+ne.shy*this.sy,Qt=ne.shx*this.sx+ne.sy*this.shx,rr=ne.shx*this.shy+ne.sy*this.sy,vr=ne.tx*this.sx+ne.ty*this.shx+this.tx,Xr=ne.tx*this.shy+ne.ty*this.sy+this.ty;return new _t(je,Tt,Qt,rr,vr,Xr)},_t.prototype.decompose=function(){var ne=this.sx,je=this.shy,Tt=this.shx,Qt=this.sy,rr=this.tx,vr=this.ty,Xr=Math.sqrt(ne*ne+je*je),bn=(ne/=Xr)*Tt+(je/=Xr)*Qt;Tt-=ne*bn,Qt-=je*bn;var qn=Math.sqrt(Tt*Tt+Qt*Qt);return bn/=qn,ne*(Qt/=qn)<je*(Tt/=qn)&&(ne=-ne,je=-je,bn=-bn,Xr=-Xr),{scale:new _t(Xr,0,0,qn,0,0),translate:new _t(1,0,0,1,rr,vr),rotate:new _t(ne,je,-je,ne,0,0),skew:new _t(1,0,bn,1,0,0)}},_t.prototype.toString=function(ne){return this.join(" ")},_t.prototype.inversed=function(){var ne=this.sx,je=this.shy,Tt=this.shx,Qt=this.sy,rr=this.tx,vr=this.ty,Xr=1/(ne*Qt-je*Tt),bn=Qt*Xr,qn=-je*Xr,li=-Tt*Xr,fi=ne*Xr;return new _t(bn,qn,li,fi,-bn*rr-li*vr,-qn*rr-fi*vr)},_t.prototype.applyToPoint=function(ne){var je=ne.x*this.sx+ne.y*this.shx+this.tx,Tt=ne.x*this.shy+ne.y*this.sy+this.ty;return new xo(je,Tt)},_t.prototype.applyToRectangle=function(ne){var je=this.applyToPoint(ne),Tt=this.applyToPoint(new xo(ne.x+ne.w,ne.y+ne.h));return new wo(je.x,je.y,Tt.x-je.x,Tt.y-je.y)},_t.prototype.clone=function(){var ne=this.sx,je=this.shy,Tt=this.shx,Qt=this.sy,rr=this.tx,vr=this.ty;return new _t(ne,je,Tt,Qt,rr,vr)},I.Matrix=_t;var dt=I.matrixMult=function(ne,je){return je.multiply(ne)},yt=new _t(1,0,0,1,0,0);I.unitMatrix=I.identityMatrix=yt;var Nt=function(ne,je){if(!bt[ne]){var Tt=(je instanceof nm?"Sh":"P")+(Object.keys(Ve).length+1).toString(10);je.id=Tt,bt[ne]=Tt,Ve[Tt]=je,ge.publish("addPattern",je)}};I.ShadingPattern=nm,I.TilingPattern=P0,I.addShadingPattern=function(ne,je){return Ue("addShadingPattern()"),Nt(ne,je),this},I.beginTilingPattern=function(ne){Ue("beginTilingPattern()"),lc(ne.boundingBox[0],ne.boundingBox[1],ne.boundingBox[2]-ne.boundingBox[0],ne.boundingBox[3]-ne.boundingBox[1],ne.matrix)},I.endTilingPattern=function(ne,je){Ue("endTilingPattern()"),je.stream=kr[ut].join(`
`),Nt(ne,je),ge.publish("endTilingPattern",je),At.pop().restore()};var Rt=I.__private__.newObject=function(){var ne=dr();return zr(ne,!0),ne},dr=I.__private__.newObjectDeferred=function(){return jt++,qt[jt]=function(){return ar},jt},zr=function(ne,je){return je=typeof je=="boolean"&&je,qt[ne]=ar,je&&We(ne+" 0 obj"),ne},Pr=I.__private__.newAdditionalObject=function(){var ne={objId:dr(),content:""};return $r.push(ne),ne},Rr=dr(),ln=dr(),Jn=I.__private__.decodeColorString=function(ne){var je=ne.split(" ");if(je.length!==2||je[1]!=="g"&&je[1]!=="G")je.length===5&&(je[4]==="k"||je[4]==="K")&&(je=[(1-je[0])*(1-je[3]),(1-je[1])*(1-je[3]),(1-je[2])*(1-je[3]),"r"]);else{var Tt=parseFloat(je[0]);je=[Tt,Tt,Tt,"r"]}for(var Qt="#",rr=0;rr<3;rr++)Qt+=("0"+Math.floor(255*parseFloat(je[rr])).toString(16)).slice(-2);return Qt},_n=I.__private__.encodeColorString=function(ne){var je;typeof ne=="string"&&(ne={ch1:ne});var Tt=ne.ch1,Qt=ne.ch2,rr=ne.ch3,vr=ne.ch4,Xr=ne.pdfColorType==="draw"?["G","RG","K"]:["g","rg","k"];if(typeof Tt=="string"&&Tt.charAt(0)!=="#"){var bn=new WQ(Tt);if(bn.ok)Tt=bn.toHex();else if(!/^\d*\.?\d*$/.test(Tt))throw new Error('Invalid color "'+Tt+'" passed to jsPDF.encodeColorString.')}if(typeof Tt=="string"&&/^#[0-9A-Fa-f]{3}$/.test(Tt)&&(Tt="#"+Tt[1]+Tt[1]+Tt[2]+Tt[2]+Tt[3]+Tt[3]),typeof Tt=="string"&&/^#[0-9A-Fa-f]{6}$/.test(Tt)){var qn=parseInt(Tt.substr(1),16);Tt=qn>>16&255,Qt=qn>>8&255,rr=255&qn}if(Qt===void 0||vr===void 0&&Tt===Qt&&Qt===rr)if(typeof Tt=="string")je=Tt+" "+Xr[0];else switch(ne.precision){case 2:je=at(Tt/255)+" "+Xr[0];break;case 3:default:je=Le(Tt/255)+" "+Xr[0]}else if(vr===void 0||Ms(vr)==="object"){if(vr&&!isNaN(vr.a)&&vr.a===0)return je=["1.","1.","1.",Xr[1]].join(" ");if(typeof Tt=="string")je=[Tt,Qt,rr,Xr[1]].join(" ");else switch(ne.precision){case 2:je=[at(Tt/255),at(Qt/255),at(rr/255),Xr[1]].join(" ");break;default:case 3:je=[Le(Tt/255),Le(Qt/255),Le(rr/255),Xr[1]].join(" ")}}else if(typeof Tt=="string")je=[Tt,Qt,rr,vr,Xr[2]].join(" ");else switch(ne.precision){case 2:je=[at(Tt),at(Qt),at(rr),at(vr),Xr[2]].join(" ");break;case 3:default:je=[Le(Tt),Le(Qt),Le(rr),Le(vr),Xr[2]].join(" ")}return je},jn=I.__private__.getFilters=function(){return a},Gn=I.__private__.putStream=function(ne){var je=(ne=ne||{}).data||"",Tt=ne.filters||jn(),Qt=ne.alreadyAppliedFilters||[],rr=ne.addLength1||!1,vr=je.length,Xr=ne.objectId,bn=function(Do){return Do};if(_!==null&&Xr===void 0)throw new Error("ObjectId must be passed to putStream for file encryption");_!==null&&(bn=ai.encryptor(Xr,0));var qn={};Tt===!0&&(Tt=["FlateEncode"]);var li=ne.additionalKeyValues||[],fi=(qn=yi.API.processDataByFilters!==void 0?yi.API.processDataByFilters(je,Tt):{data:je,reverseChain:[]}).reverseChain+(Array.isArray(Qt)?Qt.join(" "):Qt.toString());if(qn.data.length!==0&&(li.push({key:"Length",value:qn.data.length}),rr===!0&&li.push({key:"Length1",value:vr})),fi.length!=0)if(fi.split("/").length-1==1)li.push({key:"Filter",value:fi});else{li.push({key:"Filter",value:"["+fi+"]"});for(var pi=0;pi<li.length;pi+=1)if(li[pi].key==="DecodeParms"){for(var as=[],rs=0;rs<qn.reverseChain.split("/").length-1;rs+=1)as.push("null");as.push(li[pi].value),li[pi].value="["+as.join(" ")+"]"}}We("<<");for(var gi=0;gi<li.length;gi++)We("/"+li[gi].key+" "+li[gi].value);We(">>"),qn.data.length!==0&&(We("stream"),We(bn(qn.data)),We("endstream"))},Ln=I.__private__.putPage=function(ne){var je=ne.number,Tt=ne.data,Qt=ne.objId,rr=ne.contentsObjId;zr(Qt,!0),We("<</Type /Page"),We("/Parent "+ne.rootDictionaryObjId+" 0 R"),We("/Resources "+ne.resourceDictionaryObjId+" 0 R"),We("/MediaBox ["+parseFloat(Qe(ne.mediaBox.bottomLeftX))+" "+parseFloat(Qe(ne.mediaBox.bottomLeftY))+" "+Qe(ne.mediaBox.topRightX)+" "+Qe(ne.mediaBox.topRightY)+"]"),ne.cropBox!==null&&We("/CropBox ["+Qe(ne.cropBox.bottomLeftX)+" "+Qe(ne.cropBox.bottomLeftY)+" "+Qe(ne.cropBox.topRightX)+" "+Qe(ne.cropBox.topRightY)+"]"),ne.bleedBox!==null&&We("/BleedBox ["+Qe(ne.bleedBox.bottomLeftX)+" "+Qe(ne.bleedBox.bottomLeftY)+" "+Qe(ne.bleedBox.topRightX)+" "+Qe(ne.bleedBox.topRightY)+"]"),ne.trimBox!==null&&We("/TrimBox ["+Qe(ne.trimBox.bottomLeftX)+" "+Qe(ne.trimBox.bottomLeftY)+" "+Qe(ne.trimBox.topRightX)+" "+Qe(ne.trimBox.topRightY)+"]"),ne.artBox!==null&&We("/ArtBox ["+Qe(ne.artBox.bottomLeftX)+" "+Qe(ne.artBox.bottomLeftY)+" "+Qe(ne.artBox.topRightX)+" "+Qe(ne.artBox.topRightY)+"]"),typeof ne.userUnit=="number"&&ne.userUnit!==1&&We("/UserUnit "+ne.userUnit),ge.publish("putPage",{objId:Qt,pageContext:Ae[je],pageNumber:je,page:Tt}),We("/Contents "+rr+" 0 R"),We(">>"),We("endobj");var vr=Tt.join(`
`);return ce===ie.ADVANCED&&(vr+=`
Q`),zr(rr,!0),Gn({data:vr,filters:jn(),objectId:rr}),We("endobj"),Qt},Un=I.__private__.putPages=function(){var ne,je,Tt=[];for(ne=1;ne<=Pe;ne++)Ae[ne].objId=dr(),Ae[ne].contentsObjId=dr();for(ne=1;ne<=Pe;ne++)Tt.push(Ln({number:ne,data:kr[ne],objId:Ae[ne].objId,contentsObjId:Ae[ne].contentsObjId,mediaBox:Ae[ne].mediaBox,cropBox:Ae[ne].cropBox,bleedBox:Ae[ne].bleedBox,trimBox:Ae[ne].trimBox,artBox:Ae[ne].artBox,userUnit:Ae[ne].userUnit,rootDictionaryObjId:Rr,resourceDictionaryObjId:ln}));zr(Rr,!0),We("<</Type /Pages");var Qt="/Kids [";for(je=0;je<Pe;je++)Qt+=Tt[je]+" 0 R ";We(Qt+"]"),We("/Count "+Pe),We(">>"),We("endobj"),ge.publish("postPutPages")},Ei=function(ne){ge.publish("putFont",{font:ne,out:We,newObject:Rt,putStream:Gn}),ne.isAlreadyPutted!==!0&&(ne.objectNumber=Rt(),We("<<"),We("/Type /Font"),We("/BaseFont /"+M0(ne.postScriptName)),We("/Subtype /Type1"),typeof ne.encoding=="string"&&We("/Encoding /"+ne.encoding),We("/FirstChar 32"),We("/LastChar 255"),We(">>"),We("endobj"))},zi=function(){for(var ne in Xe)Xe.hasOwnProperty(ne)&&(x===!1||x===!0&&T.hasOwnProperty(ne))&&Ei(Xe[ne])},Pt=function(ne){ne.objectNumber=Rt();var je=[];je.push({key:"Type",value:"/XObject"}),je.push({key:"Subtype",value:"/Form"}),je.push({key:"BBox",value:"["+[Qe(ne.x),Qe(ne.y),Qe(ne.x+ne.width),Qe(ne.y+ne.height)].join(" ")+"]"}),je.push({key:"Matrix",value:"["+ne.matrix.toString()+"]"});var Tt=ne.pages[1].join(`
`);Gn({data:Tt,additionalKeyValues:je,objectId:ne.objectNumber}),We("endobj")},Zr=function(){for(var ne in Se)Se.hasOwnProperty(ne)&&Pt(Se[ne])},Ur=function(ne,je){var Tt,Qt=[],rr=1/(je-1);for(Tt=0;Tt<1;Tt+=rr)Qt.push(Tt);if(Qt.push(1),ne[0].offset!=0){var vr={offset:0,color:ne[0].color};ne.unshift(vr)}if(ne[ne.length-1].offset!=1){var Xr={offset:1,color:ne[ne.length-1].color};ne.push(Xr)}for(var bn="",qn=0,li=0;li<Qt.length;li++){for(Tt=Qt[li];Tt>ne[qn+1].offset;)qn++;var fi=ne[qn].offset,pi=(Tt-fi)/(ne[qn+1].offset-fi),as=ne[qn].color,rs=ne[qn+1].color;bn+=St(Math.round((1-pi)*as[0]+pi*rs[0]).toString(16))+St(Math.round((1-pi)*as[1]+pi*rs[1]).toString(16))+St(Math.round((1-pi)*as[2]+pi*rs[2]).toString(16))}return bn.trim()},On=function(ne,je){je||(je=21);var Tt=Rt(),Qt=Ur(ne.colors,je),rr=[];rr.push({key:"FunctionType",value:"0"}),rr.push({key:"Domain",value:"[0.0 1.0]"}),rr.push({key:"Size",value:"["+je+"]"}),rr.push({key:"BitsPerSample",value:"8"}),rr.push({key:"Range",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),rr.push({key:"Decode",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),Gn({data:Qt,additionalKeyValues:rr,alreadyAppliedFilters:["/ASCIIHexDecode"],objectId:Tt}),We("endobj"),ne.objectNumber=Rt(),We("<< /ShadingType "+ne.type),We("/ColorSpace /DeviceRGB");var vr="/Coords ["+Qe(parseFloat(ne.coords[0]))+" "+Qe(parseFloat(ne.coords[1]))+" ";ne.type===2?vr+=Qe(parseFloat(ne.coords[2]))+" "+Qe(parseFloat(ne.coords[3])):vr+=Qe(parseFloat(ne.coords[2]))+" "+Qe(parseFloat(ne.coords[3]))+" "+Qe(parseFloat(ne.coords[4]))+" "+Qe(parseFloat(ne.coords[5])),We(vr+="]"),ne.matrix&&We("/Matrix ["+ne.matrix.toString()+"]"),We("/Function "+Tt+" 0 R"),We("/Extend [true true]"),We(">>"),We("endobj")},di=function(ne,je){var Tt=dr(),Qt=Rt();je.push({resourcesOid:Tt,objectOid:Qt}),ne.objectNumber=Qt;var rr=[];rr.push({key:"Type",value:"/Pattern"}),rr.push({key:"PatternType",value:"1"}),rr.push({key:"PaintType",value:"1"}),rr.push({key:"TilingType",value:"1"}),rr.push({key:"BBox",value:"["+ne.boundingBox.map(Qe).join(" ")+"]"}),rr.push({key:"XStep",value:Qe(ne.xStep)}),rr.push({key:"YStep",value:Qe(ne.yStep)}),rr.push({key:"Resources",value:Tt+" 0 R"}),ne.matrix&&rr.push({key:"Matrix",value:"["+ne.matrix.toString()+"]"}),Gn({data:ne.stream,additionalKeyValues:rr,objectId:ne.objectNumber}),We("endobj")},ks=function(ne){var je;for(je in Ve)Ve.hasOwnProperty(je)&&(Ve[je]instanceof nm?On(Ve[je]):Ve[je]instanceof P0&&di(Ve[je],ne))},bi=function(ne){for(var je in ne.objectNumber=Rt(),We("<<"),ne)switch(je){case"opacity":We("/ca "+at(ne[je]));break;case"stroke-opacity":We("/CA "+at(ne[je]))}We(">>"),We("endobj")},bs=function(){var ne;for(ne in Mt)Mt.hasOwnProperty(ne)&&bi(Mt[ne])},jo=function(){for(var ne in We("/XObject <<"),Se)Se.hasOwnProperty(ne)&&Se[ne].objectNumber>=0&&We("/"+ne+" "+Se[ne].objectNumber+" 0 R");ge.publish("putXobjectDict"),We(">>")},Ks=function(){ai.oid=Rt(),We("<<"),We("/Filter /Standard"),We("/V "+ai.v),We("/R "+ai.r),We("/U <"+ai.toHexString(ai.U)+">"),We("/O <"+ai.toHexString(ai.O)+">"),We("/P "+ai.P),We(">>"),We("endobj")},Hi=function(){for(var ne in We("/Font <<"),Xe)Xe.hasOwnProperty(ne)&&(x===!1||x===!0&&T.hasOwnProperty(ne))&&We("/"+ne+" "+Xe[ne].objectNumber+" 0 R");We(">>")},Mc=function(){if(Object.keys(Ve).length>0){for(var ne in We("/Shading <<"),Ve)Ve.hasOwnProperty(ne)&&Ve[ne]instanceof nm&&Ve[ne].objectNumber>=0&&We("/"+ne+" "+Ve[ne].objectNumber+" 0 R");ge.publish("putShadingPatternDict"),We(">>")}},wa=function(ne){if(Object.keys(Ve).length>0){for(var je in We("/Pattern <<"),Ve)Ve.hasOwnProperty(je)&&Ve[je]instanceof I.TilingPattern&&Ve[je].objectNumber>=0&&Ve[je].objectNumber<ne&&We("/"+je+" "+Ve[je].objectNumber+" 0 R");ge.publish("putTilingPatternDict"),We(">>")}},ts=function(){if(Object.keys(Mt).length>0){var ne;for(ne in We("/ExtGState <<"),Mt)Mt.hasOwnProperty(ne)&&Mt[ne].objectNumber>=0&&We("/"+ne+" "+Mt[ne].objectNumber+" 0 R");ge.publish("putGStateDict"),We(">>")}},ss=function(ne){zr(ne.resourcesOid,!0),We("<<"),We("/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]"),Hi(),Mc(),wa(ne.objectOid),ts(),jo(),We(">>"),We("endobj")},sa=function(){var ne=[];zi(),bs(),Zr(),ks(ne),ge.publish("putResources"),ne.forEach(ss),ss({resourcesOid:ln,objectOid:Number.MAX_SAFE_INTEGER}),ge.publish("postPutResources")},Vi=function(){ge.publish("putAdditionalObjects");for(var ne=0;ne<$r.length;ne++){var je=$r[ne];zr(je.objId,!0),We(je.content),We("endobj")}ge.publish("postPutAdditionalObjects")},Pc=function(ne){He[ne.fontName]=He[ne.fontName]||{},He[ne.fontName][ne.fontStyle]=ne.id},vo=function(ne,je,Tt,Qt,rr){var vr={id:"F"+(Object.keys(Xe).length+1).toString(10),postScriptName:ne,fontName:je,fontStyle:Tt,encoding:Qt,isStandardFont:rr||!1,metadata:{}};return ge.publish("addFont",{font:vr,instance:this}),Xe[vr.id]=vr,Pc(vr),vr.id},uh=function(ne){for(var je=0,Tt=mr.length;je<Tt;je++){var Qt=vo.call(this,ne[je][0],ne[je][1],ne[je][2],mr[je][3],!0);x===!1&&(T[Qt]=!0);var rr=ne[je][0].split("-");Pc({id:Qt,fontName:rr[0],fontStyle:rr[1]||""})}ge.publish("addFonts",{fonts:Xe,dictionary:He})},os=function(ne){return ne.foo=function(){try{return ne.apply(this,arguments)}catch(Qt){var je=Qt.stack||"";~je.indexOf(" at ")&&(je=je.split(" at ")[1]);var Tt="Error in function "+je.split(`
`)[0].split("<")[0]+": "+Qt.message;if(!_i.console)throw new Error(Tt);_i.console.error(Tt,Qt),_i.alert&&alert(Tt)}},ne.foo.bar=ne,ne.foo},cu=function(ne,je){var Tt,Qt,rr,vr,Xr,bn,qn,li,fi;if(rr=(je=je||{}).sourceEncoding||"Unicode",Xr=je.outputEncoding,(je.autoencode||Xr)&&Xe[Rn].metadata&&Xe[Rn].metadata[rr]&&Xe[Rn].metadata[rr].encoding&&(vr=Xe[Rn].metadata[rr].encoding,!Xr&&Xe[Rn].encoding&&(Xr=Xe[Rn].encoding),!Xr&&vr.codePages&&(Xr=vr.codePages[0]),typeof Xr=="string"&&(Xr=vr[Xr]),Xr)){for(qn=!1,bn=[],Tt=0,Qt=ne.length;Tt<Qt;Tt++)(li=Xr[ne.charCodeAt(Tt)])?bn.push(String.fromCharCode(li)):bn.push(ne[Tt]),bn[Tt].charCodeAt(0)>>8&&(qn=!0);ne=bn.join("")}for(Tt=ne.length;qn===void 0&&Tt!==0;)ne.charCodeAt(Tt-1)>>8&&(qn=!0),Tt--;if(!qn)return ne;for(bn=je.noBOM?[]:[254,255],Tt=0,Qt=ne.length;Tt<Qt;Tt++){if((fi=(li=ne.charCodeAt(Tt))>>8)>>8)throw new Error("Character at position "+Tt+" of string '"+ne+"' exceeds 16bits. Cannot be encoded into UCS-2 BE");bn.push(fi),bn.push(li-(fi<<8))}return String.fromCharCode.apply(void 0,bn)},ds=I.__private__.pdfEscape=I.pdfEscape=function(ne,je){return cu(ne,je).replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},ri=I.__private__.beginPage=function(ne){kr[++Pe]=[],Ae[Pe]={objId:0,contentsObjId:0,userUnit:Number(o),artBox:null,bleedBox:null,cropBox:null,trimBox:null,mediaBox:{bottomLeftX:0,bottomLeftY:0,topRightX:Number(ne[0]),topRightY:Number(ne[1])}},Fc(Pe),pr(kr[ut])},lo=function(ne,je){var Tt,Qt,rr;switch(t=je||t,typeof ne=="string"&&(Tt=Y(ne.toLowerCase()),Array.isArray(Tt)&&(Qt=Tt[0],rr=Tt[1])),Array.isArray(ne)&&(Qt=ne[0]*nn,rr=ne[1]*nn),isNaN(Qt)&&(Qt=i[0],rr=i[1]),(Qt>14400||rr>14400)&&(po.warn("A page in a PDF can not be wider or taller than 14400 userUnit. jsPDF limits the width/height to 14400"),Qt=Math.min(14400,Qt),rr=Math.min(14400,rr)),i=[Qt,rr],t.substr(0,1)){case"l":rr>Qt&&(i=[rr,Qt]);break;case"p":Qt>rr&&(i=[rr,Qt])}ri(i),dh(qa),We($i),gu!==0&&We(gu+" J"),fh!==0&&We(fh+" j"),ge.publish("addPage",{pageNumber:Pe})},yn=function(ne){ne>0&&ne<=Pe&&(kr.splice(ne,1),Ae.splice(ne,1),Pe--,ut>Pe&&(ut=Pe),this.setPage(ut))},Fc=function(ne){ne>0&&ne<=Pe&&(ut=ne)},hh=I.__private__.getNumberOfPages=I.getNumberOfPages=function(){return kr.length-1},$a=function(ne,je,Tt){var Qt,rr=void 0;return Tt=Tt||{},ne=ne!==void 0?ne:Xe[Rn].fontName,je=je!==void 0?je:Xe[Rn].fontStyle,Qt=ne.toLowerCase(),He[Qt]!==void 0&&He[Qt][je]!==void 0?rr=He[Qt][je]:He[ne]!==void 0&&He[ne][je]!==void 0?rr=He[ne][je]:Tt.disableWarning===!1&&po.warn("Unable to look up font label for font '"+ne+"', '"+je+"'. Refer to getFontList() for available fonts."),rr||Tt.noFallback||(rr=He.times[je])==null&&(rr=He.times.normal),rr},fs=I.__private__.putInfo=function(){var ne=Rt(),je=function(Qt){return Qt};for(var Tt in _!==null&&(je=ai.encryptor(ne,0)),We("<<"),We("/Producer ("+ds(je("jsPDF "+yi.version))+")"),Cn)Cn.hasOwnProperty(Tt)&&Cn[Tt]&&We("/"+Tt.substr(0,1).toUpperCase()+Tt.substr(1)+" ("+ds(je(Cn[Tt]))+")");We("/CreationDate ("+ds(je(Ht))+")"),We(">>"),We("endobj")},As=I.__private__.putCatalog=function(ne){var je=(ne=ne||{}).rootDictionaryObjId||Rr;switch(Rt(),We("<<"),We("/Type /Catalog"),We("/Pages "+je+" 0 R"),en||(en="fullwidth"),en){case"fullwidth":We("/OpenAction [3 0 R /FitH null]");break;case"fullheight":We("/OpenAction [3 0 R /FitV null]");break;case"fullpage":We("/OpenAction [3 0 R /Fit]");break;case"original":We("/OpenAction [3 0 R /XYZ null null 1]");break;default:var Tt=""+en;Tt.substr(Tt.length-1)==="%"&&(en=parseInt(en)/100),typeof en=="number"&&We("/OpenAction [3 0 R /XYZ null null "+at(en)+"]")}switch($n||($n="continuous"),$n){case"continuous":We("/PageLayout /OneColumn");break;case"single":We("/PageLayout /SinglePage");break;case"two":case"twoleft":We("/PageLayout /TwoColumnLeft");break;case"tworight":We("/PageLayout /TwoColumnRight")}Bn&&We("/PageMode /"+Bn),ge.publish("putCatalog"),We(">>"),We("endobj")},Gi=I.__private__.putTrailer=function(){We("trailer"),We("<<"),We("/Size "+(jt+1)),We("/Root "+jt+" 0 R"),We("/Info "+(jt-1)+" 0 R"),_!==null&&We("/Encrypt "+ai.oid+" 0 R"),We("/ID [ <"+Vt+"> <"+Vt+"> ]"),We(">>")},uu=I.__private__.putHeader=function(){We("%PDF-"+N),We("%")},Us=I.__private__.putXRef=function(){var ne="0000000000";We("xref"),We("0 "+(jt+1)),We("0000000000 65535 f ");for(var je=1;je<=jt;je++)typeof qt[je]=="function"?We((ne+qt[je]()).slice(-10)+" 00000 n "):qt[je]!==void 0?We((ne+qt[je]).slice(-10)+" 00000 n "):We("0000000000 00000 n ")},vs=I.__private__.buildDocument=function(){on(),pr(nr),ge.publish("buildDocument"),uu(),Un(),Vi(),sa(),_!==null&&Ks(),fs(),As();var ne=ar;return Us(),Gi(),We("startxref"),We(""+ne),We("%%EOF"),pr(kr[ut]),nr.join(`
`)},eo=I.__private__.getBlob=function(ne){return new Blob([mn(ne)],{type:"application/pdf"})},Rc=I.output=I.__private__.output=os(function(ne,je){switch(typeof(je=je||{})=="string"?je={filename:je}:je.filename=je.filename||"generated.pdf",ne){case void 0:return vs();case"save":I.save(je.filename);break;case"arraybuffer":return mn(vs());case"blob":return eo(vs());case"bloburi":case"bloburl":if(_i.URL!==void 0&&typeof _i.URL.createObjectURL=="function")return _i.URL&&_i.URL.createObjectURL(eo(vs()))||void 0;po.warn("bloburl is not supported by your system, because URL.createObjectURL is not supported by your browser.");break;case"datauristring":case"dataurlstring":var Tt="",Qt=vs();try{Tt=pR(Qt)}catch{Tt=pR(unescape(encodeURIComponent(Qt)))}return"data:application/pdf;filename="+je.filename+";base64,"+Tt;case"pdfobjectnewwindow":if(Object.prototype.toString.call(_i)==="[object Window]"){var rr="https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.1.1/pdfobject.min.js",vr=' integrity="sha512-4ze/a9/4jqu+tX9dfOqJYSvyYd5M6qum/3HpCLr+/Jqf0whc37VUbkpNGHR7/8pSnCFw47T1fmIpwBV7UySh3g==" crossorigin="anonymous"';je.pdfObjectUrl&&(rr=je.pdfObjectUrl,vr="");var Xr='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><script src="'+rr+'"'+vr+'><\/script><script >PDFObject.embed("'+this.output("dataurlstring")+'", '+JSON.stringify(je)+");<\/script></body></html>",bn=_i.open();return bn!==null&&bn.document.write(Xr),bn}throw new Error("The option pdfobjectnewwindow just works in a browser-environment.");case"pdfjsnewwindow":if(Object.prototype.toString.call(_i)==="[object Window]"){var qn='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe id="pdfViewer" src="'+(je.pdfJsUrl||"examples/PDF.js/web/viewer.html")+"?file=&downloadName="+je.filename+'" width="500px" height="400px" /></body></html>',li=_i.open();if(li!==null){li.document.write(qn);var fi=this;li.document.documentElement.querySelector("#pdfViewer").onload=function(){li.document.title=je.filename,li.document.documentElement.querySelector("#pdfViewer").contentWindow.PDFViewerApplication.open(fi.output("bloburl"))}}return li}throw new Error("The option pdfjsnewwindow just works in a browser-environment.");case"dataurlnewwindow":if(Object.prototype.toString.call(_i)!=="[object Window]")throw new Error("The option dataurlnewwindow just works in a browser-environment.");var pi='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe src="'+this.output("datauristring",je)+'"></iframe></body></html>',as=_i.open();if(as!==null&&(as.document.write(pi),as.document.title=je.filename),as||typeof safari>"u")return as;break;case"datauri":case"dataurl":return _i.document.location.href=this.output("datauristring",je);default:return null}}),oc=function(ne){return Array.isArray(we)===!0&&we.indexOf(ne)>-1};switch(n){case"pt":nn=1;break;case"mm":nn=72/25.4;break;case"cm":nn=72/2.54;break;case"in":nn=72;break;case"px":nn=oc("px_scaling")==1?.75:96/72;break;case"pc":case"em":nn=12;break;case"ex":nn=6;break;default:if(typeof n!="number")throw new Error("Invalid unit: "+n);nn=n}var ai=null;Fr(),Kt();var Dl=function(ne){return _!==null?ai.encryptor(ne,0):function(je){return je}},ps=I.__private__.getPageInfo=I.getPageInfo=function(ne){if(isNaN(ne)||ne%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfo");return{objId:Ae[ne].objId,pageNumber:ne,pageContext:Ae[ne]}},Dn=I.__private__.getPageInfoByObjId=function(ne){if(isNaN(ne)||ne%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfoByObjId");for(var je in Ae)if(Ae[je].objId===ne)break;return ps(je)},Ro=I.__private__.getCurrentPageInfo=I.getCurrentPageInfo=function(){return{objId:Ae[ut].objId,pageNumber:ut,pageContext:Ae[ut]}};I.addPage=function(){return lo.apply(this,arguments),this},I.setPage=function(){return Fc.apply(this,arguments),pr.call(this,kr[ut]),this},I.insertPage=function(ne){return this.addPage(),this.movePage(ut,ne),this},I.movePage=function(ne,je){var Tt,Qt;if(ne>je){Tt=kr[ne],Qt=Ae[ne];for(var rr=ne;rr>je;rr--)kr[rr]=kr[rr-1],Ae[rr]=Ae[rr-1];kr[je]=Tt,Ae[je]=Qt,this.setPage(je)}else if(ne<je){Tt=kr[ne],Qt=Ae[ne];for(var vr=ne;vr<je;vr++)kr[vr]=kr[vr+1],Ae[vr]=Ae[vr+1];kr[je]=Tt,Ae[je]=Qt,this.setPage(je)}return this},I.deletePage=function(){return yn.apply(this,arguments),this},I.__private__.text=I.text=function(ne,je,Tt,Qt,rr){var vr,Xr,bn,qn,li,fi,pi,as,rs,gi=(Qt=Qt||{}).scope||this;if(typeof ne=="number"&&typeof je=="number"&&(typeof Tt=="string"||Array.isArray(Tt))){var Do=Tt;Tt=je,je=ne,ne=Do}if(arguments[3]instanceof _t?(Ue("The transform parameter of text() with a Matrix value"),rs=rr):(bn=arguments[4],qn=arguments[5],Ms(pi=arguments[3])==="object"&&pi!==null||(typeof bn=="string"&&(qn=bn,bn=null),typeof pi=="string"&&(qn=pi,pi=null),typeof pi=="number"&&(bn=pi,pi=null),Qt={flags:pi,angle:bn,align:qn})),isNaN(je)||isNaN(Tt)||ne==null)throw new Error("Invalid arguments passed to jsPDF.text");if(ne.length===0)return gi;var zn="",Wo=!1,vi=typeof Qt.lineHeightFactor=="number"?Qt.lineHeightFactor:ja,Ti=gi.internal.scaleFactor;function hc(ls){return ls=ls.split("	").join(Array(Qt.TabLen||9).join(" ")),ds(ls,pi)}function Nl(ls){for(var ji,Kn=ls.concat(),Fs=[],Xa=Kn.length;Xa--;)typeof(ji=Kn.shift())=="string"?Fs.push(ji):Array.isArray(ls)&&(ji.length===1||ji[1]===void 0&&ji[2]===void 0)?Fs.push(ji[0]):Fs.push([ji[0],ji[1],ji[2]]);return Fs}function zl(ls,ji){var Kn;if(typeof ls=="string")Kn=ji(ls)[0];else if(Array.isArray(ls)){for(var Fs,Xa,Ja=ls.concat(),xs=[],vl=Ja.length;vl--;)typeof(Fs=Ja.shift())=="string"?xs.push(ji(Fs)[0]):Array.isArray(Fs)&&typeof Fs[0]=="string"&&(Xa=ji(Fs[0],Fs[1],Fs[2]),xs.push([Xa[0],Xa[1],Xa[2]]));Kn=xs}return Kn}var Oc=!1,Wa=!0;if(typeof ne=="string")Oc=!0;else if(Array.isArray(ne)){var ml=ne.concat();Xr=[];for(var no,Ps=ml.length;Ps--;)(typeof(no=ml.shift())!="string"||Array.isArray(no)&&typeof no[0]!="string")&&(Wa=!1);Oc=Wa}if(Oc===!1)throw new Error('Type of text must be string or Array. "'+ne+'" is not recognized.');typeof ne=="string"&&(ne=ne.match(/[\r?\n]/)?ne.split(/\r\n|\r|\n/g):[ne]);var dc=Mr/gi.internal.scaleFactor,fc=dc*(vi-1);switch(Qt.baseline){case"bottom":Tt-=fc;break;case"top":Tt+=dc-fc;break;case"hanging":Tt+=dc-2*fc;break;case"middle":Tt+=dc/2-fc}if((fi=Qt.maxWidth||0)>0&&(typeof ne=="string"?ne=gi.splitTextToSize(ne,fi):Object.prototype.toString.call(ne)==="[object Array]"&&(ne=ne.reduce(function(ls,ji){return ls.concat(gi.splitTextToSize(ji,fi))},[]))),vr={text:ne,x:je,y:Tt,options:Qt,mutex:{pdfEscape:ds,activeFontKey:Rn,fonts:Xe,activeFontSize:Mr}},ge.publish("preProcessText",vr),ne=vr.text,bn=(Qt=vr.options).angle,!(rs instanceof _t)&&bn&&typeof bn=="number"){bn*=Math.PI/180,Qt.rotationDirection===0&&(bn=-bn),ce===ie.ADVANCED&&(bn=-bn);var aa=Math.cos(bn),Ac=Math.sin(bn);rs=new _t(aa,Ac,-Ac,aa,0,0)}else bn&&bn instanceof _t&&(rs=bn);ce!==ie.ADVANCED||rs||(rs=yt),(li=Qt.charSpace||pu)!==void 0&&(zn+=Qe(ze(li))+` Tc
`,this.setCharSpace(this.getCharSpace()||0)),(as=Qt.horizontalScale)!==void 0&&(zn+=Qe(100*as)+` Tz
`),Qt.lang;var co=-1,Ea=Qt.renderingMode!==void 0?Qt.renderingMode:Qt.stroke,Hl=gi.internal.getCurrentPageInfo().pageContext;switch(Ea){case 0:case!1:case"fill":co=0;break;case 1:case!0:case"stroke":co=1;break;case 2:case"fillThenStroke":co=2;break;case 3:case"invisible":co=3;break;case 4:case"fillAndAddForClipping":co=4;break;case 5:case"strokeAndAddPathForClipping":co=5;break;case 6:case"fillThenStrokeAndAddToPathForClipping":co=6;break;case 7:case"addToPathForClipping":co=7}var Bi=Hl.usedRenderingMode!==void 0?Hl.usedRenderingMode:-1;co!==-1?zn+=co+` Tr
`:Bi!==-1&&(zn+=`0 Tr
`),co!==-1&&(Hl.usedRenderingMode=co),qn=Qt.align||"left";var Xo,pc=Mr*vi,vd=gi.internal.pageSize.getWidth(),Ah=Xe[Rn];li=Qt.charSpace||pu,fi=Qt.maxWidth||0,pi=Object.assign({autoencode:!0,noBOM:!0},Qt.flags);var xi=[];if(Object.prototype.toString.call(ne)==="[object Array]"){var Jo;Xr=Nl(ne),qn!=="left"&&(Xo=Xr.map(function(ls){return gi.getStringUnitWidth(ls,{font:Ah,charSpace:li,fontSize:Mr,doKerning:!1})*Mr/Ti}));var Ta,_l=0;if(qn==="right"){je-=Xo[0],ne=[],Ps=Xr.length;for(var Bo=0;Bo<Ps;Bo++)Bo===0?(Ta=Sn(je),Jo=Ko(Tt)):(Ta=ze(_l-Xo[Bo]),Jo=-pc),ne.push([Xr[Bo],Ta,Jo]),_l=Xo[Bo]}else if(qn==="center"){je-=Xo[0]/2,ne=[],Ps=Xr.length;for(var yl=0;yl<Ps;yl++)yl===0?(Ta=Sn(je),Jo=Ko(Tt)):(Ta=ze((_l-Xo[yl])/2),Jo=-pc),ne.push([Xr[yl],Ta,Jo]),_l=Xo[yl]}else if(qn==="left"){ne=[],Ps=Xr.length;for(var la=0;la<Ps;la++)ne.push(Xr[la])}else{if(qn!=="justify")throw new Error('Unrecognized alignment option, use "left", "center", "right" or "justify".');ne=[],Ps=Xr.length,fi=fi!==0?fi:vd;for(var Oo=0;Oo<Ps;Oo++)Jo=Oo===0?Ko(Tt):-pc,Ta=Oo===0?Sn(je):0,Oo<Ps-1?xi.push(Qe(ze((fi-Xo[Oo])/(Xr[Oo].split(" ").length-1)))):xi.push(0),ne.push([Xr[Oo],Ta,Jo])}}var Co=typeof Qt.R2L=="boolean"?Qt.R2L:gn;Co===!0&&(ne=zl(ne,function(ls,ji,Kn){return[ls.split("").reverse().join(""),ji,Kn]})),vr={text:ne,x:je,y:Tt,options:Qt,mutex:{pdfEscape:ds,activeFontKey:Rn,fonts:Xe,activeFontSize:Mr}},ge.publish("postProcessText",vr),ne=vr.text,Wo=vr.mutex.isHex||!1;var kc=Xe[Rn].encoding;kc!=="WinAnsiEncoding"&&kc!=="StandardEncoding"||(ne=zl(ne,function(ls,ji,Kn){return[hc(ls),ji,Kn]})),Xr=Nl(ne),ne=[];for(var bl,Eo,uo,ca=0,Vl=1,Zo=Array.isArray(Xr[0])?Vl:ca,ua="",Uc=function(ls,ji,Kn){var Fs="";return Kn instanceof _t?(Kn=typeof Qt.angle=="number"?dt(Kn,new _t(1,0,0,1,ls,ji)):dt(new _t(1,0,0,1,ls,ji),Kn),ce===ie.ADVANCED&&(Kn=dt(new _t(1,0,0,-1,0,0),Kn)),Fs=Kn.join(" ")+` Tm
`):Fs=Qe(ls)+" "+Qe(ji)+` Td
`,Fs},ho=0;ho<Xr.length;ho++){switch(ua="",Zo){case Vl:uo=(Wo?"<":"(")+Xr[ho][0]+(Wo?">":")"),bl=parseFloat(Xr[ho][1]),Eo=parseFloat(Xr[ho][2]);break;case ca:uo=(Wo?"<":"(")+Xr[ho]+(Wo?">":")"),bl=Sn(je),Eo=Ko(Tt)}xi!==void 0&&xi[ho]!==void 0&&(ua=xi[ho]+` Tw
`),ho===0?ne.push(ua+Uc(bl,Eo,rs)+uo):Zo===ca?ne.push(ua+uo):Zo===Vl&&ne.push(ua+Uc(bl,Eo,rs)+uo)}ne=Zo===ca?ne.join(` Tj
T* `):ne.join(` Tj
`),ne+=` Tj
`;var Yo=`BT
/`;return Yo+=Rn+" "+Mr+` Tf
`,Yo+=Qe(Mr*vi)+` TL
`,Yo+=Ca+`
`,Yo+=zn,Yo+=ne,We(Yo+="ET"),T[Rn]=!0,gi};var hu=I.__private__.clip=I.clip=function(ne){return We(ne==="evenodd"?"W*":"W"),this};I.clipEvenOdd=function(){return hu("evenodd")},I.__private__.discardPath=I.discardPath=function(){return We("n"),this};var to=I.__private__.isValidStyle=function(ne){var je=!1;return[void 0,null,"S","D","F","DF","FD","f","f*","B","B*","n"].indexOf(ne)!==-1&&(je=!0),je};I.__private__.setDefaultPathOperation=I.setDefaultPathOperation=function(ne){return to(ne)&&(f=ne),this};var du=I.__private__.getStyle=I.getStyle=function(ne){var je=f;switch(ne){case"D":case"S":je="S";break;case"F":je="f";break;case"FD":case"DF":je="B";break;case"f":case"f*":case"B":case"B*":je=ne}return je},Li=I.close=function(){return We("h"),this};I.stroke=function(){return We("S"),this},I.fill=function(ne){return Ol("f",ne),this},I.fillEvenOdd=function(ne){return Ol("f*",ne),this},I.fillStroke=function(ne){return Ol("B",ne),this},I.fillStrokeEvenOdd=function(ne){return Ol("B*",ne),this};var Ol=function(ne,je){Ms(je)==="object"?ku(je,ne):We(ne)},Ai=function(ne){ne===null||ce===ie.ADVANCED&&ne===void 0||(ne=du(ne),We(ne))};function si(ne,je,Tt,Qt,rr){var vr=new P0(je||this.boundingBox,Tt||this.xStep,Qt||this.yStep,this.gState,rr||this.matrix);vr.stream=this.stream;var Xr=ne+"$$"+this.cloneIndex+++"$$";return Nt(Xr,vr),vr}var ku=function(ne,je){var Tt=bt[ne.key],Qt=Ve[Tt];if(Qt instanceof nm)We("q"),We(wi(je)),Qt.gState&&I.setGState(Qt.gState),We(ne.matrix.toString()+" cm"),We("/"+Tt+" sh"),We("Q");else if(Qt instanceof P0){var rr=new _t(1,0,0,-1,0,gl());ne.matrix&&(rr=rr.multiply(ne.matrix||yt),Tt=si.call(Qt,ne.key,ne.boundingBox,ne.xStep,ne.yStep,rr).id),We("q"),We("/Pattern cs"),We("/"+Tt+" scn"),Qt.gState&&I.setGState(Qt.gState),We(je),We("Q")}},wi=function(ne){switch(ne){case"f":case"F":return"W n";case"f*":return"W* n";case"B":return"W S";case"B*":return"W* S";case"S":return"W S";case"n":return"W n"}},kl=I.moveTo=function(ne,je){return We(Qe(ze(ne))+" "+Qe(Ne(je))+" m"),this},ro=I.lineTo=function(ne,je){return We(Qe(ze(ne))+" "+Qe(Ne(je))+" l"),this},Ba=I.curveTo=function(ne,je,Tt,Qt,rr,vr){return We([Qe(ze(ne)),Qe(Ne(je)),Qe(ze(Tt)),Qe(Ne(Qt)),Qe(ze(rr)),Qe(Ne(vr)),"c"].join(" ")),this};I.__private__.line=I.line=function(ne,je,Tt,Qt,rr){if(isNaN(ne)||isNaN(je)||isNaN(Tt)||isNaN(Qt)||!to(rr))throw new Error("Invalid arguments passed to jsPDF.line");return ce===ie.COMPAT?this.lines([[Tt-ne,Qt-je]],ne,je,[1,1],rr||"S"):this.lines([[Tt-ne,Qt-je]],ne,je,[1,1]).stroke()},I.__private__.lines=I.lines=function(ne,je,Tt,Qt,rr,vr){var Xr,bn,qn,li,fi,pi,as,rs,gi,Do,zn,Wo;if(typeof ne=="number"&&(Wo=Tt,Tt=je,je=ne,ne=Wo),Qt=Qt||[1,1],vr=vr||!1,isNaN(je)||isNaN(Tt)||!Array.isArray(ne)||!Array.isArray(Qt)||!to(rr)||typeof vr!="boolean")throw new Error("Invalid arguments passed to jsPDF.lines");for(kl(je,Tt),Xr=Qt[0],bn=Qt[1],li=ne.length,Do=je,zn=Tt,qn=0;qn<li;qn++)(fi=ne[qn]).length===2?(Do=fi[0]*Xr+Do,zn=fi[1]*bn+zn,ro(Do,zn)):(pi=fi[0]*Xr+Do,as=fi[1]*bn+zn,rs=fi[2]*Xr+Do,gi=fi[3]*bn+zn,Do=fi[4]*Xr+Do,zn=fi[5]*bn+zn,Ba(pi,as,rs,gi,Do,zn));return vr&&Li(),Ai(rr),this},I.path=function(ne){for(var je=0;je<ne.length;je++){var Tt=ne[je],Qt=Tt.c;switch(Tt.op){case"m":kl(Qt[0],Qt[1]);break;case"l":ro(Qt[0],Qt[1]);break;case"c":Ba.apply(this,Qt);break;case"h":Li()}}return this},I.__private__.rect=I.rect=function(ne,je,Tt,Qt,rr){if(isNaN(ne)||isNaN(je)||isNaN(Tt)||isNaN(Qt)||!to(rr))throw new Error("Invalid arguments passed to jsPDF.rect");return ce===ie.COMPAT&&(Qt=-Qt),We([Qe(ze(ne)),Qe(Ne(je)),Qe(ze(Tt)),Qe(ze(Qt)),"re"].join(" ")),Ai(rr),this},I.__private__.triangle=I.triangle=function(ne,je,Tt,Qt,rr,vr,Xr){if(isNaN(ne)||isNaN(je)||isNaN(Tt)||isNaN(Qt)||isNaN(rr)||isNaN(vr)||!to(Xr))throw new Error("Invalid arguments passed to jsPDF.triangle");return this.lines([[Tt-ne,Qt-je],[rr-Tt,vr-Qt],[ne-rr,je-vr]],ne,je,[1,1],Xr,!0),this},I.__private__.roundedRect=I.roundedRect=function(ne,je,Tt,Qt,rr,vr,Xr){if(isNaN(ne)||isNaN(je)||isNaN(Tt)||isNaN(Qt)||isNaN(rr)||isNaN(vr)||!to(Xr))throw new Error("Invalid arguments passed to jsPDF.roundedRect");var bn=4/3*(Math.SQRT2-1);return rr=Math.min(rr,.5*Tt),vr=Math.min(vr,.5*Qt),this.lines([[Tt-2*rr,0],[rr*bn,0,rr,vr-vr*bn,rr,vr],[0,Qt-2*vr],[0,vr*bn,-rr*bn,vr,-rr,vr],[2*rr-Tt,0],[-rr*bn,0,-rr,-vr*bn,-rr,-vr],[0,2*vr-Qt],[0,-vr*bn,rr*bn,-vr,rr,-vr]],ne+rr,je,[1,1],Xr,!0),this},I.__private__.ellipse=I.ellipse=function(ne,je,Tt,Qt,rr){if(isNaN(ne)||isNaN(je)||isNaN(Tt)||isNaN(Qt)||!to(rr))throw new Error("Invalid arguments passed to jsPDF.ellipse");var vr=4/3*(Math.SQRT2-1)*Tt,Xr=4/3*(Math.SQRT2-1)*Qt;return kl(ne+Tt,je),Ba(ne+Tt,je-Xr,ne+vr,je-Qt,ne,je-Qt),Ba(ne-vr,je-Qt,ne-Tt,je-Xr,ne-Tt,je),Ba(ne-Tt,je+Xr,ne-vr,je+Qt,ne,je+Qt),Ba(ne+vr,je+Qt,ne+Tt,je+Xr,ne+Tt,je),Ai(rr),this},I.__private__.circle=I.circle=function(ne,je,Tt,Qt){if(isNaN(ne)||isNaN(je)||isNaN(Tt)||!to(Qt))throw new Error("Invalid arguments passed to jsPDF.circle");return this.ellipse(ne,je,Tt,Tt,Qt)},I.setFont=function(ne,je,Tt){return Tt&&(je=be(je,Tt)),Rn=$a(ne,je,{disableWarning:!1}),this};var ac=I.__private__.getFont=I.getFont=function(){return Xe[$a.apply(I,arguments)]};I.__private__.getFontList=I.getFontList=function(){var ne,je,Tt={};for(ne in He)if(He.hasOwnProperty(ne))for(je in Tt[ne]=[],He[ne])He[ne].hasOwnProperty(je)&&Tt[ne].push(je);return Tt},I.addFont=function(ne,je,Tt,Qt,rr){var vr=["StandardEncoding","MacRomanEncoding","Identity-H","WinAnsiEncoding"];return arguments[3]&&vr.indexOf(arguments[3])!==-1?rr=arguments[3]:arguments[3]&&vr.indexOf(arguments[3])==-1&&(Tt=be(Tt,Qt)),rr=rr||"Identity-H",vo.call(this,ne,je,Tt,rr)};var ja,qa=r.lineWidth||.200025,qo=I.__private__.getLineWidth=I.getLineWidth=function(){return qa},dh=I.__private__.setLineWidth=I.setLineWidth=function(ne){return qa=ne,We(Qe(ze(ne))+" w"),this};I.__private__.setLineDash=yi.API.setLineDash=yi.API.setLineDashPattern=function(ne,je){if(ne=ne||[],je=je||0,isNaN(je)||!Array.isArray(ne))throw new Error("Invalid arguments passed to jsPDF.setLineDash");return ne=ne.map(function(Tt){return Qe(ze(Tt))}).join(" "),je=Qe(ze(je)),We("["+ne+"] "+je+" d"),this};var fu=I.__private__.getLineHeight=I.getLineHeight=function(){return Mr*ja};I.__private__.getLineHeight=I.getLineHeight=function(){return Mr*ja};var Ul=I.__private__.setLineHeightFactor=I.setLineHeightFactor=function(ne){return typeof(ne=ne||1.15)=="number"&&(ja=ne),this},oa=I.__private__.getLineHeightFactor=I.getLineHeightFactor=function(){return ja};Ul(r.lineHeight);var Sn=I.__private__.getHorizontalCoordinate=function(ne){return ze(ne)},Ko=I.__private__.getVerticalCoordinate=function(ne){return ce===ie.ADVANCED?ne:Ae[ut].mediaBox.topRightY-Ae[ut].mediaBox.bottomLeftY-ze(ne)},Ka=I.__private__.getHorizontalCoordinateString=I.getHorizontalCoordinateString=function(ne){return Qe(Sn(ne))},go=I.__private__.getVerticalCoordinateString=I.getVerticalCoordinateString=function(ne){return Qe(Ko(ne))},$i=r.strokeColor||"0 G";I.__private__.getStrokeColor=I.getDrawColor=function(){return Jn($i)},I.__private__.setStrokeColor=I.setDrawColor=function(ne,je,Tt,Qt){return $i=_n({ch1:ne,ch2:je,ch3:Tt,ch4:Qt,pdfColorType:"draw",precision:2}),We($i),this};var Au=r.fillColor||"0 g";I.__private__.getFillColor=I.getFillColor=function(){return Jn(Au)},I.__private__.setFillColor=I.setFillColor=function(ne,je,Tt,Qt){return Au=_n({ch1:ne,ch2:je,ch3:Tt,ch4:Qt,pdfColorType:"fill",precision:2}),We(Au),this};var Ca=r.textColor||"0 g",Nh=I.__private__.getTextColor=I.getTextColor=function(){return Jn(Ca)};I.__private__.setTextColor=I.setTextColor=function(ne,je,Tt,Qt){return Ca=_n({ch1:ne,ch2:je,ch3:Tt,ch4:Qt,pdfColorType:"text",precision:3}),this};var pu=r.charSpace,Uu=I.__private__.getCharSpace=I.getCharSpace=function(){return parseFloat(pu||0)};I.__private__.setCharSpace=I.setCharSpace=function(ne){if(isNaN(ne))throw new Error("Invalid argument passed to jsPDF.setCharSpace");return pu=ne,this};var gu=0;I.CapJoinStyles={0:0,butt:0,but:0,miter:0,1:1,round:1,rounded:1,circle:1,2:2,projecting:2,project:2,square:2,bevel:2},I.__private__.setLineCap=I.setLineCap=function(ne){var je=I.CapJoinStyles[ne];if(je===void 0)throw new Error("Line cap style of '"+ne+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return gu=je,We(je+" J"),this};var fh=0;I.__private__.setLineJoin=I.setLineJoin=function(ne){var je=I.CapJoinStyles[ne];if(je===void 0)throw new Error("Line join style of '"+ne+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return fh=je,We(je+" j"),this},I.__private__.setLineMiterLimit=I.__private__.setMiterLimit=I.setLineMiterLimit=I.setMiterLimit=function(ne){if(ne=ne||0,isNaN(ne))throw new Error("Invalid argument passed to jsPDF.setLineMiterLimit");return We(Qe(ze(ne))+" M"),this},I.GState=PB,I.setGState=function(ne){(ne=typeof ne=="string"?Mt[$t[ne]]:mu(null,ne)).equals(Wt)||(We("/"+ne.id+" gs"),Wt=ne)};var mu=function(ne,je){if(!ne||!$t[ne]){var Tt=!1;for(var Qt in Mt)if(Mt.hasOwnProperty(Qt)&&Mt[Qt].equals(je)){Tt=!0;break}if(Tt)je=Mt[Qt];else{var rr="GS"+(Object.keys(Mt).length+1).toString(10);Mt[rr]=je,je.id=rr}return ne&&($t[ne]=je.id),ge.publish("addGState",je),je}};I.addGState=function(ne,je){return mu(ne,je),this},I.saveGraphicsState=function(){return We("q"),Je.push({key:Rn,size:Mr,color:Ca}),this},I.restoreGraphicsState=function(){We("Q");var ne=Je.pop();return Rn=ne.key,Mr=ne.size,Ca=ne.color,Wt=null,this},I.setCurrentTransformationMatrix=function(ne){return We(ne.toString()+" cm"),this},I.comment=function(ne){return We("#"+ne),this};var xo=function(ne,je){var Tt=ne||0;Object.defineProperty(this,"x",{enumerable:!0,get:function(){return Tt},set:function(vr){isNaN(vr)||(Tt=parseFloat(vr))}});var Qt=je||0;Object.defineProperty(this,"y",{enumerable:!0,get:function(){return Qt},set:function(vr){isNaN(vr)||(Qt=parseFloat(vr))}});var rr="pt";return Object.defineProperty(this,"type",{enumerable:!0,get:function(){return rr},set:function(vr){rr=vr.toString()}}),this},wo=function(ne,je,Tt,Qt){xo.call(this,ne,je),this.type="rect";var rr=Tt||0;Object.defineProperty(this,"w",{enumerable:!0,get:function(){return rr},set:function(Xr){isNaN(Xr)||(rr=parseFloat(Xr))}});var vr=Qt||0;return Object.defineProperty(this,"h",{enumerable:!0,get:function(){return vr},set:function(Xr){isNaN(Xr)||(vr=parseFloat(Xr))}}),this},Lc=function(){this.page=Pe,this.currentPage=ut,this.pages=kr.slice(0),this.pagesContext=Ae.slice(0),this.x=Ci,this.y=Cr,this.matrix=Tn,this.width=cc(ut),this.height=gl(ut),this.outputDestination=sn,this.id="",this.objectNumber=-1};Lc.prototype.restore=function(){Pe=this.page,ut=this.currentPage,Ae=this.pagesContext,kr=this.pages,Ci=this.x,Cr=this.y,Tn=this.matrix,Nu(ut,this.width),uc(ut,this.height),sn=this.outputDestination};var lc=function(ne,je,Tt,Qt,rr){At.push(new Lc),Pe=ut=0,kr=[],Ci=ne,Cr=je,Tn=rr,ri([Tt,Qt])},Dc=function(ne){if(ht[ne])At.pop().restore();else{var je=new Lc,Tt="Xo"+(Object.keys(Se).length+1).toString(10);je.id=Tt,ht[ne]=Tt,Se[Tt]=je,ge.publish("addFormObject",je),At.pop().restore()}};for(var Lo in I.beginFormObject=function(ne,je,Tt,Qt,rr){return lc(ne,je,Tt,Qt,rr),this},I.endFormObject=function(ne){return Dc(ne),this},I.doFormObject=function(ne,je){var Tt=Se[ht[ne]];return We("q"),We(je.toString()+" cm"),We("/"+Tt.id+" Do"),We("Q"),this},I.getFormObject=function(ne){var je=Se[ht[ne]];return{x:je.x,y:je.y,width:je.width,height:je.height,matrix:je.matrix}},I.save=function(ne,je){return ne=ne||"generated.pdf",(je=je||{}).returnPromise=je.returnPromise||!1,je.returnPromise===!1?(rm(eo(vs()),ne),typeof rm.unload=="function"&&_i.setTimeout&&setTimeout(rm.unload,911),this):new Promise(function(Tt,Qt){try{var rr=rm(eo(vs()),ne);typeof rm.unload=="function"&&_i.setTimeout&&setTimeout(rm.unload,911),Tt(rr)}catch(vr){Qt(vr.message)}})},yi.API)yi.API.hasOwnProperty(Lo)&&(Lo==="events"&&yi.API.events.length?function(ne,je){var Tt,Qt,rr;for(rr=je.length-1;rr!==-1;rr--)Tt=je[rr][0],Qt=je[rr][1],ne.subscribe.apply(ne,[Tt].concat(typeof Qt=="function"?[Qt]:Qt))}(ge,yi.API.events):I[Lo]=yi.API[Lo]);var cc=I.getPageWidth=function(ne){return(Ae[ne=ne||ut].mediaBox.topRightX-Ae[ne].mediaBox.bottomLeftX)/nn},Nu=I.setPageWidth=function(ne,je){Ae[ne].mediaBox.topRightX=je*nn+Ae[ne].mediaBox.bottomLeftX},gl=I.getPageHeight=function(ne){return(Ae[ne=ne||ut].mediaBox.topRightY-Ae[ne].mediaBox.bottomLeftY)/nn},uc=I.setPageHeight=function(ne,je){Ae[ne].mediaBox.topRightY=je*nn+Ae[ne].mediaBox.bottomLeftY};return I.internal={pdfEscape:ds,getStyle:du,getFont:ac,getFontSize:Wr,getCharSpace:Uu,getTextColor:Nh,getLineHeight:fu,getLineHeightFactor:oa,getLineWidth:qo,write:Pn,getHorizontalCoordinate:Sn,getVerticalCoordinate:Ko,getCoordinateString:Ka,getVerticalCoordinateString:go,collections:{},newObject:Rt,newAdditionalObject:Pr,newObjectDeferred:dr,newObjectDeferredBegin:zr,getFilters:jn,putStream:Gn,events:ge,scaleFactor:nn,pageSize:{getWidth:function(){return cc(ut)},setWidth:function(ne){Nu(ut,ne)},getHeight:function(){return gl(ut)},setHeight:function(ne){uc(ut,ne)}},encryptionOptions:_,encryption:ai,getEncryptor:Dl,output:Rc,getNumberOfPages:hh,pages:kr,out:We,f2:at,f3:Le,getPageInfo:ps,getPageInfoByObjId:Dn,getCurrentPageInfo:Ro,getPDFVersion:$,Point:xo,Rectangle:wo,Matrix:_t,hasHotfix:oc},Object.defineProperty(I.internal.pageSize,"width",{get:function(){return cc(ut)},set:function(ne){Nu(ut,ne)},enumerable:!0,configurable:!0}),Object.defineProperty(I.internal.pageSize,"height",{get:function(){return gl(ut)},set:function(ne){uc(ut,ne)},enumerable:!0,configurable:!0}),uh.call(I,mr),Rn="F1",lo(i,t),ge.publish("initialized"),I}I0.prototype.lsbFirstWord=function(r){return String.fromCharCode(r>>0&255,r>>8&255,r>>16&255,r>>24&255)},I0.prototype.toHexString=function(r){return r.split("").map(function(e){return("0"+(255&e.charCodeAt(0)).toString(16)).slice(-2)}).join("")},I0.prototype.hexToBytes=function(r){for(var e=[],t=0;t<r.length;t+=2)e.push(String.fromCharCode(parseInt(r.substr(t,2),16)));return e.join("")},I0.prototype.processOwnerPassword=function(r,e){return _R(mR(e).substr(0,5),r)},I0.prototype.encryptor=function(r,e){var t=mR(this.encryptionKey+String.fromCharCode(255&r,r>>8&255,r>>16&255,255&e,e>>8&255)).substr(0,10);return function(n){return _R(t,n)}},PB.prototype.equals=function(r){var e,t="id,objectNumber,equals";if(!r||Ms(r)!==Ms(this))return!1;var n=0;for(e in this)if(!(t.indexOf(e)>=0)){if(this.hasOwnProperty(e)&&!r.hasOwnProperty(e)||this[e]!==r[e])return!1;n++}for(e in r)r.hasOwnProperty(e)&&t.indexOf(e)<0&&n--;return n===0},yi.API={events:[]},yi.version="2.5.1";var ba=yi.API,yR=1,im=function(r){return r.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},F0=function(r){return r.replace(/\\\\/g,"\\").replace(/\\\(/g,"(").replace(/\\\)/g,")")},Si=function(r){return r.toFixed(2)},Sp=function(r){return r.toFixed(5)};ba.__acroform__={};var sh=function(r,e){r.prototype=Object.create(e.prototype),r.prototype.constructor=r},t$=function(r){return r*yR},Xf=function(r){var e=new n$,t=Xn.internal.getHeight(r)||0,n=Xn.internal.getWidth(r)||0;return e.BBox=[0,0,Number(Si(n)),Number(Si(t))],e},f5e=ba.__acroform__.setBit=function(r,e){if(r=r||0,e=e||0,isNaN(r)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBit");return r|=1<<e},A5e=ba.__acroform__.clearBit=function(r,e){if(r=r||0,e=e||0,isNaN(r)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBit");return r&=~(1<<e)},p5e=ba.__acroform__.getBit=function(r,e){if(isNaN(r)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBit");return r&1<<e?1:0},Oa=ba.__acroform__.getBitForPdf=function(r,e){if(isNaN(r)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBitForPdf");return p5e(r,e-1)},ka=ba.__acroform__.setBitForPdf=function(r,e){if(isNaN(r)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBitForPdf");return f5e(r,e-1)},Ua=ba.__acroform__.clearBitForPdf=function(r,e){if(isNaN(r)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBitForPdf");return A5e(r,e-1)},g5e=ba.__acroform__.calculateCoordinates=function(r,e){var t=e.internal.getHorizontalCoordinate,n=e.internal.getVerticalCoordinate,i=r[0],s=r[1],a=r[2],o=r[3],h={};return h.lowerLeft_X=t(i)||0,h.lowerLeft_Y=n(s+o)||0,h.upperRight_X=t(i+a)||0,h.upperRight_Y=n(s)||0,[Number(Si(h.lowerLeft_X)),Number(Si(h.lowerLeft_Y)),Number(Si(h.upperRight_X)),Number(Si(h.upperRight_Y))]},m5e=function(r){if(r.appearanceStreamContent)return r.appearanceStreamContent;if(r.V||r.DV){var e=[],t=r._V||r.DV,n=bR(r,t),i=r.scope.internal.getFont(r.fontName,r.fontStyle).id;e.push("/Tx BMC"),e.push("q"),e.push("BT"),e.push(r.scope.__private__.encodeColorString(r.color)),e.push("/"+i+" "+Si(n.fontSize)+" Tf"),e.push("1 0 0 1 0 0 Tm"),e.push(n.text),e.push("ET"),e.push("Q"),e.push("EMC");var s=Xf(r);return s.scope=r.scope,s.stream=e.join(`
`),s}},bR=function(r,e){var t=r.fontSize===0?r.maxFontSize:r.fontSize,n={text:"",fontSize:""},i=(e=(e=e.substr(0,1)=="("?e.substr(1):e).substr(e.length-1)==")"?e.substr(0,e.length-1):e).split(" ");i=r.multiline?i.map(function(Le){return Le.split(`
`)}):i.map(function(Le){return[Le]});var s=t,a=Xn.internal.getHeight(r)||0;a=a<0?-a:a;var o=Xn.internal.getWidth(r)||0;o=o<0?-o:o;var h=function(Le,ze,tt){if(Le+1<i.length){var Ne=ze+" "+i[Le+1][0];return FB(Ne,r,tt).width<=o-4}return!1};s++;e:for(;s>0;){e="",s--;var f,_,x=FB("3",r,s).height,T=r.multiline?a-s:(a-x)/2,I=T+=2,N=0,$=0,W=0;if(s<=0){e=`(...) Tj
`,e+="% Width of Text: "+FB(e,r,s=12).width+", FieldWidth:"+o+`
`;break}for(var Y="",ie=0,ce=0;ce<i.length;ce++)if(i.hasOwnProperty(ce)){var fe=!1;if(i[ce].length!==1&&W!==i[ce].length-1){if((x+2)*(ie+2)+2>a)continue e;Y+=i[ce][W],fe=!0,$=ce,ce--}else{Y=(Y+=i[ce][W]+" ").substr(Y.length-1)==" "?Y.substr(0,Y.length-1):Y;var ve=parseInt(ce),be=h(ve,Y,s),Qe=ce>=i.length-1;if(be&&!Qe){Y+=" ",W=0;continue}if(be||Qe){if(Qe)$=ve;else if(r.multiline&&(x+2)*(ie+2)+2>a)continue e}else{if(!r.multiline||(x+2)*(ie+2)+2>a)continue e;$=ve}}for(var Ue="",st=N;st<=$;st++){var at=i[st];if(r.multiline){if(st===$){Ue+=at[W]+" ",W=(W+1)%at.length;continue}if(st===N){Ue+=at[at.length-1]+" ";continue}}Ue+=at[0]+" "}switch(Ue=Ue.substr(Ue.length-1)==" "?Ue.substr(0,Ue.length-1):Ue,_=FB(Ue,r,s).width,r.textAlign){case"right":f=o-_-2;break;case"center":f=(o-_)/2;break;case"left":default:f=2}e+=Si(f)+" "+Si(I)+` Td
`,e+="("+im(Ue)+`) Tj
`,e+=-Si(f)+` 0 Td
`,I=-(s+2),_=0,N=fe?$:$+1,ie++,Y=""}break}return n.text=e,n.fontSize=s,n},FB=function(r,e,t){var n=e.scope.internal.getFont(e.fontName,e.fontStyle),i=e.scope.getStringUnitWidth(r,{font:n,fontSize:parseFloat(t),charSpace:0})*parseFloat(t);return{height:e.scope.getStringUnitWidth("3",{font:n,fontSize:parseFloat(t),charSpace:0})*parseFloat(t)*1.5,width:i}},_5e={fields:[],xForms:[],acroFormDictionaryRoot:null,printedOut:!1,internal:null,isInitialized:!1},y5e=function(r,e){var t={type:"reference",object:r};e.internal.getPageInfo(r.page).pageContext.annotations.find(function(n){return n.type===t.type&&n.object===t.object})===void 0&&e.internal.getPageInfo(r.page).pageContext.annotations.push(t)},b5e=function(r,e){for(var t in r)if(r.hasOwnProperty(t)){var n=t,i=r[t];e.internal.newObjectDeferredBegin(i.objId,!0),Ms(i)==="object"&&typeof i.putStream=="function"&&i.putStream(),delete r[n]}},v5e=function(r,e){if(e.scope=r,r.internal!==void 0&&(r.internal.acroformPlugin===void 0||r.internal.acroformPlugin.isInitialized===!1)){if(nf.FieldNum=0,r.internal.acroformPlugin=JSON.parse(JSON.stringify(_5e)),r.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("Exception while creating AcroformDictionary");yR=r.internal.scaleFactor,r.internal.acroformPlugin.acroFormDictionaryRoot=new i$,r.internal.acroformPlugin.acroFormDictionaryRoot.scope=r,r.internal.acroformPlugin.acroFormDictionaryRoot._eventID=r.internal.events.subscribe("postPutResources",function(){(function(t){t.internal.events.unsubscribe(t.internal.acroformPlugin.acroFormDictionaryRoot._eventID),delete t.internal.acroformPlugin.acroFormDictionaryRoot._eventID,t.internal.acroformPlugin.printedOut=!0})(r)}),r.internal.events.subscribe("buildDocument",function(){(function(t){t.internal.acroformPlugin.acroFormDictionaryRoot.objId=void 0;var n=t.internal.acroformPlugin.acroFormDictionaryRoot.Fields;for(var i in n)if(n.hasOwnProperty(i)){var s=n[i];s.objId=void 0,s.hasAnnotation&&y5e(s,t)}})(r)}),r.internal.events.subscribe("putCatalog",function(){(function(t){if(t.internal.acroformPlugin.acroFormDictionaryRoot===void 0)throw new Error("putCatalogCallback: Root missing.");t.internal.write("/AcroForm "+t.internal.acroformPlugin.acroFormDictionaryRoot.objId+" 0 R")})(r)}),r.internal.events.subscribe("postPutPages",function(t){(function(n,i){var s=!n;for(var a in n||(i.internal.newObjectDeferredBegin(i.internal.acroformPlugin.acroFormDictionaryRoot.objId,!0),i.internal.acroformPlugin.acroFormDictionaryRoot.putStream()),n=n||i.internal.acroformPlugin.acroFormDictionaryRoot.Kids)if(n.hasOwnProperty(a)){var o=n[a],h=[],f=o.Rect;if(o.Rect&&(o.Rect=g5e(o.Rect,i)),i.internal.newObjectDeferredBegin(o.objId,!0),o.DA=Xn.createDefaultAppearanceStream(o),Ms(o)==="object"&&typeof o.getKeyValueListForStream=="function"&&(h=o.getKeyValueListForStream()),o.Rect=f,o.hasAppearanceStream&&!o.appearanceStreamContent){var _=m5e(o);h.push({key:"AP",value:"<</N "+_+">>"}),i.internal.acroformPlugin.xForms.push(_)}if(o.appearanceStreamContent){var x="";for(var T in o.appearanceStreamContent)if(o.appearanceStreamContent.hasOwnProperty(T)){var I=o.appearanceStreamContent[T];if(x+="/"+T+" ",x+="<<",Object.keys(I).length>=1||Array.isArray(I)){for(var a in I)if(I.hasOwnProperty(a)){var N=I[a];typeof N=="function"&&(N=N.call(i,o)),x+="/"+a+" "+N+" ",i.internal.acroformPlugin.xForms.indexOf(N)>=0||i.internal.acroformPlugin.xForms.push(N)}}else typeof(N=I)=="function"&&(N=N.call(i,o)),x+="/"+a+" "+N,i.internal.acroformPlugin.xForms.indexOf(N)>=0||i.internal.acroformPlugin.xForms.push(N);x+=">>"}h.push({key:"AP",value:`<<
`+x+">>"})}i.internal.putStream({additionalKeyValues:h,objectId:o.objId}),i.internal.out("endobj")}s&&b5e(i.internal.acroformPlugin.xForms,i)})(t,r)}),r.internal.acroformPlugin.isInitialized=!0}},r$=ba.__acroform__.arrayToPdfArray=function(r,e,t){var n=function(a){return a};if(Array.isArray(r)){for(var i="[",s=0;s<r.length;s++)switch(s!==0&&(i+=" "),Ms(r[s])){case"boolean":case"number":case"object":i+=r[s].toString();break;case"string":r[s].substr(0,1)!=="/"?(e!==void 0&&t&&(n=t.internal.getEncryptor(e)),i+="("+im(n(r[s].toString()))+")"):i+=r[s].toString()}return i+="]"}throw new Error("Invalid argument passed to jsPDF.__acroform__.arrayToPdfArray")},vR=function(r,e,t){var n=function(i){return i};return e!==void 0&&t&&(n=t.internal.getEncryptor(e)),(r=r||"").toString(),r="("+im(n(r))+")"},Jf=function(){this._objId=void 0,this._scope=void 0,Object.defineProperty(this,"objId",{get:function(){if(this._objId===void 0){if(this.scope===void 0)return;this._objId=this.scope.internal.newObjectDeferred()}return this._objId},set:function(r){this._objId=r}}),Object.defineProperty(this,"scope",{value:this._scope,writable:!0})};Jf.prototype.toString=function(){return this.objId+" 0 R"},Jf.prototype.putStream=function(){var r=this.getKeyValueListForStream();this.scope.internal.putStream({data:this.stream,additionalKeyValues:r,objectId:this.objId}),this.scope.internal.out("endobj")},Jf.prototype.getKeyValueListForStream=function(){var r=[],e=Object.getOwnPropertyNames(this).filter(function(s){return s!="content"&&s!="appearanceStreamContent"&&s!="scope"&&s!="objId"&&s.substring(0,1)!="_"});for(var t in e)if(Object.getOwnPropertyDescriptor(this,e[t]).configurable===!1){var n=e[t],i=this[n];i&&(Array.isArray(i)?r.push({key:n,value:r$(i,this.objId,this.scope)}):i instanceof Jf?(i.scope=this.scope,r.push({key:n,value:i.objId+" 0 R"})):typeof i!="function"&&r.push({key:n,value:i}))}return r};var n$=function(){Jf.call(this),Object.defineProperty(this,"Type",{value:"/XObject",configurable:!1,writable:!0}),Object.defineProperty(this,"Subtype",{value:"/Form",configurable:!1,writable:!0}),Object.defineProperty(this,"FormType",{value:1,configurable:!1,writable:!0});var r,e=[];Object.defineProperty(this,"BBox",{configurable:!1,get:function(){return e},set:function(t){e=t}}),Object.defineProperty(this,"Resources",{value:"2 0 R",configurable:!1,writable:!0}),Object.defineProperty(this,"stream",{enumerable:!1,configurable:!0,set:function(t){r=t.trim()},get:function(){return r||null}})};sh(n$,Jf);var i$=function(){Jf.call(this);var r,e=[];Object.defineProperty(this,"Kids",{enumerable:!1,configurable:!0,get:function(){return e.length>0?e:void 0}}),Object.defineProperty(this,"Fields",{enumerable:!1,configurable:!1,get:function(){return e}}),Object.defineProperty(this,"DA",{enumerable:!1,configurable:!1,get:function(){if(r){var t=function(n){return n};return this.scope&&(t=this.scope.internal.getEncryptor(this.objId)),"("+im(t(r))+")"}},set:function(t){r=t}})};sh(i$,Jf);var nf=function r(){Jf.call(this);var e=4;Object.defineProperty(this,"F",{enumerable:!1,configurable:!1,get:function(){return e},set:function(Y){if(isNaN(Y))throw new Error('Invalid value "'+Y+'" for attribute F supplied.');e=Y}}),Object.defineProperty(this,"showWhenPrinted",{enumerable:!0,configurable:!0,get:function(){return!!Oa(e,3)},set:function(Y){Y?this.F=ka(e,3):this.F=Ua(e,3)}});var t=0;Object.defineProperty(this,"Ff",{enumerable:!1,configurable:!1,get:function(){return t},set:function(Y){if(isNaN(Y))throw new Error('Invalid value "'+Y+'" for attribute Ff supplied.');t=Y}});var n=[];Object.defineProperty(this,"Rect",{enumerable:!1,configurable:!1,get:function(){if(n.length!==0)return n},set:function(Y){n=Y!==void 0?Y:[]}}),Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[0])?0:n[0]},set:function(Y){n[0]=Y}}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[1])?0:n[1]},set:function(Y){n[1]=Y}}),Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[2])?0:n[2]},set:function(Y){n[2]=Y}}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[3])?0:n[3]},set:function(Y){n[3]=Y}});var i="";Object.defineProperty(this,"FT",{enumerable:!0,configurable:!1,get:function(){return i},set:function(Y){switch(Y){case"/Btn":case"/Tx":case"/Ch":case"/Sig":i=Y;break;default:throw new Error('Invalid value "'+Y+'" for attribute FT supplied.')}}});var s=null;Object.defineProperty(this,"T",{enumerable:!0,configurable:!1,get:function(){if(!s||s.length<1){if(this instanceof DB)return;s="FieldObject"+r.FieldNum++}var Y=function(ie){return ie};return this.scope&&(Y=this.scope.internal.getEncryptor(this.objId)),"("+im(Y(s))+")"},set:function(Y){s=Y.toString()}}),Object.defineProperty(this,"fieldName",{configurable:!0,enumerable:!0,get:function(){return s},set:function(Y){s=Y}});var a="helvetica";Object.defineProperty(this,"fontName",{enumerable:!0,configurable:!0,get:function(){return a},set:function(Y){a=Y}});var o="normal";Object.defineProperty(this,"fontStyle",{enumerable:!0,configurable:!0,get:function(){return o},set:function(Y){o=Y}});var h=0;Object.defineProperty(this,"fontSize",{enumerable:!0,configurable:!0,get:function(){return h},set:function(Y){h=Y}});var f=void 0;Object.defineProperty(this,"maxFontSize",{enumerable:!0,configurable:!0,get:function(){return f===void 0?50/yR:f},set:function(Y){f=Y}});var _="black";Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,get:function(){return _},set:function(Y){_=Y}});var x="/F1 0 Tf 0 g";Object.defineProperty(this,"DA",{enumerable:!0,configurable:!1,get:function(){if(!(!x||this instanceof DB||this instanceof sm))return vR(x,this.objId,this.scope)},set:function(Y){Y=Y.toString(),x=Y}});var T=null;Object.defineProperty(this,"DV",{enumerable:!1,configurable:!1,get:function(){if(T)return this instanceof nc?T:vR(T,this.objId,this.scope)},set:function(Y){Y=Y.toString(),T=this instanceof nc?Y:Y.substr(0,1)==="("?F0(Y.substr(1,Y.length-2)):F0(Y)}}),Object.defineProperty(this,"defaultValue",{enumerable:!0,configurable:!0,get:function(){return this instanceof nc?F0(T.substr(1,T.length-1)):T},set:function(Y){Y=Y.toString(),T=this instanceof nc?"/"+Y:Y}});var I=null;Object.defineProperty(this,"_V",{enumerable:!1,configurable:!1,get:function(){if(I)return I},set:function(Y){this.V=Y}}),Object.defineProperty(this,"V",{enumerable:!1,configurable:!1,get:function(){if(I)return this instanceof nc?I:vR(I,this.objId,this.scope)},set:function(Y){Y=Y.toString(),I=this instanceof nc?Y:Y.substr(0,1)==="("?F0(Y.substr(1,Y.length-2)):F0(Y)}}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,get:function(){return this instanceof nc?F0(I.substr(1,I.length-1)):I},set:function(Y){Y=Y.toString(),I=this instanceof nc?"/"+Y:Y}}),Object.defineProperty(this,"hasAnnotation",{enumerable:!0,configurable:!0,get:function(){return this.Rect}}),Object.defineProperty(this,"Type",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Annot":null}}),Object.defineProperty(this,"Subtype",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Widget":null}});var N,$=!1;Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return $},set:function(Y){Y=!!Y,$=Y}}),Object.defineProperty(this,"page",{enumerable:!0,configurable:!0,get:function(){if(N)return N},set:function(Y){N=Y}}),Object.defineProperty(this,"readOnly",{enumerable:!0,configurable:!0,get:function(){return!!Oa(this.Ff,1)},set:function(Y){Y?this.Ff=ka(this.Ff,1):this.Ff=Ua(this.Ff,1)}}),Object.defineProperty(this,"required",{enumerable:!0,configurable:!0,get:function(){return!!Oa(this.Ff,2)},set:function(Y){Y?this.Ff=ka(this.Ff,2):this.Ff=Ua(this.Ff,2)}}),Object.defineProperty(this,"noExport",{enumerable:!0,configurable:!0,get:function(){return!!Oa(this.Ff,3)},set:function(Y){Y?this.Ff=ka(this.Ff,3):this.Ff=Ua(this.Ff,3)}});var W=null;Object.defineProperty(this,"Q",{enumerable:!0,configurable:!1,get:function(){if(W!==null)return W},set:function(Y){if([0,1,2].indexOf(Y)===-1)throw new Error('Invalid value "'+Y+'" for attribute Q supplied.');W=Y}}),Object.defineProperty(this,"textAlign",{get:function(){var Y;switch(W){case 0:default:Y="left";break;case 1:Y="center";break;case 2:Y="right"}return Y},configurable:!0,enumerable:!0,set:function(Y){switch(Y){case"right":case 2:W=2;break;case"center":case 1:W=1;break;case"left":case 0:default:W=0}}})};sh(nf,Jf);var R0=function(){nf.call(this),this.FT="/Ch",this.V="()",this.fontName="zapfdingbats";var r=0;Object.defineProperty(this,"TI",{enumerable:!0,configurable:!1,get:function(){return r},set:function(t){r=t}}),Object.defineProperty(this,"topIndex",{enumerable:!0,configurable:!0,get:function(){return r},set:function(t){r=t}});var e=[];Object.defineProperty(this,"Opt",{enumerable:!0,configurable:!1,get:function(){return r$(e,this.objId,this.scope)},set:function(t){var n,i;i=[],typeof(n=t)=="string"&&(i=function(s,a,o){o||(o=1);for(var h,f=[];h=a.exec(s);)f.push(h[o]);return f}(n,/\((.*?)\)/g)),e=i}}),this.getOptions=function(){return e},this.setOptions=function(t){e=t,this.sort&&e.sort()},this.addOption=function(t){t=(t=t||"").toString(),e.push(t),this.sort&&e.sort()},this.removeOption=function(t,n){for(n=n||!1,t=(t=t||"").toString();e.indexOf(t)!==-1&&(e.splice(e.indexOf(t),1),n!==!1););},Object.defineProperty(this,"combo",{enumerable:!0,configurable:!0,get:function(){return!!Oa(this.Ff,18)},set:function(t){t?this.Ff=ka(this.Ff,18):this.Ff=Ua(this.Ff,18)}}),Object.defineProperty(this,"edit",{enumerable:!0,configurable:!0,get:function(){return!!Oa(this.Ff,19)},set:function(t){this.combo===!0&&(t?this.Ff=ka(this.Ff,19):this.Ff=Ua(this.Ff,19))}}),Object.defineProperty(this,"sort",{enumerable:!0,configurable:!0,get:function(){return!!Oa(this.Ff,20)},set:function(t){t?(this.Ff=ka(this.Ff,20),e.sort()):this.Ff=Ua(this.Ff,20)}}),Object.defineProperty(this,"multiSelect",{enumerable:!0,configurable:!0,get:function(){return!!Oa(this.Ff,22)},set:function(t){t?this.Ff=ka(this.Ff,22):this.Ff=Ua(this.Ff,22)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!Oa(this.Ff,23)},set:function(t){t?this.Ff=ka(this.Ff,23):this.Ff=Ua(this.Ff,23)}}),Object.defineProperty(this,"commitOnSelChange",{enumerable:!0,configurable:!0,get:function(){return!!Oa(this.Ff,27)},set:function(t){t?this.Ff=ka(this.Ff,27):this.Ff=Ua(this.Ff,27)}}),this.hasAppearanceStream=!1};sh(R0,nf);var L0=function(){R0.call(this),this.fontName="helvetica",this.combo=!1};sh(L0,R0);var D0=function(){L0.call(this),this.combo=!0};sh(D0,L0);var RB=function(){D0.call(this),this.edit=!0};sh(RB,D0);var nc=function(){nf.call(this),this.FT="/Btn",Object.defineProperty(this,"noToggleToOff",{enumerable:!0,configurable:!0,get:function(){return!!Oa(this.Ff,15)},set:function(t){t?this.Ff=ka(this.Ff,15):this.Ff=Ua(this.Ff,15)}}),Object.defineProperty(this,"radio",{enumerable:!0,configurable:!0,get:function(){return!!Oa(this.Ff,16)},set:function(t){t?this.Ff=ka(this.Ff,16):this.Ff=Ua(this.Ff,16)}}),Object.defineProperty(this,"pushButton",{enumerable:!0,configurable:!0,get:function(){return!!Oa(this.Ff,17)},set:function(t){t?this.Ff=ka(this.Ff,17):this.Ff=Ua(this.Ff,17)}}),Object.defineProperty(this,"radioIsUnison",{enumerable:!0,configurable:!0,get:function(){return!!Oa(this.Ff,26)},set:function(t){t?this.Ff=ka(this.Ff,26):this.Ff=Ua(this.Ff,26)}});var r,e={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var t=function(s){return s};if(this.scope&&(t=this.scope.internal.getEncryptor(this.objId)),Object.keys(e).length!==0){var n,i=[];for(n in i.push("<<"),e)i.push("/"+n+" ("+im(t(e[n]))+")");return i.push(">>"),i.join(`
`)}},set:function(t){Ms(t)==="object"&&(e=t)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return e.CA||""},set:function(t){typeof t=="string"&&(e.CA=t)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return r},set:function(t){r=t}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return r.substr(1,r.length-1)},set:function(t){r="/"+t}})};sh(nc,nf);var LB=function(){nc.call(this),this.pushButton=!0};sh(LB,nc);var O0=function(){nc.call(this),this.radio=!0,this.pushButton=!1;var r=[];Object.defineProperty(this,"Kids",{enumerable:!0,configurable:!1,get:function(){return r},set:function(e){r=e!==void 0?e:[]}})};sh(O0,nc);var DB=function(){var r,e;nf.call(this),Object.defineProperty(this,"Parent",{enumerable:!1,configurable:!1,get:function(){return r},set:function(i){r=i}}),Object.defineProperty(this,"optionName",{enumerable:!1,configurable:!0,get:function(){return e},set:function(i){e=i}});var t,n={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var i=function(o){return o};this.scope&&(i=this.scope.internal.getEncryptor(this.objId));var s,a=[];for(s in a.push("<<"),n)a.push("/"+s+" ("+im(i(n[s]))+")");return a.push(">>"),a.join(`
`)},set:function(i){Ms(i)==="object"&&(n=i)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return n.CA||""},set:function(i){typeof i=="string"&&(n.CA=i)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return t},set:function(i){t=i}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return t.substr(1,t.length-1)},set:function(i){t="/"+i}}),this.caption="l",this.appearanceState="Off",this._AppearanceType=Xn.RadioButton.Circle,this.appearanceStreamContent=this._AppearanceType.createAppearanceStream(this.optionName)};sh(DB,nf),O0.prototype.setAppearance=function(r){if(!("createAppearanceStream"in r)||!("getCA"in r))throw new Error("Couldn't assign Appearance to RadioButton. Appearance was Invalid!");for(var e in this.Kids)if(this.Kids.hasOwnProperty(e)){var t=this.Kids[e];t.appearanceStreamContent=r.createAppearanceStream(t.optionName),t.caption=r.getCA()}},O0.prototype.createOption=function(r){var e=new DB;return e.Parent=this,e.optionName=r,this.Kids.push(e),x5e.call(this.scope,e),e};var OB=function(){nc.call(this),this.fontName="zapfdingbats",this.caption="3",this.appearanceState="On",this.value="On",this.textAlign="center",this.appearanceStreamContent=Xn.CheckBox.createAppearanceStream()};sh(OB,nc);var sm=function(){nf.call(this),this.FT="/Tx",Object.defineProperty(this,"multiline",{enumerable:!0,configurable:!0,get:function(){return!!Oa(this.Ff,13)},set:function(e){e?this.Ff=ka(this.Ff,13):this.Ff=Ua(this.Ff,13)}}),Object.defineProperty(this,"fileSelect",{enumerable:!0,configurable:!0,get:function(){return!!Oa(this.Ff,21)},set:function(e){e?this.Ff=ka(this.Ff,21):this.Ff=Ua(this.Ff,21)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!Oa(this.Ff,23)},set:function(e){e?this.Ff=ka(this.Ff,23):this.Ff=Ua(this.Ff,23)}}),Object.defineProperty(this,"doNotScroll",{enumerable:!0,configurable:!0,get:function(){return!!Oa(this.Ff,24)},set:function(e){e?this.Ff=ka(this.Ff,24):this.Ff=Ua(this.Ff,24)}}),Object.defineProperty(this,"comb",{enumerable:!0,configurable:!0,get:function(){return!!Oa(this.Ff,25)},set:function(e){e?this.Ff=ka(this.Ff,25):this.Ff=Ua(this.Ff,25)}}),Object.defineProperty(this,"richText",{enumerable:!0,configurable:!0,get:function(){return!!Oa(this.Ff,26)},set:function(e){e?this.Ff=ka(this.Ff,26):this.Ff=Ua(this.Ff,26)}});var r=null;Object.defineProperty(this,"MaxLen",{enumerable:!0,configurable:!1,get:function(){return r},set:function(e){r=e}}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,get:function(){return r},set:function(e){Number.isInteger(e)&&(r=e)}}),Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return this.V||this.DV}})};sh(sm,nf);var kB=function(){sm.call(this),Object.defineProperty(this,"password",{enumerable:!0,configurable:!0,get:function(){return!!Oa(this.Ff,14)},set:function(r){r?this.Ff=ka(this.Ff,14):this.Ff=Ua(this.Ff,14)}}),this.password=!0};sh(kB,sm);var Xn={CheckBox:{createAppearanceStream:function(){return{N:{On:Xn.CheckBox.YesNormal},D:{On:Xn.CheckBox.YesPushDown,Off:Xn.CheckBox.OffPushDown}}},YesPushDown:function(r){var e=Xf(r);e.scope=r.scope;var t=[],n=r.scope.internal.getFont(r.fontName,r.fontStyle).id,i=r.scope.__private__.encodeColorString(r.color),s=bR(r,r.caption);return t.push("0.749023 g"),t.push("0 0 "+Si(Xn.internal.getWidth(r))+" "+Si(Xn.internal.getHeight(r))+" re"),t.push("f"),t.push("BMC"),t.push("q"),t.push("0 0 1 rg"),t.push("/"+n+" "+Si(s.fontSize)+" Tf "+i),t.push("BT"),t.push(s.text),t.push("ET"),t.push("Q"),t.push("EMC"),e.stream=t.join(`
`),e},YesNormal:function(r){var e=Xf(r);e.scope=r.scope;var t=r.scope.internal.getFont(r.fontName,r.fontStyle).id,n=r.scope.__private__.encodeColorString(r.color),i=[],s=Xn.internal.getHeight(r),a=Xn.internal.getWidth(r),o=bR(r,r.caption);return i.push("1 g"),i.push("0 0 "+Si(a)+" "+Si(s)+" re"),i.push("f"),i.push("q"),i.push("0 0 1 rg"),i.push("0 0 "+Si(a-1)+" "+Si(s-1)+" re"),i.push("W"),i.push("n"),i.push("0 g"),i.push("BT"),i.push("/"+t+" "+Si(o.fontSize)+" Tf "+n),i.push(o.text),i.push("ET"),i.push("Q"),e.stream=i.join(`
`),e},OffPushDown:function(r){var e=Xf(r);e.scope=r.scope;var t=[];return t.push("0.749023 g"),t.push("0 0 "+Si(Xn.internal.getWidth(r))+" "+Si(Xn.internal.getHeight(r))+" re"),t.push("f"),e.stream=t.join(`
`),e}},RadioButton:{Circle:{createAppearanceStream:function(r){var e={D:{Off:Xn.RadioButton.Circle.OffPushDown},N:{}};return e.N[r]=Xn.RadioButton.Circle.YesNormal,e.D[r]=Xn.RadioButton.Circle.YesPushDown,e},getCA:function(){return"l"},YesNormal:function(r){var e=Xf(r);e.scope=r.scope;var t=[],n=Xn.internal.getWidth(r)<=Xn.internal.getHeight(r)?Xn.internal.getWidth(r)/4:Xn.internal.getHeight(r)/4;n=Number((.9*n).toFixed(5));var i=Xn.internal.Bezier_C,s=Number((n*i).toFixed(5));return t.push("q"),t.push("1 0 0 1 "+Sp(Xn.internal.getWidth(r)/2)+" "+Sp(Xn.internal.getHeight(r)/2)+" cm"),t.push(n+" 0 m"),t.push(n+" "+s+" "+s+" "+n+" 0 "+n+" c"),t.push("-"+s+" "+n+" -"+n+" "+s+" -"+n+" 0 c"),t.push("-"+n+" -"+s+" -"+s+" -"+n+" 0 -"+n+" c"),t.push(s+" -"+n+" "+n+" -"+s+" "+n+" 0 c"),t.push("f"),t.push("Q"),e.stream=t.join(`
`),e},YesPushDown:function(r){var e=Xf(r);e.scope=r.scope;var t=[],n=Xn.internal.getWidth(r)<=Xn.internal.getHeight(r)?Xn.internal.getWidth(r)/4:Xn.internal.getHeight(r)/4;n=Number((.9*n).toFixed(5));var i=Number((2*n).toFixed(5)),s=Number((i*Xn.internal.Bezier_C).toFixed(5)),a=Number((n*Xn.internal.Bezier_C).toFixed(5));return t.push("0.749023 g"),t.push("q"),t.push("1 0 0 1 "+Sp(Xn.internal.getWidth(r)/2)+" "+Sp(Xn.internal.getHeight(r)/2)+" cm"),t.push(i+" 0 m"),t.push(i+" "+s+" "+s+" "+i+" 0 "+i+" c"),t.push("-"+s+" "+i+" -"+i+" "+s+" -"+i+" 0 c"),t.push("-"+i+" -"+s+" -"+s+" -"+i+" 0 -"+i+" c"),t.push(s+" -"+i+" "+i+" -"+s+" "+i+" 0 c"),t.push("f"),t.push("Q"),t.push("0 g"),t.push("q"),t.push("1 0 0 1 "+Sp(Xn.internal.getWidth(r)/2)+" "+Sp(Xn.internal.getHeight(r)/2)+" cm"),t.push(n+" 0 m"),t.push(n+" "+a+" "+a+" "+n+" 0 "+n+" c"),t.push("-"+a+" "+n+" -"+n+" "+a+" -"+n+" 0 c"),t.push("-"+n+" -"+a+" -"+a+" -"+n+" 0 -"+n+" c"),t.push(a+" -"+n+" "+n+" -"+a+" "+n+" 0 c"),t.push("f"),t.push("Q"),e.stream=t.join(`
`),e},OffPushDown:function(r){var e=Xf(r);e.scope=r.scope;var t=[],n=Xn.internal.getWidth(r)<=Xn.internal.getHeight(r)?Xn.internal.getWidth(r)/4:Xn.internal.getHeight(r)/4;n=Number((.9*n).toFixed(5));var i=Number((2*n).toFixed(5)),s=Number((i*Xn.internal.Bezier_C).toFixed(5));return t.push("0.749023 g"),t.push("q"),t.push("1 0 0 1 "+Sp(Xn.internal.getWidth(r)/2)+" "+Sp(Xn.internal.getHeight(r)/2)+" cm"),t.push(i+" 0 m"),t.push(i+" "+s+" "+s+" "+i+" 0 "+i+" c"),t.push("-"+s+" "+i+" -"+i+" "+s+" -"+i+" 0 c"),t.push("-"+i+" -"+s+" -"+s+" -"+i+" 0 -"+i+" c"),t.push(s+" -"+i+" "+i+" -"+s+" "+i+" 0 c"),t.push("f"),t.push("Q"),e.stream=t.join(`
`),e}},Cross:{createAppearanceStream:function(r){var e={D:{Off:Xn.RadioButton.Cross.OffPushDown},N:{}};return e.N[r]=Xn.RadioButton.Cross.YesNormal,e.D[r]=Xn.RadioButton.Cross.YesPushDown,e},getCA:function(){return"8"},YesNormal:function(r){var e=Xf(r);e.scope=r.scope;var t=[],n=Xn.internal.calculateCross(r);return t.push("q"),t.push("1 1 "+Si(Xn.internal.getWidth(r)-2)+" "+Si(Xn.internal.getHeight(r)-2)+" re"),t.push("W"),t.push("n"),t.push(Si(n.x1.x)+" "+Si(n.x1.y)+" m"),t.push(Si(n.x2.x)+" "+Si(n.x2.y)+" l"),t.push(Si(n.x4.x)+" "+Si(n.x4.y)+" m"),t.push(Si(n.x3.x)+" "+Si(n.x3.y)+" l"),t.push("s"),t.push("Q"),e.stream=t.join(`
`),e},YesPushDown:function(r){var e=Xf(r);e.scope=r.scope;var t=Xn.internal.calculateCross(r),n=[];return n.push("0.749023 g"),n.push("0 0 "+Si(Xn.internal.getWidth(r))+" "+Si(Xn.internal.getHeight(r))+" re"),n.push("f"),n.push("q"),n.push("1 1 "+Si(Xn.internal.getWidth(r)-2)+" "+Si(Xn.internal.getHeight(r)-2)+" re"),n.push("W"),n.push("n"),n.push(Si(t.x1.x)+" "+Si(t.x1.y)+" m"),n.push(Si(t.x2.x)+" "+Si(t.x2.y)+" l"),n.push(Si(t.x4.x)+" "+Si(t.x4.y)+" m"),n.push(Si(t.x3.x)+" "+Si(t.x3.y)+" l"),n.push("s"),n.push("Q"),e.stream=n.join(`
`),e},OffPushDown:function(r){var e=Xf(r);e.scope=r.scope;var t=[];return t.push("0.749023 g"),t.push("0 0 "+Si(Xn.internal.getWidth(r))+" "+Si(Xn.internal.getHeight(r))+" re"),t.push("f"),e.stream=t.join(`
`),e}}},createDefaultAppearanceStream:function(r){var e=r.scope.internal.getFont(r.fontName,r.fontStyle).id,t=r.scope.__private__.encodeColorString(r.color);return"/"+e+" "+r.fontSize+" Tf "+t}};Xn.internal={Bezier_C:.551915024494,calculateCross:function(r){var e=Xn.internal.getWidth(r),t=Xn.internal.getHeight(r),n=Math.min(e,t);return{x1:{x:(e-n)/2,y:(t-n)/2+n},x2:{x:(e-n)/2+n,y:(t-n)/2},x3:{x:(e-n)/2,y:(t-n)/2},x4:{x:(e-n)/2+n,y:(t-n)/2+n}}}},Xn.internal.getWidth=function(r){var e=0;return Ms(r)==="object"&&(e=t$(r.Rect[2])),e},Xn.internal.getHeight=function(r){var e=0;return Ms(r)==="object"&&(e=t$(r.Rect[3])),e};var x5e=ba.addField=function(r){if(v5e(this,r),!(r instanceof nf))throw new Error("Invalid argument passed to jsPDF.addField.");var e;return(e=r).scope.internal.acroformPlugin.printedOut&&(e.scope.internal.acroformPlugin.printedOut=!1,e.scope.internal.acroformPlugin.acroFormDictionaryRoot=null),e.scope.internal.acroformPlugin.acroFormDictionaryRoot.Fields.push(e),r.page=r.scope.internal.getCurrentPageInfo().pageNumber,this};ba.AcroFormChoiceField=R0,ba.AcroFormListBox=L0,ba.AcroFormComboBox=D0,ba.AcroFormEditBox=RB,ba.AcroFormButton=nc,ba.AcroFormPushButton=LB,ba.AcroFormRadioButton=O0,ba.AcroFormCheckBox=OB,ba.AcroFormTextField=sm,ba.AcroFormPasswordField=kB,ba.AcroFormAppearance=Xn,ba.AcroForm={ChoiceField:R0,ListBox:L0,ComboBox:D0,EditBox:RB,Button:nc,PushButton:LB,RadioButton:O0,CheckBox:OB,TextField:sm,PasswordField:kB,Appearance:Xn},yi.AcroForm={ChoiceField:R0,ListBox:L0,ComboBox:D0,EditBox:RB,Button:nc,PushButton:LB,RadioButton:O0,CheckBox:OB,TextField:sm,PasswordField:kB,Appearance:Xn};function s$(r){return r.reduce(function(e,t,n){return e[t]=n,e},{})}(function(r){r.__addimage__={};var e="UNKNOWN",t={PNG:[[137,80,78,71]],TIFF:[[77,77,0,42],[73,73,42,0]],JPEG:[[255,216,255,224,void 0,void 0,74,70,73,70,0],[255,216,255,225,void 0,void 0,69,120,105,102,0,0],[255,216,255,219],[255,216,255,238]],JPEG2000:[[0,0,0,12,106,80,32,32]],GIF87a:[[71,73,70,56,55,97]],GIF89a:[[71,73,70,56,57,97]],WEBP:[[82,73,70,70,void 0,void 0,void 0,void 0,87,69,66,80]],BMP:[[66,77],[66,65],[67,73],[67,80],[73,67],[80,84]]},n=r.__addimage__.getImageFileTypeByImageData=function(Le,ze){var tt,Ne,Ht,Vt,Jt,Kt=e;if((ze=ze||e)==="RGBA"||Le.data!==void 0&&Le.data instanceof Uint8ClampedArray&&"height"in Le&&"width"in Le)return"RGBA";if(be(Le))for(Jt in t)for(Ht=t[Jt],tt=0;tt<Ht.length;tt+=1){for(Vt=!0,Ne=0;Ne<Ht[tt].length;Ne+=1)if(Ht[tt][Ne]!==void 0&&Ht[tt][Ne]!==Le[Ne]){Vt=!1;break}if(Vt===!0){Kt=Jt;break}}else for(Jt in t)for(Ht=t[Jt],tt=0;tt<Ht.length;tt+=1){for(Vt=!0,Ne=0;Ne<Ht[tt].length;Ne+=1)if(Ht[tt][Ne]!==void 0&&Ht[tt][Ne]!==Le.charCodeAt(Ne)){Vt=!1;break}if(Vt===!0){Kt=Jt;break}}return Kt===e&&ze!==e&&(Kt=ze),Kt},i=function Le(ze){for(var tt=this.internal.write,Ne=this.internal.putStream,Ht=(0,this.internal.getFilters)();Ht.indexOf("FlateEncode")!==-1;)Ht.splice(Ht.indexOf("FlateEncode"),1);ze.objectId=this.internal.newObject();var Vt=[];if(Vt.push({key:"Type",value:"/XObject"}),Vt.push({key:"Subtype",value:"/Image"}),Vt.push({key:"Width",value:ze.width}),Vt.push({key:"Height",value:ze.height}),ze.colorSpace===W.INDEXED?Vt.push({key:"ColorSpace",value:"[/Indexed /DeviceRGB "+(ze.palette.length/3-1)+" "+("sMask"in ze&&ze.sMask!==void 0?ze.objectId+2:ze.objectId+1)+" 0 R]"}):(Vt.push({key:"ColorSpace",value:"/"+ze.colorSpace}),ze.colorSpace===W.DEVICE_CMYK&&Vt.push({key:"Decode",value:"[1 0 1 0 1 0 1 0]"})),Vt.push({key:"BitsPerComponent",value:ze.bitsPerComponent}),"decodeParameters"in ze&&ze.decodeParameters!==void 0&&Vt.push({key:"DecodeParms",value:"<<"+ze.decodeParameters+">>"}),"transparency"in ze&&Array.isArray(ze.transparency)){for(var Jt="",Kt=0,er=ze.transparency.length;Kt<er;Kt++)Jt+=ze.transparency[Kt]+" "+ze.transparency[Kt]+" ";Vt.push({key:"Mask",value:"["+Jt+"]"})}ze.sMask!==void 0&&Vt.push({key:"SMask",value:ze.objectId+1+" 0 R"});var Xt=ze.filter!==void 0?["/"+ze.filter]:void 0;if(Ne({data:ze.data,additionalKeyValues:Vt,alreadyAppliedFilters:Xt,objectId:ze.objectId}),tt("endobj"),"sMask"in ze&&ze.sMask!==void 0){var Fr="/Predictor "+ze.predictor+" /Colors 1 /BitsPerComponent "+ze.bitsPerComponent+" /Columns "+ze.width,$e={width:ze.width,height:ze.height,colorSpace:"DeviceGray",bitsPerComponent:ze.bitsPerComponent,decodeParameters:Fr,data:ze.sMask};"filter"in ze&&($e.filter=ze.filter),Le.call(this,$e)}if(ze.colorSpace===W.INDEXED){var ut=this.internal.newObject();Ne({data:Ue(new Uint8Array(ze.palette)),objectId:ut}),tt("endobj")}},s=function(){var Le=this.internal.collections.addImage_images;for(var ze in Le)i.call(this,Le[ze])},a=function(){var Le,ze=this.internal.collections.addImage_images,tt=this.internal.write;for(var Ne in ze)tt("/I"+(Le=ze[Ne]).index,Le.objectId,"0","R")},o=function(){this.internal.collections.addImage_images||(this.internal.collections.addImage_images={},this.internal.events.subscribe("putResources",s),this.internal.events.subscribe("putXobjectDict",a))},h=function(){var Le=this.internal.collections.addImage_images;return o.call(this),Le},f=function(){return Object.keys(this.internal.collections.addImage_images).length},_=function(Le){return typeof r["process"+Le.toUpperCase()]=="function"},x=function(Le){return Ms(Le)==="object"&&Le.nodeType===1},T=function(Le,ze){if(Le.nodeName==="IMG"&&Le.hasAttribute("src")){var tt=""+Le.getAttribute("src");if(tt.indexOf("data:image/")===0)return Tb(unescape(tt).split("base64,").pop());var Ne=r.loadFile(tt,!0);if(Ne!==void 0)return Ne}if(Le.nodeName==="CANVAS"){if(Le.width===0||Le.height===0)throw new Error("Given canvas must have data. Canvas width: "+Le.width+", height: "+Le.height);var Ht;switch(ze){case"PNG":Ht="image/png";break;case"WEBP":Ht="image/webp";break;case"JPEG":case"JPG":default:Ht="image/jpeg"}return Tb(Le.toDataURL(Ht,1).split("base64,").pop())}},I=function(Le){var ze=this.internal.collections.addImage_images;if(ze){for(var tt in ze)if(Le===ze[tt].alias)return ze[tt]}},N=function(Le,ze,tt){return Le||ze||(Le=-96,ze=-96),Le<0&&(Le=-1*tt.width*72/Le/this.internal.scaleFactor),ze<0&&(ze=-1*tt.height*72/ze/this.internal.scaleFactor),Le===0&&(Le=ze*tt.width/tt.height),ze===0&&(ze=Le*tt.height/tt.width),[Le,ze]},$=function(Le,ze,tt,Ne,Ht,Vt){var Jt=N.call(this,tt,Ne,Ht),Kt=this.internal.getCoordinateString,er=this.internal.getVerticalCoordinateString,Xt=h.call(this);if(tt=Jt[0],Ne=Jt[1],Xt[Ht.index]=Ht,Vt){Vt*=Math.PI/180;var Fr=Math.cos(Vt),$e=Math.sin(Vt),ut=function(St){return St.toFixed(4)},Bt=[ut(Fr),ut($e),ut(-1*$e),ut(Fr),0,0,"cm"]}this.internal.write("q"),Vt?(this.internal.write([1,"0","0",1,Kt(Le),er(ze+Ne),"cm"].join(" ")),this.internal.write(Bt.join(" ")),this.internal.write([Kt(tt),"0","0",Kt(Ne),"0","0","cm"].join(" "))):this.internal.write([Kt(tt),"0","0",Kt(Ne),Kt(Le),er(ze+Ne),"cm"].join(" ")),this.isAdvancedAPI()&&this.internal.write([1,0,0,-1,0,0,"cm"].join(" ")),this.internal.write("/I"+Ht.index+" Do"),this.internal.write("Q")},W=r.color_spaces={DEVICE_RGB:"DeviceRGB",DEVICE_GRAY:"DeviceGray",DEVICE_CMYK:"DeviceCMYK",CAL_GREY:"CalGray",CAL_RGB:"CalRGB",LAB:"Lab",ICC_BASED:"ICCBased",INDEXED:"Indexed",PATTERN:"Pattern",SEPARATION:"Separation",DEVICE_N:"DeviceN"};r.decode={DCT_DECODE:"DCTDecode",FLATE_DECODE:"FlateDecode",LZW_DECODE:"LZWDecode",JPX_DECODE:"JPXDecode",JBIG2_DECODE:"JBIG2Decode",ASCII85_DECODE:"ASCII85Decode",ASCII_HEX_DECODE:"ASCIIHexDecode",RUN_LENGTH_DECODE:"RunLengthDecode",CCITT_FAX_DECODE:"CCITTFaxDecode"};var Y=r.image_compression={NONE:"NONE",FAST:"FAST",MEDIUM:"MEDIUM",SLOW:"SLOW"},ie=r.__addimage__.sHashCode=function(Le){var ze,tt,Ne=0;if(typeof Le=="string")for(tt=Le.length,ze=0;ze<tt;ze++)Ne=(Ne<<5)-Ne+Le.charCodeAt(ze),Ne|=0;else if(be(Le))for(tt=Le.byteLength/2,ze=0;ze<tt;ze++)Ne=(Ne<<5)-Ne+Le[ze],Ne|=0;return Ne},ce=r.__addimage__.validateStringAsBase64=function(Le){(Le=Le||"").toString().trim();var ze=!0;return Le.length===0&&(ze=!1),Le.length%4!=0&&(ze=!1),/^[A-Za-z0-9+/]+$/.test(Le.substr(0,Le.length-2))===!1&&(ze=!1),/^[A-Za-z0-9/][A-Za-z0-9+/]|[A-Za-z0-9+/]=|==$/.test(Le.substr(-2))===!1&&(ze=!1),ze},fe=r.__addimage__.extractImageFromDataUrl=function(Le){var ze=(Le=Le||"").split("base64,"),tt=null;if(ze.length===2){var Ne=/^data:(\w*\/\w*);*(charset=(?!charset=)[\w=-]*)*;*$/.exec(ze[0]);Array.isArray(Ne)&&(tt={mimeType:Ne[1],charset:Ne[2],data:ze[1]})}return tt},ve=r.__addimage__.supportsArrayBuffer=function(){return typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"};r.__addimage__.isArrayBuffer=function(Le){return ve()&&Le instanceof ArrayBuffer};var be=r.__addimage__.isArrayBufferView=function(Le){return ve()&&typeof Uint32Array<"u"&&(Le instanceof Int8Array||Le instanceof Uint8Array||typeof Uint8ClampedArray<"u"&&Le instanceof Uint8ClampedArray||Le instanceof Int16Array||Le instanceof Uint16Array||Le instanceof Int32Array||Le instanceof Uint32Array||Le instanceof Float32Array||Le instanceof Float64Array)},Qe=r.__addimage__.binaryStringToUint8Array=function(Le){for(var ze=Le.length,tt=new Uint8Array(ze),Ne=0;Ne<ze;Ne++)tt[Ne]=Le.charCodeAt(Ne);return tt},Ue=r.__addimage__.arrayBufferToBinaryString=function(Le){for(var ze="",tt=be(Le)?Le:new Uint8Array(Le),Ne=0;Ne<tt.length;Ne+=8192)ze+=String.fromCharCode.apply(null,tt.subarray(Ne,Ne+8192));return ze};r.addImage=function(){var Le,ze,tt,Ne,Ht,Vt,Jt,Kt,er;if(typeof arguments[1]=="number"?(ze=e,tt=arguments[1],Ne=arguments[2],Ht=arguments[3],Vt=arguments[4],Jt=arguments[5],Kt=arguments[6],er=arguments[7]):(ze=arguments[1],tt=arguments[2],Ne=arguments[3],Ht=arguments[4],Vt=arguments[5],Jt=arguments[6],Kt=arguments[7],er=arguments[8]),Ms(Le=arguments[0])==="object"&&!x(Le)&&"imageData"in Le){var Xt=Le;Le=Xt.imageData,ze=Xt.format||ze||e,tt=Xt.x||tt||0,Ne=Xt.y||Ne||0,Ht=Xt.w||Xt.width||Ht,Vt=Xt.h||Xt.height||Vt,Jt=Xt.alias||Jt,Kt=Xt.compression||Kt,er=Xt.rotation||Xt.angle||er}var Fr=this.internal.getFilters();if(Kt===void 0&&Fr.indexOf("FlateEncode")!==-1&&(Kt="SLOW"),isNaN(tt)||isNaN(Ne))throw new Error("Invalid coordinates passed to jsPDF.addImage");o.call(this);var $e=st.call(this,Le,ze,Jt,Kt);return $.call(this,tt,Ne,Ht,Vt,$e,er),this};var st=function(Le,ze,tt,Ne){var Ht,Vt,Jt;if(typeof Le=="string"&&n(Le)===e){Le=unescape(Le);var Kt=at(Le,!1);(Kt!==""||(Kt=r.loadFile(Le,!0))!==void 0)&&(Le=Kt)}if(x(Le)&&(Le=T(Le,ze)),ze=n(Le,ze),!_(ze))throw new Error("addImage does not support files of type '"+ze+"', please ensure that a plugin for '"+ze+"' support is added.");if(((Jt=tt)==null||Jt.length===0)&&(tt=function(er){return typeof er=="string"||be(er)?ie(er):be(er.data)?ie(er.data):null}(Le)),(Ht=I.call(this,tt))||(ve()&&(Le instanceof Uint8Array||ze==="RGBA"||(Vt=Le,Le=Qe(Le))),Ht=this["process"+ze.toUpperCase()](Le,f.call(this),tt,function(er){return er&&typeof er=="string"&&(er=er.toUpperCase()),er in r.image_compression?er:Y.NONE}(Ne),Vt)),!Ht)throw new Error("An unknown error occurred whilst processing the image.");return Ht},at=r.__addimage__.convertBase64ToBinaryString=function(Le,ze){var tt;ze=typeof ze!="boolean"||ze;var Ne,Ht="";if(typeof Le=="string"){Ne=(tt=fe(Le))!==null?tt.data:Le;try{Ht=Tb(Ne)}catch(Vt){if(ze)throw ce(Ne)?new Error("atob-Error in jsPDF.convertBase64ToBinaryString "+Vt.message):new Error("Supplied Data is not a valid base64-String jsPDF.convertBase64ToBinaryString ")}}return Ht};r.getImageProperties=function(Le){var ze,tt,Ne="";if(x(Le)&&(Le=T(Le)),typeof Le=="string"&&n(Le)===e&&((Ne=at(Le,!1))===""&&(Ne=r.loadFile(Le)||""),Le=Ne),tt=n(Le),!_(tt))throw new Error("addImage does not support files of type '"+tt+"', please ensure that a plugin for '"+tt+"' support is added.");if(!ve()||Le instanceof Uint8Array||(Le=Qe(Le)),!(ze=this["process"+tt.toUpperCase()](Le)))throw new Error("An unknown error occurred whilst processing the image");return ze.fileType=tt,ze}})(yi.API),function(r){var e=function(t){if(t!==void 0&&t!="")return!0};yi.API.events.push(["addPage",function(t){this.internal.getPageInfo(t.pageNumber).pageContext.annotations=[]}]),r.events.push(["putPage",function(t){for(var n,i,s,a=this.internal.getCoordinateString,o=this.internal.getVerticalCoordinateString,h=this.internal.getPageInfoByObjId(t.objId),f=t.pageContext.annotations,_=!1,x=0;x<f.length&&!_;x++)switch((n=f[x]).type){case"link":(e(n.options.url)||e(n.options.pageNumber))&&(_=!0);break;case"reference":case"text":case"freetext":_=!0}if(_!=0){this.internal.write("/Annots [");for(var T=0;T<f.length;T++){n=f[T];var I=this.internal.pdfEscape,N=this.internal.getEncryptor(t.objId);switch(n.type){case"reference":this.internal.write(" "+n.object.objId+" 0 R ");break;case"text":var $=this.internal.newAdditionalObject(),W=this.internal.newAdditionalObject(),Y=this.internal.getEncryptor($.objId),ie=n.title||"Note";s="<</Type /Annot /Subtype /Text "+(i="/Rect ["+a(n.bounds.x)+" "+o(n.bounds.y+n.bounds.h)+" "+a(n.bounds.x+n.bounds.w)+" "+o(n.bounds.y)+"] ")+"/Contents ("+I(Y(n.contents))+")",s+=" /Popup "+W.objId+" 0 R",s+=" /P "+h.objId+" 0 R",s+=" /T ("+I(Y(ie))+") >>",$.content=s;var ce=$.objId+" 0 R";s="<</Type /Annot /Subtype /Popup "+(i="/Rect ["+a(n.bounds.x+30)+" "+o(n.bounds.y+n.bounds.h)+" "+a(n.bounds.x+n.bounds.w+30)+" "+o(n.bounds.y)+"] ")+" /Parent "+ce,n.open&&(s+=" /Open true"),s+=" >>",W.content=s,this.internal.write($.objId,"0 R",W.objId,"0 R");break;case"freetext":i="/Rect ["+a(n.bounds.x)+" "+o(n.bounds.y)+" "+a(n.bounds.x+n.bounds.w)+" "+o(n.bounds.y+n.bounds.h)+"] ";var fe=n.color||"#000000";s="<</Type /Annot /Subtype /FreeText "+i+"/Contents ("+I(N(n.contents))+")",s+=" /DS(font: Helvetica,sans-serif 12.0pt; text-align:left; color:#"+fe+")",s+=" /Border [0 0 0]",s+=" >>",this.internal.write(s);break;case"link":if(n.options.name){var ve=this.annotations._nameMap[n.options.name];n.options.pageNumber=ve.page,n.options.top=ve.y}else n.options.top||(n.options.top=0);if(i="/Rect ["+n.finalBounds.x+" "+n.finalBounds.y+" "+n.finalBounds.w+" "+n.finalBounds.h+"] ",s="",n.options.url)s="<</Type /Annot /Subtype /Link "+i+"/Border [0 0 0] /A <</S /URI /URI ("+I(N(n.options.url))+") >>";else if(n.options.pageNumber)switch(s="<</Type /Annot /Subtype /Link "+i+"/Border [0 0 0] /Dest ["+this.internal.getPageInfo(n.options.pageNumber).objId+" 0 R",n.options.magFactor=n.options.magFactor||"XYZ",n.options.magFactor){case"Fit":s+=" /Fit]";break;case"FitH":s+=" /FitH "+n.options.top+"]";break;case"FitV":n.options.left=n.options.left||0,s+=" /FitV "+n.options.left+"]";break;case"XYZ":default:var be=o(n.options.top);n.options.left=n.options.left||0,n.options.zoom===void 0&&(n.options.zoom=0),s+=" /XYZ "+n.options.left+" "+be+" "+n.options.zoom+"]"}s!=""&&(s+=" >>",this.internal.write(s))}}this.internal.write("]")}}]),r.createAnnotation=function(t){var n=this.internal.getCurrentPageInfo();switch(t.type){case"link":this.link(t.bounds.x,t.bounds.y,t.bounds.w,t.bounds.h,t);break;case"text":case"freetext":n.pageContext.annotations.push(t)}},r.link=function(t,n,i,s,a){var o=this.internal.getCurrentPageInfo(),h=this.internal.getCoordinateString,f=this.internal.getVerticalCoordinateString;o.pageContext.annotations.push({finalBounds:{x:h(t),y:f(n),w:h(t+i),h:f(n+s)},options:a,type:"link"})},r.textWithLink=function(t,n,i,s){var a,o,h=this.getTextWidth(t),f=this.internal.getLineHeight()/this.internal.scaleFactor;if(s.maxWidth!==void 0){o=s.maxWidth;var _=this.splitTextToSize(t,o).length;a=Math.ceil(f*_)}else o=h,a=f;return this.text(t,n,i,s),i+=.2*f,s.align==="center"&&(n-=h/2),s.align==="right"&&(n-=h),this.link(n,i-f,o,a,s),h},r.getTextWidth=function(t){var n=this.internal.getFontSize();return this.getStringUnitWidth(t)*n/this.internal.scaleFactor}}(yi.API),function(r){var e={1569:[65152],1570:[65153,65154],1571:[65155,65156],1572:[65157,65158],1573:[65159,65160],1574:[65161,65162,65163,65164],1575:[65165,65166],1576:[65167,65168,65169,65170],1577:[65171,65172],1578:[65173,65174,65175,65176],1579:[65177,65178,65179,65180],1580:[65181,65182,65183,65184],1581:[65185,65186,65187,65188],1582:[65189,65190,65191,65192],1583:[65193,65194],1584:[65195,65196],1585:[65197,65198],1586:[65199,65200],1587:[65201,65202,65203,65204],1588:[65205,65206,65207,65208],1589:[65209,65210,65211,65212],1590:[65213,65214,65215,65216],1591:[65217,65218,65219,65220],1592:[65221,65222,65223,65224],1593:[65225,65226,65227,65228],1594:[65229,65230,65231,65232],1601:[65233,65234,65235,65236],1602:[65237,65238,65239,65240],1603:[65241,65242,65243,65244],1604:[65245,65246,65247,65248],1605:[65249,65250,65251,65252],1606:[65253,65254,65255,65256],1607:[65257,65258,65259,65260],1608:[65261,65262],1609:[65263,65264,64488,64489],1610:[65265,65266,65267,65268],1649:[64336,64337],1655:[64477],1657:[64358,64359,64360,64361],1658:[64350,64351,64352,64353],1659:[64338,64339,64340,64341],1662:[64342,64343,64344,64345],1663:[64354,64355,64356,64357],1664:[64346,64347,64348,64349],1667:[64374,64375,64376,64377],1668:[64370,64371,64372,64373],1670:[64378,64379,64380,64381],1671:[64382,64383,64384,64385],1672:[64392,64393],1676:[64388,64389],1677:[64386,64387],1678:[64390,64391],1681:[64396,64397],1688:[64394,64395],1700:[64362,64363,64364,64365],1702:[64366,64367,64368,64369],1705:[64398,64399,64400,64401],1709:[64467,64468,64469,64470],1711:[64402,64403,64404,64405],1713:[64410,64411,64412,64413],1715:[64406,64407,64408,64409],1722:[64414,64415],1723:[64416,64417,64418,64419],1726:[64426,64427,64428,64429],1728:[64420,64421],1729:[64422,64423,64424,64425],1733:[64480,64481],1734:[64473,64474],1735:[64471,64472],1736:[64475,64476],1737:[64482,64483],1739:[64478,64479],1740:[64508,64509,64510,64511],1744:[64484,64485,64486,64487],1746:[64430,64431],1747:[64432,64433]},t={65247:{65154:65269,65156:65271,65160:65273,65166:65275},65248:{65154:65270,65156:65272,65160:65274,65166:65276},65165:{65247:{65248:{65258:65010}}},1617:{1612:64606,1613:64607,1614:64608,1615:64609,1616:64610}},n={1612:64606,1613:64607,1614:64608,1615:64609,1616:64610},i=[1570,1571,1573,1575];r.__arabicParser__={};var s=r.__arabicParser__.isInArabicSubstitutionA=function($){return e[$.charCodeAt(0)]!==void 0},a=r.__arabicParser__.isArabicLetter=function($){return typeof $=="string"&&/^[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]+$/.test($)},o=r.__arabicParser__.isArabicEndLetter=function($){return a($)&&s($)&&e[$.charCodeAt(0)].length<=2},h=r.__arabicParser__.isArabicAlfLetter=function($){return a($)&&i.indexOf($.charCodeAt(0))>=0};r.__arabicParser__.arabicLetterHasIsolatedForm=function($){return a($)&&s($)&&e[$.charCodeAt(0)].length>=1};var f=r.__arabicParser__.arabicLetterHasFinalForm=function($){return a($)&&s($)&&e[$.charCodeAt(0)].length>=2};r.__arabicParser__.arabicLetterHasInitialForm=function($){return a($)&&s($)&&e[$.charCodeAt(0)].length>=3};var _=r.__arabicParser__.arabicLetterHasMedialForm=function($){return a($)&&s($)&&e[$.charCodeAt(0)].length==4},x=r.__arabicParser__.resolveLigatures=function($){var W=0,Y=t,ie="",ce=0;for(W=0;W<$.length;W+=1)Y[$.charCodeAt(W)]!==void 0?(ce++,typeof(Y=Y[$.charCodeAt(W)])=="number"&&(ie+=String.fromCharCode(Y),Y=t,ce=0),W===$.length-1&&(Y=t,ie+=$.charAt(W-(ce-1)),W-=ce-1,ce=0)):(Y=t,ie+=$.charAt(W-ce),W-=ce,ce=0);return ie};r.__arabicParser__.isArabicDiacritic=function($){return $!==void 0&&n[$.charCodeAt(0)]!==void 0};var T=r.__arabicParser__.getCorrectForm=function($,W,Y){return a($)?s($)===!1?-1:!f($)||!a(W)&&!a(Y)||!a(Y)&&o(W)||o($)&&!a(W)||o($)&&h(W)||o($)&&o(W)?0:_($)&&a(W)&&!o(W)&&a(Y)&&f(Y)?3:o($)||!a(Y)?1:2:-1},I=function($){var W=0,Y=0,ie=0,ce="",fe="",ve="",be=($=$||"").split("\\s+"),Qe=[];for(W=0;W<be.length;W+=1){for(Qe.push(""),Y=0;Y<be[W].length;Y+=1)ce=be[W][Y],fe=be[W][Y-1],ve=be[W][Y+1],a(ce)?(ie=T(ce,fe,ve),Qe[W]+=ie!==-1?String.fromCharCode(e[ce.charCodeAt(0)][ie]):ce):Qe[W]+=ce;Qe[W]=x(Qe[W])}return Qe.join(" ")},N=r.__arabicParser__.processArabic=r.processArabic=function(){var $,W=typeof arguments[0]=="string"?arguments[0]:arguments[0].text,Y=[];if(Array.isArray(W)){var ie=0;for(Y=[],ie=0;ie<W.length;ie+=1)Array.isArray(W[ie])?Y.push([I(W[ie][0]),W[ie][1],W[ie][2]]):Y.push([I(W[ie])]);$=Y}else $=I(W);return typeof arguments[0]=="string"?$:(arguments[0].text=$,arguments[0])};r.events.push(["preProcessText",N])}(yi.API),yi.API.autoPrint=function(r){var e;switch((r=r||{}).variant=r.variant||"non-conform",r.variant){case"javascript":this.addJS("print({});");break;case"non-conform":default:this.internal.events.subscribe("postPutResources",function(){e=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /Named"),this.internal.out("/Type /Action"),this.internal.out("/N /Print"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){this.internal.out("/OpenAction "+e+" 0 R")})}return this},function(r){var e=function(){var t=void 0;Object.defineProperty(this,"pdf",{get:function(){return t},set:function(o){t=o}});var n=150;Object.defineProperty(this,"width",{get:function(){return n},set:function(o){n=isNaN(o)||Number.isInteger(o)===!1||o<0?150:o,this.getContext("2d").pageWrapXEnabled&&(this.getContext("2d").pageWrapX=n+1)}});var i=300;Object.defineProperty(this,"height",{get:function(){return i},set:function(o){i=isNaN(o)||Number.isInteger(o)===!1||o<0?300:o,this.getContext("2d").pageWrapYEnabled&&(this.getContext("2d").pageWrapY=i+1)}});var s=[];Object.defineProperty(this,"childNodes",{get:function(){return s},set:function(o){s=o}});var a={};Object.defineProperty(this,"style",{get:function(){return a},set:function(o){a=o}}),Object.defineProperty(this,"parentNode",{})};e.prototype.getContext=function(t,n){var i;if((t=t||"2d")!=="2d")return null;for(i in n)this.pdf.context2d.hasOwnProperty(i)&&(this.pdf.context2d[i]=n[i]);return this.pdf.context2d._canvas=this,this.pdf.context2d},e.prototype.toDataURL=function(){throw new Error("toDataURL is not implemented.")},r.events.push(["initialized",function(){this.canvas=new e,this.canvas.pdf=this}])}(yi.API),function(r){var e={left:0,top:0,bottom:0,right:0},t=!1,n=function(){this.internal.__cell__===void 0&&(this.internal.__cell__={},this.internal.__cell__.padding=3,this.internal.__cell__.headerFunction=void 0,this.internal.__cell__.margins=Object.assign({},e),this.internal.__cell__.margins.width=this.getPageWidth(),i.call(this))},i=function(){this.internal.__cell__.lastCell=new s,this.internal.__cell__.pages=1},s=function(){var h=arguments[0];Object.defineProperty(this,"x",{enumerable:!0,get:function(){return h},set:function($){h=$}});var f=arguments[1];Object.defineProperty(this,"y",{enumerable:!0,get:function(){return f},set:function($){f=$}});var _=arguments[2];Object.defineProperty(this,"width",{enumerable:!0,get:function(){return _},set:function($){_=$}});var x=arguments[3];Object.defineProperty(this,"height",{enumerable:!0,get:function(){return x},set:function($){x=$}});var T=arguments[4];Object.defineProperty(this,"text",{enumerable:!0,get:function(){return T},set:function($){T=$}});var I=arguments[5];Object.defineProperty(this,"lineNumber",{enumerable:!0,get:function(){return I},set:function($){I=$}});var N=arguments[6];return Object.defineProperty(this,"align",{enumerable:!0,get:function(){return N},set:function($){N=$}}),this};s.prototype.clone=function(){return new s(this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align)},s.prototype.toArray=function(){return[this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align]},r.setHeaderFunction=function(h){return n.call(this),this.internal.__cell__.headerFunction=typeof h=="function"?h:void 0,this},r.getTextDimensions=function(h,f){n.call(this);var _=(f=f||{}).fontSize||this.getFontSize(),x=f.font||this.getFont(),T=f.scaleFactor||this.internal.scaleFactor,I=0,N=0,$=0,W=this;if(!Array.isArray(h)&&typeof h!="string"){if(typeof h!="number")throw new Error("getTextDimensions expects text-parameter to be of type String or type Number or an Array of Strings.");h=String(h)}var Y=f.maxWidth;Y>0?typeof h=="string"?h=this.splitTextToSize(h,Y):Object.prototype.toString.call(h)==="[object Array]"&&(h=h.reduce(function(ce,fe){return ce.concat(W.splitTextToSize(fe,Y))},[])):h=Array.isArray(h)?h:[h];for(var ie=0;ie<h.length;ie++)I<($=this.getStringUnitWidth(h[ie],{font:x})*_)&&(I=$);return I!==0&&(N=h.length),{w:I/=T,h:Math.max((N*_*this.getLineHeightFactor()-_*(this.getLineHeightFactor()-1))/T,0)}},r.cellAddPage=function(){n.call(this),this.addPage();var h=this.internal.__cell__.margins||e;return this.internal.__cell__.lastCell=new s(h.left,h.top,void 0,void 0),this.internal.__cell__.pages+=1,this};var a=r.cell=function(){var h;h=arguments[0]instanceof s?arguments[0]:new s(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]),n.call(this);var f=this.internal.__cell__.lastCell,_=this.internal.__cell__.padding,x=this.internal.__cell__.margins||e,T=this.internal.__cell__.tableHeaderRow,I=this.internal.__cell__.printHeaders;return f.lineNumber!==void 0&&(f.lineNumber===h.lineNumber?(h.x=(f.x||0)+(f.width||0),h.y=f.y||0):f.y+f.height+h.height+x.bottom>this.getPageHeight()?(this.cellAddPage(),h.y=x.top,I&&T&&(this.printHeaderRow(h.lineNumber,!0),h.y+=T[0].height)):h.y=f.y+f.height||h.y),h.text[0]!==void 0&&(this.rect(h.x,h.y,h.width,h.height,t===!0?"FD":void 0),h.align==="right"?this.text(h.text,h.x+h.width-_,h.y+_,{align:"right",baseline:"top"}):h.align==="center"?this.text(h.text,h.x+h.width/2,h.y+_,{align:"center",baseline:"top",maxWidth:h.width-_-_}):this.text(h.text,h.x+_,h.y+_,{align:"left",baseline:"top",maxWidth:h.width-_-_})),this.internal.__cell__.lastCell=h,this};r.table=function(h,f,_,x,T){if(n.call(this),!_)throw new Error("No data for PDF table.");var I,N,$,W,Y=[],ie=[],ce=[],fe={},ve={},be=[],Qe=[],Ue=(T=T||{}).autoSize||!1,st=T.printHeaders!==!1,at=T.css&&T.css["font-size"]!==void 0?16*T.css["font-size"]:T.fontSize||12,Le=T.margins||Object.assign({width:this.getPageWidth()},e),ze=typeof T.padding=="number"?T.padding:3,tt=T.headerBackgroundColor||"#c8c8c8",Ne=T.headerTextColor||"#000";if(i.call(this),this.internal.__cell__.printHeaders=st,this.internal.__cell__.margins=Le,this.internal.__cell__.table_font_size=at,this.internal.__cell__.padding=ze,this.internal.__cell__.headerBackgroundColor=tt,this.internal.__cell__.headerTextColor=Ne,this.setFontSize(at),x==null)ie=Y=Object.keys(_[0]),ce=Y.map(function(){return"left"});else if(Array.isArray(x)&&Ms(x[0])==="object")for(Y=x.map(function(Xt){return Xt.name}),ie=x.map(function(Xt){return Xt.prompt||Xt.name||""}),ce=x.map(function(Xt){return Xt.align||"left"}),I=0;I<x.length;I+=1)ve[x[I].name]=x[I].width*(19.049976/25.4);else Array.isArray(x)&&typeof x[0]=="string"&&(ie=Y=x,ce=Y.map(function(){return"left"}));if(Ue||Array.isArray(x)&&typeof x[0]=="string")for(I=0;I<Y.length;I+=1){for(fe[W=Y[I]]=_.map(function(Xt){return Xt[W]}),this.setFont(void 0,"bold"),be.push(this.getTextDimensions(ie[I],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w),N=fe[W],this.setFont(void 0,"normal"),$=0;$<N.length;$+=1)be.push(this.getTextDimensions(N[$],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w);ve[W]=Math.max.apply(null,be)+ze+ze,be=[]}if(st){var Ht={};for(I=0;I<Y.length;I+=1)Ht[Y[I]]={},Ht[Y[I]].text=ie[I],Ht[Y[I]].align=ce[I];var Vt=o.call(this,Ht,ve);Qe=Y.map(function(Xt){return new s(h,f,ve[Xt],Vt,Ht[Xt].text,void 0,Ht[Xt].align)}),this.setTableHeaderRow(Qe),this.printHeaderRow(1,!1)}var Jt=x.reduce(function(Xt,Fr){return Xt[Fr.name]=Fr.align,Xt},{});for(I=0;I<_.length;I+=1){"rowStart"in T&&T.rowStart instanceof Function&&T.rowStart({row:I,data:_[I]},this);var Kt=o.call(this,_[I],ve);for($=0;$<Y.length;$+=1){var er=_[I][Y[$]];"cellStart"in T&&T.cellStart instanceof Function&&T.cellStart({row:I,col:$,data:er},this),a.call(this,new s(h,f,ve[Y[$]],Kt,er,I+2,Jt[Y[$]]))}}return this.internal.__cell__.table_x=h,this.internal.__cell__.table_y=f,this};var o=function(h,f){var _=this.internal.__cell__.padding,x=this.internal.__cell__.table_font_size,T=this.internal.scaleFactor;return Object.keys(h).map(function(I){var N=h[I];return this.splitTextToSize(N.hasOwnProperty("text")?N.text:N,f[I]-_-_)},this).map(function(I){return this.getLineHeightFactor()*I.length*x/T+_+_},this).reduce(function(I,N){return Math.max(I,N)},0)};r.setTableHeaderRow=function(h){n.call(this),this.internal.__cell__.tableHeaderRow=h},r.printHeaderRow=function(h,f){if(n.call(this),!this.internal.__cell__.tableHeaderRow)throw new Error("Property tableHeaderRow does not exist.");var _;if(t=!0,typeof this.internal.__cell__.headerFunction=="function"){var x=this.internal.__cell__.headerFunction(this,this.internal.__cell__.pages);this.internal.__cell__.lastCell=new s(x[0],x[1],x[2],x[3],void 0,-1)}this.setFont(void 0,"bold");for(var T=[],I=0;I<this.internal.__cell__.tableHeaderRow.length;I+=1){_=this.internal.__cell__.tableHeaderRow[I].clone(),f&&(_.y=this.internal.__cell__.margins.top||0,T.push(_)),_.lineNumber=h;var N=this.getTextColor();this.setTextColor(this.internal.__cell__.headerTextColor),this.setFillColor(this.internal.__cell__.headerBackgroundColor),a.call(this,_),this.setTextColor(N)}T.length>0&&this.setTableHeaderRow(T),this.setFont(void 0,"normal"),t=!1}}(yi.API);var o$={italic:["italic","oblique","normal"],oblique:["oblique","italic","normal"],normal:["normal","oblique","italic"]},a$=["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded"],xR=s$(a$),l$=[100,200,300,400,500,600,700,800,900],w5e=s$(l$);function wR(r){var e=r.family.replace(/"|'/g,"").toLowerCase(),t=function(s){return o$[s=s||"normal"]?s:"normal"}(r.style),n=function(s){if(!s)return 400;if(typeof s=="number")return s>=100&&s<=900&&s%100==0?s:400;if(/^\d00$/.test(s))return parseInt(s);switch(s){case"bold":return 700;case"normal":default:return 400}}(r.weight),i=function(s){return typeof xR[s=s||"normal"]=="number"?s:"normal"}(r.stretch);return{family:e,style:t,weight:n,stretch:i,src:r.src||[],ref:r.ref||{name:e,style:[i,t,n].join(" ")}}}function c$(r,e,t,n){var i;for(i=t;i>=0&&i<e.length;i+=n)if(r[e[i]])return r[e[i]];for(i=t;i>=0&&i<e.length;i-=n)if(r[e[i]])return r[e[i]]}var B5e={"sans-serif":"helvetica",fixed:"courier",monospace:"courier",terminal:"courier",cursive:"times",fantasy:"times",serif:"times"},u$={caption:"times",icon:"times",menu:"times","message-box":"times","small-caption":"times","status-bar":"times"};function h$(r){return[r.stretch,r.style,r.weight,r.family].join(" ")}function C5e(r,e,t){for(var n=(t=t||{}).defaultFontFamily||"times",i=Object.assign({},B5e,t.genericFontFamilies||{}),s=null,a=null,o=0;o<e.length;++o)if(i[(s=wR(e[o])).family]&&(s.family=i[s.family]),r.hasOwnProperty(s.family)){a=r[s.family];break}if(!(a=a||r[n]))throw new Error("Could not find a font-family for the rule '"+h$(s)+"' and default family '"+n+"'.");if(a=function(h,f){if(f[h])return f[h];var _=xR[h],x=_<=xR.normal?-1:1,T=c$(f,a$,_,x);if(!T)throw new Error("Could not find a matching font-stretch value for "+h);return T}(s.stretch,a),a=function(h,f){if(f[h])return f[h];for(var _=o$[h],x=0;x<_.length;++x)if(f[_[x]])return f[_[x]];throw new Error("Could not find a matching font-style for "+h)}(s.style,a),!(a=function(h,f){if(f[h])return f[h];if(h===400&&f[500])return f[500];if(h===500&&f[400])return f[400];var _=w5e[h],x=c$(f,l$,_,h<400?-1:1);if(!x)throw new Error("Could not find a matching font-weight for value "+h);return x}(s.weight,a)))throw new Error("Failed to resolve a font for the rule '"+h$(s)+"'.");return a}function d$(r){return r.trimLeft()}function E5e(r,e){for(var t=0;t<r.length;){if(r.charAt(t)===e)return[r.substring(0,t),r.substring(t+1)];t+=1}return null}function T5e(r){var e=r.match(/^(-[a-z_]|[a-z_])[a-z0-9_-]*/i);return e===null?null:[e[0],r.substring(e[0].length)]}var UB,f$,A$,p$=["times"];(function(r){var e,t,n,i,s,a,o,h,f,_=function($e){return $e=$e||{},this.isStrokeTransparent=$e.isStrokeTransparent||!1,this.strokeOpacity=$e.strokeOpacity||1,this.strokeStyle=$e.strokeStyle||"#000000",this.fillStyle=$e.fillStyle||"#000000",this.isFillTransparent=$e.isFillTransparent||!1,this.fillOpacity=$e.fillOpacity||1,this.font=$e.font||"10px sans-serif",this.textBaseline=$e.textBaseline||"alphabetic",this.textAlign=$e.textAlign||"left",this.lineWidth=$e.lineWidth||1,this.lineJoin=$e.lineJoin||"miter",this.lineCap=$e.lineCap||"butt",this.path=$e.path||[],this.transform=$e.transform!==void 0?$e.transform.clone():new h,this.globalCompositeOperation=$e.globalCompositeOperation||"normal",this.globalAlpha=$e.globalAlpha||1,this.clip_path=$e.clip_path||[],this.currentPoint=$e.currentPoint||new a,this.miterLimit=$e.miterLimit||10,this.lastPoint=$e.lastPoint||new a,this.lineDashOffset=$e.lineDashOffset||0,this.lineDash=$e.lineDash||[],this.margin=$e.margin||[0,0,0,0],this.prevPageLastElemOffset=$e.prevPageLastElemOffset||0,this.ignoreClearRect=typeof $e.ignoreClearRect!="boolean"||$e.ignoreClearRect,this};r.events.push(["initialized",function(){this.context2d=new x(this),e=this.internal.f2,t=this.internal.getCoordinateString,n=this.internal.getVerticalCoordinateString,i=this.internal.getHorizontalCoordinate,s=this.internal.getVerticalCoordinate,a=this.internal.Point,o=this.internal.Rectangle,h=this.internal.Matrix,f=new _}]);var x=function($e){Object.defineProperty(this,"canvas",{get:function(){return{parentNode:!1,style:!1}}});var ut=$e;Object.defineProperty(this,"pdf",{get:function(){return ut}});var Bt=!1;Object.defineProperty(this,"pageWrapXEnabled",{get:function(){return Bt},set:function(pr){Bt=!!pr}});var St=!1;Object.defineProperty(this,"pageWrapYEnabled",{get:function(){return St},set:function(pr){St=!!pr}});var jt=0;Object.defineProperty(this,"posX",{get:function(){return jt},set:function(pr){isNaN(pr)||(jt=pr)}});var qt=0;Object.defineProperty(this,"posY",{get:function(){return qt},set:function(pr){isNaN(pr)||(qt=pr)}}),Object.defineProperty(this,"margin",{get:function(){return f.margin},set:function(pr){var We;typeof pr=="number"?We=[pr,pr,pr,pr]:((We=new Array(4))[0]=pr[0],We[1]=pr.length>=2?pr[1]:We[0],We[2]=pr.length>=3?pr[2]:We[0],We[3]=pr.length>=4?pr[3]:We[1]),f.margin=We}});var nr=!1;Object.defineProperty(this,"autoPaging",{get:function(){return nr},set:function(pr){nr=pr}});var ar=0;Object.defineProperty(this,"lastBreak",{get:function(){return ar},set:function(pr){ar=pr}});var $r=[];Object.defineProperty(this,"pageBreaks",{get:function(){return $r},set:function(pr){$r=pr}}),Object.defineProperty(this,"ctx",{get:function(){return f},set:function(pr){pr instanceof _&&(f=pr)}}),Object.defineProperty(this,"path",{get:function(){return f.path},set:function(pr){f.path=pr}});var kr=[];Object.defineProperty(this,"ctxStack",{get:function(){return kr},set:function(pr){kr=pr}}),Object.defineProperty(this,"fillStyle",{get:function(){return this.ctx.fillStyle},set:function(pr){var We;We=T(pr),this.ctx.fillStyle=We.style,this.ctx.isFillTransparent=We.a===0,this.ctx.fillOpacity=We.a,this.pdf.setFillColor(We.r,We.g,We.b,{a:We.a}),this.pdf.setTextColor(We.r,We.g,We.b,{a:We.a})}}),Object.defineProperty(this,"strokeStyle",{get:function(){return this.ctx.strokeStyle},set:function(pr){var We=T(pr);this.ctx.strokeStyle=We.style,this.ctx.isStrokeTransparent=We.a===0,this.ctx.strokeOpacity=We.a,We.a===0?this.pdf.setDrawColor(255,255,255):(We.a,this.pdf.setDrawColor(We.r,We.g,We.b))}}),Object.defineProperty(this,"lineCap",{get:function(){return this.ctx.lineCap},set:function(pr){["butt","round","square"].indexOf(pr)!==-1&&(this.ctx.lineCap=pr,this.pdf.setLineCap(pr))}}),Object.defineProperty(this,"lineWidth",{get:function(){return this.ctx.lineWidth},set:function(pr){isNaN(pr)||(this.ctx.lineWidth=pr,this.pdf.setLineWidth(pr))}}),Object.defineProperty(this,"lineJoin",{get:function(){return this.ctx.lineJoin},set:function(pr){["bevel","round","miter"].indexOf(pr)!==-1&&(this.ctx.lineJoin=pr,this.pdf.setLineJoin(pr))}}),Object.defineProperty(this,"miterLimit",{get:function(){return this.ctx.miterLimit},set:function(pr){isNaN(pr)||(this.ctx.miterLimit=pr,this.pdf.setMiterLimit(pr))}}),Object.defineProperty(this,"textBaseline",{get:function(){return this.ctx.textBaseline},set:function(pr){this.ctx.textBaseline=pr}}),Object.defineProperty(this,"textAlign",{get:function(){return this.ctx.textAlign},set:function(pr){["right","end","center","left","start"].indexOf(pr)!==-1&&(this.ctx.textAlign=pr)}});var Gr=null;function sn(pr,We){if(Gr===null){var Pn=function(mn){var mr=[];return Object.keys(mn).forEach(function(Mr){mn[Mr].forEach(function(en){var Wr=null;switch(en){case"bold":Wr={family:Mr,weight:"bold"};break;case"italic":Wr={family:Mr,style:"italic"};break;case"bolditalic":Wr={family:Mr,weight:"bold",style:"italic"};break;case"":case"normal":Wr={family:Mr}}Wr!==null&&(Wr.ref={name:Mr,style:en},mr.push(Wr))})}),mr}(pr.getFontList());Gr=function(mn){for(var mr={},Mr=0;Mr<mn.length;++Mr){var en=wR(mn[Mr]),Wr=en.family,gn=en.stretch,Bn=en.style,Fn=en.weight;mr[Wr]=mr[Wr]||{},mr[Wr][gn]=mr[Wr][gn]||{},mr[Wr][gn][Bn]=mr[Wr][gn][Bn]||{},mr[Wr][gn][Bn][Fn]=en}return mr}(Pn.concat(We))}return Gr}var on=null;Object.defineProperty(this,"fontFaces",{get:function(){return on},set:function(pr){Gr=null,on=pr}}),Object.defineProperty(this,"font",{get:function(){return this.ctx.font},set:function(pr){var We;if(this.ctx.font=pr,(We=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-_,\"\'\sa-z]+?)\s*$/i.exec(pr))!==null){var Pn=We[1],mn=(We[2],We[3]),mr=We[4],Mr=(We[5],We[6]),en=/^([.\d]+)((?:%|in|[cem]m|ex|p[ctx]))$/i.exec(mr)[2];mr=Math.floor(en==="px"?parseFloat(mr)*this.pdf.internal.scaleFactor:en==="em"?parseFloat(mr)*this.pdf.getFontSize():parseFloat(mr)*this.pdf.internal.scaleFactor),this.pdf.setFontSize(mr);var Wr=function(Cn){var Rn,nn,Ci=[],Cr=Cn.trim();if(Cr==="")return p$;if(Cr in u$)return[u$[Cr]];for(;Cr!=="";){switch(nn=null,Rn=(Cr=d$(Cr)).charAt(0)){case'"':case"'":nn=E5e(Cr.substring(1),Rn);break;default:nn=T5e(Cr)}if(nn===null||(Ci.push(nn[0]),(Cr=d$(nn[1]))!==""&&Cr.charAt(0)!==","))return p$;Cr=Cr.replace(/^,/,"")}return Ci}(Mr);if(this.fontFaces){var gn=C5e(sn(this.pdf,this.fontFaces),Wr.map(function(Cn){return{family:Cn,stretch:"normal",weight:mn,style:Pn}}));this.pdf.setFont(gn.ref.name,gn.ref.style)}else{var Bn="";(mn==="bold"||parseInt(mn,10)>=700||Pn==="bold")&&(Bn="bold"),Pn==="italic"&&(Bn+="italic"),Bn.length===0&&(Bn="normal");for(var Fn="",$n={arial:"Helvetica",Arial:"Helvetica",verdana:"Helvetica",Verdana:"Helvetica",helvetica:"Helvetica",Helvetica:"Helvetica","sans-serif":"Helvetica",fixed:"Courier",monospace:"Courier",terminal:"Courier",cursive:"Times",fantasy:"Times",serif:"Times"},ei=0;ei<Wr.length;ei++){if(this.pdf.internal.getFont(Wr[ei],Bn,{noFallback:!0,disableWarning:!0})!==void 0){Fn=Wr[ei];break}if(Bn==="bolditalic"&&this.pdf.internal.getFont(Wr[ei],"bold",{noFallback:!0,disableWarning:!0})!==void 0)Fn=Wr[ei],Bn="bold";else if(this.pdf.internal.getFont(Wr[ei],"normal",{noFallback:!0,disableWarning:!0})!==void 0){Fn=Wr[ei],Bn="normal";break}}if(Fn===""){for(var br=0;br<Wr.length;br++)if($n[Wr[br]]){Fn=$n[Wr[br]];break}}Fn=Fn===""?"Times":Fn,this.pdf.setFont(Fn,Bn)}}}}),Object.defineProperty(this,"globalCompositeOperation",{get:function(){return this.ctx.globalCompositeOperation},set:function(pr){this.ctx.globalCompositeOperation=pr}}),Object.defineProperty(this,"globalAlpha",{get:function(){return this.ctx.globalAlpha},set:function(pr){this.ctx.globalAlpha=pr}}),Object.defineProperty(this,"lineDashOffset",{get:function(){return this.ctx.lineDashOffset},set:function(pr){this.ctx.lineDashOffset=pr,Fr.call(this)}}),Object.defineProperty(this,"lineDash",{get:function(){return this.ctx.lineDash},set:function(pr){this.ctx.lineDash=pr,Fr.call(this)}}),Object.defineProperty(this,"ignoreClearRect",{get:function(){return this.ctx.ignoreClearRect},set:function(pr){this.ctx.ignoreClearRect=!!pr}})};x.prototype.setLineDash=function($e){this.lineDash=$e},x.prototype.getLineDash=function(){return this.lineDash.length%2?this.lineDash.concat(this.lineDash):this.lineDash.slice()},x.prototype.fill=function(){fe.call(this,"fill",!1)},x.prototype.stroke=function(){fe.call(this,"stroke",!1)},x.prototype.beginPath=function(){this.path=[{type:"begin"}]},x.prototype.moveTo=function($e,ut){if(isNaN($e)||isNaN(ut))throw po.error("jsPDF.context2d.moveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.moveTo");var Bt=this.ctx.transform.applyToPoint(new a($e,ut));this.path.push({type:"mt",x:Bt.x,y:Bt.y}),this.ctx.lastPoint=new a($e,ut)},x.prototype.closePath=function(){var $e=new a(0,0),ut=0;for(ut=this.path.length-1;ut!==-1;ut--)if(this.path[ut].type==="begin"&&Ms(this.path[ut+1])==="object"&&typeof this.path[ut+1].x=="number"){$e=new a(this.path[ut+1].x,this.path[ut+1].y);break}this.path.push({type:"close"}),this.ctx.lastPoint=new a($e.x,$e.y)},x.prototype.lineTo=function($e,ut){if(isNaN($e)||isNaN(ut))throw po.error("jsPDF.context2d.lineTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.lineTo");var Bt=this.ctx.transform.applyToPoint(new a($e,ut));this.path.push({type:"lt",x:Bt.x,y:Bt.y}),this.ctx.lastPoint=new a(Bt.x,Bt.y)},x.prototype.clip=function(){this.ctx.clip_path=JSON.parse(JSON.stringify(this.path)),fe.call(this,null,!0)},x.prototype.quadraticCurveTo=function($e,ut,Bt,St){if(isNaN(Bt)||isNaN(St)||isNaN($e)||isNaN(ut))throw po.error("jsPDF.context2d.quadraticCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.quadraticCurveTo");var jt=this.ctx.transform.applyToPoint(new a(Bt,St)),qt=this.ctx.transform.applyToPoint(new a($e,ut));this.path.push({type:"qct",x1:qt.x,y1:qt.y,x:jt.x,y:jt.y}),this.ctx.lastPoint=new a(jt.x,jt.y)},x.prototype.bezierCurveTo=function($e,ut,Bt,St,jt,qt){if(isNaN(jt)||isNaN(qt)||isNaN($e)||isNaN(ut)||isNaN(Bt)||isNaN(St))throw po.error("jsPDF.context2d.bezierCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.bezierCurveTo");var nr=this.ctx.transform.applyToPoint(new a(jt,qt)),ar=this.ctx.transform.applyToPoint(new a($e,ut)),$r=this.ctx.transform.applyToPoint(new a(Bt,St));this.path.push({type:"bct",x1:ar.x,y1:ar.y,x2:$r.x,y2:$r.y,x:nr.x,y:nr.y}),this.ctx.lastPoint=new a(nr.x,nr.y)},x.prototype.arc=function($e,ut,Bt,St,jt,qt){if(isNaN($e)||isNaN(ut)||isNaN(Bt)||isNaN(St)||isNaN(jt))throw po.error("jsPDF.context2d.arc: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.arc");if(qt=!!qt,!this.ctx.transform.isIdentity){var nr=this.ctx.transform.applyToPoint(new a($e,ut));$e=nr.x,ut=nr.y;var ar=this.ctx.transform.applyToPoint(new a(0,Bt)),$r=this.ctx.transform.applyToPoint(new a(0,0));Bt=Math.sqrt(Math.pow(ar.x-$r.x,2)+Math.pow(ar.y-$r.y,2))}Math.abs(jt-St)>=2*Math.PI&&(St=0,jt=2*Math.PI),this.path.push({type:"arc",x:$e,y:ut,radius:Bt,startAngle:St,endAngle:jt,counterclockwise:qt})},x.prototype.arcTo=function($e,ut,Bt,St,jt){throw new Error("arcTo not implemented.")},x.prototype.rect=function($e,ut,Bt,St){if(isNaN($e)||isNaN(ut)||isNaN(Bt)||isNaN(St))throw po.error("jsPDF.context2d.rect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rect");this.moveTo($e,ut),this.lineTo($e+Bt,ut),this.lineTo($e+Bt,ut+St),this.lineTo($e,ut+St),this.lineTo($e,ut),this.lineTo($e+Bt,ut),this.lineTo($e,ut)},x.prototype.fillRect=function($e,ut,Bt,St){if(isNaN($e)||isNaN(ut)||isNaN(Bt)||isNaN(St))throw po.error("jsPDF.context2d.fillRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillRect");if(!I.call(this)){var jt={};this.lineCap!=="butt"&&(jt.lineCap=this.lineCap,this.lineCap="butt"),this.lineJoin!=="miter"&&(jt.lineJoin=this.lineJoin,this.lineJoin="miter"),this.beginPath(),this.rect($e,ut,Bt,St),this.fill(),jt.hasOwnProperty("lineCap")&&(this.lineCap=jt.lineCap),jt.hasOwnProperty("lineJoin")&&(this.lineJoin=jt.lineJoin)}},x.prototype.strokeRect=function($e,ut,Bt,St){if(isNaN($e)||isNaN(ut)||isNaN(Bt)||isNaN(St))throw po.error("jsPDF.context2d.strokeRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeRect");N.call(this)||(this.beginPath(),this.rect($e,ut,Bt,St),this.stroke())},x.prototype.clearRect=function($e,ut,Bt,St){if(isNaN($e)||isNaN(ut)||isNaN(Bt)||isNaN(St))throw po.error("jsPDF.context2d.clearRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.clearRect");this.ignoreClearRect||(this.fillStyle="#ffffff",this.fillRect($e,ut,Bt,St))},x.prototype.save=function($e){$e=typeof $e!="boolean"||$e;for(var ut=this.pdf.internal.getCurrentPageInfo().pageNumber,Bt=0;Bt<this.pdf.internal.getNumberOfPages();Bt++)this.pdf.setPage(Bt+1),this.pdf.internal.out("q");if(this.pdf.setPage(ut),$e){this.ctx.fontSize=this.pdf.internal.getFontSize();var St=new _(this.ctx);this.ctxStack.push(this.ctx),this.ctx=St}},x.prototype.restore=function($e){$e=typeof $e!="boolean"||$e;for(var ut=this.pdf.internal.getCurrentPageInfo().pageNumber,Bt=0;Bt<this.pdf.internal.getNumberOfPages();Bt++)this.pdf.setPage(Bt+1),this.pdf.internal.out("Q");this.pdf.setPage(ut),$e&&this.ctxStack.length!==0&&(this.ctx=this.ctxStack.pop(),this.fillStyle=this.ctx.fillStyle,this.strokeStyle=this.ctx.strokeStyle,this.font=this.ctx.font,this.lineCap=this.ctx.lineCap,this.lineWidth=this.ctx.lineWidth,this.lineJoin=this.ctx.lineJoin,this.lineDash=this.ctx.lineDash,this.lineDashOffset=this.ctx.lineDashOffset)},x.prototype.toDataURL=function(){throw new Error("toDataUrl not implemented.")};var T=function($e){var ut,Bt,St,jt;if($e.isCanvasGradient===!0&&($e=$e.getColor()),!$e)return{r:0,g:0,b:0,a:0,style:$e};if(/transparent|rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*0+\s*\)/.test($e))ut=0,Bt=0,St=0,jt=0;else{var qt=/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/.exec($e);if(qt!==null)ut=parseInt(qt[1]),Bt=parseInt(qt[2]),St=parseInt(qt[3]),jt=1;else if((qt=/rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.]+)\s*\)/.exec($e))!==null)ut=parseInt(qt[1]),Bt=parseInt(qt[2]),St=parseInt(qt[3]),jt=parseFloat(qt[4]);else{if(jt=1,typeof $e=="string"&&$e.charAt(0)!=="#"){var nr=new WQ($e);$e=nr.ok?nr.toHex():"#000000"}$e.length===4?(ut=$e.substring(1,2),ut+=ut,Bt=$e.substring(2,3),Bt+=Bt,St=$e.substring(3,4),St+=St):(ut=$e.substring(1,3),Bt=$e.substring(3,5),St=$e.substring(5,7)),ut=parseInt(ut,16),Bt=parseInt(Bt,16),St=parseInt(St,16)}}return{r:ut,g:Bt,b:St,a:jt,style:$e}},I=function(){return this.ctx.isFillTransparent||this.globalAlpha==0},N=function(){return!!(this.ctx.isStrokeTransparent||this.globalAlpha==0)};x.prototype.fillText=function($e,ut,Bt,St){if(isNaN(ut)||isNaN(Bt)||typeof $e!="string")throw po.error("jsPDF.context2d.fillText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillText");if(St=isNaN(St)?void 0:St,!I.call(this)){var jt=Kt(this.ctx.transform.rotation),qt=this.ctx.transform.scaleX;ze.call(this,{text:$e,x:ut,y:Bt,scale:qt,angle:jt,align:this.textAlign,maxWidth:St})}},x.prototype.strokeText=function($e,ut,Bt,St){if(isNaN(ut)||isNaN(Bt)||typeof $e!="string")throw po.error("jsPDF.context2d.strokeText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeText");if(!N.call(this)){St=isNaN(St)?void 0:St;var jt=Kt(this.ctx.transform.rotation),qt=this.ctx.transform.scaleX;ze.call(this,{text:$e,x:ut,y:Bt,scale:qt,renderingMode:"stroke",angle:jt,align:this.textAlign,maxWidth:St})}},x.prototype.measureText=function($e){if(typeof $e!="string")throw po.error("jsPDF.context2d.measureText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.measureText");var ut=this.pdf,Bt=this.pdf.internal.scaleFactor,St=ut.internal.getFontSize(),jt=ut.getStringUnitWidth($e)*St/ut.internal.scaleFactor,qt=function(nr){var ar=(nr=nr||{}).width||0;return Object.defineProperty(this,"width",{get:function(){return ar}}),this};return new qt({width:jt*=Math.round(96*Bt/72*1e4)/1e4})},x.prototype.scale=function($e,ut){if(isNaN($e)||isNaN(ut))throw po.error("jsPDF.context2d.scale: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.scale");var Bt=new h($e,0,0,ut,0,0);this.ctx.transform=this.ctx.transform.multiply(Bt)},x.prototype.rotate=function($e){if(isNaN($e))throw po.error("jsPDF.context2d.rotate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rotate");var ut=new h(Math.cos($e),Math.sin($e),-Math.sin($e),Math.cos($e),0,0);this.ctx.transform=this.ctx.transform.multiply(ut)},x.prototype.translate=function($e,ut){if(isNaN($e)||isNaN(ut))throw po.error("jsPDF.context2d.translate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.translate");var Bt=new h(1,0,0,1,$e,ut);this.ctx.transform=this.ctx.transform.multiply(Bt)},x.prototype.transform=function($e,ut,Bt,St,jt,qt){if(isNaN($e)||isNaN(ut)||isNaN(Bt)||isNaN(St)||isNaN(jt)||isNaN(qt))throw po.error("jsPDF.context2d.transform: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.transform");var nr=new h($e,ut,Bt,St,jt,qt);this.ctx.transform=this.ctx.transform.multiply(nr)},x.prototype.setTransform=function($e,ut,Bt,St,jt,qt){$e=isNaN($e)?1:$e,ut=isNaN(ut)?0:ut,Bt=isNaN(Bt)?0:Bt,St=isNaN(St)?1:St,jt=isNaN(jt)?0:jt,qt=isNaN(qt)?0:qt,this.ctx.transform=new h($e,ut,Bt,St,jt,qt)};var $=function(){return this.margin[0]>0||this.margin[1]>0||this.margin[2]>0||this.margin[3]>0};x.prototype.drawImage=function($e,ut,Bt,St,jt,qt,nr,ar,$r){var kr=this.pdf.getImageProperties($e),Gr=1,sn=1,on=1,pr=1;St!==void 0&&ar!==void 0&&(on=ar/St,pr=$r/jt,Gr=kr.width/St*ar/St,sn=kr.height/jt*$r/jt),qt===void 0&&(qt=ut,nr=Bt,ut=0,Bt=0),St!==void 0&&ar===void 0&&(ar=St,$r=jt),St===void 0&&ar===void 0&&(ar=kr.width,$r=kr.height);for(var We,Pn=this.ctx.transform.decompose(),mn=Kt(Pn.rotate.shx),mr=new h,Mr=(mr=(mr=(mr=mr.multiply(Pn.translate)).multiply(Pn.skew)).multiply(Pn.scale)).applyToRectangle(new o(qt-ut*on,nr-Bt*pr,St*Gr,jt*sn)),en=W.call(this,Mr),Wr=[],gn=0;gn<en.length;gn+=1)Wr.indexOf(en[gn])===-1&&Wr.push(en[gn]);if(ce(Wr),this.autoPaging)for(var Bn=Wr[0],Fn=Wr[Wr.length-1],$n=Bn;$n<Fn+1;$n++){this.pdf.setPage($n);var ei=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],br=$n===1?this.posY+this.margin[0]:this.margin[0],Cn=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Rn=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],nn=$n===1?0:Cn+($n-2)*Rn;if(this.ctx.clip_path.length!==0){var Ci=this.path;We=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=ie(We,this.posX+this.margin[3],-nn+br+this.ctx.prevPageLastElemOffset),ve.call(this,"fill",!0),this.path=Ci}var Cr=JSON.parse(JSON.stringify(Mr));Cr=ie([Cr],this.posX+this.margin[3],-nn+br+this.ctx.prevPageLastElemOffset)[0];var Tn=($n>Bn||$n<Fn)&&$.call(this);Tn&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],ei,Rn,null).clip().discardPath()),this.pdf.addImage($e,"JPEG",Cr.x,Cr.y,Cr.w,Cr.h,null,null,mn),Tn&&this.pdf.restoreGraphicsState()}else this.pdf.addImage($e,"JPEG",Mr.x,Mr.y,Mr.w,Mr.h,null,null,mn)};var W=function($e,ut,Bt){var St=[];ut=ut||this.pdf.internal.pageSize.width,Bt=Bt||this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2];var jt=this.posY+this.ctx.prevPageLastElemOffset;switch($e.type){default:case"mt":case"lt":St.push(Math.floor(($e.y+jt)/Bt)+1);break;case"arc":St.push(Math.floor(($e.y+jt-$e.radius)/Bt)+1),St.push(Math.floor(($e.y+jt+$e.radius)/Bt)+1);break;case"qct":var qt=er(this.ctx.lastPoint.x,this.ctx.lastPoint.y,$e.x1,$e.y1,$e.x,$e.y);St.push(Math.floor((qt.y+jt)/Bt)+1),St.push(Math.floor((qt.y+qt.h+jt)/Bt)+1);break;case"bct":var nr=Xt(this.ctx.lastPoint.x,this.ctx.lastPoint.y,$e.x1,$e.y1,$e.x2,$e.y2,$e.x,$e.y);St.push(Math.floor((nr.y+jt)/Bt)+1),St.push(Math.floor((nr.y+nr.h+jt)/Bt)+1);break;case"rect":St.push(Math.floor(($e.y+jt)/Bt)+1),St.push(Math.floor(($e.y+$e.h+jt)/Bt)+1)}for(var ar=0;ar<St.length;ar+=1)for(;this.pdf.internal.getNumberOfPages()<St[ar];)Y.call(this);return St},Y=function(){var $e=this.fillStyle,ut=this.strokeStyle,Bt=this.font,St=this.lineCap,jt=this.lineWidth,qt=this.lineJoin;this.pdf.addPage(),this.fillStyle=$e,this.strokeStyle=ut,this.font=Bt,this.lineCap=St,this.lineWidth=jt,this.lineJoin=qt},ie=function($e,ut,Bt){for(var St=0;St<$e.length;St++)switch($e[St].type){case"bct":$e[St].x2+=ut,$e[St].y2+=Bt;case"qct":$e[St].x1+=ut,$e[St].y1+=Bt;case"mt":case"lt":case"arc":default:$e[St].x+=ut,$e[St].y+=Bt}return $e},ce=function($e){return $e.sort(function(ut,Bt){return ut-Bt})},fe=function($e,ut){for(var Bt,St,jt=this.fillStyle,qt=this.strokeStyle,nr=this.lineCap,ar=this.lineWidth,$r=Math.abs(ar*this.ctx.transform.scaleX),kr=this.lineJoin,Gr=JSON.parse(JSON.stringify(this.path)),sn=JSON.parse(JSON.stringify(this.path)),on=[],pr=0;pr<sn.length;pr++)if(sn[pr].x!==void 0)for(var We=W.call(this,sn[pr]),Pn=0;Pn<We.length;Pn+=1)on.indexOf(We[Pn])===-1&&on.push(We[Pn]);for(var mn=0;mn<on.length;mn++)for(;this.pdf.internal.getNumberOfPages()<on[mn];)Y.call(this);if(ce(on),this.autoPaging)for(var mr=on[0],Mr=on[on.length-1],en=mr;en<Mr+1;en++){this.pdf.setPage(en),this.fillStyle=jt,this.strokeStyle=qt,this.lineCap=nr,this.lineWidth=$r,this.lineJoin=kr;var Wr=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],gn=en===1?this.posY+this.margin[0]:this.margin[0],Bn=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Fn=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],$n=en===1?0:Bn+(en-2)*Fn;if(this.ctx.clip_path.length!==0){var ei=this.path;Bt=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=ie(Bt,this.posX+this.margin[3],-$n+gn+this.ctx.prevPageLastElemOffset),ve.call(this,$e,!0),this.path=ei}if(St=JSON.parse(JSON.stringify(Gr)),this.path=ie(St,this.posX+this.margin[3],-$n+gn+this.ctx.prevPageLastElemOffset),ut===!1||en===0){var br=(en>mr||en<Mr)&&$.call(this);br&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Wr,Fn,null).clip().discardPath()),ve.call(this,$e,ut),br&&this.pdf.restoreGraphicsState()}this.lineWidth=ar}else this.lineWidth=$r,ve.call(this,$e,ut),this.lineWidth=ar;this.path=Gr},ve=function($e,ut){if(($e!=="stroke"||ut||!N.call(this))&&($e==="stroke"||ut||!I.call(this))){for(var Bt,St,jt=[],qt=this.path,nr=0;nr<qt.length;nr++){var ar=qt[nr];switch(ar.type){case"begin":jt.push({begin:!0});break;case"close":jt.push({close:!0});break;case"mt":jt.push({start:ar,deltas:[],abs:[]});break;case"lt":var $r=jt.length;if(qt[nr-1]&&!isNaN(qt[nr-1].x)&&(Bt=[ar.x-qt[nr-1].x,ar.y-qt[nr-1].y],$r>0)){for(;$r>=0;$r--)if(jt[$r-1].close!==!0&&jt[$r-1].begin!==!0){jt[$r-1].deltas.push(Bt),jt[$r-1].abs.push(ar);break}}break;case"bct":Bt=[ar.x1-qt[nr-1].x,ar.y1-qt[nr-1].y,ar.x2-qt[nr-1].x,ar.y2-qt[nr-1].y,ar.x-qt[nr-1].x,ar.y-qt[nr-1].y],jt[jt.length-1].deltas.push(Bt);break;case"qct":var kr=qt[nr-1].x+2/3*(ar.x1-qt[nr-1].x),Gr=qt[nr-1].y+2/3*(ar.y1-qt[nr-1].y),sn=ar.x+2/3*(ar.x1-ar.x),on=ar.y+2/3*(ar.y1-ar.y),pr=ar.x,We=ar.y;Bt=[kr-qt[nr-1].x,Gr-qt[nr-1].y,sn-qt[nr-1].x,on-qt[nr-1].y,pr-qt[nr-1].x,We-qt[nr-1].y],jt[jt.length-1].deltas.push(Bt);break;case"arc":jt.push({deltas:[],abs:[],arc:!0}),Array.isArray(jt[jt.length-1].abs)&&jt[jt.length-1].abs.push(ar)}}St=ut?null:$e==="stroke"?"stroke":"fill";for(var Pn=!1,mn=0;mn<jt.length;mn++)if(jt[mn].arc)for(var mr=jt[mn].abs,Mr=0;Mr<mr.length;Mr++){var en=mr[Mr];en.type==="arc"?Ue.call(this,en.x,en.y,en.radius,en.startAngle,en.endAngle,en.counterclockwise,void 0,ut,!Pn):tt.call(this,en.x,en.y),Pn=!0}else if(jt[mn].close===!0)this.pdf.internal.out("h"),Pn=!1;else if(jt[mn].begin!==!0){var Wr=jt[mn].start.x,gn=jt[mn].start.y;Ne.call(this,jt[mn].deltas,Wr,gn),Pn=!0}St&&st.call(this,St),ut&&at.call(this)}},be=function($e){var ut=this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor,Bt=ut*(this.pdf.internal.getLineHeightFactor()-1);switch(this.ctx.textBaseline){case"bottom":return $e-Bt;case"top":return $e+ut-Bt;case"hanging":return $e+ut-2*Bt;case"middle":return $e+ut/2-Bt;case"ideographic":return $e;case"alphabetic":default:return $e}},Qe=function($e){return $e+this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor*(this.pdf.internal.getLineHeightFactor()-1)};x.prototype.createLinearGradient=function(){var $e=function(){};return $e.colorStops=[],$e.addColorStop=function(ut,Bt){this.colorStops.push([ut,Bt])},$e.getColor=function(){return this.colorStops.length===0?"#000000":this.colorStops[0][1]},$e.isCanvasGradient=!0,$e},x.prototype.createPattern=function(){return this.createLinearGradient()},x.prototype.createRadialGradient=function(){return this.createLinearGradient()};var Ue=function($e,ut,Bt,St,jt,qt,nr,ar,$r){for(var kr=Vt.call(this,Bt,St,jt,qt),Gr=0;Gr<kr.length;Gr++){var sn=kr[Gr];Gr===0&&($r?Le.call(this,sn.x1+$e,sn.y1+ut):tt.call(this,sn.x1+$e,sn.y1+ut)),Ht.call(this,$e,ut,sn.x2,sn.y2,sn.x3,sn.y3,sn.x4,sn.y4)}ar?at.call(this):st.call(this,nr)},st=function($e){switch($e){case"stroke":this.pdf.internal.out("S");break;case"fill":this.pdf.internal.out("f")}},at=function(){this.pdf.clip(),this.pdf.discardPath()},Le=function($e,ut){this.pdf.internal.out(t($e)+" "+n(ut)+" m")},ze=function($e){var ut;switch($e.align){case"right":case"end":ut="right";break;case"center":ut="center";break;case"left":case"start":default:ut="left"}var Bt=this.pdf.getTextDimensions($e.text),St=be.call(this,$e.y),jt=Qe.call(this,St)-Bt.h,qt=this.ctx.transform.applyToPoint(new a($e.x,St)),nr=this.ctx.transform.decompose(),ar=new h;ar=(ar=(ar=ar.multiply(nr.translate)).multiply(nr.skew)).multiply(nr.scale);for(var $r,kr,Gr,sn=this.ctx.transform.applyToRectangle(new o($e.x,St,Bt.w,Bt.h)),on=ar.applyToRectangle(new o($e.x,jt,Bt.w,Bt.h)),pr=W.call(this,on),We=[],Pn=0;Pn<pr.length;Pn+=1)We.indexOf(pr[Pn])===-1&&We.push(pr[Pn]);if(ce(We),this.autoPaging)for(var mn=We[0],mr=We[We.length-1],Mr=mn;Mr<mr+1;Mr++){this.pdf.setPage(Mr);var en=Mr===1?this.posY+this.margin[0]:this.margin[0],Wr=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],gn=this.pdf.internal.pageSize.height-this.margin[2],Bn=gn-this.margin[0],Fn=this.pdf.internal.pageSize.width-this.margin[1],$n=Fn-this.margin[3],ei=Mr===1?0:Wr+(Mr-2)*Bn;if(this.ctx.clip_path.length!==0){var br=this.path;$r=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=ie($r,this.posX+this.margin[3],-1*ei+en),ve.call(this,"fill",!0),this.path=br}var Cn=ie([JSON.parse(JSON.stringify(on))],this.posX+this.margin[3],-ei+en+this.ctx.prevPageLastElemOffset)[0];$e.scale>=.01&&(kr=this.pdf.internal.getFontSize(),this.pdf.setFontSize(kr*$e.scale),Gr=this.lineWidth,this.lineWidth=Gr*$e.scale);var Rn=this.autoPaging!=="text";if(Rn||Cn.y+Cn.h<=gn){if(Rn||Cn.y>=en&&Cn.x<=Fn){var nn=Rn?$e.text:this.pdf.splitTextToSize($e.text,$e.maxWidth||Fn-Cn.x)[0],Ci=ie([JSON.parse(JSON.stringify(sn))],this.posX+this.margin[3],-ei+en+this.ctx.prevPageLastElemOffset)[0],Cr=Rn&&(Mr>mn||Mr<mr)&&$.call(this);Cr&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],$n,Bn,null).clip().discardPath()),this.pdf.text(nn,Ci.x,Ci.y,{angle:$e.angle,align:ut,renderingMode:$e.renderingMode}),Cr&&this.pdf.restoreGraphicsState()}}else Cn.y<gn&&(this.ctx.prevPageLastElemOffset+=gn-Cn.y);$e.scale>=.01&&(this.pdf.setFontSize(kr),this.lineWidth=Gr)}else $e.scale>=.01&&(kr=this.pdf.internal.getFontSize(),this.pdf.setFontSize(kr*$e.scale),Gr=this.lineWidth,this.lineWidth=Gr*$e.scale),this.pdf.text($e.text,qt.x+this.posX,qt.y+this.posY,{angle:$e.angle,align:ut,renderingMode:$e.renderingMode,maxWidth:$e.maxWidth}),$e.scale>=.01&&(this.pdf.setFontSize(kr),this.lineWidth=Gr)},tt=function($e,ut,Bt,St){Bt=Bt||0,St=St||0,this.pdf.internal.out(t($e+Bt)+" "+n(ut+St)+" l")},Ne=function($e,ut,Bt){return this.pdf.lines($e,ut,Bt,null,null)},Ht=function($e,ut,Bt,St,jt,qt,nr,ar){this.pdf.internal.out([e(i(Bt+$e)),e(s(St+ut)),e(i(jt+$e)),e(s(qt+ut)),e(i(nr+$e)),e(s(ar+ut)),"c"].join(" "))},Vt=function($e,ut,Bt,St){for(var jt=2*Math.PI,qt=Math.PI/2;ut>Bt;)ut-=jt;var nr=Math.abs(Bt-ut);nr<jt&&St&&(nr=jt-nr);for(var ar=[],$r=St?-1:1,kr=ut;nr>1e-5;){var Gr=kr+$r*Math.min(nr,qt);ar.push(Jt.call(this,$e,kr,Gr)),nr-=Math.abs(Gr-kr),kr=Gr}return ar},Jt=function($e,ut,Bt){var St=(Bt-ut)/2,jt=$e*Math.cos(St),qt=$e*Math.sin(St),nr=jt,ar=-qt,$r=nr*nr+ar*ar,kr=$r+nr*jt+ar*qt,Gr=4/3*(Math.sqrt(2*$r*kr)-kr)/(nr*qt-ar*jt),sn=nr-Gr*ar,on=ar+Gr*nr,pr=sn,We=-on,Pn=St+ut,mn=Math.cos(Pn),mr=Math.sin(Pn);return{x1:$e*Math.cos(ut),y1:$e*Math.sin(ut),x2:sn*mn-on*mr,y2:sn*mr+on*mn,x3:pr*mn-We*mr,y3:pr*mr+We*mn,x4:$e*Math.cos(Bt),y4:$e*Math.sin(Bt)}},Kt=function($e){return 180*$e/Math.PI},er=function($e,ut,Bt,St,jt,qt){var nr=$e+.5*(Bt-$e),ar=ut+.5*(St-ut),$r=jt+.5*(Bt-jt),kr=qt+.5*(St-qt),Gr=Math.min($e,jt,nr,$r),sn=Math.max($e,jt,nr,$r),on=Math.min(ut,qt,ar,kr),pr=Math.max(ut,qt,ar,kr);return new o(Gr,on,sn-Gr,pr-on)},Xt=function($e,ut,Bt,St,jt,qt,nr,ar){var $r,kr,Gr,sn,on,pr,We,Pn,mn,mr,Mr,en,Wr,gn,Bn=Bt-$e,Fn=St-ut,$n=jt-Bt,ei=qt-St,br=nr-jt,Cn=ar-qt;for(kr=0;kr<41;kr++)mn=(We=(Gr=$e+($r=kr/40)*Bn)+$r*((on=Bt+$r*$n)-Gr))+$r*(on+$r*(jt+$r*br-on)-We),mr=(Pn=(sn=ut+$r*Fn)+$r*((pr=St+$r*ei)-sn))+$r*(pr+$r*(qt+$r*Cn-pr)-Pn),kr==0?(Mr=mn,en=mr,Wr=mn,gn=mr):(Mr=Math.min(Mr,mn),en=Math.min(en,mr),Wr=Math.max(Wr,mn),gn=Math.max(gn,mr));return new o(Math.round(Mr),Math.round(en),Math.round(Wr-Mr),Math.round(gn-en))},Fr=function(){if(this.prevLineDash||this.ctx.lineDash.length||this.ctx.lineDashOffset){var $e,ut,Bt=($e=this.ctx.lineDash,ut=this.ctx.lineDashOffset,JSON.stringify({lineDash:$e,lineDashOffset:ut}));this.prevLineDash!==Bt&&(this.pdf.setLineDash(this.ctx.lineDash,this.ctx.lineDashOffset),this.prevLineDash=Bt)}}})(yi.API),function(r){var e=function(s){var a,o,h,f,_,x,T,I,N,$;for(o=[],h=0,f=(s+=a="\0\0\0\0".slice(s.length%4||4)).length;f>h;h+=4)(_=(s.charCodeAt(h)<<24)+(s.charCodeAt(h+1)<<16)+(s.charCodeAt(h+2)<<8)+s.charCodeAt(h+3))!==0?(x=(_=((_=((_=((_=(_-($=_%85))/85)-(N=_%85))/85)-(I=_%85))/85)-(T=_%85))/85)%85,o.push(x+33,T+33,I+33,N+33,$+33)):o.push(122);return function(W,Y){for(var ie=Y;ie>0;ie--)W.pop()}(o,a.length),String.fromCharCode.apply(String,o)+"~>"},t=function(s){var a,o,h,f,_,x=String,T="length",I=255,N="charCodeAt",$="slice",W="replace";for(s[$](-2),s=s[$](0,-2)[W](/\s/g,"")[W]("z","!!!!!"),h=[],f=0,_=(s+=a="uuuuu"[$](s[T]%5||5))[T];_>f;f+=5)o=52200625*(s[N](f)-33)+614125*(s[N](f+1)-33)+7225*(s[N](f+2)-33)+85*(s[N](f+3)-33)+(s[N](f+4)-33),h.push(I&o>>24,I&o>>16,I&o>>8,I&o);return function(Y,ie){for(var ce=ie;ce>0;ce--)Y.pop()}(h,a[T]),x.fromCharCode.apply(x,h)},n=function(s){var a=new RegExp(/^([0-9A-Fa-f]{2})+$/);if((s=s.replace(/\s/g,"")).indexOf(">")!==-1&&(s=s.substr(0,s.indexOf(">"))),s.length%2&&(s+="0"),a.test(s)===!1)return"";for(var o="",h=0;h<s.length;h+=2)o+=String.fromCharCode("0x"+(s[h]+s[h+1]));return o},i=function(s){for(var a=new Uint8Array(s.length),o=s.length;o--;)a[o]=s.charCodeAt(o);return s=(a=dR(a)).reduce(function(h,f){return h+String.fromCharCode(f)},"")};r.processDataByFilters=function(s,a){var o=0,h=s||"",f=[];for(typeof(a=a||[])=="string"&&(a=[a]),o=0;o<a.length;o+=1)switch(a[o]){case"ASCII85Decode":case"/ASCII85Decode":h=t(h),f.push("/ASCII85Encode");break;case"ASCII85Encode":case"/ASCII85Encode":h=e(h),f.push("/ASCII85Decode");break;case"ASCIIHexDecode":case"/ASCIIHexDecode":h=n(h),f.push("/ASCIIHexEncode");break;case"ASCIIHexEncode":case"/ASCIIHexEncode":h=h.split("").map(function(_){return("0"+_.charCodeAt().toString(16)).slice(-2)}).join("")+">",f.push("/ASCIIHexDecode");break;case"FlateEncode":case"/FlateEncode":h=i(h),f.push("/FlateDecode");break;default:throw new Error('The filter: "'+a[o]+'" is not implemented')}return{data:h,reverseChain:f.reverse().join(" ")}}}(yi.API),function(r){r.loadFile=function(e,t,n){return function(i,s,a){s=s!==!1,a=typeof a=="function"?a:function(){};var o=void 0;try{o=function(h,f,_){var x=new XMLHttpRequest,T=0,I=function(N){var $=N.length,W=[],Y=String.fromCharCode;for(T=0;T<$;T+=1)W.push(Y(255&N.charCodeAt(T)));return W.join("")};if(x.open("GET",h,!f),x.overrideMimeType("text/plain; charset=x-user-defined"),f===!1&&(x.onload=function(){x.status===200?_(I(this.responseText)):_(void 0)}),x.send(null),f&&x.status===200)return I(x.responseText)}(i,s,a)}catch{}return o}(e,t,n)},r.loadImageFile=r.loadFile}(yi.API),function(r){function e(){return(_i.html2canvas?Promise.resolve(_i.html2canvas):Promise.resolve().then(()=>K6e)).catch(function(a){return Promise.reject(new Error("Could not load html2canvas: "+a))}).then(function(a){return a.default?a.default:a})}function t(){return(_i.DOMPurify?Promise.resolve(_i.DOMPurify):Promise.resolve().then(()=>B8e)).catch(function(a){return Promise.reject(new Error("Could not load dompurify: "+a))}).then(function(a){return a.default?a.default:a})}var n=function(a){var o=Ms(a);return o==="undefined"?"undefined":o==="string"||a instanceof String?"string":o==="number"||a instanceof Number?"number":o==="function"||a instanceof Function?"function":a&&a.constructor===Array?"array":a&&a.nodeType===1?"element":o==="object"?"object":"unknown"},i=function(a,o){var h=document.createElement(a);for(var f in o.className&&(h.className=o.className),o.innerHTML&&o.dompurify&&(h.innerHTML=o.dompurify.sanitize(o.innerHTML)),o.style)h.style[f]=o.style[f];return h},s=function a(o){var h=Object.assign(a.convert(Promise.resolve()),JSON.parse(JSON.stringify(a.template))),f=a.convert(Promise.resolve(),h);return f=(f=f.setProgress(1,a,1,[a])).set(o)};(s.prototype=Object.create(Promise.prototype)).constructor=s,s.convert=function(a,o){return a.__proto__=o||s.prototype,a},s.template={prop:{src:null,container:null,overlay:null,canvas:null,img:null,pdf:null,pageSize:null,callback:function(){}},progress:{val:0,state:null,n:0,stack:[]},opt:{filename:"file.pdf",margin:[0,0,0,0],enableLinks:!0,x:0,y:0,html2canvas:{},jsPDF:{},backgroundColor:"transparent"}},s.prototype.from=function(a,o){return this.then(function(){switch(o=o||function(h){switch(n(h)){case"string":return"string";case"element":return h.nodeName.toLowerCase()==="canvas"?"canvas":"element";default:return"unknown"}}(a)){case"string":return this.then(t).then(function(h){return this.set({src:i("div",{innerHTML:a,dompurify:h})})});case"element":return this.set({src:a});case"canvas":return this.set({canvas:a});case"img":return this.set({img:a});default:return this.error("Unknown source type.")}})},s.prototype.to=function(a){switch(a){case"container":return this.toContainer();case"canvas":return this.toCanvas();case"img":return this.toImg();case"pdf":return this.toPdf();default:return this.error("Invalid target.")}},s.prototype.toContainer=function(){return this.thenList([function(){return this.prop.src||this.error("Cannot duplicate - no source HTML.")},function(){return this.prop.pageSize||this.setPageSize()}]).then(function(){var a={position:"relative",display:"inline-block",width:(typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?Math.max(this.prop.src.clientWidth,this.prop.src.scrollWidth,this.prop.src.offsetWidth):this.opt.windowWidth)+"px",left:0,right:0,top:0,margin:"auto",backgroundColor:this.opt.backgroundColor},o=function h(f,_){for(var x=f.nodeType===3?document.createTextNode(f.nodeValue):f.cloneNode(!1),T=f.firstChild;T;T=T.nextSibling)_!==!0&&T.nodeType===1&&T.nodeName==="SCRIPT"||x.appendChild(h(T,_));return f.nodeType===1&&(f.nodeName==="CANVAS"?(x.width=f.width,x.height=f.height,x.getContext("2d").drawImage(f,0,0)):f.nodeName!=="TEXTAREA"&&f.nodeName!=="SELECT"||(x.value=f.value),x.addEventListener("load",function(){x.scrollTop=f.scrollTop,x.scrollLeft=f.scrollLeft},!0)),x}(this.prop.src,this.opt.html2canvas.javascriptEnabled);o.tagName==="BODY"&&(a.height=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)+"px"),this.prop.overlay=i("div",{className:"html2pdf__overlay",style:{position:"fixed",overflow:"hidden",zIndex:1e3,left:"-100000px",right:0,bottom:0,top:0}}),this.prop.container=i("div",{className:"html2pdf__container",style:a}),this.prop.container.appendChild(o),this.prop.container.firstChild.appendChild(i("div",{style:{clear:"both",border:"0 none transparent",margin:0,padding:0,height:0}})),this.prop.container.style.float="none",this.prop.overlay.appendChild(this.prop.container),document.body.appendChild(this.prop.overlay),this.prop.container.firstChild.style.position="relative",this.prop.container.height=Math.max(this.prop.container.firstChild.clientHeight,this.prop.container.firstChild.scrollHeight,this.prop.container.firstChild.offsetHeight)+"px"})},s.prototype.toCanvas=function(){var a=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(a).then(e).then(function(o){var h=Object.assign({},this.opt.html2canvas);return delete h.onrendered,o(this.prop.container,h)}).then(function(o){(this.opt.html2canvas.onrendered||function(){})(o),this.prop.canvas=o,document.body.removeChild(this.prop.overlay)})},s.prototype.toContext2d=function(){var a=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(a).then(e).then(function(o){var h=this.opt.jsPDF,f=this.opt.fontFaces,_=typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?1:this.opt.width/this.opt.windowWidth,x=Object.assign({async:!0,allowTaint:!0,scale:_,scrollX:this.opt.scrollX||0,scrollY:this.opt.scrollY||0,backgroundColor:"#ffffff",imageTimeout:15e3,logging:!0,proxy:null,removeContainer:!0,foreignObjectRendering:!1,useCORS:!1},this.opt.html2canvas);if(delete x.onrendered,h.context2d.autoPaging=this.opt.autoPaging===void 0||this.opt.autoPaging,h.context2d.posX=this.opt.x,h.context2d.posY=this.opt.y,h.context2d.margin=this.opt.margin,h.context2d.fontFaces=f,f)for(var T=0;T<f.length;++T){var I=f[T],N=I.src.find(function($){return $.format==="truetype"});N&&h.addFont(N.url,I.ref.name,I.ref.style)}return x.windowHeight=x.windowHeight||0,x.windowHeight=x.windowHeight==0?Math.max(this.prop.container.clientHeight,this.prop.container.scrollHeight,this.prop.container.offsetHeight):x.windowHeight,h.context2d.save(!0),o(this.prop.container,x)}).then(function(o){this.opt.jsPDF.context2d.restore(!0),(this.opt.html2canvas.onrendered||function(){})(o),this.prop.canvas=o,document.body.removeChild(this.prop.overlay)})},s.prototype.toImg=function(){return this.thenList([function(){return this.prop.canvas||this.toCanvas()}]).then(function(){var a=this.prop.canvas.toDataURL("image/"+this.opt.image.type,this.opt.image.quality);this.prop.img=document.createElement("img"),this.prop.img.src=a})},s.prototype.toPdf=function(){return this.thenList([function(){return this.toContext2d()}]).then(function(){this.prop.pdf=this.prop.pdf||this.opt.jsPDF})},s.prototype.output=function(a,o,h){return(h=h||"pdf").toLowerCase()==="img"||h.toLowerCase()==="image"?this.outputImg(a,o):this.outputPdf(a,o)},s.prototype.outputPdf=function(a,o){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){return this.prop.pdf.output(a,o)})},s.prototype.outputImg=function(a){return this.thenList([function(){return this.prop.img||this.toImg()}]).then(function(){switch(a){case void 0:case"img":return this.prop.img;case"datauristring":case"dataurlstring":return this.prop.img.src;case"datauri":case"dataurl":return document.location.href=this.prop.img.src;default:throw'Image output type "'+a+'" is not supported.'}})},s.prototype.save=function(a){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).set(a?{filename:a}:null).then(function(){this.prop.pdf.save(this.opt.filename)})},s.prototype.doCallback=function(){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){this.prop.callback(this.prop.pdf)})},s.prototype.set=function(a){if(n(a)!=="object")return this;var o=Object.keys(a||{}).map(function(h){if(h in s.template.prop)return function(){this.prop[h]=a[h]};switch(h){case"margin":return this.setMargin.bind(this,a.margin);case"jsPDF":return function(){return this.opt.jsPDF=a.jsPDF,this.setPageSize()};case"pageSize":return this.setPageSize.bind(this,a.pageSize);default:return function(){this.opt[h]=a[h]}}},this);return this.then(function(){return this.thenList(o)})},s.prototype.get=function(a,o){return this.then(function(){var h=a in s.template.prop?this.prop[a]:this.opt[a];return o?o(h):h})},s.prototype.setMargin=function(a){return this.then(function(){switch(n(a)){case"number":a=[a,a,a,a];case"array":if(a.length===2&&(a=[a[0],a[1],a[0],a[1]]),a.length===4)break;default:return this.error("Invalid margin array.")}this.opt.margin=a}).then(this.setPageSize)},s.prototype.setPageSize=function(a){function o(h,f){return Math.floor(h*f/72*96)}return this.then(function(){(a=a||yi.getPageSize(this.opt.jsPDF)).hasOwnProperty("inner")||(a.inner={width:a.width-this.opt.margin[1]-this.opt.margin[3],height:a.height-this.opt.margin[0]-this.opt.margin[2]},a.inner.px={width:o(a.inner.width,a.k),height:o(a.inner.height,a.k)},a.inner.ratio=a.inner.height/a.inner.width),this.prop.pageSize=a})},s.prototype.setProgress=function(a,o,h,f){return a!=null&&(this.progress.val=a),o!=null&&(this.progress.state=o),h!=null&&(this.progress.n=h),f!=null&&(this.progress.stack=f),this.progress.ratio=this.progress.val/this.progress.state,this},s.prototype.updateProgress=function(a,o,h,f){return this.setProgress(a?this.progress.val+a:null,o||null,h?this.progress.n+h:null,f?this.progress.stack.concat(f):null)},s.prototype.then=function(a,o){var h=this;return this.thenCore(a,o,function(f,_){return h.updateProgress(null,null,1,[f]),Promise.prototype.then.call(this,function(x){return h.updateProgress(null,f),x}).then(f,_).then(function(x){return h.updateProgress(1),x})})},s.prototype.thenCore=function(a,o,h){h=h||Promise.prototype.then,a&&(a=a.bind(this)),o&&(o=o.bind(this));var f=Promise.toString().indexOf("[native code]")!==-1&&Promise.name==="Promise"?this:s.convert(Object.assign({},this),Promise.prototype),_=h.call(f,a,o);return s.convert(_,this.__proto__)},s.prototype.thenExternal=function(a,o){return Promise.prototype.then.call(this,a,o)},s.prototype.thenList=function(a){var o=this;return a.forEach(function(h){o=o.thenCore(h)}),o},s.prototype.catch=function(a){a&&(a=a.bind(this));var o=Promise.prototype.catch.call(this,a);return s.convert(o,this)},s.prototype.catchExternal=function(a){return Promise.prototype.catch.call(this,a)},s.prototype.error=function(a){return this.then(function(){throw new Error(a)})},s.prototype.using=s.prototype.set,s.prototype.saveAs=s.prototype.save,s.prototype.export=s.prototype.output,s.prototype.run=s.prototype.then,yi.getPageSize=function(a,o,h){if(Ms(a)==="object"){var f=a;a=f.orientation,o=f.unit||o,h=f.format||h}o=o||"mm",h=h||"a4",a=(""+(a||"P")).toLowerCase();var _,x=(""+h).toLowerCase(),T={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};switch(o){case"pt":_=1;break;case"mm":_=72/25.4;break;case"cm":_=72/2.54;break;case"in":_=72;break;case"px":_=.75;break;case"pc":case"em":_=12;break;case"ex":_=6;break;default:throw"Invalid unit: "+o}var I,N=0,$=0;if(T.hasOwnProperty(x))N=T[x][1]/_,$=T[x][0]/_;else try{N=h[1],$=h[0]}catch{throw new Error("Invalid format: "+h)}if(a==="p"||a==="portrait")a="p",$>N&&(I=$,$=N,N=I);else{if(a!=="l"&&a!=="landscape")throw"Invalid orientation: "+a;a="l",N>$&&(I=$,$=N,N=I)}return{width:$,height:N,unit:o,k:_,orientation:a}},r.html=function(a,o){(o=o||{}).callback=o.callback||function(){},o.html2canvas=o.html2canvas||{},o.html2canvas.canvas=o.html2canvas.canvas||this.canvas,o.jsPDF=o.jsPDF||this,o.fontFaces=o.fontFaces?o.fontFaces.map(wR):null;var h=new s(o);return o.worker?h:h.from(a).doCallback()}}(yi.API),yi.API.addJS=function(r){return A$=r,this.internal.events.subscribe("postPutResources",function(){UB=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/Names [(EmbeddedJS) "+(UB+1)+" 0 R]"),this.internal.out(">>"),this.internal.out("endobj"),f$=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /JavaScript"),this.internal.out("/JS ("+A$+")"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){UB!==void 0&&f$!==void 0&&this.internal.out("/Names <</JavaScript "+UB+" 0 R>>")}),this},function(r){var e;r.events.push(["postPutResources",function(){var t=this,n=/^(\d+) 0 obj$/;if(this.outline.root.children.length>0)for(var i=t.outline.render().split(/\r\n/),s=0;s<i.length;s++){var a=i[s],o=n.exec(a);if(o!=null){var h=o[1];t.internal.newObjectDeferredBegin(h,!1)}t.internal.write(a)}if(this.outline.createNamedDestinations){var f=this.internal.pages.length,_=[];for(s=0;s<f;s++){var x=t.internal.newObject();_.push(x);var T=t.internal.getPageInfo(s+1);t.internal.write("<< /D["+T.objId+" 0 R /XYZ null null null]>> endobj")}var I=t.internal.newObject();for(t.internal.write("<< /Names [ "),s=0;s<_.length;s++)t.internal.write("(page_"+(s+1)+")"+_[s]+" 0 R");t.internal.write(" ] >>","endobj"),e=t.internal.newObject(),t.internal.write("<< /Dests "+I+" 0 R"),t.internal.write(">>","endobj")}}]),r.events.push(["putCatalog",function(){this.outline.root.children.length>0&&(this.internal.write("/Outlines",this.outline.makeRef(this.outline.root)),this.outline.createNamedDestinations&&this.internal.write("/Names "+e+" 0 R"))}]),r.events.push(["initialized",function(){var t=this;t.outline={createNamedDestinations:!1,root:{children:[]}},t.outline.add=function(n,i,s){var a={title:i,options:s,children:[]};return n==null&&(n=this.root),n.children.push(a),a},t.outline.render=function(){return this.ctx={},this.ctx.val="",this.ctx.pdf=t,this.genIds_r(this.root),this.renderRoot(this.root),this.renderItems(this.root),this.ctx.val},t.outline.genIds_r=function(n){n.id=t.internal.newObjectDeferred();for(var i=0;i<n.children.length;i++)this.genIds_r(n.children[i])},t.outline.renderRoot=function(n){this.objStart(n),this.line("/Type /Outlines"),n.children.length>0&&(this.line("/First "+this.makeRef(n.children[0])),this.line("/Last "+this.makeRef(n.children[n.children.length-1]))),this.line("/Count "+this.count_r({count:0},n)),this.objEnd()},t.outline.renderItems=function(n){for(var i=this.ctx.pdf.internal.getVerticalCoordinateString,s=0;s<n.children.length;s++){var a=n.children[s];this.objStart(a),this.line("/Title "+this.makeString(a.title)),this.line("/Parent "+this.makeRef(n)),s>0&&this.line("/Prev "+this.makeRef(n.children[s-1])),s<n.children.length-1&&this.line("/Next "+this.makeRef(n.children[s+1])),a.children.length>0&&(this.line("/First "+this.makeRef(a.children[0])),this.line("/Last "+this.makeRef(a.children[a.children.length-1])));var o=this.count=this.count_r({count:0},a);if(o>0&&this.line("/Count "+o),a.options&&a.options.pageNumber){var h=t.internal.getPageInfo(a.options.pageNumber);this.line("/Dest ["+h.objId+" 0 R /XYZ 0 "+i(0)+" 0]")}this.objEnd()}for(var f=0;f<n.children.length;f++)this.renderItems(n.children[f])},t.outline.line=function(n){this.ctx.val+=n+`\r
`},t.outline.makeRef=function(n){return n.id+" 0 R"},t.outline.makeString=function(n){return"("+t.internal.pdfEscape(n)+")"},t.outline.objStart=function(n){this.ctx.val+=`\r
`+n.id+` 0 obj\r
<<\r
`},t.outline.objEnd=function(){this.ctx.val+=`>> \r
endobj\r
`},t.outline.count_r=function(n,i){for(var s=0;s<i.children.length;s++)n.count++,this.count_r(n,i.children[s]);return n.count}}])}(yi.API),function(r){var e=[192,193,194,195,196,197,198,199];r.processJPEG=function(t,n,i,s,a,o){var h,f=this.decode.DCT_DECODE,_=null;if(typeof t=="string"||this.__addimage__.isArrayBuffer(t)||this.__addimage__.isArrayBufferView(t)){switch(t=a||t,t=this.__addimage__.isArrayBuffer(t)?new Uint8Array(t):t,(h=function(x){for(var T,I=256*x.charCodeAt(4)+x.charCodeAt(5),N=x.length,$={width:0,height:0,numcomponents:1},W=4;W<N;W+=2){if(W+=I,e.indexOf(x.charCodeAt(W+1))!==-1){T=256*x.charCodeAt(W+5)+x.charCodeAt(W+6),$={width:256*x.charCodeAt(W+7)+x.charCodeAt(W+8),height:T,numcomponents:x.charCodeAt(W+9)};break}I=256*x.charCodeAt(W+2)+x.charCodeAt(W+3)}return $}(t=this.__addimage__.isArrayBufferView(t)?this.__addimage__.arrayBufferToBinaryString(t):t)).numcomponents){case 1:o=this.color_spaces.DEVICE_GRAY;break;case 4:o=this.color_spaces.DEVICE_CMYK;break;case 3:o=this.color_spaces.DEVICE_RGB}_={data:t,width:h.width,height:h.height,colorSpace:o,bitsPerComponent:8,filter:f,index:n,alias:i}}return _}}(yi.API);var k0,NB,g$,m$,_$,S5e=function(){var r,e,t;function n(s){var a,o,h,f,_,x,T,I,N,$,W,Y,ie,ce;for(this.data=s,this.pos=8,this.palette=[],this.imgData=[],this.transparency={},this.animation=null,this.text={},x=null;;){switch(a=this.readUInt32(),N=(function(){var fe,ve;for(ve=[],fe=0;fe<4;++fe)ve.push(String.fromCharCode(this.data[this.pos++]));return ve}).call(this).join("")){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(a);break;case"fcTL":x&&this.animation.frames.push(x),this.pos+=4,x={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()},_=this.readUInt16(),f=this.readUInt16()||100,x.delay=1e3*_/f,x.disposeOp=this.data[this.pos++],x.blendOp=this.data[this.pos++],x.data=[];break;case"IDAT":case"fdAT":for(N==="fdAT"&&(this.pos+=4,a-=4),s=(x!=null?x.data:void 0)||this.imgData,Y=0;0<=a?Y<a:Y>a;0<=a?++Y:--Y)s.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:if(h=this.palette.length/3,this.transparency.indexed=this.read(a),this.transparency.indexed.length>h)throw new Error("More transparent colors than palette size");if(($=h-this.transparency.indexed.length)>0)for(ie=0;0<=$?ie<$:ie>$;0<=$?++ie:--ie)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(a)[0];break;case 2:this.transparency.rgb=this.read(a)}break;case"tEXt":T=(W=this.read(a)).indexOf(0),I=String.fromCharCode.apply(String,W.slice(0,T)),this.text[I]=String.fromCharCode.apply(String,W.slice(T+1));break;case"IEND":return x&&this.animation.frames.push(x),this.colors=(function(){switch(this.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}).call(this),this.hasAlphaChannel=(ce=this.colorType)===4||ce===6,o=this.colors+(this.hasAlphaChannel?1:0),this.pixelBitlength=this.bits*o,this.colorSpace=(function(){switch(this.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}).call(this),void(this.imgData=new Uint8Array(this.imgData));default:this.pos+=a}if(this.pos+=4,this.pos>this.data.length)throw new Error("Incomplete or corrupt PNG file")}}n.prototype.read=function(s){var a,o;for(o=[],a=0;0<=s?a<s:a>s;0<=s?++a:--a)o.push(this.data[this.pos++]);return o},n.prototype.readUInt32=function(){return this.data[this.pos++]<<24|this.data[this.pos++]<<16|this.data[this.pos++]<<8|this.data[this.pos++]},n.prototype.readUInt16=function(){return this.data[this.pos++]<<8|this.data[this.pos++]},n.prototype.decodePixels=function(s){var a=this.pixelBitlength/8,o=new Uint8Array(this.width*this.height*a),h=0,f=this;if(s==null&&(s=this.imgData),s.length===0)return new Uint8Array(0);function _(x,T,I,N){var $,W,Y,ie,ce,fe,ve,be,Qe,Ue,st,at,Le,ze,tt,Ne,Ht,Vt,Jt,Kt,er,Xt=Math.ceil((f.width-x)/I),Fr=Math.ceil((f.height-T)/N),$e=f.width==Xt&&f.height==Fr;for(ze=a*Xt,at=$e?o:new Uint8Array(ze*Fr),fe=s.length,Le=0,W=0;Le<Fr&&h<fe;){switch(s[h++]){case 0:for(ie=Ht=0;Ht<ze;ie=Ht+=1)at[W++]=s[h++];break;case 1:for(ie=Vt=0;Vt<ze;ie=Vt+=1)$=s[h++],ce=ie<a?0:at[W-a],at[W++]=($+ce)%256;break;case 2:for(ie=Jt=0;Jt<ze;ie=Jt+=1)$=s[h++],Y=(ie-ie%a)/a,tt=Le&&at[(Le-1)*ze+Y*a+ie%a],at[W++]=(tt+$)%256;break;case 3:for(ie=Kt=0;Kt<ze;ie=Kt+=1)$=s[h++],Y=(ie-ie%a)/a,ce=ie<a?0:at[W-a],tt=Le&&at[(Le-1)*ze+Y*a+ie%a],at[W++]=($+Math.floor((ce+tt)/2))%256;break;case 4:for(ie=er=0;er<ze;ie=er+=1)$=s[h++],Y=(ie-ie%a)/a,ce=ie<a?0:at[W-a],Le===0?tt=Ne=0:(tt=at[(Le-1)*ze+Y*a+ie%a],Ne=Y&&at[(Le-1)*ze+(Y-1)*a+ie%a]),ve=ce+tt-Ne,be=Math.abs(ve-ce),Ue=Math.abs(ve-tt),st=Math.abs(ve-Ne),Qe=be<=Ue&&be<=st?ce:Ue<=st?tt:Ne,at[W++]=($+Qe)%256;break;default:throw new Error("Invalid filter algorithm: "+s[h-1])}if(!$e){var ut=((T+Le*N)*f.width+x)*a,Bt=Le*ze;for(ie=0;ie<Xt;ie+=1){for(var St=0;St<a;St+=1)o[ut++]=at[Bt++];ut+=(I-1)*a}}Le++}}return s=l5e(s),f.interlaceMethod==1?(_(0,0,8,8),_(4,0,8,8),_(0,4,4,8),_(2,0,4,4),_(0,2,2,4),_(1,0,2,2),_(0,1,1,2)):_(0,0,1,1),o},n.prototype.decodePalette=function(){var s,a,o,h,f,_,x,T,I;for(o=this.palette,_=this.transparency.indexed||[],f=new Uint8Array((_.length||0)+o.length),h=0,s=0,a=x=0,T=o.length;x<T;a=x+=3)f[h++]=o[a],f[h++]=o[a+1],f[h++]=o[a+2],f[h++]=(I=_[s++])!=null?I:255;return f},n.prototype.copyToImageData=function(s,a){var o,h,f,_,x,T,I,N,$,W,Y;if(h=this.colors,$=null,o=this.hasAlphaChannel,this.palette.length&&($=(Y=this._decodedPalette)!=null?Y:this._decodedPalette=this.decodePalette(),h=4,o=!0),N=(f=s.data||s).length,x=$||a,_=T=0,h===1)for(;_<N;)I=$?4*a[_/4]:T,W=x[I++],f[_++]=W,f[_++]=W,f[_++]=W,f[_++]=o?x[I++]:255,T=I;else for(;_<N;)I=$?4*a[_/4]:T,f[_++]=x[I++],f[_++]=x[I++],f[_++]=x[I++],f[_++]=o?x[I++]:255,T=I},n.prototype.decode=function(){var s;return s=new Uint8Array(this.width*this.height*4),this.copyToImageData(s,this.decodePixels()),s};var i=function(){if(Object.prototype.toString.call(_i)==="[object Window]"){try{e=_i.document.createElement("canvas"),t=e.getContext("2d")}catch{return!1}return!0}return!1};return i(),r=function(s){var a;if(i()===!0)return t.width=s.width,t.height=s.height,t.clearRect(0,0,s.width,s.height),t.putImageData(s,0,0),(a=new Image).src=e.toDataURL(),a;throw new Error("This method requires a Browser with Canvas-capability.")},n.prototype.decodeFrames=function(s){var a,o,h,f,_,x,T,I;if(this.animation){for(I=[],o=_=0,x=(T=this.animation.frames).length;_<x;o=++_)a=T[o],h=s.createImageData(a.width,a.height),f=this.decodePixels(new Uint8Array(a.data)),this.copyToImageData(h,f),a.imageData=h,I.push(a.image=r(h));return I}},n.prototype.renderFrame=function(s,a){var o,h,f;return o=(h=this.animation.frames)[a],f=h[a-1],a===0&&s.clearRect(0,0,this.width,this.height),(f!=null?f.disposeOp:void 0)===1?s.clearRect(f.xOffset,f.yOffset,f.width,f.height):(f!=null?f.disposeOp:void 0)===2&&s.putImageData(f.imageData,f.xOffset,f.yOffset),o.blendOp===0&&s.clearRect(o.xOffset,o.yOffset,o.width,o.height),s.drawImage(o.image,o.xOffset,o.yOffset)},n.prototype.animate=function(s){var a,o,h,f,_,x,T=this;return o=0,x=this.animation,f=x.numFrames,h=x.frames,_=x.numPlays,(a=function(){var I,N;if(I=o++%f,N=h[I],T.renderFrame(s,I),f>1&&o/f<_)return T.animation._timeout=setTimeout(a,N.delay)})()},n.prototype.stopAnimation=function(){var s;return clearTimeout((s=this.animation)!=null?s._timeout:void 0)},n.prototype.render=function(s){var a,o;return s._png&&s._png.stopAnimation(),s._png=this,s.width=this.width,s.height=this.height,a=s.getContext("2d"),this.animation?(this.decodeFrames(a),this.animate(a)):(o=a.createImageData(this.width,this.height),this.copyToImageData(o,this.decodePixels()),a.putImageData(o,0,0))},n}();/**
* @license
*
* Copyright (c) 2014 James Robb, https://github.com/jamesbrobb
*
* Permission is hereby granted, free of charge, to any person obtaining
* a copy of this software and associated documentation files (the
* "Software"), to deal in the Software without restriction, including
* without limitation the rights to use, copy, modify, merge, publish,
* distribute, sublicense, and/or sell copies of the Software, and to
* permit persons to whom the Software is furnished to do so, subject to
* the following conditions:
*
* The above copyright notice and this permission notice shall be
* included in all copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
* MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
* LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
* OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
* WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
* ====================================================================
*//**
* @license
* (c) Dean McNamee <dean@gmail.com>, 2013.
*
* https://github.com/deanm/omggif
*
* Permission is hereby granted, free of charge, to any person obtaining a copy
* of this software and associated documentation files (the "Software"), to
* deal in the Software without restriction, including without limitation the
* rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
* sell copies of the Software, and to permit persons to whom the Software is
* furnished to do so, subject to the following conditions:
*
* The above copyright notice and this permission notice shall be included in
* all copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
* FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
* AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
* LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
* FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
* IN THE SOFTWARE.
*
* omggif is a JavaScript implementation of a GIF 89a encoder and decoder,
* including animation and compression.  It does not rely on any specific
* underlying system, so should run in the browser, Node, or Plask.
*/function I5e(r){var e=0;if(r[e++]!==71||r[e++]!==73||r[e++]!==70||r[e++]!==56||(r[e++]+1&253)!=56||r[e++]!==97)throw new Error("Invalid GIF 87a/89a header.");var t=r[e++]|r[e++]<<8,n=r[e++]|r[e++]<<8,i=r[e++],s=i>>7,a=1<<(7&i)+1;r[e++],r[e++];var o=null,h=null;s&&(o=e,h=a,e+=3*a);var f=!0,_=[],x=0,T=null,I=0,N=null;for(this.width=t,this.height=n;f&&e<r.length;)switch(r[e++]){case 33:switch(r[e++]){case 255:if(r[e]!==11||r[e+1]==78&&r[e+2]==69&&r[e+3]==84&&r[e+4]==83&&r[e+5]==67&&r[e+6]==65&&r[e+7]==80&&r[e+8]==69&&r[e+9]==50&&r[e+10]==46&&r[e+11]==48&&r[e+12]==3&&r[e+13]==1&&r[e+16]==0)e+=14,N=r[e++]|r[e++]<<8,e++;else for(e+=12;;){if(!((Le=r[e++])>=0))throw Error("Invalid block size");if(Le===0)break;e+=Le}break;case 249:if(r[e++]!==4||r[e+4]!==0)throw new Error("Invalid graphics extension block.");var $=r[e++];x=r[e++]|r[e++]<<8,T=r[e++],!(1&$)&&(T=null),I=$>>2&7,e++;break;case 254:for(;;){if(!((Le=r[e++])>=0))throw Error("Invalid block size");if(Le===0)break;e+=Le}break;default:throw new Error("Unknown graphic control label: 0x"+r[e-1].toString(16))}break;case 44:var W=r[e++]|r[e++]<<8,Y=r[e++]|r[e++]<<8,ie=r[e++]|r[e++]<<8,ce=r[e++]|r[e++]<<8,fe=r[e++],ve=fe>>6&1,be=1<<(7&fe)+1,Qe=o,Ue=h,st=!1;fe>>7&&(st=!0,Qe=e,Ue=be,e+=3*be);var at=e;for(e++;;){var Le;if(!((Le=r[e++])>=0))throw Error("Invalid block size");if(Le===0)break;e+=Le}_.push({x:W,y:Y,width:ie,height:ce,has_local_palette:st,palette_offset:Qe,palette_size:Ue,data_offset:at,data_length:e-at,transparent_index:T,interlaced:!!ve,delay:x,disposal:I});break;case 59:f=!1;break;default:throw new Error("Unknown gif block: 0x"+r[e-1].toString(16))}this.numFrames=function(){return _.length},this.loopCount=function(){return N},this.frameInfo=function(ze){if(ze<0||ze>=_.length)throw new Error("Frame index out of range.");return _[ze]},this.decodeAndBlitFrameBGRA=function(ze,tt){var Ne=this.frameInfo(ze),Ht=Ne.width*Ne.height,Vt=new Uint8Array(Ht);y$(r,Ne.data_offset,Vt,Ht);var Jt=Ne.palette_offset,Kt=Ne.transparent_index;Kt===null&&(Kt=256);var er=Ne.width,Xt=t-er,Fr=er,$e=4*(Ne.y*t+Ne.x),ut=4*((Ne.y+Ne.height)*t+Ne.x),Bt=$e,St=4*Xt;Ne.interlaced===!0&&(St+=4*t*7);for(var jt=8,qt=0,nr=Vt.length;qt<nr;++qt){var ar=Vt[qt];if(Fr===0&&(Fr=er,(Bt+=St)>=ut&&(St=4*Xt+4*t*(jt-1),Bt=$e+(er+Xt)*(jt<<1),jt>>=1)),ar===Kt)Bt+=4;else{var $r=r[Jt+3*ar],kr=r[Jt+3*ar+1],Gr=r[Jt+3*ar+2];tt[Bt++]=Gr,tt[Bt++]=kr,tt[Bt++]=$r,tt[Bt++]=255}--Fr}},this.decodeAndBlitFrameRGBA=function(ze,tt){var Ne=this.frameInfo(ze),Ht=Ne.width*Ne.height,Vt=new Uint8Array(Ht);y$(r,Ne.data_offset,Vt,Ht);var Jt=Ne.palette_offset,Kt=Ne.transparent_index;Kt===null&&(Kt=256);var er=Ne.width,Xt=t-er,Fr=er,$e=4*(Ne.y*t+Ne.x),ut=4*((Ne.y+Ne.height)*t+Ne.x),Bt=$e,St=4*Xt;Ne.interlaced===!0&&(St+=4*t*7);for(var jt=8,qt=0,nr=Vt.length;qt<nr;++qt){var ar=Vt[qt];if(Fr===0&&(Fr=er,(Bt+=St)>=ut&&(St=4*Xt+4*t*(jt-1),Bt=$e+(er+Xt)*(jt<<1),jt>>=1)),ar===Kt)Bt+=4;else{var $r=r[Jt+3*ar],kr=r[Jt+3*ar+1],Gr=r[Jt+3*ar+2];tt[Bt++]=$r,tt[Bt++]=kr,tt[Bt++]=Gr,tt[Bt++]=255}--Fr}}}function y$(r,e,t,n){for(var i=r[e++],s=1<<i,a=s+1,o=a+1,h=i+1,f=(1<<h)-1,_=0,x=0,T=0,I=r[e++],N=new Int32Array(4096),$=null;;){for(;_<16&&I!==0;)x|=r[e++]<<_,_+=8,I===1?I=r[e++]:--I;if(_<h)break;var W=x&f;if(x>>=h,_-=h,W!==s){if(W===a)break;for(var Y=W<o?W:$,ie=0,ce=Y;ce>s;)ce=N[ce]>>8,++ie;var fe=ce;if(T+ie+(Y!==W?1:0)>n)return void po.log("Warning, gif stream longer than expected.");t[T++]=fe;var ve=T+=ie;for(Y!==W&&(t[T++]=fe),ce=Y;ie--;)ce=N[ce],t[--ve]=255&ce,ce>>=8;$!==null&&o<4096&&(N[o++]=$<<8|fe,o>=f+1&&h<12&&(++h,f=f<<1|1)),$=W}else o=a+1,f=(1<<(h=i+1))-1,$=null}return T!==n&&po.log("Warning, gif stream shorter than expected."),t}/**
	 * @license
	  Copyright (c) 2008, Adobe Systems Incorporated
	  All rights reserved.

	  Redistribution and use in source and binary forms, with or without 
	  modification, are permitted provided that the following conditions are
	  met:

	  * Redistributions of source code must retain the above copyright notice, 
	    this list of conditions and the following disclaimer.
	  
	  * Redistributions in binary form must reproduce the above copyright
	    notice, this list of conditions and the following disclaimer in the 
	    documentation and/or other materials provided with the distribution.
	  
	  * Neither the name of Adobe Systems Incorporated nor the names of its 
	    contributors may be used to endorse or promote products derived from 
	    this software without specific prior written permission.

	  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS
	  IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
	  THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
	  PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR 
	  CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
	  EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
	  PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
	  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
	  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
	  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
	  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
	*/function BR(r){var e,t,n,i,s,a=Math.floor,o=new Array(64),h=new Array(64),f=new Array(64),_=new Array(64),x=new Array(65535),T=new Array(65535),I=new Array(64),N=new Array(64),$=[],W=0,Y=7,ie=new Array(64),ce=new Array(64),fe=new Array(64),ve=new Array(256),be=new Array(2048),Qe=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],Ue=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],st=[0,1,2,3,4,5,6,7,8,9,10,11],at=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],Le=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],ze=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],tt=[0,1,2,3,4,5,6,7,8,9,10,11],Ne=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],Ht=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function Vt($e,ut){for(var Bt=0,St=0,jt=new Array,qt=1;qt<=16;qt++){for(var nr=1;nr<=$e[qt];nr++)jt[ut[St]]=[],jt[ut[St]][0]=Bt,jt[ut[St]][1]=qt,St++,Bt++;Bt*=2}return jt}function Jt($e){for(var ut=$e[0],Bt=$e[1]-1;Bt>=0;)ut&1<<Bt&&(W|=1<<Y),Bt--,--Y<0&&(W==255?(Kt(255),Kt(0)):Kt(W),Y=7,W=0)}function Kt($e){$.push($e)}function er($e){Kt($e>>8&255),Kt(255&$e)}function Xt($e,ut,Bt,St,jt){for(var qt,nr=jt[0],ar=jt[240],$r=function(mr,Mr){var en,Wr,gn,Bn,Fn,$n,ei,br,Cn,Rn,nn=0;for(Cn=0;Cn<8;++Cn){en=mr[nn],Wr=mr[nn+1],gn=mr[nn+2],Bn=mr[nn+3],Fn=mr[nn+4],$n=mr[nn+5],ei=mr[nn+6];var Ci=en+(br=mr[nn+7]),Cr=en-br,Tn=Wr+ei,Xe=Wr-ei,He=gn+$n,Je=gn-$n,Ve=Bn+Fn,bt=Bn-Fn,Mt=Ci+Ve,$t=Ci-Ve,Wt=Tn+He,Pe=Tn-He;mr[nn]=Mt+Wt,mr[nn+4]=Mt-Wt;var Ae=.707106781*(Pe+$t);mr[nn+2]=$t+Ae,mr[nn+6]=$t-Ae;var ge=.382683433*((Mt=bt+Je)-(Pe=Xe+Cr)),we=.5411961*Mt+ge,Se=1.306562965*Pe+ge,ht=.707106781*(Wt=Je+Xe),At=Cr+ht,_t=Cr-ht;mr[nn+5]=_t+we,mr[nn+3]=_t-we,mr[nn+1]=At+Se,mr[nn+7]=At-Se,nn+=8}for(nn=0,Cn=0;Cn<8;++Cn){en=mr[nn],Wr=mr[nn+8],gn=mr[nn+16],Bn=mr[nn+24],Fn=mr[nn+32],$n=mr[nn+40],ei=mr[nn+48];var dt=en+(br=mr[nn+56]),yt=en-br,Nt=Wr+ei,Rt=Wr-ei,dr=gn+$n,zr=gn-$n,Pr=Bn+Fn,Rr=Bn-Fn,ln=dt+Pr,Jn=dt-Pr,_n=Nt+dr,jn=Nt-dr;mr[nn]=ln+_n,mr[nn+32]=ln-_n;var Gn=.707106781*(jn+Jn);mr[nn+16]=Jn+Gn,mr[nn+48]=Jn-Gn;var Ln=.382683433*((ln=Rr+zr)-(jn=Rt+yt)),Un=.5411961*ln+Ln,Ei=1.306562965*jn+Ln,zi=.707106781*(_n=zr+Rt),Pt=yt+zi,Zr=yt-zi;mr[nn+40]=Zr+Un,mr[nn+24]=Zr-Un,mr[nn+8]=Pt+Ei,mr[nn+56]=Pt-Ei,nn++}for(Cn=0;Cn<64;++Cn)Rn=mr[Cn]*Mr[Cn],I[Cn]=Rn>0?Rn+.5|0:Rn-.5|0;return I}($e,ut),kr=0;kr<64;++kr)N[Qe[kr]]=$r[kr];var Gr=N[0]-Bt;Bt=N[0],Gr==0?Jt(St[0]):(Jt(St[T[qt=32767+Gr]]),Jt(x[qt]));for(var sn=63;sn>0&&N[sn]==0;)sn--;if(sn==0)return Jt(nr),Bt;for(var on,pr=1;pr<=sn;){for(var We=pr;N[pr]==0&&pr<=sn;)++pr;var Pn=pr-We;if(Pn>=16){on=Pn>>4;for(var mn=1;mn<=on;++mn)Jt(ar);Pn&=15}qt=32767+N[pr],Jt(jt[(Pn<<4)+T[qt]]),Jt(x[qt]),pr++}return sn!=63&&Jt(nr),Bt}function Fr($e){$e=Math.min(Math.max($e,1),100),s!=$e&&(function(ut){for(var Bt=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],St=0;St<64;St++){var jt=a((Bt[St]*ut+50)/100);jt=Math.min(Math.max(jt,1),255),o[Qe[St]]=jt}for(var qt=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],nr=0;nr<64;nr++){var ar=a((qt[nr]*ut+50)/100);ar=Math.min(Math.max(ar,1),255),h[Qe[nr]]=ar}for(var $r=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],kr=0,Gr=0;Gr<8;Gr++)for(var sn=0;sn<8;sn++)f[kr]=1/(o[Qe[kr]]*$r[Gr]*$r[sn]*8),_[kr]=1/(h[Qe[kr]]*$r[Gr]*$r[sn]*8),kr++}($e<50?Math.floor(5e3/$e):Math.floor(200-2*$e)),s=$e)}this.encode=function($e,ut){ut&&Fr(ut),$=new Array,W=0,Y=7,er(65496),er(65504),er(16),Kt(74),Kt(70),Kt(73),Kt(70),Kt(0),Kt(1),Kt(1),Kt(0),er(1),er(1),Kt(0),Kt(0),function(){er(65499),er(132),Kt(0);for(var Wr=0;Wr<64;Wr++)Kt(o[Wr]);Kt(1);for(var gn=0;gn<64;gn++)Kt(h[gn])}(),function(Wr,gn){er(65472),er(17),Kt(8),er(gn),er(Wr),Kt(3),Kt(1),Kt(17),Kt(0),Kt(2),Kt(17),Kt(1),Kt(3),Kt(17),Kt(1)}($e.width,$e.height),function(){er(65476),er(418),Kt(0);for(var Wr=0;Wr<16;Wr++)Kt(Ue[Wr+1]);for(var gn=0;gn<=11;gn++)Kt(st[gn]);Kt(16);for(var Bn=0;Bn<16;Bn++)Kt(at[Bn+1]);for(var Fn=0;Fn<=161;Fn++)Kt(Le[Fn]);Kt(1);for(var $n=0;$n<16;$n++)Kt(ze[$n+1]);for(var ei=0;ei<=11;ei++)Kt(tt[ei]);Kt(17);for(var br=0;br<16;br++)Kt(Ne[br+1]);for(var Cn=0;Cn<=161;Cn++)Kt(Ht[Cn])}(),er(65498),er(12),Kt(3),Kt(1),Kt(0),Kt(2),Kt(17),Kt(3),Kt(17),Kt(0),Kt(63),Kt(0);var Bt=0,St=0,jt=0;W=0,Y=7,this.encode.displayName="_encode_";for(var qt,nr,ar,$r,kr,Gr,sn,on,pr,We=$e.data,Pn=$e.width,mn=$e.height,mr=4*Pn,Mr=0;Mr<mn;){for(qt=0;qt<mr;){for(kr=mr*Mr+qt,sn=-1,on=0,pr=0;pr<64;pr++)Gr=kr+(on=pr>>3)*mr+(sn=4*(7&pr)),Mr+on>=mn&&(Gr-=mr*(Mr+1+on-mn)),qt+sn>=mr&&(Gr-=qt+sn-mr+4),nr=We[Gr++],ar=We[Gr++],$r=We[Gr++],ie[pr]=(be[nr]+be[ar+256>>0]+be[$r+512>>0]>>16)-128,ce[pr]=(be[nr+768>>0]+be[ar+1024>>0]+be[$r+1280>>0]>>16)-128,fe[pr]=(be[nr+1280>>0]+be[ar+1536>>0]+be[$r+1792>>0]>>16)-128;Bt=Xt(ie,f,Bt,e,n),St=Xt(ce,_,St,t,i),jt=Xt(fe,_,jt,t,i),qt+=32}Mr+=8}if(Y>=0){var en=[];en[1]=Y+1,en[0]=(1<<Y+1)-1,Jt(en)}return er(65497),new Uint8Array($)},r=r||50,function(){for(var $e=String.fromCharCode,ut=0;ut<256;ut++)ve[ut]=$e(ut)}(),e=Vt(Ue,st),t=Vt(ze,tt),n=Vt(at,Le),i=Vt(Ne,Ht),function(){for(var $e=1,ut=2,Bt=1;Bt<=15;Bt++){for(var St=$e;St<ut;St++)T[32767+St]=Bt,x[32767+St]=[],x[32767+St][1]=Bt,x[32767+St][0]=St;for(var jt=-(ut-1);jt<=-$e;jt++)T[32767+jt]=Bt,x[32767+jt]=[],x[32767+jt][1]=Bt,x[32767+jt][0]=ut-1+jt;$e<<=1,ut<<=1}}(),function(){for(var $e=0;$e<256;$e++)be[$e]=19595*$e,be[$e+256>>0]=38470*$e,be[$e+512>>0]=7471*$e+32768,be[$e+768>>0]=-11059*$e,be[$e+1024>>0]=-21709*$e,be[$e+1280>>0]=32768*$e+8421375,be[$e+1536>>0]=-27439*$e,be[$e+1792>>0]=-5329*$e}(),Fr(r)}/**
* @license
* Copyright (c) 2017 Aras Abbasi
*
* Licensed under the MIT License.
* http://opensource.org/licenses/mit-license
*/function sf(r,e){if(this.pos=0,this.buffer=r,this.datav=new DataView(r.buffer),this.is_with_alpha=!!e,this.bottom_up=!0,this.flag=String.fromCharCode(this.buffer[0])+String.fromCharCode(this.buffer[1]),this.pos+=2,["BM","BA","CI","CP","IC","PT"].indexOf(this.flag)===-1)throw new Error("Invalid BMP File");this.parseHeader(),this.parseBGR()}function b$(r){function e(Ue){if(!Ue)throw Error("assert :P")}function t(Ue,st,at){for(var Le=0;4>Le;Le++)if(Ue[st+Le]!=at.charCodeAt(Le))return!0;return!1}function n(Ue,st,at,Le,ze){for(var tt=0;tt<ze;tt++)Ue[st+tt]=at[Le+tt]}function i(Ue,st,at,Le){for(var ze=0;ze<Le;ze++)Ue[st+ze]=at}function s(Ue){return new Int32Array(Ue)}function a(Ue,st){for(var at=[],Le=0;Le<Ue;Le++)at.push(new st);return at}function o(Ue,st){var at=[];return function Le(ze,tt,Ne){for(var Ht=Ne[tt],Vt=0;Vt<Ht&&(ze.push(Ne.length>tt+1?[]:new st),!(Ne.length<tt+1));Vt++)Le(ze[Vt],tt+1,Ne)}(at,0,Ue),at}var h=function(){var Ue=this;function st(z,X){for(var E=1<<X-1>>>0;z&E;)E>>>=1;return E?(z&E-1)+E:z}function at(z,X,E,c,y){e(!(c%E));do z[X+(c-=E)]=y;while(0<c)}function Le(z,X,E,c,y){if(e(2328>=y),512>=y)var B=s(512);else if((B=s(y))==null)return 0;return function(S,F,H,j,Z,se){var he,ue,Te=F,Fe=1<<H,Ee=s(16),Oe=s(16);for(e(Z!=0),e(j!=null),e(S!=null),e(0<H),ue=0;ue<Z;++ue){if(15<j[ue])return 0;++Ee[j[ue]]}if(Ee[0]==Z)return 0;for(Oe[1]=0,he=1;15>he;++he){if(Ee[he]>1<<he)return 0;Oe[he+1]=Oe[he]+Ee[he]}for(ue=0;ue<Z;++ue)he=j[ue],0<j[ue]&&(se[Oe[he]++]=ue);if(Oe[15]==1)return(j=new ze).g=0,j.value=se[0],at(S,Te,1,Fe,j),Fe;var rt,qe=-1,Ze=Fe-1,ot=0,vt=1,kt=1,It=1<<H;for(ue=0,he=1,Z=2;he<=H;++he,Z<<=1){if(vt+=kt<<=1,0>(kt-=Ee[he]))return 0;for(;0<Ee[he];--Ee[he])(j=new ze).g=he,j.value=se[ue++],at(S,Te+ot,Z,It,j),ot=st(ot,he)}for(he=H+1,Z=2;15>=he;++he,Z<<=1){if(vt+=kt<<=1,0>(kt-=Ee[he]))return 0;for(;0<Ee[he];--Ee[he]){if(j=new ze,(ot&Ze)!=qe){for(Te+=It,rt=1<<(qe=he)-H;15>qe&&!(0>=(rt-=Ee[qe]));)++qe,rt<<=1;Fe+=It=1<<(rt=qe-H),S[F+(qe=ot&Ze)].g=rt+H,S[F+qe].value=Te-F-qe}j.g=he-H,j.value=se[ue++],at(S,Te+(ot>>H),Z,It,j),ot=st(ot,he)}}return vt!=2*Oe[15]-1?0:Fe}(z,X,E,c,y,B)}function ze(){this.value=this.g=0}function tt(){this.value=this.g=0}function Ne(){this.G=a(5,ze),this.H=s(5),this.jc=this.Qb=this.qb=this.nd=0,this.pd=a(Ps,tt)}function Ht(z,X,E,c){e(z!=null),e(X!=null),e(2147483648>c),z.Ca=254,z.I=0,z.b=-8,z.Ka=0,z.oa=X,z.pa=E,z.Jd=X,z.Yc=E+c,z.Zc=4<=c?E+c-4+1:E,qt(z)}function Vt(z,X){for(var E=0;0<X--;)E|=ar(z,128)<<X;return E}function Jt(z,X){var E=Vt(z,X);return nr(z)?-E:E}function Kt(z,X,E,c){var y,B=0;for(e(z!=null),e(X!=null),e(4294967288>c),z.Sb=c,z.Ra=0,z.u=0,z.h=0,4<c&&(c=4),y=0;y<c;++y)B+=X[E+y]<<8*y;z.Ra=B,z.bb=c,z.oa=X,z.pa=E}function er(z){for(;8<=z.u&&z.bb<z.Sb;)z.Ra>>>=8,z.Ra+=z.oa[z.pa+z.bb]<<aa-8>>>0,++z.bb,z.u-=8;Bt(z)&&(z.h=1,z.u=0)}function Xt(z,X){if(e(0<=X),!z.h&&X<=fc){var E=ut(z)&dc[X];return z.u+=X,er(z),E}return z.h=1,z.u=0}function Fr(){this.b=this.Ca=this.I=0,this.oa=[],this.pa=0,this.Jd=[],this.Yc=0,this.Zc=[],this.Ka=0}function $e(){this.Ra=0,this.oa=[],this.h=this.u=this.bb=this.Sb=this.pa=0}function ut(z){return z.Ra>>>(z.u&aa-1)>>>0}function Bt(z){return e(z.bb<=z.Sb),z.h||z.bb==z.Sb&&z.u>aa}function St(z,X){z.u=X,z.h=Bt(z)}function jt(z){z.u>=Ac&&(e(z.u>=Ac),er(z))}function qt(z){e(z!=null&&z.oa!=null),z.pa<z.Zc?(z.I=(z.oa[z.pa++]|z.I<<8)>>>0,z.b+=8):(e(z!=null&&z.oa!=null),z.pa<z.Yc?(z.b+=8,z.I=z.oa[z.pa++]|z.I<<8):z.Ka?z.b=0:(z.I<<=8,z.b+=8,z.Ka=1))}function nr(z){return Vt(z,1)}function ar(z,X){var E=z.Ca;0>z.b&&qt(z);var c=z.b,y=E*X>>>8,B=(z.I>>>c>y)+0;for(B?(E-=y,z.I-=y+1<<c>>>0):E=y+1,c=E,y=0;256<=c;)y+=8,c>>=8;return c=7^y+co[c],z.b-=c,z.Ca=(E<<c)-1,B}function $r(z,X,E){z[X+0]=E>>24&255,z[X+1]=E>>16&255,z[X+2]=E>>8&255,z[X+3]=E>>0&255}function kr(z,X){return z[X+0]<<0|z[X+1]<<8}function Gr(z,X){return kr(z,X)|z[X+2]<<16}function sn(z,X){return kr(z,X)|kr(z,X+2)<<16}function on(z,X){var E=1<<X;return e(z!=null),e(0<X),z.X=s(E),z.X==null?0:(z.Mb=32-X,z.Xa=X,1)}function pr(z,X){e(z!=null),e(X!=null),e(z.Xa==X.Xa),n(X.X,0,z.X,0,1<<X.Xa)}function We(){this.X=[],this.Xa=this.Mb=0}function Pn(z,X,E,c){e(E!=null),e(c!=null);var y=E[0],B=c[0];return y==0&&(y=(z*B+X/2)/X),B==0&&(B=(X*y+z/2)/z),0>=y||0>=B?0:(E[0]=y,c[0]=B,1)}function mn(z,X){return z+(1<<X)-1>>>X}function mr(z,X){return((4278255360&z)+(4278255360&X)>>>0&4278255360)+((16711935&z)+(16711935&X)>>>0&16711935)>>>0}function Mr(z,X){Ue[X]=function(E,c,y,B,S,F,H){var j;for(j=0;j<S;++j){var Z=Ue[z](F[H+j-1],y,B+j);F[H+j]=mr(E[c+j],Z)}}}function en(){this.ud=this.hd=this.jd=0}function Wr(z,X){return((4278124286&(z^X))>>>1)+(z&X)>>>0}function gn(z){return 0<=z&&256>z?z:0>z?0:255<z?255:void 0}function Bn(z,X){return gn(z+(z-X+.5>>1))}function Fn(z,X,E){return Math.abs(X-E)-Math.abs(z-E)}function $n(z,X,E,c,y,B,S){for(c=B[S-1],E=0;E<y;++E)B[S+E]=c=mr(z[X+E],c)}function ei(z,X,E,c,y){var B;for(B=0;B<E;++B){var S=z[X+B],F=S>>8&255,H=16711935&(H=(H=16711935&S)+((F<<16)+F));c[y+B]=(4278255360&S)+H>>>0}}function br(z,X){X.jd=z>>0&255,X.hd=z>>8&255,X.ud=z>>16&255}function Cn(z,X,E,c,y,B){var S;for(S=0;S<c;++S){var F=X[E+S],H=F>>>8,j=F,Z=255&(Z=(Z=F>>>16)+((z.jd<<24>>24)*(H<<24>>24)>>>5));j=255&(j=(j=j+((z.hd<<24>>24)*(H<<24>>24)>>>5))+((z.ud<<24>>24)*(Z<<24>>24)>>>5)),y[B+S]=(4278255360&F)+(Z<<16)+j}}function Rn(z,X,E,c,y){Ue[X]=function(B,S,F,H,j,Z,se,he,ue){for(H=se;H<he;++H)for(se=0;se<ue;++se)j[Z++]=y(F[c(B[S++])])},Ue[z]=function(B,S,F,H,j,Z,se){var he=8>>B.b,ue=B.Ea,Te=B.K[0],Fe=B.w;if(8>he)for(B=(1<<B.b)-1,Fe=(1<<he)-1;S<F;++S){var Ee,Oe=0;for(Ee=0;Ee<ue;++Ee)Ee&B||(Oe=c(H[j++])),Z[se++]=y(Te[Oe&Fe]),Oe>>=he}else Ue["VP8LMapColor"+E](H,j,Te,Fe,Z,se,S,F,ue)}}function nn(z,X,E,c,y){for(E=X+E;X<E;){var B=z[X++];c[y++]=B>>16&255,c[y++]=B>>8&255,c[y++]=B>>0&255}}function Ci(z,X,E,c,y){for(E=X+E;X<E;){var B=z[X++];c[y++]=B>>16&255,c[y++]=B>>8&255,c[y++]=B>>0&255,c[y++]=B>>24&255}}function Cr(z,X,E,c,y){for(E=X+E;X<E;){var B=(S=z[X++])>>16&240|S>>12&15,S=S>>0&240|S>>28&15;c[y++]=B,c[y++]=S}}function Tn(z,X,E,c,y){for(E=X+E;X<E;){var B=(S=z[X++])>>16&248|S>>13&7,S=S>>5&224|S>>3&31;c[y++]=B,c[y++]=S}}function Xe(z,X,E,c,y){for(E=X+E;X<E;){var B=z[X++];c[y++]=B>>0&255,c[y++]=B>>8&255,c[y++]=B>>16&255}}function He(z,X,E,c,y,B){if(B==0)for(E=X+E;X<E;)$r(c,((B=z[X++])[0]>>24|B[1]>>8&65280|B[2]<<8&16711680|B[3]<<24)>>>0),y+=32;else n(c,y,z,X,E)}function Je(z,X){Ue[X][0]=Ue[z+"0"],Ue[X][1]=Ue[z+"1"],Ue[X][2]=Ue[z+"2"],Ue[X][3]=Ue[z+"3"],Ue[X][4]=Ue[z+"4"],Ue[X][5]=Ue[z+"5"],Ue[X][6]=Ue[z+"6"],Ue[X][7]=Ue[z+"7"],Ue[X][8]=Ue[z+"8"],Ue[X][9]=Ue[z+"9"],Ue[X][10]=Ue[z+"10"],Ue[X][11]=Ue[z+"11"],Ue[X][12]=Ue[z+"12"],Ue[X][13]=Ue[z+"13"],Ue[X][14]=Ue[z+"0"],Ue[X][15]=Ue[z+"0"]}function Ve(z){return z==Vc||z==Gc||z==_u||z==Qc}function bt(){this.eb=[],this.size=this.A=this.fb=0}function Mt(){this.y=[],this.f=[],this.ea=[],this.F=[],this.Tc=this.Ed=this.Cd=this.Fd=this.lb=this.Db=this.Ab=this.fa=this.J=this.W=this.N=this.O=0}function $t(){this.Rd=this.height=this.width=this.S=0,this.f={},this.f.RGBA=new bt,this.f.kb=new Mt,this.sd=null}function Wt(){this.width=[0],this.height=[0],this.Pd=[0],this.Qd=[0],this.format=[0]}function Pe(){this.Id=this.fd=this.Md=this.hb=this.ib=this.da=this.bd=this.cd=this.j=this.v=this.Da=this.Sd=this.ob=0}function Ae(z){return alert("todo:WebPSamplerProcessPlane"),z.T}function ge(z,X){var E=z.T,c=X.ba.f.RGBA,y=c.eb,B=c.fb+z.ka*c.A,S=ni[X.ba.S],F=z.y,H=z.O,j=z.f,Z=z.N,se=z.ea,he=z.W,ue=X.cc,Te=X.dc,Fe=X.Mc,Ee=X.Nc,Oe=z.ka,rt=z.ka+z.T,qe=z.U,Ze=qe+1>>1;for(Oe==0?S(F,H,null,null,j,Z,se,he,j,Z,se,he,y,B,null,null,qe):(S(X.ec,X.fc,F,H,ue,Te,Fe,Ee,j,Z,se,he,y,B-c.A,y,B,qe),++E);Oe+2<rt;Oe+=2)ue=j,Te=Z,Fe=se,Ee=he,Z+=z.Rc,he+=z.Rc,B+=2*c.A,S(F,(H+=2*z.fa)-z.fa,F,H,ue,Te,Fe,Ee,j,Z,se,he,y,B-c.A,y,B,qe);return H+=z.fa,z.j+rt<z.o?(n(X.ec,X.fc,F,H,qe),n(X.cc,X.dc,j,Z,Ze),n(X.Mc,X.Nc,se,he,Ze),E--):1&rt||S(F,H,null,null,j,Z,se,he,j,Z,se,he,y,B+c.A,null,null,qe),E}function we(z,X,E){var c=z.F,y=[z.J];if(c!=null){var B=z.U,S=X.ba.S,F=S==zu||S==_u;X=X.ba.f.RGBA;var H=[0],j=z.ka;H[0]=z.T,z.Kb&&(j==0?--H[0]:(--j,y[0]-=z.width),z.j+z.ka+z.T==z.o&&(H[0]=z.o-z.j-j));var Z=X.eb;j=X.fb+j*X.A,z=vl(c,y[0],z.width,B,H,Z,j+(F?0:3),X.A),e(E==H),z&&Ve(S)&&Ja(Z,j,F,B,H,X.A)}return 0}function Se(z){var X=z.ma,E=X.ba.S,c=11>E,y=E==Hc||E==_c||E==zu||E==ph||E==12||Ve(E);if(X.memory=null,X.Ib=null,X.Jb=null,X.Nd=null,!Wa(X.Oa,z,y?11:12))return 0;if(y&&Ve(E)&&Xr(),z.da)alert("todo:use_scaling");else{if(c){if(X.Ib=Ae,z.Kb){if(E=z.U+1>>1,X.memory=s(z.U+2*E),X.memory==null)return 0;X.ec=X.memory,X.fc=0,X.cc=X.ec,X.dc=X.fc+z.U,X.Mc=X.cc,X.Nc=X.dc+E,X.Ib=ge,Xr()}}else alert("todo:EmitYUV");y&&(X.Jb=we,c&&rr())}if(c&&!Fi){for(z=0;256>z;++z)un[z]=89858*(z-128)+Bu>>Gh,wf[z]=-22014*(z-128)+Bu,bc[z]=-45773*(z-128),$h[z]=113618*(z-128)+Bu>>Gh;for(z=Cu;z<Qh;++z)X=76283*(z-16)+Bu>>Gh,$c[z-Cu]=vi(X,255),Bl[z-Cu]=vi(X+8>>4,15);Fi=1}return 1}function ht(z){var X=z.ma,E=z.U,c=z.T;return e(!(1&z.ka)),0>=E||0>=c?0:(E=X.Ib(z,X),X.Jb!=null&&X.Jb(z,X,E),X.Dc+=E,1)}function At(z){z.ma.memory=null}function _t(z,X,E,c){return Xt(z,8)!=47?0:(X[0]=Xt(z,14)+1,E[0]=Xt(z,14)+1,c[0]=Xt(z,1),Xt(z,3)!=0?0:!z.h)}function dt(z,X){if(4>z)return z+1;var E=z-2>>1;return(2+(1&z)<<E)+Xt(X,E)+1}function yt(z,X){return 120<X?X-120:1<=(E=((E=Hs[X-1])>>4)*z+(8-(15&E)))?E:1;var E}function Nt(z,X,E){var c=ut(E),y=z[X+=255&c].g-8;return 0<y&&(St(E,E.u+8),c=ut(E),X+=z[X].value,X+=c&(1<<y)-1),St(E,E.u+z[X].g),z[X].value}function Rt(z,X,E){return E.g+=z.g,E.value+=z.value<<X>>>0,e(8>=E.g),z.g}function dr(z,X,E){var c=z.xc;return e((X=c==0?0:z.vc[z.md*(E>>c)+(X>>c)])<z.Wb),z.Ya[X]}function zr(z,X,E,c){var y=z.ab,B=z.c*X,S=z.C;X=S+X;var F=E,H=c;for(c=z.Ta,E=z.Ua;0<y--;){var j=z.gc[y],Z=S,se=X,he=F,ue=H,Te=(H=c,F=E,j.Ea);switch(e(Z<se),e(se<=j.nc),j.hc){case 2:Bi(he,ue,(se-Z)*Te,H,F);break;case 0:var Fe=Z,Ee=se,Oe=H,rt=F,qe=(It=j).Ea;Fe==0&&(Ea(he,ue,null,null,1,Oe,rt),$n(he,ue+1,0,0,qe-1,Oe,rt+1),ue+=qe,rt+=qe,++Fe);for(var Ze=1<<It.b,ot=Ze-1,vt=mn(qe,It.b),kt=It.K,It=It.w+(Fe>>It.b)*vt;Fe<Ee;){var ur=kt,wr=It,Dr=1;for(Hl(he,ue,Oe,rt-qe,1,Oe,rt);Dr<qe;){var Or=(Dr&~ot)+Ze;Or>qe&&(Or=qe),(0,xi[ur[wr++]>>8&15])(he,ue+ +Dr,Oe,rt+Dr-qe,Or-Dr,Oe,rt+Dr),Dr=Or}ue+=qe,rt+=qe,++Fe&ot||(It+=vt)}se!=j.nc&&n(H,F-Te,H,F+(se-Z-1)*Te,Te);break;case 1:for(Te=he,Ee=ue,qe=(he=j.Ea)-(rt=he&~(Oe=(ue=1<<j.b)-1)),Fe=mn(he,j.b),Ze=j.K,j=j.w+(Z>>j.b)*Fe;Z<se;){for(ot=Ze,vt=j,kt=new en,It=Ee+rt,ur=Ee+he;Ee<It;)br(ot[vt++],kt),Jo(kt,Te,Ee,ue,H,F),Ee+=ue,F+=ue;Ee<ur&&(br(ot[vt++],kt),Jo(kt,Te,Ee,qe,H,F),Ee+=qe,F+=qe),++Z&Oe||(j+=Fe)}break;case 3:if(he==H&&ue==F&&0<j.b){for(Ee=H,he=Te=F+(se-Z)*Te-(rt=(se-Z)*mn(j.Ea,j.b)),ue=H,Oe=F,Fe=[],rt=(qe=rt)-1;0<=rt;--rt)Fe[rt]=ue[Oe+rt];for(rt=qe-1;0<=rt;--rt)Ee[he+rt]=Fe[rt];Xo(j,Z,se,H,Te,H,F)}else Xo(j,Z,se,he,ue,H,F)}F=c,H=E}H!=E&&n(c,E,F,H,B)}function Pr(z,X){var E=z.V,c=z.Ba+z.c*z.C,y=X-z.C;if(e(X<=z.l.o),e(16>=y),0<y){var B=z.l,S=z.Ta,F=z.Ua,H=B.width;if(zr(z,y,E,c),y=F=[F],e((E=z.C)<(c=X)),e(B.v<B.va),c>B.o&&(c=B.o),E<B.j){var j=B.j-E;E=B.j,y[0]+=j*H}if(E>=c?E=0:(y[0]+=4*B.v,B.ka=E-B.j,B.U=B.va-B.v,B.T=c-E,E=1),E){if(F=F[0],11>(E=z.ca).S){var Z=E.f.RGBA,se=(c=E.S,y=B.U,B=B.T,j=Z.eb,Z.A),he=B;for(Z=Z.fb+z.Ma*Z.A;0<he--;){var ue=S,Te=F,Fe=y,Ee=j,Oe=Z;switch(c){case zc:Ta(ue,Te,Fe,Ee,Oe);break;case Hc:_l(ue,Te,Fe,Ee,Oe);break;case Vc:_l(ue,Te,Fe,Ee,Oe),Ja(Ee,Oe,0,Fe,1,0);break;case wd:la(ue,Te,Fe,Ee,Oe);break;case _c:He(ue,Te,Fe,Ee,Oe,1);break;case Gc:He(ue,Te,Fe,Ee,Oe,1),Ja(Ee,Oe,0,Fe,1,0);break;case zu:He(ue,Te,Fe,Ee,Oe,0);break;case _u:He(ue,Te,Fe,Ee,Oe,0),Ja(Ee,Oe,1,Fe,1,0);break;case ph:Bo(ue,Te,Fe,Ee,Oe);break;case Qc:Bo(ue,Te,Fe,Ee,Oe),xs(Ee,Oe,Fe,1,0);break;case Gl:yl(ue,Te,Fe,Ee,Oe);break;default:e(0)}F+=H,Z+=se}z.Ma+=B}else alert("todo:EmitRescaledRowsYUVA");e(z.Ma<=E.height)}}z.C=X,e(z.C<=z.i)}function Rr(z){var X;if(0<z.ua)return 0;for(X=0;X<z.Wb;++X){var E=z.Ya[X].G,c=z.Ya[X].H;if(0<E[1][c[1]+0].g||0<E[2][c[2]+0].g||0<E[3][c[3]+0].g)return 0}return 1}function ln(z,X,E,c,y,B){if(z.Z!=0){var S=z.qd,F=z.rd;for(e($l[z.Z]!=null);X<E;++X)$l[z.Z](S,F,c,y,c,y,B),S=c,F=y,y+=B;z.qd=S,z.rd=F}}function Jn(z,X){var E=z.l.ma,c=E.Z==0||E.Z==1?z.l.j:z.C;if(c=z.C<c?c:z.C,e(X<=z.l.o),X>c){var y=z.l.width,B=E.ca,S=E.tb+y*c,F=z.V,H=z.Ba+z.c*c,j=z.gc;e(z.ab==1),e(j[0].hc==3),vd(j[0],c,X,F,H,B,S),ln(E,c,X,B,S,y)}z.C=z.Ma=X}function _n(z,X,E,c,y,B,S){var F=z.$/c,H=z.$%c,j=z.m,Z=z.s,se=E+z.$,he=se;y=E+c*y;var ue=E+c*B,Te=280+Z.ua,Fe=z.Pb?F:16777216,Ee=0<Z.ua?Z.Wa:null,Oe=Z.wc,rt=se<ue?dr(Z,H,F):null;e(z.C<B),e(ue<=y);var qe=!1;e:for(;;){for(;qe||se<ue;){var Ze=0;if(F>=Fe){var ot=se-E;e((Fe=z).Pb),Fe.wd=Fe.m,Fe.xd=ot,0<Fe.s.ua&&pr(Fe.s.Wa,Fe.s.vb),Fe=F+Hh}if(H&Oe||(rt=dr(Z,H,F)),e(rt!=null),rt.Qb&&(X[se]=rt.qb,qe=!0),!qe)if(jt(j),rt.jc){Ze=j,ot=X;var vt=se,kt=rt.pd[ut(Ze)&Ps-1];e(rt.jc),256>kt.g?(St(Ze,Ze.u+kt.g),ot[vt]=kt.value,Ze=0):(St(Ze,Ze.u+kt.g-256),e(256<=kt.value),Ze=kt.value),Ze==0&&(qe=!0)}else Ze=Nt(rt.G[0],rt.H[0],j);if(j.h)break;if(qe||256>Ze){if(!qe)if(rt.nd)X[se]=(rt.qb|Ze<<8)>>>0;else{if(jt(j),qe=Nt(rt.G[1],rt.H[1],j),jt(j),ot=Nt(rt.G[2],rt.H[2],j),vt=Nt(rt.G[3],rt.H[3],j),j.h)break;X[se]=(vt<<24|qe<<16|Ze<<8|ot)>>>0}if(qe=!1,++se,++H>=c&&(H=0,++F,S!=null&&F<=B&&!(F%16)&&S(z,F),Ee!=null))for(;he<se;)Ze=X[he++],Ee.X[(506832829*Ze&4294967295)>>>Ee.Mb]=Ze}else if(280>Ze){if(Ze=dt(Ze-256,j),ot=Nt(rt.G[4],rt.H[4],j),jt(j),ot=yt(c,ot=dt(ot,j)),j.h)break;if(se-E<ot||y-se<Ze)break e;for(vt=0;vt<Ze;++vt)X[se+vt]=X[se+vt-ot];for(se+=Ze,H+=Ze;H>=c;)H-=c,++F,S!=null&&F<=B&&!(F%16)&&S(z,F);if(e(se<=y),H&Oe&&(rt=dr(Z,H,F)),Ee!=null)for(;he<se;)Ze=X[he++],Ee.X[(506832829*Ze&4294967295)>>>Ee.Mb]=Ze}else{if(!(Ze<Te))break e;for(qe=Ze-280,e(Ee!=null);he<se;)Ze=X[he++],Ee.X[(506832829*Ze&4294967295)>>>Ee.Mb]=Ze;Ze=se,e(!(qe>>>(ot=Ee).Xa)),X[Ze]=ot.X[qe],qe=!0}qe||e(j.h==Bt(j))}if(z.Pb&&j.h&&se<y)e(z.m.h),z.a=5,z.m=z.wd,z.$=z.xd,0<z.s.ua&&pr(z.s.vb,z.s.Wa);else{if(j.h)break e;S!=null&&S(z,F>B?B:F),z.a=0,z.$=se-E}return 1}return z.a=3,0}function jn(z){e(z!=null),z.vc=null,z.yc=null,z.Ya=null;var X=z.Wa;X!=null&&(X.X=null),z.vb=null,e(z!=null)}function Gn(){var z=new Dc;return z==null?null:(z.a=0,z.xb=xu,Je("Predictor","VP8LPredictors"),Je("Predictor","VP8LPredictors_C"),Je("PredictorAdd","VP8LPredictorsAdd"),Je("PredictorAdd","VP8LPredictorsAdd_C"),Bi=ei,Jo=Cn,Ta=nn,_l=Ci,Bo=Cr,yl=Tn,la=Xe,Ue.VP8LMapColor32b=pc,Ue.VP8LMapColor8b=Ah,z)}function Ln(z,X,E,c,y){var B=1,S=[z],F=[X],H=c.m,j=c.s,Z=null,se=0;e:for(;;){if(E)for(;B&&Xt(H,1);){var he=S,ue=F,Te=c,Fe=1,Ee=Te.m,Oe=Te.gc[Te.ab],rt=Xt(Ee,2);if(Te.Oc&1<<rt)B=0;else{switch(Te.Oc|=1<<rt,Oe.hc=rt,Oe.Ea=he[0],Oe.nc=ue[0],Oe.K=[null],++Te.ab,e(4>=Te.ab),rt){case 0:case 1:Oe.b=Xt(Ee,3)+2,Fe=Ln(mn(Oe.Ea,Oe.b),mn(Oe.nc,Oe.b),0,Te,Oe.K),Oe.K=Oe.K[0];break;case 3:var qe,Ze=Xt(Ee,8)+1,ot=16<Ze?0:4<Ze?1:2<Ze?2:3;if(he[0]=mn(Oe.Ea,ot),Oe.b=ot,qe=Fe=Ln(Ze,1,0,Te,Oe.K)){var vt,kt=Ze,It=Oe,ur=1<<(8>>It.b),wr=s(ur);if(wr==null)qe=0;else{var Dr=It.K[0],Or=It.w;for(wr[0]=It.K[0][0],vt=1;vt<1*kt;++vt)wr[vt]=mr(Dr[Or+vt],wr[vt-1]);for(;vt<4*ur;++vt)wr[vt]=0;It.K[0]=null,It.K[0]=wr,qe=1}}Fe=qe;break;case 2:break;default:e(0)}B=Fe}}if(S=S[0],F=F[0],B&&Xt(H,1)&&!(B=1<=(se=Xt(H,4))&&11>=se)){c.a=3;break e}var _r;if(_r=B)t:{var xr,Vr,xn,Qr=c,jr=S,In=F,Hn=se,Qn=E,Zn=Qr.m,ui=Qr.s,Ii=[null],cs=1,mi=0,qi=xl[Hn];r:for(;;){if(Qn&&Xt(Zn,1)){var Di=Xt(Zn,3)+2,us=mn(jr,Di),ns=mn(In,Di),Uo=us*ns;if(!Ln(us,ns,0,Qr,Ii))break r;for(Ii=Ii[0],ui.xc=Di,xr=0;xr<Uo;++xr){var da=Ii[xr]>>8&65535;Ii[xr]=da,da>=cs&&(cs=da+1)}}if(Zn.h)break r;for(Vr=0;5>Vr;++Vr){var Ki=yu[Vr];!Vr&&0<Hn&&(Ki+=1<<Hn),mi<Ki&&(mi=Ki)}var vc=a(cs*qi,ze),D=cs,l=a(D,Ne);if(l==null)var m=null;else e(65536>=D),m=l;var w=s(mi);if(m==null||w==null||vc==null){Qr.a=1;break r}var P=vc;for(xr=xn=0;xr<cs;++xr){var O=m[xr],G=O.G,J=O.H,re=0,oe=1,pe=0;for(Vr=0;5>Vr;++Vr){Ki=yu[Vr],G[Vr]=P,J[Vr]=xn,!Vr&&0<Hn&&(Ki+=1<<Hn);i:{var Ce,Me=Ki,Ke=Qr,Ye=w,gt=P,ft=xn,mt=0,xt=Ke.m,Ft=Xt(xt,1);if(i(Ye,0,0,Me),Ft){var Dt=Xt(xt,1)+1,Ut=Xt(xt,1),Gt=Xt(xt,Ut==0?1:8);Ye[Gt]=1,Dt==2&&(Ye[Gt=Xt(xt,8)]=1);var zt=1}else{var ir=s(19),sr=Xt(xt,4)+4;if(19<sr){Ke.a=3;var gr=0;break i}for(Ce=0;Ce<sr;++Ce)ir[bu[Ce]]=Xt(xt,3);var Er=void 0,fr=void 0,qr=Ke,Jr=ir,Sr=Me,tn=Ye,Yn=0,oi=qr.m,ws=8,Oi=a(128,ze);n:for(;Le(Oi,0,7,Jr,19);){if(Xt(oi,1)){var Gs=2+2*Xt(oi,3);if((Er=2+Xt(oi,Gs))>Sr)break n}else Er=Sr;for(fr=0;fr<Sr&&Er--;){jt(oi);var Wi=Oi[0+(127&ut(oi))];St(oi,oi.u+Wi.g);var ti=Wi.value;if(16>ti)tn[fr++]=ti,ti!=0&&(ws=ti);else{var Xi=ti==16,No=ti-16,Rs=zh[No],Bs=Xt(oi,Hu[No])+Rs;if(fr+Bs>Sr)break n;for(var ea=Xi?ws:0;0<Bs--;)tn[fr++]=ea}}Yn=1;break n}Yn||(qr.a=3),zt=Yn}(zt=zt&&!xt.h)&&(mt=Le(gt,ft,8,Ye,Me)),zt&&mt!=0?gr=mt:(Ke.a=3,gr=0)}if(gr==0)break r;if(oe&&Qi[Vr]==1&&(oe=P[xn].g==0),re+=P[xn].g,xn+=gr,3>=Vr){var tl,jl=w[0];for(tl=1;tl<Ki;++tl)w[tl]>jl&&(jl=w[tl]);pe+=jl}}if(O.nd=oe,O.Qb=0,oe&&(O.qb=(G[3][J[3]+0].value<<24|G[1][J[1]+0].value<<16|G[2][J[2]+0].value)>>>0,re==0&&256>G[0][J[0]+0].value&&(O.Qb=1,O.qb+=G[0][J[0]+0].value<<8)),O.jc=!O.Qb&&6>pe,O.jc){var Ma,ta=O;for(Ma=0;Ma<Ps;++Ma){var xc=Ma,El=ta.pd[xc],Qu=ta.G[0][ta.H[0]+xc];256<=Qu.value?(El.g=Qu.g+256,El.value=Qu.value):(El.g=0,El.value=0,xc>>=Rt(Qu,8,El),xc>>=Rt(ta.G[1][ta.H[1]+xc],16,El),xc>>=Rt(ta.G[2][ta.H[2]+xc],0,El),Rt(ta.G[3][ta.H[3]+xc],24,El))}}}ui.vc=Ii,ui.Wb=cs,ui.Ya=m,ui.yc=vc,_r=1;break t}_r=0}if(!(B=_r)){c.a=3;break e}if(0<se){if(j.ua=1<<se,!on(j.Wa,se)){c.a=1,B=0;break e}}else j.ua=0;var ra=c,Tl=S,ql=F,Io=ra.s,Ji=Io.xc;if(ra.c=Tl,ra.i=ql,Io.md=mn(Tl,Ji),Io.wc=Ji==0?-1:(1<<Ji)-1,E){c.xb=Vu;break e}if((Z=s(S*F))==null){c.a=1,B=0;break e}B=(B=_n(c,Z,0,S,F,F,null))&&!H.h;break e}return B?(y!=null?y[0]=Z:(e(Z==null),e(E)),c.$=0,E||jn(j)):jn(j),B}function Un(z,X){var E=z.c*z.i,c=E+X+16*X;return e(z.c<=X),z.V=s(c),z.V==null?(z.Ta=null,z.Ua=0,z.a=1,0):(z.Ta=z.V,z.Ua=z.Ba+E+X,1)}function Ei(z,X){var E=z.C,c=X-E,y=z.V,B=z.Ba+z.c*E;for(e(X<=z.l.o);0<c;){var S=16<c?16:c,F=z.l.ma,H=z.l.width,j=H*S,Z=F.ca,se=F.tb+H*E,he=z.Ta,ue=z.Ua;zr(z,S,y,B),vf(he,ue,Z,se,j),ln(F,E,E+S,Z,se,H),c-=S,y+=S*z.c,E+=S}e(E==X),z.C=z.Ma=X}function zi(){this.ub=this.yd=this.td=this.Rb=0}function Pt(){this.Kd=this.Ld=this.Ud=this.Td=this.i=this.c=0}function Zr(){this.Fb=this.Bb=this.Cb=0,this.Zb=s(4),this.Lb=s(4)}function Ur(){this.Yb=function(){var z=[];return function X(E,c,y){for(var B=y[c],S=0;S<B&&(E.push(y.length>c+1?[]:0),!(y.length<c+1));S++)X(E[S],c+1,y)}(z,0,[3,11]),z}()}function On(){this.jb=s(3),this.Wc=o([4,8],Ur),this.Xc=o([4,17],Ur)}function di(){this.Pc=this.wb=this.Tb=this.zd=0,this.vd=new s(4),this.od=new s(4)}function ks(){this.ld=this.La=this.dd=this.tc=0}function bi(){this.Na=this.la=0}function bs(){this.Sc=[0,0],this.Eb=[0,0],this.Qc=[0,0],this.ia=this.lc=0}function jo(){this.ad=s(384),this.Za=0,this.Ob=s(16),this.$b=this.Ad=this.ia=this.Gc=this.Hc=this.Dd=0}function Ks(){this.uc=this.M=this.Nb=0,this.wa=Array(new ks),this.Y=0,this.ya=Array(new jo),this.aa=0,this.l=new wa}function Hi(){this.y=s(16),this.f=s(8),this.ea=s(8)}function Mc(){this.cb=this.a=0,this.sc="",this.m=new Fr,this.Od=new zi,this.Kc=new Pt,this.ed=new di,this.Qa=new Zr,this.Ic=this.$c=this.Aa=0,this.D=new Ks,this.Xb=this.Va=this.Hb=this.zb=this.yb=this.Ub=this.za=0,this.Jc=a(8,Fr),this.ia=0,this.pb=a(4,bs),this.Pa=new On,this.Bd=this.kc=0,this.Ac=[],this.Bc=0,this.zc=[0,0,0,0],this.Gd=Array(new Hi),this.Hd=0,this.rb=Array(new bi),this.sb=0,this.wa=Array(new ks),this.Y=0,this.oc=[],this.pc=0,this.sa=[],this.ta=0,this.qa=[],this.ra=0,this.Ha=[],this.B=this.R=this.Ia=0,this.Ec=[],this.M=this.ja=this.Vb=this.Fc=0,this.ya=Array(new jo),this.L=this.aa=0,this.gd=o([4,2],ks),this.ga=null,this.Fa=[],this.Cc=this.qc=this.P=0,this.Gb=[],this.Uc=0,this.mb=[],this.nb=0,this.rc=[],this.Ga=this.Vc=0}function wa(){this.T=this.U=this.ka=this.height=this.width=0,this.y=[],this.f=[],this.ea=[],this.Rc=this.fa=this.W=this.N=this.O=0,this.ma="void",this.put="VP8IoPutHook",this.ac="VP8IoSetupHook",this.bc="VP8IoTeardownHook",this.ha=this.Kb=0,this.data=[],this.hb=this.ib=this.da=this.o=this.j=this.va=this.v=this.Da=this.ob=this.w=0,this.F=[],this.J=0}function ts(){var z=new Mc;return z!=null&&(z.a=0,z.sc="OK",z.cb=0,z.Xb=0,yc||(yc=Pc)),z}function ss(z,X,E){return z.a==0&&(z.a=X,z.sc=E,z.cb=0),0}function sa(z,X,E){return 3<=E&&z[X+0]==157&&z[X+1]==1&&z[X+2]==42}function Vi(z,X){if(z==null)return 0;if(z.a=0,z.sc="OK",X==null)return ss(z,2,"null VP8Io passed to VP8GetHeaders()");var E=X.data,c=X.w,y=X.ha;if(4>y)return ss(z,7,"Truncated header.");var B=E[c+0]|E[c+1]<<8|E[c+2]<<16,S=z.Od;if(S.Rb=!(1&B),S.td=B>>1&7,S.yd=B>>4&1,S.ub=B>>5,3<S.td)return ss(z,3,"Incorrect keyframe parameters.");if(!S.yd)return ss(z,4,"Frame not displayable.");c+=3,y-=3;var F=z.Kc;if(S.Rb){if(7>y)return ss(z,7,"cannot parse picture header");if(!sa(E,c,y))return ss(z,3,"Bad code word");F.c=16383&(E[c+4]<<8|E[c+3]),F.Td=E[c+4]>>6,F.i=16383&(E[c+6]<<8|E[c+5]),F.Ud=E[c+6]>>6,c+=7,y-=7,z.za=F.c+15>>4,z.Ub=F.i+15>>4,X.width=F.c,X.height=F.i,X.Da=0,X.j=0,X.v=0,X.va=X.width,X.o=X.height,X.da=0,X.ib=X.width,X.hb=X.height,X.U=X.width,X.T=X.height,i((B=z.Pa).jb,0,255,B.jb.length),e((B=z.Qa)!=null),B.Cb=0,B.Bb=0,B.Fb=1,i(B.Zb,0,0,B.Zb.length),i(B.Lb,0,0,B.Lb)}if(S.ub>y)return ss(z,7,"bad partition length");Ht(B=z.m,E,c,S.ub),c+=S.ub,y-=S.ub,S.Rb&&(F.Ld=nr(B),F.Kd=nr(B)),F=z.Qa;var H,j=z.Pa;if(e(B!=null),e(F!=null),F.Cb=nr(B),F.Cb){if(F.Bb=nr(B),nr(B)){for(F.Fb=nr(B),H=0;4>H;++H)F.Zb[H]=nr(B)?Jt(B,7):0;for(H=0;4>H;++H)F.Lb[H]=nr(B)?Jt(B,6):0}if(F.Bb)for(H=0;3>H;++H)j.jb[H]=nr(B)?Vt(B,8):255}else F.Bb=0;if(B.Ka)return ss(z,3,"cannot parse segment header");if((F=z.ed).zd=nr(B),F.Tb=Vt(B,6),F.wb=Vt(B,3),F.Pc=nr(B),F.Pc&&nr(B)){for(j=0;4>j;++j)nr(B)&&(F.vd[j]=Jt(B,6));for(j=0;4>j;++j)nr(B)&&(F.od[j]=Jt(B,6))}if(z.L=F.Tb==0?0:F.zd?1:2,B.Ka)return ss(z,3,"cannot parse filter header");var Z=y;if(y=H=c,c=H+Z,F=Z,z.Xb=(1<<Vt(z.m,2))-1,Z<3*(j=z.Xb))E=7;else{for(H+=3*j,F-=3*j,Z=0;Z<j;++Z){var se=E[y+0]|E[y+1]<<8|E[y+2]<<16;se>F&&(se=F),Ht(z.Jc[+Z],E,H,se),H+=se,F-=se,y+=3}Ht(z.Jc[+j],E,H,F),E=H<c?0:5}if(E!=0)return ss(z,E,"cannot parse partitions");for(E=Vt(H=z.m,7),y=nr(H)?Jt(H,4):0,c=nr(H)?Jt(H,4):0,F=nr(H)?Jt(H,4):0,j=nr(H)?Jt(H,4):0,H=nr(H)?Jt(H,4):0,Z=z.Qa,se=0;4>se;++se){if(Z.Cb){var he=Z.Zb[se];Z.Fb||(he+=E)}else{if(0<se){z.pb[se]=z.pb[0];continue}he=E}var ue=z.pb[se];ue.Sc[0]=Sa[vi(he+y,127)],ue.Sc[1]=Ia[vi(he+0,127)],ue.Eb[0]=2*Sa[vi(he+c,127)],ue.Eb[1]=101581*Ia[vi(he+F,127)]>>16,8>ue.Eb[1]&&(ue.Eb[1]=8),ue.Qc[0]=Sa[vi(he+j,117)],ue.Qc[1]=Ia[vi(he+H,127)],ue.lc=he+H}if(!S.Rb)return ss(z,4,"Not a key frame.");for(nr(B),S=z.Pa,E=0;4>E;++E){for(y=0;8>y;++y)for(c=0;3>c;++c)for(F=0;11>F;++F)j=ar(B,Za[E][y][c][F])?Vt(B,8):Vh[E][y][c][F],S.Wc[E][y].Yb[c][F]=j;for(y=0;17>y;++y)S.Xc[E][y]=S.Wc[E][pn[y]]}return z.kc=nr(B),z.kc&&(z.Bd=Vt(B,8)),z.cb=1}function Pc(z,X,E,c,y,B,S){var F=X[y].Yb[E];for(E=0;16>y;++y){if(!ar(z,F[E+0]))return y;for(;!ar(z,F[E+1]);)if(F=X[++y].Yb[0],E=0,y==16)return 16;var H=X[y+1].Yb;if(ar(z,F[E+2])){var j=z,Z=0;if(ar(j,(he=F)[(se=E)+3]))if(ar(j,he[se+6])){for(F=0,se=2*(Z=ar(j,he[se+8]))+(he=ar(j,he[se+9+Z])),Z=0,he=Bd[se];he[F];++F)Z+=Z+ar(j,he[F]);Z+=3+(8<<se)}else ar(j,he[se+7])?(Z=7+2*ar(j,165),Z+=ar(j,145)):Z=5+ar(j,159);else Z=ar(j,he[se+4])?3+ar(j,he[se+5]):2;F=H[2]}else Z=1,F=H[1];H=S+gh[y],0>(j=z).b&&qt(j);var se,he=j.b,ue=(se=j.Ca>>1)-(j.I>>he)>>31;--j.b,j.Ca+=ue,j.Ca|=1,j.I-=(se+1&ue)<<he,B[H]=((Z^ue)-ue)*c[(0<y)+0]}return 16}function vo(z){var X=z.rb[z.sb-1];X.la=0,X.Na=0,i(z.zc,0,0,z.zc.length),z.ja=0}function uh(z,X){if(z==null)return 0;if(X==null)return ss(z,2,"NULL VP8Io parameter in VP8Decode().");if(!z.cb&&!Vi(z,X))return 0;if(e(z.cb),X.ac==null||X.ac(X)){X.ob&&(z.L=0);var E=ci[z.L];if(z.L==2?(z.yb=0,z.zb=0):(z.yb=X.v-E>>4,z.zb=X.j-E>>4,0>z.yb&&(z.yb=0),0>z.zb&&(z.zb=0)),z.Va=X.o+15+E>>4,z.Hb=X.va+15+E>>4,z.Hb>z.za&&(z.Hb=z.za),z.Va>z.Ub&&(z.Va=z.Ub),0<z.L){var c=z.ed;for(E=0;4>E;++E){var y;if(z.Qa.Cb){var B=z.Qa.Lb[E];z.Qa.Fb||(B+=c.Tb)}else B=c.Tb;for(y=0;1>=y;++y){var S=z.gd[E][y],F=B;if(c.Pc&&(F+=c.vd[0],y&&(F+=c.od[0])),0<(F=0>F?0:63<F?63:F)){var H=F;0<c.wb&&(H=4<c.wb?H>>2:H>>1)>9-c.wb&&(H=9-c.wb),1>H&&(H=1),S.dd=H,S.tc=2*F+H,S.ld=40<=F?2:15<=F?1:0}else S.tc=0;S.La=y}}}E=0}else ss(z,6,"Frame setup failed"),E=z.a;if(E=E==0){if(E){z.$c=0,0<z.Aa||(z.Ic=Wn);e:{E=z.Ic,c=4*(H=z.za);var j=32*H,Z=H+1,se=0<z.L?H*(0<z.Aa?2:1):0,he=(z.Aa==2?2:1)*H;if((S=c+832+(y=3*(16*E+ci[z.L])/2*j)+(B=z.Fa!=null&&0<z.Fa.length?z.Kc.c*z.Kc.i:0))!=S)E=0;else{if(S>z.Vb){if(z.Vb=0,z.Ec=s(S),z.Fc=0,z.Ec==null){E=ss(z,1,"no memory during frame initialization.");break e}z.Vb=S}S=z.Ec,F=z.Fc,z.Ac=S,z.Bc=F,F+=c,z.Gd=a(j,Hi),z.Hd=0,z.rb=a(Z+1,bi),z.sb=1,z.wa=se?a(se,ks):null,z.Y=0,z.D.Nb=0,z.D.wa=z.wa,z.D.Y=z.Y,0<z.Aa&&(z.D.Y+=H),e(!0),z.oc=S,z.pc=F,F+=832,z.ya=a(he,jo),z.aa=0,z.D.ya=z.ya,z.D.aa=z.aa,z.Aa==2&&(z.D.aa+=H),z.R=16*H,z.B=8*H,H=(j=ci[z.L])*z.R,j=j/2*z.B,z.sa=S,z.ta=F+H,z.qa=z.sa,z.ra=z.ta+16*E*z.R+j,z.Ha=z.qa,z.Ia=z.ra+8*E*z.B+j,z.$c=0,F+=y,z.mb=B?S:null,z.nb=B?F:null,e(F+B<=z.Fc+z.Vb),vo(z),i(z.Ac,z.Bc,0,c),E=1}}if(E){if(X.ka=0,X.y=z.sa,X.O=z.ta,X.f=z.qa,X.N=z.ra,X.ea=z.Ha,X.Vd=z.Ia,X.fa=z.R,X.Rc=z.B,X.F=null,X.J=0,!Nc){for(E=-255;255>=E;++E)xd[255+E]=0>E?-E:E;for(E=-1020;1020>=E;++E)Ns[1020+E]=-128>E?-128:127<E?127:E;for(E=-112;112>=E;++E)ha[112+E]=-16>E?-16:15<E?15:E;for(E=-255;510>=E;++E)ko[255+E]=0>E?0:255<E?255:E;Nc=1}Oo=fs,Co=yn,bl=Fc,Eo=hh,uo=$a,kc=lo,ca=Au,Vl=Ca,Zo=Uu,ua=gu,Uc=Nh,ho=pu,Yo=fh,ls=mu,ji=oa,Kn=Sn,Fs=Ko,Xa=Ka,To[0]=to,To[1]=Gi,To[2]=Ro,To[3]=hu,To[4]=du,To[5]=Ol,To[6]=Li,To[7]=Ai,To[8]=ku,To[9]=si,Ya[0]=oc,Ya[1]=Us,Ya[2]=vs,Ya[3]=eo,Ya[4]=ai,Ya[5]=Dl,Ya[6]=ps,Ql[0]=Ba,Ql[1]=uu,Ql[2]=wi,Ql[3]=kl,Ql[4]=ja,Ql[5]=ac,Ql[6]=qa,E=1}else E=0}E&&(E=function(ue,Te){for(ue.M=0;ue.M<ue.Va;++ue.M){var Fe,Ee=ue.Jc[ue.M&ue.Xb],Oe=ue.m,rt=ue;for(Fe=0;Fe<rt.za;++Fe){var qe=Oe,Ze=rt,ot=Ze.Ac,vt=Ze.Bc+4*Fe,kt=Ze.zc,It=Ze.ya[Ze.aa+Fe];if(Ze.Qa.Bb?It.$b=ar(qe,Ze.Pa.jb[0])?2+ar(qe,Ze.Pa.jb[2]):ar(qe,Ze.Pa.jb[1]):It.$b=0,Ze.kc&&(It.Ad=ar(qe,Ze.Bd)),It.Za=!ar(qe,145)+0,It.Za){var ur=It.Ob,wr=0;for(Ze=0;4>Ze;++Ze){var Dr,Or=kt[0+Ze];for(Dr=0;4>Dr;++Dr){Or=vu[ot[vt+Dr]][Or];for(var _r=Cd[ar(qe,Or[0])];0<_r;)_r=Cd[2*_r+ar(qe,Or[_r])];Or=-_r,ot[vt+Dr]=Or}n(ur,wr,ot,vt,4),wr+=4,kt[0+Ze]=Or}}else Or=ar(qe,156)?ar(qe,128)?1:3:ar(qe,163)?2:0,It.Ob[0]=Or,i(ot,vt,Or,4),i(kt,0,Or,4);It.Dd=ar(qe,142)?ar(qe,114)?ar(qe,183)?1:3:2:0}if(rt.m.Ka)return ss(ue,7,"Premature end-of-partition0 encountered.");for(;ue.ja<ue.za;++ue.ja){if(rt=Ee,qe=(Oe=ue).rb[Oe.sb-1],ot=Oe.rb[Oe.sb+Oe.ja],Fe=Oe.ya[Oe.aa+Oe.ja],vt=Oe.kc?Fe.Ad:0)qe.la=ot.la=0,Fe.Za||(qe.Na=ot.Na=0),Fe.Hc=0,Fe.Gc=0,Fe.ia=0;else{var xr,Vr;if(qe=ot,ot=rt,vt=Oe.Pa.Xc,kt=Oe.ya[Oe.aa+Oe.ja],It=Oe.pb[kt.$b],Ze=kt.ad,ur=0,wr=Oe.rb[Oe.sb-1],Or=Dr=0,i(Ze,ur,0,384),kt.Za)var xn=0,Qr=vt[3];else{_r=s(16);var jr=qe.Na+wr.Na;if(jr=yc(ot,vt[1],jr,It.Eb,0,_r,0),qe.Na=wr.Na=(0<jr)+0,1<jr)Oo(_r,0,Ze,ur);else{var In=_r[0]+3>>3;for(_r=0;256>_r;_r+=16)Ze[ur+_r]=In}xn=1,Qr=vt[0]}var Hn=15&qe.la,Qn=15&wr.la;for(_r=0;4>_r;++_r){var Zn=1&Qn;for(In=Vr=0;4>In;++In)Hn=Hn>>1|(Zn=(jr=yc(ot,Qr,jr=Zn+(1&Hn),It.Sc,xn,Ze,ur))>xn)<<7,Vr=Vr<<2|(3<jr?3:1<jr?2:Ze[ur+0]!=0),ur+=16;Hn>>=4,Qn=Qn>>1|Zn<<7,Dr=(Dr<<8|Vr)>>>0}for(Qr=Hn,xn=Qn>>4,xr=0;4>xr;xr+=2){for(Vr=0,Hn=qe.la>>4+xr,Qn=wr.la>>4+xr,_r=0;2>_r;++_r){for(Zn=1&Qn,In=0;2>In;++In)jr=Zn+(1&Hn),Hn=Hn>>1|(Zn=0<(jr=yc(ot,vt[2],jr,It.Qc,0,Ze,ur)))<<3,Vr=Vr<<2|(3<jr?3:1<jr?2:Ze[ur+0]!=0),ur+=16;Hn>>=2,Qn=Qn>>1|Zn<<5}Or|=Vr<<4*xr,Qr|=Hn<<4<<xr,xn|=(240&Qn)<<xr}qe.la=Qr,wr.la=xn,kt.Hc=Dr,kt.Gc=Or,kt.ia=43690&Or?0:It.ia,vt=!(Dr|Or)}if(0<Oe.L&&(Oe.wa[Oe.Y+Oe.ja]=Oe.gd[Fe.$b][Fe.Za],Oe.wa[Oe.Y+Oe.ja].La|=!vt),rt.Ka)return ss(ue,7,"Premature end-of-file encountered.")}if(vo(ue),Oe=Te,rt=1,Fe=(Ee=ue).D,qe=0<Ee.L&&Ee.M>=Ee.zb&&Ee.M<=Ee.Va,Ee.Aa==0)e:{if(Fe.M=Ee.M,Fe.uc=qe,zl(Ee,Fe),rt=1,Fe=(Vr=Ee.D).Nb,qe=(Or=ci[Ee.L])*Ee.R,ot=Or/2*Ee.B,_r=16*Fe*Ee.R,In=8*Fe*Ee.B,vt=Ee.sa,kt=Ee.ta-qe+_r,It=Ee.qa,Ze=Ee.ra-ot+In,ur=Ee.Ha,wr=Ee.Ia-ot+In,Qn=(Hn=Vr.M)==0,Dr=Hn>=Ee.Va-1,Ee.Aa==2&&zl(Ee,Vr),Vr.uc)for(Zn=(jr=Ee).D.M,e(jr.D.uc),Vr=jr.yb;Vr<jr.Hb;++Vr){xn=Vr,Qr=Zn;var ui=(Ii=(Ki=jr).D).Nb;xr=Ki.R;var Ii=Ii.wa[Ii.Y+xn],cs=Ki.sa,mi=Ki.ta+16*ui*xr+16*xn,qi=Ii.dd,Di=Ii.tc;if(Di!=0)if(e(3<=Di),Ki.L==1)0<xn&&Kn(cs,mi,xr,Di+4),Ii.La&&Xa(cs,mi,xr,Di),0<Qr&&ji(cs,mi,xr,Di+4),Ii.La&&Fs(cs,mi,xr,Di);else{var us=Ki.B,ns=Ki.qa,Uo=Ki.ra+8*ui*us+8*xn,da=Ki.Ha,Ki=Ki.Ia+8*ui*us+8*xn;ui=Ii.ld,0<xn&&(Vl(cs,mi,xr,Di+4,qi,ui),ua(ns,Uo,da,Ki,us,Di+4,qi,ui)),Ii.La&&(ho(cs,mi,xr,Di,qi,ui),ls(ns,Uo,da,Ki,us,Di,qi,ui)),0<Qr&&(ca(cs,mi,xr,Di+4,qi,ui),Zo(ns,Uo,da,Ki,us,Di+4,qi,ui)),Ii.La&&(Uc(cs,mi,xr,Di,qi,ui),Yo(ns,Uo,da,Ki,us,Di,qi,ui))}}if(Ee.ia&&alert("todo:DitherRow"),Oe.put!=null){if(Vr=16*Hn,Hn=16*(Hn+1),Qn?(Oe.y=Ee.sa,Oe.O=Ee.ta+_r,Oe.f=Ee.qa,Oe.N=Ee.ra+In,Oe.ea=Ee.Ha,Oe.W=Ee.Ia+In):(Vr-=Or,Oe.y=vt,Oe.O=kt,Oe.f=It,Oe.N=Ze,Oe.ea=ur,Oe.W=wr),Dr||(Hn-=Or),Hn>Oe.o&&(Hn=Oe.o),Oe.F=null,Oe.J=null,Ee.Fa!=null&&0<Ee.Fa.length&&Vr<Hn&&(Oe.J=uc(Ee,Oe,Vr,Hn-Vr),Oe.F=Ee.mb,Oe.F==null&&Oe.F.length==0)){rt=ss(Ee,3,"Could not decode alpha data.");break e}Vr<Oe.j&&(Or=Oe.j-Vr,Vr=Oe.j,e(!(1&Or)),Oe.O+=Ee.R*Or,Oe.N+=Ee.B*(Or>>1),Oe.W+=Ee.B*(Or>>1),Oe.F!=null&&(Oe.J+=Oe.width*Or)),Vr<Hn&&(Oe.O+=Oe.v,Oe.N+=Oe.v>>1,Oe.W+=Oe.v>>1,Oe.F!=null&&(Oe.J+=Oe.v),Oe.ka=Vr-Oe.j,Oe.U=Oe.va-Oe.v,Oe.T=Hn-Vr,rt=Oe.put(Oe))}Fe+1!=Ee.Ic||Dr||(n(Ee.sa,Ee.ta-qe,vt,kt+16*Ee.R,qe),n(Ee.qa,Ee.ra-ot,It,Ze+8*Ee.B,ot),n(Ee.Ha,Ee.Ia-ot,ur,wr+8*Ee.B,ot))}if(!rt)return ss(ue,6,"Output aborted.")}return 1}(z,X)),X.bc!=null&&X.bc(X),E&=1}return E?(z.cb=0,E):0}function os(z,X,E,c,y){y=z[X+E+32*c]+(y>>3),z[X+E+32*c]=-256&y?0>y?0:255:y}function cu(z,X,E,c,y,B){os(z,X,0,E,c+y),os(z,X,1,E,c+B),os(z,X,2,E,c-B),os(z,X,3,E,c-y)}function ds(z){return(20091*z>>16)+z}function ri(z,X,E,c){var y,B=0,S=s(16);for(y=0;4>y;++y){var F=z[X+0]+z[X+8],H=z[X+0]-z[X+8],j=(35468*z[X+4]>>16)-ds(z[X+12]),Z=ds(z[X+4])+(35468*z[X+12]>>16);S[B+0]=F+Z,S[B+1]=H+j,S[B+2]=H-j,S[B+3]=F-Z,B+=4,X++}for(y=B=0;4>y;++y)F=(z=S[B+0]+4)+S[B+8],H=z-S[B+8],j=(35468*S[B+4]>>16)-ds(S[B+12]),os(E,c,0,0,F+(Z=ds(S[B+4])+(35468*S[B+12]>>16))),os(E,c,1,0,H+j),os(E,c,2,0,H-j),os(E,c,3,0,F-Z),B++,c+=32}function lo(z,X,E,c){var y=z[X+0]+4,B=35468*z[X+4]>>16,S=ds(z[X+4]),F=35468*z[X+1]>>16;cu(E,c,0,y+S,z=ds(z[X+1]),F),cu(E,c,1,y+B,z,F),cu(E,c,2,y-B,z,F),cu(E,c,3,y-S,z,F)}function yn(z,X,E,c,y){ri(z,X,E,c),y&&ri(z,X+16,E,c+4)}function Fc(z,X,E,c){Co(z,X+0,E,c,1),Co(z,X+32,E,c+128,1)}function hh(z,X,E,c){var y;for(z=z[X+0]+4,y=0;4>y;++y)for(X=0;4>X;++X)os(E,c,X,y,z)}function $a(z,X,E,c){z[X+0]&&Eo(z,X+0,E,c),z[X+16]&&Eo(z,X+16,E,c+4),z[X+32]&&Eo(z,X+32,E,c+128),z[X+48]&&Eo(z,X+48,E,c+128+4)}function fs(z,X,E,c){var y,B=s(16);for(y=0;4>y;++y){var S=z[X+0+y]+z[X+12+y],F=z[X+4+y]+z[X+8+y],H=z[X+4+y]-z[X+8+y],j=z[X+0+y]-z[X+12+y];B[0+y]=S+F,B[8+y]=S-F,B[4+y]=j+H,B[12+y]=j-H}for(y=0;4>y;++y)S=(z=B[0+4*y]+3)+B[3+4*y],F=B[1+4*y]+B[2+4*y],H=B[1+4*y]-B[2+4*y],j=z-B[3+4*y],E[c+0]=S+F>>3,E[c+16]=j+H>>3,E[c+32]=S-F>>3,E[c+48]=j-H>>3,c+=64}function As(z,X,E){var c,y=X-32,B=mo,S=255-z[y-1];for(c=0;c<E;++c){var F,H=B,j=S+z[X-1];for(F=0;F<E;++F)z[X+F]=H[j+z[y+F]];X+=32}}function Gi(z,X){As(z,X,4)}function uu(z,X){As(z,X,8)}function Us(z,X){As(z,X,16)}function vs(z,X){var E;for(E=0;16>E;++E)n(z,X+32*E,z,X-32,16)}function eo(z,X){var E;for(E=16;0<E;--E)i(z,X,z[X-1],16),X+=32}function Rc(z,X,E){var c;for(c=0;16>c;++c)i(X,E+32*c,z,16)}function oc(z,X){var E,c=16;for(E=0;16>E;++E)c+=z[X-1+32*E]+z[X+E-32];Rc(c>>5,z,X)}function ai(z,X){var E,c=8;for(E=0;16>E;++E)c+=z[X-1+32*E];Rc(c>>4,z,X)}function Dl(z,X){var E,c=8;for(E=0;16>E;++E)c+=z[X+E-32];Rc(c>>4,z,X)}function ps(z,X){Rc(128,z,X)}function Dn(z,X,E){return z+2*X+E+2>>2}function Ro(z,X){var E,c=X-32;for(c=new Uint8Array([Dn(z[c-1],z[c+0],z[c+1]),Dn(z[c+0],z[c+1],z[c+2]),Dn(z[c+1],z[c+2],z[c+3]),Dn(z[c+2],z[c+3],z[c+4])]),E=0;4>E;++E)n(z,X+32*E,c,0,c.length)}function hu(z,X){var E=z[X-1],c=z[X-1+32],y=z[X-1+64],B=z[X-1+96];$r(z,X+0,16843009*Dn(z[X-1-32],E,c)),$r(z,X+32,16843009*Dn(E,c,y)),$r(z,X+64,16843009*Dn(c,y,B)),$r(z,X+96,16843009*Dn(y,B,B))}function to(z,X){var E,c=4;for(E=0;4>E;++E)c+=z[X+E-32]+z[X-1+32*E];for(c>>=3,E=0;4>E;++E)i(z,X+32*E,c,4)}function du(z,X){var E=z[X-1+0],c=z[X-1+32],y=z[X-1+64],B=z[X-1-32],S=z[X+0-32],F=z[X+1-32],H=z[X+2-32],j=z[X+3-32];z[X+0+96]=Dn(c,y,z[X-1+96]),z[X+1+96]=z[X+0+64]=Dn(E,c,y),z[X+2+96]=z[X+1+64]=z[X+0+32]=Dn(B,E,c),z[X+3+96]=z[X+2+64]=z[X+1+32]=z[X+0+0]=Dn(S,B,E),z[X+3+64]=z[X+2+32]=z[X+1+0]=Dn(F,S,B),z[X+3+32]=z[X+2+0]=Dn(H,F,S),z[X+3+0]=Dn(j,H,F)}function Li(z,X){var E=z[X+1-32],c=z[X+2-32],y=z[X+3-32],B=z[X+4-32],S=z[X+5-32],F=z[X+6-32],H=z[X+7-32];z[X+0+0]=Dn(z[X+0-32],E,c),z[X+1+0]=z[X+0+32]=Dn(E,c,y),z[X+2+0]=z[X+1+32]=z[X+0+64]=Dn(c,y,B),z[X+3+0]=z[X+2+32]=z[X+1+64]=z[X+0+96]=Dn(y,B,S),z[X+3+32]=z[X+2+64]=z[X+1+96]=Dn(B,S,F),z[X+3+64]=z[X+2+96]=Dn(S,F,H),z[X+3+96]=Dn(F,H,H)}function Ol(z,X){var E=z[X-1+0],c=z[X-1+32],y=z[X-1+64],B=z[X-1-32],S=z[X+0-32],F=z[X+1-32],H=z[X+2-32],j=z[X+3-32];z[X+0+0]=z[X+1+64]=B+S+1>>1,z[X+1+0]=z[X+2+64]=S+F+1>>1,z[X+2+0]=z[X+3+64]=F+H+1>>1,z[X+3+0]=H+j+1>>1,z[X+0+96]=Dn(y,c,E),z[X+0+64]=Dn(c,E,B),z[X+0+32]=z[X+1+96]=Dn(E,B,S),z[X+1+32]=z[X+2+96]=Dn(B,S,F),z[X+2+32]=z[X+3+96]=Dn(S,F,H),z[X+3+32]=Dn(F,H,j)}function Ai(z,X){var E=z[X+0-32],c=z[X+1-32],y=z[X+2-32],B=z[X+3-32],S=z[X+4-32],F=z[X+5-32],H=z[X+6-32],j=z[X+7-32];z[X+0+0]=E+c+1>>1,z[X+1+0]=z[X+0+64]=c+y+1>>1,z[X+2+0]=z[X+1+64]=y+B+1>>1,z[X+3+0]=z[X+2+64]=B+S+1>>1,z[X+0+32]=Dn(E,c,y),z[X+1+32]=z[X+0+96]=Dn(c,y,B),z[X+2+32]=z[X+1+96]=Dn(y,B,S),z[X+3+32]=z[X+2+96]=Dn(B,S,F),z[X+3+64]=Dn(S,F,H),z[X+3+96]=Dn(F,H,j)}function si(z,X){var E=z[X-1+0],c=z[X-1+32],y=z[X-1+64],B=z[X-1+96];z[X+0+0]=E+c+1>>1,z[X+2+0]=z[X+0+32]=c+y+1>>1,z[X+2+32]=z[X+0+64]=y+B+1>>1,z[X+1+0]=Dn(E,c,y),z[X+3+0]=z[X+1+32]=Dn(c,y,B),z[X+3+32]=z[X+1+64]=Dn(y,B,B),z[X+3+64]=z[X+2+64]=z[X+0+96]=z[X+1+96]=z[X+2+96]=z[X+3+96]=B}function ku(z,X){var E=z[X-1+0],c=z[X-1+32],y=z[X-1+64],B=z[X-1+96],S=z[X-1-32],F=z[X+0-32],H=z[X+1-32],j=z[X+2-32];z[X+0+0]=z[X+2+32]=E+S+1>>1,z[X+0+32]=z[X+2+64]=c+E+1>>1,z[X+0+64]=z[X+2+96]=y+c+1>>1,z[X+0+96]=B+y+1>>1,z[X+3+0]=Dn(F,H,j),z[X+2+0]=Dn(S,F,H),z[X+1+0]=z[X+3+32]=Dn(E,S,F),z[X+1+32]=z[X+3+64]=Dn(c,E,S),z[X+1+64]=z[X+3+96]=Dn(y,c,E),z[X+1+96]=Dn(B,y,c)}function wi(z,X){var E;for(E=0;8>E;++E)n(z,X+32*E,z,X-32,8)}function kl(z,X){var E;for(E=0;8>E;++E)i(z,X,z[X-1],8),X+=32}function ro(z,X,E){var c;for(c=0;8>c;++c)i(X,E+32*c,z,8)}function Ba(z,X){var E,c=8;for(E=0;8>E;++E)c+=z[X+E-32]+z[X-1+32*E];ro(c>>4,z,X)}function ac(z,X){var E,c=4;for(E=0;8>E;++E)c+=z[X+E-32];ro(c>>3,z,X)}function ja(z,X){var E,c=4;for(E=0;8>E;++E)c+=z[X-1+32*E];ro(c>>3,z,X)}function qa(z,X){ro(128,z,X)}function qo(z,X,E){var c=z[X-E],y=z[X+0],B=3*(y-c)+gc[1020+z[X-2*E]-z[X+E]],S=mc[112+(B+4>>3)];z[X-E]=mo[255+c+mc[112+(B+3>>3)]],z[X+0]=mo[255+y-S]}function dh(z,X,E,c){var y=z[X+0],B=z[X+E];return zs[255+z[X-2*E]-z[X-E]]>c||zs[255+B-y]>c}function fu(z,X,E,c){return 4*zs[255+z[X-E]-z[X+0]]+zs[255+z[X-2*E]-z[X+E]]<=c}function Ul(z,X,E,c,y){var B=z[X-3*E],S=z[X-2*E],F=z[X-E],H=z[X+0],j=z[X+E],Z=z[X+2*E],se=z[X+3*E];return 4*zs[255+F-H]+zs[255+S-j]>c?0:zs[255+z[X-4*E]-B]<=y&&zs[255+B-S]<=y&&zs[255+S-F]<=y&&zs[255+se-Z]<=y&&zs[255+Z-j]<=y&&zs[255+j-H]<=y}function oa(z,X,E,c){var y=2*c+1;for(c=0;16>c;++c)fu(z,X+c,E,y)&&qo(z,X+c,E)}function Sn(z,X,E,c){var y=2*c+1;for(c=0;16>c;++c)fu(z,X+c*E,1,y)&&qo(z,X+c*E,1)}function Ko(z,X,E,c){var y;for(y=3;0<y;--y)oa(z,X+=4*E,E,c)}function Ka(z,X,E,c){var y;for(y=3;0<y;--y)Sn(z,X+=4,E,c)}function go(z,X,E,c,y,B,S,F){for(B=2*B+1;0<y--;){if(Ul(z,X,E,B,S))if(dh(z,X,E,F))qo(z,X,E);else{var H=z,j=X,Z=E,se=H[j-2*Z],he=H[j-Z],ue=H[j+0],Te=H[j+Z],Fe=H[j+2*Z],Ee=27*(rt=gc[1020+3*(ue-he)+gc[1020+se-Te]])+63>>7,Oe=18*rt+63>>7,rt=9*rt+63>>7;H[j-3*Z]=mo[255+H[j-3*Z]+rt],H[j-2*Z]=mo[255+se+Oe],H[j-Z]=mo[255+he+Ee],H[j+0]=mo[255+ue-Ee],H[j+Z]=mo[255+Te-Oe],H[j+2*Z]=mo[255+Fe-rt]}X+=c}}function $i(z,X,E,c,y,B,S,F){for(B=2*B+1;0<y--;){if(Ul(z,X,E,B,S))if(dh(z,X,E,F))qo(z,X,E);else{var H=z,j=X,Z=E,se=H[j-Z],he=H[j+0],ue=H[j+Z],Te=mc[112+((Fe=3*(he-se))+4>>3)],Fe=mc[112+(Fe+3>>3)],Ee=Te+1>>1;H[j-2*Z]=mo[255+H[j-2*Z]+Ee],H[j-Z]=mo[255+se+Fe],H[j+0]=mo[255+he-Te],H[j+Z]=mo[255+ue-Ee]}X+=c}}function Au(z,X,E,c,y,B){go(z,X,E,1,16,c,y,B)}function Ca(z,X,E,c,y,B){go(z,X,1,E,16,c,y,B)}function Nh(z,X,E,c,y,B){var S;for(S=3;0<S;--S)$i(z,X+=4*E,E,1,16,c,y,B)}function pu(z,X,E,c,y,B){var S;for(S=3;0<S;--S)$i(z,X+=4,1,E,16,c,y,B)}function Uu(z,X,E,c,y,B,S,F){go(z,X,y,1,8,B,S,F),go(E,c,y,1,8,B,S,F)}function gu(z,X,E,c,y,B,S,F){go(z,X,1,y,8,B,S,F),go(E,c,1,y,8,B,S,F)}function fh(z,X,E,c,y,B,S,F){$i(z,X+4*y,y,1,8,B,S,F),$i(E,c+4*y,y,1,8,B,S,F)}function mu(z,X,E,c,y,B,S,F){$i(z,X+4,1,y,8,B,S,F),$i(E,c+4,1,y,8,B,S,F)}function xo(){this.ba=new $t,this.ec=[],this.cc=[],this.Mc=[],this.Dc=this.Nc=this.dc=this.fc=0,this.Oa=new Pe,this.memory=0,this.Ib="OutputFunc",this.Jb="OutputAlphaFunc",this.Nd="OutputRowFunc"}function wo(){this.data=[],this.offset=this.kd=this.ha=this.w=0,this.na=[],this.xa=this.gb=this.Ja=this.Sa=this.P=0}function Lc(){this.nc=this.Ea=this.b=this.hc=0,this.K=[],this.w=0}function lc(){this.ua=0,this.Wa=new We,this.vb=new We,this.md=this.xc=this.wc=0,this.vc=[],this.Wb=0,this.Ya=new Ne,this.yc=new ze}function Dc(){this.xb=this.a=0,this.l=new wa,this.ca=new $t,this.V=[],this.Ba=0,this.Ta=[],this.Ua=0,this.m=new $e,this.Pb=0,this.wd=new $e,this.Ma=this.$=this.C=this.i=this.c=this.xd=0,this.s=new lc,this.ab=0,this.gc=a(4,Lc),this.Oc=0}function Lo(){this.Lc=this.Z=this.$a=this.i=this.c=0,this.l=new wa,this.ic=0,this.ca=[],this.tb=0,this.qd=null,this.rd=0}function cc(z,X,E,c,y,B,S){for(z=z==null?0:z[X+0],X=0;X<S;++X)y[B+X]=z+E[c+X]&255,z=y[B+X]}function Nu(z,X,E,c,y,B,S){var F;if(z==null)cc(null,null,E,c,y,B,S);else for(F=0;F<S;++F)y[B+F]=z[X+F]+E[c+F]&255}function gl(z,X,E,c,y,B,S){if(z==null)cc(null,null,E,c,y,B,S);else{var F,H=z[X+0],j=H,Z=H;for(F=0;F<S;++F)j=Z+(H=z[X+F])-j,Z=E[c+F]+(-256&j?0>j?0:255:j)&255,j=H,y[B+F]=Z}}function uc(z,X,E,c){var y=X.width,B=X.o;if(e(z!=null&&X!=null),0>E||0>=c||E+c>B)return null;if(!z.Cc){if(z.ga==null){var S;if(z.ga=new Lo,(S=z.ga==null)||(S=X.width*X.o,e(z.Gb.length==0),z.Gb=s(S),z.Uc=0,z.Gb==null?S=0:(z.mb=z.Gb,z.nb=z.Uc,z.rc=null,S=1),S=!S),!S){S=z.ga;var F=z.Fa,H=z.P,j=z.qc,Z=z.mb,se=z.nb,he=H+1,ue=j-1,Te=S.l;if(e(F!=null&&Z!=null&&X!=null),$l[0]=null,$l[1]=cc,$l[2]=Nu,$l[3]=gl,S.ca=Z,S.tb=se,S.c=X.width,S.i=X.height,e(0<S.c&&0<S.i),1>=j)X=0;else if(S.$a=F[H+0]>>0&3,S.Z=F[H+0]>>2&3,S.Lc=F[H+0]>>4&3,H=F[H+0]>>6&3,0>S.$a||1<S.$a||4<=S.Z||1<S.Lc||H)X=0;else if(Te.put=ht,Te.ac=Se,Te.bc=At,Te.ma=S,Te.width=X.width,Te.height=X.height,Te.Da=X.Da,Te.v=X.v,Te.va=X.va,Te.j=X.j,Te.o=X.o,S.$a)e:{e(S.$a==1),X=Gn();t:for(;;){if(X==null){X=0;break e}if(e(S!=null),S.mc=X,X.c=S.c,X.i=S.i,X.l=S.l,X.l.ma=S,X.l.width=S.c,X.l.height=S.i,X.a=0,Kt(X.m,F,he,ue),!Ln(S.c,S.i,1,X,null)||(X.ab==1&&X.gc[0].hc==3&&Rr(X.s)?(S.ic=1,F=X.c*X.i,X.Ta=null,X.Ua=0,X.V=s(F),X.Ba=0,X.V==null?(X.a=1,X=0):X=1):(S.ic=0,X=Un(X,S.c)),!X))break t;X=1;break e}S.mc=null,X=0}else X=ue>=S.c*S.i;S=!X}if(S)return null;z.ga.Lc!=1?z.Ga=0:c=B-E}e(z.ga!=null),e(E+c<=B);e:{if(X=(F=z.ga).c,B=F.l.o,F.$a==0){if(he=z.rc,ue=z.Vc,Te=z.Fa,H=z.P+1+E*X,j=z.mb,Z=z.nb+E*X,e(H<=z.P+z.qc),F.Z!=0)for(e($l[F.Z]!=null),S=0;S<c;++S)$l[F.Z](he,ue,Te,H,j,Z,X),he=j,ue=Z,Z+=X,H+=X;else for(S=0;S<c;++S)n(j,Z,Te,H,X),he=j,ue=Z,Z+=X,H+=X;z.rc=he,z.Vc=ue}else{if(e(F.mc!=null),X=E+c,e((S=F.mc)!=null),e(X<=S.i),S.C>=X)X=1;else if(F.ic||rr(),F.ic){F=S.V,he=S.Ba,ue=S.c;var Fe=S.i,Ee=(Te=1,H=S.$/ue,j=S.$%ue,Z=S.m,se=S.s,S.$),Oe=ue*Fe,rt=ue*X,qe=se.wc,Ze=Ee<rt?dr(se,j,H):null;e(Ee<=Oe),e(X<=Fe),e(Rr(se));t:for(;;){for(;!Z.h&&Ee<rt;){if(j&qe||(Ze=dr(se,j,H)),e(Ze!=null),jt(Z),256>(Fe=Nt(Ze.G[0],Ze.H[0],Z)))F[he+Ee]=Fe,++Ee,++j>=ue&&(j=0,++H<=X&&!(H%16)&&Jn(S,H));else{if(!(280>Fe)){Te=0;break t}Fe=dt(Fe-256,Z);var ot,vt=Nt(Ze.G[4],Ze.H[4],Z);if(jt(Z),!(Ee>=(vt=yt(ue,vt=dt(vt,Z)))&&Oe-Ee>=Fe)){Te=0;break t}for(ot=0;ot<Fe;++ot)F[he+Ee+ot]=F[he+Ee+ot-vt];for(Ee+=Fe,j+=Fe;j>=ue;)j-=ue,++H<=X&&!(H%16)&&Jn(S,H);Ee<rt&&j&qe&&(Ze=dr(se,j,H))}e(Z.h==Bt(Z))}Jn(S,H>X?X:H);break t}!Te||Z.h&&Ee<Oe?(Te=0,S.a=Z.h?5:3):S.$=Ee,X=Te}else X=_n(S,S.V,S.Ba,S.c,S.i,X,Ei);if(!X){c=0;break e}}E+c>=B&&(z.Cc=1),c=1}if(!c)return null;if(z.Cc&&((c=z.ga)!=null&&(c.mc=null),z.ga=null,0<z.Ga))return alert("todo:WebPDequantizeLevels"),null}return z.nb+E*y}function ne(z,X,E,c,y,B){for(;0<y--;){var S,F=z,H=X+(E?1:0),j=z,Z=X+(E?0:3);for(S=0;S<c;++S){var se=j[Z+4*S];se!=255&&(se*=32897,F[H+4*S+0]=F[H+4*S+0]*se>>23,F[H+4*S+1]=F[H+4*S+1]*se>>23,F[H+4*S+2]=F[H+4*S+2]*se>>23)}X+=B}}function je(z,X,E,c,y){for(;0<c--;){var B;for(B=0;B<E;++B){var S=z[X+2*B+0],F=15&(j=z[X+2*B+1]),H=4369*F,j=(240&j|j>>4)*H>>16;z[X+2*B+0]=(240&S|S>>4)*H>>16&240|(15&S|S<<4)*H>>16>>4&15,z[X+2*B+1]=240&j|F}X+=y}}function Tt(z,X,E,c,y,B,S,F){var H,j,Z=255;for(j=0;j<y;++j){for(H=0;H<c;++H){var se=z[X+H];B[S+4*H]=se,Z&=se}X+=E,S+=F}return Z!=255}function Qt(z,X,E,c,y){var B;for(B=0;B<y;++B)E[c+B]=z[X+B]>>8}function rr(){Ja=ne,xs=je,vl=Tt,vf=Qt}function vr(z,X,E){Ue[z]=function(c,y,B,S,F,H,j,Z,se,he,ue,Te,Fe,Ee,Oe,rt,qe){var Ze,ot=qe-1>>1,vt=F[H+0]|j[Z+0]<<16,kt=se[he+0]|ue[Te+0]<<16;e(c!=null);var It=3*vt+kt+131074>>2;for(X(c[y+0],255&It,It>>16,Fe,Ee),B!=null&&(It=3*kt+vt+131074>>2,X(B[S+0],255&It,It>>16,Oe,rt)),Ze=1;Ze<=ot;++Ze){var ur=F[H+Ze]|j[Z+Ze]<<16,wr=se[he+Ze]|ue[Te+Ze]<<16,Dr=vt+ur+kt+wr+524296,Or=Dr+2*(ur+kt)>>3;It=Or+vt>>1,vt=(Dr=Dr+2*(vt+wr)>>3)+ur>>1,X(c[y+2*Ze-1],255&It,It>>16,Fe,Ee+(2*Ze-1)*E),X(c[y+2*Ze-0],255&vt,vt>>16,Fe,Ee+(2*Ze-0)*E),B!=null&&(It=Dr+kt>>1,vt=Or+wr>>1,X(B[S+2*Ze-1],255&It,It>>16,Oe,rt+(2*Ze-1)*E),X(B[S+2*Ze+0],255&vt,vt>>16,Oe,rt+(2*Ze+0)*E)),vt=ur,kt=wr}1&qe||(It=3*vt+kt+131074>>2,X(c[y+qe-1],255&It,It>>16,Fe,Ee+(qe-1)*E),B!=null&&(It=3*kt+vt+131074>>2,X(B[S+qe-1],255&It,It>>16,Oe,rt+(qe-1)*E)))}}function Xr(){ni[zc]=Gu,ni[Hc]=So,ni[wd]=mh,ni[_c]=Vs,ni[zu]=wl,ni[ph]=el,ni[Gl]=wu,ni[Vc]=So,ni[Gc]=Vs,ni[_u]=wl,ni[Qc]=el}function bn(z){return z&~_o?0>z?0:255:z>>xf}function qn(z,X){return bn((19077*z>>8)+(26149*X>>8)-14234)}function li(z,X,E){return bn((19077*z>>8)-(6419*X>>8)-(13320*E>>8)+8708)}function fi(z,X){return bn((19077*z>>8)+(33050*X>>8)-17685)}function pi(z,X,E,c,y){c[y+0]=qn(z,E),c[y+1]=li(z,X,E),c[y+2]=fi(z,X)}function as(z,X,E,c,y){c[y+0]=fi(z,X),c[y+1]=li(z,X,E),c[y+2]=qn(z,E)}function rs(z,X,E,c,y){var B=li(z,X,E);X=B<<3&224|fi(z,X)>>3,c[y+0]=248&qn(z,E)|B>>5,c[y+1]=X}function gi(z,X,E,c,y){var B=240&fi(z,X)|15;c[y+0]=240&qn(z,E)|li(z,X,E)>>4,c[y+1]=B}function Do(z,X,E,c,y){c[y+0]=255,pi(z,X,E,c,y+1)}function zn(z,X,E,c,y){as(z,X,E,c,y),c[y+3]=255}function Wo(z,X,E,c,y){pi(z,X,E,c,y),c[y+3]=255}function vi(z,X){return 0>z?0:z>X?X:z}function Ti(z,X,E){Ue[z]=function(c,y,B,S,F,H,j,Z,se){for(var he=Z+(-2&se)*E;Z!=he;)X(c[y+0],B[S+0],F[H+0],j,Z),X(c[y+1],B[S+0],F[H+0],j,Z+E),y+=2,++S,++H,Z+=2*E;1&se&&X(c[y+0],B[S+0],F[H+0],j,Z)}}function hc(z,X,E){return E==0?z==0?X==0?6:5:X==0?4:0:E}function Nl(z,X,E,c,y){switch(z>>>30){case 3:Co(X,E,c,y,0);break;case 2:kc(X,E,c,y);break;case 1:Eo(X,E,c,y)}}function zl(z,X){var E,c,y=X.M,B=X.Nb,S=z.oc,F=z.pc+40,H=z.oc,j=z.pc+584,Z=z.oc,se=z.pc+600;for(E=0;16>E;++E)S[F+32*E-1]=129;for(E=0;8>E;++E)H[j+32*E-1]=129,Z[se+32*E-1]=129;for(0<y?S[F-1-32]=H[j-1-32]=Z[se-1-32]=129:(i(S,F-32-1,127,21),i(H,j-32-1,127,9),i(Z,se-32-1,127,9)),c=0;c<z.za;++c){var he=X.ya[X.aa+c];if(0<c){for(E=-1;16>E;++E)n(S,F+32*E-4,S,F+32*E+12,4);for(E=-1;8>E;++E)n(H,j+32*E-4,H,j+32*E+4,4),n(Z,se+32*E-4,Z,se+32*E+4,4)}var ue=z.Gd,Te=z.Hd+c,Fe=he.ad,Ee=he.Hc;if(0<y&&(n(S,F-32,ue[Te].y,0,16),n(H,j-32,ue[Te].f,0,8),n(Z,se-32,ue[Te].ea,0,8)),he.Za){var Oe=S,rt=F-32+16;for(0<y&&(c>=z.za-1?i(Oe,rt,ue[Te].y[15],4):n(Oe,rt,ue[Te+1].y,0,4)),E=0;4>E;E++)Oe[rt+128+E]=Oe[rt+256+E]=Oe[rt+384+E]=Oe[rt+0+E];for(E=0;16>E;++E,Ee<<=2)Oe=S,rt=F+Cl[E],To[he.Ob[E]](Oe,rt),Nl(Ee,Fe,16*+E,Oe,rt)}else if(Oe=hc(c,y,he.Ob[0]),Ya[Oe](S,F),Ee!=0)for(E=0;16>E;++E,Ee<<=2)Nl(Ee,Fe,16*+E,S,F+Cl[E]);for(E=he.Gc,Oe=hc(c,y,he.Dd),Ql[Oe](H,j),Ql[Oe](Z,se),Ee=Fe,Oe=H,rt=j,255&(he=E>>0)&&(170&he?bl(Ee,256,Oe,rt):uo(Ee,256,Oe,rt)),he=Z,Ee=se,255&(E>>=8)&&(170&E?bl(Fe,320,he,Ee):uo(Fe,320,he,Ee)),y<z.Ub-1&&(n(ue[Te].y,0,S,F+480,16),n(ue[Te].f,0,H,j+224,8),n(ue[Te].ea,0,Z,se+224,8)),E=8*B*z.B,ue=z.sa,Te=z.ta+16*c+16*B*z.R,Fe=z.qa,he=z.ra+8*c+E,Ee=z.Ha,Oe=z.Ia+8*c+E,E=0;16>E;++E)n(ue,Te+E*z.R,S,F+32*E,16);for(E=0;8>E;++E)n(Fe,he+E*z.B,H,j+32*E,8),n(Ee,Oe+E*z.B,Z,se+32*E,8)}}function Oc(z,X,E,c,y,B,S,F,H){var j=[0],Z=[0],se=0,he=H!=null?H.kd:0,ue=H??new wo;if(z==null||12>E)return 7;ue.data=z,ue.w=X,ue.ha=E,X=[X],E=[E],ue.gb=[ue.gb];e:{var Te=X,Fe=E,Ee=ue.gb;if(e(z!=null),e(Fe!=null),e(Ee!=null),Ee[0]=0,12<=Fe[0]&&!t(z,Te[0],"RIFF")){if(t(z,Te[0]+8,"WEBP")){Ee=3;break e}var Oe=sn(z,Te[0]+4);if(12>Oe||4294967286<Oe){Ee=3;break e}if(he&&Oe>Fe[0]-8){Ee=7;break e}Ee[0]=Oe,Te[0]+=12,Fe[0]-=12}Ee=0}if(Ee!=0)return Ee;for(Oe=0<ue.gb[0],E=E[0];;){e:{var rt=z;Fe=X,Ee=E;var qe=j,Ze=Z,ot=Te=[0];if((It=se=[se])[0]=0,8>Ee[0])Ee=7;else{if(!t(rt,Fe[0],"VP8X")){if(sn(rt,Fe[0]+4)!=10){Ee=3;break e}if(18>Ee[0]){Ee=7;break e}var vt=sn(rt,Fe[0]+8),kt=1+Gr(rt,Fe[0]+12);if(2147483648<=kt*(rt=1+Gr(rt,Fe[0]+15))){Ee=3;break e}ot!=null&&(ot[0]=vt),qe!=null&&(qe[0]=kt),Ze!=null&&(Ze[0]=rt),Fe[0]+=18,Ee[0]-=18,It[0]=1}Ee=0}}if(se=se[0],Te=Te[0],Ee!=0)return Ee;if(Fe=!!(2&Te),!Oe&&se)return 3;if(B!=null&&(B[0]=!!(16&Te)),S!=null&&(S[0]=Fe),F!=null&&(F[0]=0),S=j[0],Te=Z[0],se&&Fe&&H==null){Ee=0;break}if(4>E){Ee=7;break}if(Oe&&se||!Oe&&!se&&!t(z,X[0],"ALPH")){E=[E],ue.na=[ue.na],ue.P=[ue.P],ue.Sa=[ue.Sa];e:{vt=z,Ee=X,Oe=E;var It=ue.gb;qe=ue.na,Ze=ue.P,ot=ue.Sa,kt=22,e(vt!=null),e(Oe!=null),rt=Ee[0];var ur=Oe[0];for(e(qe!=null),e(ot!=null),qe[0]=null,Ze[0]=null,ot[0]=0;;){if(Ee[0]=rt,Oe[0]=ur,8>ur){Ee=7;break e}var wr=sn(vt,rt+4);if(4294967286<wr){Ee=3;break e}var Dr=8+wr+1&-2;if(kt+=Dr,0<It&&kt>It){Ee=3;break e}if(!t(vt,rt,"VP8 ")||!t(vt,rt,"VP8L")){Ee=0;break e}if(ur[0]<Dr){Ee=7;break e}t(vt,rt,"ALPH")||(qe[0]=vt,Ze[0]=rt+8,ot[0]=wr),rt+=Dr,ur-=Dr}}if(E=E[0],ue.na=ue.na[0],ue.P=ue.P[0],ue.Sa=ue.Sa[0],Ee!=0)break}E=[E],ue.Ja=[ue.Ja],ue.xa=[ue.xa];e:if(It=z,Ee=X,Oe=E,qe=ue.gb[0],Ze=ue.Ja,ot=ue.xa,vt=Ee[0],rt=!t(It,vt,"VP8 "),kt=!t(It,vt,"VP8L"),e(It!=null),e(Oe!=null),e(Ze!=null),e(ot!=null),8>Oe[0])Ee=7;else{if(rt||kt){if(It=sn(It,vt+4),12<=qe&&It>qe-12){Ee=3;break e}if(he&&It>Oe[0]-8){Ee=7;break e}Ze[0]=It,Ee[0]+=8,Oe[0]-=8,ot[0]=kt}else ot[0]=5<=Oe[0]&&It[vt+0]==47&&!(It[vt+4]>>5),Ze[0]=Oe[0];Ee=0}if(E=E[0],ue.Ja=ue.Ja[0],ue.xa=ue.xa[0],X=X[0],Ee!=0)break;if(4294967286<ue.Ja)return 3;if(F==null||Fe||(F[0]=ue.xa?2:1),S=[S],Te=[Te],ue.xa){if(5>E){Ee=7;break}F=S,he=Te,Fe=B,z==null||5>E?z=0:5<=E&&z[X+0]==47&&!(z[X+4]>>5)?(Oe=[0],It=[0],qe=[0],Kt(Ze=new $e,z,X,E),_t(Ze,Oe,It,qe)?(F!=null&&(F[0]=Oe[0]),he!=null&&(he[0]=It[0]),Fe!=null&&(Fe[0]=qe[0]),z=1):z=0):z=0}else{if(10>E){Ee=7;break}F=Te,z==null||10>E||!sa(z,X+3,E-3)?z=0:(he=z[X+0]|z[X+1]<<8|z[X+2]<<16,Fe=16383&(z[X+7]<<8|z[X+6]),z=16383&(z[X+9]<<8|z[X+8]),1&he||3<(he>>1&7)||!(he>>4&1)||he>>5>=ue.Ja||!Fe||!z?z=0:(S&&(S[0]=Fe),F&&(F[0]=z),z=1))}if(!z||(S=S[0],Te=Te[0],se&&(j[0]!=S||Z[0]!=Te)))return 3;H!=null&&(H[0]=ue,H.offset=X-H.w,e(4294967286>X-H.w),e(H.offset==H.ha-E));break}return Ee==0||Ee==7&&se&&H==null?(B!=null&&(B[0]|=ue.na!=null&&0<ue.na.length),c!=null&&(c[0]=S),y!=null&&(y[0]=Te),0):Ee}function Wa(z,X,E){var c=X.width,y=X.height,B=0,S=0,F=c,H=y;if(X.Da=z!=null&&0<z.Da,X.Da&&(F=z.cd,H=z.bd,B=z.v,S=z.j,11>E||(B&=-2,S&=-2),0>B||0>S||0>=F||0>=H||B+F>c||S+H>y))return 0;if(X.v=B,X.j=S,X.va=B+F,X.o=S+H,X.U=F,X.T=H,X.da=z!=null&&0<z.da,X.da){if(!Pn(F,H,E=[z.ib],B=[z.hb]))return 0;X.ib=E[0],X.hb=B[0]}return X.ob=z!=null&&z.ob,X.Kb=z==null||!z.Sd,X.da&&(X.ob=X.ib<3*c/4&&X.hb<3*y/4,X.Kb=0),1}function ml(z){if(z==null)return 2;if(11>z.S){var X=z.f.RGBA;X.fb+=(z.height-1)*X.A,X.A=-X.A}else X=z.f.kb,z=z.height,X.O+=(z-1)*X.fa,X.fa=-X.fa,X.N+=(z-1>>1)*X.Ab,X.Ab=-X.Ab,X.W+=(z-1>>1)*X.Db,X.Db=-X.Db,X.F!=null&&(X.J+=(z-1)*X.lb,X.lb=-X.lb);return 0}function no(z,X,E,c){if(c==null||0>=z||0>=X)return 2;if(E!=null){if(E.Da){var y=E.cd,B=E.bd,S=-2&E.v,F=-2&E.j;if(0>S||0>F||0>=y||0>=B||S+y>z||F+B>X)return 2;z=y,X=B}if(E.da){if(!Pn(z,X,y=[E.ib],B=[E.hb]))return 2;z=y[0],X=B[0]}}c.width=z,c.height=X;e:{var H=c.width,j=c.height;if(z=c.S,0>=H||0>=j||!(z>=zc&&13>z))z=2;else{if(0>=c.Rd&&c.sd==null){S=B=y=X=0;var Z=(F=H*Eu[z])*j;if(11>z||(B=(j+1)/2*(X=(H+1)/2),z==12&&(S=(y=H)*j)),(j=s(Z+2*B+S))==null){z=1;break e}c.sd=j,11>z?((H=c.f.RGBA).eb=j,H.fb=0,H.A=F,H.size=Z):((H=c.f.kb).y=j,H.O=0,H.fa=F,H.Fd=Z,H.f=j,H.N=0+Z,H.Ab=X,H.Cd=B,H.ea=j,H.W=0+Z+B,H.Db=X,H.Ed=B,z==12&&(H.F=j,H.J=0+Z+2*B),H.Tc=S,H.lb=y)}if(X=1,y=c.S,B=c.width,S=c.height,y>=zc&&13>y)if(11>y)z=c.f.RGBA,X&=(F=Math.abs(z.A))*(S-1)+B<=z.size,X&=F>=B*Eu[y],X&=z.eb!=null;else{z=c.f.kb,F=(B+1)/2,Z=(S+1)/2,H=Math.abs(z.fa),j=Math.abs(z.Ab);var se=Math.abs(z.Db),he=Math.abs(z.lb),ue=he*(S-1)+B;X&=H*(S-1)+B<=z.Fd,X&=j*(Z-1)+F<=z.Cd,X=(X&=se*(Z-1)+F<=z.Ed)&H>=B&j>=F&se>=F,X&=z.y!=null,X&=z.f!=null,X&=z.ea!=null,y==12&&(X&=he>=B,X&=ue<=z.Tc,X&=z.F!=null)}else X=0;z=X?0:2}}return z!=0||E!=null&&E.fd&&(z=ml(c)),z}var Ps=64,dc=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215],fc=24,aa=32,Ac=8,co=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];Mr("Predictor0","PredictorAdd0"),Ue.Predictor0=function(){return 4278190080},Ue.Predictor1=function(z){return z},Ue.Predictor2=function(z,X,E){return X[E+0]},Ue.Predictor3=function(z,X,E){return X[E+1]},Ue.Predictor4=function(z,X,E){return X[E-1]},Ue.Predictor5=function(z,X,E){return Wr(Wr(z,X[E+1]),X[E+0])},Ue.Predictor6=function(z,X,E){return Wr(z,X[E-1])},Ue.Predictor7=function(z,X,E){return Wr(z,X[E+0])},Ue.Predictor8=function(z,X,E){return Wr(X[E-1],X[E+0])},Ue.Predictor9=function(z,X,E){return Wr(X[E+0],X[E+1])},Ue.Predictor10=function(z,X,E){return Wr(Wr(z,X[E-1]),Wr(X[E+0],X[E+1]))},Ue.Predictor11=function(z,X,E){var c=X[E+0];return 0>=Fn(c>>24&255,z>>24&255,(X=X[E-1])>>24&255)+Fn(c>>16&255,z>>16&255,X>>16&255)+Fn(c>>8&255,z>>8&255,X>>8&255)+Fn(255&c,255&z,255&X)?c:z},Ue.Predictor12=function(z,X,E){var c=X[E+0];return(gn((z>>24&255)+(c>>24&255)-((X=X[E-1])>>24&255))<<24|gn((z>>16&255)+(c>>16&255)-(X>>16&255))<<16|gn((z>>8&255)+(c>>8&255)-(X>>8&255))<<8|gn((255&z)+(255&c)-(255&X)))>>>0},Ue.Predictor13=function(z,X,E){var c=X[E-1];return(Bn((z=Wr(z,X[E+0]))>>24&255,c>>24&255)<<24|Bn(z>>16&255,c>>16&255)<<16|Bn(z>>8&255,c>>8&255)<<8|Bn(z>>0&255,c>>0&255))>>>0};var Ea=Ue.PredictorAdd0;Ue.PredictorAdd1=$n,Mr("Predictor2","PredictorAdd2"),Mr("Predictor3","PredictorAdd3"),Mr("Predictor4","PredictorAdd4"),Mr("Predictor5","PredictorAdd5"),Mr("Predictor6","PredictorAdd6"),Mr("Predictor7","PredictorAdd7"),Mr("Predictor8","PredictorAdd8"),Mr("Predictor9","PredictorAdd9"),Mr("Predictor10","PredictorAdd10"),Mr("Predictor11","PredictorAdd11"),Mr("Predictor12","PredictorAdd12"),Mr("Predictor13","PredictorAdd13");var Hl=Ue.PredictorAdd2;Rn("ColorIndexInverseTransform","MapARGB","32b",function(z){return z>>8&255},function(z){return z}),Rn("VP8LColorIndexInverseTransformAlpha","MapAlpha","8b",function(z){return z},function(z){return z>>8&255});var Bi,Xo=Ue.ColorIndexInverseTransform,pc=Ue.MapARGB,vd=Ue.VP8LColorIndexInverseTransformAlpha,Ah=Ue.MapAlpha,xi=Ue.VP8LPredictorsAdd=[];xi.length=16,(Ue.VP8LPredictors=[]).length=16,(Ue.VP8LPredictorsAdd_C=[]).length=16,(Ue.VP8LPredictors_C=[]).length=16;var Jo,Ta,_l,Bo,yl,la,Oo,Co,kc,bl,Eo,uo,ca,Vl,Zo,ua,Uc,ho,Yo,ls,ji,Kn,Fs,Xa,Ja,xs,vl,vf,xd=s(511),Ns=s(2041),ha=s(225),ko=s(767),Nc=0,gc=Ns,mc=ha,mo=ko,zs=xd,zc=0,Hc=1,wd=2,_c=3,zu=4,ph=5,Gl=6,Vc=7,Gc=8,_u=9,Qc=10,Hu=[2,3,7],zh=[3,3,11],yu=[280,256,256,256,40],Qi=[0,1,1,1,0],bu=[17,18,0,1,2,3,4,5,16,6,7,8,9,10,11,12,13,14,15],Hs=[24,7,23,25,40,6,39,41,22,26,38,42,56,5,55,57,21,27,54,58,37,43,72,4,71,73,20,28,53,59,70,74,36,44,88,69,75,52,60,3,87,89,19,29,86,90,35,45,68,76,85,91,51,61,104,2,103,105,18,30,102,106,34,46,84,92,67,77,101,107,50,62,120,1,119,121,83,93,17,31,100,108,66,78,118,122,33,47,117,123,49,63,99,109,82,94,0,116,124,65,79,16,32,98,110,48,115,125,81,95,64,114,126,97,111,80,113,127,96,112],xl=[2954,2956,2958,2962,2970,2986,3018,3082,3212,3468,3980,5004],Hh=8,Sa=[4,5,6,7,8,9,10,10,11,12,13,14,15,16,17,17,18,19,20,20,21,21,22,22,23,23,24,25,25,26,27,28,29,30,31,32,33,34,35,36,37,37,38,39,40,41,42,43,44,45,46,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,76,77,78,79,80,81,82,83,84,85,86,87,88,89,91,93,95,96,98,100,101,102,104,106,108,110,112,114,116,118,122,124,126,128,130,132,134,136,138,140,143,145,148,151,154,157],Ia=[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,119,122,125,128,131,134,137,140,143,146,149,152,155,158,161,164,167,170,173,177,181,185,189,193,197,201,205,209,213,217,221,225,229,234,239,245,249,254,259,264,269,274,279,284],yc=null,Bd=[[173,148,140,0],[176,155,140,135,0],[180,157,141,134,130,0],[254,254,243,230,196,177,153,140,133,130,129,0]],gh=[0,1,4,8,5,2,3,6,9,12,13,10,7,11,14,15],Cd=[-0,1,-1,2,-2,3,4,6,-3,5,-4,-5,-6,7,-7,8,-8,-9],Vh=[[[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]],[[253,136,254,255,228,219,128,128,128,128,128],[189,129,242,255,227,213,255,219,128,128,128],[106,126,227,252,214,209,255,255,128,128,128]],[[1,98,248,255,236,226,255,255,128,128,128],[181,133,238,254,221,234,255,154,128,128,128],[78,134,202,247,198,180,255,219,128,128,128]],[[1,185,249,255,243,255,128,128,128,128,128],[184,150,247,255,236,224,128,128,128,128,128],[77,110,216,255,236,230,128,128,128,128,128]],[[1,101,251,255,241,255,128,128,128,128,128],[170,139,241,252,236,209,255,255,128,128,128],[37,116,196,243,228,255,255,255,128,128,128]],[[1,204,254,255,245,255,128,128,128,128,128],[207,160,250,255,238,128,128,128,128,128,128],[102,103,231,255,211,171,128,128,128,128,128]],[[1,152,252,255,240,255,128,128,128,128,128],[177,135,243,255,234,225,128,128,128,128,128],[80,129,211,255,194,224,128,128,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[246,1,255,128,128,128,128,128,128,128,128],[255,128,128,128,128,128,128,128,128,128,128]]],[[[198,35,237,223,193,187,162,160,145,155,62],[131,45,198,221,172,176,220,157,252,221,1],[68,47,146,208,149,167,221,162,255,223,128]],[[1,149,241,255,221,224,255,255,128,128,128],[184,141,234,253,222,220,255,199,128,128,128],[81,99,181,242,176,190,249,202,255,255,128]],[[1,129,232,253,214,197,242,196,255,255,128],[99,121,210,250,201,198,255,202,128,128,128],[23,91,163,242,170,187,247,210,255,255,128]],[[1,200,246,255,234,255,128,128,128,128,128],[109,178,241,255,231,245,255,255,128,128,128],[44,130,201,253,205,192,255,255,128,128,128]],[[1,132,239,251,219,209,255,165,128,128,128],[94,136,225,251,218,190,255,255,128,128,128],[22,100,174,245,186,161,255,199,128,128,128]],[[1,182,249,255,232,235,128,128,128,128,128],[124,143,241,255,227,234,128,128,128,128,128],[35,77,181,251,193,211,255,205,128,128,128]],[[1,157,247,255,236,231,255,255,128,128,128],[121,141,235,255,225,227,255,255,128,128,128],[45,99,188,251,195,217,255,224,128,128,128]],[[1,1,251,255,213,255,128,128,128,128,128],[203,1,248,255,255,128,128,128,128,128,128],[137,1,177,255,224,255,128,128,128,128,128]]],[[[253,9,248,251,207,208,255,192,128,128,128],[175,13,224,243,193,185,249,198,255,255,128],[73,17,171,221,161,179,236,167,255,234,128]],[[1,95,247,253,212,183,255,255,128,128,128],[239,90,244,250,211,209,255,255,128,128,128],[155,77,195,248,188,195,255,255,128,128,128]],[[1,24,239,251,218,219,255,205,128,128,128],[201,51,219,255,196,186,128,128,128,128,128],[69,46,190,239,201,218,255,228,128,128,128]],[[1,191,251,255,255,128,128,128,128,128,128],[223,165,249,255,213,255,128,128,128,128,128],[141,124,248,255,255,128,128,128,128,128,128]],[[1,16,248,255,255,128,128,128,128,128,128],[190,36,230,255,236,255,128,128,128,128,128],[149,1,255,128,128,128,128,128,128,128,128]],[[1,226,255,128,128,128,128,128,128,128,128],[247,192,255,128,128,128,128,128,128,128,128],[240,128,255,128,128,128,128,128,128,128,128]],[[1,134,252,255,255,128,128,128,128,128,128],[213,62,250,255,255,128,128,128,128,128,128],[55,93,255,128,128,128,128,128,128,128,128]],[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]]],[[[202,24,213,235,186,191,220,160,240,175,255],[126,38,182,232,169,184,228,174,255,187,128],[61,46,138,219,151,178,240,170,255,216,128]],[[1,112,230,250,199,191,247,159,255,255,128],[166,109,228,252,211,215,255,174,128,128,128],[39,77,162,232,172,180,245,178,255,255,128]],[[1,52,220,246,198,199,249,220,255,255,128],[124,74,191,243,183,193,250,221,255,255,128],[24,71,130,219,154,170,243,182,255,255,128]],[[1,182,225,249,219,240,255,224,128,128,128],[149,150,226,252,216,205,255,171,128,128,128],[28,108,170,242,183,194,254,223,255,255,128]],[[1,81,230,252,204,203,255,192,128,128,128],[123,102,209,247,188,196,255,233,128,128,128],[20,95,153,243,164,173,255,203,128,128,128]],[[1,222,248,255,216,213,128,128,128,128,128],[168,175,246,252,235,205,255,255,128,128,128],[47,116,215,255,211,212,255,255,128,128,128]],[[1,121,236,253,212,214,255,255,128,128,128],[141,84,213,252,201,202,255,219,128,128,128],[42,80,160,240,162,185,255,205,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[244,1,255,128,128,128,128,128,128,128,128],[238,1,255,128,128,128,128,128,128,128,128]]]],vu=[[[231,120,48,89,115,113,120,152,112],[152,179,64,126,170,118,46,70,95],[175,69,143,80,85,82,72,155,103],[56,58,10,171,218,189,17,13,152],[114,26,17,163,44,195,21,10,173],[121,24,80,195,26,62,44,64,85],[144,71,10,38,171,213,144,34,26],[170,46,55,19,136,160,33,206,71],[63,20,8,114,114,208,12,9,226],[81,40,11,96,182,84,29,16,36]],[[134,183,89,137,98,101,106,165,148],[72,187,100,130,157,111,32,75,80],[66,102,167,99,74,62,40,234,128],[41,53,9,178,241,141,26,8,107],[74,43,26,146,73,166,49,23,157],[65,38,105,160,51,52,31,115,128],[104,79,12,27,217,255,87,17,7],[87,68,71,44,114,51,15,186,23],[47,41,14,110,182,183,21,17,194],[66,45,25,102,197,189,23,18,22]],[[88,88,147,150,42,46,45,196,205],[43,97,183,117,85,38,35,179,61],[39,53,200,87,26,21,43,232,171],[56,34,51,104,114,102,29,93,77],[39,28,85,171,58,165,90,98,64],[34,22,116,206,23,34,43,166,73],[107,54,32,26,51,1,81,43,31],[68,25,106,22,64,171,36,225,114],[34,19,21,102,132,188,16,76,124],[62,18,78,95,85,57,50,48,51]],[[193,101,35,159,215,111,89,46,111],[60,148,31,172,219,228,21,18,111],[112,113,77,85,179,255,38,120,114],[40,42,1,196,245,209,10,25,109],[88,43,29,140,166,213,37,43,154],[61,63,30,155,67,45,68,1,209],[100,80,8,43,154,1,51,26,71],[142,78,78,16,255,128,34,197,171],[41,40,5,102,211,183,4,1,221],[51,50,17,168,209,192,23,25,82]],[[138,31,36,171,27,166,38,44,229],[67,87,58,169,82,115,26,59,179],[63,59,90,180,59,166,93,73,154],[40,40,21,116,143,209,34,39,175],[47,15,16,183,34,223,49,45,183],[46,17,33,183,6,98,15,32,183],[57,46,22,24,128,1,54,17,37],[65,32,73,115,28,128,23,128,205],[40,3,9,115,51,192,18,6,223],[87,37,9,115,59,77,64,21,47]],[[104,55,44,218,9,54,53,130,226],[64,90,70,205,40,41,23,26,57],[54,57,112,184,5,41,38,166,213],[30,34,26,133,152,116,10,32,134],[39,19,53,221,26,114,32,73,255],[31,9,65,234,2,15,1,118,73],[75,32,12,51,192,255,160,43,51],[88,31,35,67,102,85,55,186,85],[56,21,23,111,59,205,45,37,192],[55,38,70,124,73,102,1,34,98]],[[125,98,42,88,104,85,117,175,82],[95,84,53,89,128,100,113,101,45],[75,79,123,47,51,128,81,171,1],[57,17,5,71,102,57,53,41,49],[38,33,13,121,57,73,26,1,85],[41,10,67,138,77,110,90,47,114],[115,21,2,10,102,255,166,23,6],[101,29,16,10,85,128,101,196,26],[57,18,10,102,102,213,34,20,43],[117,20,15,36,163,128,68,1,26]],[[102,61,71,37,34,53,31,243,192],[69,60,71,38,73,119,28,222,37],[68,45,128,34,1,47,11,245,171],[62,17,19,70,146,85,55,62,70],[37,43,37,154,100,163,85,160,1],[63,9,92,136,28,64,32,201,85],[75,15,9,9,64,255,184,119,16],[86,6,28,5,64,255,25,248,1],[56,8,17,132,137,255,55,116,128],[58,15,20,82,135,57,26,121,40]],[[164,50,31,137,154,133,25,35,218],[51,103,44,131,131,123,31,6,158],[86,40,64,135,148,224,45,183,128],[22,26,17,131,240,154,14,1,209],[45,16,21,91,64,222,7,1,197],[56,21,39,155,60,138,23,102,213],[83,12,13,54,192,255,68,47,28],[85,26,85,85,128,128,32,146,171],[18,11,7,63,144,171,4,4,246],[35,27,10,146,174,171,12,26,128]],[[190,80,35,99,180,80,126,54,45],[85,126,47,87,176,51,41,20,32],[101,75,128,139,118,146,116,128,85],[56,41,15,176,236,85,37,9,62],[71,30,17,119,118,255,17,18,138],[101,38,60,138,55,70,43,26,142],[146,36,19,30,171,255,97,27,20],[138,45,61,62,219,1,81,188,64],[32,41,20,117,151,142,20,21,163],[112,19,12,61,195,128,48,4,24]]],Za=[[[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[176,246,255,255,255,255,255,255,255,255,255],[223,241,252,255,255,255,255,255,255,255,255],[249,253,253,255,255,255,255,255,255,255,255]],[[255,244,252,255,255,255,255,255,255,255,255],[234,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255]],[[255,246,254,255,255,255,255,255,255,255,255],[239,253,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[251,255,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[251,254,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,254,253,255,254,255,255,255,255,255,255],[250,255,254,255,254,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[217,255,255,255,255,255,255,255,255,255,255],[225,252,241,253,255,255,254,255,255,255,255],[234,250,241,250,253,255,253,254,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[223,254,254,255,255,255,255,255,255,255,255],[238,253,254,254,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[249,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,255,255,255,255,255,255,255,255,255],[247,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[252,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[186,251,250,255,255,255,255,255,255,255,255],[234,251,244,254,255,255,255,255,255,255,255],[251,251,243,253,254,255,254,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[236,253,254,255,255,255,255,255,255,255,255],[251,253,253,254,254,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[254,254,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[254,254,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[248,255,255,255,255,255,255,255,255,255,255],[250,254,252,254,255,255,255,255,255,255,255],[248,254,249,253,255,255,255,255,255,255,255]],[[255,253,253,255,255,255,255,255,255,255,255],[246,253,253,255,255,255,255,255,255,255,255],[252,254,251,254,254,255,255,255,255,255,255]],[[255,254,252,255,255,255,255,255,255,255,255],[248,254,253,255,255,255,255,255,255,255,255],[253,255,254,254,255,255,255,255,255,255,255]],[[255,251,254,255,255,255,255,255,255,255,255],[245,251,254,255,255,255,255,255,255,255,255],[253,253,254,255,255,255,255,255,255,255,255]],[[255,251,253,255,255,255,255,255,255,255,255],[252,253,254,255,255,255,255,255,255,255,255],[255,254,255,255,255,255,255,255,255,255,255]],[[255,252,255,255,255,255,255,255,255,255,255],[249,255,254,255,255,255,255,255,255,255,255],[255,255,254,255,255,255,255,255,255,255,255]],[[255,255,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]]],pn=[0,1,2,3,6,4,5,6,6,6,6,6,6,6,6,7,0],Ya=[],To=[],Ql=[],Vu=1,xu=2,$l=[],ni=[];vr("UpsampleRgbLinePair",pi,3),vr("UpsampleBgrLinePair",as,3),vr("UpsampleRgbaLinePair",Wo,4),vr("UpsampleBgraLinePair",zn,4),vr("UpsampleArgbLinePair",Do,4),vr("UpsampleRgba4444LinePair",gi,2),vr("UpsampleRgb565LinePair",rs,2);var Gu=Ue.UpsampleRgbLinePair,mh=Ue.UpsampleBgrLinePair,So=Ue.UpsampleRgbaLinePair,Vs=Ue.UpsampleBgraLinePair,wl=Ue.UpsampleArgbLinePair,el=Ue.UpsampleRgba4444LinePair,wu=Ue.UpsampleRgb565LinePair,Gh=16,Bu=1<<Gh-1,Cu=-227,Qh=482,xf=6,_o=(256<<xf)-1,Fi=0,un=s(256),$h=s(256),bc=s(256),wf=s(256),$c=s(Qh-Cu),Bl=s(Qh-Cu);Ti("YuvToRgbRow",pi,3),Ti("YuvToBgrRow",as,3),Ti("YuvToRgbaRow",Wo,4),Ti("YuvToBgraRow",zn,4),Ti("YuvToArgbRow",Do,4),Ti("YuvToRgba4444Row",gi,2),Ti("YuvToRgb565Row",rs,2);var Cl=[0,4,8,12,128,132,136,140,256,260,264,268,384,388,392,396],ci=[0,2,8],vn=[8,7,6,4,4,2,2,2,1,1,1,1],Wn=1;this.WebPDecodeRGBA=function(z,X,E,c,y){var B=Hc,S=new xo,F=new $t;S.ba=F,F.S=B,F.width=[F.width],F.height=[F.height];var H=F.width,j=F.height,Z=new Wt;if(Z==null||z==null)var se=2;else e(Z!=null),se=Oc(z,X,E,Z.width,Z.height,Z.Pd,Z.Qd,Z.format,null);if(se!=0?H=0:(H!=null&&(H[0]=Z.width[0]),j!=null&&(j[0]=Z.height[0]),H=1),H){F.width=F.width[0],F.height=F.height[0],c!=null&&(c[0]=F.width),y!=null&&(y[0]=F.height);e:{if(c=new wa,(y=new wo).data=z,y.w=X,y.ha=E,y.kd=1,X=[0],e(y!=null),((z=Oc(y.data,y.w,y.ha,null,null,null,X,null,y))==0||z==7)&&X[0]&&(z=4),(X=z)==0){if(e(S!=null),c.data=y.data,c.w=y.w+y.offset,c.ha=y.ha-y.offset,c.put=ht,c.ac=Se,c.bc=At,c.ma=S,y.xa){if((z=Gn())==null){S=1;break e}if(function(he,ue){var Te=[0],Fe=[0],Ee=[0];t:for(;;){if(he==null)return 0;if(ue==null)return he.a=2,0;if(he.l=ue,he.a=0,Kt(he.m,ue.data,ue.w,ue.ha),!_t(he.m,Te,Fe,Ee)){he.a=3;break t}if(he.xb=xu,ue.width=Te[0],ue.height=Fe[0],!Ln(Te[0],Fe[0],1,he,null))break t;return 1}return e(he.a!=0),0}(z,c)){if(c=(X=no(c.width,c.height,S.Oa,S.ba))==0){t:{c=z;r:for(;;){if(c==null){c=0;break t}if(e(c.s.yc!=null),e(c.s.Ya!=null),e(0<c.s.Wb),e((E=c.l)!=null),e((y=E.ma)!=null),c.xb!=0){if(c.ca=y.ba,c.tb=y.tb,e(c.ca!=null),!Wa(y.Oa,E,_c)){c.a=2;break r}if(!Un(c,E.width)||E.da)break r;if((E.da||Ve(c.ca.S))&&rr(),11>c.ca.S||(alert("todo:WebPInitConvertARGBToYUV"),c.ca.f.kb.F!=null&&rr()),c.Pb&&0<c.s.ua&&c.s.vb.X==null&&!on(c.s.vb,c.s.Wa.Xa)){c.a=1;break r}c.xb=0}if(!_n(c,c.V,c.Ba,c.c,c.i,E.o,Pr))break r;y.Dc=c.Ma,c=1;break t}e(c.a!=0),c=0}c=!c}c&&(X=z.a)}else X=z.a}else{if((z=new ts)==null){S=1;break e}if(z.Fa=y.na,z.P=y.P,z.qc=y.Sa,Vi(z,c)){if((X=no(c.width,c.height,S.Oa,S.ba))==0){if(z.Aa=0,E=S.Oa,e((y=z)!=null),E!=null){if(0<(H=0>(H=E.Md)?0:100<H?255:255*H/100)){for(j=Z=0;4>j;++j)12>(se=y.pb[j]).lc&&(se.ia=H*vn[0>se.lc?0:se.lc]>>3),Z|=se.ia;Z&&(alert("todo:VP8InitRandom"),y.ia=1)}y.Ga=E.Id,100<y.Ga?y.Ga=100:0>y.Ga&&(y.Ga=0)}uh(z,c)||(X=z.a)}}else X=z.a}X==0&&S.Oa!=null&&S.Oa.fd&&(X=ml(S.ba))}S=X}B=S!=0?null:11>B?F.f.RGBA.eb:F.f.kb.y}else B=null;return B};var Eu=[3,4,3,4,4,2,2,4,4,4,2,1,1]};function f(Ue,st){for(var at="",Le=0;Le<4;Le++)at+=String.fromCharCode(Ue[st++]);return at}function _(Ue,st){return(Ue[st+0]<<0|Ue[st+1]<<8|Ue[st+2]<<16)>>>0}function x(Ue,st){return(Ue[st+0]<<0|Ue[st+1]<<8|Ue[st+2]<<16|Ue[st+3]<<24)>>>0}new h;var T=[0],I=[0],N=[],$=new h,W=r,Y=function(Ue,st){var at={},Le=0,ze=!1,tt=0,Ne=0;if(at.frames=[],!function(ut,Bt,St,jt){for(var qt=0;qt<jt;qt++)if(ut[Bt+qt]!=St.charCodeAt(qt))return!0;return!1}(Ue,st,"RIFF",4)){var Ht,Vt;for(x(Ue,st+=4),st+=8;st<Ue.length;){var Jt=f(Ue,st),Kt=x(Ue,st+=4);st+=4;var er=Kt+(1&Kt);switch(Jt){case"VP8 ":case"VP8L":at.frames[Le]===void 0&&(at.frames[Le]={}),($e=at.frames[Le]).src_off=ze?Ne:st-8,$e.src_size=tt+Kt+8,Le++,ze&&(ze=!1,tt=0,Ne=0);break;case"VP8X":($e=at.header={}).feature_flags=Ue[st];var Xt=st+4;$e.canvas_width=1+_(Ue,Xt),Xt+=3,$e.canvas_height=1+_(Ue,Xt),Xt+=3;break;case"ALPH":ze=!0,tt=er+8,Ne=st-8;break;case"ANIM":($e=at.header).bgcolor=x(Ue,st),Xt=st+4,$e.loop_count=(Ht=Ue)[(Vt=Xt)+0]<<0|Ht[Vt+1]<<8,Xt+=2;break;case"ANMF":var Fr,$e;($e=at.frames[Le]={}).offset_x=2*_(Ue,st),st+=3,$e.offset_y=2*_(Ue,st),st+=3,$e.width=1+_(Ue,st),st+=3,$e.height=1+_(Ue,st),st+=3,$e.duration=_(Ue,st),st+=3,Fr=Ue[st++],$e.dispose=1&Fr,$e.blend=Fr>>1&1}Jt!="ANMF"&&(st+=er)}return at}}(W,0);Y.response=W,Y.rgbaoutput=!0,Y.dataurl=!1;var ie=Y.header?Y.header:null,ce=Y.frames?Y.frames:null;if(ie){ie.loop_counter=ie.loop_count,T=[ie.canvas_height],I=[ie.canvas_width];for(var fe=0;fe<ce.length&&ce[fe].blend!=0;fe++);}var ve=ce[0],be=$.WebPDecodeRGBA(W,ve.src_off,ve.src_size,I,T);ve.rgba=be,ve.imgwidth=I[0],ve.imgheight=T[0];for(var Qe=0;Qe<I[0]*T[0]*4;Qe++)N[Qe]=be[Qe];return this.width=I,this.height=T,this.data=N,this}(function(r){var e=function(){return typeof dR=="function"},t=function(T,I,N,$){var W=4,Y=a;switch($){case r.image_compression.FAST:W=1,Y=s;break;case r.image_compression.MEDIUM:W=6,Y=o;break;case r.image_compression.SLOW:W=9,Y=h}T=n(T,I,N,Y);var ie=dR(T,{level:W});return r.__addimage__.arrayBufferToBinaryString(ie)},n=function(T,I,N,$){for(var W,Y,ie,ce=T.length/I,fe=new Uint8Array(T.length+ce),ve=_(),be=0;be<ce;be+=1){if(ie=be*I,W=T.subarray(ie,ie+I),$)fe.set($(W,N,Y),ie+be);else{for(var Qe,Ue=ve.length,st=[];Qe<Ue;Qe+=1)st[Qe]=ve[Qe](W,N,Y);var at=x(st.concat());fe.set(st[at],ie+be)}Y=W}return fe},i=function(T){var I=Array.apply([],T);return I.unshift(0),I},s=function(T,I){var N,$=[],W=T.length;$[0]=1;for(var Y=0;Y<W;Y+=1)N=T[Y-I]||0,$[Y+1]=T[Y]-N+256&255;return $},a=function(T,I,N){var $,W=[],Y=T.length;W[0]=2;for(var ie=0;ie<Y;ie+=1)$=N&&N[ie]||0,W[ie+1]=T[ie]-$+256&255;return W},o=function(T,I,N){var $,W,Y=[],ie=T.length;Y[0]=3;for(var ce=0;ce<ie;ce+=1)$=T[ce-I]||0,W=N&&N[ce]||0,Y[ce+1]=T[ce]+256-($+W>>>1)&255;return Y},h=function(T,I,N){var $,W,Y,ie,ce=[],fe=T.length;ce[0]=4;for(var ve=0;ve<fe;ve+=1)$=T[ve-I]||0,W=N&&N[ve]||0,Y=N&&N[ve-I]||0,ie=f($,W,Y),ce[ve+1]=T[ve]-ie+256&255;return ce},f=function(T,I,N){if(T===I&&I===N)return T;var $=Math.abs(I-N),W=Math.abs(T-N),Y=Math.abs(T+I-N-N);return $<=W&&$<=Y?T:W<=Y?I:N},_=function(){return[i,s,a,o,h]},x=function(T){var I=T.map(function(N){return N.reduce(function($,W){return $+Math.abs(W)},0)});return I.indexOf(Math.min.apply(null,I))};r.processPNG=function(T,I,N,$){var W,Y,ie,ce,fe,ve,be,Qe,Ue,st,at,Le,ze,tt,Ne,Ht=this.decode.FLATE_DECODE,Vt="";if(this.__addimage__.isArrayBuffer(T)&&(T=new Uint8Array(T)),this.__addimage__.isArrayBufferView(T)){if(T=(ie=new S5e(T)).imgData,Y=ie.bits,W=ie.colorSpace,fe=ie.colors,[4,6].indexOf(ie.colorType)!==-1){if(ie.bits===8){Ue=(Qe=ie.pixelBitlength==32?new Uint32Array(ie.decodePixels().buffer):ie.pixelBitlength==16?new Uint16Array(ie.decodePixels().buffer):new Uint8Array(ie.decodePixels().buffer)).length,at=new Uint8Array(Ue*ie.colors),st=new Uint8Array(Ue);var Jt,Kt=ie.pixelBitlength-ie.bits;for(tt=0,Ne=0;tt<Ue;tt++){for(ze=Qe[tt],Jt=0;Jt<Kt;)at[Ne++]=ze>>>Jt&255,Jt+=ie.bits;st[tt]=ze>>>Jt&255}}if(ie.bits===16){Ue=(Qe=new Uint32Array(ie.decodePixels().buffer)).length,at=new Uint8Array(Ue*(32/ie.pixelBitlength)*ie.colors),st=new Uint8Array(Ue*(32/ie.pixelBitlength)),Le=ie.colors>1,tt=0,Ne=0;for(var er=0;tt<Ue;)ze=Qe[tt++],at[Ne++]=ze>>>0&255,Le&&(at[Ne++]=ze>>>16&255,ze=Qe[tt++],at[Ne++]=ze>>>0&255),st[er++]=ze>>>16&255;Y=8}$!==r.image_compression.NONE&&e()?(T=t(at,ie.width*ie.colors,ie.colors,$),be=t(st,ie.width,1,$)):(T=at,be=st,Ht=void 0)}if(ie.colorType===3&&(W=this.color_spaces.INDEXED,ve=ie.palette,ie.transparency.indexed)){var Xt=ie.transparency.indexed,Fr=0;for(tt=0,Ue=Xt.length;tt<Ue;++tt)Fr+=Xt[tt];if((Fr/=255)===Ue-1&&Xt.indexOf(0)!==-1)ce=[Xt.indexOf(0)];else if(Fr!==Ue){for(Qe=ie.decodePixels(),st=new Uint8Array(Qe.length),tt=0,Ue=Qe.length;tt<Ue;tt++)st[tt]=Xt[Qe[tt]];be=t(st,ie.width,1)}}var $e=function(ut){var Bt;switch(ut){case r.image_compression.FAST:Bt=11;break;case r.image_compression.MEDIUM:Bt=13;break;case r.image_compression.SLOW:Bt=14;break;default:Bt=12}return Bt}($);return Ht===this.decode.FLATE_DECODE&&(Vt="/Predictor "+$e+" "),Vt+="/Colors "+fe+" /BitsPerComponent "+Y+" /Columns "+ie.width,(this.__addimage__.isArrayBuffer(T)||this.__addimage__.isArrayBufferView(T))&&(T=this.__addimage__.arrayBufferToBinaryString(T)),(be&&this.__addimage__.isArrayBuffer(be)||this.__addimage__.isArrayBufferView(be))&&(be=this.__addimage__.arrayBufferToBinaryString(be)),{alias:N,data:T,index:I,filter:Ht,decodeParameters:Vt,transparency:ce,palette:ve,sMask:be,predictor:$e,width:ie.width,height:ie.height,bitsPerComponent:Y,colorSpace:W}}}})(yi.API),function(r){r.processGIF89A=function(e,t,n,i){var s=new I5e(e),a=s.width,o=s.height,h=[];s.decodeAndBlitFrameRGBA(0,h);var f={data:h,width:a,height:o},_=new BR(100).encode(f,100);return r.processJPEG.call(this,_,t,n,i)},r.processGIF87A=r.processGIF89A}(yi.API),sf.prototype.parseHeader=function(){if(this.fileSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.datav.getUint32(this.pos,!0),this.pos+=4,this.offset=this.datav.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.width=this.datav.getUint32(this.pos,!0),this.pos+=4,this.height=this.datav.getInt32(this.pos,!0),this.pos+=4,this.planes=this.datav.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.datav.getUint16(this.pos,!0),this.pos+=2,this.compress=this.datav.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.hr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.vr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.colors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.bitPP===16&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){var r=this.colors===0?1<<this.bitPP:this.colors;this.palette=new Array(r);for(var e=0;e<r;e++){var t=this.datav.getUint8(this.pos++,!0),n=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0);this.palette[e]={red:i,green:n,blue:t,quad:s}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)},sf.prototype.parseBGR=function(){this.pos=this.offset;try{var r="bit"+this.bitPP,e=this.width*this.height*4;this.data=new Uint8Array(e),this[r]()}catch(t){po.log("bit decode error:"+t)}},sf.prototype.bit1=function(){var r,e=Math.ceil(this.width/8),t=e%4;for(r=this.height-1;r>=0;r--){for(var n=this.bottom_up?r:this.height-1-r,i=0;i<e;i++)for(var s=this.datav.getUint8(this.pos++,!0),a=n*this.width*4+8*i*4,o=0;o<8&&8*i+o<this.width;o++){var h=this.palette[s>>7-o&1];this.data[a+4*o]=h.blue,this.data[a+4*o+1]=h.green,this.data[a+4*o+2]=h.red,this.data[a+4*o+3]=255}t!==0&&(this.pos+=4-t)}},sf.prototype.bit4=function(){for(var r=Math.ceil(this.width/2),e=r%4,t=this.height-1;t>=0;t--){for(var n=this.bottom_up?t:this.height-1-t,i=0;i<r;i++){var s=this.datav.getUint8(this.pos++,!0),a=n*this.width*4+2*i*4,o=s>>4,h=15&s,f=this.palette[o];if(this.data[a]=f.blue,this.data[a+1]=f.green,this.data[a+2]=f.red,this.data[a+3]=255,2*i+1>=this.width)break;f=this.palette[h],this.data[a+4]=f.blue,this.data[a+4+1]=f.green,this.data[a+4+2]=f.red,this.data[a+4+3]=255}e!==0&&(this.pos+=4-e)}},sf.prototype.bit8=function(){for(var r=this.width%4,e=this.height-1;e>=0;e--){for(var t=this.bottom_up?e:this.height-1-e,n=0;n<this.width;n++){var i=this.datav.getUint8(this.pos++,!0),s=t*this.width*4+4*n;if(i<this.palette.length){var a=this.palette[i];this.data[s]=a.red,this.data[s+1]=a.green,this.data[s+2]=a.blue,this.data[s+3]=255}else this.data[s]=255,this.data[s+1]=255,this.data[s+2]=255,this.data[s+3]=255}r!==0&&(this.pos+=4-r)}},sf.prototype.bit15=function(){for(var r=this.width%3,e=parseInt("11111",2),t=this.height-1;t>=0;t--){for(var n=this.bottom_up?t:this.height-1-t,i=0;i<this.width;i++){var s=this.datav.getUint16(this.pos,!0);this.pos+=2;var a=(s&e)/e*255|0,o=(s>>5&e)/e*255|0,h=(s>>10&e)/e*255|0,f=s>>15?255:0,_=n*this.width*4+4*i;this.data[_]=h,this.data[_+1]=o,this.data[_+2]=a,this.data[_+3]=f}this.pos+=r}},sf.prototype.bit16=function(){for(var r=this.width%3,e=parseInt("11111",2),t=parseInt("111111",2),n=this.height-1;n>=0;n--){for(var i=this.bottom_up?n:this.height-1-n,s=0;s<this.width;s++){var a=this.datav.getUint16(this.pos,!0);this.pos+=2;var o=(a&e)/e*255|0,h=(a>>5&t)/t*255|0,f=(a>>11)/e*255|0,_=i*this.width*4+4*s;this.data[_]=f,this.data[_+1]=h,this.data[_+2]=o,this.data[_+3]=255}this.pos+=r}},sf.prototype.bit24=function(){for(var r=this.height-1;r>=0;r--){for(var e=this.bottom_up?r:this.height-1-r,t=0;t<this.width;t++){var n=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0),a=e*this.width*4+4*t;this.data[a]=s,this.data[a+1]=i,this.data[a+2]=n,this.data[a+3]=255}this.pos+=this.width%4}},sf.prototype.bit32=function(){for(var r=this.height-1;r>=0;r--)for(var e=this.bottom_up?r:this.height-1-r,t=0;t<this.width;t++){var n=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0),o=e*this.width*4+4*t;this.data[o]=s,this.data[o+1]=i,this.data[o+2]=n,this.data[o+3]=a}},sf.prototype.getData=function(){return this.data},function(r){r.processBMP=function(e,t,n,i){var s=new sf(e,!1),a=s.width,o=s.height,h={data:s.getData(),width:a,height:o},f=new BR(100).encode(h,100);return r.processJPEG.call(this,f,t,n,i)}}(yi.API),b$.prototype.getData=function(){return this.data},function(r){r.processWEBP=function(e,t,n,i){var s=new b$(e),a=s.width,o=s.height,h={data:s.getData(),width:a,height:o},f=new BR(100).encode(h,100);return r.processJPEG.call(this,f,t,n,i)}}(yi.API),yi.API.processRGBA=function(r,e,t){for(var n=r.data,i=n.length,s=new Uint8Array(i/4*3),a=new Uint8Array(i/4),o=0,h=0,f=0;f<i;f+=4){var _=n[f],x=n[f+1],T=n[f+2],I=n[f+3];s[o++]=_,s[o++]=x,s[o++]=T,a[h++]=I}var N=this.__addimage__.arrayBufferToBinaryString(s);return{alpha:this.__addimage__.arrayBufferToBinaryString(a),data:N,index:e,alias:t,colorSpace:"DeviceRGB",bitsPerComponent:8,width:r.width,height:r.height}},yi.API.setLanguage=function(r){return this.internal.languageSettings===void 0&&(this.internal.languageSettings={},this.internal.languageSettings.isSubscribed=!1),{af:"Afrikaans",sq:"Albanian",ar:"Arabic (Standard)","ar-DZ":"Arabic (Algeria)","ar-BH":"Arabic (Bahrain)","ar-EG":"Arabic (Egypt)","ar-IQ":"Arabic (Iraq)","ar-JO":"Arabic (Jordan)","ar-KW":"Arabic (Kuwait)","ar-LB":"Arabic (Lebanon)","ar-LY":"Arabic (Libya)","ar-MA":"Arabic (Morocco)","ar-OM":"Arabic (Oman)","ar-QA":"Arabic (Qatar)","ar-SA":"Arabic (Saudi Arabia)","ar-SY":"Arabic (Syria)","ar-TN":"Arabic (Tunisia)","ar-AE":"Arabic (U.A.E.)","ar-YE":"Arabic (Yemen)",an:"Aragonese",hy:"Armenian",as:"Assamese",ast:"Asturian",az:"Azerbaijani",eu:"Basque",be:"Belarusian",bn:"Bengali",bs:"Bosnian",br:"Breton",bg:"Bulgarian",my:"Burmese",ca:"Catalan",ch:"Chamorro",ce:"Chechen",zh:"Chinese","zh-HK":"Chinese (Hong Kong)","zh-CN":"Chinese (PRC)","zh-SG":"Chinese (Singapore)","zh-TW":"Chinese (Taiwan)",cv:"Chuvash",co:"Corsican",cr:"Cree",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch (Standard)","nl-BE":"Dutch (Belgian)",en:"English","en-AU":"English (Australia)","en-BZ":"English (Belize)","en-CA":"English (Canada)","en-IE":"English (Ireland)","en-JM":"English (Jamaica)","en-NZ":"English (New Zealand)","en-PH":"English (Philippines)","en-ZA":"English (South Africa)","en-TT":"English (Trinidad & Tobago)","en-GB":"English (United Kingdom)","en-US":"English (United States)","en-ZW":"English (Zimbabwe)",eo:"Esperanto",et:"Estonian",fo:"Faeroese",fj:"Fijian",fi:"Finnish",fr:"French (Standard)","fr-BE":"French (Belgium)","fr-CA":"French (Canada)","fr-FR":"French (France)","fr-LU":"French (Luxembourg)","fr-MC":"French (Monaco)","fr-CH":"French (Switzerland)",fy:"Frisian",fur:"Friulian",gd:"Gaelic (Scots)","gd-IE":"Gaelic (Irish)",gl:"Galacian",ka:"Georgian",de:"German (Standard)","de-AT":"German (Austria)","de-DE":"German (Germany)","de-LI":"German (Liechtenstein)","de-LU":"German (Luxembourg)","de-CH":"German (Switzerland)",el:"Greek",gu:"Gujurati",ht:"Haitian",he:"Hebrew",hi:"Hindi",hu:"Hungarian",is:"Icelandic",id:"Indonesian",iu:"Inuktitut",ga:"Irish",it:"Italian (Standard)","it-CH":"Italian (Switzerland)",ja:"Japanese",kn:"Kannada",ks:"Kashmiri",kk:"Kazakh",km:"Khmer",ky:"Kirghiz",tlh:"Klingon",ko:"Korean","ko-KP":"Korean (North Korea)","ko-KR":"Korean (South Korea)",la:"Latin",lv:"Latvian",lt:"Lithuanian",lb:"Luxembourgish",mk:"North Macedonia",ms:"Malay",ml:"Malayalam",mt:"Maltese",mi:"Maori",mr:"Marathi",mo:"Moldavian",nv:"Navajo",ng:"Ndonga",ne:"Nepali",no:"Norwegian",nb:"Norwegian (Bokmal)",nn:"Norwegian (Nynorsk)",oc:"Occitan",or:"Oriya",om:"Oromo",fa:"Persian","fa-IR":"Persian/Iran",pl:"Polish",pt:"Portuguese","pt-BR":"Portuguese (Brazil)",pa:"Punjabi","pa-IN":"Punjabi (India)","pa-PK":"Punjabi (Pakistan)",qu:"Quechua",rm:"Rhaeto-Romanic",ro:"Romanian","ro-MO":"Romanian (Moldavia)",ru:"Russian","ru-MO":"Russian (Moldavia)",sz:"Sami (Lappish)",sg:"Sango",sa:"Sanskrit",sc:"Sardinian",sd:"Sindhi",si:"Singhalese",sr:"Serbian",sk:"Slovak",sl:"Slovenian",so:"Somani",sb:"Sorbian",es:"Spanish","es-AR":"Spanish (Argentina)","es-BO":"Spanish (Bolivia)","es-CL":"Spanish (Chile)","es-CO":"Spanish (Colombia)","es-CR":"Spanish (Costa Rica)","es-DO":"Spanish (Dominican Republic)","es-EC":"Spanish (Ecuador)","es-SV":"Spanish (El Salvador)","es-GT":"Spanish (Guatemala)","es-HN":"Spanish (Honduras)","es-MX":"Spanish (Mexico)","es-NI":"Spanish (Nicaragua)","es-PA":"Spanish (Panama)","es-PY":"Spanish (Paraguay)","es-PE":"Spanish (Peru)","es-PR":"Spanish (Puerto Rico)","es-ES":"Spanish (Spain)","es-UY":"Spanish (Uruguay)","es-VE":"Spanish (Venezuela)",sx:"Sutu",sw:"Swahili",sv:"Swedish","sv-FI":"Swedish (Finland)","sv-SV":"Swedish (Sweden)",ta:"Tamil",tt:"Tatar",te:"Teluga",th:"Thai",tig:"Tigre",ts:"Tsonga",tn:"Tswana",tr:"Turkish",tk:"Turkmen",uk:"Ukrainian",hsb:"Upper Sorbian",ur:"Urdu",ve:"Venda",vi:"Vietnamese",vo:"Volapuk",wa:"Walloon",cy:"Welsh",xh:"Xhosa",ji:"Yiddish",zu:"Zulu"}[r]!==void 0&&(this.internal.languageSettings.languageCode=r,this.internal.languageSettings.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){this.internal.write("/Lang ("+this.internal.languageSettings.languageCode+")")}),this.internal.languageSettings.isSubscribed=!0)),this},k0=yi.API,NB=k0.getCharWidthsArray=function(r,e){var t,n,i=(e=e||{}).font||this.internal.getFont(),s=e.fontSize||this.internal.getFontSize(),a=e.charSpace||this.internal.getCharSpace(),o=e.widths?e.widths:i.metadata.Unicode.widths,h=o.fof?o.fof:1,f=e.kerning?e.kerning:i.metadata.Unicode.kerning,_=f.fof?f.fof:1,x=e.doKerning!==!1,T=0,I=r.length,N=0,$=o[0]||h,W=[];for(t=0;t<I;t++)n=r.charCodeAt(t),typeof i.metadata.widthOfString=="function"?W.push((i.metadata.widthOfGlyph(i.metadata.characterToGlyph(n))+a*(1e3/s)||0)/1e3):(T=x&&Ms(f[n])==="object"&&!isNaN(parseInt(f[n][N],10))?f[n][N]/_:0,W.push((o[n]||$)/h+T)),N=n;return W},g$=k0.getStringUnitWidth=function(r,e){var t=(e=e||{}).fontSize||this.internal.getFontSize(),n=e.font||this.internal.getFont(),i=e.charSpace||this.internal.getCharSpace();return k0.processArabic&&(r=k0.processArabic(r)),typeof n.metadata.widthOfString=="function"?n.metadata.widthOfString(r,t,i)/t:NB.apply(this,arguments).reduce(function(s,a){return s+a},0)},m$=function(r,e,t,n){for(var i=[],s=0,a=r.length,o=0;s!==a&&o+e[s]<t;)o+=e[s],s++;i.push(r.slice(0,s));var h=s;for(o=0;s!==a;)o+e[s]>n&&(i.push(r.slice(h,s)),o=0,h=s),o+=e[s],s++;return h!==s&&i.push(r.slice(h,s)),i},_$=function(r,e,t){t||(t={});var n,i,s,a,o,h,f,_=[],x=[_],T=t.textIndent||0,I=0,N=0,$=r.split(" "),W=NB.apply(this,[" ",t])[0];if(h=t.lineIndent===-1?$[0].length+2:t.lineIndent||0){var Y=Array(h).join(" "),ie=[];$.map(function(fe){(fe=fe.split(/\s*\n/)).length>1?ie=ie.concat(fe.map(function(ve,be){return(be&&ve.length?`
`:"")+ve})):ie.push(fe[0])}),$=ie,h=g$.apply(this,[Y,t])}for(s=0,a=$.length;s<a;s++){var ce=0;if(n=$[s],h&&n[0]==`
`&&(n=n.substr(1),ce=1),T+I+(N=(i=NB.apply(this,[n,t])).reduce(function(fe,ve){return fe+ve},0))>e||ce){if(N>e){for(o=m$.apply(this,[n,i,e-(T+I),e]),_.push(o.shift()),_=[o.pop()];o.length;)x.push([o.shift()]);N=i.slice(n.length-(_[0]?_[0].length:0)).reduce(function(fe,ve){return fe+ve},0)}else _=[n];x.push(_),T=N+h,I=W}else _.push(n),T+=I+N,I=W}return f=h?function(fe,ve){return(ve?Y:"")+fe.join(" ")}:function(fe){return fe.join(" ")},x.map(f)},k0.splitTextToSize=function(r,e,t){var n,i=(t=t||{}).fontSize||this.internal.getFontSize(),s=(function(_){if(_.widths&&_.kerning)return{widths:_.widths,kerning:_.kerning};var x=this.internal.getFont(_.fontName,_.fontStyle);return x.metadata.Unicode?{widths:x.metadata.Unicode.widths||{0:1},kerning:x.metadata.Unicode.kerning||{}}:{font:x.metadata,fontSize:this.internal.getFontSize(),charSpace:this.internal.getCharSpace()}}).call(this,t);n=Array.isArray(r)?r:String(r).split(/\r?\n/);var a=1*this.internal.scaleFactor*e/i;s.textIndent=t.textIndent?1*t.textIndent*this.internal.scaleFactor/i:0,s.lineIndent=t.lineIndent;var o,h,f=[];for(o=0,h=n.length;o<h;o++)f=f.concat(_$.apply(this,[n[o],a,s]));return f},function(r){r.__fontmetrics__=r.__fontmetrics__||{};for(var e="klmnopqrstuvwxyz",t={},n={},i=0;i<e.length;i++)t[e[i]]="0123456789abcdef"[i],n["0123456789abcdef"[i]]=e[i];var s=function(x){return"0x"+parseInt(x,10).toString(16)},a=r.__fontmetrics__.compress=function(x){var T,I,N,$,W=["{"];for(var Y in x){if(T=x[Y],isNaN(parseInt(Y,10))?I="'"+Y+"'":(Y=parseInt(Y,10),I=(I=s(Y).slice(2)).slice(0,-1)+n[I.slice(-1)]),typeof T=="number")T<0?(N=s(T).slice(3),$="-"):(N=s(T).slice(2),$=""),N=$+N.slice(0,-1)+n[N.slice(-1)];else{if(Ms(T)!=="object")throw new Error("Don't know what to do with value type "+Ms(T)+".");N=a(T)}W.push(I+N)}return W.push("}"),W.join("")},o=r.__fontmetrics__.uncompress=function(x){if(typeof x!="string")throw new Error("Invalid argument passed to uncompress.");for(var T,I,N,$,W={},Y=1,ie=W,ce=[],fe="",ve="",be=x.length-1,Qe=1;Qe<be;Qe+=1)($=x[Qe])=="'"?T?(N=T.join(""),T=void 0):T=[]:T?T.push($):$=="{"?(ce.push([ie,N]),ie={},N=void 0):$=="}"?((I=ce.pop())[0][I[1]]=ie,N=void 0,ie=I[0]):$=="-"?Y=-1:N===void 0?t.hasOwnProperty($)?(fe+=t[$],N=parseInt(fe,16)*Y,Y=1,fe=""):fe+=$:t.hasOwnProperty($)?(ve+=t[$],ie[N]=parseInt(ve,16)*Y,Y=1,N=void 0,ve=""):ve+=$;return W},h={codePages:["WinAnsiEncoding"],WinAnsiEncoding:o("{19m8n201n9q201o9r201s9l201t9m201u8m201w9n201x9o201y8o202k8q202l8r202m9p202q8p20aw8k203k8t203t8v203u9v2cq8s212m9t15m8w15n9w2dw9s16k8u16l9u17s9z17x8y17y9y}")},f={Unicode:{Courier:h,"Courier-Bold":h,"Courier-BoldOblique":h,"Courier-Oblique":h,Helvetica:h,"Helvetica-Bold":h,"Helvetica-BoldOblique":h,"Helvetica-Oblique":h,"Times-Roman":h,"Times-Bold":h,"Times-BoldItalic":h,"Times-Italic":h}},_={Unicode:{"Courier-Oblique":o("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-BoldItalic":o("{'widths'{k3o2q4ycx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2r202m2n2n3m2o3m2p5n202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5n4l4m4m4m4n4m4o4s4p4m4q4m4r4s4s4y4t2r4u3m4v4m4w3x4x5t4y4s4z4s5k3x5l4s5m4m5n3r5o3x5p4s5q4m5r5t5s4m5t3x5u3x5v2l5w1w5x2l5y3t5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q2l6r3m6s3r6t1w6u1w6v3m6w1w6x4y6y3r6z3m7k3m7l3m7m2r7n2r7o1w7p3r7q2w7r4m7s3m7t2w7u2r7v2n7w1q7x2n7y3t202l3mcl4mal2ram3man3mao3map3mar3mas2lat4uau1uav3maw3way4uaz2lbk2sbl3t'fof'6obo2lbp3tbq3mbr1tbs2lbu1ybv3mbz3mck4m202k3mcm4mcn4mco4mcp4mcq5ycr4mcs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz2w203k6o212m6o2dw2l2cq2l3t3m3u2l17s3x19m3m}'kerning'{cl{4qu5kt5qt5rs17ss5ts}201s{201ss}201t{cks4lscmscnscoscpscls2wu2yu201ts}201x{2wu2yu}2k{201ts}2w{4qx5kx5ou5qx5rs17su5tu}2x{17su5tu5ou}2y{4qx5kx5ou5qx5rs17ss5ts}'fof'-6ofn{17sw5tw5ou5qw5rs}7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qs}3v{17su5tu5os5qs}7p{17su5tu}ck{4qu5kt5qt5rs17ss5ts}4l{4qu5kt5qt5rs17ss5ts}cm{4qu5kt5qt5rs17ss5ts}cn{4qu5kt5qt5rs17ss5ts}co{4qu5kt5qt5rs17ss5ts}cp{4qu5kt5qt5rs17ss5ts}6l{4qu5ou5qw5rt17su5tu}5q{ckuclucmucnucoucpu4lu}5r{ckuclucmucnucoucpu4lu}7q{cksclscmscnscoscps4ls}6p{4qu5ou5qw5rt17sw5tw}ek{4qu5ou5qw5rt17su5tu}el{4qu5ou5qw5rt17su5tu}em{4qu5ou5qw5rt17su5tu}en{4qu5ou5qw5rt17su5tu}eo{4qu5ou5qw5rt17su5tu}ep{4qu5ou5qw5rt17su5tu}es{17ss5ts5qs4qu}et{4qu5ou5qw5rt17sw5tw}eu{4qu5ou5qw5rt17ss5ts}ev{17ss5ts5qs4qu}6z{17sw5tw5ou5qw5rs}fm{17sw5tw5ou5qw5rs}7n{201ts}fo{17sw5tw5ou5qw5rs}fp{17sw5tw5ou5qw5rs}fq{17sw5tw5ou5qw5rs}7r{cksclscmscnscoscps4ls}fs{17sw5tw5ou5qw5rs}ft{17su5tu}fu{17su5tu}fv{17su5tu}fw{17su5tu}fz{cksclscmscnscoscps4ls}}}"),"Helvetica-Bold":o("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),Courier:o("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-BoldOblique":o("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Bold":o("{'widths'{k3q2q5ncx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2l202m2n2n3m2o3m2p6o202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5x4l4s4m4m4n4s4o4s4p4m4q3x4r4y4s4y4t2r4u3m4v4y4w4m4x5y4y4s4z4y5k3x5l4y5m4s5n3r5o4m5p4s5q4s5r6o5s4s5t4s5u4m5v2l5w1w5x2l5y3u5z3m6k2l6l3m6m3r6n2w6o3r6p2w6q2l6r3m6s3r6t1w6u2l6v3r6w1w6x5n6y3r6z3m7k3r7l3r7m2w7n2r7o2l7p3r7q3m7r4s7s3m7t3m7u2w7v2r7w1q7x2r7y3o202l3mcl4sal2lam3man3mao3map3mar3mas2lat4uau1yav3maw3tay4uaz2lbk2sbl3t'fof'6obo2lbp3rbr1tbs2lbu2lbv3mbz3mck4s202k3mcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3rek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3m3u2l17s4s19m3m}'kerning'{cl{4qt5ks5ot5qy5rw17sv5tv}201t{cks4lscmscnscoscpscls4wv}2k{201ts}2w{4qu5ku7mu5os5qx5ru17su5tu}2x{17su5tu5ou5qs}2y{4qv5kv7mu5ot5qz5ru17su5tu}'fof'-6o7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qu}3v{17su5tu5os5qu}fu{17su5tu5ou5qu}7p{17su5tu5ou5qu}ck{4qt5ks5ot5qy5rw17sv5tv}4l{4qt5ks5ot5qy5rw17sv5tv}cm{4qt5ks5ot5qy5rw17sv5tv}cn{4qt5ks5ot5qy5rw17sv5tv}co{4qt5ks5ot5qy5rw17sv5tv}cp{4qt5ks5ot5qy5rw17sv5tv}6l{17st5tt5ou5qu}17s{ckuclucmucnucoucpu4lu4wu}5o{ckuclucmucnucoucpu4lu4wu}5q{ckzclzcmzcnzcozcpz4lz4wu}5r{ckxclxcmxcnxcoxcpx4lx4wu}5t{ckuclucmucnucoucpu4lu4wu}7q{ckuclucmucnucoucpu4lu}6p{17sw5tw5ou5qu}ek{17st5tt5qu}el{17st5tt5ou5qu}em{17st5tt5qu}en{17st5tt5qu}eo{17st5tt5qu}ep{17st5tt5ou5qu}es{17ss5ts5qu}et{17sw5tw5ou5qu}eu{17sw5tw5ou5qu}ev{17ss5ts5qu}6z{17sw5tw5ou5qu5rs}fm{17sw5tw5ou5qu5rs}fn{17sw5tw5ou5qu5rs}fo{17sw5tw5ou5qu5rs}fp{17sw5tw5ou5qu5rs}fq{17sw5tw5ou5qu5rs}7r{cktcltcmtcntcotcpt4lt5os}fs{17sw5tw5ou5qu5rs}ft{17su5tu5ou5qu}7m{5os}fv{17su5tu5ou5qu}fw{17su5tu5ou5qu}fz{cksclscmscnscoscps4ls}}}"),Symbol:o("{'widths'{k3uaw4r19m3m2k1t2l2l202m2y2n3m2p5n202q6o3k3m2s2l2t2l2v3r2w1t3m3m2y1t2z1wbk2sbl3r'fof'6o3n3m3o3m3p3m3q3m3r3m3s3m3t3m3u1w3v1w3w3r3x3r3y3r3z2wbp3t3l3m5v2l5x2l5z3m2q4yfr3r7v3k7w1o7x3k}'kerning'{'fof'-6o}}"),Helvetica:o("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}"),"Helvetica-BoldOblique":o("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),ZapfDingbats:o("{'widths'{k4u2k1w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-Bold":o("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Italic":o("{'widths'{k3n2q4ycx2l201n3m201o5t201s2l201t2l201u2l201w3r201x3r201y3r2k1t2l2l202m2n2n3m2o3m2p5n202q5t2r1p2s2l2t2l2u3m2v4n2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w4n3x4n3y4n3z3m4k5w4l3x4m3x4n4m4o4s4p3x4q3x4r4s4s4s4t2l4u2w4v4m4w3r4x5n4y4m4z4s5k3x5l4s5m3x5n3m5o3r5p4s5q3x5r5n5s3x5t3r5u3r5v2r5w1w5x2r5y2u5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q1w6r3m6s3m6t1w6u1w6v2w6w1w6x4s6y3m6z3m7k3m7l3m7m2r7n2r7o1w7p3m7q2w7r4m7s2w7t2w7u2r7v2s7w1v7x2s7y3q202l3mcl3xal2ram3man3mao3map3mar3mas2lat4wau1vav3maw4nay4waz2lbk2sbl4n'fof'6obo2lbp3mbq3obr1tbs2lbu1zbv3mbz3mck3x202k3mcm3xcn3xco3xcp3xcq5tcr4mcs3xct3xcu3xcv3xcw2l2m2ucy2lcz2ldl4mdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr4nfs3mft3mfu3mfv3mfw3mfz2w203k6o212m6m2dw2l2cq2l3t3m3u2l17s3r19m3m}'kerning'{cl{5kt4qw}201s{201sw}201t{201tw2wy2yy6q-t}201x{2wy2yy}2k{201tw}2w{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}2x{17ss5ts5os}2y{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}'fof'-6o6t{17ss5ts5qs}7t{5os}3v{5qs}7p{17su5tu5qs}ck{5kt4qw}4l{5kt4qw}cm{5kt4qw}cn{5kt4qw}co{5kt4qw}cp{5kt4qw}6l{4qs5ks5ou5qw5ru17su5tu}17s{2ks}5q{ckvclvcmvcnvcovcpv4lv}5r{ckuclucmucnucoucpu4lu}5t{2ks}6p{4qs5ks5ou5qw5ru17su5tu}ek{4qs5ks5ou5qw5ru17su5tu}el{4qs5ks5ou5qw5ru17su5tu}em{4qs5ks5ou5qw5ru17su5tu}en{4qs5ks5ou5qw5ru17su5tu}eo{4qs5ks5ou5qw5ru17su5tu}ep{4qs5ks5ou5qw5ru17su5tu}es{5ks5qs4qs}et{4qs5ks5ou5qw5ru17su5tu}eu{4qs5ks5qw5ru17su5tu}ev{5ks5qs4qs}ex{17ss5ts5qs}6z{4qv5ks5ou5qw5ru17su5tu}fm{4qv5ks5ou5qw5ru17su5tu}fn{4qv5ks5ou5qw5ru17su5tu}fo{4qv5ks5ou5qw5ru17su5tu}fp{4qv5ks5ou5qw5ru17su5tu}fq{4qv5ks5ou5qw5ru17su5tu}7r{5os}fs{4qv5ks5ou5qw5ru17su5tu}ft{17su5tu5qs}fu{17su5tu5qs}fv{17su5tu5qs}fw{17su5tu5qs}}}"),"Times-Roman":o("{'widths'{k3n2q4ycx2l201n3m201o6o201s2l201t2l201u2l201w2w201x2w201y2w2k1t2l2l202m2n2n3m2o3m2p5n202q6o2r1m2s2l2t2l2u3m2v3s2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v1w3w3s3x3s3y3s3z2w4k5w4l4s4m4m4n4m4o4s4p3x4q3r4r4s4s4s4t2l4u2r4v4s4w3x4x5t4y4s4z4s5k3r5l4s5m4m5n3r5o3x5p4s5q4s5r5y5s4s5t4s5u3x5v2l5w1w5x2l5y2z5z3m6k2l6l2w6m3m6n2w6o3m6p2w6q2l6r3m6s3m6t1w6u1w6v3m6w1w6x4y6y3m6z3m7k3m7l3m7m2l7n2r7o1w7p3m7q3m7r4s7s3m7t3m7u2w7v3k7w1o7x3k7y3q202l3mcl4sal2lam3man3mao3map3mar3mas2lat4wau1vav3maw3say4waz2lbk2sbl3s'fof'6obo2lbp3mbq2xbr1tbs2lbu1zbv3mbz2wck4s202k3mcm4scn4sco4scp4scq5tcr4mcs3xct3xcu3xcv3xcw2l2m2tcy2lcz2ldl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek2wel2wem2wen2weo2wep2weq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr3sfs3mft3mfu3mfv3mfw3mfz3m203k6o212m6m2dw2l2cq2l3t3m3u1w17s4s19m3m}'kerning'{cl{4qs5ku17sw5ou5qy5rw201ss5tw201ws}201s{201ss}201t{ckw4lwcmwcnwcowcpwclw4wu201ts}2k{201ts}2w{4qs5kw5os5qx5ru17sx5tx}2x{17sw5tw5ou5qu}2y{4qs5kw5os5qx5ru17sx5tx}'fof'-6o7t{ckuclucmucnucoucpu4lu5os5rs}3u{17su5tu5qs}3v{17su5tu5qs}7p{17sw5tw5qs}ck{4qs5ku17sw5ou5qy5rw201ss5tw201ws}4l{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cm{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cn{4qs5ku17sw5ou5qy5rw201ss5tw201ws}co{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cp{4qs5ku17sw5ou5qy5rw201ss5tw201ws}6l{17su5tu5os5qw5rs}17s{2ktclvcmvcnvcovcpv4lv4wuckv}5o{ckwclwcmwcnwcowcpw4lw4wu}5q{ckyclycmycnycoycpy4ly4wu5ms}5r{cktcltcmtcntcotcpt4lt4ws}5t{2ktclvcmvcnvcovcpv4lv4wuckv}7q{cksclscmscnscoscps4ls}6p{17su5tu5qw5rs}ek{5qs5rs}el{17su5tu5os5qw5rs}em{17su5tu5os5qs5rs}en{17su5qs5rs}eo{5qs5rs}ep{17su5tu5os5qw5rs}es{5qs}et{17su5tu5qw5rs}eu{17su5tu5qs5rs}ev{5qs}6z{17sv5tv5os5qx5rs}fm{5os5qt5rs}fn{17sv5tv5os5qx5rs}fo{17sv5tv5os5qx5rs}fp{5os5qt5rs}fq{5os5qt5rs}7r{ckuclucmucnucoucpu4lu5os}fs{17sv5tv5os5qx5rs}ft{17ss5ts5qs}fu{17sw5tw5qs}fv{17sw5tw5qs}fw{17ss5ts5qs}fz{ckuclucmucnucoucpu4lu5os5rs}}}"),"Helvetica-Oblique":o("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}")}};r.events.push(["addFont",function(x){var T=x.font,I=_.Unicode[T.postScriptName];I&&(T.metadata.Unicode={},T.metadata.Unicode.widths=I.widths,T.metadata.Unicode.kerning=I.kerning);var N=f.Unicode[T.postScriptName];N&&(T.metadata.Unicode.encoding=N,T.encoding=N.codePages[0])}])}(yi.API),function(r){var e=function(t){for(var n=t.length,i=new Uint8Array(n),s=0;s<n;s++)i[s]=t.charCodeAt(s);return i};r.API.events.push(["addFont",function(t){var n=void 0,i=t.font,s=t.instance;if(!i.isStandardFont){if(s===void 0)throw new Error("Font does not exist in vFS, import fonts or remove declaration doc.addFont('"+i.postScriptName+"').");if(typeof(n=s.existsFileInVFS(i.postScriptName)===!1?s.loadFile(i.postScriptName):s.getFileFromVFS(i.postScriptName))!="string")throw new Error("Font is not stored as string-data in vFS, import fonts or remove declaration doc.addFont('"+i.postScriptName+"').");(function(a,o){o=/^\x00\x01\x00\x00/.test(o)?e(o):e(Tb(o)),a.metadata=r.API.TTFFont.open(o),a.metadata.Unicode=a.metadata.Unicode||{encoding:{},kerning:{},widths:[]},a.metadata.glyIdsUsed=[0]})(i,n)}}])}(yi),function(r){function e(){return(_i.canvg?Promise.resolve(_i.canvg):Promise.resolve().then(()=>_We)).catch(function(t){return Promise.reject(new Error("Could not load canvg: "+t))}).then(function(t){return t.default?t.default:t})}yi.API.addSvgAsImage=function(t,n,i,s,a,o,h,f){if(isNaN(n)||isNaN(i))throw po.error("jsPDF.addSvgAsImage: Invalid coordinates",arguments),new Error("Invalid coordinates passed to jsPDF.addSvgAsImage");if(isNaN(s)||isNaN(a))throw po.error("jsPDF.addSvgAsImage: Invalid measurements",arguments),new Error("Invalid measurements (width and/or height) passed to jsPDF.addSvgAsImage");var _=document.createElement("canvas");_.width=s,_.height=a;var x=_.getContext("2d");x.fillStyle="#fff",x.fillRect(0,0,_.width,_.height);var T={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0},I=this;return e().then(function(N){return N.fromString(x,t,T)},function(){return Promise.reject(new Error("Could not load canvg."))}).then(function(N){return N.render(T)}).then(function(){I.addImage(_.toDataURL("image/jpeg",1),n,i,s,a,h,f)})}}(),yi.API.putTotalPages=function(r){var e,t=0;parseInt(this.internal.getFont().id.substr(1),10)<15?(e=new RegExp(r,"g"),t=this.internal.getNumberOfPages()):(e=new RegExp(this.pdfEscape16(r,this.internal.getFont()),"g"),t=this.pdfEscape16(this.internal.getNumberOfPages()+"",this.internal.getFont()));for(var n=1;n<=this.internal.getNumberOfPages();n++)for(var i=0;i<this.internal.pages[n].length;i++)this.internal.pages[n][i]=this.internal.pages[n][i].replace(e,t);return this},yi.API.viewerPreferences=function(r,e){var t;r=r||{},e=e||!1;var n,i,s,a={HideToolbar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideMenubar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideWindowUI:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},FitWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},CenterWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},DisplayDocTitle:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.4},NonFullScreenPageMode:{defaultValue:"UseNone",value:"UseNone",type:"name",explicitSet:!1,valueSet:["UseNone","UseOutlines","UseThumbs","UseOC"],pdfVersion:1.3},Direction:{defaultValue:"L2R",value:"L2R",type:"name",explicitSet:!1,valueSet:["L2R","R2L"],pdfVersion:1.3},ViewArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},ViewClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintScaling:{defaultValue:"AppDefault",value:"AppDefault",type:"name",explicitSet:!1,valueSet:["AppDefault","None"],pdfVersion:1.6},Duplex:{defaultValue:"",value:"none",type:"name",explicitSet:!1,valueSet:["Simplex","DuplexFlipShortEdge","DuplexFlipLongEdge","none"],pdfVersion:1.7},PickTrayByPDFSize:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.7},PrintPageRange:{defaultValue:"",value:"",type:"array",explicitSet:!1,valueSet:null,pdfVersion:1.7},NumCopies:{defaultValue:1,value:1,type:"integer",explicitSet:!1,valueSet:null,pdfVersion:1.7}},o=Object.keys(a),h=[],f=0,_=0,x=0;function T(N,$){var W,Y=!1;for(W=0;W<N.length;W+=1)N[W]===$&&(Y=!0);return Y}if(this.internal.viewerpreferences===void 0&&(this.internal.viewerpreferences={},this.internal.viewerpreferences.configuration=JSON.parse(JSON.stringify(a)),this.internal.viewerpreferences.isSubscribed=!1),t=this.internal.viewerpreferences.configuration,r==="reset"||e===!0){var I=o.length;for(x=0;x<I;x+=1)t[o[x]].value=t[o[x]].defaultValue,t[o[x]].explicitSet=!1}if(Ms(r)==="object"){for(i in r)if(s=r[i],T(o,i)&&s!==void 0){if(t[i].type==="boolean"&&typeof s=="boolean")t[i].value=s;else if(t[i].type==="name"&&T(t[i].valueSet,s))t[i].value=s;else if(t[i].type==="integer"&&Number.isInteger(s))t[i].value=s;else if(t[i].type==="array"){for(f=0;f<s.length;f+=1)if(n=!0,s[f].length===1&&typeof s[f][0]=="number")h.push(String(s[f]-1));else if(s[f].length>1){for(_=0;_<s[f].length;_+=1)typeof s[f][_]!="number"&&(n=!1);n===!0&&h.push([s[f][0]-1,s[f][1]-1].join(" "))}t[i].value="["+h.join(" ")+"]"}else t[i].value=t[i].defaultValue;t[i].explicitSet=!0}}return this.internal.viewerpreferences.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){var N,$=[];for(N in t)t[N].explicitSet===!0&&(t[N].type==="name"?$.push("/"+N+" /"+t[N].value):$.push("/"+N+" "+t[N].value));$.length!==0&&this.internal.write(`/ViewerPreferences
<<
`+$.join(`
`)+`
>>`)}),this.internal.viewerpreferences.isSubscribed=!0),this.internal.viewerpreferences.configuration=t,this},function(r){var e=function(){var n='<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description rdf:about="" xmlns:jspdf="'+this.internal.__metadata__.namespaceuri+'"><jspdf:metadata>',i=unescape(encodeURIComponent('<x:xmpmeta xmlns:x="adobe:ns:meta/">')),s=unescape(encodeURIComponent(n)),a=unescape(encodeURIComponent(this.internal.__metadata__.metadata)),o=unescape(encodeURIComponent("</jspdf:metadata></rdf:Description></rdf:RDF>")),h=unescape(encodeURIComponent("</x:xmpmeta>")),f=s.length+a.length+o.length+i.length+h.length;this.internal.__metadata__.metadata_object_number=this.internal.newObject(),this.internal.write("<< /Type /Metadata /Subtype /XML /Length "+f+" >>"),this.internal.write("stream"),this.internal.write(i+s+a+o+h),this.internal.write("endstream"),this.internal.write("endobj")},t=function(){this.internal.__metadata__.metadata_object_number&&this.internal.write("/Metadata "+this.internal.__metadata__.metadata_object_number+" 0 R")};r.addMetadata=function(n,i){return this.internal.__metadata__===void 0&&(this.internal.__metadata__={metadata:n,namespaceuri:i||"http://jspdf.default.namespaceuri/"},this.internal.events.subscribe("putCatalog",t),this.internal.events.subscribe("postPutResources",e)),this}}(yi.API),function(r){var e=r.API,t=e.pdfEscape16=function(s,a){for(var o,h=a.metadata.Unicode.widths,f=["","0","00","000","0000"],_=[""],x=0,T=s.length;x<T;++x){if(o=a.metadata.characterToGlyph(s.charCodeAt(x)),a.metadata.glyIdsUsed.push(o),a.metadata.toUnicode[o]=s.charCodeAt(x),h.indexOf(o)==-1&&(h.push(o),h.push([parseInt(a.metadata.widthOfGlyph(o),10)])),o=="0")return _.join("");o=o.toString(16),_.push(f[4-o.length],o)}return _.join("")},n=function(s){var a,o,h,f,_,x,T;for(_=`/CIDInit /ProcSet findresource begin
12 dict begin
begincmap
/CIDSystemInfo <<
  /Registry (Adobe)
  /Ordering (UCS)
  /Supplement 0
>> def
/CMapName /Adobe-Identity-UCS def
/CMapType 2 def
1 begincodespacerange
<0000><ffff>
endcodespacerange`,h=[],x=0,T=(o=Object.keys(s).sort(function(I,N){return I-N})).length;x<T;x++)a=o[x],h.length>=100&&(_+=`
`+h.length+` beginbfchar
`+h.join(`
`)+`
endbfchar`,h=[]),s[a]!==void 0&&s[a]!==null&&typeof s[a].toString=="function"&&(f=("0000"+s[a].toString(16)).slice(-4),a=("0000"+(+a).toString(16)).slice(-4),h.push("<"+a+"><"+f+">"));return h.length&&(_+=`
`+h.length+` beginbfchar
`+h.join(`
`)+`
endbfchar
`),_+=`endcmap
CMapName currentdict /CMap defineresource pop
end
end`};e.events.push(["putFont",function(s){(function(a){var o=a.font,h=a.out,f=a.newObject,_=a.putStream;if(o.metadata instanceof r.API.TTFFont&&o.encoding==="Identity-H"){for(var x=o.metadata.Unicode.widths,T=o.metadata.subset.encode(o.metadata.glyIdsUsed,1),I="",N=0;N<T.length;N++)I+=String.fromCharCode(T[N]);var $=f();_({data:I,addLength1:!0,objectId:$}),h("endobj");var W=f();_({data:n(o.metadata.toUnicode),addLength1:!0,objectId:W}),h("endobj");var Y=f();h("<<"),h("/Type /FontDescriptor"),h("/FontName /"+M0(o.fontName)),h("/FontFile2 "+$+" 0 R"),h("/FontBBox "+r.API.PDFObject.convert(o.metadata.bbox)),h("/Flags "+o.metadata.flags),h("/StemV "+o.metadata.stemV),h("/ItalicAngle "+o.metadata.italicAngle),h("/Ascent "+o.metadata.ascender),h("/Descent "+o.metadata.decender),h("/CapHeight "+o.metadata.capHeight),h(">>"),h("endobj");var ie=f();h("<<"),h("/Type /Font"),h("/BaseFont /"+M0(o.fontName)),h("/FontDescriptor "+Y+" 0 R"),h("/W "+r.API.PDFObject.convert(x)),h("/CIDToGIDMap /Identity"),h("/DW 1000"),h("/Subtype /CIDFontType2"),h("/CIDSystemInfo"),h("<<"),h("/Supplement 0"),h("/Registry (Adobe)"),h("/Ordering ("+o.encoding+")"),h(">>"),h(">>"),h("endobj"),o.objectNumber=f(),h("<<"),h("/Type /Font"),h("/Subtype /Type0"),h("/ToUnicode "+W+" 0 R"),h("/BaseFont /"+M0(o.fontName)),h("/Encoding /"+o.encoding),h("/DescendantFonts ["+ie+" 0 R]"),h(">>"),h("endobj"),o.isAlreadyPutted=!0}})(s)}]),e.events.push(["putFont",function(s){(function(a){var o=a.font,h=a.out,f=a.newObject,_=a.putStream;if(o.metadata instanceof r.API.TTFFont&&o.encoding==="WinAnsiEncoding"){for(var x=o.metadata.rawData,T="",I=0;I<x.length;I++)T+=String.fromCharCode(x[I]);var N=f();_({data:T,addLength1:!0,objectId:N}),h("endobj");var $=f();_({data:n(o.metadata.toUnicode),addLength1:!0,objectId:$}),h("endobj");var W=f();h("<<"),h("/Descent "+o.metadata.decender),h("/CapHeight "+o.metadata.capHeight),h("/StemV "+o.metadata.stemV),h("/Type /FontDescriptor"),h("/FontFile2 "+N+" 0 R"),h("/Flags 96"),h("/FontBBox "+r.API.PDFObject.convert(o.metadata.bbox)),h("/FontName /"+M0(o.fontName)),h("/ItalicAngle "+o.metadata.italicAngle),h("/Ascent "+o.metadata.ascender),h(">>"),h("endobj"),o.objectNumber=f();for(var Y=0;Y<o.metadata.hmtx.widths.length;Y++)o.metadata.hmtx.widths[Y]=parseInt(o.metadata.hmtx.widths[Y]*(1e3/o.metadata.head.unitsPerEm));h("<</Subtype/TrueType/Type/Font/ToUnicode "+$+" 0 R/BaseFont/"+M0(o.fontName)+"/FontDescriptor "+W+" 0 R/Encoding/"+o.encoding+" /FirstChar 29 /LastChar 255 /Widths "+r.API.PDFObject.convert(o.metadata.hmtx.widths)+">>"),h("endobj"),o.isAlreadyPutted=!0}})(s)}]);var i=function(s){var a,o=s.text||"",h=s.x,f=s.y,_=s.options||{},x=s.mutex||{},T=x.pdfEscape,I=x.activeFontKey,N=x.fonts,$=I,W="",Y=0,ie="",ce=N[$].encoding;if(N[$].encoding!=="Identity-H")return{text:o,x:h,y:f,options:_,mutex:x};for(ie=o,$=I,Array.isArray(o)&&(ie=o[0]),Y=0;Y<ie.length;Y+=1)N[$].metadata.hasOwnProperty("cmap")&&(a=N[$].metadata.cmap.unicode.codeMap[ie[Y].charCodeAt(0)]),a||ie[Y].charCodeAt(0)<256&&N[$].metadata.hasOwnProperty("Unicode")?W+=ie[Y]:W+="";var fe="";return parseInt($.slice(1))<14||ce==="WinAnsiEncoding"?fe=T(W,$).split("").map(function(ve){return ve.charCodeAt(0).toString(16)}).join(""):ce==="Identity-H"&&(fe=t(W,N[$])),x.isHex=!0,{text:fe,x:h,y:f,options:_,mutex:x}};e.events.push(["postProcessText",function(s){var a=s.text||"",o=[],h={text:a,x:s.x,y:s.y,options:s.options,mutex:s.mutex};if(Array.isArray(a)){var f=0;for(f=0;f<a.length;f+=1)Array.isArray(a[f])&&a[f].length===3?o.push([i(Object.assign({},h,{text:a[f][0]})).text,a[f][1],a[f][2]]):o.push(i(Object.assign({},h,{text:a[f]})).text);s.text=o}else s.text=i(Object.assign({},h,{text:a})).text}])}(yi),function(r){var e=function(){return this.internal.vFS===void 0&&(this.internal.vFS={}),!0};r.existsFileInVFS=function(t){return e.call(this),this.internal.vFS[t]!==void 0},r.addFileToVFS=function(t,n){return e.call(this),this.internal.vFS[t]=n,this},r.getFileFromVFS=function(t){return e.call(this),this.internal.vFS[t]!==void 0?this.internal.vFS[t]:null}}(yi.API),function(r){r.__bidiEngine__=r.prototype.__bidiEngine__=function(n){var i,s,a,o,h,f,_,x=e,T=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],I=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],N={L:0,R:1,EN:2,AN:3,N:4,B:5,S:6},$={0:0,5:1,6:2,7:3,32:4,251:5,254:6,255:7},W=["(",")","(","<",">","<","[","]","[","{","}","{","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],Y=new RegExp(/^([1-4|9]|1[0-9]|2[0-9]|3[0168]|4[04589]|5[012]|7[78]|159|16[0-9]|17[0-2]|21[569]|22[03489]|250)$/),ie=!1,ce=0;this.__bidiEngine__={};var fe=function(Le){var ze=Le.charCodeAt(),tt=ze>>8,Ne=$[tt];return Ne!==void 0?x[256*Ne+(255&ze)]:tt===252||tt===253?"AL":Y.test(tt)?"L":tt===8?"R":"N"},ve=function(Le){for(var ze,tt=0;tt<Le.length;tt++){if((ze=fe(Le.charAt(tt)))==="L")return!1;if(ze==="R")return!0}return!1},be=function(Le,ze,tt,Ne){var Ht,Vt,Jt,Kt,er=ze[Ne];switch(er){case"L":case"R":ie=!1;break;case"N":case"AN":break;case"EN":ie&&(er="AN");break;case"AL":ie=!0,er="R";break;case"WS":er="N";break;case"CS":Ne<1||Ne+1>=ze.length||(Ht=tt[Ne-1])!=="EN"&&Ht!=="AN"||(Vt=ze[Ne+1])!=="EN"&&Vt!=="AN"?er="N":ie&&(Vt="AN"),er=Vt===Ht?Vt:"N";break;case"ES":er=(Ht=Ne>0?tt[Ne-1]:"B")==="EN"&&Ne+1<ze.length&&ze[Ne+1]==="EN"?"EN":"N";break;case"ET":if(Ne>0&&tt[Ne-1]==="EN"){er="EN";break}if(ie){er="N";break}for(Jt=Ne+1,Kt=ze.length;Jt<Kt&&ze[Jt]==="ET";)Jt++;er=Jt<Kt&&ze[Jt]==="EN"?"EN":"N";break;case"NSM":if(a&&!o){for(Kt=ze.length,Jt=Ne+1;Jt<Kt&&ze[Jt]==="NSM";)Jt++;if(Jt<Kt){var Xt=Le[Ne],Fr=Xt>=1425&&Xt<=2303||Xt===64286;if(Ht=ze[Jt],Fr&&(Ht==="R"||Ht==="AL")){er="R";break}}}er=Ne<1||(Ht=ze[Ne-1])==="B"?"N":tt[Ne-1];break;case"B":ie=!1,i=!0,er=ce;break;case"S":s=!0,er="N";break;case"LRE":case"RLE":case"LRO":case"RLO":case"PDF":ie=!1;break;case"BN":er="N"}return er},Qe=function(Le,ze,tt){var Ne=Le.split("");return tt&&Ue(Ne,tt,{hiLevel:ce}),Ne.reverse(),ze&&ze.reverse(),Ne.join("")},Ue=function(Le,ze,tt){var Ne,Ht,Vt,Jt,Kt,er=-1,Xt=Le.length,Fr=0,$e=[],ut=ce?I:T,Bt=[];for(ie=!1,i=!1,s=!1,Ht=0;Ht<Xt;Ht++)Bt[Ht]=fe(Le[Ht]);for(Vt=0;Vt<Xt;Vt++){if(Kt=Fr,$e[Vt]=be(Le,Bt,$e,Vt),Ne=240&(Fr=ut[Kt][N[$e[Vt]]]),Fr&=15,ze[Vt]=Jt=ut[Fr][5],Ne>0)if(Ne===16){for(Ht=er;Ht<Vt;Ht++)ze[Ht]=1;er=-1}else er=-1;if(ut[Fr][6])er===-1&&(er=Vt);else if(er>-1){for(Ht=er;Ht<Vt;Ht++)ze[Ht]=Jt;er=-1}Bt[Vt]==="B"&&(ze[Vt]=0),tt.hiLevel|=Jt}s&&function(St,jt,qt){for(var nr=0;nr<qt;nr++)if(St[nr]==="S"){jt[nr]=ce;for(var ar=nr-1;ar>=0&&St[ar]==="WS";ar--)jt[ar]=ce}}(Bt,ze,Xt)},st=function(Le,ze,tt,Ne,Ht){if(!(Ht.hiLevel<Le)){if(Le===1&&ce===1&&!i)return ze.reverse(),void(tt&&tt.reverse());for(var Vt,Jt,Kt,er,Xt=ze.length,Fr=0;Fr<Xt;){if(Ne[Fr]>=Le){for(Kt=Fr+1;Kt<Xt&&Ne[Kt]>=Le;)Kt++;for(er=Fr,Jt=Kt-1;er<Jt;er++,Jt--)Vt=ze[er],ze[er]=ze[Jt],ze[Jt]=Vt,tt&&(Vt=tt[er],tt[er]=tt[Jt],tt[Jt]=Vt);Fr=Kt}Fr++}}},at=function(Le,ze,tt){var Ne=Le.split(""),Ht={hiLevel:ce};return tt||(tt=[]),Ue(Ne,tt,Ht),function(Vt,Jt,Kt){if(Kt.hiLevel!==0&&_)for(var er,Xt=0;Xt<Vt.length;Xt++)Jt[Xt]===1&&(er=W.indexOf(Vt[Xt]))>=0&&(Vt[Xt]=W[er+1])}(Ne,tt,Ht),st(2,Ne,ze,tt,Ht),st(1,Ne,ze,tt,Ht),Ne.join("")};return this.__bidiEngine__.doBidiReorder=function(Le,ze,tt){if(function(Ht,Vt){if(Vt)for(var Jt=0;Jt<Ht.length;Jt++)Vt[Jt]=Jt;o===void 0&&(o=ve(Ht)),f===void 0&&(f=ve(Ht))}(Le,ze),a||!h||f)if(a&&h&&o^f)ce=o?1:0,Le=Qe(Le,ze,tt);else if(!a&&h&&f)ce=o?1:0,Le=at(Le,ze,tt),Le=Qe(Le,ze);else if(!a||o||h||f){if(a&&!h&&o^f)Le=Qe(Le,ze),o?(ce=0,Le=at(Le,ze,tt)):(ce=1,Le=at(Le,ze,tt),Le=Qe(Le,ze));else if(a&&o&&!h&&f)ce=1,Le=at(Le,ze,tt),Le=Qe(Le,ze);else if(!a&&!h&&o^f){var Ne=_;o?(ce=1,Le=at(Le,ze,tt),ce=0,_=!1,Le=at(Le,ze,tt),_=Ne):(ce=0,Le=at(Le,ze,tt),Le=Qe(Le,ze),ce=1,_=!1,Le=at(Le,ze,tt),_=Ne,Le=Qe(Le,ze))}}else ce=0,Le=at(Le,ze,tt);else ce=o?1:0,Le=at(Le,ze,tt);return Le},this.__bidiEngine__.setOptions=function(Le){Le&&(a=Le.isInputVisual,h=Le.isOutputVisual,o=Le.isInputRtl,f=Le.isOutputRtl,_=Le.isSymmetricSwapping)},this.__bidiEngine__.setOptions(n),this.__bidiEngine__};var e=["BN","BN","BN","BN","BN","BN","BN","BN","BN","S","B","S","WS","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","B","B","B","S","WS","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","BN","BN","BN","BN","BN","BN","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","CS","N","ET","ET","ET","ET","N","N","N","N","L","N","N","BN","N","N","ET","ET","EN","EN","N","L","N","N","N","EN","L","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","N","N","N","N","N","ET","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","NSM","R","NSM","NSM","R","NSM","NSM","R","NSM","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","N","N","N","N","N","R","R","R","R","R","N","N","N","N","N","N","N","N","N","N","N","AN","AN","AN","AN","AN","AN","N","N","AL","ET","ET","AL","CS","AL","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","AN","AN","AN","AN","AN","AN","AN","AN","AN","ET","AN","AN","AL","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","N","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","NSM","NSM","N","NSM","NSM","NSM","NSM","AL","AL","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","R","N","N","N","N","R","N","N","N","N","N","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","BN","BN","BN","L","R","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","B","LRE","RLE","PDF","LRO","RLO","CS","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","BN","BN","BN","BN","BN","N","LRI","RLI","FSI","PDI","BN","BN","BN","BN","BN","BN","EN","L","N","N","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","L","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","N","N","N","N","N","R","NSM","R","R","R","R","R","R","R","R","R","R","ES","R","R","R","R","R","R","R","R","R","R","R","R","R","N","R","R","R","R","R","N","R","N","R","R","N","R","R","N","R","R","R","R","R","R","R","R","R","R","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","CS","N","N","CS","N","N","N","N","N","N","N","N","N","ET","N","N","ES","ES","N","N","N","N","N","ET","ET","N","N","N","N","N","AL","AL","AL","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","BN","N","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","N","N","N","ET","ET","N","N","N","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N"],t=new r.__bidiEngine__({isInputVisual:!0});r.API.events.push(["postProcessText",function(n){var i=n.text,s=(n.x,n.y,n.options||{}),a=(n.mutex,s.lang,[]);if(s.isInputVisual=typeof s.isInputVisual!="boolean"||s.isInputVisual,t.setOptions(s),Object.prototype.toString.call(i)==="[object Array]"){var o=0;for(a=[],o=0;o<i.length;o+=1)Object.prototype.toString.call(i[o])==="[object Array]"?a.push([t.doBidiReorder(i[o][0]),i[o][1],i[o][2]]):a.push([t.doBidiReorder(i[o])]);n.text=a}else n.text=t.doBidiReorder(i);t.setOptions({isInputVisual:!0})}])}(yi),yi.API.TTFFont=function(){function r(e){var t;if(this.rawData=e,t=this.contents=new Ip(e),this.contents.pos=4,t.readString(4)==="ttcf")throw new Error("TTCF not supported.");t.pos=0,this.parse(),this.subset=new Q5e(this),this.registerTTF()}return r.open=function(e){return new r(e)},r.prototype.parse=function(){return this.directory=new M5e(this.contents),this.head=new F5e(this),this.name=new k5e(this),this.cmap=new x$(this),this.toUnicode={},this.hhea=new R5e(this),this.maxp=new U5e(this),this.hmtx=new N5e(this),this.post=new D5e(this),this.os2=new L5e(this),this.loca=new G5e(this),this.glyf=new z5e(this),this.ascender=this.os2.exists&&this.os2.ascender||this.hhea.ascender,this.decender=this.os2.exists&&this.os2.decender||this.hhea.decender,this.lineGap=this.os2.exists&&this.os2.lineGap||this.hhea.lineGap,this.bbox=[this.head.xMin,this.head.yMin,this.head.xMax,this.head.yMax]},r.prototype.registerTTF=function(){var e,t,n,i,s;if(this.scaleFactor=1e3/this.head.unitsPerEm,this.bbox=(function(){var a,o,h,f;for(f=[],a=0,o=(h=this.bbox).length;a<o;a++)e=h[a],f.push(Math.round(e*this.scaleFactor));return f}).call(this),this.stemV=0,this.post.exists?(n=255&(i=this.post.italic_angle),32768&(t=i>>16)&&(t=-(1+(65535^t))),this.italicAngle=+(t+"."+n)):this.italicAngle=0,this.ascender=Math.round(this.ascender*this.scaleFactor),this.decender=Math.round(this.decender*this.scaleFactor),this.lineGap=Math.round(this.lineGap*this.scaleFactor),this.capHeight=this.os2.exists&&this.os2.capHeight||this.ascender,this.xHeight=this.os2.exists&&this.os2.xHeight||0,this.familyClass=(this.os2.exists&&this.os2.familyClass||0)>>8,this.isSerif=(s=this.familyClass)===1||s===2||s===3||s===4||s===5||s===7,this.isScript=this.familyClass===10,this.flags=0,this.post.isFixedPitch&&(this.flags|=1),this.isSerif&&(this.flags|=2),this.isScript&&(this.flags|=8),this.italicAngle!==0&&(this.flags|=64),this.flags|=32,!this.cmap.unicode)throw new Error("No unicode cmap for font")},r.prototype.characterToGlyph=function(e){var t;return((t=this.cmap.unicode)!=null?t.codeMap[e]:void 0)||0},r.prototype.widthOfGlyph=function(e){var t;return t=1e3/this.head.unitsPerEm,this.hmtx.forGlyph(e).advance*t},r.prototype.widthOfString=function(e,t,n){var i,s,a,o;for(a=0,s=0,o=(e=""+e).length;0<=o?s<o:s>o;s=0<=o?++s:--s)i=e.charCodeAt(s),a+=this.widthOfGlyph(this.characterToGlyph(i))+n*(1e3/t)||0;return a*(t/1e3)},r.prototype.lineHeight=function(e,t){var n;return t==null&&(t=!1),n=t?this.lineGap:0,(this.ascender+n-this.decender)/1e3*e},r}();var of,Ip=function(){function r(e){this.data=e??[],this.pos=0,this.length=this.data.length}return r.prototype.readByte=function(){return this.data[this.pos++]},r.prototype.writeByte=function(e){return this.data[this.pos++]=e},r.prototype.readUInt32=function(){return 16777216*this.readByte()+(this.readByte()<<16)+(this.readByte()<<8)+this.readByte()},r.prototype.writeUInt32=function(e){return this.writeByte(e>>>24&255),this.writeByte(e>>16&255),this.writeByte(e>>8&255),this.writeByte(255&e)},r.prototype.readInt32=function(){var e;return(e=this.readUInt32())>=2147483648?e-4294967296:e},r.prototype.writeInt32=function(e){return e<0&&(e+=4294967296),this.writeUInt32(e)},r.prototype.readUInt16=function(){return this.readByte()<<8|this.readByte()},r.prototype.writeUInt16=function(e){return this.writeByte(e>>8&255),this.writeByte(255&e)},r.prototype.readInt16=function(){var e;return(e=this.readUInt16())>=32768?e-65536:e},r.prototype.writeInt16=function(e){return e<0&&(e+=65536),this.writeUInt16(e)},r.prototype.readString=function(e){var t,n;for(n=[],t=0;0<=e?t<e:t>e;t=0<=e?++t:--t)n[t]=String.fromCharCode(this.readByte());return n.join("")},r.prototype.writeString=function(e){var t,n,i;for(i=[],t=0,n=e.length;0<=n?t<n:t>n;t=0<=n?++t:--t)i.push(this.writeByte(e.charCodeAt(t)));return i},r.prototype.readShort=function(){return this.readInt16()},r.prototype.writeShort=function(e){return this.writeInt16(e)},r.prototype.readLongLong=function(){var e,t,n,i,s,a,o,h;return e=this.readByte(),t=this.readByte(),n=this.readByte(),i=this.readByte(),s=this.readByte(),a=this.readByte(),o=this.readByte(),h=this.readByte(),128&e?-1*(72057594037927940*(255^e)+281474976710656*(255^t)+1099511627776*(255^n)+4294967296*(255^i)+16777216*(255^s)+65536*(255^a)+256*(255^o)+(255^h)+1):72057594037927940*e+281474976710656*t+1099511627776*n+4294967296*i+16777216*s+65536*a+256*o+h},r.prototype.writeLongLong=function(e){var t,n;return t=Math.floor(e/4294967296),n=4294967295&e,this.writeByte(t>>24&255),this.writeByte(t>>16&255),this.writeByte(t>>8&255),this.writeByte(255&t),this.writeByte(n>>24&255),this.writeByte(n>>16&255),this.writeByte(n>>8&255),this.writeByte(255&n)},r.prototype.readInt=function(){return this.readInt32()},r.prototype.writeInt=function(e){return this.writeInt32(e)},r.prototype.read=function(e){var t,n;for(t=[],n=0;0<=e?n<e:n>e;n=0<=e?++n:--n)t.push(this.readByte());return t},r.prototype.write=function(e){var t,n,i,s;for(s=[],n=0,i=e.length;n<i;n++)t=e[n],s.push(this.writeByte(t));return s},r}(),M5e=function(){var r;function e(t){var n,i,s;for(this.scalarType=t.readInt(),this.tableCount=t.readShort(),this.searchRange=t.readShort(),this.entrySelector=t.readShort(),this.rangeShift=t.readShort(),this.tables={},i=0,s=this.tableCount;0<=s?i<s:i>s;i=0<=s?++i:--i)n={tag:t.readString(4),checksum:t.readInt(),offset:t.readInt(),length:t.readInt()},this.tables[n.tag]=n}return e.prototype.encode=function(t){var n,i,s,a,o,h,f,_,x,T,I,N,$;for($ in I=Object.keys(t).length,h=Math.log(2),x=16*Math.floor(Math.log(I)/h),a=Math.floor(x/h),_=16*I-x,(i=new Ip).writeInt(this.scalarType),i.writeShort(I),i.writeShort(x),i.writeShort(a),i.writeShort(_),s=16*I,f=i.pos+s,o=null,N=[],t)for(T=t[$],i.writeString($),i.writeInt(r(T)),i.writeInt(f),i.writeInt(T.length),N=N.concat(T),$==="head"&&(o=f),f+=T.length;f%4;)N.push(0),f++;return i.write(N),n=2981146554-r(i.data),i.pos=o+8,i.writeUInt32(n),i.data},r=function(t){var n,i,s,a;for(t=w$.call(t);t.length%4;)t.push(0);for(s=new Ip(t),i=0,n=0,a=t.length;n<a;n=n+=4)i+=s.readUInt32();return 4294967295&i},e}(),P5e={}.hasOwnProperty,Zf=function(r,e){for(var t in e)P5e.call(e,t)&&(r[t]=e[t]);function n(){this.constructor=r}return n.prototype=e.prototype,r.prototype=new n,r.__super__=e.prototype,r};of=function(){function r(e){var t;this.file=e,t=this.file.directory.tables[this.tag],this.exists=!!t,t&&(this.offset=t.offset,this.length=t.length,this.parse(this.file.contents))}return r.prototype.parse=function(){},r.prototype.encode=function(){},r.prototype.raw=function(){return this.exists?(this.file.contents.pos=this.offset,this.file.contents.read(this.length)):null},r}();var F5e=function(r){function e(){return e.__super__.constructor.apply(this,arguments)}return Zf(e,of),e.prototype.tag="head",e.prototype.parse=function(t){return t.pos=this.offset,this.version=t.readInt(),this.revision=t.readInt(),this.checkSumAdjustment=t.readInt(),this.magicNumber=t.readInt(),this.flags=t.readShort(),this.unitsPerEm=t.readShort(),this.created=t.readLongLong(),this.modified=t.readLongLong(),this.xMin=t.readShort(),this.yMin=t.readShort(),this.xMax=t.readShort(),this.yMax=t.readShort(),this.macStyle=t.readShort(),this.lowestRecPPEM=t.readShort(),this.fontDirectionHint=t.readShort(),this.indexToLocFormat=t.readShort(),this.glyphDataFormat=t.readShort()},e.prototype.encode=function(t){var n;return(n=new Ip).writeInt(this.version),n.writeInt(this.revision),n.writeInt(this.checkSumAdjustment),n.writeInt(this.magicNumber),n.writeShort(this.flags),n.writeShort(this.unitsPerEm),n.writeLongLong(this.created),n.writeLongLong(this.modified),n.writeShort(this.xMin),n.writeShort(this.yMin),n.writeShort(this.xMax),n.writeShort(this.yMax),n.writeShort(this.macStyle),n.writeShort(this.lowestRecPPEM),n.writeShort(this.fontDirectionHint),n.writeShort(t),n.writeShort(this.glyphDataFormat),n.data},e}(),v$=function(){function r(e,t){var n,i,s,a,o,h,f,_,x,T,I,N,$,W,Y,ie,ce;switch(this.platformID=e.readUInt16(),this.encodingID=e.readShort(),this.offset=t+e.readInt(),x=e.pos,e.pos=this.offset,this.format=e.readUInt16(),this.length=e.readUInt16(),this.language=e.readUInt16(),this.isUnicode=this.platformID===3&&this.encodingID===1&&this.format===4||this.platformID===0&&this.format===4,this.codeMap={},this.format){case 0:for(h=0;h<256;++h)this.codeMap[h]=e.readByte();break;case 4:for(I=e.readUInt16(),T=I/2,e.pos+=6,s=function(){var fe,ve;for(ve=[],h=fe=0;0<=T?fe<T:fe>T;h=0<=T?++fe:--fe)ve.push(e.readUInt16());return ve}(),e.pos+=2,$=function(){var fe,ve;for(ve=[],h=fe=0;0<=T?fe<T:fe>T;h=0<=T?++fe:--fe)ve.push(e.readUInt16());return ve}(),f=function(){var fe,ve;for(ve=[],h=fe=0;0<=T?fe<T:fe>T;h=0<=T?++fe:--fe)ve.push(e.readUInt16());return ve}(),_=function(){var fe,ve;for(ve=[],h=fe=0;0<=T?fe<T:fe>T;h=0<=T?++fe:--fe)ve.push(e.readUInt16());return ve}(),i=(this.length-e.pos+this.offset)/2,o=function(){var fe,ve;for(ve=[],h=fe=0;0<=i?fe<i:fe>i;h=0<=i?++fe:--fe)ve.push(e.readUInt16());return ve}(),h=Y=0,ce=s.length;Y<ce;h=++Y)for(W=s[h],n=ie=N=$[h];N<=W?ie<=W:ie>=W;n=N<=W?++ie:--ie)_[h]===0?a=n+f[h]:(a=o[_[h]/2+(n-N)-(T-h)]||0)!==0&&(a+=f[h]),this.codeMap[n]=65535&a}e.pos=x}return r.encode=function(e,t){var n,i,s,a,o,h,f,_,x,T,I,N,$,W,Y,ie,ce,fe,ve,be,Qe,Ue,st,at,Le,ze,tt,Ne,Ht,Vt,Jt,Kt,er,Xt,Fr,$e,ut,Bt,St,jt,qt,nr,ar,$r,kr,Gr;switch(Ne=new Ip,a=Object.keys(e).sort(function(sn,on){return sn-on}),t){case"macroman":for($=0,W=function(){var sn=[];for(N=0;N<256;++N)sn.push(0);return sn}(),ie={0:0},s={},Ht=0,er=a.length;Ht<er;Ht++)ie[ar=e[i=a[Ht]]]==null&&(ie[ar]=++$),s[i]={old:e[i],new:ie[e[i]]},W[i]=ie[e[i]];return Ne.writeUInt16(1),Ne.writeUInt16(0),Ne.writeUInt32(12),Ne.writeUInt16(0),Ne.writeUInt16(262),Ne.writeUInt16(0),Ne.write(W),{charMap:s,subtable:Ne.data,maxGlyphID:$+1};case"unicode":for(ze=[],x=[],ce=0,ie={},n={},Y=f=null,Vt=0,Xt=a.length;Vt<Xt;Vt++)ie[ve=e[i=a[Vt]]]==null&&(ie[ve]=++ce),n[i]={old:ve,new:ie[ve]},o=ie[ve]-i,Y!=null&&o===f||(Y&&x.push(Y),ze.push(i),f=o),Y=i;for(Y&&x.push(Y),x.push(65535),ze.push(65535),at=2*(st=ze.length),Ue=2*Math.pow(Math.log(st)/Math.LN2,2),T=Math.log(Ue/2)/Math.LN2,Qe=2*st-Ue,h=[],be=[],I=[],N=Jt=0,Fr=ze.length;Jt<Fr;N=++Jt){if(Le=ze[N],_=x[N],Le===65535){h.push(0),be.push(0);break}if(Le-(tt=n[Le].new)>=32768)for(h.push(0),be.push(2*(I.length+st-N)),i=Kt=Le;Le<=_?Kt<=_:Kt>=_;i=Le<=_?++Kt:--Kt)I.push(n[i].new);else h.push(tt-Le),be.push(0)}for(Ne.writeUInt16(3),Ne.writeUInt16(1),Ne.writeUInt32(12),Ne.writeUInt16(4),Ne.writeUInt16(16+8*st+2*I.length),Ne.writeUInt16(0),Ne.writeUInt16(at),Ne.writeUInt16(Ue),Ne.writeUInt16(T),Ne.writeUInt16(Qe),qt=0,$e=x.length;qt<$e;qt++)i=x[qt],Ne.writeUInt16(i);for(Ne.writeUInt16(0),nr=0,ut=ze.length;nr<ut;nr++)i=ze[nr],Ne.writeUInt16(i);for($r=0,Bt=h.length;$r<Bt;$r++)o=h[$r],Ne.writeUInt16(o);for(kr=0,St=be.length;kr<St;kr++)fe=be[kr],Ne.writeUInt16(fe);for(Gr=0,jt=I.length;Gr<jt;Gr++)$=I[Gr],Ne.writeUInt16($);return{charMap:n,subtable:Ne.data,maxGlyphID:ce+1}}},r}(),x$=function(r){function e(){return e.__super__.constructor.apply(this,arguments)}return Zf(e,of),e.prototype.tag="cmap",e.prototype.parse=function(t){var n,i,s;for(t.pos=this.offset,this.version=t.readUInt16(),s=t.readUInt16(),this.tables=[],this.unicode=null,i=0;0<=s?i<s:i>s;i=0<=s?++i:--i)n=new v$(t,this.offset),this.tables.push(n),n.isUnicode&&this.unicode==null&&(this.unicode=n);return!0},e.encode=function(t,n){var i,s;return n==null&&(n="macroman"),i=v$.encode(t,n),(s=new Ip).writeUInt16(0),s.writeUInt16(1),i.table=s.data.concat(i.subtable),i},e}(),R5e=function(r){function e(){return e.__super__.constructor.apply(this,arguments)}return Zf(e,of),e.prototype.tag="hhea",e.prototype.parse=function(t){return t.pos=this.offset,this.version=t.readInt(),this.ascender=t.readShort(),this.decender=t.readShort(),this.lineGap=t.readShort(),this.advanceWidthMax=t.readShort(),this.minLeftSideBearing=t.readShort(),this.minRightSideBearing=t.readShort(),this.xMaxExtent=t.readShort(),this.caretSlopeRise=t.readShort(),this.caretSlopeRun=t.readShort(),this.caretOffset=t.readShort(),t.pos+=8,this.metricDataFormat=t.readShort(),this.numberOfMetrics=t.readUInt16()},e}(),L5e=function(r){function e(){return e.__super__.constructor.apply(this,arguments)}return Zf(e,of),e.prototype.tag="OS/2",e.prototype.parse=function(t){if(t.pos=this.offset,this.version=t.readUInt16(),this.averageCharWidth=t.readShort(),this.weightClass=t.readUInt16(),this.widthClass=t.readUInt16(),this.type=t.readShort(),this.ySubscriptXSize=t.readShort(),this.ySubscriptYSize=t.readShort(),this.ySubscriptXOffset=t.readShort(),this.ySubscriptYOffset=t.readShort(),this.ySuperscriptXSize=t.readShort(),this.ySuperscriptYSize=t.readShort(),this.ySuperscriptXOffset=t.readShort(),this.ySuperscriptYOffset=t.readShort(),this.yStrikeoutSize=t.readShort(),this.yStrikeoutPosition=t.readShort(),this.familyClass=t.readShort(),this.panose=function(){var n,i;for(i=[],n=0;n<10;++n)i.push(t.readByte());return i}(),this.charRange=function(){var n,i;for(i=[],n=0;n<4;++n)i.push(t.readInt());return i}(),this.vendorID=t.readString(4),this.selection=t.readShort(),this.firstCharIndex=t.readShort(),this.lastCharIndex=t.readShort(),this.version>0&&(this.ascent=t.readShort(),this.descent=t.readShort(),this.lineGap=t.readShort(),this.winAscent=t.readShort(),this.winDescent=t.readShort(),this.codePageRange=function(){var n,i;for(i=[],n=0;n<2;n=++n)i.push(t.readInt());return i}(),this.version>1))return this.xHeight=t.readShort(),this.capHeight=t.readShort(),this.defaultChar=t.readShort(),this.breakChar=t.readShort(),this.maxContext=t.readShort()},e}(),D5e=function(r){function e(){return e.__super__.constructor.apply(this,arguments)}return Zf(e,of),e.prototype.tag="post",e.prototype.parse=function(t){var n,i,s;switch(t.pos=this.offset,this.format=t.readInt(),this.italicAngle=t.readInt(),this.underlinePosition=t.readShort(),this.underlineThickness=t.readShort(),this.isFixedPitch=t.readInt(),this.minMemType42=t.readInt(),this.maxMemType42=t.readInt(),this.minMemType1=t.readInt(),this.maxMemType1=t.readInt(),this.format){case 65536:break;case 131072:var a;for(i=t.readUInt16(),this.glyphNameIndex=[],a=0;0<=i?a<i:a>i;a=0<=i?++a:--a)this.glyphNameIndex.push(t.readUInt16());for(this.names=[],s=[];t.pos<this.offset+this.length;)n=t.readByte(),s.push(this.names.push(t.readString(n)));return s;case 151552:return i=t.readUInt16(),this.offsets=t.read(i);case 196608:break;case 262144:return this.map=(function(){var o,h,f;for(f=[],a=o=0,h=this.file.maxp.numGlyphs;0<=h?o<h:o>h;a=0<=h?++o:--o)f.push(t.readUInt32());return f}).call(this)}},e}(),O5e=function(r,e){this.raw=r,this.length=r.length,this.platformID=e.platformID,this.encodingID=e.encodingID,this.languageID=e.languageID},k5e=function(r){function e(){return e.__super__.constructor.apply(this,arguments)}return Zf(e,of),e.prototype.tag="name",e.prototype.parse=function(t){var n,i,s,a,o,h,f,_,x,T,I;for(t.pos=this.offset,t.readShort(),n=t.readShort(),h=t.readShort(),i=[],a=0;0<=n?a<n:a>n;a=0<=n?++a:--a)i.push({platformID:t.readShort(),encodingID:t.readShort(),languageID:t.readShort(),nameID:t.readShort(),length:t.readShort(),offset:this.offset+h+t.readShort()});for(f={},a=x=0,T=i.length;x<T;a=++x)s=i[a],t.pos=s.offset,_=t.readString(s.length),o=new O5e(_,s),f[I=s.nameID]==null&&(f[I]=[]),f[s.nameID].push(o);this.strings=f,this.copyright=f[0],this.fontFamily=f[1],this.fontSubfamily=f[2],this.uniqueSubfamily=f[3],this.fontName=f[4],this.version=f[5];try{this.postscriptName=f[6][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}catch{this.postscriptName=f[4][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}return this.trademark=f[7],this.manufacturer=f[8],this.designer=f[9],this.description=f[10],this.vendorUrl=f[11],this.designerUrl=f[12],this.license=f[13],this.licenseUrl=f[14],this.preferredFamily=f[15],this.preferredSubfamily=f[17],this.compatibleFull=f[18],this.sampleText=f[19]},e}(),U5e=function(r){function e(){return e.__super__.constructor.apply(this,arguments)}return Zf(e,of),e.prototype.tag="maxp",e.prototype.parse=function(t){return t.pos=this.offset,this.version=t.readInt(),this.numGlyphs=t.readUInt16(),this.maxPoints=t.readUInt16(),this.maxContours=t.readUInt16(),this.maxCompositePoints=t.readUInt16(),this.maxComponentContours=t.readUInt16(),this.maxZones=t.readUInt16(),this.maxTwilightPoints=t.readUInt16(),this.maxStorage=t.readUInt16(),this.maxFunctionDefs=t.readUInt16(),this.maxInstructionDefs=t.readUInt16(),this.maxStackElements=t.readUInt16(),this.maxSizeOfInstructions=t.readUInt16(),this.maxComponentElements=t.readUInt16(),this.maxComponentDepth=t.readUInt16()},e}(),N5e=function(r){function e(){return e.__super__.constructor.apply(this,arguments)}return Zf(e,of),e.prototype.tag="hmtx",e.prototype.parse=function(t){var n,i,s,a,o,h,f;for(t.pos=this.offset,this.metrics=[],n=0,h=this.file.hhea.numberOfMetrics;0<=h?n<h:n>h;n=0<=h?++n:--n)this.metrics.push({advance:t.readUInt16(),lsb:t.readInt16()});for(s=this.file.maxp.numGlyphs-this.file.hhea.numberOfMetrics,this.leftSideBearings=function(){var _,x;for(x=[],n=_=0;0<=s?_<s:_>s;n=0<=s?++_:--_)x.push(t.readInt16());return x}(),this.widths=(function(){var _,x,T,I;for(I=[],_=0,x=(T=this.metrics).length;_<x;_++)a=T[_],I.push(a.advance);return I}).call(this),i=this.widths[this.widths.length-1],f=[],n=o=0;0<=s?o<s:o>s;n=0<=s?++o:--o)f.push(this.widths.push(i));return f},e.prototype.forGlyph=function(t){return t in this.metrics?this.metrics[t]:{advance:this.metrics[this.metrics.length-1].advance,lsb:this.leftSideBearings[t-this.metrics.length]}},e}(),w$=[].slice,z5e=function(r){function e(){return e.__super__.constructor.apply(this,arguments)}return Zf(e,of),e.prototype.tag="glyf",e.prototype.parse=function(){return this.cache={}},e.prototype.glyphFor=function(t){var n,i,s,a,o,h,f,_,x,T;return t in this.cache?this.cache[t]:(a=this.file.loca,n=this.file.contents,i=a.indexOf(t),(s=a.lengthOf(t))===0?this.cache[t]=null:(n.pos=this.offset+i,o=(h=new Ip(n.read(s))).readShort(),_=h.readShort(),T=h.readShort(),f=h.readShort(),x=h.readShort(),this.cache[t]=o===-1?new V5e(h,_,T,f,x):new H5e(h,o,_,T,f,x),this.cache[t]))},e.prototype.encode=function(t,n,i){var s,a,o,h,f;for(o=[],a=[],h=0,f=n.length;h<f;h++)s=t[n[h]],a.push(o.length),s&&(o=o.concat(s.encode(i)));return a.push(o.length),{table:o,offsets:a}},e}(),H5e=function(){function r(e,t,n,i,s,a){this.raw=e,this.numberOfContours=t,this.xMin=n,this.yMin=i,this.xMax=s,this.yMax=a,this.compound=!1}return r.prototype.encode=function(){return this.raw.data},r}(),V5e=function(){function r(e,t,n,i,s){var a,o;for(this.raw=e,this.xMin=t,this.yMin=n,this.xMax=i,this.yMax=s,this.compound=!0,this.glyphIDs=[],this.glyphOffsets=[],a=this.raw;o=a.readShort(),this.glyphOffsets.push(a.pos),this.glyphIDs.push(a.readUInt16()),32&o;)a.pos+=1&o?4:2,128&o?a.pos+=8:64&o?a.pos+=4:8&o&&(a.pos+=2)}return r.prototype.encode=function(){var e,t,n;for(t=new Ip(w$.call(this.raw.data)),e=0,n=this.glyphIDs.length;e<n;++e)t.pos=this.glyphOffsets[e];return t.data},r}(),G5e=function(r){function e(){return e.__super__.constructor.apply(this,arguments)}return Zf(e,of),e.prototype.tag="loca",e.prototype.parse=function(t){var n,i;return t.pos=this.offset,n=this.file.head.indexToLocFormat,this.offsets=n===0?(function(){var s,a;for(a=[],i=0,s=this.length;i<s;i+=2)a.push(2*t.readUInt16());return a}).call(this):(function(){var s,a;for(a=[],i=0,s=this.length;i<s;i+=4)a.push(t.readUInt32());return a}).call(this)},e.prototype.indexOf=function(t){return this.offsets[t]},e.prototype.lengthOf=function(t){return this.offsets[t+1]-this.offsets[t]},e.prototype.encode=function(t,n){for(var i=new Uint32Array(this.offsets.length),s=0,a=0,o=0;o<i.length;++o)if(i[o]=s,a<n.length&&n[a]==o){++a,i[o]=s;var h=this.offsets[o],f=this.offsets[o+1]-h;f>0&&(s+=f)}for(var _=new Array(4*i.length),x=0;x<i.length;++x)_[4*x+3]=255&i[x],_[4*x+2]=(65280&i[x])>>8,_[4*x+1]=(16711680&i[x])>>16,_[4*x]=(4278190080&i[x])>>24;return _},e}(),Q5e=function(){function r(e){this.font=e,this.subset={},this.unicodes={},this.next=33}return r.prototype.generateCmap=function(){var e,t,n,i,s;for(t in i=this.font.cmap.tables[0].codeMap,e={},s=this.subset)n=s[t],e[t]=i[n];return e},r.prototype.glyphsFor=function(e){var t,n,i,s,a,o,h;for(i={},a=0,o=e.length;a<o;a++)i[s=e[a]]=this.font.glyf.glyphFor(s);for(s in t=[],i)(n=i[s])!=null&&n.compound&&t.push.apply(t,n.glyphIDs);if(t.length>0)for(s in h=this.glyphsFor(t))n=h[s],i[s]=n;return i},r.prototype.encode=function(e,t){var n,i,s,a,o,h,f,_,x,T,I,N,$,W,Y;for(i in n=x$.encode(this.generateCmap(),"unicode"),a=this.glyphsFor(e),I={0:0},Y=n.charMap)I[(h=Y[i]).old]=h.new;for(N in T=n.maxGlyphID,a)N in I||(I[N]=T++);return _=function(ie){var ce,fe;for(ce in fe={},ie)fe[ie[ce]]=ce;return fe}(I),x=Object.keys(_).sort(function(ie,ce){return ie-ce}),$=function(){var ie,ce,fe;for(fe=[],ie=0,ce=x.length;ie<ce;ie++)o=x[ie],fe.push(_[o]);return fe}(),s=this.font.glyf.encode(a,$,I),f=this.font.loca.encode(s.offsets,$),W={cmap:this.font.cmap.raw(),glyf:s.table,loca:f,hmtx:this.font.hmtx.raw(),hhea:this.font.hhea.raw(),maxp:this.font.maxp.raw(),post:this.font.post.raw(),name:this.font.name.raw(),head:this.font.head.encode(t)},this.font.os2.exists&&(W["OS/2"]=this.font.os2.raw()),this.font.directory.encode(W)},r}();yi.API.PDFObject=function(){var r;function e(){}return r=function(t,n){return(Array(n+1).join("0")+t).slice(-n)},e.convert=function(t){var n,i,s,a;if(Array.isArray(t))return"["+function(){var o,h,f;for(f=[],o=0,h=t.length;o<h;o++)n=t[o],f.push(e.convert(n));return f}().join(" ")+"]";if(typeof t=="string")return"/"+t;if(t!=null&&t.isString)return"("+t+")";if(t instanceof Date)return"(D:"+r(t.getUTCFullYear(),4)+r(t.getUTCMonth(),2)+r(t.getUTCDate(),2)+r(t.getUTCHours(),2)+r(t.getUTCMinutes(),2)+r(t.getUTCSeconds(),2)+"Z)";if({}.toString.call(t)==="[object Object]"){for(i in s=["<<"],t)a=t[i],s.push("/"+i+" "+e.convert(a));return s.push(">>"),s.join(`
`)}return""+t},e}();const CR={"circle-radius":8,"circle-color":"red","circle-stroke-width":1,"circle-stroke-color":"black"},ER={textSize:16,textHaloColor:"#FFFFFF",textHaloWidth:.8,textColor:"#000000",fallbackTextFont:["Open Sans Regular"]};let $5e=class{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:tm.A4,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:300,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:wA.PNG,s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:S0.mm,a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"map",o=arguments.length>6&&arguments[6]!==void 0?arguments[6]:"maplibregl-marker",h=arguments.length>7&&arguments[7]!==void 0?arguments[7]:CR,f=arguments.length>8&&arguments[8]!==void 0?arguments[8]:"maplibregl-ctrl-attrib-inner",_=arguments.length>9&&arguments[9]!==void 0?arguments[9]:ER;Is(this,"map"),Is(this,"width"),Is(this,"height"),Is(this,"dpi"),Is(this,"format"),Is(this,"unit"),Is(this,"fileName"),Is(this,"markerClassName"),Is(this,"markerCirclePaint"),Is(this,"attributionClassName"),Is(this,"attributionStyle"),this.map=e,this.width=t[0],this.height=t[1],this.dpi=n,this.format=i,this.unit=s,this.fileName=a,this.markerClassName=o,this.markerCirclePaint=h,this.attributionClassName=f,this.attributionStyle=_}renderMapPost(e){return e}getMarkers(){return this.map.getCanvasContainer().getElementsByClassName(this.markerClassName)}renderMarkers(e){const t=this.getMarkers();for(let n=0;n<t.length;n++){const i=t.item(n);if(!i)continue;const s=i.getAttribute("style");if(!s)continue;const a=/translate\(([^,]+)px,\s*([^,]+)px\)/,o=s.match(a);if(!o)continue;const h=parseInt(o[1]),f=parseInt(o[2]),_=this.map.unproject([h,f]),x=`point${n}`;e.addSource(x,{type:"geojson",data:{type:"Point",coordinates:[_.lng,_.lat]}}),e.addLayer({id:x,source:x,type:"circle",paint:this.markerCirclePaint})}return e}generate(){const e=this;JsLoadingOverlay.show({overlayBackgroundColor:"#5D5959",overlayOpacity:"0.6",spinnerIcon:"ball-spin",spinnerColor:"#2400FD",spinnerSize:"2x",overlayIDName:"overlay",spinnerIDName:"spinner",offsetX:0,offsetY:0,containerID:null,lockScroll:!1,overlayZIndex:9998,spinnerZIndex:9999});const t=window.devicePixelRatio;Object.defineProperty(window,"devicePixelRatio",{get(){return e.dpi/96}});const n=document.createElement("div");n.className="hidden-map",document.body.appendChild(n);const i=document.createElement("div");i.style.width=this.toPixels(this.width),i.style.height=this.toPixels(this.height),n.appendChild(i);const s=this.map.getStyle();if(s&&s.sources){const o=s.sources;Object.keys(o).forEach(h=>{const f=o[h];Object.keys(f).forEach(_=>{f[_]||delete f[_]})})}let a=this.getRenderedMap(i,s);a.once("idle",()=>{this.addAttributions(a)?a.once("idle",()=>{a=this.renderMapPost(a),this.getMarkers().length===0?this.exportImage(a,n,t):(a=this.renderMarkers(a),a.once("idle",()=>{this.exportImage(a,n,t)}))}):(a=this.renderMapPost(a),this.getMarkers().length===0?this.exportImage(a,n,t):(a=this.renderMarkers(a),a.once("idle",()=>{this.exportImage(a,n,t)})))})}stripHtml(e){const t=document.createElement("div");return t.innerHTML=e,t.textContent||t.innerText||""}addAttributions(e){if(!this.map.getStyle().glyphs)return!1;const t=e.getContainer(),n=parseInt(t.style.width.replace("px",""))-5,i=parseInt(t.style.height.replace("px",""))-5,s=[n,i],a=e.unproject(s),o=t.getElementsByClassName(this.attributionClassName),h=[];if((o==null?void 0:o.length)>0){const I=o.item(0);if(I)for(let N=0;N<I.children.length;N++){const $=I.children.item(N);$&&h.push(this.stripHtml($.outerHTML))}}else{const I=this.map.getStyle().sources;Object.keys(I).forEach(N=>{const $=I[N];if("attribution"in $){const W=$.attribution;h.push(this.stripHtml(W))}})}if(h.length===0)return!1;const f=h.join(" | "),_="attribution";e.addSource(_,{type:"geojson",data:{type:"Feature",geometry:{type:"Point",coordinates:[a.lng,a.lat]},properties:{attribution:f}}});const x=this.map.getStyle().layers.filter(I=>I.type==="symbol"&&I.layout&&"text-font"in I.layout),T=x.length>0&&x[0].layout?x[0].layout["text-font"]:this.attributionStyle.fallbackTextFont;return e.addLayer({id:_,source:_,type:"symbol",layout:{"text-field":["get","attribution"],"text-font":T,"text-max-width":parseInt(`${n/this.attributionStyle.textSize}`),"text-anchor":"bottom-right","text-justify":"right","text-size":this.attributionStyle.textSize},paint:{"text-halo-color":this.attributionStyle.textHaloColor,"text-halo-width":this.attributionStyle.textHaloWidth,"text-color":this.attributionStyle.textColor}}),!0}exportImage(e,t,n){var i;const s=e.getCanvas(),a=`${this.fileName}.${this.format}`;switch(this.format){case wA.PNG:this.toPNG(s,a);break;case wA.JPEG:this.toJPEG(s,a);break;case wA.PDF:this.toPDF(e,a);break;case wA.SVG:this.toSVG(s,a);break;default:console.error(`Invalid file format: ${this.format}`);break}e.remove(),(i=t.parentNode)==null||i.removeChild(t),Object.defineProperty(window,"devicePixelRatio",{get(){return n}}),t.remove(),JsLoadingOverlay.hide()}toPNG(e,t){const n=document.createElement("a");n.href=e.toDataURL(),n.download=t,n.click(),n.remove()}toJPEG(e,t){const n=e.toDataURL("image/jpeg",.85),i=document.createElement("a");i.href=n,i.download=t,i.click(),i.remove()}toPDF(e,t){const n=e.getCanvas(),i=new yi({orientation:this.width>this.height?"l":"p",unit:this.unit,compress:!0,format:[this.width,this.height]});i.addImage(n.toDataURL("image/png"),"png",0,0,this.width,this.height,void 0,"FAST");const{lng:s,lat:a}=e.getCenter();i.setProperties({title:e.getStyle().name,subject:`center: [${s}, ${a}], zoom: ${e.getZoom()}`,creator:"Mapbox GL Export Plugin",author:"(c)Mapbox, (c)OpenStreetMap"}),i.save(t)}toSVG(e,t){const n=e.toDataURL("image/png"),i=Number(this.toPixels(this.width,this.dpi).replace("px","")),s=Number(this.toPixels(this.height,this.dpi).replace("px","")),a=`
    <svg xmlns="http://www.w3.org/2000/svg" 
      xmlns:xlink="http://www.w3.org/1999/xlink" 
      version="1.1" 
      width="${i}" 
      height="${s}" 
      viewBox="0 0 ${i} ${s}" 
      xml:space="preserve">
        <image style="stroke: none; stroke-width: 0; stroke-dasharray: none; stroke-linecap: butt; stroke-dashoffset: 0; stroke-linejoin: miter; stroke-miterlimit: 4; fill: rgb(0,0,0); fill-rule: nonzero; opacity: 1;"  
      xlink:href="${n}" width="${i}" height="${s}"></image>
    </svg>`,o=document.createElement("a");o.href=`data:application/xml,${encodeURIComponent(a)}`,o.download=t,o.click(),o.remove()}toPixels(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:96;return this.unit===S0.mm&&(t/=25.4),`${t*e}px`}},j5e=class extends $5e{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:tm.A4,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:300,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:wA.PNG,s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:S0.mm,a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"map",o=arguments.length>6&&arguments[6]!==void 0?arguments[6]:CR,h=arguments.length>7&&arguments[7]!==void 0?arguments[7]:ER;super(e,t,n,i,s,a,"maplibregl-marker",o,"maplibregl-ctrl-attrib-inner",h)}getRenderedMap(e,t){const n=new MRe.Map({container:e,style:t,center:this.map.getCenter(),zoom:this.map.getZoom(),bearing:this.map.getBearing(),pitch:this.map.getPitch(),interactive:!1,preserveDrawingBuffer:!0,fadeDuration:0,transformRequest:this.map._requestManager._transformRequestFn});this.map.getTerrain()&&(n.setMaxPitch(85),n.setPitch(this.map.getPitch()));const i=(this.map.style.imageManager||{}).images||[];return Object.keys(i).forEach(s=>{n.addImage(s,i[s].data)}),n}renderMapPost(e){const t=this.map.getTerrain();return t&&e.setTerrain({source:t.source,exaggeration:t.exaggeration}),e}},q5e=class{constructor(e){Is(this,"controlContainer"),Is(this,"exportContainer"),Is(this,"crosshair"),Is(this,"printableArea"),Is(this,"map"),Is(this,"exportButton"),Is(this,"options",{PageSize:tm.A4,PageOrientation:xb.Landscape,Format:wA.PDF,DPI:rR[300],Crosshair:!1,PrintableArea:!1,Local:"en",AllowedSizes:Object.keys(tm),Filename:"map",markerCirclePaint:CR,attributionStyle:ER}),Is(this,"MAPLIB_CSS_PREFIX","maplibregl"),e&&(this.options=Object.assign(this.options,e)),this.onDocumentClick=this.onDocumentClick.bind(this)}getDefaultPosition(){return"top-right"}getTranslation(){const e=this.options.Local??"en";return KRe(e)}onAdd(e){var t;this.map=e,this.controlContainer=document.createElement("div"),this.controlContainer.classList.add(`${this.MAPLIB_CSS_PREFIX}-ctrl`),this.controlContainer.classList.add(`${this.MAPLIB_CSS_PREFIX}-ctrl-group`),this.exportContainer=document.createElement("div"),this.exportContainer.classList.add(`${this.MAPLIB_CSS_PREFIX}-export-list`),this.exportButton=document.createElement("button"),this.exportButton.classList.add(`${this.MAPLIB_CSS_PREFIX}-ctrl-icon`),this.exportButton.classList.add(`${this.MAPLIB_CSS_PREFIX}-export-control`),this.exportButton.type="button",this.exportButton.addEventListener("click",()=>{this.exportButton.style.display="none",this.exportContainer.style.display="block",this.toggleCrosshair(!0),this.togglePrintableArea(!0)}),document.addEventListener("click",this.onDocumentClick),this.controlContainer.appendChild(this.exportButton),this.controlContainer.appendChild(this.exportContainer);const n=document.createElement("TABLE");n.className="print-table";const i={};(t=this.options.AllowedSizes)==null||t.forEach(_=>{tm[_]&&(i[_]=tm[_])});const s=this.createSelection(i,this.getTranslation().PageSize,"page-size",this.options.PageSize,(_,x)=>JSON.stringify(_[x]));n.appendChild(s);const a=this.createSelection(xb,this.getTranslation().PageOrientation,"page-orientation",this.options.PageOrientation,(_,x)=>_[x]);n.appendChild(a);const o=this.createSelection(wA,this.getTranslation().Format,"format-type",this.options.Format,(_,x)=>_[x]);n.appendChild(o);const h=this.createSelection(rR,this.getTranslation().DPI,"dpi-type",this.options.DPI,(_,x)=>_[x]);n.appendChild(h),this.exportContainer.appendChild(n);const f=document.createElement("button");return f.type="button",f.textContent=this.getTranslation().Generate,f.classList.add("generate-button"),f.addEventListener("click",()=>{const _=document.getElementById("mapbox-gl-export-page-size"),x=document.getElementById("mapbox-gl-export-page-orientation"),T=document.getElementById("mapbox-gl-export-format-type"),I=document.getElementById("mapbox-gl-export-dpi-type"),N=x.value;let $=JSON.parse(_.value);N===xb.Portrait&&($=$.reverse()),this.generateMap(e,$,Number(I.value),T.value,S0.mm,this.options.Filename)}),this.exportContainer.appendChild(f),this.controlContainer}generateMap(e,t,n,i,s,a){new j5e(e,t,n,i,s,a,this.options.markerCirclePaint,this.options.attributionStyle).generate()}createSelection(e,t,n,i,s){const a=document.createElement("label");a.textContent=t;const o=document.createElement("select");o.setAttribute("id",`mapbox-gl-export-${n}`),o.style.width="100%",Object.keys(e).forEach(x=>{const T=document.createElement("option");T.setAttribute("value",s(e,x)),T.appendChild(document.createTextNode(x)),T.setAttribute("name",n),i===e[x]&&(T.selected=!0),o.appendChild(T)}),o.addEventListener("change",()=>{this.updatePrintableArea()});const h=document.createElement("TR"),f=document.createElement("TD"),_=document.createElement("TD");return f.appendChild(a),_.appendChild(o),h.appendChild(f),h.appendChild(_),h}onRemove(){!this.controlContainer||!this.controlContainer.parentNode||!this.map||!this.exportButton||(this.exportButton.removeEventListener("click",this.onDocumentClick),this.controlContainer.parentNode.removeChild(this.controlContainer),document.removeEventListener("click",this.onDocumentClick),this.crosshair!==void 0&&(this.crosshair.destroy(),this.crosshair=void 0),this.printableArea!==void 0&&(this.printableArea.destroy(),this.printableArea=void 0),this.map=void 0)}onDocumentClick(e){this.controlContainer&&!this.controlContainer.contains(e.target)&&this.exportContainer&&this.exportButton&&(this.exportContainer.style.display="none",this.exportButton.style.display="block",this.toggleCrosshair(!1),this.togglePrintableArea(!1))}toggleCrosshair(e){this.options.Crosshair===!0&&(e===!1?this.crosshair!==void 0&&(this.crosshair.destroy(),this.crosshair=void 0):(this.crosshair=new RRe(this.map),this.crosshair.create()))}togglePrintableArea(e){this.options.PrintableArea===!0&&(e===!1?this.printableArea!==void 0&&(this.printableArea.destroy(),this.printableArea=void 0):(this.printableArea=new LRe(this.map),this.updatePrintableArea()))}updatePrintableArea(){if(this.printableArea===void 0)return;const e=document.getElementById("mapbox-gl-export-page-size"),t=document.getElementById("mapbox-gl-export-page-orientation").value;let n=JSON.parse(e.value);t===xb.Portrait&&(n=n.reverse()),this.printableArea.updateArea(n[0],n[1])}};var B$=W5e,K5e=Object.prototype.hasOwnProperty;function W5e(){for(var r={},e=0;e<arguments.length;e++){var t=arguments[e];for(var n in t)K5e.call(t,n)&&(r[n]=t[n])}return r}var C$={exports:{}};(function(r,e){(function(){var t={};r.exports=t,t.simpleFilter=function(n,i){return i.filter(function(s){return t.test(n,s)})},t.test=function(n,i){return t.match(n,i)!==null},t.match=function(n,i,s){s=s||{};var a=0,o=[],h=i.length,f=0,_=0,x=s.pre||"",T=s.post||"",I=s.caseSensitive&&i||i.toLowerCase(),N;n=s.caseSensitive&&n||n.toLowerCase();for(var $=0;$<h;$++)N=i[$],I[$]===n[a]?(N=x+N+T,a+=1,_+=1+_):_=0,f+=_,o[o.length]=N;return a===n.length?(f=I===n?1/0:f,{rendered:o.join(""),score:f}):null},t.filter=function(n,i,s){return!i||i.length===0?[]:typeof n!="string"?i:(s=s||{},i.reduce(function(a,o,h,f){var _=o;s.extract&&(_=s.extract(o));var x=t.match(n,_,s);return x!=null&&(a[a.length]={string:x.rendered,score:x.score,index:h,original:o}),a},[]).sort(function(a,o){var h=o.score-a.score;return h||a.index-o.index}))}})()})(C$);var X5e=C$.exports,oh=function(r){return this.component=r,this.items=[],this.active=r.options.noInitialSelection?-1:0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,r.el.parentNode.insertBefore(this.wrapper,r.el.nextSibling),this};oh.prototype.show=function(){this.element.style.display="block"},oh.prototype.hide=function(){this.element.style.display="none"},oh.prototype.add=function(r){this.items.push(r)},oh.prototype.clear=function(){this.items=[],this.active=this.component.options.noInitialSelection?-1:0},oh.prototype.isEmpty=function(){return!this.items.length},oh.prototype.isVisible=function(){return this.element.style.display==="block"},oh.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var r=0;r<this.items.length;r++)this.drawItem(this.items[r],this.active===r);this.show()},oh.prototype.drawItem=function(r,e){var t=document.createElement("li"),n=document.createElement("a");e&&(t.className+=" active"),n.innerHTML=r.string,t.appendChild(n),this.element.appendChild(t),t.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),t.addEventListener("mouseup",(function(){this.handleMouseUp.call(this,r)}).bind(this))},oh.prototype.handleMouseUp=function(r){this.selectingListItem=!1,this.component.value(r.original),this.clear(),this.draw()},oh.prototype.move=function(r){this.active=r,this.draw()},oh.prototype.previous=function(){this.move(this.active<=0?this.items.length-1:this.active-1)},oh.prototype.next=function(){this.move(this.active>=this.items.length-1?0:this.active+1)},oh.prototype.drawError=function(r){var e=document.createElement("li");e.innerHTML=r,this.element.appendChild(e),this.show()};var J5e=oh,Z5e=B$,Y5e=X5e,e4e=J5e,su=function(r,e,t){return t=t||{},this.options=Z5e({minLength:2,limit:5,filter:!0,hideOnBlur:!0,noInitialSelection:!0},t),this.el=r,this.data=e||[],this.list=new e4e(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",(function(n){this.handleKeyUp(n.keyCode,n)}).bind(this),!1),this.el.addEventListener("keydown",(function(n){this.handleKeyDown(n)}).bind(this)),this.el.addEventListener("focus",(function(){this.handleFocus()}).bind(this)),this.el.addEventListener("blur",(function(){this.handleBlur()}).bind(this)),this.el.addEventListener("paste",(function(n){this.handlePaste(n)}).bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};su.prototype.handleKeyUp=function(r,e){if(!(r===40||r===38||r===27||r===9)){if(r===13){this.list.items[this.list.active]&&(this.list.handleMouseUp(this.list.items[this.list.active]),e.stopPropagation());return}this.handleInputChange(this.el.value)}},su.prototype.handleKeyDown=function(r){switch(r.keyCode){case 13:this.list.active>=0&&(this.list.selectingListItem=!0);break;case 9:this.list.isEmpty()||(this.list.isVisible()&&r.preventDefault(),this.value(this.list.active>=0?this.list.items[this.list.active].original:null),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}},su.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()},su.prototype.handlePaste=function(r){if(r.clipboardData)this.handleInputChange(r.clipboardData.getData("Text"));else{var e=this;setTimeout(function(){e.handleInputChange(r.target.value)},100)}},su.prototype.handleInputChange=function(r){if(this.query=this.normalize(r),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates((function(e){for(var t=0;t<e.length&&(this.list.add(e[t]),t!==this.options.limit-1);t++);this.list.draw()}).bind(this))},su.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1},su.prototype.update=function(r){this.data=r,this.handleKeyUp()},su.prototype.clear=function(){this.data=[],this.list.clear()},su.prototype.normalize=function(r){return r=r.toLowerCase(),r},su.prototype.match=function(r,e){return r.indexOf(e)>-1},su.prototype.value=function(r){if(this.selected=r,this.el.value=this.getItemValue(r||{place_name:this.query}),document.createEvent){var e=document.createEvent("HTMLEvents");e.initEvent("change",!0,!1),this.el.dispatchEvent(e)}else this.el.fireEvent("onchange")},su.prototype.getCandidates=function(r){var e={pre:"<strong>",post:"</strong>",extract:(function(n){return this.getItemValue(n)}).bind(this)},t;this.options.filter?(t=Y5e.filter(this.query,this.data,e),t=t.map((function(n){return{original:n.original,string:this.render(n.original,n.string)}}).bind(this))):t=this.data.map((function(n){var i=this.render(n);return{original:n,string:i}}).bind(this)),r(t)},su.prototype.getItemValue=function(r){return r},su.prototype.render=function(r,e){if(e)return e;for(var t=r.original?this.getItemValue(r.original):this.getItemValue(r),n=this.normalize(t),i=n.lastIndexOf(this.query);i>-1;){var s=i+this.query.length;t=t.slice(0,i)+"<strong>"+t.slice(i,s)+"</strong>"+t.slice(s),i=n.slice(0,i).lastIndexOf(this.query)}return t},su.prototype.renderError=function(r){this.list.drawError(r)};var t4e=su,E$=t4e,r4e=E$;typeof window<"u"&&(window.Suggestions=E$);var n4e="Expected a function",T$=NaN,i4e="[object Symbol]",s4e=/^\s+|\s+$/g,o4e=/^[-+]0x[0-9a-f]+$/i,a4e=/^0b[01]+$/i,l4e=/^0o[0-7]+$/i,c4e=parseInt,u4e=typeof Il=="object"&&Il&&Il.Object===Object&&Il,h4e=typeof self=="object"&&self&&self.Object===Object&&self,d4e=u4e||h4e||Function("return this")(),f4e=Object.prototype,A4e=f4e.toString,p4e=Math.max,g4e=Math.min,TR=function(){return d4e.Date.now()};function m4e(r,e,t){var n,i,s,a,o,h,f=0,_=!1,x=!1,T=!0;if(typeof r!="function")throw new TypeError(n4e);e=S$(e)||0,SR(t)&&(_=!!t.leading,x="maxWait"in t,s=x?p4e(S$(t.maxWait)||0,e):s,T="trailing"in t?!!t.trailing:T);function I(be){var Qe=n,Ue=i;return n=i=void 0,f=be,a=r.apply(Ue,Qe),a}function N(be){return f=be,o=setTimeout(Y,e),_?I(be):a}function $(be){var Qe=be-h,Ue=be-f,st=e-Qe;return x?g4e(st,s-Ue):st}function W(be){var Qe=be-h,Ue=be-f;return h===void 0||Qe>=e||Qe<0||x&&Ue>=s}function Y(){var be=TR();if(W(be))return ie(be);o=setTimeout(Y,$(be))}function ie(be){return o=void 0,T&&n?I(be):(n=i=void 0,a)}function ce(){o!==void 0&&clearTimeout(o),f=0,n=h=i=o=void 0}function fe(){return o===void 0?a:ie(TR())}function ve(){var be=TR(),Qe=W(be);if(n=arguments,i=this,h=be,Qe){if(o===void 0)return N(h);if(x)return o=setTimeout(Y,e),I(h)}return o===void 0&&(o=setTimeout(Y,e)),a}return ve.cancel=ce,ve.flush=fe,ve}function SR(r){var e=typeof r;return!!r&&(e=="object"||e=="function")}function _4e(r){return!!r&&typeof r=="object"}function y4e(r){return typeof r=="symbol"||_4e(r)&&A4e.call(r)==i4e}function S$(r){if(typeof r=="number")return r;if(y4e(r))return T$;if(SR(r)){var e=typeof r.valueOf=="function"?r.valueOf():r;r=SR(e)?e+"":e}if(typeof r!="string")return r===0?r:+r;r=r.replace(s4e,"");var t=a4e.test(r);return t||l4e.test(r)?c4e(r.slice(2),t?2:8):o4e.test(r)?T$:+r}var b4e=m4e,IR={exports:{}},U0=typeof Reflect=="object"?Reflect:null,I$=U0&&typeof U0.apply=="function"?U0.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)},zB;U0&&typeof U0.ownKeys=="function"?zB=U0.ownKeys:Object.getOwnPropertySymbols?zB=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:zB=function(e){return Object.getOwnPropertyNames(e)};function v4e(r){console&&console.warn&&console.warn(r)}var M$=Number.isNaN||function(e){return e!==e};function oo(){oo.init.call(this)}IR.exports=oo,IR.exports.once=C4e,oo.EventEmitter=oo,oo.prototype._events=void 0,oo.prototype._eventsCount=0,oo.prototype._maxListeners=void 0;var P$=10;function HB(r){if(typeof r!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof r)}Object.defineProperty(oo,"defaultMaxListeners",{enumerable:!0,get:function(){return P$},set:function(r){if(typeof r!="number"||r<0||M$(r))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+r+".");P$=r}}),oo.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},oo.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||M$(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function F$(r){return r._maxListeners===void 0?oo.defaultMaxListeners:r._maxListeners}oo.prototype.getMaxListeners=function(){return F$(this)},oo.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i=e==="error",s=this._events;if(s!==void 0)i=i&&s.error===void 0;else if(!i)return!1;if(i){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var o=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw o.context=a,o}var h=s[e];if(h===void 0)return!1;if(typeof h=="function")I$(h,this,t);else for(var f=h.length,_=k$(h,f),n=0;n<f;++n)I$(_[n],this,t);return!0};function R$(r,e,t,n){var i,s,a;if(HB(t),s=r._events,s===void 0?(s=r._events=Object.create(null),r._eventsCount=0):(s.newListener!==void 0&&(r.emit("newListener",e,t.listener?t.listener:t),s=r._events),a=s[e]),a===void 0)a=s[e]=t,++r._eventsCount;else if(typeof a=="function"?a=s[e]=n?[t,a]:[a,t]:n?a.unshift(t):a.push(t),i=F$(r),i>0&&a.length>i&&!a.warned){a.warned=!0;var o=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");o.name="MaxListenersExceededWarning",o.emitter=r,o.type=e,o.count=a.length,v4e(o)}return r}oo.prototype.addListener=function(e,t){return R$(this,e,t,!1)},oo.prototype.on=oo.prototype.addListener,oo.prototype.prependListener=function(e,t){return R$(this,e,t,!0)};function x4e(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function L$(r,e,t){var n={fired:!1,wrapFn:void 0,target:r,type:e,listener:t},i=x4e.bind(n);return i.listener=t,n.wrapFn=i,i}oo.prototype.once=function(e,t){return HB(t),this.on(e,L$(this,e,t)),this},oo.prototype.prependOnceListener=function(e,t){return HB(t),this.prependListener(e,L$(this,e,t)),this},oo.prototype.removeListener=function(e,t){var n,i,s,a,o;if(HB(t),i=this._events,i===void 0)return this;if(n=i[e],n===void 0)return this;if(n===t||n.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if(typeof n!="function"){for(s=-1,a=n.length-1;a>=0;a--)if(n[a]===t||n[a].listener===t){o=n[a].listener,s=a;break}if(s<0)return this;s===0?n.shift():w4e(n,s),n.length===1&&(i[e]=n[0]),i.removeListener!==void 0&&this.emit("removeListener",e,o||t)}return this},oo.prototype.off=oo.prototype.removeListener,oo.prototype.removeAllListeners=function(e){var t,n,i;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[e]),this;if(arguments.length===0){var s=Object.keys(n),a;for(i=0;i<s.length;++i)a=s[i],a!=="removeListener"&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=n[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this};function D$(r,e,t){var n=r._events;if(n===void 0)return[];var i=n[e];return i===void 0?[]:typeof i=="function"?t?[i.listener||i]:[i]:t?B4e(i):k$(i,i.length)}oo.prototype.listeners=function(e){return D$(this,e,!0)},oo.prototype.rawListeners=function(e){return D$(this,e,!1)},oo.listenerCount=function(r,e){return typeof r.listenerCount=="function"?r.listenerCount(e):O$.call(r,e)},oo.prototype.listenerCount=O$;function O$(r){var e=this._events;if(e!==void 0){var t=e[r];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}oo.prototype.eventNames=function(){return this._eventsCount>0?zB(this._events):[]};function k$(r,e){for(var t=new Array(e),n=0;n<e;++n)t[n]=r[n];return t}function w4e(r,e){for(;e+1<r.length;e++)r[e]=r[e+1];r.pop()}function B4e(r){for(var e=new Array(r.length),t=0;t<e.length;++t)e[t]=r[t].listener||r[t];return e}function C4e(r,e){return new Promise(function(t,n){function i(a){r.removeListener(e,s),n(a)}function s(){typeof r.removeListener=="function"&&r.removeListener("error",i),t([].slice.call(arguments))}U$(r,e,s,{once:!0}),e!=="error"&&E4e(r,i,{once:!0})})}function E4e(r,e,t){typeof r.on=="function"&&U$(r,"error",e,t)}function U$(r,e,t,n){if(typeof r.on=="function")n.once?r.once(e,t):r.on(e,t);else if(typeof r.addEventListener=="function")r.addEventListener(e,function i(s){n.once&&r.removeEventListener(e,i),t(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof r)}var N$=IR.exports,T4e={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}},S4e={de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"",ja:"",lv:"Meklt",pt:"Procurar",sr:"",zh:"",cs:"Vyhledvn",hu:"Keress",ka:"",nb:"Ske",sk:"Vyhadvanie",th:"",fi:"Hae",is:"Leita",ko:"",pl:"Szukaj",sl:"Iskanje",fa:"",ru:""},I4e={placeholder:S4e},z$={exports:{}};(function(r){(function(e,t,n){r.exports?r.exports=n():e[t]=n()})(Il,"subtag",function(){var e="",t=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function n(h){return h.match(t)||[]}function i(h){return n(h).filter(function(f,_){return f&&_})}function s(h){return h=n(h),{language:h[1]||e,extlang:h[2]||e,script:h[3]||e,region:h[4]||e}}function a(h,f,_){Object.defineProperty(h,f,{value:_,enumerable:!0})}function o(h,f,_){function x(T){return n(T)[h]||e}a(x,"pattern",f),a(s,_,x)}return o(1,/^[a-zA-Z]{2,3}$/,"language"),o(2,/^[a-zA-Z]{3}$/,"extlang"),o(3,/^[a-zA-Z]{4}$/,"script"),o(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),a(s,"split",i),s})})(z$);var M4e=z$.exports,P4e=r4e,F4e=b4e,Lh=B$,R4e=N$.EventEmitter,H$=T4e,L4e=I4e,D4e=M4e;function V$(r,e){this._eventEmitter=new R4e,this.options=Lh({},this.options,e),this.inputString="",this.fresh=!0,this.lastSelected=null,this.geocoderApi=r}V$.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,showResultsWhileTyping:!1,minLength:2,reverseGeocode:!1,limit:5,enableEventLogging:!0,marker:!0,popup:!1,maplibregl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,getItemValue:function(r){return r.text!==void 0?r.text:r.place_name},render:function(r){if(r.geometry){var o=r.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--result maplibregl-ctrl-geocoder--result"><svg class="mapboxgl-ctrl-geocoder--result-icon maplibre-ctrl-geocoder--result-icon" viewBox="0 0 24 32" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 0C5.36571 0 0 5.38676 0 12.0471C0 21.0824 12 32 12 32C12 32 24 21.0824 24 12.0471C24 5.38676 18.6343 0 12 0ZM12 16.3496C9.63428 16.3496 7.71429 14.4221 7.71429 12.0471C7.71429 9.67207 9.63428 7.74454 12 7.74454C14.3657 7.74454 16.2857 9.67207 16.2857 12.0471C16.2857 14.4221 14.3657 16.3496 12 16.3496Z" fill="#687078"/></svg><div><div class="mapboxgl-ctrl-geocoder--result-title maplibregl-ctrl-geocoder--result-title">'+o[0]+'</div><div class="mapboxgl-ctrl-geocoder--result-address maplibregl-ctrl-geocoder--result-address">'+o.splice(1,o.length).join(",")+"</div></div></div>"}else{var e=r.text,t=e.toLowerCase().indexOf(this.query.toLowerCase()),n=this.query.length,i=e.substring(0,t),s=e.substring(t,t+n),a=e.substring(t+n);return'<div class="mapboxgl-ctrl-geocoder--suggestion maplibregl-ctrl-geocoder--suggestion"><svg class="mapboxgl-ctrl-geocoder--suggestion-icon maplibre-ctrl-geocoder--suggestion-icon" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><path d="M22.8702 20.1258H21.4248L20.9125 19.6318C22.7055 17.546 23.785 14.8382 23.785 11.8925C23.785 5.32419 18.4608 0 11.8925 0C5.32419 0 0 5.32419 0 11.8925C0 18.4608 5.32419 23.785 11.8925 23.785C14.8382 23.785 17.546 22.7055 19.6318 20.9125L20.1258 21.4248V22.8702L29.2739 32L32 29.2739L22.8702 20.1258ZM11.8925 20.1258C7.33676 20.1258 3.65923 16.4483 3.65923 11.8925C3.65923 7.33676 7.33676 3.65923 11.8925 3.65923C16.4483 3.65923 20.1258 7.33676 20.1258 11.8925C20.1258 16.4483 16.4483 20.1258 11.8925 20.1258Z" fill="#687078"/></svg><div class="mapboxgl-ctrl-geocoder--suggestion-info maplibregl-ctrl-geocoder--suggestion-info"><div class="mapboxgl-ctrl-geocoder--suggestion-title maplibregl-ctrl-geocoder--suggestion-title">'+i+'<span class="mapboxgl-ctrl-geocoder--suggestion-match maplibregl-ctrl-geocoder--suggestion-match">'+s+"</span>"+a+"</div></div></div>"}},popupRender:function(r){var e=r.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion maplibre-ctrl-geocoder--suggestion popup-suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title maplibre-ctrl-geocoder--suggestion-title popup-suggestion-title">'+e[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address maplibre-ctrl-geocoder--suggestion-address popup-suggestion-address">'+e.splice(1,e.length).join(",")+"</div></div>"},showResultMarkers:!0,debounceSearch:200},addTo:function(r){function e(n,i){if(!document.body.contains(i))throw new Error("Element provided to #addTo() exists, but is not in the DOM");var s=n.onAdd();i.appendChild(s)}if(r._controlContainer)r.addControl(this);else if(r instanceof HTMLElement)e(this,r);else if(typeof r=="string"){var t=document.querySelectorAll(r);if(t.length===0)throw new Error("Element ",r,"not found.");if(t.length>1)throw new Error("Geocoder can only be added to a single html element");e(this,t[0])}else throw new Error("Error: addTo must be a maplibre-gl-js map, an html element, or a CSS selector query for a single html element")},onAdd:function(r){if(r&&typeof r!="string"&&(this._map=r),this.setLanguage(),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this);var e=this.container=document.createElement("div");e.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl maplibregl-ctrl-geocoder maplibregl-ctrl";var t=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input maplibregl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",F4e(this._onKeyDown,this.options.debounceSearch)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton);var n=document.createElement("div");n.classList.add("mapboxgl-ctrl-geocoder--pin-right","maplibregl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button maplibregl-ctrl-geocoder--button";var i=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');return this._clearEl.appendChild(i),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),n.appendChild(this._clearEl),n.appendChild(this._loadingEl),e.appendChild(t),e.appendChild(this._inputEl),e.appendChild(n),this._typeahead=new P4e(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit,noInitialSelection:!0}),this.setRenderFunction(this.options.render),this._typeahead.getItemValue=this.options.getItemValue,this.mapMarker=null,this.resultMarkers=[],this._handleMarker=this._handleMarker.bind(this),this._handleResultMarkers=this._handleResultMarkers.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._maplibregl=this.options.maplibregl,!this._maplibregl&&this.options.marker&&(console.error("No maplibregl detected in options. Map markers are disabled. Please set options.maplibregl."),this.options.marker=!1)),e},createIcon:function(r,e){var t=document.createElementNS("http://www.w3.org/2000/svg","svg");if(t.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+r+" maplibregl-ctrl-geocoder--icon maplibregl-ctrl-geocoder--icon-"+r),t.setAttribute("viewBox","0 0 18 18"),t.setAttribute("xml:space","preserve"),t.setAttribute("width",18),t.setAttribute("height",18),"innerHTML"in t)t.innerHTML=e;else{var n=document.createElement("div");n.innerHTML="<svg>"+e.valueOf().toString()+"</svg>";var i=n.firstChild,s=i.firstChild;t.appendChild(s)}return t},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_onPaste:function(r){var e=(r.clipboardData||window.clipboardData).getData("text");e.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(e)},_onKeyDown:function(r){var e=27,t=9;if(r.keyCode===e&&this.options.clearAndBlurOnEsc)return this._clear(r),this._inputEl.blur();var n=r.target&&r.target.shadowRoot?r.target.shadowRoot.activeElement:r.target,i=n?n.value:"";if(!i)return this.fresh=!0,r.keyCode!==t&&this.clear(r),this._clearEl.style.display="none";if(!(r.metaKey||[t,e,37,39,38,40].indexOf(r.keyCode)!==-1)){if(r.keyCode===13)if(!this.options.showResultsWhileTyping)this._typeahead.selected||this._geocode(n.value);else{this._typeahead.selected==null&&this.geocoderApi.getSuggestions?this._geocode(n.value,!0):this._typeahead.selected==null&&this.options.showResultMarkers&&this._fitBoundsForMarkers();return}n.value.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(n.value)}},_showButton:function(){this._inputEl.value.length>0&&(this._clearEl.style.display="block")},_hideButton:function(){this._typeahead.selected&&(this._clearEl.style.display="none")},_onBlur:function(r){this.options.clearOnBlur&&this._clearOnBlur(r),this.options.collapsed&&this._collapse()},_onChange:function(){var r=this._typeahead.selected;if(r&&!r.geometry)r.placeId?this._geocode(r.placeId,!0,!0):this._geocode(r.text,!0);else if(r&&JSON.stringify(r)!==this.lastSelected){if(this._clearEl.style.display="none",this.options.flyTo){var e;if(this._removeResultMarkers(),r.properties&&H$[r.properties.short_code])e=Lh({},this.options.flyTo),this._map&&this._map.fitBounds(H$[r.properties.short_code].bbox,e);else if(r.bbox){var t=r.bbox;e=Lh({},this.options.flyTo),this._map&&this._map.fitBounds([[t[0],t[1]],[t[2],t[3]]],e)}else{var n={zoom:this.options.zoom};e=Lh({},n,this.options.flyTo),r.center?e.center=r.center:r.geometry&&r.geometry.type&&r.geometry.type==="Point"&&r.geometry.coordinates&&(e.center=r.geometry.coordinates),this._map&&this._map.flyTo(e)}}this.options.marker&&this._maplibregl&&this._handleMarker(r),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(r),this._typeahead.selected=null,this._eventEmitter.emit("result",{result:r})}},_getConfigForRequest:function(){var r=["bbox","limit","proximity","countries","types","language","reverseMode"],e=this,t=r.reduce(function(n,i){return e.options[i]&&(["countries","types","language"].indexOf(i)>-1?n[i]=e.options[i].split(/[\s,]+/):n[i]=e.options[i],i==="proximity"&&e.options[i]&&typeof e.options[i].longitude=="number"&&typeof e.options[i].latitude=="number"&&(n[i]=[e.options[i].longitude,e.options[i].latitude])),n},{});return t},_geocode:function(r,e,t){this._loadingEl.style.display="block",this._eventEmitter.emit("loading",{query:r}),this.inputString=r;var n=null,i=this._getConfigForRequest(),s;if(this.options.localGeocoderOnly)s=Promise.resolve();else if(this.options.reverseGeocode&&/(-?\d+\.?\d*)[, ]+(-?\d+\.?\d*)[ ]*$/.test(r)){var a=r.split(/[\s(,)?]+/).map(function(f){return parseFloat(f,10)}).reverse();i.types&&i.types[0],i=Lh(i,{query:a,limit:1}),"proximity"in i&&delete i.proximity,s=this.geocoderApi.reverseGeocode(i)}else i=Lh(i,{query:r}),this.geocoderApi.getSuggestions?e?this.geocoderApi.searchByPlaceId&&t?s=this.geocoderApi.searchByPlaceId(i):s=this.geocoderApi.forwardGeocode(i):s=this.geocoderApi.getSuggestions(i):s=this.geocoderApi.forwardGeocode(i);var o=[];this.options.localGeocoder&&(o=this.options.localGeocoder(r),o||(o=[]));var h=[];return s.catch((function(f){n=f}).bind(this)).then((function(f){this._loadingEl.style.display="none";var _={};return f?_=f:_={type:"FeatureCollection",features:[]},_.config=i,this.fresh&&(this.fresh=!1),_.features=_.features?o.concat(_.features):o,this.options.externalGeocoder?(h=this.options.externalGeocoder(r,_.features,i)||[],h.then(function(x){return _.features=_.features?x.concat(_.features):x,_},function(){return _})):_}).bind(this)).then((function(f){if(n)throw n;this.options.filter&&f.features.length&&(f.features=f.features.filter(this.options.filter));var _=[];f.suggestions?_=f.suggestions:f.place?_=[f.place]:_=f.features,_.length?(this._clearEl.style.display="block",this._typeahead.update(_),(!this.options.showResultsWhileTyping||e)&&this.options.showResultMarkers&&(f.features.length>0||f.place)&&this._fitBoundsForMarkers(),this._eventEmitter.emit("results",f)):(this._clearEl.style.display="none",this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",f))}).bind(this)).catch((function(f){this._loadingEl.style.display="none",o.length&&this.options.localGeocoder||h.length&&this.options.externalGeocoder?(this._clearEl.style.display="block",this._typeahead.update(o)):(this._clearEl.style.display="none",this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:o}),this._eventEmitter.emit("error",{error:f})}).bind(this)),s},_clear:function(r){r&&r.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._clearEl.style.display="none",this._removeMarker(),this._removeResultMarkers(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(r){this._clear(r),this._inputEl.focus()},_clearOnBlur:function(r){var e=this;r.relatedTarget&&e._clear(r)},_onQueryResult:function(r){var e=r;if(e.features.length){var t=e.features[0];this._typeahead.selected=t,this._inputEl.value=t.place_name,this._onChange()}},_updateProximity:function(){if(this._map)if(this._map.getZoom()>9){var r=this._map.getCenter().wrap();this.setProximity({longitude:r.lng,latitude:r.lat})}else this.setProximity(null)},_collapse:function(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed","maplibregl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed","maplibregl-ctrl-geocoder--collapsed")},query:function(r){return this._geocode(r).then(this._onQueryResult),this},_renderError:function(){var r="<div class='mapbox-gl-geocoder--error maplibre-gl-geocoder--error'>There was an error reaching the server</div>";this._renderMessage(r)},_renderNoResults:function(){var r="<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results maplibre-gl-geocoder--error maplibre-gl-geocoder--no-results'>No results found</div>";this._renderMessage(r)},_renderMessage:function(r){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(r)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var r=this.options.language.split(",")[0],e=D4e.language(r),t=L4e.placeholder[e];if(t)return t}return"Search"},_fitBoundsForMarkers:function(){if(!(this._typeahead.data.length<1)){var r=this._typeahead.data.filter(function(i){return typeof i!="string"}).slice(0,this.options.limit);if(this._clearEl.style.display="none",this.options.flyTo&&this._maplibregl&&this._map){var e={padding:100},t=Lh({},e,this.options.flyTo),n=new this._maplibregl.LngLatBounds;r.forEach(function(i){n.extend(i.geometry.coordinates)}),this._map.fitBounds(n.toArray(),t)}return r.length>0&&this._maplibregl&&this._handleResultMarkers(r),this}},setInput:function(r){return this._inputEl.value=r,this._typeahead.selected=null,this._typeahead.clear(),r.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(r),this},setProximity:function(r){return this.options.proximity=r,this},getProximity:function(){return this.options.proximity},setRenderFunction:function(r){return r&&typeof r=="function"&&(this._typeahead.render=r),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(r){var e=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=r||this.options.language||e,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(r){return this.options.zoom=r,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(r){return this.options.flyTo=r,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(r){return this.placeholder=r||this._getPlaceholderText(),this._inputEl.placeholder=this.placeholder,this._inputEl.setAttribute("aria-label",this.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(r){return this.options.bbox=r,this},getCountries:function(){return this.options.countries},setCountries:function(r){return this.options.countries=r,this},getTypes:function(){return this.options.types},setTypes:function(r){return this.options.types=r,this},getMinLength:function(){return this.options.minLength},setMinLength:function(r){return this.options.minLength=r,this._typeahead&&(this._typeahead.options.minLength=r),this},getLimit:function(){return this.options.limit},setLimit:function(r){return this.options.limit=r,this._typeahead&&(this._typeahead.options.limit=r),this},getFilter:function(){return this.options.filter},setFilter:function(r){return this.options.filter=r,this},setGeocoderApi:function(r){return this.geocoderApi=r,this},getGeocoderApi:function(){return this.geocoderApi},_handleMarker:function(r){if(this._map){this._removeMarker();var e={color:"#4668F2"},t=Lh({},e,this.options.marker);this.mapMarker=new this._maplibregl.Marker(t);var n;if(this.options.popup){var i={},s=Lh({},i,this.options.popup);n=new this._maplibregl.Popup(s).setHTML(this.options.popupRender(r))}return r.center?(this.mapMarker.setLngLat(r.center).addTo(this._map),this.options.popup&&this.mapMarker.setPopup(n)):r.geometry&&r.geometry.type&&r.geometry.type==="Point"&&r.geometry.coordinates&&(this.mapMarker.setLngLat(r.geometry.coordinates).addTo(this._map),this.options.popup&&this.mapMarker.setPopup(n)),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},_handleResultMarkers:function(r){if(this._map){this._removeResultMarkers();var e={color:"#4668F2"},t=Lh({},e,this.options.showResultMarkers);return r.forEach((function(n){if(this.options.showResultMarkers&&this.options.showResultMarkers.element){var i=this.options.showResultMarkers.element.cloneNode(!0);t=Lh(t,{element:i})}var s=new this._maplibregl.Marker(Lh({},t,{element:i})),a;if(this.options.popup){var o={},h=Lh({},o,this.options.popup);a=new this._maplibregl.Popup(h).setHTML(this.options.popupRender(n))}n.center?(s.setLngLat(n.center).addTo(this._map),this.options.popup&&s.setPopup(a)):n.geometry&&n.geometry.type&&n.geometry.type==="Point"&&n.geometry.coordinates&&(s.setLngLat(n.geometry.coordinates).addTo(this._map),this.options.popup&&s.setPopup(a)),this.resultMarkers.push(s)}).bind(this)),this}},_removeResultMarkers:function(){this.resultMarkers&&this.resultMarkers.length>0&&(this.resultMarkers.forEach(function(r){r.remove()}),this.resultMarkers=[])},on:function(r,e){return this._eventEmitter.on(r,e),this},off:function(r,e){return this._eventEmitter.removeListener(r,e),this}};var O4e=V$;const k4e=dA(O4e),om={defaultOptions:{limitsUrl:"https://tilemaps.icgc.cat/vt/limits-tilejsonV3.json",geocoder:{peliasUrl1:"https://eines.icgc.cat/geocodificador/autocompletar?text=",peliasUrl2:"&layers=topo1%2Ctopo2%2Caddress&size=5"},mapOptions:{container:"map",center:{0:1.537786,1:41.837539},zoom:7.5,bearing:0,pitch:0,hash:!1,style:"https://geoserveis.icgc.cat/styles/icgc_mapa_base_gris.json.json",maxZoom:18,maxPitch:85},logoIcgcOptions:{logoUrlColor:"https://eines.icgc.cat/recursos/logos/icgc_logo_color.png",logoUrlWhite:"https://eines.icgc.cat/recursos/logos/icgc_logo_blanc.svg",logoLink:"https://www.icgc.cat",logoTitle:"Institut Cartogrfic i Geolgic de Catalunya",logoWidth:100,logoOpacity:.6},logoGencatOptions:{logoUrlColor:"https://eines.icgc.cat/recursos/logos/gencat_logo_color.png",logoUrlWhite:"https://eines.icgc.cat/recursos/logos/gencat_logo_blanc.png",logoLink:"https://web.gencat.cat/",logoTitle:"Generalitat de Catalunya",logoWidth:100,logoOpacity:.6},map3dOptions:{spaceErrorFactor:2,exaggeration:1,zfactor:48,minZoomRange:15.5,maxZoomRange:22,urlTilesetCities:"https://geoserveis.icgc.cat/servei/catalunya/ciutats/3dtiles/v1/tilesetV1.0.json",layerIdOrder:"place-isolated",sourceLayerFilterId:"place",minZoomFilter:14,layerId3d:"edificisMapboxLayer",terrainSource:"ICGC5M",style3dName:"orto3d",imageIcon:"https://eines.icgc.cat/recursos//images/stick.png"},baseStyles:[{key:"TOPO",url:"https://geoserveis.icgc.cat/styles/icgc_mapa_base_topografic.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_mapa_estandard.png"},{key:"ORTO",url:"https://geoserveis.icgc.cat/styles/icgc_orto_estandard.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_orto_estandard.png"},{key:"ORTO3D",url:"https://eines.icgc.cat/recursos//styles/icgc_orto_3d.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_orto_estandard.png"},{key:"ORTOHYBRID",url:"https://geoserveis.icgc.cat/styles/icgc_orto_hibrida.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_orto_hibrida.png"},{key:"ADMIN",url:"https://geoserveis.icgc.cat/styles/icgc_limits_administratius_gris.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_delimitacio_limits_administratius.png"},{key:"DARK",url:"https://geoserveis.icgc.cat/styles/icgc_mapa_base_fosc.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_mapa_base_fosc.png"},{key:"LIGHT",url:"https://geoserveis.icgc.cat/styles/icgc_mapa_base_gris.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_mapa_base_gris.png"},{key:"GEOLOGY",url:"https://geoserveis.icgc.cat/styles/icgc_geologic_informacio.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_geologic_informacio.png"},{key:"RASTER",substyles:{TOPO:{url:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/topografic/MON3857NW/{z}/{x}/{y}.png",image:"https://icgc-web-pro.s3.eu-central-1.amazonaws.com/produccio/s3fs-public/2024-10/mapabase_topo.jpg"},ADMIN:{url:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/administratiu/MON3857NW/{z}/{x}/{y}.png",image:"https://icgc-web-pro.s3.eu-central-1.amazonaws.com/produccio/s3fs-public/2024-10/mapabase_administratiu.jpg"},LIGHT:{url:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/topografic-gris/MON3857NW/{z}/{x}/{y}.png",image:"https://icgc-web-pro.s3.eu-central-1.amazonaws.com/produccio/s3fs-public/2024-10/mapabase_topo_gris.jpg"},STANDARD:{url:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/estandard/MON3857NW/{z}/{x}/{y}.png",image:"https://icgc-web-pro.s3.eu-central-1.amazonaws.com/produccio/s3fs-public/2024-10/mapabase_estandard_0.jpg"},Simplified:{url:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/simplificat/MON3857NW/{z}/{x}/{y}.png",image:"https://icgc-web-pro.s3.eu-central-1.amazonaws.com/produccio/s3fs-public/2024-10/mapabase_simplificat.jpg"},ORTO:{url:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/orto/MON3857NW/{z}/{x}/{y}.png",image:"https://icgc-web-pro.s3.eu-central-1.amazonaws.com/produccio/s3fs-public/2024-10/mapabase_orto.jpg"},ORTOGREY:{url:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/orto-gris/MON3857NW/{z}/{x}/{y}.png",image:"https://icgc-web-pro.s3.eu-central-1.amazonaws.com/produccio/s3fs-public/2024-10/mapabase_orto_gris.jpg"},ORTOHYBRID:{url:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/orto-hibrida/MON3857NW/{z}/{x}/{y}.png",image:"https://icgc-web-pro.s3.eu-central-1.amazonaws.com/produccio/s3fs-public/2024-10/mapabase_orto_hibida.jpg"}}}],urlTerrainICGC:[{name:"ICGC5M",url:"https://tilemaps.icgc.cat/tileserver/tileserver/terreny-5m-30m-rgb-extent/{z}/{x}/{y}.png"},{name:"WORLD30M",url:"https://s3.amazonaws.com/elevation-tiles-prod/terrarium/{z}/{x}/{y}.png",encoding:"terrarium"}],ortoLayersICGC:[{name:"ortofotoColorProvisional",key:"ortofoto_color_provisional",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_provisional"},{name:"ortofotoColor2023",key:"ortofoto_color_2023",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2023"},{name:"ortofotoColor2022",key:"ortofoto_color_2022",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2022"},{name:"ortofotoColor2021",key:"ortofoto_color_2021",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2021"},{name:"ortofotoColor2020",key:"ortofoto_color_2020",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2020"},{name:"ortofotoColor2019",key:"ortofoto_color_2019",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2019"},{name:"ortofotoColor2018",key:"ortofoto_color_2018",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2018"},{name:"ortofotoColor2017",key:"ortofoto_color_2017",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2017"},{name:"ortofotoColor2016",key:"ortofoto_color_2016",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2016"},{name:"ortofotoColor2015",key:"ortofoto_color_2015",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2015"},{name:"ortofotoColor2014",key:"ortofoto_color_2014",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2014"},{name:"ortofotoColor2013",key:"ortofoto_color_2013",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2013"},{name:"ortofotoColor2012",key:"ortofoto_color_2012",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2012"},{name:"ortofotoColor2011",key:"ortofoto_color_2011",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2011"},{name:"ortofotoColor2010",key:"ortofoto_color_2010",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2010"},{name:"ortofotoColor2009",key:"ortofoto_color_2009",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2009"},{name:"ortofotoColor2008",key:"ortofoto_color_2008",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2008"},{name:"ortofotoColor20062007",key:"ortofoto_color_2006-2007",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2006-2007"},{name:"ortofotoColor20042005",key:"ortofoto_color_2004-2005",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2004-2005"},{name:"ortofotoColor20002003",key:"ortofoto_color_2000-2003",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2000-2003"},{name:"ortofotoBlancINegre1998",key:"ortofoto_blanc_i_negre_1998",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1998"},{name:"ortofotoBlancINegre19941997",key:"ortofoto_blanc_i_negre_1994-1997",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1994-1997"},{name:"ortofotoColor1993",key:"ortofoto_color_1993",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_1993"},{name:"ortofotoBlancINegre19831992",key:"ortofoto_blanc_i_negre_1983-1992",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1983-1992"},{name:"ortofotoBlancINegre19701977",key:"ortofoto_blanc_i_negre_1970-1977",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1970-1977"},{name:"ortofotoBlancINegre1956",key:"ortofoto_blanc_i_negre_1956",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1956"},{name:"ortofotoBlancINegre1945",key:"ortofoto_blanc_i_negre_1945",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1945"},{name:"ortofotoColorSerieAnual",key:"ortofoto_color_serie_anual",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_serie_anual"},{name:"ortofotoInfraroigProvisional",key:"ortofoto_infraroig_provisional",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_provisional"},{name:"ortofotoInfraroig2023",key:"ortofoto_infraroig_2023",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2023"},{name:"ortofotoInfraroig2022",key:"ortofoto_infraroig_2022",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2022"},{name:"ortofotoInfraroig2021",key:"ortofoto_infraroig_2021",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2021"},{name:"ortofotoInfraroig2020",key:"ortofoto_infraroig_2020",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2020"},{name:"ortofotoInfraroig2019",key:"ortofoto_infraroig_2019",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2019"},{name:"ortofotoInfraroig2018",key:"ortofoto_infraroig_2018",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2018"},{name:"ortofotoInfraroig2017",key:"ortofoto_infraroig_2017",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2017"},{name:"ortofotoInfraroig2016",key:"ortofoto_infraroig_2016",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2016"},{name:"ortofotoInfraroig2015",key:"ortofoto_infraroig_2015",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2015"},{name:"ortofotoInfraroig2014",key:"ortofoto_infraroig_2014",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2014"},{name:"ortofotoInfraroig2013",key:"ortofoto_infraroig_2013",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2013"},{name:"ortofotoInfraroig2012",key:"ortofoto_infraroig_2012",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2012"},{name:"ortofotoInfraroig2011",key:"ortofoto_infraroig_2011",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2011"},{name:"ortofotoInfraroig2010",key:"ortofoto_infraroig_2010",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2010"},{name:"ortofotoInfraroig2009",key:"ortofoto_infraroig_2009",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2009"},{name:"ortofotoInfraroig2008",key:"ortofoto_infraroig_2008",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2008"},{name:"ortofotoInfraroig20062007",key:"ortofoto_infraroig_2006-2007",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2006-2007"},{name:"ortofotoInfraroig19961997",key:"ortofoto_infraroig_1996-1997",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_1996-1997"},{name:"ortofotoInfraroigSerieAnual",key:"ortofoto_infraroig_serie_anual",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_serie_anual"}],vectorLayersICGC:[{name:"agrupacionsCensals2015",key:"agrupacions_censals_2015"},{name:"agrupacionsCensals2016",key:"agrupacions_censals_2016"},{name:"agrupacionsCensals2017",key:"agrupacions_censals_2017"},{name:"agrupacionsCensals2018",key:"agrupacions_censals_2018"},{name:"agrupacionsCensals2019",key:"agrupacions_censals_2019"},{name:"agrupacionsCensals2020",key:"agrupacions_censals_2020"},{name:"agrupacionsCensals2021",key:"agrupacions_censals_2021"},{name:"agrupacionsCensalsVigent",key:"agrupacions_censals_vigent"},{name:"agrupacionsCensalsVigentText",key:"agrupacions_censals_vigent_text"},{name:"areesBasiquesPolicials2019",key:"arees_basiques_policials_2019"},{name:"areesBasiquesPolicials2020",key:"arees_basiques_policials_2020"},{name:"areesBasiquesPolicials2022",key:"arees_basiques_policials_2022"},{name:"areesBasiquesPolicialsVigent",key:"arees_basiques_policials_vigent"},{name:"areesBasiquesPolicialsVigentText",key:"arees_basiques_policials_vigent_text"},{name:"areesBasiquesSalutVigent",key:"arees_basiques_salut_vigent"},{name:"areesBasiquesServeisSocialsVigent",key:"arees_basiques_serveis_socials_vigent"},{name:"areesBasiquesServeisSocialsVigentText",key:"arees_basiques_serveis_socials_vigent_text"},{name:"areesGestioAssistencialVigent",key:"arees_gestio_assistencial_vigent"},{name:"areesHidrogeologiquesAquifersVigent",key:"arees_hidrogeologiques_aquifers_vigent"},{name:"catalunyaVigent",key:"catalunya_vigent"},{name:"catalunyaVigentText",key:"catalunya_vigent_text"},{name:"comarques2022",key:"comarques_2022"},{name:"comarquesVigent",key:"comarques_vigent"},{name:"comarquesVigentText",key:"comarques_vigent_text"},{name:"districtesCensals2015",key:"districtes_censals_2015"},{name:"districtesCensals2016",key:"districtes_censals_2016"},{name:"districtesCensals2017",key:"districtes_censals_2017"},{name:"districtesCensals2018",key:"districtes_censals_2018"},{name:"districtesCensals2019",key:"districtes_censals_2019"},{name:"districtesCensals2020",key:"districtes_censals_2020"},{name:"districtesCensals2021",key:"districtes_censals_2021"},{name:"districtesCensals2022",key:"districtes_censals_2022"},{name:"districtesCensals2023",key:"districtes_censals_2023"},{name:"districtesCensalsVigent",key:"districtes_censals_vigent"},{name:"districtesCensalsVigentText",key:"districtes_censals_vigent_text"},{name:"incendisForestalsVigent",key:"incendis_forestals_vigent"},{name:"incendisForestalsVigentText",key:"incendis_forestals_vigent_text"},{name:"municipis2022",key:"municipis_2022"},{name:"municipis2022Text",key:"municipis_2022_text"},{name:"municipisVigent",key:"municipis_vigent"},{name:"municipisVigentText",key:"municipis_vigent_text"},{name:"partitsJudicialsVigent",key:"partits_judicials_vigent"},{name:"partitsJudicialsVigentText",key:"partits_judicials_vigent_text"},{name:"plaTerritorial2015",key:"pla_territorial_2015"},{name:"plaTerritorialVigent",key:"pla_territorial_vigent"},{name:"plaTerritorialVigentText",key:"pla_territorial_vigent_text"},{name:"provinciesVigent",key:"provincies_vigent"},{name:"provinciesVigentText",key:"provincies_vigent_text"},{name:"regionsPolicialsVigent",key:"regions_policials_vigent"},{name:"regionsPolicialsVigentText",key:"regions_policials_vigent_text"},{name:"regionsSanitariesVigent",key:"regions_sanitaries_vigent"},{name:"regionsSanitariesVigentText",key:"regions_sanitaries_vigent_text"},{name:"seccionsCensals2015",key:"seccions_censals_2015"},{name:"seccionsCensals2016",key:"seccions_censals_2016"},{name:"seccionsCensals2017",key:"seccions_censals_2017"},{name:"seccionsCensals2018",key:"seccions_censals_2018"},{name:"seccionsCensals2019",key:"seccions_censals_2019"},{name:"seccionsCensals2020",key:"seccions_censals_2020"},{name:"seccionsCensals2021",key:"seccions_censals_2021"},{name:"seccionsCensals2022",key:"seccions_censals_2022"},{name:"seccionsCensals2023",key:"seccions_censals_2023"},{name:"seccionsCensalsVigent",key:"seccions_censals_vigent"},{name:"seccionsCensalsVigentText",key:"seccions_censals_vigent_text"},{name:"sectorsSanitarisVigent",key:"sectors_sanitaris_vigent"},{name:"vegueriesVigent",key:"vegueries_vigent"},{name:"vegueriesVigentText",key:"vegueries_vigent_text"}],vectorLayers:[{key:"cobertes2018",url:"https://tilemaps.icgc.cat/tileserver/cobertes_tilejson.json",legend:"https://eines.icgc.cat/recursos//images/llegendaCobertesSol2018.jpg"}],wmsLayers:[{key:"espaisInteresGeologic",layer:"",url:"https://geoserveis.icgc.cat/servei/catalunya/espais-interes-geologic/wms/service?&service=WMS&request=GetMap&layers=espais-interes-geologic&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}"},{key:"gravimetriaBouguer500000",layer:"",url:"https://geoserveis.icgc.cat/servei/catalunya/gravimetria/wms/service?&service=WMS&request=GetMap&layers=anomalia_bouguer_500000&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}"},{key:"cobertesSol2018",layer:"",url:"https://geoserveis.icgc.cat/servei/catalunya/cobertes-sol/wms/service?&service=WMS&request=GetMap&layers=cobertes_2018&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}"},{key:"administratiu",layer:"",url:"http://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/administratiu/MON3857NW/{z}/{x}/{y}.png"},{key:"simplificat",layer:"",url:"http://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/simplificat/MON3857NW/{z}/{x}/{y}.png"},{key:"cims",layer:"",url:"https://geoserveis.icgc.cat/icc_100cims/wms/service?REQUEST=GetMap&SERVICE=WMS&VERSION=1.1.1&LAYERS=0&STYLES=&FORMAT=image/png&BGCOLOR=0xFFFFFF&TRANSPARENT=TRUE&SRS=EPSG:25831&BBOX=137118.923076923,4488408.75,650959.076923077,4749634.75&WIDTH=895&HEIGHT=455"},{key:"cobertesSol",layer:"",url:"http://geoserveis.icgc.cat/servei/catalunya/cobertes-sol/wms?REQUEST=GetMap&SERVICE=WMS&VERSION=1.3.0&LAYERS=cobertes_2009&STYLES=&FORMAT=image/png&BGCOLOR=0xFFFFFF&TRANSPARENT=TRUE&CRS=EPSG:25831&BBOX=374110.828167253,4639230.79853085,452621.120632226,4703578.45000215&WIDTH=1020&HEIGHT=836"}],fgbLayers:[{name:"agrupacionsCensalsVigent",key:"agrupacions_censals_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_vigent.fgb"},{name:"agrupacionsCensalsVigentText",key:"agrupacions_censals_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_vigent_text.fgb"},{name:"areesBasiquesPolicialsVigent",key:"arees_basiques_policials_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_vigent.fgb"},{name:"areesBasiquesPolicialsVigentText",key:"arees_basiques_policials_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_vigent_text.fgb"},{name:"areesBasiquesSalutVigent",key:"arees_basiques_salut_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_salut_vigent.fgb"},{name:"areesBasiquesServeisSocialsVigent",key:"arees_basiques_serveis_socials_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_serveis_socials_vigent.fgb"},{name:"areesBasiquesServeisSocialsVigentText",key:"arees_basiques_serveis_socials_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_serveis_socials_vigent_text.fgb"},{name:"areesGestioAssistencialVigent",key:"arees_gestio_assistencial_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_gestio_assistencial_vigent.fgb"},{name:"areesHidrogeologiquesAquifersVigent",key:"arees_hidrogeologiques_aquifers_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_hidrogeologiques_aquifers_vigent.fgb"},{name:"catalunyaVigent",key:"catalunya_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/catalunya_vigent.fgb"},{name:"catalunyaVigentText",key:"catalunya_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/catalunya_vigent_text.fgb"},{name:"comarquesVigent",key:"comarques_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/comarques_vigent.fgb"},{name:"comarquesVigentText",key:"comarques_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/comarques_vigent_text.fgb"},{name:"districtesCensalsVigent",key:"districtes_censals_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_vigent.fgb"},{name:"districtesCensalsVigentText",key:"districtes_censals_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_vigent_text.fgb"},{name:"incendisForestalsVigent",key:"incendis_forestals_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/incendis_forestals_vigent.fgb"},{name:"incendisForestalsVigentText",key:"incendis_forestals_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/incendis_forestals_vigent_text.fgb"},{name:"municipisVigent",key:"municipis_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/municipis_vigent.fgb"},{name:"municipisVigentText",key:"municipis_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/municipis_vigent_text.fgb"},{name:"partitsJudicialsVigent",key:"partits_judicials_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/partits_judicials_vigent.fgb"},{name:"partitsJudicialsVigentText",key:"partits_judicials_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/partits_judicials_vigent_text.fgb"},{name:"plaTerritorialVigent",key:"pla_territorial_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/pla_territorial_vigent.fgb"},{name:"plaTerritorialVigentText",key:"pla_territorial_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/pla_territorial_vigent_text.fgb"},{name:"provinciesVigent",key:"provincies_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/provincies_vigent.fgb"},{name:"provinciesVigentText",key:"provincies_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/provincies_vigent_text.fgb"},{name:"regionsPolicialsVigent",key:"regions_policials_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/regions_policials_vigent.fgb"},{name:"regionsPolicialsVigentText",key:"regions_policials_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/regions_policials_vigent_text.fgb"},{name:"regionsSanitariesVigent",key:"regions_sanitaries_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/regions_sanitaries_vigent.fgb"},{name:"regionsSanitariesVigentText",key:"regions_sanitaries_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/regions_sanitaries_vigent_text.fgb"},{name:"seccionsCensalsVigent",key:"seccions_censals_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_vigent.fgb"},{name:"seccionsCensalsVigentText",key:"seccions_censals_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_vigent_text.fgb"},{name:"sectorsSanitarisVigent",key:"sectors_sanitaris_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/sectors_sanitaris_vigent.fgb"},{name:"vegueriesVigent",key:"vegueries_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/vegueries_vigent.fgb"},{name:"vegueriesVigentText",key:"vegueries_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/vegueries_vigent_text.fgb"}]},Styles:{TOPO:"https://geoserveis.icgc.cat/styles/icgc_mapa_base_topografic.json",ORTO:"https://geoserveis.icgc.cat/styles/icgc_orto_estandard.json",ORTO3D:"https://eines.icgc.cat/recursos//styles/icgc_orto_3d.json",ORTOHYBRID:"https://geoserveis.icgc.cat/styles/icgc_orto_hibrida.json",ADMIN:"https://geoserveis.icgc.cat/styles/icgc_limits_administratius_gris.json",DARK:"https://geoserveis.icgc.cat/styles/icgc_mapa_base_fosc.json",LIGHT:"https://geoserveis.icgc.cat/styles/icgc_mapa_base_gris.json",GEOLOGY:"https://geoserveis.icgc.cat/styles/icgc_geologic_informacio.json",RASTER:{TOPO:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/topografic/MON3857NW/{z}/{x}/{y}.png",ADMIN:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/administratiu/MON3857NW/{z}/{x}/{y}.png",LIGHT:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/topografic-gris/MON3857NW/{z}/{x}/{y}.png",STANDARD:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/estandard/MON3857NW/{z}/{x}/{y}.png",SIMPLIFIED:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/simplificat/MON3857NW/{z}/{x}/{y}.png",ORTO:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/orto/MON3857NW/{z}/{x}/{y}.png",ORTOGREY:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/orto-gris/MON3857NW/{z}/{x}/{y}.png",ORTOHYBRID:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/orto-hibrida/MON3857NW/{z}/{x}/{y}.png"}},Terrains:{ICGC5M:"https://tilemaps.icgc.cat/tileserver/tileserver/terreny-5m-30m-rgb-extent/{z}/{x}/{y}.png",WORLD30M:"https://s3.amazonaws.com/elevation-tiles-prod/terrarium/{z}/{x}/{y}.png"},Layers:{Orto:{ortofotoColorProvisional:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_provisional",ortofotoColor2023:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2023",ortofotoColor2022:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2022",ortofotoColor2021:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2021",ortofotoColor2020:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2020",ortofotoColor2019:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2019",ortofotoColor2018:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2018",ortofotoColor2017:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2017",ortofotoColor2016:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2016",ortofotoColor2015:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2015",ortofotoColor2014:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2014",ortofotoColor2013:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2013",ortofotoColor2012:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2012",ortofotoColor2011:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2011",ortofotoColor2010:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2010",ortofotoColor2009:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2009",ortofotoColor2008:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2008",ortofotoColor20062007:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2006-2007",ortofotoColor20042005:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2004-2005",ortofotoColor20002003:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2000-2003",ortofotoBlancINegre1998:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1998",ortofotoBlancINegre19941997:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1994-1997",ortofotoColor1993:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_1993",ortofotoBlancINegre19831992:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1983-1992",ortofotoBlancINegre19701977:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1970-1977",ortofotoBlancINegre1956:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1956",ortofotoBlancINegre1945:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1945",ortofotoColorSerieAnual:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_serie_anual",ortofotoInfraroigProvisional:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_provisional",ortofotoInfraroig2023:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2023",ortofotoInfraroig2022:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2022",ortofotoInfraroig2021:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2021",ortofotoInfraroig2020:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2020",ortofotoInfraroig2019:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2019",ortofotoInfraroig2018:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2018",ortofotoInfraroig2017:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2017",ortofotoInfraroig2016:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2016",ortofotoInfraroig2015:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2015",ortofotoInfraroig2014:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2014",ortofotoInfraroig2013:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2013",ortofotoInfraroig2012:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2012",ortofotoInfraroig2011:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2011",ortofotoInfraroig2010:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2010",ortofotoInfraroig2009:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2009",ortofotoInfraroig2008:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2008",ortofotoInfraroig20062007:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2006-2007",ortofotoInfraroig19961997:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_1996-1997",ortofotoInfraroigSerieAnual:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_serie_anual"},VectorAdmin:{agrupacionsCensals2015:"agrupacions_censals_2015",agrupacionsCensals2016:"agrupacions_censals_2016",agrupacionsCensals2017:"agrupacions_censals_2017",agrupacionsCensals2018:"agrupacions_censals_2018",agrupacionsCensals2019:"agrupacions_censals_2019",agrupacionsCensals2020:"agrupacions_censals_2020",agrupacionsCensals2021:"agrupacions_censals_2021",agrupacionsCensalsVigent:"agrupacions_censals_vigent",agrupacionsCensalsVigentText:"agrupacions_censals_vigent_text",areesBasiquesPolicials2019:"arees_basiques_policials_2019",areesBasiquesPolicials2020:"arees_basiques_policials_2020",areesBasiquesPolicials2022:"arees_basiques_policials_2022",areesBasiquesPolicialsVigent:"arees_basiques_policials_vigent",areesBasiquesPolicialsVigentText:"arees_basiques_policials_vigent_text",areesBasiquesSalutVigent:"arees_basiques_salut_vigent",areesBasiquesServeisSocialsVigent:"arees_basiques_serveis_socials_vigent",areesBasiquesServeisSocialsVigentText:"arees_basiques_serveis_socials_vigent_text",areesGestioAssistencialVigent:"arees_gestio_assistencial_vigent",areesHidrogeologiquesAquifersVigent:"arees_hidrogeologiques_aquifers_vigent",catalunyaVigent:"catalunya_vigent",catalunyaVigentText:"catalunya_vigent_text",comarques2022:"comarques_2022",comarquesVigent:"comarques_vigent",comarquesVigentText:"comarques_vigent_text",districtesCensals2015:"districtes_censals_2015",districtesCensals2016:"districtes_censals_2016",districtesCensals2017:"districtes_censals_2017",districtesCensals2018:"districtes_censals_2018",districtesCensals2019:"districtes_censals_2019",districtesCensals2020:"districtes_censals_2020",districtesCensals2021:"districtes_censals_2021",districtesCensals2022:"districtes_censals_2022",districtesCensals2023:"districtes_censals_2023",districtesCensalsVigent:"districtes_censals_vigent",districtesCensalsVigentText:"districtes_censals_vigent_text",incendisForestalsVigent:"incendis_forestals_vigent",incendisForestalsVigentText:"incendis_forestals_vigent_text",municipis2022:"municipis_2022",municipis2022Text:"municipis_2022_text",municipisVigent:"municipis_vigent",municipisVigentText:"municipis_vigent_text",partitsJudicialsVigent:"partits_judicials_vigent",partitsJudicialsVigentText:"partits_judicials_vigent_text",plaTerritorial2015:"pla_territorial_2015",plaTerritorialVigent:"pla_territorial_vigent",plaTerritorialVigentText:"pla_territorial_vigent_text",provinciesVigent:"provincies_vigent",provinciesVigentText:"provincies_vigent_text",regionsPolicialsVigent:"regions_policials_vigent",regionsPolicialsVigentText:"regions_policials_vigent_text",regionsSanitariesVigent:"regions_sanitaries_vigent",regionsSanitariesVigentText:"regions_sanitaries_vigent_text",seccionsCensals2015:"seccions_censals_2015",seccionsCensals2016:"seccions_censals_2016",seccionsCensals2017:"seccions_censals_2017",seccionsCensals2018:"seccions_censals_2018",seccionsCensals2019:"seccions_censals_2019",seccionsCensals2020:"seccions_censals_2020",seccionsCensals2021:"seccions_censals_2021",seccionsCensals2022:"seccions_censals_2022",seccionsCensals2023:"seccions_censals_2023",seccionsCensalsVigent:"seccions_censals_vigent",seccionsCensalsVigentText:"seccions_censals_vigent_text",sectorsSanitarisVigent:"sectors_sanitaris_vigent",vegueriesVigent:"vegueries_vigent",vegueriesVigentText:"vegueries_vigent_text"},FGBAdmin:{agrupacionsCensalsVigent:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_vigent.fgb",agrupacionsCensalsVigentText:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_vigent_text.fgb",areesBasiquesPolicialsVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_vigent.fgb",areesBasiquesPolicialsVigentText:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_vigent_text.fgb",areesBasiquesSalutVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_salut_vigent.fgb",areesBasiquesServeisSocialsVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_serveis_socials_vigent.fgb",areesBasiquesServeisSocialsVigentText:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_serveis_socials_vigent_text.fgb",areesGestioAssistencialVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_gestio_assistencial_vigent.fgb",areesHidrogeologiquesAquifersVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_hidrogeologiques_aquifers_vigent.fgb",catalunyaVigent:"https://tilemaps.icgc.cat/vector/fgb/catalunya_vigent.fgb",catalunyaVigentText:"https://tilemaps.icgc.cat/vector/fgb/catalunya_vigent_text.fgb",comarquesVigent:"https://tilemaps.icgc.cat/vector/fgb/comarques_vigent.fgb",comarquesVigentText:"https://tilemaps.icgc.cat/vector/fgb/comarques_vigent_text.fgb",districtesCensalsVigent:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_vigent.fgb",districtesCensalsVigentText:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_vigent_text.fgb",incendisForestalsVigent:"https://tilemaps.icgc.cat/vector/fgb/incendis_forestals_vigent.fgb",incendisForestalsVigentText:"https://tilemaps.icgc.cat/vector/fgb/incendis_forestals_vigent_text.fgb",municipisVigent:"https://tilemaps.icgc.cat/vector/fgb/municipis_vigent.fgb",municipisVigentText:"https://tilemaps.icgc.cat/vector/fgb/municipis_vigent_text.fgb",partitsJudicialsVigent:"https://tilemaps.icgc.cat/vector/fgb/partits_judicials_vigent.fgb",partitsJudicialsVigentText:"https://tilemaps.icgc.cat/vector/fgb/partits_judicials_vigent_text.fgb",plaTerritorialVigent:"https://tilemaps.icgc.cat/vector/fgb/pla_territorial_vigent.fgb",plaTerritorialVigentText:"https://tilemaps.icgc.cat/vector/fgb/pla_territorial_vigent_text.fgb",provinciesVigent:"https://tilemaps.icgc.cat/vector/fgb/provincies_vigent.fgb",provinciesVigentText:"https://tilemaps.icgc.cat/vector/fgb/provincies_vigent_text.fgb",regionsPolicialsVigent:"https://tilemaps.icgc.cat/vector/fgb/regions_policials_vigent.fgb",regionsPolicialsVigentText:"https://tilemaps.icgc.cat/vector/fgb/regions_policials_vigent_text.fgb",regionsSanitariesVigent:"https://tilemaps.icgc.cat/vector/fgb/regions_sanitaries_vigent.fgb",regionsSanitariesVigentText:"https://tilemaps.icgc.cat/vector/fgb/regions_sanitaries_vigent_text.fgb",seccionsCensalsVigent:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_vigent.fgb",seccionsCensalsVigentText:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_vigent_text.fgb",sectorsSanitarisVigent:"https://tilemaps.icgc.cat/vector/fgb/sectors_sanitaris_vigent.fgb",vegueriesVigent:"https://tilemaps.icgc.cat/vector/fgb/vegueries_vigent.fgb",vegueriesVigentText:"https://tilemaps.icgc.cat/vector/fgb/vegueries_vigent_text.fgb"},Vector:{cobertes2018:"https://tilemaps.icgc.cat/tileserver/cobertes_tilejson.json"},WMS:{espaisInteresGeologic:"https://geoserveis.icgc.cat/servei/catalunya/espais-interes-geologic/wms/service?&service=WMS&request=GetMap&layers=espais-interes-geologic&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}",gravimetriaBouguer500000:"https://geoserveis.icgc.cat/servei/catalunya/gravimetria/wms/service?&service=WMS&request=GetMap&layers=anomalia_bouguer_500000&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}",cobertesSol2018:"https://geoserveis.icgc.cat/servei/catalunya/cobertes-sol/wms/service?&service=WMS&request=GetMap&layers=cobertes_2018&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}",administratiu:"http://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/administratiu/MON3857NW/{z}/{x}/{y}.png",simplificat:"http://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/simplificat/MON3857NW/{z}/{x}/{y}.png",cims:"https://geoserveis.icgc.cat/icc_100cims/wms/service?REQUEST=GetMap&SERVICE=WMS&VERSION=1.1.1&LAYERS=0&STYLES=&FORMAT=image/png&BGCOLOR=0xFFFFFF&TRANSPARENT=TRUE&SRS=EPSG:25831&BBOX=137118.923076923,4488408.75,650959.076923077,4749634.75&WIDTH=895&HEIGHT=455",cobertesSol:"http://geoserveis.icgc.cat/servei/catalunya/cobertes-sol/wms?REQUEST=GetMap&SERVICE=WMS&VERSION=1.3.0&LAYERS=cobertes_2009&STYLES=&FORMAT=image/png&BGCOLOR=0xFFFFFF&TRANSPARENT=TRUE&CRS=EPSG:25831&BBOX=374110.828167253,4639230.79853085,452621.120632226,4703578.45000215&WIDTH=1020&HEIGHT=836"}}};class U4e{constructor(e){this.options=e||{}}onAdd(e){let t=om.defaultOptions;return this._map=e,this._img1=document.createElement("img"),this._img1.className="maplibregl-ctrl",this._img1.src=this.options.color?t.logoIcgcOptions.logoUrlColor:t.logoIcgcOptions.logoUrlWhite,this._img1.width=t.logoIcgcOptions.logoWidth,this._img1.title=t.logoIcgcOptions.logoTitle,this._img1.style.opacity=t.logoIcgcOptions.logoOpacity,this.link1=document.createElement("a"),this.link1.href=t.logoIcgcOptions.logoLink,this.link1.target="_blank",this.link1.appendChild(this._img1),this._container1=document.createElement("div"),this._container1.className="maplibregl-ctrl",this._container1.style.width=`${t.logoIcgcOptions.logoWidth}px`,this._container1.appendChild(this.link1),this._img2=document.createElement("img"),this._img2.className="maplibregl-ctrl",this._img2.src=this.options.color?t.logoGencatOptions.logoUrlColor:t.logoGencatOptions.logoUrlWhite,this._img2.width=t.logoGencatOptions.logoWidth,this._img2.title=t.logoGencatOptions.logoTitle,this._img2.style.opacity=t.logoGencatOptions.logoOpacity,this.link2=document.createElement("a"),this.link2.href=t.logoGencatOptions.logoLink,this.link2.target="_blank",this.link2.appendChild(this._img2),this._container2=document.createElement("div"),this._container2.className="maplibregl-ctrl",this._container2.style.width=`${t.logoGencatOptions.logoWidth}px`,this._container2.appendChild(this.link2),this._mainContainer=document.createElement("div"),this._mainContainer.className="divLogos",this._mainContainer.style="display: flex",this._mainContainer.appendChild(this._container1),this._mainContainer.appendChild(this._container2),this._mainContainer}}class N4e{constructor(e){this.options=e||{}}onAdd(e){this._map=e,this._img1=document.createElement("img"),this._img1.src=this.options.url,this._img1.width=150,this._img1.title=300,this.controlContainer=document.createElement("div"),this.controlContainer.classList.add("maplibregl-ctrl"),this.controlContainer.classList.add("maplibregl-ctrl-group"),this.legendContainer=document.createElement("div"),this.legendContainer.classList.add("maplibregl-legend-list"),this.legendButton=document.createElement("button"),this.legendButton.classList.add("maplibregl-ctrl-icon"),this.legendButton.classList.add("maplibregl-legend-switcher"),this.legendButton.addEventListener("click",()=>{this.legendButton.style.display="none",this.legendContainer.style.display="block"}),document.addEventListener("click",this.onDocumentClick),this.controlContainer.appendChild(this.legendButton),this.controlContainer.appendChild(this.legendContainer),this.closeButton=document.createElement("button"),this.closeButton.textContent="x",this.closeButton.classList.add("maplibregl-legend-close-button"),this.closeButton.addEventListener("click",()=>{this.legendButton.style.display="block",this.legendContainer.style.display="none"}),this.legendContainer.appendChild(this.closeButton);const t=document.createElement("label");return t.classList.add("maplibregl-legend-title-label"),t.textContent=this.options.idLayer||"Llegenda",this.legendContainer.appendChild(t),this.legendContainer.appendChild(document.createElement("br")),this.legendContainer.appendChild(this._img1),this.controlContainer}}var N0=G$.prototype,MR="WGS 84";function G$(r){r!==void 0&&(MR=r),this.setEllipsoid(MR)}N0.convertLatLngToUtm=function(r,e,t){var n;if(this.status)return"No ecclipsoid data associated with unknown datum: "+MR;if(!Number.isInteger(t))return"Precision is not integer number.";r=parseFloat(r),e=parseFloat(e);var i=e,s=this.toRadians(r),a=this.toRadians(i);i>=8&&i<=13&&r>54.5&&r<58||r>=56&&r<64&&i>=3&&i<12?n=32:(n=(i+180)/6+1,r>=72&&r<84&&(i>=0&&i<9?n=31:i>=9&&i<21?n=33:i>=21&&i<33?n=35:i>=33&&i<42&&(n=37))),n=parseInt(n);var o=(n-1)*6-180+3,h=this.toRadians(o),f=this.getUtmLetterDesignator(r),_=this.eccSquared/(1-this.eccSquared),x=this.a/Math.sqrt(1-this.eccSquared*Math.sin(s)*Math.sin(s)),T=Math.tan(s)*Math.tan(s),I=_*Math.cos(s)*Math.cos(s),N=Math.cos(s)*(a-h),$=this.a*((1-this.eccSquared/4-3*this.eccSquared*this.eccSquared/64-5*this.eccSquared*this.eccSquared*this.eccSquared/256)*s-(3*this.eccSquared/8+3*this.eccSquared*this.eccSquared/32+45*this.eccSquared*this.eccSquared*this.eccSquared/1024)*Math.sin(2*s)+(15*this.eccSquared*this.eccSquared/256+45*this.eccSquared*this.eccSquared*this.eccSquared/1024)*Math.sin(4*s)-35*this.eccSquared*this.eccSquared*this.eccSquared/3072*Math.sin(6*s)),W=parseFloat(.9996*x*(N+(1-T+I)*N*N*N/6+(5-18*T+T*T+72*I-58*_)*N*N*N*N*N/120)+5e5),Y=parseFloat(.9996*($+x*Math.tan(s)*(N*N/2+(5-T+9*I+4*I*I)*N*N*N*N/24+(61-58*T+T*T+600*I-330*_)*N*N*N*N*N*N/720)));return r<0&&(Y+=1e7),Y=Q$(Y,t),W=Q$(W,t),{Easting:W,Northing:Y,ZoneNumber:parseInt(n),ZoneLetter:f}},N0.convertUtmToLatLng=function(r,e,t,n){var i=(1-Math.sqrt(1-this.eccSquared))/(1+Math.sqrt(1-this.eccSquared)),s=r-5e5,a=e,o=t,h=n;if(r===void 0)return"Please pass the UTMEasting!";if(e===void 0)return"Please pass the UTMNorthing!";if(t===void 0)return"Please pass the UTMZoneNumber!";if(n===void 0)return"Please pass the UTMZoneLetter!";["N","P","Q","R","S","T","U","V","W","X","Y","Z"].indexOf(h)!==-1||(a-=1e7);var f=(o-1)*6-180+3,_=this.eccSquared/(1-this.eccSquared),x=a/.9996,T=x/(this.a*(1-this.eccSquared/4-3*this.eccSquared*this.eccSquared/64-5*this.eccSquared*this.eccSquared*this.eccSquared/256)),I=T+(3*i/2-27*i*i*i/32)*Math.sin(2*T)+(21*i*i/16-55*i*i*i*i/32)*Math.sin(4*T)+151*i*i*i/96*Math.sin(6*T);this.toDegrees(I);var N=this.a/Math.sqrt(1-this.eccSquared*Math.sin(I)*Math.sin(I)),$=Math.tan(I)*Math.tan(I),W=_*Math.cos(I)*Math.cos(I),Y=this.a*(1-this.eccSquared)/Math.pow(1-this.eccSquared*Math.sin(I)*Math.sin(I),1.5),ie=s/(N*.9996),ce=I-N*Math.tan(I)/Y*(ie*ie/2-(5+3*$+10*W-4*W*W-9*_)*ie*ie*ie*ie/24+(61+90*$+298*W+45*$*$-252*_-3*W*W)*ie*ie*ie*ie*ie*ie/720);ce=this.toDegrees(ce);var fe=(ie-(1+2*$+W)*ie*ie*ie/6+(5-2*W+28*$-3*W*W+8*_+24*$*$)*ie*ie*ie*ie*ie/120)/Math.cos(I);return fe=f+this.toDegrees(fe),{lat:ce,lng:fe}},N0.getUtmLetterDesignator=function(r){return r=parseFloat(r),84>=r&&r>=72?"X":72>r&&r>=64?"W":64>r&&r>=56?"V":56>r&&r>=48?"U":48>r&&r>=40?"T":40>r&&r>=32?"S":32>r&&r>=24?"R":24>r&&r>=16?"Q":16>r&&r>=8?"P":8>r&&r>=0?"N":0>r&&r>=-8?"M":-8>r&&r>=-16?"L":-16>r&&r>=-24?"K":-24>r&&r>=-32?"J":-32>r&&r>=-40?"H":-40>r&&r>=-48?"G":-48>r&&r>=-56?"F":-56>r&&r>=-64?"E":-64>r&&r>=-72?"D":-72>r&&r>=-80?"C":"Z"},N0.setEllipsoid=function(r){switch(r){case"Airy":this.a=6377563,this.eccSquared=.00667054;break;case"Australian National":this.a=6378160,this.eccSquared=.006694542;break;case"Bessel 1841":this.a=6377397,this.eccSquared=.006674372;break;case"Bessel 1841 Nambia":this.a=6377484,this.eccSquared=.006674372;break;case"Clarke 1866":this.a=6378206,this.eccSquared=.006768658;break;case"Clarke 1880":this.a=6378249,this.eccSquared=.006803511;break;case"Everest":this.a=6377276,this.eccSquared=.006637847;break;case"Fischer 1960 Mercury":this.a=6378166,this.eccSquared=.006693422;break;case"Fischer 1968":this.a=6378150,this.eccSquared=.006693422;break;case"GRS 1967":this.a=6378160,this.eccSquared=.006694605;break;case"GRS 1980":this.a=6378137,this.eccSquared=.00669438;break;case"Helmert 1906":this.a=6378200,this.eccSquared=.006693422;break;case"Hough":this.a=6378270,this.eccSquared=.00672267;break;case"International":this.a=6378388,this.eccSquared=.00672267;break;case"Krassovsky":this.a=6378245,this.eccSquared=.006693422;break;case"Modified Airy":this.a=6377340,this.eccSquared=.00667054;break;case"Modified Everest":this.a=6377304,this.eccSquared=.006637847;break;case"Modified Fischer 1960":this.a=6378155,this.eccSquared=.006693422;break;case"South American 1969":this.a=6378160,this.eccSquared=.006694542;break;case"WGS 60":this.a=6378165,this.eccSquared=.006693422;break;case"WGS 66":this.a=6378145,this.eccSquared=.006694542;break;case"WGS 72":this.a=6378135,this.eccSquared=.006694318;break;case"ED50":this.a=6378388,this.eccSquared=.00672267;break;case"WGS 84":case"EUREF89":case"ETRS89":this.a=6378137,this.eccSquared=.00669438;break;default:this.status=!0}},N0.toDegrees=function(r){return r/Math.PI*180},N0.toRadians=function(r){return r*Math.PI/180};function Q$(r,e){var t=Math.pow(10,e);return Math.round(r*t)/t}var z4e=G$;const H4e=dA(z4e);class V4e{constructor(e){this.options=e||{},this.options.utm=this.options.hasOwnProperty("utm")?this.options.utm:!0,this.options.lonlat=this.options.hasOwnProperty("lonlat")?this.options.lonlat:!0}onAdd(e){const t=new H4e;return this._map=e,this._container=document.createElement("div"),this._container.className="maplibregl-ctrl coordControl",this._container.style.width=`${this.options.width||"225px"}`,this._map.on("mousemove",n=>{const i=n.lngLat.lat,s=n.lngLat.lng;let a="",o="";const h=t.convertLatLngToUtm(i,s,2),f=i>0?"N":"S";this.options.utm&&(a=`ETRS89 UTM ${h.ZoneNumber}${f} X:<b> ${h.Easting}</b> Y:<b> ${h.Northing}</b> <br>`),this.options.lonlat&&(o=`WGS 84 Lon:<b> ${s.toFixed(5)}</b>  Lat:<b> ${i.toFixed(5)}</b>`);const _=`${a}${o}`;this._container.innerHTML=_}),this._container}_lookUTM31(e,t){var n=0,i=0,s=6,a=84;return e>=n&&e<=s&&t>=i&&t<=a}onRemove(){this._container.parentNode.removeChild(this._container),this._map=void 0}}function $$(r,e){return function(){return r.apply(e,arguments)}}const{toString:G4e}=Object.prototype,{getPrototypeOf:PR}=Object,VB=(r=>e=>{const t=G4e.call(e);return r[t]||(r[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),af=r=>(r=r.toLowerCase(),e=>VB(e)===r),GB=r=>e=>typeof e===r,{isArray:z0}=Array,Sb=GB("undefined");function Q4e(r){return r!==null&&!Sb(r)&&r.constructor!==null&&!Sb(r.constructor)&&Dh(r.constructor.isBuffer)&&r.constructor.isBuffer(r)}const j$=af("ArrayBuffer");function $4e(r){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(r):e=r&&r.buffer&&j$(r.buffer),e}const j4e=GB("string"),Dh=GB("function"),q$=GB("number"),QB=r=>r!==null&&typeof r=="object",q4e=r=>r===!0||r===!1,$B=r=>{if(VB(r)!=="object")return!1;const e=PR(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)},K4e=af("Date"),W4e=af("File"),X4e=af("Blob"),J4e=af("FileList"),Z4e=r=>QB(r)&&Dh(r.pipe),Y4e=r=>{let e;return r&&(typeof FormData=="function"&&r instanceof FormData||Dh(r.append)&&((e=VB(r))==="formdata"||e==="object"&&Dh(r.toString)&&r.toString()==="[object FormData]"))},eLe=af("URLSearchParams"),[tLe,rLe,nLe,iLe]=["ReadableStream","Request","Response","Headers"].map(af),sLe=r=>r.trim?r.trim():r.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Ib(r,e){let{allOwnKeys:t=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(r===null||typeof r>"u")return;let n,i;if(typeof r!="object"&&(r=[r]),z0(r))for(n=0,i=r.length;n<i;n++)e.call(null,r[n],n,r);else{const s=t?Object.getOwnPropertyNames(r):Object.keys(r),a=s.length;let o;for(n=0;n<a;n++)o=s[n],e.call(null,r[o],o,r)}}function K$(r,e){e=e.toLowerCase();const t=Object.keys(r);let n=t.length,i;for(;n-- >0;)if(i=t[n],e===i.toLowerCase())return i;return null}const am=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,W$=r=>!Sb(r)&&r!==am;function FR(){const{caseless:r}=W$(this)&&this||{},e={},t=(n,i)=>{const s=r&&K$(e,i)||i;$B(e[s])&&$B(n)?e[s]=FR(e[s],n):$B(n)?e[s]=FR({},n):z0(n)?e[s]=n.slice():e[s]=n};for(let n=0,i=arguments.length;n<i;n++)arguments[n]&&Ib(arguments[n],t);return e}const oLe=function(r,e,t){let{allOwnKeys:n}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return Ib(e,(i,s)=>{t&&Dh(i)?r[s]=$$(i,t):r[s]=i},{allOwnKeys:n}),r},aLe=r=>(r.charCodeAt(0)===65279&&(r=r.slice(1)),r),lLe=(r,e,t,n)=>{r.prototype=Object.create(e.prototype,n),r.prototype.constructor=r,Object.defineProperty(r,"super",{value:e.prototype}),t&&Object.assign(r.prototype,t)},cLe=(r,e,t,n)=>{let i,s,a;const o={};if(e=e||{},r==null)return e;do{for(i=Object.getOwnPropertyNames(r),s=i.length;s-- >0;)a=i[s],(!n||n(a,r,e))&&!o[a]&&(e[a]=r[a],o[a]=!0);r=t!==!1&&PR(r)}while(r&&(!t||t(r,e))&&r!==Object.prototype);return e},uLe=(r,e,t)=>{r=String(r),(t===void 0||t>r.length)&&(t=r.length),t-=e.length;const n=r.indexOf(e,t);return n!==-1&&n===t},hLe=r=>{if(!r)return null;if(z0(r))return r;let e=r.length;if(!q$(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=r[e];return t},dLe=(r=>e=>r&&e instanceof r)(typeof Uint8Array<"u"&&PR(Uint8Array)),fLe=(r,e)=>{const n=(r&&r[Symbol.iterator]).call(r);let i;for(;(i=n.next())&&!i.done;){const s=i.value;e.call(r,s[0],s[1])}},ALe=(r,e)=>{let t;const n=[];for(;(t=r.exec(e))!==null;)n.push(t);return n},pLe=af("HTMLFormElement"),gLe=r=>r.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,n,i){return n.toUpperCase()+i}),X$=(r=>{let{hasOwnProperty:e}=r;return(t,n)=>e.call(t,n)})(Object.prototype),mLe=af("RegExp"),J$=(r,e)=>{const t=Object.getOwnPropertyDescriptors(r),n={};Ib(t,(i,s)=>{let a;(a=e(i,s,r))!==!1&&(n[s]=a||i)}),Object.defineProperties(r,n)},_Le=r=>{J$(r,(e,t)=>{if(Dh(r)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const n=r[t];if(Dh(n)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},yLe=(r,e)=>{const t={},n=i=>{i.forEach(s=>{t[s]=!0})};return z0(r)?n(r):n(String(r).split(e)),t},bLe=()=>{},vLe=(r,e)=>r!=null&&Number.isFinite(r=+r)?r:e,RR="abcdefghijklmnopqrstuvwxyz",Z$="0123456789",Y$={DIGIT:Z$,ALPHA:RR,ALPHA_DIGIT:RR+RR.toUpperCase()+Z$},xLe=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Y$.ALPHA_DIGIT,t="";const{length:n}=e;for(;r--;)t+=e[Math.random()*n|0];return t};function wLe(r){return!!(r&&Dh(r.append)&&r[Symbol.toStringTag]==="FormData"&&r[Symbol.iterator])}const BLe=r=>{const e=new Array(10),t=(n,i)=>{if(QB(n)){if(e.indexOf(n)>=0)return;if(!("toJSON"in n)){e[i]=n;const s=z0(n)?[]:{};return Ib(n,(a,o)=>{const h=t(a,i+1);!Sb(h)&&(s[o]=h)}),e[i]=void 0,s}}return n};return t(r,0)},CLe=af("AsyncFunction"),ELe=r=>r&&(QB(r)||Dh(r))&&Dh(r.then)&&Dh(r.catch),ej=((r,e)=>r?setImmediate:e?((t,n)=>(am.addEventListener("message",i=>{let{source:s,data:a}=i;s===am&&a===t&&n.length&&n.shift()()},!1),i=>{n.push(i),am.postMessage(t,"*")}))(`axios@${Math.random()}`,[]):t=>setTimeout(t))(typeof setImmediate=="function",Dh(am.postMessage)),TLe=typeof queueMicrotask<"u"?queueMicrotask.bind(am):typeof process<"u"&&process.nextTick||ej,Ir={isArray:z0,isArrayBuffer:j$,isBuffer:Q4e,isFormData:Y4e,isArrayBufferView:$4e,isString:j4e,isNumber:q$,isBoolean:q4e,isObject:QB,isPlainObject:$B,isReadableStream:tLe,isRequest:rLe,isResponse:nLe,isHeaders:iLe,isUndefined:Sb,isDate:K4e,isFile:W4e,isBlob:X4e,isRegExp:mLe,isFunction:Dh,isStream:Z4e,isURLSearchParams:eLe,isTypedArray:dLe,isFileList:J4e,forEach:Ib,merge:FR,extend:oLe,trim:sLe,stripBOM:aLe,inherits:lLe,toFlatObject:cLe,kindOf:VB,kindOfTest:af,endsWith:uLe,toArray:hLe,forEachEntry:fLe,matchAll:ALe,isHTMLForm:pLe,hasOwnProperty:X$,hasOwnProp:X$,reduceDescriptors:J$,freezeMethods:_Le,toObjectSet:yLe,toCamelCase:gLe,noop:bLe,toFiniteNumber:vLe,findKey:K$,global:am,isContextDefined:W$,ALPHABET:Y$,generateString:xLe,isSpecCompliantForm:wLe,toJSONObject:BLe,isAsyncFn:CLe,isThenable:ELe,setImmediate:ej,asap:TLe};function Ri(r,e,t,n,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=r,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),n&&(this.request=n),i&&(this.response=i,this.status=i.status?i.status:null)}Ir.inherits(Ri,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Ir.toJSONObject(this.config),code:this.code,status:this.status}}});const tj=Ri.prototype,rj={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(r=>{rj[r]={value:r}}),Object.defineProperties(Ri,rj),Object.defineProperty(tj,"isAxiosError",{value:!0}),Ri.from=(r,e,t,n,i,s)=>{const a=Object.create(tj);return Ir.toFlatObject(r,a,function(h){return h!==Error.prototype},o=>o!=="isAxiosError"),Ri.call(a,r.message,e,t,n,i),a.cause=r,a.name=r.name,s&&Object.assign(a,s),a};const SLe=null;function LR(r){return Ir.isPlainObject(r)||Ir.isArray(r)}function nj(r){return Ir.endsWith(r,"[]")?r.slice(0,-2):r}function ij(r,e,t){return r?r.concat(e).map(function(i,s){return i=nj(i),!t&&s?"["+i+"]":i}).join(t?".":""):e}function ILe(r){return Ir.isArray(r)&&!r.some(LR)}const MLe=Ir.toFlatObject(Ir,{},null,function(e){return/^is[A-Z]/.test(e)});function jB(r,e,t){if(!Ir.isObject(r))throw new TypeError("target must be an object");e=e||new FormData,t=Ir.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function($,W){return!Ir.isUndefined(W[$])});const n=t.metaTokens,i=t.visitor||_,s=t.dots,a=t.indexes,h=(t.Blob||typeof Blob<"u"&&Blob)&&Ir.isSpecCompliantForm(e);if(!Ir.isFunction(i))throw new TypeError("visitor must be a function");function f(N){if(N===null)return"";if(Ir.isDate(N))return N.toISOString();if(!h&&Ir.isBlob(N))throw new Ri("Blob is not supported. Use a Buffer instead.");return Ir.isArrayBuffer(N)||Ir.isTypedArray(N)?h&&typeof Blob=="function"?new Blob([N]):Buffer.from(N):N}function _(N,$,W){let Y=N;if(N&&!W&&typeof N=="object"){if(Ir.endsWith($,"{}"))$=n?$:$.slice(0,-2),N=JSON.stringify(N);else if(Ir.isArray(N)&&ILe(N)||(Ir.isFileList(N)||Ir.endsWith($,"[]"))&&(Y=Ir.toArray(N)))return $=nj($),Y.forEach(function(ce,fe){!(Ir.isUndefined(ce)||ce===null)&&e.append(a===!0?ij([$],fe,s):a===null?$:$+"[]",f(ce))}),!1}return LR(N)?!0:(e.append(ij(W,$,s),f(N)),!1)}const x=[],T=Object.assign(MLe,{defaultVisitor:_,convertValue:f,isVisitable:LR});function I(N,$){if(!Ir.isUndefined(N)){if(x.indexOf(N)!==-1)throw Error("Circular reference detected in "+$.join("."));x.push(N),Ir.forEach(N,function(Y,ie){(!(Ir.isUndefined(Y)||Y===null)&&i.call(e,Y,Ir.isString(ie)?ie.trim():ie,$,T))===!0&&I(Y,$?$.concat(ie):[ie])}),x.pop()}}if(!Ir.isObject(r))throw new TypeError("data must be an object");return I(r),e}function sj(r){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(r).replace(/[!'()~]|%20|%00/g,function(n){return e[n]})}function DR(r,e){this._pairs=[],r&&jB(r,this,e)}const oj=DR.prototype;oj.append=function(e,t){this._pairs.push([e,t])},oj.toString=function(e){const t=e?function(n){return e.call(this,n,sj)}:sj;return this._pairs.map(function(i){return t(i[0])+"="+t(i[1])},"").join("&")};function PLe(r){return encodeURIComponent(r).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function aj(r,e,t){if(!e)return r;const n=t&&t.encode||PLe;Ir.isFunction(t)&&(t={serialize:t});const i=t&&t.serialize;let s;if(i?s=i(e,t):s=Ir.isURLSearchParams(e)?e.toString():new DR(e,t).toString(n),s){const a=r.indexOf("#");a!==-1&&(r=r.slice(0,a)),r+=(r.indexOf("?")===-1?"?":"&")+s}return r}class lj{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Ir.forEach(this.handlers,function(n){n!==null&&e(n)})}}const cj={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},FLe={isBrowser:!0,classes:{URLSearchParams:typeof URLSearchParams<"u"?URLSearchParams:DR,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]},OR=typeof window<"u"&&typeof document<"u",kR=typeof navigator=="object"&&navigator||void 0,RLe=OR&&(!kR||["ReactNative","NativeScript","NS"].indexOf(kR.product)<0),LLe=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",DLe=OR&&window.location.href||"http://localhost",ou={...Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:OR,hasStandardBrowserEnv:RLe,hasStandardBrowserWebWorkerEnv:LLe,navigator:kR,origin:DLe},Symbol.toStringTag,{value:"Module"})),...FLe};function OLe(r,e){return jB(r,new ou.classes.URLSearchParams,Object.assign({visitor:function(t,n,i,s){return ou.isNode&&Ir.isBuffer(t)?(this.append(n,t.toString("base64")),!1):s.defaultVisitor.apply(this,arguments)}},e))}function kLe(r){return Ir.matchAll(/\w+|\[(\w*)]/g,r).map(e=>e[0]==="[]"?"":e[1]||e[0])}function ULe(r){const e={},t=Object.keys(r);let n;const i=t.length;let s;for(n=0;n<i;n++)s=t[n],e[s]=r[s];return e}function uj(r){function e(t,n,i,s){let a=t[s++];if(a==="__proto__")return!0;const o=Number.isFinite(+a),h=s>=t.length;return a=!a&&Ir.isArray(i)?i.length:a,h?(Ir.hasOwnProp(i,a)?i[a]=[i[a],n]:i[a]=n,!o):((!i[a]||!Ir.isObject(i[a]))&&(i[a]=[]),e(t,n,i[a],s)&&Ir.isArray(i[a])&&(i[a]=ULe(i[a])),!o)}if(Ir.isFormData(r)&&Ir.isFunction(r.entries)){const t={};return Ir.forEachEntry(r,(n,i)=>{e(kLe(n),i,t,0)}),t}return null}function NLe(r,e,t){if(Ir.isString(r))try{return(e||JSON.parse)(r),Ir.trim(r)}catch(n){if(n.name!=="SyntaxError")throw n}return(0,JSON.stringify)(r)}const Mb={transitional:cj,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const n=t.getContentType()||"",i=n.indexOf("application/json")>-1,s=Ir.isObject(e);if(s&&Ir.isHTMLForm(e)&&(e=new FormData(e)),Ir.isFormData(e))return i?JSON.stringify(uj(e)):e;if(Ir.isArrayBuffer(e)||Ir.isBuffer(e)||Ir.isStream(e)||Ir.isFile(e)||Ir.isBlob(e)||Ir.isReadableStream(e))return e;if(Ir.isArrayBufferView(e))return e.buffer;if(Ir.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let o;if(s){if(n.indexOf("application/x-www-form-urlencoded")>-1)return OLe(e,this.formSerializer).toString();if((o=Ir.isFileList(e))||n.indexOf("multipart/form-data")>-1){const h=this.env&&this.env.FormData;return jB(o?{"files[]":e}:e,h&&new h,this.formSerializer)}}return s||i?(t.setContentType("application/json",!1),NLe(e)):e}],transformResponse:[function(e){const t=this.transitional||Mb.transitional,n=t&&t.forcedJSONParsing,i=this.responseType==="json";if(Ir.isResponse(e)||Ir.isReadableStream(e))return e;if(e&&Ir.isString(e)&&(n&&!this.responseType||i)){const a=!(t&&t.silentJSONParsing)&&i;try{return JSON.parse(e)}catch(o){if(a)throw o.name==="SyntaxError"?Ri.from(o,Ri.ERR_BAD_RESPONSE,this,null,this.response):o}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ou.classes.FormData,Blob:ou.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Ir.forEach(["delete","get","head","post","put","patch"],r=>{Mb.headers[r]={}});const zLe=Ir.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),HLe=r=>{const e={};let t,n,i;return r&&r.split(`
`).forEach(function(a){i=a.indexOf(":"),t=a.substring(0,i).trim().toLowerCase(),n=a.substring(i+1).trim(),!(!t||e[t]&&zLe[t])&&(t==="set-cookie"?e[t]?e[t].push(n):e[t]=[n]:e[t]=e[t]?e[t]+", "+n:n)}),e},hj=Symbol("internals");function Pb(r){return r&&String(r).trim().toLowerCase()}function qB(r){return r===!1||r==null?r:Ir.isArray(r)?r.map(qB):String(r)}function VLe(r){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=t.exec(r);)e[n[1]]=n[2];return e}const GLe=r=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(r.trim());function UR(r,e,t,n,i){if(Ir.isFunction(n))return n.call(this,e,t);if(i&&(e=t),!!Ir.isString(e)){if(Ir.isString(n))return e.indexOf(n)!==-1;if(Ir.isRegExp(n))return n.test(e)}}function QLe(r){return r.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,n)=>t.toUpperCase()+n)}function $Le(r,e){const t=Ir.toCamelCase(" "+e);["get","set","has"].forEach(n=>{Object.defineProperty(r,n+t,{value:function(i,s,a){return this[n].call(this,e,i,s,a)},configurable:!0})})}class ah{constructor(e){e&&this.set(e)}set(e,t,n){const i=this;function s(o,h,f){const _=Pb(h);if(!_)throw new Error("header name must be a non-empty string");const x=Ir.findKey(i,_);(!x||i[x]===void 0||f===!0||f===void 0&&i[x]!==!1)&&(i[x||h]=qB(o))}const a=(o,h)=>Ir.forEach(o,(f,_)=>s(f,_,h));if(Ir.isPlainObject(e)||e instanceof this.constructor)a(e,t);else if(Ir.isString(e)&&(e=e.trim())&&!GLe(e))a(HLe(e),t);else if(Ir.isHeaders(e))for(const[o,h]of e.entries())s(h,o,n);else e!=null&&s(t,e,n);return this}get(e,t){if(e=Pb(e),e){const n=Ir.findKey(this,e);if(n){const i=this[n];if(!t)return i;if(t===!0)return VLe(i);if(Ir.isFunction(t))return t.call(this,i,n);if(Ir.isRegExp(t))return t.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=Pb(e),e){const n=Ir.findKey(this,e);return!!(n&&this[n]!==void 0&&(!t||UR(this,this[n],n,t)))}return!1}delete(e,t){const n=this;let i=!1;function s(a){if(a=Pb(a),a){const o=Ir.findKey(n,a);o&&(!t||UR(n,n[o],o,t))&&(delete n[o],i=!0)}}return Ir.isArray(e)?e.forEach(s):s(e),i}clear(e){const t=Object.keys(this);let n=t.length,i=!1;for(;n--;){const s=t[n];(!e||UR(this,this[s],s,e,!0))&&(delete this[s],i=!0)}return i}normalize(e){const t=this,n={};return Ir.forEach(this,(i,s)=>{const a=Ir.findKey(n,s);if(a){t[a]=qB(i),delete t[s];return}const o=e?QLe(s):String(s).trim();o!==s&&delete t[s],t[o]=qB(i),n[o]=!0}),this}concat(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.constructor.concat(this,...t)}toJSON(e){const t=Object.create(null);return Ir.forEach(this,(n,i)=>{n!=null&&n!==!1&&(t[i]=e&&Ir.isArray(n)?n.join(", "):n)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(e=>{let[t,n]=e;return t+": "+n}).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e){const t=new this(e);for(var n=arguments.length,i=new Array(n>1?n-1:0),s=1;s<n;s++)i[s-1]=arguments[s];return i.forEach(a=>t.set(a)),t}static accessor(e){const n=(this[hj]=this[hj]={accessors:{}}).accessors,i=this.prototype;function s(a){const o=Pb(a);n[o]||($Le(i,a),n[o]=!0)}return Ir.isArray(e)?e.forEach(s):s(e),this}}ah.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),Ir.reduceDescriptors(ah.prototype,(r,e)=>{let{value:t}=r,n=e[0].toUpperCase()+e.slice(1);return{get:()=>t,set(i){this[n]=i}}}),Ir.freezeMethods(ah);function NR(r,e){const t=this||Mb,n=e||t,i=ah.from(n.headers);let s=n.data;return Ir.forEach(r,function(o){s=o.call(t,s,i.normalize(),e?e.status:void 0)}),i.normalize(),s}function dj(r){return!!(r&&r.__CANCEL__)}function H0(r,e,t){Ri.call(this,r??"canceled",Ri.ERR_CANCELED,e,t),this.name="CanceledError"}Ir.inherits(H0,Ri,{__CANCEL__:!0});function fj(r,e,t){const n=t.config.validateStatus;!t.status||!n||n(t.status)?r(t):e(new Ri("Request failed with status code "+t.status,[Ri.ERR_BAD_REQUEST,Ri.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}function jLe(r){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(r);return e&&e[1]||""}function qLe(r,e){r=r||10;const t=new Array(r),n=new Array(r);let i=0,s=0,a;return e=e!==void 0?e:1e3,function(h){const f=Date.now(),_=n[s];a||(a=f),t[i]=h,n[i]=f;let x=s,T=0;for(;x!==i;)T+=t[x++],x=x%r;if(i=(i+1)%r,i===s&&(s=(s+1)%r),f-a<e)return;const I=_&&f-_;return I?Math.round(T*1e3/I):void 0}}function KLe(r,e){let t=0,n=1e3/e,i,s;const a=function(f){t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),i=null,s&&(clearTimeout(s),s=null),r.apply(null,f)};return[function(){const f=Date.now(),_=f-t;for(var x=arguments.length,T=new Array(x),I=0;I<x;I++)T[I]=arguments[I];_>=n?a(T,f):(i=T,s||(s=setTimeout(()=>{s=null,a(i)},n-_)))},()=>i&&a(i)]}const KB=function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,n=0;const i=qLe(50,250);return KLe(s=>{const a=s.loaded,o=s.lengthComputable?s.total:void 0,h=a-n,f=i(h),_=a<=o;n=a;const x={loaded:a,total:o,progress:o?a/o:void 0,bytes:h,rate:f||void 0,estimated:f&&o&&_?(o-a)/f:void 0,event:s,lengthComputable:o!=null,[e?"download":"upload"]:!0};r(x)},t)},Aj=(r,e)=>{const t=r!=null;return[n=>e[0]({lengthComputable:t,total:r,loaded:n}),e[1]]},pj=r=>function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Ir.asap(()=>r(...t))},WLe=ou.hasStandardBrowserEnv?((r,e)=>t=>(t=new URL(t,ou.origin),r.protocol===t.protocol&&r.host===t.host&&(e||r.port===t.port)))(new URL(ou.origin),ou.navigator&&/(msie|trident)/i.test(ou.navigator.userAgent)):()=>!0,XLe=ou.hasStandardBrowserEnv?{write(r,e,t,n,i,s){const a=[r+"="+encodeURIComponent(e)];Ir.isNumber(t)&&a.push("expires="+new Date(t).toGMTString()),Ir.isString(n)&&a.push("path="+n),Ir.isString(i)&&a.push("domain="+i),s===!0&&a.push("secure"),document.cookie=a.join("; ")},read(r){const e=document.cookie.match(new RegExp("(^|;\\s*)("+r+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(r){this.write(r,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function JLe(r){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(r)}function ZLe(r,e){return e?r.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):r}function gj(r,e){return r&&!JLe(e)?ZLe(r,e):e}const mj=r=>r instanceof ah?{...r}:r;function lm(r,e){e=e||{};const t={};function n(f,_,x,T){return Ir.isPlainObject(f)&&Ir.isPlainObject(_)?Ir.merge.call({caseless:T},f,_):Ir.isPlainObject(_)?Ir.merge({},_):Ir.isArray(_)?_.slice():_}function i(f,_,x,T){if(Ir.isUndefined(_)){if(!Ir.isUndefined(f))return n(void 0,f,x,T)}else return n(f,_,x,T)}function s(f,_){if(!Ir.isUndefined(_))return n(void 0,_)}function a(f,_){if(Ir.isUndefined(_)){if(!Ir.isUndefined(f))return n(void 0,f)}else return n(void 0,_)}function o(f,_,x){if(x in e)return n(f,_);if(x in r)return n(void 0,f)}const h={url:s,method:s,data:s,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:o,headers:(f,_,x)=>i(mj(f),mj(_),x,!0)};return Ir.forEach(Object.keys(Object.assign({},r,e)),function(_){const x=h[_]||i,T=x(r[_],e[_],_);Ir.isUndefined(T)&&x!==o||(t[_]=T)}),t}const _j=r=>{const e=lm({},r);let{data:t,withXSRFToken:n,xsrfHeaderName:i,xsrfCookieName:s,headers:a,auth:o}=e;e.headers=a=ah.from(a),e.url=aj(gj(e.baseURL,e.url),r.params,r.paramsSerializer),o&&a.set("Authorization","Basic "+btoa((o.username||"")+":"+(o.password?unescape(encodeURIComponent(o.password)):"")));let h;if(Ir.isFormData(t)){if(ou.hasStandardBrowserEnv||ou.hasStandardBrowserWebWorkerEnv)a.setContentType(void 0);else if((h=a.getContentType())!==!1){const[f,..._]=h?h.split(";").map(x=>x.trim()).filter(Boolean):[];a.setContentType([f||"multipart/form-data",..._].join("; "))}}if(ou.hasStandardBrowserEnv&&(n&&Ir.isFunction(n)&&(n=n(e)),n||n!==!1&&WLe(e.url))){const f=i&&s&&XLe.read(s);f&&a.set(i,f)}return e},YLe=typeof XMLHttpRequest<"u"&&function(r){return new Promise(function(t,n){const i=_j(r);let s=i.data;const a=ah.from(i.headers).normalize();let{responseType:o,onUploadProgress:h,onDownloadProgress:f}=i,_,x,T,I,N;function $(){I&&I(),N&&N(),i.cancelToken&&i.cancelToken.unsubscribe(_),i.signal&&i.signal.removeEventListener("abort",_)}let W=new XMLHttpRequest;W.open(i.method.toUpperCase(),i.url,!0),W.timeout=i.timeout;function Y(){if(!W)return;const ce=ah.from("getAllResponseHeaders"in W&&W.getAllResponseHeaders()),ve={data:!o||o==="text"||o==="json"?W.responseText:W.response,status:W.status,statusText:W.statusText,headers:ce,config:r,request:W};fj(function(Qe){t(Qe),$()},function(Qe){n(Qe),$()},ve),W=null}"onloadend"in W?W.onloadend=Y:W.onreadystatechange=function(){!W||W.readyState!==4||W.status===0&&!(W.responseURL&&W.responseURL.indexOf("file:")===0)||setTimeout(Y)},W.onabort=function(){W&&(n(new Ri("Request aborted",Ri.ECONNABORTED,r,W)),W=null)},W.onerror=function(){n(new Ri("Network Error",Ri.ERR_NETWORK,r,W)),W=null},W.ontimeout=function(){let fe=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";const ve=i.transitional||cj;i.timeoutErrorMessage&&(fe=i.timeoutErrorMessage),n(new Ri(fe,ve.clarifyTimeoutError?Ri.ETIMEDOUT:Ri.ECONNABORTED,r,W)),W=null},s===void 0&&a.setContentType(null),"setRequestHeader"in W&&Ir.forEach(a.toJSON(),function(fe,ve){W.setRequestHeader(ve,fe)}),Ir.isUndefined(i.withCredentials)||(W.withCredentials=!!i.withCredentials),o&&o!=="json"&&(W.responseType=i.responseType),f&&([T,N]=KB(f,!0),W.addEventListener("progress",T)),h&&W.upload&&([x,I]=KB(h),W.upload.addEventListener("progress",x),W.upload.addEventListener("loadend",I)),(i.cancelToken||i.signal)&&(_=ce=>{W&&(n(!ce||ce.type?new H0(null,r,W):ce),W.abort(),W=null)},i.cancelToken&&i.cancelToken.subscribe(_),i.signal&&(i.signal.aborted?_():i.signal.addEventListener("abort",_)));const ie=jLe(i.url);if(ie&&ou.protocols.indexOf(ie)===-1){n(new Ri("Unsupported protocol "+ie+":",Ri.ERR_BAD_REQUEST,r));return}W.send(s||null)})},eDe=(r,e)=>{const{length:t}=r=r?r.filter(Boolean):[];if(e||t){let n=new AbortController,i;const s=function(f){if(!i){i=!0,o();const _=f instanceof Error?f:this.reason;n.abort(_ instanceof Ri?_:new H0(_ instanceof Error?_.message:_))}};let a=e&&setTimeout(()=>{a=null,s(new Ri(`timeout ${e} of ms exceeded`,Ri.ETIMEDOUT))},e);const o=()=>{r&&(a&&clearTimeout(a),a=null,r.forEach(f=>{f.unsubscribe?f.unsubscribe(s):f.removeEventListener("abort",s)}),r=null)};r.forEach(f=>f.addEventListener("abort",s));const{signal:h}=n;return h.unsubscribe=()=>Ir.asap(o),h}},tDe=function*(r,e){let t=r.byteLength;if(t<e){yield r;return}let n=0,i;for(;n<t;)i=n+e,yield r.slice(n,i),n=i},rDe=async function*(r,e){for await(const t of nDe(r))yield*tDe(t,e)},nDe=async function*(r){if(r[Symbol.asyncIterator]){yield*r;return}const e=r.getReader();try{for(;;){const{done:t,value:n}=await e.read();if(t)break;yield n}}finally{await e.cancel()}},yj=(r,e,t,n)=>{const i=rDe(r,e);let s=0,a,o=h=>{a||(a=!0,n&&n(h))};return new ReadableStream({async pull(h){try{const{done:f,value:_}=await i.next();if(f){o(),h.close();return}let x=_.byteLength;if(t){let T=s+=x;t(T)}h.enqueue(new Uint8Array(_))}catch(f){throw o(f),f}},cancel(h){return o(h),i.return()}},{highWaterMark:2})},WB=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",bj=WB&&typeof ReadableStream=="function",iDe=WB&&(typeof TextEncoder=="function"?(r=>e=>r.encode(e))(new TextEncoder):async r=>new Uint8Array(await new Response(r).arrayBuffer())),vj=function(r){try{for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return!!r(...t)}catch{return!1}},sDe=bj&&vj(()=>{let r=!1;const e=new Request(ou.origin,{body:new ReadableStream,method:"POST",get duplex(){return r=!0,"half"}}).headers.has("Content-Type");return r&&!e}),xj=64*1024,zR=bj&&vj(()=>Ir.isReadableStream(new Response("").body)),XB={stream:zR&&(r=>r.body)};WB&&(r=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!XB[e]&&(XB[e]=Ir.isFunction(r[e])?t=>t[e]():(t,n)=>{throw new Ri(`Response type '${e}' is not supported`,Ri.ERR_NOT_SUPPORT,n)})})})(new Response);const oDe=async r=>{if(r==null)return 0;if(Ir.isBlob(r))return r.size;if(Ir.isSpecCompliantForm(r))return(await new Request(ou.origin,{method:"POST",body:r}).arrayBuffer()).byteLength;if(Ir.isArrayBufferView(r)||Ir.isArrayBuffer(r))return r.byteLength;if(Ir.isURLSearchParams(r)&&(r=r+""),Ir.isString(r))return(await iDe(r)).byteLength},aDe=async(r,e)=>{const t=Ir.toFiniteNumber(r.getContentLength());return t??oDe(e)},HR={http:SLe,xhr:YLe,fetch:WB&&(async r=>{let{url:e,method:t,data:n,signal:i,cancelToken:s,timeout:a,onDownloadProgress:o,onUploadProgress:h,responseType:f,headers:_,withCredentials:x="same-origin",fetchOptions:T}=_j(r);f=f?(f+"").toLowerCase():"text";let I=eDe([i,s&&s.toAbortSignal()],a),N;const $=I&&I.unsubscribe&&(()=>{I.unsubscribe()});let W;try{if(h&&sDe&&t!=="get"&&t!=="head"&&(W=await aDe(_,n))!==0){let ve=new Request(e,{method:"POST",body:n,duplex:"half"}),be;if(Ir.isFormData(n)&&(be=ve.headers.get("content-type"))&&_.setContentType(be),ve.body){const[Qe,Ue]=Aj(W,KB(pj(h)));n=yj(ve.body,xj,Qe,Ue)}}Ir.isString(x)||(x=x?"include":"omit");const Y="credentials"in Request.prototype;N=new Request(e,{...T,signal:I,method:t.toUpperCase(),headers:_.normalize().toJSON(),body:n,duplex:"half",credentials:Y?x:void 0});let ie=await fetch(N);const ce=zR&&(f==="stream"||f==="response");if(zR&&(o||ce&&$)){const ve={};["status","statusText","headers"].forEach(st=>{ve[st]=ie[st]});const be=Ir.toFiniteNumber(ie.headers.get("content-length")),[Qe,Ue]=o&&Aj(be,KB(pj(o),!0))||[];ie=new Response(yj(ie.body,xj,Qe,()=>{Ue&&Ue(),$&&$()}),ve)}f=f||"text";let fe=await XB[Ir.findKey(XB,f)||"text"](ie,r);return!ce&&$&&$(),await new Promise((ve,be)=>{fj(ve,be,{data:fe,headers:ah.from(ie.headers),status:ie.status,statusText:ie.statusText,config:r,request:N})})}catch(Y){throw $&&$(),Y&&Y.name==="TypeError"&&/fetch/i.test(Y.message)?Object.assign(new Ri("Network Error",Ri.ERR_NETWORK,r,N),{cause:Y.cause||Y}):Ri.from(Y,Y&&Y.code,r,N)}})};Ir.forEach(HR,(r,e)=>{if(r){try{Object.defineProperty(r,"name",{value:e})}catch{}Object.defineProperty(r,"adapterName",{value:e})}});const wj=r=>`- ${r}`,lDe=r=>Ir.isFunction(r)||r===null||r===!1,Bj={getAdapter:r=>{r=Ir.isArray(r)?r:[r];const{length:e}=r;let t,n;const i={};for(let s=0;s<e;s++){t=r[s];let a;if(n=t,!lDe(t)&&(n=HR[(a=String(t)).toLowerCase()],n===void 0))throw new Ri(`Unknown adapter '${a}'`);if(n)break;i[a||"#"+s]=n}if(!n){const s=Object.entries(i).map(o=>{let[h,f]=o;return`adapter ${h} `+(f===!1?"is not supported by the environment":"is not available in the build")});let a=e?s.length>1?`since :
`+s.map(wj).join(`
`):" "+wj(s[0]):"as no adapter specified";throw new Ri("There is no suitable adapter to dispatch the request "+a,"ERR_NOT_SUPPORT")}return n},adapters:HR};function VR(r){if(r.cancelToken&&r.cancelToken.throwIfRequested(),r.signal&&r.signal.aborted)throw new H0(null,r)}function Cj(r){return VR(r),r.headers=ah.from(r.headers),r.data=NR.call(r,r.transformRequest),["post","put","patch"].indexOf(r.method)!==-1&&r.headers.setContentType("application/x-www-form-urlencoded",!1),Bj.getAdapter(r.adapter||Mb.adapter)(r).then(function(n){return VR(r),n.data=NR.call(r,r.transformResponse,n),n.headers=ah.from(n.headers),n},function(n){return dj(n)||(VR(r),n&&n.response&&(n.response.data=NR.call(r,r.transformResponse,n.response),n.response.headers=ah.from(n.response.headers))),Promise.reject(n)})}const Ej="1.7.9",JB={};["object","boolean","number","function","string","symbol"].forEach((r,e)=>{JB[r]=function(n){return typeof n===r||"a"+(e<1?"n ":" ")+r}});const Tj={};JB.transitional=function(e,t,n){function i(s,a){return"[Axios v"+Ej+"] Transitional option '"+s+"'"+a+(n?". "+n:"")}return(s,a,o)=>{if(e===!1)throw new Ri(i(a," has been removed"+(t?" in "+t:"")),Ri.ERR_DEPRECATED);return t&&!Tj[a]&&(Tj[a]=!0,console.warn(i(a," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(s,a,o):!0}},JB.spelling=function(e){return(t,n)=>(console.warn(`${n} is likely a misspelling of ${e}`),!0)};function cDe(r,e,t){if(typeof r!="object")throw new Ri("options must be an object",Ri.ERR_BAD_OPTION_VALUE);const n=Object.keys(r);let i=n.length;for(;i-- >0;){const s=n[i],a=e[s];if(a){const o=r[s],h=o===void 0||a(o,s,r);if(h!==!0)throw new Ri("option "+s+" must be "+h,Ri.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new Ri("Unknown option "+s,Ri.ERR_BAD_OPTION)}}const ZB={assertOptions:cDe,validators:JB},Yf=ZB.validators;class cm{constructor(e){this.defaults=e,this.interceptors={request:new lj,response:new lj}}async request(e,t){try{return await this._request(e,t)}catch(n){if(n instanceof Error){let i={};Error.captureStackTrace?Error.captureStackTrace(i):i=new Error;const s=i.stack?i.stack.replace(/^.+\n/,""):"";try{n.stack?s&&!String(n.stack).endsWith(s.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+s):n.stack=s}catch{}}throw n}}_request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=lm(this.defaults,t);const{transitional:n,paramsSerializer:i,headers:s}=t;n!==void 0&&ZB.assertOptions(n,{silentJSONParsing:Yf.transitional(Yf.boolean),forcedJSONParsing:Yf.transitional(Yf.boolean),clarifyTimeoutError:Yf.transitional(Yf.boolean)},!1),i!=null&&(Ir.isFunction(i)?t.paramsSerializer={serialize:i}:ZB.assertOptions(i,{encode:Yf.function,serialize:Yf.function},!0)),ZB.assertOptions(t,{baseUrl:Yf.spelling("baseURL"),withXsrfToken:Yf.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let a=s&&Ir.merge(s.common,s[t.method]);s&&Ir.forEach(["delete","get","head","post","put","patch","common"],N=>{delete s[N]}),t.headers=ah.concat(a,s);const o=[];let h=!0;this.interceptors.request.forEach(function($){typeof $.runWhen=="function"&&$.runWhen(t)===!1||(h=h&&$.synchronous,o.unshift($.fulfilled,$.rejected))});const f=[];this.interceptors.response.forEach(function($){f.push($.fulfilled,$.rejected)});let _,x=0,T;if(!h){const N=[Cj.bind(this),void 0];for(N.unshift.apply(N,o),N.push.apply(N,f),T=N.length,_=Promise.resolve(t);x<T;)_=_.then(N[x++],N[x++]);return _}T=o.length;let I=t;for(x=0;x<T;){const N=o[x++],$=o[x++];try{I=N(I)}catch(W){$.call(this,W);break}}try{_=Cj.call(this,I)}catch(N){return Promise.reject(N)}for(x=0,T=f.length;x<T;)_=_.then(f[x++],f[x++]);return _}getUri(e){e=lm(this.defaults,e);const t=gj(e.baseURL,e.url);return aj(t,e.params,e.paramsSerializer)}}Ir.forEach(["delete","get","head","options"],function(e){cm.prototype[e]=function(t,n){return this.request(lm(n||{},{method:e,url:t,data:(n||{}).data}))}}),Ir.forEach(["post","put","patch"],function(e){function t(n){return function(s,a,o){return this.request(lm(o||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:s,data:a}))}}cm.prototype[e]=t(),cm.prototype[e+"Form"]=t(!0)});class GR{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(s){t=s});const n=this;this.promise.then(i=>{if(!n._listeners)return;let s=n._listeners.length;for(;s-- >0;)n._listeners[s](i);n._listeners=null}),this.promise.then=i=>{let s;const a=new Promise(o=>{n.subscribe(o),s=o}).then(i);return a.cancel=function(){n.unsubscribe(s)},a},e(function(s,a,o){n.reason||(n.reason=new H0(s,a,o),t(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=n=>{e.abort(n)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new GR(function(i){e=i}),cancel:e}}}function uDe(r){return function(t){return r.apply(null,t)}}function hDe(r){return Ir.isObject(r)&&r.isAxiosError===!0}const QR={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(QR).forEach(r=>{let[e,t]=r;QR[t]=e});function Sj(r){const e=new cm(r),t=$$(cm.prototype.request,e);return Ir.extend(t,cm.prototype,e,{allOwnKeys:!0}),Ir.extend(t,e,null,{allOwnKeys:!0}),t.create=function(i){return Sj(lm(r,i))},t}const hl=Sj(Mb);hl.Axios=cm,hl.CanceledError=H0,hl.CancelToken=GR,hl.isCancel=dj,hl.VERSION=Ej,hl.toFormData=jB,hl.AxiosError=Ri,hl.Cancel=hl.CanceledError,hl.all=function(e){return Promise.all(e)},hl.spread=uDe,hl.isAxiosError=hDe,hl.mergeConfig=lm,hl.AxiosHeaders=ah,hl.formToJSON=r=>uj(Ir.isHTMLForm(r)?new FormData(r):r),hl.getAdapter=Bj.getAdapter,hl.HttpStatusCode=QR,hl.default=hl;const dDe="https://eines.icgc.cat/recursos/mapicgc-gl-js/mapicgc-config.json",fDe=5e3;class Ij{static async getConfigICGC(){try{const e=await hl.get(dDe,{timeout:fDe});return e.data?e.data:(console.log("Resposta sense dades:",e),om)}catch(e){return e.response?(console.error("Error de resposta:",e.response.data),console.error("Codi d'estat:",e.response.status)):e.request?console.error("No s'ha rebut resposta del servidor:",e.request):console.error("Error:",e.message),om}}}const ADe={cobertesSol:{"fill-opacity":["interpolate",["exponential",.5],["zoom"],13.5,1,18,.4],"fill-outline-color":"rgba(0,0, 0, 0)","fill-color":["interpolate",["cubic-bezier",.5,1,1,1],["get","nivell_2"],0,"#ffffff",111,"#ffff00",112,"#ccff33",113,"#af5b15",114,"#808000",115,"#cdcd00",116,"#ffffcc",221,"#33cc33",222,"#66ff33",223,"#689018",224,"#967d5f",225,"#19e61e",226,"#b4ff9b",227,"#aaa500",228,"#c3c3a0",229,"#00ff9b",230,"#ff9632",231,"#282828",232,"#79797a",233,"#f5df78",234,"#3296ff",341,"#ff007d",342,"#ff53cd",343,"#ffa4e2",344,"#ffc8e2",345,"#ffb4b4",346,"#0f3700",347,"#730055",348,"#6200c4",349,"#4a9595",350,"#ff00f0",351,"#adaaca",352,"#ffe6e6",353,"#67629a",354,"#4a466e",355,"#2f2d46",461,"#6f6fff",462,"#0000dc",463,"#000064",464,"#185f94",465,"#12466d",466,"#000080"]}},pDe="lines",YB="labels";let um,Fb,va,ys,gDe=class{constructor(e){Ij.getConfigICGC().then(t=>{um={...t.Styles},va={...t.Layers},Fb={...t.Terrains},ys={...t.defaultOptions},this.initTheMap(e)}).catch(t=>{console.info("Configuracio per defecte",t),um={...om.Styles},va={...om.Layers},Fb={...om.Terrains},ys={...om.defaultOptions},this.initTheMap(e)})}initTheMap(e){if(!e)e=ys.mapOptions;else for(const n in ys.mapOptions){let i=[ys.mapOptions.center[0],ys.mapOptions.center[1]];ys.mapOptions.center=i,e.hasOwnProperty(n)||(e[n]=ys.mapOptions[n])}e.maxPitch=85,e.maplibreLogo=!1,e.attributionControl=!1;const t=e.style.includes("https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/");t?(this.map=new Wl.Map({container:e.container,center:e.center,zoom:e.zoom,pitch:e.pitch||0,hash:e.hash||!1,style:{version:8,sources:{},layers:[]}}),this.map.on("load",()=>{this.map.addSource("raster-source",{type:"raster",tiles:[e.style],tileSize:256}),this.map.addLayer({id:"raster-layer",type:"raster",source:"raster-source"})})):this.map=new Wl.Map(e),this.map.on("load",()=>{if(!t){const n=this.map.getStyle().name,i=e.style;this.map.addControl(new U4e({color:i.indexOf("orto")===-1,defaultOptions:ys}),"bottom-left"),this._dealOrto3dStyle(n)}})}addGeocoderICGC(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"top-right";try{e={...{collapsed:!0,marker:!0,zoom:16,popup:!0,showResultMarkers:!0,maplibregl:Wl,showResultsWhileTyping:!0,minLength:2},...e};const i={forwardGeocode:async a=>{const o=[];try{const h=ys.geocoder.peliasUrl1+encodeURIComponent(a.query)+ys.geocoder.peliasUrl2,_=await(await fetch(h)).json();for(const x of _.features){const T=x.geometry.coordinates,I={type:"Feature",geometry:{type:"Point",coordinates:T},place_name:x.properties.etiqueta,properties:x.properties,text:x.properties.etiqueta,place_type:["place"],center:T};o.push(I)}}catch(h){console.error(`Failed to forwardGeocode with error: ${h}`)}return{features:o}}};this.map.addControl(new k4e(i,e),t);let s=document.getElementsByClassName("maplibregl-ctrl-geocoder--input");s[0].attributes[2].nodeValue="Cerca...",s[0].addEventListener("input",function(a){a.target.value.length>3})}catch(n){console.error(`Error adding ICGC geocoder: ${n.message}`)}}async loadImage(e){try{return this.map.loadImage(e)}catch(t){console.error(`Error getting loadImage: ${t.message}`)}}getConfigStyles(){try{let e=[];for(const t of um)e.push(t.name);return e}catch(e){console.error(`Error retrieving base styles: ${e.message}`)}}getConfigWMSLayers(){try{let e=[];for(const t in va.WMS)va.WMS.hasOwnProperty(t)&&e.push(t);return e}catch(e){console.error(`Error retrieving WMS layers: ${e.message}`)}}getConfigOrtoLayers(){try{let e=[];for(const t in va.Orto)va.Orto.hasOwnProperty(t)&&e.push(t);return e}catch(e){console.error(`Error retrieving orto image layers: ${e.message}`)}}getConfigVectorLayers(){try{let e=[];for(const t in va.Vector)va.Vector.hasOwnProperty(t)&&e.push(t);return e}catch(e){console.error(`Error retrieving vector layers: ${e.message}`)}}getConfigVectorAdminLayers(){try{let e=[];for(const t in va.VectorAdmin)va.VectorAdmin.hasOwnProperty(t)&&e.push(t);return e}catch(e){console.error(`Error retrieving vectorAdmin layers: ${e.message}`)}}getConfigFGBAdminLayers(){try{let e=[];for(const t in va.FGBAdmin)va.FGBAdmin.hasOwnProperty(t)&&e.push(t);return e}catch(e){console.error(`Error retrieving FGBAdmin layers: ${e.message}`)}}async fetchData(e,t,n){try{(!n||n===void 0)&&(n={type:"line",layout:{visibility:"visible"},paint:{"line-color":"grey","line-width":2},layerPosition:"top"});let i=n.layerPosition;if(e.includes(".fgb"))this.addFGBLayerICGC(e,t,n);else{const a=await(await fetch(e)).json();let o=t,h=this._dealOrderLayer(i),f=a.features[0].geometry.type;f.includes("ine")&&(n!==void 0?this.map.addLayer({id:o,type:"line",source:{type:"geojson",data:a},layout:n.layout||{},paint:n.paint||{}},h):this.map.addLayer({id:o,type:"line",source:{type:"geojson",data:a},layout:{visibility:"visible"},paint:{"line-color":"black","line-width":2,"line-opacity":1}},h)),f.includes("olygon")&&(n!==void 0?this.map.addLayer({id:o,type:"fill",source:{type:"geojson",data:a},layout:n.layout,paint:n.paint},h):this.map.addLayer({id:o,type:"fill",source:{type:"geojson",data:a},layout:{visibility:"visible"},paint:{"fill-color":"blue","fill-opacity":.6}},h)),f.includes("oint")&&(n!==void 0?this.map.addLayer({id:o,type:"circle",source:{type:"geojson",data:a},layout:n.layout,paint:n.paint},h):this.map.addLayer({id:o,type:"circle",source:{type:"geojson",data:a},layout:{visibility:"visible"},paint:{"circle-color":"red","circle-opacity":.85}},h))}}catch(i){console.error(`Error fetching data: ${i.message}`)}}async fetchDataAndMenu(e,t,n,i){try{let s;i!==null?s=i.layerPosition:s=YB;let a,o=document.getElementById("map");if(document.getElementById("menu-group")?a=document.getElementById("menu-group"):(a=document.createElement("nav"),a.id="menu-group",a.classList.add="filter-group",o.appendChild(a)),a!==null){let h="visible",f=this._dealOrderLayer(s),_;if(e.includes(".fgb")){let T=this._getKeyByUrlFGB(e);T===null&&(T="userFGB");const I=await fetch(e),N={type:"FeatureCollection",features:[]};for await(const W of tO(I.body))N.features.push(W);_=N;let $=t;if(this.map.addSource($,{type:"geojson",data:N}),e.includes("text"))i!==void 0?this.map.addLayer({id:t,type:"symbol",source:$,layout:i.layout,paint:i.paint},f):this.map.addLayer({id:t,type:"symbol",source:$,layout:{"text-letter-spacing":.1,"text-size":{base:1.2,stops:[[8,0],[12,14],[15,15]]},"text-font":["FiraSans-Regular"],"text-field":["get","NOM_AC"],"text-transform":"none","text-max-width":25,visibility:h,"text-justify":"right","text-anchor":"top","text-allow-overlap":!1,"symbol-spacing":2,"text-line-height":1},paint:{"text-halo-blur":.5,"text-color":"rgba(90, 7, 7, 1)","text-halo-width":2,"text-halo-color":"rgba(255, 255, 255,0.8)"}},f);else{let W=t+"Text";this.map.addLayer({id:W,type:"symbol",source:$,layout:{"text-letter-spacing":.1,"text-size":{base:1.2,stops:[[8,0],[12,14],[15,15]]},"text-font":["FiraSans-Regular"],"text-field":["get","NOM_AC"],"text-transform":"none","text-max-width":25,visibility:h,"text-justify":"right","text-anchor":"top","text-allow-overlap":!1,"symbol-spacing":2,"text-line-height":1},paint:{"text-halo-blur":.5,"text-color":"rgba(90, 7, 7, 1)","text-halo-width":2,"text-halo-color":"rgba(255, 255, 255,0.8)"}},f)}}else _=await(await fetch(e)).json();if(n!=="all"){const T=document.createElement("div");T.id="titleDivMenu",T.textContent=t,a.appendChild(T);const I=document.createElement("div");I.id="titleDivMenuSub",I.textContent=` ${n}`,a.appendChild(I)}let x;if(i.type?x=i.type:x=_.features[0].geometry.type,n==="all")x.includes("ine")&&(i!==void 0?this.map.addLayer({id:t,type:"line",source:{type:"geojson",data:_},layout:i.layout,paint:i.paint},f):this.map.addLayer({id:t,type:"line",source:{type:"geojson",data:_},layout:{visibility:"visible"},paint:{"line-color":"black","line-width":2,"line-opacity":1}},f)),x.includes("olygon")&&(i!==void 0?this.map.addLayer({id:t,type:"fill",source:{type:"geojson",data:_},layout:i.layout,paint:i.paint},f):this.map.addLayer({id:t,type:"fill",source:{type:"geojson",data:_},layout:{visibility:"visible"},paint:{"fill-color":"#0000FF","fill-opacity":0}},f)),x.includes("oint")&&(i!==void 0?this.map.addLayer({id:t,type:"circle",source:{type:"geojson",data:_},layout:i.layout,paint:i.paint},f):this.map.addLayer({id:t,type:"circle",source:{type:"geojson",data:_},layout:{visibility:"visible"},paint:{"circle-color":"red","circle-opacity":.85}},f)),x.includes("ymbol")&&(i!==void 0?this.map.addLayer({id:t,type:"symbol",source:{type:"geojson",data:_},layout:i.layout,paint:i.paint},f):this.map.addLayer({id:t,type:"symbol",source:{type:"geojson",data:_},layout:{visibility:"visible"},paint:{"text-halo-blur":.5,"text-color":"rgba(90, 7, 7, 1)","text-halo-width":2,"text-halo-color":"rgba(255, 255, 255,0.8)"}},f)),this.addMenuItem(t);else{let T=n;const I={};_.features.forEach(N=>{const $=N.properties[T],W=$+"-userFieldFilter-"+t;$!==null&&(I[W]||(x.includes("ine")&&(i!==void 0?this.map.addLayer({id:W,type:"line",source:{type:"geojson",data:_},layout:i.layout,paint:i.paint,filter:["==",`${T}`,$]},f):this.map.addLayer({id:W,type:"line",source:{type:"geojson",data:_},layout:{visibility:"visible"},filter:["==",`${T}`,$],paint:{"line-color":"black","line-width":2,"line-opacity":1}},f)),x.includes("olygon")&&(i!==void 0?this.map.addLayer({id:W,type:"fill",source:{type:"geojson",data:_},filter:["==",`${T}`,$],layout:i.layout,paint:i.paint},f):this.map.addLayer({id:W,type:"fill",source:{type:"geojson",data:_},layout:{visibility:"visible"},filter:["==",`${T}`,$],paint:{"fill-color":"blue","fill-opacity":.6}},f)),x.includes("oint")&&(i!==void 0?this.map.addLayer({id:W,type:"circle",source:{type:"geojson",data:_},filter:["==",`${T}`,$],layout:i.layout,paint:i.paint},f):this.map.addLayer({id:W,type:"circle",source:{type:"geojson",data:_},layout:{visibility:"visible"},filter:["==",`${T}`,$],paint:{"circle-color":"red","circle-opacity":.85}},f)),I[W]=!0,this.addMenuItem(W)))})}}}catch(s){console.error(`Error fetching data: ${s.message}`)}}on(e,t){setTimeout(()=>{try{return this.map.on(e,t)}catch(n){console.error(`Error adding event ON listener: ${n.message}`)}},100)}setStyle(e,t){try{t!==void 0?this.map.setStyle(e,t):this.map.setStyle(e),this.map.on("styledata",()=>{if(window.document.querySelector(".maplibregl-compact-show")){var n=window.document.querySelector(".maplibregl-compact-show");n.classList.remove("maplibregl-compact-show")}this._dealOrto3dStyle(this.map.getStyle().name)})}catch(n){console.error(`Error setting style: ${n.message}`)}}addControl(e,t){try{t===void 0&&(t="top-right"),this.map.addControl(e,t)}catch(n){console.error(`Error adding control: ${n.message}`)}}setSky(e){try{e===void 0&&(this.map.style.stylesheet.id.includes("orto")?e={"sky-color":"#86bbd5","sky-horizon-blend":.3,"horizon-color":"#ffffff33","horizon-fog-blend":.1,"fog-ground-blend":.75,"fog-color":"#c5d6d6"}:this.map.style.stylesheet.id.includes("mapa_estandard_general")?e={"sky-color":"#a5f0f0","sky-horizon-blend":.3,"horizon-color":"#e1e3e3","horizon-fog-blend":.9,"fog-ground-blend":.85,"fog-color":"#c5d6d6"}:this.map.style.stylesheet.id.includes("icgc_mapa_vissir")?e={"sky-color":"#a5f0f0","sky-horizon-blend":.3,"horizon-color":"#e1e3e3","horizon-fog-blend":.9,"fog-ground-blend":.85,"fog-color":"#c5d6d6"}:this.map.style.stylesheet.id.includes("fosc")?e={"sky-color":"#232423","sky-horizon-blend":.3,"horizon-color":"#969996","horizon-fog-blend":.9,"fog-ground-blend":.85,"fog-color":"#383838"}:e={"sky-color":"#86bbd5","sky-horizon-blend":.3,"horizon-color":"#ffffff33","horizon-fog-blend":.1,"fog-ground-blend":.75,"fog-color":"#c5d6d6"}),this.map.setSky(e)}catch(t){console.error(`Error setting sky properties: ${t.message}`)}}addMouseCoordControl(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"bottom-left";try{this.map.addControl(new V4e(e),t)}catch(n){console.error(`Error adding mouse coordinate control: ${n.message}`)}}addGeolocateControl(e,t){try{t===void 0&&(t="top-right"),e===void 0?this.map.addControl(new Wl.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0}),t):this.map.addControl(new Wl.GeolocateControl(e),t)}catch(n){console.error(`Error adding geolocate control: ${n.message}`)}}addFullscreenControl(e,t){try{t===void 0&&(t="top-right"),e===void 0?this.map.addControl(new Wl.FullscreenControl({container:HTMLElement}),t):this.map.addControl(new Wl.FullscreenControl(e),t)}catch(n){console.error(`Error adding fullscreen control: ${n.message}`)}}addLayer(e,t){try{this.map.addLayer(e,t)}catch(n){console.error(`Error adding layer: ${n.message}`)}}addImage(e,t,n){try{this.map.addImage(e,t,n)}catch(i){console.error(`Error adding image: ${i.message}`)}return this}addSource(e,t){try{this.map.addSource(e,t)}catch(n){console.error(`Error adding source: ${n.message}`)}return this}addSprite(e,t,n){try{this.map.addSprite(e,t,n)}catch(i){console.error(`Error adding sprite: ${i.message}`)}return this}areTilesLoaded(){return this.map.areTilesLoaded()}cameraForBounds(e,t){return this.map.cameraForBounds(e,t)}easeTo(e,t){return this.map.easeTo(e,t),this}fitBounds(e,t,n){return this.map.fitBounds(e,t,n),this}fitScreenCoordinates(e,t,n,i,s){return this.map.fitScreenCoordinates(e,t,n,i,s),this}flyTo(e,t){return this.map.flyTo(e,t),this}getBearing(){return this.map.getBearing()}getBounds(){return this.map.getBounds()}getCameraTargetElevation(){return this.map.getCameraTargetElevation()}getCanvas(){return this.map.getCanvas()}getCanvasContainer(){return this.map.getCanvasContainer()}getCenter(){return this.map.getCenter()}getContainer(){return this.map.getContainer()}getFeatureState(e){return this.map.getFeatureState(e)}getFilter(e){return this.map.getFilter(e)}getGlyphs(){return this.map.getGlyphs()}getImage(e){return this.map.getImage(e)}getLayer(e){return this.map.getLayer(e)}getLayersOrder(){return this.map.getLayersOrder()}getLayoutProperty(e,t){return this.map.getLayoutProperty(e,t)}getLight(){return this.map.getLight()}getMaxBounds(){return this.map.getMaxBounds()}getMaxPitch(){return this.map.getMaxPitch()}getMaxZoom(){return this.map.getMaxZoom()}getMinPitch(){return this.map.getMinPitch()}getMinZoom(){return this.map.getMinZoom()}getPadding(){return this.map.getPadding()}getPaintProperty(e,t){return this.map.getPaintProperty(e,t)}getPitch(){return this.map.getPitch()}getPixelRatio(){return this.map.getPixelRatio()}getRenderWorldCopies(){return this.map.getRenderWorldCopies()}getSource(e){return this.map.getSource(e)}getSprite(){return this.map.getSprite()}getStyle(){return this.map.getStyle()}getTerrain(){return this.map.getTerrain()}getZoom(){return this.map.getZoom()}hasControl(e){return this.map.hasControl(e)}hasImage(e){return this.map.hasImage(e)}isMoving(){return this.map.isMoving()}isRotating(){return this.map.isRotating()}isSourceLoaded(e){return this.map.isSourceLoaded(e)}isStyleLoaded(){return this.map.isStyleLoaded()}isZooming(){return this.map.isZooming()}jumpTo(e,t){return this.map.jumpTo(e,t)}listImages(){return this.map.listImages()}listens(e){return this.map.listens(e)}loadImage(e){return this.map.loadImage(e)}loaded(){return this.map.loaded()}LngLatBounds(e,t){return new Wl.LngLatBounds(e,t)}addProtocol(e,t){return this.map.addProtocol(e,t)}moveLayer(e,t){return this.map.moveLayer(e,t)}panBy(e,t,n){return this.map.panBy(e,t,n)}panTo(e,t,n){return this.map.panTo(e,t,n)}project(e){return this.map.project(e)}queryRenderedFeatures(e,t){return this.map.queryRenderedFeatures(e,t)}querySourceFeatures(e,t){return this.map.querySourceFeatures(e,t)}queryTerrainElevation(e){return this.map.queryTerrainElevation(e)}redraw(){return this.map.redraw()}remove(){return this.map.remove()}removeControl(e){return this.map.removeControl(e)}removeFeatureState(e,t){return this.map.removeFeatureState(e,t)}removeImage(e){return this.map.removeImage(e)}removeLayer(e){try{this.map.removeLayer(e)}catch(t){console.error(`Error removing layer: ${t.message}`)}}removeSource(e){try{this.map.removeSource(e)}catch(t){console.error(`Error removing source: ${t.message}`)}}removeSprite(e){return this.map.removeSprite(e)}resetNorth(e,t){return this.map.resetNorth(e,t)}resetNorthPitch(e,t){return this.map.resetNorthPitch(e,t)}resize(e){return this.map.resize(e)}rotateTo(e,t,n){return this.map.rotateTo(e,t,n)}setBearing(e,t){return this.map.setBearing(e,t)}setCenter(e,t){return this.map.setCenter(e,t)}setEventedParent(e,t){return this.map.setEventedParent(e,t)}setFeatureState(e,t){return this.map.setFeatureState(e,t)}setFilter(e,t,n){return this.map.setFilter(e,t,n)}setGlyphs(e,t){return this.map.setGlyphs(e,t)}setLayerZoomRange(e,t,n){return this.map.setLayerZoomRange(e,t,n)}setLayoutProperty(e,t,n,i){return this.map.setLayoutProperty(e,t,n,i)}setLight(e,t){return this.map.setLight(e,t)}setMaxBounds(e){return this.map.setMaxBounds(e)}setMaxPitch(e){return this.map.setMaxPitch(e)}setMaxZoom(e){return this.map.setMaxZoom(e)}setMinPitch(e){return this.map.setMinPitch(e)}setMinZoom(e){return this.map.setMinZoom(e)}setPadding(e,t){return this.map.setPadding(e,t)}setPaintProperty(e,t,n,i){return this.map.setPaintProperty(e,t,n,i)}setPitch(e,t){return this.map.setPitch(e,t)}setPixelRatio(e){return this.map.setPixelRatio(e)}setRenderWorldCopies(e){return this.map.setRenderWorldCopies(e)}setSprite(e,t){return this.map.setSprite(e,t)}setTerrain(e){return this.map.setTerrain(e)}setTransformRequest(e){return this.map.setTransformRequest(e)}setZoom(e,t){return this.map.setZoom(e,t)}snapToNorth(e,t){return this.map.snapToNorth(e,t)}stop(){return this.map.stop()}triggerRepaint(){return this.map.triggerRepaint()}unproject(e){return this.map.unproject(e)}updateImage(e,t){return this.map.updateImage(e,t)}zoomIn(e,t){return this.map.zoomIn(e,t)}zoomOut(e,t){return this.map.zoomOut(e,t)}zoomTo(e,t,n){return this.map.zoomTo(e,t,n)}addLayerGeoJSON(e,t){try{let n=this._dealOrderLayer(t);this.map.addSource(`${e.id}`,{type:"geojson",data:e.data}),this.map.addLayer({id:`${e.id}-layerIcgcMap`,type:e.type,source:`${e.id}`,layout:e.layout,paint:e.paint},n)}catch(n){console.error(`Error adding GeoJSON layer: ${n.message}`)}}addLayerWMS(e,t,n){try{let i=this._dealOrderLayer(n.layerPosition);n?(this.map.addSource(`${t}`,{type:"raster",tiles:[e],tileSize:256},i),this.map.addLayer({id:t,type:"raster",source:t,layout:n.layout,paint:n.paint},i)):(this.map.addSource(`${t}`,{type:"raster",tiles:[e],tileSize:256},i),this.map.addLayer({id:t,type:"raster",source:t,paint:{}},i))}catch(i){console.error(`Error adding WMS layer: ${i.message}`)}}addLogo(e){try{let t=document.getElementById("map"),n;n=document.createElement("div"),n.id="logos",t.appendChild(n);const i=document.createElement("img");i.src=e.url,i.style.height=e.height;const s=document.getElementById("logos"),a=document.createElement("a");a.id=e.id,a.href=e.href,a.target="_blank",a.style.position="relative",a.style.bottom="1px",a.appendChild(i),s.appendChild(a)}catch(t){console.error(`Error adding logo: ${t.message}`)}}addBasemapsICGC(e){try{const t=a=>{this.map.setStyle(a)};let n=document.getElementById("map"),i;i=document.createElement("div"),i.id="basemap-group",i.classList.add="filter-group",n.appendChild(i);const s=document.getElementById("basemap-group");for(const a of e)for(const o of Object.keys(ys.baseStyles)){const h=ys.baseStyles[o];if(a===h.url){const f=document.createElement("div");f.className="basemap-item",f.title=h.key,f.style.backgroundImage=`url('${h.image}')`,s.appendChild(f),f.addEventListener("click",()=>t(h.url))}}}catch(t){console.error(`Error adding basemaps: ${t.message}`)}}addBasemaps(e){try{const t=a=>{map.setStyle(a.url)};let n=document.getElementById("map"),i;i=document.createElement("div"),i.id="basemap-group",i.classList.add="basemap-group",n.appendChild(i);const s=document.getElementById("basemap-group");e.forEach(a=>{const o=document.createElement("div");o.className="basemap-item",o.title=a.label,o.style.backgroundImage=`url('${a.image}')`,s.appendChild(o),o.addEventListener("click",()=>t(a))})}catch(t){console.error(`Error adding basemaps: ${t.message}`)}}addFeatureQuery(e,t,n){try{let i;this.map.on("mouseenter",e,()=>{this.map.getCanvas().style.cursor="pointer"}),this.map.on("mouseleave",e,()=>{this.map.getCanvas().style.cursor=""}),this.map.on("click",s=>{let a=this.map.queryRenderedFeatures(s.point);if(a&&a[0].source.includes(e)){let o=[s.lngLat.lng,s.lngLat.lat];if(t!==void 0&&t.length>0&&t!=="all"){if(t!==null){let h="";t.forEach(f=>{let _=a[0].properties[f];h=h+`<h4>${_}</h4>`}),i=h,this.addPopup(o,i,n)}}else{let h="";for(const f in a[0].properties)h+="<b>"+f+"</b>:"+a[0].properties[f]+"<br>";i=h,this.addPopup(o,i,n)}}})}catch(i){console.error(`Error adding feature query: ${i.message}`)}}addScaleControl(e,t){try{var n=new Wl.ScaleControl(e);this.map.addControl(n,t)}catch(i){console.error(`Error adding scale: ${i.message}`)}}addExportControl(e,t){try{typeof e=="string"&&(t=e,e=void 0),e===void 0&&(e={PageSize:tm.A4,PageOrientation:xb.Landscape,Format:wA.PNG,DPI:rR[300],Crosshair:!0,PrintableArea:!0,Local:"ca"},t="top-right"),this.map.addControl(new q5e(e),t)}catch(n){console.error(`Error adding export control: ${n.message}`)}}addMarker(e){try{let t,n;return e.text===void 0?t=new Wl.Marker(e.options).setLngLat(e.coord).addTo(this.map):(n=new Wl.Popup({offset:e.textOffset}).setHTML(e.text),t=new Wl.Marker(e.options).setLngLat(e.coord).setPopup(n).addTo(this.map)),t}catch(t){return console.error(`Error adding marker: ${t.message}`),null}}addPopup(e,t,n){try{return n.image===void 0?new Wl.Popup().setLngLat(e).setHTML(`
        <div class="popupBody">
          <div class="popupTop">
          ${n.title}
          </div>
          <div class="popupBottom">
          <div class="popupBottomUp">
 ${t}
          </div>
          <div class="popupBottomDown">
          </div>
          </div>
        </div>
      `).addTo(this.map):new Wl.Popup().setLngLat(e).setHTML(`
        <div class="popupBody">
          <div class="popupTop">
          ${n.title}
          </div>
          <div class="popupBottom">
          <div class="popupBottomUp">
          ${t}
          </div>
          <div class="popupBottomDown">
             <img style="  padding: 8px;  width: 50%;" src=${n.image} />
          </div>
          </div>
        </div>
      `).addTo(this.map)}catch(i){return console.error(`Error adding popup: ${i.message}`),null}}addFullScreen(e){try{e===void 0&&(e="top-right"),this.map.addControl(new Wl.FullscreenControl,e)}catch(t){console.error(`Error adding fullscreen control: ${t.message}`)}}addMenuItem(e){try{let t;if(e.includes("-userFieldFilter-")?t=e.split("-userFieldFilter-")[0]:t=e,e.length>0){const n=document.getElementById("menu-group"),i=document.createElement("input");i.type="checkbox",i.id=e,i.checked=!0,n.appendChild(i);const s=document.createElement("label");s.setAttribute("for",e),s.textContent=t,n.appendChild(s),i.addEventListener("change",a=>{this.map.setLayoutProperty(e,"visibility",a.target.checked?"visible":"none")})}}catch(t){console.error(`Error adding menu item: ${t.message}`)}}addLayerTree(e){try{let t=e.features,n=document.getElementById("map"),i=document.createElement("nav");i.id="filter-group",n.appendChild(i);const s=document.getElementById("filter-group");this.map.addSource(`${e.id}`,{type:e.type,data:t}),t.features.forEach(a=>{const o=a.properties.icon,h=`poi-${o}`;if(!this.map.getLayer(h)){this.map.addLayer({id:h,type:"circle",source:`${e.id}`,paint:{"circle-radius":6,"circle-color":"#B42222"},filter:["==","icon",o]},this._firstSymbolLayer());const f=document.createElement("input");f.type="checkbox",f.id=h,f.checked=!0,s.appendChild(f);const _=document.createElement("label");_.setAttribute("for",h),_.textContent=o,s.appendChild(_),f.addEventListener("change",x=>{this.map.setLayoutProperty(h,"visibility",x.target.checked?"visible":"none")})}})}catch(t){console.error(`Error adding layer tree: ${t.message}`)}}createNavigationControl(e,t){try{t===void 0&&(t="top-right"),this.map.addControl(new Wl.NavigationControl(e),t)}catch(n){return console.error(`Error creating navigation control: ${n.message}`),null}}addNavigationControl(e,t){try{t===void 0&&(t="top-right"),this.map.addControl(new Wl.NavigationControl(e),t)}catch(n){console.error(`Error adding navigation control: ${n.message}`)}}addAttributionControl(e,t){try{this.map.addControl(new Wl.AttributionControl(e),t)}catch(n){console.error(`Error adding attribution control: ${n.message}`)}}addImageLayerICGC(e,t,n){try{let i=null,s,a;n?(a=n,s=n.layerPosition):a={type:"raster",layout:{visibility:"visible"},paint:{"raster-opacity":1},layerPosition:YB},i=this._findImageType(e,va.Orto,va.VectorAdmin,va.WMS,va.Vector),i||console.log(" %c The layer: %c%s%c does not exist in the ICGC DB. Consult the documentation.","font-weight: bold; font-style: italic;","font-weight: normal; font-style: normal; color: red;",e,"font-weight: bold; font-style: italic;");let o={id:t,tiles:e};this.addLayerWMS(e,t,a)}catch(i){console.error(`Error adding ICGC image layer: ${i.message}`)}}async addVectorLayerICGC(e,t,n){try{let{type:i="line",layerPosition:s=YB,layoutOptions:a={visibility:"visible"},paintOption:o}=n||{},h=this._dealOrderLayer(s);if(!e){console.log(" %c The layer: %c%s%c does not exist in the ICGC DB. Consult the documentation.","font-weight: bold; font-style: italic;","font-weight: normal; font-style: normal; color: red;",e,"font-weight: bold; font-style: italic;");return}if(e.includes("https")){let f=this._getKeyByUrlVector(e);this.map.addSource(f,{type:"vector",url:e});let _={id:f,type:"fill",source:f,"source-layer":"cobertes",maxzoom:18,layout:n.layout,paint:ADe.cobertesSol};if(f==="cobertes2018"&&this.map.addLayer(_,h),a.visibility==="visible"){let x=this._getLegendByName(f);this.addLegend(x,f)}}else{let f=t;this.map.addSource(f,{type:"vector",url:ys.limitsUrl});let _={id:t,type:i,source:f,"source-layer":e,layout:n.layout,paint:n.paint||{}};i==="fill"||i==="polygon"?_.paint=o||{"fill-color":"#0000FF","fill-opacity":0}:i==="line"&&(_.paint=o||{"line-color":"#4832a8","line-opacity":1,"line-width":1}),this.map.addLayer(_,h)}}catch(i){console.error(`Error adding ICGC vector layer: ${i.message}`)}}async addFGBLayerICGC(e,t,n){try{n||(n.layout={visibility:!0},n.paint={"line-color":"#4832a8","line-opacity":1,"line-width":1},n.type="lines",n.layerPosition="labels");let i=this._dealOrderLayer(n.layerPosition);const s=await fetch(e),a={type:"FeatureCollection",features:[]};for await(const h of tO(s.body))a.features.push(h);let o=t;this.map.addSource(o,{type:"geojson",data:a}),e.includes("text")?this.map.addLayer({id:t,type:"symbol",source:o,layout:{"text-letter-spacing":.1,"text-size":{base:1.2,stops:[[8,0],[12,14],[15,15]]},"text-font":["FiraSans-Regular"],"text-field":["get","NOM_AC"],"text-transform":"none","text-max-width":25,visibility:n.layout.visibility,"text-justify":"right","text-anchor":"top","text-allow-overlap":!1,"symbol-spacing":2,"text-line-height":1},paint:{"text-halo-blur":.5,"text-color":"rgba(90, 7, 7, 1)","text-halo-width":2,"text-halo-color":"rgba(255, 255, 255,0.8)"}},i):this.map.addLayer({id:t,type:n.type,source:o,layout:n.layout,paint:n.paint},i)}catch(i){console.error(`Error adding ICGC FGB layer: ${i.message}`)}}addTerrainICGC(e,t){try{let n;for(const s in Fb)if(Fb.hasOwnProperty(s)){const a=Fb[s];a===e&&(n=a)}let i=n;this.getSource("terrainICGC")!==void 0&&(this.getStyle().layers.forEach(a=>{a.source==="terrainICGC"&&this.removeLayer(a.id)}),this.removeSource("terrainICGC")),this.getSource("terrainICGC")===void 0&&(e.includes("terrarium")?this.map.addSource("terrainICGC",{type:"raster-dem",tiles:[i],tileSize:512,encoding:"terrarium",maxzoom:16}):this.map.addSource("terrainICGC",{type:"raster-dem",tiles:[i],tileSize:512,maxzoom:16})),this.map.setTerrain({source:"terrainICGC",exaggeration:1.5}),t==null||this.map.addControl(new gY({pitch:90,bearing:null,minpitchzoom:null}),t)}catch(n){console.error(`Error adding 3D terrain: ${n.message}`)}}addLegend(e,t){try{this.map.addControl(new N4e({url:e,idLayer:t}))}catch(n){console.error(`Error adding legend: ${n.message}`)}}_findImageType(e,t,n,i,s){const a=[t,n,i,s];for(const o of a)for(const[h,f]of Object.entries(o))if(f===e)return h;return null}_getKeyByUrlFGB(e){for(const t in va.FGBAdmin)if(va.FGBAdmin.hasOwnProperty(t)&&va.FGBAdmin[t]===e)return t;return null}_getLegendByName(e){for(const t in ys.vectorLayers){const n=ys.vectorLayers[t];if(n.key===e)return n.legend}return null}_getKeyByUrlVector(e){for(const t in va.Vector)if(va.Vector.hasOwnProperty(t)&&va.Vector[t]===e)return t;return null}async _raiseText3DStyle(){try{const e=await this.map.loadImage(ys.map3dOptions.imageIcon);this.map.addImage("stick",e.data),this.map.getStyle().layers.forEach(t=>{if(t["source-layer"]===ys.map3dOptions.sourceLayerFilterId&&t.minzoom>=ys.map3dOptions.minZoomFilter&&e){const n=t.id;this.map.setLayoutProperty(n,"icon-image","stick"),this.map.setLayoutProperty(n,"text-offset",[0,-9]),this.map.setLayoutProperty(n,"symbol-placement","point"),this.map.setLayoutProperty(n,"symbol-avoid-edges",!1),this.map.setLayoutProperty(n,"text-allow-overlap",!0),this.map.setLayoutProperty(n,"text-ignore-placement",!1),this.map.setLayoutProperty(n,"text-pitch-alignment","auto"),this.map.setLayoutProperty(n,"text-rotation-alignment","auto"),this.map.setLayoutProperty(n,"text-justify","center"),this.map.setLayoutProperty(n,"text-anchor","bottom"),this.map.setLayoutProperty(n,"icon-anchor","bottom"),this.map.setPaintProperty(n,"text-color","#ffffff"),this.map.setPaintProperty(n,"text-halo-color","#000000"),this.map.setPaintProperty(n,"text-halo-width",2)}})}catch(e){return console.error(`Error dealing orto 3D: ${e.message}`),null}}_dealStyleMaps(e){try{if(e&&e.indexOf("icgc.cat")!=-1){for(const t in um)if(um.hasOwnProperty(t)){const n=um[t];if(t===e)return n}return um[0]}else return e}catch(t){return console.error(`Error dealing with map styles: ${t.message}`),null}}_dealOrto3dStyle(e){try{if(e=="orto3d"){this.map.setMaxZoom(18.8),this.map.easeTo({pitch:45});const t=new oN({intensity:4}),n=new QI({ambientLight:t});this.map.setTerrain({source:ys.map3dOptions.terrainSource,exaggeration:ys.map3dOptions.exaggeration});const i=this._createCitiesMapboxLayer();this.map.getLayer(ys.map3dOptions.layerId3d)||(this.map.addLayer(i,ys.map3dOptions.layerIdOrder),this.map.setLayerZoomRange(ys.map3dOptions.layerId3d,ys.map3dOptions.minZoomRange,ys.map3dOptions.maxZoomRange),i.deck.setProps({effects:[n]}),this._raiseText3DStyle()),this.map.setSky({"sky-color":"#86bbd5","sky-horizon-blend":.3,"horizon-color":"#ffffff33","horizon-fog-blend":.1,"fog-ground-blend":.75,"fog-color":"#c5d6d6"})}else this.map.getLayer(ys.map3dOptions.layerId3d)&&(this.map.removeLayer(ys.map3dOptions.layerId3d),this.map.setTerrain(null))}catch(t){return console.error(`Error dealing orto 3D: ${t.message}`),null}}_dealOrderLayer(e){return e===YB?this._firstSymbolLayer():e===pDe?this._firstLineLayer():""}_firstSymbolLayer(){try{const e=this.map.getStyle().layers;let t;for(let n=0;n<e.length;n++)if(e[n].type==="symbol"&&e[n].id.indexOf("contour")===-1&&e[n].id.indexOf("water")===-1){t=e[n].id;break}return t}catch(e){console.error(`Error getting first symbol layer: ${e.message}`)}}_firstLineLayer(){try{const e=this.map.getStyle().layers;let t;for(let n=0;n<e.length;n++)if(e[n].type==="line"){t=e[n].id;break}return t}catch(e){console.error(`Error getting first symbol layer: ${e.message}`)}}_createCitiesMapboxLayer(){try{return new Gde({id:ys.map3dOptions.layerId3d,type:tF,data:ys.map3dOptions.urlTilesetCities,loader:kQ,loadOptions:{tileset:{viewDistanceScale:1,updateTransforms:!0,maximumScreenSpaceError:ys.map3dOptions.spaceErrorFactor}},onTilesetLoad:t=>{t.options.maximumScreenSpaceError=ys.map3dOptions.spaceErrorFactor},onTileLoad:t=>{t.content.cartographicOrigin.z-=ys.map3dOptions.zfactor},operation:"terrain+draw"})}catch(e){return console.error(`Error adding MapboxLayer: ${e.message}`),null}}};var Mj={exports:{}};function mDe(r,e){var t=r.getCenter(),n=r.getZoom(),i=r.getBearing(),s=r.getPitch();e.forEach(function(a){a.jumpTo({center:t,zoom:n,bearing:i,pitch:s})})}function _De(){var r,e=arguments.length;if(e===1)r=arguments[0];else{r=[];for(var t=0;t<e;t++)r.push(arguments[t])}var n=[];r.forEach(function(o,h){n[h]=a.bind(null,o,r.filter(function(f,_){return _!==h}))});function i(){r.forEach(function(o,h){o.on("move",n[h])})}function s(){r.forEach(function(o,h){o.off("move",n[h])})}function a(o,h){s(),mDe(o,h),i()}return i(),function(){s(),n=[],r=[]}}var yDe=_De;(function(r){var e=yDe,t=N$.EventEmitter;function n(i,s,a,o){if(this.options=o||{},this._mapA=i,this._mapB=s,this._horizontal=this.options.orientation==="horizontal",this._onDown=this._onDown.bind(this),this._onMove=this._onMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._ev=new t,this._swiper=document.createElement("div"),this._swiper.className=this._horizontal?"compare-swiper-horizontal":"compare-swiper-vertical",this._controlContainer=document.createElement("div"),this._controlContainer.className=this._horizontal?"maplibregl-compare maplibregl-compare-horizontal":"maplibregl-compare",this._controlContainer.className=this._controlContainer.className,this._controlContainer.appendChild(this._swiper),typeof a=="string"&&document.body.querySelectorAll){var h=document.body.querySelectorAll(a)[0];if(!h)throw new Error("Cannot find element with specified container selector.");h.appendChild(this._controlContainer)}else if(a instanceof Element&&a.appendChild)a.appendChild(this._controlContainer);else throw new Error("Invalid container specified. Must be CSS selector or HTML element.");this._bounds=s.getContainer().getBoundingClientRect();var f=(this._horizontal?this._bounds.height:this._bounds.width)/2;this._setPosition(f),this._clearSync=e(i,s),this._onResize=(function(){this._bounds=s.getContainer().getBoundingClientRect(),this.currentPosition&&this._setPosition(this.currentPosition)}).bind(this),s.on("resize",this._onResize),this.options&&this.options.mousemove&&(i.getContainer().addEventListener("mousemove",this._onMove),s.getContainer().addEventListener("mousemove",this._onMove)),this._swiper.addEventListener("mousedown",this._onDown),this._swiper.addEventListener("touchstart",this._onDown)}n.prototype={_setPointerEvents:function(i){this._controlContainer.style.pointerEvents=i,this._swiper.style.pointerEvents=i},_onDown:function(i){i.touches?(document.addEventListener("touchmove",this._onMove),document.addEventListener("touchend",this._onTouchEnd)):(document.addEventListener("mousemove",this._onMove),document.addEventListener("mouseup",this._onMouseUp))},_setPosition:function(i){i=Math.min(i,this._horizontal?this._bounds.height:this._bounds.width);var s=this._horizontal?"translate(0, "+i+"px)":"translate("+i+"px, 0)";this._controlContainer.style.transform=s,this._controlContainer.style.WebkitTransform=s;var a=this._horizontal?"rect(0, 999em, "+i+"px, 0)":"rect(0, "+i+"px, "+this._bounds.height+"px, 0)",o=this._horizontal?"rect("+i+"px, 999em, "+this._bounds.height+"px,0)":"rect(0, 999em, "+this._bounds.height+"px,"+i+"px)";this._mapA.getContainer().style.clip=a,this._mapB.getContainer().style.clip=o,this.currentPosition=i},_onMove:function(i){this.options&&this.options.mousemove&&this._setPointerEvents(i.touches?"auto":"none"),this._horizontal?this._setPosition(this._getY(i)):this._setPosition(this._getX(i))},_onMouseUp:function(){document.removeEventListener("mousemove",this._onMove),document.removeEventListener("mouseup",this._onMouseUp),this.fire("slideend",{currentPosition:this.currentPosition})},_onTouchEnd:function(){document.removeEventListener("touchmove",this._onMove),document.removeEventListener("touchend",this._onTouchEnd),this.fire("slideend",{currentPosition:this.currentPosition})},_getX:function(i){i=i.touches?i.touches[0]:i;var s=i.clientX-this._bounds.left;return s<0&&(s=0),s>this._bounds.width&&(s=this._bounds.width),s},_getY:function(i){i=i.touches?i.touches[0]:i;var s=i.clientY-this._bounds.top;return s<0&&(s=0),s>this._bounds.height&&(s=this._bounds.height),s},setSlider:function(i){this._setPosition(i)},on:function(i,s){return this._ev.on(i,s),this},fire:function(i,s){return this._ev.emit(i,s),this},off:function(i,s){return this._ev.removeListener(i,s),this},remove:function(){this._clearSync(),this._mapB.off("resize",this._onResize);var i=this._mapA.getContainer();i&&(i.style.clip=null,i.removeEventListener("mousemove",this._onMove));var s=this._mapB.getContainer();s&&(s.style.clip=null,s.removeEventListener("mousemove",this._onMove)),this._swiper.removeEventListener("mousedown",this._onDown),this._swiper.removeEventListener("touchstart",this._onDown),this._controlContainer.remove()}},window.maplibregl?maplibregl.Compare=n:r.exports=n})(Mj);var bDe=Mj.exports;const vDe=dA(bDe);class xDe{constructor(e,t,n,i){const s=this;setTimeout(function(){s.mapCompare=new vDe(e.map,t.map,n,{})},1e3)}}/*!
 * html2canvas 1.4.1 <https://html2canvas.hertzen.com>
 * Copyright (c) 2022 Niklas von Hertzen <https://hertzen.com>
 * Released under MIT License
 *//*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var $R=function(r,e){return $R=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])},$R(r,e)};function lf(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");$R(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var jR=function(){return jR=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},jR.apply(this,arguments)};function Pu(r,e,t,n){function i(s){return s instanceof t?s:new t(function(a){a(s)})}return new(t||(t=Promise))(function(s,a){function o(_){try{f(n.next(_))}catch(x){a(x)}}function h(_){try{f(n.throw(_))}catch(x){a(x)}}function f(_){_.done?s(_.value):i(_.value).then(o,h)}f((n=n.apply(r,[])).next())})}function au(r,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,i,s,a;return a={next:o(0),throw:o(1),return:o(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function o(f){return function(_){return h([f,_])}}function h(f){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(s=f[0]&2?i.return:f[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,f[1])).done)return s;switch(i=0,s&&(f=[f[0]&2,s.value]),f[0]){case 0:case 1:s=f;break;case 4:return t.label++,{value:f[1],done:!1};case 5:t.label++,i=f[1],f=[0];continue;case 7:f=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(f[0]===6||f[0]===2)){t=0;continue}if(f[0]===3&&(!s||f[1]>s[0]&&f[1]<s[3])){t.label=f[1];break}if(f[0]===6&&t.label<s[1]){t.label=s[1],s=f;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(f);break}s[2]&&t.ops.pop(),t.trys.pop();continue}f=e.call(r,t)}catch(_){f=[6,_],i=0}finally{n=s=0}if(f[0]&5)throw f[1];return{value:f[0]?f[1]:void 0,done:!0}}}function eC(r,e,t){if(arguments.length===2)for(var n=0,i=e.length,s;n<i;n++)(s||!(n in e))&&(s||(s=Array.prototype.slice.call(e,0,n)),s[n]=e[n]);return r.concat(s||e)}for(var CA=function(){function r(e,t,n,i){this.left=e,this.top=t,this.width=n,this.height=i}return r.prototype.add=function(e,t,n,i){return new r(this.left+e,this.top+t,this.width+n,this.height+i)},r.fromClientRect=function(e,t){return new r(t.left+e.windowBounds.left,t.top+e.windowBounds.top,t.width,t.height)},r.fromDOMRectList=function(e,t){var n=Array.from(t).find(function(i){return i.width!==0});return n?new r(n.left+e.windowBounds.left,n.top+e.windowBounds.top,n.width,n.height):r.EMPTY},r.EMPTY=new r(0,0,0,0),r}(),tC=function(r,e){return CA.fromClientRect(r,e.getBoundingClientRect())},wDe=function(r){var e=r.body,t=r.documentElement;if(!e||!t)throw new Error("Unable to get document size");var n=Math.max(Math.max(e.scrollWidth,t.scrollWidth),Math.max(e.offsetWidth,t.offsetWidth),Math.max(e.clientWidth,t.clientWidth)),i=Math.max(Math.max(e.scrollHeight,t.scrollHeight),Math.max(e.offsetHeight,t.offsetHeight),Math.max(e.clientHeight,t.clientHeight));return new CA(0,0,n,i)},rC=function(r){for(var e=[],t=0,n=r.length;t<n;){var i=r.charCodeAt(t++);if(i>=55296&&i<=56319&&t<n){var s=r.charCodeAt(t++);(s&64512)===56320?e.push(((i&1023)<<10)+(s&1023)+65536):(e.push(i),t--)}else e.push(i)}return e},Na=function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];if(String.fromCodePoint)return String.fromCodePoint.apply(String,r);var t=r.length;if(!t)return"";for(var n=[],i=-1,s="";++i<t;){var a=r[i];a<=65535?n.push(a):(a-=65536,n.push((a>>10)+55296,a%1024+56320)),(i+1===t||n.length>16384)&&(s+=String.fromCharCode.apply(String,n),n.length=0)}return s},Pj="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",BDe=typeof Uint8Array>"u"?[]:new Uint8Array(256),nC=0;nC<Pj.length;nC++)BDe[Pj.charCodeAt(nC)]=nC;for(var Fj="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Rb=typeof Uint8Array>"u"?[]:new Uint8Array(256),iC=0;iC<Fj.length;iC++)Rb[Fj.charCodeAt(iC)]=iC;for(var CDe=function(r){var e=r.length*.75,t=r.length,n,i=0,s,a,o,h;r[r.length-1]==="="&&(e--,r[r.length-2]==="="&&e--);var f=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"&&typeof Uint8Array.prototype.slice<"u"?new ArrayBuffer(e):new Array(e),_=Array.isArray(f)?f:new Uint8Array(f);for(n=0;n<t;n+=4)s=Rb[r.charCodeAt(n)],a=Rb[r.charCodeAt(n+1)],o=Rb[r.charCodeAt(n+2)],h=Rb[r.charCodeAt(n+3)],_[i++]=s<<2|a>>4,_[i++]=(a&15)<<4|o>>2,_[i++]=(o&3)<<6|h&63;return f},EDe=function(r){for(var e=r.length,t=[],n=0;n<e;n+=2)t.push(r[n+1]<<8|r[n]);return t},TDe=function(r){for(var e=r.length,t=[],n=0;n<e;n+=4)t.push(r[n+3]<<24|r[n+2]<<16|r[n+1]<<8|r[n]);return t},hm=5,qR=11,KR=2,SDe=qR-hm,Rj=65536>>hm,IDe=1<<hm,WR=IDe-1,MDe=1024>>hm,PDe=Rj+MDe,FDe=PDe,RDe=32,LDe=FDe+RDe,DDe=65536>>qR,ODe=1<<SDe,kDe=ODe-1,Lj=function(r,e,t){return r.slice?r.slice(e,t):new Uint16Array(Array.prototype.slice.call(r,e,t))},UDe=function(r,e,t){return r.slice?r.slice(e,t):new Uint32Array(Array.prototype.slice.call(r,e,t))},NDe=function(r,e){var t=CDe(r),n=Array.isArray(t)?TDe(t):new Uint32Array(t),i=Array.isArray(t)?EDe(t):new Uint16Array(t),s=24,a=Lj(i,s/2,n[4]/2),o=n[5]===2?Lj(i,(s+n[4])/2):UDe(n,Math.ceil((s+n[4])/4));return new zDe(n[0],n[1],n[2],n[3],a,o)},zDe=function(){function r(e,t,n,i,s,a){this.initialValue=e,this.errorValue=t,this.highStart=n,this.highValueIndex=i,this.index=s,this.data=a}return r.prototype.get=function(e){var t;if(e>=0){if(e<55296||e>56319&&e<=65535)return t=this.index[e>>hm],t=(t<<KR)+(e&WR),this.data[t];if(e<=65535)return t=this.index[Rj+(e-55296>>hm)],t=(t<<KR)+(e&WR),this.data[t];if(e<this.highStart)return t=LDe-DDe+(e>>qR),t=this.index[t],t+=e>>hm&kDe,t=this.index[t],t=(t<<KR)+(e&WR),this.data[t];if(e<=1114111)return this.data[this.highValueIndex]}return this.errorValue},r}(),Dj="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",HDe=typeof Uint8Array>"u"?[]:new Uint8Array(256),sC=0;sC<Dj.length;sC++)HDe[Dj.charCodeAt(sC)]=sC;var VDe="KwAAAAAAAAAACA4AUD0AADAgAAACAAAAAAAIABAAGABAAEgAUABYAGAAaABgAGgAYgBqAF8AZwBgAGgAcQB5AHUAfQCFAI0AlQCdAKIAqgCyALoAYABoAGAAaABgAGgAwgDKAGAAaADGAM4A0wDbAOEA6QDxAPkAAQEJAQ8BFwF1AH0AHAEkASwBNAE6AUIBQQFJAVEBWQFhAWgBcAF4ATAAgAGGAY4BlQGXAZ8BpwGvAbUBvQHFAc0B0wHbAeMB6wHxAfkBAQIJAvEBEQIZAiECKQIxAjgCQAJGAk4CVgJeAmQCbAJ0AnwCgQKJApECmQKgAqgCsAK4ArwCxAIwAMwC0wLbAjAA4wLrAvMC+AIAAwcDDwMwABcDHQMlAy0DNQN1AD0DQQNJA0kDSQNRA1EDVwNZA1kDdQB1AGEDdQBpA20DdQN1AHsDdQCBA4kDkQN1AHUAmQOhA3UAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AKYDrgN1AHUAtgO+A8YDzgPWAxcD3gPjA+sD8wN1AHUA+wMDBAkEdQANBBUEHQQlBCoEFwMyBDgEYABABBcDSARQBFgEYARoBDAAcAQzAXgEgASIBJAEdQCXBHUAnwSnBK4EtgS6BMIEyAR1AHUAdQB1AHUAdQCVANAEYABgAGAAYABgAGAAYABgANgEYADcBOQEYADsBPQE/AQEBQwFFAUcBSQFLAU0BWQEPAVEBUsFUwVbBWAAYgVgAGoFcgV6BYIFigWRBWAAmQWfBaYFYABgAGAAYABgAKoFYACxBbAFuQW6BcEFwQXHBcEFwQXPBdMF2wXjBeoF8gX6BQIGCgYSBhoGIgYqBjIGOgZgAD4GRgZMBmAAUwZaBmAAYABgAGAAYABgAGAAYABgAGAAYABgAGIGYABpBnAGYABgAGAAYABgAGAAYABgAGAAYAB4Bn8GhQZgAGAAYAB1AHcDFQSLBmAAYABgAJMGdQA9A3UAmwajBqsGqwaVALMGuwbDBjAAywbSBtIG1QbSBtIG0gbSBtIG0gbdBuMG6wbzBvsGAwcLBxMHAwcbByMHJwcsBywHMQcsB9IGOAdAB0gHTgfSBkgHVgfSBtIG0gbSBtIG0gbSBtIG0gbSBiwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdgAGAALAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdbB2MHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB2kH0gZwB64EdQB1AHUAdQB1AHUAdQB1AHUHfQdgAIUHjQd1AHUAlQedB2AAYAClB6sHYACzB7YHvgfGB3UAzgfWBzMB3gfmB1EB7gf1B/0HlQENAQUIDQh1ABUIHQglCBcDLQg1CD0IRQhNCEEDUwh1AHUAdQBbCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIcAh3CHoIMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIgggwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAALAcsBywHLAcsBywHLAcsBywHLAcsB4oILAcsB44I0gaWCJ4Ipgh1AHUAqgiyCHUAdQB1AHUAdQB1AHUAdQB1AHUAtwh8AXUAvwh1AMUIyQjRCNkI4AjoCHUAdQB1AO4I9gj+CAYJDgkTCS0HGwkjCYIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiAAIAAAAFAAYABgAGIAXwBgAHEAdQBFAJUAogCyAKAAYABgAEIA4ABGANMA4QDxAMEBDwE1AFwBLAE6AQEBUQF4QkhCmEKoQrhCgAHIQsAB0MLAAcABwAHAAeDC6ABoAHDCwMMAAcABwAHAAdDDGMMAAcAB6MM4wwjDWMNow3jDaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAEjDqABWw6bDqABpg6gAaABoAHcDvwOPA+gAaABfA/8DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DpcPAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcAB9cPKwkyCToJMAB1AHUAdQBCCUoJTQl1AFUJXAljCWcJawkwADAAMAAwAHMJdQB2CX4JdQCECYoJjgmWCXUAngkwAGAAYABxAHUApgn3A64JtAl1ALkJdQDACTAAMAAwADAAdQB1AHUAdQB1AHUAdQB1AHUAowYNBMUIMAAwADAAMADICcsJ0wnZCRUE4QkwAOkJ8An4CTAAMAB1AAAKvwh1AAgKDwoXCh8KdQAwACcKLgp1ADYKqAmICT4KRgowADAAdQB1AE4KMAB1AFYKdQBeCnUAZQowADAAMAAwADAAMAAwADAAMAAVBHUAbQowADAAdQC5CXUKMAAwAHwBxAijBogEMgF9CoQKiASMCpQKmgqIBKIKqgquCogEDQG2Cr4KxgrLCjAAMADTCtsKCgHjCusK8Qr5CgELMAAwADAAMAB1AIsECQsRC3UANAEZCzAAMAAwADAAMAB1ACELKQswAHUANAExCzkLdQBBC0kLMABRC1kLMAAwADAAMAAwADAAdQBhCzAAMAAwAGAAYABpC3ELdwt/CzAAMACHC4sLkwubC58Lpwt1AK4Ltgt1APsDMAAwADAAMAAwADAAMAAwAL4LwwvLC9IL1wvdCzAAMADlC+kL8Qv5C/8LSQswADAAMAAwADAAMAAwADAAMAAHDDAAMAAwADAAMAAODBYMHgx1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1ACYMMAAwADAAdQB1AHUALgx1AHUAdQB1AHUAdQA2DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AD4MdQBGDHUAdQB1AHUAdQB1AEkMdQB1AHUAdQB1AFAMMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQBYDHUAdQB1AF8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUA+wMVBGcMMAAwAHwBbwx1AHcMfwyHDI8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAYABgAJcMMAAwADAAdQB1AJ8MlQClDDAAMACtDCwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB7UMLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AA0EMAC9DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAsBywHLAcsBywHLAcsBywHLQcwAMEMyAwsBywHLAcsBywHLAcsBywHLAcsBywHzAwwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1ANQM2QzhDDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMABgAGAAYABgAGAAYABgAOkMYADxDGAA+AwADQYNYABhCWAAYAAODTAAMAAwADAAFg1gAGAAHg37AzAAMAAwADAAYABgACYNYAAsDTQNPA1gAEMNPg1LDWAAYABgAGAAYABgAGAAYABgAGAAUg1aDYsGVglhDV0NcQBnDW0NdQ15DWAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAlQCBDZUAiA2PDZcNMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAnw2nDTAAMAAwADAAMAAwAHUArw23DTAAMAAwADAAMAAwADAAMAAwADAAMAB1AL8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQDHDTAAYABgAM8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA1w11ANwNMAAwAD0B5A0wADAAMAAwADAAMADsDfQN/A0EDgwOFA4wABsOMAAwADAAMAAwADAAMAAwANIG0gbSBtIG0gbSBtIG0gYjDigOwQUuDsEFMw7SBjoO0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGQg5KDlIOVg7SBtIGXg5lDm0OdQ7SBtIGfQ6EDooOjQ6UDtIGmg6hDtIG0gaoDqwO0ga0DrwO0gZgAGAAYADEDmAAYAAkBtIGzA5gANIOYADaDokO0gbSBt8O5w7SBu8O0gb1DvwO0gZgAGAAxA7SBtIG0gbSBtIGYABgAGAAYAAED2AAsAUMD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHJA8sBywHLAcsBywHLAccDywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywPLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAc0D9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHPA/SBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gYUD0QPlQCVAJUAMAAwADAAMACVAJUAlQCVAJUAlQCVAEwPMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA//8EAAQABAAEAAQABAAEAAQABAANAAMAAQABAAIABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQACgATABcAHgAbABoAHgAXABYAEgAeABsAGAAPABgAHABLAEsASwBLAEsASwBLAEsASwBLABgAGAAeAB4AHgATAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABYAGwASAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWAA0AEQAeAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAFAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJABYAGgAbABsAGwAeAB0AHQAeAE8AFwAeAA0AHgAeABoAGwBPAE8ADgBQAB0AHQAdAE8ATwAXAE8ATwBPABYAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAFAATwBAAE8ATwBPAEAATwBQAFAATwBQAB4AHgAeAB4AHgAeAB0AHQAdAB0AHgAdAB4ADgBQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgBQAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAkACQAJAAkACQAJAAkABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAFAAHgAeAB4AKwArAFAAUABQAFAAGABQACsAKwArACsAHgAeAFAAHgBQAFAAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUAAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAYAA0AKwArAB4AHgAbACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAB4ABAAEAB4ABAAEABMABAArACsAKwArACsAKwArACsAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAKwArACsAKwBWAFYAVgBWAB4AHgArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AGgAaABoAGAAYAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQAEwAEACsAEwATAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABLAEsASwBLAEsASwBLAEsASwBLABoAGQAZAB4AUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABMAUAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABABQAFAABAAEAB4ABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUAAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAFAABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQAUABQAB4AHgAYABMAUAArACsABAAbABsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAFAABAAEAAQABAAEAFAABAAEAAQAUAAEAAQABAAEAAQAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArACsAHgArAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAUAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEAA0ADQBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUAArACsAKwBQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABABQACsAKwArACsAKwArACsAKwAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUAAaABoAUABQAFAAUABQAEwAHgAbAFAAHgAEACsAKwAEAAQABAArAFAAUABQAFAAUABQACsAKwArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQACsAUABQACsAKwAEACsABAAEAAQABAAEACsAKwArACsABAAEACsAKwAEAAQABAArACsAKwAEACsAKwArACsAKwArACsAUABQAFAAUAArAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLAAQABABQAFAAUAAEAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAArACsAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AGwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAKwArACsAKwArAAQABAAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAAQAUAArAFAAUABQAFAAUABQACsAKwArAFAAUABQACsAUABQAFAAUAArACsAKwBQAFAAKwBQACsAUABQACsAKwArAFAAUAArACsAKwBQAFAAUAArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArAAQABAAEAAQABAArACsAKwAEAAQABAArAAQABAAEAAQAKwArAFAAKwArACsAKwArACsABAArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAHgAeAB4AHgAeAB4AGwAeACsAKwArACsAKwAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAUABQAFAAKwArACsAKwArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwAOAFAAUABQAFAAUABQAFAAHgBQAAQABAAEAA4AUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAKwArAAQAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAKwArACsAKwArACsAUAArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAFAABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQABABQAB4AKwArACsAKwBQAFAAUAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQABoAUABQAFAAUABQAFAAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQACsAUAArACsAUABQAFAAUABQAFAAUAArACsAKwAEACsAKwArACsABAAEAAQABAAEAAQAKwAEACsABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArAAQABAAeACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAXAAqACoAKgAqACoAKgAqACsAKwArACsAGwBcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAeAEsASwBLAEsASwBLAEsASwBLAEsADQANACsAKwArACsAKwBcAFwAKwBcACsAXABcAFwAXABcACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAXAArAFwAXABcAFwAXABcAFwAXABcAFwAKgBcAFwAKgAqACoAKgAqACoAKgAqACoAXAArACsAXABcAFwAXABcACsAXAArACoAKgAqACoAKgAqACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwBcAFwAXABcAFAADgAOAA4ADgAeAA4ADgAJAA4ADgANAAkAEwATABMAEwATAAkAHgATAB4AHgAeAAQABAAeAB4AHgAeAB4AHgBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQAFAADQAEAB4ABAAeAAQAFgARABYAEQAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAAQABAAEAAQADQAEAAQAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAA0ADQAeAB4AHgAeAB4AHgAEAB4AHgAeAB4AHgAeACsAHgAeAA4ADgANAA4AHgAeAB4AHgAeAAkACQArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgBcAEsASwBLAEsASwBLAEsASwBLAEsADQANAB4AHgAeAB4AXABcAFwAXABcAFwAKgAqACoAKgBcAFwAXABcACoAKgAqAFwAKgAqACoAXABcACoAKgAqACoAKgAqACoAXABcAFwAKgAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqAFwAKgBLAEsASwBLAEsASwBLAEsASwBLACoAKgAqACoAKgAqAFAAUABQAFAAUABQACsAUAArACsAKwArACsAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAKwBQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsABAAEAAQAHgANAB4AHgAeAB4AHgAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUAArACsADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWABEAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQANAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAANAA0AKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUAArAAQABAArACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqAA0ADQAVAFwADQAeAA0AGwBcACoAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwAeAB4AEwATAA0ADQAOAB4AEwATAB4ABAAEAAQACQArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAHgArACsAKwATABMASwBLAEsASwBLAEsASwBLAEsASwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAXABcAFwAXABcACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAXAArACsAKwAqACoAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsAHgAeAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKwAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKwArAAQASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACoAKgAqACoAKgAqACoAXAAqACoAKgAqACoAKgArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABABQAFAAUABQAFAAUABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwANAA0AHgANAA0ADQANAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwAeAB4AHgAeAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArAA0ADQANAA0ADQBLAEsASwBLAEsASwBLAEsASwBLACsAKwArAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUAAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAAQAUABQAFAAUABQAFAABABQAFAABAAEAAQAUAArACsAKwArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQACsAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAFAAUABQACsAHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQACsAKwAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQACsAHgAeAB4AHgAeAB4AHgAOAB4AKwANAA0ADQANAA0ADQANAAkADQANAA0ACAAEAAsABAAEAA0ACQANAA0ADAAdAB0AHgAXABcAFgAXABcAFwAWABcAHQAdAB4AHgAUABQAFAANAAEAAQAEAAQABAAEAAQACQAaABoAGgAaABoAGgAaABoAHgAXABcAHQAVABUAHgAeAB4AHgAeAB4AGAAWABEAFQAVABUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ADQAeAA0ADQANAA0AHgANAA0ADQAHAB4AHgAeAB4AKwAEAAQABAAEAAQABAAEAAQABAAEAFAAUAArACsATwBQAFAAUABQAFAAHgAeAB4AFgARAE8AUABPAE8ATwBPAFAAUABQAFAAUAAeAB4AHgAWABEAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArABsAGwAbABsAGwAbABsAGgAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGgAbABsAGwAbABoAGwAbABoAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAHgAeAFAAGgAeAB0AHgBQAB4AGgAeAB4AHgAeAB4AHgAeAB4AHgBPAB4AUAAbAB4AHgBQAFAAUABQAFAAHgAeAB4AHQAdAB4AUAAeAFAAHgBQAB4AUABPAFAAUAAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgBQAFAAUABQAE8ATwBQAFAAUABQAFAATwBQAFAATwBQAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAUABQAFAATwBPAE8ATwBPAE8ATwBPAE8ATwBQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABPAB4AHgArACsAKwArAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHQAdAB4AHgAeAB0AHQAeAB4AHQAeAB4AHgAdAB4AHQAbABsAHgAdAB4AHgAeAB4AHQAeAB4AHQAdAB0AHQAeAB4AHQAeAB0AHgAdAB0AHQAdAB0AHQAeAB0AHgAeAB4AHgAeAB0AHQAdAB0AHgAeAB4AHgAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHgAeAB0AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAeAB0AHQAdAB0AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAdAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAWABEAHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAWABEAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AHQAdAB0AHgAeAB0AHgAeAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlAB4AHQAdAB4AHgAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AJQAlAB0AHQAlAB4AJQAlACUAIAAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAdAB0AHQAeAB0AJQAdAB0AHgAdAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAdAB0AHQAdACUAHgAlACUAJQAdACUAJQAdAB0AHQAlACUAHQAdACUAHQAdACUAJQAlAB4AHQAeAB4AHgAeAB0AHQAlAB0AHQAdAB0AHQAdACUAJQAlACUAJQAdACUAJQAgACUAHQAdACUAJQAlACUAJQAlACUAJQAeAB4AHgAlACUAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AFwAXABcAFwAXABcAHgATABMAJQAeAB4AHgAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARABYAEQAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAEAAQABAAeAB4AKwArACsAKwArABMADQANAA0AUAATAA0AUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUAANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAA0ADQANAA0ADQANAA0ADQAeAA0AFgANAB4AHgAXABcAHgAeABcAFwAWABEAFgARABYAEQAWABEADQANAA0ADQATAFAADQANAB4ADQANAB4AHgAeAB4AHgAMAAwADQANAA0AHgANAA0AFgANAA0ADQANAA0ADQANAA0AHgANAB4ADQANAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArAA0AEQARACUAJQBHAFcAVwAWABEAFgARABYAEQAWABEAFgARACUAJQAWABEAFgARABYAEQAWABEAFQAWABEAEQAlAFcAVwBXAFcAVwBXAFcAVwBXAAQABAAEAAQABAAEACUAVwBXAFcAVwA2ACUAJQBXAFcAVwBHAEcAJQAlACUAKwBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBRAFcAUQBXAFEAVwBXAFcAVwBXAFcAUQBXAFcAVwBXAFcAVwBRAFEAKwArAAQABAAVABUARwBHAFcAFQBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBRAFcAVwBXAFcAVwBXAFEAUQBXAFcAVwBXABUAUQBHAEcAVwArACsAKwArACsAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwAlACUAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACsAKwArACsAKwArACsAKwArACsAKwArAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBPAE8ATwBPAE8ATwBPAE8AJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADQATAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABLAEsASwBLAEsASwBLAEsASwBLAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAABAAEAAQABAAeAAQABAAEAAQABAAEAAQABAAEAAQAHgBQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAeAA0ADQANAA0ADQArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAAQAUABQAFAABABQAFAAUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAeAB4AHgAeAAQAKwArACsAUABQAFAAUABQAFAAHgAeABoAHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADgAOABMAEwArACsAKwArACsAKwArACsABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwANAA0ASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUAAeAB4AHgBQAA4AUABQAAQAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArAB4AWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYACsAKwArAAQAHgAeAB4AHgAeAB4ADQANAA0AHgAeAB4AHgArAFAASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArAB4AHgBcAFwAXABcAFwAKgBcAFwAXABcAFwAXABcAFwAXABcAEsASwBLAEsASwBLAEsASwBLAEsAXABcAFwAXABcACsAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAFAAUABQAAQAUABQAFAAUABQAFAAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAHgANAA0ADQBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAXAAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAKgAqACoAXABcACoAKgBcAFwAXABcAFwAKgAqAFwAKgBcACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcACoAKgBQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAA0ADQBQAFAAUAAEAAQAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQADQAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAVABVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBUAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVACsAKwArACsAKwArACsAKwArACsAKwArAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAKwArACsAKwBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAKwArACsAKwAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAKwArACsAKwArAFYABABWAFYAVgBWAFYAVgBWAFYAVgBWAB4AVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgArAFYAVgBWAFYAVgArAFYAKwBWAFYAKwBWAFYAKwBWAFYAVgBWAFYAVgBWAFYAVgBWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAEQAWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAaAB4AKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAGAARABEAGAAYABMAEwAWABEAFAArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACUAJQAlACUAJQAWABEAFgARABYAEQAWABEAFgARABYAEQAlACUAFgARACUAJQAlACUAJQAlACUAEQAlABEAKwAVABUAEwATACUAFgARABYAEQAWABEAJQAlACUAJQAlACUAJQAlACsAJQAbABoAJQArACsAKwArAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAcAKwATACUAJQAbABoAJQAlABYAEQAlACUAEQAlABEAJQBXAFcAVwBXAFcAVwBXAFcAVwBXABUAFQAlACUAJQATACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXABYAJQARACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAWACUAEQAlABYAEQARABYAEQARABUAVwBRAFEAUQBRAFEAUQBRAFEAUQBRAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcARwArACsAVwBXAFcAVwBXAFcAKwArAFcAVwBXAFcAVwBXACsAKwBXAFcAVwBXAFcAVwArACsAVwBXAFcAKwArACsAGgAbACUAJQAlABsAGwArAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAAQAB0AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsADQANAA0AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAA0AUABQAFAAUAArACsAKwArAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwArAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwBQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAUABQAFAAUABQAAQABAAEACsABAAEACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAKwBQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAA0ADQANAA0ADQANAA0ADQAeACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAArACsAKwArAFAAUABQAFAAUAANAA0ADQANAA0ADQAUACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsADQANAA0ADQANAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArAAQABAANACsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAB4AHgAeAB4AHgArACsAKwArACsAKwAEAAQABAAEAAQABAAEAA0ADQAeAB4AHgAeAB4AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsASwBLAEsASwBLAEsASwBLAEsASwANAA0ADQANAFAABAAEAFAAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAeAA4AUAArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAADQANAB4ADQAEAAQABAAEAB4ABAAEAEsASwBLAEsASwBLAEsASwBLAEsAUAAOAFAADQANAA0AKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAANAA0AHgANAA0AHgAEACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAA0AKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsABAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsABAAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAUAArACsAKwArACsAKwAEACsAKwArACsAKwBQAFAAUABQAFAABAAEACsAKwAEAAQABAAEAAQABAAEACsAKwArAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAQABABQAFAAUABQAA0ADQANAA0AHgBLAEsASwBLAEsASwBLAEsASwBLAA0ADQArAB4ABABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUAAeAFAAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABAAEAAQADgANAA0AEwATAB4AHgAeAA0ADQANAA0ADQANAA0ADQANAA0ADQANAA0ADQANAFAAUABQAFAABAAEACsAKwAEAA0ADQAeAFAAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKwArACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBcAFwADQANAA0AKgBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAKwArAFAAKwArAFAAUABQAFAAUABQAFAAUAArAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQAKwAEAAQAKwArAAQABAAEAAQAUAAEAFAABAAEAA0ADQANACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABABQAA4AUAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAFAABAAEAAQABAAOAB4ADQANAA0ADQAOAB4ABAArACsAKwArACsAKwArACsAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAA0ADQANAFAADgAOAA4ADQANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAAQABAAEAFAADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAOABMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAArACsAKwAEACsABAAEACsABAAEAAQABAAEAAQABABQAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAaABoAGgAaAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABIAEgAQwBDAEMAUABQAFAAUABDAFAAUABQAEgAQwBIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABDAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAJAAkACQAJAAkACQAJABYAEQArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwANAA0AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAANACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAA0ADQANAB4AHgAeAB4AHgAeAFAAUABQAFAADQAeACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAA0AHgAeACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAARwBHABUARwAJACsAKwArACsAKwArACsAKwArACsAKwAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUQBRAFEAKwArACsAKwArACsAKwArACsAKwArACsAKwBRAFEAUQBRACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAHgAEAAQADQAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQABAAEAAQABAAeAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQAHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAKwArAFAAKwArAFAAUAArACsAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUAArAFAAUABQAFAAUABQAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAHgAeAFAAUABQAFAAUAArAFAAKwArACsAUABQAFAAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeACsAKwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4ABAAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAHgAeAA0ADQANAA0AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArAAQABAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwBQAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArABsAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAB4AHgAeAB4ABAAEAAQABAAEAAQABABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArABYAFgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAGgBQAFAAUAAaAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUAArACsAKwArACsAKwBQACsAKwArACsAUAArAFAAKwBQACsAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUAArAFAAKwBQACsAUAArAFAAUAArAFAAKwArAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAKwBQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8AJQAlACUAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB4AHgAeACUAJQAlAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAlACUAJQAlACUAHgAlACUAJQAlACUAIAAgACAAJQAlACAAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACEAIQAhACEAIQAlACUAIAAgACUAJQAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAIAAlACUAJQAlACAAIAAgACUAIAAgACAAJQAlACUAJQAlACUAJQAgACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAlAB4AJQAeACUAJQAlACUAJQAgACUAJQAlACUAHgAlAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACAAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABcAFwAXABUAFQAVAB4AHgAeAB4AJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAgACUAJQAgACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAIAAgACUAJQAgACAAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACAAIAAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACAAIAAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAA==",Oj=50,GDe=1,kj=2,Uj=3,QDe=4,$De=5,Nj=7,zj=8,Hj=9,Mp=10,XR=11,Vj=12,JR=13,jDe=14,Lb=15,ZR=16,oC=17,Db=18,qDe=19,Gj=20,YR=21,Ob=22,e5=23,V0=24,Oh=25,kb=26,Ub=27,G0=28,KDe=29,Q0=30,WDe=31,aC=32,lC=33,t5=34,r5=35,n5=36,Nb=37,i5=38,cC=39,uC=40,s5=41,Qj=42,XDe=43,JDe=[9001,65288],$j="!",Fu="",hC="",o5=NDe(VDe),EA=[Q0,n5],a5=[GDe,kj,Uj,$De],jj=[Mp,zj],qj=[Ub,kb],ZDe=a5.concat(jj),Kj=[i5,cC,uC,t5,r5],YDe=[Lb,JR],eOe=function(r,e){e===void 0&&(e="strict");var t=[],n=[],i=[];return r.forEach(function(s,a){var o=o5.get(s);if(o>Oj?(i.push(!0),o-=Oj):i.push(!1),["normal","auto","loose"].indexOf(e)!==-1&&[8208,8211,12316,12448].indexOf(s)!==-1)return n.push(a),t.push(ZR);if(o===QDe||o===XR){if(a===0)return n.push(a),t.push(Q0);var h=t[a-1];return ZDe.indexOf(h)===-1?(n.push(n[a-1]),t.push(h)):(n.push(a),t.push(Q0))}if(n.push(a),o===WDe)return t.push(e==="strict"?YR:Nb);if(o===Qj||o===KDe)return t.push(Q0);if(o===XDe)return s>=131072&&s<=196605||s>=196608&&s<=262141?t.push(Nb):t.push(Q0);t.push(o)}),[n,t,i]},l5=function(r,e,t,n){var i=n[t];if(Array.isArray(r)?r.indexOf(i)!==-1:r===i)for(var s=t;s<=n.length;){s++;var a=n[s];if(a===e)return!0;if(a!==Mp)break}if(i===Mp)for(var s=t;s>0;){s--;var o=n[s];if(Array.isArray(r)?r.indexOf(o)!==-1:r===o)for(var h=t;h<=n.length;){h++;var a=n[h];if(a===e)return!0;if(a!==Mp)break}if(o!==Mp)break}return!1},Wj=function(r,e){for(var t=r;t>=0;){var n=e[t];if(n===Mp)t--;else return n}return 0},tOe=function(r,e,t,n,i){if(t[n]===0)return Fu;var s=n-1;if(Array.isArray(i)&&i[s]===!0)return Fu;var a=s-1,o=s+1,h=e[s],f=a>=0?e[a]:0,_=e[o];if(h===kj&&_===Uj)return Fu;if(a5.indexOf(h)!==-1)return $j;if(a5.indexOf(_)!==-1||jj.indexOf(_)!==-1)return Fu;if(Wj(s,e)===zj)return hC;if(o5.get(r[s])===XR||(h===aC||h===lC)&&o5.get(r[o])===XR||h===Nj||_===Nj||h===Hj||[Mp,JR,Lb].indexOf(h)===-1&&_===Hj||[oC,Db,qDe,V0,G0].indexOf(_)!==-1||Wj(s,e)===Ob||l5(e5,Ob,s,e)||l5([oC,Db],YR,s,e)||l5(Vj,Vj,s,e))return Fu;if(h===Mp)return hC;if(h===e5||_===e5)return Fu;if(_===ZR||h===ZR)return hC;if([JR,Lb,YR].indexOf(_)!==-1||h===jDe||f===n5&&YDe.indexOf(h)!==-1||h===G0&&_===n5||_===Gj||EA.indexOf(_)!==-1&&h===Oh||EA.indexOf(h)!==-1&&_===Oh||h===Ub&&[Nb,aC,lC].indexOf(_)!==-1||[Nb,aC,lC].indexOf(h)!==-1&&_===kb||EA.indexOf(h)!==-1&&qj.indexOf(_)!==-1||qj.indexOf(h)!==-1&&EA.indexOf(_)!==-1||[Ub,kb].indexOf(h)!==-1&&(_===Oh||[Ob,Lb].indexOf(_)!==-1&&e[o+1]===Oh)||[Ob,Lb].indexOf(h)!==-1&&_===Oh||h===Oh&&[Oh,G0,V0].indexOf(_)!==-1)return Fu;if([Oh,G0,V0,oC,Db].indexOf(_)!==-1)for(var x=s;x>=0;){var T=e[x];if(T===Oh)return Fu;if([G0,V0].indexOf(T)!==-1)x--;else break}if([Ub,kb].indexOf(_)!==-1)for(var x=[oC,Db].indexOf(h)!==-1?a:s;x>=0;){var T=e[x];if(T===Oh)return Fu;if([G0,V0].indexOf(T)!==-1)x--;else break}if(i5===h&&[i5,cC,t5,r5].indexOf(_)!==-1||[cC,t5].indexOf(h)!==-1&&[cC,uC].indexOf(_)!==-1||[uC,r5].indexOf(h)!==-1&&_===uC||Kj.indexOf(h)!==-1&&[Gj,kb].indexOf(_)!==-1||Kj.indexOf(_)!==-1&&h===Ub||EA.indexOf(h)!==-1&&EA.indexOf(_)!==-1||h===V0&&EA.indexOf(_)!==-1||EA.concat(Oh).indexOf(h)!==-1&&_===Ob&&JDe.indexOf(r[o])===-1||EA.concat(Oh).indexOf(_)!==-1&&h===Db)return Fu;if(h===s5&&_===s5){for(var I=t[s],N=1;I>0&&(I--,e[I]===s5);)N++;if(N%2!==0)return Fu}return h===aC&&_===lC?Fu:hC},rOe=function(r,e){e||(e={lineBreak:"normal",wordBreak:"normal"});var t=eOe(r,e.lineBreak),n=t[0],i=t[1],s=t[2];(e.wordBreak==="break-all"||e.wordBreak==="break-word")&&(i=i.map(function(o){return[Oh,Q0,Qj].indexOf(o)!==-1?Nb:o}));var a=e.wordBreak==="keep-all"?s.map(function(o,h){return o&&r[h]>=19968&&r[h]<=40959}):void 0;return[n,i,a]},nOe=function(){function r(e,t,n,i){this.codePoints=e,this.required=t===$j,this.start=n,this.end=i}return r.prototype.slice=function(){return Na.apply(void 0,this.codePoints.slice(this.start,this.end))},r}(),iOe=function(r,e){var t=rC(r),n=rOe(t,e),i=n[0],s=n[1],a=n[2],o=t.length,h=0,f=0;return{next:function(){if(f>=o)return{done:!0,value:null};for(var _=Fu;f<o&&(_=tOe(t,s,i,++f,a))===Fu;);if(_!==Fu||f===o){var x=new nOe(t,_,h,f);return h=f,{value:x,done:!1}}return{done:!0,value:null}}}},sOe=1,oOe=2,zb=4,Xj=8,dC=10,Jj=47,Hb=92,aOe=9,lOe=32,fC=34,Vb=61,cOe=35,uOe=36,hOe=37,AC=39,pC=40,Gb=41,dOe=95,lh=45,fOe=33,AOe=60,pOe=62,gOe=64,mOe=91,_Oe=93,yOe=61,bOe=123,gC=63,vOe=125,Zj=124,xOe=126,wOe=128,Yj=65533,c5=42,dm=43,BOe=44,COe=58,EOe=59,Qb=46,TOe=0,SOe=8,IOe=11,MOe=14,POe=31,FOe=127,eA=-1,e7=48,t7=97,r7=101,ROe=102,LOe=117,DOe=122,n7=65,i7=69,s7=70,OOe=85,kOe=90,Ru=function(r){return r>=e7&&r<=57},UOe=function(r){return r>=55296&&r<=57343},$0=function(r){return Ru(r)||r>=n7&&r<=s7||r>=t7&&r<=ROe},NOe=function(r){return r>=t7&&r<=DOe},zOe=function(r){return r>=n7&&r<=kOe},HOe=function(r){return NOe(r)||zOe(r)},VOe=function(r){return r>=wOe},mC=function(r){return r===dC||r===aOe||r===lOe},_C=function(r){return HOe(r)||VOe(r)||r===dOe},o7=function(r){return _C(r)||Ru(r)||r===lh},GOe=function(r){return r>=TOe&&r<=SOe||r===IOe||r>=MOe&&r<=POe||r===FOe},Pp=function(r,e){return r!==Hb?!1:e!==dC},yC=function(r,e,t){return r===lh?_C(e)||Pp(e,t):_C(r)?!0:!!(r===Hb&&Pp(r,e))},u5=function(r,e,t){return r===dm||r===lh?Ru(e)?!0:e===Qb&&Ru(t):Ru(r===Qb?e:r)},QOe=function(r){var e=0,t=1;(r[e]===dm||r[e]===lh)&&(r[e]===lh&&(t=-1),e++);for(var n=[];Ru(r[e]);)n.push(r[e++]);var i=n.length?parseInt(Na.apply(void 0,n),10):0;r[e]===Qb&&e++;for(var s=[];Ru(r[e]);)s.push(r[e++]);var a=s.length,o=a?parseInt(Na.apply(void 0,s),10):0;(r[e]===i7||r[e]===r7)&&e++;var h=1;(r[e]===dm||r[e]===lh)&&(r[e]===lh&&(h=-1),e++);for(var f=[];Ru(r[e]);)f.push(r[e++]);var _=f.length?parseInt(Na.apply(void 0,f),10):0;return t*(i+o*Math.pow(10,-a))*Math.pow(10,h*_)},$Oe={type:2},jOe={type:3},qOe={type:4},KOe={type:13},WOe={type:8},XOe={type:21},JOe={type:9},ZOe={type:10},YOe={type:11},eke={type:12},tke={type:14},bC={type:23},rke={type:1},nke={type:25},ike={type:24},ske={type:26},oke={type:27},ake={type:28},lke={type:29},cke={type:31},h5={type:32},a7=function(){function r(){this._value=[]}return r.prototype.write=function(e){this._value=this._value.concat(rC(e))},r.prototype.read=function(){for(var e=[],t=this.consumeToken();t!==h5;)e.push(t),t=this.consumeToken();return e},r.prototype.consumeToken=function(){var e=this.consumeCodePoint();switch(e){case fC:return this.consumeStringToken(fC);case cOe:var t=this.peekCodePoint(0),n=this.peekCodePoint(1),i=this.peekCodePoint(2);if(o7(t)||Pp(n,i)){var s=yC(t,n,i)?oOe:sOe,a=this.consumeName();return{type:5,value:a,flags:s}}break;case uOe:if(this.peekCodePoint(0)===Vb)return this.consumeCodePoint(),KOe;break;case AC:return this.consumeStringToken(AC);case pC:return $Oe;case Gb:return jOe;case c5:if(this.peekCodePoint(0)===Vb)return this.consumeCodePoint(),tke;break;case dm:if(u5(e,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(e),this.consumeNumericToken();break;case BOe:return qOe;case lh:var o=e,h=this.peekCodePoint(0),f=this.peekCodePoint(1);if(u5(o,h,f))return this.reconsumeCodePoint(e),this.consumeNumericToken();if(yC(o,h,f))return this.reconsumeCodePoint(e),this.consumeIdentLikeToken();if(h===lh&&f===pOe)return this.consumeCodePoint(),this.consumeCodePoint(),ike;break;case Qb:if(u5(e,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(e),this.consumeNumericToken();break;case Jj:if(this.peekCodePoint(0)===c5)for(this.consumeCodePoint();;){var _=this.consumeCodePoint();if(_===c5&&(_=this.consumeCodePoint(),_===Jj))return this.consumeToken();if(_===eA)return this.consumeToken()}break;case COe:return ske;case EOe:return oke;case AOe:if(this.peekCodePoint(0)===fOe&&this.peekCodePoint(1)===lh&&this.peekCodePoint(2)===lh)return this.consumeCodePoint(),this.consumeCodePoint(),nke;break;case gOe:var x=this.peekCodePoint(0),T=this.peekCodePoint(1),I=this.peekCodePoint(2);if(yC(x,T,I)){var a=this.consumeName();return{type:7,value:a}}break;case mOe:return ake;case Hb:if(Pp(e,this.peekCodePoint(0)))return this.reconsumeCodePoint(e),this.consumeIdentLikeToken();break;case _Oe:return lke;case yOe:if(this.peekCodePoint(0)===Vb)return this.consumeCodePoint(),WOe;break;case bOe:return YOe;case vOe:return eke;case LOe:case OOe:var N=this.peekCodePoint(0),$=this.peekCodePoint(1);return N===dm&&($0($)||$===gC)&&(this.consumeCodePoint(),this.consumeUnicodeRangeToken()),this.reconsumeCodePoint(e),this.consumeIdentLikeToken();case Zj:if(this.peekCodePoint(0)===Vb)return this.consumeCodePoint(),JOe;if(this.peekCodePoint(0)===Zj)return this.consumeCodePoint(),XOe;break;case xOe:if(this.peekCodePoint(0)===Vb)return this.consumeCodePoint(),ZOe;break;case eA:return h5}return mC(e)?(this.consumeWhiteSpace(),cke):Ru(e)?(this.reconsumeCodePoint(e),this.consumeNumericToken()):_C(e)?(this.reconsumeCodePoint(e),this.consumeIdentLikeToken()):{type:6,value:Na(e)}},r.prototype.consumeCodePoint=function(){var e=this._value.shift();return typeof e>"u"?-1:e},r.prototype.reconsumeCodePoint=function(e){this._value.unshift(e)},r.prototype.peekCodePoint=function(e){return e>=this._value.length?-1:this._value[e]},r.prototype.consumeUnicodeRangeToken=function(){for(var e=[],t=this.consumeCodePoint();$0(t)&&e.length<6;)e.push(t),t=this.consumeCodePoint();for(var n=!1;t===gC&&e.length<6;)e.push(t),t=this.consumeCodePoint(),n=!0;if(n){var i=parseInt(Na.apply(void 0,e.map(function(h){return h===gC?e7:h})),16),s=parseInt(Na.apply(void 0,e.map(function(h){return h===gC?s7:h})),16);return{type:30,start:i,end:s}}var a=parseInt(Na.apply(void 0,e),16);if(this.peekCodePoint(0)===lh&&$0(this.peekCodePoint(1))){this.consumeCodePoint(),t=this.consumeCodePoint();for(var o=[];$0(t)&&o.length<6;)o.push(t),t=this.consumeCodePoint();var s=parseInt(Na.apply(void 0,o),16);return{type:30,start:a,end:s}}else return{type:30,start:a,end:a}},r.prototype.consumeIdentLikeToken=function(){var e=this.consumeName();return e.toLowerCase()==="url"&&this.peekCodePoint(0)===pC?(this.consumeCodePoint(),this.consumeUrlToken()):this.peekCodePoint(0)===pC?(this.consumeCodePoint(),{type:19,value:e}):{type:20,value:e}},r.prototype.consumeUrlToken=function(){var e=[];if(this.consumeWhiteSpace(),this.peekCodePoint(0)===eA)return{type:22,value:""};var t=this.peekCodePoint(0);if(t===AC||t===fC){var n=this.consumeStringToken(this.consumeCodePoint());return n.type===0&&(this.consumeWhiteSpace(),this.peekCodePoint(0)===eA||this.peekCodePoint(0)===Gb)?(this.consumeCodePoint(),{type:22,value:n.value}):(this.consumeBadUrlRemnants(),bC)}for(;;){var i=this.consumeCodePoint();if(i===eA||i===Gb)return{type:22,value:Na.apply(void 0,e)};if(mC(i))return this.consumeWhiteSpace(),this.peekCodePoint(0)===eA||this.peekCodePoint(0)===Gb?(this.consumeCodePoint(),{type:22,value:Na.apply(void 0,e)}):(this.consumeBadUrlRemnants(),bC);if(i===fC||i===AC||i===pC||GOe(i))return this.consumeBadUrlRemnants(),bC;if(i===Hb)if(Pp(i,this.peekCodePoint(0)))e.push(this.consumeEscapedCodePoint());else return this.consumeBadUrlRemnants(),bC;else e.push(i)}},r.prototype.consumeWhiteSpace=function(){for(;mC(this.peekCodePoint(0));)this.consumeCodePoint()},r.prototype.consumeBadUrlRemnants=function(){for(;;){var e=this.consumeCodePoint();if(e===Gb||e===eA)return;Pp(e,this.peekCodePoint(0))&&this.consumeEscapedCodePoint()}},r.prototype.consumeStringSlice=function(e){for(var t=5e4,n="";e>0;){var i=Math.min(t,e);n+=Na.apply(void 0,this._value.splice(0,i)),e-=i}return this._value.shift(),n},r.prototype.consumeStringToken=function(e){var t="",n=0;do{var i=this._value[n];if(i===eA||i===void 0||i===e)return t+=this.consumeStringSlice(n),{type:0,value:t};if(i===dC)return this._value.splice(0,n),rke;if(i===Hb){var s=this._value[n+1];s!==eA&&s!==void 0&&(s===dC?(t+=this.consumeStringSlice(n),n=-1,this._value.shift()):Pp(i,s)&&(t+=this.consumeStringSlice(n),t+=Na(this.consumeEscapedCodePoint()),n=-1))}n++}while(!0)},r.prototype.consumeNumber=function(){var e=[],t=zb,n=this.peekCodePoint(0);for((n===dm||n===lh)&&e.push(this.consumeCodePoint());Ru(this.peekCodePoint(0));)e.push(this.consumeCodePoint());n=this.peekCodePoint(0);var i=this.peekCodePoint(1);if(n===Qb&&Ru(i))for(e.push(this.consumeCodePoint(),this.consumeCodePoint()),t=Xj;Ru(this.peekCodePoint(0));)e.push(this.consumeCodePoint());n=this.peekCodePoint(0),i=this.peekCodePoint(1);var s=this.peekCodePoint(2);if((n===i7||n===r7)&&((i===dm||i===lh)&&Ru(s)||Ru(i)))for(e.push(this.consumeCodePoint(),this.consumeCodePoint()),t=Xj;Ru(this.peekCodePoint(0));)e.push(this.consumeCodePoint());return[QOe(e),t]},r.prototype.consumeNumericToken=function(){var e=this.consumeNumber(),t=e[0],n=e[1],i=this.peekCodePoint(0),s=this.peekCodePoint(1),a=this.peekCodePoint(2);if(yC(i,s,a)){var o=this.consumeName();return{type:15,number:t,flags:n,unit:o}}return i===hOe?(this.consumeCodePoint(),{type:16,number:t,flags:n}):{type:17,number:t,flags:n}},r.prototype.consumeEscapedCodePoint=function(){var e=this.consumeCodePoint();if($0(e)){for(var t=Na(e);$0(this.peekCodePoint(0))&&t.length<6;)t+=Na(this.consumeCodePoint());mC(this.peekCodePoint(0))&&this.consumeCodePoint();var n=parseInt(t,16);return n===0||UOe(n)||n>1114111?Yj:n}return e===eA?Yj:e},r.prototype.consumeName=function(){for(var e="";;){var t=this.consumeCodePoint();if(o7(t))e+=Na(t);else if(Pp(t,this.peekCodePoint(0)))e+=Na(this.consumeEscapedCodePoint());else return this.reconsumeCodePoint(t),e}},r}(),l7=function(){function r(e){this._tokens=e}return r.create=function(e){var t=new a7;return t.write(e),new r(t.read())},r.parseValue=function(e){return r.create(e).parseComponentValue()},r.parseValues=function(e){return r.create(e).parseComponentValues()},r.prototype.parseComponentValue=function(){for(var e=this.consumeToken();e.type===31;)e=this.consumeToken();if(e.type===32)throw new SyntaxError("Error parsing CSS component value, unexpected EOF");this.reconsumeToken(e);var t=this.consumeComponentValue();do e=this.consumeToken();while(e.type===31);if(e.type===32)return t;throw new SyntaxError("Error parsing CSS component value, multiple values found when expecting only one")},r.prototype.parseComponentValues=function(){for(var e=[];;){var t=this.consumeComponentValue();if(t.type===32)return e;e.push(t),e.push()}},r.prototype.consumeComponentValue=function(){var e=this.consumeToken();switch(e.type){case 11:case 28:case 2:return this.consumeSimpleBlock(e.type);case 19:return this.consumeFunction(e)}return e},r.prototype.consumeSimpleBlock=function(e){for(var t={type:e,values:[]},n=this.consumeToken();;){if(n.type===32||hke(n,e))return t;this.reconsumeToken(n),t.values.push(this.consumeComponentValue()),n=this.consumeToken()}},r.prototype.consumeFunction=function(e){for(var t={name:e.value,values:[],type:18};;){var n=this.consumeToken();if(n.type===32||n.type===3)return t;this.reconsumeToken(n),t.values.push(this.consumeComponentValue())}},r.prototype.consumeToken=function(){var e=this._tokens.shift();return typeof e>"u"?h5:e},r.prototype.reconsumeToken=function(e){this._tokens.unshift(e)},r}(),$b=function(r){return r.type===15},j0=function(r){return r.type===17},ao=function(r){return r.type===20},uke=function(r){return r.type===0},d5=function(r,e){return ao(r)&&r.value===e},c7=function(r){return r.type!==31},q0=function(r){return r.type!==31&&r.type!==4},tA=function(r){var e=[],t=[];return r.forEach(function(n){if(n.type===4){if(t.length===0)throw new Error("Error parsing function args, zero tokens for arg");e.push(t),t=[];return}n.type!==31&&t.push(n)}),t.length&&e.push(t),e},hke=function(r,e){return e===11&&r.type===12||e===28&&r.type===29?!0:e===2&&r.type===3},Fp=function(r){return r.type===17||r.type===15},dl=function(r){return r.type===16||Fp(r)},u7=function(r){return r.length>1?[r[0],r[1]]:[r[0]]},Cc={type:17,number:0,flags:zb},f5={type:16,number:50,flags:zb},Rp={type:16,number:100,flags:zb},jb=function(r,e,t){var n=r[0],i=r[1];return[yo(n,e),yo(typeof i<"u"?i:n,t)]},yo=function(r,e){if(r.type===16)return r.number/100*e;if($b(r))switch(r.unit){case"rem":case"em":return 16*r.number;case"px":default:return r.number}return r.number},h7="deg",d7="grad",f7="rad",A7="turn",vC={name:"angle",parse:function(r,e){if(e.type===15)switch(e.unit){case h7:return Math.PI*e.number/180;case d7:return Math.PI/200*e.number;case f7:return e.number;case A7:return Math.PI*2*e.number}throw new Error("Unsupported angle type")}},p7=function(r){return r.type===15&&(r.unit===h7||r.unit===d7||r.unit===f7||r.unit===A7)},g7=function(r){var e=r.filter(ao).map(function(t){return t.value}).join(" ");switch(e){case"to bottom right":case"to right bottom":case"left top":case"top left":return[Cc,Cc];case"to top":case"bottom":return gd(0);case"to bottom left":case"to left bottom":case"right top":case"top right":return[Cc,Rp];case"to right":case"left":return gd(90);case"to top left":case"to left top":case"right bottom":case"bottom right":return[Rp,Rp];case"to bottom":case"top":return gd(180);case"to top right":case"to right top":case"left bottom":case"bottom left":return[Rp,Cc];case"to left":case"right":return gd(270)}return 0},gd=function(r){return Math.PI*r/180},Lp={name:"color",parse:function(r,e){if(e.type===18){var t=dke[e.name];if(typeof t>"u")throw new Error('Attempting to parse an unsupported color function "'+e.name+'"');return t(r,e.values)}if(e.type===5){if(e.value.length===3){var n=e.value.substring(0,1),i=e.value.substring(1,2),s=e.value.substring(2,3);return Op(parseInt(n+n,16),parseInt(i+i,16),parseInt(s+s,16),1)}if(e.value.length===4){var n=e.value.substring(0,1),i=e.value.substring(1,2),s=e.value.substring(2,3),a=e.value.substring(3,4);return Op(parseInt(n+n,16),parseInt(i+i,16),parseInt(s+s,16),parseInt(a+a,16)/255)}if(e.value.length===6){var n=e.value.substring(0,2),i=e.value.substring(2,4),s=e.value.substring(4,6);return Op(parseInt(n,16),parseInt(i,16),parseInt(s,16),1)}if(e.value.length===8){var n=e.value.substring(0,2),i=e.value.substring(2,4),s=e.value.substring(4,6),a=e.value.substring(6,8);return Op(parseInt(n,16),parseInt(i,16),parseInt(s,16),parseInt(a,16)/255)}}if(e.type===20){var o=TA[e.value.toUpperCase()];if(typeof o<"u")return o}return TA.TRANSPARENT}},Dp=function(r){return(255&r)===0},ic=function(r){var e=255&r,t=255&r>>8,n=255&r>>16,i=255&r>>24;return e<255?"rgba("+i+","+n+","+t+","+e/255+")":"rgb("+i+","+n+","+t+")"},Op=function(r,e,t,n){return(r<<24|e<<16|t<<8|Math.round(n*255)<<0)>>>0},m7=function(r,e){if(r.type===17)return r.number;if(r.type===16){var t=e===3?1:255;return e===3?r.number/100*t:Math.round(r.number/100*t)}return 0},_7=function(r,e){var t=e.filter(q0);if(t.length===3){var n=t.map(m7),i=n[0],s=n[1],a=n[2];return Op(i,s,a,1)}if(t.length===4){var o=t.map(m7),i=o[0],s=o[1],a=o[2],h=o[3];return Op(i,s,a,h)}return 0};function A5(r,e,t){return t<0&&(t+=1),t>=1&&(t-=1),t<1/6?(e-r)*t*6+r:t<1/2?e:t<2/3?(e-r)*6*(2/3-t)+r:r}var y7=function(r,e){var t=e.filter(q0),n=t[0],i=t[1],s=t[2],a=t[3],o=(n.type===17?gd(n.number):vC.parse(r,n))/(Math.PI*2),h=dl(i)?i.number/100:0,f=dl(s)?s.number/100:0,_=typeof a<"u"&&dl(a)?yo(a,1):1;if(h===0)return Op(f*255,f*255,f*255,1);var x=f<=.5?f*(h+1):f+h-f*h,T=f*2-x,I=A5(T,x,o+1/3),N=A5(T,x,o),$=A5(T,x,o-1/3);return Op(I*255,N*255,$*255,_)},dke={hsl:y7,hsla:y7,rgb:_7,rgba:_7},qb=function(r,e){return Lp.parse(r,l7.create(e).parseComponentValue())},TA={ALICEBLUE:4042850303,ANTIQUEWHITE:4209760255,AQUA:16777215,AQUAMARINE:2147472639,AZURE:4043309055,BEIGE:4126530815,BISQUE:4293182719,BLACK:255,BLANCHEDALMOND:4293643775,BLUE:65535,BLUEVIOLET:2318131967,BROWN:2771004159,BURLYWOOD:3736635391,CADETBLUE:1604231423,CHARTREUSE:2147418367,CHOCOLATE:3530104575,CORAL:4286533887,CORNFLOWERBLUE:1687547391,CORNSILK:4294499583,CRIMSON:3692313855,CYAN:16777215,DARKBLUE:35839,DARKCYAN:9145343,DARKGOLDENROD:3095837695,DARKGRAY:2846468607,DARKGREEN:6553855,DARKGREY:2846468607,DARKKHAKI:3182914559,DARKMAGENTA:2332068863,DARKOLIVEGREEN:1433087999,DARKORANGE:4287365375,DARKORCHID:2570243327,DARKRED:2332033279,DARKSALMON:3918953215,DARKSEAGREEN:2411499519,DARKSLATEBLUE:1211993087,DARKSLATEGRAY:793726975,DARKSLATEGREY:793726975,DARKTURQUOISE:13554175,DARKVIOLET:2483082239,DEEPPINK:4279538687,DEEPSKYBLUE:12582911,DIMGRAY:1768516095,DIMGREY:1768516095,DODGERBLUE:512819199,FIREBRICK:2988581631,FLORALWHITE:4294635775,FORESTGREEN:579543807,FUCHSIA:4278255615,GAINSBORO:3705462015,GHOSTWHITE:4177068031,GOLD:4292280575,GOLDENROD:3668254975,GRAY:2155905279,GREEN:8388863,GREENYELLOW:2919182335,GREY:2155905279,HONEYDEW:4043305215,HOTPINK:4285117695,INDIANRED:3445382399,INDIGO:1258324735,IVORY:4294963455,KHAKI:4041641215,LAVENDER:3873897215,LAVENDERBLUSH:4293981695,LAWNGREEN:2096890111,LEMONCHIFFON:4294626815,LIGHTBLUE:2916673279,LIGHTCORAL:4034953471,LIGHTCYAN:3774873599,LIGHTGOLDENRODYELLOW:4210742015,LIGHTGRAY:3553874943,LIGHTGREEN:2431553791,LIGHTGREY:3553874943,LIGHTPINK:4290167295,LIGHTSALMON:4288707327,LIGHTSEAGREEN:548580095,LIGHTSKYBLUE:2278488831,LIGHTSLATEGRAY:2005441023,LIGHTSLATEGREY:2005441023,LIGHTSTEELBLUE:2965692159,LIGHTYELLOW:4294959359,LIME:16711935,LIMEGREEN:852308735,LINEN:4210091775,MAGENTA:4278255615,MAROON:2147483903,MEDIUMAQUAMARINE:1724754687,MEDIUMBLUE:52735,MEDIUMORCHID:3126187007,MEDIUMPURPLE:2473647103,MEDIUMSEAGREEN:1018393087,MEDIUMSLATEBLUE:2070474495,MEDIUMSPRINGGREEN:16423679,MEDIUMTURQUOISE:1221709055,MEDIUMVIOLETRED:3340076543,MIDNIGHTBLUE:421097727,MINTCREAM:4127193855,MISTYROSE:4293190143,MOCCASIN:4293178879,NAVAJOWHITE:4292783615,NAVY:33023,OLDLACE:4260751103,OLIVE:2155872511,OLIVEDRAB:1804477439,ORANGE:4289003775,ORANGERED:4282712319,ORCHID:3664828159,PALEGOLDENROD:4008225535,PALEGREEN:2566625535,PALETURQUOISE:2951671551,PALEVIOLETRED:3681588223,PAPAYAWHIP:4293907967,PEACHPUFF:4292524543,PERU:3448061951,PINK:4290825215,PLUM:3718307327,POWDERBLUE:2967529215,PURPLE:2147516671,REBECCAPURPLE:1714657791,RED:4278190335,ROSYBROWN:3163525119,ROYALBLUE:1097458175,SADDLEBROWN:2336560127,SALMON:4202722047,SANDYBROWN:4104413439,SEAGREEN:780883967,SEASHELL:4294307583,SIENNA:2689740287,SILVER:3233857791,SKYBLUE:2278484991,SLATEBLUE:1784335871,SLATEGRAY:1887473919,SLATEGREY:1887473919,SNOW:4294638335,SPRINGGREEN:16744447,STEELBLUE:1182971135,TAN:3535047935,TEAL:8421631,THISTLE:3636451583,TOMATO:4284696575,TRANSPARENT:0,TURQUOISE:1088475391,VIOLET:4001558271,WHEAT:4125012991,WHITE:4294967295,WHITESMOKE:4126537215,YELLOW:4294902015,YELLOWGREEN:2597139199},fke={name:"background-clip",initialValue:"border-box",prefix:!1,type:1,parse:function(r,e){return e.map(function(t){if(ao(t))switch(t.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},Ake={name:"background-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},xC=function(r,e){var t=Lp.parse(r,e[0]),n=e[1];return n&&dl(n)?{color:t,stop:n}:{color:t,stop:null}},b7=function(r,e){var t=r[0],n=r[r.length-1];t.stop===null&&(t.stop=Cc),n.stop===null&&(n.stop=Rp);for(var i=[],s=0,a=0;a<r.length;a++){var o=r[a].stop;if(o!==null){var h=yo(o,e);h>s?i.push(h):i.push(s),s=h}else i.push(null)}for(var f=null,a=0;a<i.length;a++){var _=i[a];if(_===null)f===null&&(f=a);else if(f!==null){for(var x=a-f,T=i[f-1],I=(_-T)/(x+1),N=1;N<=x;N++)i[f+N-1]=I*N;f=null}}return r.map(function($,W){var Y=$.color;return{color:Y,stop:Math.max(Math.min(1,i[W]/e),0)}})},pke=function(r,e,t){var n=e/2,i=t/2,s=yo(r[0],e)-n,a=i-yo(r[1],t);return(Math.atan2(a,s)+Math.PI*2)%(Math.PI*2)},gke=function(r,e,t){var n=typeof r=="number"?r:pke(r,e,t),i=Math.abs(e*Math.sin(n))+Math.abs(t*Math.cos(n)),s=e/2,a=t/2,o=i/2,h=Math.sin(n-Math.PI/2)*o,f=Math.cos(n-Math.PI/2)*o;return[i,s-f,s+f,a-h,a+h]},cf=function(r,e){return Math.sqrt(r*r+e*e)},v7=function(r,e,t,n,i){var s=[[0,0],[0,e],[r,0],[r,e]];return s.reduce(function(a,o){var h=o[0],f=o[1],_=cf(t-h,n-f);return(i?_<a.optimumDistance:_>a.optimumDistance)?{optimumCorner:o,optimumDistance:_}:a},{optimumDistance:i?1/0:-1/0,optimumCorner:null}).optimumCorner},mke=function(r,e,t,n,i){var s=0,a=0;switch(r.size){case 0:r.shape===0?s=a=Math.min(Math.abs(e),Math.abs(e-n),Math.abs(t),Math.abs(t-i)):r.shape===1&&(s=Math.min(Math.abs(e),Math.abs(e-n)),a=Math.min(Math.abs(t),Math.abs(t-i)));break;case 2:if(r.shape===0)s=a=Math.min(cf(e,t),cf(e,t-i),cf(e-n,t),cf(e-n,t-i));else if(r.shape===1){var o=Math.min(Math.abs(t),Math.abs(t-i))/Math.min(Math.abs(e),Math.abs(e-n)),h=v7(n,i,e,t,!0),f=h[0],_=h[1];s=cf(f-e,(_-t)/o),a=o*s}break;case 1:r.shape===0?s=a=Math.max(Math.abs(e),Math.abs(e-n),Math.abs(t),Math.abs(t-i)):r.shape===1&&(s=Math.max(Math.abs(e),Math.abs(e-n)),a=Math.max(Math.abs(t),Math.abs(t-i)));break;case 3:if(r.shape===0)s=a=Math.max(cf(e,t),cf(e,t-i),cf(e-n,t),cf(e-n,t-i));else if(r.shape===1){var o=Math.max(Math.abs(t),Math.abs(t-i))/Math.max(Math.abs(e),Math.abs(e-n)),x=v7(n,i,e,t,!1),f=x[0],_=x[1];s=cf(f-e,(_-t)/o),a=o*s}break}return Array.isArray(r.size)&&(s=yo(r.size[0],n),a=r.size.length===2?yo(r.size[1],i):s),[s,a]},_ke=function(r,e){var t=gd(180),n=[];return tA(e).forEach(function(i,s){if(s===0){var a=i[0];if(a.type===20&&a.value==="to"){t=g7(i);return}else if(p7(a)){t=vC.parse(r,a);return}}var o=xC(r,i);n.push(o)}),{angle:t,stops:n,type:1}},wC=function(r,e){var t=gd(180),n=[];return tA(e).forEach(function(i,s){if(s===0){var a=i[0];if(a.type===20&&["top","left","right","bottom"].indexOf(a.value)!==-1){t=g7(i);return}else if(p7(a)){t=(vC.parse(r,a)+gd(270))%gd(360);return}}var o=xC(r,i);n.push(o)}),{angle:t,stops:n,type:1}},yke=function(r,e){var t=gd(180),n=[],i=1,s=0,a=3,o=[];return tA(e).forEach(function(h,f){var _=h[0];if(f===0){if(ao(_)&&_.value==="linear"){i=1;return}else if(ao(_)&&_.value==="radial"){i=2;return}}if(_.type===18){if(_.name==="from"){var x=Lp.parse(r,_.values[0]);n.push({stop:Cc,color:x})}else if(_.name==="to"){var x=Lp.parse(r,_.values[0]);n.push({stop:Rp,color:x})}else if(_.name==="color-stop"){var T=_.values.filter(q0);if(T.length===2){var x=Lp.parse(r,T[1]),I=T[0];j0(I)&&n.push({stop:{type:16,number:I.number*100,flags:I.flags},color:x})}}}}),i===1?{angle:(t+gd(180))%gd(360),stops:n,type:i}:{size:a,shape:s,stops:n,position:o,type:i}},x7="closest-side",w7="farthest-side",B7="closest-corner",C7="farthest-corner",E7="circle",T7="ellipse",S7="cover",I7="contain",bke=function(r,e){var t=0,n=3,i=[],s=[];return tA(e).forEach(function(a,o){var h=!0;if(o===0){var f=!1;h=a.reduce(function(x,T){if(f)if(ao(T))switch(T.value){case"center":return s.push(f5),x;case"top":case"left":return s.push(Cc),x;case"right":case"bottom":return s.push(Rp),x}else(dl(T)||Fp(T))&&s.push(T);else if(ao(T))switch(T.value){case E7:return t=0,!1;case T7:return t=1,!1;case"at":return f=!0,!1;case x7:return n=0,!1;case S7:case w7:return n=1,!1;case I7:case B7:return n=2,!1;case C7:return n=3,!1}else if(Fp(T)||dl(T))return Array.isArray(n)||(n=[]),n.push(T),!1;return x},h)}if(h){var _=xC(r,a);i.push(_)}}),{size:n,shape:t,stops:i,position:s,type:2}},BC=function(r,e){var t=0,n=3,i=[],s=[];return tA(e).forEach(function(a,o){var h=!0;if(o===0?h=a.reduce(function(_,x){if(ao(x))switch(x.value){case"center":return s.push(f5),!1;case"top":case"left":return s.push(Cc),!1;case"right":case"bottom":return s.push(Rp),!1}else if(dl(x)||Fp(x))return s.push(x),!1;return _},h):o===1&&(h=a.reduce(function(_,x){if(ao(x))switch(x.value){case E7:return t=0,!1;case T7:return t=1,!1;case I7:case x7:return n=0,!1;case w7:return n=1,!1;case B7:return n=2,!1;case S7:case C7:return n=3,!1}else if(Fp(x)||dl(x))return Array.isArray(n)||(n=[]),n.push(x),!1;return _},h)),h){var f=xC(r,a);i.push(f)}}),{size:n,shape:t,stops:i,position:s,type:2}},vke=function(r){return r.type===1},xke=function(r){return r.type===2},p5={name:"image",parse:function(r,e){if(e.type===22){var t={url:e.value,type:0};return r.cache.addImage(e.value),t}if(e.type===18){var n=M7[e.name];if(typeof n>"u")throw new Error('Attempting to parse an unsupported image function "'+e.name+'"');return n(r,e.values)}throw new Error("Unsupported image type "+e.type)}};function wke(r){return!(r.type===20&&r.value==="none")&&(r.type!==18||!!M7[r.name])}var M7={"linear-gradient":_ke,"-moz-linear-gradient":wC,"-ms-linear-gradient":wC,"-o-linear-gradient":wC,"-webkit-linear-gradient":wC,"radial-gradient":bke,"-moz-radial-gradient":BC,"-ms-radial-gradient":BC,"-o-radial-gradient":BC,"-webkit-radial-gradient":BC,"-webkit-gradient":yke},Bke={name:"background-image",initialValue:"none",type:1,prefix:!1,parse:function(r,e){if(e.length===0)return[];var t=e[0];return t.type===20&&t.value==="none"?[]:e.filter(function(n){return q0(n)&&wke(n)}).map(function(n){return p5.parse(r,n)})}},Cke={name:"background-origin",initialValue:"border-box",prefix:!1,type:1,parse:function(r,e){return e.map(function(t){if(ao(t))switch(t.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},Eke={name:"background-position",initialValue:"0% 0%",type:1,prefix:!1,parse:function(r,e){return tA(e).map(function(t){return t.filter(dl)}).map(u7)}},Tke={name:"background-repeat",initialValue:"repeat",prefix:!1,type:1,parse:function(r,e){return tA(e).map(function(t){return t.filter(ao).map(function(n){return n.value}).join(" ")}).map(Ske)}},Ske=function(r){switch(r){case"no-repeat":return 1;case"repeat-x":case"repeat no-repeat":return 2;case"repeat-y":case"no-repeat repeat":return 3;case"repeat":default:return 0}},K0;(function(r){r.AUTO="auto",r.CONTAIN="contain",r.COVER="cover"})(K0||(K0={}));var Ike={name:"background-size",initialValue:"0",prefix:!1,type:1,parse:function(r,e){return tA(e).map(function(t){return t.filter(Mke)})}},Mke=function(r){return ao(r)||dl(r)},CC=function(r){return{name:"border-"+r+"-color",initialValue:"transparent",prefix:!1,type:3,format:"color"}},Pke=CC("top"),Fke=CC("right"),Rke=CC("bottom"),Lke=CC("left"),EC=function(r){return{name:"border-radius-"+r,initialValue:"0 0",prefix:!1,type:1,parse:function(e,t){return u7(t.filter(dl))}}},Dke=EC("top-left"),Oke=EC("top-right"),kke=EC("bottom-right"),Uke=EC("bottom-left"),TC=function(r){return{name:"border-"+r+"-style",initialValue:"solid",prefix:!1,type:2,parse:function(e,t){switch(t){case"none":return 0;case"dashed":return 2;case"dotted":return 3;case"double":return 4}return 1}}},Nke=TC("top"),zke=TC("right"),Hke=TC("bottom"),Vke=TC("left"),SC=function(r){return{name:"border-"+r+"-width",initialValue:"0",type:0,prefix:!1,parse:function(e,t){return $b(t)?t.number:0}}},Gke=SC("top"),Qke=SC("right"),$ke=SC("bottom"),jke=SC("left"),qke={name:"color",initialValue:"transparent",prefix:!1,type:3,format:"color"},Kke={name:"direction",initialValue:"ltr",prefix:!1,type:2,parse:function(r,e){switch(e){case"rtl":return 1;case"ltr":default:return 0}}},Wke={name:"display",initialValue:"inline-block",prefix:!1,type:1,parse:function(r,e){return e.filter(ao).reduce(function(t,n){return t|Xke(n.value)},0)}},Xke=function(r){switch(r){case"block":case"-webkit-box":return 2;case"inline":return 4;case"run-in":return 8;case"flow":return 16;case"flow-root":return 32;case"table":return 64;case"flex":case"-webkit-flex":return 128;case"grid":case"-ms-grid":return 256;case"ruby":return 512;case"subgrid":return 1024;case"list-item":return 2048;case"table-row-group":return 4096;case"table-header-group":return 8192;case"table-footer-group":return 16384;case"table-row":return 32768;case"table-cell":return 65536;case"table-column-group":return 131072;case"table-column":return 262144;case"table-caption":return 524288;case"ruby-base":return 1048576;case"ruby-text":return 2097152;case"ruby-base-container":return 4194304;case"ruby-text-container":return 8388608;case"contents":return 16777216;case"inline-block":return 33554432;case"inline-list-item":return 67108864;case"inline-table":return 134217728;case"inline-flex":return 268435456;case"inline-grid":return 536870912}return 0},Jke={name:"float",initialValue:"none",prefix:!1,type:2,parse:function(r,e){switch(e){case"left":return 1;case"right":return 2;case"inline-start":return 3;case"inline-end":return 4}return 0}},Zke={name:"letter-spacing",initialValue:"0",prefix:!1,type:0,parse:function(r,e){return e.type===20&&e.value==="normal"?0:e.type===17||e.type===15?e.number:0}},IC;(function(r){r.NORMAL="normal",r.STRICT="strict"})(IC||(IC={}));var Yke={name:"line-break",initialValue:"normal",prefix:!1,type:2,parse:function(r,e){switch(e){case"strict":return IC.STRICT;case"normal":default:return IC.NORMAL}}},eUe={name:"line-height",initialValue:"normal",prefix:!1,type:4},P7=function(r,e){return ao(r)&&r.value==="normal"?1.2*e:r.type===17?e*r.number:dl(r)?yo(r,e):e},tUe={name:"list-style-image",initialValue:"none",type:0,prefix:!1,parse:function(r,e){return e.type===20&&e.value==="none"?null:p5.parse(r,e)}},rUe={name:"list-style-position",initialValue:"outside",prefix:!1,type:2,parse:function(r,e){switch(e){case"inside":return 0;case"outside":default:return 1}}},g5={name:"list-style-type",initialValue:"none",prefix:!1,type:2,parse:function(r,e){switch(e){case"disc":return 0;case"circle":return 1;case"square":return 2;case"decimal":return 3;case"cjk-decimal":return 4;case"decimal-leading-zero":return 5;case"lower-roman":return 6;case"upper-roman":return 7;case"lower-greek":return 8;case"lower-alpha":return 9;case"upper-alpha":return 10;case"arabic-indic":return 11;case"armenian":return 12;case"bengali":return 13;case"cambodian":return 14;case"cjk-earthly-branch":return 15;case"cjk-heavenly-stem":return 16;case"cjk-ideographic":return 17;case"devanagari":return 18;case"ethiopic-numeric":return 19;case"georgian":return 20;case"gujarati":return 21;case"gurmukhi":return 22;case"hebrew":return 22;case"hiragana":return 23;case"hiragana-iroha":return 24;case"japanese-formal":return 25;case"japanese-informal":return 26;case"kannada":return 27;case"katakana":return 28;case"katakana-iroha":return 29;case"khmer":return 30;case"korean-hangul-formal":return 31;case"korean-hanja-formal":return 32;case"korean-hanja-informal":return 33;case"lao":return 34;case"lower-armenian":return 35;case"malayalam":return 36;case"mongolian":return 37;case"myanmar":return 38;case"oriya":return 39;case"persian":return 40;case"simp-chinese-formal":return 41;case"simp-chinese-informal":return 42;case"tamil":return 43;case"telugu":return 44;case"thai":return 45;case"tibetan":return 46;case"trad-chinese-formal":return 47;case"trad-chinese-informal":return 48;case"upper-armenian":return 49;case"disclosure-open":return 50;case"disclosure-closed":return 51;case"none":default:return-1}}},MC=function(r){return{name:"margin-"+r,initialValue:"0",prefix:!1,type:4}},nUe=MC("top"),iUe=MC("right"),sUe=MC("bottom"),oUe=MC("left"),aUe={name:"overflow",initialValue:"visible",prefix:!1,type:1,parse:function(r,e){return e.filter(ao).map(function(t){switch(t.value){case"hidden":return 1;case"scroll":return 2;case"clip":return 3;case"auto":return 4;case"visible":default:return 0}})}},lUe={name:"overflow-wrap",initialValue:"normal",prefix:!1,type:2,parse:function(r,e){switch(e){case"break-word":return"break-word";case"normal":default:return"normal"}}},PC=function(r){return{name:"padding-"+r,initialValue:"0",prefix:!1,type:3,format:"length-percentage"}},cUe=PC("top"),uUe=PC("right"),hUe=PC("bottom"),dUe=PC("left"),fUe={name:"text-align",initialValue:"left",prefix:!1,type:2,parse:function(r,e){switch(e){case"right":return 2;case"center":case"justify":return 1;case"left":default:return 0}}},AUe={name:"position",initialValue:"static",prefix:!1,type:2,parse:function(r,e){switch(e){case"relative":return 1;case"absolute":return 2;case"fixed":return 3;case"sticky":return 4}return 0}},pUe={name:"text-shadow",initialValue:"none",type:1,prefix:!1,parse:function(r,e){return e.length===1&&d5(e[0],"none")?[]:tA(e).map(function(t){for(var n={color:TA.TRANSPARENT,offsetX:Cc,offsetY:Cc,blur:Cc},i=0,s=0;s<t.length;s++){var a=t[s];Fp(a)?(i===0?n.offsetX=a:i===1?n.offsetY=a:n.blur=a,i++):n.color=Lp.parse(r,a)}return n})}},gUe={name:"text-transform",initialValue:"none",prefix:!1,type:2,parse:function(r,e){switch(e){case"uppercase":return 2;case"lowercase":return 1;case"capitalize":return 3}return 0}},mUe={name:"transform",initialValue:"none",prefix:!0,type:0,parse:function(r,e){if(e.type===20&&e.value==="none")return null;if(e.type===18){var t=bUe[e.name];if(typeof t>"u")throw new Error('Attempting to parse an unsupported transform function "'+e.name+'"');return t(e.values)}return null}},_Ue=function(r){var e=r.filter(function(t){return t.type===17}).map(function(t){return t.number});return e.length===6?e:null},yUe=function(r){var e=r.filter(function(h){return h.type===17}).map(function(h){return h.number}),t=e[0],n=e[1];e[2],e[3];var i=e[4],s=e[5];e[6],e[7],e[8],e[9],e[10],e[11];var a=e[12],o=e[13];return e[14],e[15],e.length===16?[t,n,i,s,a,o]:null},bUe={matrix:_Ue,matrix3d:yUe},F7={type:16,number:50,flags:zb},vUe=[F7,F7],xUe={name:"transform-origin",initialValue:"50% 50%",prefix:!0,type:1,parse:function(r,e){var t=e.filter(dl);return t.length!==2?vUe:[t[0],t[1]]}},wUe={name:"visible",initialValue:"none",prefix:!1,type:2,parse:function(r,e){switch(e){case"hidden":return 1;case"collapse":return 2;case"visible":default:return 0}}},Kb;(function(r){r.NORMAL="normal",r.BREAK_ALL="break-all",r.KEEP_ALL="keep-all"})(Kb||(Kb={}));for(var BUe={name:"word-break",initialValue:"normal",prefix:!1,type:2,parse:function(r,e){switch(e){case"break-all":return Kb.BREAK_ALL;case"keep-all":return Kb.KEEP_ALL;case"normal":default:return Kb.NORMAL}}},CUe={name:"z-index",initialValue:"auto",prefix:!1,type:0,parse:function(r,e){if(e.type===20)return{auto:!0,order:0};if(j0(e))return{auto:!1,order:e.number};throw new Error("Invalid z-index number parsed")}},R7={name:"time",parse:function(r,e){if(e.type===15)switch(e.unit.toLowerCase()){case"s":return 1e3*e.number;case"ms":return e.number}throw new Error("Unsupported time type")}},EUe={name:"opacity",initialValue:"1",type:0,prefix:!1,parse:function(r,e){return j0(e)?e.number:1}},TUe={name:"text-decoration-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},SUe={name:"text-decoration-line",initialValue:"none",prefix:!1,type:1,parse:function(r,e){return e.filter(ao).map(function(t){switch(t.value){case"underline":return 1;case"overline":return 2;case"line-through":return 3;case"none":return 4}return 0}).filter(function(t){return t!==0})}},IUe={name:"font-family",initialValue:"",prefix:!1,type:1,parse:function(r,e){var t=[],n=[];return e.forEach(function(i){switch(i.type){case 20:case 0:t.push(i.value);break;case 17:t.push(i.number.toString());break;case 4:n.push(t.join(" ")),t.length=0;break}}),t.length&&n.push(t.join(" ")),n.map(function(i){return i.indexOf(" ")===-1?i:"'"+i+"'"})}},MUe={name:"font-size",initialValue:"0",prefix:!1,type:3,format:"length"},PUe={name:"font-weight",initialValue:"normal",type:0,prefix:!1,parse:function(r,e){if(j0(e))return e.number;if(ao(e))switch(e.value){case"bold":return 700;case"normal":default:return 400}return 400}},FUe={name:"font-variant",initialValue:"none",type:1,prefix:!1,parse:function(r,e){return e.filter(ao).map(function(t){return t.value})}},RUe={name:"font-style",initialValue:"normal",prefix:!1,type:2,parse:function(r,e){switch(e){case"oblique":return"oblique";case"italic":return"italic";case"normal":default:return"normal"}}},Ll=function(r,e){return(r&e)!==0},LUe={name:"content",initialValue:"none",type:1,prefix:!1,parse:function(r,e){if(e.length===0)return[];var t=e[0];return t.type===20&&t.value==="none"?[]:e}},DUe={name:"counter-increment",initialValue:"none",prefix:!0,type:1,parse:function(r,e){if(e.length===0)return null;var t=e[0];if(t.type===20&&t.value==="none")return null;for(var n=[],i=e.filter(c7),s=0;s<i.length;s++){var a=i[s],o=i[s+1];if(a.type===20){var h=o&&j0(o)?o.number:1;n.push({counter:a.value,increment:h})}}return n}},OUe={name:"counter-reset",initialValue:"none",prefix:!0,type:1,parse:function(r,e){if(e.length===0)return[];for(var t=[],n=e.filter(c7),i=0;i<n.length;i++){var s=n[i],a=n[i+1];if(ao(s)&&s.value!=="none"){var o=a&&j0(a)?a.number:0;t.push({counter:s.value,reset:o})}}return t}},kUe={name:"duration",initialValue:"0s",prefix:!1,type:1,parse:function(r,e){return e.filter($b).map(function(t){return R7.parse(r,t)})}},UUe={name:"quotes",initialValue:"none",prefix:!0,type:1,parse:function(r,e){if(e.length===0)return null;var t=e[0];if(t.type===20&&t.value==="none")return null;var n=[],i=e.filter(uke);if(i.length%2!==0)return null;for(var s=0;s<i.length;s+=2){var a=i[s].value,o=i[s+1].value;n.push({open:a,close:o})}return n}},L7=function(r,e,t){if(!r)return"";var n=r[Math.min(e,r.length-1)];return n?t?n.open:n.close:""},NUe={name:"box-shadow",initialValue:"none",type:1,prefix:!1,parse:function(r,e){return e.length===1&&d5(e[0],"none")?[]:tA(e).map(function(t){for(var n={color:255,offsetX:Cc,offsetY:Cc,blur:Cc,spread:Cc,inset:!1},i=0,s=0;s<t.length;s++){var a=t[s];d5(a,"inset")?n.inset=!0:Fp(a)?(i===0?n.offsetX=a:i===1?n.offsetY=a:i===2?n.blur=a:n.spread=a,i++):n.color=Lp.parse(r,a)}return n})}},zUe={name:"paint-order",initialValue:"normal",prefix:!1,type:1,parse:function(r,e){var t=[0,1,2],n=[];return e.filter(ao).forEach(function(i){switch(i.value){case"stroke":n.push(1);break;case"fill":n.push(0);break;case"markers":n.push(2);break}}),t.forEach(function(i){n.indexOf(i)===-1&&n.push(i)}),n}},HUe={name:"-webkit-text-stroke-color",initialValue:"currentcolor",prefix:!1,type:3,format:"color"},VUe={name:"-webkit-text-stroke-width",initialValue:"0",type:0,prefix:!1,parse:function(r,e){return $b(e)?e.number:0}},GUe=function(){function r(e,t){var n,i;this.animationDuration=Vn(e,kUe,t.animationDuration),this.backgroundClip=Vn(e,fke,t.backgroundClip),this.backgroundColor=Vn(e,Ake,t.backgroundColor),this.backgroundImage=Vn(e,Bke,t.backgroundImage),this.backgroundOrigin=Vn(e,Cke,t.backgroundOrigin),this.backgroundPosition=Vn(e,Eke,t.backgroundPosition),this.backgroundRepeat=Vn(e,Tke,t.backgroundRepeat),this.backgroundSize=Vn(e,Ike,t.backgroundSize),this.borderTopColor=Vn(e,Pke,t.borderTopColor),this.borderRightColor=Vn(e,Fke,t.borderRightColor),this.borderBottomColor=Vn(e,Rke,t.borderBottomColor),this.borderLeftColor=Vn(e,Lke,t.borderLeftColor),this.borderTopLeftRadius=Vn(e,Dke,t.borderTopLeftRadius),this.borderTopRightRadius=Vn(e,Oke,t.borderTopRightRadius),this.borderBottomRightRadius=Vn(e,kke,t.borderBottomRightRadius),this.borderBottomLeftRadius=Vn(e,Uke,t.borderBottomLeftRadius),this.borderTopStyle=Vn(e,Nke,t.borderTopStyle),this.borderRightStyle=Vn(e,zke,t.borderRightStyle),this.borderBottomStyle=Vn(e,Hke,t.borderBottomStyle),this.borderLeftStyle=Vn(e,Vke,t.borderLeftStyle),this.borderTopWidth=Vn(e,Gke,t.borderTopWidth),this.borderRightWidth=Vn(e,Qke,t.borderRightWidth),this.borderBottomWidth=Vn(e,$ke,t.borderBottomWidth),this.borderLeftWidth=Vn(e,jke,t.borderLeftWidth),this.boxShadow=Vn(e,NUe,t.boxShadow),this.color=Vn(e,qke,t.color),this.direction=Vn(e,Kke,t.direction),this.display=Vn(e,Wke,t.display),this.float=Vn(e,Jke,t.cssFloat),this.fontFamily=Vn(e,IUe,t.fontFamily),this.fontSize=Vn(e,MUe,t.fontSize),this.fontStyle=Vn(e,RUe,t.fontStyle),this.fontVariant=Vn(e,FUe,t.fontVariant),this.fontWeight=Vn(e,PUe,t.fontWeight),this.letterSpacing=Vn(e,Zke,t.letterSpacing),this.lineBreak=Vn(e,Yke,t.lineBreak),this.lineHeight=Vn(e,eUe,t.lineHeight),this.listStyleImage=Vn(e,tUe,t.listStyleImage),this.listStylePosition=Vn(e,rUe,t.listStylePosition),this.listStyleType=Vn(e,g5,t.listStyleType),this.marginTop=Vn(e,nUe,t.marginTop),this.marginRight=Vn(e,iUe,t.marginRight),this.marginBottom=Vn(e,sUe,t.marginBottom),this.marginLeft=Vn(e,oUe,t.marginLeft),this.opacity=Vn(e,EUe,t.opacity);var s=Vn(e,aUe,t.overflow);this.overflowX=s[0],this.overflowY=s[s.length>1?1:0],this.overflowWrap=Vn(e,lUe,t.overflowWrap),this.paddingTop=Vn(e,cUe,t.paddingTop),this.paddingRight=Vn(e,uUe,t.paddingRight),this.paddingBottom=Vn(e,hUe,t.paddingBottom),this.paddingLeft=Vn(e,dUe,t.paddingLeft),this.paintOrder=Vn(e,zUe,t.paintOrder),this.position=Vn(e,AUe,t.position),this.textAlign=Vn(e,fUe,t.textAlign),this.textDecorationColor=Vn(e,TUe,(n=t.textDecorationColor)!==null&&n!==void 0?n:t.color),this.textDecorationLine=Vn(e,SUe,(i=t.textDecorationLine)!==null&&i!==void 0?i:t.textDecoration),this.textShadow=Vn(e,pUe,t.textShadow),this.textTransform=Vn(e,gUe,t.textTransform),this.transform=Vn(e,mUe,t.transform),this.transformOrigin=Vn(e,xUe,t.transformOrigin),this.visibility=Vn(e,wUe,t.visibility),this.webkitTextStrokeColor=Vn(e,HUe,t.webkitTextStrokeColor),this.webkitTextStrokeWidth=Vn(e,VUe,t.webkitTextStrokeWidth),this.wordBreak=Vn(e,BUe,t.wordBreak),this.zIndex=Vn(e,CUe,t.zIndex)}return r.prototype.isVisible=function(){return this.display>0&&this.opacity>0&&this.visibility===0},r.prototype.isTransparent=function(){return Dp(this.backgroundColor)},r.prototype.isTransformed=function(){return this.transform!==null},r.prototype.isPositioned=function(){return this.position!==0},r.prototype.isPositionedWithZIndex=function(){return this.isPositioned()&&!this.zIndex.auto},r.prototype.isFloating=function(){return this.float!==0},r.prototype.isInlineLevel=function(){return Ll(this.display,4)||Ll(this.display,33554432)||Ll(this.display,268435456)||Ll(this.display,536870912)||Ll(this.display,67108864)||Ll(this.display,134217728)},r}(),QUe=function(){function r(e,t){this.content=Vn(e,LUe,t.content),this.quotes=Vn(e,UUe,t.quotes)}return r}(),D7=function(){function r(e,t){this.counterIncrement=Vn(e,DUe,t.counterIncrement),this.counterReset=Vn(e,OUe,t.counterReset)}return r}(),Vn=function(r,e,t){var n=new a7,i=t!==null&&typeof t<"u"?t.toString():e.initialValue;n.write(i);var s=new l7(n.read());switch(e.type){case 2:var a=s.parseComponentValue();return e.parse(r,ao(a)?a.value:e.initialValue);case 0:return e.parse(r,s.parseComponentValue());case 1:return e.parse(r,s.parseComponentValues());case 4:return s.parseComponentValue();case 3:switch(e.format){case"angle":return vC.parse(r,s.parseComponentValue());case"color":return Lp.parse(r,s.parseComponentValue());case"image":return p5.parse(r,s.parseComponentValue());case"length":var o=s.parseComponentValue();return Fp(o)?o:Cc;case"length-percentage":var h=s.parseComponentValue();return dl(h)?h:Cc;case"time":return R7.parse(r,s.parseComponentValue())}break}},$Ue="data-html2canvas-debug",jUe=function(r){var e=r.getAttribute($Ue);switch(e){case"all":return 1;case"clone":return 2;case"parse":return 3;case"render":return 4;default:return 0}},m5=function(r,e){var t=jUe(r);return t===1||e===t},rA=function(){function r(e,t){if(this.context=e,this.textNodes=[],this.elements=[],this.flags=0,m5(t,3))debugger;this.styles=new GUe(e,window.getComputedStyle(t,null)),M5(t)&&(this.styles.animationDuration.some(function(n){return n>0})&&(t.style.animationDuration="0s"),this.styles.transform!==null&&(t.style.transform="none")),this.bounds=tC(this.context,t),m5(t,4)&&(this.flags|=16)}return r}(),qUe="AAAAAAAAAAAAEA4AGBkAAFAaAAACAAAAAAAIABAAGAAwADgACAAQAAgAEAAIABAACAAQAAgAEAAIABAACAAQAAgAEAAIABAAQABIAEQATAAIABAACAAQAAgAEAAIABAAVABcAAgAEAAIABAACAAQAGAAaABwAHgAgACIAI4AlgAIABAAmwCjAKgAsAC2AL4AvQDFAMoA0gBPAVYBWgEIAAgACACMANoAYgFkAWwBdAF8AX0BhQGNAZUBlgGeAaMBlQGWAasBswF8AbsBwwF0AcsBYwHTAQgA2wG/AOMBdAF8AekB8QF0AfkB+wHiAHQBfAEIAAMC5gQIAAsCEgIIAAgAFgIeAggAIgIpAggAMQI5AkACygEIAAgASAJQAlgCYAIIAAgACAAKBQoFCgUTBRMFGQUrBSsFCAAIAAgACAAIAAgACAAIAAgACABdAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABoAmgCrwGvAQgAbgJ2AggAHgEIAAgACADnAXsCCAAIAAgAgwIIAAgACAAIAAgACACKAggAkQKZAggAPADJAAgAoQKkAqwCsgK6AsICCADJAggA0AIIAAgACAAIANYC3gIIAAgACAAIAAgACABAAOYCCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAkASoB+QIEAAgACAA8AEMCCABCBQgACABJBVAFCAAIAAgACAAIAAgACAAIAAgACABTBVoFCAAIAFoFCABfBWUFCAAIAAgACAAIAAgAbQUIAAgACAAIAAgACABzBXsFfQWFBYoFigWKBZEFigWKBYoFmAWfBaYFrgWxBbkFCAAIAAgACAAIAAgACAAIAAgACAAIAMEFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAMgFCADQBQgACAAIAAgACAAIAAgACAAIAAgACAAIAO4CCAAIAAgAiQAIAAgACABAAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAD0AggACAD8AggACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIANYFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAMDvwAIAAgAJAIIAAgACAAIAAgACAAIAAgACwMTAwgACAB9BOsEGwMjAwgAKwMyAwsFYgE3A/MEPwMIAEUDTQNRAwgAWQOsAGEDCAAIAAgACAAIAAgACABpAzQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFIQUoBSwFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABtAwgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABMAEwACAAIAAgACAAIABgACAAIAAgACAC/AAgACAAyAQgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACAAIAAwAAgACAAIAAgACAAIAAgACAAIAAAARABIAAgACAAIABQASAAIAAgAIABwAEAAjgCIABsAqAC2AL0AigDQAtwC+IJIQqVAZUBWQqVAZUBlQGVAZUBlQGrC5UBlQGVAZUBlQGVAZUBlQGVAXsKlQGVAbAK6wsrDGUMpQzlDJUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAfAKAAuZA64AtwCJALoC6ADwAAgAuACgA/oEpgO6AqsD+AAIAAgAswMIAAgACAAIAIkAuwP5AfsBwwPLAwgACAAIAAgACADRA9kDCAAIAOED6QMIAAgACAAIAAgACADuA/YDCAAIAP4DyQAIAAgABgQIAAgAXQAOBAgACAAIAAgACAAIABMECAAIAAgACAAIAAgACAD8AAQBCAAIAAgAGgQiBCoECAExBAgAEAEIAAgACAAIAAgACAAIAAgACAAIAAgACAA4BAgACABABEYECAAIAAgATAQYAQgAVAQIAAgACAAIAAgACAAIAAgACAAIAFoECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAOQEIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAB+BAcACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAEABhgSMBAgACAAIAAgAlAQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAwAEAAQABAADAAMAAwADAAQABAAEAAQABAAEAAQABHATAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAdQMIAAgACAAIAAgACAAIAMkACAAIAAgAfQMIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACFA4kDCAAIAAgACAAIAOcBCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAIcDCAAIAAgACAAIAAgACAAIAAgACAAIAJEDCAAIAAgACADFAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABgBAgAZgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAbAQCBXIECAAIAHkECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABAAJwEQACjBKoEsgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAC6BMIECAAIAAgACAAIAAgACABmBAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAxwQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAGYECAAIAAgAzgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBd0FXwUIAOIF6gXxBYoF3gT5BQAGCAaKBYoFigWKBYoFigWKBYoFigWKBYoFigXWBIoFigWKBYoFigWKBYoFigWKBYsFEAaKBYoFigWKBYoFigWKBRQGCACKBYoFigWKBQgACAAIANEECAAIABgGigUgBggAJgYIAC4GMwaKBYoF0wQ3Bj4GigWKBYoFigWKBYoFigWKBYoFigWKBYoFigUIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWLBf///////wQABAAEAAQABAAEAAQABAAEAAQAAwAEAAQAAgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAQADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUAAAAFAAUAAAAFAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAQAAAAUABQAFAAUABQAFAAAAAAAFAAUAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAFAAUAAQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAAABwAHAAcAAAAHAAcABwAFAAEAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAcABwAFAAUAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAQABAAAAAAAAAAAAAAAFAAUABQAFAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAHAAcAAAAHAAcAAAAAAAUABQAHAAUAAQAHAAEABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwABAAUABQAFAAUAAAAAAAAAAAAAAAEAAQABAAEAAQABAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABQANAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAABQAHAAUABQAFAAAAAAAAAAcABQAFAAUABQAFAAQABAAEAAQABAAEAAQABAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUAAAAFAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAUAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAcABwAFAAcABwAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUABwAHAAUABQAFAAUAAAAAAAcABwAAAAAABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAAAAAAAAAAABQAFAAAAAAAFAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAFAAUABQAFAAUAAAAFAAUABwAAAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABwAFAAUABQAFAAAAAAAHAAcAAAAAAAcABwAFAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAAAAAAAAAHAAcABwAAAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAUABQAFAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAHAAcABQAHAAcAAAAFAAcABwAAAAcABwAFAAUAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAFAAcABwAFAAUABQAAAAUAAAAHAAcABwAHAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAHAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUAAAAFAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAUAAAAFAAUAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABwAFAAUABQAFAAUABQAAAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABQAFAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAFAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAHAAUABQAFAAUABQAFAAUABwAHAAcABwAHAAcABwAHAAUABwAHAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABwAHAAcABwAFAAUABwAHAAcAAAAAAAAAAAAHAAcABQAHAAcABwAHAAcABwAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAUABQAFAAUABQAFAAUAAAAFAAAABQAAAAAABQAFAAUABQAFAAUABQAFAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAUABQAFAAUABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABwAFAAcABwAHAAcABwAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAUABQAFAAUABwAHAAUABQAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABQAFAAcABwAHAAUABwAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAcABQAFAAUABQAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAAAAAABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAAAAAAAAAFAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAUABQAHAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAFAAUABQAFAAcABwAFAAUABwAHAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAcABwAFAAUABwAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABQAAAAAABQAFAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAcABwAAAAAAAAAAAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAcABwAFAAcABwAAAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAFAAUABQAAAAUABQAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABwAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAHAAcABQAHAAUABQAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAAABwAHAAAAAAAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAFAAUABwAFAAcABwAFAAcABQAFAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAAAAAABwAHAAcABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAFAAcABwAFAAUABQAFAAUABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAUABQAFAAcABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABQAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAAAAAAFAAUABwAHAAcABwAFAAAAAAAAAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAHAAUABQAFAAUABQAFAAUABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAABQAAAAUABQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAHAAcAAAAFAAUAAAAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABQAFAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAABQAFAAUABQAFAAUABQAAAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAFAAUABQAFAAUADgAOAA4ADgAOAA4ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAMAAwADAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkAAAAAAAAAAAAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAAAAAAAAAAAAsADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwACwAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAADgAOAA4AAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAAAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4AAAAOAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAAAAAAAAAAAA4AAAAOAAAAAAAAAAAADgAOAA4AAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAA=",O7="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Wb=typeof Uint8Array>"u"?[]:new Uint8Array(256),FC=0;FC<O7.length;FC++)Wb[O7.charCodeAt(FC)]=FC;for(var KUe=function(r){var e=r.length*.75,t=r.length,n,i=0,s,a,o,h;r[r.length-1]==="="&&(e--,r[r.length-2]==="="&&e--);var f=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"&&typeof Uint8Array.prototype.slice<"u"?new ArrayBuffer(e):new Array(e),_=Array.isArray(f)?f:new Uint8Array(f);for(n=0;n<t;n+=4)s=Wb[r.charCodeAt(n)],a=Wb[r.charCodeAt(n+1)],o=Wb[r.charCodeAt(n+2)],h=Wb[r.charCodeAt(n+3)],_[i++]=s<<2|a>>4,_[i++]=(a&15)<<4|o>>2,_[i++]=(o&3)<<6|h&63;return f},WUe=function(r){for(var e=r.length,t=[],n=0;n<e;n+=2)t.push(r[n+1]<<8|r[n]);return t},XUe=function(r){for(var e=r.length,t=[],n=0;n<e;n+=4)t.push(r[n+3]<<24|r[n+2]<<16|r[n+1]<<8|r[n]);return t},fm=5,_5=11,y5=2,JUe=_5-fm,k7=65536>>fm,ZUe=1<<fm,b5=ZUe-1,YUe=1024>>fm,eNe=k7+YUe,tNe=eNe,rNe=32,nNe=tNe+rNe,iNe=65536>>_5,sNe=1<<JUe,oNe=sNe-1,U7=function(r,e,t){return r.slice?r.slice(e,t):new Uint16Array(Array.prototype.slice.call(r,e,t))},aNe=function(r,e,t){return r.slice?r.slice(e,t):new Uint32Array(Array.prototype.slice.call(r,e,t))},lNe=function(r,e){var t=KUe(r),n=Array.isArray(t)?XUe(t):new Uint32Array(t),i=Array.isArray(t)?WUe(t):new Uint16Array(t),s=24,a=U7(i,s/2,n[4]/2),o=n[5]===2?U7(i,(s+n[4])/2):aNe(n,Math.ceil((s+n[4])/4));return new cNe(n[0],n[1],n[2],n[3],a,o)},cNe=function(){function r(e,t,n,i,s,a){this.initialValue=e,this.errorValue=t,this.highStart=n,this.highValueIndex=i,this.index=s,this.data=a}return r.prototype.get=function(e){var t;if(e>=0){if(e<55296||e>56319&&e<=65535)return t=this.index[e>>fm],t=(t<<y5)+(e&b5),this.data[t];if(e<=65535)return t=this.index[k7+(e-55296>>fm)],t=(t<<y5)+(e&b5),this.data[t];if(e<this.highStart)return t=nNe-iNe+(e>>_5),t=this.index[t],t+=e>>fm&oNe,t=this.index[t],t=(t<<y5)+(e&b5),this.data[t];if(e<=1114111)return this.data[this.highValueIndex]}return this.errorValue},r}(),N7="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",uNe=typeof Uint8Array>"u"?[]:new Uint8Array(256),RC=0;RC<N7.length;RC++)uNe[N7.charCodeAt(RC)]=RC;var hNe=1,v5=2,x5=3,z7=4,H7=5,dNe=7,V7=8,w5=9,B5=10,G7=11,Q7=12,$7=13,j7=14,C5=15,fNe=function(r){for(var e=[],t=0,n=r.length;t<n;){var i=r.charCodeAt(t++);if(i>=55296&&i<=56319&&t<n){var s=r.charCodeAt(t++);(s&64512)===56320?e.push(((i&1023)<<10)+(s&1023)+65536):(e.push(i),t--)}else e.push(i)}return e},ANe=function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];if(String.fromCodePoint)return String.fromCodePoint.apply(String,r);var t=r.length;if(!t)return"";for(var n=[],i=-1,s="";++i<t;){var a=r[i];a<=65535?n.push(a):(a-=65536,n.push((a>>10)+55296,a%1024+56320)),(i+1===t||n.length>16384)&&(s+=String.fromCharCode.apply(String,n),n.length=0)}return s},pNe=lNe(qUe),Am="",q7="",gNe=function(r){return pNe.get(r)},mNe=function(r,e,t){var n=t-2,i=e[n],s=e[t-1],a=e[t];if(s===v5&&a===x5)return Am;if(s===v5||s===x5||s===z7||a===v5||a===x5||a===z7)return q7;if(s===V7&&[V7,w5,G7,Q7].indexOf(a)!==-1||(s===G7||s===w5)&&(a===w5||a===B5)||(s===Q7||s===B5)&&a===B5||a===$7||a===H7||a===dNe||s===hNe)return Am;if(s===$7&&a===j7){for(;i===H7;)i=e[--n];if(i===j7)return Am}if(s===C5&&a===C5){for(var o=0;i===C5;)o++,i=e[--n];if(o%2===0)return Am}return q7},_Ne=function(r){var e=fNe(r),t=e.length,n=0,i=0,s=e.map(gNe);return{next:function(){if(n>=t)return{done:!0,value:null};for(var a=Am;n<t&&(a=mNe(e,s,++n))===Am;);if(a!==Am||n===t){var o=ANe.apply(null,e.slice(i,n));return i=n,{value:o,done:!1}}return{done:!0,value:null}}}},yNe=function(r){for(var e=_Ne(r),t=[],n;!(n=e.next()).done;)n.value&&t.push(n.value.slice());return t},bNe=function(r){var e=123;if(r.createRange){var t=r.createRange();if(t.getBoundingClientRect){var n=r.createElement("boundtest");n.style.height=e+"px",n.style.display="block",r.body.appendChild(n),t.selectNode(n);var i=t.getBoundingClientRect(),s=Math.round(i.height);if(r.body.removeChild(n),s===e)return!0}}return!1},vNe=function(r){var e=r.createElement("boundtest");e.style.width="50px",e.style.display="block",e.style.fontSize="12px",e.style.letterSpacing="0px",e.style.wordSpacing="0px",r.body.appendChild(e);var t=r.createRange();e.innerHTML=typeof"".repeat=="function"?"&#128104;".repeat(10):"";var n=e.firstChild,i=rC(n.data).map(function(h){return Na(h)}),s=0,a={},o=i.every(function(h,f){t.setStart(n,s),t.setEnd(n,s+h.length);var _=t.getBoundingClientRect();s+=h.length;var x=_.x>a.x||_.y>a.y;return a=_,f===0?!0:x});return r.body.removeChild(e),o},xNe=function(){return typeof new Image().crossOrigin<"u"},wNe=function(){return typeof new XMLHttpRequest().responseType=="string"},BNe=function(r){var e=new Image,t=r.createElement("canvas"),n=t.getContext("2d");if(!n)return!1;e.src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>";try{n.drawImage(e,0,0),t.toDataURL()}catch{return!1}return!0},K7=function(r){return r[0]===0&&r[1]===255&&r[2]===0&&r[3]===255},CNe=function(r){var e=r.createElement("canvas"),t=100;e.width=t,e.height=t;var n=e.getContext("2d");if(!n)return Promise.reject(!1);n.fillStyle="rgb(0, 255, 0)",n.fillRect(0,0,t,t);var i=new Image,s=e.toDataURL();i.src=s;var a=E5(t,t,0,0,i);return n.fillStyle="red",n.fillRect(0,0,t,t),W7(a).then(function(o){n.drawImage(o,0,0);var h=n.getImageData(0,0,t,t).data;n.fillStyle="red",n.fillRect(0,0,t,t);var f=r.createElement("div");return f.style.backgroundImage="url("+s+")",f.style.height=t+"px",K7(h)?W7(E5(t,t,0,0,f)):Promise.reject(!1)}).then(function(o){return n.drawImage(o,0,0),K7(n.getImageData(0,0,t,t).data)}).catch(function(){return!1})},E5=function(r,e,t,n,i){var s="http://www.w3.org/2000/svg",a=document.createElementNS(s,"svg"),o=document.createElementNS(s,"foreignObject");return a.setAttributeNS(null,"width",r.toString()),a.setAttributeNS(null,"height",e.toString()),o.setAttributeNS(null,"width","100%"),o.setAttributeNS(null,"height","100%"),o.setAttributeNS(null,"x",t.toString()),o.setAttributeNS(null,"y",n.toString()),o.setAttributeNS(null,"externalResourcesRequired","true"),a.appendChild(o),o.appendChild(i),a},W7=function(r){return new Promise(function(e,t){var n=new Image;n.onload=function(){return e(n)},n.onerror=t,n.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(new XMLSerializer().serializeToString(r))})},Ec={get SUPPORT_RANGE_BOUNDS(){var r=bNe(document);return Object.defineProperty(Ec,"SUPPORT_RANGE_BOUNDS",{value:r}),r},get SUPPORT_WORD_BREAKING(){var r=Ec.SUPPORT_RANGE_BOUNDS&&vNe(document);return Object.defineProperty(Ec,"SUPPORT_WORD_BREAKING",{value:r}),r},get SUPPORT_SVG_DRAWING(){var r=BNe(document);return Object.defineProperty(Ec,"SUPPORT_SVG_DRAWING",{value:r}),r},get SUPPORT_FOREIGNOBJECT_DRAWING(){var r=typeof Array.from=="function"&&typeof window.fetch=="function"?CNe(document):Promise.resolve(!1);return Object.defineProperty(Ec,"SUPPORT_FOREIGNOBJECT_DRAWING",{value:r}),r},get SUPPORT_CORS_IMAGES(){var r=xNe();return Object.defineProperty(Ec,"SUPPORT_CORS_IMAGES",{value:r}),r},get SUPPORT_RESPONSE_TYPE(){var r=wNe();return Object.defineProperty(Ec,"SUPPORT_RESPONSE_TYPE",{value:r}),r},get SUPPORT_CORS_XHR(){var r="withCredentials"in new XMLHttpRequest;return Object.defineProperty(Ec,"SUPPORT_CORS_XHR",{value:r}),r},get SUPPORT_NATIVE_TEXT_SEGMENTATION(){var r=!!(typeof Intl<"u"&&Intl.Segmenter);return Object.defineProperty(Ec,"SUPPORT_NATIVE_TEXT_SEGMENTATION",{value:r}),r}},Xb=function(){function r(e,t){this.text=e,this.bounds=t}return r}(),ENe=function(r,e,t,n){var i=INe(e,t),s=[],a=0;return i.forEach(function(o){if(t.textDecorationLine.length||o.trim().length>0)if(Ec.SUPPORT_RANGE_BOUNDS){var h=X7(n,a,o.length).getClientRects();if(h.length>1){var f=T5(o),_=0;f.forEach(function(T){s.push(new Xb(T,CA.fromDOMRectList(r,X7(n,_+a,T.length).getClientRects()))),_+=T.length})}else s.push(new Xb(o,CA.fromDOMRectList(r,h)))}else{var x=n.splitText(o.length);s.push(new Xb(o,TNe(r,n))),n=x}else Ec.SUPPORT_RANGE_BOUNDS||(n=n.splitText(o.length));a+=o.length}),s},TNe=function(r,e){var t=e.ownerDocument;if(t){var n=t.createElement("html2canvaswrapper");n.appendChild(e.cloneNode(!0));var i=e.parentNode;if(i){i.replaceChild(n,e);var s=tC(r,n);return n.firstChild&&i.replaceChild(n.firstChild,n),s}}return CA.EMPTY},X7=function(r,e,t){var n=r.ownerDocument;if(!n)throw new Error("Node has no owner document");var i=n.createRange();return i.setStart(r,e),i.setEnd(r,e+t),i},T5=function(r){if(Ec.SUPPORT_NATIVE_TEXT_SEGMENTATION){var e=new Intl.Segmenter(void 0,{granularity:"grapheme"});return Array.from(e.segment(r)).map(function(t){return t.segment})}return yNe(r)},SNe=function(r,e){if(Ec.SUPPORT_NATIVE_TEXT_SEGMENTATION){var t=new Intl.Segmenter(void 0,{granularity:"word"});return Array.from(t.segment(r)).map(function(n){return n.segment})}return PNe(r,e)},INe=function(r,e){return e.letterSpacing!==0?T5(r):SNe(r,e)},MNe=[32,160,4961,65792,65793,4153,4241],PNe=function(r,e){for(var t=iOe(r,{lineBreak:e.lineBreak,wordBreak:e.overflowWrap==="break-word"?"break-word":e.wordBreak}),n=[],i,s=function(){if(i.value){var a=i.value.slice(),o=rC(a),h="";o.forEach(function(f){MNe.indexOf(f)===-1?h+=Na(f):(h.length&&n.push(h),n.push(Na(f)),h="")}),h.length&&n.push(h)}};!(i=t.next()).done;)s();return n},FNe=function(){function r(e,t,n){this.text=RNe(t.data,n.textTransform),this.textBounds=ENe(e,this.text,n,t)}return r}(),RNe=function(r,e){switch(e){case 1:return r.toLowerCase();case 3:return r.replace(LNe,DNe);case 2:return r.toUpperCase();default:return r}},LNe=/(^|\s|:|-|\(|\))([a-z])/g,DNe=function(r,e,t){return r.length>0?e+t.toUpperCase():r},J7=function(r){lf(e,r);function e(t,n){var i=r.call(this,t,n)||this;return i.src=n.currentSrc||n.src,i.intrinsicWidth=n.naturalWidth,i.intrinsicHeight=n.naturalHeight,i.context.cache.addImage(i.src),i}return e}(rA),Z7=function(r){lf(e,r);function e(t,n){var i=r.call(this,t,n)||this;return i.canvas=n,i.intrinsicWidth=n.width,i.intrinsicHeight=n.height,i}return e}(rA),Y7=function(r){lf(e,r);function e(t,n){var i=r.call(this,t,n)||this,s=new XMLSerializer,a=tC(t,n);return n.setAttribute("width",a.width+"px"),n.setAttribute("height",a.height+"px"),i.svg="data:image/svg+xml,"+encodeURIComponent(s.serializeToString(n)),i.intrinsicWidth=n.width.baseVal.value,i.intrinsicHeight=n.height.baseVal.value,i.context.cache.addImage(i.svg),i}return e}(rA),eq=function(r){lf(e,r);function e(t,n){var i=r.call(this,t,n)||this;return i.value=n.value,i}return e}(rA),S5=function(r){lf(e,r);function e(t,n){var i=r.call(this,t,n)||this;return i.start=n.start,i.reversed=typeof n.reversed=="boolean"&&n.reversed===!0,i}return e}(rA),ONe=[{type:15,flags:0,unit:"px",number:3}],kNe=[{type:16,flags:0,number:50}],UNe=function(r){return r.width>r.height?new CA(r.left+(r.width-r.height)/2,r.top,r.height,r.height):r.width<r.height?new CA(r.left,r.top+(r.height-r.width)/2,r.width,r.width):r},NNe=function(r){var e=r.type===zNe?new Array(r.value.length+1).join(""):r.value;return e.length===0?r.placeholder||"":e},LC="checkbox",DC="radio",zNe="password",tq=707406591,I5=function(r){lf(e,r);function e(t,n){var i=r.call(this,t,n)||this;switch(i.type=n.type.toLowerCase(),i.checked=n.checked,i.value=NNe(n),(i.type===LC||i.type===DC)&&(i.styles.backgroundColor=3739148031,i.styles.borderTopColor=i.styles.borderRightColor=i.styles.borderBottomColor=i.styles.borderLeftColor=2779096575,i.styles.borderTopWidth=i.styles.borderRightWidth=i.styles.borderBottomWidth=i.styles.borderLeftWidth=1,i.styles.borderTopStyle=i.styles.borderRightStyle=i.styles.borderBottomStyle=i.styles.borderLeftStyle=1,i.styles.backgroundClip=[0],i.styles.backgroundOrigin=[0],i.bounds=UNe(i.bounds)),i.type){case LC:i.styles.borderTopRightRadius=i.styles.borderTopLeftRadius=i.styles.borderBottomRightRadius=i.styles.borderBottomLeftRadius=ONe;break;case DC:i.styles.borderTopRightRadius=i.styles.borderTopLeftRadius=i.styles.borderBottomRightRadius=i.styles.borderBottomLeftRadius=kNe;break}return i}return e}(rA),rq=function(r){lf(e,r);function e(t,n){var i=r.call(this,t,n)||this,s=n.options[n.selectedIndex||0];return i.value=s&&s.text||"",i}return e}(rA),nq=function(r){lf(e,r);function e(t,n){var i=r.call(this,t,n)||this;return i.value=n.value,i}return e}(rA),iq=function(r){lf(e,r);function e(t,n){var i=r.call(this,t,n)||this;i.src=n.src,i.width=parseInt(n.width,10)||0,i.height=parseInt(n.height,10)||0,i.backgroundColor=i.styles.backgroundColor;try{if(n.contentWindow&&n.contentWindow.document&&n.contentWindow.document.documentElement){i.tree=oq(t,n.contentWindow.document.documentElement);var s=n.contentWindow.document.documentElement?qb(t,getComputedStyle(n.contentWindow.document.documentElement).backgroundColor):TA.TRANSPARENT,a=n.contentWindow.document.body?qb(t,getComputedStyle(n.contentWindow.document.body).backgroundColor):TA.TRANSPARENT;i.backgroundColor=Dp(s)?Dp(a)?i.styles.backgroundColor:a:s}}catch{}return i}return e}(rA),HNe=["OL","UL","MENU"],OC=function(r,e,t,n){for(var i=e.firstChild,s=void 0;i;i=s)if(s=i.nextSibling,aq(i)&&i.data.trim().length>0)t.textNodes.push(new FNe(r,i,t.styles));else if(W0(i))if(fq(i)&&i.assignedNodes)i.assignedNodes().forEach(function(o){return OC(r,o,t,n)});else{var a=sq(r,i);a.styles.isVisible()&&(VNe(i,a,n)?a.flags|=4:GNe(a.styles)&&(a.flags|=2),HNe.indexOf(i.tagName)!==-1&&(a.flags|=8),t.elements.push(a),i.slot,i.shadowRoot?OC(r,i.shadowRoot,a,n):!UC(i)&&!lq(i)&&!NC(i)&&OC(r,i,a,n))}},sq=function(r,e){return F5(e)?new J7(r,e):cq(e)?new Z7(r,e):lq(e)?new Y7(r,e):QNe(e)?new eq(r,e):$Ne(e)?new S5(r,e):jNe(e)?new I5(r,e):NC(e)?new rq(r,e):UC(e)?new nq(r,e):hq(e)?new iq(r,e):new rA(r,e)},oq=function(r,e){var t=sq(r,e);return t.flags|=4,OC(r,e,t,t),t},VNe=function(r,e,t){return e.styles.isPositionedWithZIndex()||e.styles.opacity<1||e.styles.isTransformed()||P5(r)&&t.styles.isTransparent()},GNe=function(r){return r.isPositioned()||r.isFloating()},aq=function(r){return r.nodeType===Node.TEXT_NODE},W0=function(r){return r.nodeType===Node.ELEMENT_NODE},M5=function(r){return W0(r)&&typeof r.style<"u"&&!kC(r)},kC=function(r){return typeof r.className=="object"},QNe=function(r){return r.tagName==="LI"},$Ne=function(r){return r.tagName==="OL"},jNe=function(r){return r.tagName==="INPUT"},qNe=function(r){return r.tagName==="HTML"},lq=function(r){return r.tagName==="svg"},P5=function(r){return r.tagName==="BODY"},cq=function(r){return r.tagName==="CANVAS"},uq=function(r){return r.tagName==="VIDEO"},F5=function(r){return r.tagName==="IMG"},hq=function(r){return r.tagName==="IFRAME"},dq=function(r){return r.tagName==="STYLE"},KNe=function(r){return r.tagName==="SCRIPT"},UC=function(r){return r.tagName==="TEXTAREA"},NC=function(r){return r.tagName==="SELECT"},fq=function(r){return r.tagName==="SLOT"},Aq=function(r){return r.tagName.indexOf("-")>0},WNe=function(){function r(){this.counters={}}return r.prototype.getCounterValue=function(e){var t=this.counters[e];return t&&t.length?t[t.length-1]:1},r.prototype.getCounterValues=function(e){var t=this.counters[e];return t||[]},r.prototype.pop=function(e){var t=this;e.forEach(function(n){return t.counters[n].pop()})},r.prototype.parse=function(e){var t=this,n=e.counterIncrement,i=e.counterReset,s=!0;n!==null&&n.forEach(function(o){var h=t.counters[o.counter];h&&o.increment!==0&&(s=!1,h.length||h.push(1),h[Math.max(0,h.length-1)]+=o.increment)});var a=[];return s&&i.forEach(function(o){var h=t.counters[o.counter];a.push(o.counter),h||(h=t.counters[o.counter]=[]),h.push(o.reset)}),a},r}(),pq={integers:[1e3,900,500,400,100,90,50,40,10,9,5,4,1],values:["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"]},gq={integers:[9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},XNe={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,400,300,200,100,90,80,70,60,50,40,30,20,19,18,17,16,15,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},JNe={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},X0=function(r,e,t,n,i,s){return r<e||r>t?Zb(r,i,s.length>0):n.integers.reduce(function(a,o,h){for(;r>=o;)r-=o,a+=n.values[h];return a},"")+s},mq=function(r,e,t,n){var i="";do t||r--,i=n(r)+i,r/=e;while(r*e>=e);return i},za=function(r,e,t,n,i){var s=t-e+1;return(r<0?"-":"")+(mq(Math.abs(r),s,n,function(a){return Na(Math.floor(a%s)+e)})+i)},pm=function(r,e,t){t===void 0&&(t=". ");var n=e.length;return mq(Math.abs(r),n,!1,function(i){return e[Math.floor(i%n)]})+t},J0=1,kp=2,Up=4,Jb=8,SA=function(r,e,t,n,i,s){if(r<-9999||r>9999)return Zb(r,4,i.length>0);var a=Math.abs(r),o=i;if(a===0)return e[0]+o;for(var h=0;a>0&&h<=4;h++){var f=a%10;f===0&&Ll(s,J0)&&o!==""?o=e[f]+o:f>1||f===1&&h===0||f===1&&h===1&&Ll(s,kp)||f===1&&h===1&&Ll(s,Up)&&r>100||f===1&&h>1&&Ll(s,Jb)?o=e[f]+(h>0?t[h-1]:"")+o:f===1&&h>0&&(o=t[h-1]+o),a=Math.floor(a/10)}return(r<0?n:"")+o},_q="",yq="",bq="",R5="",Zb=function(r,e,t){var n=t?". ":"",i=t?"":"",s=t?", ":"",a=t?" ":"";switch(e){case 0:return""+a;case 1:return""+a;case 2:return""+a;case 5:var o=za(r,48,57,!0,n);return o.length<4?"0"+o:o;case 4:return pm(r,"",i);case 6:return X0(r,1,3999,pq,3,n).toLowerCase();case 7:return X0(r,1,3999,pq,3,n);case 8:return za(r,945,969,!1,n);case 9:return za(r,97,122,!1,n);case 10:return za(r,65,90,!1,n);case 11:return za(r,1632,1641,!0,n);case 12:case 49:return X0(r,1,9999,gq,3,n);case 35:return X0(r,1,9999,gq,3,n).toLowerCase();case 13:return za(r,2534,2543,!0,n);case 14:case 30:return za(r,6112,6121,!0,n);case 15:return pm(r,"",i);case 16:return pm(r,"",i);case 17:case 48:return SA(r,"",_q,"",i,kp|Up|Jb);case 47:return SA(r,"",yq,"",i,J0|kp|Up|Jb);case 42:return SA(r,"",_q,"",i,kp|Up|Jb);case 41:return SA(r,"",yq,"",i,J0|kp|Up|Jb);case 26:return SA(r,"","",bq,i,0);case 25:return SA(r,"","",bq,i,J0|kp|Up);case 31:return SA(r,"","",R5,s,J0|kp|Up);case 33:return SA(r,"","",R5,s,0);case 32:return SA(r,"","",R5,s,J0|kp|Up);case 18:return za(r,2406,2415,!0,n);case 20:return X0(r,1,19999,JNe,3,n);case 21:return za(r,2790,2799,!0,n);case 22:return za(r,2662,2671,!0,n);case 22:return X0(r,1,10999,XNe,3,n);case 23:return pm(r,"");case 24:return pm(r,"");case 27:return za(r,3302,3311,!0,n);case 28:return pm(r,"",i);case 29:return pm(r,"",i);case 34:return za(r,3792,3801,!0,n);case 37:return za(r,6160,6169,!0,n);case 38:return za(r,4160,4169,!0,n);case 39:return za(r,2918,2927,!0,n);case 40:return za(r,1776,1785,!0,n);case 43:return za(r,3046,3055,!0,n);case 44:return za(r,3174,3183,!0,n);case 45:return za(r,3664,3673,!0,n);case 46:return za(r,3872,3881,!0,n);case 3:default:return za(r,48,57,!0,n)}},vq="data-html2canvas-ignore",xq=function(){function r(e,t,n){if(this.context=e,this.options=n,this.scrolledElements=[],this.referenceElement=t,this.counters=new WNe,this.quoteDepth=0,!t.ownerDocument)throw new Error("Cloned element does not have an owner document");this.documentElement=this.cloneNode(t.ownerDocument.documentElement,!1)}return r.prototype.toIFrame=function(e,t){var n=this,i=ZNe(e,t);if(!i.contentWindow)return Promise.reject("Unable to find iframe window");var s=e.defaultView.pageXOffset,a=e.defaultView.pageYOffset,o=i.contentWindow,h=o.document,f=t6e(i).then(function(){return Pu(n,void 0,void 0,function(){var _,x;return au(this,function(T){switch(T.label){case 0:return this.scrolledElements.forEach(s6e),o&&(o.scrollTo(t.left,t.top),/(iPad|iPhone|iPod)/g.test(navigator.userAgent)&&(o.scrollY!==t.top||o.scrollX!==t.left)&&(this.context.logger.warn("Unable to restore scroll position for cloned document"),this.context.windowBounds=this.context.windowBounds.add(o.scrollX-t.left,o.scrollY-t.top,0,0))),_=this.options.onclone,x=this.clonedReferenceElement,typeof x>"u"?[2,Promise.reject("Error finding the "+this.referenceElement.nodeName+" in the cloned document")]:h.fonts&&h.fonts.ready?[4,h.fonts.ready]:[3,2];case 1:T.sent(),T.label=2;case 2:return/(AppleWebKit)/g.test(navigator.userAgent)?[4,e6e(h)]:[3,4];case 3:T.sent(),T.label=4;case 4:return typeof _=="function"?[2,Promise.resolve().then(function(){return _(h,x)}).then(function(){return i})]:[2,i]}})})});return h.open(),h.write(n6e(document.doctype)+"<html></html>"),i6e(this.referenceElement.ownerDocument,s,a),h.replaceChild(h.adoptNode(this.documentElement),h.documentElement),h.close(),f},r.prototype.createElementClone=function(e){if(m5(e,2))debugger;if(cq(e))return this.createCanvasClone(e);if(uq(e))return this.createVideoClone(e);if(dq(e))return this.createStyleClone(e);var t=e.cloneNode(!1);return F5(t)&&(F5(e)&&e.currentSrc&&e.currentSrc!==e.src&&(t.src=e.currentSrc,t.srcset=""),t.loading==="lazy"&&(t.loading="eager")),Aq(t)?this.createCustomElementClone(t):t},r.prototype.createCustomElementClone=function(e){var t=document.createElement("html2canvascustomelement");return L5(e.style,t),t},r.prototype.createStyleClone=function(e){try{var t=e.sheet;if(t&&t.cssRules){var n=[].slice.call(t.cssRules,0).reduce(function(s,a){return a&&typeof a.cssText=="string"?s+a.cssText:s},""),i=e.cloneNode(!1);return i.textContent=n,i}}catch(s){if(this.context.logger.error("Unable to access cssRules property",s),s.name!=="SecurityError")throw s}return e.cloneNode(!1)},r.prototype.createCanvasClone=function(e){var t;if(this.options.inlineImages&&e.ownerDocument){var n=e.ownerDocument.createElement("img");try{return n.src=e.toDataURL(),n}catch{this.context.logger.info("Unable to inline canvas contents, canvas is tainted",e)}}var i=e.cloneNode(!1);try{i.width=e.width,i.height=e.height;var s=e.getContext("2d"),a=i.getContext("2d");if(a)if(!this.options.allowTaint&&s)a.putImageData(s.getImageData(0,0,e.width,e.height),0,0);else{var o=(t=e.getContext("webgl2"))!==null&&t!==void 0?t:e.getContext("webgl");if(o){var h=o.getContextAttributes();(h==null?void 0:h.preserveDrawingBuffer)===!1&&this.context.logger.warn("Unable to clone WebGL context as it has preserveDrawingBuffer=false",e)}a.drawImage(e,0,0)}return i}catch{this.context.logger.info("Unable to clone canvas as it is tainted",e)}return i},r.prototype.createVideoClone=function(e){var t=e.ownerDocument.createElement("canvas");t.width=e.offsetWidth,t.height=e.offsetHeight;var n=t.getContext("2d");try{return n&&(n.drawImage(e,0,0,t.width,t.height),this.options.allowTaint||n.getImageData(0,0,t.width,t.height)),t}catch{this.context.logger.info("Unable to clone video as it is tainted",e)}var i=e.ownerDocument.createElement("canvas");return i.width=e.offsetWidth,i.height=e.offsetHeight,i},r.prototype.appendChildNode=function(e,t,n){(!W0(t)||!KNe(t)&&!t.hasAttribute(vq)&&(typeof this.options.ignoreElements!="function"||!this.options.ignoreElements(t)))&&(!this.options.copyStyles||!W0(t)||!dq(t))&&e.appendChild(this.cloneNode(t,n))},r.prototype.cloneChildNodes=function(e,t,n){for(var i=this,s=e.shadowRoot?e.shadowRoot.firstChild:e.firstChild;s;s=s.nextSibling)if(W0(s)&&fq(s)&&typeof s.assignedNodes=="function"){var a=s.assignedNodes();a.length&&a.forEach(function(o){return i.appendChildNode(t,o,n)})}else this.appendChildNode(t,s,n)},r.prototype.cloneNode=function(e,t){if(aq(e))return document.createTextNode(e.data);if(!e.ownerDocument)return e.cloneNode(!1);var n=e.ownerDocument.defaultView;if(n&&W0(e)&&(M5(e)||kC(e))){var i=this.createElementClone(e);i.style.transitionProperty="none";var s=n.getComputedStyle(e),a=n.getComputedStyle(e,":before"),o=n.getComputedStyle(e,":after");this.referenceElement===e&&M5(i)&&(this.clonedReferenceElement=i),P5(i)&&l6e(i);var h=this.counters.parse(new D7(this.context,s)),f=this.resolvePseudoContent(e,i,a,Yb.BEFORE);Aq(e)&&(t=!0),uq(e)||this.cloneChildNodes(e,i,t),f&&i.insertBefore(f,i.firstChild);var _=this.resolvePseudoContent(e,i,o,Yb.AFTER);return _&&i.appendChild(_),this.counters.pop(h),(s&&(this.options.copyStyles||kC(e))&&!hq(e)||t)&&L5(s,i),(e.scrollTop!==0||e.scrollLeft!==0)&&this.scrolledElements.push([i,e.scrollLeft,e.scrollTop]),(UC(e)||NC(e))&&(UC(i)||NC(i))&&(i.value=e.value),i}return e.cloneNode(!1)},r.prototype.resolvePseudoContent=function(e,t,n,i){var s=this;if(n){var a=n.content,o=t.ownerDocument;if(!(!o||!a||a==="none"||a==="-moz-alt-content"||n.display==="none")){this.counters.parse(new D7(this.context,n));var h=new QUe(this.context,n),f=o.createElement("html2canvaspseudoelement");L5(n,f),h.content.forEach(function(x){if(x.type===0)f.appendChild(o.createTextNode(x.value));else if(x.type===22){var T=o.createElement("img");T.src=x.value,T.style.opacity="1",f.appendChild(T)}else if(x.type===18){if(x.name==="attr"){var I=x.values.filter(ao);I.length&&f.appendChild(o.createTextNode(e.getAttribute(I[0].value)||""))}else if(x.name==="counter"){var N=x.values.filter(q0),$=N[0],W=N[1];if($&&ao($)){var Y=s.counters.getCounterValue($.value),ie=W&&ao(W)?g5.parse(s.context,W.value):3;f.appendChild(o.createTextNode(Zb(Y,ie,!1)))}}else if(x.name==="counters"){var ce=x.values.filter(q0),$=ce[0],fe=ce[1],W=ce[2];if($&&ao($)){var ve=s.counters.getCounterValues($.value),be=W&&ao(W)?g5.parse(s.context,W.value):3,Qe=fe&&fe.type===0?fe.value:"",Ue=ve.map(function(Le){return Zb(Le,be,!1)}).join(Qe);f.appendChild(o.createTextNode(Ue))}}}else if(x.type===20)switch(x.value){case"open-quote":f.appendChild(o.createTextNode(L7(h.quotes,s.quoteDepth++,!0)));break;case"close-quote":f.appendChild(o.createTextNode(L7(h.quotes,--s.quoteDepth,!1)));break;default:f.appendChild(o.createTextNode(x.value))}}),f.className=D5+" "+O5;var _=i===Yb.BEFORE?" "+D5:" "+O5;return kC(t)?t.className.baseValue+=_:t.className+=_,f}}},r.destroy=function(e){return e.parentNode?(e.parentNode.removeChild(e),!0):!1},r}(),Yb;(function(r){r[r.BEFORE=0]="BEFORE",r[r.AFTER=1]="AFTER"})(Yb||(Yb={}));var ZNe=function(r,e){var t=r.createElement("iframe");return t.className="html2canvas-container",t.style.visibility="hidden",t.style.position="fixed",t.style.left="-10000px",t.style.top="0px",t.style.border="0",t.width=e.width.toString(),t.height=e.height.toString(),t.scrolling="no",t.setAttribute(vq,"true"),r.body.appendChild(t),t},YNe=function(r){return new Promise(function(e){if(r.complete){e();return}if(!r.src){e();return}r.onload=e,r.onerror=e})},e6e=function(r){return Promise.all([].slice.call(r.images,0).map(YNe))},t6e=function(r){return new Promise(function(e,t){var n=r.contentWindow;if(!n)return t("No window assigned for iframe");var i=n.document;n.onload=r.onload=function(){n.onload=r.onload=null;var s=setInterval(function(){i.body.childNodes.length>0&&i.readyState==="complete"&&(clearInterval(s),e(r))},50)}})},r6e=["all","d","content"],L5=function(r,e){for(var t=r.length-1;t>=0;t--){var n=r.item(t);r6e.indexOf(n)===-1&&e.style.setProperty(n,r.getPropertyValue(n))}return e},n6e=function(r){var e="";return r&&(e+="<!DOCTYPE ",r.name&&(e+=r.name),r.internalSubset&&(e+=r.internalSubset),r.publicId&&(e+='"'+r.publicId+'"'),r.systemId&&(e+='"'+r.systemId+'"'),e+=">"),e},i6e=function(r,e,t){r&&r.defaultView&&(e!==r.defaultView.pageXOffset||t!==r.defaultView.pageYOffset)&&r.defaultView.scrollTo(e,t)},s6e=function(r){var e=r[0],t=r[1],n=r[2];e.scrollLeft=t,e.scrollTop=n},o6e=":before",a6e=":after",D5="___html2canvas___pseudoelement_before",O5="___html2canvas___pseudoelement_after",wq=`{
    content: "" !important;
    display: none !important;
}`,l6e=function(r){c6e(r,"."+D5+o6e+wq+`
         .`+O5+a6e+wq)},c6e=function(r,e){var t=r.ownerDocument;if(t){var n=t.createElement("style");n.textContent=e,r.appendChild(n)}},Bq=function(){function r(){}return r.getOrigin=function(e){var t=r._link;return t?(t.href=e,t.href=t.href,t.protocol+t.hostname+t.port):"about:blank"},r.isSameOrigin=function(e){return r.getOrigin(e)===r._origin},r.setContext=function(e){r._link=e.document.createElement("a"),r._origin=r.getOrigin(e.location.href)},r._origin="about:blank",r}(),u6e=function(){function r(e,t){this.context=e,this._options=t,this._cache={}}return r.prototype.addImage=function(e){var t=Promise.resolve();return this.has(e)||(U5(e)||A6e(e))&&(this._cache[e]=this.loadImage(e)).catch(function(){}),t},r.prototype.match=function(e){return this._cache[e]},r.prototype.loadImage=function(e){return Pu(this,void 0,void 0,function(){var t,n,i,s,a=this;return au(this,function(o){switch(o.label){case 0:return t=Bq.isSameOrigin(e),n=!k5(e)&&this._options.useCORS===!0&&Ec.SUPPORT_CORS_IMAGES&&!t,i=!k5(e)&&!t&&!U5(e)&&typeof this._options.proxy=="string"&&Ec.SUPPORT_CORS_XHR&&!n,!t&&this._options.allowTaint===!1&&!k5(e)&&!U5(e)&&!i&&!n?[2]:(s=e,i?[4,this.proxy(s)]:[3,2]);case 1:s=o.sent(),o.label=2;case 2:return this.context.logger.debug("Added image "+e.substring(0,256)),[4,new Promise(function(h,f){var _=new Image;_.onload=function(){return h(_)},_.onerror=f,(p6e(s)||n)&&(_.crossOrigin="anonymous"),_.src=s,_.complete===!0&&setTimeout(function(){return h(_)},500),a._options.imageTimeout>0&&setTimeout(function(){return f("Timed out ("+a._options.imageTimeout+"ms) loading image")},a._options.imageTimeout)})];case 3:return[2,o.sent()]}})})},r.prototype.has=function(e){return typeof this._cache[e]<"u"},r.prototype.keys=function(){return Promise.resolve(Object.keys(this._cache))},r.prototype.proxy=function(e){var t=this,n=this._options.proxy;if(!n)throw new Error("No proxy defined");var i=e.substring(0,256);return new Promise(function(s,a){var o=Ec.SUPPORT_RESPONSE_TYPE?"blob":"text",h=new XMLHttpRequest;h.onload=function(){if(h.status===200)if(o==="text")s(h.response);else{var x=new FileReader;x.addEventListener("load",function(){return s(x.result)},!1),x.addEventListener("error",function(T){return a(T)},!1),x.readAsDataURL(h.response)}else a("Failed to proxy resource "+i+" with status code "+h.status)},h.onerror=a;var f=n.indexOf("?")>-1?"&":"?";if(h.open("GET",""+n+f+"url="+encodeURIComponent(e)+"&responseType="+o),o!=="text"&&h instanceof XMLHttpRequest&&(h.responseType=o),t._options.imageTimeout){var _=t._options.imageTimeout;h.timeout=_,h.ontimeout=function(){return a("Timed out ("+_+"ms) proxying "+i)}}h.send()})},r}(),h6e=/^data:image\/svg\+xml/i,d6e=/^data:image\/.*;base64,/i,f6e=/^data:image\/.*/i,A6e=function(r){return Ec.SUPPORT_SVG_DRAWING||!g6e(r)},k5=function(r){return f6e.test(r)},p6e=function(r){return d6e.test(r)},U5=function(r){return r.substr(0,4)==="blob"},g6e=function(r){return r.substr(-3).toLowerCase()==="svg"||h6e.test(r)},kn=function(){function r(e,t){this.type=0,this.x=e,this.y=t}return r.prototype.add=function(e,t){return new r(this.x+e,this.y+t)},r}(),Z0=function(r,e,t){return new kn(r.x+(e.x-r.x)*t,r.y+(e.y-r.y)*t)},zC=function(){function r(e,t,n,i){this.type=1,this.start=e,this.startControl=t,this.endControl=n,this.end=i}return r.prototype.subdivide=function(e,t){var n=Z0(this.start,this.startControl,e),i=Z0(this.startControl,this.endControl,e),s=Z0(this.endControl,this.end,e),a=Z0(n,i,e),o=Z0(i,s,e),h=Z0(a,o,e);return t?new r(this.start,n,a,h):new r(h,o,s,this.end)},r.prototype.add=function(e,t){return new r(this.start.add(e,t),this.startControl.add(e,t),this.endControl.add(e,t),this.end.add(e,t))},r.prototype.reverse=function(){return new r(this.end,this.endControl,this.startControl,this.start)},r}(),md=function(r){return r.type===1},m6e=function(){function r(e){var t=e.styles,n=e.bounds,i=jb(t.borderTopLeftRadius,n.width,n.height),s=i[0],a=i[1],o=jb(t.borderTopRightRadius,n.width,n.height),h=o[0],f=o[1],_=jb(t.borderBottomRightRadius,n.width,n.height),x=_[0],T=_[1],I=jb(t.borderBottomLeftRadius,n.width,n.height),N=I[0],$=I[1],W=[];W.push((s+h)/n.width),W.push((N+x)/n.width),W.push((a+$)/n.height),W.push((f+T)/n.height);var Y=Math.max.apply(Math,W);Y>1&&(s/=Y,a/=Y,h/=Y,f/=Y,x/=Y,T/=Y,N/=Y,$/=Y);var ie=n.width-h,ce=n.height-T,fe=n.width-x,ve=n.height-$,be=t.borderTopWidth,Qe=t.borderRightWidth,Ue=t.borderBottomWidth,st=t.borderLeftWidth,at=yo(t.paddingTop,e.bounds.width),Le=yo(t.paddingRight,e.bounds.width),ze=yo(t.paddingBottom,e.bounds.width),tt=yo(t.paddingLeft,e.bounds.width);this.topLeftBorderDoubleOuterBox=s>0||a>0?$o(n.left+st/3,n.top+be/3,s-st/3,a-be/3,js.TOP_LEFT):new kn(n.left+st/3,n.top+be/3),this.topRightBorderDoubleOuterBox=s>0||a>0?$o(n.left+ie,n.top+be/3,h-Qe/3,f-be/3,js.TOP_RIGHT):new kn(n.left+n.width-Qe/3,n.top+be/3),this.bottomRightBorderDoubleOuterBox=x>0||T>0?$o(n.left+fe,n.top+ce,x-Qe/3,T-Ue/3,js.BOTTOM_RIGHT):new kn(n.left+n.width-Qe/3,n.top+n.height-Ue/3),this.bottomLeftBorderDoubleOuterBox=N>0||$>0?$o(n.left+st/3,n.top+ve,N-st/3,$-Ue/3,js.BOTTOM_LEFT):new kn(n.left+st/3,n.top+n.height-Ue/3),this.topLeftBorderDoubleInnerBox=s>0||a>0?$o(n.left+st*2/3,n.top+be*2/3,s-st*2/3,a-be*2/3,js.TOP_LEFT):new kn(n.left+st*2/3,n.top+be*2/3),this.topRightBorderDoubleInnerBox=s>0||a>0?$o(n.left+ie,n.top+be*2/3,h-Qe*2/3,f-be*2/3,js.TOP_RIGHT):new kn(n.left+n.width-Qe*2/3,n.top+be*2/3),this.bottomRightBorderDoubleInnerBox=x>0||T>0?$o(n.left+fe,n.top+ce,x-Qe*2/3,T-Ue*2/3,js.BOTTOM_RIGHT):new kn(n.left+n.width-Qe*2/3,n.top+n.height-Ue*2/3),this.bottomLeftBorderDoubleInnerBox=N>0||$>0?$o(n.left+st*2/3,n.top+ve,N-st*2/3,$-Ue*2/3,js.BOTTOM_LEFT):new kn(n.left+st*2/3,n.top+n.height-Ue*2/3),this.topLeftBorderStroke=s>0||a>0?$o(n.left+st/2,n.top+be/2,s-st/2,a-be/2,js.TOP_LEFT):new kn(n.left+st/2,n.top+be/2),this.topRightBorderStroke=s>0||a>0?$o(n.left+ie,n.top+be/2,h-Qe/2,f-be/2,js.TOP_RIGHT):new kn(n.left+n.width-Qe/2,n.top+be/2),this.bottomRightBorderStroke=x>0||T>0?$o(n.left+fe,n.top+ce,x-Qe/2,T-Ue/2,js.BOTTOM_RIGHT):new kn(n.left+n.width-Qe/2,n.top+n.height-Ue/2),this.bottomLeftBorderStroke=N>0||$>0?$o(n.left+st/2,n.top+ve,N-st/2,$-Ue/2,js.BOTTOM_LEFT):new kn(n.left+st/2,n.top+n.height-Ue/2),this.topLeftBorderBox=s>0||a>0?$o(n.left,n.top,s,a,js.TOP_LEFT):new kn(n.left,n.top),this.topRightBorderBox=h>0||f>0?$o(n.left+ie,n.top,h,f,js.TOP_RIGHT):new kn(n.left+n.width,n.top),this.bottomRightBorderBox=x>0||T>0?$o(n.left+fe,n.top+ce,x,T,js.BOTTOM_RIGHT):new kn(n.left+n.width,n.top+n.height),this.bottomLeftBorderBox=N>0||$>0?$o(n.left,n.top+ve,N,$,js.BOTTOM_LEFT):new kn(n.left,n.top+n.height),this.topLeftPaddingBox=s>0||a>0?$o(n.left+st,n.top+be,Math.max(0,s-st),Math.max(0,a-be),js.TOP_LEFT):new kn(n.left+st,n.top+be),this.topRightPaddingBox=h>0||f>0?$o(n.left+Math.min(ie,n.width-Qe),n.top+be,ie>n.width+Qe?0:Math.max(0,h-Qe),Math.max(0,f-be),js.TOP_RIGHT):new kn(n.left+n.width-Qe,n.top+be),this.bottomRightPaddingBox=x>0||T>0?$o(n.left+Math.min(fe,n.width-st),n.top+Math.min(ce,n.height-Ue),Math.max(0,x-Qe),Math.max(0,T-Ue),js.BOTTOM_RIGHT):new kn(n.left+n.width-Qe,n.top+n.height-Ue),this.bottomLeftPaddingBox=N>0||$>0?$o(n.left+st,n.top+Math.min(ve,n.height-Ue),Math.max(0,N-st),Math.max(0,$-Ue),js.BOTTOM_LEFT):new kn(n.left+st,n.top+n.height-Ue),this.topLeftContentBox=s>0||a>0?$o(n.left+st+tt,n.top+be+at,Math.max(0,s-(st+tt)),Math.max(0,a-(be+at)),js.TOP_LEFT):new kn(n.left+st+tt,n.top+be+at),this.topRightContentBox=h>0||f>0?$o(n.left+Math.min(ie,n.width+st+tt),n.top+be+at,ie>n.width+st+tt?0:h-st+tt,f-(be+at),js.TOP_RIGHT):new kn(n.left+n.width-(Qe+Le),n.top+be+at),this.bottomRightContentBox=x>0||T>0?$o(n.left+Math.min(fe,n.width-(st+tt)),n.top+Math.min(ce,n.height+be+at),Math.max(0,x-(Qe+Le)),T-(Ue+ze),js.BOTTOM_RIGHT):new kn(n.left+n.width-(Qe+Le),n.top+n.height-(Ue+ze)),this.bottomLeftContentBox=N>0||$>0?$o(n.left+st+tt,n.top+ve,Math.max(0,N-(st+tt)),$-(Ue+ze),js.BOTTOM_LEFT):new kn(n.left+st+tt,n.top+n.height-(Ue+ze))}return r}(),js;(function(r){r[r.TOP_LEFT=0]="TOP_LEFT",r[r.TOP_RIGHT=1]="TOP_RIGHT",r[r.BOTTOM_RIGHT=2]="BOTTOM_RIGHT",r[r.BOTTOM_LEFT=3]="BOTTOM_LEFT"})(js||(js={}));var $o=function(r,e,t,n,i){var s=4*((Math.sqrt(2)-1)/3),a=t*s,o=n*s,h=r+t,f=e+n;switch(i){case js.TOP_LEFT:return new zC(new kn(r,f),new kn(r,f-o),new kn(h-a,e),new kn(h,e));case js.TOP_RIGHT:return new zC(new kn(r,e),new kn(r+a,e),new kn(h,f-o),new kn(h,f));case js.BOTTOM_RIGHT:return new zC(new kn(h,e),new kn(h,e+o),new kn(r+a,f),new kn(r,f));case js.BOTTOM_LEFT:default:return new zC(new kn(h,f),new kn(h-a,f),new kn(r,e+o),new kn(r,e))}},HC=function(r){return[r.topLeftBorderBox,r.topRightBorderBox,r.bottomRightBorderBox,r.bottomLeftBorderBox]},_6e=function(r){return[r.topLeftContentBox,r.topRightContentBox,r.bottomRightContentBox,r.bottomLeftContentBox]},VC=function(r){return[r.topLeftPaddingBox,r.topRightPaddingBox,r.bottomRightPaddingBox,r.bottomLeftPaddingBox]},y6e=function(){function r(e,t,n){this.offsetX=e,this.offsetY=t,this.matrix=n,this.type=0,this.target=6}return r}(),GC=function(){function r(e,t){this.path=e,this.target=t,this.type=1}return r}(),b6e=function(){function r(e){this.opacity=e,this.type=2,this.target=6}return r}(),v6e=function(r){return r.type===0},Cq=function(r){return r.type===1},x6e=function(r){return r.type===2},Eq=function(r,e){return r.length===e.length?r.some(function(t,n){return t===e[n]}):!1},w6e=function(r,e,t,n,i){return r.map(function(s,a){switch(a){case 0:return s.add(e,t);case 1:return s.add(e+n,t);case 2:return s.add(e+n,t+i);case 3:return s.add(e,t+i)}return s})},Tq=function(){function r(e){this.element=e,this.inlineLevel=[],this.nonInlineLevel=[],this.negativeZIndex=[],this.zeroOrAutoZIndexOrTransformedOrOpacity=[],this.positiveZIndex=[],this.nonPositionedFloats=[],this.nonPositionedInlineLevel=[]}return r}(),Sq=function(){function r(e,t){if(this.container=e,this.parent=t,this.effects=[],this.curves=new m6e(this.container),this.container.styles.opacity<1&&this.effects.push(new b6e(this.container.styles.opacity)),this.container.styles.transform!==null){var n=this.container.bounds.left+this.container.styles.transformOrigin[0].number,i=this.container.bounds.top+this.container.styles.transformOrigin[1].number,s=this.container.styles.transform;this.effects.push(new y6e(n,i,s))}if(this.container.styles.overflowX!==0){var a=HC(this.curves),o=VC(this.curves);Eq(a,o)?this.effects.push(new GC(a,6)):(this.effects.push(new GC(a,2)),this.effects.push(new GC(o,4)))}}return r.prototype.getEffects=function(e){for(var t=[2,3].indexOf(this.container.styles.position)===-1,n=this.parent,i=this.effects.slice(0);n;){var s=n.effects.filter(function(h){return!Cq(h)});if(t||n.container.styles.position!==0||!n.parent){if(i.unshift.apply(i,s),t=[2,3].indexOf(n.container.styles.position)===-1,n.container.styles.overflowX!==0){var a=HC(n.curves),o=VC(n.curves);Eq(a,o)||i.unshift(new GC(o,6))}}else i.unshift.apply(i,s);n=n.parent}return i.filter(function(h){return Ll(h.target,e)})},r}(),N5=function(r,e,t,n){r.container.elements.forEach(function(i){var s=Ll(i.flags,4),a=Ll(i.flags,2),o=new Sq(i,r);Ll(i.styles.display,2048)&&n.push(o);var h=Ll(i.flags,8)?[]:n;if(s||a){var f=s||i.styles.isPositioned()?t:e,_=new Tq(o);if(i.styles.isPositioned()||i.styles.opacity<1||i.styles.isTransformed()){var x=i.styles.zIndex.order;if(x<0){var T=0;f.negativeZIndex.some(function(N,$){return x>N.element.container.styles.zIndex.order?(T=$,!1):T>0}),f.negativeZIndex.splice(T,0,_)}else if(x>0){var I=0;f.positiveZIndex.some(function(N,$){return x>=N.element.container.styles.zIndex.order?(I=$+1,!1):I>0}),f.positiveZIndex.splice(I,0,_)}else f.zeroOrAutoZIndexOrTransformedOrOpacity.push(_)}else i.styles.isFloating()?f.nonPositionedFloats.push(_):f.nonPositionedInlineLevel.push(_);N5(o,_,s?_:t,h)}else i.styles.isInlineLevel()?e.inlineLevel.push(o):e.nonInlineLevel.push(o),N5(o,e,t,h);Ll(i.flags,8)&&Iq(i,h)})},Iq=function(r,e){for(var t=r instanceof S5?r.start:1,n=r instanceof S5?r.reversed:!1,i=0;i<e.length;i++){var s=e[i];s.container instanceof eq&&typeof s.container.value=="number"&&s.container.value!==0&&(t=s.container.value),s.listValue=Zb(t,s.container.styles.listStyleType,!0),t+=n?-1:1}},B6e=function(r){var e=new Sq(r,null),t=new Tq(e),n=[];return N5(e,t,t,n),Iq(e.container,n),t},Mq=function(r,e){switch(e){case 0:return _d(r.topLeftBorderBox,r.topLeftPaddingBox,r.topRightBorderBox,r.topRightPaddingBox);case 1:return _d(r.topRightBorderBox,r.topRightPaddingBox,r.bottomRightBorderBox,r.bottomRightPaddingBox);case 2:return _d(r.bottomRightBorderBox,r.bottomRightPaddingBox,r.bottomLeftBorderBox,r.bottomLeftPaddingBox);case 3:default:return _d(r.bottomLeftBorderBox,r.bottomLeftPaddingBox,r.topLeftBorderBox,r.topLeftPaddingBox)}},C6e=function(r,e){switch(e){case 0:return _d(r.topLeftBorderBox,r.topLeftBorderDoubleOuterBox,r.topRightBorderBox,r.topRightBorderDoubleOuterBox);case 1:return _d(r.topRightBorderBox,r.topRightBorderDoubleOuterBox,r.bottomRightBorderBox,r.bottomRightBorderDoubleOuterBox);case 2:return _d(r.bottomRightBorderBox,r.bottomRightBorderDoubleOuterBox,r.bottomLeftBorderBox,r.bottomLeftBorderDoubleOuterBox);case 3:default:return _d(r.bottomLeftBorderBox,r.bottomLeftBorderDoubleOuterBox,r.topLeftBorderBox,r.topLeftBorderDoubleOuterBox)}},E6e=function(r,e){switch(e){case 0:return _d(r.topLeftBorderDoubleInnerBox,r.topLeftPaddingBox,r.topRightBorderDoubleInnerBox,r.topRightPaddingBox);case 1:return _d(r.topRightBorderDoubleInnerBox,r.topRightPaddingBox,r.bottomRightBorderDoubleInnerBox,r.bottomRightPaddingBox);case 2:return _d(r.bottomRightBorderDoubleInnerBox,r.bottomRightPaddingBox,r.bottomLeftBorderDoubleInnerBox,r.bottomLeftPaddingBox);case 3:default:return _d(r.bottomLeftBorderDoubleInnerBox,r.bottomLeftPaddingBox,r.topLeftBorderDoubleInnerBox,r.topLeftPaddingBox)}},T6e=function(r,e){switch(e){case 0:return QC(r.topLeftBorderStroke,r.topRightBorderStroke);case 1:return QC(r.topRightBorderStroke,r.bottomRightBorderStroke);case 2:return QC(r.bottomRightBorderStroke,r.bottomLeftBorderStroke);case 3:default:return QC(r.bottomLeftBorderStroke,r.topLeftBorderStroke)}},QC=function(r,e){var t=[];return md(r)?t.push(r.subdivide(.5,!1)):t.push(r),md(e)?t.push(e.subdivide(.5,!0)):t.push(e),t},_d=function(r,e,t,n){var i=[];return md(r)?i.push(r.subdivide(.5,!1)):i.push(r),md(t)?i.push(t.subdivide(.5,!0)):i.push(t),md(n)?i.push(n.subdivide(.5,!0).reverse()):i.push(n),md(e)?i.push(e.subdivide(.5,!1).reverse()):i.push(e),i},Pq=function(r){var e=r.bounds,t=r.styles;return e.add(t.borderLeftWidth,t.borderTopWidth,-(t.borderRightWidth+t.borderLeftWidth),-(t.borderTopWidth+t.borderBottomWidth))},$C=function(r){var e=r.styles,t=r.bounds,n=yo(e.paddingLeft,t.width),i=yo(e.paddingRight,t.width),s=yo(e.paddingTop,t.width),a=yo(e.paddingBottom,t.width);return t.add(n+e.borderLeftWidth,s+e.borderTopWidth,-(e.borderRightWidth+e.borderLeftWidth+n+i),-(e.borderTopWidth+e.borderBottomWidth+s+a))},S6e=function(r,e){return r===0?e.bounds:r===2?$C(e):Pq(e)},I6e=function(r,e){return r===0?e.bounds:r===2?$C(e):Pq(e)},z5=function(r,e,t){var n=S6e(ey(r.styles.backgroundOrigin,e),r),i=I6e(ey(r.styles.backgroundClip,e),r),s=M6e(ey(r.styles.backgroundSize,e),t,n),a=s[0],o=s[1],h=jb(ey(r.styles.backgroundPosition,e),n.width-a,n.height-o),f=P6e(ey(r.styles.backgroundRepeat,e),h,s,n,i),_=Math.round(n.left+h[0]),x=Math.round(n.top+h[1]);return[f,_,x,a,o]},Y0=function(r){return ao(r)&&r.value===K0.AUTO},jC=function(r){return typeof r=="number"},M6e=function(r,e,t){var n=e[0],i=e[1],s=e[2],a=r[0],o=r[1];if(!a)return[0,0];if(dl(a)&&o&&dl(o))return[yo(a,t.width),yo(o,t.height)];var h=jC(s);if(ao(a)&&(a.value===K0.CONTAIN||a.value===K0.COVER)){if(jC(s)){var f=t.width/t.height;return f<s!=(a.value===K0.COVER)?[t.width,t.width/s]:[t.height*s,t.height]}return[t.width,t.height]}var _=jC(n),x=jC(i),T=_||x;if(Y0(a)&&(!o||Y0(o))){if(_&&x)return[n,i];if(!h&&!T)return[t.width,t.height];if(T&&h){var I=_?n:i*s,N=x?i:n/s;return[I,N]}var $=_?n:t.width,W=x?i:t.height;return[$,W]}if(h){var Y=0,ie=0;return dl(a)?Y=yo(a,t.width):dl(o)&&(ie=yo(o,t.height)),Y0(a)?Y=ie*s:(!o||Y0(o))&&(ie=Y/s),[Y,ie]}var ce=null,fe=null;if(dl(a)?ce=yo(a,t.width):o&&dl(o)&&(fe=yo(o,t.height)),ce!==null&&(!o||Y0(o))&&(fe=_&&x?ce/n*i:t.height),fe!==null&&Y0(a)&&(ce=_&&x?fe/i*n:t.width),ce!==null&&fe!==null)return[ce,fe];throw new Error("Unable to calculate background-size for element")},ey=function(r,e){var t=r[e];return typeof t>"u"?r[0]:t},P6e=function(r,e,t,n,i){var s=e[0],a=e[1],o=t[0],h=t[1];switch(r){case 2:return[new kn(Math.round(n.left),Math.round(n.top+a)),new kn(Math.round(n.left+n.width),Math.round(n.top+a)),new kn(Math.round(n.left+n.width),Math.round(h+n.top+a)),new kn(Math.round(n.left),Math.round(h+n.top+a))];case 3:return[new kn(Math.round(n.left+s),Math.round(n.top)),new kn(Math.round(n.left+s+o),Math.round(n.top)),new kn(Math.round(n.left+s+o),Math.round(n.height+n.top)),new kn(Math.round(n.left+s),Math.round(n.height+n.top))];case 1:return[new kn(Math.round(n.left+s),Math.round(n.top+a)),new kn(Math.round(n.left+s+o),Math.round(n.top+a)),new kn(Math.round(n.left+s+o),Math.round(n.top+a+h)),new kn(Math.round(n.left+s),Math.round(n.top+a+h))];default:return[new kn(Math.round(i.left),Math.round(i.top)),new kn(Math.round(i.left+i.width),Math.round(i.top)),new kn(Math.round(i.left+i.width),Math.round(i.height+i.top)),new kn(Math.round(i.left),Math.round(i.height+i.top))]}},F6e="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",Fq="Hidden Text",R6e=function(){function r(e){this._data={},this._document=e}return r.prototype.parseMetrics=function(e,t){var n=this._document.createElement("div"),i=this._document.createElement("img"),s=this._document.createElement("span"),a=this._document.body;n.style.visibility="hidden",n.style.fontFamily=e,n.style.fontSize=t,n.style.margin="0",n.style.padding="0",n.style.whiteSpace="nowrap",a.appendChild(n),i.src=F6e,i.width=1,i.height=1,i.style.margin="0",i.style.padding="0",i.style.verticalAlign="baseline",s.style.fontFamily=e,s.style.fontSize=t,s.style.margin="0",s.style.padding="0",s.appendChild(this._document.createTextNode(Fq)),n.appendChild(s),n.appendChild(i);var o=i.offsetTop-s.offsetTop+2;n.removeChild(s),n.appendChild(this._document.createTextNode(Fq)),n.style.lineHeight="normal",i.style.verticalAlign="super";var h=i.offsetTop-n.offsetTop+2;return a.removeChild(n),{baseline:o,middle:h}},r.prototype.getMetrics=function(e,t){var n=e+" "+t;return typeof this._data[n]>"u"&&(this._data[n]=this.parseMetrics(e,t)),this._data[n]},r}(),Rq=function(){function r(e,t){this.context=e,this.options=t}return r}(),L6e=1e4,D6e=function(r){lf(e,r);function e(t,n){var i=r.call(this,t,n)||this;return i._activeEffects=[],i.canvas=n.canvas?n.canvas:document.createElement("canvas"),i.ctx=i.canvas.getContext("2d"),n.canvas||(i.canvas.width=Math.floor(n.width*n.scale),i.canvas.height=Math.floor(n.height*n.scale),i.canvas.style.width=n.width+"px",i.canvas.style.height=n.height+"px"),i.fontMetrics=new R6e(document),i.ctx.scale(i.options.scale,i.options.scale),i.ctx.translate(-n.x,-n.y),i.ctx.textBaseline="bottom",i._activeEffects=[],i.context.logger.debug("Canvas renderer initialized ("+n.width+"x"+n.height+") with scale "+n.scale),i}return e.prototype.applyEffects=function(t){for(var n=this;this._activeEffects.length;)this.popEffect();t.forEach(function(i){return n.applyEffect(i)})},e.prototype.applyEffect=function(t){this.ctx.save(),x6e(t)&&(this.ctx.globalAlpha=t.opacity),v6e(t)&&(this.ctx.translate(t.offsetX,t.offsetY),this.ctx.transform(t.matrix[0],t.matrix[1],t.matrix[2],t.matrix[3],t.matrix[4],t.matrix[5]),this.ctx.translate(-t.offsetX,-t.offsetY)),Cq(t)&&(this.path(t.path),this.ctx.clip()),this._activeEffects.push(t)},e.prototype.popEffect=function(){this._activeEffects.pop(),this.ctx.restore()},e.prototype.renderStack=function(t){return Pu(this,void 0,void 0,function(){var n;return au(this,function(i){switch(i.label){case 0:return n=t.element.container.styles,n.isVisible()?[4,this.renderStackContent(t)]:[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}})})},e.prototype.renderNode=function(t){return Pu(this,void 0,void 0,function(){return au(this,function(n){switch(n.label){case 0:if(Ll(t.container.flags,16))debugger;return t.container.styles.isVisible()?[4,this.renderNodeBackgroundAndBorders(t)]:[3,3];case 1:return n.sent(),[4,this.renderNodeContent(t)];case 2:n.sent(),n.label=3;case 3:return[2]}})})},e.prototype.renderTextWithLetterSpacing=function(t,n,i){var s=this;if(n===0)this.ctx.fillText(t.text,t.bounds.left,t.bounds.top+i);else{var a=T5(t.text);a.reduce(function(o,h){return s.ctx.fillText(h,o,t.bounds.top+i),o+s.ctx.measureText(h).width},t.bounds.left)}},e.prototype.createFontStyle=function(t){var n=t.fontVariant.filter(function(a){return a==="normal"||a==="small-caps"}).join(""),i=z6e(t.fontFamily).join(", "),s=$b(t.fontSize)?""+t.fontSize.number+t.fontSize.unit:t.fontSize.number+"px";return[[t.fontStyle,n,t.fontWeight,s,i].join(" "),i,s]},e.prototype.renderTextNode=function(t,n){return Pu(this,void 0,void 0,function(){var i,s,a,o,h,f,_,x,T=this;return au(this,function(I){return i=this.createFontStyle(n),s=i[0],a=i[1],o=i[2],this.ctx.font=s,this.ctx.direction=n.direction===1?"rtl":"ltr",this.ctx.textAlign="left",this.ctx.textBaseline="alphabetic",h=this.fontMetrics.getMetrics(a,o),f=h.baseline,_=h.middle,x=n.paintOrder,t.textBounds.forEach(function(N){x.forEach(function($){switch($){case 0:T.ctx.fillStyle=ic(n.color),T.renderTextWithLetterSpacing(N,n.letterSpacing,f);var W=n.textShadow;W.length&&N.text.trim().length&&(W.slice(0).reverse().forEach(function(Y){T.ctx.shadowColor=ic(Y.color),T.ctx.shadowOffsetX=Y.offsetX.number*T.options.scale,T.ctx.shadowOffsetY=Y.offsetY.number*T.options.scale,T.ctx.shadowBlur=Y.blur.number,T.renderTextWithLetterSpacing(N,n.letterSpacing,f)}),T.ctx.shadowColor="",T.ctx.shadowOffsetX=0,T.ctx.shadowOffsetY=0,T.ctx.shadowBlur=0),n.textDecorationLine.length&&(T.ctx.fillStyle=ic(n.textDecorationColor||n.color),n.textDecorationLine.forEach(function(Y){switch(Y){case 1:T.ctx.fillRect(N.bounds.left,Math.round(N.bounds.top+f),N.bounds.width,1);break;case 2:T.ctx.fillRect(N.bounds.left,Math.round(N.bounds.top),N.bounds.width,1);break;case 3:T.ctx.fillRect(N.bounds.left,Math.ceil(N.bounds.top+_),N.bounds.width,1);break}}));break;case 1:n.webkitTextStrokeWidth&&N.text.trim().length&&(T.ctx.strokeStyle=ic(n.webkitTextStrokeColor),T.ctx.lineWidth=n.webkitTextStrokeWidth,T.ctx.lineJoin=window.chrome?"miter":"round",T.ctx.strokeText(N.text,N.bounds.left,N.bounds.top+f)),T.ctx.strokeStyle="",T.ctx.lineWidth=0,T.ctx.lineJoin="miter";break}})}),[2]})})},e.prototype.renderReplacedElement=function(t,n,i){if(i&&t.intrinsicWidth>0&&t.intrinsicHeight>0){var s=$C(t),a=VC(n);this.path(a),this.ctx.save(),this.ctx.clip(),this.ctx.drawImage(i,0,0,t.intrinsicWidth,t.intrinsicHeight,s.left,s.top,s.width,s.height),this.ctx.restore()}},e.prototype.renderNodeContent=function(t){return Pu(this,void 0,void 0,function(){var n,i,s,a,o,h,ie,ie,f,_,x,T,fe,I,N,ve,$,W,Y,ie,ce,fe,ve;return au(this,function(be){switch(be.label){case 0:this.applyEffects(t.getEffects(4)),n=t.container,i=t.curves,s=n.styles,a=0,o=n.textNodes,be.label=1;case 1:return a<o.length?(h=o[a],[4,this.renderTextNode(h,s)]):[3,4];case 2:be.sent(),be.label=3;case 3:return a++,[3,1];case 4:if(!(n instanceof J7))return[3,8];be.label=5;case 5:return be.trys.push([5,7,,8]),[4,this.context.cache.match(n.src)];case 6:return ie=be.sent(),this.renderReplacedElement(n,i,ie),[3,8];case 7:return be.sent(),this.context.logger.error("Error loading image "+n.src),[3,8];case 8:if(n instanceof Z7&&this.renderReplacedElement(n,i,n.canvas),!(n instanceof Y7))return[3,12];be.label=9;case 9:return be.trys.push([9,11,,12]),[4,this.context.cache.match(n.svg)];case 10:return ie=be.sent(),this.renderReplacedElement(n,i,ie),[3,12];case 11:return be.sent(),this.context.logger.error("Error loading svg "+n.svg.substring(0,255)),[3,12];case 12:return n instanceof iq&&n.tree?(f=new e(this.context,{scale:this.options.scale,backgroundColor:n.backgroundColor,x:0,y:0,width:n.width,height:n.height}),[4,f.render(n.tree)]):[3,14];case 13:_=be.sent(),n.width&&n.height&&this.ctx.drawImage(_,0,0,n.width,n.height,n.bounds.left,n.bounds.top,n.bounds.width,n.bounds.height),be.label=14;case 14:if(n instanceof I5&&(x=Math.min(n.bounds.width,n.bounds.height),n.type===LC?n.checked&&(this.ctx.save(),this.path([new kn(n.bounds.left+x*.39363,n.bounds.top+x*.79),new kn(n.bounds.left+x*.16,n.bounds.top+x*.5549),new kn(n.bounds.left+x*.27347,n.bounds.top+x*.44071),new kn(n.bounds.left+x*.39694,n.bounds.top+x*.5649),new kn(n.bounds.left+x*.72983,n.bounds.top+x*.23),new kn(n.bounds.left+x*.84,n.bounds.top+x*.34085),new kn(n.bounds.left+x*.39363,n.bounds.top+x*.79)]),this.ctx.fillStyle=ic(tq),this.ctx.fill(),this.ctx.restore()):n.type===DC&&n.checked&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(n.bounds.left+x/2,n.bounds.top+x/2,x/4,0,Math.PI*2,!0),this.ctx.fillStyle=ic(tq),this.ctx.fill(),this.ctx.restore())),O6e(n)&&n.value.length){switch(T=this.createFontStyle(s),fe=T[0],I=T[1],N=this.fontMetrics.getMetrics(fe,I).baseline,this.ctx.font=fe,this.ctx.fillStyle=ic(s.color),this.ctx.textBaseline="alphabetic",this.ctx.textAlign=U6e(n.styles.textAlign),ve=$C(n),$=0,n.styles.textAlign){case 1:$+=ve.width/2;break;case 2:$+=ve.width;break}W=ve.add($,0,0,-ve.height/2+1),this.ctx.save(),this.path([new kn(ve.left,ve.top),new kn(ve.left+ve.width,ve.top),new kn(ve.left+ve.width,ve.top+ve.height),new kn(ve.left,ve.top+ve.height)]),this.ctx.clip(),this.renderTextWithLetterSpacing(new Xb(n.value,W),s.letterSpacing,N),this.ctx.restore(),this.ctx.textBaseline="alphabetic",this.ctx.textAlign="left"}if(!Ll(n.styles.display,2048))return[3,20];if(n.styles.listStyleImage===null)return[3,19];if(Y=n.styles.listStyleImage,Y.type!==0)return[3,18];ie=void 0,ce=Y.url,be.label=15;case 15:return be.trys.push([15,17,,18]),[4,this.context.cache.match(ce)];case 16:return ie=be.sent(),this.ctx.drawImage(ie,n.bounds.left-(ie.width+10),n.bounds.top),[3,18];case 17:return be.sent(),this.context.logger.error("Error loading list-style-image "+ce),[3,18];case 18:return[3,20];case 19:t.listValue&&n.styles.listStyleType!==-1&&(fe=this.createFontStyle(s)[0],this.ctx.font=fe,this.ctx.fillStyle=ic(s.color),this.ctx.textBaseline="middle",this.ctx.textAlign="right",ve=new CA(n.bounds.left,n.bounds.top+yo(n.styles.paddingTop,n.bounds.width),n.bounds.width,P7(s.lineHeight,s.fontSize.number)/2+1),this.renderTextWithLetterSpacing(new Xb(t.listValue,ve),s.letterSpacing,P7(s.lineHeight,s.fontSize.number)/2+2),this.ctx.textBaseline="bottom",this.ctx.textAlign="left"),be.label=20;case 20:return[2]}})})},e.prototype.renderStackContent=function(t){return Pu(this,void 0,void 0,function(){var n,i,Y,s,a,Y,o,h,Y,f,_,Y,x,T,Y,I,N,Y,$,W,Y;return au(this,function(ie){switch(ie.label){case 0:if(Ll(t.element.container.flags,16))debugger;return[4,this.renderNodeBackgroundAndBorders(t.element)];case 1:ie.sent(),n=0,i=t.negativeZIndex,ie.label=2;case 2:return n<i.length?(Y=i[n],[4,this.renderStack(Y)]):[3,5];case 3:ie.sent(),ie.label=4;case 4:return n++,[3,2];case 5:return[4,this.renderNodeContent(t.element)];case 6:ie.sent(),s=0,a=t.nonInlineLevel,ie.label=7;case 7:return s<a.length?(Y=a[s],[4,this.renderNode(Y)]):[3,10];case 8:ie.sent(),ie.label=9;case 9:return s++,[3,7];case 10:o=0,h=t.nonPositionedFloats,ie.label=11;case 11:return o<h.length?(Y=h[o],[4,this.renderStack(Y)]):[3,14];case 12:ie.sent(),ie.label=13;case 13:return o++,[3,11];case 14:f=0,_=t.nonPositionedInlineLevel,ie.label=15;case 15:return f<_.length?(Y=_[f],[4,this.renderStack(Y)]):[3,18];case 16:ie.sent(),ie.label=17;case 17:return f++,[3,15];case 18:x=0,T=t.inlineLevel,ie.label=19;case 19:return x<T.length?(Y=T[x],[4,this.renderNode(Y)]):[3,22];case 20:ie.sent(),ie.label=21;case 21:return x++,[3,19];case 22:I=0,N=t.zeroOrAutoZIndexOrTransformedOrOpacity,ie.label=23;case 23:return I<N.length?(Y=N[I],[4,this.renderStack(Y)]):[3,26];case 24:ie.sent(),ie.label=25;case 25:return I++,[3,23];case 26:$=0,W=t.positiveZIndex,ie.label=27;case 27:return $<W.length?(Y=W[$],[4,this.renderStack(Y)]):[3,30];case 28:ie.sent(),ie.label=29;case 29:return $++,[3,27];case 30:return[2]}})})},e.prototype.mask=function(t){this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.lineTo(this.canvas.width,0),this.ctx.lineTo(this.canvas.width,this.canvas.height),this.ctx.lineTo(0,this.canvas.height),this.ctx.lineTo(0,0),this.formatPath(t.slice(0).reverse()),this.ctx.closePath()},e.prototype.path=function(t){this.ctx.beginPath(),this.formatPath(t),this.ctx.closePath()},e.prototype.formatPath=function(t){var n=this;t.forEach(function(i,s){var a=md(i)?i.start:i;s===0?n.ctx.moveTo(a.x,a.y):n.ctx.lineTo(a.x,a.y),md(i)&&n.ctx.bezierCurveTo(i.startControl.x,i.startControl.y,i.endControl.x,i.endControl.y,i.end.x,i.end.y)})},e.prototype.renderRepeat=function(t,n,i,s){this.path(t),this.ctx.fillStyle=n,this.ctx.translate(i,s),this.ctx.fill(),this.ctx.translate(-i,-s)},e.prototype.resizeImage=function(t,n,i){var s;if(t.width===n&&t.height===i)return t;var a=(s=this.canvas.ownerDocument)!==null&&s!==void 0?s:document,o=a.createElement("canvas");o.width=Math.max(1,n),o.height=Math.max(1,i);var h=o.getContext("2d");return h.drawImage(t,0,0,t.width,t.height,0,0,n,i),o},e.prototype.renderBackgroundImage=function(t){return Pu(this,void 0,void 0,function(){var n,i,s,a,o,h;return au(this,function(f){switch(f.label){case 0:n=t.styles.backgroundImage.length-1,i=function(_){var x,T,I,at,Vt,Jt,tt,Ne,Ue,N,at,Vt,Jt,tt,Ne,$,W,Y,ie,ce,fe,ve,be,Qe,Ue,st,at,Le,ze,tt,Ne,Ht,Vt,Jt,Kt,er,Xt,Fr,$e,ut,Bt,St;return au(this,function(jt){switch(jt.label){case 0:if(_.type!==0)return[3,5];x=void 0,T=_.url,jt.label=1;case 1:return jt.trys.push([1,3,,4]),[4,s.context.cache.match(T)];case 2:return x=jt.sent(),[3,4];case 3:return jt.sent(),s.context.logger.error("Error loading background-image "+T),[3,4];case 4:return x&&(I=z5(t,n,[x.width,x.height,x.width/x.height]),at=I[0],Vt=I[1],Jt=I[2],tt=I[3],Ne=I[4],Ue=s.ctx.createPattern(s.resizeImage(x,tt,Ne),"repeat"),s.renderRepeat(at,Ue,Vt,Jt)),[3,6];case 5:vke(_)?(N=z5(t,n,[null,null,null]),at=N[0],Vt=N[1],Jt=N[2],tt=N[3],Ne=N[4],$=gke(_.angle,tt,Ne),W=$[0],Y=$[1],ie=$[2],ce=$[3],fe=$[4],ve=document.createElement("canvas"),ve.width=tt,ve.height=Ne,be=ve.getContext("2d"),Qe=be.createLinearGradient(Y,ce,ie,fe),b7(_.stops,W).forEach(function(qt){return Qe.addColorStop(qt.stop,ic(qt.color))}),be.fillStyle=Qe,be.fillRect(0,0,tt,Ne),tt>0&&Ne>0&&(Ue=s.ctx.createPattern(ve,"repeat"),s.renderRepeat(at,Ue,Vt,Jt))):xke(_)&&(st=z5(t,n,[null,null,null]),at=st[0],Le=st[1],ze=st[2],tt=st[3],Ne=st[4],Ht=_.position.length===0?[f5]:_.position,Vt=yo(Ht[0],tt),Jt=yo(Ht[Ht.length-1],Ne),Kt=mke(_,Vt,Jt,tt,Ne),er=Kt[0],Xt=Kt[1],er>0&&Xt>0&&(Fr=s.ctx.createRadialGradient(Le+Vt,ze+Jt,0,Le+Vt,ze+Jt,er),b7(_.stops,er*2).forEach(function(qt){return Fr.addColorStop(qt.stop,ic(qt.color))}),s.path(at),s.ctx.fillStyle=Fr,er!==Xt?($e=t.bounds.left+.5*t.bounds.width,ut=t.bounds.top+.5*t.bounds.height,Bt=Xt/er,St=1/Bt,s.ctx.save(),s.ctx.translate($e,ut),s.ctx.transform(1,0,0,Bt,0,0),s.ctx.translate(-$e,-ut),s.ctx.fillRect(Le,St*(ze-ut)+ut,tt,Ne*St),s.ctx.restore()):s.ctx.fill())),jt.label=6;case 6:return n--,[2]}})},s=this,a=0,o=t.styles.backgroundImage.slice(0).reverse(),f.label=1;case 1:return a<o.length?(h=o[a],[5,i(h)]):[3,4];case 2:f.sent(),f.label=3;case 3:return a++,[3,1];case 4:return[2]}})})},e.prototype.renderSolidBorder=function(t,n,i){return Pu(this,void 0,void 0,function(){return au(this,function(s){return this.path(Mq(i,n)),this.ctx.fillStyle=ic(t),this.ctx.fill(),[2]})})},e.prototype.renderDoubleBorder=function(t,n,i,s){return Pu(this,void 0,void 0,function(){var a,o;return au(this,function(h){switch(h.label){case 0:return n<3?[4,this.renderSolidBorder(t,i,s)]:[3,2];case 1:return h.sent(),[2];case 2:return a=C6e(s,i),this.path(a),this.ctx.fillStyle=ic(t),this.ctx.fill(),o=E6e(s,i),this.path(o),this.ctx.fill(),[2]}})})},e.prototype.renderNodeBackgroundAndBorders=function(t){return Pu(this,void 0,void 0,function(){var n,i,s,a,o,h,f,_,x=this;return au(this,function(T){switch(T.label){case 0:return this.applyEffects(t.getEffects(2)),n=t.container.styles,i=!Dp(n.backgroundColor)||n.backgroundImage.length,s=[{style:n.borderTopStyle,color:n.borderTopColor,width:n.borderTopWidth},{style:n.borderRightStyle,color:n.borderRightColor,width:n.borderRightWidth},{style:n.borderBottomStyle,color:n.borderBottomColor,width:n.borderBottomWidth},{style:n.borderLeftStyle,color:n.borderLeftColor,width:n.borderLeftWidth}],a=k6e(ey(n.backgroundClip,0),t.curves),i||n.boxShadow.length?(this.ctx.save(),this.path(a),this.ctx.clip(),Dp(n.backgroundColor)||(this.ctx.fillStyle=ic(n.backgroundColor),this.ctx.fill()),[4,this.renderBackgroundImage(t.container)]):[3,2];case 1:T.sent(),this.ctx.restore(),n.boxShadow.slice(0).reverse().forEach(function(I){x.ctx.save();var N=HC(t.curves),$=I.inset?0:L6e,W=w6e(N,-$+(I.inset?1:-1)*I.spread.number,(I.inset?1:-1)*I.spread.number,I.spread.number*(I.inset?-2:2),I.spread.number*(I.inset?-2:2));I.inset?(x.path(N),x.ctx.clip(),x.mask(W)):(x.mask(N),x.ctx.clip(),x.path(W)),x.ctx.shadowOffsetX=I.offsetX.number+$,x.ctx.shadowOffsetY=I.offsetY.number,x.ctx.shadowColor=ic(I.color),x.ctx.shadowBlur=I.blur.number,x.ctx.fillStyle=I.inset?ic(I.color):"rgba(0,0,0,1)",x.ctx.fill(),x.ctx.restore()}),T.label=2;case 2:o=0,h=0,f=s,T.label=3;case 3:return h<f.length?(_=f[h],_.style!==0&&!Dp(_.color)&&_.width>0?_.style!==2?[3,5]:[4,this.renderDashedDottedBorder(_.color,_.width,o,t.curves,2)]:[3,11]):[3,13];case 4:return T.sent(),[3,11];case 5:return _.style!==3?[3,7]:[4,this.renderDashedDottedBorder(_.color,_.width,o,t.curves,3)];case 6:return T.sent(),[3,11];case 7:return _.style!==4?[3,9]:[4,this.renderDoubleBorder(_.color,_.width,o,t.curves)];case 8:return T.sent(),[3,11];case 9:return[4,this.renderSolidBorder(_.color,o,t.curves)];case 10:T.sent(),T.label=11;case 11:o++,T.label=12;case 12:return h++,[3,3];case 13:return[2]}})})},e.prototype.renderDashedDottedBorder=function(t,n,i,s,a){return Pu(this,void 0,void 0,function(){var o,h,f,_,x,T,I,N,$,W,Y,ie,ce,fe,ve,be,ve,be;return au(this,function(Qe){return this.ctx.save(),o=T6e(s,i),h=Mq(s,i),a===2&&(this.path(h),this.ctx.clip()),md(h[0])?(f=h[0].start.x,_=h[0].start.y):(f=h[0].x,_=h[0].y),md(h[1])?(x=h[1].end.x,T=h[1].end.y):(x=h[1].x,T=h[1].y),i===0||i===2?I=Math.abs(f-x):I=Math.abs(_-T),this.ctx.beginPath(),a===3?this.formatPath(o):this.formatPath(h.slice(0,2)),N=n<3?n*3:n*2,$=n<3?n*2:n,a===3&&(N=n,$=n),W=!0,I<=N*2?W=!1:I<=N*2+$?(Y=I/(2*N+$),N*=Y,$*=Y):(ie=Math.floor((I+$)/(N+$)),ce=(I-ie*N)/(ie-1),fe=(I-(ie+1)*N)/ie,$=fe<=0||Math.abs($-ce)<Math.abs($-fe)?ce:fe),W&&(a===3?this.ctx.setLineDash([0,N+$]):this.ctx.setLineDash([N,$])),a===3?(this.ctx.lineCap="round",this.ctx.lineWidth=n):this.ctx.lineWidth=n*2+1.1,this.ctx.strokeStyle=ic(t),this.ctx.stroke(),this.ctx.setLineDash([]),a===2&&(md(h[0])&&(ve=h[3],be=h[0],this.ctx.beginPath(),this.formatPath([new kn(ve.end.x,ve.end.y),new kn(be.start.x,be.start.y)]),this.ctx.stroke()),md(h[1])&&(ve=h[1],be=h[2],this.ctx.beginPath(),this.formatPath([new kn(ve.end.x,ve.end.y),new kn(be.start.x,be.start.y)]),this.ctx.stroke())),this.ctx.restore(),[2]})})},e.prototype.render=function(t){return Pu(this,void 0,void 0,function(){var n;return au(this,function(i){switch(i.label){case 0:return this.options.backgroundColor&&(this.ctx.fillStyle=ic(this.options.backgroundColor),this.ctx.fillRect(this.options.x,this.options.y,this.options.width,this.options.height)),n=B6e(t),[4,this.renderStack(n)];case 1:return i.sent(),this.applyEffects([]),[2,this.canvas]}})})},e}(Rq),O6e=function(r){return r instanceof nq||r instanceof rq?!0:r instanceof I5&&r.type!==DC&&r.type!==LC},k6e=function(r,e){switch(r){case 0:return HC(e);case 2:return _6e(e);case 1:default:return VC(e)}},U6e=function(r){switch(r){case 1:return"center";case 2:return"right";case 0:default:return"left"}},N6e=["-apple-system","system-ui"],z6e=function(r){return/iPhone OS 15_(0|1)/.test(window.navigator.userAgent)?r.filter(function(e){return N6e.indexOf(e)===-1}):r},H6e=function(r){lf(e,r);function e(t,n){var i=r.call(this,t,n)||this;return i.canvas=n.canvas?n.canvas:document.createElement("canvas"),i.ctx=i.canvas.getContext("2d"),i.options=n,i.canvas.width=Math.floor(n.width*n.scale),i.canvas.height=Math.floor(n.height*n.scale),i.canvas.style.width=n.width+"px",i.canvas.style.height=n.height+"px",i.ctx.scale(i.options.scale,i.options.scale),i.ctx.translate(-n.x,-n.y),i.context.logger.debug("EXPERIMENTAL ForeignObject renderer initialized ("+n.width+"x"+n.height+" at "+n.x+","+n.y+") with scale "+n.scale),i}return e.prototype.render=function(t){return Pu(this,void 0,void 0,function(){var n,i;return au(this,function(s){switch(s.label){case 0:return n=E5(this.options.width*this.options.scale,this.options.height*this.options.scale,this.options.scale,this.options.scale,t),[4,V6e(n)];case 1:return i=s.sent(),this.options.backgroundColor&&(this.ctx.fillStyle=ic(this.options.backgroundColor),this.ctx.fillRect(0,0,this.options.width*this.options.scale,this.options.height*this.options.scale)),this.ctx.drawImage(i,-this.options.x*this.options.scale,-this.options.y*this.options.scale),[2,this.canvas]}})})},e}(Rq),V6e=function(r){return new Promise(function(e,t){var n=new Image;n.onload=function(){e(n)},n.onerror=t,n.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(new XMLSerializer().serializeToString(r))})},G6e=function(){function r(e){var t=e.id,n=e.enabled;this.id=t,this.enabled=n,this.start=Date.now()}return r.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&(typeof window<"u"&&window.console&&typeof console.debug=="function"?console.debug.apply(console,eC([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},r.prototype.getTime=function(){return Date.now()-this.start},r.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&typeof window<"u"&&window.console&&typeof console.info=="function"&&console.info.apply(console,eC([this.id,this.getTime()+"ms"],e))},r.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&(typeof window<"u"&&window.console&&typeof console.warn=="function"?console.warn.apply(console,eC([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},r.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&(typeof window<"u"&&window.console&&typeof console.error=="function"?console.error.apply(console,eC([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},r.instances={},r}(),Q6e=function(){function r(e,t){var n;this.windowBounds=t,this.instanceName="#"+r.instanceCount++,this.logger=new G6e({id:this.instanceName,enabled:e.logging}),this.cache=(n=e.cache)!==null&&n!==void 0?n:new u6e(this,e)}return r.instanceCount=1,r}(),$6e=function(r,e){return e===void 0&&(e={}),j6e(r,e)};typeof window<"u"&&Bq.setContext(window);var j6e=function(r,e){return Pu(void 0,void 0,void 0,function(){var t,n,i,s,a,o,h,f,_,x,T,I,N,$,W,Y,ie,ce,fe,ve,Qe,be,Qe,Ue,st,at,Le,ze,tt,Ne,Ht,Vt,Jt,Kt,er,Xt,Fr,$e,ut,Bt;return au(this,function(St){switch(St.label){case 0:if(!r||typeof r!="object")return[2,Promise.reject("Invalid element provided as first argument")];if(t=r.ownerDocument,!t)throw new Error("Element is not attached to a Document");if(n=t.defaultView,!n)throw new Error("Document is not attached to a Window");return i={allowTaint:(Ue=e.allowTaint)!==null&&Ue!==void 0?Ue:!1,imageTimeout:(st=e.imageTimeout)!==null&&st!==void 0?st:15e3,proxy:e.proxy,useCORS:(at=e.useCORS)!==null&&at!==void 0?at:!1},s=jR({logging:(Le=e.logging)!==null&&Le!==void 0?Le:!0,cache:e.cache},i),a={windowWidth:(ze=e.windowWidth)!==null&&ze!==void 0?ze:n.innerWidth,windowHeight:(tt=e.windowHeight)!==null&&tt!==void 0?tt:n.innerHeight,scrollX:(Ne=e.scrollX)!==null&&Ne!==void 0?Ne:n.pageXOffset,scrollY:(Ht=e.scrollY)!==null&&Ht!==void 0?Ht:n.pageYOffset},o=new CA(a.scrollX,a.scrollY,a.windowWidth,a.windowHeight),h=new Q6e(s,o),f=(Vt=e.foreignObjectRendering)!==null&&Vt!==void 0?Vt:!1,_={allowTaint:(Jt=e.allowTaint)!==null&&Jt!==void 0?Jt:!1,onclone:e.onclone,ignoreElements:e.ignoreElements,inlineImages:f,copyStyles:f},h.logger.debug("Starting document clone with size "+o.width+"x"+o.height+" scrolled to "+-o.left+","+-o.top),x=new xq(h,r,_),T=x.clonedReferenceElement,T?[4,x.toIFrame(t,o)]:[2,Promise.reject("Unable to find element in cloned iframe")];case 1:return I=St.sent(),N=P5(T)||qNe(T)?wDe(T.ownerDocument):tC(h,T),$=N.width,W=N.height,Y=N.left,ie=N.top,ce=q6e(h,T,e.backgroundColor),fe={canvas:e.canvas,backgroundColor:ce,scale:(er=(Kt=e.scale)!==null&&Kt!==void 0?Kt:n.devicePixelRatio)!==null&&er!==void 0?er:1,x:((Xt=e.x)!==null&&Xt!==void 0?Xt:0)+Y,y:((Fr=e.y)!==null&&Fr!==void 0?Fr:0)+ie,width:($e=e.width)!==null&&$e!==void 0?$e:Math.ceil($),height:(ut=e.height)!==null&&ut!==void 0?ut:Math.ceil(W)},f?(h.logger.debug("Document cloned, using foreign object rendering"),Qe=new H6e(h,fe),[4,Qe.render(T)]):[3,3];case 2:return ve=St.sent(),[3,5];case 3:return h.logger.debug("Document cloned, element located at "+Y+","+ie+" with size "+$+"x"+W+" using computed rendering"),h.logger.debug("Starting DOM parsing"),be=oq(h,T),ce===be.styles.backgroundColor&&(be.styles.backgroundColor=TA.TRANSPARENT),h.logger.debug("Starting renderer for element at "+fe.x+","+fe.y+" with size "+fe.width+"x"+fe.height),Qe=new D6e(h,fe),[4,Qe.render(be)];case 4:ve=St.sent(),St.label=5;case 5:return(!((Bt=e.removeContainer)!==null&&Bt!==void 0)||Bt)&&(xq.destroy(I)||h.logger.error("Cannot detach cloned iframe as it is not in the DOM anymore")),h.logger.debug("Finished rendering"),[2,ve]}})})},q6e=function(r,e,t){var n=e.ownerDocument,i=n.documentElement?qb(r,getComputedStyle(n.documentElement).backgroundColor):TA.TRANSPARENT,s=n.body?qb(r,getComputedStyle(n.body).backgroundColor):TA.TRANSPARENT,a=typeof t=="string"?qb(r,t):t===null?TA.TRANSPARENT:4294967295;return e===n.documentElement?Dp(i)?Dp(s)?a:s:i:a};const K6e=Object.freeze(Object.defineProperty({__proto__:null,default:$6e},Symbol.toStringTag,{value:"Module"}));/*! @license DOMPurify 2.5.3 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/2.5.3/LICENSE */function Np(r){"@babel/helpers - typeof";return Np=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Np(r)}function H5(r,e){return H5=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t},H5(r,e)}function W6e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function qC(r,e,t){return W6e()?qC=Reflect.construct:qC=function(n,i,s){var a=[null];a.push.apply(a,i);var o=Function.bind.apply(n,a),h=new o;return s&&H5(h,s.prototype),h},qC.apply(null,arguments)}function uf(r){return X6e(r)||J6e(r)||Z6e(r)||Y6e()}function X6e(r){if(Array.isArray(r))return V5(r)}function J6e(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function Z6e(r,e){if(r){if(typeof r=="string")return V5(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return V5(r,e)}}function V5(r,e){(e==null||e>r.length)&&(e=r.length);for(var t=0,n=new Array(e);t<e;t++)n[t]=r[t];return n}function Y6e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var e8e=Object.hasOwnProperty,Lq=Object.setPrototypeOf,t8e=Object.isFrozen,r8e=Object.getPrototypeOf,n8e=Object.getOwnPropertyDescriptor,Lu=Object.freeze,yd=Object.seal,i8e=Object.create,Dq=typeof Reflect<"u"&&Reflect,KC=Dq.apply,G5=Dq.construct;KC||(KC=function(r,e,t){return r.apply(e,t)}),Lu||(Lu=function(r){return r}),yd||(yd=function(r){return r}),G5||(G5=function(r,e){return qC(r,uf(e))});var s8e=kh(Array.prototype.forEach),Oq=kh(Array.prototype.pop),ev=kh(Array.prototype.push),WC=kh(String.prototype.toLowerCase),Q5=kh(String.prototype.toString),kq=kh(String.prototype.match),hf=kh(String.prototype.replace),o8e=kh(String.prototype.indexOf),a8e=kh(String.prototype.trim),Tc=kh(RegExp.prototype.test),$5=l8e(TypeError),Uq=kh(Number.isNaN);function kh(r){return function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return KC(r,e,n)}}function l8e(r){return function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return G5(r,t)}}function Ui(r,e,t){var n;t=(n=t)!==null&&n!==void 0?n:WC,Lq&&Lq(r,null);for(var i=e.length;i--;){var s=e[i];if(typeof s=="string"){var a=t(s);a!==s&&(t8e(e)||(e[i]=a),s=a)}r[s]=!0}return r}function gm(r){var e=i8e(null),t;for(t in r)KC(e8e,r,[t])===!0&&(e[t]=r[t]);return e}function XC(r,e){for(;r!==null;){var t=n8e(r,e);if(t){if(t.get)return kh(t.get);if(typeof t.value=="function")return kh(t.value)}r=r8e(r)}function n(i){return console.warn("fallback value for",i),null}return n}var Nq=Lu(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),j5=Lu(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),q5=Lu(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),c8e=Lu(["animate","color-profile","cursor","discard","fedropshadow","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),K5=Lu(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover"]),u8e=Lu(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),zq=Lu(["#text"]),Hq=Lu(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","xmlns","slot"]),W5=Lu(["accent-height","accumulate","additive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),Vq=Lu(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),JC=Lu(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),h8e=yd(/\{\{[\w\W]*|[\w\W]*\}\}/gm),d8e=yd(/<%[\w\W]*|[\w\W]*%>/gm),f8e=yd(/\${[\w\W]*}/gm),A8e=yd(/^data-[\-\w.\u00B7-\uFFFF]/),p8e=yd(/^aria-[\-\w]+$/),g8e=yd(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),m8e=yd(/^(?:\w+script|data):/i),_8e=yd(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),y8e=yd(/^html$/i),b8e=yd(/^[a-z][.\w]*(-[.\w]+)+$/i),v8e=function(){return typeof window>"u"?null:window},x8e=function(r,e){if(Np(r)!=="object"||typeof r.createPolicy!="function")return null;var t=null,n="data-tt-policy-suffix";e.currentScript&&e.currentScript.hasAttribute(n)&&(t=e.currentScript.getAttribute(n));var i="dompurify"+(t?"#"+t:"");try{return r.createPolicy(i,{createHTML:function(s){return s},createScriptURL:function(s){return s}})}catch{return console.warn("TrustedTypes policy "+i+" could not be created."),null}};function Gq(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:v8e(),e=function(Pt){return Gq(Pt)};if(e.version="2.5.3",e.removed=[],!r||!r.document||r.document.nodeType!==9)return e.isSupported=!1,e;var t=r.document,n=r.document,i=r.DocumentFragment,s=r.HTMLTemplateElement,a=r.Node,o=r.Element,h=r.NodeFilter,f=r.NamedNodeMap,_=f===void 0?r.NamedNodeMap||r.MozNamedAttrMap:f,x=r.HTMLFormElement,T=r.DOMParser,I=r.trustedTypes,N=o.prototype,$=XC(N,"cloneNode"),W=XC(N,"nextSibling"),Y=XC(N,"childNodes"),ie=XC(N,"parentNode");if(typeof s=="function"){var ce=n.createElement("template");ce.content&&ce.content.ownerDocument&&(n=ce.content.ownerDocument)}var fe=x8e(I,t),ve=fe?fe.createHTML(""):"",be=n,Qe=be.implementation,Ue=be.createNodeIterator,st=be.createDocumentFragment,at=be.getElementsByTagName,Le=t.importNode,ze={};try{ze=gm(n).documentMode?n.documentMode:{}}catch{}var tt={};e.isSupported=typeof ie=="function"&&Qe&&Qe.createHTMLDocument!==void 0&&ze!==9;var Ne=h8e,Ht=d8e,Vt=f8e,Jt=A8e,Kt=p8e,er=m8e,Xt=_8e,Fr=b8e,$e=g8e,ut=null,Bt=Ui({},[].concat(uf(Nq),uf(j5),uf(q5),uf(K5),uf(zq))),St=null,jt=Ui({},[].concat(uf(Hq),uf(W5),uf(Vq),uf(JC))),qt=Object.seal(Object.create(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),nr=null,ar=null,$r=!0,kr=!0,Gr=!1,sn=!0,on=!1,pr=!0,We=!1,Pn=!1,mn=!1,mr=!1,Mr=!1,en=!1,Wr=!0,gn=!1,Bn="user-content-",Fn=!0,$n=!1,ei={},br=null,Cn=Ui({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]),Rn=null,nn=Ui({},["audio","video","img","source","image","track"]),Ci=null,Cr=Ui({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),Tn="http://www.w3.org/1998/Math/MathML",Xe="http://www.w3.org/2000/svg",He="http://www.w3.org/1999/xhtml",Je=He,Ve=!1,bt=null,Mt=Ui({},[Tn,Xe,He],Q5),$t,Wt=["application/xhtml+xml","text/html"],Pe="text/html",Ae,ge=null,we=255,Se=n.createElement("form"),ht=function(Pt){return Pt instanceof RegExp||Pt instanceof Function},At=function(Pt){ge&&ge===Pt||((!Pt||Np(Pt)!=="object")&&(Pt={}),Pt=gm(Pt),$t=Wt.indexOf(Pt.PARSER_MEDIA_TYPE)===-1?$t=Pe:$t=Pt.PARSER_MEDIA_TYPE,Ae=$t==="application/xhtml+xml"?Q5:WC,ut="ALLOWED_TAGS"in Pt?Ui({},Pt.ALLOWED_TAGS,Ae):Bt,St="ALLOWED_ATTR"in Pt?Ui({},Pt.ALLOWED_ATTR,Ae):jt,bt="ALLOWED_NAMESPACES"in Pt?Ui({},Pt.ALLOWED_NAMESPACES,Q5):Mt,Ci="ADD_URI_SAFE_ATTR"in Pt?Ui(gm(Cr),Pt.ADD_URI_SAFE_ATTR,Ae):Cr,Rn="ADD_DATA_URI_TAGS"in Pt?Ui(gm(nn),Pt.ADD_DATA_URI_TAGS,Ae):nn,br="FORBID_CONTENTS"in Pt?Ui({},Pt.FORBID_CONTENTS,Ae):Cn,nr="FORBID_TAGS"in Pt?Ui({},Pt.FORBID_TAGS,Ae):{},ar="FORBID_ATTR"in Pt?Ui({},Pt.FORBID_ATTR,Ae):{},ei="USE_PROFILES"in Pt?Pt.USE_PROFILES:!1,$r=Pt.ALLOW_ARIA_ATTR!==!1,kr=Pt.ALLOW_DATA_ATTR!==!1,Gr=Pt.ALLOW_UNKNOWN_PROTOCOLS||!1,sn=Pt.ALLOW_SELF_CLOSE_IN_ATTR!==!1,on=Pt.SAFE_FOR_TEMPLATES||!1,pr=Pt.SAFE_FOR_XML!==!1,We=Pt.WHOLE_DOCUMENT||!1,mr=Pt.RETURN_DOM||!1,Mr=Pt.RETURN_DOM_FRAGMENT||!1,en=Pt.RETURN_TRUSTED_TYPE||!1,mn=Pt.FORCE_BODY||!1,Wr=Pt.SANITIZE_DOM!==!1,gn=Pt.SANITIZE_NAMED_PROPS||!1,Fn=Pt.KEEP_CONTENT!==!1,$n=Pt.IN_PLACE||!1,$e=Pt.ALLOWED_URI_REGEXP||$e,Je=Pt.NAMESPACE||He,qt=Pt.CUSTOM_ELEMENT_HANDLING||{},Pt.CUSTOM_ELEMENT_HANDLING&&ht(Pt.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(qt.tagNameCheck=Pt.CUSTOM_ELEMENT_HANDLING.tagNameCheck),Pt.CUSTOM_ELEMENT_HANDLING&&ht(Pt.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(qt.attributeNameCheck=Pt.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),Pt.CUSTOM_ELEMENT_HANDLING&&typeof Pt.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(qt.allowCustomizedBuiltInElements=Pt.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),on&&(kr=!1),Mr&&(mr=!0),ei&&(ut=Ui({},uf(zq)),St=[],ei.html===!0&&(Ui(ut,Nq),Ui(St,Hq)),ei.svg===!0&&(Ui(ut,j5),Ui(St,W5),Ui(St,JC)),ei.svgFilters===!0&&(Ui(ut,q5),Ui(St,W5),Ui(St,JC)),ei.mathMl===!0&&(Ui(ut,K5),Ui(St,Vq),Ui(St,JC))),Pt.ADD_TAGS&&(ut===Bt&&(ut=gm(ut)),Ui(ut,Pt.ADD_TAGS,Ae)),Pt.ADD_ATTR&&(St===jt&&(St=gm(St)),Ui(St,Pt.ADD_ATTR,Ae)),Pt.ADD_URI_SAFE_ATTR&&Ui(Ci,Pt.ADD_URI_SAFE_ATTR,Ae),Pt.FORBID_CONTENTS&&(br===Cn&&(br=gm(br)),Ui(br,Pt.FORBID_CONTENTS,Ae)),Fn&&(ut["#text"]=!0),We&&Ui(ut,["html","head","body"]),ut.table&&(Ui(ut,["tbody"]),delete nr.tbody),Lu&&Lu(Pt),ge=Pt)},_t=Ui({},["mi","mo","mn","ms","mtext"]),dt=Ui({},["foreignobject","annotation-xml"]),yt=Ui({},["title","style","font","a","script"]),Nt=Ui({},j5);Ui(Nt,q5),Ui(Nt,c8e);var Rt=Ui({},K5);Ui(Rt,u8e);var dr=function(Pt){var Zr=ie(Pt);(!Zr||!Zr.tagName)&&(Zr={namespaceURI:Je,tagName:"template"});var Ur=WC(Pt.tagName),On=WC(Zr.tagName);return bt[Pt.namespaceURI]?Pt.namespaceURI===Xe?Zr.namespaceURI===He?Ur==="svg":Zr.namespaceURI===Tn?Ur==="svg"&&(On==="annotation-xml"||_t[On]):!!Nt[Ur]:Pt.namespaceURI===Tn?Zr.namespaceURI===He?Ur==="math":Zr.namespaceURI===Xe?Ur==="math"&&dt[On]:!!Rt[Ur]:Pt.namespaceURI===He?Zr.namespaceURI===Xe&&!dt[On]||Zr.namespaceURI===Tn&&!_t[On]?!1:!Rt[Ur]&&(yt[Ur]||!Nt[Ur]):!!($t==="application/xhtml+xml"&&bt[Pt.namespaceURI]):!1},zr=function(Pt){ev(e.removed,{element:Pt});try{Pt.parentNode.removeChild(Pt)}catch{try{Pt.outerHTML=ve}catch{Pt.remove()}}},Pr=function(Pt,Zr){try{ev(e.removed,{attribute:Zr.getAttributeNode(Pt),from:Zr})}catch{ev(e.removed,{attribute:null,from:Zr})}if(Zr.removeAttribute(Pt),Pt==="is"&&!St[Pt])if(mr||Mr)try{zr(Zr)}catch{}else try{Zr.setAttribute(Pt,"")}catch{}},Rr=function(Pt){var Zr,Ur;if(mn)Pt="<remove></remove>"+Pt;else{var On=kq(Pt,/^[\r\n\t ]+/);Ur=On&&On[0]}$t==="application/xhtml+xml"&&Je===He&&(Pt='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+Pt+"</body></html>");var di=fe?fe.createHTML(Pt):Pt;if(Je===He)try{Zr=new T().parseFromString(di,$t)}catch{}if(!Zr||!Zr.documentElement){Zr=Qe.createDocument(Je,"template",null);try{Zr.documentElement.innerHTML=Ve?ve:di}catch{}}var ks=Zr.body||Zr.documentElement;return Pt&&Ur&&ks.insertBefore(n.createTextNode(Ur),ks.childNodes[0]||null),Je===He?at.call(Zr,We?"html":"body")[0]:We?Zr.documentElement:ks},ln=function(Pt){return Ue.call(Pt.ownerDocument||Pt,Pt,h.SHOW_ELEMENT|h.SHOW_COMMENT|h.SHOW_TEXT|h.SHOW_PROCESSING_INSTRUCTION|h.SHOW_CDATA_SECTION,null,!1)},Jn=function(Pt){return Pt instanceof x&&(typeof Pt.__depth<"u"&&typeof Pt.__depth!="number"||typeof Pt.__removalCount<"u"&&typeof Pt.__removalCount!="number"||typeof Pt.nodeName!="string"||typeof Pt.textContent!="string"||typeof Pt.removeChild!="function"||!(Pt.attributes instanceof _)||typeof Pt.removeAttribute!="function"||typeof Pt.setAttribute!="function"||typeof Pt.namespaceURI!="string"||typeof Pt.insertBefore!="function"||typeof Pt.hasChildNodes!="function")},_n=function(Pt){return Np(a)==="object"?Pt instanceof a:Pt&&Np(Pt)==="object"&&typeof Pt.nodeType=="number"&&typeof Pt.nodeName=="string"},jn=function(Pt,Zr,Ur){tt[Pt]&&s8e(tt[Pt],function(On){On.call(e,Zr,Ur,ge)})},Gn=function(Pt){var Zr;if(jn("beforeSanitizeElements",Pt,null),Jn(Pt)||Tc(/[\u0080-\uFFFF]/,Pt.nodeName))return zr(Pt),!0;var Ur=Ae(Pt.nodeName);if(jn("uponSanitizeElement",Pt,{tagName:Ur,allowedTags:ut}),Pt.hasChildNodes()&&!_n(Pt.firstElementChild)&&(!_n(Pt.content)||!_n(Pt.content.firstElementChild))&&Tc(/<[/\w]/g,Pt.innerHTML)&&Tc(/<[/\w]/g,Pt.textContent)||Ur==="select"&&Tc(/<template/i,Pt.innerHTML)||Pt.nodeType===7||pr&&Pt.nodeType===8&&Tc(/<[/\w]/g,Pt.data))return zr(Pt),!0;if(!ut[Ur]||nr[Ur]){if(!nr[Ur]&&Un(Ur)&&(qt.tagNameCheck instanceof RegExp&&Tc(qt.tagNameCheck,Ur)||qt.tagNameCheck instanceof Function&&qt.tagNameCheck(Ur)))return!1;if(Fn&&!br[Ur]){var On=ie(Pt)||Pt.parentNode,di=Y(Pt)||Pt.childNodes;if(di&&On)for(var ks=di.length,bi=ks-1;bi>=0;--bi){var bs=$(di[bi],!0);bs.__removalCount=(Pt.__removalCount||0)+1,On.insertBefore(bs,W(Pt))}}return zr(Pt),!0}return Pt instanceof o&&!dr(Pt)||(Ur==="noscript"||Ur==="noembed"||Ur==="noframes")&&Tc(/<\/no(script|embed|frames)/i,Pt.innerHTML)?(zr(Pt),!0):(on&&Pt.nodeType===3&&(Zr=Pt.textContent,Zr=hf(Zr,Ne," "),Zr=hf(Zr,Ht," "),Zr=hf(Zr,Vt," "),Pt.textContent!==Zr&&(ev(e.removed,{element:Pt.cloneNode()}),Pt.textContent=Zr)),jn("afterSanitizeElements",Pt,null),!1)},Ln=function(Pt,Zr,Ur){if(Wr&&(Zr==="id"||Zr==="name")&&(Ur in n||Ur in Se||Ur==="__depth"||Ur==="__removalCount"))return!1;if(!(kr&&!ar[Zr]&&Tc(Jt,Zr))&&!($r&&Tc(Kt,Zr))){if(!St[Zr]||ar[Zr]){if(!(Un(Pt)&&(qt.tagNameCheck instanceof RegExp&&Tc(qt.tagNameCheck,Pt)||qt.tagNameCheck instanceof Function&&qt.tagNameCheck(Pt))&&(qt.attributeNameCheck instanceof RegExp&&Tc(qt.attributeNameCheck,Zr)||qt.attributeNameCheck instanceof Function&&qt.attributeNameCheck(Zr))||Zr==="is"&&qt.allowCustomizedBuiltInElements&&(qt.tagNameCheck instanceof RegExp&&Tc(qt.tagNameCheck,Ur)||qt.tagNameCheck instanceof Function&&qt.tagNameCheck(Ur))))return!1}else if(!Ci[Zr]&&!Tc($e,hf(Ur,Xt,""))&&!((Zr==="src"||Zr==="xlink:href"||Zr==="href")&&Pt!=="script"&&o8e(Ur,"data:")===0&&Rn[Pt])&&!(Gr&&!Tc(er,hf(Ur,Xt,"")))&&Ur)return!1}return!0},Un=function(Pt){return Pt!=="annotation-xml"&&kq(Pt,Fr)},Ei=function(Pt){var Zr,Ur,On,di;jn("beforeSanitizeAttributes",Pt,null);var ks=Pt.attributes;if(ks){var bi={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:St};for(di=ks.length;di--;){Zr=ks[di];var bs=Zr,jo=bs.name,Ks=bs.namespaceURI;if(Ur=jo==="value"?Zr.value:a8e(Zr.value),On=Ae(jo),bi.attrName=On,bi.attrValue=Ur,bi.keepAttr=!0,bi.forceKeepAttr=void 0,jn("uponSanitizeAttribute",Pt,bi),Ur=bi.attrValue,!bi.forceKeepAttr&&(Pr(jo,Pt),!!bi.keepAttr)){if(!sn&&Tc(/\/>/i,Ur)){Pr(jo,Pt);continue}if(pr&&Tc(/((--!?|])>)|<\/(style|title)/i,Ur)){Pr(jo,Pt);continue}on&&(Ur=hf(Ur,Ne," "),Ur=hf(Ur,Ht," "),Ur=hf(Ur,Vt," "));var Hi=Ae(Pt.nodeName);if(Ln(Hi,On,Ur)){if(gn&&(On==="id"||On==="name")&&(Pr(jo,Pt),Ur=Bn+Ur),fe&&Np(I)==="object"&&typeof I.getAttributeType=="function"&&!Ks)switch(I.getAttributeType(Hi,On)){case"TrustedHTML":{Ur=fe.createHTML(Ur);break}case"TrustedScriptURL":{Ur=fe.createScriptURL(Ur);break}}try{Ks?Pt.setAttributeNS(Ks,jo,Ur):Pt.setAttribute(jo,Ur),Jn(Pt)?zr(Pt):Oq(e.removed)}catch{}}}}jn("afterSanitizeAttributes",Pt,null)}},zi=function Pt(Zr){var Ur,On=ln(Zr);for(jn("beforeSanitizeShadowDOM",Zr,null);Ur=On.nextNode();)if(jn("uponSanitizeShadowNode",Ur,null),!Gn(Ur)){var di=ie(Ur);Ur.nodeType===1&&(di&&di.__depth?Ur.__depth=(Ur.__removalCount||0)+di.__depth+1:Ur.__depth=1),(Ur.__depth>=we||Uq(Ur.__depth))&&zr(Ur),Ur.content instanceof i&&(Ur.content.__depth=Ur.__depth,Pt(Ur.content)),Ei(Ur)}jn("afterSanitizeShadowDOM",Zr,null)};return e.sanitize=function(Pt){var Zr=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},Ur,On,di,ks,bi;if(Ve=!Pt,Ve&&(Pt="<!-->"),typeof Pt!="string"&&!_n(Pt))if(typeof Pt.toString=="function"){if(Pt=Pt.toString(),typeof Pt!="string")throw $5("dirty is not a string, aborting")}else throw $5("toString is not a function");if(!e.isSupported){if(Np(r.toStaticHTML)==="object"||typeof r.toStaticHTML=="function"){if(typeof Pt=="string")return r.toStaticHTML(Pt);if(_n(Pt))return r.toStaticHTML(Pt.outerHTML)}return Pt}if(Pn||At(Zr),e.removed=[],typeof Pt=="string"&&($n=!1),$n){if(Pt.nodeName){var bs=Ae(Pt.nodeName);if(!ut[bs]||nr[bs])throw $5("root node is forbidden and cannot be sanitized in-place")}}else if(Pt instanceof a)Ur=Rr("<!---->"),On=Ur.ownerDocument.importNode(Pt,!0),On.nodeType===1&&On.nodeName==="BODY"||On.nodeName==="HTML"?Ur=On:Ur.appendChild(On);else{if(!mr&&!on&&!We&&Pt.indexOf("<")===-1)return fe&&en?fe.createHTML(Pt):Pt;if(Ur=Rr(Pt),!Ur)return mr?null:en?ve:""}Ur&&mn&&zr(Ur.firstChild);for(var jo=ln($n?Pt:Ur);di=jo.nextNode();)if(!(di.nodeType===3&&di===ks)&&!Gn(di)){var Ks=ie(di);di.nodeType===1&&(Ks&&Ks.__depth?di.__depth=(di.__removalCount||0)+Ks.__depth+1:di.__depth=1),(di.__depth>=we||Uq(di.__depth))&&zr(di),di.content instanceof i&&(di.content.__depth=di.__depth,zi(di.content)),Ei(di),ks=di}if(ks=null,$n)return Pt;if(mr){if(Mr)for(bi=st.call(Ur.ownerDocument);Ur.firstChild;)bi.appendChild(Ur.firstChild);else bi=Ur;return(St.shadowroot||St.shadowrootmod)&&(bi=Le.call(t,bi,!0)),bi}var Hi=We?Ur.outerHTML:Ur.innerHTML;return We&&ut["!doctype"]&&Ur.ownerDocument&&Ur.ownerDocument.doctype&&Ur.ownerDocument.doctype.name&&Tc(y8e,Ur.ownerDocument.doctype.name)&&(Hi="<!DOCTYPE "+Ur.ownerDocument.doctype.name+`>
`+Hi),on&&(Hi=hf(Hi,Ne," "),Hi=hf(Hi,Ht," "),Hi=hf(Hi,Vt," ")),fe&&en?fe.createHTML(Hi):Hi},e.setConfig=function(Pt){At(Pt),Pn=!0},e.clearConfig=function(){ge=null,Pn=!1},e.isValidAttribute=function(Pt,Zr,Ur){ge||At({});var On=Ae(Pt),di=Ae(Zr);return Ln(On,di,Ur)},e.addHook=function(Pt,Zr){typeof Zr=="function"&&(tt[Pt]=tt[Pt]||[],ev(tt[Pt],Zr))},e.removeHook=function(Pt){if(tt[Pt])return Oq(tt[Pt])},e.removeHooks=function(Pt){tt[Pt]&&(tt[Pt]=[])},e.removeAllHooks=function(){tt={}},e}var w8e=Gq();const B8e=Object.freeze(Object.defineProperty({__proto__:null,default:w8e},Symbol.toStringTag,{value:"Module"}));var ty=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Qq(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var tv=function(r){return r&&r.Math===Math&&r},Ha=tv(typeof globalThis=="object"&&globalThis)||tv(typeof window=="object"&&window)||tv(typeof self=="object"&&self)||tv(typeof ty=="object"&&ty)||tv(typeof ty=="object"&&ty)||function(){return this}()||Function("return this")(),rv={},Va=function(r){try{return!!r()}catch{return!0}},C8e=Va,df=!C8e(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),E8e=Va,ZC=!E8e(function(){var r=(function(){}).bind();return typeof r!="function"||r.hasOwnProperty("prototype")}),T8e=ZC,YC=Function.prototype.call,Sc=T8e?YC.bind(YC):function(){return YC.apply(YC,arguments)},$q={},jq={}.propertyIsEnumerable,qq=Object.getOwnPropertyDescriptor,S8e=qq&&!jq.call({1:2},1);$q.f=S8e?function(r){var e=qq(this,r);return!!e&&e.enumerable}:jq;var X5=function(r,e){return{enumerable:!(r&1),configurable:!(r&2),writable:!(r&4),value:e}},Kq=ZC,Wq=Function.prototype,J5=Wq.call,I8e=Kq&&Wq.bind.bind(J5,J5),Ga=Kq?I8e:function(r){return function(){return J5.apply(r,arguments)}},Xq=Ga,M8e=Xq({}.toString),P8e=Xq("".slice),mm=function(r){return P8e(M8e(r),8,-1)},F8e=Ga,R8e=Va,L8e=mm,Z5=Object,D8e=F8e("".split),Jq=R8e(function(){return!Z5("z").propertyIsEnumerable(0)})?function(r){return L8e(r)==="String"?D8e(r,""):Z5(r)}:Z5,_m=function(r){return r==null},O8e=_m,k8e=TypeError,ff=function(r){if(O8e(r))throw new k8e("Can't call method on "+r);return r},U8e=Jq,N8e=ff,nv=function(r){return U8e(N8e(r))},Y5=typeof document=="object"&&document.all,Qa=typeof Y5>"u"&&Y5!==void 0?function(r){return typeof r=="function"||r===Y5}:function(r){return typeof r=="function"},z8e=Qa,Af=function(r){return typeof r=="object"?r!==null:z8e(r)},e4=Ha,H8e=Qa,V8e=function(r){return H8e(r)?r:void 0},ym=function(r,e){return arguments.length<2?V8e(e4[r]):e4[r]&&e4[r][e]},G8e=Ga,eE=G8e({}.isPrototypeOf),tE=typeof navigator<"u"&&String(navigator.userAgent)||"",Zq=Ha,t4=tE,Yq=Zq.process,eK=Zq.Deno,tK=Yq&&Yq.versions||eK&&eK.version,rK=tK&&tK.v8,pf,rE;rK&&(pf=rK.split("."),rE=pf[0]>0&&pf[0]<4?1:+(pf[0]+pf[1])),!rE&&t4&&(pf=t4.match(/Edge\/(\d+)/),(!pf||pf[1]>=74)&&(pf=t4.match(/Chrome\/(\d+)/),pf&&(rE=+pf[1])));var r4=rE,nK=r4,Q8e=Va,$8e=Ha,j8e=$8e.String,iK=!!Object.getOwnPropertySymbols&&!Q8e(function(){var r=Symbol("symbol detection");return!j8e(r)||!(Object(r)instanceof Symbol)||!Symbol.sham&&nK&&nK<41}),q8e=iK,sK=q8e&&!Symbol.sham&&typeof Symbol.iterator=="symbol",K8e=ym,W8e=Qa,X8e=eE,J8e=sK,Z8e=Object,oK=J8e?function(r){return typeof r=="symbol"}:function(r){var e=K8e("Symbol");return W8e(e)&&X8e(e.prototype,Z8e(r))},Y8e=String,nE=function(r){try{return Y8e(r)}catch{return"Object"}},eze=Qa,tze=nE,rze=TypeError,IA=function(r){if(eze(r))return r;throw new rze(tze(r)+" is not a function")},nze=IA,ize=_m,ry=function(r,e){var t=r[e];return ize(t)?void 0:nze(t)},n4=Sc,i4=Qa,s4=Af,sze=TypeError,oze=function(r,e){var t,n;if(e==="string"&&i4(t=r.toString)&&!s4(n=n4(t,r))||i4(t=r.valueOf)&&!s4(n=n4(t,r))||e!=="string"&&i4(t=r.toString)&&!s4(n=n4(t,r)))return n;throw new sze("Can't convert object to primitive value")},aK={exports:{}},lK=Ha,aze=Object.defineProperty,o4=function(r,e){try{aze(lK,r,{value:e,configurable:!0,writable:!0})}catch{lK[r]=e}return e},lze=Ha,cze=o4,cK="__core-js_shared__",uK=aK.exports=lze[cK]||cze(cK,{});(uK.versions||(uK.versions=[])).push({version:"3.37.0",mode:"global",copyright:" 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.37.0/LICENSE",source:"https://github.com/zloirock/core-js"});var a4=aK.exports,hK=a4,l4=function(r,e){return hK[r]||(hK[r]=e||{})},uze=ff,hze=Object,iE=function(r){return hze(uze(r))},dze=Ga,fze=iE,Aze=dze({}.hasOwnProperty),gf=Object.hasOwn||function(r,e){return Aze(fze(r),e)},pze=Ga,gze=0,mze=Math.random(),_ze=pze(1 .toString),dK=function(r){return"Symbol("+(r===void 0?"":r)+")_"+_ze(++gze+mze,36)},yze=Ha,bze=l4,fK=gf,vze=dK,xze=iK,wze=sK,ny=yze.Symbol,c4=bze("wks"),Bze=wze?ny.for||ny:ny&&ny.withoutSetter||vze,sc=function(r){return fK(c4,r)||(c4[r]=xze&&fK(ny,r)?ny[r]:Bze("Symbol."+r)),c4[r]},Cze=Sc,AK=Af,pK=oK,Eze=ry,Tze=oze,Sze=sc,Ize=TypeError,Mze=Sze("toPrimitive"),Pze=function(r,e){if(!AK(r)||pK(r))return r;var t=Eze(r,Mze),n;if(t){if(e===void 0&&(e="default"),n=Cze(t,r,e),!AK(n)||pK(n))return n;throw new Ize("Can't convert object to primitive value")}return e===void 0&&(e="number"),Tze(r,e)},Fze=Pze,Rze=oK,gK=function(r){var e=Fze(r,"string");return Rze(e)?e:e+""},Lze=Ha,mK=Af,u4=Lze.document,Dze=mK(u4)&&mK(u4.createElement),sE=function(r){return Dze?u4.createElement(r):{}},Oze=df,kze=Va,Uze=sE,_K=!Oze&&!kze(function(){return Object.defineProperty(Uze("div"),"a",{get:function(){return 7}}).a!==7}),Nze=df,zze=Sc,Hze=$q,Vze=X5,Gze=nv,Qze=gK,$ze=gf,jze=_K,yK=Object.getOwnPropertyDescriptor;rv.f=Nze?yK:function(r,e){if(r=Gze(r),e=Qze(e),jze)try{return yK(r,e)}catch{}if($ze(r,e))return Vze(!zze(Hze.f,r,e),r[e])};var MA={},qze=df,Kze=Va,bK=qze&&Kze(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),Wze=Af,Xze=String,Jze=TypeError,Du=function(r){if(Wze(r))return r;throw new Jze(Xze(r)+" is not an object")},Zze=df,Yze=_K,e9e=bK,oE=Du,vK=gK,t9e=TypeError,h4=Object.defineProperty,r9e=Object.getOwnPropertyDescriptor,d4="enumerable",f4="configurable",A4="writable";MA.f=Zze?e9e?function(r,e,t){if(oE(r),e=vK(e),oE(t),typeof r=="function"&&e==="prototype"&&"value"in t&&A4 in t&&!t[A4]){var n=r9e(r,e);n&&n[A4]&&(r[e]=t.value,t={configurable:f4 in t?t[f4]:n[f4],enumerable:d4 in t?t[d4]:n[d4],writable:!1})}return h4(r,e,t)}:h4:function(r,e,t){if(oE(r),e=vK(e),oE(t),Yze)try{return h4(r,e,t)}catch{}if("get"in t||"set"in t)throw new t9e("Accessors not supported");return"value"in t&&(r[e]=t.value),r};var n9e=df,i9e=MA,s9e=X5,iv=n9e?function(r,e,t){return i9e.f(r,e,s9e(1,t))}:function(r,e,t){return r[e]=t,r},xK={exports:{}},p4=df,o9e=gf,wK=Function.prototype,a9e=p4&&Object.getOwnPropertyDescriptor,g4=o9e(wK,"name"),l9e=g4&&(function(){}).name==="something",c9e=g4&&(!p4||p4&&a9e(wK,"name").configurable),aE={EXISTS:g4,PROPER:l9e,CONFIGURABLE:c9e},u9e=Ga,h9e=Qa,m4=a4,d9e=u9e(Function.toString);h9e(m4.inspectSource)||(m4.inspectSource=function(r){return d9e(r)});var _4=m4.inspectSource,f9e=Ha,A9e=Qa,BK=f9e.WeakMap,p9e=A9e(BK)&&/native code/.test(String(BK)),g9e=l4,m9e=dK,CK=g9e("keys"),y4=function(r){return CK[r]||(CK[r]=m9e(r))},b4={},_9e=p9e,EK=Ha,y9e=Af,b9e=iv,v4=gf,x4=a4,v9e=y4,x9e=b4,TK="Object already initialized",w4=EK.TypeError,w9e=EK.WeakMap,lE,sv,cE,B9e=function(r){return cE(r)?sv(r):lE(r,{})},C9e=function(r){return function(e){var t;if(!y9e(e)||(t=sv(e)).type!==r)throw new w4("Incompatible receiver, "+r+" required");return t}};if(_9e||x4.state){var nA=x4.state||(x4.state=new w9e);nA.get=nA.get,nA.has=nA.has,nA.set=nA.set,lE=function(r,e){if(nA.has(r))throw new w4(TK);return e.facade=r,nA.set(r,e),e},sv=function(r){return nA.get(r)||{}},cE=function(r){return nA.has(r)}}else{var iy=v9e("state");x9e[iy]=!0,lE=function(r,e){if(v4(r,iy))throw new w4(TK);return e.facade=r,b9e(r,iy,e),e},sv=function(r){return v4(r,iy)?r[iy]:{}},cE=function(r){return v4(r,iy)}}var uE={set:lE,get:sv,has:cE,enforce:B9e,getterFor:C9e},B4=Ga,E9e=Va,T9e=Qa,hE=gf,C4=df,S9e=aE.CONFIGURABLE,I9e=_4,SK=uE,M9e=SK.enforce,P9e=SK.get,IK=String,dE=Object.defineProperty,F9e=B4("".slice),R9e=B4("".replace),L9e=B4([].join),D9e=C4&&!E9e(function(){return dE(function(){},"length",{value:8}).length!==8}),O9e=String(String).split("String"),k9e=xK.exports=function(r,e,t){F9e(IK(e),0,7)==="Symbol("&&(e="["+R9e(IK(e),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),t&&t.getter&&(e="get "+e),t&&t.setter&&(e="set "+e),(!hE(r,"name")||S9e&&r.name!==e)&&(C4?dE(r,"name",{value:e,configurable:!0}):r.name=e),D9e&&t&&hE(t,"arity")&&r.length!==t.arity&&dE(r,"length",{value:t.arity});try{t&&hE(t,"constructor")&&t.constructor?C4&&dE(r,"prototype",{writable:!1}):r.prototype&&(r.prototype=void 0)}catch{}var n=M9e(r);return hE(n,"source")||(n.source=L9e(O9e,typeof e=="string"?e:"")),r};Function.prototype.toString=k9e(function(){return T9e(this)&&P9e(this).source||I9e(this)},"toString");var MK=xK.exports,U9e=Qa,N9e=MA,z9e=MK,H9e=o4,bm=function(r,e,t,n){n||(n={});var i=n.enumerable,s=n.name!==void 0?n.name:e;if(U9e(t)&&z9e(t,s,n),n.global)i?r[e]=t:H9e(e,t);else{try{n.unsafe?r[e]&&(i=!0):delete r[e]}catch{}i?r[e]=t:N9e.f(r,e,{value:t,enumerable:!1,configurable:!n.nonConfigurable,writable:!n.nonWritable})}return r},PK={},V9e=Math.ceil,G9e=Math.floor,Q9e=Math.trunc||function(r){var e=+r;return(e>0?G9e:V9e)(e)},$9e=Q9e,fE=function(r){var e=+r;return e!==e||e===0?0:$9e(e)},j9e=fE,q9e=Math.max,K9e=Math.min,W9e=function(r,e){var t=j9e(r);return t<0?q9e(t+e,0):K9e(t,e)},X9e=fE,J9e=Math.min,sy=function(r){var e=X9e(r);return e>0?J9e(e,9007199254740991):0},Z9e=sy,E4=function(r){return Z9e(r.length)},Y9e=nv,eHe=W9e,tHe=E4,FK=function(r){return function(e,t,n){var i=Y9e(e),s=tHe(i);if(s===0)return!r&&-1;var a=eHe(n,s),o;if(r&&t!==t){for(;s>a;)if(o=i[a++],o!==o)return!0}else for(;s>a;a++)if((r||a in i)&&i[a]===t)return r||a||0;return!r&&-1}},RK={includes:FK(!0),indexOf:FK(!1)},rHe=Ga,T4=gf,nHe=nv,iHe=RK.indexOf,sHe=b4,LK=rHe([].push),DK=function(r,e){var t=nHe(r),n=0,i=[],s;for(s in t)!T4(sHe,s)&&T4(t,s)&&LK(i,s);for(;e.length>n;)T4(t,s=e[n++])&&(~iHe(i,s)||LK(i,s));return i},S4=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],oHe=DK,aHe=S4,lHe=aHe.concat("length","prototype");PK.f=Object.getOwnPropertyNames||function(r){return oHe(r,lHe)};var OK={};OK.f=Object.getOwnPropertySymbols;var cHe=ym,uHe=Ga,hHe=PK,dHe=OK,fHe=Du,AHe=uHe([].concat),pHe=cHe("Reflect","ownKeys")||function(r){var e=hHe.f(fHe(r)),t=dHe.f;return t?AHe(e,t(r)):e},kK=gf,gHe=pHe,mHe=rv,_He=MA,yHe=function(r,e,t){for(var n=gHe(e),i=_He.f,s=mHe.f,a=0;a<n.length;a++){var o=n[a];!kK(r,o)&&!(t&&kK(t,o))&&i(r,o,s(e,o))}},bHe=Va,vHe=Qa,xHe=/#|\.prototype\./,ov=function(r,e){var t=BHe[wHe(r)];return t===EHe?!0:t===CHe?!1:vHe(e)?bHe(e):!!e},wHe=ov.normalize=function(r){return String(r).replace(xHe,".").toLowerCase()},BHe=ov.data={},CHe=ov.NATIVE="N",EHe=ov.POLYFILL="P",UK=ov,AE=Ha,THe=rv.f,SHe=iv,IHe=bm,MHe=o4,PHe=yHe,FHe=UK,Ou=function(r,e){var t=r.target,n=r.global,i=r.stat,s,a,o,h,f,_;if(n?a=AE:i?a=AE[t]||MHe(t,{}):a=AE[t]&&AE[t].prototype,a)for(o in e){if(f=e[o],r.dontCallGetSet?(_=THe(a,o),h=_&&_.value):h=a[o],s=FHe(n?o:t+(i?".":"#")+o,r.forced),!s&&h!==void 0){if(typeof f==typeof h)continue;PHe(f,h)}(r.sham||h&&h.sham)&&SHe(f,"sham",!0),IHe(a,o,f,r)}},RHe=Ha,LHe=mm,av=LHe(RHe.process)==="process",DHe=Ga,OHe=IA,kHe=function(r,e,t){try{return DHe(OHe(Object.getOwnPropertyDescriptor(r,e)[t]))}catch{}},UHe=Af,NHe=function(r){return UHe(r)||r===null},zHe=NHe,HHe=String,VHe=TypeError,GHe=function(r){if(zHe(r))return r;throw new VHe("Can't set "+HHe(r)+" as a prototype")},QHe=kHe,$He=Af,jHe=ff,qHe=GHe,NK=Object.setPrototypeOf||("__proto__"in{}?function(){var r=!1,e={},t;try{t=QHe(Object.prototype,"__proto__","set"),t(e,[]),r=e instanceof Array}catch{}return function(n,i){return jHe(n),qHe(i),$He(n)&&(r?t(n,i):n.__proto__=i),n}}():void 0),KHe=MA.f,WHe=gf,XHe=sc,zK=XHe("toStringTag"),pE=function(r,e,t){r&&!t&&(r=r.prototype),r&&!WHe(r,zK)&&KHe(r,zK,{configurable:!0,value:e})},HK=MK,JHe=MA,ZHe=function(r,e,t){return t.get&&HK(t.get,e,{getter:!0}),t.set&&HK(t.set,e,{setter:!0}),JHe.f(r,e,t)},YHe=ym,eVe=ZHe,tVe=sc,rVe=df,VK=tVe("species"),nVe=function(r){var e=YHe(r);rVe&&e&&!e[VK]&&eVe(e,VK,{configurable:!0,get:function(){return this}})},iVe=eE,sVe=TypeError,oVe=function(r,e){if(iVe(e,r))return r;throw new sVe("Incorrect invocation")},aVe=sc,lVe=aVe("toStringTag"),GK={};GK[lVe]="z";var cVe=String(GK)==="[object z]",uVe=cVe,hVe=Qa,gE=mm,dVe=sc,fVe=dVe("toStringTag"),AVe=Object,pVe=gE(function(){return arguments}())==="Arguments",gVe=function(r,e){try{return r[e]}catch{}},I4=uVe?gE:function(r){var e,t,n;return r===void 0?"Undefined":r===null?"Null":typeof(t=gVe(e=AVe(r),fVe))=="string"?t:pVe?gE(e):(n=gE(e))==="Object"&&hVe(e.callee)?"Arguments":n},mVe=Ga,_Ve=Va,QK=Qa,yVe=I4,bVe=ym,vVe=_4,$K=function(){},jK=bVe("Reflect","construct"),M4=/^\s*(?:class|function)\b/,xVe=mVe(M4.exec),wVe=!M4.test($K),lv=function(r){if(!QK(r))return!1;try{return jK($K,[],r),!0}catch{return!1}},qK=function(r){if(!QK(r))return!1;switch(yVe(r)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return wVe||!!xVe(M4,vVe(r))}catch{return!0}};qK.sham=!0;var BVe=!jK||_Ve(function(){var r;return lv(lv.call)||!lv(Object)||!lv(function(){r=!0})||r})?qK:lv,CVe=BVe,EVe=nE,TVe=TypeError,SVe=function(r){if(CVe(r))return r;throw new TVe(EVe(r)+" is not a constructor")},KK=Du,IVe=SVe,MVe=_m,PVe=sc,FVe=PVe("species"),WK=function(r,e){var t=KK(r).constructor,n;return t===void 0||MVe(n=KK(t)[FVe])?e:IVe(n)},RVe=ZC,XK=Function.prototype,JK=XK.apply,ZK=XK.call,YK=typeof Reflect=="object"&&Reflect.apply||(RVe?ZK.bind(JK):function(){return ZK.apply(JK,arguments)}),LVe=mm,DVe=Ga,mE=function(r){if(LVe(r)==="Function")return DVe(r)},eW=mE,OVe=IA,kVe=ZC,UVe=eW(eW.bind),P4=function(r,e){return OVe(r),e===void 0?r:kVe?UVe(r,e):function(){return r.apply(e,arguments)}},NVe=ym,tW=NVe("document","documentElement"),zVe=Ga,HVe=zVe([].slice),VVe=TypeError,GVe=function(r,e){if(r<e)throw new VVe("Not enough arguments");return r},QVe=tE,rW=/(?:ipad|iphone|ipod).*applewebkit/i.test(QVe),Uh=Ha,$Ve=YK,jVe=P4,nW=Qa,qVe=gf,iW=Va,sW=tW,KVe=HVe,oW=sE,WVe=GVe,XVe=rW,JVe=av,F4=Uh.setImmediate,R4=Uh.clearImmediate,ZVe=Uh.process,L4=Uh.Dispatch,YVe=Uh.Function,aW=Uh.MessageChannel,eGe=Uh.String,D4=0,cv={},lW="onreadystatechange",uv,vm,O4,k4;iW(function(){uv=Uh.location});var U4=function(r){if(qVe(cv,r)){var e=cv[r];delete cv[r],e()}},N4=function(r){return function(){U4(r)}},cW=function(r){U4(r.data)},uW=function(r){Uh.postMessage(eGe(r),uv.protocol+"//"+uv.host)};(!F4||!R4)&&(F4=function(r){WVe(arguments.length,1);var e=nW(r)?r:YVe(r),t=KVe(arguments,1);return cv[++D4]=function(){$Ve(e,void 0,t)},vm(D4),D4},R4=function(r){delete cv[r]},JVe?vm=function(r){ZVe.nextTick(N4(r))}:L4&&L4.now?vm=function(r){L4.now(N4(r))}:aW&&!XVe?(O4=new aW,k4=O4.port2,O4.port1.onmessage=cW,vm=jVe(k4.postMessage,k4)):Uh.addEventListener&&nW(Uh.postMessage)&&!Uh.importScripts&&uv&&uv.protocol!=="file:"&&!iW(uW)?(vm=uW,Uh.addEventListener("message",cW,!1)):lW in oW("script")?vm=function(r){sW.appendChild(oW("script"))[lW]=function(){sW.removeChild(this),U4(r)}}:vm=function(r){setTimeout(N4(r),0)});var hW={set:F4,clear:R4},dW=Ha,tGe=df,rGe=Object.getOwnPropertyDescriptor,nGe=function(r){if(!tGe)return dW[r];var e=rGe(dW,r);return e&&e.value},fW=function(){this.head=null,this.tail=null};fW.prototype={add:function(r){var e={item:r,next:null},t=this.tail;t?t.next=e:this.head=e,this.tail=e},get:function(){var r=this.head;if(r){var e=this.head=r.next;return e===null&&(this.tail=null),r.item}}};var AW=fW,iGe=tE,sGe=/ipad|iphone|ipod/i.test(iGe)&&typeof Pebble<"u",oGe=tE,aGe=/web0s(?!.*chrome)/i.test(oGe),oy=Ha,lGe=nGe,pW=P4,z4=hW.set,cGe=AW,uGe=rW,hGe=sGe,dGe=aGe,H4=av,gW=oy.MutationObserver||oy.WebKitMutationObserver,mW=oy.document,_W=oy.process,_E=oy.Promise,V4=lGe("queueMicrotask"),ay,G4,Q4,yE,yW;if(!V4){var bE=new cGe,vE=function(){var r,e;for(H4&&(r=_W.domain)&&r.exit();e=bE.get();)try{e()}catch(t){throw bE.head&&ay(),t}r&&r.enter()};!uGe&&!H4&&!dGe&&gW&&mW?(G4=!0,Q4=mW.createTextNode(""),new gW(vE).observe(Q4,{characterData:!0}),ay=function(){Q4.data=G4=!G4}):!hGe&&_E&&_E.resolve?(yE=_E.resolve(void 0),yE.constructor=_E,yW=pW(yE.then,yE),ay=function(){yW(vE)}):H4?ay=function(){_W.nextTick(vE)}:(z4=pW(z4,oy),ay=function(){z4(vE)}),V4=function(r){bE.head||ay(),bE.add(r)}}var fGe=V4,AGe=function(r,e){try{arguments.length===1?console.error(r):console.error(r,e)}catch{}},$4=function(r){try{return{error:!1,value:r()}}catch(e){return{error:!0,value:e}}},pGe=Ha,xE=pGe.Promise,bW=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",gGe=bW,mGe=av,_Ge=!gGe&&!mGe&&typeof window=="object"&&typeof document=="object",yGe=Ha,hv=xE,bGe=Qa,vGe=UK,xGe=_4,wGe=sc,BGe=_Ge,CGe=bW,j4=r4;hv&&hv.prototype;var EGe=wGe("species"),q4=!1,vW=bGe(yGe.PromiseRejectionEvent),TGe=vGe("Promise",function(){var r=xGe(hv),e=r!==String(hv);if(!e&&j4===66)return!0;if(!j4||j4<51||!/native code/.test(r)){var t=new hv(function(s){s(1)}),n=function(s){s(function(){},function(){})},i=t.constructor={};if(i[EGe]=n,q4=t.then(function(){})instanceof n,!q4)return!0}return!e&&(BGe||CGe)&&!vW}),dv={CONSTRUCTOR:TGe,REJECTION_EVENT:vW,SUBCLASSING:q4},ly={},xW=IA,SGe=TypeError,IGe=function(r){var e,t;this.promise=new r(function(n,i){if(e!==void 0||t!==void 0)throw new SGe("Bad Promise constructor");e=n,t=i}),this.resolve=xW(e),this.reject=xW(t)};ly.f=function(r){return new IGe(r)};var MGe=Ou,wE=av,zp=Ha,cy=Sc,wW=bm,BW=NK,PGe=pE,FGe=nVe,RGe=IA,BE=Qa,LGe=Af,DGe=oVe,OGe=WK,CW=hW.set,K4=fGe,kGe=AGe,UGe=$4,NGe=AW,EW=uE,CE=xE,W4=dv,TW=ly,EE="Promise",SW=W4.CONSTRUCTOR,zGe=W4.REJECTION_EVENT,HGe=W4.SUBCLASSING,X4=EW.getterFor(EE),VGe=EW.set,uy=CE&&CE.prototype,xm=CE,TE=uy,IW=zp.TypeError,J4=zp.document,Z4=zp.process,Y4=TW.f,GGe=Y4,QGe=!!(J4&&J4.createEvent&&zp.dispatchEvent),MW="unhandledrejection",$Ge="rejectionhandled",PW=0,FW=1,jGe=2,eL=1,RW=2,SE,LW,qGe,DW,OW=function(r){var e;return LGe(r)&&BE(e=r.then)?e:!1},kW=function(r,e){var t=e.value,n=e.state===FW,i=n?r.ok:r.fail,s=r.resolve,a=r.reject,o=r.domain,h,f,_;try{i?(n||(e.rejection===RW&&WGe(e),e.rejection=eL),i===!0?h=t:(o&&o.enter(),h=i(t),o&&(o.exit(),_=!0)),h===r.promise?a(new IW("Promise-chain cycle")):(f=OW(h))?cy(f,h,s,a):s(h)):a(t)}catch(x){o&&!_&&o.exit(),a(x)}},UW=function(r,e){r.notified||(r.notified=!0,K4(function(){for(var t=r.reactions,n;n=t.get();)kW(n,r);r.notified=!1,e&&!r.rejection&&KGe(r)}))},NW=function(r,e,t){var n,i;QGe?(n=J4.createEvent("Event"),n.promise=e,n.reason=t,n.initEvent(r,!1,!0),zp.dispatchEvent(n)):n={promise:e,reason:t},!zGe&&(i=zp["on"+r])?i(n):r===MW&&kGe("Unhandled promise rejection",t)},KGe=function(r){cy(CW,zp,function(){var e=r.facade,t=r.value,n=zW(r),i;if(n&&(i=UGe(function(){wE?Z4.emit("unhandledRejection",t,e):NW(MW,e,t)}),r.rejection=wE||zW(r)?RW:eL,i.error))throw i.value})},zW=function(r){return r.rejection!==eL&&!r.parent},WGe=function(r){cy(CW,zp,function(){var e=r.facade;wE?Z4.emit("rejectionHandled",e):NW($Ge,e,r.value)})},hy=function(r,e,t){return function(n){r(e,n,t)}},dy=function(r,e,t){r.done||(r.done=!0,t&&(r=t),r.value=e,r.state=jGe,UW(r,!0))},tL=function(r,e,t){if(!r.done){r.done=!0,t&&(r=t);try{if(r.facade===e)throw new IW("Promise can't be resolved itself");var n=OW(e);n?K4(function(){var i={done:!1};try{cy(n,e,hy(tL,i,r),hy(dy,i,r))}catch(s){dy(i,s,r)}}):(r.value=e,r.state=FW,UW(r,!1))}catch(i){dy({done:!1},i,r)}}};if(SW&&(xm=function(r){DGe(this,TE),RGe(r),cy(SE,this);var e=X4(this);try{r(hy(tL,e),hy(dy,e))}catch(t){dy(e,t)}},TE=xm.prototype,SE=function(r){VGe(this,{type:EE,done:!1,notified:!1,parent:!1,reactions:new NGe,rejection:!1,state:PW,value:void 0})},SE.prototype=wW(TE,"then",function(r,e){var t=X4(this),n=Y4(OGe(this,xm));return t.parent=!0,n.ok=BE(r)?r:!0,n.fail=BE(e)&&e,n.domain=wE?Z4.domain:void 0,t.state===PW?t.reactions.add(n):K4(function(){kW(n,t)}),n.promise}),LW=function(){var r=new SE,e=X4(r);this.promise=r,this.resolve=hy(tL,e),this.reject=hy(dy,e)},TW.f=Y4=function(r){return r===xm||r===qGe?new LW(r):GGe(r)},BE(CE)&&uy!==Object.prototype)){DW=uy.then,HGe||wW(uy,"then",function(r,e){var t=this;return new xm(function(n,i){cy(DW,t,n,i)}).then(r,e)},{unsafe:!0});try{delete uy.constructor}catch{}BW&&BW(uy,TE)}MGe({global:!0,constructor:!0,wrap:!0,forced:SW},{Promise:xm}),PGe(xm,EE,!1),FGe(EE);var fv={},XGe=sc,JGe=fv,ZGe=XGe("iterator"),YGe=Array.prototype,eQe=function(r){return r!==void 0&&(JGe.Array===r||YGe[ZGe]===r)},tQe=I4,HW=ry,rQe=_m,nQe=fv,iQe=sc,sQe=iQe("iterator"),VW=function(r){if(!rQe(r))return HW(r,sQe)||HW(r,"@@iterator")||nQe[tQe(r)]},oQe=Sc,aQe=IA,lQe=Du,cQe=nE,uQe=VW,hQe=TypeError,dQe=function(r,e){var t=arguments.length<2?uQe(r):e;if(aQe(t))return lQe(oQe(t,r));throw new hQe(cQe(r)+" is not iterable")},fQe=Sc,GW=Du,AQe=ry,pQe=function(r,e,t){var n,i;GW(r);try{if(n=AQe(r,"return"),!n){if(e==="throw")throw t;return t}n=fQe(n,r)}catch(s){i=!0,n=s}if(e==="throw")throw t;if(i)throw n;return GW(n),t},gQe=P4,mQe=Sc,_Qe=Du,yQe=nE,bQe=eQe,vQe=E4,QW=eE,xQe=dQe,wQe=VW,$W=pQe,BQe=TypeError,IE=function(r,e){this.stopped=r,this.result=e},jW=IE.prototype,qW=function(r,e,t){var n=t&&t.that,i=!!(t&&t.AS_ENTRIES),s=!!(t&&t.IS_RECORD),a=!!(t&&t.IS_ITERATOR),o=!!(t&&t.INTERRUPTED),h=gQe(e,n),f,_,x,T,I,N,$,W=function(ie){return f&&$W(f,"normal",ie),new IE(!0,ie)},Y=function(ie){return i?(_Qe(ie),o?h(ie[0],ie[1],W):h(ie[0],ie[1])):o?h(ie,W):h(ie)};if(s)f=r.iterator;else if(a)f=r;else{if(_=wQe(r),!_)throw new BQe(yQe(r)+" is not iterable");if(bQe(_)){for(x=0,T=vQe(r);T>x;x++)if(I=Y(r[x]),I&&QW(jW,I))return I;return new IE(!1)}f=xQe(r,_)}for(N=s?r.next:f.next;!($=mQe(N,f)).done;){try{I=Y($.value)}catch(ie){$W(f,"throw",ie)}if(typeof I=="object"&&I&&QW(jW,I))return I}return new IE(!1)},CQe=sc,KW=CQe("iterator"),WW=!1;try{var EQe=0,XW={next:function(){return{done:!!EQe++}},return:function(){WW=!0}};XW[KW]=function(){return this},Array.from(XW,function(){throw 2})}catch{}var TQe=function(r,e){try{if(!e&&!WW)return!1}catch{return!1}var t=!1;try{var n={};n[KW]=function(){return{next:function(){return{done:t=!0}}}},r(n)}catch{}return t},SQe=xE,IQe=TQe,MQe=dv.CONSTRUCTOR,JW=MQe||!IQe(function(r){SQe.all(r).then(void 0,function(){})}),PQe=Ou,FQe=Sc,RQe=IA,LQe=ly,DQe=$4,OQe=qW,kQe=JW;PQe({target:"Promise",stat:!0,forced:kQe},{all:function(r){var e=this,t=LQe.f(e),n=t.resolve,i=t.reject,s=DQe(function(){var a=RQe(e.resolve),o=[],h=0,f=1;OQe(r,function(_){var x=h++,T=!1;f++,FQe(a,e,_).then(function(I){T||(T=!0,o[x]=I,--f||n(o))},i)}),--f||n(o)});return s.error&&i(s.value),t.promise}});var UQe=Ou,NQe=dv.CONSTRUCTOR,rL=xE,zQe=ym,HQe=Qa,VQe=bm,ZW=rL&&rL.prototype;if(UQe({target:"Promise",proto:!0,forced:NQe,real:!0},{catch:function(r){return this.then(void 0,r)}}),HQe(rL)){var YW=zQe("Promise").prototype.catch;ZW.catch!==YW&&VQe(ZW,"catch",YW,{unsafe:!0})}var GQe=Ou,QQe=Sc,$Qe=IA,jQe=ly,qQe=$4,KQe=qW,WQe=JW;GQe({target:"Promise",stat:!0,forced:WQe},{race:function(r){var e=this,t=jQe.f(e),n=t.reject,i=qQe(function(){var s=$Qe(e.resolve);KQe(r,function(a){QQe(s,e,a).then(t.resolve,n)})});return i.error&&n(i.value),t.promise}});var XQe=Ou,JQe=ly,ZQe=dv.CONSTRUCTOR;XQe({target:"Promise",stat:!0,forced:ZQe},{reject:function(r){var e=JQe.f(this),t=e.reject;return t(r),e.promise}});var YQe=Du,e$e=Af,t$e=ly,r$e=function(r,e){if(YQe(r),e$e(e)&&e.constructor===r)return e;var t=t$e.f(r),n=t.resolve;return n(e),t.promise},n$e=Ou,i$e=ym,s$e=dv.CONSTRUCTOR,o$e=r$e;i$e("Promise"),n$e({target:"Promise",stat:!0,forced:s$e},{resolve:function(r){return o$e(this,r)}});function eX(r,e,t,n,i,s,a){try{var o=r[s](a),h=o.value}catch(f){t(f);return}o.done?e(h):Promise.resolve(h).then(n,i)}function PA(r){return function(){var e=this,t=arguments;return new Promise(function(n,i){var s=r.apply(e,t);function a(h){eX(s,n,i,a,o,"next",h)}function o(h){eX(s,n,i,a,o,"throw",h)}a(void 0)})}}var a$e=I4,l$e=String,iA=function(r){if(a$e(r)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return l$e(r)},c$e=Du,tX=function(){var r=c$e(this),e="";return r.hasIndices&&(e+="d"),r.global&&(e+="g"),r.ignoreCase&&(e+="i"),r.multiline&&(e+="m"),r.dotAll&&(e+="s"),r.unicode&&(e+="u"),r.unicodeSets&&(e+="v"),r.sticky&&(e+="y"),e},nL=Va,u$e=Ha,iL=u$e.RegExp,sL=nL(function(){var r=iL("a","y");return r.lastIndex=2,r.exec("abcd")!==null}),h$e=sL||nL(function(){return!iL("a","y").sticky}),d$e=sL||nL(function(){var r=iL("^r","gy");return r.lastIndex=2,r.exec("str")!==null}),rX={BROKEN_CARET:d$e,MISSED_STICKY:h$e,UNSUPPORTED_Y:sL},nX={},f$e=DK,A$e=S4,p$e=Object.keys||function(r){return f$e(r,A$e)},g$e=df,m$e=bK,_$e=MA,y$e=Du,b$e=nv,v$e=p$e;nX.f=g$e&&!m$e?Object.defineProperties:function(r,e){y$e(r);for(var t=b$e(e),n=v$e(e),i=n.length,s=0,a;i>s;)_$e.f(r,a=n[s++],t[a]);return r};var x$e=Du,w$e=nX,iX=S4,B$e=b4,C$e=tW,E$e=sE,T$e=y4,sX=">",oX="<",oL="prototype",aL="script",aX=T$e("IE_PROTO"),lL=function(){},lX=function(r){return oX+aL+sX+r+oX+"/"+aL+sX},cX=function(r){r.write(lX("")),r.close();var e=r.parentWindow.Object;return r=null,e},S$e=function(){var r=E$e("iframe"),e="java"+aL+":",t;return r.style.display="none",C$e.appendChild(r),r.src=String(e),t=r.contentWindow.document,t.open(),t.write(lX("document.F=Object")),t.close(),t.F},ME,PE=function(){try{ME=new ActiveXObject("htmlfile")}catch{}PE=typeof document<"u"?document.domain&&ME?cX(ME):S$e():cX(ME);for(var r=iX.length;r--;)delete PE[oL][iX[r]];return PE()};B$e[aX]=!0;var cL=Object.create||function(r,e){var t;return r!==null?(lL[oL]=x$e(r),t=new lL,lL[oL]=null,t[aX]=r):t=PE(),e===void 0?t:w$e.f(t,e)},I$e=Va,M$e=Ha,P$e=M$e.RegExp,F$e=I$e(function(){var r=P$e(".","s");return!(r.dotAll&&r.test(`
`)&&r.flags==="s")}),R$e=Va,L$e=Ha,D$e=L$e.RegExp,O$e=R$e(function(){var r=D$e("(?<a>b)","g");return r.exec("b").groups.a!=="b"||"b".replace(r,"$<a>c")!=="bc"}),fy=Sc,FE=Ga,k$e=iA,U$e=tX,N$e=rX,z$e=l4,H$e=cL,V$e=uE.get,G$e=F$e,Q$e=O$e,$$e=z$e("native-string-replace",String.prototype.replace),RE=RegExp.prototype.exec,uL=RE,j$e=FE("".charAt),q$e=FE("".indexOf),K$e=FE("".replace),hL=FE("".slice),dL=function(){var r=/a/,e=/b*/g;return fy(RE,r,"a"),fy(RE,e,"a"),r.lastIndex!==0||e.lastIndex!==0}(),uX=N$e.BROKEN_CARET,fL=/()??/.exec("")[1]!==void 0,W$e=dL||fL||uX||G$e||Q$e;W$e&&(uL=function(r){var e=this,t=V$e(e),n=k$e(r),i=t.raw,s,a,o,h,f,_,x;if(i)return i.lastIndex=e.lastIndex,s=fy(uL,i,n),e.lastIndex=i.lastIndex,s;var T=t.groups,I=uX&&e.sticky,N=fy(U$e,e),$=e.source,W=0,Y=n;if(I&&(N=K$e(N,"y",""),q$e(N,"g")===-1&&(N+="g"),Y=hL(n,e.lastIndex),e.lastIndex>0&&(!e.multiline||e.multiline&&j$e(n,e.lastIndex-1)!==`
`)&&($="(?: "+$+")",Y=" "+Y,W++),a=new RegExp("^(?:"+$+")",N)),fL&&(a=new RegExp("^"+$+"$(?!\\s)",N)),dL&&(o=e.lastIndex),h=fy(RE,I?a:e,Y),I?h?(h.input=hL(h.input,W),h[0]=hL(h[0],W),h.index=e.lastIndex,e.lastIndex+=h[0].length):e.lastIndex=0:dL&&h&&(e.lastIndex=e.global?h.index+h[0].length:o),fL&&h&&h.length>1&&fy($$e,h[0],a,function(){for(f=1;f<arguments.length-2;f++)arguments[f]===void 0&&(h[f]=void 0)}),h&&T)for(h.groups=_=H$e(null),f=0;f<T.length;f++)x=T[f],_[x[0]]=h[x[1]];return h});var AL=uL,X$e=Ou,hX=AL;X$e({target:"RegExp",proto:!0,forced:/./.exec!==hX},{exec:hX});var dX=Sc,fX=bm,J$e=AL,AX=Va,pX=sc,Z$e=iv,Y$e=pX("species"),pL=RegExp.prototype,gL=function(r,e,t,n){var i=pX(r),s=!AX(function(){var f={};return f[i]=function(){return 7},""[r](f)!==7}),a=s&&!AX(function(){var f=!1,_=/a/;return r==="split"&&(_={},_.constructor={},_.constructor[Y$e]=function(){return _},_.flags="",_[i]=/./[i]),_.exec=function(){return f=!0,null},_[i](""),!f});if(!s||!a||t){var o=/./[i],h=e(i,""[r],function(f,_,x,T,I){var N=_.exec;return N===J$e||N===pL.exec?s&&!I?{done:!0,value:dX(o,_,x,T)}:{done:!0,value:dX(f,x,_,T)}:{done:!1}});fX(String.prototype,r,h[0]),fX(pL,i,h[1])}n&&Z$e(pL[i],"sham",!0)},mL=Ga,eje=fE,tje=iA,rje=ff,nje=mL("".charAt),gX=mL("".charCodeAt),ije=mL("".slice),mX=function(r){return function(e,t){var n=tje(rje(e)),i=eje(t),s=n.length,a,o;return i<0||i>=s?r?"":void 0:(a=gX(n,i),a<55296||a>56319||i+1===s||(o=gX(n,i+1))<56320||o>57343?r?nje(n,i):a:r?ije(n,i,i+2):(a-55296<<10)+(o-56320)+65536)}},sje={codeAt:mX(!1),charAt:mX(!0)},oje=sje.charAt,_L=function(r,e,t){return e+(t?oje(r,e).length:1)},_X=Sc,aje=Du,lje=Qa,cje=mm,uje=AL,hje=TypeError,yL=function(r,e){var t=r.exec;if(lje(t)){var n=_X(t,r,e);return n!==null&&aje(n),n}if(cje(r)==="RegExp")return _X(uje,r,e);throw new hje("RegExp#exec called on incompatible receiver")},dje=Sc,fje=gL,Aje=Du,pje=_m,gje=sy,bL=iA,mje=ff,_je=ry,yje=_L,yX=yL;fje("match",function(r,e,t){return[function(n){var i=mje(this),s=pje(n)?void 0:_je(n,r);return s?dje(s,n,i):new RegExp(n)[r](bL(i))},function(n){var i=Aje(this),s=bL(n),a=t(e,i,s);if(a.done)return a.value;if(!i.global)return yX(i,s);var o=i.unicode;i.lastIndex=0;for(var h=[],f=0,_;(_=yX(i,s))!==null;){var x=bL(_[0]);h[f]=x,x===""&&(i.lastIndex=yje(s,gje(i.lastIndex),o)),f++}return f===0?null:h}]});var vL=Ga,bje=iE,vje=Math.floor,xL=vL("".charAt),xje=vL("".replace),wL=vL("".slice),wje=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,Bje=/\$([$&'`]|\d{1,2})/g,Cje=function(r,e,t,n,i,s){var a=t+r.length,o=n.length,h=Bje;return i!==void 0&&(i=bje(i),h=wje),xje(s,h,function(f,_){var x;switch(xL(_,0)){case"$":return"$";case"&":return r;case"`":return wL(e,0,t);case"'":return wL(e,a);case"<":x=i[wL(_,1,-1)];break;default:var T=+_;if(T===0)return f;if(T>o){var I=vje(T/10);return I===0?f:I<=o?n[I-1]===void 0?xL(_,1):n[I-1]+xL(_,1):f}x=n[T-1]}return x===void 0?"":x})},Eje=YK,bX=Sc,LE=Ga,Tje=gL,Sje=Va,Ije=Du,Mje=Qa,Pje=_m,Fje=fE,Rje=sy,Ay=iA,Lje=ff,Dje=_L,Oje=ry,kje=Cje,Uje=yL,Nje=sc,BL=Nje("replace"),zje=Math.max,Hje=Math.min,Vje=LE([].concat),CL=LE([].push),vX=LE("".indexOf),xX=LE("".slice),Gje=function(r){return r===void 0?r:String(r)},Qje=function(){return"a".replace(/./,"$0")==="$0"}(),wX=function(){return/./[BL]?/./[BL]("a","$0")==="":!1}(),$je=!Sje(function(){var r=/./;return r.exec=function(){var e=[];return e.groups={a:"7"},e},"".replace(r,"$<a>")!=="7"});Tje("replace",function(r,e,t){var n=wX?"$":"$0";return[function(i,s){var a=Lje(this),o=Pje(i)?void 0:Oje(i,BL);return o?bX(o,i,a,s):bX(e,Ay(a),i,s)},function(i,s){var a=Ije(this),o=Ay(i);if(typeof s=="string"&&vX(s,n)===-1&&vX(s,"$<")===-1){var h=t(e,a,o,s);if(h.done)return h.value}var f=Mje(s);f||(s=Ay(s));var _=a.global,x;_&&(x=a.unicode,a.lastIndex=0);for(var T=[],I;I=Uje(a,o),!(I===null||(CL(T,I),!_));){var N=Ay(I[0]);N===""&&(a.lastIndex=Dje(o,Rje(a.lastIndex),x))}for(var $="",W=0,Y=0;Y<T.length;Y++){I=T[Y];for(var ie=Ay(I[0]),ce=zje(Hje(Fje(I.index),o.length),0),fe=[],ve,be=1;be<I.length;be++)CL(fe,Gje(I[be]));var Qe=I.groups;if(f){var Ue=Vje([ie],fe,ce,o);Qe!==void 0&&CL(Ue,Qe),ve=Ay(Eje(s,void 0,Ue))}else ve=kje(ie,o,ce,fe,Qe,s);ce>=W&&($+=xX(o,W,ce)+ve,W=ce+ie.length)}return $+xX(o,W)}]},!$je||!Qje||wX);var jje=Af,qje=mm,Kje=sc,Wje=Kje("match"),Xje=function(r){var e;return jje(r)&&((e=r[Wje])!==void 0?!!e:qje(r)==="RegExp")},Jje=Xje,Zje=TypeError,EL=function(r){if(Jje(r))throw new Zje("The method doesn't accept regular expressions");return r},Yje=sc,e7e=Yje("match"),TL=function(r){var e=/./;try{"/./"[r](e)}catch{try{return e[e7e]=!1,"/./"[r](e)}catch{}}return!1},t7e=Ou,r7e=mE,n7e=rv.f,i7e=sy,BX=iA,s7e=EL,o7e=ff,a7e=TL,l7e=r7e("".slice),c7e=Math.min,CX=a7e("startsWith"),u7e=!CX&&!!function(){var r=n7e(String.prototype,"startsWith");return r&&!r.writable}();t7e({target:"String",proto:!0,forced:!u7e&&!CX},{startsWith:function(r){var e=BX(o7e(this));s7e(r);var t=i7e(c7e(arguments.length>1?arguments[1]:void 0,e.length)),n=BX(r);return l7e(e,t,t+n.length)===n}});var h7e=sc,d7e=cL,f7e=MA.f,SL=h7e("unscopables"),IL=Array.prototype;IL[SL]===void 0&&f7e(IL,SL,{configurable:!0,value:d7e(null)});var A7e=function(r){IL[SL][r]=!0},p7e=Va,g7e=!p7e(function(){function r(){}return r.prototype.constructor=null,Object.getPrototypeOf(new r)!==r.prototype}),m7e=gf,_7e=Qa,y7e=iE,b7e=y4,v7e=g7e,EX=b7e("IE_PROTO"),ML=Object,x7e=ML.prototype,TX=v7e?ML.getPrototypeOf:function(r){var e=y7e(r);if(m7e(e,EX))return e[EX];var t=e.constructor;return _7e(t)&&e instanceof t?t.prototype:e instanceof ML?x7e:null},w7e=Va,B7e=Qa,C7e=Af,SX=TX,E7e=bm,T7e=sc,PL=T7e("iterator"),IX=!1,wm,FL,RL;[].keys&&(RL=[].keys(),"next"in RL?(FL=SX(SX(RL)),FL!==Object.prototype&&(wm=FL)):IX=!0);var S7e=!C7e(wm)||w7e(function(){var r={};return wm[PL].call(r)!==r});S7e&&(wm={}),B7e(wm[PL])||E7e(wm,PL,function(){return this});var MX={IteratorPrototype:wm,BUGGY_SAFARI_ITERATORS:IX},I7e=MX.IteratorPrototype,M7e=cL,P7e=X5,F7e=pE,R7e=fv,L7e=function(){return this},D7e=function(r,e,t,n){var i=e+" Iterator";return r.prototype=M7e(I7e,{next:P7e(+!n,t)}),F7e(r,i,!1),R7e[i]=L7e,r},O7e=Ou,k7e=Sc,PX=aE,U7e=Qa,N7e=D7e,FX=TX,RX=NK,z7e=pE,H7e=iv,LL=bm,V7e=sc,G7e=fv,LX=MX,Q7e=PX.PROPER,$7e=PX.CONFIGURABLE,DX=LX.IteratorPrototype,DE=LX.BUGGY_SAFARI_ITERATORS,Av=V7e("iterator"),OX="keys",pv="values",kX="entries",j7e=function(){return this},q7e=function(r,e,t,n,i,s,a){N7e(t,e,n);var o=function(Y){if(Y===i&&T)return T;if(!DE&&Y&&Y in _)return _[Y];switch(Y){case OX:return function(){return new t(this,Y)};case pv:return function(){return new t(this,Y)};case kX:return function(){return new t(this,Y)}}return function(){return new t(this)}},h=e+" Iterator",f=!1,_=r.prototype,x=_[Av]||_["@@iterator"]||i&&_[i],T=!DE&&x||o(i),I=e==="Array"&&_.entries||x,N,$,W;if(I&&(N=FX(I.call(new r)),N!==Object.prototype&&N.next&&(FX(N)!==DX&&(RX?RX(N,DX):U7e(N[Av])||LL(N,Av,j7e)),z7e(N,h,!0))),Q7e&&i===pv&&x&&x.name!==pv&&($7e?H7e(_,"name",pv):(f=!0,T=function(){return k7e(x,this)})),i)if($={values:o(pv),keys:s?T:o(OX),entries:o(kX)},a)for(W in $)(DE||f||!(W in _))&&LL(_,W,$[W]);else O7e({target:e,proto:!0,forced:DE||f},$);return _[Av]!==T&&LL(_,Av,T,{name:i}),G7e[e]=T,$},K7e=function(r,e){return{value:r,done:e}},W7e=nv,DL=A7e,UX=fv,NX=uE,X7e=MA.f,J7e=q7e,OE=K7e,Z7e=df,zX="Array Iterator",Y7e=NX.set,eqe=NX.getterFor(zX),tqe=J7e(Array,"Array",function(r,e){Y7e(this,{type:zX,target:W7e(r),index:0,kind:e})},function(){var r=eqe(this),e=r.target,t=r.index++;if(!e||t>=e.length)return r.target=void 0,OE(void 0,!0);switch(r.kind){case"keys":return OE(t,!1);case"values":return OE(e[t],!1)}return OE([t,e[t]],!1)},"values"),HX=UX.Arguments=UX.Array;if(DL("keys"),DL("values"),DL("entries"),Z7e&&HX.name!=="values")try{X7e(HX,"name",{value:"values"})}catch{}var rqe={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},nqe=sE,OL=nqe("span").classList,VX=OL&&OL.constructor&&OL.constructor.prototype,iqe=VX===Object.prototype?void 0:VX,GX=Ha,QX=rqe,sqe=iqe,gv=tqe,$X=iv,oqe=pE,aqe=sc,kL=aqe("iterator"),UL=gv.values,jX=function(r,e){if(r){if(r[kL]!==UL)try{$X(r,kL,UL)}catch{r[kL]=UL}if(oqe(r,e,!0),QX[e]){for(var t in gv)if(r[t]!==gv[t])try{$X(r,t,gv[t])}catch{r[t]=gv[t]}}}};for(var NL in QX)jX(GX[NL]&&GX[NL].prototype,NL);jX(sqe,"DOMTokenList");function lqe(r,e){if(Ms(r)!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var n=t.call(r,e||"default");if(Ms(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function cqe(r){var e=lqe(r,"string");return Ms(e)=="symbol"?e:e+""}function zL(r,e,t){return e=cqe(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}var uqe=IA,hqe=iE,dqe=Jq,fqe=E4,qX=TypeError,KX="Reduce of empty array with no initial value",WX=function(r){return function(e,t,n,i){var s=hqe(e),a=dqe(s),o=fqe(s);if(uqe(t),o===0&&n<2)throw new qX(KX);var h=r?o-1:0,f=r?-1:1;if(n<2)for(;;){if(h in a){i=a[h],h+=f;break}if(h+=f,r?h<0:o<=h)throw new qX(KX)}for(;r?h>=0:o>h;h+=f)h in a&&(i=t(i,a[h],h,s));return i}},Aqe={left:WX(!1),right:WX(!0)},pqe=Va,XX=function(r,e){var t=[][r];return!!t&&pqe(function(){t.call(null,e||function(){return 1},1)})},gqe=Ou,mqe=Aqe.left,_qe=XX,JX=r4,yqe=av,bqe=!yqe&&JX>79&&JX<83,vqe=bqe||!_qe("reduce");gqe({target:"Array",proto:!0,forced:vqe},{reduce:function(r){var e=arguments.length;return mqe(this,r,e,e>1?arguments[1]:void 0)}});var xqe=Ou,wqe=mE,Bqe=rv.f,Cqe=sy,ZX=iA,Eqe=EL,Tqe=ff,Sqe=TL,Iqe=wqe("".slice),Mqe=Math.min,YX=Sqe("endsWith"),Pqe=!YX&&!!function(){var r=Bqe(String.prototype,"endsWith");return r&&!r.writable}();xqe({target:"String",proto:!0,forced:!Pqe&&!YX},{endsWith:function(r){var e=ZX(Tqe(this));Eqe(r);var t=arguments.length>1?arguments[1]:void 0,n=e.length,i=t===void 0?n:Mqe(Cqe(t),n),s=ZX(r);return Iqe(e,i-s.length,i)===s}});var HL=Sc,eJ=Ga,Fqe=gL,Rqe=Du,Lqe=_m,Dqe=ff,Oqe=WK,kqe=_L,Uqe=sy,tJ=iA,Nqe=ry,rJ=yL,zqe=rX,Hqe=Va,py=zqe.UNSUPPORTED_Y,Vqe=4294967295,Gqe=Math.min,VL=eJ([].push),QL=eJ("".slice),Qqe=!Hqe(function(){var r=/(?:)/,e=r.exec;r.exec=function(){return e.apply(this,arguments)};var t="ab".split(r);return t.length!==2||t[0]!=="a"||t[1]!=="b"}),nJ="abbc".split(/(b)*/)[1]==="c"||"test".split(/(?:)/,-1).length!==4||"ab".split(/(?:ab)*/).length!==2||".".split(/(.?)(.?)/).length!==4||".".split(/()()/).length>1||"".split(/.?/).length;Fqe("split",function(r,e,t){var n="0".split(void 0,0).length?function(i,s){return i===void 0&&s===0?[]:HL(e,this,i,s)}:e;return[function(i,s){var a=Dqe(this),o=Lqe(i)?void 0:Nqe(i,r);return o?HL(o,i,a,s):HL(n,tJ(a),i,s)},function(i,s){var a=Rqe(this),o=tJ(i);if(!nJ){var h=t(n,a,o,s,n!==e);if(h.done)return h.value}var f=Oqe(a,RegExp),_=a.unicode,x=(a.ignoreCase?"i":"")+(a.multiline?"m":"")+(a.unicode?"u":"")+(py?"g":"y"),T=new f(py?"^(?:"+a.source+")":a,x),I=s===void 0?Vqe:s>>>0;if(I===0)return[];if(o.length===0)return rJ(T,o)===null?[o]:[];for(var N=0,$=0,W=[];$<o.length;){T.lastIndex=py?0:$;var Y=rJ(T,py?QL(o,$):o),ie;if(Y===null||(ie=Gqe(Uqe(T.lastIndex+(py?$:0)),o.length))===N)$=kqe(o,$,_);else{if(VL(W,QL(o,N,$)),W.length===I)return W;for(var ce=1;ce<=Y.length-1;ce++)if(VL(W,Y[ce]),W.length===I)return W;$=N=ie}}return VL(W,QL(o,N)),W}]},nJ||!Qqe,py);var kE={exports:{}},mv={exports:{}};(function(){var r,e,t,n,i,s;typeof performance<"u"&&performance!==null&&performance.now?mv.exports=function(){return performance.now()}:typeof process<"u"&&process!==null&&process.hrtime?(mv.exports=function(){return(r()-i)/1e6},e=process.hrtime,r=function(){var a;return a=e(),a[0]*1e9+a[1]},n=r(),s=process.uptime()*1e9,i=n-s):Date.now?(mv.exports=function(){return Date.now()-t},t=Date.now()):(mv.exports=function(){return new Date().getTime()-t},t=new Date().getTime())}).call(ty);for(var $qe=mv.exports,jqe=$qe,FA=typeof window>"u"?ty:window,UE=["moz","webkit"],gy="AnimationFrame",my=FA["request"+gy],_v=FA["cancel"+gy]||FA["cancelRequest"+gy],yv=0;!my&&yv<UE.length;yv++)my=FA[UE[yv]+"Request"+gy],_v=FA[UE[yv]+"Cancel"+gy]||FA[UE[yv]+"CancelRequest"+gy];if(!my||!_v){var $L=0,iJ=0,Bm=[],qqe=1e3/60;my=function(r){if(Bm.length===0){var e=jqe(),t=Math.max(0,qqe-(e-$L));$L=t+e,setTimeout(function(){var n=Bm.slice(0);Bm.length=0;for(var i=0;i<n.length;i++)if(!n[i].cancelled)try{n[i].callback($L)}catch(s){setTimeout(function(){throw s},0)}},Math.round(t))}return Bm.push({handle:++iJ,callback:r,cancelled:!1}),iJ},_v=function(r){for(var e=0;e<Bm.length;e++)Bm[e].handle===r&&(Bm[e].cancelled=!0)}}kE.exports=function(r){return my.call(FA,r)},kE.exports.cancel=function(){_v.apply(FA,arguments)},kE.exports.polyfill=function(r){r||(r=FA),r.requestAnimationFrame=my,r.cancelAnimationFrame=_v};var Kqe=kE.exports;const jL=Qq(Kqe);var sJ=`	
\v\f\r \u2028\u2029\uFEFF`,Wqe=Ga,Xqe=ff,Jqe=iA,qL=sJ,oJ=Wqe("".replace),Zqe=RegExp("^["+qL+"]+"),Yqe=RegExp("(^|[^"+qL+"])["+qL+"]+$"),KL=function(r){return function(e){var t=Jqe(Xqe(e));return r&1&&(t=oJ(t,Zqe,"")),r&2&&(t=oJ(t,Yqe,"$1")),t}},eKe={start:KL(1),end:KL(2),trim:KL(3)},tKe=aE.PROPER,rKe=Va,aJ=sJ,lJ="",nKe=function(r){return rKe(function(){return!!aJ[r]()||lJ[r]()!==lJ||tKe&&aJ[r].name!==r})},iKe=Ou,sKe=eKe.trim,oKe=nKe;iKe({target:"String",proto:!0,forced:oKe("trim")},{trim:function(){return sKe(this)}});var aKe=function(r){this.ok=!1,this.alpha=1,r.charAt(0)=="#"&&(r=r.substr(1,6)),r=r.replace(/ /g,""),r=r.toLowerCase();var e={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};r=e[r]||r;for(var t=[{re:/^rgba\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3}),\s*((?:\d?\.)?\d)\)$/,example:["rgba(123, 234, 45, 0.8)","rgba(255,234,245,1.0)"],process:function(h){return[parseInt(h[1]),parseInt(h[2]),parseInt(h[3]),parseFloat(h[4])]}},{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(h){return[parseInt(h[1]),parseInt(h[2]),parseInt(h[3])]}},{re:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,example:["#00ff00","336699"],process:function(h){return[parseInt(h[1],16),parseInt(h[2],16),parseInt(h[3],16)]}},{re:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,example:["#fb0","f0f"],process:function(h){return[parseInt(h[1]+h[1],16),parseInt(h[2]+h[2],16),parseInt(h[3]+h[3],16)]}}],n=0;n<t.length;n++){var i=t[n].re,s=t[n].process,a=i.exec(r);if(a){var o=s(a);this.r=o[0],this.g=o[1],this.b=o[2],o.length>3&&(this.alpha=o[3]),this.ok=!0}}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.alpha=this.alpha<0?0:this.alpha>1||isNaN(this.alpha)?1:this.alpha,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toRGBA=function(){return"rgba("+this.r+", "+this.g+", "+this.b+", "+this.alpha+")"},this.toHex=function(){var h=this.r.toString(16),f=this.g.toString(16),_=this.b.toString(16);return h.length==1&&(h="0"+h),f.length==1&&(f="0"+f),_.length==1&&(_="0"+_),"#"+h+f+_},this.getHelpXML=function(){for(var h=new Array,f=0;f<t.length;f++)for(var _=t[f].example,x=0;x<_.length;x++)h[h.length]=_[x];for(var T in e)h[h.length]=T;var I=document.createElement("ul");I.setAttribute("id","rgbcolor-examples");for(var f=0;f<h.length;f++)try{var N=document.createElement("li"),$=new RGBColor(h[f]),W=document.createElement("div");W.style.cssText="margin: 3px; border: 1px solid black; background:"+$.toHex()+"; color:"+$.toHex(),W.appendChild(document.createTextNode("test"));var Y=document.createTextNode(" "+h[f]+" -> "+$.toRGB()+" -> "+$.toHex());N.appendChild(W),N.appendChild(Y),I.appendChild(N)}catch{}return I}};const WL=Qq(aKe);var lKe=Ou,cKe=mE,uKe=RK.indexOf,hKe=XX,XL=cKe([].indexOf),cJ=!!XL&&1/XL([1],1,-0)<0,dKe=cJ||!hKe("indexOf");lKe({target:"Array",proto:!0,forced:dKe},{indexOf:function(r){var e=arguments.length>1?arguments[1]:void 0;return cJ?XL(this,r,e)||0:uKe(this,r,e)}});var fKe=Ou,AKe=Ga,pKe=EL,gKe=ff,uJ=iA,mKe=TL,_Ke=AKe("".indexOf);fKe({target:"String",proto:!0,forced:!mKe("includes")},{includes:function(r){return!!~_Ke(uJ(gKe(this)),uJ(pKe(r)),arguments.length>1?arguments[1]:void 0)}});var yKe=mm,bKe=Array.isArray||function(r){return yKe(r)==="Array"},vKe=Ou,xKe=Ga,wKe=bKe,BKe=xKe([].reverse),hJ=[1,2];vKe({target:"Array",proto:!0,forced:String(hJ)===String(hJ.reverse())},{reverse:function(){return wKe(this)&&(this.length=this.length),BKe(this)}});/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var dJ=function(r,e){return(dJ=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])})(r,e)};function fJ(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function t(){this.constructor=r}dJ(r,e),r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function CKe(r){var e="";Array.isArray(r)||(r=[r]);for(var t=0;t<r.length;t++){var n=r[t];if(n.type===rn.CLOSE_PATH)e+="z";else if(n.type===rn.HORIZ_LINE_TO)e+=(n.relative?"h":"H")+n.x;else if(n.type===rn.VERT_LINE_TO)e+=(n.relative?"v":"V")+n.y;else if(n.type===rn.MOVE_TO)e+=(n.relative?"m":"M")+n.x+" "+n.y;else if(n.type===rn.LINE_TO)e+=(n.relative?"l":"L")+n.x+" "+n.y;else if(n.type===rn.CURVE_TO)e+=(n.relative?"c":"C")+n.x1+" "+n.y1+" "+n.x2+" "+n.y2+" "+n.x+" "+n.y;else if(n.type===rn.SMOOTH_CURVE_TO)e+=(n.relative?"s":"S")+n.x2+" "+n.y2+" "+n.x+" "+n.y;else if(n.type===rn.QUAD_TO)e+=(n.relative?"q":"Q")+n.x1+" "+n.y1+" "+n.x+" "+n.y;else if(n.type===rn.SMOOTH_QUAD_TO)e+=(n.relative?"t":"T")+n.x+" "+n.y;else{if(n.type!==rn.ARC)throw new Error('Unexpected command type "'+n.type+'" at index '+t+".");e+=(n.relative?"a":"A")+n.rX+" "+n.rY+" "+n.xRot+" "+ +n.lArcFlag+" "+ +n.sweepFlag+" "+n.x+" "+n.y}}return e}function JL(r,e){var t=r[0],n=r[1];return[t*Math.cos(e)-n*Math.sin(e),t*Math.sin(e)+n*Math.cos(e)]}function mf(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];for(var t=0;t<r.length;t++)if(typeof r[t]!="number")throw new Error("assertNumbers arguments["+t+"] is not a number. "+typeof r[t]+" == typeof "+r[t]);return!0}var Hp=Math.PI;function ZL(r,e,t){r.lArcFlag=r.lArcFlag===0?0:1,r.sweepFlag=r.sweepFlag===0?0:1;var n=r.rX,i=r.rY,s=r.x,a=r.y;n=Math.abs(r.rX),i=Math.abs(r.rY);var o=JL([(e-s)/2,(t-a)/2],-r.xRot/180*Hp),h=o[0],f=o[1],_=Math.pow(h,2)/Math.pow(n,2)+Math.pow(f,2)/Math.pow(i,2);1<_&&(n*=Math.sqrt(_),i*=Math.sqrt(_)),r.rX=n,r.rY=i;var x=Math.pow(n,2)*Math.pow(f,2)+Math.pow(i,2)*Math.pow(h,2),T=(r.lArcFlag!==r.sweepFlag?1:-1)*Math.sqrt(Math.max(0,(Math.pow(n,2)*Math.pow(i,2)-x)/x)),I=n*f/i*T,N=-i*h/n*T,$=JL([I,N],r.xRot/180*Hp);r.cX=$[0]+(e+s)/2,r.cY=$[1]+(t+a)/2,r.phi1=Math.atan2((f-N)/i,(h-I)/n),r.phi2=Math.atan2((-f-N)/i,(-h-I)/n),r.sweepFlag===0&&r.phi2>r.phi1&&(r.phi2-=2*Hp),r.sweepFlag===1&&r.phi2<r.phi1&&(r.phi2+=2*Hp),r.phi1*=180/Hp,r.phi2*=180/Hp}function AJ(r,e,t){mf(r,e,t);var n=r*r+e*e-t*t;if(0>n)return[];if(n===0)return[[r*t/(r*r+e*e),e*t/(r*r+e*e)]];var i=Math.sqrt(n);return[[(r*t+e*i)/(r*r+e*e),(e*t-r*i)/(r*r+e*e)],[(r*t-e*i)/(r*r+e*e),(e*t+r*i)/(r*r+e*e)]]}var fl,RA=Math.PI/180;function pJ(r,e,t){return(1-t)*r+t*e}function gJ(r,e,t,n){return r+Math.cos(n/180*Hp)*e+Math.sin(n/180*Hp)*t}function mJ(r,e,t,n){var i=1e-6,s=e-r,a=t-e,o=3*s+3*(n-t)-6*a,h=6*(a-s),f=3*s;return Math.abs(o)<i?[-f/h]:function(_,x,T){var I=_*_/4-x;if(I<-T)return[];if(I<=T)return[-_/2];var N=Math.sqrt(I);return[-_/2-N,-_/2+N]}(h/o,f/o,i)}function _J(r,e,t,n,i){var s=1-i;return r*(s*s*s)+e*(3*s*s*i)+t*(3*s*i*i)+n*(i*i*i)}(function(r){function e(){return i(function(o,h,f){return o.relative&&(o.x1!==void 0&&(o.x1+=h),o.y1!==void 0&&(o.y1+=f),o.x2!==void 0&&(o.x2+=h),o.y2!==void 0&&(o.y2+=f),o.x!==void 0&&(o.x+=h),o.y!==void 0&&(o.y+=f),o.relative=!1),o})}function t(){var o=NaN,h=NaN,f=NaN,_=NaN;return i(function(x,T,I){return x.type&rn.SMOOTH_CURVE_TO&&(x.type=rn.CURVE_TO,o=isNaN(o)?T:o,h=isNaN(h)?I:h,x.x1=x.relative?T-o:2*T-o,x.y1=x.relative?I-h:2*I-h),x.type&rn.CURVE_TO?(o=x.relative?T+x.x2:x.x2,h=x.relative?I+x.y2:x.y2):(o=NaN,h=NaN),x.type&rn.SMOOTH_QUAD_TO&&(x.type=rn.QUAD_TO,f=isNaN(f)?T:f,_=isNaN(_)?I:_,x.x1=x.relative?T-f:2*T-f,x.y1=x.relative?I-_:2*I-_),x.type&rn.QUAD_TO?(f=x.relative?T+x.x1:x.x1,_=x.relative?I+x.y1:x.y1):(f=NaN,_=NaN),x})}function n(){var o=NaN,h=NaN;return i(function(f,_,x){if(f.type&rn.SMOOTH_QUAD_TO&&(f.type=rn.QUAD_TO,o=isNaN(o)?_:o,h=isNaN(h)?x:h,f.x1=f.relative?_-o:2*_-o,f.y1=f.relative?x-h:2*x-h),f.type&rn.QUAD_TO){o=f.relative?_+f.x1:f.x1,h=f.relative?x+f.y1:f.y1;var T=f.x1,I=f.y1;f.type=rn.CURVE_TO,f.x1=((f.relative?0:_)+2*T)/3,f.y1=((f.relative?0:x)+2*I)/3,f.x2=(f.x+2*T)/3,f.y2=(f.y+2*I)/3}else o=NaN,h=NaN;return f})}function i(o){var h=0,f=0,_=NaN,x=NaN;return function(T){if(isNaN(_)&&!(T.type&rn.MOVE_TO))throw new Error("path must start with moveto");var I=o(T,h,f,_,x);return T.type&rn.CLOSE_PATH&&(h=_,f=x),T.x!==void 0&&(h=T.relative?h+T.x:T.x),T.y!==void 0&&(f=T.relative?f+T.y:T.y),T.type&rn.MOVE_TO&&(_=h,x=f),I}}function s(o,h,f,_,x,T){return mf(o,h,f,_,x,T),i(function(I,N,$,W){var Y=I.x1,ie=I.x2,ce=I.relative&&!isNaN(W),fe=I.x!==void 0?I.x:ce?0:N,ve=I.y!==void 0?I.y:ce?0:$;function be($e){return $e*$e}I.type&rn.HORIZ_LINE_TO&&h!==0&&(I.type=rn.LINE_TO,I.y=I.relative?0:$),I.type&rn.VERT_LINE_TO&&f!==0&&(I.type=rn.LINE_TO,I.x=I.relative?0:N),I.x!==void 0&&(I.x=I.x*o+ve*f+(ce?0:x)),I.y!==void 0&&(I.y=fe*h+I.y*_+(ce?0:T)),I.x1!==void 0&&(I.x1=I.x1*o+I.y1*f+(ce?0:x)),I.y1!==void 0&&(I.y1=Y*h+I.y1*_+(ce?0:T)),I.x2!==void 0&&(I.x2=I.x2*o+I.y2*f+(ce?0:x)),I.y2!==void 0&&(I.y2=ie*h+I.y2*_+(ce?0:T));var Qe=o*_-h*f;if(I.xRot!==void 0&&(o!==1||h!==0||f!==0||_!==1))if(Qe===0)delete I.rX,delete I.rY,delete I.xRot,delete I.lArcFlag,delete I.sweepFlag,I.type=rn.LINE_TO;else{var Ue=I.xRot*Math.PI/180,st=Math.sin(Ue),at=Math.cos(Ue),Le=1/be(I.rX),ze=1/be(I.rY),tt=be(at)*Le+be(st)*ze,Ne=2*st*at*(Le-ze),Ht=be(st)*Le+be(at)*ze,Vt=tt*_*_-Ne*h*_+Ht*h*h,Jt=Ne*(o*_+h*f)-2*(tt*f*_+Ht*o*h),Kt=tt*f*f-Ne*o*f+Ht*o*o,er=(Math.atan2(Jt,Vt-Kt)+Math.PI)%Math.PI/2,Xt=Math.sin(er),Fr=Math.cos(er);I.rX=Math.abs(Qe)/Math.sqrt(Vt*be(Fr)+Jt*Xt*Fr+Kt*be(Xt)),I.rY=Math.abs(Qe)/Math.sqrt(Vt*be(Xt)-Jt*Xt*Fr+Kt*be(Fr)),I.xRot=180*er/Math.PI}return I.sweepFlag!==void 0&&0>Qe&&(I.sweepFlag=+!I.sweepFlag),I})}function a(){return function(o){var h={};for(var f in o)h[f]=o[f];return h}}r.ROUND=function(o){function h(f){return Math.round(f*o)/o}return o===void 0&&(o=1e13),mf(o),function(f){return f.x1!==void 0&&(f.x1=h(f.x1)),f.y1!==void 0&&(f.y1=h(f.y1)),f.x2!==void 0&&(f.x2=h(f.x2)),f.y2!==void 0&&(f.y2=h(f.y2)),f.x!==void 0&&(f.x=h(f.x)),f.y!==void 0&&(f.y=h(f.y)),f.rX!==void 0&&(f.rX=h(f.rX)),f.rY!==void 0&&(f.rY=h(f.rY)),f}},r.TO_ABS=e,r.TO_REL=function(){return i(function(o,h,f){return o.relative||(o.x1!==void 0&&(o.x1-=h),o.y1!==void 0&&(o.y1-=f),o.x2!==void 0&&(o.x2-=h),o.y2!==void 0&&(o.y2-=f),o.x!==void 0&&(o.x-=h),o.y!==void 0&&(o.y-=f),o.relative=!0),o})},r.NORMALIZE_HVZ=function(o,h,f){return o===void 0&&(o=!0),h===void 0&&(h=!0),f===void 0&&(f=!0),i(function(_,x,T,I,N){if(isNaN(I)&&!(_.type&rn.MOVE_TO))throw new Error("path must start with moveto");return h&&_.type&rn.HORIZ_LINE_TO&&(_.type=rn.LINE_TO,_.y=_.relative?0:T),f&&_.type&rn.VERT_LINE_TO&&(_.type=rn.LINE_TO,_.x=_.relative?0:x),o&&_.type&rn.CLOSE_PATH&&(_.type=rn.LINE_TO,_.x=_.relative?I-x:I,_.y=_.relative?N-T:N),_.type&rn.ARC&&(_.rX===0||_.rY===0)&&(_.type=rn.LINE_TO,delete _.rX,delete _.rY,delete _.xRot,delete _.lArcFlag,delete _.sweepFlag),_})},r.NORMALIZE_ST=t,r.QT_TO_C=n,r.INFO=i,r.SANITIZE=function(o){o===void 0&&(o=0),mf(o);var h=NaN,f=NaN,_=NaN,x=NaN;return i(function(T,I,N,$,W){var Y=Math.abs,ie=!1,ce=0,fe=0;if(T.type&rn.SMOOTH_CURVE_TO&&(ce=isNaN(h)?0:I-h,fe=isNaN(f)?0:N-f),T.type&(rn.CURVE_TO|rn.SMOOTH_CURVE_TO)?(h=T.relative?I+T.x2:T.x2,f=T.relative?N+T.y2:T.y2):(h=NaN,f=NaN),T.type&rn.SMOOTH_QUAD_TO?(_=isNaN(_)?I:2*I-_,x=isNaN(x)?N:2*N-x):T.type&rn.QUAD_TO?(_=T.relative?I+T.x1:T.x1,x=T.relative?N+T.y1:T.y2):(_=NaN,x=NaN),T.type&rn.LINE_COMMANDS||T.type&rn.ARC&&(T.rX===0||T.rY===0||!T.lArcFlag)||T.type&rn.CURVE_TO||T.type&rn.SMOOTH_CURVE_TO||T.type&rn.QUAD_TO||T.type&rn.SMOOTH_QUAD_TO){var ve=T.x===void 0?0:T.relative?T.x:T.x-I,be=T.y===void 0?0:T.relative?T.y:T.y-N;ce=isNaN(_)?T.x1===void 0?ce:T.relative?T.x:T.x1-I:_-I,fe=isNaN(x)?T.y1===void 0?fe:T.relative?T.y:T.y1-N:x-N;var Qe=T.x2===void 0?0:T.relative?T.x:T.x2-I,Ue=T.y2===void 0?0:T.relative?T.y:T.y2-N;Y(ve)<=o&&Y(be)<=o&&Y(ce)<=o&&Y(fe)<=o&&Y(Qe)<=o&&Y(Ue)<=o&&(ie=!0)}return T.type&rn.CLOSE_PATH&&Y(I-$)<=o&&Y(N-W)<=o&&(ie=!0),ie?[]:T})},r.MATRIX=s,r.ROTATE=function(o,h,f){h===void 0&&(h=0),f===void 0&&(f=0),mf(o,h,f);var _=Math.sin(o),x=Math.cos(o);return s(x,_,-_,x,h-h*x+f*_,f-h*_-f*x)},r.TRANSLATE=function(o,h){return h===void 0&&(h=0),mf(o,h),s(1,0,0,1,o,h)},r.SCALE=function(o,h){return h===void 0&&(h=o),mf(o,h),s(o,0,0,h,0,0)},r.SKEW_X=function(o){return mf(o),s(1,0,Math.atan(o),1,0,0)},r.SKEW_Y=function(o){return mf(o),s(1,Math.atan(o),0,1,0,0)},r.X_AXIS_SYMMETRY=function(o){return o===void 0&&(o=0),mf(o),s(-1,0,0,1,o,0)},r.Y_AXIS_SYMMETRY=function(o){return o===void 0&&(o=0),mf(o),s(1,0,0,-1,0,o)},r.A_TO_C=function(){return i(function(o,h,f){return rn.ARC===o.type?function(_,x,T){var I,N,$,W;_.cX||ZL(_,x,T);for(var Y=Math.min(_.phi1,_.phi2),ie=Math.max(_.phi1,_.phi2)-Y,ce=Math.ceil(ie/90),fe=new Array(ce),ve=x,be=T,Qe=0;Qe<ce;Qe++){var Ue=pJ(_.phi1,_.phi2,Qe/ce),st=pJ(_.phi1,_.phi2,(Qe+1)/ce),at=st-Ue,Le=4/3*Math.tan(at*RA/4),ze=[Math.cos(Ue*RA)-Le*Math.sin(Ue*RA),Math.sin(Ue*RA)+Le*Math.cos(Ue*RA)],tt=ze[0],Ne=ze[1],Ht=[Math.cos(st*RA),Math.sin(st*RA)],Vt=Ht[0],Jt=Ht[1],Kt=[Vt+Le*Math.sin(st*RA),Jt-Le*Math.cos(st*RA)],er=Kt[0],Xt=Kt[1];fe[Qe]={relative:_.relative,type:rn.CURVE_TO};var Fr=function($e,ut){var Bt=JL([$e*_.rX,ut*_.rY],_.xRot),St=Bt[0],jt=Bt[1];return[_.cX+St,_.cY+jt]};I=Fr(tt,Ne),fe[Qe].x1=I[0],fe[Qe].y1=I[1],N=Fr(er,Xt),fe[Qe].x2=N[0],fe[Qe].y2=N[1],$=Fr(Vt,Jt),fe[Qe].x=$[0],fe[Qe].y=$[1],_.relative&&(fe[Qe].x1-=ve,fe[Qe].y1-=be,fe[Qe].x2-=ve,fe[Qe].y2-=be,fe[Qe].x-=ve,fe[Qe].y-=be),ve=(W=[fe[Qe].x,fe[Qe].y])[0],be=W[1]}return fe}(o,o.relative?0:h,o.relative?0:f):o})},r.ANNOTATE_ARCS=function(){return i(function(o,h,f){return o.relative&&(h=0,f=0),rn.ARC===o.type&&ZL(o,h,f),o})},r.CLONE=a,r.CALCULATE_BOUNDS=function(){var o=function(T){var I={};for(var N in T)I[N]=T[N];return I},h=e(),f=n(),_=t(),x=i(function(T,I,N){var $=_(f(h(o(T))));function W(Xt){Xt>x.maxX&&(x.maxX=Xt),Xt<x.minX&&(x.minX=Xt)}function Y(Xt){Xt>x.maxY&&(x.maxY=Xt),Xt<x.minY&&(x.minY=Xt)}if($.type&rn.DRAWING_COMMANDS&&(W(I),Y(N)),$.type&rn.HORIZ_LINE_TO&&W($.x),$.type&rn.VERT_LINE_TO&&Y($.y),$.type&rn.LINE_TO&&(W($.x),Y($.y)),$.type&rn.CURVE_TO){W($.x),Y($.y);for(var ie=0,ce=mJ(I,$.x1,$.x2,$.x);ie<ce.length;ie++)0<(er=ce[ie])&&1>er&&W(_J(I,$.x1,$.x2,$.x,er));for(var fe=0,ve=mJ(N,$.y1,$.y2,$.y);fe<ve.length;fe++)0<(er=ve[fe])&&1>er&&Y(_J(N,$.y1,$.y2,$.y,er))}if($.type&rn.ARC){W($.x),Y($.y),ZL($,I,N);for(var be=$.xRot/180*Math.PI,Qe=Math.cos(be)*$.rX,Ue=Math.sin(be)*$.rX,st=-Math.sin(be)*$.rY,at=Math.cos(be)*$.rY,Le=$.phi1<$.phi2?[$.phi1,$.phi2]:-180>$.phi2?[$.phi2+360,$.phi1+360]:[$.phi2,$.phi1],ze=Le[0],tt=Le[1],Ne=function(Xt){var Fr=Xt[0],$e=Xt[1],ut=180*Math.atan2($e,Fr)/Math.PI;return ut<ze?ut+360:ut},Ht=0,Vt=AJ(st,-Qe,0).map(Ne);Ht<Vt.length;Ht++)(er=Vt[Ht])>ze&&er<tt&&W(gJ($.cX,Qe,st,er));for(var Jt=0,Kt=AJ(at,-Ue,0).map(Ne);Jt<Kt.length;Jt++){var er;(er=Kt[Jt])>ze&&er<tt&&Y(gJ($.cY,Ue,at,er))}}return T});return x.minX=1/0,x.maxX=-1/0,x.minY=1/0,x.maxY=-1/0,x}})(fl||(fl={}));var _f,yJ=function(){function r(){}return r.prototype.round=function(e){return this.transform(fl.ROUND(e))},r.prototype.toAbs=function(){return this.transform(fl.TO_ABS())},r.prototype.toRel=function(){return this.transform(fl.TO_REL())},r.prototype.normalizeHVZ=function(e,t,n){return this.transform(fl.NORMALIZE_HVZ(e,t,n))},r.prototype.normalizeST=function(){return this.transform(fl.NORMALIZE_ST())},r.prototype.qtToC=function(){return this.transform(fl.QT_TO_C())},r.prototype.aToC=function(){return this.transform(fl.A_TO_C())},r.prototype.sanitize=function(e){return this.transform(fl.SANITIZE(e))},r.prototype.translate=function(e,t){return this.transform(fl.TRANSLATE(e,t))},r.prototype.scale=function(e,t){return this.transform(fl.SCALE(e,t))},r.prototype.rotate=function(e,t,n){return this.transform(fl.ROTATE(e,t,n))},r.prototype.matrix=function(e,t,n,i,s,a){return this.transform(fl.MATRIX(e,t,n,i,s,a))},r.prototype.skewX=function(e){return this.transform(fl.SKEW_X(e))},r.prototype.skewY=function(e){return this.transform(fl.SKEW_Y(e))},r.prototype.xSymmetry=function(e){return this.transform(fl.X_AXIS_SYMMETRY(e))},r.prototype.ySymmetry=function(e){return this.transform(fl.Y_AXIS_SYMMETRY(e))},r.prototype.annotateArcs=function(){return this.transform(fl.ANNOTATE_ARCS())},r}(),EKe=function(r){return r===" "||r==="	"||r==="\r"||r===`
`},bJ=function(r){return 48<=r.charCodeAt(0)&&r.charCodeAt(0)<=57},TKe=function(r){function e(){var t=r.call(this)||this;return t.curNumber="",t.curCommandType=-1,t.curCommandRelative=!1,t.canParseCommandOrComma=!0,t.curNumberHasExp=!1,t.curNumberHasExpDigits=!1,t.curNumberHasDecimal=!1,t.curArgs=[],t}return fJ(e,r),e.prototype.finish=function(t){if(t===void 0&&(t=[]),this.parse(" ",t),this.curArgs.length!==0||!this.canParseCommandOrComma)throw new SyntaxError("Unterminated command at the path end.");return t},e.prototype.parse=function(t,n){var i=this;n===void 0&&(n=[]);for(var s=function(x){n.push(x),i.curArgs.length=0,i.canParseCommandOrComma=!0},a=0;a<t.length;a++){var o=t[a],h=!(this.curCommandType!==rn.ARC||this.curArgs.length!==3&&this.curArgs.length!==4||this.curNumber.length!==1||this.curNumber!=="0"&&this.curNumber!=="1"),f=bJ(o)&&(this.curNumber==="0"&&o==="0"||h);if(!bJ(o)||f)if(o!=="e"&&o!=="E")if(o!=="-"&&o!=="+"||!this.curNumberHasExp||this.curNumberHasExpDigits)if(o!=="."||this.curNumberHasExp||this.curNumberHasDecimal||h){if(this.curNumber&&this.curCommandType!==-1){var _=Number(this.curNumber);if(isNaN(_))throw new SyntaxError("Invalid number ending at "+a);if(this.curCommandType===rn.ARC){if(this.curArgs.length===0||this.curArgs.length===1){if(0>_)throw new SyntaxError('Expected positive number, got "'+_+'" at index "'+a+'"')}else if((this.curArgs.length===3||this.curArgs.length===4)&&this.curNumber!=="0"&&this.curNumber!=="1")throw new SyntaxError('Expected a flag, got "'+this.curNumber+'" at index "'+a+'"')}this.curArgs.push(_),this.curArgs.length===SKe[this.curCommandType]&&(rn.HORIZ_LINE_TO===this.curCommandType?s({type:rn.HORIZ_LINE_TO,relative:this.curCommandRelative,x:_}):rn.VERT_LINE_TO===this.curCommandType?s({type:rn.VERT_LINE_TO,relative:this.curCommandRelative,y:_}):this.curCommandType===rn.MOVE_TO||this.curCommandType===rn.LINE_TO||this.curCommandType===rn.SMOOTH_QUAD_TO?(s({type:this.curCommandType,relative:this.curCommandRelative,x:this.curArgs[0],y:this.curArgs[1]}),rn.MOVE_TO===this.curCommandType&&(this.curCommandType=rn.LINE_TO)):this.curCommandType===rn.CURVE_TO?s({type:rn.CURVE_TO,relative:this.curCommandRelative,x1:this.curArgs[0],y1:this.curArgs[1],x2:this.curArgs[2],y2:this.curArgs[3],x:this.curArgs[4],y:this.curArgs[5]}):this.curCommandType===rn.SMOOTH_CURVE_TO?s({type:rn.SMOOTH_CURVE_TO,relative:this.curCommandRelative,x2:this.curArgs[0],y2:this.curArgs[1],x:this.curArgs[2],y:this.curArgs[3]}):this.curCommandType===rn.QUAD_TO?s({type:rn.QUAD_TO,relative:this.curCommandRelative,x1:this.curArgs[0],y1:this.curArgs[1],x:this.curArgs[2],y:this.curArgs[3]}):this.curCommandType===rn.ARC&&s({type:rn.ARC,relative:this.curCommandRelative,rX:this.curArgs[0],rY:this.curArgs[1],xRot:this.curArgs[2],lArcFlag:this.curArgs[3],sweepFlag:this.curArgs[4],x:this.curArgs[5],y:this.curArgs[6]})),this.curNumber="",this.curNumberHasExpDigits=!1,this.curNumberHasExp=!1,this.curNumberHasDecimal=!1,this.canParseCommandOrComma=!0}if(!EKe(o))if(o===","&&this.canParseCommandOrComma)this.canParseCommandOrComma=!1;else if(o!=="+"&&o!=="-"&&o!==".")if(f)this.curNumber=o,this.curNumberHasDecimal=!1;else{if(this.curArgs.length!==0)throw new SyntaxError("Unterminated command at index "+a+".");if(!this.canParseCommandOrComma)throw new SyntaxError('Unexpected character "'+o+'" at index '+a+". Command cannot follow comma");if(this.canParseCommandOrComma=!1,o!=="z"&&o!=="Z")if(o==="h"||o==="H")this.curCommandType=rn.HORIZ_LINE_TO,this.curCommandRelative=o==="h";else if(o==="v"||o==="V")this.curCommandType=rn.VERT_LINE_TO,this.curCommandRelative=o==="v";else if(o==="m"||o==="M")this.curCommandType=rn.MOVE_TO,this.curCommandRelative=o==="m";else if(o==="l"||o==="L")this.curCommandType=rn.LINE_TO,this.curCommandRelative=o==="l";else if(o==="c"||o==="C")this.curCommandType=rn.CURVE_TO,this.curCommandRelative=o==="c";else if(o==="s"||o==="S")this.curCommandType=rn.SMOOTH_CURVE_TO,this.curCommandRelative=o==="s";else if(o==="q"||o==="Q")this.curCommandType=rn.QUAD_TO,this.curCommandRelative=o==="q";else if(o==="t"||o==="T")this.curCommandType=rn.SMOOTH_QUAD_TO,this.curCommandRelative=o==="t";else{if(o!=="a"&&o!=="A")throw new SyntaxError('Unexpected character "'+o+'" at index '+a+".");this.curCommandType=rn.ARC,this.curCommandRelative=o==="a"}else n.push({type:rn.CLOSE_PATH}),this.canParseCommandOrComma=!0,this.curCommandType=-1}else this.curNumber=o,this.curNumberHasDecimal=o==="."}else this.curNumber+=o,this.curNumberHasDecimal=!0;else this.curNumber+=o;else this.curNumber+=o,this.curNumberHasExp=!0;else this.curNumber+=o,this.curNumberHasExpDigits=this.curNumberHasExp}return n},e.prototype.transform=function(t){return Object.create(this,{parse:{value:function(n,i){i===void 0&&(i=[]);for(var s=0,a=Object.getPrototypeOf(this).parse.call(this,n);s<a.length;s++){var o=a[s],h=t(o);Array.isArray(h)?i.push.apply(i,h):i.push(h)}return i}}})},e}(yJ),rn=function(r){function e(t){var n=r.call(this)||this;return n.commands=typeof t=="string"?e.parse(t):t,n}return fJ(e,r),e.prototype.encode=function(){return e.encode(this.commands)},e.prototype.getBounds=function(){var t=fl.CALCULATE_BOUNDS();return this.transform(t),t},e.prototype.transform=function(t){for(var n=[],i=0,s=this.commands;i<s.length;i++){var a=t(s[i]);Array.isArray(a)?n.push.apply(n,a):n.push(a)}return this.commands=n,this},e.encode=function(t){return CKe(t)},e.parse=function(t){var n=new TKe,i=[];return n.parse(t,i),n.finish(i),i},e.CLOSE_PATH=1,e.MOVE_TO=2,e.HORIZ_LINE_TO=4,e.VERT_LINE_TO=8,e.LINE_TO=16,e.CURVE_TO=32,e.SMOOTH_CURVE_TO=64,e.QUAD_TO=128,e.SMOOTH_QUAD_TO=256,e.ARC=512,e.LINE_COMMANDS=e.LINE_TO|e.HORIZ_LINE_TO|e.VERT_LINE_TO,e.DRAWING_COMMANDS=e.HORIZ_LINE_TO|e.VERT_LINE_TO|e.LINE_TO|e.CURVE_TO|e.SMOOTH_CURVE_TO|e.QUAD_TO|e.SMOOTH_QUAD_TO|e.ARC,e}(yJ),SKe=((_f={})[rn.MOVE_TO]=2,_f[rn.LINE_TO]=2,_f[rn.HORIZ_LINE_TO]=1,_f[rn.VERT_LINE_TO]=1,_f[rn.CLOSE_PATH]=0,_f[rn.QUAD_TO]=4,_f[rn.SMOOTH_QUAD_TO]=2,_f[rn.CURVE_TO]=6,_f[rn.SMOOTH_CURVE_TO]=4,_f[rn.ARC]=7,_f),IKe=Sc,MKe=gf,PKe=eE,FKe=tX,vJ=RegExp.prototype,RKe=function(r){var e=r.flags;return e===void 0&&!("flags"in vJ)&&!MKe(r,"flags")&&PKe(vJ,r)?IKe(FKe,r):e},LKe=aE.PROPER,DKe=bm,OKe=Du,xJ=iA,kKe=Va,UKe=RKe,YL="toString",wJ=RegExp.prototype,BJ=wJ[YL],NKe=kKe(function(){return BJ.call({source:"a",flags:"b"})!=="/a/b"}),zKe=LKe&&BJ.name!==YL;(NKe||zKe)&&DKe(wJ,YL,function(){var r=OKe(this),e=xJ(r.source),t=xJ(UKe(r));return"/"+e+"/"+t},{unsafe:!0});function NE(r){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?NE=function(e){return typeof e}:NE=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},NE(r)}function HKe(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}var VKe=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],GKe=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function QKe(r,e,t,n,i){if(typeof r=="string"&&(r=document.getElementById(r)),!r||NE(r)!=="object"||!("getContext"in r))throw new TypeError("Expecting canvas with `getContext` method in processCanvasRGB(A) calls!");var s=r.getContext("2d");try{return s.getImageData(e,t,n,i)}catch(a){throw new Error("unable to access image data: "+a)}}function $Ke(r,e,t,n,i,s){if(!(isNaN(s)||s<1)){s|=0;var a=QKe(r,e,t,n,i);a=jKe(a,e,t,n,i,s),r.getContext("2d").putImageData(a,e,t)}}function jKe(r,e,t,n,i,s){for(var a=r.data,o=2*s+1,h=n-1,f=i-1,_=s+1,x=_*(_+1)/2,T=new CJ,I=T,N,$=1;$<o;$++)I=I.next=new CJ,$===_&&(N=I);I.next=T;for(var W=null,Y=null,ie=0,ce=0,fe=VKe[s],ve=GKe[s],be=0;be<i;be++){I=T;for(var Qe=a[ce],Ue=a[ce+1],st=a[ce+2],at=a[ce+3],Le=0;Le<_;Le++)I.r=Qe,I.g=Ue,I.b=st,I.a=at,I=I.next;for(var ze=0,tt=0,Ne=0,Ht=0,Vt=_*Qe,Jt=_*Ue,Kt=_*st,er=_*at,Xt=x*Qe,Fr=x*Ue,$e=x*st,ut=x*at,Bt=1;Bt<_;Bt++){var St=ce+((h<Bt?h:Bt)<<2),jt=a[St],qt=a[St+1],nr=a[St+2],ar=a[St+3],$r=_-Bt;Xt+=(I.r=jt)*$r,Fr+=(I.g=qt)*$r,$e+=(I.b=nr)*$r,ut+=(I.a=ar)*$r,ze+=jt,tt+=qt,Ne+=nr,Ht+=ar,I=I.next}W=T,Y=N;for(var kr=0;kr<n;kr++){var Gr=ut*fe>>>ve;if(a[ce+3]=Gr,Gr!==0){var sn=255/Gr;a[ce]=(Xt*fe>>>ve)*sn,a[ce+1]=(Fr*fe>>>ve)*sn,a[ce+2]=($e*fe>>>ve)*sn}else a[ce]=a[ce+1]=a[ce+2]=0;Xt-=Vt,Fr-=Jt,$e-=Kt,ut-=er,Vt-=W.r,Jt-=W.g,Kt-=W.b,er-=W.a;var on=kr+s+1;on=ie+(on<h?on:h)<<2,ze+=W.r=a[on],tt+=W.g=a[on+1],Ne+=W.b=a[on+2],Ht+=W.a=a[on+3],Xt+=ze,Fr+=tt,$e+=Ne,ut+=Ht,W=W.next;var pr=Y,We=pr.r,Pn=pr.g,mn=pr.b,mr=pr.a;Vt+=We,Jt+=Pn,Kt+=mn,er+=mr,ze-=We,tt-=Pn,Ne-=mn,Ht-=mr,Y=Y.next,ce+=4}ie+=n}for(var Mr=0;Mr<n;Mr++){ce=Mr<<2;var en=a[ce],Wr=a[ce+1],gn=a[ce+2],Bn=a[ce+3],Fn=_*en,$n=_*Wr,ei=_*gn,br=_*Bn,Cn=x*en,Rn=x*Wr,nn=x*gn,Ci=x*Bn;I=T;for(var Cr=0;Cr<_;Cr++)I.r=en,I.g=Wr,I.b=gn,I.a=Bn,I=I.next;for(var Tn=n,Xe=0,He=0,Je=0,Ve=0,bt=1;bt<=s;bt++){ce=Tn+Mr<<2;var Mt=_-bt;Cn+=(I.r=en=a[ce])*Mt,Rn+=(I.g=Wr=a[ce+1])*Mt,nn+=(I.b=gn=a[ce+2])*Mt,Ci+=(I.a=Bn=a[ce+3])*Mt,Ve+=en,Xe+=Wr,He+=gn,Je+=Bn,I=I.next,bt<f&&(Tn+=n)}ce=Mr,W=T,Y=N;for(var $t=0;$t<i;$t++){var Wt=ce<<2;a[Wt+3]=Bn=Ci*fe>>>ve,Bn>0?(Bn=255/Bn,a[Wt]=(Cn*fe>>>ve)*Bn,a[Wt+1]=(Rn*fe>>>ve)*Bn,a[Wt+2]=(nn*fe>>>ve)*Bn):a[Wt]=a[Wt+1]=a[Wt+2]=0,Cn-=Fn,Rn-=$n,nn-=ei,Ci-=br,Fn-=W.r,$n-=W.g,ei-=W.b,br-=W.a,Wt=Mr+((Wt=$t+_)<f?Wt:f)*n<<2,Cn+=Ve+=W.r=a[Wt],Rn+=Xe+=W.g=a[Wt+1],nn+=He+=W.b=a[Wt+2],Ci+=Je+=W.a=a[Wt+3],W=W.next,Fn+=en=Y.r,$n+=Wr=Y.g,ei+=gn=Y.b,br+=Bn=Y.a,Ve-=en,Xe-=Wr,He-=gn,Je-=Bn,Y=Y.next,ce+=n}}return r}var CJ=function r(){HKe(this,r),this.r=0,this.g=0,this.b=0,this.a=0,this.next=null};function qKe(){var{DOMParser:r}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e={window:null,ignoreAnimation:!0,ignoreMouse:!0,DOMParser:r,createCanvas(t,n){return new OffscreenCanvas(t,n)},createImage(t){return PA(function*(){var n=yield fetch(t),i=yield n.blob(),s=yield createImageBitmap(i);return s})()}};return(typeof DOMParser<"u"||typeof r>"u")&&Reflect.deleteProperty(e,"DOMParser"),e}function KKe(r){var{DOMParser:e,canvas:t,fetch:n}=r;return{window:null,ignoreAnimation:!0,ignoreMouse:!0,DOMParser:e,fetch:n,createCanvas:t.createCanvas,createImage:t.loadImage}}var WKe=Object.freeze({__proto__:null,offscreen:qKe,node:KKe});function Cm(r){return r.replace(/(?!\u3000)\s+/gm," ")}function EJ(r){return r.replace(/^[\n \t]+/,"")}function TJ(r){return r.replace(/[\n \t]+$/,"")}function ch(r){var e=(r||"").match(/-?(\d+(?:\.\d*(?:[eE][+-]?\d+)?)?|\.\d+)(?=\D|$)/gm)||[];return e.map(parseFloat)}var XKe=/^[A-Z-]+$/;function SJ(r){return XKe.test(r)?r.toLowerCase():r}function eD(r){var e=/url\(('([^']+)'|"([^"]+)"|([^'")]+))\)/.exec(r)||[];return e[2]||e[3]||e[4]}function IJ(r){if(!r.startsWith("rgb"))return r;var e=3,t=r.replace(/\d+(\.\d+)?/g,(n,i)=>e--&&i?String(Math.round(parseFloat(n))):n);return t}var JKe=/(\[[^\]]+\])/g,ZKe=/(#[^\s+>~.[:]+)/g,YKe=/(\.[^\s+>~.[:]+)/g,eWe=/(::[^\s+>~.[:]+|:first-line|:first-letter|:before|:after)/gi,tWe=/(:[\w-]+\([^)]*\))/gi,rWe=/(:[^\s+>~.[:]+)/g,nWe=/([^\s+>~.[:]+)/g;function Em(r,e){var t=e.exec(r);return t?[r.replace(e," "),t.length]:[r,0]}function MJ(r){var e=[0,0,0],t=r.replace(/:not\(([^)]*)\)/g,"     $1 ").replace(/{[\s\S]*/gm," "),n=0;return[t,n]=Em(t,JKe),e[1]+=n,[t,n]=Em(t,ZKe),e[0]+=n,[t,n]=Em(t,YKe),e[1]+=n,[t,n]=Em(t,eWe),e[2]+=n,[t,n]=Em(t,tWe),e[1]+=n,[t,n]=Em(t,rWe),e[1]+=n,t=t.replace(/[*\s+>~]/g," ").replace(/[#.]/g," "),[t,n]=Em(t,nWe),e[2]+=n,e.join("")}var Tm=1e-8;function tD(r){return Math.sqrt(Math.pow(r[0],2)+Math.pow(r[1],2))}function zE(r,e){return(r[0]*e[0]+r[1]*e[1])/(tD(r)*tD(e))}function rD(r,e){return(r[0]*e[1]<r[1]*e[0]?-1:1)*Math.acos(zE(r,e))}function nD(r){return r*r*r}function iD(r){return 3*r*r*(1-r)}function sD(r){return 3*r*(1-r)*(1-r)}function oD(r){return(1-r)*(1-r)*(1-r)}function aD(r){return r*r}function lD(r){return 2*r*(1-r)}function cD(r){return(1-r)*(1-r)}class ii{constructor(e,t,n){this.document=e,this.name=t,this.value=n,this.isNormalizedColor=!1}static empty(e){return new ii(e,"EMPTY","")}split(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:" ",{document:t,name:n}=this;return Cm(this.getString()).trim().split(e).map(i=>new ii(t,n,i))}hasValue(e){var{value:t}=this;return t!==null&&t!==""&&(e||t!==0)&&typeof t<"u"}isString(e){var{value:t}=this,n=typeof t=="string";return!n||!e?n:e.test(t)}isUrlDefinition(){return this.isString(/^url\(/)}isPixels(){if(!this.hasValue())return!1;var e=this.getString();switch(!0){case e.endsWith("px"):case/^[0-9]+$/.test(e):return!0;default:return!1}}setValue(e){return this.value=e,this}getValue(e){return typeof e>"u"||this.hasValue()?this.value:e}getNumber(e){if(!this.hasValue())return typeof e>"u"?0:parseFloat(e);var{value:t}=this,n=parseFloat(t);return this.isString(/%$/)&&(n/=100),n}getString(e){return typeof e>"u"||this.hasValue()?typeof this.value>"u"?"":String(this.value):String(e)}getColor(e){var t=this.getString(e);return this.isNormalizedColor||(this.isNormalizedColor=!0,t=IJ(t),this.value=t),t}getDpi(){return 96}getRem(){return this.document.rootEmSize}getEm(){return this.document.emSize}getUnits(){return this.getString().replace(/[0-9.-]/g,"")}getPixels(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!this.hasValue())return 0;var[n,i]=typeof e=="boolean"?[void 0,e]:[e],{viewPort:s}=this.document.screen;switch(!0){case this.isString(/vmin$/):return this.getNumber()/100*Math.min(s.computeSize("x"),s.computeSize("y"));case this.isString(/vmax$/):return this.getNumber()/100*Math.max(s.computeSize("x"),s.computeSize("y"));case this.isString(/vw$/):return this.getNumber()/100*s.computeSize("x");case this.isString(/vh$/):return this.getNumber()/100*s.computeSize("y");case this.isString(/rem$/):return this.getNumber()*this.getRem();case this.isString(/em$/):return this.getNumber()*this.getEm();case this.isString(/ex$/):return this.getNumber()*this.getEm()/2;case this.isString(/px$/):return this.getNumber();case this.isString(/pt$/):return this.getNumber()*this.getDpi()*(1/72);case this.isString(/pc$/):return this.getNumber()*15;case this.isString(/cm$/):return this.getNumber()*this.getDpi()/2.54;case this.isString(/mm$/):return this.getNumber()*this.getDpi()/25.4;case this.isString(/in$/):return this.getNumber()*this.getDpi();case(this.isString(/%$/)&&i):return this.getNumber()*this.getEm();case this.isString(/%$/):return this.getNumber()*s.computeSize(n);default:{var a=this.getNumber();return t&&a<1?a*s.computeSize(n):a}}}getMilliseconds(){return this.hasValue()?this.isString(/ms$/)?this.getNumber():this.getNumber()*1e3:0}getRadians(){if(!this.hasValue())return 0;switch(!0){case this.isString(/deg$/):return this.getNumber()*(Math.PI/180);case this.isString(/grad$/):return this.getNumber()*(Math.PI/200);case this.isString(/rad$/):return this.getNumber();default:return this.getNumber()*(Math.PI/180)}}getDefinition(){var e=this.getString(),t=/#([^)'"]+)/.exec(e);return t&&(t=t[1]),t||(t=e),this.document.definitions[t]}getFillStyleDefinition(e,t){var n=this.getDefinition();if(!n)return null;if(typeof n.createGradient=="function")return n.createGradient(this.document.ctx,e,t);if(typeof n.createPattern=="function"){if(n.getHrefAttribute().hasValue()){var i=n.getAttribute("patternTransform");n=n.getHrefAttribute().getDefinition(),i.hasValue()&&n.getAttribute("patternTransform",!0).setValue(i.value)}return n.createPattern(this.document.ctx,e,t)}return null}getTextBaseline(){return this.hasValue()?ii.textBaselineMapping[this.getString()]:null}addOpacity(e){for(var t=this.getColor(),n=t.length,i=0,s=0;s<n&&(t[s]===","&&i++,i!==3);s++);if(e.hasValue()&&this.isString()&&i!==3){var a=new WL(t);a.ok&&(a.alpha=e.getNumber(),t=a.toRGBA())}return new ii(this.document,this.name,t)}}ii.textBaselineMapping={baseline:"alphabetic","before-edge":"top","text-before-edge":"top",middle:"middle",central:"middle","after-edge":"bottom","text-after-edge":"bottom",ideographic:"ideographic",alphabetic:"alphabetic",hanging:"hanging",mathematical:"alphabetic"};class PJ{constructor(){this.viewPorts=[]}clear(){this.viewPorts=[]}setCurrent(e,t){this.viewPorts.push({width:e,height:t})}removeCurrent(){this.viewPorts.pop()}getCurrent(){var{viewPorts:e}=this;return e[e.length-1]}get width(){return this.getCurrent().width}get height(){return this.getCurrent().height}computeSize(e){return typeof e=="number"?e:e==="x"?this.width:e==="y"?this.height:Math.sqrt(Math.pow(this.width,2)+Math.pow(this.height,2))/Math.sqrt(2)}}class xa{constructor(e,t){this.x=e,this.y=t}static parse(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,[n=t,i=t]=ch(e);return new xa(n,i)}static parseScale(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,[n=t,i=n]=ch(e);return new xa(n,i)}static parsePath(e){for(var t=ch(e),n=t.length,i=[],s=0;s<n;s+=2)i.push(new xa(t[s],t[s+1]));return i}angleTo(e){return Math.atan2(e.y-this.y,e.x-this.x)}applyTransform(e){var{x:t,y:n}=this,i=t*e[0]+n*e[2]+e[4],s=t*e[1]+n*e[3]+e[5];this.x=i,this.y=s}}class FJ{constructor(e){this.screen=e,this.working=!1,this.events=[],this.eventElements=[],this.onClick=this.onClick.bind(this),this.onMouseMove=this.onMouseMove.bind(this)}isWorking(){return this.working}start(){if(!this.working){var{screen:e,onClick:t,onMouseMove:n}=this,i=e.ctx.canvas;i.onclick=t,i.onmousemove=n,this.working=!0}}stop(){if(this.working){var e=this.screen.ctx.canvas;this.working=!1,e.onclick=null,e.onmousemove=null}}hasEvents(){return this.working&&this.events.length>0}runEvents(){if(this.working){var{screen:e,events:t,eventElements:n}=this,{style:i}=e.ctx.canvas;i&&(i.cursor=""),t.forEach((s,a)=>{for(var{run:o}=s,h=n[a];h;)o(h),h=h.parent}),this.events=[],this.eventElements=[]}}checkPath(e,t){if(!(!this.working||!t)){var{events:n,eventElements:i}=this;n.forEach((s,a)=>{var{x:o,y:h}=s;!i[a]&&t.isPointInPath&&t.isPointInPath(o,h)&&(i[a]=e)})}}checkBoundingBox(e,t){if(!(!this.working||!t)){var{events:n,eventElements:i}=this;n.forEach((s,a)=>{var{x:o,y:h}=s;!i[a]&&t.isPointInBox(o,h)&&(i[a]=e)})}}mapXY(e,t){for(var{window:n,ctx:i}=this.screen,s=new xa(e,t),a=i.canvas;a;)s.x-=a.offsetLeft,s.y-=a.offsetTop,a=a.offsetParent;return n.scrollX&&(s.x+=n.scrollX),n.scrollY&&(s.y+=n.scrollY),s}onClick(e){var{x:t,y:n}=this.mapXY(e.clientX,e.clientY);this.events.push({type:"onclick",x:t,y:n,run(i){i.onClick&&i.onClick()}})}onMouseMove(e){var{x:t,y:n}=this.mapXY(e.clientX,e.clientY);this.events.push({type:"onmousemove",x:t,y:n,run(i){i.onMouseMove&&i.onMouseMove()}})}}var RJ=typeof window<"u"?window:null,LJ=typeof fetch<"u"?fetch.bind(void 0):null;class bv{constructor(e){var{fetch:t=LJ,window:n=RJ}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.ctx=e,this.FRAMERATE=30,this.MAX_VIRTUAL_PIXELS=3e4,this.CLIENT_WIDTH=800,this.CLIENT_HEIGHT=600,this.viewPort=new PJ,this.mouse=new FJ(this),this.animations=[],this.waits=[],this.frameDuration=0,this.isReadyLock=!1,this.isFirstRender=!0,this.intervalId=null,this.window=n,this.fetch=t}wait(e){this.waits.push(e)}ready(){return this.readyPromise?this.readyPromise:Promise.resolve()}isReady(){if(this.isReadyLock)return!0;var e=this.waits.every(t=>t());return e&&(this.waits=[],this.resolveReady&&this.resolveReady()),this.isReadyLock=e,e}setDefaults(e){e.strokeStyle="rgba(0,0,0,0)",e.lineCap="butt",e.lineJoin="miter",e.miterLimit=4}setViewBox(e){var{document:t,ctx:n,aspectRatio:i,width:s,desiredWidth:a,height:o,desiredHeight:h,minX:f=0,minY:_=0,refX:x,refY:T,clip:I=!1,clipX:N=0,clipY:$=0}=e,W=Cm(i).replace(/^defer\s/,""),[Y,ie]=W.split(" "),ce=Y||"xMidYMid",fe=ie||"meet",ve=s/a,be=o/h,Qe=Math.min(ve,be),Ue=Math.max(ve,be),st=a,at=h;fe==="meet"&&(st*=Qe,at*=Qe),fe==="slice"&&(st*=Ue,at*=Ue);var Le=new ii(t,"refX",x),ze=new ii(t,"refY",T),tt=Le.hasValue()&&ze.hasValue();if(tt&&n.translate(-Qe*Le.getPixels("x"),-Qe*ze.getPixels("y")),I){var Ne=Qe*N,Ht=Qe*$;n.beginPath(),n.moveTo(Ne,Ht),n.lineTo(s,Ht),n.lineTo(s,o),n.lineTo(Ne,o),n.closePath(),n.clip()}if(!tt){var Vt=fe==="meet"&&Qe===be,Jt=fe==="slice"&&Ue===be,Kt=fe==="meet"&&Qe===ve,er=fe==="slice"&&Ue===ve;ce.startsWith("xMid")&&(Vt||Jt)&&n.translate(s/2-st/2,0),ce.endsWith("YMid")&&(Kt||er)&&n.translate(0,o/2-at/2),ce.startsWith("xMax")&&(Vt||Jt)&&n.translate(s-st,0),ce.endsWith("YMax")&&(Kt||er)&&n.translate(0,o-at)}switch(!0){case ce==="none":n.scale(ve,be);break;case fe==="meet":n.scale(Qe,Qe);break;case fe==="slice":n.scale(Ue,Ue);break}n.translate(-f,-_)}start(e){var{enableRedraw:t=!1,ignoreMouse:n=!1,ignoreAnimation:i=!1,ignoreDimensions:s=!1,ignoreClear:a=!1,forceRedraw:o,scaleWidth:h,scaleHeight:f,offsetX:_,offsetY:x}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{FRAMERATE:T,mouse:I}=this,N=1e3/T;if(this.frameDuration=N,this.readyPromise=new Promise(ce=>{this.resolveReady=ce}),this.isReady()&&this.render(e,s,a,h,f,_,x),!!t){var $=Date.now(),W=$,Y=0,ie=()=>{$=Date.now(),Y=$-W,Y>=N&&(W=$-Y%N,this.shouldUpdate(i,o)&&(this.render(e,s,a,h,f,_,x),I.runEvents())),this.intervalId=jL(ie)};n||I.start(),this.intervalId=jL(ie)}}stop(){this.intervalId&&(jL.cancel(this.intervalId),this.intervalId=null),this.mouse.stop()}shouldUpdate(e,t){if(!e){var{frameDuration:n}=this,i=this.animations.reduce((s,a)=>a.update(n)||s,!1);if(i)return!0}return!!(typeof t=="function"&&t()||!this.isReadyLock&&this.isReady()||this.mouse.hasEvents())}render(e,t,n,i,s,a,o){var{CLIENT_WIDTH:h,CLIENT_HEIGHT:f,viewPort:_,ctx:x,isFirstRender:T}=this,I=x.canvas;_.clear(),I.width&&I.height?_.setCurrent(I.width,I.height):_.setCurrent(h,f);var N=e.getStyle("width"),$=e.getStyle("height");!t&&(T||typeof i!="number"&&typeof s!="number")&&(N.hasValue()&&(I.width=N.getPixels("x"),I.style&&(I.style.width="".concat(I.width,"px"))),$.hasValue()&&(I.height=$.getPixels("y"),I.style&&(I.style.height="".concat(I.height,"px"))));var W=I.clientWidth||I.width,Y=I.clientHeight||I.height;if(t&&N.hasValue()&&$.hasValue()&&(W=N.getPixels("x"),Y=$.getPixels("y")),_.setCurrent(W,Y),typeof a=="number"&&e.getAttribute("x",!0).setValue(a),typeof o=="number"&&e.getAttribute("y",!0).setValue(o),typeof i=="number"||typeof s=="number"){var ie=ch(e.getAttribute("viewBox").getString()),ce=0,fe=0;if(typeof i=="number"){var ve=e.getStyle("width");ve.hasValue()?ce=ve.getPixels("x")/i:isNaN(ie[2])||(ce=ie[2]/i)}if(typeof s=="number"){var be=e.getStyle("height");be.hasValue()?fe=be.getPixels("y")/s:isNaN(ie[3])||(fe=ie[3]/s)}ce||(ce=fe),fe||(fe=ce),e.getAttribute("width",!0).setValue(i),e.getAttribute("height",!0).setValue(s);var Qe=e.getStyle("transform",!0,!0);Qe.setValue("".concat(Qe.getString()," scale(").concat(1/ce,", ").concat(1/fe,")"))}n||x.clearRect(0,0,W,Y),e.render(x),T&&(this.isFirstRender=!1)}}bv.defaultWindow=RJ,bv.defaultFetch=LJ;var{defaultFetch:iWe}=bv,sWe=typeof DOMParser<"u"?DOMParser:null;class HE{constructor(){var{fetch:e=iWe,DOMParser:t=sWe}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.fetch=e,this.DOMParser=t}parse(e){var t=this;return PA(function*(){return e.startsWith("<")?t.parseFromString(e):t.load(e)})()}parseFromString(e){var t=new this.DOMParser;try{return this.checkDocument(t.parseFromString(e,"image/svg+xml"))}catch{return this.checkDocument(t.parseFromString(e,"text/xml"))}}checkDocument(e){var t=e.getElementsByTagName("parsererror")[0];if(t)throw new Error(t.textContent);return e}load(e){var t=this;return PA(function*(){var n=yield t.fetch(e),i=yield n.text();return t.parseFromString(i)})()}}class DJ{constructor(e,t){this.type="translate",this.point=null,this.point=xa.parse(t)}apply(e){var{x:t,y:n}=this.point;e.translate(t||0,n||0)}unapply(e){var{x:t,y:n}=this.point;e.translate(-1*t||0,-1*n||0)}applyToPoint(e){var{x:t,y:n}=this.point;e.applyTransform([1,0,0,1,t||0,n||0])}}class OJ{constructor(e,t,n){this.type="rotate",this.angle=null,this.originX=null,this.originY=null,this.cx=0,this.cy=0;var i=ch(t);this.angle=new ii(e,"angle",i[0]),this.originX=n[0],this.originY=n[1],this.cx=i[1]||0,this.cy=i[2]||0}apply(e){var{cx:t,cy:n,originX:i,originY:s,angle:a}=this,o=t+i.getPixels("x"),h=n+s.getPixels("y");e.translate(o,h),e.rotate(a.getRadians()),e.translate(-o,-h)}unapply(e){var{cx:t,cy:n,originX:i,originY:s,angle:a}=this,o=t+i.getPixels("x"),h=n+s.getPixels("y");e.translate(o,h),e.rotate(-1*a.getRadians()),e.translate(-o,-h)}applyToPoint(e){var{cx:t,cy:n,angle:i}=this,s=i.getRadians();e.applyTransform([1,0,0,1,t||0,n||0]),e.applyTransform([Math.cos(s),Math.sin(s),-Math.sin(s),Math.cos(s),0,0]),e.applyTransform([1,0,0,1,-t||0,-n||0])}}class kJ{constructor(e,t,n){this.type="scale",this.scale=null,this.originX=null,this.originY=null;var i=xa.parseScale(t);(i.x===0||i.y===0)&&(i.x=Tm,i.y=Tm),this.scale=i,this.originX=n[0],this.originY=n[1]}apply(e){var{scale:{x:t,y:n},originX:i,originY:s}=this,a=i.getPixels("x"),o=s.getPixels("y");e.translate(a,o),e.scale(t,n||t),e.translate(-a,-o)}unapply(e){var{scale:{x:t,y:n},originX:i,originY:s}=this,a=i.getPixels("x"),o=s.getPixels("y");e.translate(a,o),e.scale(1/t,1/n||t),e.translate(-a,-o)}applyToPoint(e){var{x:t,y:n}=this.scale;e.applyTransform([t||0,0,0,n||0,0,0])}}class uD{constructor(e,t,n){this.type="matrix",this.matrix=[],this.originX=null,this.originY=null,this.matrix=ch(t),this.originX=n[0],this.originY=n[1]}apply(e){var{originX:t,originY:n,matrix:i}=this,s=t.getPixels("x"),a=n.getPixels("y");e.translate(s,a),e.transform(i[0],i[1],i[2],i[3],i[4],i[5]),e.translate(-s,-a)}unapply(e){var{originX:t,originY:n,matrix:i}=this,s=i[0],a=i[2],o=i[4],h=i[1],f=i[3],_=i[5],x=0,T=0,I=1,N=1/(s*(f*I-_*T)-a*(h*I-_*x)+o*(h*T-f*x)),$=t.getPixels("x"),W=n.getPixels("y");e.translate($,W),e.transform(N*(f*I-_*T),N*(_*x-h*I),N*(o*T-a*I),N*(s*I-o*x),N*(a*_-o*f),N*(o*h-s*_)),e.translate(-$,-W)}applyToPoint(e){e.applyTransform(this.matrix)}}class hD extends uD{constructor(e,t,n){super(e,t,n),this.type="skew",this.angle=null,this.angle=new ii(e,"angle",t)}}class UJ extends hD{constructor(e,t,n){super(e,t,n),this.type="skewX",this.matrix=[1,0,Math.tan(this.angle.getRadians()),1,0,0]}}class NJ extends hD{constructor(e,t,n){super(e,t,n),this.type="skewY",this.matrix=[1,Math.tan(this.angle.getRadians()),0,1,0,0]}}function oWe(r){return Cm(r).trim().replace(/\)([a-zA-Z])/g,") $1").replace(/\)(\s?,\s?)/g,") ").split(/\s(?=[a-z])/)}function aWe(r){var[e,t]=r.split("(");return[e.trim(),t.trim().replace(")","")]}class Vp{constructor(e,t,n){this.document=e,this.transforms=[];var i=oWe(t);i.forEach(s=>{if(s!=="none"){var[a,o]=aWe(s),h=Vp.transformTypes[a];typeof h<"u"&&this.transforms.push(new h(this.document,o,n))}})}static fromElement(e,t){var n=t.getStyle("transform",!1,!0),[i,s=i]=t.getStyle("transform-origin",!1,!0).split(),a=[i,s];return n.hasValue()?new Vp(e,n.getString(),a):null}apply(e){for(var{transforms:t}=this,n=t.length,i=0;i<n;i++)t[i].apply(e)}unapply(e){for(var{transforms:t}=this,n=t.length,i=n-1;i>=0;i--)t[i].unapply(e)}applyToPoint(e){for(var{transforms:t}=this,n=t.length,i=0;i<n;i++)t[i].applyToPoint(e)}}Vp.transformTypes={translate:DJ,rotate:OJ,scale:kJ,matrix:uD,skewX:UJ,skewY:NJ};class bo{constructor(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(this.document=e,this.node=t,this.captureTextNodes=n,this.attributes={},this.styles={},this.stylesSpecificity={},this.animationFrozen=!1,this.animationFrozenValue="",this.parent=null,this.children=[],!(!t||t.nodeType!==1)){if(Array.from(t.attributes).forEach(o=>{var h=SJ(o.nodeName);this.attributes[h]=new ii(e,h,o.value)}),this.addStylesFromStyleDefinition(),this.getAttribute("style").hasValue()){var i=this.getAttribute("style").getString().split(";").map(o=>o.trim());i.forEach(o=>{if(o){var[h,f]=o.split(":").map(_=>_.trim());this.styles[h]=new ii(e,h,f)}})}var{definitions:s}=e,a=this.getAttribute("id");a.hasValue()&&(s[a.getString()]||(s[a.getString()]=this)),Array.from(t.childNodes).forEach(o=>{if(o.nodeType===1)this.addChild(o);else if(n&&(o.nodeType===3||o.nodeType===4)){var h=e.createTextNode(o);h.getText().length>0&&this.addChild(h)}})}}getAttribute(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,n=this.attributes[e];if(!n&&t){var i=new ii(this.document,e,"");return this.attributes[e]=i,i}return n||ii.empty(this.document)}getHrefAttribute(){for(var e in this.attributes)if(e==="href"||e.endsWith(":href"))return this.attributes[e];return ii.empty(this.document)}getStyle(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=this.styles[e];if(i)return i;var s=this.getAttribute(e);if(s!=null&&s.hasValue())return this.styles[e]=s,s;if(!n){var{parent:a}=this;if(a){var o=a.getStyle(e);if(o!=null&&o.hasValue())return o}}if(t){var h=new ii(this.document,e,"");return this.styles[e]=h,h}return i||ii.empty(this.document)}render(e){if(!(this.getStyle("display").getString()==="none"||this.getStyle("visibility").getString()==="hidden")){if(e.save(),this.getStyle("mask").hasValue()){var t=this.getStyle("mask").getDefinition();t&&(this.applyEffects(e),t.apply(e,this))}else if(this.getStyle("filter").getValue("none")!=="none"){var n=this.getStyle("filter").getDefinition();n&&(this.applyEffects(e),n.apply(e,this))}else this.setContext(e),this.renderChildren(e),this.clearContext(e);e.restore()}}setContext(e){}applyEffects(e){var t=Vp.fromElement(this.document,this);t&&t.apply(e);var n=this.getStyle("clip-path",!1,!0);if(n.hasValue()){var i=n.getDefinition();i&&i.apply(e)}}clearContext(e){}renderChildren(e){this.children.forEach(t=>{t.render(e)})}addChild(e){var t=e instanceof bo?e:this.document.createElement(e);t.parent=this,bo.ignoreChildTypes.includes(t.type)||this.children.push(t)}matchesSelector(e){var t,{node:n}=this;if(typeof n.matches=="function")return n.matches(e);var i=(t=n.getAttribute)===null||t===void 0?void 0:t.call(n,"class");return!i||i===""?!1:i.split(" ").some(s=>".".concat(s)===e)}addStylesFromStyleDefinition(){var{styles:e,stylesSpecificity:t}=this.document;for(var n in e)if(!n.startsWith("@")&&this.matchesSelector(n)){var i=e[n],s=t[n];if(i)for(var a in i){var o=this.stylesSpecificity[a];typeof o>"u"&&(o="000"),s>=o&&(this.styles[a]=i[a],this.stylesSpecificity[a]=s)}}}removeStyles(e,t){var n=t.reduce((i,s)=>{var a=e.getStyle(s);if(!a.hasValue())return i;var o=a.getString();return a.setValue(""),[...i,[s,o]]},[]);return n}restoreStyles(e,t){t.forEach(n=>{var[i,s]=n;e.getStyle(i,!0).setValue(s)})}isFirstChild(){var e;return((e=this.parent)===null||e===void 0?void 0:e.children.indexOf(this))===0}}bo.ignoreChildTypes=["title"];class zJ extends bo{constructor(e,t,n){super(e,t,n)}}function lWe(r){var e=r.trim();return/^('|")/.test(e)?e:'"'.concat(e,'"')}function cWe(r){return typeof process>"u"?r:r.trim().split(",").map(lWe).join(",")}function uWe(r){if(!r)return"";var e=r.trim().toLowerCase();switch(e){case"normal":case"italic":case"oblique":case"inherit":case"initial":case"unset":return e;default:return/^oblique\s+(-|)\d+deg$/.test(e)?e:""}}function hWe(r){if(!r)return"";var e=r.trim().toLowerCase();switch(e){case"normal":case"bold":case"lighter":case"bolder":case"inherit":case"initial":case"unset":return e;default:return/^[\d.]+$/.test(e)?e:""}}class lu{constructor(e,t,n,i,s,a){var o=a?typeof a=="string"?lu.parse(a):a:{};this.fontFamily=s||o.fontFamily,this.fontSize=i||o.fontSize,this.fontStyle=e||o.fontStyle,this.fontWeight=n||o.fontWeight,this.fontVariant=t||o.fontVariant}static parse(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0,n="",i="",s="",a="",o="",h=Cm(e).trim().split(" "),f={fontSize:!1,fontStyle:!1,fontWeight:!1,fontVariant:!1};return h.forEach(_=>{switch(!0){case(!f.fontStyle&&lu.styles.includes(_)):_!=="inherit"&&(n=_),f.fontStyle=!0;break;case(!f.fontVariant&&lu.variants.includes(_)):_!=="inherit"&&(i=_),f.fontStyle=!0,f.fontVariant=!0;break;case(!f.fontWeight&&lu.weights.includes(_)):_!=="inherit"&&(s=_),f.fontStyle=!0,f.fontVariant=!0,f.fontWeight=!0;break;case!f.fontSize:_!=="inherit"&&([a]=_.split("/")),f.fontStyle=!0,f.fontVariant=!0,f.fontWeight=!0,f.fontSize=!0;break;default:_!=="inherit"&&(o+=_)}}),new lu(n,i,s,a,o,t)}toString(){return[uWe(this.fontStyle),this.fontVariant,hWe(this.fontWeight),this.fontSize,cWe(this.fontFamily)].join(" ").trim()}}lu.styles="normal|italic|oblique|inherit",lu.variants="normal|small-caps|inherit",lu.weights="normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit";class bd{constructor(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Number.NaN,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Number.NaN,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Number.NaN,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:Number.NaN;this.x1=e,this.y1=t,this.x2=n,this.y2=i,this.addPoint(e,t),this.addPoint(n,i)}get x(){return this.x1}get y(){return this.y1}get width(){return this.x2-this.x1}get height(){return this.y2-this.y1}addPoint(e,t){typeof e<"u"&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=e,this.x2=e),e<this.x1&&(this.x1=e),e>this.x2&&(this.x2=e)),typeof t<"u"&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=t,this.y2=t),t<this.y1&&(this.y1=t),t>this.y2&&(this.y2=t))}addX(e){this.addPoint(e,null)}addY(e){this.addPoint(null,e)}addBoundingBox(e){if(e){var{x1:t,y1:n,x2:i,y2:s}=e;this.addPoint(t,n),this.addPoint(i,s)}}sumCubic(e,t,n,i,s){return Math.pow(1-e,3)*t+3*Math.pow(1-e,2)*e*n+3*(1-e)*Math.pow(e,2)*i+Math.pow(e,3)*s}bezierCurveAdd(e,t,n,i,s){var a=6*t-12*n+6*i,o=-3*t+9*n-9*i+3*s,h=3*n-3*t;if(o===0){if(a===0)return;var f=-h/a;0<f&&f<1&&(e?this.addX(this.sumCubic(f,t,n,i,s)):this.addY(this.sumCubic(f,t,n,i,s)));return}var _=Math.pow(a,2)-4*h*o;if(!(_<0)){var x=(-a+Math.sqrt(_))/(2*o);0<x&&x<1&&(e?this.addX(this.sumCubic(x,t,n,i,s)):this.addY(this.sumCubic(x,t,n,i,s)));var T=(-a-Math.sqrt(_))/(2*o);0<T&&T<1&&(e?this.addX(this.sumCubic(T,t,n,i,s)):this.addY(this.sumCubic(T,t,n,i,s)))}}addBezierCurve(e,t,n,i,s,a,o,h){this.addPoint(e,t),this.addPoint(o,h),this.bezierCurveAdd(!0,e,n,s,o),this.bezierCurveAdd(!1,t,i,a,h)}addQuadraticCurve(e,t,n,i,s,a){var o=e+.6666666666666666*(n-e),h=t+2/3*(i-t),f=o+1/3*(s-e),_=h+1/3*(a-t);this.addBezierCurve(e,t,o,f,h,_,s,a)}isPointInBox(e,t){var{x1:n,y1:i,x2:s,y2:a}=this;return n<=e&&e<=s&&i<=t&&t<=a}}class Pi extends rn{constructor(e){super(e.replace(/([+\-.])\s+/gm,"$1").replace(/[^MmZzLlHhVvCcSsQqTtAae\d\s.,+-].*/g,"")),this.control=null,this.start=null,this.current=null,this.command=null,this.commands=this.commands,this.i=-1,this.previousCommand=null,this.points=[],this.angles=[]}reset(){this.i=-1,this.command=null,this.previousCommand=null,this.start=new xa(0,0),this.control=new xa(0,0),this.current=new xa(0,0),this.points=[],this.angles=[]}isEnd(){var{i:e,commands:t}=this;return e>=t.length-1}next(){var e=this.commands[++this.i];return this.previousCommand=this.command,this.command=e,e}getPoint(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"x",t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"y",n=new xa(this.command[e],this.command[t]);return this.makeAbsolute(n)}getAsControlPoint(e,t){var n=this.getPoint(e,t);return this.control=n,n}getAsCurrentPoint(e,t){var n=this.getPoint(e,t);return this.current=n,n}getReflectedControlPoint(){var e=this.previousCommand.type;if(e!==rn.CURVE_TO&&e!==rn.SMOOTH_CURVE_TO&&e!==rn.QUAD_TO&&e!==rn.SMOOTH_QUAD_TO)return this.current;var{current:{x:t,y:n},control:{x:i,y:s}}=this,a=new xa(2*t-i,2*n-s);return a}makeAbsolute(e){if(this.command.relative){var{x:t,y:n}=this.current;e.x+=t,e.y+=n}return e}addMarker(e,t,n){var{points:i,angles:s}=this;n&&s.length>0&&!s[s.length-1]&&(s[s.length-1]=i[i.length-1].angleTo(n)),this.addMarkerAngle(e,t?t.angleTo(e):null)}addMarkerAngle(e,t){this.points.push(e),this.angles.push(t)}getMarkerPoints(){return this.points}getMarkerAngles(){for(var{angles:e}=this,t=e.length,n=0;n<t;n++)if(!e[n]){for(var i=n+1;i<t;i++)if(e[i]){e[n]=e[i];break}}return e}}class Gp extends bo{constructor(){super(...arguments),this.modifiedEmSizeStack=!1}calculateOpacity(){for(var e=1,t=this;t;){var n=t.getStyle("opacity",!1,!0);n.hasValue(!0)&&(e*=n.getNumber()),t=t.parent}return e}setContext(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!t){var n=this.getStyle("fill"),i=this.getStyle("fill-opacity"),s=this.getStyle("stroke"),a=this.getStyle("stroke-opacity");if(n.isUrlDefinition()){var o=n.getFillStyleDefinition(this,i);o&&(e.fillStyle=o)}else if(n.hasValue()){n.getString()==="currentColor"&&n.setValue(this.getStyle("color").getColor());var h=n.getColor();h!=="inherit"&&(e.fillStyle=h==="none"?"rgba(0,0,0,0)":h)}if(i.hasValue()){var f=new ii(this.document,"fill",e.fillStyle).addOpacity(i).getColor();e.fillStyle=f}if(s.isUrlDefinition()){var _=s.getFillStyleDefinition(this,a);_&&(e.strokeStyle=_)}else if(s.hasValue()){s.getString()==="currentColor"&&s.setValue(this.getStyle("color").getColor());var x=s.getString();x!=="inherit"&&(e.strokeStyle=x==="none"?"rgba(0,0,0,0)":x)}if(a.hasValue()){var T=new ii(this.document,"stroke",e.strokeStyle).addOpacity(a).getString();e.strokeStyle=T}var I=this.getStyle("stroke-width");if(I.hasValue()){var N=I.getPixels();e.lineWidth=N||Tm}var $=this.getStyle("stroke-linecap"),W=this.getStyle("stroke-linejoin"),Y=this.getStyle("stroke-miterlimit"),ie=this.getStyle("stroke-dasharray"),ce=this.getStyle("stroke-dashoffset");if($.hasValue()&&(e.lineCap=$.getString()),W.hasValue()&&(e.lineJoin=W.getString()),Y.hasValue()&&(e.miterLimit=Y.getNumber()),ie.hasValue()&&ie.getString()!=="none"){var fe=ch(ie.getString());typeof e.setLineDash<"u"?e.setLineDash(fe):typeof e.webkitLineDash<"u"?e.webkitLineDash=fe:typeof e.mozDash<"u"&&!(fe.length===1&&fe[0]===0)&&(e.mozDash=fe);var ve=ce.getPixels();typeof e.lineDashOffset<"u"?e.lineDashOffset=ve:typeof e.webkitLineDashOffset<"u"?e.webkitLineDashOffset=ve:typeof e.mozDashOffset<"u"&&(e.mozDashOffset=ve)}}if(this.modifiedEmSizeStack=!1,typeof e.font<"u"){var be=this.getStyle("font"),Qe=this.getStyle("font-style"),Ue=this.getStyle("font-variant"),st=this.getStyle("font-weight"),at=this.getStyle("font-size"),Le=this.getStyle("font-family"),ze=new lu(Qe.getString(),Ue.getString(),st.getString(),at.hasValue()?"".concat(at.getPixels(!0),"px"):"",Le.getString(),lu.parse(be.getString(),e.font));Qe.setValue(ze.fontStyle),Ue.setValue(ze.fontVariant),st.setValue(ze.fontWeight),at.setValue(ze.fontSize),Le.setValue(ze.fontFamily),e.font=ze.toString(),at.isPixels()&&(this.document.emSize=at.getPixels(),this.modifiedEmSizeStack=!0)}t||(this.applyEffects(e),e.globalAlpha=this.calculateOpacity())}clearContext(e){super.clearContext(e),this.modifiedEmSizeStack&&this.document.popEmSize()}}class qs extends Gp{constructor(e,t,n){super(e,t,n),this.type="path",this.pathParser=null,this.pathParser=new Pi(this.getAttribute("d").getString())}path(e){var{pathParser:t}=this,n=new bd;for(t.reset(),e&&e.beginPath();!t.isEnd();)switch(t.next().type){case Pi.MOVE_TO:this.pathM(e,n);break;case Pi.LINE_TO:this.pathL(e,n);break;case Pi.HORIZ_LINE_TO:this.pathH(e,n);break;case Pi.VERT_LINE_TO:this.pathV(e,n);break;case Pi.CURVE_TO:this.pathC(e,n);break;case Pi.SMOOTH_CURVE_TO:this.pathS(e,n);break;case Pi.QUAD_TO:this.pathQ(e,n);break;case Pi.SMOOTH_QUAD_TO:this.pathT(e,n);break;case Pi.ARC:this.pathA(e,n);break;case Pi.CLOSE_PATH:this.pathZ(e,n);break}return n}getBoundingBox(e){return this.path()}getMarkers(){var{pathParser:e}=this,t=e.getMarkerPoints(),n=e.getMarkerAngles(),i=t.map((s,a)=>[s,n[a]]);return i}renderChildren(e){this.path(e),this.document.screen.mouse.checkPath(this,e);var t=this.getStyle("fill-rule");e.fillStyle!==""&&(t.getString("inherit")!=="inherit"?e.fill(t.getString()):e.fill()),e.strokeStyle!==""&&(this.getAttribute("vector-effect").getString()==="non-scaling-stroke"?(e.save(),e.setTransform(1,0,0,1,0,0),e.stroke(),e.restore()):e.stroke());var n=this.getMarkers();if(n){var i=n.length-1,s=this.getStyle("marker-start"),a=this.getStyle("marker-mid"),o=this.getStyle("marker-end");if(s.isUrlDefinition()){var h=s.getDefinition(),[f,_]=n[0];h.render(e,f,_)}if(a.isUrlDefinition())for(var x=a.getDefinition(),T=1;T<i;T++){var[I,N]=n[T];x.render(e,I,N)}if(o.isUrlDefinition()){var $=o.getDefinition(),[W,Y]=n[i];$.render(e,W,Y)}}}static pathM(e){var t=e.getAsCurrentPoint();return e.start=e.current,{point:t}}pathM(e,t){var{pathParser:n}=this,{point:i}=qs.pathM(n),{x:s,y:a}=i;n.addMarker(i),t.addPoint(s,a),e&&e.moveTo(s,a)}static pathL(e){var{current:t}=e,n=e.getAsCurrentPoint();return{current:t,point:n}}pathL(e,t){var{pathParser:n}=this,{current:i,point:s}=qs.pathL(n),{x:a,y:o}=s;n.addMarker(s,i),t.addPoint(a,o),e&&e.lineTo(a,o)}static pathH(e){var{current:t,command:n}=e,i=new xa((n.relative?t.x:0)+n.x,t.y);return e.current=i,{current:t,point:i}}pathH(e,t){var{pathParser:n}=this,{current:i,point:s}=qs.pathH(n),{x:a,y:o}=s;n.addMarker(s,i),t.addPoint(a,o),e&&e.lineTo(a,o)}static pathV(e){var{current:t,command:n}=e,i=new xa(t.x,(n.relative?t.y:0)+n.y);return e.current=i,{current:t,point:i}}pathV(e,t){var{pathParser:n}=this,{current:i,point:s}=qs.pathV(n),{x:a,y:o}=s;n.addMarker(s,i),t.addPoint(a,o),e&&e.lineTo(a,o)}static pathC(e){var{current:t}=e,n=e.getPoint("x1","y1"),i=e.getAsControlPoint("x2","y2"),s=e.getAsCurrentPoint();return{current:t,point:n,controlPoint:i,currentPoint:s}}pathC(e,t){var{pathParser:n}=this,{current:i,point:s,controlPoint:a,currentPoint:o}=qs.pathC(n);n.addMarker(o,a,s),t.addBezierCurve(i.x,i.y,s.x,s.y,a.x,a.y,o.x,o.y),e&&e.bezierCurveTo(s.x,s.y,a.x,a.y,o.x,o.y)}static pathS(e){var{current:t}=e,n=e.getReflectedControlPoint(),i=e.getAsControlPoint("x2","y2"),s=e.getAsCurrentPoint();return{current:t,point:n,controlPoint:i,currentPoint:s}}pathS(e,t){var{pathParser:n}=this,{current:i,point:s,controlPoint:a,currentPoint:o}=qs.pathS(n);n.addMarker(o,a,s),t.addBezierCurve(i.x,i.y,s.x,s.y,a.x,a.y,o.x,o.y),e&&e.bezierCurveTo(s.x,s.y,a.x,a.y,o.x,o.y)}static pathQ(e){var{current:t}=e,n=e.getAsControlPoint("x1","y1"),i=e.getAsCurrentPoint();return{current:t,controlPoint:n,currentPoint:i}}pathQ(e,t){var{pathParser:n}=this,{current:i,controlPoint:s,currentPoint:a}=qs.pathQ(n);n.addMarker(a,s,s),t.addQuadraticCurve(i.x,i.y,s.x,s.y,a.x,a.y),e&&e.quadraticCurveTo(s.x,s.y,a.x,a.y)}static pathT(e){var{current:t}=e,n=e.getReflectedControlPoint();e.control=n;var i=e.getAsCurrentPoint();return{current:t,controlPoint:n,currentPoint:i}}pathT(e,t){var{pathParser:n}=this,{current:i,controlPoint:s,currentPoint:a}=qs.pathT(n);n.addMarker(a,s,s),t.addQuadraticCurve(i.x,i.y,s.x,s.y,a.x,a.y),e&&e.quadraticCurveTo(s.x,s.y,a.x,a.y)}static pathA(e){var{current:t,command:n}=e,{rX:i,rY:s,xRot:a,lArcFlag:o,sweepFlag:h}=n,f=a*(Math.PI/180),_=e.getAsCurrentPoint(),x=new xa(Math.cos(f)*(t.x-_.x)/2+Math.sin(f)*(t.y-_.y)/2,-Math.sin(f)*(t.x-_.x)/2+Math.cos(f)*(t.y-_.y)/2),T=Math.pow(x.x,2)/Math.pow(i,2)+Math.pow(x.y,2)/Math.pow(s,2);T>1&&(i*=Math.sqrt(T),s*=Math.sqrt(T));var I=(o===h?-1:1)*Math.sqrt((Math.pow(i,2)*Math.pow(s,2)-Math.pow(i,2)*Math.pow(x.y,2)-Math.pow(s,2)*Math.pow(x.x,2))/(Math.pow(i,2)*Math.pow(x.y,2)+Math.pow(s,2)*Math.pow(x.x,2)));isNaN(I)&&(I=0);var N=new xa(I*i*x.y/s,I*-s*x.x/i),$=new xa((t.x+_.x)/2+Math.cos(f)*N.x-Math.sin(f)*N.y,(t.y+_.y)/2+Math.sin(f)*N.x+Math.cos(f)*N.y),W=rD([1,0],[(x.x-N.x)/i,(x.y-N.y)/s]),Y=[(x.x-N.x)/i,(x.y-N.y)/s],ie=[(-x.x-N.x)/i,(-x.y-N.y)/s],ce=rD(Y,ie);return zE(Y,ie)<=-1&&(ce=Math.PI),zE(Y,ie)>=1&&(ce=0),{currentPoint:_,rX:i,rY:s,sweepFlag:h,xAxisRotation:f,centp:$,a1:W,ad:ce}}pathA(e,t){var{pathParser:n}=this,{currentPoint:i,rX:s,rY:a,sweepFlag:o,xAxisRotation:h,centp:f,a1:_,ad:x}=qs.pathA(n),T=1-o?1:-1,I=_+T*(x/2),N=new xa(f.x+s*Math.cos(I),f.y+a*Math.sin(I));if(n.addMarkerAngle(N,I-T*Math.PI/2),n.addMarkerAngle(i,I-T*Math.PI),t.addPoint(i.x,i.y),e&&!isNaN(_)&&!isNaN(x)){var $=s>a?s:a,W=s>a?1:s/a,Y=s>a?a/s:1;e.translate(f.x,f.y),e.rotate(h),e.scale(W,Y),e.arc(0,0,$,_,_+x,!!(1-o)),e.scale(1/W,1/Y),e.rotate(-h),e.translate(-f.x,-f.y)}}static pathZ(e){e.current=e.start}pathZ(e,t){qs.pathZ(this.pathParser),e&&t.x1!==t.x2&&t.y1!==t.y2&&e.closePath()}}class dD extends qs{constructor(e,t,n){super(e,t,n),this.type="glyph",this.horizAdvX=this.getAttribute("horiz-adv-x").getNumber(),this.unicode=this.getAttribute("unicode").getString(),this.arabicForm=this.getAttribute("arabic-form").getString()}}class LA extends Gp{constructor(e,t,n){super(e,t,new.target===LA?!0:n),this.type="text",this.x=0,this.y=0,this.measureCache=-1}setContext(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;super.setContext(e,t);var n=this.getStyle("dominant-baseline").getTextBaseline()||this.getStyle("alignment-baseline").getTextBaseline();n&&(e.textBaseline=n)}initializeCoordinates(){this.x=0,this.y=0,this.leafTexts=[],this.textChunkStart=0,this.minX=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY}getBoundingBox(e){if(this.type!=="text")return this.getTElementBoundingBox(e);this.initializeCoordinates(),this.adjustChildCoordinatesRecursive(e);var t=null;return this.children.forEach((n,i)=>{var s=this.getChildBoundingBox(e,this,this,i);t?t.addBoundingBox(s):t=s}),t}getFontSize(){var{document:e,parent:t}=this,n=lu.parse(e.ctx.font).fontSize,i=t.getStyle("font-size").getNumber(n);return i}getTElementBoundingBox(e){var t=this.getFontSize();return new bd(this.x,this.y-t,this.x+this.measureText(e),this.y)}getGlyph(e,t,n){var i=t[n],s=null;if(e.isArabic){var a=t.length,o=t[n-1],h=t[n+1],f="isolated";if((n===0||o===" ")&&n<a-1&&h!==" "&&(f="terminal"),n>0&&o!==" "&&n<a-1&&h!==" "&&(f="medial"),n>0&&o!==" "&&(n===a-1||h===" ")&&(f="initial"),typeof e.glyphs[i]<"u"){var _=e.glyphs[i];s=_ instanceof dD?_:_[f]}}else s=e.glyphs[i];return s||(s=e.missingGlyph),s}getText(){return""}getTextFromNode(e){var t=e||this.node,n=Array.from(t.parentNode.childNodes),i=n.indexOf(t),s=n.length-1,a=Cm(t.textContent||"");return i===0&&(a=EJ(a)),i===s&&(a=TJ(a)),a}renderChildren(e){if(this.type!=="text"){this.renderTElementChildren(e);return}this.initializeCoordinates(),this.adjustChildCoordinatesRecursive(e),this.children.forEach((n,i)=>{this.renderChild(e,this,this,i)});var{mouse:t}=this.document.screen;t.isWorking()&&t.checkBoundingBox(this,this.getBoundingBox(e))}renderTElementChildren(e){var{document:t,parent:n}=this,i=this.getText(),s=n.getStyle("font-family").getDefinition();if(s){for(var{unitsPerEm:a}=s.fontFace,o=lu.parse(t.ctx.font),h=n.getStyle("font-size").getNumber(o.fontSize),f=n.getStyle("font-style").getString(o.fontStyle),_=h/a,x=s.isRTL?i.split("").reverse().join(""):i,T=ch(n.getAttribute("dx").getString()),I=x.length,N=0;N<I;N++){var $=this.getGlyph(s,x,N);e.translate(this.x,this.y),e.scale(_,-_);var W=e.lineWidth;e.lineWidth=e.lineWidth*a/h,f==="italic"&&e.transform(1,0,.4,1,0,0),$.render(e),f==="italic"&&e.transform(1,0,-.4,1,0,0),e.lineWidth=W,e.scale(1/_,-1/_),e.translate(-this.x,-this.y),this.x+=h*($.horizAdvX||s.horizAdvX)/a,typeof T[N]<"u"&&!isNaN(T[N])&&(this.x+=T[N])}return}var{x:Y,y:ie}=this;e.fillStyle&&e.fillText(i,Y,ie),e.strokeStyle&&e.strokeText(i,Y,ie)}applyAnchoring(){if(!(this.textChunkStart>=this.leafTexts.length)){var e=this.leafTexts[this.textChunkStart],t=e.getStyle("text-anchor").getString("start"),n=!1,i=0;t==="start"&&!n||t==="end"&&n?i=e.x-this.minX:t==="end"&&!n||t==="start"&&n?i=e.x-this.maxX:i=e.x-(this.minX+this.maxX)/2;for(var s=this.textChunkStart;s<this.leafTexts.length;s++)this.leafTexts[s].x+=i;this.minX=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.textChunkStart=this.leafTexts.length}}adjustChildCoordinatesRecursive(e){this.children.forEach((t,n)=>{this.adjustChildCoordinatesRecursiveCore(e,this,this,n)}),this.applyAnchoring()}adjustChildCoordinatesRecursiveCore(e,t,n,i){var s=n.children[i];s.children.length>0?s.children.forEach((a,o)=>{t.adjustChildCoordinatesRecursiveCore(e,t,s,o)}):this.adjustChildCoordinates(e,t,n,i)}adjustChildCoordinates(e,t,n,i){var s=n.children[i];if(typeof s.measureText!="function")return s;e.save(),s.setContext(e,!0);var a=s.getAttribute("x"),o=s.getAttribute("y"),h=s.getAttribute("dx"),f=s.getAttribute("dy"),_=s.getStyle("font-family").getDefinition(),x=!!_&&_.isRTL;i===0&&(a.hasValue()||a.setValue(s.getInheritedAttribute("x")),o.hasValue()||o.setValue(s.getInheritedAttribute("y")),h.hasValue()||h.setValue(s.getInheritedAttribute("dx")),f.hasValue()||f.setValue(s.getInheritedAttribute("dy")));var T=s.measureText(e);return x&&(t.x-=T),a.hasValue()?(t.applyAnchoring(),s.x=a.getPixels("x"),h.hasValue()&&(s.x+=h.getPixels("x"))):(h.hasValue()&&(t.x+=h.getPixels("x")),s.x=t.x),t.x=s.x,x||(t.x+=T),o.hasValue()?(s.y=o.getPixels("y"),f.hasValue()&&(s.y+=f.getPixels("y"))):(f.hasValue()&&(t.y+=f.getPixels("y")),s.y=t.y),t.y=s.y,t.leafTexts.push(s),t.minX=Math.min(t.minX,s.x,s.x+T),t.maxX=Math.max(t.maxX,s.x,s.x+T),s.clearContext(e),e.restore(),s}getChildBoundingBox(e,t,n,i){var s=n.children[i];if(typeof s.getBoundingBox!="function")return null;var a=s.getBoundingBox(e);return a?(s.children.forEach((o,h)=>{var f=t.getChildBoundingBox(e,t,s,h);a.addBoundingBox(f)}),a):null}renderChild(e,t,n,i){var s=n.children[i];s.render(e),s.children.forEach((a,o)=>{t.renderChild(e,t,s,o)})}measureText(e){var{measureCache:t}=this;if(~t)return t;var n=this.getText(),i=this.measureTargetText(e,n);return this.measureCache=i,i}measureTargetText(e,t){if(!t.length)return 0;var{parent:n}=this,i=n.getStyle("font-family").getDefinition();if(i){for(var s=this.getFontSize(),a=i.isRTL?t.split("").reverse().join(""):t,o=ch(n.getAttribute("dx").getString()),h=a.length,f=0,_=0;_<h;_++){var x=this.getGlyph(i,a,_);f+=(x.horizAdvX||i.horizAdvX)*s/i.fontFace.unitsPerEm,typeof o[_]<"u"&&!isNaN(o[_])&&(f+=o[_])}return f}if(!e.measureText)return t.length*10;e.save(),this.setContext(e,!0);var{width:T}=e.measureText(t);return this.clearContext(e),e.restore(),T}getInheritedAttribute(e){for(var t=this;t instanceof LA&&t.isFirstChild();){var n=t.parent.getAttribute(e);if(n.hasValue(!0))return n.getValue("0");t=t.parent}return null}}class vv extends LA{constructor(e,t,n){super(e,t,new.target===vv?!0:n),this.type="tspan",this.text=this.children.length>0?"":this.getTextFromNode()}getText(){return this.text}}class dWe extends vv{constructor(){super(...arguments),this.type="textNode"}}class _y extends Gp{constructor(){super(...arguments),this.type="svg",this.root=!1}setContext(e){var t,{document:n}=this,{screen:i,window:s}=n,a=e.canvas;if(i.setDefaults(e),a.style&&typeof e.font<"u"&&s&&typeof s.getComputedStyle<"u"){e.font=s.getComputedStyle(a).getPropertyValue("font");var o=new ii(n,"fontSize",lu.parse(e.font).fontSize);o.hasValue()&&(n.rootEmSize=o.getPixels("y"),n.emSize=n.rootEmSize)}this.getAttribute("x").hasValue()||this.getAttribute("x",!0).setValue(0),this.getAttribute("y").hasValue()||this.getAttribute("y",!0).setValue(0);var{width:h,height:f}=i.viewPort;this.getStyle("width").hasValue()||this.getStyle("width",!0).setValue("100%"),this.getStyle("height").hasValue()||this.getStyle("height",!0).setValue("100%"),this.getStyle("color").hasValue()||this.getStyle("color",!0).setValue("black");var _=this.getAttribute("refX"),x=this.getAttribute("refY"),T=this.getAttribute("viewBox"),I=T.hasValue()?ch(T.getString()):null,N=!this.root&&this.getStyle("overflow").getValue("hidden")!=="visible",$=0,W=0,Y=0,ie=0;I&&($=I[0],W=I[1]),this.root||(h=this.getStyle("width").getPixels("x"),f=this.getStyle("height").getPixels("y"),this.type==="marker"&&(Y=$,ie=W,$=0,W=0)),i.viewPort.setCurrent(h,f),this.node&&(!this.parent||((t=this.node.parentNode)===null||t===void 0?void 0:t.nodeName)==="foreignObject")&&this.getStyle("transform",!1,!0).hasValue()&&!this.getStyle("transform-origin",!1,!0).hasValue()&&this.getStyle("transform-origin",!0,!0).setValue("50% 50%"),super.setContext(e),e.translate(this.getAttribute("x").getPixels("x"),this.getAttribute("y").getPixels("y")),I&&(h=I[2],f=I[3]),n.setViewBox({ctx:e,aspectRatio:this.getAttribute("preserveAspectRatio").getString(),width:i.viewPort.width,desiredWidth:h,height:i.viewPort.height,desiredHeight:f,minX:$,minY:W,refX:_.getValue(),refY:x.getValue(),clip:N,clipX:Y,clipY:ie}),I&&(i.viewPort.removeCurrent(),i.viewPort.setCurrent(h,f))}clearContext(e){super.clearContext(e),this.document.screen.viewPort.removeCurrent()}resize(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:e,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=this.getAttribute("width",!0),s=this.getAttribute("height",!0),a=this.getAttribute("viewBox"),o=this.getAttribute("style"),h=i.getNumber(0),f=s.getNumber(0);if(n)if(typeof n=="string")this.getAttribute("preserveAspectRatio",!0).setValue(n);else{var _=this.getAttribute("preserveAspectRatio");_.hasValue()&&_.setValue(_.getString().replace(/^\s*(\S.*\S)\s*$/,"$1"))}if(i.setValue(e),s.setValue(t),a.hasValue()||a.setValue("0 0 ".concat(h||e," ").concat(f||t)),o.hasValue()){var x=this.getStyle("width"),T=this.getStyle("height");x.hasValue()&&x.setValue("".concat(e,"px")),T.hasValue()&&T.setValue("".concat(t,"px"))}}}class fD extends qs{constructor(){super(...arguments),this.type="rect"}path(e){var t=this.getAttribute("x").getPixels("x"),n=this.getAttribute("y").getPixels("y"),i=this.getStyle("width",!1,!0).getPixels("x"),s=this.getStyle("height",!1,!0).getPixels("y"),a=this.getAttribute("rx"),o=this.getAttribute("ry"),h=a.getPixels("x"),f=o.getPixels("y");if(a.hasValue()&&!o.hasValue()&&(f=h),o.hasValue()&&!a.hasValue()&&(h=f),h=Math.min(h,i/2),f=Math.min(f,s/2),e){var _=4*((Math.sqrt(2)-1)/3);e.beginPath(),s>0&&i>0&&(e.moveTo(t+h,n),e.lineTo(t+i-h,n),e.bezierCurveTo(t+i-h+_*h,n,t+i,n+f-_*f,t+i,n+f),e.lineTo(t+i,n+s-f),e.bezierCurveTo(t+i,n+s-f+_*f,t+i-h+_*h,n+s,t+i-h,n+s),e.lineTo(t+h,n+s),e.bezierCurveTo(t+h-_*h,n+s,t,n+s-f+_*f,t,n+s-f),e.lineTo(t,n+f),e.bezierCurveTo(t,n+f-_*f,t+h-_*h,n,t+h,n),e.closePath())}return new bd(t,n,t+i,n+s)}getMarkers(){return null}}class HJ extends qs{constructor(){super(...arguments),this.type="circle"}path(e){var t=this.getAttribute("cx").getPixels("x"),n=this.getAttribute("cy").getPixels("y"),i=this.getAttribute("r").getPixels();return e&&i>0&&(e.beginPath(),e.arc(t,n,i,0,Math.PI*2,!1),e.closePath()),new bd(t-i,n-i,t+i,n+i)}getMarkers(){return null}}class VJ extends qs{constructor(){super(...arguments),this.type="ellipse"}path(e){var t=4*((Math.sqrt(2)-1)/3),n=this.getAttribute("rx").getPixels("x"),i=this.getAttribute("ry").getPixels("y"),s=this.getAttribute("cx").getPixels("x"),a=this.getAttribute("cy").getPixels("y");return e&&n>0&&i>0&&(e.beginPath(),e.moveTo(s+n,a),e.bezierCurveTo(s+n,a+t*i,s+t*n,a+i,s,a+i),e.bezierCurveTo(s-t*n,a+i,s-n,a+t*i,s-n,a),e.bezierCurveTo(s-n,a-t*i,s-t*n,a-i,s,a-i),e.bezierCurveTo(s+t*n,a-i,s+n,a-t*i,s+n,a),e.closePath()),new bd(s-n,a-i,s+n,a+i)}getMarkers(){return null}}class GJ extends qs{constructor(){super(...arguments),this.type="line"}getPoints(){return[new xa(this.getAttribute("x1").getPixels("x"),this.getAttribute("y1").getPixels("y")),new xa(this.getAttribute("x2").getPixels("x"),this.getAttribute("y2").getPixels("y"))]}path(e){var[{x:t,y:n},{x:i,y:s}]=this.getPoints();return e&&(e.beginPath(),e.moveTo(t,n),e.lineTo(i,s)),new bd(t,n,i,s)}getMarkers(){var[e,t]=this.getPoints(),n=e.angleTo(t);return[[e,n],[t,n]]}}class AD extends qs{constructor(e,t,n){super(e,t,n),this.type="polyline",this.points=[],this.points=xa.parsePath(this.getAttribute("points").getString())}path(e){var{points:t}=this,[{x:n,y:i}]=t,s=new bd(n,i);return e&&(e.beginPath(),e.moveTo(n,i)),t.forEach(a=>{var{x:o,y:h}=a;s.addPoint(o,h),e&&e.lineTo(o,h)}),s}getMarkers(){var{points:e}=this,t=e.length-1,n=[];return e.forEach((i,s)=>{s!==t&&n.push([i,i.angleTo(e[s+1])])}),n.length>0&&n.push([e[e.length-1],n[n.length-1][1]]),n}}class QJ extends AD{constructor(){super(...arguments),this.type="polygon"}path(e){var t=super.path(e),[{x:n,y:i}]=this.points;return e&&(e.lineTo(n,i),e.closePath()),t}}class $J extends bo{constructor(){super(...arguments),this.type="pattern"}createPattern(e,t,n){var i=this.getStyle("width").getPixels("x",!0),s=this.getStyle("height").getPixels("y",!0),a=new _y(this.document,null);a.attributes.viewBox=new ii(this.document,"viewBox",this.getAttribute("viewBox").getValue()),a.attributes.width=new ii(this.document,"width","".concat(i,"px")),a.attributes.height=new ii(this.document,"height","".concat(s,"px")),a.attributes.transform=new ii(this.document,"transform",this.getAttribute("patternTransform").getValue()),a.children=this.children;var o=this.document.createCanvas(i,s),h=o.getContext("2d"),f=this.getAttribute("x"),_=this.getAttribute("y");f.hasValue()&&_.hasValue()&&h.translate(f.getPixels("x",!0),_.getPixels("y",!0)),n.hasValue()?this.styles["fill-opacity"]=n:Reflect.deleteProperty(this.styles,"fill-opacity");for(var x=-1;x<=1;x++)for(var T=-1;T<=1;T++)h.save(),a.attributes.x=new ii(this.document,"x",x*o.width),a.attributes.y=new ii(this.document,"y",T*o.height),a.render(h),h.restore();var I=e.createPattern(o,"repeat");return I}}class jJ extends bo{constructor(){super(...arguments),this.type="marker"}render(e,t,n){if(t){var{x:i,y:s}=t,a=this.getAttribute("orient").getString("auto"),o=this.getAttribute("markerUnits").getString("strokeWidth");e.translate(i,s),a==="auto"&&e.rotate(n),o==="strokeWidth"&&e.scale(e.lineWidth,e.lineWidth),e.save();var h=new _y(this.document,null);h.type=this.type,h.attributes.viewBox=new ii(this.document,"viewBox",this.getAttribute("viewBox").getValue()),h.attributes.refX=new ii(this.document,"refX",this.getAttribute("refX").getValue()),h.attributes.refY=new ii(this.document,"refY",this.getAttribute("refY").getValue()),h.attributes.width=new ii(this.document,"width",this.getAttribute("markerWidth").getValue()),h.attributes.height=new ii(this.document,"height",this.getAttribute("markerHeight").getValue()),h.attributes.overflow=new ii(this.document,"overflow",this.getAttribute("overflow").getValue()),h.attributes.fill=new ii(this.document,"fill",this.getAttribute("fill").getColor("black")),h.attributes.stroke=new ii(this.document,"stroke",this.getAttribute("stroke").getValue("none")),h.children=this.children,h.render(e),e.restore(),o==="strokeWidth"&&e.scale(1/e.lineWidth,1/e.lineWidth),a==="auto"&&e.rotate(-n),e.translate(-i,-s)}}}class qJ extends bo{constructor(){super(...arguments),this.type="defs"}render(){}}class VE extends Gp{constructor(){super(...arguments),this.type="g"}getBoundingBox(e){var t=new bd;return this.children.forEach(n=>{t.addBoundingBox(n.getBoundingBox(e))}),t}}class pD extends bo{constructor(e,t,n){super(e,t,n),this.attributesToInherit=["gradientUnits"],this.stops=[];var{stops:i,children:s}=this;s.forEach(a=>{a.type==="stop"&&i.push(a)})}getGradientUnits(){return this.getAttribute("gradientUnits").getString("objectBoundingBox")}createGradient(e,t,n){var i=this;this.getHrefAttribute().hasValue()&&(i=this.getHrefAttribute().getDefinition(),this.inheritStopContainer(i));var{stops:s}=i,a=this.getGradient(e,t);if(!a)return this.addParentOpacity(n,s[s.length-1].color);if(s.forEach(W=>{a.addColorStop(W.offset,this.addParentOpacity(n,W.color))}),this.getAttribute("gradientTransform").hasValue()){var{document:o}=this,{MAX_VIRTUAL_PIXELS:h,viewPort:f}=o.screen,[_]=f.viewPorts,x=new fD(o,null);x.attributes.x=new ii(o,"x",-h/3),x.attributes.y=new ii(o,"y",-h/3),x.attributes.width=new ii(o,"width",h),x.attributes.height=new ii(o,"height",h);var T=new VE(o,null);T.attributes.transform=new ii(o,"transform",this.getAttribute("gradientTransform").getValue()),T.children=[x];var I=new _y(o,null);I.attributes.x=new ii(o,"x",0),I.attributes.y=new ii(o,"y",0),I.attributes.width=new ii(o,"width",_.width),I.attributes.height=new ii(o,"height",_.height),I.children=[T];var N=o.createCanvas(_.width,_.height),$=N.getContext("2d");return $.fillStyle=a,I.render($),$.createPattern(N,"no-repeat")}return a}inheritStopContainer(e){this.attributesToInherit.forEach(t=>{!this.getAttribute(t).hasValue()&&e.getAttribute(t).hasValue()&&this.getAttribute(t,!0).setValue(e.getAttribute(t).getValue())})}addParentOpacity(e,t){if(e.hasValue()){var n=new ii(this.document,"color",t);return n.addOpacity(e).getColor()}return t}}class KJ extends pD{constructor(e,t,n){super(e,t,n),this.type="linearGradient",this.attributesToInherit.push("x1","y1","x2","y2")}getGradient(e,t){var n=this.getGradientUnits()==="objectBoundingBox",i=n?t.getBoundingBox(e):null;if(n&&!i)return null;!this.getAttribute("x1").hasValue()&&!this.getAttribute("y1").hasValue()&&!this.getAttribute("x2").hasValue()&&!this.getAttribute("y2").hasValue()&&(this.getAttribute("x1",!0).setValue(0),this.getAttribute("y1",!0).setValue(0),this.getAttribute("x2",!0).setValue(1),this.getAttribute("y2",!0).setValue(0));var s=n?i.x+i.width*this.getAttribute("x1").getNumber():this.getAttribute("x1").getPixels("x"),a=n?i.y+i.height*this.getAttribute("y1").getNumber():this.getAttribute("y1").getPixels("y"),o=n?i.x+i.width*this.getAttribute("x2").getNumber():this.getAttribute("x2").getPixels("x"),h=n?i.y+i.height*this.getAttribute("y2").getNumber():this.getAttribute("y2").getPixels("y");return s===o&&a===h?null:e.createLinearGradient(s,a,o,h)}}class WJ extends pD{constructor(e,t,n){super(e,t,n),this.type="radialGradient",this.attributesToInherit.push("cx","cy","r","fx","fy","fr")}getGradient(e,t){var n=this.getGradientUnits()==="objectBoundingBox",i=t.getBoundingBox(e);if(n&&!i)return null;this.getAttribute("cx").hasValue()||this.getAttribute("cx",!0).setValue("50%"),this.getAttribute("cy").hasValue()||this.getAttribute("cy",!0).setValue("50%"),this.getAttribute("r").hasValue()||this.getAttribute("r",!0).setValue("50%");var s=n?i.x+i.width*this.getAttribute("cx").getNumber():this.getAttribute("cx").getPixels("x"),a=n?i.y+i.height*this.getAttribute("cy").getNumber():this.getAttribute("cy").getPixels("y"),o=s,h=a;this.getAttribute("fx").hasValue()&&(o=n?i.x+i.width*this.getAttribute("fx").getNumber():this.getAttribute("fx").getPixels("x")),this.getAttribute("fy").hasValue()&&(h=n?i.y+i.height*this.getAttribute("fy").getNumber():this.getAttribute("fy").getPixels("y"));var f=n?(i.width+i.height)/2*this.getAttribute("r").getNumber():this.getAttribute("r").getPixels(),_=this.getAttribute("fr").getPixels();return e.createRadialGradient(o,h,_,s,a,f)}}class XJ extends bo{constructor(e,t,n){super(e,t,n),this.type="stop";var i=Math.max(0,Math.min(1,this.getAttribute("offset").getNumber())),s=this.getStyle("stop-opacity"),a=this.getStyle("stop-color",!0);a.getString()===""&&a.setValue("#000"),s.hasValue()&&(a=a.addOpacity(s)),this.offset=i,this.color=a.getColor()}}class GE extends bo{constructor(e,t,n){super(e,t,n),this.type="animate",this.duration=0,this.initialValue=null,this.initialUnits="",this.removed=!1,this.frozen=!1,e.screen.animations.push(this),this.begin=this.getAttribute("begin").getMilliseconds(),this.maxDuration=this.begin+this.getAttribute("dur").getMilliseconds(),this.from=this.getAttribute("from"),this.to=this.getAttribute("to"),this.values=new ii(e,"values",null);var i=this.getAttribute("values");i.hasValue()&&this.values.setValue(i.getString().split(";"))}getProperty(){var e=this.getAttribute("attributeType").getString(),t=this.getAttribute("attributeName").getString();return e==="CSS"?this.parent.getStyle(t,!0):this.parent.getAttribute(t,!0)}calcValue(){var{initialUnits:e}=this,{progress:t,from:n,to:i}=this.getProgress(),s=n.getNumber()+(i.getNumber()-n.getNumber())*t;return e==="%"&&(s*=100),"".concat(s).concat(e)}update(e){var{parent:t}=this,n=this.getProperty();if(this.initialValue||(this.initialValue=n.getString(),this.initialUnits=n.getUnits()),this.duration>this.maxDuration){var i=this.getAttribute("fill").getString("remove");if(this.getAttribute("repeatCount").getString()==="indefinite"||this.getAttribute("repeatDur").getString()==="indefinite")this.duration=0;else if(i==="freeze"&&!this.frozen)this.frozen=!0,t.animationFrozen=!0,t.animationFrozenValue=n.getString();else if(i==="remove"&&!this.removed)return this.removed=!0,n.setValue(t.animationFrozen?t.animationFrozenValue:this.initialValue),!0;return!1}this.duration+=e;var s=!1;if(this.begin<this.duration){var a=this.calcValue(),o=this.getAttribute("type");if(o.hasValue()){var h=o.getString();a="".concat(h,"(").concat(a,")")}n.setValue(a),s=!0}return s}getProgress(){var{document:e,values:t}=this,n={progress:(this.duration-this.begin)/(this.maxDuration-this.begin)};if(t.hasValue()){var i=n.progress*(t.getValue().length-1),s=Math.floor(i),a=Math.ceil(i);n.from=new ii(e,"from",parseFloat(t.getValue()[s])),n.to=new ii(e,"to",parseFloat(t.getValue()[a])),n.progress=(i-s)/(a-s)}else n.from=this.from,n.to=this.to;return n}}class JJ extends GE{constructor(){super(...arguments),this.type="animateColor"}calcValue(){var{progress:e,from:t,to:n}=this.getProgress(),i=new WL(t.getColor()),s=new WL(n.getColor());if(i.ok&&s.ok){var a=i.r+(s.r-i.r)*e,o=i.g+(s.g-i.g)*e,h=i.b+(s.b-i.b)*e;return"rgb(".concat(Math.floor(a),", ").concat(Math.floor(o),", ").concat(Math.floor(h),")")}return this.getAttribute("from").getColor()}}class ZJ extends GE{constructor(){super(...arguments),this.type="animateTransform"}calcValue(){var{progress:e,from:t,to:n}=this.getProgress(),i=ch(t.getString()),s=ch(n.getString()),a=i.map((o,h)=>{var f=s[h];return o+(f-o)*e}).join(" ");return a}}class YJ extends bo{constructor(e,t,n){super(e,t,n),this.type="font",this.glyphs={},this.horizAdvX=this.getAttribute("horiz-adv-x").getNumber();var{definitions:i}=e,{children:s}=this;for(var a of s)switch(a.type){case"font-face":{this.fontFace=a;var o=a.getStyle("font-family");o.hasValue()&&(i[o.getString()]=this);break}case"missing-glyph":this.missingGlyph=a;break;case"glyph":{var h=a;h.arabicForm?(this.isRTL=!0,this.isArabic=!0,typeof this.glyphs[h.unicode]>"u"&&(this.glyphs[h.unicode]={}),this.glyphs[h.unicode][h.arabicForm]=h):this.glyphs[h.unicode]=h;break}}}render(){}}class eZ extends bo{constructor(e,t,n){super(e,t,n),this.type="font-face",this.ascent=this.getAttribute("ascent").getNumber(),this.descent=this.getAttribute("descent").getNumber(),this.unitsPerEm=this.getAttribute("units-per-em").getNumber()}}class tZ extends qs{constructor(){super(...arguments),this.type="missing-glyph",this.horizAdvX=0}}class rZ extends LA{constructor(){super(...arguments),this.type="tref"}getText(){var e=this.getHrefAttribute().getDefinition();if(e){var t=e.children[0];if(t)return t.getText()}return""}}class nZ extends LA{constructor(e,t,n){super(e,t,n),this.type="a";var{childNodes:i}=t,s=i[0],a=i.length>0&&Array.from(i).every(o=>o.nodeType===3);this.hasText=a,this.text=a?this.getTextFromNode(s):""}getText(){return this.text}renderChildren(e){if(this.hasText){super.renderChildren(e);var{document:t,x:n,y:i}=this,{mouse:s}=t.screen,a=new ii(t,"fontSize",lu.parse(t.ctx.font).fontSize);s.isWorking()&&s.checkBoundingBox(this,new bd(n,i-a.getPixels("y"),n+this.measureText(e),i))}else if(this.children.length>0){var o=new VE(this.document,null);o.children=this.children,o.parent=this,o.render(e)}}onClick(){var{window:e}=this.document;e&&e.open(this.getHrefAttribute().getString())}onMouseMove(){var e=this.document.ctx;e.canvas.style.cursor="pointer"}}function iZ(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function QE(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?iZ(Object(t),!0).forEach(function(n){zL(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):iZ(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}class sZ extends LA{constructor(e,t,n){super(e,t,n),this.type="textPath",this.textWidth=0,this.textHeight=0,this.pathLength=-1,this.glyphInfo=null,this.letterSpacingCache=[],this.measuresCache=new Map([["",0]]);var i=this.getHrefAttribute().getDefinition();this.text=this.getTextFromNode(),this.dataArray=this.parsePathData(i)}getText(){return this.text}path(e){var{dataArray:t}=this;e&&e.beginPath(),t.forEach(n=>{var{type:i,points:s}=n;switch(i){case Pi.LINE_TO:e&&e.lineTo(s[0],s[1]);break;case Pi.MOVE_TO:e&&e.moveTo(s[0],s[1]);break;case Pi.CURVE_TO:e&&e.bezierCurveTo(s[0],s[1],s[2],s[3],s[4],s[5]);break;case Pi.QUAD_TO:e&&e.quadraticCurveTo(s[0],s[1],s[2],s[3]);break;case Pi.ARC:{var[a,o,h,f,_,x,T,I]=s,N=h>f?h:f,$=h>f?1:h/f,W=h>f?f/h:1;e&&(e.translate(a,o),e.rotate(T),e.scale($,W),e.arc(0,0,N,_,_+x,!!(1-I)),e.scale(1/$,1/W),e.rotate(-T),e.translate(-a,-o));break}case Pi.CLOSE_PATH:e&&e.closePath();break}})}renderChildren(e){this.setTextData(e),e.save();var t=this.parent.getStyle("text-decoration").getString(),n=this.getFontSize(),{glyphInfo:i}=this,s=e.fillStyle;t==="underline"&&e.beginPath(),i.forEach((a,o)=>{var{p0:h,p1:f,rotation:_,text:x}=a;e.save(),e.translate(h.x,h.y),e.rotate(_),e.fillStyle&&e.fillText(x,0,0),e.strokeStyle&&e.strokeText(x,0,0),e.restore(),t==="underline"&&(o===0&&e.moveTo(h.x,h.y+n/8),e.lineTo(f.x,f.y+n/5))}),t==="underline"&&(e.lineWidth=n/20,e.strokeStyle=s,e.stroke(),e.closePath()),e.restore()}getLetterSpacingAt(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.letterSpacingCache[e]||0}findSegmentToFitChar(e,t,n,i,s,a,o,h,f){var _=a,x=this.measureText(e,h);h===" "&&t==="justify"&&n<i&&(x+=(i-n)/s),f>-1&&(_+=this.getLetterSpacingAt(f));var T=this.textHeight/20,I=this.getEquidistantPointOnPath(_,T,0),N=this.getEquidistantPointOnPath(_+x,T,0),$={p0:I,p1:N},W=I&&N?Math.atan2(N.y-I.y,N.x-I.x):0;if(o){var Y=Math.cos(Math.PI/2+W)*o,ie=Math.cos(-W)*o;$.p0=QE(QE({},I),{},{x:I.x+Y,y:I.y+ie}),$.p1=QE(QE({},N),{},{x:N.x+Y,y:N.y+ie})}return _+=x,{offset:_,segment:$,rotation:W}}measureText(e,t){var{measuresCache:n}=this,i=t||this.getText();if(n.has(i))return n.get(i);var s=this.measureTargetText(e,i);return n.set(i,s),s}setTextData(e){if(!this.glyphInfo){var t=this.getText(),n=t.split(""),i=t.split(" ").length-1,s=this.parent.getAttribute("dx").split().map(fe=>fe.getPixels("x")),a=this.parent.getAttribute("dy").getPixels("y"),o=this.parent.getStyle("text-anchor").getString("start"),h=this.getStyle("letter-spacing"),f=this.parent.getStyle("letter-spacing"),_=0;!h.hasValue()||h.getValue()==="inherit"?_=f.getPixels():h.hasValue()&&h.getValue()!=="initial"&&h.getValue()!=="unset"&&(_=h.getPixels());var x=[],T=t.length;this.letterSpacingCache=x;for(var I=0;I<T;I++)x.push(typeof s[I]<"u"?s[I]:_);var N=x.reduce((fe,ve,be)=>be===0?0:fe+ve||0,0),$=this.measureText(e),W=Math.max($+N,0);this.textWidth=$,this.textHeight=this.getFontSize(),this.glyphInfo=[];var Y=this.getPathLength(),ie=this.getStyle("startOffset").getNumber(0)*Y,ce=0;(o==="middle"||o==="center")&&(ce=-W/2),(o==="end"||o==="right")&&(ce=-W),ce+=ie,n.forEach((fe,ve)=>{var{offset:be,segment:Qe,rotation:Ue}=this.findSegmentToFitChar(e,o,W,Y,i,ce,a,fe,ve);ce=be,!(!Qe.p0||!Qe.p1)&&this.glyphInfo.push({text:n[ve],p0:Qe.p0,p1:Qe.p1,rotation:Ue})})}}parsePathData(e){if(this.pathLength=-1,!e)return[];var t=[],{pathParser:n}=e;for(n.reset();!n.isEnd();){var{current:i}=n,s=i?i.x:0,a=i?i.y:0,o=n.next(),h=o.type,f=[];switch(o.type){case Pi.MOVE_TO:this.pathM(n,f);break;case Pi.LINE_TO:h=this.pathL(n,f);break;case Pi.HORIZ_LINE_TO:h=this.pathH(n,f);break;case Pi.VERT_LINE_TO:h=this.pathV(n,f);break;case Pi.CURVE_TO:this.pathC(n,f);break;case Pi.SMOOTH_CURVE_TO:h=this.pathS(n,f);break;case Pi.QUAD_TO:this.pathQ(n,f);break;case Pi.SMOOTH_QUAD_TO:h=this.pathT(n,f);break;case Pi.ARC:f=this.pathA(n);break;case Pi.CLOSE_PATH:qs.pathZ(n);break}o.type!==Pi.CLOSE_PATH?t.push({type:h,points:f,start:{x:s,y:a},pathLength:this.calcLength(s,a,h,f)}):t.push({type:Pi.CLOSE_PATH,points:[],pathLength:0})}return t}pathM(e,t){var{x:n,y:i}=qs.pathM(e).point;t.push(n,i)}pathL(e,t){var{x:n,y:i}=qs.pathL(e).point;return t.push(n,i),Pi.LINE_TO}pathH(e,t){var{x:n,y:i}=qs.pathH(e).point;return t.push(n,i),Pi.LINE_TO}pathV(e,t){var{x:n,y:i}=qs.pathV(e).point;return t.push(n,i),Pi.LINE_TO}pathC(e,t){var{point:n,controlPoint:i,currentPoint:s}=qs.pathC(e);t.push(n.x,n.y,i.x,i.y,s.x,s.y)}pathS(e,t){var{point:n,controlPoint:i,currentPoint:s}=qs.pathS(e);return t.push(n.x,n.y,i.x,i.y,s.x,s.y),Pi.CURVE_TO}pathQ(e,t){var{controlPoint:n,currentPoint:i}=qs.pathQ(e);t.push(n.x,n.y,i.x,i.y)}pathT(e,t){var{controlPoint:n,currentPoint:i}=qs.pathT(e);return t.push(n.x,n.y,i.x,i.y),Pi.QUAD_TO}pathA(e){var{rX:t,rY:n,sweepFlag:i,xAxisRotation:s,centp:a,a1:o,ad:h}=qs.pathA(e);return i===0&&h>0&&(h-=2*Math.PI),i===1&&h<0&&(h+=2*Math.PI),[a.x,a.y,t,n,o,h,s,i]}calcLength(e,t,n,i){var s=0,a=null,o=null,h=0;switch(n){case Pi.LINE_TO:return this.getLineLength(e,t,i[0],i[1]);case Pi.CURVE_TO:for(s=0,a=this.getPointOnCubicBezier(0,e,t,i[0],i[1],i[2],i[3],i[4],i[5]),h=.01;h<=1;h+=.01)o=this.getPointOnCubicBezier(h,e,t,i[0],i[1],i[2],i[3],i[4],i[5]),s+=this.getLineLength(a.x,a.y,o.x,o.y),a=o;return s;case Pi.QUAD_TO:for(s=0,a=this.getPointOnQuadraticBezier(0,e,t,i[0],i[1],i[2],i[3]),h=.01;h<=1;h+=.01)o=this.getPointOnQuadraticBezier(h,e,t,i[0],i[1],i[2],i[3]),s+=this.getLineLength(a.x,a.y,o.x,o.y),a=o;return s;case Pi.ARC:{s=0;var f=i[4],_=i[5],x=i[4]+_,T=Math.PI/180;if(Math.abs(f-x)<T&&(T=Math.abs(f-x)),a=this.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],f,0),_<0)for(h=f-T;h>x;h-=T)o=this.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],h,0),s+=this.getLineLength(a.x,a.y,o.x,o.y),a=o;else for(h=f+T;h<x;h+=T)o=this.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],h,0),s+=this.getLineLength(a.x,a.y,o.x,o.y),a=o;return o=this.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],x,0),s+=this.getLineLength(a.x,a.y,o.x,o.y),s}}return 0}getPointOnLine(e,t,n,i,s){var a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:t,o=arguments.length>6&&arguments[6]!==void 0?arguments[6]:n,h=(s-n)/(i-t+Tm),f=Math.sqrt(e*e/(1+h*h));i<t&&(f*=-1);var _=h*f,x=null;if(i===t)x={x:a,y:o+_};else if((o-n)/(a-t+Tm)===h)x={x:a+f,y:o+_};else{var T=0,I=0,N=this.getLineLength(t,n,i,s);if(N<Tm)return null;var $=(a-t)*(i-t)+(o-n)*(s-n);$/=N*N,T=t+$*(i-t),I=n+$*(s-n);var W=this.getLineLength(a,o,T,I),Y=Math.sqrt(e*e-W*W);f=Math.sqrt(Y*Y/(1+h*h)),i<t&&(f*=-1),_=h*f,x={x:T+f,y:I+_}}return x}getPointOnPath(e){var t=this.getPathLength(),n=0,i=null;if(e<-5e-5||e-5e-5>t)return null;var{dataArray:s}=this;for(var a of s){if(a&&(a.pathLength<5e-5||n+a.pathLength+5e-5<e)){n+=a.pathLength;continue}var o=e-n,h=0;switch(a.type){case Pi.LINE_TO:i=this.getPointOnLine(o,a.start.x,a.start.y,a.points[0],a.points[1],a.start.x,a.start.y);break;case Pi.ARC:{var f=a.points[4],_=a.points[5],x=a.points[4]+_;if(h=f+o/a.pathLength*_,_<0&&h<x||_>=0&&h>x)break;i=this.getPointOnEllipticalArc(a.points[0],a.points[1],a.points[2],a.points[3],h,a.points[6]);break}case Pi.CURVE_TO:h=o/a.pathLength,h>1&&(h=1),i=this.getPointOnCubicBezier(h,a.start.x,a.start.y,a.points[0],a.points[1],a.points[2],a.points[3],a.points[4],a.points[5]);break;case Pi.QUAD_TO:h=o/a.pathLength,h>1&&(h=1),i=this.getPointOnQuadraticBezier(h,a.start.x,a.start.y,a.points[0],a.points[1],a.points[2],a.points[3]);break}if(i)return i;break}return null}getLineLength(e,t,n,i){return Math.sqrt((n-e)*(n-e)+(i-t)*(i-t))}getPathLength(){return this.pathLength===-1&&(this.pathLength=this.dataArray.reduce((e,t)=>t.pathLength>0?e+t.pathLength:e,0)),this.pathLength}getPointOnCubicBezier(e,t,n,i,s,a,o,h,f){var _=h*nD(e)+a*iD(e)+i*sD(e)+t*oD(e),x=f*nD(e)+o*iD(e)+s*sD(e)+n*oD(e);return{x:_,y:x}}getPointOnQuadraticBezier(e,t,n,i,s,a,o){var h=a*aD(e)+i*lD(e)+t*cD(e),f=o*aD(e)+s*lD(e)+n*cD(e);return{x:h,y:f}}getPointOnEllipticalArc(e,t,n,i,s,a){var o=Math.cos(a),h=Math.sin(a),f={x:n*Math.cos(s),y:i*Math.sin(s)};return{x:e+(f.x*o-f.y*h),y:t+(f.x*h+f.y*o)}}buildEquidistantCache(e,t){var n=this.getPathLength(),i=t||.25,s=e||n/100;if(!this.equidistantCache||this.equidistantCache.step!==s||this.equidistantCache.precision!==i){this.equidistantCache={step:s,precision:i,points:[]};for(var a=0,o=0;o<=n;o+=i){var h=this.getPointOnPath(o),f=this.getPointOnPath(o+i);!h||!f||(a+=this.getLineLength(h.x,h.y,f.x,f.y),a>=s&&(this.equidistantCache.points.push({x:h.x,y:h.y,distance:o}),a-=s))}}}getEquidistantPointOnPath(e,t,n){if(this.buildEquidistantCache(t,n),e<0||e-this.getPathLength()>5e-5)return null;var i=Math.round(e/this.getPathLength()*(this.equidistantCache.points.length-1));return this.equidistantCache.points[i]||null}}var fWe=/^\s*data:(([^/,;]+\/[^/,;]+)(?:;([^,;=]+=[^,;=]+))?)?(?:;(base64))?,(.*)$/i;class oZ extends Gp{constructor(e,t,n){super(e,t,n),this.type="image",this.loaded=!1;var i=this.getHrefAttribute().getString();if(i){var s=i.endsWith(".svg")||/^\s*data:image\/svg\+xml/i.test(i);e.images.push(this),s?this.loadSvg(i):this.loadImage(i),this.isSvg=s}}loadImage(e){var t=this;return PA(function*(){try{var n=yield t.document.createImage(e);t.image=n}catch(i){console.error('Error while loading image "'.concat(e,'":'),i)}t.loaded=!0})()}loadSvg(e){var t=this;return PA(function*(){var n=fWe.exec(e);if(n){var i=n[5];n[4]==="base64"?t.image=atob(i):t.image=decodeURIComponent(i)}else try{var s=yield t.document.fetch(e),a=yield s.text();t.image=a}catch(o){console.error('Error while loading image "'.concat(e,'":'),o)}t.loaded=!0})()}renderChildren(e){var{document:t,image:n,loaded:i}=this,s=this.getAttribute("x").getPixels("x"),a=this.getAttribute("y").getPixels("y"),o=this.getStyle("width").getPixels("x"),h=this.getStyle("height").getPixels("y");if(!(!i||!n||!o||!h)){if(e.save(),e.translate(s,a),this.isSvg){var f=t.canvg.forkString(e,this.image,{ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0,ignoreClear:!0,offsetX:0,offsetY:0,scaleWidth:o,scaleHeight:h});f.document.documentElement.parent=this,f.render()}else{var _=this.image;t.setViewBox({ctx:e,aspectRatio:this.getAttribute("preserveAspectRatio").getString(),width:o,desiredWidth:_.width,height:h,desiredHeight:_.height}),this.loaded&&(typeof _.complete>"u"||_.complete)&&e.drawImage(_,0,0)}e.restore()}}getBoundingBox(){var e=this.getAttribute("x").getPixels("x"),t=this.getAttribute("y").getPixels("y"),n=this.getStyle("width").getPixels("x"),i=this.getStyle("height").getPixels("y");return new bd(e,t,e+n,t+i)}}class aZ extends Gp{constructor(){super(...arguments),this.type="symbol"}render(e){}}class lZ{constructor(e){this.document=e,this.loaded=!1,e.fonts.push(this)}load(e,t){var n=this;return PA(function*(){try{var{document:i}=n,s=yield i.canvg.parser.load(t),a=s.getElementsByTagName("font");Array.from(a).forEach(o=>{var h=i.createElement(o);i.definitions[e]=h})}catch(o){console.error('Error while loading font "'.concat(t,'":'),o)}n.loaded=!0})()}}class gD extends bo{constructor(e,t,n){super(e,t,n),this.type="style";var i=Cm(Array.from(t.childNodes).map(a=>a.textContent).join("").replace(/(\/\*([^*]|[\r\n]|(\*+([^*/]|[\r\n])))*\*+\/)|(^[\s]*\/\/.*)/gm,"").replace(/@import.*;/g,"")),s=i.split("}");s.forEach(a=>{var o=a.trim();if(o){var h=o.split("{"),f=h[0].split(","),_=h[1].split(";");f.forEach(x=>{var T=x.trim();if(T){var I=e.styles[T]||{};if(_.forEach(W=>{var Y=W.indexOf(":"),ie=W.substr(0,Y).trim(),ce=W.substr(Y+1,W.length-Y).trim();ie&&ce&&(I[ie]=new ii(e,ie,ce))}),e.styles[T]=I,e.stylesSpecificity[T]=MJ(T),T==="@font-face"){var N=I["font-family"].getString().replace(/"|'/g,""),$=I.src.getString().split(",");$.forEach(W=>{if(W.indexOf('format("svg")')>0){var Y=eD(W);Y&&new lZ(e).load(N,Y)}})}}})}})}}gD.parseExternalUrl=eD;class cZ extends Gp{constructor(){super(...arguments),this.type="use"}setContext(e){super.setContext(e);var t=this.getAttribute("x"),n=this.getAttribute("y");t.hasValue()&&e.translate(t.getPixels("x"),0),n.hasValue()&&e.translate(0,n.getPixels("y"))}path(e){var{element:t}=this;t&&t.path(e)}renderChildren(e){var{document:t,element:n}=this;if(n){var i=n;if(n.type==="symbol"&&(i=new _y(t,null),i.attributes.viewBox=new ii(t,"viewBox",n.getAttribute("viewBox").getString()),i.attributes.preserveAspectRatio=new ii(t,"preserveAspectRatio",n.getAttribute("preserveAspectRatio").getString()),i.attributes.overflow=new ii(t,"overflow",n.getAttribute("overflow").getString()),i.children=n.children,n.styles.opacity=new ii(t,"opacity",this.calculateOpacity())),i.type==="svg"){var s=this.getStyle("width",!1,!0),a=this.getStyle("height",!1,!0);s.hasValue()&&(i.attributes.width=new ii(t,"width",s.getString())),a.hasValue()&&(i.attributes.height=new ii(t,"height",a.getString()))}var o=i.parent;i.parent=this,i.render(e),i.parent=o}}getBoundingBox(e){var{element:t}=this;return t?t.getBoundingBox(e):null}elementTransform(){var{document:e,element:t}=this;return Vp.fromElement(e,t)}get element(){return this.cachedElement||(this.cachedElement=this.getHrefAttribute().getDefinition()),this.cachedElement}}function $E(r,e,t,n,i,s){return r[t*n*4+e*4+s]}function jE(r,e,t,n,i,s,a){r[t*n*4+e*4+s]=a}function Al(r,e,t){var n=r[e];return n*t}function DA(r,e,t,n){return e+Math.cos(r)*t+Math.sin(r)*n}class mD extends bo{constructor(e,t,n){super(e,t,n),this.type="feColorMatrix";var i=ch(this.getAttribute("values").getString());switch(this.getAttribute("type").getString("matrix")){case"saturate":{var s=i[0];i=[.213+.787*s,.715-.715*s,.072-.072*s,0,0,.213-.213*s,.715+.285*s,.072-.072*s,0,0,.213-.213*s,.715-.715*s,.072+.928*s,0,0,0,0,0,1,0,0,0,0,0,1];break}case"hueRotate":{var a=i[0]*Math.PI/180;i=[DA(a,.213,.787,-.213),DA(a,.715,-.715,-.715),DA(a,.072,-.072,.928),0,0,DA(a,.213,-.213,.143),DA(a,.715,.285,.14),DA(a,.072,-.072,-.283),0,0,DA(a,.213,-.213,-.787),DA(a,.715,-.715,.715),DA(a,.072,.928,.072),0,0,0,0,0,1,0,0,0,0,0,1];break}case"luminanceToAlpha":i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.2125,.7154,.0721,0,0,0,0,0,0,1];break}this.matrix=i,this.includeOpacity=this.getAttribute("includeOpacity").hasValue()}apply(e,t,n,i,s){for(var{includeOpacity:a,matrix:o}=this,h=e.getImageData(0,0,i,s),f=0;f<s;f++)for(var _=0;_<i;_++){var x=$E(h.data,_,f,i,s,0),T=$E(h.data,_,f,i,s,1),I=$E(h.data,_,f,i,s,2),N=$E(h.data,_,f,i,s,3),$=Al(o,0,x)+Al(o,1,T)+Al(o,2,I)+Al(o,3,N)+Al(o,4,1),W=Al(o,5,x)+Al(o,6,T)+Al(o,7,I)+Al(o,8,N)+Al(o,9,1),Y=Al(o,10,x)+Al(o,11,T)+Al(o,12,I)+Al(o,13,N)+Al(o,14,1),ie=Al(o,15,x)+Al(o,16,T)+Al(o,17,I)+Al(o,18,N)+Al(o,19,1);a&&($=0,W=0,Y=0,ie*=N/255),jE(h.data,_,f,i,s,0,$),jE(h.data,_,f,i,s,1,W),jE(h.data,_,f,i,s,2,Y),jE(h.data,_,f,i,s,3,ie)}e.clearRect(0,0,i,s),e.putImageData(h,0,0)}}class xv extends bo{constructor(){super(...arguments),this.type="mask"}apply(e,t){var{document:n}=this,i=this.getAttribute("x").getPixels("x"),s=this.getAttribute("y").getPixels("y"),a=this.getStyle("width").getPixels("x"),o=this.getStyle("height").getPixels("y");if(!a&&!o){var h=new bd;this.children.forEach(N=>{h.addBoundingBox(N.getBoundingBox(e))}),i=Math.floor(h.x1),s=Math.floor(h.y1),a=Math.floor(h.width),o=Math.floor(h.height)}var f=this.removeStyles(t,xv.ignoreStyles),_=n.createCanvas(i+a,s+o),x=_.getContext("2d");n.screen.setDefaults(x),this.renderChildren(x),new mD(n,{nodeType:1,childNodes:[],attributes:[{nodeName:"type",value:"luminanceToAlpha"},{nodeName:"includeOpacity",value:"true"}]}).apply(x,0,0,i+a,s+o);var T=n.createCanvas(i+a,s+o),I=T.getContext("2d");n.screen.setDefaults(I),t.render(I),I.globalCompositeOperation="destination-in",I.fillStyle=x.createPattern(_,"no-repeat"),I.fillRect(0,0,i+a,s+o),e.fillStyle=I.createPattern(T,"no-repeat"),e.fillRect(0,0,i+a,s+o),this.restoreStyles(t,f)}render(e){}}xv.ignoreStyles=["mask","transform","clip-path"];var uZ=()=>{};class hZ extends bo{constructor(){super(...arguments),this.type="clipPath"}apply(e){var{document:t}=this,n=Reflect.getPrototypeOf(e),{beginPath:i,closePath:s}=e;n&&(n.beginPath=uZ,n.closePath=uZ),Reflect.apply(i,e,[]),this.children.forEach(a=>{if(!(typeof a.path>"u")){var o=typeof a.elementTransform<"u"?a.elementTransform():null;o||(o=Vp.fromElement(t,a)),o&&o.apply(e),a.path(e),n&&(n.closePath=s),o&&o.unapply(e)}}),Reflect.apply(s,e,[]),e.clip(),n&&(n.beginPath=i,n.closePath=s)}render(e){}}class wv extends bo{constructor(){super(...arguments),this.type="filter"}apply(e,t){var{document:n,children:i}=this,s=t.getBoundingBox(e);if(s){var a=0,o=0;i.forEach(Y=>{var ie=Y.extraFilterDistance||0;a=Math.max(a,ie),o=Math.max(o,ie)});var h=Math.floor(s.width),f=Math.floor(s.height),_=h+2*a,x=f+2*o;if(!(_<1||x<1)){var T=Math.floor(s.x),I=Math.floor(s.y),N=this.removeStyles(t,wv.ignoreStyles),$=n.createCanvas(_,x),W=$.getContext("2d");n.screen.setDefaults(W),W.translate(-T+a,-I+o),t.render(W),i.forEach(Y=>{typeof Y.apply=="function"&&Y.apply(W,0,0,_,x)}),e.drawImage($,0,0,_,x,T-a,I-o,_,x),this.restoreStyles(t,N)}}}render(e){}}wv.ignoreStyles=["filter","transform","clip-path"];class dZ extends bo{constructor(e,t,n){super(e,t,n),this.type="feDropShadow",this.addStylesFromStyleDefinition()}apply(e,t,n,i,s){}}class fZ extends bo{constructor(){super(...arguments),this.type="feMorphology"}apply(e,t,n,i,s){}}class AZ extends bo{constructor(){super(...arguments),this.type="feComposite"}apply(e,t,n,i,s){}}class pZ extends bo{constructor(e,t,n){super(e,t,n),this.type="feGaussianBlur",this.blurRadius=Math.floor(this.getAttribute("stdDeviation").getNumber()),this.extraFilterDistance=this.blurRadius}apply(e,t,n,i,s){var{document:a,blurRadius:o}=this,h=a.window?a.window.document.body:null,f=e.canvas;f.id=a.getUniqueId(),h&&(f.style.display="none",h.appendChild(f)),$Ke(f,t,n,i,s,o),h&&h.removeChild(f)}}class gZ extends bo{constructor(){super(...arguments),this.type="title"}}class mZ extends bo{constructor(){super(...arguments),this.type="desc"}}var AWe={svg:_y,rect:fD,circle:HJ,ellipse:VJ,line:GJ,polyline:AD,polygon:QJ,path:qs,pattern:$J,marker:jJ,defs:qJ,linearGradient:KJ,radialGradient:WJ,stop:XJ,animate:GE,animateColor:JJ,animateTransform:ZJ,font:YJ,"font-face":eZ,"missing-glyph":tZ,glyph:dD,text:LA,tspan:vv,tref:rZ,a:nZ,textPath:sZ,image:oZ,g:VE,symbol:aZ,style:gD,use:cZ,mask:xv,clipPath:hZ,filter:wv,feDropShadow:dZ,feMorphology:fZ,feComposite:AZ,feColorMatrix:mD,feGaussianBlur:pZ,title:gZ,desc:mZ};function _Z(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function pWe(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?_Z(Object(t),!0).forEach(function(n){zL(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):_Z(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}function gWe(r,e){var t=document.createElement("canvas");return t.width=r,t.height=e,t}function mWe(r){return _D.apply(this,arguments)}function _D(){return _D=PA(function*(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,t=document.createElement("img");return e&&(t.crossOrigin="Anonymous"),new Promise((n,i)=>{t.onload=()=>{n(t)},t.onerror=(s,a,o,h,f)=>{i(f)},t.src=r})}),_D.apply(this,arguments)}class OA{constructor(e){var{rootEmSize:t=12,emSize:n=12,createCanvas:i=OA.createCanvas,createImage:s=OA.createImage,anonymousCrossOrigin:a}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.canvg=e,this.definitions={},this.styles={},this.stylesSpecificity={},this.images=[],this.fonts=[],this.emSizeStack=[],this.uniqueId=0,this.screen=e.screen,this.rootEmSize=t,this.emSize=n,this.createCanvas=i,this.createImage=this.bindCreateImage(s,a),this.screen.wait(this.isImagesLoaded.bind(this)),this.screen.wait(this.isFontsLoaded.bind(this))}bindCreateImage(e,t){return typeof t=="boolean"?(n,i)=>e(n,typeof i=="boolean"?i:t):e}get window(){return this.screen.window}get fetch(){return this.screen.fetch}get ctx(){return this.screen.ctx}get emSize(){var{emSizeStack:e}=this;return e[e.length-1]}set emSize(e){var{emSizeStack:t}=this;t.push(e)}popEmSize(){var{emSizeStack:e}=this;e.pop()}getUniqueId(){return"canvg".concat(++this.uniqueId)}isImagesLoaded(){return this.images.every(e=>e.loaded)}isFontsLoaded(){return this.fonts.every(e=>e.loaded)}createDocumentElement(e){var t=this.createElement(e.documentElement);return t.root=!0,t.addStylesFromStyleDefinition(),this.documentElement=t,t}createElement(e){var t=e.nodeName.replace(/^[^:]+:/,""),n=OA.elementTypes[t];return typeof n<"u"?new n(this,e):new zJ(this,e)}createTextNode(e){return new dWe(this,e)}setViewBox(e){this.screen.setViewBox(pWe({document:this},e))}}OA.createCanvas=gWe,OA.createImage=mWe,OA.elementTypes=AWe;function yZ(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function Sm(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?yZ(Object(t),!0).forEach(function(n){zL(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):yZ(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}class Im{constructor(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.parser=new HE(n),this.screen=new bv(e,n),this.options=n;var i=new OA(this,n),s=i.createDocumentElement(t);this.document=i,this.documentElement=s}static from(e,t){var n=arguments;return PA(function*(){var i=n.length>2&&n[2]!==void 0?n[2]:{},s=new HE(i),a=yield s.parse(t);return new Im(e,a,i)})()}static fromString(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=new HE(n),s=i.parseFromString(t);return new Im(e,s,n)}fork(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return Im.from(e,t,Sm(Sm({},this.options),n))}forkString(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return Im.fromString(e,t,Sm(Sm({},this.options),n))}ready(){return this.screen.ready()}isReady(){return this.screen.isReady()}render(){var e=arguments,t=this;return PA(function*(){var n=e.length>0&&e[0]!==void 0?e[0]:{};t.start(Sm({enableRedraw:!0,ignoreAnimation:!0,ignoreMouse:!0},n)),yield t.ready(),t.stop()})()}start(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{documentElement:t,screen:n,options:i}=this;n.start(t,Sm(Sm({enableRedraw:!0},i),e))}stop(){this.screen.stop()}resize(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:e,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;this.documentElement.resize(e,t,n)}}const _We=Object.freeze(Object.defineProperty({__proto__:null,AElement:nZ,AnimateColorElement:JJ,AnimateElement:GE,AnimateTransformElement:ZJ,BoundingBox:bd,CB1:nD,CB2:iD,CB3:sD,CB4:oD,Canvg:Im,CircleElement:HJ,ClipPathElement:hZ,DefsElement:qJ,DescElement:mZ,Document:OA,Element:bo,EllipseElement:VJ,FeColorMatrixElement:mD,FeCompositeElement:AZ,FeDropShadowElement:dZ,FeGaussianBlurElement:pZ,FeMorphologyElement:fZ,FilterElement:wv,Font:lu,FontElement:YJ,FontFaceElement:eZ,GElement:VE,GlyphElement:dD,GradientElement:pD,ImageElement:oZ,LineElement:GJ,LinearGradientElement:KJ,MarkerElement:jJ,MaskElement:xv,Matrix:uD,MissingGlyphElement:tZ,Mouse:FJ,PSEUDO_ZERO:Tm,Parser:HE,PathElement:qs,PathParser:Pi,PatternElement:$J,Point:xa,PolygonElement:QJ,PolylineElement:AD,Property:ii,QB1:aD,QB2:lD,QB3:cD,RadialGradientElement:WJ,RectElement:fD,RenderedElement:Gp,Rotate:OJ,SVGElement:_y,SVGFontLoader:lZ,Scale:kJ,Screen:bv,Skew:hD,SkewX:UJ,SkewY:NJ,StopElement:XJ,StyleElement:gD,SymbolElement:aZ,TRefElement:rZ,TSpanElement:vv,TextElement:LA,TextPathElement:sZ,TitleElement:gZ,Transform:Vp,Translate:DJ,UnknownElement:zJ,UseElement:cZ,ViewPort:PJ,compressSpaces:Cm,default:Im,getSelectorSpecificity:MJ,normalizeAttributeName:SJ,normalizeColor:IJ,parseExternalUrl:eD,presets:WKe,toNumbers:ch,trimLeft:EJ,trimRight:TJ,vectorMagnitude:tD,vectorsAngle:rD,vectorsRatio:zE},Symbol.toStringTag,{value:"Module"}));Wu.CompareMaps=xDe,Wu.Config=Ij,Wu.Map=gDe,Object.defineProperty(Wu,Symbol.toStringTag,{value:"Module"})});
