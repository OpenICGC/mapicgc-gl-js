(function(xl,sp){typeof exports=="object"&&typeof module<"u"?sp(exports):typeof define=="function"&&define.amd?define(["exports"],sp):(xl=typeof globalThis<"u"?globalThis:xl||self,sp(xl.mapicgcgl={}))})(this,function(xl){"use strict";function sp(r,t){for(var e=0;e<t.length;e++){const n=t[e];if(typeof n!="string"&&!Array.isArray(n)){for(const i in n)if(i!=="default"&&!(i in r)){const s=Object.getOwnPropertyDescriptor(n,i);s&&Object.defineProperty(r,i,s.get?s:{enumerable:!0,get:()=>n[i]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}var pd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function xm(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var sE={exports:{}};(function(r,t){(function(e,n){r.exports=n()})(pd,function(){var e,n,i;function s(o,h){if(!e)e=h;else if(!n)n=h;else{var f="var sharedChunk = {}; ("+e+")(sharedChunk); ("+n+")(sharedChunk);",g={};e(g),i=h(g),typeof window<"u"&&(i.workerUrl=window.URL.createObjectURL(new Blob([f],{type:"text/javascript"})))}}s(["exports"],function(o){function h(A,c,u,p){return new(u||(u=Promise))(function(_,x){function T(z){try{P(p.next(z))}catch(W){x(W)}}function L(z){try{P(p.throw(z))}catch(W){x(W)}}function P(z){var W;z.done?_(z.value):(W=z.value,W instanceof u?W:new u(function(Y){Y(W)})).then(T,L)}P((p=p.apply(A,c||[])).next())})}function f(A){return A&&A.__esModule&&Object.prototype.hasOwnProperty.call(A,"default")?A.default:A}typeof SuppressedError=="function"&&SuppressedError;var g=b;function b(A,c){this.x=A,this.y=c}b.prototype={clone:function(){return new b(this.x,this.y)},add:function(A){return this.clone()._add(A)},sub:function(A){return this.clone()._sub(A)},multByPoint:function(A){return this.clone()._multByPoint(A)},divByPoint:function(A){return this.clone()._divByPoint(A)},mult:function(A){return this.clone()._mult(A)},div:function(A){return this.clone()._div(A)},rotate:function(A){return this.clone()._rotate(A)},rotateAround:function(A,c){return this.clone()._rotateAround(A,c)},matMult:function(A){return this.clone()._matMult(A)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(A){return this.x===A.x&&this.y===A.y},dist:function(A){return Math.sqrt(this.distSqr(A))},distSqr:function(A){var c=A.x-this.x,u=A.y-this.y;return c*c+u*u},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(A){return Math.atan2(this.y-A.y,this.x-A.x)},angleWith:function(A){return this.angleWithSep(A.x,A.y)},angleWithSep:function(A,c){return Math.atan2(this.x*c-this.y*A,this.x*A+this.y*c)},_matMult:function(A){var c=A[2]*this.x+A[3]*this.y;return this.x=A[0]*this.x+A[1]*this.y,this.y=c,this},_add:function(A){return this.x+=A.x,this.y+=A.y,this},_sub:function(A){return this.x-=A.x,this.y-=A.y,this},_mult:function(A){return this.x*=A,this.y*=A,this},_div:function(A){return this.x/=A,this.y/=A,this},_multByPoint:function(A){return this.x*=A.x,this.y*=A.y,this},_divByPoint:function(A){return this.x/=A.x,this.y/=A.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var A=this.y;return this.y=this.x,this.x=-A,this},_rotate:function(A){var c=Math.cos(A),u=Math.sin(A),p=u*this.x+c*this.y;return this.x=c*this.x-u*this.y,this.y=p,this},_rotateAround:function(A,c){var u=Math.cos(A),p=Math.sin(A),_=c.y+p*(this.x-c.x)+u*(this.y-c.y);return this.x=c.x+u*(this.x-c.x)-p*(this.y-c.y),this.y=_,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},b.convert=function(A){return A instanceof b?A:Array.isArray(A)?new b(A[0],A[1]):A};var C=f(g),B=R;function R(A,c,u,p){this.cx=3*A,this.bx=3*(u-A)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*c,this.by=3*(p-c)-this.cy,this.ay=1-this.cy-this.by,this.p1x=A,this.p1y=c,this.p2x=u,this.p2y=p}R.prototype={sampleCurveX:function(A){return((this.ax*A+this.bx)*A+this.cx)*A},sampleCurveY:function(A){return((this.ay*A+this.by)*A+this.cy)*A},sampleCurveDerivativeX:function(A){return(3*this.ax*A+2*this.bx)*A+this.cx},solveCurveX:function(A,c){if(c===void 0&&(c=1e-6),A<0)return 0;if(A>1)return 1;for(var u=A,p=0;p<8;p++){var _=this.sampleCurveX(u)-A;if(Math.abs(_)<c)return u;var x=this.sampleCurveDerivativeX(u);if(Math.abs(x)<1e-6)break;u-=_/x}var T=0,L=1;for(u=A,p=0;p<20&&(_=this.sampleCurveX(u),!(Math.abs(_-A)<c));p++)A>_?T=u:L=u,u=.5*(L-T)+T;return u},solve:function(A,c){return this.sampleCurveY(this.solveCurveX(A,c))}};var D=f(B);let Q,k;function j(){return Q==null&&(Q=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Q}function et(){if(k==null&&(k=!1,j())){const c=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(c){for(let p=0;p<5*5;p++){const _=4*p;c.fillStyle=`rgb(${_},${_+1},${_+2})`,c.fillRect(p%5,Math.floor(p/5),1,1)}const u=c.getImageData(0,0,5,5).data;for(let p=0;p<5*5*4;p++)if(p%4!=3&&u[p]!==p){k=!0;break}}}return k||!1}function st(A,c,u,p){const _=new D(A,c,u,p);return function(x){return _.solve(x)}}const mt=st(.25,.1,.25,1);function pt(A,c,u){return Math.min(u,Math.max(c,A))}function yt(A,c,u){const p=u-c,_=((A-c)%p+p)%p+c;return _===c?u:_}function ft(A){for(var c=arguments.length,u=new Array(c>1?c-1:0),p=1;p<c;p++)u[p-1]=arguments[p];for(const _ of u)for(const x in _)A[x]=_[x];return A}let Dt=1;function It(A,c,u){const p={};for(const _ in A)p[_]=c.call(u||this,A[_],_,A);return p}function ut(A,c,u){const p={};for(const _ in A)c.call(u||this,A[_],_,A)&&(p[_]=A[_]);return p}function At(A){return Array.isArray(A)?A.map(At):typeof A=="object"&&A?It(A,At):A}const Bt={};function vt(A){Bt[A]||(typeof console<"u"&&console.warn(A),Bt[A]=!0)}function ne(A,c,u){return(u.y-A.y)*(c.x-A.x)>(c.y-A.y)*(u.x-A.x)}function ie(A){let c=0;for(let u,p,_=0,x=A.length,T=x-1;_<x;T=_++)u=A[_],p=A[T],c+=(p.x-u.x)*(u.y+p.y);return c}function ae(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}let te=null;function ce(A){return typeof ImageBitmap<"u"&&A instanceof ImageBitmap}const le="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Te(A,c,u,p,_){return h(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const x=new VideoFrame(A,{timestamp:0});try{const T=x==null?void 0:x.format;if(!T||!T.startsWith("BGR")&&!T.startsWith("RGB"))throw new Error(`Unrecognized format ${T}`);const L=T.startsWith("BGR"),P=new Uint8ClampedArray(p*_*4);if(yield x.copyTo(P,function(z,W,Y,it,lt){const ht=4*Math.max(-W,0),Et=(Math.max(0,Y)-Y)*it*4+ht,Mt=4*it,Gt=Math.max(0,W),ee=Math.max(0,Y);return{rect:{x:Gt,y:ee,width:Math.min(z.width,W+it)-Gt,height:Math.min(z.height,Y+lt)-ee},layout:[{offset:Et,stride:Mt}]}}(A,c,u,p,_)),L)for(let z=0;z<P.length;z+=4){const W=P[z];P[z]=P[z+2],P[z+2]=W}return P}finally{x.close()}})}let rt,wt,St,qt;const Jt={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(A){const c=requestAnimationFrame(A);return{cancel:()=>cancelAnimationFrame(c)}},getImageData(A){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return this.getImageCanvasContext(A).getImageData(-c,-c,A.width+2*c,A.height+2*c)},getImageCanvasContext(A){const c=window.document.createElement("canvas"),u=c.getContext("2d",{willReadFrequently:!0});if(!u)throw new Error("failed to create canvas 2d context");return c.width=A.width,c.height=A.height,u.drawImage(A,0,0,A.width,A.height),u},resolveURL:A=>(St||(St=document.createElement("a")),St.href=A,St.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(qt==null&&(qt=matchMedia("(prefers-reduced-motion: reduce)")),qt.matches)}},se={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};class Ae extends Error{constructor(c,u,p,_){super(`AJAXError: ${u} (${c}): ${p}`),this.status=c,this.statusText=u,this.url=p,this.body=_}}const oe=ae()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href,Ce=A=>se.REGISTERED_PROTOCOLS[A.substring(0,A.indexOf("://"))];function Pe(A,c){const u=new AbortController,p=new Request(A.url,{method:A.method||"GET",body:A.body,credentials:A.credentials,headers:A.headers,cache:A.cache,referrer:oe(),signal:u.signal});let _=!1,x=!1;return A.type==="json"&&p.headers.set("Accept","application/json"),x||fetch(p).then(T=>T.ok?(L=>{(A.type==="arrayBuffer"||A.type==="image"?L.arrayBuffer():A.type==="json"?L.json():L.text()).then(P=>{x||(_=!0,c(null,P,L.headers.get("Cache-Control"),L.headers.get("Expires")))}).catch(P=>{x||c(new Error(P.message))})})(T):T.blob().then(L=>c(new Ae(T.status,T.statusText,A.url,L)))).catch(T=>{T.code!==20&&c(new Error(T.message))}),{cancel:()=>{x=!0,_||u.abort()}}}const Ve=function(A,c){if(/:\/\//.test(A.url)&&!/^https?:|^file:/.test(A.url)){if(ae()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",A,c);if(!ae())return(Ce(A.url)||Pe)(A,c)}if(!(/^file:/.test(u=A.url)||/^file:/.test(oe())&&!/^\w+:/.test(u))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return Pe(A,c);if(ae()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",A,c,void 0,!0)}var u;return function(p,_){const x=new XMLHttpRequest;x.open(p.method||"GET",p.url,!0),p.type!=="arrayBuffer"&&p.type!=="image"||(x.responseType="arraybuffer");for(const T in p.headers)x.setRequestHeader(T,p.headers[T]);return p.type==="json"&&(x.responseType="text",x.setRequestHeader("Accept","application/json")),x.withCredentials=p.credentials==="include",x.onerror=()=>{_(new Error(x.statusText))},x.onload=()=>{if((x.status>=200&&x.status<300||x.status===0)&&x.response!==null){let T=x.response;if(p.type==="json")try{T=JSON.parse(x.response)}catch(L){return _(L)}_(null,T,x.getResponseHeader("Cache-Control"),x.getResponseHeader("Expires"))}else{const T=new Blob([x.response],{type:x.getResponseHeader("Content-Type")});_(new Ae(x.status,x.statusText,p.url,T))}},x.send(p.body),{cancel:()=>x.abort()}}(A,c)},Ke=function(A,c){return Ve(ft(A,{type:"arrayBuffer"}),c)};function rr(A){if(!A||A.indexOf("://")<=0||A.indexOf("data:image/")===0||A.indexOf("blob:")===0)return!0;const c=new URL(A),u=window.location;return c.protocol===u.protocol&&c.host===u.host}function _e(A,c,u){u[A]&&u[A].indexOf(c)!==-1||(u[A]=u[A]||[],u[A].push(c))}function Ut(A,c,u){if(u&&u[A]){const p=u[A].indexOf(c);p!==-1&&u[A].splice(p,1)}}class pr{constructor(c){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};ft(this,u),this.type=c}}class ir extends pr{constructor(c){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super("error",ft({error:c},u))}}class Se{on(c,u){return this._listeners=this._listeners||{},_e(c,u,this._listeners),this}off(c,u){return Ut(c,u,this._listeners),Ut(c,u,this._oneTimeListeners),this}once(c,u){return u?(this._oneTimeListeners=this._oneTimeListeners||{},_e(c,u,this._oneTimeListeners),this):new Promise(p=>this.once(c,p))}fire(c,u){typeof c=="string"&&(c=new pr(c,u||{}));const p=c.type;if(this.listens(p)){c.target=this;const _=this._listeners&&this._listeners[p]?this._listeners[p].slice():[];for(const L of _)L.call(this,c);const x=this._oneTimeListeners&&this._oneTimeListeners[p]?this._oneTimeListeners[p].slice():[];for(const L of x)Ut(p,L,this._oneTimeListeners),L.call(this,c);const T=this._eventedParent;T&&(ft(c,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),T.fire(c))}else c instanceof ir&&console.error(c.error);return this}listens(c){return this._listeners&&this._listeners[c]&&this._listeners[c].length>0||this._oneTimeListeners&&this._oneTimeListeners[c]&&this._oneTimeListeners[c].length>0||this._eventedParent&&this._eventedParent.listens(c)}setEventedParent(c,u){return this._eventedParent=c,this._eventedParentData=u,this}}var Kt={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Ie=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function ke(A,c){const u={};for(const p in A)p!=="ref"&&(u[p]=A[p]);return Ie.forEach(p=>{p in c&&(u[p]=c[p])}),u}function He(A,c){if(Array.isArray(A)){if(!Array.isArray(c)||A.length!==c.length)return!1;for(let u=0;u<A.length;u++)if(!He(A[u],c[u]))return!1;return!0}if(typeof A=="object"&&A!==null&&c!==null){if(typeof c!="object"||Object.keys(A).length!==Object.keys(c).length)return!1;for(const u in A)if(!He(A[u],c[u]))return!1;return!0}return A===c}const De={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function xr(A,c,u){u.push({command:De.addSource,args:[A,c[A]]})}function Pr(A,c,u){c.push({command:De.removeSource,args:[A]}),u[A]=!0}function Or(A,c,u,p){Pr(A,u,p),xr(A,c,u)}function nn(A,c,u){let p;for(p in A[u])if(Object.prototype.hasOwnProperty.call(A[u],p)&&p!=="data"&&!He(A[u][p],c[u][p]))return!1;for(p in c[u])if(Object.prototype.hasOwnProperty.call(c[u],p)&&p!=="data"&&!He(A[u][p],c[u][p]))return!1;return!0}function Br(A,c,u,p,_,x){let T;for(T in c=c||{},A=A||{})Object.prototype.hasOwnProperty.call(A,T)&&(He(A[T],c[T])||u.push({command:x,args:[p,T,c[T],_]}));for(T in c)Object.prototype.hasOwnProperty.call(c,T)&&!Object.prototype.hasOwnProperty.call(A,T)&&(He(A[T],c[T])||u.push({command:x,args:[p,T,c[T],_]}))}function Ur(A){return A.id}function je(A,c){return A[c.id]=c,A}class Ee{constructor(c,u,p,_){this.message=(c?`${c}: `:"")+p,_&&(this.identifier=_),u!=null&&u.__line__&&(this.line=u.__line__)}}function Nr(A){for(var c=arguments.length,u=new Array(c>1?c-1:0),p=1;p<c;p++)u[p-1]=arguments[p];for(const _ of u)for(const x in _)A[x]=_[x];return A}class Vr extends Error{constructor(c,u){super(u),this.message=u,this.key=c}}class qr{constructor(c){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.parent=c,this.bindings={};for(const[p,_]of u)this.bindings[p]=_}concat(c){return new qr(this,c)}get(c){if(this.bindings[c])return this.bindings[c];if(this.parent)return this.parent.get(c);throw new Error(`${c} not found in scope.`)}has(c){return!!this.bindings[c]||!!this.parent&&this.parent.has(c)}}const rn={kind:"null"},Fe={kind:"number"},Ze={kind:"string"},ur={kind:"boolean"},Jr={kind:"color"},Un={kind:"object"},qe={kind:"value"},sn={kind:"collator"},_t={kind:"formatted"},tt={kind:"padding"},at={kind:"resolvedImage"},gt={kind:"variableAnchorOffsetCollection"};function Tt(A,c){return{kind:"array",itemType:A,N:c}}function Ft(A){if(A.kind==="array"){const c=Ft(A.itemType);return typeof A.N=="number"?`array<${c}, ${A.N}>`:A.itemType.kind==="value"?"array":`array<${c}>`}return A.kind}const Ht=[rn,Fe,Ze,ur,Jr,_t,Un,Tt(qe),tt,at,gt];function Vt(A,c){if(c.kind==="error")return null;if(A.kind==="array"){if(c.kind==="array"&&(c.N===0&&c.itemType.kind==="value"||!Vt(A.itemType,c.itemType))&&(typeof A.N!="number"||A.N===c.N))return null}else{if(A.kind===c.kind)return null;if(A.kind==="value"){for(const u of Ht)if(!Vt(u,c))return null}}return`Expected ${Ft(A)} but found ${Ft(c)} instead.`}function Qt(A,c){return c.some(u=>u.kind===A.kind)}function $t(A,c){return c.some(u=>u==="null"?A===null:u==="array"?Array.isArray(A):u==="object"?A&&!Array.isArray(A)&&typeof A=="object":u===typeof A)}function fe(A,c){return A.kind==="array"&&c.kind==="array"?A.itemType.kind===c.itemType.kind&&typeof A.N=="number":A.kind===c.kind}const ye=.96422,we=.82521,hr=4/29,dr=6/29,Je=3*dr*dr,or=dr*dr*dr,_r=Math.PI/180,Rr=180/Math.PI;function jr(A){return(A%=360)<0&&(A+=360),A}function Fr(A){let[c,u,p,_]=A,x,T;const L=Qe((.2225045*(c=Rt(c))+.7168786*(u=Rt(u))+.0606169*(p=Rt(p)))/1);c===u&&u===p?x=T=L:(x=Qe((.4360747*c+.3850649*u+.1430804*p)/ye),T=Qe((.0139322*c+.0971045*u+.7141733*p)/we));const P=116*L-16;return[P<0?0:P,500*(x-L),200*(L-T),_]}function Rt(A){return A<=.04045?A/12.92:Math.pow((A+.055)/1.055,2.4)}function Qe(A){return A>or?Math.pow(A,1/3):A/Je+hr}function Be(A){let[c,u,p,_]=A,x=(c+16)/116,T=isNaN(u)?x:x+u/500,L=isNaN(p)?x:x-p/200;return x=1*Kr(x),T=ye*Kr(T),L=we*Kr(L),[Er(3.1338561*T-1.6168667*x-.4906146*L),Er(-.9787684*T+1.9161415*x+.033454*L),Er(.0719453*T-.2289914*x+1.4052427*L),_]}function Er(A){return(A=A<=.00304?12.92*A:1.055*Math.pow(A,1/2.4)-.055)<0?0:A>1?1:A}function Kr(A){return A>dr?A*A*A:Je*(A-hr)}function Sn(A){return parseInt(A.padEnd(2,A),16)/255}function Rn(A,c){return Vn(c?A/100:A,0,1)}function Vn(A,c,u){return Math.min(Math.max(c,A),u)}function kn(A){return!A.some(Number.isNaN)}const Qn={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Yr{constructor(c,u,p){let _=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1,x=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0;this.r=c,this.g=u,this.b=p,this.a=_,x||(this.r*=_,this.g*=_,this.b*=_,_||this.overwriteGetter("rgb",[c,u,p,_]))}static parse(c){if(c instanceof Yr)return c;if(typeof c!="string")return;const u=function(p){if((p=p.toLowerCase().trim())==="transparent")return[0,0,0,0];const _=Qn[p];if(_){const[T,L,P]=_;return[T/255,L/255,P/255,1]}if(p.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(p)){const T=p.length<6?1:2;let L=1;return[Sn(p.slice(L,L+=T)),Sn(p.slice(L,L+=T)),Sn(p.slice(L,L+=T)),Sn(p.slice(L,L+T)||"ff")]}if(p.startsWith("rgb")){const T=p.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(T){const[L,P,z,W,Y,it,lt,ht,Et,Mt,Gt,ee]=T,Xt=[W||" ",lt||" ",Mt].join("");if(Xt==="  "||Xt==="  /"||Xt===",,"||Xt===",,,"){const re=[z,it,Et].join(""),de=re==="%%%"?100:re===""?255:0;if(de){const xe=[Vn(+P/de,0,1),Vn(+Y/de,0,1),Vn(+ht/de,0,1),Gt?Rn(+Gt,ee):1];if(kn(xe))return xe}}return}}const x=p.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(x){const[T,L,P,z,W,Y,it,lt,ht]=x,Et=[P||" ",W||" ",it].join("");if(Et==="  "||Et==="  /"||Et===",,"||Et===",,,"){const Mt=[+L,Vn(+z,0,100),Vn(+Y,0,100),lt?Rn(+lt,ht):1];if(kn(Mt))return function(Gt){let[ee,Xt,re,de]=Gt;function xe(nr){const gr=(nr+ee/30)%12,er=Xt*Math.min(re,1-re);return re-er*Math.max(-1,Math.min(gr-3,9-gr,1))}return ee=jr(ee),Xt/=100,re/=100,[xe(0),xe(8),xe(4),de]}(Mt)}}}(c);return u?new Yr(...u,!1):void 0}get rgb(){const{r:c,g:u,b:p,a:_}=this,x=_||1/0;return this.overwriteGetter("rgb",[c/x,u/x,p/x,_])}get hcl(){return this.overwriteGetter("hcl",function(c){const[u,p,_,x]=Fr(c),T=Math.sqrt(p*p+_*_);return[Math.round(1e4*T)?jr(Math.atan2(_,p)*Rr):NaN,T,u,x]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Fr(this.rgb))}overwriteGetter(c,u){return Object.defineProperty(this,c,{value:u}),u}toString(){const[c,u,p,_]=this.rgb;return`rgba(${[c,u,p].map(x=>Math.round(255*x)).join(",")},${_})`}}Yr.black=new Yr(0,0,0,1),Yr.white=new Yr(1,1,1,1),Yr.transparent=new Yr(0,0,0,0),Yr.red=new Yr(1,0,0,1);class Xs{constructor(c,u,p){this.sensitivity=c?u?"variant":"case":u?"accent":"base",this.locale=p,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(c,u){return this.collator.compare(c,u)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class ts{constructor(c,u,p,_,x){this.text=c,this.image=u,this.scale=p,this.fontStack=_,this.textColor=x}}class Dn{constructor(c){this.sections=c}static fromString(c){return new Dn([new ts(c,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(c=>c.text.length!==0||c.image&&c.image.name.length!==0)}static factory(c){return c instanceof Dn?c:Dn.fromString(c)}toString(){return this.sections.length===0?"":this.sections.map(c=>c.text).join("")}}class Gi{constructor(c){this.values=c.slice()}static parse(c){if(c instanceof Gi)return c;if(typeof c=="number")return new Gi([c,c,c,c]);if(Array.isArray(c)&&!(c.length<1||c.length>4)){for(const u of c)if(typeof u!="number")return;switch(c.length){case 1:c=[c[0],c[0],c[0],c[0]];break;case 2:c=[c[0],c[1],c[0],c[1]];break;case 3:c=[c[0],c[1],c[2],c[1]]}return new Gi(c)}}toString(){return JSON.stringify(this.values)}}const za=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Ii{constructor(c){this.values=c.slice()}static parse(c){if(c instanceof Ii)return c;if(Array.isArray(c)&&!(c.length<1)&&c.length%2==0){for(let u=0;u<c.length;u+=2){const p=c[u],_=c[u+1];if(typeof p!="string"||!za.has(p)||!Array.isArray(_)||_.length!==2||typeof _[0]!="number"||typeof _[1]!="number")return}return new Ii(c)}}toString(){return JSON.stringify(this.values)}}class kr{constructor(c){this.name=c.name,this.available=c.available}toString(){return this.name}static fromString(c){return c?new kr({name:c,available:!1}):null}}function Bo(A,c,u,p){return typeof A=="number"&&A>=0&&A<=255&&typeof c=="number"&&c>=0&&c<=255&&typeof u=="number"&&u>=0&&u<=255?p===void 0||typeof p=="number"&&p>=0&&p<=1?null:`Invalid rgba value [${[A,c,u,p].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof p=="number"?[A,c,u,p]:[A,c,u]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Js(A){if(A===null||typeof A=="string"||typeof A=="boolean"||typeof A=="number"||A instanceof Yr||A instanceof Xs||A instanceof Dn||A instanceof Gi||A instanceof Ii||A instanceof kr)return!0;if(Array.isArray(A)){for(const c of A)if(!Js(c))return!1;return!0}if(typeof A=="object"){for(const c in A)if(!Js(A[c]))return!1;return!0}return!1}function Tn(A){if(A===null)return rn;if(typeof A=="string")return Ze;if(typeof A=="boolean")return ur;if(typeof A=="number")return Fe;if(A instanceof Yr)return Jr;if(A instanceof Xs)return sn;if(A instanceof Dn)return _t;if(A instanceof Gi)return tt;if(A instanceof Ii)return gt;if(A instanceof kr)return at;if(Array.isArray(A)){const c=A.length;let u;for(const p of A){const _=Tn(p);if(u){if(u===_)continue;u=qe;break}u=_}return Tt(u||qe,c)}return Un}function on(A){const c=typeof A;return A===null?"":c==="string"||c==="number"||c==="boolean"?String(A):A instanceof Yr||A instanceof Dn||A instanceof Gi||A instanceof Ii||A instanceof kr?A.toString():JSON.stringify(A)}class Ys{constructor(c,u){this.type=c,this.value=u}static parse(c,u){if(c.length!==2)return u.error(`'literal' expression requires exactly one argument, but found ${c.length-1} instead.`);if(!Js(c[1]))return u.error("invalid value");const p=c[1];let _=Tn(p);const x=u.expectedType;return _.kind!=="array"||_.N!==0||!x||x.kind!=="array"||typeof x.N=="number"&&x.N!==0||(_=x),new Ys(_,p)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class An{constructor(c){this.name="ExpressionEvaluationError",this.message=c}toJSON(){return this.message}}const Li={string:Ze,number:Fe,boolean:ur,object:Un};class jn{constructor(c,u){this.type=c,this.args=u}static parse(c,u){if(c.length<2)return u.error("Expected at least one argument.");let p,_=1;const x=c[0];if(x==="array"){let L,P;if(c.length>2){const z=c[1];if(typeof z!="string"||!(z in Li)||z==="object")return u.error('The item type argument of "array" must be one of string, number, boolean',1);L=Li[z],_++}else L=qe;if(c.length>3){if(c[2]!==null&&(typeof c[2]!="number"||c[2]<0||c[2]!==Math.floor(c[2])))return u.error('The length argument to "array" must be a positive integer literal',2);P=c[2],_++}p=Tt(L,P)}else{if(!Li[x])throw new Error(`Types doesn't contain name = ${x}`);p=Li[x]}const T=[];for(;_<c.length;_++){const L=u.parse(c[_],_,qe);if(!L)return null;T.push(L)}return new jn(p,T)}evaluate(c){for(let u=0;u<this.args.length;u++){const p=this.args[u].evaluate(c);if(!Vt(this.type,Tn(p)))return p;if(u===this.args.length-1)throw new An(`Expected value to be of type ${Ft(this.type)}, but found ${Ft(Tn(p))} instead.`)}throw new Error}eachChild(c){this.args.forEach(c)}outputDefined(){return this.args.every(c=>c.outputDefined())}}const fa={"to-boolean":ur,"to-color":Jr,"to-number":Fe,"to-string":Ze};class Cs{constructor(c,u){this.type=c,this.args=u}static parse(c,u){if(c.length<2)return u.error("Expected at least one argument.");const p=c[0];if(!fa[p])throw new Error(`Can't parse ${p} as it is not part of the known types`);if((p==="to-boolean"||p==="to-string")&&c.length!==2)return u.error("Expected one argument.");const _=fa[p],x=[];for(let T=1;T<c.length;T++){const L=u.parse(c[T],T,qe);if(!L)return null;x.push(L)}return new Cs(_,x)}evaluate(c){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(c);case"color":{let u,p;for(const _ of this.args){if(u=_.evaluate(c),p=null,u instanceof Yr)return u;if(typeof u=="string"){const x=c.parseColor(u);if(x)return x}else if(Array.isArray(u)&&(p=u.length<3||u.length>4?`Invalid rbga value ${JSON.stringify(u)}: expected an array containing either three or four numeric values.`:Bo(u[0],u[1],u[2],u[3]),!p))return new Yr(u[0]/255,u[1]/255,u[2]/255,u[3])}throw new An(p||`Could not parse color from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"padding":{let u;for(const p of this.args){u=p.evaluate(c);const _=Gi.parse(u);if(_)return _}throw new An(`Could not parse padding from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"variableAnchorOffsetCollection":{let u;for(const p of this.args){u=p.evaluate(c);const _=Ii.parse(u);if(_)return _}throw new An(`Could not parse variableAnchorOffsetCollection from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"number":{let u=null;for(const p of this.args){if(u=p.evaluate(c),u===null)return 0;const _=Number(u);if(!isNaN(_))return _}throw new An(`Could not convert ${JSON.stringify(u)} to number.`)}case"formatted":return Dn.fromString(on(this.args[0].evaluate(c)));case"resolvedImage":return kr.fromString(on(this.args[0].evaluate(c)));default:return on(this.args[0].evaluate(c))}}eachChild(c){this.args.forEach(c)}outputDefined(){return this.args.every(c=>c.outputDefined())}}const Jc=["Unknown","Point","LineString","Polygon"];class hc{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Jc[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(c){let u=this._parseColorCache[c];return u||(u=this._parseColorCache[c]=Yr.parse(c)),u}}class dc{constructor(c,u){let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],_=arguments.length>3?arguments[3]:void 0,x=arguments.length>4&&arguments[4]!==void 0?arguments[4]:new qr,T=arguments.length>5&&arguments[5]!==void 0?arguments[5]:[];this.registry=c,this.path=p,this.key=p.map(L=>`[${L}]`).join(""),this.scope=x,this.errors=T,this.expectedType=_,this._isConstant=u}parse(c,u,p,_){let x=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};return u?this.concat(u,p,_)._parse(c,x):this._parse(c,x)}_parse(c,u){function p(_,x,T){return T==="assert"?new jn(x,[_]):T==="coerce"?new Cs(x,[_]):_}if(c!==null&&typeof c!="string"&&typeof c!="boolean"&&typeof c!="number"||(c=["literal",c]),Array.isArray(c)){if(c.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const _=c[0];if(typeof _!="string")return this.error(`Expression name must be a string, but found ${typeof _} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const x=this.registry[_];if(x){let T=x.parse(c,this);if(!T)return null;if(this.expectedType){const L=this.expectedType,P=T.type;if(L.kind!=="string"&&L.kind!=="number"&&L.kind!=="boolean"&&L.kind!=="object"&&L.kind!=="array"||P.kind!=="value")if(L.kind!=="color"&&L.kind!=="formatted"&&L.kind!=="resolvedImage"||P.kind!=="value"&&P.kind!=="string")if(L.kind!=="padding"||P.kind!=="value"&&P.kind!=="number"&&P.kind!=="array")if(L.kind!=="variableAnchorOffsetCollection"||P.kind!=="value"&&P.kind!=="array"){if(this.checkSubtype(L,P))return null}else T=p(T,L,u.typeAnnotation||"coerce");else T=p(T,L,u.typeAnnotation||"coerce");else T=p(T,L,u.typeAnnotation||"coerce");else T=p(T,L,u.typeAnnotation||"assert")}if(!(T instanceof Ys)&&T.type.kind!=="resolvedImage"&&this._isConstant(T)){const L=new hc;try{T=new Ys(T.type,T.evaluate(L))}catch(P){return this.error(P.message),null}}return T}return this.error(`Unknown expression "${_}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(c===void 0?"'undefined' value invalid. Use null instead.":typeof c=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof c} instead.`)}concat(c,u,p){const _=typeof c=="number"?this.path.concat(c):this.path,x=p?this.scope.concat(p):this.scope;return new dc(this.registry,this._isConstant,_,u||null,x,this.errors)}error(c){for(var u=arguments.length,p=new Array(u>1?u-1:0),_=1;_<u;_++)p[_-1]=arguments[_];const x=`${this.key}${p.map(T=>`[${T}]`).join("")}`;this.errors.push(new Vr(x,c))}checkSubtype(c,u){const p=Vt(c,u);return p&&this.error(p),p}}class dt{constructor(c,u,p){this.type=sn,this.locale=p,this.caseSensitive=c,this.diacriticSensitive=u}static parse(c,u){if(c.length!==2)return u.error("Expected one argument.");const p=c[1];if(typeof p!="object"||Array.isArray(p))return u.error("Collator options argument must be an object.");const _=u.parse(p["case-sensitive"]!==void 0&&p["case-sensitive"],1,ur);if(!_)return null;const x=u.parse(p["diacritic-sensitive"]!==void 0&&p["diacritic-sensitive"],1,ur);if(!x)return null;let T=null;return p.locale&&(T=u.parse(p.locale,1,Ze),!T)?null:new dt(_,x,T)}evaluate(c){return new Xs(this.caseSensitive.evaluate(c),this.diacriticSensitive.evaluate(c),this.locale?this.locale.evaluate(c):null)}eachChild(c){c(this.caseSensitive),c(this.diacriticSensitive),this.locale&&c(this.locale)}outputDefined(){return!1}}const bt=8192;function jt(A,c){A[0]=Math.min(A[0],c[0]),A[1]=Math.min(A[1],c[1]),A[2]=Math.max(A[2],c[0]),A[3]=Math.max(A[3],c[1])}function pe(A,c){return!(A[0]<=c[0]||A[2]>=c[2]||A[1]<=c[1]||A[3]>=c[3])}function Ue(A,c){const u=(180+A[0])/360,p=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+A[1]*Math.PI/360)))/360,_=Math.pow(2,c.z);return[Math.round(u*_*bt),Math.round(p*_*bt)]}function cr(A,c,u){const p=A[0]-c[0],_=A[1]-c[1],x=A[0]-u[0],T=A[1]-u[1];return p*T-x*_==0&&p*x<=0&&_*T<=0}function Qr(A,c){let u=!1;for(let T=0,L=c.length;T<L;T++){const P=c[T];for(let z=0,W=P.length;z<W-1;z++){if(cr(A,P[z],P[z+1]))return!1;(_=P[z])[1]>(p=A)[1]!=(x=P[z+1])[1]>p[1]&&p[0]<(x[0]-_[0])*(p[1]-_[1])/(x[1]-_[1])+_[0]&&(u=!u)}}var p,_,x;return u}function qn(A,c){for(let u=0;u<c.length;u++)if(Qr(A,c[u]))return!0;return!1}function ti(A,c,u,p){const _=p[0]-u[0],x=p[1]-u[1],T=(A[0]-u[0])*x-_*(A[1]-u[1]),L=(c[0]-u[0])*x-_*(c[1]-u[1]);return T>0&&L<0||T<0&&L>0}function Bi(A,c,u){for(const z of u)for(let W=0;W<z.length-1;++W)if((L=[(T=z[W+1])[0]-(x=z[W])[0],T[1]-x[1]])[0]*(P=[(_=c)[0]-(p=A)[0],_[1]-p[1]])[1]-L[1]*P[0]!=0&&ti(p,_,x,T)&&ti(x,T,p,_))return!0;var p,_,x,T,L,P;return!1}function zn(A,c){for(let u=0;u<A.length;++u)if(!Qr(A[u],c))return!1;for(let u=0;u<A.length-1;++u)if(Bi(A[u],A[u+1],c))return!1;return!0}function Vu(A,c){for(let u=0;u<c.length;u++)if(zn(A,c[u]))return!0;return!1}function Yc(A,c,u){const p=[];for(let _=0;_<A.length;_++){const x=[];for(let T=0;T<A[_].length;T++){const L=Ue(A[_][T],u);jt(c,L),x.push(L)}p.push(x)}return p}function $r(A,c,u){const p=[];for(let _=0;_<A.length;_++){const x=Yc(A[_],c,u);p.push(x)}return p}function ju(A,c,u,p){if(A[0]<u[0]||A[0]>u[2]){const _=.5*p;let x=A[0]-u[0]>_?-p:u[0]-A[0]>_?p:0;x===0&&(x=A[0]-u[2]>_?-p:u[2]-A[0]>_?p:0),A[0]+=x}jt(c,A)}function HA(A,c,u,p){const _=Math.pow(2,p.z)*bt,x=[p.x*bt,p.y*bt],T=[];for(const L of A)for(const P of L){const z=[P.x+x[0],P.y+x[1]];ju(z,c,u,_),T.push(z)}return T}function Co(A,c,u,p){const _=Math.pow(2,p.z)*bt,x=[p.x*bt,p.y*bt],T=[];for(const P of A){const z=[];for(const W of P){const Y=[W.x+x[0],W.y+x[1]];jt(c,Y),z.push(Y)}T.push(z)}if(c[2]-c[0]<=_/2){(L=c)[0]=L[1]=1/0,L[2]=L[3]=-1/0;for(const P of T)for(const z of P)ju(z,c,u,_)}var L;return T}class pa{constructor(c,u){this.type=ur,this.geojson=c,this.geometries=u}static parse(c,u){if(c.length!==2)return u.error(`'within' expression requires exactly one argument, but found ${c.length-1} instead.`);if(Js(c[1])){const p=c[1];if(p.type==="FeatureCollection")for(let _=0;_<p.features.length;++_){const x=p.features[_].geometry.type;if(x==="Polygon"||x==="MultiPolygon")return new pa(p,p.features[_].geometry)}else if(p.type==="Feature"){const _=p.geometry.type;if(_==="Polygon"||_==="MultiPolygon")return new pa(p,p.geometry)}else if(p.type==="Polygon"||p.type==="MultiPolygon")return new pa(p,p)}return u.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(c){if(c.geometry()!=null&&c.canonicalID()!=null){if(c.geometryType()==="Point")return function(u,p){const _=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],T=u.canonicalID();if(p.type==="Polygon"){const L=Yc(p.coordinates,x,T),P=HA(u.geometry(),_,x,T);if(!pe(_,x))return!1;for(const z of P)if(!Qr(z,L))return!1}if(p.type==="MultiPolygon"){const L=$r(p.coordinates,x,T),P=HA(u.geometry(),_,x,T);if(!pe(_,x))return!1;for(const z of P)if(!qn(z,L))return!1}return!0}(c,this.geometries);if(c.geometryType()==="LineString")return function(u,p){const _=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],T=u.canonicalID();if(p.type==="Polygon"){const L=Yc(p.coordinates,x,T),P=Co(u.geometry(),_,x,T);if(!pe(_,x))return!1;for(const z of P)if(!zn(z,L))return!1}if(p.type==="MultiPolygon"){const L=$r(p.coordinates,x,T),P=Co(u.geometry(),_,x,T);if(!pe(_,x))return!1;for(const z of P)if(!Vu(z,L))return!1}return!0}(c,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class Zc{constructor(c,u){this.type=u.type,this.name=c,this.boundExpression=u}static parse(c,u){if(c.length!==2||typeof c[1]!="string")return u.error("'var' expression requires exactly one string literal argument.");const p=c[1];return u.scope.has(p)?new Zc(p,u.scope.get(p)):u.error(`Unknown variable "${p}". Make sure "${p}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(c){return this.boundExpression.evaluate(c)}eachChild(){}outputDefined(){return!1}}class es{constructor(c,u,p,_){this.name=c,this.type=u,this._evaluate=p,this.args=_}evaluate(c){return this._evaluate(c,this.args)}eachChild(c){this.args.forEach(c)}outputDefined(){return!1}static parse(c,u){const p=c[0],_=es.definitions[p];if(!_)return u.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0);const x=Array.isArray(_)?_[0]:_.type,T=Array.isArray(_)?[[_[1],_[2]]]:_.overloads,L=T.filter(z=>{let[W]=z;return!Array.isArray(W)||W.length===c.length-1});let P=null;for(const[z,W]of L){P=new dc(u.registry,fc,u.path,null,u.scope);const Y=[];let it=!1;for(let lt=1;lt<c.length;lt++){const ht=c[lt],Et=Array.isArray(z)?z[lt-1]:z.type,Mt=P.parse(ht,1+Y.length,Et);if(!Mt){it=!0;break}Y.push(Mt)}if(!it)if(Array.isArray(z)&&z.length!==Y.length)P.error(`Expected ${z.length} arguments, but found ${Y.length} instead.`);else{for(let lt=0;lt<Y.length;lt++){const ht=Array.isArray(z)?z[lt]:z.type,Et=Y[lt];P.concat(lt+1).checkSubtype(ht,Et.type)}if(P.errors.length===0)return new es(p,x,W,Y)}}if(L.length===1)u.errors.push(...P.errors);else{const z=(L.length?L:T).map(Y=>{let[it]=Y;return lt=it,Array.isArray(lt)?`(${lt.map(Ft).join(", ")})`:`(${Ft(lt.type)}...)`;var lt}).join(" | "),W=[];for(let Y=1;Y<c.length;Y++){const it=u.parse(c[Y],1+W.length);if(!it)return null;W.push(Ft(it.type))}u.error(`Expected arguments of type ${z}, but found (${W.join(", ")}) instead.`)}return null}static register(c,u){es.definitions=u;for(const p in u)c[p]=es}}function fc(A){if(A instanceof Zc)return fc(A.boundExpression);if(A instanceof es&&A.name==="error"||A instanceof dt||A instanceof pa)return!1;const c=A instanceof Cs||A instanceof jn;let u=!0;return A.eachChild(p=>{u=c?u&&fc(p):u&&p instanceof Ys}),!!u&&ql(A)&&Kl(A,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function ql(A){if(A instanceof es&&(A.name==="get"&&A.args.length===1||A.name==="feature-state"||A.name==="has"&&A.args.length===1||A.name==="properties"||A.name==="geometry-type"||A.name==="id"||/^filter-/.test(A.name))||A instanceof pa)return!1;let c=!0;return A.eachChild(u=>{c&&!ql(u)&&(c=!1)}),c}function tl(A){if(A instanceof es&&A.name==="feature-state")return!1;let c=!0;return A.eachChild(u=>{c&&!tl(u)&&(c=!1)}),c}function Kl(A,c){if(A instanceof es&&c.indexOf(A.name)>=0)return!1;let u=!0;return A.eachChild(p=>{u&&!Kl(p,c)&&(u=!1)}),u}function ga(A,c){const u=A.length-1;let p,_,x=0,T=u,L=0;for(;x<=T;)if(L=Math.floor((x+T)/2),p=A[L],_=A[L+1],p<=c){if(L===u||c<_)return L;x=L+1}else{if(!(p>c))throw new An("Input is not a number.");T=L-1}return 0}class Us{constructor(c,u,p){this.type=c,this.input=u,this.labels=[],this.outputs=[];for(const[_,x]of p)this.labels.push(_),this.outputs.push(x)}static parse(c,u){if(c.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${c.length-1}.`);if((c.length-1)%2!=0)return u.error("Expected an even number of arguments.");const p=u.parse(c[1],1,Fe);if(!p)return null;const _=[];let x=null;u.expectedType&&u.expectedType.kind!=="value"&&(x=u.expectedType);for(let T=1;T<c.length;T+=2){const L=T===1?-1/0:c[T],P=c[T+1],z=T,W=T+1;if(typeof L!="number")return u.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',z);if(_.length&&_[_.length-1][0]>=L)return u.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',z);const Y=u.parse(P,W,x);if(!Y)return null;x=x||Y.type,_.push([L,Y])}return new Us(x,p,_)}evaluate(c){const u=this.labels,p=this.outputs;if(u.length===1)return p[0].evaluate(c);const _=this.input.evaluate(c);if(_<=u[0])return p[0].evaluate(c);const x=u.length;return _>=u[x-1]?p[x-1].evaluate(c):p[ga(u,_)].evaluate(c)}eachChild(c){c(this.input);for(const u of this.outputs)c(u)}outputDefined(){return this.outputs.every(c=>c.outputDefined())}}function Zr(A,c,u){return A+u*(c-A)}function $l(A,c,u){return A.map((p,_)=>Zr(p,c[_],u))}const Fi={number:Zr,color:function(A,c,u){switch(arguments.length>3&&arguments[3]!==void 0?arguments[3]:"rgb"){case"rgb":{const[_,x,T,L]=$l(A.rgb,c.rgb,u);return new Yr(_,x,T,L,!1)}case"hcl":{const[_,x,T,L]=A.hcl,[P,z,W,Y]=c.hcl;let it,lt;if(isNaN(_)||isNaN(P))isNaN(_)?isNaN(P)?it=NaN:(it=P,T!==1&&T!==0||(lt=z)):(it=_,W!==1&&W!==0||(lt=x));else{let ee=P-_;P>_&&ee>180?ee-=360:P<_&&_-P>180&&(ee+=360),it=_+u*ee}const[ht,Et,Mt,Gt]=function(ee){let[Xt,re,de,xe]=ee;return Xt=isNaN(Xt)?0:Xt*_r,Be([de,Math.cos(Xt)*re,Math.sin(Xt)*re,xe])}([it,lt??Zr(x,z,u),Zr(T,W,u),Zr(L,Y,u)]);return new Yr(ht,Et,Mt,Gt,!1)}case"lab":{const[_,x,T,L]=Be($l(A.lab,c.lab,u));return new Yr(_,x,T,L,!1)}}},array:$l,padding:function(A,c,u){return new Gi($l(A.values,c.values,u))},variableAnchorOffsetCollection:function(A,c,u){const p=A.values,_=c.values;if(p.length!==_.length)throw new An(`Cannot interpolate values of different length. from: ${A.toString()}, to: ${c.toString()}`);const x=[];for(let T=0;T<p.length;T+=2){if(p[T]!==_[T])throw new An(`Cannot interpolate values containing mismatched anchors. from[${T}]: ${p[T]}, to[${T}]: ${_[T]}`);x.push(p[T]);const[L,P]=p[T+1],[z,W]=_[T+1];x.push([Zr(L,z,u),Zr(P,W,u)])}return new Ii(x)}};class rs{constructor(c,u,p,_,x){this.type=c,this.operator=u,this.interpolation=p,this.input=_,this.labels=[],this.outputs=[];for(const[T,L]of x)this.labels.push(T),this.outputs.push(L)}static interpolationFactor(c,u,p,_){let x=0;if(c.name==="exponential")x=pc(u,c.base,p,_);else if(c.name==="linear")x=pc(u,1,p,_);else if(c.name==="cubic-bezier"){const T=c.controlPoints;x=new D(T[0],T[1],T[2],T[3]).solve(pc(u,1,p,_))}return x}static parse(c,u){let[p,_,x,...T]=c;if(!Array.isArray(_)||_.length===0)return u.error("Expected an interpolation type expression.",1);if(_[0]==="linear")_={name:"linear"};else if(_[0]==="exponential"){const z=_[1];if(typeof z!="number")return u.error("Exponential interpolation requires a numeric base.",1,1);_={name:"exponential",base:z}}else{if(_[0]!=="cubic-bezier")return u.error(`Unknown interpolation type ${String(_[0])}`,1,0);{const z=_.slice(1);if(z.length!==4||z.some(W=>typeof W!="number"||W<0||W>1))return u.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);_={name:"cubic-bezier",controlPoints:z}}}if(c.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${c.length-1}.`);if((c.length-1)%2!=0)return u.error("Expected an even number of arguments.");if(x=u.parse(x,2,Fe),!x)return null;const L=[];let P=null;p==="interpolate-hcl"||p==="interpolate-lab"?P=Jr:u.expectedType&&u.expectedType.kind!=="value"&&(P=u.expectedType);for(let z=0;z<T.length;z+=2){const W=T[z],Y=T[z+1],it=z+3,lt=z+4;if(typeof W!="number")return u.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',it);if(L.length&&L[L.length-1][0]>=W)return u.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',it);const ht=u.parse(Y,lt,P);if(!ht)return null;P=P||ht.type,L.push([W,ht])}return fe(P,Fe)||fe(P,Jr)||fe(P,tt)||fe(P,gt)||fe(P,Tt(Fe))?new rs(P,p,_,x,L):u.error(`Type ${Ft(P)} is not interpolatable.`)}evaluate(c){const u=this.labels,p=this.outputs;if(u.length===1)return p[0].evaluate(c);const _=this.input.evaluate(c);if(_<=u[0])return p[0].evaluate(c);const x=u.length;if(_>=u[x-1])return p[x-1].evaluate(c);const T=ga(u,_),L=rs.interpolationFactor(this.interpolation,_,u[T],u[T+1]),P=p[T].evaluate(c),z=p[T+1].evaluate(c);switch(this.operator){case"interpolate":return Fi[this.type.kind](P,z,L);case"interpolate-hcl":return Fi.color(P,z,L,"hcl");case"interpolate-lab":return Fi.color(P,z,L,"lab")}}eachChild(c){c(this.input);for(const u of this.outputs)c(u)}outputDefined(){return this.outputs.every(c=>c.outputDefined())}}function pc(A,c,u,p){const _=p-u,x=A-u;return _===0?0:c===1?x/_:(Math.pow(c,x)-1)/(Math.pow(c,_)-1)}class el{constructor(c,u){this.type=c,this.args=u}static parse(c,u){if(c.length<2)return u.error("Expectected at least one argument.");let p=null;const _=u.expectedType;_&&_.kind!=="value"&&(p=_);const x=[];for(const L of c.slice(1)){const P=u.parse(L,1+x.length,p,void 0,{typeAnnotation:"omit"});if(!P)return null;p=p||P.type,x.push(P)}if(!p)throw new Error("No output type");const T=_&&x.some(L=>Vt(_,L.type));return new el(T?qe:p,x)}evaluate(c){let u,p=null,_=0;for(const x of this.args)if(_++,p=x.evaluate(c),p&&p instanceof kr&&!p.available&&(u||(u=p.name),p=null,_===this.args.length&&(p=u)),p!==null)break;return p}eachChild(c){this.args.forEach(c)}outputDefined(){return this.args.every(c=>c.outputDefined())}}class rl{constructor(c,u){this.type=u.type,this.bindings=[].concat(c),this.result=u}evaluate(c){return this.result.evaluate(c)}eachChild(c){for(const u of this.bindings)c(u[1]);c(this.result)}static parse(c,u){if(c.length<4)return u.error(`Expected at least 3 arguments, but found ${c.length-1} instead.`);const p=[];for(let x=1;x<c.length-1;x+=2){const T=c[x];if(typeof T!="string")return u.error(`Expected string, but found ${typeof T} instead.`,x);if(/[^a-zA-Z0-9_]/.test(T))return u.error("Variable names must contain only alphanumeric characters or '_'.",x);const L=u.parse(c[x+1],x+1);if(!L)return null;p.push([T,L])}const _=u.parse(c[c.length-1],c.length-1,u.expectedType,p);return _?new rl(p,_):null}outputDefined(){return this.result.outputDefined()}}class Wl{constructor(c,u,p){this.type=c,this.index=u,this.input=p}static parse(c,u){if(c.length!==3)return u.error(`Expected 2 arguments, but found ${c.length-1} instead.`);const p=u.parse(c[1],1,Fe),_=u.parse(c[2],2,Tt(u.expectedType||qe));return p&&_?new Wl(_.type.itemType,p,_):null}evaluate(c){const u=this.index.evaluate(c),p=this.input.evaluate(c);if(u<0)throw new An(`Array index out of bounds: ${u} < 0.`);if(u>=p.length)throw new An(`Array index out of bounds: ${u} > ${p.length-1}.`);if(u!==Math.floor(u))throw new An(`Array index must be an integer, but found ${u} instead.`);return p[u]}eachChild(c){c(this.index),c(this.input)}outputDefined(){return!1}}class Xl{constructor(c,u){this.type=ur,this.needle=c,this.haystack=u}static parse(c,u){if(c.length!==3)return u.error(`Expected 2 arguments, but found ${c.length-1} instead.`);const p=u.parse(c[1],1,qe),_=u.parse(c[2],2,qe);return p&&_?Qt(p.type,[ur,Ze,Fe,rn,qe])?new Xl(p,_):u.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ft(p.type)} instead`):null}evaluate(c){const u=this.needle.evaluate(c),p=this.haystack.evaluate(c);if(!p)return!1;if(!$t(u,["boolean","string","number","null"]))throw new An(`Expected first argument to be of type boolean, string, number or null, but found ${Ft(Tn(u))} instead.`);if(!$t(p,["string","array"]))throw new An(`Expected second argument to be of type array or string, but found ${Ft(Tn(p))} instead.`);return p.indexOf(u)>=0}eachChild(c){c(this.needle),c(this.haystack)}outputDefined(){return!0}}class Eo{constructor(c,u,p){this.type=Fe,this.needle=c,this.haystack=u,this.fromIndex=p}static parse(c,u){if(c.length<=2||c.length>=5)return u.error(`Expected 3 or 4 arguments, but found ${c.length-1} instead.`);const p=u.parse(c[1],1,qe),_=u.parse(c[2],2,qe);if(!p||!_)return null;if(!Qt(p.type,[ur,Ze,Fe,rn,qe]))return u.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ft(p.type)} instead`);if(c.length===4){const x=u.parse(c[3],3,Fe);return x?new Eo(p,_,x):null}return new Eo(p,_)}evaluate(c){const u=this.needle.evaluate(c),p=this.haystack.evaluate(c);if(!$t(u,["boolean","string","number","null"]))throw new An(`Expected first argument to be of type boolean, string, number or null, but found ${Ft(Tn(u))} instead.`);if(!$t(p,["string","array"]))throw new An(`Expected second argument to be of type array or string, but found ${Ft(Tn(p))} instead.`);if(this.fromIndex){const _=this.fromIndex.evaluate(c);return p.indexOf(u,_)}return p.indexOf(u)}eachChild(c){c(this.needle),c(this.haystack),this.fromIndex&&c(this.fromIndex)}outputDefined(){return!1}}class ma{constructor(c,u,p,_,x,T){this.inputType=c,this.type=u,this.input=p,this.cases=_,this.outputs=x,this.otherwise=T}static parse(c,u){if(c.length<5)return u.error(`Expected at least 4 arguments, but found only ${c.length-1}.`);if(c.length%2!=1)return u.error("Expected an even number of arguments.");let p,_;u.expectedType&&u.expectedType.kind!=="value"&&(_=u.expectedType);const x={},T=[];for(let z=2;z<c.length-1;z+=2){let W=c[z];const Y=c[z+1];Array.isArray(W)||(W=[W]);const it=u.concat(z);if(W.length===0)return it.error("Expected at least one branch label.");for(const ht of W){if(typeof ht!="number"&&typeof ht!="string")return it.error("Branch labels must be numbers or strings.");if(typeof ht=="number"&&Math.abs(ht)>Number.MAX_SAFE_INTEGER)return it.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof ht=="number"&&Math.floor(ht)!==ht)return it.error("Numeric branch labels must be integer values.");if(p){if(it.checkSubtype(p,Tn(ht)))return null}else p=Tn(ht);if(x[String(ht)]!==void 0)return it.error("Branch labels must be unique.");x[String(ht)]=T.length}const lt=u.parse(Y,z,_);if(!lt)return null;_=_||lt.type,T.push(lt)}const L=u.parse(c[1],1,qe);if(!L)return null;const P=u.parse(c[c.length-1],c.length-1,_);return P?L.type.kind!=="value"&&u.concat(1).checkSubtype(p,L.type)?null:new ma(p,_,L,x,T,P):null}evaluate(c){const u=this.input.evaluate(c);return(Tn(u)===this.inputType&&this.outputs[this.cases[u]]||this.otherwise).evaluate(c)}eachChild(c){c(this.input),this.outputs.forEach(c),c(this.otherwise)}outputDefined(){return this.outputs.every(c=>c.outputDefined())&&this.otherwise.outputDefined()}}class GA{constructor(c,u,p){this.type=c,this.branches=u,this.otherwise=p}static parse(c,u){if(c.length<4)return u.error(`Expected at least 3 arguments, but found only ${c.length-1}.`);if(c.length%2!=0)return u.error("Expected an odd number of arguments.");let p;u.expectedType&&u.expectedType.kind!=="value"&&(p=u.expectedType);const _=[];for(let T=1;T<c.length-1;T+=2){const L=u.parse(c[T],T,ur);if(!L)return null;const P=u.parse(c[T+1],T+1,p);if(!P)return null;_.push([L,P]),p=p||P.type}const x=u.parse(c[c.length-1],c.length-1,p);if(!x)return null;if(!p)throw new Error("Can't infer output type");return new GA(p,_,x)}evaluate(c){for(const[u,p]of this.branches)if(u.evaluate(c))return p.evaluate(c);return this.otherwise.evaluate(c)}eachChild(c){for(const[u,p]of this.branches)c(u),c(p);c(this.otherwise)}outputDefined(){return this.branches.every(c=>{let[u,p]=c;return p.outputDefined()})&&this.otherwise.outputDefined()}}class Wo{constructor(c,u,p,_){this.type=c,this.input=u,this.beginIndex=p,this.endIndex=_}static parse(c,u){if(c.length<=2||c.length>=5)return u.error(`Expected 3 or 4 arguments, but found ${c.length-1} instead.`);const p=u.parse(c[1],1,qe),_=u.parse(c[2],2,Fe);if(!p||!_)return null;if(!Qt(p.type,[Tt(qe),Ze,qe]))return u.error(`Expected first argument to be of type array or string, but found ${Ft(p.type)} instead`);if(c.length===4){const x=u.parse(c[3],3,Fe);return x?new Wo(p.type,p,_,x):null}return new Wo(p.type,p,_)}evaluate(c){const u=this.input.evaluate(c),p=this.beginIndex.evaluate(c);if(!$t(u,["string","array"]))throw new An(`Expected first argument to be of type array or string, but found ${Ft(Tn(u))} instead.`);if(this.endIndex){const _=this.endIndex.evaluate(c);return u.slice(p,_)}return u.slice(p)}eachChild(c){c(this.input),c(this.beginIndex),this.endIndex&&c(this.endIndex)}outputDefined(){return!1}}function So(A,c){return A==="=="||A==="!="?c.kind==="boolean"||c.kind==="string"||c.kind==="number"||c.kind==="null"||c.kind==="value":c.kind==="string"||c.kind==="number"||c.kind==="value"}function Jl(A,c,u,p){return p.compare(c,u)===0}function To(A,c,u){const p=A!=="=="&&A!=="!=";return class JN{constructor(x,T,L){this.type=ur,this.lhs=x,this.rhs=T,this.collator=L,this.hasUntypedArgument=x.type.kind==="value"||T.type.kind==="value"}static parse(x,T){if(x.length!==3&&x.length!==4)return T.error("Expected two or three arguments.");const L=x[0];let P=T.parse(x[1],1,qe);if(!P)return null;if(!So(L,P.type))return T.concat(1).error(`"${L}" comparisons are not supported for type '${Ft(P.type)}'.`);let z=T.parse(x[2],2,qe);if(!z)return null;if(!So(L,z.type))return T.concat(2).error(`"${L}" comparisons are not supported for type '${Ft(z.type)}'.`);if(P.type.kind!==z.type.kind&&P.type.kind!=="value"&&z.type.kind!=="value")return T.error(`Cannot compare types '${Ft(P.type)}' and '${Ft(z.type)}'.`);p&&(P.type.kind==="value"&&z.type.kind!=="value"?P=new jn(z.type,[P]):P.type.kind!=="value"&&z.type.kind==="value"&&(z=new jn(P.type,[z])));let W=null;if(x.length===4){if(P.type.kind!=="string"&&z.type.kind!=="string"&&P.type.kind!=="value"&&z.type.kind!=="value")return T.error("Cannot use collator to compare non-string types.");if(W=T.parse(x[3],3,sn),!W)return null}return new JN(P,z,W)}evaluate(x){const T=this.lhs.evaluate(x),L=this.rhs.evaluate(x);if(p&&this.hasUntypedArgument){const P=Tn(T),z=Tn(L);if(P.kind!==z.kind||P.kind!=="string"&&P.kind!=="number")throw new An(`Expected arguments for "${A}" to be (string, string) or (number, number), but found (${P.kind}, ${z.kind}) instead.`)}if(this.collator&&!p&&this.hasUntypedArgument){const P=Tn(T),z=Tn(L);if(P.kind!=="string"||z.kind!=="string")return c(x,T,L)}return this.collator?u(x,T,L,this.collator.evaluate(x)):c(x,T,L)}eachChild(x){x(this.lhs),x(this.rhs),this.collator&&x(this.collator)}outputDefined(){return!0}}}const Xh=To("==",function(A,c,u){return c===u},Jl),Yl=To("!=",function(A,c,u){return c!==u},function(A,c,u,p){return!Jl(0,c,u,p)}),Jh=To("<",function(A,c,u){return c<u},function(A,c,u,p){return p.compare(c,u)<0}),VA=To(">",function(A,c,u){return c>u},function(A,c,u,p){return p.compare(c,u)>0}),jA=To("<=",function(A,c,u){return c<=u},function(A,c,u,p){return p.compare(c,u)<=0}),qu=To(">=",function(A,c,u){return c>=u},function(A,c,u,p){return p.compare(c,u)>=0});class gc{constructor(c,u,p,_,x){this.type=Ze,this.number=c,this.locale=u,this.currency=p,this.minFractionDigits=_,this.maxFractionDigits=x}static parse(c,u){if(c.length!==3)return u.error("Expected two arguments.");const p=u.parse(c[1],1,Fe);if(!p)return null;const _=c[2];if(typeof _!="object"||Array.isArray(_))return u.error("NumberFormat options argument must be an object.");let x=null;if(_.locale&&(x=u.parse(_.locale,1,Ze),!x))return null;let T=null;if(_.currency&&(T=u.parse(_.currency,1,Ze),!T))return null;let L=null;if(_["min-fraction-digits"]&&(L=u.parse(_["min-fraction-digits"],1,Fe),!L))return null;let P=null;return _["max-fraction-digits"]&&(P=u.parse(_["max-fraction-digits"],1,Fe),!P)?null:new gc(p,x,T,L,P)}evaluate(c){return new Intl.NumberFormat(this.locale?this.locale.evaluate(c):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(c):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(c):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(c):void 0}).format(this.number.evaluate(c))}eachChild(c){c(this.number),this.locale&&c(this.locale),this.currency&&c(this.currency),this.minFractionDigits&&c(this.minFractionDigits),this.maxFractionDigits&&c(this.maxFractionDigits)}outputDefined(){return!1}}class mc{constructor(c){this.type=_t,this.sections=c}static parse(c,u){if(c.length<2)return u.error("Expected at least one argument.");const p=c[1];if(!Array.isArray(p)&&typeof p=="object")return u.error("First argument must be an image or text section.");const _=[];let x=!1;for(let T=1;T<=c.length-1;++T){const L=c[T];if(x&&typeof L=="object"&&!Array.isArray(L)){x=!1;let P=null;if(L["font-scale"]&&(P=u.parse(L["font-scale"],1,Fe),!P))return null;let z=null;if(L["text-font"]&&(z=u.parse(L["text-font"],1,Tt(Ze)),!z))return null;let W=null;if(L["text-color"]&&(W=u.parse(L["text-color"],1,Jr),!W))return null;const Y=_[_.length-1];Y.scale=P,Y.font=z,Y.textColor=W}else{const P=u.parse(c[T],1,qe);if(!P)return null;const z=P.type.kind;if(z!=="string"&&z!=="value"&&z!=="null"&&z!=="resolvedImage")return u.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");x=!0,_.push({content:P,scale:null,font:null,textColor:null})}}return new mc(_)}evaluate(c){return new Dn(this.sections.map(u=>{const p=u.content.evaluate(c);return Tn(p)===at?new ts("",p,null,null,null):new ts(on(p),null,u.scale?u.scale.evaluate(c):null,u.font?u.font.evaluate(c).join(","):null,u.textColor?u.textColor.evaluate(c):null)}))}eachChild(c){for(const u of this.sections)c(u.content),u.scale&&c(u.scale),u.font&&c(u.font),u.textColor&&c(u.textColor)}outputDefined(){return!1}}class nl{constructor(c){this.type=at,this.input=c}static parse(c,u){if(c.length!==2)return u.error("Expected two arguments.");const p=u.parse(c[1],1,Ze);return p?new nl(p):u.error("No image name provided.")}evaluate(c){const u=this.input.evaluate(c),p=kr.fromString(u);return p&&c.availableImages&&(p.available=c.availableImages.indexOf(u)>-1),p}eachChild(c){c(this.input)}outputDefined(){return!1}}class Zl{constructor(c){this.type=Fe,this.input=c}static parse(c,u){if(c.length!==2)return u.error(`Expected 1 argument, but found ${c.length-1} instead.`);const p=u.parse(c[1],1);return p?p.type.kind!=="array"&&p.type.kind!=="string"&&p.type.kind!=="value"?u.error(`Expected argument of type string or array, but found ${Ft(p.type)} instead.`):new Zl(p):null}evaluate(c){const u=this.input.evaluate(c);if(typeof u=="string"||Array.isArray(u))return u.length;throw new An(`Expected value to be of type string or array, but found ${Ft(Tn(u))} instead.`)}eachChild(c){c(this.input)}outputDefined(){return!1}}const yc={"==":Xh,"!=":Yl,">":VA,"<":Jh,">=":qu,"<=":jA,array:jn,at:Wl,boolean:jn,case:GA,coalesce:el,collator:dt,format:mc,image:nl,in:Xl,"index-of":Eo,interpolate:rs,"interpolate-hcl":rs,"interpolate-lab":rs,length:Zl,let:rl,literal:Ys,match:ma,number:jn,"number-format":gc,object:jn,slice:Wo,step:Us,string:jn,"to-boolean":Cs,"to-color":Cs,"to-number":Cs,"to-string":Cs,var:Zc,within:pa};function il(A,c){let[u,p,_,x]=c;u=u.evaluate(A),p=p.evaluate(A),_=_.evaluate(A);const T=x?x.evaluate(A):1,L=Bo(u,p,_,T);if(L)throw new An(L);return new Yr(u/255,p/255,_/255,T,!1)}function _c(A,c){return A in c}function sl(A,c){const u=c[A];return u===void 0?null:u}function Rs(A){return{type:A}}function tA(A){return{result:"success",value:A}}function U(A){return{result:"error",value:A}}function nt(A){return A["property-type"]==="data-driven"||A["property-type"]==="cross-faded-data-driven"}function Pt(A){return!!A.expression&&A.expression.parameters.indexOf("zoom")>-1}function Yt(A){return!!A.expression&&A.expression.interpolated}function Zt(A){return A instanceof Number?"number":A instanceof String?"string":A instanceof Boolean?"boolean":Array.isArray(A)?"array":A===null?"null":typeof A}function ge(A){return typeof A=="object"&&A!==null&&!Array.isArray(A)}function ze(A){return A}function Me(A,c){const u=c.type==="color",p=A.stops&&typeof A.stops[0][0]=="object",_=p||!(p||A.property!==void 0),x=A.type||(Yt(c)?"exponential":"interval");if(u||c.type==="padding"){const W=u?Yr.parse:Gi.parse;(A=Nr({},A)).stops&&(A.stops=A.stops.map(Y=>[Y[0],W(Y[1])])),A.default=W(A.default?A.default:c.default)}if(A.colorSpace&&(T=A.colorSpace)!=="rgb"&&T!=="hcl"&&T!=="lab")throw new Error(`Unknown color space: "${A.colorSpace}"`);var T;let L,P,z;if(x==="exponential")L=un;else if(x==="interval")L=wr;else if(x==="categorical"){L=mr,P=Object.create(null);for(const W of A.stops)P[W[0]]=W[1];z=typeof A.stops[0][0]}else{if(x!=="identity")throw new Error(`Unknown function type "${x}"`);L=si}if(p){const W={},Y=[];for(let ht=0;ht<A.stops.length;ht++){const Et=A.stops[ht],Mt=Et[0].zoom;W[Mt]===void 0&&(W[Mt]={zoom:Mt,type:A.type,property:A.property,default:A.default,stops:[]},Y.push(Mt)),W[Mt].stops.push([Et[0].value,Et[1]])}const it=[];for(const ht of Y)it.push([W[ht].zoom,Me(W[ht],c)]);const lt={name:"linear"};return{kind:"composite",interpolationType:lt,interpolationFactor:rs.interpolationFactor.bind(void 0,lt),zoomStops:it.map(ht=>ht[0]),evaluate:(ht,Et)=>{let{zoom:Mt}=ht;return un({stops:it,base:A.base},c,Mt).evaluate(Mt,Et)}}}if(_){const W=x==="exponential"?{name:"exponential",base:A.base!==void 0?A.base:1}:null;return{kind:"camera",interpolationType:W,interpolationFactor:rs.interpolationFactor.bind(void 0,W),zoomStops:A.stops.map(Y=>Y[0]),evaluate:Y=>{let{zoom:it}=Y;return L(A,c,it,P,z)}}}return{kind:"source",evaluate(W,Y){const it=Y&&Y.properties?Y.properties[A.property]:void 0;return it===void 0?Ir(A.default,c.default):L(A,c,it,P,z)}}}function Ir(A,c,u){return A!==void 0?A:c!==void 0?c:u!==void 0?u:void 0}function mr(A,c,u,p,_){return Ir(typeof u===_?p[u]:void 0,A.default,c.default)}function wr(A,c,u){if(Zt(u)!=="number")return Ir(A.default,c.default);const p=A.stops.length;if(p===1||u<=A.stops[0][0])return A.stops[0][1];if(u>=A.stops[p-1][0])return A.stops[p-1][1];const _=ga(A.stops.map(x=>x[0]),u);return A.stops[_][1]}function un(A,c,u){const p=A.base!==void 0?A.base:1;if(Zt(u)!=="number")return Ir(A.default,c.default);const _=A.stops.length;if(_===1||u<=A.stops[0][0])return A.stops[0][1];if(u>=A.stops[_-1][0])return A.stops[_-1][1];const x=ga(A.stops.map(W=>W[0]),u),T=function(W,Y,it,lt){const ht=lt-it,Et=W-it;return ht===0?0:Y===1?Et/ht:(Math.pow(Y,Et)-1)/(Math.pow(Y,ht)-1)}(u,p,A.stops[x][0],A.stops[x+1][0]),L=A.stops[x][1],P=A.stops[x+1][1],z=Fi[c.type]||ze;return typeof L.evaluate=="function"?{evaluate(){for(var W=arguments.length,Y=new Array(W),it=0;it<W;it++)Y[it]=arguments[it];const lt=L.evaluate.apply(void 0,Y),ht=P.evaluate.apply(void 0,Y);if(lt!==void 0&&ht!==void 0)return z(lt,ht,T,A.colorSpace)}}:z(L,P,T,A.colorSpace)}function si(A,c,u){switch(c.type){case"color":u=Yr.parse(u);break;case"formatted":u=Dn.fromString(u.toString());break;case"resolvedImage":u=kr.fromString(u.toString());break;case"padding":u=Gi.parse(u);break;default:Zt(u)===c.type||c.type==="enum"&&c.values[u]||(u=void 0)}return Ir(u,A.default,c.default)}es.register(yc,{error:[{kind:"error"},[Ze],(A,c)=>{let[u]=c;throw new An(u.evaluate(A))}],typeof:[Ze,[qe],(A,c)=>{let[u]=c;return Ft(Tn(u.evaluate(A)))}],"to-rgba":[Tt(Fe,4),[Jr],(A,c)=>{let[u]=c;const[p,_,x,T]=u.evaluate(A).rgb;return[255*p,255*_,255*x,T]}],rgb:[Jr,[Fe,Fe,Fe],il],rgba:[Jr,[Fe,Fe,Fe,Fe],il],has:{type:ur,overloads:[[[Ze],(A,c)=>{let[u]=c;return _c(u.evaluate(A),A.properties())}],[[Ze,Un],(A,c)=>{let[u,p]=c;return _c(u.evaluate(A),p.evaluate(A))}]]},get:{type:qe,overloads:[[[Ze],(A,c)=>{let[u]=c;return sl(u.evaluate(A),A.properties())}],[[Ze,Un],(A,c)=>{let[u,p]=c;return sl(u.evaluate(A),p.evaluate(A))}]]},"feature-state":[qe,[Ze],(A,c)=>{let[u]=c;return sl(u.evaluate(A),A.featureState||{})}],properties:[Un,[],A=>A.properties()],"geometry-type":[Ze,[],A=>A.geometryType()],id:[qe,[],A=>A.id()],zoom:[Fe,[],A=>A.globals.zoom],"heatmap-density":[Fe,[],A=>A.globals.heatmapDensity||0],"line-progress":[Fe,[],A=>A.globals.lineProgress||0],accumulated:[qe,[],A=>A.globals.accumulated===void 0?null:A.globals.accumulated],"+":[Fe,Rs(Fe),(A,c)=>{let u=0;for(const p of c)u+=p.evaluate(A);return u}],"*":[Fe,Rs(Fe),(A,c)=>{let u=1;for(const p of c)u*=p.evaluate(A);return u}],"-":{type:Fe,overloads:[[[Fe,Fe],(A,c)=>{let[u,p]=c;return u.evaluate(A)-p.evaluate(A)}],[[Fe],(A,c)=>{let[u]=c;return-u.evaluate(A)}]]},"/":[Fe,[Fe,Fe],(A,c)=>{let[u,p]=c;return u.evaluate(A)/p.evaluate(A)}],"%":[Fe,[Fe,Fe],(A,c)=>{let[u,p]=c;return u.evaluate(A)%p.evaluate(A)}],ln2:[Fe,[],()=>Math.LN2],pi:[Fe,[],()=>Math.PI],e:[Fe,[],()=>Math.E],"^":[Fe,[Fe,Fe],(A,c)=>{let[u,p]=c;return Math.pow(u.evaluate(A),p.evaluate(A))}],sqrt:[Fe,[Fe],(A,c)=>{let[u]=c;return Math.sqrt(u.evaluate(A))}],log10:[Fe,[Fe],(A,c)=>{let[u]=c;return Math.log(u.evaluate(A))/Math.LN10}],ln:[Fe,[Fe],(A,c)=>{let[u]=c;return Math.log(u.evaluate(A))}],log2:[Fe,[Fe],(A,c)=>{let[u]=c;return Math.log(u.evaluate(A))/Math.LN2}],sin:[Fe,[Fe],(A,c)=>{let[u]=c;return Math.sin(u.evaluate(A))}],cos:[Fe,[Fe],(A,c)=>{let[u]=c;return Math.cos(u.evaluate(A))}],tan:[Fe,[Fe],(A,c)=>{let[u]=c;return Math.tan(u.evaluate(A))}],asin:[Fe,[Fe],(A,c)=>{let[u]=c;return Math.asin(u.evaluate(A))}],acos:[Fe,[Fe],(A,c)=>{let[u]=c;return Math.acos(u.evaluate(A))}],atan:[Fe,[Fe],(A,c)=>{let[u]=c;return Math.atan(u.evaluate(A))}],min:[Fe,Rs(Fe),(A,c)=>Math.min(...c.map(u=>u.evaluate(A)))],max:[Fe,Rs(Fe),(A,c)=>Math.max(...c.map(u=>u.evaluate(A)))],abs:[Fe,[Fe],(A,c)=>{let[u]=c;return Math.abs(u.evaluate(A))}],round:[Fe,[Fe],(A,c)=>{let[u]=c;const p=u.evaluate(A);return p<0?-Math.round(-p):Math.round(p)}],floor:[Fe,[Fe],(A,c)=>{let[u]=c;return Math.floor(u.evaluate(A))}],ceil:[Fe,[Fe],(A,c)=>{let[u]=c;return Math.ceil(u.evaluate(A))}],"filter-==":[ur,[Ze,qe],(A,c)=>{let[u,p]=c;return A.properties()[u.value]===p.value}],"filter-id-==":[ur,[qe],(A,c)=>{let[u]=c;return A.id()===u.value}],"filter-type-==":[ur,[Ze],(A,c)=>{let[u]=c;return A.geometryType()===u.value}],"filter-<":[ur,[Ze,qe],(A,c)=>{let[u,p]=c;const _=A.properties()[u.value],x=p.value;return typeof _==typeof x&&_<x}],"filter-id-<":[ur,[qe],(A,c)=>{let[u]=c;const p=A.id(),_=u.value;return typeof p==typeof _&&p<_}],"filter->":[ur,[Ze,qe],(A,c)=>{let[u,p]=c;const _=A.properties()[u.value],x=p.value;return typeof _==typeof x&&_>x}],"filter-id->":[ur,[qe],(A,c)=>{let[u]=c;const p=A.id(),_=u.value;return typeof p==typeof _&&p>_}],"filter-<=":[ur,[Ze,qe],(A,c)=>{let[u,p]=c;const _=A.properties()[u.value],x=p.value;return typeof _==typeof x&&_<=x}],"filter-id-<=":[ur,[qe],(A,c)=>{let[u]=c;const p=A.id(),_=u.value;return typeof p==typeof _&&p<=_}],"filter->=":[ur,[Ze,qe],(A,c)=>{let[u,p]=c;const _=A.properties()[u.value],x=p.value;return typeof _==typeof x&&_>=x}],"filter-id->=":[ur,[qe],(A,c)=>{let[u]=c;const p=A.id(),_=u.value;return typeof p==typeof _&&p>=_}],"filter-has":[ur,[qe],(A,c)=>{let[u]=c;return u.value in A.properties()}],"filter-has-id":[ur,[],A=>A.id()!==null&&A.id()!==void 0],"filter-type-in":[ur,[Tt(Ze)],(A,c)=>{let[u]=c;return u.value.indexOf(A.geometryType())>=0}],"filter-id-in":[ur,[Tt(qe)],(A,c)=>{let[u]=c;return u.value.indexOf(A.id())>=0}],"filter-in-small":[ur,[Ze,Tt(qe)],(A,c)=>{let[u,p]=c;return p.value.indexOf(A.properties()[u.value])>=0}],"filter-in-large":[ur,[Ze,Tt(qe)],(A,c)=>{let[u,p]=c;return function(_,x,T,L){for(;T<=L;){const P=T+L>>1;if(x[P]===_)return!0;x[P]>_?L=P-1:T=P+1}return!1}(A.properties()[u.value],p.value,0,p.value.length-1)}],all:{type:ur,overloads:[[[ur,ur],(A,c)=>{let[u,p]=c;return u.evaluate(A)&&p.evaluate(A)}],[Rs(ur),(A,c)=>{for(const u of c)if(!u.evaluate(A))return!1;return!0}]]},any:{type:ur,overloads:[[[ur,ur],(A,c)=>{let[u,p]=c;return u.evaluate(A)||p.evaluate(A)}],[Rs(ur),(A,c)=>{for(const u of c)if(u.evaluate(A))return!0;return!1}]]},"!":[ur,[ur],(A,c)=>{let[u]=c;return!u.evaluate(A)}],"is-supported-script":[ur,[Ze],(A,c)=>{let[u]=c;const p=A.globals&&A.globals.isSupportedScript;return!p||p(u.evaluate(A))}],upcase:[Ze,[Ze],(A,c)=>{let[u]=c;return u.evaluate(A).toUpperCase()}],downcase:[Ze,[Ze],(A,c)=>{let[u]=c;return u.evaluate(A).toLowerCase()}],concat:[Ze,Rs(qe),(A,c)=>c.map(u=>on(u.evaluate(A))).join("")],"resolved-locale":[Ze,[sn],(A,c)=>{let[u]=c;return u.evaluate(A).resolvedLocale()}]});class hi{constructor(c,u){var p;this.expression=c,this._warningHistory={},this._evaluator=new hc,this._defaultValue=u?(p=u).type==="color"&&ge(p.default)?new Yr(0,0,0,0):p.type==="color"?Yr.parse(p.default)||null:p.type==="padding"?Gi.parse(p.default)||null:p.type==="variableAnchorOffsetCollection"?Ii.parse(p.default)||null:p.default===void 0?null:p.default:null,this._enumValues=u&&u.type==="enum"?u.values:null}evaluateWithoutErrorHandling(c,u,p,_,x,T){return this._evaluator.globals=c,this._evaluator.feature=u,this._evaluator.featureState=p,this._evaluator.canonical=_,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=T,this.expression.evaluate(this._evaluator)}evaluate(c,u,p,_,x,T){this._evaluator.globals=c,this._evaluator.feature=u||null,this._evaluator.featureState=p||null,this._evaluator.canonical=_,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=T||null;try{const L=this.expression.evaluate(this._evaluator);if(L==null||typeof L=="number"&&L!=L)return this._defaultValue;if(this._enumValues&&!(L in this._enumValues))throw new An(`Expected value to be one of ${Object.keys(this._enumValues).map(P=>JSON.stringify(P)).join(", ")}, but found ${JSON.stringify(L)} instead.`);return L}catch(L){return this._warningHistory[L.message]||(this._warningHistory[L.message]=!0,typeof console<"u"&&console.warn(L.message)),this._defaultValue}}}function di(A){return Array.isArray(A)&&A.length>0&&typeof A[0]=="string"&&A[0]in yc}function Mi(A,c){const u=new dc(yc,fc,[],c?function(_){const x={color:Jr,string:Ze,number:Fe,enum:Ze,boolean:ur,formatted:_t,padding:tt,resolvedImage:at,variableAnchorOffsetCollection:gt};return _.type==="array"?Tt(x[_.value]||qe,_.length):x[_.type]}(c):void 0),p=u.parse(A,void 0,void 0,void 0,c&&c.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?tA(new hi(p,c)):U(u.errors)}class Ci{constructor(c,u){this.kind=c,this._styleExpression=u,this.isStateDependent=c!=="constant"&&!tl(u.expression)}evaluateWithoutErrorHandling(c,u,p,_,x,T){return this._styleExpression.evaluateWithoutErrorHandling(c,u,p,_,x,T)}evaluate(c,u,p,_,x,T){return this._styleExpression.evaluate(c,u,p,_,x,T)}}class Ds{constructor(c,u,p,_){this.kind=c,this.zoomStops=p,this._styleExpression=u,this.isStateDependent=c!=="camera"&&!tl(u.expression),this.interpolationType=_}evaluateWithoutErrorHandling(c,u,p,_,x,T){return this._styleExpression.evaluateWithoutErrorHandling(c,u,p,_,x,T)}evaluate(c,u,p,_,x,T){return this._styleExpression.evaluate(c,u,p,_,x,T)}interpolationFactor(c,u,p){return this.interpolationType?rs.interpolationFactor(this.interpolationType,c,u,p):0}}function Os(A,c){const u=Mi(A,c);if(u.result==="error")return u;const p=u.value.expression,_=ql(p);if(!_&&!nt(c))return U([new Vr("","data expressions not supported")]);const x=Kl(p,["zoom"]);if(!x&&!Pt(c))return U([new Vr("","zoom expressions not supported")]);const T=vc(p);return T||x?T instanceof Vr?U([T]):T instanceof rs&&!Yt(c)?U([new Vr("",'"interpolate" expressions cannot be used with this property')]):tA(T?new Ds(_?"camera":"composite",u.value,T.labels,T instanceof rs?T.interpolation:void 0):new Ci(_?"constant":"source",u.value)):U([new Vr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Zs{constructor(c,u){this._parameters=c,this._specification=u,Nr(this,Me(this._parameters,this._specification))}static deserialize(c){return new Zs(c._parameters,c._specification)}static serialize(c){return{_parameters:c._parameters,_specification:c._specification}}}function vc(A){let c=null;if(A instanceof rl)c=vc(A.result);else if(A instanceof el){for(const u of A.args)if(c=vc(u),c)break}else(A instanceof Us||A instanceof rs)&&A.input instanceof es&&A.input.name==="zoom"&&(c=A);return c instanceof Vr||A.eachChild(u=>{const p=vc(u);p instanceof Vr?c=p:!c&&p?c=new Vr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):c&&p&&c!==p&&(c=new Vr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),c}function Ha(A){if(A===!0||A===!1)return!0;if(!Array.isArray(A)||A.length===0)return!1;switch(A[0]){case"has":return A.length>=2&&A[1]!=="$id"&&A[1]!=="$type";case"in":return A.length>=3&&(typeof A[1]!="string"||Array.isArray(A[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return A.length!==3||Array.isArray(A[1])||Array.isArray(A[2]);case"any":case"all":for(const c of A.slice(1))if(!Ha(c)&&typeof c!="boolean")return!1;return!0;default:return!0}}const qA={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function bc(A){if(A==null)return{filter:()=>!0,needGeometry:!1};Ha(A)||(A=Ga(A));const c=Mi(A,qA);if(c.result==="error")throw new Error(c.value.map(u=>`${u.key}: ${u.message}`).join(", "));return{filter:(u,p,_)=>c.value.evaluate(u,p,{},_),needGeometry:eA(A)}}function KA(A,c){return A<c?-1:A>c?1:0}function eA(A){if(!Array.isArray(A))return!1;if(A[0]==="within")return!0;for(let c=1;c<A.length;c++)if(eA(A[c]))return!0;return!1}function Ga(A){if(!A)return!0;const c=A[0];return A.length<=1?c!=="any":c==="=="?ps(A[1],A[2],"=="):c==="!="?ya(ps(A[1],A[2],"==")):c==="<"||c===">"||c==="<="||c===">="?ps(A[1],A[2],c):c==="any"?(u=A.slice(1),["any"].concat(u.map(Ga))):c==="all"?["all"].concat(A.slice(1).map(Ga)):c==="none"?["all"].concat(A.slice(1).map(Ga).map(ya)):c==="in"?ol(A[1],A.slice(2)):c==="!in"?ya(ol(A[1],A.slice(2))):c==="has"?al(A[1]):c==="!has"?ya(al(A[1])):c!=="within"||A;var u}function ps(A,c,u){switch(A){case"$type":return[`filter-type-${u}`,c];case"$id":return[`filter-id-${u}`,c];default:return[`filter-${u}`,A,c]}}function ol(A,c){if(c.length===0)return!1;switch(A){case"$type":return["filter-type-in",["literal",c]];case"$id":return["filter-id-in",["literal",c]];default:return c.length>200&&!c.some(u=>typeof u!=typeof c[0])?["filter-in-large",A,["literal",c.sort(KA)]]:["filter-in-small",A,["literal",c]]}}function al(A){switch(A){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",A]}}function ya(A){return["!",A]}function wc(A){const c=typeof A;if(c==="number"||c==="boolean"||c==="string"||A==null)return JSON.stringify(A);if(Array.isArray(A)){let _="[";for(const x of A)_+=`${wc(x)},`;return`${_}]`}const u=Object.keys(A).sort();let p="{";for(let _=0;_<u.length;_++)p+=`${JSON.stringify(u[_])}:${wc(A[u[_]])},`;return`${p}}`}function ns(A){let c="";for(const u of Ie)c+=`/${wc(A[u])}`;return c}function Ku(A){const c=A.value;return c?[new Ee(A.key,c,"constants have been deprecated as of v8")]:[]}function Kn(A){return A instanceof Number||A instanceof String||A instanceof Boolean?A.valueOf():A}function _a(A){if(Array.isArray(A))return A.map(_a);if(A instanceof Object&&!(A instanceof Number||A instanceof String||A instanceof Boolean)){const c={};for(const u in A)c[u]=_a(A[u]);return c}return Kn(A)}function oi(A){const c=A.key,u=A.value,p=A.valueSpec||{},_=A.objectElementValidators||{},x=A.style,T=A.styleSpec,L=A.validateSpec;let P=[];const z=Zt(u);if(z!=="object")return[new Ee(c,u,`object expected, ${z} found`)];for(const W in u){const Y=W.split(".")[0],it=p[Y]||p["*"];let lt;if(_[Y])lt=_[Y];else if(p[Y])lt=L;else if(_["*"])lt=_["*"];else{if(!p["*"]){P.push(new Ee(c,u[W],`unknown property "${W}"`));continue}lt=L}P=P.concat(lt({key:(c&&`${c}.`)+W,value:u[W],valueSpec:it,style:x,styleSpec:T,object:u,objectKey:W,validateSpec:L},u))}for(const W in p)_[W]||p[W].required&&p[W].default===void 0&&u[W]===void 0&&P.push(new Ee(c,u,`missing required property "${W}"`));return P}function va(A){const c=A.value,u=A.valueSpec,p=A.style,_=A.styleSpec,x=A.key,T=A.arrayElementValidator||A.validateSpec;if(Zt(c)!=="array")return[new Ee(x,c,`array expected, ${Zt(c)} found`)];if(u.length&&c.length!==u.length)return[new Ee(x,c,`array length ${u.length} expected, length ${c.length} found`)];if(u["min-length"]&&c.length<u["min-length"])return[new Ee(x,c,`array length at least ${u["min-length"]} expected, length ${c.length} found`)];let L={type:u.value,values:u.values};_.$version<7&&(L.function=u.function),Zt(u.value)==="object"&&(L=u.value);let P=[];for(let z=0;z<c.length;z++)P=P.concat(T({array:c,arrayIndex:z,value:c[z],valueSpec:L,validateSpec:A.validateSpec,style:p,styleSpec:_,key:`${x}[${z}]`}));return P}function cl(A){const c=A.key,u=A.value,p=A.valueSpec;let _=Zt(u);return _==="number"&&u!=u&&(_="NaN"),_!=="number"?[new Ee(c,u,`number expected, ${_} found`)]:"minimum"in p&&u<p.minimum?[new Ee(c,u,`${u} is less than the minimum value ${p.minimum}`)]:"maximum"in p&&u>p.maximum?[new Ee(c,u,`${u} is greater than the maximum value ${p.maximum}`)]:[]}function rA(A){const c=A.valueSpec,u=Kn(A.value.type);let p,_,x,T={};const L=u!=="categorical"&&A.value.property===void 0,P=!L,z=Zt(A.value.stops)==="array"&&Zt(A.value.stops[0])==="array"&&Zt(A.value.stops[0][0])==="object",W=oi({key:A.key,value:A.value,valueSpec:A.styleSpec.function,validateSpec:A.validateSpec,style:A.style,styleSpec:A.styleSpec,objectElementValidators:{stops:function(lt){if(u==="identity")return[new Ee(lt.key,lt.value,'identity function may not have a "stops" property')];let ht=[];const Et=lt.value;return ht=ht.concat(va({key:lt.key,value:Et,valueSpec:lt.valueSpec,validateSpec:lt.validateSpec,style:lt.style,styleSpec:lt.styleSpec,arrayElementValidator:Y})),Zt(Et)==="array"&&Et.length===0&&ht.push(new Ee(lt.key,Et,"array must have at least one stop")),ht},default:function(lt){return lt.validateSpec({key:lt.key,value:lt.value,valueSpec:c,validateSpec:lt.validateSpec,style:lt.style,styleSpec:lt.styleSpec})}}});return u==="identity"&&L&&W.push(new Ee(A.key,A.value,'missing required property "property"')),u==="identity"||A.value.stops||W.push(new Ee(A.key,A.value,'missing required property "stops"')),u==="exponential"&&A.valueSpec.expression&&!Yt(A.valueSpec)&&W.push(new Ee(A.key,A.value,"exponential functions not supported")),A.styleSpec.$version>=8&&(P&&!nt(A.valueSpec)?W.push(new Ee(A.key,A.value,"property functions not supported")):L&&!Pt(A.valueSpec)&&W.push(new Ee(A.key,A.value,"zoom functions not supported"))),u!=="categorical"&&!z||A.value.property!==void 0||W.push(new Ee(A.key,A.value,'"property" property is required')),W;function Y(lt){let ht=[];const Et=lt.value,Mt=lt.key;if(Zt(Et)!=="array")return[new Ee(Mt,Et,`array expected, ${Zt(Et)} found`)];if(Et.length!==2)return[new Ee(Mt,Et,`array length 2 expected, length ${Et.length} found`)];if(z){if(Zt(Et[0])!=="object")return[new Ee(Mt,Et,`object expected, ${Zt(Et[0])} found`)];if(Et[0].zoom===void 0)return[new Ee(Mt,Et,"object stop key must have zoom")];if(Et[0].value===void 0)return[new Ee(Mt,Et,"object stop key must have value")];if(x&&x>Kn(Et[0].zoom))return[new Ee(Mt,Et[0].zoom,"stop zoom values must appear in ascending order")];Kn(Et[0].zoom)!==x&&(x=Kn(Et[0].zoom),_=void 0,T={}),ht=ht.concat(oi({key:`${Mt}[0]`,value:Et[0],valueSpec:{zoom:{}},validateSpec:lt.validateSpec,style:lt.style,styleSpec:lt.styleSpec,objectElementValidators:{zoom:cl,value:it}}))}else ht=ht.concat(it({key:`${Mt}[0]`,value:Et[0],valueSpec:{},validateSpec:lt.validateSpec,style:lt.style,styleSpec:lt.styleSpec},Et));return di(_a(Et[1]))?ht.concat([new Ee(`${Mt}[1]`,Et[1],"expressions are not allowed in function stops.")]):ht.concat(lt.validateSpec({key:`${Mt}[1]`,value:Et[1],valueSpec:c,validateSpec:lt.validateSpec,style:lt.style,styleSpec:lt.styleSpec}))}function it(lt,ht){const Et=Zt(lt.value),Mt=Kn(lt.value),Gt=lt.value!==null?lt.value:ht;if(p){if(Et!==p)return[new Ee(lt.key,Gt,`${Et} stop domain type must match previous stop domain type ${p}`)]}else p=Et;if(Et!=="number"&&Et!=="string"&&Et!=="boolean")return[new Ee(lt.key,Gt,"stop domain value must be a number, string, or boolean")];if(Et!=="number"&&u!=="categorical"){let ee=`number expected, ${Et} found`;return nt(c)&&u===void 0&&(ee+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ee(lt.key,Gt,ee)]}return u!=="categorical"||Et!=="number"||isFinite(Mt)&&Math.floor(Mt)===Mt?u!=="categorical"&&Et==="number"&&_!==void 0&&Mt<_?[new Ee(lt.key,Gt,"stop domain values must appear in ascending order")]:(_=Mt,u==="categorical"&&Mt in T?[new Ee(lt.key,Gt,"stop domain values must be unique")]:(T[Mt]=!0,[])):[new Ee(lt.key,Gt,`integer expected, found ${Mt}`)]}}function Ns(A){const c=(A.expressionContext==="property"?Os:Mi)(_a(A.value),A.valueSpec);if(c.result==="error")return c.value.map(p=>new Ee(`${A.key}${p.key}`,A.value,p.message));const u=c.value.expression||c.value._styleExpression.expression;if(A.expressionContext==="property"&&A.propertyKey==="text-font"&&!u.outputDefined())return[new Ee(A.key,A.value,`Invalid data expression for "${A.propertyKey}". Output values must be contained as literals within the expression.`)];if(A.expressionContext==="property"&&A.propertyType==="layout"&&!tl(u))return[new Ee(A.key,A.value,'"feature-state" data expressions are not supported with layout properties.')];if(A.expressionContext==="filter"&&!tl(u))return[new Ee(A.key,A.value,'"feature-state" data expressions are not supported with filters.')];if(A.expressionContext&&A.expressionContext.indexOf("cluster")===0){if(!Kl(u,["zoom","feature-state"]))return[new Ee(A.key,A.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(A.expressionContext==="cluster-initial"&&!ql(u))return[new Ee(A.key,A.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function gs(A){const c=A.key,u=A.value,p=A.valueSpec,_=[];return Array.isArray(p.values)?p.values.indexOf(Kn(u))===-1&&_.push(new Ee(c,u,`expected one of [${p.values.join(", ")}], ${JSON.stringify(u)} found`)):Object.keys(p.values).indexOf(Kn(u))===-1&&_.push(new Ee(c,u,`expected one of [${Object.keys(p.values).join(", ")}], ${JSON.stringify(u)} found`)),_}function ms(A){return Ha(_a(A.value))?Ns(Nr({},A,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Va(A)}function Va(A){const c=A.value,u=A.key;if(Zt(c)!=="array")return[new Ee(u,c,`array expected, ${Zt(c)} found`)];const p=A.styleSpec;let _,x=[];if(c.length<1)return[new Ee(u,c,"filter array must have at least 1 element")];switch(x=x.concat(gs({key:`${u}[0]`,value:c[0],valueSpec:p.filter_operator,style:A.style,styleSpec:A.styleSpec})),Kn(c[0])){case"<":case"<=":case">":case">=":c.length>=2&&Kn(c[1])==="$type"&&x.push(new Ee(u,c,`"$type" cannot be use with operator "${c[0]}"`));case"==":case"!=":c.length!==3&&x.push(new Ee(u,c,`filter array for operator "${c[0]}" must have 3 elements`));case"in":case"!in":c.length>=2&&(_=Zt(c[1]),_!=="string"&&x.push(new Ee(`${u}[1]`,c[1],`string expected, ${_} found`)));for(let T=2;T<c.length;T++)_=Zt(c[T]),Kn(c[1])==="$type"?x=x.concat(gs({key:`${u}[${T}]`,value:c[T],valueSpec:p.geometry_type,style:A.style,styleSpec:A.styleSpec})):_!=="string"&&_!=="number"&&_!=="boolean"&&x.push(new Ee(`${u}[${T}]`,c[T],`string, number, or boolean expected, ${_} found`));break;case"any":case"all":case"none":for(let T=1;T<c.length;T++)x=x.concat(Va({key:`${u}[${T}]`,value:c[T],style:A.style,styleSpec:A.styleSpec}));break;case"has":case"!has":_=Zt(c[1]),c.length!==2?x.push(new Ee(u,c,`filter array for "${c[0]}" operator must have 2 elements`)):_!=="string"&&x.push(new Ee(`${u}[1]`,c[1],`string expected, ${_} found`));break;case"within":_=Zt(c[1]),c.length!==2?x.push(new Ee(u,c,`filter array for "${c[0]}" operator must have 2 elements`)):_!=="object"&&x.push(new Ee(`${u}[1]`,c[1],`object expected, ${_} found`))}return x}function Xo(A,c){const u=A.key,p=A.validateSpec,_=A.style,x=A.styleSpec,T=A.value,L=A.objectKey,P=x[`${c}_${A.layerType}`];if(!P)return[];const z=L.match(/^(.*)-transition$/);if(c==="paint"&&z&&P[z[1]]&&P[z[1]].transition)return p({key:u,value:T,valueSpec:x.transition,style:_,styleSpec:x});const W=A.valueSpec||P[L];if(!W)return[new Ee(u,T,`unknown property "${L}"`)];let Y;if(Zt(T)==="string"&&nt(W)&&!W.tokens&&(Y=/^{([^}]+)}$/.exec(T)))return[new Ee(u,T,`"${L}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(Y[1])} }\`.`)];const it=[];return A.layerType==="symbol"&&(L==="text-field"&&_&&!_.glyphs&&it.push(new Ee(u,T,'use of "text-field" requires a style "glyphs" property')),L==="text-font"&&ge(_a(T))&&Kn(T.type)==="identity"&&it.push(new Ee(u,T,'"text-font" does not support identity functions'))),it.concat(p({key:A.key,value:T,valueSpec:W,style:_,styleSpec:x,expressionContext:"property",propertyType:c,propertyKey:L}))}function ba(A){return Xo(A,"paint")}function ll(A){return Xo(A,"layout")}function Io(A){let c=[];const u=A.value,p=A.key,_=A.style,x=A.styleSpec;u.type||u.ref||c.push(new Ee(p,u,'either "type" or "ref" is required'));let T=Kn(u.type);const L=Kn(u.ref);if(u.id){const P=Kn(u.id);for(let z=0;z<A.arrayIndex;z++){const W=_.layers[z];Kn(W.id)===P&&c.push(new Ee(p,u.id,`duplicate layer id "${u.id}", previously used at line ${W.id.__line__}`))}}if("ref"in u){let P;["type","source","source-layer","filter","layout"].forEach(z=>{z in u&&c.push(new Ee(p,u[z],`"${z}" is prohibited for ref layers`))}),_.layers.forEach(z=>{Kn(z.id)===L&&(P=z)}),P?P.ref?c.push(new Ee(p,u.ref,"ref cannot reference another ref layer")):T=Kn(P.type):c.push(new Ee(p,u.ref,`ref layer "${L}" not found`))}else if(T!=="background")if(u.source){const P=_.sources&&_.sources[u.source],z=P&&Kn(P.type);P?z==="vector"&&T==="raster"?c.push(new Ee(p,u.source,`layer "${u.id}" requires a raster source`)):z!=="raster-dem"&&T==="hillshade"?c.push(new Ee(p,u.source,`layer "${u.id}" requires a raster-dem source`)):z==="raster"&&T!=="raster"?c.push(new Ee(p,u.source,`layer "${u.id}" requires a vector source`)):z!=="vector"||u["source-layer"]?z==="raster-dem"&&T!=="hillshade"?c.push(new Ee(p,u.source,"raster-dem source can only be used with layer type 'hillshade'.")):T!=="line"||!u.paint||!u.paint["line-gradient"]||z==="geojson"&&P.lineMetrics||c.push(new Ee(p,u,`layer "${u.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):c.push(new Ee(p,u,`layer "${u.id}" must specify a "source-layer"`)):c.push(new Ee(p,u.source,`source "${u.source}" not found`))}else c.push(new Ee(p,u,'missing required property "source"'));return c=c.concat(oi({key:p,value:u,valueSpec:x.layer,style:A.style,styleSpec:A.styleSpec,validateSpec:A.validateSpec,objectElementValidators:{"*":()=>[],type:()=>A.validateSpec({key:`${p}.type`,value:u.type,valueSpec:x.layer.type,style:A.style,styleSpec:A.styleSpec,validateSpec:A.validateSpec,object:u,objectKey:"type"}),filter:ms,layout:P=>oi({layer:u,key:P.key,value:P.value,style:P.style,styleSpec:P.styleSpec,validateSpec:P.validateSpec,objectElementValidators:{"*":z=>ll(Nr({layerType:T},z))}}),paint:P=>oi({layer:u,key:P.key,value:P.value,style:P.style,styleSpec:P.styleSpec,validateSpec:P.validateSpec,objectElementValidators:{"*":z=>ba(Nr({layerType:T},z))}})}})),c}function Es(A){const c=A.value,u=A.key,p=Zt(c);return p!=="string"?[new Ee(u,c,`string expected, ${p} found`)]:[]}const ja={promoteId:function(A){let{key:c,value:u}=A;if(Zt(u)==="string")return Es({key:c,value:u});{const p=[];for(const _ in u)p.push(...Es({key:`${c}.${_}`,value:u[_]}));return p}}};function Ei(A){const c=A.value,u=A.key,p=A.styleSpec,_=A.style,x=A.validateSpec;if(!c.type)return[new Ee(u,c,'"type" is required')];const T=Kn(c.type);let L;switch(T){case"vector":case"raster":return L=oi({key:u,value:c,valueSpec:p[`source_${T.replace("-","_")}`],style:A.style,styleSpec:p,objectElementValidators:ja,validateSpec:x}),L;case"raster-dem":return L=function(P){var z;const W=(z=P.sourceName)!==null&&z!==void 0?z:"",Y=P.value,it=P.styleSpec,lt=it.source_raster_dem,ht=P.style;let Et=[];const Mt=Zt(Y);if(Y===void 0)return Et;if(Mt!=="object")return Et.push(new Ee("source_raster_dem",Y,`object expected, ${Mt} found`)),Et;const Gt=Kn(Y.encoding)==="custom",ee=["redFactor","greenFactor","blueFactor","baseShift"],Xt=P.value.encoding?`"${P.value.encoding}"`:"Default";for(const re in Y)!Gt&&ee.includes(re)?Et.push(new Ee(re,Y[re],`In "${W}": "${re}" is only valid when "encoding" is set to "custom". ${Xt} encoding found`)):lt[re]?Et=Et.concat(P.validateSpec({key:re,value:Y[re],valueSpec:lt[re],validateSpec:P.validateSpec,style:ht,styleSpec:it})):Et.push(new Ee(re,Y[re],`unknown property "${re}"`));return Et}({sourceName:u,value:c,style:A.style,styleSpec:p,validateSpec:x}),L;case"geojson":if(L=oi({key:u,value:c,valueSpec:p.source_geojson,style:_,styleSpec:p,validateSpec:x,objectElementValidators:ja}),c.cluster)for(const P in c.clusterProperties){const[z,W]=c.clusterProperties[P],Y=typeof z=="string"?[z,["accumulated"],["get",P]]:z;L.push(...Ns({key:`${u}.${P}.map`,value:W,validateSpec:x,expressionContext:"cluster-map"})),L.push(...Ns({key:`${u}.${P}.reduce`,value:Y,validateSpec:x,expressionContext:"cluster-reduce"}))}return L;case"video":return oi({key:u,value:c,valueSpec:p.source_video,style:_,validateSpec:x,styleSpec:p});case"image":return oi({key:u,value:c,valueSpec:p.source_image,style:_,validateSpec:x,styleSpec:p});case"canvas":return[new Ee(u,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return gs({key:`${u}.type`,value:c.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:_,validateSpec:x,styleSpec:p})}}function Ss(A){const c=A.value,u=A.styleSpec,p=u.light,_=A.style;let x=[];const T=Zt(c);if(c===void 0)return x;if(T!=="object")return x=x.concat([new Ee("light",c,`object expected, ${T} found`)]),x;for(const L in c){const P=L.match(/^(.*)-transition$/);x=x.concat(P&&p[P[1]]&&p[P[1]].transition?A.validateSpec({key:L,value:c[L],valueSpec:u.transition,validateSpec:A.validateSpec,style:_,styleSpec:u}):p[L]?A.validateSpec({key:L,value:c[L],valueSpec:p[L],validateSpec:A.validateSpec,style:_,styleSpec:u}):[new Ee(L,c[L],`unknown property "${L}"`)])}return x}function wa(A){const c=A.value,u=A.styleSpec,p=u.terrain,_=A.style;let x=[];const T=Zt(c);if(c===void 0)return x;if(T!=="object")return x=x.concat([new Ee("terrain",c,`object expected, ${T} found`)]),x;for(const L in c)x=x.concat(p[L]?A.validateSpec({key:L,value:c[L],valueSpec:p[L],validateSpec:A.validateSpec,style:_,styleSpec:u}):[new Ee(L,c[L],`unknown property "${L}"`)]);return x}function xc(A){let c=[];const u=A.value,p=A.key;if(Array.isArray(u)){const _=[],x=[];for(const T in u)u[T].id&&_.includes(u[T].id)&&c.push(new Ee(p,u,`all the sprites' ids must be unique, but ${u[T].id} is duplicated`)),_.push(u[T].id),u[T].url&&x.includes(u[T].url)&&c.push(new Ee(p,u,`all the sprites' URLs must be unique, but ${u[T].url} is duplicated`)),x.push(u[T].url),c=c.concat(oi({key:`${p}[${T}]`,value:u[T],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:A.validateSpec}));return c}return Es({key:p,value:u})}const Al={"*":()=>[],array:va,boolean:function(A){const c=A.value,u=A.key,p=Zt(c);return p!=="boolean"?[new Ee(u,c,`boolean expected, ${p} found`)]:[]},number:cl,color:function(A){const c=A.key,u=A.value,p=Zt(u);return p!=="string"?[new Ee(c,u,`color expected, ${p} found`)]:Yr.parse(String(u))?[]:[new Ee(c,u,`color expected, "${u}" found`)]},constants:Ku,enum:gs,filter:ms,function:rA,layer:Io,object:oi,source:Ei,light:Ss,terrain:wa,string:Es,formatted:function(A){return Es(A).length===0?[]:Ns(A)},resolvedImage:function(A){return Es(A).length===0?[]:Ns(A)},padding:function(A){const c=A.key,u=A.value;if(Zt(u)==="array"){if(u.length<1||u.length>4)return[new Ee(c,u,`padding requires 1 to 4 values; ${u.length} values found`)];const p={type:"number"};let _=[];for(let x=0;x<u.length;x++)_=_.concat(A.validateSpec({key:`${c}[${x}]`,value:u[x],validateSpec:A.validateSpec,valueSpec:p}));return _}return cl({key:c,value:u,valueSpec:{}})},variableAnchorOffsetCollection:function(A){const c=A.key,u=A.value,p=Zt(u),_=A.styleSpec;if(p!=="array"||u.length<1||u.length%2!=0)return[new Ee(c,u,"variableAnchorOffsetCollection requires a non-empty array of even length")];let x=[];for(let T=0;T<u.length;T+=2)x=x.concat(gs({key:`${c}[${T}]`,value:u[T],valueSpec:_.layout_symbol["text-anchor"]})),x=x.concat(va({key:`${c}[${T+1}]`,value:u[T+1],valueSpec:{length:2,value:"number"},validateSpec:A.validateSpec,style:A.style,styleSpec:_}));return x},sprite:xc};function Ts(A){const c=A.value,u=A.valueSpec,p=A.styleSpec;return A.validateSpec=Ts,u.expression&&ge(Kn(c))?rA(A):u.expression&&di(_a(c))?Ns(A):u.type&&Al[u.type]?Al[u.type](A):oi(Nr({},A,{valueSpec:u.type?p[u.type]:u}))}function qa(A){const c=A.value,u=A.key,p=Es(A);return p.length||(c.indexOf("{fontstack}")===-1&&p.push(new Ee(u,c,'"glyphs" url must include a "{fontstack}" token')),c.indexOf("{range}")===-1&&p.push(new Ee(u,c,'"glyphs" url must include a "{range}" token'))),p}function ys(A){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Kt,u=[];return u=u.concat(Ts({key:"",value:A,valueSpec:c.$root,styleSpec:c,style:A,validateSpec:Ts,objectElementValidators:{glyphs:qa,"*":()=>[]}})),A.constants&&(u=u.concat(Ku({key:"constants",value:A.constants,style:A,styleSpec:c,validateSpec:Ts}))),Lo(u)}function Si(A){return function(c){return A({...c,validateSpec:Ts})}}function Lo(A){return[].concat(A).sort((c,u)=>c.line-u.line)}function bn(A){return function(){for(var c=arguments.length,u=new Array(c),p=0;p<c;p++)u[p]=arguments[p];return Lo(A.apply(this,u))}}ys.source=bn(Si(Ei)),ys.sprite=bn(Si(xc)),ys.glyphs=bn(Si(qa)),ys.light=bn(Si(Ss)),ys.terrain=bn(Si(wa)),ys.layer=bn(Si(Io)),ys.filter=bn(Si(ms)),ys.paintProperty=bn(Si(ba)),ys.layoutProperty=bn(Si(ll));const wn=ys,bi=wn.light,wi=wn.paintProperty,xa=wn.layoutProperty;function Jo(A,c){let u=!1;if(c&&c.length)for(const p of c)A.fire(new ir(new Error(p.message))),u=!0;return u}class Yo{constructor(c,u,p){const _=this.cells=[];if(c instanceof ArrayBuffer){this.arrayBuffer=c;const T=new Int32Array(this.arrayBuffer);c=T[0],this.d=(u=T[1])+2*(p=T[2]);for(let P=0;P<this.d*this.d;P++){const z=T[3+P],W=T[3+P+1];_.push(z===W?null:T.subarray(z,W))}const L=T[3+_.length+1];this.keys=T.subarray(T[3+_.length],L),this.bboxes=T.subarray(L),this.insert=this._insertReadonly}else{this.d=u+2*p;for(let T=0;T<this.d*this.d;T++)_.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=c,this.padding=p,this.scale=u/c,this.uid=0;const x=p/u*c;this.min=-x,this.max=c+x}insert(c,u,p,_,x){this._forEachCell(u,p,_,x,this._insertCell,this.uid++,void 0,void 0),this.keys.push(c),this.bboxes.push(u),this.bboxes.push(p),this.bboxes.push(_),this.bboxes.push(x)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(c,u,p,_,x,T){this.cells[x].push(T)}query(c,u,p,_,x){const T=this.min,L=this.max;if(c<=T&&u<=T&&L<=p&&L<=_&&!x)return Array.prototype.slice.call(this.keys);{const P=[];return this._forEachCell(c,u,p,_,this._queryCell,P,{},x),P}}_queryCell(c,u,p,_,x,T,L,P){const z=this.cells[x];if(z!==null){const W=this.keys,Y=this.bboxes;for(let it=0;it<z.length;it++){const lt=z[it];if(L[lt]===void 0){const ht=4*lt;(P?P(Y[ht+0],Y[ht+1],Y[ht+2],Y[ht+3]):c<=Y[ht+2]&&u<=Y[ht+3]&&p>=Y[ht+0]&&_>=Y[ht+1])?(L[lt]=!0,T.push(W[lt])):L[lt]=!1}}}}_forEachCell(c,u,p,_,x,T,L,P){const z=this._convertToCellCoord(c),W=this._convertToCellCoord(u),Y=this._convertToCellCoord(p),it=this._convertToCellCoord(_);for(let lt=z;lt<=Y;lt++)for(let ht=W;ht<=it;ht++){const Et=this.d*ht+lt;if((!P||P(this._convertFromCellCoord(lt),this._convertFromCellCoord(ht),this._convertFromCellCoord(lt+1),this._convertFromCellCoord(ht+1)))&&x.call(this,c,u,p,_,Et,T,L,P))return}}_convertFromCellCoord(c){return(c-this.padding)/this.scale}_convertToCellCoord(c){return Math.max(0,Math.min(this.d-1,Math.floor(c*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const c=this.cells,u=3+this.cells.length+1+1;let p=0;for(let T=0;T<this.cells.length;T++)p+=this.cells[T].length;const _=new Int32Array(u+p+this.keys.length+this.bboxes.length);_[0]=this.extent,_[1]=this.n,_[2]=this.padding;let x=u;for(let T=0;T<c.length;T++){const L=c[T];_[3+T]=x,_.set(L,x),x+=L.length}return _[3+c.length]=x,_.set(this.keys,x),x+=this.keys.length,_[3+c.length+1]=x,_.set(this.bboxes,x),x+=this.bboxes.length,_.buffer}static serialize(c,u){const p=c.toArrayBuffer();return u&&u.push(p),{buffer:p}}static deserialize(c){return new Yo(c.buffer)}}const Fo={};function ar(A,c){let u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(Fo[A])throw new Error(`${A} is already registered.`);Object.defineProperty(c,"_classRegistryKey",{value:A,writeable:!1}),Fo[A]={klass:c,omit:u.omit||[],shallow:u.shallow||[]}}ar("Object",Object),ar("TransferableGridIndex",Yo),ar("Color",Yr),ar("Error",Error),ar("AJAXError",Ae),ar("ResolvedImage",kr),ar("StylePropertyFunction",Zs),ar("StyleExpression",hi,{omit:["_evaluator"]}),ar("ZoomDependentExpression",Ds),ar("ZoomConstantExpression",Ci),ar("CompoundExpression",es,{omit:["_evaluate"]});for(const A in yc)yc[A]._classRegistryKey||ar(`Expression_${A}`,yc[A]);function $A(A){return A&&typeof ArrayBuffer<"u"&&(A instanceof ArrayBuffer||A.constructor&&A.constructor.name==="ArrayBuffer")}function Ka(A,c){if(A==null||typeof A=="boolean"||typeof A=="number"||typeof A=="string"||A instanceof Boolean||A instanceof Number||A instanceof String||A instanceof Date||A instanceof RegExp||A instanceof Blob)return A;if($A(A)||ce(A))return c&&c.push(A),A;if(ArrayBuffer.isView(A)){const u=A;return c&&c.push(u.buffer),u}if(A instanceof ImageData)return c&&c.push(A.data.buffer),A;if(Array.isArray(A)){const u=[];for(const p of A)u.push(Ka(p,c));return u}if(typeof A=="object"){const u=A.constructor,p=u._classRegistryKey;if(!p)throw new Error("can't serialize object of unregistered class");if(!Fo[p])throw new Error(`${p} is not registered.`);const _=u.serialize?u.serialize(A,c):{};if(u.serialize){if(c&&_===c[c.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const x in A){if(!A.hasOwnProperty(x)||Fo[p].omit.indexOf(x)>=0)continue;const T=A[x];_[x]=Fo[p].shallow.indexOf(x)>=0?T:Ka(T,c)}A instanceof Error&&(_.message=A.message)}if(_.$name)throw new Error("$name property is reserved for worker serialization logic.");return p!=="Object"&&(_.$name=p),_}throw new Error("can't serialize object of type "+typeof A)}function ul(A){if(A==null||typeof A=="boolean"||typeof A=="number"||typeof A=="string"||A instanceof Boolean||A instanceof Number||A instanceof String||A instanceof Date||A instanceof RegExp||A instanceof Blob||$A(A)||ce(A)||ArrayBuffer.isView(A)||A instanceof ImageData)return A;if(Array.isArray(A))return A.map(ul);if(typeof A=="object"){const c=A.$name||"Object";if(!Fo[c])throw new Error(`can't deserialize unregistered class ${c}`);const{klass:u}=Fo[c];if(!u)throw new Error(`can't deserialize unregistered class ${c}`);if(u.deserialize)return u.deserialize(A);const p=Object.create(u.prototype);for(const _ of Object.keys(A)){if(_==="$name")continue;const x=A[_];p[_]=Fo[c].shallow.indexOf(_)>=0?x:ul(x)}return p}throw new Error("can't deserialize object of type "+typeof A)}class Yh{constructor(){this.first=!0}update(c,u){const p=Math.floor(c);return this.first?(this.first=!1,this.lastIntegerZoom=p,this.lastIntegerZoomTime=0,this.lastZoom=c,this.lastFloorZoom=p,!0):(this.lastFloorZoom>p?(this.lastIntegerZoom=p+1,this.lastIntegerZoomTime=u):this.lastFloorZoom<p&&(this.lastIntegerZoom=p,this.lastIntegerZoomTime=u),c!==this.lastZoom&&(this.lastZoom=c,this.lastFloorZoom=p,!0))}}const tr={"Latin-1 Supplement":A=>A>=128&&A<=255,Arabic:A=>A>=1536&&A<=1791,"Arabic Supplement":A=>A>=1872&&A<=1919,"Arabic Extended-A":A=>A>=2208&&A<=2303,"Hangul Jamo":A=>A>=4352&&A<=4607,"Unified Canadian Aboriginal Syllabics":A=>A>=5120&&A<=5759,Khmer:A=>A>=6016&&A<=6143,"Unified Canadian Aboriginal Syllabics Extended":A=>A>=6320&&A<=6399,"General Punctuation":A=>A>=8192&&A<=8303,"Letterlike Symbols":A=>A>=8448&&A<=8527,"Number Forms":A=>A>=8528&&A<=8591,"Miscellaneous Technical":A=>A>=8960&&A<=9215,"Control Pictures":A=>A>=9216&&A<=9279,"Optical Character Recognition":A=>A>=9280&&A<=9311,"Enclosed Alphanumerics":A=>A>=9312&&A<=9471,"Geometric Shapes":A=>A>=9632&&A<=9727,"Miscellaneous Symbols":A=>A>=9728&&A<=9983,"Miscellaneous Symbols and Arrows":A=>A>=11008&&A<=11263,"CJK Radicals Supplement":A=>A>=11904&&A<=12031,"Kangxi Radicals":A=>A>=12032&&A<=12255,"Ideographic Description Characters":A=>A>=12272&&A<=12287,"CJK Symbols and Punctuation":A=>A>=12288&&A<=12351,Hiragana:A=>A>=12352&&A<=12447,Katakana:A=>A>=12448&&A<=12543,Bopomofo:A=>A>=12544&&A<=12591,"Hangul Compatibility Jamo":A=>A>=12592&&A<=12687,Kanbun:A=>A>=12688&&A<=12703,"Bopomofo Extended":A=>A>=12704&&A<=12735,"CJK Strokes":A=>A>=12736&&A<=12783,"Katakana Phonetic Extensions":A=>A>=12784&&A<=12799,"Enclosed CJK Letters and Months":A=>A>=12800&&A<=13055,"CJK Compatibility":A=>A>=13056&&A<=13311,"CJK Unified Ideographs Extension A":A=>A>=13312&&A<=19903,"Yijing Hexagram Symbols":A=>A>=19904&&A<=19967,"CJK Unified Ideographs":A=>A>=19968&&A<=40959,"Yi Syllables":A=>A>=40960&&A<=42127,"Yi Radicals":A=>A>=42128&&A<=42191,"Hangul Jamo Extended-A":A=>A>=43360&&A<=43391,"Hangul Syllables":A=>A>=44032&&A<=55215,"Hangul Jamo Extended-B":A=>A>=55216&&A<=55295,"Private Use Area":A=>A>=57344&&A<=63743,"CJK Compatibility Ideographs":A=>A>=63744&&A<=64255,"Arabic Presentation Forms-A":A=>A>=64336&&A<=65023,"Vertical Forms":A=>A>=65040&&A<=65055,"CJK Compatibility Forms":A=>A>=65072&&A<=65103,"Small Form Variants":A=>A>=65104&&A<=65135,"Arabic Presentation Forms-B":A=>A>=65136&&A<=65279,"Halfwidth and Fullwidth Forms":A=>A>=65280&&A<=65519};function WA(A){for(const c of A)if(ks(c.charCodeAt(0)))return!0;return!1}function nA(A){for(const c of A)if(!to(c.charCodeAt(0)))return!1;return!0}function to(A){return!(tr.Arabic(A)||tr["Arabic Supplement"](A)||tr["Arabic Extended-A"](A)||tr["Arabic Presentation Forms-A"](A)||tr["Arabic Presentation Forms-B"](A))}function ks(A){return!(A!==746&&A!==747&&(A<4352||!(tr["Bopomofo Extended"](A)||tr.Bopomofo(A)||tr["CJK Compatibility Forms"](A)&&!(A>=65097&&A<=65103)||tr["CJK Compatibility Ideographs"](A)||tr["CJK Compatibility"](A)||tr["CJK Radicals Supplement"](A)||tr["CJK Strokes"](A)||!(!tr["CJK Symbols and Punctuation"](A)||A>=12296&&A<=12305||A>=12308&&A<=12319||A===12336)||tr["CJK Unified Ideographs Extension A"](A)||tr["CJK Unified Ideographs"](A)||tr["Enclosed CJK Letters and Months"](A)||tr["Hangul Compatibility Jamo"](A)||tr["Hangul Jamo Extended-A"](A)||tr["Hangul Jamo Extended-B"](A)||tr["Hangul Jamo"](A)||tr["Hangul Syllables"](A)||tr.Hiragana(A)||tr["Ideographic Description Characters"](A)||tr.Kanbun(A)||tr["Kangxi Radicals"](A)||tr["Katakana Phonetic Extensions"](A)||tr.Katakana(A)&&A!==12540||!(!tr["Halfwidth and Fullwidth Forms"](A)||A===65288||A===65289||A===65293||A>=65306&&A<=65310||A===65339||A===65341||A===65343||A>=65371&&A<=65503||A===65507||A>=65512&&A<=65519)||!(!tr["Small Form Variants"](A)||A>=65112&&A<=65118||A>=65123&&A<=65126)||tr["Unified Canadian Aboriginal Syllabics"](A)||tr["Unified Canadian Aboriginal Syllabics Extended"](A)||tr["Vertical Forms"](A)||tr["Yijing Hexagram Symbols"](A)||tr["Yi Syllables"](A)||tr["Yi Radicals"](A))))}function XA(A){return!(ks(A)||function(c){return!!(tr["Latin-1 Supplement"](c)&&(c===167||c===169||c===174||c===177||c===188||c===189||c===190||c===215||c===247)||tr["General Punctuation"](c)&&(c===8214||c===8224||c===8225||c===8240||c===8241||c===8251||c===8252||c===8258||c===8263||c===8264||c===8265||c===8273)||tr["Letterlike Symbols"](c)||tr["Number Forms"](c)||tr["Miscellaneous Technical"](c)&&(c>=8960&&c<=8967||c>=8972&&c<=8991||c>=8996&&c<=9e3||c===9003||c>=9085&&c<=9114||c>=9150&&c<=9165||c===9167||c>=9169&&c<=9179||c>=9186&&c<=9215)||tr["Control Pictures"](c)&&c!==9251||tr["Optical Character Recognition"](c)||tr["Enclosed Alphanumerics"](c)||tr["Geometric Shapes"](c)||tr["Miscellaneous Symbols"](c)&&!(c>=9754&&c<=9759)||tr["Miscellaneous Symbols and Arrows"](c)&&(c>=11026&&c<=11055||c>=11088&&c<=11097||c>=11192&&c<=11243)||tr["CJK Symbols and Punctuation"](c)||tr.Katakana(c)||tr["Private Use Area"](c)||tr["CJK Compatibility Forms"](c)||tr["Small Form Variants"](c)||tr["Halfwidth and Fullwidth Forms"](c)||c===8734||c===8756||c===8757||c>=9984&&c<=10087||c>=10102&&c<=10131||c===65532||c===65533)}(A))}function JA(A){return A>=1424&&A<=2303||tr["Arabic Presentation Forms-A"](A)||tr["Arabic Presentation Forms-B"](A)}function Zh(A,c){return!(!c&&JA(A)||A>=2304&&A<=3583||A>=3840&&A<=4255||tr.Khmer(A))}function $u(A){for(const c of A)if(JA(c.charCodeAt(0)))return!0;return!1}const iA="deferred",YA="loading",Wu="loaded";let ZA=null,_s="unavailable",Zo=null;const hl=function(A){A&&typeof A=="string"&&A.indexOf("NetworkError")>-1&&(_s="error"),ZA&&ZA(A)};function td(){tu.fire(new pr("pluginStateChange",{pluginStatus:_s,pluginURL:Zo}))}const tu=new Se,Xu=function(){return _s},Gf=function(){if(_s!==iA||!Zo)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");_s=YA,td(),Zo&&Ke({url:Zo},A=>{A?hl(A):(_s=Wu,td())})},eo={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>_s===Wu||eo.applyArabicShaping!=null,isLoading:()=>_s===YA,setState(A){if(!ae())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");_s=A.pluginStatus,Zo=A.pluginURL},isParsed(){if(!ae())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return eo.applyArabicShaping!=null&&eo.processBidirectionalText!=null&&eo.processStyledBidirectionalText!=null},getPluginURL(){if(!ae())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return Zo}};class Jn{constructor(c,u){this.zoom=c,u?(this.now=u.now,this.fadeDuration=u.fadeDuration,this.zoomHistory=u.zoomHistory,this.transition=u.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Yh,this.transition={})}isSupportedScript(c){return function(u,p){for(const _ of u)if(!Zh(_.charCodeAt(0),p))return!1;return!0}(c,eo.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const c=this.zoom,u=c-Math.floor(c),p=this.crossFadingFactor();return c>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:u+(1-u)*p}:{fromScale:.5,toScale:1,t:1-(1-p)*u}}}class Ju{constructor(c,u){this.property=c,this.value=u,this.expression=function(p,_){if(ge(p))return new Zs(p,_);if(di(p)){const x=Os(p,_);if(x.result==="error")throw new Error(x.value.map(T=>`${T.key}: ${T.message}`).join(", "));return x.value}{let x=p;return _.type==="color"&&typeof p=="string"?x=Yr.parse(p):_.type!=="padding"||typeof p!="number"&&!Array.isArray(p)?_.type==="variableAnchorOffsetCollection"&&Array.isArray(p)&&(x=Ii.parse(p)):x=Gi.parse(p),{kind:"constant",evaluate:()=>x}}}(u===void 0?c.specification.default:u,c.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(c,u,p){return this.property.possiblyEvaluate(this,c,u,p)}}class ed{constructor(c){this.property=c,this.value=new Ju(c,void 0)}transitioned(c,u){return new Zu(this.property,this.value,u,ft({},c.transition,this.transition),c.now)}untransitioned(){return new Zu(this.property,this.value,null,{},0)}}class Yu{constructor(c){this._properties=c,this._values=Object.create(c.defaultTransitionablePropertyValues)}getValue(c){return At(this._values[c].value.value)}setValue(c,u){Object.prototype.hasOwnProperty.call(this._values,c)||(this._values[c]=new ed(this._values[c].property)),this._values[c].value=new Ju(this._values[c].property,u===null?void 0:At(u))}getTransition(c){return At(this._values[c].transition)}setTransition(c,u){Object.prototype.hasOwnProperty.call(this._values,c)||(this._values[c]=new ed(this._values[c].property)),this._values[c].transition=At(u)||void 0}serialize(){const c={};for(const u of Object.keys(this._values)){const p=this.getValue(u);p!==void 0&&(c[u]=p);const _=this.getTransition(u);_!==void 0&&(c[`${u}-transition`]=_)}return c}transitioned(c,u){const p=new sA(this._properties);for(const _ of Object.keys(this._values))p._values[_]=this._values[_].transitioned(c,u._values[_]);return p}untransitioned(){const c=new sA(this._properties);for(const u of Object.keys(this._values))c._values[u]=this._values[u].untransitioned();return c}}class Zu{constructor(c,u,p,_,x){this.property=c,this.value=u,this.begin=x+_.delay||0,this.end=this.begin+_.duration||0,c.specification.transition&&(_.delay||_.duration)&&(this.prior=p)}possiblyEvaluate(c,u,p){const _=c.now||0,x=this.value.possiblyEvaluate(c,u,p),T=this.prior;if(T){if(_>this.end)return this.prior=null,x;if(this.value.isDataDriven())return this.prior=null,x;if(_<this.begin)return T.possiblyEvaluate(c,u,p);{const L=(_-this.begin)/(this.end-this.begin);return this.property.interpolate(T.possiblyEvaluate(c,u,p),x,function(P){if(P<=0)return 0;if(P>=1)return 1;const z=P*P,W=z*P;return 4*(P<.5?W:3*(P-z)+W-.75)}(L))}}return x}}class sA{constructor(c){this._properties=c,this._values=Object.create(c.defaultTransitioningPropertyValues)}possiblyEvaluate(c,u,p){const _=new eu(this._properties);for(const x of Object.keys(this._values))_._values[x]=this._values[x].possiblyEvaluate(c,u,p);return _}hasTransition(){for(const c of Object.keys(this._values))if(this._values[c].prior)return!0;return!1}}class tm{constructor(c){this._properties=c,this._values=Object.create(c.defaultPropertyValues)}hasValue(c){return this._values[c].value!==void 0}getValue(c){return At(this._values[c].value)}setValue(c,u){this._values[c]=new Ju(this._values[c].property,u===null?void 0:At(u))}serialize(){const c={};for(const u of Object.keys(this._values)){const p=this.getValue(u);p!==void 0&&(c[u]=p)}return c}possiblyEvaluate(c,u,p){const _=new eu(this._properties);for(const x of Object.keys(this._values))_._values[x]=this._values[x].possiblyEvaluate(c,u,p);return _}}class Is{constructor(c,u,p){this.property=c,this.value=u,this.parameters=p}isConstant(){return this.value.kind==="constant"}constantOr(c){return this.value.kind==="constant"?this.value.value:c}evaluate(c,u,p,_){return this.property.evaluate(this.value,this.parameters,c,u,p,_)}}class eu{constructor(c){this._properties=c,this._values=Object.create(c.defaultPossiblyEvaluatedValues)}get(c){return this._values[c]}}class vr{constructor(c){this.specification=c}possiblyEvaluate(c,u){if(c.isDataDriven())throw new Error("Value should not be data driven");return c.expression.evaluate(u)}interpolate(c,u,p){const _=Fi[this.specification.type];return _?_(c,u,p):c}}class Mr{constructor(c,u){this.specification=c,this.overrides=u}possiblyEvaluate(c,u,p,_){return new Is(this,c.expression.kind==="constant"||c.expression.kind==="camera"?{kind:"constant",value:c.expression.evaluate(u,null,{},p,_)}:c.expression,u)}interpolate(c,u,p){if(c.value.kind!=="constant"||u.value.kind!=="constant")return c;if(c.value.value===void 0||u.value.value===void 0)return new Is(this,{kind:"constant",value:void 0},c.parameters);const _=Fi[this.specification.type];if(_){const x=_(c.value.value,u.value.value,p);return new Is(this,{kind:"constant",value:x},c.parameters)}return c}evaluate(c,u,p,_,x,T){return c.kind==="constant"?c.value:c.evaluate(u,p,_,x,T)}}class ru extends Mr{possiblyEvaluate(c,u,p,_){if(c.value===void 0)return new Is(this,{kind:"constant",value:void 0},u);if(c.expression.kind==="constant"){const x=c.expression.evaluate(u,null,{},p,_),T=c.property.specification.type==="resolvedImage"&&typeof x!="string"?x.name:x,L=this._calculate(T,T,T,u);return new Is(this,{kind:"constant",value:L},u)}if(c.expression.kind==="camera"){const x=this._calculate(c.expression.evaluate({zoom:u.zoom-1}),c.expression.evaluate({zoom:u.zoom}),c.expression.evaluate({zoom:u.zoom+1}),u);return new Is(this,{kind:"constant",value:x},u)}return new Is(this,c.expression,u)}evaluate(c,u,p,_,x,T){if(c.kind==="source"){const L=c.evaluate(u,p,_,x,T);return this._calculate(L,L,L,u)}return c.kind==="composite"?this._calculate(c.evaluate({zoom:Math.floor(u.zoom)-1},p,_),c.evaluate({zoom:Math.floor(u.zoom)},p,_),c.evaluate({zoom:Math.floor(u.zoom)+1},p,_),u):c.value}_calculate(c,u,p,_){return _.zoom>_.zoomHistory.lastIntegerZoom?{from:c,to:u}:{from:p,to:u}}interpolate(c){return c}}class rd{constructor(c){this.specification=c}possiblyEvaluate(c,u,p,_){if(c.value!==void 0){if(c.expression.kind==="constant"){const x=c.expression.evaluate(u,null,{},p,_);return this._calculate(x,x,x,u)}return this._calculate(c.expression.evaluate(new Jn(Math.floor(u.zoom-1),u)),c.expression.evaluate(new Jn(Math.floor(u.zoom),u)),c.expression.evaluate(new Jn(Math.floor(u.zoom+1),u)),u)}}_calculate(c,u,p,_){return _.zoom>_.zoomHistory.lastIntegerZoom?{from:c,to:u}:{from:p,to:u}}interpolate(c){return c}}class Ba{constructor(c){this.specification=c}possiblyEvaluate(c,u,p,_){return!!c.expression.evaluate(u,null,{},p,_)}interpolate(){return!1}}class In{constructor(c){this.properties=c,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const u in c){const p=c[u];p.specification.overridable&&this.overridableProperties.push(u);const _=this.defaultPropertyValues[u]=new Ju(p,void 0),x=this.defaultTransitionablePropertyValues[u]=new ed(p);this.defaultTransitioningPropertyValues[u]=x.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=_.possiblyEvaluate({})}}}ar("DataDrivenProperty",Mr),ar("DataConstantProperty",vr),ar("CrossFadedDataDrivenProperty",ru),ar("CrossFadedProperty",rd),ar("ColorRampProperty",Ba);const ta="-transition";class Mo extends Se{constructor(c,u){if(super(),this.id=c.id,this.type=c.type,this._featureFilter={filter:()=>!0,needGeometry:!1},c.type!=="custom"&&(this.metadata=c.metadata,this.minzoom=c.minzoom,this.maxzoom=c.maxzoom,c.type!=="background"&&(this.source=c.source,this.sourceLayer=c["source-layer"],this.filter=c.filter),u.layout&&(this._unevaluatedLayout=new tm(u.layout)),u.paint)){this._transitionablePaint=new Yu(u.paint);for(const p in c.paint)this.setPaintProperty(p,c.paint[p],{validate:!1});for(const p in c.layout)this.setLayoutProperty(p,c.layout[p],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new eu(u.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(c){return c==="visibility"?this.visibility:this._unevaluatedLayout.getValue(c)}setLayoutProperty(c,u){let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};u!=null&&this._validate(xa,`layers.${this.id}.layout.${c}`,c,u,p)||(c!=="visibility"?this._unevaluatedLayout.setValue(c,u):this.visibility=u)}getPaintProperty(c){return c.endsWith(ta)?this._transitionablePaint.getTransition(c.slice(0,-11)):this._transitionablePaint.getValue(c)}setPaintProperty(c,u){let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(u!=null&&this._validate(wi,`layers.${this.id}.paint.${c}`,c,u,p))return!1;if(c.endsWith(ta))return this._transitionablePaint.setTransition(c.slice(0,-11),u||void 0),!1;{const _=this._transitionablePaint._values[c],x=_.property.specification["property-type"]==="cross-faded-data-driven",T=_.value.isDataDriven(),L=_.value;this._transitionablePaint.setValue(c,u),this._handleSpecialPaintPropertyUpdate(c);const P=this._transitionablePaint._values[c].value;return P.isDataDriven()||T||x||this._handleOverridablePaintPropertyUpdate(c,L,P)}}_handleSpecialPaintPropertyUpdate(c){}_handleOverridablePaintPropertyUpdate(c,u,p){return!1}isHidden(c){return!!(this.minzoom&&c<this.minzoom)||!!(this.maxzoom&&c>=this.maxzoom)||this.visibility==="none"}updateTransitions(c){this._transitioningPaint=this._transitionablePaint.transitioned(c,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(c,u){c.getCrossfadeParameters&&(this._crossfadeParameters=c.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(c,void 0,u)),this.paint=this._transitioningPaint.possiblyEvaluate(c,void 0,u)}serialize(){const c={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(c.layout=c.layout||{},c.layout.visibility=this.visibility),ut(c,(u,p)=>!(u===void 0||p==="layout"&&!Object.keys(u).length||p==="paint"&&!Object.keys(u).length))}_validate(c,u,p,_){let x=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};return(!x||x.validate!==!1)&&Jo(this,c.call(wn,{key:u,layerType:this.type,objectKey:p,value:_,styleSpec:Kt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const c in this.paint._values){const u=this.paint.get(c);if(u instanceof Is&&nt(u.property.specification)&&(u.value.kind==="source"||u.value.kind==="composite")&&u.value.isStateDependent)return!0}return!1}}const nd={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Qs{constructor(c,u){this._structArray=c,this._pos1=u*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class xn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(c,u){return c._trim(),u&&(c.isTransferred=!0,u.push(c.arrayBuffer)),{length:c.length,arrayBuffer:c.arrayBuffer}}static deserialize(c){const u=Object.create(this.prototype);return u.arrayBuffer=c.arrayBuffer,u.length=c.length,u.capacity=c.arrayBuffer.byteLength/u.bytesPerElement,u._refreshViews(),u}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(c){this.reserve(c),this.length=c}reserve(c){if(c>this.capacity){this.capacity=Math.max(c,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const u=this.uint8;this._refreshViews(),u&&this.uint8.set(u)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function ai(A){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,u=0,p=0;return{members:A.map(_=>{const x=nd[_.type].BYTES_PER_ELEMENT,T=u=oA(u,Math.max(c,x)),L=_.components||1;return p=Math.max(p,x),u+=x*L,{name:_.name,type:_.type,components:L,offset:T}}),size:oA(u,Math.max(p,c)),alignment:c}}function oA(A,c){return Math.ceil(A/c)*c}class aA extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,u){const p=this.length;return this.resize(p+1),this.emplace(p,c,u)}emplace(c,u,p){const _=2*c;return this.int16[_+0]=u,this.int16[_+1]=p,c}}aA.prototype.bytesPerElement=4,ar("StructArrayLayout2i4",aA);class cA extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,u,p){const _=this.length;return this.resize(_+1),this.emplace(_,c,u,p)}emplace(c,u,p,_){const x=3*c;return this.int16[x+0]=u,this.int16[x+1]=p,this.int16[x+2]=_,c}}cA.prototype.bytesPerElement=6,ar("StructArrayLayout3i6",cA);class Bc extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,u,p,_){const x=this.length;return this.resize(x+1),this.emplace(x,c,u,p,_)}emplace(c,u,p,_,x){const T=4*c;return this.int16[T+0]=u,this.int16[T+1]=p,this.int16[T+2]=_,this.int16[T+3]=x,c}}Bc.prototype.bytesPerElement=8,ar("StructArrayLayout4i8",Bc);class th extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,u,p,_,x,T){const L=this.length;return this.resize(L+1),this.emplace(L,c,u,p,_,x,T)}emplace(c,u,p,_,x,T,L){const P=6*c;return this.int16[P+0]=u,this.int16[P+1]=p,this.int16[P+2]=_,this.int16[P+3]=x,this.int16[P+4]=T,this.int16[P+5]=L,c}}th.prototype.bytesPerElement=12,ar("StructArrayLayout2i4i12",th);class id extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,u,p,_,x,T){const L=this.length;return this.resize(L+1),this.emplace(L,c,u,p,_,x,T)}emplace(c,u,p,_,x,T,L){const P=4*c,z=8*c;return this.int16[P+0]=u,this.int16[P+1]=p,this.uint8[z+4]=_,this.uint8[z+5]=x,this.uint8[z+6]=T,this.uint8[z+7]=L,c}}id.prototype.bytesPerElement=8,ar("StructArrayLayout2i4ub8",id);class $a extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,u){const p=this.length;return this.resize(p+1),this.emplace(p,c,u)}emplace(c,u,p){const _=2*c;return this.float32[_+0]=u,this.float32[_+1]=p,c}}$a.prototype.bytesPerElement=8,ar("StructArrayLayout2f8",$a);class lA extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,u,p,_,x,T,L,P,z,W){const Y=this.length;return this.resize(Y+1),this.emplace(Y,c,u,p,_,x,T,L,P,z,W)}emplace(c,u,p,_,x,T,L,P,z,W,Y){const it=10*c;return this.uint16[it+0]=u,this.uint16[it+1]=p,this.uint16[it+2]=_,this.uint16[it+3]=x,this.uint16[it+4]=T,this.uint16[it+5]=L,this.uint16[it+6]=P,this.uint16[it+7]=z,this.uint16[it+8]=W,this.uint16[it+9]=Y,c}}lA.prototype.bytesPerElement=20,ar("StructArrayLayout10ui20",lA);class dl extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,u,p,_,x,T,L,P,z,W,Y,it){const lt=this.length;return this.resize(lt+1),this.emplace(lt,c,u,p,_,x,T,L,P,z,W,Y,it)}emplace(c,u,p,_,x,T,L,P,z,W,Y,it,lt){const ht=12*c;return this.int16[ht+0]=u,this.int16[ht+1]=p,this.int16[ht+2]=_,this.int16[ht+3]=x,this.uint16[ht+4]=T,this.uint16[ht+5]=L,this.uint16[ht+6]=P,this.uint16[ht+7]=z,this.int16[ht+8]=W,this.int16[ht+9]=Y,this.int16[ht+10]=it,this.int16[ht+11]=lt,c}}dl.prototype.bytesPerElement=24,ar("StructArrayLayout4i4ui4i24",dl);class _n extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,u,p){const _=this.length;return this.resize(_+1),this.emplace(_,c,u,p)}emplace(c,u,p,_){const x=3*c;return this.float32[x+0]=u,this.float32[x+1]=p,this.float32[x+2]=_,c}}_n.prototype.bytesPerElement=12,ar("StructArrayLayout3f12",_n);class w extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(c){const u=this.length;return this.resize(u+1),this.emplace(u,c)}emplace(c,u){return this.uint32[1*c+0]=u,c}}w.prototype.bytesPerElement=4,ar("StructArrayLayout1ul4",w);class l extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,u,p,_,x,T,L,P,z){const W=this.length;return this.resize(W+1),this.emplace(W,c,u,p,_,x,T,L,P,z)}emplace(c,u,p,_,x,T,L,P,z,W){const Y=10*c,it=5*c;return this.int16[Y+0]=u,this.int16[Y+1]=p,this.int16[Y+2]=_,this.int16[Y+3]=x,this.int16[Y+4]=T,this.int16[Y+5]=L,this.uint32[it+3]=P,this.uint16[Y+8]=z,this.uint16[Y+9]=W,c}}l.prototype.bytesPerElement=20,ar("StructArrayLayout6i1ul2ui20",l);class d extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,u,p,_,x,T){const L=this.length;return this.resize(L+1),this.emplace(L,c,u,p,_,x,T)}emplace(c,u,p,_,x,T,L){const P=6*c;return this.int16[P+0]=u,this.int16[P+1]=p,this.int16[P+2]=_,this.int16[P+3]=x,this.int16[P+4]=T,this.int16[P+5]=L,c}}d.prototype.bytesPerElement=12,ar("StructArrayLayout2i2i2i12",d);class m extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,u,p,_,x){const T=this.length;return this.resize(T+1),this.emplace(T,c,u,p,_,x)}emplace(c,u,p,_,x,T){const L=4*c,P=8*c;return this.float32[L+0]=u,this.float32[L+1]=p,this.float32[L+2]=_,this.int16[P+6]=x,this.int16[P+7]=T,c}}m.prototype.bytesPerElement=16,ar("StructArrayLayout2f1f2i16",m);class v extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,u,p,_){const x=this.length;return this.resize(x+1),this.emplace(x,c,u,p,_)}emplace(c,u,p,_,x){const T=12*c,L=3*c;return this.uint8[T+0]=u,this.uint8[T+1]=p,this.float32[L+1]=_,this.float32[L+2]=x,c}}v.prototype.bytesPerElement=12,ar("StructArrayLayout2ub2f12",v);class E extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,u,p){const _=this.length;return this.resize(_+1),this.emplace(_,c,u,p)}emplace(c,u,p,_){const x=3*c;return this.uint16[x+0]=u,this.uint16[x+1]=p,this.uint16[x+2]=_,c}}E.prototype.bytesPerElement=6,ar("StructArrayLayout3ui6",E);class F extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,u,p,_,x,T,L,P,z,W,Y,it,lt,ht,Et,Mt,Gt){const ee=this.length;return this.resize(ee+1),this.emplace(ee,c,u,p,_,x,T,L,P,z,W,Y,it,lt,ht,Et,Mt,Gt)}emplace(c,u,p,_,x,T,L,P,z,W,Y,it,lt,ht,Et,Mt,Gt,ee){const Xt=24*c,re=12*c,de=48*c;return this.int16[Xt+0]=u,this.int16[Xt+1]=p,this.uint16[Xt+2]=_,this.uint16[Xt+3]=x,this.uint32[re+2]=T,this.uint32[re+3]=L,this.uint32[re+4]=P,this.uint16[Xt+10]=z,this.uint16[Xt+11]=W,this.uint16[Xt+12]=Y,this.float32[re+7]=it,this.float32[re+8]=lt,this.uint8[de+36]=ht,this.uint8[de+37]=Et,this.uint8[de+38]=Mt,this.uint32[re+10]=Gt,this.int16[Xt+22]=ee,c}}F.prototype.bytesPerElement=48,ar("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",F);class M extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,u,p,_,x,T,L,P,z,W,Y,it,lt,ht,Et,Mt,Gt,ee,Xt,re,de,xe,nr,gr,er,Ye,$e,lr){const Xe=this.length;return this.resize(Xe+1),this.emplace(Xe,c,u,p,_,x,T,L,P,z,W,Y,it,lt,ht,Et,Mt,Gt,ee,Xt,re,de,xe,nr,gr,er,Ye,$e,lr)}emplace(c,u,p,_,x,T,L,P,z,W,Y,it,lt,ht,Et,Mt,Gt,ee,Xt,re,de,xe,nr,gr,er,Ye,$e,lr,Xe){const Re=32*c,Lr=16*c;return this.int16[Re+0]=u,this.int16[Re+1]=p,this.int16[Re+2]=_,this.int16[Re+3]=x,this.int16[Re+4]=T,this.int16[Re+5]=L,this.int16[Re+6]=P,this.int16[Re+7]=z,this.uint16[Re+8]=W,this.uint16[Re+9]=Y,this.uint16[Re+10]=it,this.uint16[Re+11]=lt,this.uint16[Re+12]=ht,this.uint16[Re+13]=Et,this.uint16[Re+14]=Mt,this.uint16[Re+15]=Gt,this.uint16[Re+16]=ee,this.uint16[Re+17]=Xt,this.uint16[Re+18]=re,this.uint16[Re+19]=de,this.uint16[Re+20]=xe,this.uint16[Re+21]=nr,this.uint16[Re+22]=gr,this.uint32[Lr+12]=er,this.float32[Lr+13]=Ye,this.float32[Lr+14]=$e,this.uint16[Re+30]=lr,this.uint16[Re+31]=Xe,c}}M.prototype.bytesPerElement=64,ar("StructArrayLayout8i15ui1ul2f2ui64",M);class N extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c){const u=this.length;return this.resize(u+1),this.emplace(u,c)}emplace(c,u){return this.float32[1*c+0]=u,c}}N.prototype.bytesPerElement=4,ar("StructArrayLayout1f4",N);class G extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,u,p){const _=this.length;return this.resize(_+1),this.emplace(_,c,u,p)}emplace(c,u,p,_){const x=3*c;return this.uint16[6*c+0]=u,this.float32[x+1]=p,this.float32[x+2]=_,c}}G.prototype.bytesPerElement=12,ar("StructArrayLayout1ui2f12",G);class $ extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,u,p){const _=this.length;return this.resize(_+1),this.emplace(_,c,u,p)}emplace(c,u,p,_){const x=4*c;return this.uint32[2*c+0]=u,this.uint16[x+2]=p,this.uint16[x+3]=_,c}}$.prototype.bytesPerElement=8,ar("StructArrayLayout1ul2ui8",$);class J extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,u){const p=this.length;return this.resize(p+1),this.emplace(p,c,u)}emplace(c,u,p){const _=2*c;return this.uint16[_+0]=u,this.uint16[_+1]=p,c}}J.prototype.bytesPerElement=4,ar("StructArrayLayout2ui4",J);class ct extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c){const u=this.length;return this.resize(u+1),this.emplace(u,c)}emplace(c,u){return this.uint16[1*c+0]=u,c}}ct.prototype.bytesPerElement=2,ar("StructArrayLayout1ui2",ct);class Ct extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,u,p,_){const x=this.length;return this.resize(x+1),this.emplace(x,c,u,p,_)}emplace(c,u,p,_,x){const T=4*c;return this.float32[T+0]=u,this.float32[T+1]=p,this.float32[T+2]=_,this.float32[T+3]=x,c}}Ct.prototype.bytesPerElement=16,ar("StructArrayLayout4f16",Ct);class y extends Qs{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new C(this.anchorPointX,this.anchorPointY)}}y.prototype.size=20;class S extends l{get(c){return new y(this,c)}}ar("CollisionBoxArray",S);class I extends Qs{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(c){this._structArray.uint8[this._pos1+37]=c}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(c){this._structArray.uint8[this._pos1+38]=c}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(c){this._structArray.uint32[this._pos4+10]=c}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}I.prototype.size=48;class O extends F{get(c){return new I(this,c)}}ar("PlacedSymbolArray",O);class V extends Qs{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(c){this._structArray.uint32[this._pos4+12]=c}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}V.prototype.size=64;class H extends M{get(c){return new V(this,c)}}ar("SymbolInstanceArray",H);class q extends N{getoffsetX(c){return this.float32[1*c+0]}}ar("GlyphOffsetArray",q);class X extends cA{getx(c){return this.int16[3*c+0]}gety(c){return this.int16[3*c+1]}gettileUnitDistanceFromAnchor(c){return this.int16[3*c+2]}}ar("SymbolLineVertexArray",X);class Z extends Qs{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Z.prototype.size=12;class ot extends G{get(c){return new Z(this,c)}}ar("TextAnchorOffsetArray",ot);class xt extends Qs{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}xt.prototype.size=8;class Lt extends ${get(c){return new xt(this,c)}}ar("FeatureIndexArray",Lt);class kt extends aA{}class zt extends aA{}class me extends aA{}class Wt extends th{}class Ot extends id{}class Nt extends $a{}class be extends lA{}class ve extends dl{}class he extends _n{}class Le extends w{}class Oe extends d{}class sr extends v{}class Ge extends E{}class zr extends J{}const Hr=ai([{name:"a_pos",components:2,type:"Int16"}],4),{members:tn}=Hr;class Sr{constructor(){let c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];this.segments=c}prepareSegment(c,u,p,_){let x=this.segments[this.segments.length-1];return c>Sr.MAX_VERTEX_ARRAY_LENGTH&&vt(`Max vertices per segment is ${Sr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${c}`),(!x||x.vertexLength+c>Sr.MAX_VERTEX_ARRAY_LENGTH||x.sortKey!==_)&&(x={vertexOffset:u.length,primitiveOffset:p.length,vertexLength:0,primitiveLength:0},_!==void 0&&(x.sortKey=_),this.segments.push(x)),x}get(){return this.segments}destroy(){for(const c of this.segments)for(const u in c.vaos)c.vaos[u].destroy()}static simpleSegment(c,u,p,_){return new Sr([{vertexOffset:c,primitiveOffset:u,vertexLength:p,primitiveLength:_,vaos:{},sortKey:0}])}}function pn(A,c){return 256*(A=pt(Math.floor(A),0,255))+pt(Math.floor(c),0,255)}Sr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ar("SegmentVector",Sr);const hn=ai([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Gr={exports:{}},Yn={exports:{}};Yn.exports=function(A,c){var u,p,_,x,T,L,P,z;for(p=A.length-(u=3&A.length),_=c,T=3432918353,L=461845907,z=0;z<p;)P=255&A.charCodeAt(z)|(255&A.charCodeAt(++z))<<8|(255&A.charCodeAt(++z))<<16|(255&A.charCodeAt(++z))<<24,++z,_=27492+(65535&(x=5*(65535&(_=(_^=P=(65535&(P=(P=(65535&P)*T+(((P>>>16)*T&65535)<<16)&4294967295)<<15|P>>>17))*L+(((P>>>16)*L&65535)<<16)&4294967295)<<13|_>>>19))+((5*(_>>>16)&65535)<<16)&4294967295))+((58964+(x>>>16)&65535)<<16);switch(P=0,u){case 3:P^=(255&A.charCodeAt(z+2))<<16;case 2:P^=(255&A.charCodeAt(z+1))<<8;case 1:_^=P=(65535&(P=(P=(65535&(P^=255&A.charCodeAt(z)))*T+(((P>>>16)*T&65535)<<16)&4294967295)<<15|P>>>17))*L+(((P>>>16)*L&65535)<<16)&4294967295}return _^=A.length,_=2246822507*(65535&(_^=_>>>16))+((2246822507*(_>>>16)&65535)<<16)&4294967295,_=3266489909*(65535&(_^=_>>>13))+((3266489909*(_>>>16)&65535)<<16)&4294967295,(_^=_>>>16)>>>0};var Pi=Yn.exports,vn={exports:{}};vn.exports=function(A,c){for(var u,p=A.length,_=c^p,x=0;p>=4;)u=1540483477*(65535&(u=255&A.charCodeAt(x)|(255&A.charCodeAt(++x))<<8|(255&A.charCodeAt(++x))<<16|(255&A.charCodeAt(++x))<<24))+((1540483477*(u>>>16)&65535)<<16),_=1540483477*(65535&_)+((1540483477*(_>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),p-=4,++x;switch(p){case 3:_^=(255&A.charCodeAt(x+2))<<16;case 2:_^=(255&A.charCodeAt(x+1))<<8;case 1:_=1540483477*(65535&(_^=255&A.charCodeAt(x)))+((1540483477*(_>>>16)&65535)<<16)}return _=1540483477*(65535&(_^=_>>>13))+((1540483477*(_>>>16)&65535)<<16),(_^=_>>>15)>>>0};var Fn=Pi,en=vn.exports;Gr.exports=Fn,Gr.exports.murmur3=Fn,Gr.exports.murmur2=en;var Ui=f(Gr.exports);class Bn{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(c,u,p,_){this.ids.push(gn(c)),this.positions.push(u,p,_)}getPositions(c){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const u=gn(c);let p=0,_=this.ids.length-1;for(;p<_;){const T=p+_>>1;this.ids[T]>=u?_=T:p=T+1}const x=[];for(;this.ids[p]===u;)x.push({index:this.positions[3*p],start:this.positions[3*p+1],end:this.positions[3*p+2]}),p++;return x}static serialize(c,u){const p=new Float64Array(c.ids),_=new Uint32Array(c.positions);return Mn(p,_,0,p.length-1),u&&u.push(p.buffer,_.buffer),{ids:p,positions:_}}static deserialize(c){const u=new Bn;return u.ids=c.ids,u.positions=c.positions,u.indexed=!0,u}}function gn(A){const c=+A;return!isNaN(c)&&c<=Number.MAX_SAFE_INTEGER?c:Ui(String(A))}function Mn(A,c,u,p){for(;u<p;){const _=A[u+p>>1];let x=u-1,T=p+1;for(;;){do x++;while(A[x]<_);do T--;while(A[T]>_);if(x>=T)break;mn(A,x,T),mn(c,3*x,3*T),mn(c,3*x+1,3*T+1),mn(c,3*x+2,3*T+2)}T-u<p-T?(Mn(A,c,u,T),u=T+1):(Mn(A,c,T+1,p),p=T)}}function mn(A,c,u){const p=A[c];A[c]=A[u],A[u]=p}ar("FeaturePositionMap",Bn);class Vi{constructor(c,u){this.gl=c.gl,this.location=u}}class ro extends Vi{constructor(c,u){super(c,u),this.current=0}set(c){this.current!==c&&(this.current=c,this.gl.uniform1f(this.location,c))}}class Ri extends Vi{constructor(c,u){super(c,u),this.current=[0,0,0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]&&c[3]===this.current[3]||(this.current=c,this.gl.uniform4f(this.location,c[0],c[1],c[2],c[3]))}}class Ca extends Vi{constructor(c,u){super(c,u),this.current=Yr.transparent}set(c){c.r===this.current.r&&c.g===this.current.g&&c.b===this.current.b&&c.a===this.current.a||(this.current=c,this.gl.uniform4f(this.location,c.r,c.g,c.b,c.a))}}const fl=new Float32Array(16);function Cc(A){return[pn(255*A.r,255*A.g),pn(255*A.b,255*A.a)]}class is{constructor(c,u,p){this.value=c,this.uniformNames=u.map(_=>`u_${_}`),this.type=p}setUniform(c,u,p){c.set(p.constantOr(this.value))}getBinding(c,u,p){return this.type==="color"?new Ca(c,u):new ro(c,u)}}class Hn{constructor(c,u){this.uniformNames=u.map(p=>`u_${p}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(c,u){this.pixelRatioFrom=u.pixelRatio,this.pixelRatioTo=c.pixelRatio,this.patternFrom=u.tlbr,this.patternTo=c.tlbr}setUniform(c,u,p,_){const x=_==="u_pattern_to"?this.patternTo:_==="u_pattern_from"?this.patternFrom:_==="u_pixel_ratio_to"?this.pixelRatioTo:_==="u_pixel_ratio_from"?this.pixelRatioFrom:null;x&&c.set(x)}getBinding(c,u,p){return p.substr(0,9)==="u_pattern"?new Ri(c,u):new ro(c,u)}}class Po{constructor(c,u,p,_){this.expression=c,this.type=p,this.maxValue=0,this.paintVertexAttributes=u.map(x=>({name:`a_${x}`,type:"Float32",components:p==="color"?2:1,offset:0})),this.paintVertexArray=new _}populatePaintArray(c,u,p,_,x){const T=this.paintVertexArray.length,L=this.expression.evaluate(new Jn(0),u,{},_,[],x);this.paintVertexArray.resize(c),this._setPaintValue(T,c,L)}updatePaintArray(c,u,p,_){const x=this.expression.evaluate({zoom:0},p,_);this._setPaintValue(c,u,x)}_setPaintValue(c,u,p){if(this.type==="color"){const _=Cc(p);for(let x=c;x<u;x++)this.paintVertexArray.emplace(x,_[0],_[1])}else{for(let _=c;_<u;_++)this.paintVertexArray.emplace(_,p);this.maxValue=Math.max(this.maxValue,Math.abs(p))}}upload(c){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=c.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class no{constructor(c,u,p,_,x,T){this.expression=c,this.uniformNames=u.map(L=>`u_${L}_t`),this.type=p,this.useIntegerZoom=_,this.zoom=x,this.maxValue=0,this.paintVertexAttributes=u.map(L=>({name:`a_${L}`,type:"Float32",components:p==="color"?4:2,offset:0})),this.paintVertexArray=new T}populatePaintArray(c,u,p,_,x){const T=this.expression.evaluate(new Jn(this.zoom),u,{},_,[],x),L=this.expression.evaluate(new Jn(this.zoom+1),u,{},_,[],x),P=this.paintVertexArray.length;this.paintVertexArray.resize(c),this._setPaintValue(P,c,T,L)}updatePaintArray(c,u,p,_){const x=this.expression.evaluate({zoom:this.zoom},p,_),T=this.expression.evaluate({zoom:this.zoom+1},p,_);this._setPaintValue(c,u,x,T)}_setPaintValue(c,u,p,_){if(this.type==="color"){const x=Cc(p),T=Cc(_);for(let L=c;L<u;L++)this.paintVertexArray.emplace(L,x[0],x[1],T[0],T[1])}else{for(let x=c;x<u;x++)this.paintVertexArray.emplace(x,p,_);this.maxValue=Math.max(this.maxValue,Math.abs(p),Math.abs(_))}}upload(c){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=c.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(c,u){const p=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,_=pt(this.expression.interpolationFactor(p,this.zoom,this.zoom+1),0,1);c.set(_)}getBinding(c,u,p){return new ro(c,u)}}class ea{constructor(c,u,p,_,x,T){this.expression=c,this.type=u,this.useIntegerZoom=p,this.zoom=_,this.layerId=T,this.zoomInPaintVertexArray=new x,this.zoomOutPaintVertexArray=new x}populatePaintArray(c,u,p){const _=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(c),this.zoomOutPaintVertexArray.resize(c),this._setPaintValues(_,c,u.patterns&&u.patterns[this.layerId],p)}updatePaintArray(c,u,p,_,x){this._setPaintValues(c,u,p.patterns&&p.patterns[this.layerId],x)}_setPaintValues(c,u,p,_){if(!_||!p)return;const{min:x,mid:T,max:L}=p,P=_[x],z=_[T],W=_[L];if(P&&z&&W)for(let Y=c;Y<u;Y++)this.zoomInPaintVertexArray.emplace(Y,z.tl[0],z.tl[1],z.br[0],z.br[1],P.tl[0],P.tl[1],P.br[0],P.br[1],z.pixelRatio,P.pixelRatio),this.zoomOutPaintVertexArray.emplace(Y,z.tl[0],z.tl[1],z.br[0],z.br[1],W.tl[0],W.tl[1],W.br[0],W.br[1],z.pixelRatio,W.pixelRatio)}upload(c){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=c.createVertexBuffer(this.zoomInPaintVertexArray,hn.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=c.createVertexBuffer(this.zoomOutPaintVertexArray,hn.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class AA{constructor(c,u,p){this.binders={},this._buffers=[];const _=[];for(const x in c.paint._values){if(!p(x))continue;const T=c.paint.get(x);if(!(T instanceof Is&&nt(T.property.specification)))continue;const L=Vf(x,c.type),P=T.value,z=T.property.specification.type,W=T.property.useIntegerZoom,Y=T.property.specification["property-type"],it=Y==="cross-faded"||Y==="cross-faded-data-driven";if(P.kind==="constant")this.binders[x]=it?new Hn(P.value,L):new is(P.value,L,z),_.push(`/u_${x}`);else if(P.kind==="source"||it){const lt=Ea(x,z,"source");this.binders[x]=it?new ea(P,z,W,u,lt,c.id):new Po(P,L,z,lt),_.push(`/a_${x}`)}else{const lt=Ea(x,z,"composite");this.binders[x]=new no(P,L,z,W,u,lt),_.push(`/z_${x}`)}}this.cacheKey=_.sort().join("")}getMaxValue(c){const u=this.binders[c];return u instanceof Po||u instanceof no?u.maxValue:0}populatePaintArrays(c,u,p,_,x){for(const T in this.binders){const L=this.binders[T];(L instanceof Po||L instanceof no||L instanceof ea)&&L.populatePaintArray(c,u,p,_,x)}}setConstantPatternPositions(c,u){for(const p in this.binders){const _=this.binders[p];_ instanceof Hn&&_.setConstantPatternPositions(c,u)}}updatePaintArrays(c,u,p,_,x){let T=!1;for(const L in c){const P=u.getPositions(L);for(const z of P){const W=p.feature(z.index);for(const Y in this.binders){const it=this.binders[Y];if((it instanceof Po||it instanceof no||it instanceof ea)&&it.expression.isStateDependent===!0){const lt=_.paint.get(Y);it.expression=lt.value,it.updatePaintArray(z.start,z.end,W,c[L],x),T=!0}}}}return T}defines(){const c=[];for(const u in this.binders){const p=this.binders[u];(p instanceof is||p instanceof Hn)&&c.push(...p.uniformNames.map(_=>`#define HAS_UNIFORM_${_}`))}return c}getBinderAttributes(){const c=[];for(const u in this.binders){const p=this.binders[u];if(p instanceof Po||p instanceof no)for(let _=0;_<p.paintVertexAttributes.length;_++)c.push(p.paintVertexAttributes[_].name);else if(p instanceof ea)for(let _=0;_<hn.members.length;_++)c.push(hn.members[_].name)}return c}getBinderUniforms(){const c=[];for(const u in this.binders){const p=this.binders[u];if(p instanceof is||p instanceof Hn||p instanceof no)for(const _ of p.uniformNames)c.push(_)}return c}getPaintVertexBuffers(){return this._buffers}getUniforms(c,u){const p=[];for(const _ in this.binders){const x=this.binders[_];if(x instanceof is||x instanceof Hn||x instanceof no){for(const T of x.uniformNames)if(u[T]){const L=x.getBinding(c,u[T],T);p.push({name:T,property:_,binding:L})}}}return p}setUniforms(c,u,p,_){for(const{name:x,property:T,binding:L}of u)this.binders[T].setUniform(L,_,p.get(T),x)}updatePaintBuffers(c){this._buffers=[];for(const u in this.binders){const p=this.binders[u];if(c&&p instanceof ea){const _=c.fromScale===2?p.zoomInPaintVertexBuffer:p.zoomOutPaintVertexBuffer;_&&this._buffers.push(_)}else(p instanceof Po||p instanceof no)&&p.paintVertexBuffer&&this._buffers.push(p.paintVertexBuffer)}}upload(c){for(const u in this.binders){const p=this.binders[u];(p instanceof Po||p instanceof no||p instanceof ea)&&p.upload(c)}this.updatePaintBuffers()}destroy(){for(const c in this.binders){const u=this.binders[c];(u instanceof Po||u instanceof no||u instanceof ea)&&u.destroy()}}}class io{constructor(c,u){let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:()=>!0;this.programConfigurations={};for(const _ of c)this.programConfigurations[_.id]=new AA(_,u,p);this.needsUpload=!1,this._featureMap=new Bn,this._bufferOffset=0}populatePaintArrays(c,u,p,_,x,T){for(const L in this.programConfigurations)this.programConfigurations[L].populatePaintArrays(c,u,_,x,T);u.id!==void 0&&this._featureMap.add(u.id,p,this._bufferOffset,c),this._bufferOffset=c,this.needsUpload=!0}updatePaintArrays(c,u,p,_){for(const x of p)this.needsUpload=this.programConfigurations[x.id].updatePaintArrays(c,this._featureMap,u,x,_)||this.needsUpload}get(c){return this.programConfigurations[c]}upload(c){if(this.needsUpload){for(const u in this.programConfigurations)this.programConfigurations[u].upload(c);this.needsUpload=!1}}destroy(){for(const c in this.programConfigurations)this.programConfigurations[c].destroy()}}function Vf(A,c){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[A]||[A.replace(`${c}-`,"").replace(/-/g,"_")]}function Ea(A,c,u){const p={color:{source:$a,composite:Ct},number:{source:N,composite:$a}},_=function(x){return{"line-pattern":{source:be,composite:be},"fill-pattern":{source:be,composite:be},"fill-extrusion-pattern":{source:be,composite:be}}[x]}(A);return _&&_[u]||p[c][u]}ar("ConstantBinder",is),ar("CrossFadedConstantBinder",Hn),ar("SourceExpressionBinder",Po),ar("CrossFadedCompositeBinder",ea),ar("CompositeExpressionBinder",no),ar("ProgramConfiguration",AA,{omit:["_buffers"]}),ar("ProgramConfigurationSet",io);const ei=8192,uA=Math.pow(2,14)-1,em=-uA-1;function Ec(A){const c=ei/A.extent,u=A.loadGeometry();for(let p=0;p<u.length;p++){const _=u[p];for(let x=0;x<_.length;x++){const T=_[x],L=Math.round(T.x*c),P=Math.round(T.y*c);T.x=pt(L,em,uA),T.y=pt(P,em,uA),(L<T.x||L>T.x+1||P<T.y||P>T.y+1)&&vt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return u}function hA(A,c){return{type:A.type,id:A.id,properties:A.properties,geometry:c?Ec(A):[]}}function nu(A,c,u,p,_){A.emplaceBack(2*c+(p+1)/2,2*u+(_+1)/2)}class sd{constructor(c){this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(u=>u.id),this.index=c.index,this.hasPattern=!1,this.layoutVertexArray=new zt,this.indexArray=new Ge,this.segments=new Sr,this.programConfigurations=new io(c.layers,c.zoom),this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(c,u,p){const _=this.layers[0],x=[];let T=null,L=!1;_.type==="circle"&&(T=_.layout.get("circle-sort-key"),L=!T.isConstant());for(const{feature:P,id:z,index:W,sourceLayerIndex:Y}of c){const it=this.layers[0]._featureFilter.needGeometry,lt=hA(P,it);if(!this.layers[0]._featureFilter.filter(new Jn(this.zoom),lt,p))continue;const ht=L?T.evaluate(lt,{},p):void 0,Et={id:z,properties:P.properties,type:P.type,sourceLayerIndex:Y,index:W,geometry:it?lt.geometry:Ec(P),patterns:{},sortKey:ht};x.push(Et)}L&&x.sort((P,z)=>P.sortKey-z.sortKey);for(const P of x){const{geometry:z,index:W,sourceLayerIndex:Y}=P,it=c[W].feature;this.addFeature(P,z,W,p),u.featureIndex.insert(it,z,W,Y,this.index)}}update(c,u,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(c,u,this.stateDependentLayers,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(c){this.uploaded||(this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,tn),this.indexBuffer=c.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(c),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(c,u,p,_){for(const x of u)for(const T of x){const L=T.x,P=T.y;if(L<0||L>=ei||P<0||P>=ei)continue;const z=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,c.sortKey),W=z.vertexLength;nu(this.layoutVertexArray,L,P,-1,-1),nu(this.layoutVertexArray,L,P,1,-1),nu(this.layoutVertexArray,L,P,1,1),nu(this.layoutVertexArray,L,P,-1,1),this.indexArray.emplaceBack(W,W+1,W+2),this.indexArray.emplaceBack(W,W+3,W+2),z.vertexLength+=4,z.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,c,p,{},_)}}function od(A,c){for(let u=0;u<A.length;u++)if(iu(c,A[u]))return!0;for(let u=0;u<c.length;u++)if(iu(A,c[u]))return!0;return!!cd(A,c)}function ad(A,c,u){return!!iu(A,c)||!!rm(c,A,u)}function J1(A,c){if(A.length===1)return Z1(c,A[0]);for(let u=0;u<c.length;u++){const p=c[u];for(let _=0;_<p.length;_++)if(iu(A,p[_]))return!0}for(let u=0;u<A.length;u++)if(Z1(c,A[u]))return!0;for(let u=0;u<c.length;u++)if(cd(A,c[u]))return!0;return!1}function wC(A,c,u){if(A.length>1){if(cd(A,c))return!0;for(let p=0;p<c.length;p++)if(rm(c[p],A,u))return!0}for(let p=0;p<A.length;p++)if(rm(A[p],c,u))return!0;return!1}function cd(A,c){if(A.length===0||c.length===0)return!1;for(let u=0;u<A.length-1;u++){const p=A[u],_=A[u+1];for(let x=0;x<c.length-1;x++)if(dA(p,_,c[x],c[x+1]))return!0}return!1}function dA(A,c,u,p){return ne(A,u,p)!==ne(c,u,p)&&ne(A,c,u)!==ne(A,c,p)}function rm(A,c,u){const p=u*u;if(c.length===1)return A.distSqr(c[0])<p;for(let _=1;_<c.length;_++)if(Y1(A,c[_-1],c[_])<p)return!0;return!1}function Y1(A,c,u){const p=c.distSqr(u);if(p===0)return A.distSqr(c);const _=((A.x-c.x)*(u.x-c.x)+(A.y-c.y)*(u.y-c.y))/p;return A.distSqr(_<0?c:_>1?u:u.sub(c)._mult(_)._add(c))}function Z1(A,c){let u,p,_,x=!1;for(let T=0;T<A.length;T++){u=A[T];for(let L=0,P=u.length-1;L<u.length;P=L++)p=u[L],_=u[P],p.y>c.y!=_.y>c.y&&c.x<(_.x-p.x)*(c.y-p.y)/(_.y-p.y)+p.x&&(x=!x)}return x}function iu(A,c){let u=!1;for(let p=0,_=A.length-1;p<A.length;_=p++){const x=A[p],T=A[_];x.y>c.y!=T.y>c.y&&c.x<(T.x-x.x)*(c.y-x.y)/(T.y-x.y)+x.x&&(u=!u)}return u}function jf(A,c,u){const p=u[0],_=u[2];if(A.x<p.x&&c.x<p.x||A.x>_.x&&c.x>_.x||A.y<p.y&&c.y<p.y||A.y>_.y&&c.y>_.y)return!1;const x=ne(A,c,u[0]);return x!==ne(A,c,u[1])||x!==ne(A,c,u[2])||x!==ne(A,c,u[3])}function eh(A,c,u){const p=c.paint.get(A).value;return p.kind==="constant"?p.value:u.programConfigurations.get(c.id).getMaxValue(A)}function ld(A){return Math.sqrt(A[0]*A[0]+A[1]*A[1])}function su(A,c,u,p,_){if(!c[0]&&!c[1])return A;const x=C.convert(c)._mult(_);u==="viewport"&&x._rotate(-p);const T=[];for(let L=0;L<A.length;L++)T.push(A[L].sub(x));return T}let qf,rh;ar("CircleBucket",sd,{omit:["layers"]});var t_={get paint(){return rh=rh||new In({"circle-radius":new Mr(Kt.paint_circle["circle-radius"]),"circle-color":new Mr(Kt.paint_circle["circle-color"]),"circle-blur":new Mr(Kt.paint_circle["circle-blur"]),"circle-opacity":new Mr(Kt.paint_circle["circle-opacity"]),"circle-translate":new vr(Kt.paint_circle["circle-translate"]),"circle-translate-anchor":new vr(Kt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new vr(Kt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new vr(Kt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Mr(Kt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Mr(Kt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Mr(Kt.paint_circle["circle-stroke-opacity"])})},get layout(){return qf=qf||new In({"circle-sort-key":new Mr(Kt.layout_circle["circle-sort-key"])})}},zs=1e-6,pl=typeof Float32Array<"u"?Float32Array:Array;function Kf(A){return A[0]=1,A[1]=0,A[2]=0,A[3]=0,A[4]=0,A[5]=1,A[6]=0,A[7]=0,A[8]=0,A[9]=0,A[10]=1,A[11]=0,A[12]=0,A[13]=0,A[14]=0,A[15]=1,A}function $f(A,c,u){var p=c[0],_=c[1],x=c[2],T=c[3],L=c[4],P=c[5],z=c[6],W=c[7],Y=c[8],it=c[9],lt=c[10],ht=c[11],Et=c[12],Mt=c[13],Gt=c[14],ee=c[15],Xt=u[0],re=u[1],de=u[2],xe=u[3];return A[0]=Xt*p+re*L+de*Y+xe*Et,A[1]=Xt*_+re*P+de*it+xe*Mt,A[2]=Xt*x+re*z+de*lt+xe*Gt,A[3]=Xt*T+re*W+de*ht+xe*ee,A[4]=(Xt=u[4])*p+(re=u[5])*L+(de=u[6])*Y+(xe=u[7])*Et,A[5]=Xt*_+re*P+de*it+xe*Mt,A[6]=Xt*x+re*z+de*lt+xe*Gt,A[7]=Xt*T+re*W+de*ht+xe*ee,A[8]=(Xt=u[8])*p+(re=u[9])*L+(de=u[10])*Y+(xe=u[11])*Et,A[9]=Xt*_+re*P+de*it+xe*Mt,A[10]=Xt*x+re*z+de*lt+xe*Gt,A[11]=Xt*T+re*W+de*ht+xe*ee,A[12]=(Xt=u[12])*p+(re=u[13])*L+(de=u[14])*Y+(xe=u[15])*Et,A[13]=Xt*_+re*P+de*it+xe*Mt,A[14]=Xt*x+re*z+de*lt+xe*Gt,A[15]=Xt*T+re*W+de*ht+xe*ee,A}Math.hypot||(Math.hypot=function(){for(var A=0,c=arguments.length;c--;)A+=arguments[c]*arguments[c];return Math.sqrt(A)});var Sa,e_=$f;function Ad(A,c,u){var p=c[0],_=c[1],x=c[2],T=c[3];return A[0]=u[0]*p+u[4]*_+u[8]*x+u[12]*T,A[1]=u[1]*p+u[5]*_+u[9]*x+u[13]*T,A[2]=u[2]*p+u[6]*_+u[10]*x+u[14]*T,A[3]=u[3]*p+u[7]*_+u[11]*x+u[15]*T,A}Sa=new pl(4),pl!=Float32Array&&(Sa[0]=0,Sa[1]=0,Sa[2]=0,Sa[3]=0);class xC extends Mo{constructor(c){super(c,t_)}createBucket(c){return new sd(c)}queryRadius(c){const u=c;return eh("circle-radius",this,u)+eh("circle-stroke-width",this,u)+ld(this.paint.get("circle-translate"))}queryIntersectsFeature(c,u,p,_,x,T,L,P){const z=su(c,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),T.angle,L),W=this.paint.get("circle-radius").evaluate(u,p)+this.paint.get("circle-stroke-width").evaluate(u,p),Y=this.paint.get("circle-pitch-alignment")==="map",it=Y?z:function(ht,Et){return ht.map(Mt=>nm(Mt,Et))}(z,P),lt=Y?W*L:W;for(const ht of _)for(const Et of ht){const Mt=Y?Et:nm(Et,P);let Gt=lt;const ee=Ad([],[Et.x,Et.y,0,1],P);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Gt*=ee[3]/T.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Gt*=T.cameraToCenterDistance/ee[3]),ad(it,Mt,Gt))return!0}return!1}}function nm(A,c){const u=Ad([],[A.x,A.y,0,1],c);return new C(u[0]/u[3],u[1]/u[3])}class ou extends sd{}let r_;ar("HeatmapBucket",ou,{omit:["layers"]});var n_={get paint(){return r_=r_||new In({"heatmap-radius":new Mr(Kt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Mr(Kt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new vr(Kt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ba(Kt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new vr(Kt.paint_heatmap["heatmap-opacity"])})}};function im(A,c,u,p){let{width:_,height:x}=c;if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==_*x*u)throw new RangeError(`mismatched image size. expected: ${p.length} but got: ${_*x*u}`)}else p=new Uint8Array(_*x*u);return A.width=_,A.height=x,A.data=p,A}function sm(A,c,u){let{width:p,height:_}=c;if(p===A.width&&_===A.height)return;const x=im({},{width:p,height:_},u);om(A,x,{x:0,y:0},{x:0,y:0},{width:Math.min(A.width,p),height:Math.min(A.height,_)},u),A.width=p,A.height=_,A.data=x.data}function om(A,c,u,p,_,x){if(_.width===0||_.height===0)return c;if(_.width>A.width||_.height>A.height||u.x>A.width-_.width||u.y>A.height-_.height)throw new RangeError("out of range source coordinates for image copy");if(_.width>c.width||_.height>c.height||p.x>c.width-_.width||p.y>c.height-_.height)throw new RangeError("out of range destination coordinates for image copy");const T=A.data,L=c.data;if(T===L)throw new Error("srcData equals dstData, so image is already copied");for(let P=0;P<_.height;P++){const z=((u.y+P)*A.width+u.x)*x,W=((p.y+P)*c.width+p.x)*x;for(let Y=0;Y<_.width*x;Y++)L[W+Y]=T[z+Y]}return c}class gl{constructor(c,u){im(this,c,1,u)}resize(c){sm(this,c,1)}clone(){return new gl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(c,u,p,_,x){om(c,u,p,_,x,1)}}class so{constructor(c,u){im(this,c,4,u)}resize(c){sm(this,c,4)}replace(c,u){u?this.data.set(c):this.data=c instanceof Uint8ClampedArray?new Uint8Array(c.buffer):c}clone(){return new so({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(c,u,p,_,x){om(c,u,p,_,x,4)}}function ud(A){const c={},u=A.resolution||256,p=A.clips?A.clips.length:1,_=A.image||new so({width:u,height:p});if(Math.log(u)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${u}`);const x=(T,L,P)=>{c[A.evaluationKey]=P;const z=A.expression.evaluate(c);_.data[T+L+0]=Math.floor(255*z.r/z.a),_.data[T+L+1]=Math.floor(255*z.g/z.a),_.data[T+L+2]=Math.floor(255*z.b/z.a),_.data[T+L+3]=Math.floor(255*z.a)};if(A.clips)for(let T=0,L=0;T<p;++T,L+=4*u)for(let P=0,z=0;P<u;P++,z+=4){const W=P/(u-1),{start:Y,end:it}=A.clips[T];x(L,z,Y*(1-W)+it*W)}else for(let T=0,L=0;T<u;T++,L+=4)x(0,L,T/(u-1));return _}ar("AlphaImage",gl),ar("RGBAImage",so);class ml extends Mo{createBucket(c){return new ou(c)}constructor(c){super(c,n_),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(c){c==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=ud({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let yl;var fA={get paint(){return yl=yl||new In({"hillshade-illumination-direction":new vr(Kt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new vr(Kt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new vr(Kt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new vr(Kt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new vr(Kt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new vr(Kt.paint_hillshade["hillshade-accent-color"])})}};class Wf extends Mo{constructor(c){super(c,fA)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const am=ai([{name:"a_pos",components:2,type:"Int16"}],4),{members:i_}=am;var cm={exports:{}};function nh(A,c,u){u=u||2;var p,_,x,T,L,P,z,W=c&&c.length,Y=W?c[0]*u:A.length,it=Xf(A,0,Y,u,!0),lt=[];if(!it||it.next===it.prev)return lt;if(W&&(it=function(Et,Mt,Gt,ee){var Xt,re,de,xe=[];for(Xt=0,re=Mt.length;Xt<re;Xt++)(de=Xf(Et,Mt[Xt]*ee,Xt<re-1?Mt[Xt+1]*ee:Et.length,ee,!1))===de.next&&(de.steiner=!0),xe.push(f1t(de));for(xe.sort(u1t),Xt=0;Xt<xe.length;Xt++)Gt=h1t(xe[Xt],Gt);return Gt}(A,c,it,u)),A.length>80*u){p=x=A[0],_=T=A[1];for(var ht=u;ht<Y;ht+=u)(L=A[ht])<p&&(p=L),(P=A[ht+1])<_&&(_=P),L>x&&(x=L),P>T&&(T=P);z=(z=Math.max(x-p,T-_))!==0?32767/z:0}return lm(it,lt,u,p,_,z,0),lt}function Xf(A,c,u,p,_){var x,T;if(_===EC(A,c,u,p)>0)for(x=c;x<u;x+=p)T=RO(x,A[x],A[x+1],T);else for(x=u-p;x>=c;x-=p)T=RO(x,A[x],A[x+1],T);return T&&s_(T,T.next)&&(um(T),T=T.next),T}function hd(A,c){if(!A)return A;c||(c=A);var u,p=A;do if(u=!1,p.steiner||!s_(p,p.next)&&Di(p.prev,p,p.next)!==0)p=p.next;else{if(um(p),(p=c=p.prev)===p.next)break;u=!0}while(u||p!==c);return c}function lm(A,c,u,p,_,x,T){if(A){!T&&x&&function(W,Y,it,lt){var ht=W;do ht.z===0&&(ht.z=BC(ht.x,ht.y,Y,it,lt)),ht.prevZ=ht.prev,ht.nextZ=ht.next,ht=ht.next;while(ht!==W);ht.prevZ.nextZ=null,ht.prevZ=null,function(Et){var Mt,Gt,ee,Xt,re,de,xe,nr,gr=1;do{for(Gt=Et,Et=null,re=null,de=0;Gt;){for(de++,ee=Gt,xe=0,Mt=0;Mt<gr&&(xe++,ee=ee.nextZ);Mt++);for(nr=gr;xe>0||nr>0&&ee;)xe!==0&&(nr===0||!ee||Gt.z<=ee.z)?(Xt=Gt,Gt=Gt.nextZ,xe--):(Xt=ee,ee=ee.nextZ,nr--),re?re.nextZ=Xt:Et=Xt,Xt.prevZ=re,re=Xt;Gt=ee}re.nextZ=null,gr*=2}while(de>1)}(ht)}(A,p,_,x);for(var L,P,z=A;A.prev!==A.next;)if(L=A.prev,P=A.next,x?c1t(A,p,_,x):a1t(A))c.push(L.i/u|0),c.push(A.i/u|0),c.push(P.i/u|0),um(A),A=P.next,z=P.next;else if((A=P)===z){T?T===1?lm(A=l1t(hd(A),c,u),c,u,p,_,x,2):T===2&&A1t(A,c,u,p,_,x):lm(hd(A),c,u,p,_,x,1);break}}}function a1t(A){var c=A.prev,u=A,p=A.next;if(Di(c,u,p)>=0)return!1;for(var _=c.x,x=u.x,T=p.x,L=c.y,P=u.y,z=p.y,W=_<x?_<T?_:T:x<T?x:T,Y=L<P?L<z?L:z:P<z?P:z,it=_>x?_>T?_:T:x>T?x:T,lt=L>P?L>z?L:z:P>z?P:z,ht=p.next;ht!==c;){if(ht.x>=W&&ht.x<=it&&ht.y>=Y&&ht.y<=lt&&Jf(_,L,x,P,T,z,ht.x,ht.y)&&Di(ht.prev,ht,ht.next)>=0)return!1;ht=ht.next}return!0}function c1t(A,c,u,p){var _=A.prev,x=A,T=A.next;if(Di(_,x,T)>=0)return!1;for(var L=_.x,P=x.x,z=T.x,W=_.y,Y=x.y,it=T.y,lt=L<P?L<z?L:z:P<z?P:z,ht=W<Y?W<it?W:it:Y<it?Y:it,Et=L>P?L>z?L:z:P>z?P:z,Mt=W>Y?W>it?W:it:Y>it?Y:it,Gt=BC(lt,ht,c,u,p),ee=BC(Et,Mt,c,u,p),Xt=A.prevZ,re=A.nextZ;Xt&&Xt.z>=Gt&&re&&re.z<=ee;){if(Xt.x>=lt&&Xt.x<=Et&&Xt.y>=ht&&Xt.y<=Mt&&Xt!==_&&Xt!==T&&Jf(L,W,P,Y,z,it,Xt.x,Xt.y)&&Di(Xt.prev,Xt,Xt.next)>=0||(Xt=Xt.prevZ,re.x>=lt&&re.x<=Et&&re.y>=ht&&re.y<=Mt&&re!==_&&re!==T&&Jf(L,W,P,Y,z,it,re.x,re.y)&&Di(re.prev,re,re.next)>=0))return!1;re=re.nextZ}for(;Xt&&Xt.z>=Gt;){if(Xt.x>=lt&&Xt.x<=Et&&Xt.y>=ht&&Xt.y<=Mt&&Xt!==_&&Xt!==T&&Jf(L,W,P,Y,z,it,Xt.x,Xt.y)&&Di(Xt.prev,Xt,Xt.next)>=0)return!1;Xt=Xt.prevZ}for(;re&&re.z<=ee;){if(re.x>=lt&&re.x<=Et&&re.y>=ht&&re.y<=Mt&&re!==_&&re!==T&&Jf(L,W,P,Y,z,it,re.x,re.y)&&Di(re.prev,re,re.next)>=0)return!1;re=re.nextZ}return!0}function l1t(A,c,u){var p=A;do{var _=p.prev,x=p.next.next;!s_(_,x)&&PO(_,p,p.next,x)&&Am(_,x)&&Am(x,_)&&(c.push(_.i/u|0),c.push(p.i/u|0),c.push(x.i/u|0),um(p),um(p.next),p=A=x),p=p.next}while(p!==A);return hd(p)}function A1t(A,c,u,p,_,x){var T=A;do{for(var L=T.next.next;L!==T.prev;){if(T.i!==L.i&&p1t(T,L)){var P=UO(T,L);return T=hd(T,T.next),P=hd(P,P.next),lm(T,c,u,p,_,x,0),void lm(P,c,u,p,_,x,0)}L=L.next}T=T.next}while(T!==A)}function u1t(A,c){return A.x-c.x}function h1t(A,c){var u=function(_,x){var T,L=x,P=_.x,z=_.y,W=-1/0;do{if(z<=L.y&&z>=L.next.y&&L.next.y!==L.y){var Y=L.x+(z-L.y)*(L.next.x-L.x)/(L.next.y-L.y);if(Y<=P&&Y>W&&(W=Y,T=L.x<L.next.x?L:L.next,Y===P))return T}L=L.next}while(L!==x);if(!T)return null;var it,lt=T,ht=T.x,Et=T.y,Mt=1/0;L=T;do P>=L.x&&L.x>=ht&&P!==L.x&&Jf(z<Et?P:W,z,ht,Et,z<Et?W:P,z,L.x,L.y)&&(it=Math.abs(z-L.y)/(P-L.x),Am(L,_)&&(it<Mt||it===Mt&&(L.x>T.x||L.x===T.x&&d1t(T,L)))&&(T=L,Mt=it)),L=L.next;while(L!==lt);return T}(A,c);if(!u)return c;var p=UO(u,A);return hd(p,p.next),hd(u,u.next)}function d1t(A,c){return Di(A.prev,A,c.prev)<0&&Di(c.next,A,A.next)<0}function BC(A,c,u,p,_){return(A=1431655765&((A=858993459&((A=252645135&((A=16711935&((A=(A-u)*_|0)|A<<8))|A<<4))|A<<2))|A<<1))|(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=(c-p)*_|0)|c<<8))|c<<4))|c<<2))|c<<1))<<1}function f1t(A){var c=A,u=A;do(c.x<u.x||c.x===u.x&&c.y<u.y)&&(u=c),c=c.next;while(c!==A);return u}function Jf(A,c,u,p,_,x,T,L){return(_-T)*(c-L)>=(A-T)*(x-L)&&(A-T)*(p-L)>=(u-T)*(c-L)&&(u-T)*(x-L)>=(_-T)*(p-L)}function p1t(A,c){return A.next.i!==c.i&&A.prev.i!==c.i&&!function(u,p){var _=u;do{if(_.i!==u.i&&_.next.i!==u.i&&_.i!==p.i&&_.next.i!==p.i&&PO(_,_.next,u,p))return!0;_=_.next}while(_!==u);return!1}(A,c)&&(Am(A,c)&&Am(c,A)&&function(u,p){var _=u,x=!1,T=(u.x+p.x)/2,L=(u.y+p.y)/2;do _.y>L!=_.next.y>L&&_.next.y!==_.y&&T<(_.next.x-_.x)*(L-_.y)/(_.next.y-_.y)+_.x&&(x=!x),_=_.next;while(_!==u);return x}(A,c)&&(Di(A.prev,A,c.prev)||Di(A,c.prev,c))||s_(A,c)&&Di(A.prev,A,A.next)>0&&Di(c.prev,c,c.next)>0)}function Di(A,c,u){return(c.y-A.y)*(u.x-c.x)-(c.x-A.x)*(u.y-c.y)}function s_(A,c){return A.x===c.x&&A.y===c.y}function PO(A,c,u,p){var _=a_(Di(A,c,u)),x=a_(Di(A,c,p)),T=a_(Di(u,p,A)),L=a_(Di(u,p,c));return _!==x&&T!==L||!(_!==0||!o_(A,u,c))||!(x!==0||!o_(A,p,c))||!(T!==0||!o_(u,A,p))||!(L!==0||!o_(u,c,p))}function o_(A,c,u){return c.x<=Math.max(A.x,u.x)&&c.x>=Math.min(A.x,u.x)&&c.y<=Math.max(A.y,u.y)&&c.y>=Math.min(A.y,u.y)}function a_(A){return A>0?1:A<0?-1:0}function Am(A,c){return Di(A.prev,A,A.next)<0?Di(A,c,A.next)>=0&&Di(A,A.prev,c)>=0:Di(A,c,A.prev)<0||Di(A,A.next,c)<0}function UO(A,c){var u=new CC(A.i,A.x,A.y),p=new CC(c.i,c.x,c.y),_=A.next,x=c.prev;return A.next=c,c.prev=A,u.next=_,_.prev=u,p.next=u,u.prev=p,x.next=p,p.prev=x,p}function RO(A,c,u,p){var _=new CC(A,c,u);return p?(_.next=p.next,_.prev=p,p.next.prev=_,p.next=_):(_.prev=_,_.next=_),_}function um(A){A.next.prev=A.prev,A.prev.next=A.next,A.prevZ&&(A.prevZ.nextZ=A.nextZ),A.nextZ&&(A.nextZ.prevZ=A.prevZ)}function CC(A,c,u){this.i=A,this.x=c,this.y=u,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function EC(A,c,u,p){for(var _=0,x=c,T=u-p;x<u;x+=p)_+=(A[T]-A[x])*(A[x+1]+A[T+1]),T=x;return _}cm.exports=nh,cm.exports.default=nh,nh.deviation=function(A,c,u,p){var _=c&&c.length,x=Math.abs(EC(A,0,_?c[0]*u:A.length,u));if(_)for(var T=0,L=c.length;T<L;T++)x-=Math.abs(EC(A,c[T]*u,T<L-1?c[T+1]*u:A.length,u));var P=0;for(T=0;T<p.length;T+=3){var z=p[T]*u,W=p[T+1]*u,Y=p[T+2]*u;P+=Math.abs((A[z]-A[Y])*(A[W+1]-A[z+1])-(A[z]-A[W])*(A[Y+1]-A[z+1]))}return x===0&&P===0?0:Math.abs((P-x)/x)},nh.flatten=function(A){for(var c=A[0][0].length,u={vertices:[],holes:[],dimensions:c},p=0,_=0;_<A.length;_++){for(var x=0;x<A[_].length;x++)for(var T=0;T<c;T++)u.vertices.push(A[_][x][T]);_>0&&u.holes.push(p+=A[_-1].length)}return u};var DO=f(cm.exports);function g1t(A,c,u,p,_){OO(A,c,u||0,p||A.length-1,_||m1t)}function OO(A,c,u,p,_){for(;p>u;){if(p-u>600){var x=p-u+1,T=c-u+1,L=Math.log(x),P=.5*Math.exp(2*L/3),z=.5*Math.sqrt(L*P*(x-P)/x)*(T-x/2<0?-1:1);OO(A,c,Math.max(u,Math.floor(c-T*P/x+z)),Math.min(p,Math.floor(c+(x-T)*P/x+z)),_)}var W=A[c],Y=u,it=p;for(hm(A,u,c),_(A[p],W)>0&&hm(A,u,p);Y<it;){for(hm(A,Y,it),Y++,it--;_(A[Y],W)<0;)Y++;for(;_(A[it],W)>0;)it--}_(A[u],W)===0?hm(A,u,it):hm(A,++it,p),it<=c&&(u=it+1),c<=it&&(p=it-1)}}function hm(A,c,u){var p=A[c];A[c]=A[u],A[u]=p}function m1t(A,c){return A<c?-1:A>c?1:0}function SC(A,c){const u=A.length;if(u<=1)return[A];const p=[];let _,x;for(let T=0;T<u;T++){const L=ie(A[T]);L!==0&&(A[T].area=Math.abs(L),x===void 0&&(x=L<0),x===L<0?(_&&p.push(_),_=[A[T]]):_.push(A[T]))}if(_&&p.push(_),c>1)for(let T=0;T<p.length;T++)p[T].length<=c||(g1t(p[T],c,1,p[T].length-1,y1t),p[T]=p[T].slice(0,c));return p}function y1t(A,c){return c.area-A.area}function TC(A,c,u){const p=u.patternDependencies;let _=!1;for(const x of c){const T=x.paint.get(`${A}-pattern`);T.isConstant()||(_=!0);const L=T.constantOr(null);L&&(_=!0,p[L.to]=!0,p[L.from]=!0)}return _}function IC(A,c,u,p,_){const x=_.patternDependencies;for(const T of c){const L=T.paint.get(`${A}-pattern`).value;if(L.kind!=="constant"){let P=L.evaluate({zoom:p-1},u,{},_.availableImages),z=L.evaluate({zoom:p},u,{},_.availableImages),W=L.evaluate({zoom:p+1},u,{},_.availableImages);P=P&&P.name?P.name:P,z=z&&z.name?z.name:z,W=W&&W.name?W.name:W,x[P]=!0,x[z]=!0,x[W]=!0,u.patterns[T.id]={min:P,mid:z,max:W}}}return u}class LC{constructor(c){this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(u=>u.id),this.index=c.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new me,this.indexArray=new Ge,this.indexArray2=new zr,this.programConfigurations=new io(c.layers,c.zoom),this.segments=new Sr,this.segments2=new Sr,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(c,u,p){this.hasPattern=TC("fill",this.layers,u);const _=this.layers[0].layout.get("fill-sort-key"),x=!_.isConstant(),T=[];for(const{feature:L,id:P,index:z,sourceLayerIndex:W}of c){const Y=this.layers[0]._featureFilter.needGeometry,it=hA(L,Y);if(!this.layers[0]._featureFilter.filter(new Jn(this.zoom),it,p))continue;const lt=x?_.evaluate(it,{},p,u.availableImages):void 0,ht={id:P,properties:L.properties,type:L.type,sourceLayerIndex:W,index:z,geometry:Y?it.geometry:Ec(L),patterns:{},sortKey:lt};T.push(ht)}x&&T.sort((L,P)=>L.sortKey-P.sortKey);for(const L of T){const{geometry:P,index:z,sourceLayerIndex:W}=L;if(this.hasPattern){const Y=IC("fill",this.layers,L,this.zoom,u);this.patternFeatures.push(Y)}else this.addFeature(L,P,z,p,{});u.featureIndex.insert(c[z].feature,P,z,W,this.index)}}update(c,u,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(c,u,this.stateDependentLayers,p)}addFeatures(c,u,p){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,u,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(c){this.uploaded||(this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,i_),this.indexBuffer=c.createIndexBuffer(this.indexArray),this.indexBuffer2=c.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(c),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(c,u,p,_,x){for(const T of SC(u,500)){let L=0;for(const lt of T)L+=lt.length;const P=this.segments.prepareSegment(L,this.layoutVertexArray,this.indexArray),z=P.vertexLength,W=[],Y=[];for(const lt of T){if(lt.length===0)continue;lt!==T[0]&&Y.push(W.length/2);const ht=this.segments2.prepareSegment(lt.length,this.layoutVertexArray,this.indexArray2),Et=ht.vertexLength;this.layoutVertexArray.emplaceBack(lt[0].x,lt[0].y),this.indexArray2.emplaceBack(Et+lt.length-1,Et),W.push(lt[0].x),W.push(lt[0].y);for(let Mt=1;Mt<lt.length;Mt++)this.layoutVertexArray.emplaceBack(lt[Mt].x,lt[Mt].y),this.indexArray2.emplaceBack(Et+Mt-1,Et+Mt),W.push(lt[Mt].x),W.push(lt[Mt].y);ht.vertexLength+=lt.length,ht.primitiveLength+=lt.length}const it=DO(W,Y);for(let lt=0;lt<it.length;lt+=3)this.indexArray.emplaceBack(z+it[lt],z+it[lt+1],z+it[lt+2]);P.vertexLength+=L,P.primitiveLength+=it.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,c,p,x,_)}}let NO,kO;ar("FillBucket",LC,{omit:["layers","patternFeatures"]});var _1t={get paint(){return kO=kO||new In({"fill-antialias":new vr(Kt.paint_fill["fill-antialias"]),"fill-opacity":new Mr(Kt.paint_fill["fill-opacity"]),"fill-color":new Mr(Kt.paint_fill["fill-color"]),"fill-outline-color":new Mr(Kt.paint_fill["fill-outline-color"]),"fill-translate":new vr(Kt.paint_fill["fill-translate"]),"fill-translate-anchor":new vr(Kt.paint_fill["fill-translate-anchor"]),"fill-pattern":new ru(Kt.paint_fill["fill-pattern"])})},get layout(){return NO=NO||new In({"fill-sort-key":new Mr(Kt.layout_fill["fill-sort-key"])})}};class v1t extends Mo{constructor(c){super(c,_1t)}recalculate(c,u){super.recalculate(c,u);const p=this.paint._values["fill-outline-color"];p.value.kind==="constant"&&p.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(c){return new LC(c)}queryRadius(){return ld(this.paint.get("fill-translate"))}queryIntersectsFeature(c,u,p,_,x,T,L){return J1(su(c,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),T.angle,L),_)}isTileClipped(){return!0}}const b1t=ai([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),w1t=ai([{name:"a_centroid",components:2,type:"Int16"}],4),{members:x1t}=b1t;var ih={},B1t=g,QO=Yf;function Yf(A,c,u,p,_){this.properties={},this.extent=u,this.type=0,this._pbf=A,this._geometry=-1,this._keys=p,this._values=_,A.readFields(C1t,this,c)}function C1t(A,c,u){A==1?c.id=u.readVarint():A==2?function(p,_){for(var x=p.readVarint()+p.pos;p.pos<x;){var T=_._keys[p.readVarint()],L=_._values[p.readVarint()];_.properties[T]=L}}(u,c):A==3?c.type=u.readVarint():A==4&&(c._geometry=u.pos)}function E1t(A){for(var c,u,p=0,_=0,x=A.length,T=x-1;_<x;T=_++)p+=((u=A[T]).x-(c=A[_]).x)*(c.y+u.y);return p}Yf.types=["Unknown","Point","LineString","Polygon"],Yf.prototype.loadGeometry=function(){var A=this._pbf;A.pos=this._geometry;for(var c,u=A.readVarint()+A.pos,p=1,_=0,x=0,T=0,L=[];A.pos<u;){if(_<=0){var P=A.readVarint();p=7&P,_=P>>3}if(_--,p===1||p===2)x+=A.readSVarint(),T+=A.readSVarint(),p===1&&(c&&L.push(c),c=[]),c.push(new B1t(x,T));else{if(p!==7)throw new Error("unknown command "+p);c&&c.push(c[0].clone())}}return c&&L.push(c),L},Yf.prototype.bbox=function(){var A=this._pbf;A.pos=this._geometry;for(var c=A.readVarint()+A.pos,u=1,p=0,_=0,x=0,T=1/0,L=-1/0,P=1/0,z=-1/0;A.pos<c;){if(p<=0){var W=A.readVarint();u=7&W,p=W>>3}if(p--,u===1||u===2)(_+=A.readSVarint())<T&&(T=_),_>L&&(L=_),(x+=A.readSVarint())<P&&(P=x),x>z&&(z=x);else if(u!==7)throw new Error("unknown command "+u)}return[T,P,L,z]},Yf.prototype.toGeoJSON=function(A,c,u){var p,_,x=this.extent*Math.pow(2,u),T=this.extent*A,L=this.extent*c,P=this.loadGeometry(),z=Yf.types[this.type];function W(lt){for(var ht=0;ht<lt.length;ht++){var Et=lt[ht];lt[ht]=[360*(Et.x+T)/x-180,360/Math.PI*Math.atan(Math.exp((180-360*(Et.y+L)/x)*Math.PI/180))-90]}}switch(this.type){case 1:var Y=[];for(p=0;p<P.length;p++)Y[p]=P[p][0];W(P=Y);break;case 2:for(p=0;p<P.length;p++)W(P[p]);break;case 3:for(P=function(lt){var ht=lt.length;if(ht<=1)return[lt];for(var Et,Mt,Gt=[],ee=0;ee<ht;ee++){var Xt=E1t(lt[ee]);Xt!==0&&(Mt===void 0&&(Mt=Xt<0),Mt===Xt<0?(Et&&Gt.push(Et),Et=[lt[ee]]):Et.push(lt[ee]))}return Et&&Gt.push(Et),Gt}(P),p=0;p<P.length;p++)for(_=0;_<P[p].length;_++)W(P[p][_])}P.length===1?P=P[0]:z="Multi"+z;var it={type:"Feature",geometry:{type:z,coordinates:P},properties:this.properties};return"id"in this&&(it.id=this.id),it};var S1t=QO,zO=HO;function HO(A,c){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=A,this._keys=[],this._values=[],this._features=[],A.readFields(T1t,this,c),this.length=this._features.length}function T1t(A,c,u){A===15?c.version=u.readVarint():A===1?c.name=u.readString():A===5?c.extent=u.readVarint():A===2?c._features.push(u.pos):A===3?c._keys.push(u.readString()):A===4&&c._values.push(function(p){for(var _=null,x=p.readVarint()+p.pos;p.pos<x;){var T=p.readVarint()>>3;_=T===1?p.readString():T===2?p.readFloat():T===3?p.readDouble():T===4?p.readVarint64():T===5?p.readVarint():T===6?p.readSVarint():T===7?p.readBoolean():null}return _}(u))}HO.prototype.feature=function(A){if(A<0||A>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[A];var c=this._pbf.readVarint()+this._pbf.pos;return new S1t(this._pbf,c,this.extent,this._keys,this._values)};var I1t=zO;function L1t(A,c,u){if(A===3){var p=new I1t(u,u.readVarint()+u.pos);p.length&&(c[p.name]=p)}}ih.VectorTile=function(A,c){this.layers=A.readFields(L1t,{},c)},ih.VectorTileFeature=QO,ih.VectorTileLayer=zO;const F1t=ih.VectorTileFeature.types,FC=Math.pow(2,13);function dm(A,c,u,p,_,x,T,L){A.emplaceBack(c,u,2*Math.floor(p*FC)+T,_*FC*2,x*FC*2,Math.round(L))}class MC{constructor(c){this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(u=>u.id),this.index=c.index,this.hasPattern=!1,this.layoutVertexArray=new Wt,this.centroidVertexArray=new kt,this.indexArray=new Ge,this.programConfigurations=new io(c.layers,c.zoom),this.segments=new Sr,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(c,u,p){this.features=[],this.hasPattern=TC("fill-extrusion",this.layers,u);for(const{feature:_,id:x,index:T,sourceLayerIndex:L}of c){const P=this.layers[0]._featureFilter.needGeometry,z=hA(_,P);if(!this.layers[0]._featureFilter.filter(new Jn(this.zoom),z,p))continue;const W={id:x,sourceLayerIndex:L,index:T,geometry:P?z.geometry:Ec(_),properties:_.properties,type:_.type,patterns:{}};this.hasPattern?this.features.push(IC("fill-extrusion",this.layers,W,this.zoom,u)):this.addFeature(W,W.geometry,T,p,{}),u.featureIndex.insert(_,W.geometry,T,L,this.index,!0)}}addFeatures(c,u,p){for(const _ of this.features){const{geometry:x}=_;this.addFeature(_,x,_.index,u,p)}}update(c,u,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(c,u,this.stateDependentLayers,p)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(c){this.uploaded||(this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,x1t),this.centroidVertexBuffer=c.createVertexBuffer(this.centroidVertexArray,w1t.members,!0),this.indexBuffer=c.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(c),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(c,u,p,_,x){const T={x:0,y:0,vertexCount:0};for(const L of SC(u,500)){let P=0;for(const ht of L)P+=ht.length;let z=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const ht of L){if(ht.length===0||P1t(ht))continue;let Et=0;for(let Mt=0;Mt<ht.length;Mt++){const Gt=ht[Mt];if(Mt>=1){const ee=ht[Mt-1];if(!M1t(Gt,ee)){z.vertexLength+4>Sr.MAX_VERTEX_ARRAY_LENGTH&&(z=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Xt=Gt.sub(ee)._perp()._unit(),re=ee.dist(Gt);Et+re>32768&&(Et=0),dm(this.layoutVertexArray,Gt.x,Gt.y,Xt.x,Xt.y,0,0,Et),dm(this.layoutVertexArray,Gt.x,Gt.y,Xt.x,Xt.y,0,1,Et),T.x+=2*Gt.x,T.y+=2*Gt.y,T.vertexCount+=2,Et+=re,dm(this.layoutVertexArray,ee.x,ee.y,Xt.x,Xt.y,0,0,Et),dm(this.layoutVertexArray,ee.x,ee.y,Xt.x,Xt.y,0,1,Et),T.x+=2*ee.x,T.y+=2*ee.y,T.vertexCount+=2;const de=z.vertexLength;this.indexArray.emplaceBack(de,de+2,de+1),this.indexArray.emplaceBack(de+1,de+2,de+3),z.vertexLength+=4,z.primitiveLength+=2}}}}if(z.vertexLength+P>Sr.MAX_VERTEX_ARRAY_LENGTH&&(z=this.segments.prepareSegment(P,this.layoutVertexArray,this.indexArray)),F1t[c.type]!=="Polygon")continue;const W=[],Y=[],it=z.vertexLength;for(const ht of L)if(ht.length!==0){ht!==L[0]&&Y.push(W.length/2);for(let Et=0;Et<ht.length;Et++){const Mt=ht[Et];dm(this.layoutVertexArray,Mt.x,Mt.y,0,0,1,1,0),T.x+=Mt.x,T.y+=Mt.y,T.vertexCount+=1,W.push(Mt.x),W.push(Mt.y)}}const lt=DO(W,Y);for(let ht=0;ht<lt.length;ht+=3)this.indexArray.emplaceBack(it+lt[ht],it+lt[ht+2],it+lt[ht+1]);z.primitiveLength+=lt.length/3,z.vertexLength+=P}for(let L=0;L<T.vertexCount;L++)this.centroidVertexArray.emplaceBack(Math.floor(T.x/T.vertexCount),Math.floor(T.y/T.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,c,p,x,_)}}function M1t(A,c){return A.x===c.x&&(A.x<0||A.x>ei)||A.y===c.y&&(A.y<0||A.y>ei)}function P1t(A){return A.every(c=>c.x<0)||A.every(c=>c.x>ei)||A.every(c=>c.y<0)||A.every(c=>c.y>ei)}let GO;ar("FillExtrusionBucket",MC,{omit:["layers","features"]});var U1t={get paint(){return GO=GO||new In({"fill-extrusion-opacity":new vr(Kt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Mr(Kt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new vr(Kt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new vr(Kt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ru(Kt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Mr(Kt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Mr(Kt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new vr(Kt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class R1t extends Mo{constructor(c){super(c,U1t)}createBucket(c){return new MC(c)}queryRadius(){return ld(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(c,u,p,_,x,T,L,P){const z=su(c,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),T.angle,L),W=this.paint.get("fill-extrusion-height").evaluate(u,p),Y=this.paint.get("fill-extrusion-base").evaluate(u,p),it=function(ht,Et,Mt,Gt){const ee=[];for(const Xt of ht){const re=[Xt.x,Xt.y,0,1];Ad(re,re,Et),ee.push(new C(re[0]/re[3],re[1]/re[3]))}return ee}(z,P),lt=function(ht,Et,Mt,Gt){const ee=[],Xt=[],re=Gt[8]*Et,de=Gt[9]*Et,xe=Gt[10]*Et,nr=Gt[11]*Et,gr=Gt[8]*Mt,er=Gt[9]*Mt,Ye=Gt[10]*Mt,$e=Gt[11]*Mt;for(const lr of ht){const Xe=[],Re=[];for(const Lr of lr){const br=Lr.x,cn=Lr.y,ci=Gt[0]*br+Gt[4]*cn+Gt[12],fi=Gt[1]*br+Gt[5]*cn+Gt[13],os=Gt[2]*br+Gt[6]*cn+Gt[14],Ta=Gt[3]*br+Gt[7]*cn+Gt[15],Uo=os+xe,ji=Ta+nr,Ls=ci+gr,Gs=fi+er,Ro=os+Ye,Do=Ta+$e,as=new C((ci+re)/ji,(fi+de)/ji);as.z=Uo/ji,Xe.push(as);const cs=new C(Ls/Do,Gs/Do);cs.z=Ro/Do,Re.push(cs)}ee.push(Xe),Xt.push(Re)}return[ee,Xt]}(_,Y,W,P);return function(ht,Et,Mt){let Gt=1/0;J1(Mt,Et)&&(Gt=VO(Mt,Et[0]));for(let ee=0;ee<Et.length;ee++){const Xt=Et[ee],re=ht[ee];for(let de=0;de<Xt.length-1;de++){const xe=Xt[de],nr=[xe,Xt[de+1],re[de+1],re[de],xe];od(Mt,nr)&&(Gt=Math.min(Gt,VO(Mt,nr)))}}return Gt!==1/0&&Gt}(lt[0],lt[1],it)}}function fm(A,c){return A.x*c.x+A.y*c.y}function VO(A,c){if(A.length===1){let u=0;const p=c[u++];let _;for(;!_||p.equals(_);)if(_=c[u++],!_)return 1/0;for(;u<c.length;u++){const x=c[u],T=A[0],L=_.sub(p),P=x.sub(p),z=T.sub(p),W=fm(L,L),Y=fm(L,P),it=fm(P,P),lt=fm(z,L),ht=fm(z,P),Et=W*it-Y*Y,Mt=(it*lt-Y*ht)/Et,Gt=(W*ht-Y*lt)/Et,ee=p.z*(1-Mt-Gt)+_.z*Mt+x.z*Gt;if(isFinite(ee))return ee}return 1/0}{let u=1/0;for(const p of c)u=Math.min(u,p.z);return u}}const D1t=ai([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:O1t}=D1t,N1t=ai([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:k1t}=N1t,Q1t=ih.VectorTileFeature.types,z1t=Math.cos(Math.PI/180*37.5),jO=Math.pow(2,14)/.5;class PC{constructor(c){this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(u=>u.id),this.index=c.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(u=>{this.gradients[u.id]={}}),this.layoutVertexArray=new Ot,this.layoutVertexArray2=new Nt,this.indexArray=new Ge,this.programConfigurations=new io(c.layers,c.zoom),this.segments=new Sr,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(c,u,p){this.hasPattern=TC("line",this.layers,u);const _=this.layers[0].layout.get("line-sort-key"),x=!_.isConstant(),T=[];for(const{feature:L,id:P,index:z,sourceLayerIndex:W}of c){const Y=this.layers[0]._featureFilter.needGeometry,it=hA(L,Y);if(!this.layers[0]._featureFilter.filter(new Jn(this.zoom),it,p))continue;const lt=x?_.evaluate(it,{},p):void 0,ht={id:P,properties:L.properties,type:L.type,sourceLayerIndex:W,index:z,geometry:Y?it.geometry:Ec(L),patterns:{},sortKey:lt};T.push(ht)}x&&T.sort((L,P)=>L.sortKey-P.sortKey);for(const L of T){const{geometry:P,index:z,sourceLayerIndex:W}=L;if(this.hasPattern){const Y=IC("line",this.layers,L,this.zoom,u);this.patternFeatures.push(Y)}else this.addFeature(L,P,z,p,{});u.featureIndex.insert(c[z].feature,P,z,W,this.index)}}update(c,u,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(c,u,this.stateDependentLayers,p)}addFeatures(c,u,p){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,u,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(c){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=c.createVertexBuffer(this.layoutVertexArray2,k1t)),this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,O1t),this.indexBuffer=c.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(c),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(c){if(c.properties&&Object.prototype.hasOwnProperty.call(c.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(c.properties,"mapbox_clip_end"))return{start:+c.properties.mapbox_clip_start,end:+c.properties.mapbox_clip_end}}addFeature(c,u,p,_,x){const T=this.layers[0].layout,L=T.get("line-join").evaluate(c,{}),P=T.get("line-cap"),z=T.get("line-miter-limit"),W=T.get("line-round-limit");this.lineClips=this.lineFeatureClips(c);for(const Y of u)this.addLine(Y,c,L,P,z,W);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,c,p,x,_)}addLine(c,u,p,_,x,T){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Gt=0;Gt<c.length-1;Gt++)this.totalDistance+=c[Gt].dist(c[Gt+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const L=Q1t[u.type]==="Polygon";let P=c.length;for(;P>=2&&c[P-1].equals(c[P-2]);)P--;let z=0;for(;z<P-1&&c[z].equals(c[z+1]);)z++;if(P<(L?3:2))return;p==="bevel"&&(x=1.05);const W=this.overscaling<=16?15*ei/(512*this.overscaling):0,Y=this.segments.prepareSegment(10*P,this.layoutVertexArray,this.indexArray);let it,lt,ht,Et,Mt;this.e1=this.e2=-1,L&&(it=c[P-2],Mt=c[z].sub(it)._unit()._perp());for(let Gt=z;Gt<P;Gt++){if(ht=Gt===P-1?L?c[z+1]:void 0:c[Gt+1],ht&&c[Gt].equals(ht))continue;Mt&&(Et=Mt),it&&(lt=it),it=c[Gt],Mt=ht?ht.sub(it)._unit()._perp():Et,Et=Et||Mt;let ee=Et.add(Mt);ee.x===0&&ee.y===0||ee._unit();const Xt=Et.x*Mt.x+Et.y*Mt.y,re=ee.x*Mt.x+ee.y*Mt.y,de=re!==0?1/re:1/0,xe=2*Math.sqrt(2-2*re),nr=re<z1t&&lt&&ht,gr=Et.x*Mt.y-Et.y*Mt.x>0;if(nr&&Gt>z){const $e=it.dist(lt);if($e>2*W){const lr=it.sub(it.sub(lt)._mult(W/$e)._round());this.updateDistance(lt,lr),this.addCurrentVertex(lr,Et,0,0,Y),lt=lr}}const er=lt&&ht;let Ye=er?p:L?"butt":_;if(er&&Ye==="round"&&(de<T?Ye="miter":de<=2&&(Ye="fakeround")),Ye==="miter"&&de>x&&(Ye="bevel"),Ye==="bevel"&&(de>2&&(Ye="flipbevel"),de<x&&(Ye="miter")),lt&&this.updateDistance(lt,it),Ye==="miter")ee._mult(de),this.addCurrentVertex(it,ee,0,0,Y);else if(Ye==="flipbevel"){if(de>100)ee=Mt.mult(-1);else{const $e=de*Et.add(Mt).mag()/Et.sub(Mt).mag();ee._perp()._mult($e*(gr?-1:1))}this.addCurrentVertex(it,ee,0,0,Y),this.addCurrentVertex(it,ee.mult(-1),0,0,Y)}else if(Ye==="bevel"||Ye==="fakeround"){const $e=-Math.sqrt(de*de-1),lr=gr?$e:0,Xe=gr?0:$e;if(lt&&this.addCurrentVertex(it,Et,lr,Xe,Y),Ye==="fakeround"){const Re=Math.round(180*xe/Math.PI/20);for(let Lr=1;Lr<Re;Lr++){let br=Lr/Re;if(br!==.5){const ci=br-.5;br+=br*ci*(br-1)*((1.0904+Xt*(Xt*(3.55645-1.43519*Xt)-3.2452))*ci*ci+(.848013+Xt*(.215638*Xt-1.06021)))}const cn=Mt.sub(Et)._mult(br)._add(Et)._unit()._mult(gr?-1:1);this.addHalfVertex(it,cn.x,cn.y,!1,gr,0,Y)}}ht&&this.addCurrentVertex(it,Mt,-lr,-Xe,Y)}else if(Ye==="butt")this.addCurrentVertex(it,ee,0,0,Y);else if(Ye==="square"){const $e=lt?1:-1;this.addCurrentVertex(it,ee,$e,$e,Y)}else Ye==="round"&&(lt&&(this.addCurrentVertex(it,Et,0,0,Y),this.addCurrentVertex(it,Et,1,1,Y,!0)),ht&&(this.addCurrentVertex(it,Mt,-1,-1,Y,!0),this.addCurrentVertex(it,Mt,0,0,Y)));if(nr&&Gt<P-1){const $e=it.dist(ht);if($e>2*W){const lr=it.add(ht.sub(it)._mult(W/$e)._round());this.updateDistance(it,lr),this.addCurrentVertex(lr,Mt,0,0,Y),it=lr}}}}addCurrentVertex(c,u,p,_,x){let T=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!1;const L=u.y*_-u.x,P=-u.y-u.x*_;this.addHalfVertex(c,u.x+u.y*p,u.y-u.x*p,T,!1,p,x),this.addHalfVertex(c,L,P,T,!0,-_,x),this.distance>jO/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(c,u,p,_,x,T))}addHalfVertex(c,u,p,_,x,T,L){let{x:P,y:z}=c;const W=.5*(this.lineClips?this.scaledDistance*(jO-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((P<<1)+(_?1:0),(z<<1)+(x?1:0),Math.round(63*u)+128,Math.round(63*p)+128,1+(T===0?0:T<0?-1:1)|(63&W)<<2,W>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const Y=L.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,Y),L.primitiveLength++),x?this.e2=Y:this.e1=Y}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(c,u){this.distance+=c.dist(u),this.updateScaledDistance()}}let qO,KO;ar("LineBucket",PC,{omit:["layers","patternFeatures"]});var $O={get paint(){return KO=KO||new In({"line-opacity":new Mr(Kt.paint_line["line-opacity"]),"line-color":new Mr(Kt.paint_line["line-color"]),"line-translate":new vr(Kt.paint_line["line-translate"]),"line-translate-anchor":new vr(Kt.paint_line["line-translate-anchor"]),"line-width":new Mr(Kt.paint_line["line-width"]),"line-gap-width":new Mr(Kt.paint_line["line-gap-width"]),"line-offset":new Mr(Kt.paint_line["line-offset"]),"line-blur":new Mr(Kt.paint_line["line-blur"]),"line-dasharray":new rd(Kt.paint_line["line-dasharray"]),"line-pattern":new ru(Kt.paint_line["line-pattern"]),"line-gradient":new Ba(Kt.paint_line["line-gradient"])})},get layout(){return qO=qO||new In({"line-cap":new vr(Kt.layout_line["line-cap"]),"line-join":new Mr(Kt.layout_line["line-join"]),"line-miter-limit":new vr(Kt.layout_line["line-miter-limit"]),"line-round-limit":new vr(Kt.layout_line["line-round-limit"]),"line-sort-key":new Mr(Kt.layout_line["line-sort-key"])})}};class H1t extends Mr{possiblyEvaluate(c,u){return u=new Jn(Math.floor(u.zoom),{now:u.now,fadeDuration:u.fadeDuration,zoomHistory:u.zoomHistory,transition:u.transition}),super.possiblyEvaluate(c,u)}evaluate(c,u,p,_){return u=ft({},u,{zoom:Math.floor(u.zoom)}),super.evaluate(c,u,p,_)}}let c_;class G1t extends Mo{constructor(c){super(c,$O),this.gradientVersion=0,c_||(c_=new H1t($O.paint.properties["line-width"].specification),c_.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(c){if(c==="line-gradient"){const u=this.gradientExpression();this.stepInterpolant=!!function(p){return p._styleExpression!==void 0}(u)&&u._styleExpression.expression instanceof Us,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(c,u){super.recalculate(c,u),this.paint._values["line-floorwidth"]=c_.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,c)}createBucket(c){return new PC(c)}queryRadius(c){const u=c,p=WO(eh("line-width",this,u),eh("line-gap-width",this,u)),_=eh("line-offset",this,u);return p/2+Math.abs(_)+ld(this.paint.get("line-translate"))}queryIntersectsFeature(c,u,p,_,x,T,L){const P=su(c,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),T.angle,L),z=L/2*WO(this.paint.get("line-width").evaluate(u,p),this.paint.get("line-gap-width").evaluate(u,p)),W=this.paint.get("line-offset").evaluate(u,p);return W&&(_=function(Y,it){const lt=[];for(let ht=0;ht<Y.length;ht++){const Et=Y[ht],Mt=[];for(let Gt=0;Gt<Et.length;Gt++){const ee=Et[Gt-1],Xt=Et[Gt],re=Et[Gt+1],de=Gt===0?new C(0,0):Xt.sub(ee)._unit()._perp(),xe=Gt===Et.length-1?new C(0,0):re.sub(Xt)._unit()._perp(),nr=de._add(xe)._unit(),gr=nr.x*xe.x+nr.y*xe.y;gr!==0&&nr._mult(1/gr),Mt.push(nr._mult(it)._add(Xt))}lt.push(Mt)}return lt}(_,W*L)),function(Y,it,lt){for(let ht=0;ht<it.length;ht++){const Et=it[ht];if(Y.length>=3){for(let Mt=0;Mt<Et.length;Mt++)if(iu(Y,Et[Mt]))return!0}if(wC(Y,Et,lt))return!0}return!1}(P,_,z)}isTileClipped(){return!0}}function WO(A,c){return c>0?c+2*A:A}const V1t=ai([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),j1t=ai([{name:"a_projected_pos",components:3,type:"Float32"}],4);ai([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const q1t=ai([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);ai([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const XO=ai([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),K1t=ai([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function $1t(A,c,u){return A.sections.forEach(p=>{p.text=function(_,x,T){const L=x.layout.get("text-transform").evaluate(T,{});return L==="uppercase"?_=_.toLocaleUpperCase():L==="lowercase"&&(_=_.toLocaleLowerCase()),eo.applyArabicShaping&&(_=eo.applyArabicShaping(_)),_}(p.text,c,u)}),A}ai([{name:"triangle",components:3,type:"Uint16"}]),ai([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),ai([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),ai([{type:"Float32",name:"offsetX"}]),ai([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),ai([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const pm={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var ss=24,JO=$n,YO=function(A,c,u,p,_){var x,T,L=8*_-p-1,P=(1<<L)-1,z=P>>1,W=-7,Y=u?_-1:0,it=u?-1:1,lt=A[c+Y];for(Y+=it,x=lt&(1<<-W)-1,lt>>=-W,W+=L;W>0;x=256*x+A[c+Y],Y+=it,W-=8);for(T=x&(1<<-W)-1,x>>=-W,W+=p;W>0;T=256*T+A[c+Y],Y+=it,W-=8);if(x===0)x=1-z;else{if(x===P)return T?NaN:1/0*(lt?-1:1);T+=Math.pow(2,p),x-=z}return(lt?-1:1)*T*Math.pow(2,x-p)},ZO=function(A,c,u,p,_,x){var T,L,P,z=8*x-_-1,W=(1<<z)-1,Y=W>>1,it=_===23?Math.pow(2,-24)-Math.pow(2,-77):0,lt=p?0:x-1,ht=p?1:-1,Et=c<0||c===0&&1/c<0?1:0;for(c=Math.abs(c),isNaN(c)||c===1/0?(L=isNaN(c)?1:0,T=W):(T=Math.floor(Math.log(c)/Math.LN2),c*(P=Math.pow(2,-T))<1&&(T--,P*=2),(c+=T+Y>=1?it/P:it*Math.pow(2,1-Y))*P>=2&&(T++,P/=2),T+Y>=W?(L=0,T=W):T+Y>=1?(L=(c*P-1)*Math.pow(2,_),T+=Y):(L=c*Math.pow(2,Y-1)*Math.pow(2,_),T=0));_>=8;A[u+lt]=255&L,lt+=ht,L/=256,_-=8);for(T=T<<_|L,z+=_;z>0;A[u+lt]=255&T,lt+=ht,T/=256,z-=8);A[u+lt-ht]|=128*Et};function $n(A){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(A)?A:new Uint8Array(A||0),this.pos=0,this.type=0,this.length=this.buf.length}$n.Varint=0,$n.Fixed64=1,$n.Bytes=2,$n.Fixed32=5;var UC=4294967296,tN=1/UC,eN=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function au(A){return A.type===$n.Bytes?A.readVarint()+A.pos:A.pos+1}function Zf(A,c,u){return u?4294967296*c+(A>>>0):4294967296*(c>>>0)+(A>>>0)}function rN(A,c,u){var p=c<=16383?1:c<=2097151?2:c<=268435455?3:Math.floor(Math.log(c)/(7*Math.LN2));u.realloc(p);for(var _=u.pos-1;_>=A;_--)u.buf[_+p]=u.buf[_]}function W1t(A,c){for(var u=0;u<A.length;u++)c.writeVarint(A[u])}function X1t(A,c){for(var u=0;u<A.length;u++)c.writeSVarint(A[u])}function J1t(A,c){for(var u=0;u<A.length;u++)c.writeFloat(A[u])}function Y1t(A,c){for(var u=0;u<A.length;u++)c.writeDouble(A[u])}function Z1t(A,c){for(var u=0;u<A.length;u++)c.writeBoolean(A[u])}function t_t(A,c){for(var u=0;u<A.length;u++)c.writeFixed32(A[u])}function e_t(A,c){for(var u=0;u<A.length;u++)c.writeSFixed32(A[u])}function r_t(A,c){for(var u=0;u<A.length;u++)c.writeFixed64(A[u])}function n_t(A,c){for(var u=0;u<A.length;u++)c.writeSFixed64(A[u])}function l_(A,c){return(A[c]|A[c+1]<<8|A[c+2]<<16)+16777216*A[c+3]}function tp(A,c,u){A[u]=c,A[u+1]=c>>>8,A[u+2]=c>>>16,A[u+3]=c>>>24}function nN(A,c){return(A[c]|A[c+1]<<8|A[c+2]<<16)+(A[c+3]<<24)}$n.prototype={destroy:function(){this.buf=null},readFields:function(A,c,u){for(u=u||this.length;this.pos<u;){var p=this.readVarint(),_=p>>3,x=this.pos;this.type=7&p,A(_,c,this),this.pos===x&&this.skip(p)}return c},readMessage:function(A,c){return this.readFields(A,c,this.readVarint()+this.pos)},readFixed32:function(){var A=l_(this.buf,this.pos);return this.pos+=4,A},readSFixed32:function(){var A=nN(this.buf,this.pos);return this.pos+=4,A},readFixed64:function(){var A=l_(this.buf,this.pos)+l_(this.buf,this.pos+4)*UC;return this.pos+=8,A},readSFixed64:function(){var A=l_(this.buf,this.pos)+nN(this.buf,this.pos+4)*UC;return this.pos+=8,A},readFloat:function(){var A=YO(this.buf,this.pos,!0,23,4);return this.pos+=4,A},readDouble:function(){var A=YO(this.buf,this.pos,!0,52,8);return this.pos+=8,A},readVarint:function(A){var c,u,p=this.buf;return c=127&(u=p[this.pos++]),u<128?c:(c|=(127&(u=p[this.pos++]))<<7,u<128?c:(c|=(127&(u=p[this.pos++]))<<14,u<128?c:(c|=(127&(u=p[this.pos++]))<<21,u<128?c:function(_,x,T){var L,P,z=T.buf;if(L=(112&(P=z[T.pos++]))>>4,P<128||(L|=(127&(P=z[T.pos++]))<<3,P<128)||(L|=(127&(P=z[T.pos++]))<<10,P<128)||(L|=(127&(P=z[T.pos++]))<<17,P<128)||(L|=(127&(P=z[T.pos++]))<<24,P<128)||(L|=(1&(P=z[T.pos++]))<<31,P<128))return Zf(_,L,x);throw new Error("Expected varint not more than 10 bytes")}(c|=(15&(u=p[this.pos]))<<28,A,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var A=this.readVarint();return A%2==1?(A+1)/-2:A/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var A=this.readVarint()+this.pos,c=this.pos;return this.pos=A,A-c>=12&&eN?function(u,p,_){return eN.decode(u.subarray(p,_))}(this.buf,c,A):function(u,p,_){for(var x="",T=p;T<_;){var L,P,z,W=u[T],Y=null,it=W>239?4:W>223?3:W>191?2:1;if(T+it>_)break;it===1?W<128&&(Y=W):it===2?(192&(L=u[T+1]))==128&&(Y=(31&W)<<6|63&L)<=127&&(Y=null):it===3?(P=u[T+2],(192&(L=u[T+1]))==128&&(192&P)==128&&((Y=(15&W)<<12|(63&L)<<6|63&P)<=2047||Y>=55296&&Y<=57343)&&(Y=null)):it===4&&(P=u[T+2],z=u[T+3],(192&(L=u[T+1]))==128&&(192&P)==128&&(192&z)==128&&((Y=(15&W)<<18|(63&L)<<12|(63&P)<<6|63&z)<=65535||Y>=1114112)&&(Y=null)),Y===null?(Y=65533,it=1):Y>65535&&(Y-=65536,x+=String.fromCharCode(Y>>>10&1023|55296),Y=56320|1023&Y),x+=String.fromCharCode(Y),T+=it}return x}(this.buf,c,A)},readBytes:function(){var A=this.readVarint()+this.pos,c=this.buf.subarray(this.pos,A);return this.pos=A,c},readPackedVarint:function(A,c){if(this.type!==$n.Bytes)return A.push(this.readVarint(c));var u=au(this);for(A=A||[];this.pos<u;)A.push(this.readVarint(c));return A},readPackedSVarint:function(A){if(this.type!==$n.Bytes)return A.push(this.readSVarint());var c=au(this);for(A=A||[];this.pos<c;)A.push(this.readSVarint());return A},readPackedBoolean:function(A){if(this.type!==$n.Bytes)return A.push(this.readBoolean());var c=au(this);for(A=A||[];this.pos<c;)A.push(this.readBoolean());return A},readPackedFloat:function(A){if(this.type!==$n.Bytes)return A.push(this.readFloat());var c=au(this);for(A=A||[];this.pos<c;)A.push(this.readFloat());return A},readPackedDouble:function(A){if(this.type!==$n.Bytes)return A.push(this.readDouble());var c=au(this);for(A=A||[];this.pos<c;)A.push(this.readDouble());return A},readPackedFixed32:function(A){if(this.type!==$n.Bytes)return A.push(this.readFixed32());var c=au(this);for(A=A||[];this.pos<c;)A.push(this.readFixed32());return A},readPackedSFixed32:function(A){if(this.type!==$n.Bytes)return A.push(this.readSFixed32());var c=au(this);for(A=A||[];this.pos<c;)A.push(this.readSFixed32());return A},readPackedFixed64:function(A){if(this.type!==$n.Bytes)return A.push(this.readFixed64());var c=au(this);for(A=A||[];this.pos<c;)A.push(this.readFixed64());return A},readPackedSFixed64:function(A){if(this.type!==$n.Bytes)return A.push(this.readSFixed64());var c=au(this);for(A=A||[];this.pos<c;)A.push(this.readSFixed64());return A},skip:function(A){var c=7&A;if(c===$n.Varint)for(;this.buf[this.pos++]>127;);else if(c===$n.Bytes)this.pos=this.readVarint()+this.pos;else if(c===$n.Fixed32)this.pos+=4;else{if(c!==$n.Fixed64)throw new Error("Unimplemented type: "+c);this.pos+=8}},writeTag:function(A,c){this.writeVarint(A<<3|c)},realloc:function(A){for(var c=this.length||16;c<this.pos+A;)c*=2;if(c!==this.length){var u=new Uint8Array(c);u.set(this.buf),this.buf=u,this.length=c}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(A){this.realloc(4),tp(this.buf,A,this.pos),this.pos+=4},writeSFixed32:function(A){this.realloc(4),tp(this.buf,A,this.pos),this.pos+=4},writeFixed64:function(A){this.realloc(8),tp(this.buf,-1&A,this.pos),tp(this.buf,Math.floor(A*tN),this.pos+4),this.pos+=8},writeSFixed64:function(A){this.realloc(8),tp(this.buf,-1&A,this.pos),tp(this.buf,Math.floor(A*tN),this.pos+4),this.pos+=8},writeVarint:function(A){(A=+A||0)>268435455||A<0?function(c,u){var p,_;if(c>=0?(p=c%4294967296|0,_=c/4294967296|0):(_=~(-c/4294967296),4294967295^(p=~(-c%4294967296))?p=p+1|0:(p=0,_=_+1|0)),c>=18446744073709552e3||c<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");u.realloc(10),function(x,T,L){L.buf[L.pos++]=127&x|128,x>>>=7,L.buf[L.pos++]=127&x|128,x>>>=7,L.buf[L.pos++]=127&x|128,x>>>=7,L.buf[L.pos++]=127&x|128,L.buf[L.pos]=127&(x>>>=7)}(p,0,u),function(x,T){var L=(7&x)<<4;T.buf[T.pos++]|=L|((x>>>=3)?128:0),x&&(T.buf[T.pos++]=127&x|((x>>>=7)?128:0),x&&(T.buf[T.pos++]=127&x|((x>>>=7)?128:0),x&&(T.buf[T.pos++]=127&x|((x>>>=7)?128:0),x&&(T.buf[T.pos++]=127&x|((x>>>=7)?128:0),x&&(T.buf[T.pos++]=127&x)))))}(_,u)}(A,this):(this.realloc(4),this.buf[this.pos++]=127&A|(A>127?128:0),A<=127||(this.buf[this.pos++]=127&(A>>>=7)|(A>127?128:0),A<=127||(this.buf[this.pos++]=127&(A>>>=7)|(A>127?128:0),A<=127||(this.buf[this.pos++]=A>>>7&127))))},writeSVarint:function(A){this.writeVarint(A<0?2*-A-1:2*A)},writeBoolean:function(A){this.writeVarint(!!A)},writeString:function(A){A=String(A),this.realloc(4*A.length),this.pos++;var c=this.pos;this.pos=function(p,_,x){for(var T,L,P=0;P<_.length;P++){if((T=_.charCodeAt(P))>55295&&T<57344){if(!L){T>56319||P+1===_.length?(p[x++]=239,p[x++]=191,p[x++]=189):L=T;continue}if(T<56320){p[x++]=239,p[x++]=191,p[x++]=189,L=T;continue}T=L-55296<<10|T-56320|65536,L=null}else L&&(p[x++]=239,p[x++]=191,p[x++]=189,L=null);T<128?p[x++]=T:(T<2048?p[x++]=T>>6|192:(T<65536?p[x++]=T>>12|224:(p[x++]=T>>18|240,p[x++]=T>>12&63|128),p[x++]=T>>6&63|128),p[x++]=63&T|128)}return x}(this.buf,A,this.pos);var u=this.pos-c;u>=128&&rN(c,u,this),this.pos=c-1,this.writeVarint(u),this.pos+=u},writeFloat:function(A){this.realloc(4),ZO(this.buf,A,this.pos,!0,23,4),this.pos+=4},writeDouble:function(A){this.realloc(8),ZO(this.buf,A,this.pos,!0,52,8),this.pos+=8},writeBytes:function(A){var c=A.length;this.writeVarint(c),this.realloc(c);for(var u=0;u<c;u++)this.buf[this.pos++]=A[u]},writeRawMessage:function(A,c){this.pos++;var u=this.pos;A(c,this);var p=this.pos-u;p>=128&&rN(u,p,this),this.pos=u-1,this.writeVarint(p),this.pos+=p},writeMessage:function(A,c,u){this.writeTag(A,$n.Bytes),this.writeRawMessage(c,u)},writePackedVarint:function(A,c){c.length&&this.writeMessage(A,W1t,c)},writePackedSVarint:function(A,c){c.length&&this.writeMessage(A,X1t,c)},writePackedBoolean:function(A,c){c.length&&this.writeMessage(A,Z1t,c)},writePackedFloat:function(A,c){c.length&&this.writeMessage(A,J1t,c)},writePackedDouble:function(A,c){c.length&&this.writeMessage(A,Y1t,c)},writePackedFixed32:function(A,c){c.length&&this.writeMessage(A,t_t,c)},writePackedSFixed32:function(A,c){c.length&&this.writeMessage(A,e_t,c)},writePackedFixed64:function(A,c){c.length&&this.writeMessage(A,r_t,c)},writePackedSFixed64:function(A,c){c.length&&this.writeMessage(A,n_t,c)},writeBytesField:function(A,c){this.writeTag(A,$n.Bytes),this.writeBytes(c)},writeFixed32Field:function(A,c){this.writeTag(A,$n.Fixed32),this.writeFixed32(c)},writeSFixed32Field:function(A,c){this.writeTag(A,$n.Fixed32),this.writeSFixed32(c)},writeFixed64Field:function(A,c){this.writeTag(A,$n.Fixed64),this.writeFixed64(c)},writeSFixed64Field:function(A,c){this.writeTag(A,$n.Fixed64),this.writeSFixed64(c)},writeVarintField:function(A,c){this.writeTag(A,$n.Varint),this.writeVarint(c)},writeSVarintField:function(A,c){this.writeTag(A,$n.Varint),this.writeSVarint(c)},writeStringField:function(A,c){this.writeTag(A,$n.Bytes),this.writeString(c)},writeFloatField:function(A,c){this.writeTag(A,$n.Fixed32),this.writeFloat(c)},writeDoubleField:function(A,c){this.writeTag(A,$n.Fixed64),this.writeDouble(c)},writeBooleanField:function(A,c){this.writeVarintField(A,!!c)}};var RC=f(JO);const DC=3;function i_t(A,c,u){A===1&&u.readMessage(s_t,c)}function s_t(A,c,u){if(A===3){const{id:p,bitmap:_,width:x,height:T,left:L,top:P,advance:z}=u.readMessage(o_t,{});c.push({id:p,bitmap:new gl({width:x+2*DC,height:T+2*DC},_),metrics:{width:x,height:T,left:L,top:P,advance:z}})}}function o_t(A,c,u){A===1?c.id=u.readVarint():A===2?c.bitmap=u.readBytes():A===3?c.width=u.readVarint():A===4?c.height=u.readVarint():A===5?c.left=u.readSVarint():A===6?c.top=u.readSVarint():A===7&&(c.advance=u.readVarint())}const iN=DC;function sN(A){let c=0,u=0;for(const T of A)c+=T.w*T.h,u=Math.max(u,T.w);A.sort((T,L)=>L.h-T.h);const p=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(c/.95)),u),h:1/0}];let _=0,x=0;for(const T of A)for(let L=p.length-1;L>=0;L--){const P=p[L];if(!(T.w>P.w||T.h>P.h)){if(T.x=P.x,T.y=P.y,x=Math.max(x,T.y+T.h),_=Math.max(_,T.x+T.w),T.w===P.w&&T.h===P.h){const z=p.pop();L<p.length&&(p[L]=z)}else T.h===P.h?(P.x+=T.w,P.w-=T.w):T.w===P.w?(P.y+=T.h,P.h-=T.h):(p.push({x:P.x+T.w,y:P.y,w:P.w-T.w,h:T.h}),P.y+=T.h,P.h-=T.h);break}}return{w:_,h:x,fill:c/(_*x)||0}}const ra=1;class OC{constructor(c,u){let{pixelRatio:p,version:_,stretchX:x,stretchY:T,content:L}=u;this.paddedRect=c,this.pixelRatio=p,this.stretchX=x,this.stretchY=T,this.content=L,this.version=_}get tl(){return[this.paddedRect.x+ra,this.paddedRect.y+ra]}get br(){return[this.paddedRect.x+this.paddedRect.w-ra,this.paddedRect.y+this.paddedRect.h-ra]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*ra)/this.pixelRatio,(this.paddedRect.h-2*ra)/this.pixelRatio]}}class oN{constructor(c,u){const p={},_={};this.haveRenderCallbacks=[];const x=[];this.addImages(c,p,x),this.addImages(u,_,x);const{w:T,h:L}=sN(x),P=new so({width:T||1,height:L||1});for(const z in c){const W=c[z],Y=p[z].paddedRect;so.copy(W.data,P,{x:0,y:0},{x:Y.x+ra,y:Y.y+ra},W.data)}for(const z in u){const W=u[z],Y=_[z].paddedRect,it=Y.x+ra,lt=Y.y+ra,ht=W.data.width,Et=W.data.height;so.copy(W.data,P,{x:0,y:0},{x:it,y:lt},W.data),so.copy(W.data,P,{x:0,y:Et-1},{x:it,y:lt-1},{width:ht,height:1}),so.copy(W.data,P,{x:0,y:0},{x:it,y:lt+Et},{width:ht,height:1}),so.copy(W.data,P,{x:ht-1,y:0},{x:it-1,y:lt},{width:1,height:Et}),so.copy(W.data,P,{x:0,y:0},{x:it+ht,y:lt},{width:1,height:Et})}this.image=P,this.iconPositions=p,this.patternPositions=_}addImages(c,u,p){for(const _ in c){const x=c[_],T={x:0,y:0,w:x.data.width+2*ra,h:x.data.height+2*ra};p.push(T),u[_]=new OC(T,x),x.hasRenderCallback&&this.haveRenderCallbacks.push(_)}}patchUpdatedImages(c,u){c.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const p in c.updatedImages)this.patchUpdatedImage(this.iconPositions[p],c.getImage(p),u),this.patchUpdatedImage(this.patternPositions[p],c.getImage(p),u)}patchUpdatedImage(c,u,p){if(!c||!u||c.version===u.version)return;c.version=u.version;const[_,x]=c.tl;p.update(u.data,void 0,{x:_,y:x})}}var sh;ar("ImagePosition",OC),ar("ImageAtlas",oN),o.ai=void 0,(sh=o.ai||(o.ai={}))[sh.none=0]="none",sh[sh.horizontal=1]="horizontal",sh[sh.vertical=2]="vertical",sh[sh.horizontalOnly=3]="horizontalOnly";const gm=-17;class mm{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(c,u){const p=new mm;return p.scale=c||1,p.fontStack=u,p}static forImage(c){const u=new mm;return u.imageName=c,u}}class ep{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(c,u){const p=new ep;for(let _=0;_<c.sections.length;_++){const x=c.sections[_];x.image?p.addImageSection(x):p.addTextSection(x,u)}return p}length(){return this.text.length}getSection(c){return this.sections[this.sectionIndex[c]]}getSectionIndex(c){return this.sectionIndex[c]}getCharCode(c){return this.text.charCodeAt(c)}verticalizePunctuation(){this.text=function(c){let u="";for(let p=0;p<c.length;p++){const _=c.charCodeAt(p+1)||null,x=c.charCodeAt(p-1)||null;u+=_&&XA(_)&&!pm[c[p+1]]||x&&XA(x)&&!pm[c[p-1]]||!pm[c[p]]?c[p]:pm[c[p]]}return u}(this.text)}trim(){let c=0;for(let p=0;p<this.text.length&&u_[this.text.charCodeAt(p)];p++)c++;let u=this.text.length;for(let p=this.text.length-1;p>=0&&p>=c&&u_[this.text.charCodeAt(p)];p--)u--;this.text=this.text.substring(c,u),this.sectionIndex=this.sectionIndex.slice(c,u)}substring(c,u){const p=new ep;return p.text=this.text.substring(c,u),p.sectionIndex=this.sectionIndex.slice(c,u),p.sections=this.sections,p}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((c,u)=>Math.max(c,this.sections[u].scale),0)}addTextSection(c,u){this.text+=c.text,this.sections.push(mm.forText(c.scale,c.fontStack||u));const p=this.sections.length-1;for(let _=0;_<c.text.length;++_)this.sectionIndex.push(p)}addImageSection(c){const u=c.image?c.image.name:"";if(u.length===0)return void vt("Can't add FormattedSection with an empty image.");const p=this.getNextImageSectionCharCode();p?(this.text+=String.fromCharCode(p),this.sections.push(mm.forImage(u)),this.sectionIndex.push(this.sections.length-1)):vt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function A_(A,c,u,p,_,x,T,L,P,z,W,Y,it,lt,ht,Et){const Mt=ep.fromFeature(A,_);let Gt;Y===o.ai.vertical&&Mt.verticalizePunctuation();const{processBidirectionalText:ee,processStyledBidirectionalText:Xt}=eo;if(ee&&Mt.sections.length===1){Gt=[];const xe=ee(Mt.toString(),NC(Mt,z,x,c,p,lt,ht));for(const nr of xe){const gr=new ep;gr.text=nr,gr.sections=Mt.sections;for(let er=0;er<nr.length;er++)gr.sectionIndex.push(0);Gt.push(gr)}}else if(Xt){Gt=[];const xe=Xt(Mt.text,Mt.sectionIndex,NC(Mt,z,x,c,p,lt,ht));for(const nr of xe){const gr=new ep;gr.text=nr[0],gr.sectionIndex=nr[1],gr.sections=Mt.sections,Gt.push(gr)}}else Gt=function(xe,nr){const gr=[],er=xe.text;let Ye=0;for(const $e of nr)gr.push(xe.substring(Ye,$e)),Ye=$e;return Ye<er.length&&gr.push(xe.substring(Ye,er.length)),gr}(Mt,NC(Mt,z,x,c,p,lt,ht));const re=[],de={positionedLines:re,text:Mt.toString(),top:W[1],bottom:W[1],left:W[0],right:W[0],writingMode:Y,iconsInText:!1,verticalizable:!1};return function(xe,nr,gr,er,Ye,$e,lr,Xe,Re,Lr,br,cn){let ci=0,fi=gm,os=0,Ta=0;const Uo=Xe==="right"?1:Xe==="left"?0:.5;let ji=0;for(const as of Ye){as.trim();const cs=as.getMaxScale(),oo=(cs-1)*ss,Oo={positionedGlyphs:[],lineOffset:0};xe.positionedLines[ji]=Oo;const ao=Oo.positionedGlyphs;let na=0;if(!as.length()){fi+=$e,++ji;continue}for(let ls=0;ls<as.length();ls++){const dn=as.getSection(ls),co=as.getSectionIndex(ls),Vs=as.getCharCode(ls);let As=0,Sc=null,_l=null,vl=null,cu=ss;const Tc=!(Re===o.ai.horizontal||!br&&!ks(Vs)||br&&(u_[Vs]||(Ls=Vs,tr.Arabic(Ls)||tr["Arabic Supplement"](Ls)||tr["Arabic Extended-A"](Ls)||tr["Arabic Presentation Forms-A"](Ls)||tr["Arabic Presentation Forms-B"](Ls))));if(dn.imageName){const Xa=er[dn.imageName];if(!Xa)continue;vl=dn.imageName,xe.iconsInText=xe.iconsInText||!0,_l=Xa.paddedRect;const sa=Xa.displaySize;dn.scale=dn.scale*ss/cn,Sc={width:sa[0],height:sa[1],left:ra,top:-iN,advance:Tc?sa[1]:sa[0]},As=oo+(ss-sa[1]*dn.scale),cu=Sc.advance;const lu=Tc?sa[0]*dn.scale-ss*cs:sa[1]*dn.scale-ss*cs;lu>0&&lu>na&&(na=lu)}else{const Xa=gr[dn.fontStack],sa=Xa&&Xa[Vs];if(sa&&sa.rect)_l=sa.rect,Sc=sa.metrics;else{const lu=nr[dn.fontStack],wm=lu&&lu[Vs];if(!wm)continue;Sc=wm.metrics}As=(cs-dn.scale)*ss}Tc?(xe.verticalizable=!0,ao.push({glyph:Vs,imageName:vl,x:ci,y:fi+As,vertical:Tc,scale:dn.scale,fontStack:dn.fontStack,sectionIndex:co,metrics:Sc,rect:_l}),ci+=cu*dn.scale+Lr):(ao.push({glyph:Vs,imageName:vl,x:ci,y:fi+As,vertical:Tc,scale:dn.scale,fontStack:dn.fontStack,sectionIndex:co,metrics:Sc,rect:_l}),ci+=Sc.advance*dn.scale+Lr)}ao.length!==0&&(os=Math.max(ci-Lr,os),l_t(ao,0,ao.length-1,Uo,na)),ci=0;const ia=$e*cs+na;Oo.lineOffset=Math.max(na,oo),fi+=ia,Ta=Math.max(ia,Ta),++ji}var Ls;const Gs=fi-gm,{horizontalAlign:Ro,verticalAlign:Do}=kC(lr);(function(as,cs,oo,Oo,ao,na,ia,ls,dn){const co=(cs-oo)*ao;let Vs=0;Vs=na!==ia?-ls*Oo-gm:(-Oo*dn+.5)*ia;for(const As of as)for(const Sc of As.positionedGlyphs)Sc.x+=co,Sc.y+=Vs})(xe.positionedLines,Uo,Ro,Do,os,Ta,$e,Gs,Ye.length),xe.top+=-Do*Gs,xe.bottom=xe.top+Gs,xe.left+=-Ro*os,xe.right=xe.left+os}(de,c,u,p,Gt,T,L,P,Y,z,it,Et),!function(xe){for(const nr of xe)if(nr.positionedGlyphs.length!==0)return!1;return!0}(re)&&de}const u_={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},a_t={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function aN(A,c,u,p,_,x){if(c.imageName){const T=p[c.imageName];return T?T.displaySize[0]*c.scale*ss/x+_:0}{const T=u[c.fontStack],L=T&&T[A];return L?L.metrics.advance*c.scale+_:0}}function cN(A,c,u,p){const _=Math.pow(A-c,2);return p?A<c?_/2:2*_:_+Math.abs(u)*u}function c_t(A,c,u){let p=0;return A===10&&(p-=1e4),u&&(p+=150),A!==40&&A!==65288||(p+=50),c!==41&&c!==65289||(p+=50),p}function lN(A,c,u,p,_,x){let T=null,L=cN(c,u,_,x);for(const P of p){const z=cN(c-P.x,u,_,x)+P.badness;z<=L&&(T=P,L=z)}return{index:A,x:c,priorBreak:T,badness:L}}function AN(A){return A?AN(A.priorBreak).concat(A.index):[]}function NC(A,c,u,p,_,x,T){if(x!=="point")return[];if(!A)return[];const L=[],P=function(it,lt,ht,Et,Mt,Gt){let ee=0;for(let Xt=0;Xt<it.length();Xt++){const re=it.getSection(Xt);ee+=aN(it.getCharCode(Xt),re,Et,Mt,lt,Gt)}return ee/Math.max(1,Math.ceil(ee/ht))}(A,c,u,p,_,T),z=A.text.indexOf("")>=0;let W=0;for(let it=0;it<A.length();it++){const lt=A.getSection(it),ht=A.getCharCode(it);if(u_[ht]||(W+=aN(ht,lt,p,_,c,T)),it<A.length()-1){const Et=!((Y=ht)<11904||!(tr["Bopomofo Extended"](Y)||tr.Bopomofo(Y)||tr["CJK Compatibility Forms"](Y)||tr["CJK Compatibility Ideographs"](Y)||tr["CJK Compatibility"](Y)||tr["CJK Radicals Supplement"](Y)||tr["CJK Strokes"](Y)||tr["CJK Symbols and Punctuation"](Y)||tr["CJK Unified Ideographs Extension A"](Y)||tr["CJK Unified Ideographs"](Y)||tr["Enclosed CJK Letters and Months"](Y)||tr["Halfwidth and Fullwidth Forms"](Y)||tr.Hiragana(Y)||tr["Ideographic Description Characters"](Y)||tr["Kangxi Radicals"](Y)||tr["Katakana Phonetic Extensions"](Y)||tr.Katakana(Y)||tr["Vertical Forms"](Y)||tr["Yi Radicals"](Y)||tr["Yi Syllables"](Y)));(a_t[ht]||Et||lt.imageName)&&L.push(lN(it+1,W,P,L,c_t(ht,A.getCharCode(it+1),Et&&z),!1))}}var Y;return AN(lN(A.length(),W,P,L,0,!0))}function kC(A){let c=.5,u=.5;switch(A){case"right":case"top-right":case"bottom-right":c=1;break;case"left":case"top-left":case"bottom-left":c=0}switch(A){case"bottom":case"bottom-right":case"bottom-left":u=1;break;case"top":case"top-right":case"top-left":u=0}return{horizontalAlign:c,verticalAlign:u}}function l_t(A,c,u,p,_){if(!p&&!_)return;const x=A[u],T=(A[u].x+x.metrics.advance*x.scale)*p;for(let L=c;L<=u;L++)A[L].x-=T,A[L].y+=_}function A_t(A,c,u){const{horizontalAlign:p,verticalAlign:_}=kC(u),x=c[0]-A.displaySize[0]*p,T=c[1]-A.displaySize[1]*_;return{image:A,top:T,bottom:T+A.displaySize[1],left:x,right:x+A.displaySize[0]}}function uN(A,c,u,p,_,x){const T=A.image;let L;if(T.content){const Mt=T.content,Gt=T.pixelRatio||1;L=[Mt[0]/Gt,Mt[1]/Gt,T.displaySize[0]-Mt[2]/Gt,T.displaySize[1]-Mt[3]/Gt]}const P=c.left*x,z=c.right*x;let W,Y,it,lt;u==="width"||u==="both"?(lt=_[0]+P-p[3],Y=_[0]+z+p[1]):(lt=_[0]+(P+z-T.displaySize[0])/2,Y=lt+T.displaySize[0]);const ht=c.top*x,Et=c.bottom*x;return u==="height"||u==="both"?(W=_[1]+ht-p[0],it=_[1]+Et+p[2]):(W=_[1]+(ht+Et-T.displaySize[1])/2,it=W+T.displaySize[1]),{image:T,top:W,right:Y,bottom:it,left:lt,collisionPadding:L}}const ym=255,pA=128,oh=ym*pA;function hN(A,c){const{expression:u}=c;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new Jn(A+1))};if(u.kind==="source")return{kind:"source"};{const{zoomStops:p,interpolationType:_}=u;let x=0;for(;x<p.length&&p[x]<=A;)x++;x=Math.max(0,x-1);let T=x;for(;T<p.length&&p[T]<A+1;)T++;T=Math.min(p.length-1,T);const L=p[x],P=p[T];return u.kind==="composite"?{kind:"composite",minZoom:L,maxZoom:P,interpolationType:_}:{kind:"camera",minZoom:L,maxZoom:P,minSize:u.evaluate(new Jn(L)),maxSize:u.evaluate(new Jn(P)),interpolationType:_}}}function QC(A,c,u){let p="never";const _=A.get(c);return _?p=_:A.get(u)&&(p="always"),p}const u_t=ih.VectorTileFeature.types,h_t=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function h_(A,c,u,p,_,x,T,L,P,z,W,Y,it){const lt=L?Math.min(oh,Math.round(L[0])):0,ht=L?Math.min(oh,Math.round(L[1])):0;A.emplaceBack(c,u,Math.round(32*p),Math.round(32*_),x,T,(lt<<1)+(P?1:0),ht,16*z,16*W,256*Y,256*it)}function zC(A,c,u){A.emplaceBack(c.x,c.y,u),A.emplaceBack(c.x,c.y,u),A.emplaceBack(c.x,c.y,u),A.emplaceBack(c.x,c.y,u)}function d_t(A){for(const c of A.sections)if($u(c.text))return!0;return!1}class HC{constructor(c){this.layoutVertexArray=new ve,this.indexArray=new Ge,this.programConfigurations=c,this.segments=new Sr,this.dynamicLayoutVertexArray=new he,this.opacityVertexArray=new Le,this.hasVisibleVertices=!1,this.placedSymbolArray=new O}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(c,u,p,_){this.isEmpty()||(p&&(this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,V1t.members),this.indexBuffer=c.createIndexBuffer(this.indexArray,u),this.dynamicLayoutVertexBuffer=c.createVertexBuffer(this.dynamicLayoutVertexArray,j1t.members,!0),this.opacityVertexBuffer=c.createVertexBuffer(this.opacityVertexArray,h_t,!0),this.opacityVertexBuffer.itemSize=1),(p||_)&&this.programConfigurations.upload(c))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}ar("SymbolBuffers",HC);class GC{constructor(c,u,p){this.layoutVertexArray=new c,this.layoutAttributes=u,this.indexArray=new p,this.segments=new Sr,this.collisionVertexArray=new sr}upload(c){this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=c.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=c.createVertexBuffer(this.collisionVertexArray,q1t.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}ar("CollisionBuffers",GC);class rp{constructor(c){this.collisionBoxArray=c.collisionBoxArray,this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(T=>T.id),this.index=c.index,this.pixelRatio=c.pixelRatio,this.sourceLayerIndex=c.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Kf([]),this.placementViewportMatrix=Kf([]);const u=this.layers[0]._unevaluatedLayout._values;this.textSizeData=hN(this.zoom,u["text-size"]),this.iconSizeData=hN(this.zoom,u["icon-size"]);const p=this.layers[0].layout,_=p.get("symbol-sort-key"),x=p.get("symbol-z-order");this.canOverlap=QC(p,"text-overlap","text-allow-overlap")!=="never"||QC(p,"icon-overlap","icon-allow-overlap")!=="never"||p.get("text-ignore-placement")||p.get("icon-ignore-placement"),this.sortFeaturesByKey=x!=="viewport-y"&&!_.isConstant(),this.sortFeaturesByY=(x==="viewport-y"||x==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,p.get("symbol-placement")==="point"&&(this.writingModes=p.get("text-writing-mode").map(T=>o.ai[T])),this.stateDependentLayerIds=this.layers.filter(T=>T.isStateDependent()).map(T=>T.id),this.sourceID=c.sourceID}createArrays(){this.text=new HC(new io(this.layers,this.zoom,c=>/^text/.test(c))),this.icon=new HC(new io(this.layers,this.zoom,c=>/^icon/.test(c))),this.glyphOffsetArray=new q,this.lineVertexArray=new X,this.symbolInstances=new H,this.textAnchorOffsets=new ot}calculateGlyphDependencies(c,u,p,_,x){for(let T=0;T<c.length;T++)if(u[c.charCodeAt(T)]=!0,(p||_)&&x){const L=pm[c.charAt(T)];L&&(u[L.charCodeAt(0)]=!0)}}populate(c,u,p){const _=this.layers[0],x=_.layout,T=x.get("text-font"),L=x.get("text-field"),P=x.get("icon-image"),z=(L.value.kind!=="constant"||L.value.value instanceof Dn&&!L.value.value.isEmpty()||L.value.value.toString().length>0)&&(T.value.kind!=="constant"||T.value.value.length>0),W=P.value.kind!=="constant"||!!P.value.value||Object.keys(P.parameters).length>0,Y=x.get("symbol-sort-key");if(this.features=[],!z&&!W)return;const it=u.iconDependencies,lt=u.glyphDependencies,ht=u.availableImages,Et=new Jn(this.zoom);for(const{feature:Mt,id:Gt,index:ee,sourceLayerIndex:Xt}of c){const re=_._featureFilter.needGeometry,de=hA(Mt,re);if(!_._featureFilter.filter(Et,de,p))continue;let xe,nr;if(re||(de.geometry=Ec(Mt)),z){const er=_.getValueAndResolveTokens("text-field",de,p,ht),Ye=Dn.factory(er);d_t(Ye)&&(this.hasRTLText=!0),(!this.hasRTLText||Xu()==="unavailable"||this.hasRTLText&&eo.isParsed())&&(xe=$1t(Ye,_,de))}if(W){const er=_.getValueAndResolveTokens("icon-image",de,p,ht);nr=er instanceof kr?er:kr.fromString(er)}if(!xe&&!nr)continue;const gr=this.sortFeaturesByKey?Y.evaluate(de,{},p):void 0;if(this.features.push({id:Gt,text:xe,icon:nr,index:ee,sourceLayerIndex:Xt,geometry:de.geometry,properties:Mt.properties,type:u_t[Mt.type],sortKey:gr}),nr&&(it[nr.name]=!0),xe){const er=T.evaluate(de,{},p).join(","),Ye=x.get("text-rotation-alignment")!=="viewport"&&x.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(o.ai.vertical)>=0;for(const $e of xe.sections)if($e.image)it[$e.image.name]=!0;else{const lr=WA(xe.toString()),Xe=$e.fontStack||er,Re=lt[Xe]=lt[Xe]||{};this.calculateGlyphDependencies($e.text,Re,Ye,this.allowVerticalPlacement,lr)}}}x.get("symbol-placement")==="line"&&(this.features=function(Mt){const Gt={},ee={},Xt=[];let re=0;function de(er){Xt.push(Mt[er]),re++}function xe(er,Ye,$e){const lr=ee[er];return delete ee[er],ee[Ye]=lr,Xt[lr].geometry[0].pop(),Xt[lr].geometry[0]=Xt[lr].geometry[0].concat($e[0]),lr}function nr(er,Ye,$e){const lr=Gt[Ye];return delete Gt[Ye],Gt[er]=lr,Xt[lr].geometry[0].shift(),Xt[lr].geometry[0]=$e[0].concat(Xt[lr].geometry[0]),lr}function gr(er,Ye,$e){const lr=$e?Ye[0][Ye[0].length-1]:Ye[0][0];return`${er}:${lr.x}:${lr.y}`}for(let er=0;er<Mt.length;er++){const Ye=Mt[er],$e=Ye.geometry,lr=Ye.text?Ye.text.toString():null;if(!lr){de(er);continue}const Xe=gr(lr,$e),Re=gr(lr,$e,!0);if(Xe in ee&&Re in Gt&&ee[Xe]!==Gt[Re]){const Lr=nr(Xe,Re,$e),br=xe(Xe,Re,Xt[Lr].geometry);delete Gt[Xe],delete ee[Re],ee[gr(lr,Xt[br].geometry,!0)]=br,Xt[Lr].geometry=null}else Xe in ee?xe(Xe,Re,$e):Re in Gt?nr(Xe,Re,$e):(de(er),Gt[Xe]=re-1,ee[Re]=re-1)}return Xt.filter(er=>er.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Mt,Gt)=>Mt.sortKey-Gt.sortKey)}update(c,u,p){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(c,u,this.layers,p),this.icon.programConfigurations.updatePaintArrays(c,u,this.layers,p))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(c){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(c),this.iconCollisionBox.upload(c)),this.text.upload(c,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(c,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(c,u){const p=this.lineVertexArray.length;if(c.segment!==void 0){let _=c.dist(u[c.segment+1]),x=c.dist(u[c.segment]);const T={};for(let L=c.segment+1;L<u.length;L++)T[L]={x:u[L].x,y:u[L].y,tileUnitDistanceFromAnchor:_},L<u.length-1&&(_+=u[L+1].dist(u[L]));for(let L=c.segment||0;L>=0;L--)T[L]={x:u[L].x,y:u[L].y,tileUnitDistanceFromAnchor:x},L>0&&(x+=u[L-1].dist(u[L]));for(let L=0;L<u.length;L++){const P=T[L];this.lineVertexArray.emplaceBack(P.x,P.y,P.tileUnitDistanceFromAnchor)}}return{lineStartIndex:p,lineLength:this.lineVertexArray.length-p}}addSymbols(c,u,p,_,x,T,L,P,z,W,Y,it){const lt=c.indexArray,ht=c.layoutVertexArray,Et=c.segments.prepareSegment(4*u.length,ht,lt,this.canOverlap?T.sortKey:void 0),Mt=this.glyphOffsetArray.length,Gt=Et.vertexLength,ee=this.allowVerticalPlacement&&L===o.ai.vertical?Math.PI/2:0,Xt=T.text&&T.text.sections;for(let re=0;re<u.length;re++){const{tl:de,tr:xe,bl:nr,br:gr,tex:er,pixelOffsetTL:Ye,pixelOffsetBR:$e,minFontScaleX:lr,minFontScaleY:Xe,glyphOffset:Re,isSDF:Lr,sectionIndex:br}=u[re],cn=Et.vertexLength,ci=Re[1];h_(ht,P.x,P.y,de.x,ci+de.y,er.x,er.y,p,Lr,Ye.x,Ye.y,lr,Xe),h_(ht,P.x,P.y,xe.x,ci+xe.y,er.x+er.w,er.y,p,Lr,$e.x,Ye.y,lr,Xe),h_(ht,P.x,P.y,nr.x,ci+nr.y,er.x,er.y+er.h,p,Lr,Ye.x,$e.y,lr,Xe),h_(ht,P.x,P.y,gr.x,ci+gr.y,er.x+er.w,er.y+er.h,p,Lr,$e.x,$e.y,lr,Xe),zC(c.dynamicLayoutVertexArray,P,ee),lt.emplaceBack(cn,cn+1,cn+2),lt.emplaceBack(cn+1,cn+2,cn+3),Et.vertexLength+=4,Et.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Re[0]),re!==u.length-1&&br===u[re+1].sectionIndex||c.programConfigurations.populatePaintArrays(ht.length,T,T.index,{},it,Xt&&Xt[br])}c.placedSymbolArray.emplaceBack(P.x,P.y,Mt,this.glyphOffsetArray.length-Mt,Gt,z,W,P.segment,p?p[0]:0,p?p[1]:0,_[0],_[1],L,0,!1,0,Y)}_addCollisionDebugVertex(c,u,p,_,x,T){return u.emplaceBack(0,0),c.emplaceBack(p.x,p.y,_,x,Math.round(T.x),Math.round(T.y))}addCollisionDebugVertices(c,u,p,_,x,T,L){const P=x.segments.prepareSegment(4,x.layoutVertexArray,x.indexArray),z=P.vertexLength,W=x.layoutVertexArray,Y=x.collisionVertexArray,it=L.anchorX,lt=L.anchorY;this._addCollisionDebugVertex(W,Y,T,it,lt,new C(c,u)),this._addCollisionDebugVertex(W,Y,T,it,lt,new C(p,u)),this._addCollisionDebugVertex(W,Y,T,it,lt,new C(p,_)),this._addCollisionDebugVertex(W,Y,T,it,lt,new C(c,_)),P.vertexLength+=4;const ht=x.indexArray;ht.emplaceBack(z,z+1),ht.emplaceBack(z+1,z+2),ht.emplaceBack(z+2,z+3),ht.emplaceBack(z+3,z),P.primitiveLength+=4}addDebugCollisionBoxes(c,u,p,_){for(let x=c;x<u;x++){const T=this.collisionBoxArray.get(x);this.addCollisionDebugVertices(T.x1,T.y1,T.x2,T.y2,_?this.textCollisionBox:this.iconCollisionBox,T.anchorPoint,p)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new GC(Oe,XO.members,zr),this.iconCollisionBox=new GC(Oe,XO.members,zr);for(let c=0;c<this.symbolInstances.length;c++){const u=this.symbolInstances.get(c);this.addDebugCollisionBoxes(u.textBoxStartIndex,u.textBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.iconBoxStartIndex,u.iconBoxEndIndex,u,!1),this.addDebugCollisionBoxes(u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex,u,!1)}}_deserializeCollisionBoxesForSymbol(c,u,p,_,x,T,L,P,z){const W={};for(let Y=u;Y<p;Y++){const it=c.get(Y);W.textBox={x1:it.x1,y1:it.y1,x2:it.x2,y2:it.y2,anchorPointX:it.anchorPointX,anchorPointY:it.anchorPointY},W.textFeatureIndex=it.featureIndex;break}for(let Y=_;Y<x;Y++){const it=c.get(Y);W.verticalTextBox={x1:it.x1,y1:it.y1,x2:it.x2,y2:it.y2,anchorPointX:it.anchorPointX,anchorPointY:it.anchorPointY},W.verticalTextFeatureIndex=it.featureIndex;break}for(let Y=T;Y<L;Y++){const it=c.get(Y);W.iconBox={x1:it.x1,y1:it.y1,x2:it.x2,y2:it.y2,anchorPointX:it.anchorPointX,anchorPointY:it.anchorPointY},W.iconFeatureIndex=it.featureIndex;break}for(let Y=P;Y<z;Y++){const it=c.get(Y);W.verticalIconBox={x1:it.x1,y1:it.y1,x2:it.x2,y2:it.y2,anchorPointX:it.anchorPointX,anchorPointY:it.anchorPointY},W.verticalIconFeatureIndex=it.featureIndex;break}return W}deserializeCollisionBoxes(c){this.collisionArrays=[];for(let u=0;u<this.symbolInstances.length;u++){const p=this.symbolInstances.get(u);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(c,p.textBoxStartIndex,p.textBoxEndIndex,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p.iconBoxStartIndex,p.iconBoxEndIndex,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(c,u){const p=c.placedSymbolArray.get(u),_=p.vertexStartIndex+4*p.numGlyphs;for(let x=p.vertexStartIndex;x<_;x+=4)c.indexArray.emplaceBack(x,x+1,x+2),c.indexArray.emplaceBack(x+1,x+2,x+3)}getSortedSymbolIndexes(c){if(this.sortedAngle===c&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const u=Math.sin(c),p=Math.cos(c),_=[],x=[],T=[];for(let L=0;L<this.symbolInstances.length;++L){T.push(L);const P=this.symbolInstances.get(L);_.push(0|Math.round(u*P.anchorX+p*P.anchorY)),x.push(P.featureIndex)}return T.sort((L,P)=>_[L]-_[P]||x[P]-x[L]),T}addToSortKeyRanges(c,u){const p=this.sortKeyRanges[this.sortKeyRanges.length-1];p&&p.sortKey===u?p.symbolInstanceEnd=c+1:this.sortKeyRanges.push({sortKey:u,symbolInstanceStart:c,symbolInstanceEnd:c+1})}sortFeatures(c){if(this.sortFeaturesByY&&this.sortedAngle!==c&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(c),this.sortedAngle=c,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const u of this.symbolInstanceIndexes){const p=this.symbolInstances.get(u);this.featureSortOrder.push(p.featureIndex),[p.rightJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.leftJustifiedTextSymbolIndex].forEach((_,x,T)=>{_>=0&&T.indexOf(_)===x&&this.addIndicesForPlacedSymbol(this.text,_)}),p.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,p.verticalPlacedTextSymbolIndex),p.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,p.placedIconSymbolIndex),p.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,p.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let dN,fN;ar("SymbolBucket",rp,{omit:["layers","collisionBoxArray","features","compareText"]}),rp.MAX_GLYPHS=65535,rp.addDynamicAttributes=zC;var VC={get paint(){return fN=fN||new In({"icon-opacity":new Mr(Kt.paint_symbol["icon-opacity"]),"icon-color":new Mr(Kt.paint_symbol["icon-color"]),"icon-halo-color":new Mr(Kt.paint_symbol["icon-halo-color"]),"icon-halo-width":new Mr(Kt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Mr(Kt.paint_symbol["icon-halo-blur"]),"icon-translate":new vr(Kt.paint_symbol["icon-translate"]),"icon-translate-anchor":new vr(Kt.paint_symbol["icon-translate-anchor"]),"text-opacity":new Mr(Kt.paint_symbol["text-opacity"]),"text-color":new Mr(Kt.paint_symbol["text-color"],{runtimeType:Jr,getOverride:A=>A.textColor,hasOverride:A=>!!A.textColor}),"text-halo-color":new Mr(Kt.paint_symbol["text-halo-color"]),"text-halo-width":new Mr(Kt.paint_symbol["text-halo-width"]),"text-halo-blur":new Mr(Kt.paint_symbol["text-halo-blur"]),"text-translate":new vr(Kt.paint_symbol["text-translate"]),"text-translate-anchor":new vr(Kt.paint_symbol["text-translate-anchor"])})},get layout(){return dN=dN||new In({"symbol-placement":new vr(Kt.layout_symbol["symbol-placement"]),"symbol-spacing":new vr(Kt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new vr(Kt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Mr(Kt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new vr(Kt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new vr(Kt.layout_symbol["icon-allow-overlap"]),"icon-overlap":new vr(Kt.layout_symbol["icon-overlap"]),"icon-ignore-placement":new vr(Kt.layout_symbol["icon-ignore-placement"]),"icon-optional":new vr(Kt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new vr(Kt.layout_symbol["icon-rotation-alignment"]),"icon-size":new Mr(Kt.layout_symbol["icon-size"]),"icon-text-fit":new vr(Kt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new vr(Kt.layout_symbol["icon-text-fit-padding"]),"icon-image":new Mr(Kt.layout_symbol["icon-image"]),"icon-rotate":new Mr(Kt.layout_symbol["icon-rotate"]),"icon-padding":new Mr(Kt.layout_symbol["icon-padding"]),"icon-keep-upright":new vr(Kt.layout_symbol["icon-keep-upright"]),"icon-offset":new Mr(Kt.layout_symbol["icon-offset"]),"icon-anchor":new Mr(Kt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new vr(Kt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new vr(Kt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new vr(Kt.layout_symbol["text-rotation-alignment"]),"text-field":new Mr(Kt.layout_symbol["text-field"]),"text-font":new Mr(Kt.layout_symbol["text-font"]),"text-size":new Mr(Kt.layout_symbol["text-size"]),"text-max-width":new Mr(Kt.layout_symbol["text-max-width"]),"text-line-height":new vr(Kt.layout_symbol["text-line-height"]),"text-letter-spacing":new Mr(Kt.layout_symbol["text-letter-spacing"]),"text-justify":new Mr(Kt.layout_symbol["text-justify"]),"text-radial-offset":new Mr(Kt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new vr(Kt.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Mr(Kt.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Mr(Kt.layout_symbol["text-anchor"]),"text-max-angle":new vr(Kt.layout_symbol["text-max-angle"]),"text-writing-mode":new vr(Kt.layout_symbol["text-writing-mode"]),"text-rotate":new Mr(Kt.layout_symbol["text-rotate"]),"text-padding":new vr(Kt.layout_symbol["text-padding"]),"text-keep-upright":new vr(Kt.layout_symbol["text-keep-upright"]),"text-transform":new Mr(Kt.layout_symbol["text-transform"]),"text-offset":new Mr(Kt.layout_symbol["text-offset"]),"text-allow-overlap":new vr(Kt.layout_symbol["text-allow-overlap"]),"text-overlap":new vr(Kt.layout_symbol["text-overlap"]),"text-ignore-placement":new vr(Kt.layout_symbol["text-ignore-placement"]),"text-optional":new vr(Kt.layout_symbol["text-optional"])})}};class pN{constructor(c){if(c.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=c.property.overrides?c.property.overrides.runtimeType:rn,this.defaultValue=c}evaluate(c){if(c.formattedSection){const u=this.defaultValue.property.overrides;if(u&&u.hasOverride(c.formattedSection))return u.getOverride(c.formattedSection)}return c.feature&&c.featureState?this.defaultValue.evaluate(c.feature,c.featureState):this.defaultValue.property.specification.default}eachChild(c){this.defaultValue.isConstant()||c(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ar("FormatSectionOverride",pN,{omit:["defaultValue"]});class d_ extends Mo{constructor(c){super(c,VC)}recalculate(c,u){if(super.recalculate(c,u),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const p=this.layout.get("text-writing-mode");if(p){const _=[];for(const x of p)_.indexOf(x)<0&&_.push(x);this.layout._values["text-writing-mode"]=_}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(c,u,p,_){const x=this.layout.get(c).evaluate(u,{},p,_),T=this._unevaluatedLayout._values[c];return T.isDataDriven()||di(T.value)||!x?x:function(L,P){return P.replace(/{([^{}]+)}/g,(z,W)=>L&&W in L?String(L[W]):"")}(u.properties,x)}createBucket(c){return new rp(c)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const c of VC.paint.overridableProperties){if(!d_.hasPaintOverride(this.layout,c))continue;const u=this.paint.get(c),p=new pN(u),_=new hi(p,u.property.specification);let x=null;x=u.value.kind==="constant"||u.value.kind==="source"?new Ci("source",_):new Ds("composite",_,u.value.zoomStops),this.paint._values[c]=new Is(u.property,x,u.parameters)}}_handleOverridablePaintPropertyUpdate(c,u,p){return!(!this.layout||u.isDataDriven()||p.isDataDriven())&&d_.hasPaintOverride(this.layout,c)}static hasPaintOverride(c,u){const p=c.get("text-field"),_=VC.paint.properties[u];let x=!1;const T=L=>{for(const P of L)if(_.overrides&&_.overrides.hasOverride(P))return void(x=!0)};if(p.value.kind==="constant"&&p.value.value instanceof Dn)T(p.value.value.sections);else if(p.value.kind==="source"){const L=z=>{x||(z instanceof Ys&&Tn(z.value)===_t?T(z.value.sections):z instanceof mc?T(z.sections):z.eachChild(L))},P=p.value;P._styleExpression&&L(P._styleExpression.expression)}return x}}let gN;var f_t={get paint(){return gN=gN||new In({"background-color":new vr(Kt.paint_background["background-color"]),"background-pattern":new rd(Kt.paint_background["background-pattern"]),"background-opacity":new vr(Kt.paint_background["background-opacity"])})}};class p_t extends Mo{constructor(c){super(c,f_t)}}let mN;var g_t={get paint(){return mN=mN||new In({"raster-opacity":new vr(Kt.paint_raster["raster-opacity"]),"raster-hue-rotate":new vr(Kt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new vr(Kt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new vr(Kt.paint_raster["raster-brightness-max"]),"raster-saturation":new vr(Kt.paint_raster["raster-saturation"]),"raster-contrast":new vr(Kt.paint_raster["raster-contrast"]),"raster-resampling":new vr(Kt.paint_raster["raster-resampling"]),"raster-fade-duration":new vr(Kt.paint_raster["raster-fade-duration"])})}};class m_t extends Mo{constructor(c){super(c,g_t)}}class y_t extends Mo{constructor(c){super(c,{}),this.onAdd=u=>{this.implementation.onAdd&&this.implementation.onAdd(u,u.painter.context.gl)},this.onRemove=u=>{this.implementation.onRemove&&this.implementation.onRemove(u,u.painter.context.gl)},this.implementation=c}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class __t{constructor(c){this._callback=c,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const jC=63710088e-1;class ah{constructor(c,u){if(isNaN(c)||isNaN(u))throw new Error(`Invalid LngLat object: (${c}, ${u})`);if(this.lng=+c,this.lat=+u,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ah(yt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(c){const u=Math.PI/180,p=this.lat*u,_=c.lat*u,x=Math.sin(p)*Math.sin(_)+Math.cos(p)*Math.cos(_)*Math.cos((c.lng-this.lng)*u);return jC*Math.acos(Math.min(x,1))}static convert(c){if(c instanceof ah)return c;if(Array.isArray(c)&&(c.length===2||c.length===3))return new ah(Number(c[0]),Number(c[1]));if(!Array.isArray(c)&&typeof c=="object"&&c!==null)return new ah(Number("lng"in c?c.lng:c.lon),Number(c.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const yN=2*Math.PI*jC;function _N(A){return yN*Math.cos(A*Math.PI/180)}function vN(A){return(180+A)/360}function bN(A){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+A*Math.PI/360)))/360}function wN(A,c){return A/_N(c)}function xN(A){return 360*A-180}function qC(A){return 360/Math.PI*Math.atan(Math.exp((180-360*A)*Math.PI/180))-90}class f_{constructor(c,u){let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;this.x=+c,this.y=+u,this.z=+p}static fromLngLat(c){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const p=ah.convert(c);return new f_(vN(p.lng),bN(p.lat),wN(u,p.lat))}toLngLat(){return new ah(xN(this.x),qC(this.y))}toAltitude(){return this.z*_N(qC(this.y))}meterInMercatorCoordinateUnits(){return 1/yN*(c=qC(this.y),1/Math.cos(c*Math.PI/180));var c}}function BN(A,c,u){var p=2*Math.PI*6378137/256/Math.pow(2,u);return[A*p-2*Math.PI*6378137/2,c*p-2*Math.PI*6378137/2]}class KC{constructor(c,u,p){if(c<0||c>25||p<0||p>=Math.pow(2,c)||u<0||u>=Math.pow(2,c))throw new Error(`x=${u}, y=${p}, z=${c} outside of bounds. 0<=x<${Math.pow(2,c)}, 0<=y<${Math.pow(2,c)} 0<=z<=25 `);this.z=c,this.x=u,this.y=p,this.key=_m(0,c,c,u,p)}equals(c){return this.z===c.z&&this.x===c.x&&this.y===c.y}url(c,u,p){const _=(T=this.y,L=this.z,P=BN(256*(x=this.x),256*(T=Math.pow(2,L)-T-1),L),z=BN(256*(x+1),256*(T+1),L),P[0]+","+P[1]+","+z[0]+","+z[1]);var x,T,L,P,z;const W=function(Y,it,lt){let ht,Et="";for(let Mt=Y;Mt>0;Mt--)ht=1<<Mt-1,Et+=(it&ht?1:0)+(lt&ht?2:0);return Et}(this.z,this.x,this.y);return c[(this.x+this.y)%c.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(p==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,u>1?"@2x":"").replace(/{quadkey}/g,W).replace(/{bbox-epsg-3857}/g,_)}isChildOf(c){const u=this.z-c.z;return u>0&&c.x===this.x>>u&&c.y===this.y>>u}getTilePoint(c){const u=Math.pow(2,this.z);return new C((c.x*u-this.x)*ei,(c.y*u-this.y)*ei)}toString(){return`${this.z}/${this.x}/${this.y}`}}class CN{constructor(c,u){this.wrap=c,this.canonical=u,this.key=_m(c,u.z,u.z,u.x,u.y)}}class Wa{constructor(c,u,p,_,x){if(c<p)throw new Error(`overscaledZ should be >= z; overscaledZ = ${c}; z = ${p}`);this.overscaledZ=c,this.wrap=u,this.canonical=new KC(p,+_,+x),this.key=_m(u,c,p,_,x)}clone(){return new Wa(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(c){return this.overscaledZ===c.overscaledZ&&this.wrap===c.wrap&&this.canonical.equals(c.canonical)}scaledTo(c){if(c>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${c}; overscaledZ = ${this.overscaledZ}`);const u=this.canonical.z-c;return c>this.canonical.z?new Wa(c,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Wa(c,this.wrap,c,this.canonical.x>>u,this.canonical.y>>u)}calculateScaledKey(c,u){if(c>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${c}; overscaledZ = ${this.overscaledZ}`);const p=this.canonical.z-c;return c>this.canonical.z?_m(this.wrap*+u,c,this.canonical.z,this.canonical.x,this.canonical.y):_m(this.wrap*+u,c,c,this.canonical.x>>p,this.canonical.y>>p)}isChildOf(c){if(c.wrap!==this.wrap)return!1;const u=this.canonical.z-c.canonical.z;return c.overscaledZ===0||c.overscaledZ<this.overscaledZ&&c.canonical.x===this.canonical.x>>u&&c.canonical.y===this.canonical.y>>u}children(c){if(this.overscaledZ>=c)return[new Wa(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const u=this.canonical.z+1,p=2*this.canonical.x,_=2*this.canonical.y;return[new Wa(u,this.wrap,u,p,_),new Wa(u,this.wrap,u,p+1,_),new Wa(u,this.wrap,u,p,_+1),new Wa(u,this.wrap,u,p+1,_+1)]}isLessThan(c){return this.wrap<c.wrap||!(this.wrap>c.wrap)&&(this.overscaledZ<c.overscaledZ||!(this.overscaledZ>c.overscaledZ)&&(this.canonical.x<c.canonical.x||!(this.canonical.x>c.canonical.x)&&this.canonical.y<c.canonical.y))}wrapped(){return new Wa(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(c){return new Wa(this.overscaledZ,c,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new CN(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(c){return this.canonical.getTilePoint(new f_(c.x-this.wrap,c.y))}}function _m(A,c,u,p,_){(A*=2)<0&&(A=-1*A-1);const x=1<<u;return(x*x*A+x*_+p).toString(36)+u.toString(36)+c.toString(36)}ar("CanonicalTileID",KC),ar("OverscaledTileID",Wa,{omit:["posMatrix"]});class EN{constructor(c,u,p){let _=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1,x=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1,T=arguments.length>5&&arguments[5]!==void 0?arguments[5]:1,L=arguments.length>6&&arguments[6]!==void 0?arguments[6]:0;if(this.uid=c,u.height!==u.width)throw new RangeError("DEM tiles must be square");if(p&&!["mapbox","terrarium","custom"].includes(p))return void vt(`"${p}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=u.height;const P=this.dim=u.height-2;switch(this.data=new Uint32Array(u.data.buffer),p){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=_,this.greenFactor=x,this.blueFactor=T,this.baseShift=L;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let z=0;z<P;z++)this.data[this._idx(-1,z)]=this.data[this._idx(0,z)],this.data[this._idx(P,z)]=this.data[this._idx(P-1,z)],this.data[this._idx(z,-1)]=this.data[this._idx(z,0)],this.data[this._idx(z,P)]=this.data[this._idx(z,P-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(P,-1)]=this.data[this._idx(P-1,0)],this.data[this._idx(-1,P)]=this.data[this._idx(0,P-1)],this.data[this._idx(P,P)]=this.data[this._idx(P-1,P-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let z=0;z<P;z++)for(let W=0;W<P;W++){const Y=this.get(z,W);Y>this.max&&(this.max=Y),Y<this.min&&(this.min=Y)}}get(c,u){const p=new Uint8Array(this.data.buffer),_=4*this._idx(c,u);return this.unpack(p[_],p[_+1],p[_+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(c,u){if(c<-1||c>=this.dim+1||u<-1||u>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(u+1)*this.stride+(c+1)}unpack(c,u,p){return c*this.redFactor+u*this.greenFactor+p*this.blueFactor-this.baseShift}getPixels(){return new so({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(c,u,p){if(this.dim!==c.dim)throw new Error("dem dimension mismatch");let _=u*this.dim,x=u*this.dim+this.dim,T=p*this.dim,L=p*this.dim+this.dim;switch(u){case-1:_=x-1;break;case 1:x=_+1}switch(p){case-1:T=L-1;break;case 1:L=T+1}const P=-u*this.dim,z=-p*this.dim;for(let W=T;W<L;W++)for(let Y=_;Y<x;Y++)this.data[this._idx(Y,W)]=c.data[this._idx(Y+P,W+z)]}}ar("DEMData",EN);class SN{constructor(c){this._stringToNumber={},this._numberToString=[];for(let u=0;u<c.length;u++){const p=c[u];this._stringToNumber[p]=u,this._numberToString[u]=p}}encode(c){return this._stringToNumber[c]}decode(c){if(c>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${c} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[c]}}class TN{constructor(c,u,p,_,x){this.type="Feature",this._vectorTileFeature=c,c._z=u,c._x=p,c._y=_,this.properties=c.properties,this.id=x}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(c){this._geometry=c}toJSON(){const c={geometry:this.geometry};for(const u in this)u!=="_geometry"&&u!=="_vectorTileFeature"&&(c[u]=this[u]);return c}}class IN{constructor(c,u){this.tileID=c,this.x=c.canonical.x,this.y=c.canonical.y,this.z=c.canonical.z,this.grid=new Yo(ei,16,0),this.grid3D=new Yo(ei,16,0),this.featureIndexArray=new Lt,this.promoteId=u}insert(c,u,p,_,x,T){const L=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(p,_,x);const P=T?this.grid3D:this.grid;for(let z=0;z<u.length;z++){const W=u[z],Y=[1/0,1/0,-1/0,-1/0];for(let it=0;it<W.length;it++){const lt=W[it];Y[0]=Math.min(Y[0],lt.x),Y[1]=Math.min(Y[1],lt.y),Y[2]=Math.max(Y[2],lt.x),Y[3]=Math.max(Y[3],lt.y)}Y[0]<ei&&Y[1]<ei&&Y[2]>=0&&Y[3]>=0&&P.insert(L,Y[0],Y[1],Y[2],Y[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new ih.VectorTile(new RC(this.rawTileData)).layers,this.sourceLayerCoder=new SN(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(c,u,p,_){this.loadVTLayers();const x=c.params||{},T=ei/c.tileSize/c.scale,L=bc(x.filter),P=c.queryGeometry,z=c.queryPadding*T,W=FN(P),Y=this.grid.query(W.minX-z,W.minY-z,W.maxX+z,W.maxY+z),it=FN(c.cameraQueryGeometry),lt=this.grid3D.query(it.minX-z,it.minY-z,it.maxX+z,it.maxY+z,(Mt,Gt,ee,Xt)=>function(re,de,xe,nr,gr){for(const Ye of re)if(de<=Ye.x&&xe<=Ye.y&&nr>=Ye.x&&gr>=Ye.y)return!0;const er=[new C(de,xe),new C(de,gr),new C(nr,gr),new C(nr,xe)];if(re.length>2){for(const Ye of er)if(iu(re,Ye))return!0}for(let Ye=0;Ye<re.length-1;Ye++)if(jf(re[Ye],re[Ye+1],er))return!0;return!1}(c.cameraQueryGeometry,Mt-z,Gt-z,ee+z,Xt+z));for(const Mt of lt)Y.push(Mt);Y.sort(v_t);const ht={};let Et;for(let Mt=0;Mt<Y.length;Mt++){const Gt=Y[Mt];if(Gt===Et)continue;Et=Gt;const ee=this.featureIndexArray.get(Gt);let Xt=null;this.loadMatchingFeature(ht,ee.bucketIndex,ee.sourceLayerIndex,ee.featureIndex,L,x.layers,x.availableImages,u,p,_,(re,de,xe)=>(Xt||(Xt=Ec(re)),de.queryIntersectsFeature(P,re,xe,Xt,this.z,c.transform,T,c.pixelPosMatrix)))}return ht}loadMatchingFeature(c,u,p,_,x,T,L,P,z,W,Y){const it=this.bucketLayerIDs[u];if(T&&!function(Mt,Gt){for(let ee=0;ee<Mt.length;ee++)if(Gt.indexOf(Mt[ee])>=0)return!0;return!1}(T,it))return;const lt=this.sourceLayerCoder.decode(p),ht=this.vtLayers[lt].feature(_);if(x.needGeometry){const Mt=hA(ht,!0);if(!x.filter(new Jn(this.tileID.overscaledZ),Mt,this.tileID.canonical))return}else if(!x.filter(new Jn(this.tileID.overscaledZ),ht))return;const Et=this.getId(ht,lt);for(let Mt=0;Mt<it.length;Mt++){const Gt=it[Mt];if(T&&T.indexOf(Gt)<0)continue;const ee=P[Gt];if(!ee)continue;let Xt={};Et&&W&&(Xt=W.getState(ee.sourceLayer||"_geojsonTileLayer",Et));const re=ft({},z[Gt]);re.paint=LN(re.paint,ee.paint,ht,Xt,L),re.layout=LN(re.layout,ee.layout,ht,Xt,L);const de=!Y||Y(ht,ee,Xt);if(!de)continue;const xe=new TN(ht,this.z,this.x,this.y,Et);xe.layer=re;let nr=c[Gt];nr===void 0&&(nr=c[Gt]=[]),nr.push({featureIndex:_,feature:xe,intersectionZ:de})}}lookupSymbolFeatures(c,u,p,_,x,T,L,P){const z={};this.loadVTLayers();const W=bc(x);for(const Y of c)this.loadMatchingFeature(z,p,_,Y,W,T,L,P,u);return z}hasLayer(c){for(const u of this.bucketLayerIDs)for(const p of u)if(c===p)return!0;return!1}getId(c,u){let p=c.id;return this.promoteId&&(p=c.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[u]],typeof p=="boolean"&&(p=Number(p))),p}}function LN(A,c,u,p,_){return It(A,(x,T)=>{const L=c instanceof eu?c.get(T):null;return L&&L.evaluate?L.evaluate(u,p,_):L})}function FN(A){let c=1/0,u=1/0,p=-1/0,_=-1/0;for(const x of A)c=Math.min(c,x.x),u=Math.min(u,x.y),p=Math.max(p,x.x),_=Math.max(_,x.y);return{minX:c,minY:u,maxX:p,maxY:_}}function v_t(A,c){return c-A}function MN(A,c,u,p,_){const x=[];for(let T=0;T<A.length;T++){const L=A[T];let P;for(let z=0;z<L.length-1;z++){let W=L[z],Y=L[z+1];W.x<c&&Y.x<c||(W.x<c?W=new C(c,W.y+(c-W.x)/(Y.x-W.x)*(Y.y-W.y))._round():Y.x<c&&(Y=new C(c,W.y+(c-W.x)/(Y.x-W.x)*(Y.y-W.y))._round()),W.y<u&&Y.y<u||(W.y<u?W=new C(W.x+(u-W.y)/(Y.y-W.y)*(Y.x-W.x),u)._round():Y.y<u&&(Y=new C(W.x+(u-W.y)/(Y.y-W.y)*(Y.x-W.x),u)._round()),W.x>=p&&Y.x>=p||(W.x>=p?W=new C(p,W.y+(p-W.x)/(Y.x-W.x)*(Y.y-W.y))._round():Y.x>=p&&(Y=new C(p,W.y+(p-W.x)/(Y.x-W.x)*(Y.y-W.y))._round()),W.y>=_&&Y.y>=_||(W.y>=_?W=new C(W.x+(_-W.y)/(Y.y-W.y)*(Y.x-W.x),_)._round():Y.y>=_&&(Y=new C(W.x+(_-W.y)/(Y.y-W.y)*(Y.x-W.x),_)._round()),P&&W.equals(P[P.length-1])||(P=[W],x.push(P)),P.push(Y)))))}}return x}ar("FeatureIndex",IN,{omit:["rawTileData","sourceLayerCoder"]});class ch extends C{constructor(c,u,p,_){super(c,u),this.angle=p,_!==void 0&&(this.segment=_)}clone(){return new ch(this.x,this.y,this.angle,this.segment)}}function PN(A,c,u,p,_){if(c.segment===void 0||u===0)return!0;let x=c,T=c.segment+1,L=0;for(;L>-u/2;){if(T--,T<0)return!1;L-=A[T].dist(x),x=A[T]}L+=A[T].dist(A[T+1]),T++;const P=[];let z=0;for(;L<u/2;){const W=A[T],Y=A[T+1];if(!Y)return!1;let it=A[T-1].angleTo(W)-W.angleTo(Y);for(it=Math.abs((it+3*Math.PI)%(2*Math.PI)-Math.PI),P.push({distance:L,angleDelta:it}),z+=it;L-P[0].distance>p;)z-=P.shift().angleDelta;if(z>_)return!1;T++,L+=W.dist(Y)}return!0}function UN(A){let c=0;for(let u=0;u<A.length-1;u++)c+=A[u].dist(A[u+1]);return c}function RN(A,c,u){return A?.6*c*u:0}function DN(A,c){return Math.max(A?A.right-A.left:0,c?c.right-c.left:0)}function b_t(A,c,u,p,_,x){const T=RN(u,_,x),L=DN(u,p)*x;let P=0;const z=UN(A)/2;for(let W=0;W<A.length-1;W++){const Y=A[W],it=A[W+1],lt=Y.dist(it);if(P+lt>z){const ht=(z-P)/lt,Et=Fi.number(Y.x,it.x,ht),Mt=Fi.number(Y.y,it.y,ht),Gt=new ch(Et,Mt,it.angleTo(Y),W);return Gt._round(),!T||PN(A,Gt,L,T,c)?Gt:void 0}P+=lt}}function w_t(A,c,u,p,_,x,T,L,P){const z=RN(p,x,T),W=DN(p,_),Y=W*T,it=A[0].x===0||A[0].x===P||A[0].y===0||A[0].y===P;return c-Y<c/4&&(c=Y+c/4),ON(A,it?c/2*L%c:(W/2+2*x)*T*L%c,c,z,u,Y,it,!1,P)}function ON(A,c,u,p,_,x,T,L,P){const z=x/2,W=UN(A);let Y=0,it=c-u,lt=[];for(let ht=0;ht<A.length-1;ht++){const Et=A[ht],Mt=A[ht+1],Gt=Et.dist(Mt),ee=Mt.angleTo(Et);for(;it+u<Y+Gt;){it+=u;const Xt=(it-Y)/Gt,re=Fi.number(Et.x,Mt.x,Xt),de=Fi.number(Et.y,Mt.y,Xt);if(re>=0&&re<P&&de>=0&&de<P&&it-z>=0&&it+z<=W){const xe=new ch(re,de,ee,ht);xe._round(),p&&!PN(A,xe,x,p,_)||lt.push(xe)}}Y+=Gt}return L||lt.length||T||(lt=ON(A,Y/2,u,p,_,x,T,!0,P)),lt}ar("Anchor",ch);const np=ra;function NN(A,c,u,p){const _=[],x=A.image,T=x.pixelRatio,L=x.paddedRect.w-2*np,P=x.paddedRect.h-2*np,z=A.right-A.left,W=A.bottom-A.top,Y=x.stretchX||[[0,L]],it=x.stretchY||[[0,P]],lt=($e,lr)=>$e+lr[1]-lr[0],ht=Y.reduce(lt,0),Et=it.reduce(lt,0),Mt=L-ht,Gt=P-Et;let ee=0,Xt=ht,re=0,de=Et,xe=0,nr=Mt,gr=0,er=Gt;if(x.content&&p){const $e=x.content;ee=p_(Y,0,$e[0]),re=p_(it,0,$e[1]),Xt=p_(Y,$e[0],$e[2]),de=p_(it,$e[1],$e[3]),xe=$e[0]-ee,gr=$e[1]-re,nr=$e[2]-$e[0]-Xt,er=$e[3]-$e[1]-de}const Ye=($e,lr,Xe,Re)=>{const Lr=g_($e.stretch-ee,Xt,z,A.left),br=m_($e.fixed-xe,nr,$e.stretch,ht),cn=g_(lr.stretch-re,de,W,A.top),ci=m_(lr.fixed-gr,er,lr.stretch,Et),fi=g_(Xe.stretch-ee,Xt,z,A.left),os=m_(Xe.fixed-xe,nr,Xe.stretch,ht),Ta=g_(Re.stretch-re,de,W,A.top),Uo=m_(Re.fixed-gr,er,Re.stretch,Et),ji=new C(Lr,cn),Ls=new C(fi,cn),Gs=new C(fi,Ta),Ro=new C(Lr,Ta),Do=new C(br/T,ci/T),as=new C(os/T,Uo/T),cs=c*Math.PI/180;if(cs){const ao=Math.sin(cs),na=Math.cos(cs),ia=[na,-ao,ao,na];ji._matMult(ia),Ls._matMult(ia),Ro._matMult(ia),Gs._matMult(ia)}const oo=$e.stretch+$e.fixed,Oo=lr.stretch+lr.fixed;return{tl:ji,tr:Ls,bl:Ro,br:Gs,tex:{x:x.paddedRect.x+np+oo,y:x.paddedRect.y+np+Oo,w:Xe.stretch+Xe.fixed-oo,h:Re.stretch+Re.fixed-Oo},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Do,pixelOffsetBR:as,minFontScaleX:nr/T/z,minFontScaleY:er/T/W,isSDF:u}};if(p&&(x.stretchX||x.stretchY)){const $e=kN(Y,Mt,ht),lr=kN(it,Gt,Et);for(let Xe=0;Xe<$e.length-1;Xe++){const Re=$e[Xe],Lr=$e[Xe+1];for(let br=0;br<lr.length-1;br++)_.push(Ye(Re,lr[br],Lr,lr[br+1]))}}else _.push(Ye({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:L+1},{fixed:0,stretch:P+1}));return _}function p_(A,c,u){let p=0;for(const _ of A)p+=Math.max(c,Math.min(u,_[1]))-Math.max(c,Math.min(u,_[0]));return p}function kN(A,c,u){const p=[{fixed:-np,stretch:0}];for(const[_,x]of A){const T=p[p.length-1];p.push({fixed:_-T.stretch,stretch:T.stretch}),p.push({fixed:_-T.stretch,stretch:T.stretch+(x-_)})}return p.push({fixed:c+np,stretch:u}),p}function g_(A,c,u,p){return A/c*u+p}function m_(A,c,u,p){return A-c*u/p}class y_{constructor(c,u,p,_,x,T,L,P,z,W){if(this.boxStartIndex=c.length,z){let Y=T.top,it=T.bottom;const lt=T.collisionPadding;lt&&(Y-=lt[1],it+=lt[3]);let ht=it-Y;ht>0&&(ht=Math.max(10,ht),this.circleDiameter=ht)}else{let Y=T.top*L-P[0],it=T.bottom*L+P[2],lt=T.left*L-P[3],ht=T.right*L+P[1];const Et=T.collisionPadding;if(Et&&(lt-=Et[0]*L,Y-=Et[1]*L,ht+=Et[2]*L,it+=Et[3]*L),W){const Mt=new C(lt,Y),Gt=new C(ht,Y),ee=new C(lt,it),Xt=new C(ht,it),re=W*Math.PI/180;Mt._rotate(re),Gt._rotate(re),ee._rotate(re),Xt._rotate(re),lt=Math.min(Mt.x,Gt.x,ee.x,Xt.x),ht=Math.max(Mt.x,Gt.x,ee.x,Xt.x),Y=Math.min(Mt.y,Gt.y,ee.y,Xt.y),it=Math.max(Mt.y,Gt.y,ee.y,Xt.y)}c.emplaceBack(u.x,u.y,lt,Y,ht,it,p,_,x)}this.boxEndIndex=c.length}}class x_t{constructor(){let c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:B_t;if(this.data=c,this.length=this.data.length,this.compare=u,this.length>0)for(let p=(this.length>>1)-1;p>=0;p--)this._down(p)}push(c){this.data.push(c),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const c=this.data[0],u=this.data.pop();return this.length--,this.length>0&&(this.data[0]=u,this._down(0)),c}peek(){return this.data[0]}_up(c){const{data:u,compare:p}=this,_=u[c];for(;c>0;){const x=c-1>>1,T=u[x];if(p(_,T)>=0)break;u[c]=T,c=x}u[c]=_}_down(c){const{data:u,compare:p}=this,_=this.length>>1,x=u[c];for(;c<_;){let T=1+(c<<1),L=u[T];const P=T+1;if(P<this.length&&p(u[P],L)<0&&(T=P,L=u[P]),p(L,x)>=0)break;u[c]=L,c=T}u[c]=x}}function B_t(A,c){return A<c?-1:A>c?1:0}function C_t(A){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,p=1/0,_=1/0,x=-1/0,T=-1/0;const L=A[0];for(let lt=0;lt<L.length;lt++){const ht=L[lt];(!lt||ht.x<p)&&(p=ht.x),(!lt||ht.y<_)&&(_=ht.y),(!lt||ht.x>x)&&(x=ht.x),(!lt||ht.y>T)&&(T=ht.y)}const P=Math.min(x-p,T-_);let z=P/2;const W=new x_t([],E_t);if(P===0)return new C(p,_);for(let lt=p;lt<x;lt+=P)for(let ht=_;ht<T;ht+=P)W.push(new ip(lt+z,ht+z,z,A));let Y=function(lt){let ht=0,Et=0,Mt=0;const Gt=lt[0];for(let ee=0,Xt=Gt.length,re=Xt-1;ee<Xt;re=ee++){const de=Gt[ee],xe=Gt[re],nr=de.x*xe.y-xe.x*de.y;Et+=(de.x+xe.x)*nr,Mt+=(de.y+xe.y)*nr,ht+=3*nr}return new ip(Et/ht,Mt/ht,0,lt)}(A),it=W.length;for(;W.length;){const lt=W.pop();(lt.d>Y.d||!Y.d)&&(Y=lt,u&&console.log("found best %d after %d probes",Math.round(1e4*lt.d)/1e4,it)),lt.max-Y.d<=c||(z=lt.h/2,W.push(new ip(lt.p.x-z,lt.p.y-z,z,A)),W.push(new ip(lt.p.x+z,lt.p.y-z,z,A)),W.push(new ip(lt.p.x-z,lt.p.y+z,z,A)),W.push(new ip(lt.p.x+z,lt.p.y+z,z,A)),it+=4)}return u&&(console.log(`num probes: ${it}`),console.log(`best distance: ${Y.d}`)),Y.p}function E_t(A,c){return c.max-A.max}function ip(A,c,u,p){this.p=new C(A,c),this.h=u,this.d=function(_,x){let T=!1,L=1/0;for(let P=0;P<x.length;P++){const z=x[P];for(let W=0,Y=z.length,it=Y-1;W<Y;it=W++){const lt=z[W],ht=z[it];lt.y>_.y!=ht.y>_.y&&_.x<(ht.x-lt.x)*(_.y-lt.y)/(ht.y-lt.y)+lt.x&&(T=!T),L=Math.min(L,Y1(_,lt,ht))}}return(T?1:-1)*Math.sqrt(L)}(this.p,p),this.max=this.d+this.h*Math.SQRT2}var Hs;o.aq=void 0,(Hs=o.aq||(o.aq={}))[Hs.center=1]="center",Hs[Hs.left=2]="left",Hs[Hs.right=3]="right",Hs[Hs.top=4]="top",Hs[Hs.bottom=5]="bottom",Hs[Hs["top-left"]=6]="top-left",Hs[Hs["top-right"]=7]="top-right",Hs[Hs["bottom-left"]=8]="bottom-left",Hs[Hs["bottom-right"]=9]="bottom-right";const lh=7,$C=Number.POSITIVE_INFINITY;function QN(A,c){return c[1]!==$C?function(u,p,_){let x=0,T=0;switch(p=Math.abs(p),_=Math.abs(_),u){case"top-right":case"top-left":case"top":T=_-lh;break;case"bottom-right":case"bottom-left":case"bottom":T=-_+lh}switch(u){case"top-right":case"bottom-right":case"right":x=-p;break;case"top-left":case"bottom-left":case"left":x=p}return[x,T]}(A,c[0],c[1]):function(u,p){let _=0,x=0;p<0&&(p=0);const T=p/Math.SQRT2;switch(u){case"top-right":case"top-left":x=T-lh;break;case"bottom-right":case"bottom-left":x=-T+lh;break;case"bottom":x=-p+lh;break;case"top":x=p-lh}switch(u){case"top-right":case"bottom-right":_=-T;break;case"top-left":case"bottom-left":_=T;break;case"left":_=p;break;case"right":_=-p}return[_,x]}(A,c[0])}function zN(A,c,u){var p;const _=A.layout,x=(p=_.get("text-variable-anchor-offset"))===null||p===void 0?void 0:p.evaluate(c,{},u);if(x){const L=x.values,P=[];for(let z=0;z<L.length;z+=2){const W=P[z]=L[z],Y=L[z+1].map(it=>it*ss);W.startsWith("top")?Y[1]-=lh:W.startsWith("bottom")&&(Y[1]+=lh),P[z+1]=Y}return new Ii(P)}const T=_.get("text-variable-anchor");if(T){let L;L=A._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[_.get("text-radial-offset").evaluate(c,{},u)*ss,$C]:_.get("text-offset").evaluate(c,{},u).map(z=>z*ss);const P=[];for(const z of T)P.push(z,QN(z,L));return new Ii(P)}return null}function WC(A){switch(A){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function S_t(A,c,u,p,_,x,T,L,P,z,W){let Y=x.textMaxSize.evaluate(c,{});Y===void 0&&(Y=T);const it=A.layers[0].layout,lt=it.get("icon-offset").evaluate(c,{},W),ht=GN(u.horizontal),Et=T/24,Mt=A.tilePixelRatio*Et,Gt=A.tilePixelRatio*Y/24,ee=A.tilePixelRatio*L,Xt=A.tilePixelRatio*it.get("symbol-spacing"),re=it.get("text-padding")*A.tilePixelRatio,de=function(Re,Lr,br){let cn=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;const ci=Re.get("icon-padding").evaluate(Lr,{},br),fi=ci&&ci.values;return[fi[0]*cn,fi[1]*cn,fi[2]*cn,fi[3]*cn]}(it,c,W,A.tilePixelRatio),xe=it.get("text-max-angle")/180*Math.PI,nr=it.get("text-rotation-alignment")!=="viewport"&&it.get("symbol-placement")!=="point",gr=it.get("icon-rotation-alignment")==="map"&&it.get("symbol-placement")!=="point",er=it.get("symbol-placement"),Ye=Xt/2,$e=it.get("icon-text-fit");let lr;p&&$e!=="none"&&(A.allowVerticalPlacement&&u.vertical&&(lr=uN(p,u.vertical,$e,it.get("icon-text-fit-padding"),lt,Et)),ht&&(p=uN(p,ht,$e,it.get("icon-text-fit-padding"),lt,Et)));const Xe=(Re,Lr)=>{Lr.x<0||Lr.x>=ei||Lr.y<0||Lr.y>=ei||function(br,cn,ci,fi,os,Ta,Uo,ji,Ls,Gs,Ro,Do,as,cs,oo,Oo,ao,na,ia,ls,dn,co,Vs,As,Sc){const _l=br.addToLineVertexArray(cn,ci);let vl,cu,Tc,Xa,sa=0,lu=0,wm=0,KN=0,nE=-1,iE=-1;const Au={};let $N=Ui("");if(br.allowVerticalPlacement&&fi.vertical){const lo=ji.layout.get("text-rotate").evaluate(dn,{},As)+90;Tc=new y_(Ls,cn,Gs,Ro,Do,fi.vertical,as,cs,oo,lo),Uo&&(Xa=new y_(Ls,cn,Gs,Ro,Do,Uo,ao,na,oo,lo))}if(os){const lo=ji.layout.get("icon-rotate").evaluate(dn,{}),Ja=ji.layout.get("icon-text-fit")!=="none",dd=NN(os,lo,Vs,Ja),wl=Uo?NN(Uo,lo,Vs,Ja):void 0;cu=new y_(Ls,cn,Gs,Ro,Do,os,ao,na,!1,lo),sa=4*dd.length;const fd=br.iconSizeData;let gA=null;fd.kind==="source"?(gA=[pA*ji.layout.get("icon-size").evaluate(dn,{})],gA[0]>oh&&vt(`${br.layerIds[0]}: Value for "icon-size" is >= ${ym}. Reduce your "icon-size".`)):fd.kind==="composite"&&(gA=[pA*co.compositeIconSizes[0].evaluate(dn,{},As),pA*co.compositeIconSizes[1].evaluate(dn,{},As)],(gA[0]>oh||gA[1]>oh)&&vt(`${br.layerIds[0]}: Value for "icon-size" is >= ${ym}. Reduce your "icon-size".`)),br.addSymbols(br.icon,dd,gA,ls,ia,dn,o.ai.none,cn,_l.lineStartIndex,_l.lineLength,-1,As),nE=br.icon.placedSymbolArray.length-1,wl&&(lu=4*wl.length,br.addSymbols(br.icon,wl,gA,ls,ia,dn,o.ai.vertical,cn,_l.lineStartIndex,_l.lineLength,-1,As),iE=br.icon.placedSymbolArray.length-1)}const WN=Object.keys(fi.horizontal);for(const lo of WN){const Ja=fi.horizontal[lo];if(!vl){$N=Ui(Ja.text);const wl=ji.layout.get("text-rotate").evaluate(dn,{},As);vl=new y_(Ls,cn,Gs,Ro,Do,Ja,as,cs,oo,wl)}const dd=Ja.positionedLines.length===1;if(wm+=HN(br,cn,Ja,Ta,ji,oo,dn,Oo,_l,fi.vertical?o.ai.horizontal:o.ai.horizontalOnly,dd?WN:[lo],Au,nE,co,As),dd)break}fi.vertical&&(KN+=HN(br,cn,fi.vertical,Ta,ji,oo,dn,Oo,_l,o.ai.vertical,["vertical"],Au,iE,co,As));const L_t=vl?vl.boxStartIndex:br.collisionBoxArray.length,F_t=vl?vl.boxEndIndex:br.collisionBoxArray.length,M_t=Tc?Tc.boxStartIndex:br.collisionBoxArray.length,P_t=Tc?Tc.boxEndIndex:br.collisionBoxArray.length,U_t=cu?cu.boxStartIndex:br.collisionBoxArray.length,R_t=cu?cu.boxEndIndex:br.collisionBoxArray.length,D_t=Xa?Xa.boxStartIndex:br.collisionBoxArray.length,O_t=Xa?Xa.boxEndIndex:br.collisionBoxArray.length;let bl=-1;const v_=(lo,Ja)=>lo&&lo.circleDiameter?Math.max(lo.circleDiameter,Ja):Ja;bl=v_(vl,bl),bl=v_(Tc,bl),bl=v_(cu,bl),bl=v_(Xa,bl);const XN=bl>-1?1:0;XN&&(bl*=Sc/ss),br.glyphOffsetArray.length>=rp.MAX_GLYPHS&&vt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),dn.sortKey!==void 0&&br.addToSortKeyRanges(br.symbolInstances.length,dn.sortKey);const N_t=zN(ji,dn,As),[k_t,Q_t]=function(lo,Ja){const dd=lo.length,wl=Ja==null?void 0:Ja.values;if((wl==null?void 0:wl.length)>0)for(let fd=0;fd<wl.length;fd+=2){const gA=wl[fd+1];lo.emplaceBack(o.aq[wl[fd]],gA[0],gA[1])}return[dd,lo.length]}(br.textAnchorOffsets,N_t);br.symbolInstances.emplaceBack(cn.x,cn.y,Au.right>=0?Au.right:-1,Au.center>=0?Au.center:-1,Au.left>=0?Au.left:-1,Au.vertical||-1,nE,iE,$N,L_t,F_t,M_t,P_t,U_t,R_t,D_t,O_t,Gs,wm,KN,sa,lu,XN,0,as,bl,k_t,Q_t)}(A,Lr,Re,u,p,_,lr,A.layers[0],A.collisionBoxArray,c.index,c.sourceLayerIndex,A.index,Mt,[re,re,re,re],nr,P,ee,de,gr,lt,c,x,z,W,T)};if(er==="line")for(const Re of MN(c.geometry,0,0,ei,ei)){const Lr=w_t(Re,Xt,xe,u.vertical||ht,p,24,Gt,A.overscaling,ei);for(const br of Lr)ht&&T_t(A,ht.text,Ye,br)||Xe(Re,br)}else if(er==="line-center"){for(const Re of c.geometry)if(Re.length>1){const Lr=b_t(Re,xe,u.vertical||ht,p,24,Gt);Lr&&Xe(Re,Lr)}}else if(c.type==="Polygon")for(const Re of SC(c.geometry,0)){const Lr=C_t(Re,16);Xe(Re[0],new ch(Lr.x,Lr.y,0))}else if(c.type==="LineString")for(const Re of c.geometry)Xe(Re,new ch(Re[0].x,Re[0].y,0));else if(c.type==="Point")for(const Re of c.geometry)for(const Lr of Re)Xe([Lr],new ch(Lr.x,Lr.y,0))}function HN(A,c,u,p,_,x,T,L,P,z,W,Y,it,lt,ht){const Et=function(ee,Xt,re,de,xe,nr,gr,er){const Ye=de.layout.get("text-rotate").evaluate(nr,{})*Math.PI/180,$e=[];for(const lr of Xt.positionedLines)for(const Xe of lr.positionedGlyphs){if(!Xe.rect)continue;const Re=Xe.rect||{};let Lr=iN+1,br=!0,cn=1,ci=0;const fi=(xe||er)&&Xe.vertical,os=Xe.metrics.advance*Xe.scale/2;if(er&&Xt.verticalizable&&(ci=lr.lineOffset/2-(Xe.imageName?-(ss-Xe.metrics.width*Xe.scale)/2:(Xe.scale-1)*ss)),Xe.imageName){const ls=gr[Xe.imageName];br=ls.sdf,cn=ls.pixelRatio,Lr=ra/cn}const Ta=xe?[Xe.x+os,Xe.y]:[0,0];let Uo=xe?[0,0]:[Xe.x+os+re[0],Xe.y+re[1]-ci],ji=[0,0];fi&&(ji=Uo,Uo=[0,0]);const Ls=Xe.metrics.isDoubleResolution?2:1,Gs=(Xe.metrics.left-Lr)*Xe.scale-os+Uo[0],Ro=(-Xe.metrics.top-Lr)*Xe.scale+Uo[1],Do=Gs+Re.w/Ls*Xe.scale/cn,as=Ro+Re.h/Ls*Xe.scale/cn,cs=new C(Gs,Ro),oo=new C(Do,Ro),Oo=new C(Gs,as),ao=new C(Do,as);if(fi){const ls=new C(-os,os-gm),dn=-Math.PI/2,co=ss/2-os,Vs=new C(5-gm-co,-(Xe.imageName?co:0)),As=new C(...ji);cs._rotateAround(dn,ls)._add(Vs)._add(As),oo._rotateAround(dn,ls)._add(Vs)._add(As),Oo._rotateAround(dn,ls)._add(Vs)._add(As),ao._rotateAround(dn,ls)._add(Vs)._add(As)}if(Ye){const ls=Math.sin(Ye),dn=Math.cos(Ye),co=[dn,-ls,ls,dn];cs._matMult(co),oo._matMult(co),Oo._matMult(co),ao._matMult(co)}const na=new C(0,0),ia=new C(0,0);$e.push({tl:cs,tr:oo,bl:Oo,br:ao,tex:Re,writingMode:Xt.writingMode,glyphOffset:Ta,sectionIndex:Xe.sectionIndex,isSDF:br,pixelOffsetTL:na,pixelOffsetBR:ia,minFontScaleX:0,minFontScaleY:0})}return $e}(0,u,L,_,x,T,p,A.allowVerticalPlacement),Mt=A.textSizeData;let Gt=null;Mt.kind==="source"?(Gt=[pA*_.layout.get("text-size").evaluate(T,{})],Gt[0]>oh&&vt(`${A.layerIds[0]}: Value for "text-size" is >= ${ym}. Reduce your "text-size".`)):Mt.kind==="composite"&&(Gt=[pA*lt.compositeTextSizes[0].evaluate(T,{},ht),pA*lt.compositeTextSizes[1].evaluate(T,{},ht)],(Gt[0]>oh||Gt[1]>oh)&&vt(`${A.layerIds[0]}: Value for "text-size" is >= ${ym}. Reduce your "text-size".`)),A.addSymbols(A.text,Et,Gt,L,x,T,z,c,P.lineStartIndex,P.lineLength,it,ht);for(const ee of W)Y[ee]=A.text.placedSymbolArray.length-1;return 4*Et.length}function GN(A){for(const c in A)return A[c];return null}function T_t(A,c,u,p){const _=A.compareText;if(c in _){const x=_[c];for(let T=x.length-1;T>=0;T--)if(p.dist(x[T])<u)return!0}else _[c]=[];return _[c].push(p),!1}const VN=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class XC{static from(c){if(!(c instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[u,p]=new Uint8Array(c,0,2);if(u!==219)throw new Error("Data does not appear to be in a KDBush format.");const _=p>>4;if(_!==1)throw new Error(`Got v${_} data when expected v1.`);const x=VN[15&p];if(!x)throw new Error("Unrecognized array type.");const[T]=new Uint16Array(c,2,1),[L]=new Uint32Array(c,4,1);return new XC(L,T,x,c)}constructor(c){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:64,p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Float64Array,_=arguments.length>3?arguments[3]:void 0;if(isNaN(c)||c<0)throw new Error(`Unpexpected numItems value: ${c}.`);this.numItems=+c,this.nodeSize=Math.min(Math.max(+u,2),65535),this.ArrayType=p,this.IndexArrayType=c<65536?Uint16Array:Uint32Array;const x=VN.indexOf(this.ArrayType),T=2*c*this.ArrayType.BYTES_PER_ELEMENT,L=c*this.IndexArrayType.BYTES_PER_ELEMENT,P=(8-L%8)%8;if(x<0)throw new Error(`Unexpected typed array class: ${p}.`);_&&_ instanceof ArrayBuffer?(this.data=_,this.ids=new this.IndexArrayType(this.data,8,c),this.coords=new this.ArrayType(this.data,8+L+P,2*c),this._pos=2*c,this._finished=!0):(this.data=new ArrayBuffer(8+T+L+P),this.ids=new this.IndexArrayType(this.data,8,c),this.coords=new this.ArrayType(this.data,8+L+P,2*c),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+x]),new Uint16Array(this.data,2,1)[0]=u,new Uint32Array(this.data,4,1)[0]=c)}add(c,u){const p=this._pos>>1;return this.ids[p]=p,this.coords[this._pos++]=c,this.coords[this._pos++]=u,p}finish(){const c=this._pos>>1;if(c!==this.numItems)throw new Error(`Added ${c} items when expected ${this.numItems}.`);return JC(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(c,u,p,_){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:x,coords:T,nodeSize:L}=this,P=[0,x.length-1,0],z=[];for(;P.length;){const W=P.pop()||0,Y=P.pop()||0,it=P.pop()||0;if(Y-it<=L){for(let Mt=it;Mt<=Y;Mt++){const Gt=T[2*Mt],ee=T[2*Mt+1];Gt>=c&&Gt<=p&&ee>=u&&ee<=_&&z.push(x[Mt])}continue}const lt=it+Y>>1,ht=T[2*lt],Et=T[2*lt+1];ht>=c&&ht<=p&&Et>=u&&Et<=_&&z.push(x[lt]),(W===0?c<=ht:u<=Et)&&(P.push(it),P.push(lt-1),P.push(1-W)),(W===0?p>=ht:_>=Et)&&(P.push(lt+1),P.push(Y),P.push(1-W))}return z}within(c,u,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:_,coords:x,nodeSize:T}=this,L=[0,_.length-1,0],P=[],z=p*p;for(;L.length;){const W=L.pop()||0,Y=L.pop()||0,it=L.pop()||0;if(Y-it<=T){for(let Mt=it;Mt<=Y;Mt++)qN(x[2*Mt],x[2*Mt+1],c,u)<=z&&P.push(_[Mt]);continue}const lt=it+Y>>1,ht=x[2*lt],Et=x[2*lt+1];qN(ht,Et,c,u)<=z&&P.push(_[lt]),(W===0?c-p<=ht:u-p<=Et)&&(L.push(it),L.push(lt-1),L.push(1-W)),(W===0?c+p>=ht:u+p>=Et)&&(L.push(lt+1),L.push(Y),L.push(1-W))}return P}}function JC(A,c,u,p,_,x){if(_-p<=u)return;const T=p+_>>1;jN(A,c,T,p,_,x),JC(A,c,u,p,T-1,1-x),JC(A,c,u,T+1,_,1-x)}function jN(A,c,u,p,_,x){for(;_>p;){if(_-p>600){const z=_-p+1,W=u-p+1,Y=Math.log(z),it=.5*Math.exp(2*Y/3),lt=.5*Math.sqrt(Y*it*(z-it)/z)*(W-z/2<0?-1:1);jN(A,c,u,Math.max(p,Math.floor(u-W*it/z+lt)),Math.min(_,Math.floor(u+(z-W)*it/z+lt)),x)}const T=c[2*u+x];let L=p,P=_;for(vm(A,c,p,u),c[2*_+x]>T&&vm(A,c,p,_);L<P;){for(vm(A,c,L,P),L++,P--;c[2*L+x]<T;)L++;for(;c[2*P+x]>T;)P--}c[2*p+x]===T?vm(A,c,p,P):(P++,vm(A,c,P,_)),P<=u&&(p=P+1),u<=P&&(_=P-1)}}function vm(A,c,u,p){YC(A,u,p),YC(c,2*u,2*p),YC(c,2*u+1,2*p+1)}function YC(A,c,u){const p=A[c];A[c]=A[u],A[u]=p}function qN(A,c,u,p){const _=A-u,x=c-p;return _*_+x*x}var ZC;o.bh=void 0,(ZC=o.bh||(o.bh={})).create="create",ZC.load="load",ZC.fullLoad="fullLoad";let __=null,bm=[];const tE=1e3/60,eE="loadTime",rE="fullLoadTime",I_t={mark(A){performance.mark(A)},frame(A){const c=A;__!=null&&bm.push(c-__),__=c},clearMetrics(){__=null,bm=[],performance.clearMeasures(eE),performance.clearMeasures(rE);for(const A in o.bh)performance.clearMarks(o.bh[A])},getPerformanceMetrics(){performance.measure(eE,o.bh.create,o.bh.load),performance.measure(rE,o.bh.create,o.bh.fullLoad);const A=performance.getEntriesByName(eE)[0].duration,c=performance.getEntriesByName(rE)[0].duration,u=bm.length,p=1/(bm.reduce((x,T)=>x+T,0)/u/1e3),_=bm.filter(x=>x>tE).reduce((x,T)=>x+(T-tE)/tE,0);return{loadTime:A,fullLoadTime:c,fps:p,percentDroppedFrames:_/(u+_)*100,totalFrames:u}}};o.$=function(A,c,u){var p,_,x,T,L,P,z,W,Y,it,lt,ht,Et=u[0],Mt=u[1],Gt=u[2];return c===A?(A[12]=c[0]*Et+c[4]*Mt+c[8]*Gt+c[12],A[13]=c[1]*Et+c[5]*Mt+c[9]*Gt+c[13],A[14]=c[2]*Et+c[6]*Mt+c[10]*Gt+c[14],A[15]=c[3]*Et+c[7]*Mt+c[11]*Gt+c[15]):(_=c[1],x=c[2],T=c[3],L=c[4],P=c[5],z=c[6],W=c[7],Y=c[8],it=c[9],lt=c[10],ht=c[11],A[0]=p=c[0],A[1]=_,A[2]=x,A[3]=T,A[4]=L,A[5]=P,A[6]=z,A[7]=W,A[8]=Y,A[9]=it,A[10]=lt,A[11]=ht,A[12]=p*Et+L*Mt+Y*Gt+c[12],A[13]=_*Et+P*Mt+it*Gt+c[13],A[14]=x*Et+z*Mt+lt*Gt+c[14],A[15]=T*Et+W*Mt+ht*Gt+c[15]),A},o.A=pl,o.B=Fi,o.C=class{constructor(A,c,u){this.receive=p=>{const _=p.data,x=_.id;if(x&&(!_.targetMapId||this.mapId===_.targetMapId))if(_.type==="<cancel>"){delete this.tasks[x];const T=this.cancelCallbacks[x];delete this.cancelCallbacks[x],T&&T()}else ae()||_.mustQueue?(this.tasks[x]=_,this.taskQueue.push(x),this.invoker.trigger()):this.processTask(x,_)},this.process=()=>{if(!this.taskQueue.length)return;const p=this.taskQueue.shift(),_=this.tasks[p];delete this.tasks[p],this.taskQueue.length&&this.invoker.trigger(),_&&this.processTask(p,_)},this.target=A,this.parent=c,this.mapId=u,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},this.invoker=new __t(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=ae()?A:window}send(A,c,u,p){let _=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;const x=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(this.callbacks[x]=u);const T=[],L={id:x,type:A,hasCallback:!!u,targetMapId:p,mustQueue:_,sourceMapId:this.mapId,data:Ka(c,T)};return this.target.postMessage(L,{transfer:T}),{cancel:()=>{u&&delete this.callbacks[x],this.target.postMessage({id:x,type:"<cancel>",targetMapId:p,sourceMapId:this.mapId})}}}processTask(A,c){if(c.type==="<response>"){const u=this.callbacks[A];delete this.callbacks[A],u&&(c.error?u(ul(c.error)):u(null,ul(c.data)))}else{let u=!1;const p=[],_=c.hasCallback?(L,P)=>{u=!0,delete this.cancelCallbacks[A];const z={id:A,type:"<response>",sourceMapId:this.mapId,error:L?Ka(L):null,data:Ka(P,p)};this.target.postMessage(z,{transfer:p})}:L=>{u=!0};let x=null;const T=ul(c.data);if(this.parent[c.type])x=this.parent[c.type](c.sourceMapId,T,_);else if("getWorkerSource"in this.parent){const L=c.type.split(".");x=this.parent.getWorkerSource(c.sourceMapId,L[0],T.source)[L[1]](T,_)}else _(new Error(`Could not find function ${c.type}`));!u&&x&&x.cancel&&(this.cancelCallbacks[A]=x.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},o.D=vr,o.E=Se,o.F=function(A,c){const u={};for(let p=0;p<c.length;p++){const _=c[p];_ in A&&(u[_]=A[_])}return u},o.G=vN,o.H=bN,o.I=OC,o.J=j,o.K=et,o.L=ah,o.M=Te,o.N=ei,o.O=Wa,o.P=C,o.Q=ai,o.R=so,o.S=Sr,o.T=Yu,o.U=f_,o.V=class extends Bc{},o.W=KC,o.X=function(A,c){const u=window.document.createElement("video");u.muted=!0,u.onloadstart=function(){c(null,u)};for(let p=0;p<A.length;p++){const _=window.document.createElement("source");rr(A[p])||(u.crossOrigin="Anonymous"),_.src=A[p],u.appendChild(_)}return{cancel:()=>{}}},o.Y=Ee,o.Z=function(){var A=new pl(16);return pl!=Float32Array&&(A[1]=0,A[2]=0,A[3]=0,A[4]=0,A[6]=0,A[7]=0,A[8]=0,A[9]=0,A[11]=0,A[12]=0,A[13]=0,A[14]=0),A[0]=1,A[5]=1,A[10]=1,A[15]=1,A},o._=h,o.a=ce,o.a$=class extends ct{},o.a0=function(A,c,u){var p=u[0],_=u[1],x=u[2];return A[0]=c[0]*p,A[1]=c[1]*p,A[2]=c[2]*p,A[3]=c[3]*p,A[4]=c[4]*_,A[5]=c[5]*_,A[6]=c[6]*_,A[7]=c[7]*_,A[8]=c[8]*x,A[9]=c[9]*x,A[10]=c[10]*x,A[11]=c[11]*x,A[12]=c[12],A[13]=c[13],A[14]=c[14],A[15]=c[15],A},o.a1=$f,o.a2=function(){return Dt++},o.a3=S,o.a4=rp,o.a5=function(){eo.isLoading()||eo.isLoaded()||Xu()!=="deferred"||Gf()},o.a6=bc,o.a7=hA,o.a8=Jn,o.a9=TN,o.aA=hl,o.aB=function(A){A=A.slice();const c=Object.create(null);for(let u=0;u<A.length;u++)c[A[u].id]=A[u];for(let u=0;u<A.length;u++)"ref"in A[u]&&(A[u]=ke(A[u],c[A[u].ref]));return A},o.aC=function(A){if(A.type==="custom")return new y_t(A);switch(A.type){case"background":return new p_t(A);case"circle":return new xC(A);case"fill":return new v1t(A);case"fill-extrusion":return new R1t(A);case"heatmap":return new ml(A);case"hillshade":return new Wf(A);case"line":return new G1t(A);case"raster":return new m_t(A);case"symbol":return new d_(A)}},o.aD=At,o.aE=function(A,c){if(!A)return[{command:De.setStyle,args:[c]}];let u=[];try{if(!He(A.version,c.version))return[{command:De.setStyle,args:[c]}];He(A.center,c.center)||u.push({command:De.setCenter,args:[c.center]}),He(A.zoom,c.zoom)||u.push({command:De.setZoom,args:[c.zoom]}),He(A.bearing,c.bearing)||u.push({command:De.setBearing,args:[c.bearing]}),He(A.pitch,c.pitch)||u.push({command:De.setPitch,args:[c.pitch]}),He(A.sprite,c.sprite)||u.push({command:De.setSprite,args:[c.sprite]}),He(A.glyphs,c.glyphs)||u.push({command:De.setGlyphs,args:[c.glyphs]}),He(A.transition,c.transition)||u.push({command:De.setTransition,args:[c.transition]}),He(A.light,c.light)||u.push({command:De.setLight,args:[c.light]});const p={},_=[];(function(T,L,P,z){let W;for(W in L=L||{},T=T||{})Object.prototype.hasOwnProperty.call(T,W)&&(Object.prototype.hasOwnProperty.call(L,W)||Pr(W,P,z));for(W in L)Object.prototype.hasOwnProperty.call(L,W)&&(Object.prototype.hasOwnProperty.call(T,W)?He(T[W],L[W])||(T[W].type==="geojson"&&L[W].type==="geojson"&&nn(T,L,W)?P.push({command:De.setGeoJSONSourceData,args:[W,L[W].data]}):Or(W,L,P,z)):xr(W,L,P))})(A.sources,c.sources,_,p);const x=[];A.layers&&A.layers.forEach(T=>{p[T.source]?u.push({command:De.removeLayer,args:[T.id]}):x.push(T)}),u=u.concat(_),function(T,L,P){L=L||[];const z=(T=T||[]).map(Ur),W=L.map(Ur),Y=T.reduce(je,{}),it=L.reduce(je,{}),lt=z.slice(),ht=Object.create(null);let Et,Mt,Gt,ee,Xt,re,de;for(Et=0,Mt=0;Et<z.length;Et++)Gt=z[Et],Object.prototype.hasOwnProperty.call(it,Gt)?Mt++:(P.push({command:De.removeLayer,args:[Gt]}),lt.splice(lt.indexOf(Gt,Mt),1));for(Et=0,Mt=0;Et<W.length;Et++)Gt=W[W.length-1-Et],lt[lt.length-1-Et]!==Gt&&(Object.prototype.hasOwnProperty.call(Y,Gt)?(P.push({command:De.removeLayer,args:[Gt]}),lt.splice(lt.lastIndexOf(Gt,lt.length-Mt),1)):Mt++,re=lt[lt.length-Et],P.push({command:De.addLayer,args:[it[Gt],re]}),lt.splice(lt.length-Et,0,Gt),ht[Gt]=!0);for(Et=0;Et<W.length;Et++)if(Gt=W[Et],ee=Y[Gt],Xt=it[Gt],!ht[Gt]&&!He(ee,Xt))if(He(ee.source,Xt.source)&&He(ee["source-layer"],Xt["source-layer"])&&He(ee.type,Xt.type)){for(de in Br(ee.layout,Xt.layout,P,Gt,null,De.setLayoutProperty),Br(ee.paint,Xt.paint,P,Gt,null,De.setPaintProperty),He(ee.filter,Xt.filter)||P.push({command:De.setFilter,args:[Gt,Xt.filter]}),He(ee.minzoom,Xt.minzoom)&&He(ee.maxzoom,Xt.maxzoom)||P.push({command:De.setLayerZoomRange,args:[Gt,Xt.minzoom,Xt.maxzoom]}),ee)Object.prototype.hasOwnProperty.call(ee,de)&&de!=="layout"&&de!=="paint"&&de!=="filter"&&de!=="metadata"&&de!=="minzoom"&&de!=="maxzoom"&&(de.indexOf("paint.")===0?Br(ee[de],Xt[de],P,Gt,de.slice(6),De.setPaintProperty):He(ee[de],Xt[de])||P.push({command:De.setLayerProperty,args:[Gt,de,Xt[de]]}));for(de in Xt)Object.prototype.hasOwnProperty.call(Xt,de)&&!Object.prototype.hasOwnProperty.call(ee,de)&&de!=="layout"&&de!=="paint"&&de!=="filter"&&de!=="metadata"&&de!=="minzoom"&&de!=="maxzoom"&&(de.indexOf("paint.")===0?Br(ee[de],Xt[de],P,Gt,de.slice(6),De.setPaintProperty):He(ee[de],Xt[de])||P.push({command:De.setLayerProperty,args:[Gt,de,Xt[de]]}))}else P.push({command:De.removeLayer,args:[Gt]}),re=lt[lt.lastIndexOf(Gt)+1],P.push({command:De.addLayer,args:[Xt,re]})}(x,c.layers,u)}catch(p){console.warn("Unable to compute style diff:",p),u=[{command:De.setStyle,args:[c]}]}return u},o.aF=function(A){const c=[],u=A.id;return u===void 0&&c.push({message:`layers.${u}: missing required property "id"`}),A.render===void 0&&c.push({message:`layers.${u}: missing required method "render"`}),A.renderingMode&&A.renderingMode!=="2d"&&A.renderingMode!=="3d"&&c.push({message:`layers.${u}: property "renderingMode" must be either "2d" or "3d"`}),c},o.aG=function A(c,u){if(Array.isArray(c)){if(!Array.isArray(u)||c.length!==u.length)return!1;for(let p=0;p<c.length;p++)if(!A(c[p],u[p]))return!1;return!0}if(typeof c=="object"&&c!==null&&u!==null){if(typeof u!="object"||Object.keys(c).length!==Object.keys(u).length)return!1;for(const p in c)if(!A(c[p],u[p]))return!1;return!0}return c===u},o.aH=It,o.aI=ut,o.aJ=tu,o.aK=function(A){return A({pluginStatus:_s,pluginURL:Zo}),tu.on("pluginStateChange",A),A},o.aL=class extends Vi{constructor(A,c){super(A,c),this.current=0}set(A){this.current!==A&&(this.current=A,this.gl.uniform1i(this.location,A))}},o.aM=ro,o.aN=class extends Vi{constructor(A,c){super(A,c),this.current=fl}set(A){if(A[12]!==this.current[12]||A[0]!==this.current[0])return this.current=A,void this.gl.uniformMatrix4fv(this.location,!1,A);for(let c=1;c<16;c++)if(A[c]!==this.current[c]){this.current=A,this.gl.uniformMatrix4fv(this.location,!1,A);break}}},o.aO=Ri,o.aP=class extends Vi{constructor(A,c){super(A,c),this.current=[0,0,0]}set(A){A[0]===this.current[0]&&A[1]===this.current[1]&&A[2]===this.current[2]||(this.current=A,this.gl.uniform3f(this.location,A[0],A[1],A[2]))}},o.aQ=class extends Vi{constructor(A,c){super(A,c),this.current=[0,0]}set(A){A[0]===this.current[0]&&A[1]===this.current[1]||(this.current=A,this.gl.uniform2f(this.location,A[0],A[1]))}},o.aR=Ca,o.aS=function(A,c,u,p,_,x,T){var L=1/(c-u),P=1/(p-_),z=1/(x-T);return A[0]=-2*L,A[1]=0,A[2]=0,A[3]=0,A[4]=0,A[5]=-2*P,A[6]=0,A[7]=0,A[8]=0,A[9]=0,A[10]=2*z,A[11]=0,A[12]=(c+u)*L,A[13]=(_+p)*P,A[14]=(T+x)*z,A[15]=1,A},o.aT=Yr,o.aU=e_,o.aV=class extends m{},o.aW=K1t,o.aX=class extends E{},o.aY=function(A){return A<=1?1:Math.pow(2,Math.ceil(Math.log(A)/Math.LN2))},o.aZ=ud,o.a_=kt,o.aa=function(A){const c={};if(A.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(u,p,_,x)=>{const T=_||x;return c[p]=!T||T.toLowerCase(),""}),c["max-age"]){const u=parseInt(c["max-age"],10);isNaN(u)?delete c["max-age"]:c["max-age"]=u}return c},o.ab=function(A,c){const u=[];for(const p in A)p in c||u.push(p);return u},o.ac=function(A){if(te==null){const c=A.navigator?A.navigator.userAgent:null;te=!!A.safari||!(!c||!(/\b(iPad|iPhone|iPod)\b/.test(c)||c.match("Safari")&&!c.match("Chrome")))}return te},o.ad=pt,o.ae=function(A,c,u){var p=Math.sin(u),_=Math.cos(u),x=c[0],T=c[1],L=c[2],P=c[3],z=c[4],W=c[5],Y=c[6],it=c[7];return c!==A&&(A[8]=c[8],A[9]=c[9],A[10]=c[10],A[11]=c[11],A[12]=c[12],A[13]=c[13],A[14]=c[14],A[15]=c[15]),A[0]=x*_+z*p,A[1]=T*_+W*p,A[2]=L*_+Y*p,A[3]=P*_+it*p,A[4]=z*_-x*p,A[5]=W*_-T*p,A[6]=Y*_-L*p,A[7]=it*_-P*p,A},o.af=function(A){var c=new pl(16);return c[0]=A[0],c[1]=A[1],c[2]=A[2],c[3]=A[3],c[4]=A[4],c[5]=A[5],c[6]=A[6],c[7]=A[7],c[8]=A[8],c[9]=A[9],c[10]=A[10],c[11]=A[11],c[12]=A[12],c[13]=A[13],c[14]=A[14],c[15]=A[15],c},o.ag=Ad,o.ah=function(A,c){let u=0,p=0;if(A.kind==="constant")p=A.layoutSize;else if(A.kind!=="source"){const{interpolationType:_,minZoom:x,maxZoom:T}=A,L=_?pt(rs.interpolationFactor(_,c,x,T),0,1):0;A.kind==="camera"?p=Fi.number(A.minSize,A.maxSize,L):u=L}return{uSizeT:u,uSize:p}},o.aj=function(A,c,u){let{uSize:p,uSizeT:_}=c,{lowerSize:x,upperSize:T}=u;return A.kind==="source"?x/pA:A.kind==="composite"?Fi.number(x/pA,T/pA,_):p},o.ak=zC,o.al=function(A,c,u,p){const _=c.y-A.y,x=c.x-A.x,T=p.y-u.y,L=p.x-u.x,P=T*x-L*_;if(P===0)return null;const z=(L*(A.y-u.y)-T*(A.x-u.x))/P;return new C(A.x+z*x,A.y+z*_)},o.am=MN,o.an=od,o.ao=Kf,o.ap=ss,o.ar=QC,o.as=function(A,c){var u=c[0],p=c[1],_=c[2],x=c[3],T=c[4],L=c[5],P=c[6],z=c[7],W=c[8],Y=c[9],it=c[10],lt=c[11],ht=c[12],Et=c[13],Mt=c[14],Gt=c[15],ee=u*L-p*T,Xt=u*P-_*T,re=u*z-x*T,de=p*P-_*L,xe=p*z-x*L,nr=_*z-x*P,gr=W*Et-Y*ht,er=W*Mt-it*ht,Ye=W*Gt-lt*ht,$e=Y*Mt-it*Et,lr=Y*Gt-lt*Et,Xe=it*Gt-lt*Mt,Re=ee*Xe-Xt*lr+re*$e+de*Ye-xe*er+nr*gr;return Re?(A[0]=(L*Xe-P*lr+z*$e)*(Re=1/Re),A[1]=(_*lr-p*Xe-x*$e)*Re,A[2]=(Et*nr-Mt*xe+Gt*de)*Re,A[3]=(it*xe-Y*nr-lt*de)*Re,A[4]=(P*Ye-T*Xe-z*er)*Re,A[5]=(u*Xe-_*Ye+x*er)*Re,A[6]=(Mt*re-ht*nr-Gt*Xt)*Re,A[7]=(W*nr-it*re+lt*Xt)*Re,A[8]=(T*lr-L*Ye+z*gr)*Re,A[9]=(p*Ye-u*lr-x*gr)*Re,A[10]=(ht*xe-Et*re+Gt*ee)*Re,A[11]=(Y*re-W*xe-lt*ee)*Re,A[12]=(L*er-T*$e-P*gr)*Re,A[13]=(u*$e-p*er+_*gr)*Re,A[14]=(Et*Xt-ht*de-Mt*ee)*Re,A[15]=(W*de-Y*Xt+it*ee)*Re,A):null},o.at=WC,o.au=kC,o.av=XC,o.aw=function(){const A={},c=Kt.$version;for(const u in Kt.$root){const p=Kt.$root[u];if(p.required){let _=null;_=u==="version"?c:p.type==="array"?[]:{},_!=null&&(A[u]=_)}}return A},o.ax=De,o.ay=Yh,o.az=oe,o.b=function(A,c){const u=new Blob([new Uint8Array(A)],{type:"image/png"});createImageBitmap(u).then(p=>{c(null,p)}).catch(p=>{c(new Error(`Could not load image because of ${p.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})},o.b0=Ge,o.b1=function(A,c){var u=A[0],p=A[1],_=A[2],x=A[3],T=A[4],L=A[5],P=A[6],z=A[7],W=A[8],Y=A[9],it=A[10],lt=A[11],ht=A[12],Et=A[13],Mt=A[14],Gt=A[15],ee=c[0],Xt=c[1],re=c[2],de=c[3],xe=c[4],nr=c[5],gr=c[6],er=c[7],Ye=c[8],$e=c[9],lr=c[10],Xe=c[11],Re=c[12],Lr=c[13],br=c[14],cn=c[15];return Math.abs(u-ee)<=zs*Math.max(1,Math.abs(u),Math.abs(ee))&&Math.abs(p-Xt)<=zs*Math.max(1,Math.abs(p),Math.abs(Xt))&&Math.abs(_-re)<=zs*Math.max(1,Math.abs(_),Math.abs(re))&&Math.abs(x-de)<=zs*Math.max(1,Math.abs(x),Math.abs(de))&&Math.abs(T-xe)<=zs*Math.max(1,Math.abs(T),Math.abs(xe))&&Math.abs(L-nr)<=zs*Math.max(1,Math.abs(L),Math.abs(nr))&&Math.abs(P-gr)<=zs*Math.max(1,Math.abs(P),Math.abs(gr))&&Math.abs(z-er)<=zs*Math.max(1,Math.abs(z),Math.abs(er))&&Math.abs(W-Ye)<=zs*Math.max(1,Math.abs(W),Math.abs(Ye))&&Math.abs(Y-$e)<=zs*Math.max(1,Math.abs(Y),Math.abs($e))&&Math.abs(it-lr)<=zs*Math.max(1,Math.abs(it),Math.abs(lr))&&Math.abs(lt-Xe)<=zs*Math.max(1,Math.abs(lt),Math.abs(Xe))&&Math.abs(ht-Re)<=zs*Math.max(1,Math.abs(ht),Math.abs(Re))&&Math.abs(Et-Lr)<=zs*Math.max(1,Math.abs(Et),Math.abs(Lr))&&Math.abs(Mt-br)<=zs*Math.max(1,Math.abs(Mt),Math.abs(br))&&Math.abs(Gt-cn)<=zs*Math.max(1,Math.abs(Gt),Math.abs(cn))},o.b2=function(A,c){return A[0]=c[0],A[1]=c[1],A[2]=c[2],A[3]=c[3],A[4]=c[4],A[5]=c[5],A[6]=c[6],A[7]=c[7],A[8]=c[8],A[9]=c[9],A[10]=c[10],A[11]=c[11],A[12]=c[12],A[13]=c[13],A[14]=c[14],A[15]=c[15],A},o.b3=function(A,c,u){return A[0]=c[0]*u[0],A[1]=c[1]*u[1],A[2]=c[2]*u[2],A[3]=c[3]*u[3],A},o.b4=function(A,c){return A[0]*c[0]+A[1]*c[1]+A[2]*c[2]+A[3]*c[3]},o.b5=yt,o.b6=CN,o.b7=wN,o.b8=function(A,c,u,p,_){var x,T=1/Math.tan(c/2);return A[0]=T/u,A[1]=0,A[2]=0,A[3]=0,A[4]=0,A[5]=T,A[6]=0,A[7]=0,A[8]=0,A[9]=0,A[11]=-1,A[12]=0,A[13]=0,A[15]=0,_!=null&&_!==1/0?(A[10]=(_+p)*(x=1/(p-_)),A[14]=2*_*p*x):(A[10]=-1,A[14]=-2*p),A},o.b9=function(A,c,u){var p=Math.sin(u),_=Math.cos(u),x=c[4],T=c[5],L=c[6],P=c[7],z=c[8],W=c[9],Y=c[10],it=c[11];return c!==A&&(A[0]=c[0],A[1]=c[1],A[2]=c[2],A[3]=c[3],A[12]=c[12],A[13]=c[13],A[14]=c[14],A[15]=c[15]),A[4]=x*_+z*p,A[5]=T*_+W*p,A[6]=L*_+Y*p,A[7]=P*_+it*p,A[8]=z*_-x*p,A[9]=W*_-T*p,A[10]=Y*_-L*p,A[11]=it*_-P*p,A},o.bA=g,o.bB=JO,o.bC=Mi,o.bD=eo,o.ba=st,o.bb=mt,o.bc=function(A,c){return A[0]=c[0],A[1]=0,A[2]=0,A[3]=0,A[4]=0,A[5]=c[1],A[6]=0,A[7]=0,A[8]=0,A[9]=0,A[10]=c[2],A[11]=0,A[12]=0,A[13]=0,A[14]=0,A[15]=1,A},o.bd=class extends cA{},o.be=jC,o.bf=xN,o.bg=I_t,o.bi=Ae,o.bj=function(A,c){let u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(_s===iA||_s===YA||_s===Wu)throw new Error("setRTLTextPlugin cannot be called multiple times.");Zo=Jt.resolveURL(A),_s=iA,ZA=c,td(),u||Gf()},o.bk=Xu,o.bl=function(A,c){const u={};for(let _=0;_<A.length;_++){const x=c&&c[A[_].id]||ns(A[_]);c&&(c[A[_].id]=x);let T=u[x];T||(T=u[x]=[]),T.push(A[_])}const p=[];for(const _ in u)p.push(u[_]);return p},o.bm=ar,o.bn=SN,o.bo=IN,o.bp=oN,o.bq=function(A){A.bucket.createArrays(),A.bucket.tilePixelRatio=ei/(512*A.bucket.overscaling),A.bucket.compareText={},A.bucket.iconsNeedLinear=!1;const c=A.bucket.layers[0],u=c.layout,p=c._unevaluatedLayout._values,_={layoutIconSize:p["icon-size"].possiblyEvaluate(new Jn(A.bucket.zoom+1),A.canonical),layoutTextSize:p["text-size"].possiblyEvaluate(new Jn(A.bucket.zoom+1),A.canonical),textMaxSize:p["text-size"].possiblyEvaluate(new Jn(18))};if(A.bucket.textSizeData.kind==="composite"){const{minZoom:z,maxZoom:W}=A.bucket.textSizeData;_.compositeTextSizes=[p["text-size"].possiblyEvaluate(new Jn(z),A.canonical),p["text-size"].possiblyEvaluate(new Jn(W),A.canonical)]}if(A.bucket.iconSizeData.kind==="composite"){const{minZoom:z,maxZoom:W}=A.bucket.iconSizeData;_.compositeIconSizes=[p["icon-size"].possiblyEvaluate(new Jn(z),A.canonical),p["icon-size"].possiblyEvaluate(new Jn(W),A.canonical)]}const x=u.get("text-line-height")*ss,T=u.get("text-rotation-alignment")!=="viewport"&&u.get("symbol-placement")!=="point",L=u.get("text-keep-upright"),P=u.get("text-size");for(const z of A.bucket.features){const W=u.get("text-font").evaluate(z,{},A.canonical).join(","),Y=P.evaluate(z,{},A.canonical),it=_.layoutTextSize.evaluate(z,{},A.canonical),lt=_.layoutIconSize.evaluate(z,{},A.canonical),ht={horizontal:{},vertical:void 0},Et=z.text;let Mt,Gt=[0,0];if(Et){const re=Et.toString(),de=u.get("text-letter-spacing").evaluate(z,{},A.canonical)*ss,xe=nA(re)?de:0,nr=u.get("text-anchor").evaluate(z,{},A.canonical),gr=zN(c,z,A.canonical);if(!gr){const Xe=u.get("text-radial-offset").evaluate(z,{},A.canonical);Gt=Xe?QN(nr,[Xe*ss,$C]):u.get("text-offset").evaluate(z,{},A.canonical).map(Re=>Re*ss)}let er=T?"center":u.get("text-justify").evaluate(z,{},A.canonical);const Ye=u.get("symbol-placement"),$e=Ye==="point"?u.get("text-max-width").evaluate(z,{},A.canonical)*ss:0,lr=()=>{A.bucket.allowVerticalPlacement&&WA(re)&&(ht.vertical=A_(Et,A.glyphMap,A.glyphPositions,A.imagePositions,W,$e,x,nr,"left",xe,Gt,o.ai.vertical,!0,Ye,it,Y))};if(!T&&gr){const Xe=new Set;if(er==="auto")for(let Lr=0;Lr<gr.values.length;Lr+=2)Xe.add(WC(gr.values[Lr]));else Xe.add(er);let Re=!1;for(const Lr of Xe)if(!ht.horizontal[Lr])if(Re)ht.horizontal[Lr]=ht.horizontal[0];else{const br=A_(Et,A.glyphMap,A.glyphPositions,A.imagePositions,W,$e,x,"center",Lr,xe,Gt,o.ai.horizontal,!1,Ye,it,Y);br&&(ht.horizontal[Lr]=br,Re=br.positionedLines.length===1)}lr()}else{er==="auto"&&(er=WC(nr));const Xe=A_(Et,A.glyphMap,A.glyphPositions,A.imagePositions,W,$e,x,nr,er,xe,Gt,o.ai.horizontal,!1,Ye,it,Y);Xe&&(ht.horizontal[er]=Xe),lr(),WA(re)&&T&&L&&(ht.vertical=A_(Et,A.glyphMap,A.glyphPositions,A.imagePositions,W,$e,x,nr,er,xe,Gt,o.ai.vertical,!1,Ye,it,Y))}}let ee=!1;if(z.icon&&z.icon.name){const re=A.imageMap[z.icon.name];re&&(Mt=A_t(A.imagePositions[z.icon.name],u.get("icon-offset").evaluate(z,{},A.canonical),u.get("icon-anchor").evaluate(z,{},A.canonical)),ee=!!re.sdf,A.bucket.sdfIcons===void 0?A.bucket.sdfIcons=ee:A.bucket.sdfIcons!==ee&&vt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(re.pixelRatio!==A.bucket.pixelRatio||u.get("icon-rotate").constantOr(1)!==0)&&(A.bucket.iconsNeedLinear=!0))}const Xt=GN(ht.horizontal)||ht.vertical;A.bucket.iconsInText=!!Xt&&Xt.iconsInText,(Xt||Mt)&&S_t(A.bucket,z,ht,Mt,A.imageMap,_,it,lt,Gt,ee,A.canonical)}A.showCollisionBoxes&&A.bucket.generateCollisionDebugBuffers()},o.br=PC,o.bs=LC,o.bt=MC,o.bu=class{constructor(A){this._marks={start:[A.url,"start"].join("#"),end:[A.url,"end"].join("#"),measure:A.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let A=performance.getEntriesByName(this._marks.measure);return A.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),A=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),A}},o.bv=RC,o.bw=ih,o.bx=function(A,c,u,p,_){return h(this,void 0,void 0,function*(){if(et())try{return yield Te(A,c,u,p,_)}catch{}return function(x,T,L,P,z){const W=x.width,Y=x.height;rt&&wt||(rt=new OffscreenCanvas(W,Y),wt=rt.getContext("2d",{willReadFrequently:!0})),rt.width=W,rt.height=Y,wt.drawImage(x,0,0,W,Y);const it=wt.getImageData(T,L,P,z);return wt.clearRect(0,0,W,Y),it.data}(A,c,u,p,_)})},o.by=EN,o.bz=f,o.c=se,o.d=function(A,c){const u=new Image;u.onload=()=>{c(null,u),URL.revokeObjectURL(u.src),u.onload=null,window.requestAnimationFrame(()=>{u.src=le})},u.onerror=()=>c(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const p=new Blob([new Uint8Array(A)],{type:"image/png"});u.src=A.byteLength?URL.createObjectURL(p):le},o.e=ft,o.f=function(A,c){return Ve(ft(A,{type:"json"}),c)},o.g=Ce,o.h=Jt,o.i=ae,o.j=ir,o.k=pr,o.l=Ke,o.m=Ve,o.n=function(A){return new RC(A).readFields(i_t,[])},o.o=function(A,c,u){if(!A.length)return u(null,[]);let p=A.length;const _=new Array(A.length);let x=null;A.forEach((T,L)=>{c(T,(P,z)=>{P&&(x=P),_[L]=z,--p==0&&u(x,_)})})},o.p=sN,o.q=gl,o.r=In,o.s=rr,o.t=bi,o.u=tr,o.v=Kt,o.w=vt,o.x=Jo,o.y=wn,o.z=function(A){let[c,u,p]=A;return u+=90,u*=Math.PI/180,p*=Math.PI/180,{x:c*Math.cos(u)*Math.sin(p),y:c*Math.sin(u)*Math.sin(p),z:c*Math.cos(p)}}}),s(["./shared"],function(o){class h{constructor(tt){this.keyCache={},tt&&this.replace(tt)}replace(tt){this._layerConfigs={},this._layers={},this.update(tt,[])}update(tt,at){for(const Tt of tt){this._layerConfigs[Tt.id]=Tt;const Ft=this._layers[Tt.id]=o.aC(Tt);Ft._featureFilter=o.a6(Ft.filter),this.keyCache[Tt.id]&&delete this.keyCache[Tt.id]}for(const Tt of at)delete this.keyCache[Tt],delete this._layerConfigs[Tt],delete this._layers[Tt];this.familiesBySource={};const gt=o.bl(Object.values(this._layerConfigs),this.keyCache);for(const Tt of gt){const Ft=Tt.map(ye=>this._layers[ye.id]),Ht=Ft[0];if(Ht.visibility==="none")continue;const Vt=Ht.source||"";let Qt=this.familiesBySource[Vt];Qt||(Qt=this.familiesBySource[Vt]={});const $t=Ht.sourceLayer||"_geojsonTileLayer";let fe=Qt[$t];fe||(fe=Qt[$t]=[]),fe.push(Ft)}}}class f{constructor(tt){const at={},gt=[];for(const Vt in tt){const Qt=tt[Vt],$t=at[Vt]={};for(const fe in Qt){const ye=Qt[+fe];if(!ye||ye.bitmap.width===0||ye.bitmap.height===0)continue;const we={x:0,y:0,w:ye.bitmap.width+2,h:ye.bitmap.height+2};gt.push(we),$t[fe]={rect:we,metrics:ye.metrics}}}const{w:Tt,h:Ft}=o.p(gt),Ht=new o.q({width:Tt||1,height:Ft||1});for(const Vt in tt){const Qt=tt[Vt];for(const $t in Qt){const fe=Qt[+$t];if(!fe||fe.bitmap.width===0||fe.bitmap.height===0)continue;const ye=at[Vt][$t].rect;o.q.copy(fe.bitmap,Ht,{x:0,y:0},{x:ye.x+1,y:ye.y+1},fe.bitmap)}}this.image=Ht,this.positions=at}}o.bm("GlyphAtlas",f);class g{constructor(tt){this.tileID=new o.O(tt.tileID.overscaledZ,tt.tileID.wrap,tt.tileID.canonical.z,tt.tileID.canonical.x,tt.tileID.canonical.y),this.uid=tt.uid,this.zoom=tt.zoom,this.pixelRatio=tt.pixelRatio,this.tileSize=tt.tileSize,this.source=tt.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=tt.showCollisionBoxes,this.collectResourceTiming=!!tt.collectResourceTiming,this.returnDependencies=!!tt.returnDependencies,this.promoteId=tt.promoteId,this.inFlightDependencies=[],this.dependencySentinel=-1}parse(tt,at,gt,Tt,Ft){this.status="parsing",this.data=tt,this.collisionBoxArray=new o.a3;const Ht=new o.bn(Object.keys(tt.layers).sort()),Vt=new o.bo(this.tileID,this.promoteId);Vt.bucketLayerIDs=[];const Qt={},$t={featureIndex:Vt,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:gt},fe=at.familiesBySource[this.source];for(const Fr in fe){const Rt=tt.layers[Fr];if(!Rt)continue;Rt.version===1&&o.w(`Vector tile source "${this.source}" layer "${Fr}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Qe=Ht.encode(Fr),Be=[];for(let Er=0;Er<Rt.length;Er++){const Kr=Rt.feature(Er),Sn=Vt.getId(Kr,Fr);Be.push({feature:Kr,id:Sn,index:Er,sourceLayerIndex:Qe})}for(const Er of fe[Fr]){const Kr=Er[0];Kr.source!==this.source&&o.w(`layer.source = ${Kr.source} does not equal this.source = ${this.source}`),Kr.minzoom&&this.zoom<Math.floor(Kr.minzoom)||Kr.maxzoom&&this.zoom>=Kr.maxzoom||Kr.visibility!=="none"&&(b(Er,this.zoom,gt),(Qt[Kr.id]=Kr.createBucket({index:Vt.bucketLayerIDs.length,layers:Er,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Qe,sourceID:this.source})).populate(Be,$t,this.tileID.canonical),Vt.bucketLayerIDs.push(Er.map(Sn=>Sn.id)))}}let ye,we,hr,dr;const Je=o.aH($t.glyphDependencies,Fr=>Object.keys(Fr).map(Number));this.inFlightDependencies.forEach(Fr=>Fr==null?void 0:Fr.cancel()),this.inFlightDependencies=[];const or=++this.dependencySentinel;Object.keys(Je).length?this.inFlightDependencies.push(Tt.send("getGlyphs",{uid:this.uid,stacks:Je,source:this.source,tileID:this.tileID,type:"glyphs"},(Fr,Rt)=>{or===this.dependencySentinel&&(ye||(ye=Fr,we=Rt,jr.call(this)))})):we={};const _r=Object.keys($t.iconDependencies);_r.length?this.inFlightDependencies.push(Tt.send("getImages",{icons:_r,source:this.source,tileID:this.tileID,type:"icons"},(Fr,Rt)=>{or===this.dependencySentinel&&(ye||(ye=Fr,hr=Rt,jr.call(this)))})):hr={};const Rr=Object.keys($t.patternDependencies);function jr(){if(ye)return Ft(ye);if(we&&hr&&dr){const Fr=new f(we),Rt=new o.bp(hr,dr);for(const Qe in Qt){const Be=Qt[Qe];Be instanceof o.a4?(b(Be.layers,this.zoom,gt),o.bq({bucket:Be,glyphMap:we,glyphPositions:Fr.positions,imageMap:hr,imagePositions:Rt.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Be.hasPattern&&(Be instanceof o.br||Be instanceof o.bs||Be instanceof o.bt)&&(b(Be.layers,this.zoom,gt),Be.addFeatures($t,this.tileID.canonical,Rt.patternPositions))}this.status="done",Ft(null,{buckets:Object.values(Qt).filter(Qe=>!Qe.isEmpty()),featureIndex:Vt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Fr.image,imageAtlas:Rt,glyphMap:this.returnDependencies?we:null,iconMap:this.returnDependencies?hr:null,glyphPositions:this.returnDependencies?Fr.positions:null})}}Rr.length?this.inFlightDependencies.push(Tt.send("getImages",{icons:Rr,source:this.source,tileID:this.tileID,type:"patterns"},(Fr,Rt)=>{or===this.dependencySentinel&&(ye||(ye=Fr,dr=Rt,jr.call(this)))})):dr={},jr.call(this)}}function b(_t,tt,at){const gt=new o.a8(tt);for(const Tt of _t)Tt.recalculate(gt,at)}function C(_t,tt){const at=o.l(_t.request,(gt,Tt,Ft,Ht)=>{if(gt)tt(gt);else if(Tt)try{const Vt=new o.bw.VectorTile(new o.bv(Tt));tt(null,{vectorTile:Vt,rawData:Tt,cacheControl:Ft,expires:Ht})}catch(Vt){const Qt=new Uint8Array(Tt);let $t=`Unable to parse the tile at ${_t.request.url}, `;$t+=Qt[0]===31&&Qt[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${Vt.messge}`,tt(new Error($t))}});return()=>{at.cancel(),tt()}}class B{constructor(tt,at,gt,Tt){this.actor=tt,this.layerIndex=at,this.availableImages=gt,this.loadVectorData=Tt||C,this.fetching={},this.loading={},this.loaded={}}loadTile(tt,at){const gt=tt.uid;this.loading||(this.loading={});const Tt=!!(tt&&tt.request&&tt.request.collectResourceTiming)&&new o.bu(tt.request),Ft=this.loading[gt]=new g(tt);Ft.abort=this.loadVectorData(tt,(Ht,Vt)=>{if(delete this.loading[gt],Ht||!Vt)return Ft.status="done",this.loaded[gt]=Ft,at(Ht);const Qt=Vt.rawData,$t={};Vt.expires&&($t.expires=Vt.expires),Vt.cacheControl&&($t.cacheControl=Vt.cacheControl);const fe={};if(Tt){const ye=Tt.finish();ye&&(fe.resourceTiming=JSON.parse(JSON.stringify(ye)))}Ft.vectorTile=Vt.vectorTile,Ft.parse(Vt.vectorTile,this.layerIndex,this.availableImages,this.actor,(ye,we)=>{if(delete this.fetching[gt],ye||!we)return at(ye);at(null,o.e({rawTileData:Qt.slice(0)},we,$t,fe))}),this.loaded=this.loaded||{},this.loaded[gt]=Ft,this.fetching[gt]={rawTileData:Qt,cacheControl:$t,resourceTiming:fe}})}reloadTile(tt,at){const gt=this.loaded,Tt=tt.uid;if(gt&&gt[Tt]){const Ft=gt[Tt];Ft.showCollisionBoxes=tt.showCollisionBoxes,Ft.status==="parsing"?Ft.parse(Ft.vectorTile,this.layerIndex,this.availableImages,this.actor,(Ht,Vt)=>{if(Ht||!Vt)return at(Ht,Vt);let Qt;if(this.fetching[Tt]){const{rawTileData:$t,cacheControl:fe,resourceTiming:ye}=this.fetching[Tt];delete this.fetching[Tt],Qt=o.e({rawTileData:$t.slice(0)},Vt,fe,ye)}else Qt=Vt;at(null,Qt)}):Ft.status==="done"&&(Ft.vectorTile?Ft.parse(Ft.vectorTile,this.layerIndex,this.availableImages,this.actor,at):at())}}abortTile(tt,at){const gt=this.loading,Tt=tt.uid;gt&&gt[Tt]&&gt[Tt].abort&&(gt[Tt].abort(),delete gt[Tt]),at()}removeTile(tt,at){const gt=this.loaded,Tt=tt.uid;gt&&gt[Tt]&&delete gt[Tt],at()}}class R{constructor(){this.loaded={}}loadTile(tt,at){return o._(this,void 0,void 0,function*(){const{uid:gt,encoding:Tt,rawImageData:Ft,redFactor:Ht,greenFactor:Vt,blueFactor:Qt,baseShift:$t}=tt,fe=Ft.width+2,ye=Ft.height+2,we=o.a(Ft)?new o.R({width:fe,height:ye},yield o.bx(Ft,-1,-1,fe,ye)):Ft,hr=new o.by(gt,we,Tt,Ht,Vt,Qt,$t);this.loaded=this.loaded||{},this.loaded[gt]=hr,at(null,hr)})}removeTile(tt){const at=this.loaded,gt=tt.uid;at&&at[gt]&&delete at[gt]}}function D(_t,tt){if(_t.length!==0){Q(_t[0],tt);for(var at=1;at<_t.length;at++)Q(_t[at],!tt)}}function Q(_t,tt){for(var at=0,gt=0,Tt=0,Ft=_t.length,Ht=Ft-1;Tt<Ft;Ht=Tt++){var Vt=(_t[Tt][0]-_t[Ht][0])*(_t[Ht][1]+_t[Tt][1]),Qt=at+Vt;gt+=Math.abs(at)>=Math.abs(Vt)?at-Qt+Vt:Vt-Qt+at,at=Qt}at+gt>=0!=!!tt&&_t.reverse()}var k=o.bz(function _t(tt,at){var gt,Tt=tt&&tt.type;if(Tt==="FeatureCollection")for(gt=0;gt<tt.features.length;gt++)_t(tt.features[gt],at);else if(Tt==="GeometryCollection")for(gt=0;gt<tt.geometries.length;gt++)_t(tt.geometries[gt],at);else if(Tt==="Feature")_t(tt.geometry,at);else if(Tt==="Polygon")D(tt.coordinates,at);else if(Tt==="MultiPolygon")for(gt=0;gt<tt.coordinates.length;gt++)D(tt.coordinates[gt],at);return tt});const j=o.bw.VectorTileFeature.prototype.toGeoJSON;var et={exports:{}},st=o.bA,mt=o.bw.VectorTileFeature,pt=yt;function yt(_t,tt){this.options=tt||{},this.features=_t,this.length=_t.length}function ft(_t,tt){this.id=typeof _t.id=="number"?_t.id:void 0,this.type=_t.type,this.rawGeometry=_t.type===1?[_t.geometry]:_t.geometry,this.properties=_t.tags,this.extent=tt||4096}yt.prototype.feature=function(_t){return new ft(this.features[_t],this.options.extent)},ft.prototype.loadGeometry=function(){var _t=this.rawGeometry;this.geometry=[];for(var tt=0;tt<_t.length;tt++){for(var at=_t[tt],gt=[],Tt=0;Tt<at.length;Tt++)gt.push(new st(at[Tt][0],at[Tt][1]));this.geometry.push(gt)}return this.geometry},ft.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var _t=this.geometry,tt=1/0,at=-1/0,gt=1/0,Tt=-1/0,Ft=0;Ft<_t.length;Ft++)for(var Ht=_t[Ft],Vt=0;Vt<Ht.length;Vt++){var Qt=Ht[Vt];tt=Math.min(tt,Qt.x),at=Math.max(at,Qt.x),gt=Math.min(gt,Qt.y),Tt=Math.max(Tt,Qt.y)}return[tt,gt,at,Tt]},ft.prototype.toGeoJSON=mt.prototype.toGeoJSON;var Dt=o.bB,It=pt;function ut(_t){var tt=new Dt;return function(at,gt){for(var Tt in at.layers)gt.writeMessage(3,At,at.layers[Tt])}(_t,tt),tt.finish()}function At(_t,tt){var at;tt.writeVarintField(15,_t.version||1),tt.writeStringField(1,_t.name||""),tt.writeVarintField(5,_t.extent||4096);var gt={keys:[],values:[],keycache:{},valuecache:{}};for(at=0;at<_t.length;at++)gt.feature=_t.feature(at),tt.writeMessage(2,Bt,gt);var Tt=gt.keys;for(at=0;at<Tt.length;at++)tt.writeStringField(3,Tt[at]);var Ft=gt.values;for(at=0;at<Ft.length;at++)tt.writeMessage(4,te,Ft[at])}function Bt(_t,tt){var at=_t.feature;at.id!==void 0&&tt.writeVarintField(1,at.id),tt.writeMessage(2,vt,_t),tt.writeVarintField(3,at.type),tt.writeMessage(4,ae,at)}function vt(_t,tt){var at=_t.feature,gt=_t.keys,Tt=_t.values,Ft=_t.keycache,Ht=_t.valuecache;for(var Vt in at.properties){var Qt=at.properties[Vt],$t=Ft[Vt];if(Qt!==null){$t===void 0&&(gt.push(Vt),Ft[Vt]=$t=gt.length-1),tt.writeVarint($t);var fe=typeof Qt;fe!=="string"&&fe!=="boolean"&&fe!=="number"&&(Qt=JSON.stringify(Qt));var ye=fe+":"+Qt,we=Ht[ye];we===void 0&&(Tt.push(Qt),Ht[ye]=we=Tt.length-1),tt.writeVarint(we)}}}function ne(_t,tt){return(tt<<3)+(7&_t)}function ie(_t){return _t<<1^_t>>31}function ae(_t,tt){for(var at=_t.loadGeometry(),gt=_t.type,Tt=0,Ft=0,Ht=at.length,Vt=0;Vt<Ht;Vt++){var Qt=at[Vt],$t=1;gt===1&&($t=Qt.length),tt.writeVarint(ne(1,$t));for(var fe=gt===3?Qt.length-1:Qt.length,ye=0;ye<fe;ye++){ye===1&&gt!==1&&tt.writeVarint(ne(2,fe-1));var we=Qt[ye].x-Tt,hr=Qt[ye].y-Ft;tt.writeVarint(ie(we)),tt.writeVarint(ie(hr)),Tt+=we,Ft+=hr}gt===3&&tt.writeVarint(ne(7,1))}}function te(_t,tt){var at=typeof _t;at==="string"?tt.writeStringField(1,_t):at==="boolean"?tt.writeBooleanField(7,_t):at==="number"&&(_t%1!=0?tt.writeDoubleField(3,_t):_t<0?tt.writeSVarintField(6,_t):tt.writeVarintField(5,_t))}et.exports=ut,et.exports.fromVectorTileJs=ut,et.exports.fromGeojsonVt=function(_t,tt){tt=tt||{};var at={};for(var gt in _t)at[gt]=new It(_t[gt].features,tt),at[gt].name=gt,at[gt].version=tt.version,at[gt].extent=tt.extent;return ut({layers:at})},et.exports.GeoJSONWrapper=It;var ce=o.bz(et.exports);const le={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:_t=>_t},Te=Math.fround||(rt=new Float32Array(1),_t=>(rt[0]=+_t,rt[0]));var rt;const wt=3,St=5,qt=6;class Jt{constructor(tt){this.options=Object.assign(Object.create(le),tt),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(tt){const{log:at,minZoom:gt,maxZoom:Tt}=this.options;at&&console.time("total time");const Ft=`prepare ${tt.length} points`;at&&console.time(Ft),this.points=tt;const Ht=[];for(let Qt=0;Qt<tt.length;Qt++){const $t=tt[Qt];if(!$t.geometry)continue;const[fe,ye]=$t.geometry.coordinates,we=Te(oe(fe)),hr=Te(Ce(ye));Ht.push(we,hr,1/0,Qt,-1,1),this.options.reduce&&Ht.push(0)}let Vt=this.trees[Tt+1]=this._createTree(Ht);at&&console.timeEnd(Ft);for(let Qt=Tt;Qt>=gt;Qt--){const $t=+Date.now();Vt=this.trees[Qt]=this._createTree(this._cluster(Vt,Qt)),at&&console.log("z%d: %d clusters in %dms",Qt,Vt.numItems,+Date.now()-$t)}return at&&console.timeEnd("total time"),this}getClusters(tt,at){let gt=((tt[0]+180)%360+360)%360-180;const Tt=Math.max(-90,Math.min(90,tt[1]));let Ft=tt[2]===180?180:((tt[2]+180)%360+360)%360-180;const Ht=Math.max(-90,Math.min(90,tt[3]));if(tt[2]-tt[0]>=360)gt=-180,Ft=180;else if(gt>Ft){const ye=this.getClusters([gt,Tt,180,Ht],at),we=this.getClusters([-180,Tt,Ft,Ht],at);return ye.concat(we)}const Vt=this.trees[this._limitZoom(at)],Qt=Vt.range(oe(gt),Ce(Ht),oe(Ft),Ce(Tt)),$t=Vt.data,fe=[];for(const ye of Qt){const we=this.stride*ye;fe.push($t[we+St]>1?se($t,we,this.clusterProps):this.points[$t[we+wt]])}return fe}getChildren(tt){const at=this._getOriginId(tt),gt=this._getOriginZoom(tt),Tt="No cluster with the specified id.",Ft=this.trees[gt];if(!Ft)throw new Error(Tt);const Ht=Ft.data;if(at*this.stride>=Ht.length)throw new Error(Tt);const Vt=this.options.radius/(this.options.extent*Math.pow(2,gt-1)),Qt=Ft.within(Ht[at*this.stride],Ht[at*this.stride+1],Vt),$t=[];for(const fe of Qt){const ye=fe*this.stride;Ht[ye+4]===tt&&$t.push(Ht[ye+St]>1?se(Ht,ye,this.clusterProps):this.points[Ht[ye+wt]])}if($t.length===0)throw new Error(Tt);return $t}getLeaves(tt,at,gt){const Tt=[];return this._appendLeaves(Tt,tt,at=at||10,gt=gt||0,0),Tt}getTile(tt,at,gt){const Tt=this.trees[this._limitZoom(tt)],Ft=Math.pow(2,tt),{extent:Ht,radius:Vt}=this.options,Qt=Vt/Ht,$t=(gt-Qt)/Ft,fe=(gt+1+Qt)/Ft,ye={features:[]};return this._addTileFeatures(Tt.range((at-Qt)/Ft,$t,(at+1+Qt)/Ft,fe),Tt.data,at,gt,Ft,ye),at===0&&this._addTileFeatures(Tt.range(1-Qt/Ft,$t,1,fe),Tt.data,Ft,gt,Ft,ye),at===Ft-1&&this._addTileFeatures(Tt.range(0,$t,Qt/Ft,fe),Tt.data,-1,gt,Ft,ye),ye.features.length?ye:null}getClusterExpansionZoom(tt){let at=this._getOriginZoom(tt)-1;for(;at<=this.options.maxZoom;){const gt=this.getChildren(tt);if(at++,gt.length!==1)break;tt=gt[0].properties.cluster_id}return at}_appendLeaves(tt,at,gt,Tt,Ft){const Ht=this.getChildren(at);for(const Vt of Ht){const Qt=Vt.properties;if(Qt&&Qt.cluster?Ft+Qt.point_count<=Tt?Ft+=Qt.point_count:Ft=this._appendLeaves(tt,Qt.cluster_id,gt,Tt,Ft):Ft<Tt?Ft++:tt.push(Vt),tt.length===gt)break}return Ft}_createTree(tt){const at=new o.av(tt.length/this.stride|0,this.options.nodeSize,Float32Array);for(let gt=0;gt<tt.length;gt+=this.stride)at.add(tt[gt],tt[gt+1]);return at.finish(),at.data=tt,at}_addTileFeatures(tt,at,gt,Tt,Ft,Ht){for(const Vt of tt){const Qt=Vt*this.stride,$t=at[Qt+St]>1;let fe,ye,we;if($t)fe=Ae(at,Qt,this.clusterProps),ye=at[Qt],we=at[Qt+1];else{const Je=this.points[at[Qt+wt]];fe=Je.properties;const[or,_r]=Je.geometry.coordinates;ye=oe(or),we=Ce(_r)}const hr={type:1,geometry:[[Math.round(this.options.extent*(ye*Ft-gt)),Math.round(this.options.extent*(we*Ft-Tt))]],tags:fe};let dr;dr=$t||this.options.generateId?at[Qt+wt]:this.points[at[Qt+wt]].id,dr!==void 0&&(hr.id=dr),Ht.features.push(hr)}}_limitZoom(tt){return Math.max(this.options.minZoom,Math.min(Math.floor(+tt),this.options.maxZoom+1))}_cluster(tt,at){const{radius:gt,extent:Tt,reduce:Ft,minPoints:Ht}=this.options,Vt=gt/(Tt*Math.pow(2,at)),Qt=tt.data,$t=[],fe=this.stride;for(let ye=0;ye<Qt.length;ye+=fe){if(Qt[ye+2]<=at)continue;Qt[ye+2]=at;const we=Qt[ye],hr=Qt[ye+1],dr=tt.within(Qt[ye],Qt[ye+1],Vt),Je=Qt[ye+St];let or=Je;for(const _r of dr){const Rr=_r*fe;Qt[Rr+2]>at&&(or+=Qt[Rr+St])}if(or>Je&&or>=Ht){let _r,Rr=we*Je,jr=hr*Je,Fr=-1;const Rt=((ye/fe|0)<<5)+(at+1)+this.points.length;for(const Qe of dr){const Be=Qe*fe;if(Qt[Be+2]<=at)continue;Qt[Be+2]=at;const Er=Qt[Be+St];Rr+=Qt[Be]*Er,jr+=Qt[Be+1]*Er,Qt[Be+4]=Rt,Ft&&(_r||(_r=this._map(Qt,ye,!0),Fr=this.clusterProps.length,this.clusterProps.push(_r)),Ft(_r,this._map(Qt,Be)))}Qt[ye+4]=Rt,$t.push(Rr/or,jr/or,1/0,Rt,-1,or),Ft&&$t.push(Fr)}else{for(let _r=0;_r<fe;_r++)$t.push(Qt[ye+_r]);if(or>1)for(const _r of dr){const Rr=_r*fe;if(!(Qt[Rr+2]<=at)){Qt[Rr+2]=at;for(let jr=0;jr<fe;jr++)$t.push(Qt[Rr+jr])}}}}return $t}_getOriginId(tt){return tt-this.points.length>>5}_getOriginZoom(tt){return(tt-this.points.length)%32}_map(tt,at,gt){if(tt[at+St]>1){const Ht=this.clusterProps[tt[at+qt]];return gt?Object.assign({},Ht):Ht}const Tt=this.points[tt[at+wt]].properties,Ft=this.options.map(Tt);return gt&&Ft===Tt?Object.assign({},Ft):Ft}}function se(_t,tt,at){return{type:"Feature",id:_t[tt+wt],properties:Ae(_t,tt,at),geometry:{type:"Point",coordinates:[(gt=_t[tt],360*(gt-.5)),Pe(_t[tt+1])]}};var gt}function Ae(_t,tt,at){const gt=_t[tt+St],Tt=gt>=1e4?`${Math.round(gt/1e3)}k`:gt>=1e3?Math.round(gt/100)/10+"k":gt,Ft=_t[tt+qt],Ht=Ft===-1?{}:Object.assign({},at[Ft]);return Object.assign(Ht,{cluster:!0,cluster_id:_t[tt+wt],point_count:gt,point_count_abbreviated:Tt})}function oe(_t){return _t/360+.5}function Ce(_t){const tt=Math.sin(_t*Math.PI/180),at=.5-.25*Math.log((1+tt)/(1-tt))/Math.PI;return at<0?0:at>1?1:at}function Pe(_t){const tt=(180-360*_t)*Math.PI/180;return 360*Math.atan(Math.exp(tt))/Math.PI-90}function Ve(_t,tt,at,gt){for(var Tt,Ft=gt,Ht=at-tt>>1,Vt=at-tt,Qt=_t[tt],$t=_t[tt+1],fe=_t[at],ye=_t[at+1],we=tt+3;we<at;we+=3){var hr=Ke(_t[we],_t[we+1],Qt,$t,fe,ye);if(hr>Ft)Tt=we,Ft=hr;else if(hr===Ft){var dr=Math.abs(we-Ht);dr<Vt&&(Tt=we,Vt=dr)}}Ft>gt&&(Tt-tt>3&&Ve(_t,tt,Tt,gt),_t[Tt+2]=Ft,at-Tt>3&&Ve(_t,Tt,at,gt))}function Ke(_t,tt,at,gt,Tt,Ft){var Ht=Tt-at,Vt=Ft-gt;if(Ht!==0||Vt!==0){var Qt=((_t-at)*Ht+(tt-gt)*Vt)/(Ht*Ht+Vt*Vt);Qt>1?(at=Tt,gt=Ft):Qt>0&&(at+=Ht*Qt,gt+=Vt*Qt)}return(Ht=_t-at)*Ht+(Vt=tt-gt)*Vt}function rr(_t,tt,at,gt){var Tt={id:_t===void 0?null:_t,type:tt,geometry:at,tags:gt,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Ft){var Ht=Ft.geometry,Vt=Ft.type;if(Vt==="Point"||Vt==="MultiPoint"||Vt==="LineString")_e(Ft,Ht);else if(Vt==="Polygon"||Vt==="MultiLineString")for(var Qt=0;Qt<Ht.length;Qt++)_e(Ft,Ht[Qt]);else if(Vt==="MultiPolygon")for(Qt=0;Qt<Ht.length;Qt++)for(var $t=0;$t<Ht[Qt].length;$t++)_e(Ft,Ht[Qt][$t])}(Tt),Tt}function _e(_t,tt){for(var at=0;at<tt.length;at+=3)_t.minX=Math.min(_t.minX,tt[at]),_t.minY=Math.min(_t.minY,tt[at+1]),_t.maxX=Math.max(_t.maxX,tt[at]),_t.maxY=Math.max(_t.maxY,tt[at+1])}function Ut(_t,tt,at,gt){if(tt.geometry){var Tt=tt.geometry.coordinates,Ft=tt.geometry.type,Ht=Math.pow(at.tolerance/((1<<at.maxZoom)*at.extent),2),Vt=[],Qt=tt.id;if(at.promoteId?Qt=tt.properties[at.promoteId]:at.generateId&&(Qt=gt||0),Ft==="Point")pr(Tt,Vt);else if(Ft==="MultiPoint")for(var $t=0;$t<Tt.length;$t++)pr(Tt[$t],Vt);else if(Ft==="LineString")ir(Tt,Vt,Ht,!1);else if(Ft==="MultiLineString"){if(at.lineMetrics){for($t=0;$t<Tt.length;$t++)ir(Tt[$t],Vt=[],Ht,!1),_t.push(rr(Qt,"LineString",Vt,tt.properties));return}Se(Tt,Vt,Ht,!1)}else if(Ft==="Polygon")Se(Tt,Vt,Ht,!0);else{if(Ft!=="MultiPolygon"){if(Ft==="GeometryCollection"){for($t=0;$t<tt.geometry.geometries.length;$t++)Ut(_t,{id:Qt,geometry:tt.geometry.geometries[$t],properties:tt.properties},at,gt);return}throw new Error("Input data is not a valid GeoJSON object.")}for($t=0;$t<Tt.length;$t++){var fe=[];Se(Tt[$t],fe,Ht,!0),Vt.push(fe)}}_t.push(rr(Qt,Ft,Vt,tt.properties))}}function pr(_t,tt){tt.push(Kt(_t[0])),tt.push(Ie(_t[1])),tt.push(0)}function ir(_t,tt,at,gt){for(var Tt,Ft,Ht=0,Vt=0;Vt<_t.length;Vt++){var Qt=Kt(_t[Vt][0]),$t=Ie(_t[Vt][1]);tt.push(Qt),tt.push($t),tt.push(0),Vt>0&&(Ht+=gt?(Tt*$t-Qt*Ft)/2:Math.sqrt(Math.pow(Qt-Tt,2)+Math.pow($t-Ft,2))),Tt=Qt,Ft=$t}var fe=tt.length-3;tt[2]=1,Ve(tt,0,fe,at),tt[fe+2]=1,tt.size=Math.abs(Ht),tt.start=0,tt.end=tt.size}function Se(_t,tt,at,gt){for(var Tt=0;Tt<_t.length;Tt++){var Ft=[];ir(_t[Tt],Ft,at,gt),tt.push(Ft)}}function Kt(_t){return _t/360+.5}function Ie(_t){var tt=Math.sin(_t*Math.PI/180),at=.5-.25*Math.log((1+tt)/(1-tt))/Math.PI;return at<0?0:at>1?1:at}function ke(_t,tt,at,gt,Tt,Ft,Ht,Vt){if(gt/=tt,Ft>=(at/=tt)&&Ht<gt)return _t;if(Ht<at||Ft>=gt)return null;for(var Qt=[],$t=0;$t<_t.length;$t++){var fe=_t[$t],ye=fe.geometry,we=fe.type,hr=Tt===0?fe.minX:fe.minY,dr=Tt===0?fe.maxX:fe.maxY;if(hr>=at&&dr<gt)Qt.push(fe);else if(!(dr<at||hr>=gt)){var Je=[];if(we==="Point"||we==="MultiPoint")He(ye,Je,at,gt,Tt);else if(we==="LineString")De(ye,Je,at,gt,Tt,!1,Vt.lineMetrics);else if(we==="MultiLineString")Pr(ye,Je,at,gt,Tt,!1);else if(we==="Polygon")Pr(ye,Je,at,gt,Tt,!0);else if(we==="MultiPolygon")for(var or=0;or<ye.length;or++){var _r=[];Pr(ye[or],_r,at,gt,Tt,!0),_r.length&&Je.push(_r)}if(Je.length){if(Vt.lineMetrics&&we==="LineString"){for(or=0;or<Je.length;or++)Qt.push(rr(fe.id,we,Je[or],fe.tags));continue}we!=="LineString"&&we!=="MultiLineString"||(Je.length===1?(we="LineString",Je=Je[0]):we="MultiLineString"),we!=="Point"&&we!=="MultiPoint"||(we=Je.length===3?"Point":"MultiPoint"),Qt.push(rr(fe.id,we,Je,fe.tags))}}}return Qt.length?Qt:null}function He(_t,tt,at,gt,Tt){for(var Ft=0;Ft<_t.length;Ft+=3){var Ht=_t[Ft+Tt];Ht>=at&&Ht<=gt&&(tt.push(_t[Ft]),tt.push(_t[Ft+1]),tt.push(_t[Ft+2]))}}function De(_t,tt,at,gt,Tt,Ft,Ht){for(var Vt,Qt,$t=xr(_t),fe=Tt===0?nn:Br,ye=_t.start,we=0;we<_t.length-3;we+=3){var hr=_t[we],dr=_t[we+1],Je=_t[we+2],or=_t[we+3],_r=_t[we+4],Rr=Tt===0?hr:dr,jr=Tt===0?or:_r,Fr=!1;Ht&&(Vt=Math.sqrt(Math.pow(hr-or,2)+Math.pow(dr-_r,2))),Rr<at?jr>at&&(Qt=fe($t,hr,dr,or,_r,at),Ht&&($t.start=ye+Vt*Qt)):Rr>gt?jr<gt&&(Qt=fe($t,hr,dr,or,_r,gt),Ht&&($t.start=ye+Vt*Qt)):Or($t,hr,dr,Je),jr<at&&Rr>=at&&(Qt=fe($t,hr,dr,or,_r,at),Fr=!0),jr>gt&&Rr<=gt&&(Qt=fe($t,hr,dr,or,_r,gt),Fr=!0),!Ft&&Fr&&(Ht&&($t.end=ye+Vt*Qt),tt.push($t),$t=xr(_t)),Ht&&(ye+=Vt)}var Rt=_t.length-3;hr=_t[Rt],dr=_t[Rt+1],Je=_t[Rt+2],(Rr=Tt===0?hr:dr)>=at&&Rr<=gt&&Or($t,hr,dr,Je),Rt=$t.length-3,Ft&&Rt>=3&&($t[Rt]!==$t[0]||$t[Rt+1]!==$t[1])&&Or($t,$t[0],$t[1],$t[2]),$t.length&&tt.push($t)}function xr(_t){var tt=[];return tt.size=_t.size,tt.start=_t.start,tt.end=_t.end,tt}function Pr(_t,tt,at,gt,Tt,Ft){for(var Ht=0;Ht<_t.length;Ht++)De(_t[Ht],tt,at,gt,Tt,Ft,!1)}function Or(_t,tt,at,gt){_t.push(tt),_t.push(at),_t.push(gt)}function nn(_t,tt,at,gt,Tt,Ft){var Ht=(Ft-tt)/(gt-tt);return _t.push(Ft),_t.push(at+(Tt-at)*Ht),_t.push(1),Ht}function Br(_t,tt,at,gt,Tt,Ft){var Ht=(Ft-at)/(Tt-at);return _t.push(tt+(gt-tt)*Ht),_t.push(Ft),_t.push(1),Ht}function Ur(_t,tt){for(var at=[],gt=0;gt<_t.length;gt++){var Tt,Ft=_t[gt],Ht=Ft.type;if(Ht==="Point"||Ht==="MultiPoint"||Ht==="LineString")Tt=je(Ft.geometry,tt);else if(Ht==="MultiLineString"||Ht==="Polygon"){Tt=[];for(var Vt=0;Vt<Ft.geometry.length;Vt++)Tt.push(je(Ft.geometry[Vt],tt))}else if(Ht==="MultiPolygon")for(Tt=[],Vt=0;Vt<Ft.geometry.length;Vt++){for(var Qt=[],$t=0;$t<Ft.geometry[Vt].length;$t++)Qt.push(je(Ft.geometry[Vt][$t],tt));Tt.push(Qt)}at.push(rr(Ft.id,Ht,Tt,Ft.tags))}return at}function je(_t,tt){var at=[];at.size=_t.size,_t.start!==void 0&&(at.start=_t.start,at.end=_t.end);for(var gt=0;gt<_t.length;gt+=3)at.push(_t[gt]+tt,_t[gt+1],_t[gt+2]);return at}function Ee(_t,tt){if(_t.transformed)return _t;var at,gt,Tt,Ft=1<<_t.z,Ht=_t.x,Vt=_t.y;for(at=0;at<_t.features.length;at++){var Qt=_t.features[at],$t=Qt.geometry,fe=Qt.type;if(Qt.geometry=[],fe===1)for(gt=0;gt<$t.length;gt+=2)Qt.geometry.push(Nr($t[gt],$t[gt+1],tt,Ft,Ht,Vt));else for(gt=0;gt<$t.length;gt++){var ye=[];for(Tt=0;Tt<$t[gt].length;Tt+=2)ye.push(Nr($t[gt][Tt],$t[gt][Tt+1],tt,Ft,Ht,Vt));Qt.geometry.push(ye)}}return _t.transformed=!0,_t}function Nr(_t,tt,at,gt,Tt,Ft){return[Math.round(at*(_t*gt-Tt)),Math.round(at*(tt*gt-Ft))]}function Vr(_t,tt,at,gt,Tt){for(var Ft=tt===Tt.maxZoom?0:Tt.tolerance/((1<<tt)*Tt.extent),Ht={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:at,y:gt,z:tt,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Vt=0;Vt<_t.length;Vt++){Ht.numFeatures++,qr(Ht,_t[Vt],Ft,Tt);var Qt=_t[Vt].minX,$t=_t[Vt].minY,fe=_t[Vt].maxX,ye=_t[Vt].maxY;Qt<Ht.minX&&(Ht.minX=Qt),$t<Ht.minY&&(Ht.minY=$t),fe>Ht.maxX&&(Ht.maxX=fe),ye>Ht.maxY&&(Ht.maxY=ye)}return Ht}function qr(_t,tt,at,gt){var Tt=tt.geometry,Ft=tt.type,Ht=[];if(Ft==="Point"||Ft==="MultiPoint")for(var Vt=0;Vt<Tt.length;Vt+=3)Ht.push(Tt[Vt]),Ht.push(Tt[Vt+1]),_t.numPoints++,_t.numSimplified++;else if(Ft==="LineString")rn(Ht,Tt,_t,at,!1,!1);else if(Ft==="MultiLineString"||Ft==="Polygon")for(Vt=0;Vt<Tt.length;Vt++)rn(Ht,Tt[Vt],_t,at,Ft==="Polygon",Vt===0);else if(Ft==="MultiPolygon")for(var Qt=0;Qt<Tt.length;Qt++){var $t=Tt[Qt];for(Vt=0;Vt<$t.length;Vt++)rn(Ht,$t[Vt],_t,at,!0,Vt===0)}if(Ht.length){var fe=tt.tags||null;if(Ft==="LineString"&&gt.lineMetrics){for(var ye in fe={},tt.tags)fe[ye]=tt.tags[ye];fe.mapbox_clip_start=Tt.start/Tt.size,fe.mapbox_clip_end=Tt.end/Tt.size}var we={geometry:Ht,type:Ft==="Polygon"||Ft==="MultiPolygon"?3:Ft==="LineString"||Ft==="MultiLineString"?2:1,tags:fe};tt.id!==null&&(we.id=tt.id),_t.features.push(we)}}function rn(_t,tt,at,gt,Tt,Ft){var Ht=gt*gt;if(gt>0&&tt.size<(Tt?Ht:gt))at.numPoints+=tt.length/3;else{for(var Vt=[],Qt=0;Qt<tt.length;Qt+=3)(gt===0||tt[Qt+2]>Ht)&&(at.numSimplified++,Vt.push(tt[Qt]),Vt.push(tt[Qt+1])),at.numPoints++;Tt&&function($t,fe){for(var ye=0,we=0,hr=$t.length,dr=hr-2;we<hr;dr=we,we+=2)ye+=($t[we]-$t[dr])*($t[we+1]+$t[dr+1]);if(ye>0===fe)for(we=0,hr=$t.length;we<hr/2;we+=2){var Je=$t[we],or=$t[we+1];$t[we]=$t[hr-2-we],$t[we+1]=$t[hr-1-we],$t[hr-2-we]=Je,$t[hr-1-we]=or}}(Vt,Ft),_t.push(Vt)}}function Fe(_t,tt){var at=(tt=this.options=function(Tt,Ft){for(var Ht in Ft)Tt[Ht]=Ft[Ht];return Tt}(Object.create(this.options),tt)).debug;if(at&&console.time("preprocess data"),tt.maxZoom<0||tt.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(tt.promoteId&&tt.generateId)throw new Error("promoteId and generateId cannot be used together.");var gt=function(Tt,Ft){var Ht=[];if(Tt.type==="FeatureCollection")for(var Vt=0;Vt<Tt.features.length;Vt++)Ut(Ht,Tt.features[Vt],Ft,Vt);else Ut(Ht,Tt.type==="Feature"?Tt:{geometry:Tt},Ft);return Ht}(_t,tt);this.tiles={},this.tileCoords=[],at&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",tt.indexMaxZoom,tt.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),gt=function(Tt,Ft){var Ht=Ft.buffer/Ft.extent,Vt=Tt,Qt=ke(Tt,1,-1-Ht,Ht,0,-1,2,Ft),$t=ke(Tt,1,1-Ht,2+Ht,0,-1,2,Ft);return(Qt||$t)&&(Vt=ke(Tt,1,-Ht,1+Ht,0,-1,2,Ft)||[],Qt&&(Vt=Ur(Qt,1).concat(Vt)),$t&&(Vt=Vt.concat(Ur($t,-1)))),Vt}(gt,tt),gt.length&&this.splitTile(gt,0,0,0),at&&(gt.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Ze(_t,tt,at){return 32*((1<<_t)*at+tt)+_t}function ur(_t,tt){return tt?_t.properties[tt]:_t.id}function Jr(_t,tt){if(_t==null)return!0;if(_t.type==="Feature")return ur(_t,tt)!=null;if(_t.type==="FeatureCollection"){const at=new Set;for(const gt of _t.features){const Tt=ur(gt,tt);if(Tt==null||at.has(Tt))return!1;at.add(Tt)}return!0}return!1}function Un(_t,tt){const at=new Map;if(_t!=null)if(_t.type==="Feature")at.set(ur(_t,tt),_t);else for(const gt of _t.features)at.set(ur(gt,tt),gt);return at}Fe.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Fe.prototype.splitTile=function(_t,tt,at,gt,Tt,Ft,Ht){for(var Vt=[_t,tt,at,gt],Qt=this.options,$t=Qt.debug;Vt.length;){gt=Vt.pop(),at=Vt.pop(),tt=Vt.pop(),_t=Vt.pop();var fe=1<<tt,ye=Ze(tt,at,gt),we=this.tiles[ye];if(!we&&($t>1&&console.time("creation"),we=this.tiles[ye]=Vr(_t,tt,at,gt,Qt),this.tileCoords.push({z:tt,x:at,y:gt}),$t)){$t>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",tt,at,gt,we.numFeatures,we.numPoints,we.numSimplified),console.timeEnd("creation"));var hr="z"+tt;this.stats[hr]=(this.stats[hr]||0)+1,this.total++}if(we.source=_t,Tt){if(tt===Qt.maxZoom||tt===Tt)continue;var dr=1<<Tt-tt;if(at!==Math.floor(Ft/dr)||gt!==Math.floor(Ht/dr))continue}else if(tt===Qt.indexMaxZoom||we.numPoints<=Qt.indexMaxPoints)continue;if(we.source=null,_t.length!==0){$t>1&&console.time("clipping");var Je,or,_r,Rr,jr,Fr,Rt=.5*Qt.buffer/Qt.extent,Qe=.5-Rt,Be=.5+Rt,Er=1+Rt;Je=or=_r=Rr=null,jr=ke(_t,fe,at-Rt,at+Be,0,we.minX,we.maxX,Qt),Fr=ke(_t,fe,at+Qe,at+Er,0,we.minX,we.maxX,Qt),_t=null,jr&&(Je=ke(jr,fe,gt-Rt,gt+Be,1,we.minY,we.maxY,Qt),or=ke(jr,fe,gt+Qe,gt+Er,1,we.minY,we.maxY,Qt),jr=null),Fr&&(_r=ke(Fr,fe,gt-Rt,gt+Be,1,we.minY,we.maxY,Qt),Rr=ke(Fr,fe,gt+Qe,gt+Er,1,we.minY,we.maxY,Qt),Fr=null),$t>1&&console.timeEnd("clipping"),Vt.push(Je||[],tt+1,2*at,2*gt),Vt.push(or||[],tt+1,2*at,2*gt+1),Vt.push(_r||[],tt+1,2*at+1,2*gt),Vt.push(Rr||[],tt+1,2*at+1,2*gt+1)}}},Fe.prototype.getTile=function(_t,tt,at){var gt=this.options,Tt=gt.extent,Ft=gt.debug;if(_t<0||_t>24)return null;var Ht=1<<_t,Vt=Ze(_t,tt=(tt%Ht+Ht)%Ht,at);if(this.tiles[Vt])return Ee(this.tiles[Vt],Tt);Ft>1&&console.log("drilling down to z%d-%d-%d",_t,tt,at);for(var Qt,$t=_t,fe=tt,ye=at;!Qt&&$t>0;)$t--,fe=Math.floor(fe/2),ye=Math.floor(ye/2),Qt=this.tiles[Ze($t,fe,ye)];return Qt&&Qt.source?(Ft>1&&console.log("found parent tile z%d-%d-%d",$t,fe,ye),Ft>1&&console.time("drilling down"),this.splitTile(Qt.source,$t,fe,ye,_t,tt,at),Ft>1&&console.timeEnd("drilling down"),this.tiles[Vt]?Ee(this.tiles[Vt],Tt):null):null};class qe extends B{constructor(tt,at,gt,Tt){super(tt,at,gt),this._dataUpdateable=new Map,this.loadGeoJSON=(Ft,Ht)=>{const{promoteId:Vt}=Ft;if(Ft.request)return o.f(Ft.request,(Qt,$t,fe,ye)=>{this._dataUpdateable=Jr($t,Vt)?Un($t,Vt):void 0,Ht(Qt,$t,fe,ye)});if(typeof Ft.data=="string")try{const Qt=JSON.parse(Ft.data);this._dataUpdateable=Jr(Qt,Vt)?Un(Qt,Vt):void 0,Ht(null,Qt)}catch{Ht(new Error(`Input data given to '${Ft.source}' is not a valid GeoJSON object.`))}else Ft.dataDiff?this._dataUpdateable?(function(Qt,$t,fe){var ye,we,hr,dr;if($t.removeAll&&Qt.clear(),$t.remove)for(const Je of $t.remove)Qt.delete(Je);if($t.add)for(const Je of $t.add){const or=ur(Je,fe);or!=null&&Qt.set(or,Je)}if($t.update)for(const Je of $t.update){let or=Qt.get(Je.id);if(or==null)continue;const _r=!Je.removeAllProperties&&(((ye=Je.removeProperties)===null||ye===void 0?void 0:ye.length)>0||((we=Je.addOrUpdateProperties)===null||we===void 0?void 0:we.length)>0);if((Je.newGeometry||Je.removeAllProperties||_r)&&(or=Object.assign({},or),Qt.set(Je.id,or),_r&&(or.properties=Object.assign({},or.properties))),Je.newGeometry&&(or.geometry=Je.newGeometry),Je.removeAllProperties)or.properties={};else if(((hr=Je.removeProperties)===null||hr===void 0?void 0:hr.length)>0)for(const Rr of Je.removeProperties)Object.prototype.hasOwnProperty.call(or.properties,Rr)&&delete or.properties[Rr];if(((dr=Je.addOrUpdateProperties)===null||dr===void 0?void 0:dr.length)>0)for(const{key:Rr,value:jr}of Je.addOrUpdateProperties)or.properties[Rr]=jr}}(this._dataUpdateable,Ft.dataDiff,Vt),Ht(null,{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())})):Ht(new Error(`Cannot update existing geojson data in ${Ft.source}`)):Ht(new Error(`Input data given to '${Ft.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}},this.loadVectorData=this.loadGeoJSONTile,Tt&&(this.loadGeoJSON=Tt)}loadGeoJSONTile(tt,at){const gt=tt.tileID.canonical;if(!this._geoJSONIndex)return at(null,null);const Tt=this._geoJSONIndex.getTile(gt.z,gt.x,gt.y);if(!Tt)return at(null,null);const Ft=new class{constructor(Vt){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.N,this.length=Vt.length,this._features=Vt}feature(Vt){return new class{constructor(Qt){this._feature=Qt,this.extent=o.N,this.type=Qt.type,this.properties=Qt.tags,"id"in Qt&&!isNaN(Qt.id)&&(this.id=parseInt(Qt.id,10))}loadGeometry(){if(this._feature.type===1){const Qt=[];for(const $t of this._feature.geometry)Qt.push([new o.P($t[0],$t[1])]);return Qt}{const Qt=[];for(const $t of this._feature.geometry){const fe=[];for(const ye of $t)fe.push(new o.P(ye[0],ye[1]));Qt.push(fe)}return Qt}}toGeoJSON(Qt,$t,fe){return j.call(this,Qt,$t,fe)}}(this._features[Vt])}}(Tt.features);let Ht=ce(Ft);Ht.byteOffset===0&&Ht.byteLength===Ht.buffer.byteLength||(Ht=new Uint8Array(Ht)),at(null,{vectorTile:Ft,rawData:Ht.buffer})}loadData(tt,at){var gt;(gt=this._pendingRequest)===null||gt===void 0||gt.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const Tt=!!(tt&&tt.request&&tt.request.collectResourceTiming)&&new o.bu(tt.request);this._pendingCallback=at,this._pendingRequest=this.loadGeoJSON(tt,(Ft,Ht)=>{if(delete this._pendingCallback,delete this._pendingRequest,Ft||!Ht)return at(Ft);if(typeof Ht!="object")return at(new Error(`Input data given to '${tt.source}' is not a valid GeoJSON object.`));{k(Ht,!0);try{if(tt.filter){const Qt=o.bC(tt.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Qt.result==="error")throw new Error(Qt.value.map(fe=>`${fe.key}: ${fe.message}`).join(", "));Ht={type:"FeatureCollection",features:Ht.features.filter(fe=>Qt.value.evaluate({zoom:0},fe))}}this._geoJSONIndex=tt.cluster?new Jt(function(Qt){let{superclusterOptions:$t,clusterProperties:fe}=Qt;if(!fe||!$t)return $t;const ye={},we={},hr={accumulated:null,zoom:0},dr={properties:null},Je=Object.keys(fe);for(const or of Je){const[_r,Rr]=fe[or],jr=o.bC(Rr),Fr=o.bC(typeof _r=="string"?[_r,["accumulated"],["get",or]]:_r);ye[or]=jr.value,we[or]=Fr.value}return $t.map=or=>{dr.properties=or;const _r={};for(const Rr of Je)_r[Rr]=ye[Rr].evaluate(hr,dr);return _r},$t.reduce=(or,_r)=>{dr.properties=_r;for(const Rr of Je)hr.accumulated=or[Rr],or[Rr]=we[Rr].evaluate(hr,dr)},$t}(tt)).load(Ht.features):function(Qt,$t){return new Fe(Qt,$t)}(Ht,tt.geojsonVtOptions)}catch(Qt){return at(Qt)}this.loaded={};const Vt={};if(Tt){const Qt=Tt.finish();Qt&&(Vt.resourceTiming={},Vt.resourceTiming[tt.source]=JSON.parse(JSON.stringify(Qt)))}at(null,Vt)}})}reloadTile(tt,at){const gt=this.loaded;return gt&&gt[tt.uid]?super.reloadTile(tt,at):this.loadTile(tt,at)}removeSource(tt,at){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),at()}getClusterExpansionZoom(tt,at){try{at(null,this._geoJSONIndex.getClusterExpansionZoom(tt.clusterId))}catch(gt){at(gt)}}getClusterChildren(tt,at){try{at(null,this._geoJSONIndex.getChildren(tt.clusterId))}catch(gt){at(gt)}}getClusterLeaves(tt,at){try{at(null,this._geoJSONIndex.getLeaves(tt.clusterId,tt.limit,tt.offset))}catch(gt){at(gt)}}}class sn{constructor(tt){this.self=tt,this.actor=new o.C(tt,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:B,geojson:qe},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(at,gt)=>{if(this.workerSourceTypes[at])throw new Error(`Worker source with name "${at}" already registered.`);this.workerSourceTypes[at]=gt},this.self.registerRTLTextPlugin=at=>{if(o.bD.isParsed())throw new Error("RTL text plugin already registered.");o.bD.applyArabicShaping=at.applyArabicShaping,o.bD.processBidirectionalText=at.processBidirectionalText,o.bD.processStyledBidirectionalText=at.processStyledBidirectionalText}}setReferrer(tt,at){this.referrer=at}setImages(tt,at,gt){this.availableImages[tt]=at;for(const Tt in this.workerSources[tt]){const Ft=this.workerSources[tt][Tt];for(const Ht in Ft)Ft[Ht].availableImages=at}gt()}setLayers(tt,at,gt){this.getLayerIndex(tt).replace(at),gt()}updateLayers(tt,at,gt){this.getLayerIndex(tt).update(at.layers,at.removedIds),gt()}loadTile(tt,at,gt){this.getWorkerSource(tt,at.type,at.source).loadTile(at,gt)}loadDEMTile(tt,at,gt){this.getDEMWorkerSource(tt,at.source).loadTile(at,gt)}reloadTile(tt,at,gt){this.getWorkerSource(tt,at.type,at.source).reloadTile(at,gt)}abortTile(tt,at,gt){this.getWorkerSource(tt,at.type,at.source).abortTile(at,gt)}removeTile(tt,at,gt){this.getWorkerSource(tt,at.type,at.source).removeTile(at,gt)}removeDEMTile(tt,at){this.getDEMWorkerSource(tt,at.source).removeTile(at)}removeSource(tt,at,gt){if(!this.workerSources[tt]||!this.workerSources[tt][at.type]||!this.workerSources[tt][at.type][at.source])return;const Tt=this.workerSources[tt][at.type][at.source];delete this.workerSources[tt][at.type][at.source],Tt.removeSource!==void 0?Tt.removeSource(at,gt):gt()}loadWorkerSource(tt,at,gt){try{this.self.importScripts(at.url),gt()}catch(Tt){gt(Tt.toString())}}syncRTLPluginState(tt,at,gt){try{o.bD.setState(at);const Tt=o.bD.getPluginURL();if(o.bD.isLoaded()&&!o.bD.isParsed()&&Tt!=null){this.self.importScripts(Tt);const Ft=o.bD.isParsed();gt(Ft?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Tt}`),Ft)}}catch(Tt){gt(Tt.toString())}}getAvailableImages(tt){let at=this.availableImages[tt];return at||(at=[]),at}getLayerIndex(tt){let at=this.layerIndexes[tt];return at||(at=this.layerIndexes[tt]=new h),at}getWorkerSource(tt,at,gt){return this.workerSources[tt]||(this.workerSources[tt]={}),this.workerSources[tt][at]||(this.workerSources[tt][at]={}),this.workerSources[tt][at][gt]||(this.workerSources[tt][at][gt]=new this.workerSourceTypes[at]({send:(Tt,Ft,Ht)=>{this.actor.send(Tt,Ft,Ht,tt)}},this.getLayerIndex(tt),this.getAvailableImages(tt))),this.workerSources[tt][at][gt]}getDEMWorkerSource(tt,at){return this.demWorkerSources[tt]||(this.demWorkerSources[tt]={}),this.demWorkerSources[tt][at]||(this.demWorkerSources[tt][at]=new R),this.demWorkerSources[tt][at]}}return o.i()&&(self.worker=new sn(self)),sn}),s(["./shared"],function(o){var h="3.6.2";class f{static testProp(l){if(!f.docStyle)return l[0];for(let d=0;d<l.length;d++)if(l[d]in f.docStyle)return l[d];return l[0]}static create(l,d,m){const v=window.document.createElement(l);return d!==void 0&&(v.className=d),m&&m.appendChild(v),v}static createNS(l,d){return window.document.createElementNS(l,d)}static disableDrag(){f.docStyle&&f.selectProp&&(f.userSelect=f.docStyle[f.selectProp],f.docStyle[f.selectProp]="none")}static enableDrag(){f.docStyle&&f.selectProp&&(f.docStyle[f.selectProp]=f.userSelect)}static setTransform(l,d){l.style[f.transformProp]=d}static addEventListener(l,d,m){let v=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};l.addEventListener(d,m,"passive"in v?v:v.capture)}static removeEventListener(l,d,m){let v=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};l.removeEventListener(d,m,"passive"in v?v:v.capture)}static suppressClickInternal(l){l.preventDefault(),l.stopPropagation(),window.removeEventListener("click",f.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",f.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",f.suppressClickInternal,!0)},0)}static mousePos(l,d){const m=l.getBoundingClientRect();return new o.P(d.clientX-m.left-l.clientLeft,d.clientY-m.top-l.clientTop)}static touchPos(l,d){const m=l.getBoundingClientRect(),v=[];for(let E=0;E<d.length;E++)v.push(new o.P(d[E].clientX-m.left-l.clientLeft,d[E].clientY-m.top-l.clientTop));return v}static mouseButton(l){return l.button}static remove(l){l.parentNode&&l.parentNode.removeChild(l)}}f.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,f.selectProp=f.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),f.transformProp=f.testProp(["transform","WebkitTransform"]);const g={supported:!1,testSupport:function(w){!B&&C&&(R?D(w):b=w)}};let b,C,B=!1,R=!1;function D(w){const l=w.createTexture();w.bindTexture(w.TEXTURE_2D,l);try{if(w.texImage2D(w.TEXTURE_2D,0,w.RGBA,w.RGBA,w.UNSIGNED_BYTE,C),w.isContextLost())return;g.supported=!0}catch{}w.deleteTexture(l),B=!0}var Q,k;typeof document<"u"&&(C=document.createElement("img"),C.onload=function(){b&&D(b),b=null,R=!0},C.onerror=function(){B=!0,b=null},C.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(w){let l,d,m,v;w.resetRequestQueue=()=>{l=[],d=0,m=0,v={}},w.addThrottleControl=G=>{const $=m++;return v[$]=G,$},w.removeThrottleControl=G=>{delete v[G],M()},w.getImage=function(G,$){let J=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;g.supported&&(G.headers||(G.headers={}),G.headers.accept="image/webp,*/*");const ct={requestParameters:G,supportImageRefresh:J,callback:$,cancelled:!1,completed:!1,cancel:()=>{ct.completed||ct.cancelled||(ct.cancelled=!0,ct.innerRequest&&(ct.innerRequest.cancel(),d--),M())}};return l.push(ct),M(),ct};const E=G=>{const{requestParameters:$,supportImageRefresh:J,callback:ct}=G;return o.e($,{type:"image"}),(J!==!1||o.i()||o.g($.url)||$.headers&&!Object.keys($.headers).reduce((Ct,y)=>Ct&&y==="accept",!0)?o.m:N)($,(Ct,y,S,I)=>{F(G,ct,Ct,y,S,I)})},F=(G,$,J,ct,Ct,y)=>{J?$(J):ct instanceof HTMLImageElement||o.a(ct)?$(null,ct):ct&&((S,I)=>{typeof createImageBitmap=="function"?o.b(S,I):o.d(S,I)})(ct,(S,I)=>{S!=null?$(S):I!=null&&$(null,I,{cacheControl:Ct,expires:y})}),G.cancelled||(G.completed=!0,d--,M())},M=()=>{const G=(()=>{const $=Object.keys(v);let J=!1;if($.length>0){for(const ct of $)if(J=v[ct](),J)break}return J})()?o.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:o.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let $=d;$<G&&l.length>0;$++){const J=l.shift();if(J.cancelled){$--;continue}const ct=E(J);d++,J.innerRequest=ct}},N=(G,$)=>{const J=new Image,ct=G.url;let Ct=!1;const y=G.credentials;return y&&y==="include"?J.crossOrigin="use-credentials":(y&&y==="same-origin"||!o.s(ct))&&(J.crossOrigin="anonymous"),J.fetchPriority="high",J.onload=()=>{$(null,J),J.onerror=J.onload=null},J.onerror=()=>{Ct||$(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")),J.onerror=J.onload=null},J.src=ct,{cancel:()=>{Ct=!0,J.src=""}}}}(Q||(Q={})),Q.resetRequestQueue(),function(w){w.Glyphs="Glyphs",w.Image="Image",w.Source="Source",w.SpriteImage="SpriteImage",w.SpriteJSON="SpriteJSON",w.Style="Style",w.Tile="Tile",w.Unknown="Unknown"}(k||(k={}));class j{constructor(l){this._transformRequestFn=l}transformRequest(l,d){return this._transformRequestFn&&this._transformRequestFn(l,d)||{url:l}}normalizeSpriteURL(l,d,m){const v=function(E){const F=E.match(et);if(!F)throw new Error(`Unable to parse URL "${E}"`);return{protocol:F[1],authority:F[2],path:F[3]||"/",params:F[4]?F[4].split("&"):[]}}(l);return v.path+=`${d}${m}`,function(E){const F=E.params.length?`?${E.params.join("&")}`:"";return`${E.protocol}://${E.authority}${E.path}${F}`}(v)}setTransformRequest(l){this._transformRequestFn=l}}const et=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function st(w){var l=new o.A(3);return l[0]=w[0],l[1]=w[1],l[2]=w[2],l}var mt,pt=function(w,l,d){return w[0]=l[0]-d[0],w[1]=l[1]-d[1],w[2]=l[2]-d[2],w};mt=new o.A(3),o.A!=Float32Array&&(mt[0]=0,mt[1]=0,mt[2]=0);var yt=function(w){var l=w[0],d=w[1];return l*l+d*d};function ft(w){const l=[];if(typeof w=="string")l.push({id:"default",url:w});else if(w&&w.length>0){const d=[];for(const{id:m,url:v}of w){const E=`${m}${v}`;d.indexOf(E)===-1&&(d.push(E),l.push({id:m,url:v}))}}return l}function Dt(w,l,d,m,v){if(m)return void w(m);if(v!==Object.values(l).length||v!==Object.values(d).length)return;const E={};for(const F in l){E[F]={};const M=o.h.getImageCanvasContext(d[F]),N=l[F];for(const G in N){const{width:$,height:J,x:ct,y:Ct,sdf:y,pixelRatio:S,stretchX:I,stretchY:O,content:V}=N[G];E[F][G]={data:null,pixelRatio:S,sdf:y,stretchX:I,stretchY:O,content:V,spriteData:{width:$,height:J,x:ct,y:Ct,context:M}}}}w(null,E)}(function(){var w=new o.A(2);o.A!=Float32Array&&(w[0]=0,w[1]=0)})();class It{constructor(l,d,m,v){this.context=l,this.format=m,this.texture=l.gl.createTexture(),this.update(d,v)}update(l,d,m){const{width:v,height:E}=l,F=!(this.size&&this.size[0]===v&&this.size[1]===E||m),{context:M}=this,{gl:N}=M;if(this.useMipmap=!!(d&&d.useMipmap),N.bindTexture(N.TEXTURE_2D,this.texture),M.pixelStoreUnpackFlipY.set(!1),M.pixelStoreUnpack.set(1),M.pixelStoreUnpackPremultiplyAlpha.set(this.format===N.RGBA&&(!d||d.premultiply!==!1)),F)this.size=[v,E],l instanceof HTMLImageElement||l instanceof HTMLCanvasElement||l instanceof HTMLVideoElement||l instanceof ImageData||o.a(l)?N.texImage2D(N.TEXTURE_2D,0,this.format,this.format,N.UNSIGNED_BYTE,l):N.texImage2D(N.TEXTURE_2D,0,this.format,v,E,0,this.format,N.UNSIGNED_BYTE,l.data);else{const{x:G,y:$}=m||{x:0,y:0};l instanceof HTMLImageElement||l instanceof HTMLCanvasElement||l instanceof HTMLVideoElement||l instanceof ImageData||o.a(l)?N.texSubImage2D(N.TEXTURE_2D,0,G,$,N.RGBA,N.UNSIGNED_BYTE,l):N.texSubImage2D(N.TEXTURE_2D,0,G,$,v,E,N.RGBA,N.UNSIGNED_BYTE,l.data)}this.useMipmap&&this.isSizePowerOfTwo()&&N.generateMipmap(N.TEXTURE_2D)}bind(l,d,m){const{context:v}=this,{gl:E}=v;E.bindTexture(E.TEXTURE_2D,this.texture),m!==E.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(m=E.LINEAR),l!==this.filter&&(E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MAG_FILTER,l),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MIN_FILTER,m||l),this.filter=l),d!==this.wrap&&(E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_S,d),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_T,d),this.wrap=d)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:l}=this.context;l.deleteTexture(this.texture),this.texture=null}}function ut(w){const{userImage:l}=w;return!!(l&&l.render&&l.render())&&(w.data.replace(new Uint8Array(l.data.buffer)),!0)}class At extends o.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(l){if(this.loaded!==l&&(this.loaded=l,l)){for(const{ids:d,callback:m}of this.requestors)this._notify(d,m);this.requestors=[]}}getImage(l){const d=this.images[l];if(d&&!d.data&&d.spriteData){const m=d.spriteData;d.data=new o.R({width:m.width,height:m.height},m.context.getImageData(m.x,m.y,m.width,m.height).data),d.spriteData=null}return d}addImage(l,d){if(this.images[l])throw new Error(`Image id ${l} already exist, use updateImage instead`);this._validate(l,d)&&(this.images[l]=d)}_validate(l,d){let m=!0;const v=d.data||d.spriteData;return this._validateStretch(d.stretchX,v&&v.width)||(this.fire(new o.j(new Error(`Image "${l}" has invalid "stretchX" value`))),m=!1),this._validateStretch(d.stretchY,v&&v.height)||(this.fire(new o.j(new Error(`Image "${l}" has invalid "stretchY" value`))),m=!1),this._validateContent(d.content,d)||(this.fire(new o.j(new Error(`Image "${l}" has invalid "content" value`))),m=!1),m}_validateStretch(l,d){if(!l)return!0;let m=0;for(const v of l){if(v[0]<m||v[1]<v[0]||d<v[1])return!1;m=v[1]}return!0}_validateContent(l,d){if(!l)return!0;if(l.length!==4)return!1;const m=d.spriteData,v=m&&m.width||d.data.width,E=m&&m.height||d.data.height;return!(l[0]<0||v<l[0]||l[1]<0||E<l[1]||l[2]<0||v<l[2]||l[3]<0||E<l[3]||l[2]<l[0]||l[3]<l[1])}updateImage(l,d){let m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const v=this.getImage(l);if(m&&(v.data.width!==d.data.width||v.data.height!==d.data.height))throw new Error(`size mismatch between old image (${v.data.width}x${v.data.height}) and new image (${d.data.width}x${d.data.height}).`);d.version=v.version+1,this.images[l]=d,this.updatedImages[l]=!0}removeImage(l){const d=this.images[l];delete this.images[l],delete this.patterns[l],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(l,d){let m=!0;if(!this.isLoaded())for(const v of l)this.images[v]||(m=!1);this.isLoaded()||m?this._notify(l,d):this.requestors.push({ids:l,callback:d})}_notify(l,d){const m={};for(const v of l){let E=this.getImage(v);E||(this.fire(new o.k("styleimagemissing",{id:v})),E=this.getImage(v)),E?m[v]={data:E.data.clone(),pixelRatio:E.pixelRatio,sdf:E.sdf,version:E.version,stretchX:E.stretchX,stretchY:E.stretchY,content:E.content,hasRenderCallback:!!(E.userImage&&E.userImage.render)}:o.w(`Image "${v}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}d(null,m)}getPixelSize(){const{width:l,height:d}=this.atlasImage;return{width:l,height:d}}getPattern(l){const d=this.patterns[l],m=this.getImage(l);if(!m)return null;if(d&&d.position.version===m.version)return d.position;if(d)d.position.version=m.version;else{const v={w:m.data.width+2,h:m.data.height+2,x:0,y:0},E=new o.I(v,m);this.patterns[l]={bin:v,position:E}}return this._updatePatternAtlas(),this.patterns[l].position}bind(l){const d=l.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new It(l,this.atlasImage,d.RGBA),this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(){const l=[];for(const E in this.patterns)l.push(this.patterns[E].bin);const{w:d,h:m}=o.p(l),v=this.atlasImage;v.resize({width:d||1,height:m||1});for(const E in this.patterns){const{bin:F}=this.patterns[E],M=F.x+1,N=F.y+1,G=this.getImage(E).data,$=G.width,J=G.height;o.R.copy(G,v,{x:0,y:0},{x:M,y:N},{width:$,height:J}),o.R.copy(G,v,{x:0,y:J-1},{x:M,y:N-1},{width:$,height:1}),o.R.copy(G,v,{x:0,y:0},{x:M,y:N+J},{width:$,height:1}),o.R.copy(G,v,{x:$-1,y:0},{x:M-1,y:N},{width:1,height:J}),o.R.copy(G,v,{x:0,y:0},{x:M+$,y:N},{width:1,height:J})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(l){for(const d of l){if(this.callbackDispatchedThisFrame[d])continue;this.callbackDispatchedThisFrame[d]=!0;const m=this.getImage(d);m||o.w(`Image with ID: "${d}" was not found`),ut(m)&&this.updateImage(d,m)}}}const Bt=1e20;function vt(w,l,d,m,v,E,F,M,N){for(let G=l;G<l+m;G++)ne(w,d*E+G,E,v,F,M,N);for(let G=d;G<d+v;G++)ne(w,G*E+l,1,m,F,M,N)}function ne(w,l,d,m,v,E,F){E[0]=0,F[0]=-Bt,F[1]=Bt,v[0]=w[l];for(let M=1,N=0,G=0;M<m;M++){v[M]=w[l+M*d];const $=M*M;do{const J=E[N];G=(v[M]-v[J]+$-J*J)/(M-J)/2}while(G<=F[N]&&--N>-1);N++,E[N]=M,F[N]=G,F[N+1]=Bt}for(let M=0,N=0;M<m;M++){for(;F[N+1]<M;)N++;const G=E[N],$=M-G;w[l+M*d]=v[G]+$*$}}class ie{constructor(l,d){this.requestManager=l,this.localIdeographFontFamily=d,this.entries={}}setURL(l){this.url=l}getGlyphs(l,d){const m=[];for(const v in l)for(const E of l[v])m.push({stack:v,id:E});o.o(m,(v,E)=>{let{stack:F,id:M}=v,N=this.entries[F];N||(N=this.entries[F]={glyphs:{},requests:{},ranges:{}});let G=N.glyphs[M];if(G!==void 0)return void E(null,{stack:F,id:M,glyph:G});if(G=this._tinySDF(N,F,M),G)return N.glyphs[M]=G,void E(null,{stack:F,id:M,glyph:G});const $=Math.floor(M/256);if(256*$>65535)return void E(new Error("glyphs > 65535 not supported"));if(N.ranges[$])return void E(null,{stack:F,id:M,glyph:G});if(!this.url)return void E(new Error("glyphsUrl is not set"));let J=N.requests[$];J||(J=N.requests[$]=[],ie.loadGlyphRange(F,$,this.url,this.requestManager,(ct,Ct)=>{if(Ct){for(const y in Ct)this._doesCharSupportLocalGlyph(+y)||(N.glyphs[+y]=Ct[+y]);N.ranges[$]=!0}for(const y of J)y(ct,Ct);delete N.requests[$]})),J.push((ct,Ct)=>{ct?E(ct):Ct&&E(null,{stack:F,id:M,glyph:Ct[M]||null})})},(v,E)=>{if(v)d(v);else if(E){const F={};for(const{stack:M,id:N,glyph:G}of E)(F[M]||(F[M]={}))[N]=G&&{id:G.id,bitmap:G.bitmap.clone(),metrics:G.metrics};d(null,F)}})}_doesCharSupportLocalGlyph(l){return!!this.localIdeographFontFamily&&(o.u["CJK Unified Ideographs"](l)||o.u["Hangul Syllables"](l)||o.u.Hiragana(l)||o.u.Katakana(l))}_tinySDF(l,d,m){const v=this.localIdeographFontFamily;if(!v||!this._doesCharSupportLocalGlyph(m))return;let E=l.tinySDF;if(!E){let M="400";/bold/i.test(d)?M="900":/medium/i.test(d)?M="500":/light/i.test(d)&&(M="200"),E=l.tinySDF=new ie.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:v,fontWeight:M})}const F=E.draw(String.fromCharCode(m));return{id:m,bitmap:new o.q({width:F.width||60,height:F.height||60},F.data),metrics:{width:F.glyphWidth/2||24,height:F.glyphHeight/2||24,left:F.glyphLeft/2+.5||0,top:F.glyphTop/2-27.5||-8,advance:F.glyphAdvance/2||24,isDoubleResolution:!0}}}}ie.loadGlyphRange=function(w,l,d,m,v){const E=256*l,F=E+255,M=m.transformRequest(d.replace("{fontstack}",w).replace("{range}",`${E}-${F}`),k.Glyphs);o.l(M,(N,G)=>{if(N)v(N);else if(G){const $={};for(const J of o.n(G))$[J.id]=J;v(null,$)}})},ie.TinySDF=class{constructor(){let{fontSize:w=24,buffer:l=3,radius:d=8,cutoff:m=.25,fontFamily:v="sans-serif",fontWeight:E="normal",fontStyle:F="normal"}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.buffer=l,this.cutoff=m,this.radius=d;const M=this.size=w+4*l,N=this._createCanvas(M),G=this.ctx=N.getContext("2d",{willReadFrequently:!0});G.font=`${F} ${E} ${w}px ${v}`,G.textBaseline="alphabetic",G.textAlign="left",G.fillStyle="black",this.gridOuter=new Float64Array(M*M),this.gridInner=new Float64Array(M*M),this.f=new Float64Array(M),this.z=new Float64Array(M+1),this.v=new Uint16Array(M)}_createCanvas(w){const l=document.createElement("canvas");return l.width=l.height=w,l}draw(w){const{width:l,actualBoundingBoxAscent:d,actualBoundingBoxDescent:m,actualBoundingBoxLeft:v,actualBoundingBoxRight:E}=this.ctx.measureText(w),F=Math.ceil(d),M=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(E-v))),N=Math.min(this.size-this.buffer,F+Math.ceil(m)),G=M+2*this.buffer,$=N+2*this.buffer,J=Math.max(G*$,0),ct=new Uint8ClampedArray(J),Ct={data:ct,width:G,height:$,glyphWidth:M,glyphHeight:N,glyphTop:F,glyphLeft:0,glyphAdvance:l};if(M===0||N===0)return Ct;const{ctx:y,buffer:S,gridInner:I,gridOuter:O}=this;y.clearRect(S,S,M,N),y.fillText(w,S,S+F);const V=y.getImageData(S,S,M,N);O.fill(Bt,0,J),I.fill(0,0,J);for(let H=0;H<N;H++)for(let q=0;q<M;q++){const X=V.data[4*(H*M+q)+3]/255;if(X===0)continue;const Z=(H+S)*G+q+S;if(X===1)O[Z]=0,I[Z]=Bt;else{const ot=.5-X;O[Z]=ot>0?ot*ot:0,I[Z]=ot<0?ot*ot:0}}vt(O,0,0,G,$,G,this.f,this.v,this.z),vt(I,S,S,M,N,G,this.f,this.v,this.z);for(let H=0;H<J;H++){const q=Math.sqrt(O[H])-Math.sqrt(I[H]);ct[H]=Math.round(255-255*(q/this.radius+this.cutoff))}return Ct}};class ae{constructor(){this.specification=o.v.light.position}possiblyEvaluate(l,d){return o.z(l.expression.evaluate(d))}interpolate(l,d,m){return{x:o.B.number(l.x,d.x,m),y:o.B.number(l.y,d.y,m),z:o.B.number(l.z,d.z,m)}}}let te;class ce extends o.E{constructor(l){super(),te=te||new o.r({anchor:new o.D(o.v.light.anchor),position:new ae,color:new o.D(o.v.light.color),intensity:new o.D(o.v.light.intensity)}),this._transitionable=new o.T(te),this.setLight(l),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(l){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!this._validate(o.t,l,d))for(const m in l){const v=l[m];m.endsWith("-transition")?this._transitionable.setTransition(m.slice(0,-11),v):this._transitionable.setValue(m,v)}}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,d,m){return(!m||m.validate!==!1)&&o.x(this,l.call(o.y,o.e({value:d,style:{glyphs:!0,sprite:!0},styleSpec:o.v})))}}class le{constructor(l,d){this.width=l,this.height=d,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(l,d){const m=l.join(",")+String(d);return this.dashEntry[m]||(this.dashEntry[m]=this.addDash(l,d)),this.dashEntry[m]}getDashRanges(l,d,m){const v=[];let E=l.length%2==1?-l[l.length-1]*m:0,F=l[0]*m,M=!0;v.push({left:E,right:F,isDash:M,zeroLength:l[0]===0});let N=l[0];for(let G=1;G<l.length;G++){M=!M;const $=l[G];E=N*m,N+=$,F=N*m,v.push({left:E,right:F,isDash:M,zeroLength:$===0})}return v}addRoundDash(l,d,m){const v=d/2;for(let E=-m;E<=m;E++){const F=this.width*(this.nextRow+m+E);let M=0,N=l[M];for(let G=0;G<this.width;G++){G/N.right>1&&(N=l[++M]);const $=Math.abs(G-N.left),J=Math.abs(G-N.right),ct=Math.min($,J);let Ct;const y=E/m*(v+1);if(N.isDash){const S=v-Math.abs(y);Ct=Math.sqrt(ct*ct+S*S)}else Ct=v-Math.sqrt(ct*ct+y*y);this.data[F+G]=Math.max(0,Math.min(255,Ct+128))}}}addRegularDash(l){for(let M=l.length-1;M>=0;--M){const N=l[M],G=l[M+1];N.zeroLength?l.splice(M,1):G&&G.isDash===N.isDash&&(G.left=N.left,l.splice(M,1))}const d=l[0],m=l[l.length-1];d.isDash===m.isDash&&(d.left=m.left-this.width,m.right=d.right+this.width);const v=this.width*this.nextRow;let E=0,F=l[E];for(let M=0;M<this.width;M++){M/F.right>1&&(F=l[++E]);const N=Math.abs(M-F.left),G=Math.abs(M-F.right),$=Math.min(N,G);this.data[v+M]=Math.max(0,Math.min(255,(F.isDash?$:-$)+128))}}addDash(l,d){const m=d?7:0,v=2*m+1;if(this.nextRow+v>this.height)return o.w("LineAtlas out of space"),null;let E=0;for(let M=0;M<l.length;M++)E+=l[M];if(E!==0){const M=this.width/E,N=this.getDashRanges(l,this.width,M);d?this.addRoundDash(N,M,m):this.addRegularDash(N)}const F={y:(this.nextRow+m+.5)/this.height,height:2*m/this.height,width:E};return this.nextRow+=v,this.dirty=!0,F}bind(l){const d=l.gl;this.texture?(d.bindTexture(d.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,d.texSubImage2D(d.TEXTURE_2D,0,0,0,this.width,this.height,d.ALPHA,d.UNSIGNED_BYTE,this.data))):(this.texture=d.createTexture(),d.bindTexture(d.TEXTURE_2D,this.texture),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texImage2D(d.TEXTURE_2D,0,d.ALPHA,this.width,this.height,0,d.ALPHA,d.UNSIGNED_BYTE,this.data))}}class Te{constructor(l,d,m){this.workerPool=l,this.actors=[],this.currentActor=0,this.id=m;const v=this.workerPool.acquire(m);for(let E=0;E<v.length;E++){const F=new o.C(v[E],d,m);F.name=`Worker ${E}`,this.actors.push(F)}if(!this.actors.length)throw new Error("No actors found")}broadcast(l,d,m){o.o(this.actors,(v,E)=>{v.send(l,d,E)},m=m||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.actors.forEach(d=>{d.remove()}),this.actors=[],l&&this.workerPool.release(this.id)}}function rt(w,l,d){const m=function(v,E){if(v)return d(v);if(E){const F=o.F(o.e(E,w),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);E.vector_layers&&(F.vectorLayers=E.vector_layers,F.vectorLayerIds=F.vectorLayers.map(M=>M.id)),d(null,F)}};return w.url?o.f(l.transformRequest(w.url,k.Source),m):o.h.frame(()=>m(null,w))}class wt{constructor(l,d){l&&(d?this.setSouthWest(l).setNorthEast(d):Array.isArray(l)&&(l.length===4?this.setSouthWest([l[0],l[1]]).setNorthEast([l[2],l[3]]):this.setSouthWest(l[0]).setNorthEast(l[1])))}setNorthEast(l){return this._ne=l instanceof o.L?new o.L(l.lng,l.lat):o.L.convert(l),this}setSouthWest(l){return this._sw=l instanceof o.L?new o.L(l.lng,l.lat):o.L.convert(l),this}extend(l){const d=this._sw,m=this._ne;let v,E;if(l instanceof o.L)v=l,E=l;else{if(!(l instanceof wt))return Array.isArray(l)?l.length===4||l.every(Array.isArray)?this.extend(wt.convert(l)):this.extend(o.L.convert(l)):l&&("lng"in l||"lon"in l)&&"lat"in l?this.extend(o.L.convert(l)):this;if(v=l._sw,E=l._ne,!v||!E)return this}return d||m?(d.lng=Math.min(v.lng,d.lng),d.lat=Math.min(v.lat,d.lat),m.lng=Math.max(E.lng,m.lng),m.lat=Math.max(E.lat,m.lat)):(this._sw=new o.L(v.lng,v.lat),this._ne=new o.L(E.lng,E.lat)),this}getCenter(){return new o.L((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new o.L(this.getWest(),this.getNorth())}getSouthEast(){return new o.L(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(l){const{lng:d,lat:m}=o.L.convert(l);let v=this._sw.lng<=d&&d<=this._ne.lng;return this._sw.lng>this._ne.lng&&(v=this._sw.lng>=d&&d>=this._ne.lng),this._sw.lat<=m&&m<=this._ne.lat&&v}static convert(l){return l instanceof wt?l:l&&new wt(l)}static fromLngLat(l){const m=360*(arguments.length>1&&arguments[1]!==void 0?arguments[1]:0)/40075017,v=m/Math.cos(Math.PI/180*l.lat);return new wt(new o.L(l.lng-v,l.lat-m),new o.L(l.lng+v,l.lat+m))}}class St{constructor(l,d,m){this.bounds=wt.convert(this.validateBounds(l)),this.minzoom=d||0,this.maxzoom=m||24}validateBounds(l){return Array.isArray(l)&&l.length===4?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]}contains(l){const d=Math.pow(2,l.z),m=Math.floor(o.G(this.bounds.getWest())*d),v=Math.floor(o.H(this.bounds.getNorth())*d),E=Math.ceil(o.G(this.bounds.getEast())*d),F=Math.ceil(o.H(this.bounds.getSouth())*d);return l.x>=m&&l.x<E&&l.y>=v&&l.y<F}}class qt extends o.E{constructor(l,d,m,v){if(super(),this.load=()=>{this._loaded=!1,this.fire(new o.k("dataloading",{dataType:"source"})),this._tileJSONRequest=rt(this._options,this.map._requestManager,(E,F)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),E?this.fire(new o.j(E)):F&&(o.e(this,F),F.bounds&&(this.tileBounds=new St(F.bounds,this.minzoom,this.maxzoom)),this.fire(new o.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.k("data",{dataType:"source",sourceDataType:"content"})))})},this.serialize=()=>o.e({},this._options),this.id=l,this.dispatcher=m,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.e(this,o.F(d,["url","scheme","tileSize","promoteId"])),this._options=o.e({type:"vector"},d),this._collectResourceTiming=d.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(v)}loaded(){return this._loaded}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}onAdd(l){this.map=l,this.load()}setSourceProperty(l){this._tileJSONRequest&&this._tileJSONRequest.cancel(),l(),this.load()}setTiles(l){return this.setSourceProperty(()=>{this._options.tiles=l}),this}setUrl(l){return this.setSourceProperty(()=>{this.url=l,this._options.url=l}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}loadTile(l,d){const m=l.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),v={request:this.map._requestManager.transformRequest(m,k.Tile),uid:l.uid,tileID:l.tileID,zoom:l.tileID.overscaledZ,tileSize:this.tileSize*l.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function E(F,M){return delete l.request,l.aborted?d(null):F&&F.status!==404?d(F):(M&&M.resourceTiming&&(l.resourceTiming=M.resourceTiming),this.map._refreshExpiredTiles&&M&&l.setExpiryData(M),l.loadVectorData(M,this.map.painter),d(null),void(l.reloadCallback&&(this.loadTile(l,l.reloadCallback),l.reloadCallback=null)))}v.request.collectResourceTiming=this._collectResourceTiming,l.actor&&l.state!=="expired"?l.state==="loading"?l.reloadCallback=d:l.request=l.actor.send("reloadTile",v,E.bind(this)):(l.actor=this.dispatcher.getActor(),l.request=l.actor.send("loadTile",v,E.bind(this)))}abortTile(l){l.request&&(l.request.cancel(),delete l.request),l.actor&&l.actor.send("abortTile",{uid:l.uid,type:this.type,source:this.id},void 0)}unloadTile(l){l.unloadVectorData(),l.actor&&l.actor.send("removeTile",{uid:l.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class Jt extends o.E{constructor(l,d,m,v){super(),this.id=l,this.dispatcher=m,this.setEventedParent(v),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.e({type:"raster"},d),o.e(this,o.F(d,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new o.k("dataloading",{dataType:"source"})),this._tileJSONRequest=rt(this._options,this.map._requestManager,(l,d)=>{this._tileJSONRequest=null,this._loaded=!0,l?this.fire(new o.j(l)):d&&(o.e(this,d),d.bounds&&(this.tileBounds=new St(d.bounds,this.minzoom,this.maxzoom)),this.fire(new o.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.k("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(l){this.map=l,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}setSourceProperty(l){this._tileJSONRequest&&this._tileJSONRequest.cancel(),l(),this.load()}setTiles(l){return this.setSourceProperty(()=>{this._options.tiles=l}),this}serialize(){return o.e({},this._options)}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}loadTile(l,d){const m=l.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);l.request=Q.getImage(this.map._requestManager.transformRequest(m,k.Tile),(v,E,F)=>{if(delete l.request,l.aborted)l.state="unloaded",d(null);else if(v)l.state="errored",d(v);else if(E){this.map._refreshExpiredTiles&&F&&l.setExpiryData(F);const M=this.map.painter.context,N=M.gl;l.texture=this.map.painter.getTileTexture(E.width),l.texture?l.texture.update(E,{useMipmap:!0}):(l.texture=new It(M,E,N.RGBA,{useMipmap:!0}),l.texture.bind(N.LINEAR,N.CLAMP_TO_EDGE,N.LINEAR_MIPMAP_NEAREST),M.extTextureFilterAnisotropic&&N.texParameterf(N.TEXTURE_2D,M.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,M.extTextureFilterAnisotropicMax)),l.state="loaded",d(null)}},this.map._refreshExpiredTiles)}abortTile(l,d){l.request&&(l.request.cancel(),delete l.request),d()}unloadTile(l,d){l.texture&&this.map.painter.saveTileTexture(l.texture),d()}hasTransition(){return!1}}class se extends Jt{constructor(l,d,m,v){super(l,d,m,v),this.type="raster-dem",this.maxzoom=22,this._options=o.e({type:"raster-dem"},d),this.encoding=d.encoding||"mapbox",this.redFactor=d.redFactor,this.greenFactor=d.greenFactor,this.blueFactor=d.blueFactor,this.baseShift=d.baseShift}loadTile(l,d){const m=l.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),v=this.map._requestManager.transformRequest(m,k.Tile);function E(F,M){F&&(l.state="errored",d(F)),M&&(l.dem=M,l.needsHillshadePrepare=!0,l.needsTerrainPrepare=!0,l.state="loaded",d(null))}l.neighboringTiles=this._getNeighboringTiles(l.tileID),l.request=Q.getImage(v,(F,M,N)=>o._(this,void 0,void 0,function*(){if(delete l.request,l.aborted)l.state="unloaded",d(null);else if(F)l.state="errored",d(F);else if(M){this.map._refreshExpiredTiles&&l.setExpiryData(N);const G=o.a(M)&&o.J()?M:yield function(J){return o._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&o.K()){const ct=J.width+2,Ct=J.height+2;try{return new o.R({width:ct,height:Ct},yield o.M(J,-1,-1,ct,Ct))}catch{}}return o.h.getImageData(J,1)})}(M),$={uid:l.uid,coord:l.tileID,source:this.id,rawImageData:G,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};l.actor&&l.state!=="expired"||(l.actor=this.dispatcher.getActor(),l.actor.send("loadDEMTile",$,E))}}),this.map._refreshExpiredTiles)}_getNeighboringTiles(l){const d=l.canonical,m=Math.pow(2,d.z),v=(d.x-1+m)%m,E=d.x===0?l.wrap-1:l.wrap,F=(d.x+1+m)%m,M=d.x+1===m?l.wrap+1:l.wrap,N={};return N[new o.O(l.overscaledZ,E,d.z,v,d.y).key]={backfilled:!1},N[new o.O(l.overscaledZ,M,d.z,F,d.y).key]={backfilled:!1},d.y>0&&(N[new o.O(l.overscaledZ,E,d.z,v,d.y-1).key]={backfilled:!1},N[new o.O(l.overscaledZ,l.wrap,d.z,d.x,d.y-1).key]={backfilled:!1},N[new o.O(l.overscaledZ,M,d.z,F,d.y-1).key]={backfilled:!1}),d.y+1<m&&(N[new o.O(l.overscaledZ,E,d.z,v,d.y+1).key]={backfilled:!1},N[new o.O(l.overscaledZ,l.wrap,d.z,d.x,d.y+1).key]={backfilled:!1},N[new o.O(l.overscaledZ,M,d.z,F,d.y+1).key]={backfilled:!1}),N}unloadTile(l){l.demTexture&&this.map.painter.saveTileTexture(l.demTexture),l.fbo&&(l.fbo.destroy(),delete l.fbo),l.dem&&delete l.dem,delete l.neighboringTiles,l.state="unloaded",l.actor&&l.actor.send("removeDEMTile",{uid:l.uid,source:this.id})}}class Ae extends o.E{constructor(l,d,m,v){super(),this.load=()=>{this._updateWorkerData()},this.serialize=()=>o.e({},this._options,{type:this.type,data:this._data}),this.id=l,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=m.getActor(),this.setEventedParent(v),this._data=d.data,this._options=o.e({},d),this._collectResourceTiming=d.collectResourceTiming,d.maxzoom!==void 0&&(this.maxzoom=d.maxzoom),d.type&&(this.type=d.type),d.attribution&&(this.attribution=d.attribution),this.promoteId=d.promoteId;const E=o.N/this.tileSize;this.workerOptions=o.e({source:this.id,cluster:d.cluster||!1,geojsonVtOptions:{buffer:(d.buffer!==void 0?d.buffer:128)*E,tolerance:(d.tolerance!==void 0?d.tolerance:.375)*E,extent:o.N,maxZoom:this.maxzoom,lineMetrics:d.lineMetrics||!1,generateId:d.generateId||!1},superclusterOptions:{maxZoom:d.clusterMaxZoom!==void 0?d.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,d.clusterMinPoints||2),extent:o.N,radius:(d.clusterRadius||50)*E,log:!1,generateId:d.generateId||!1},clusterProperties:d.clusterProperties,filter:d.filter},d.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}onAdd(l){this.map=l,this.load()}setData(l){return this._data=l,this._updateWorkerData(),this}updateData(l){return this._updateWorkerData(l),this}setClusterOptions(l){return this.workerOptions.cluster=l.cluster,l&&(l.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=l.clusterRadius),l.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=l.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(l,d){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:l,source:this.id},d),this}getClusterChildren(l,d){return this.actor.send("geojson.getClusterChildren",{clusterId:l,source:this.id},d),this}getClusterLeaves(l,d,m,v){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:l,limit:d,offset:m},v),this}_updateWorkerData(l){const d=o.e({},this.workerOptions);l?d.dataDiff=l:typeof this._data=="string"?(d.request=this.map._requestManager.transformRequest(o.h.resolveURL(this._data),k.Source),d.request.collectResourceTiming=this._collectResourceTiming):d.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new o.k("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,d,(m,v)=>{if(this._pendingLoads--,this._removed||v&&v.abandoned)return void this.fire(new o.k("dataabort",{dataType:"source"}));let E=null;if(v&&v.resourceTiming&&v.resourceTiming[this.id]&&(E=v.resourceTiming[this.id].slice(0)),m)return void this.fire(new o.j(m));const F={dataType:"source"};this._collectResourceTiming&&E&&E.length>0&&o.e(F,{resourceTiming:E}),this.fire(new o.k("data",Object.assign(Object.assign({},F),{sourceDataType:"metadata"}))),this.fire(new o.k("data",Object.assign(Object.assign({},F),{sourceDataType:"content"})))})}loaded(){return this._pendingLoads===0}loadTile(l,d){const m=l.actor?"reloadTile":"loadTile";l.actor=this.actor;const v={type:this.type,uid:l.uid,tileID:l.tileID,zoom:l.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};l.request=this.actor.send(m,v,(E,F)=>(delete l.request,l.unloadVectorData(),l.aborted?d(null):E?d(E):(l.loadVectorData(F,this.map.painter,m==="reloadTile"),d(null))))}abortTile(l){l.request&&(l.request.cancel(),delete l.request),l.aborted=!0}unloadTile(l){l.unloadVectorData(),this.actor.send("removeTile",{uid:l.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}hasTransition(){return!1}}var oe=o.Q([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Ce extends o.E{constructor(l,d,m,v){super(),this.load=(E,F)=>{this._loaded=!1,this.fire(new o.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=Q.getImage(this.map._requestManager.transformRequest(this.url,k.Image),(M,N)=>{this._request=null,this._loaded=!0,M?this.fire(new o.j(M)):N&&(this.image=N,E&&(this.coordinates=E),F&&F(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||!this.image)return;const E=this.map.painter.context,F=E.gl;this.boundsBuffer||(this.boundsBuffer=E.createVertexBuffer(this._boundsArray,oe.members)),this.boundsSegments||(this.boundsSegments=o.S.simpleSegment(0,0,4,2)),this.texture||(this.texture=new It(E,this.image,F.RGBA),this.texture.bind(F.LINEAR,F.CLAMP_TO_EDGE));let M=!1;for(const N in this.tiles){const G=this.tiles[N];G.state!=="loaded"&&(G.state="loaded",G.texture=this.texture,M=!0)}M&&this.fire(new o.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"image",url:this.options.url,coordinates:this.coordinates}),this.id=l,this.dispatcher=m,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(v),this.options=d}loaded(){return this._loaded}updateImage(l){return l.url?(this._request&&(this._request.cancel(),this._request=null),this.options.url=l.url,this.load(l.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(l){this.map=l,this.load()}onRemove(){this._request&&(this._request.cancel(),this._request=null)}setCoordinates(l){this.coordinates=l;const d=l.map(o.U.fromLngLat);this.tileID=function(v){let E=1/0,F=1/0,M=-1/0,N=-1/0;for(const ct of v)E=Math.min(E,ct.x),F=Math.min(F,ct.y),M=Math.max(M,ct.x),N=Math.max(N,ct.y);const G=Math.max(M-E,N-F),$=Math.max(0,Math.floor(-Math.log(G)/Math.LN2)),J=Math.pow(2,$);return new o.W($,Math.floor((E+M)/2*J),Math.floor((F+N)/2*J))}(d),this.minzoom=this.maxzoom=this.tileID.z;const m=d.map(v=>this.tileID.getTilePoint(v)._round());return this._boundsArray=new o.V,this._boundsArray.emplaceBack(m[0].x,m[0].y,0,0),this._boundsArray.emplaceBack(m[1].x,m[1].y,o.N,0),this._boundsArray.emplaceBack(m[3].x,m[3].y,0,o.N),this._boundsArray.emplaceBack(m[2].x,m[2].y,o.N,o.N),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new o.k("data",{dataType:"source",sourceDataType:"content"})),this}loadTile(l,d){this.tileID&&this.tileID.equals(l.tileID.canonical)?(this.tiles[String(l.tileID.wrap)]=l,l.buckets={},d(null)):(l.state="errored",d(null))}hasTransition(){return!1}}class Pe extends Ce{constructor(l,d,m,v){super(l,d,m,v),this.load=()=>{this._loaded=!1;const E=this.options;this.urls=[];for(const F of E.urls)this.urls.push(this.map._requestManager.transformRequest(F,k.Source).url);o.X(this.urls,(F,M)=>{this._loaded=!0,F?this.fire(new o.j(F)):M&&(this.video=M,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const E=this.map.painter.context,F=E.gl;this.boundsBuffer||(this.boundsBuffer=E.createVertexBuffer(this._boundsArray,oe.members)),this.boundsSegments||(this.boundsSegments=o.S.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(F.LINEAR,F.CLAMP_TO_EDGE),F.texSubImage2D(F.TEXTURE_2D,0,0,0,F.RGBA,F.UNSIGNED_BYTE,this.video)):(this.texture=new It(E,this.video,F.RGBA),this.texture.bind(F.LINEAR,F.CLAMP_TO_EDGE));let M=!1;for(const N in this.tiles){const G=this.tiles[N];G.state!=="loaded"&&(G.state="loaded",G.texture=this.texture,M=!0)}M&&this.fire(new o.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"video",urls:this.urls,coordinates:this.coordinates}),this.roundZoom=!0,this.type="video",this.options=d}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(l){if(this.video){const d=this.video.seekable;l<d.start(0)||l>d.end(0)?this.fire(new o.j(new o.Y(`sources.${this.id}`,null,`Playback for this video can be set only between the ${d.start(0)} and ${d.end(0)}-second mark.`))):this.video.currentTime=l}}getVideo(){return this.video}onAdd(l){this.map||(this.map=l,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}hasTransition(){return this.video&&!this.video.paused}}class Ve extends Ce{constructor(l,d,m,v){super(l,d,m,v),this.load=()=>{this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},this.prepare=()=>{let E=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,E=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,E=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const F=this.map.painter.context,M=F.gl;this.boundsBuffer||(this.boundsBuffer=F.createVertexBuffer(this._boundsArray,oe.members)),this.boundsSegments||(this.boundsSegments=o.S.simpleSegment(0,0,4,2)),this.texture?(E||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new It(F,this.canvas,M.RGBA,{premultiply:!0});let N=!1;for(const G in this.tiles){const $=this.tiles[G];$.state!=="loaded"&&($.state="loaded",$.texture=this.texture,N=!0)}N&&this.fire(new o.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"canvas",coordinates:this.coordinates}),d.coordinates?Array.isArray(d.coordinates)&&d.coordinates.length===4&&!d.coordinates.some(E=>!Array.isArray(E)||E.length!==2||E.some(F=>typeof F!="number"))||this.fire(new o.j(new o.Y(`sources.${l}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.j(new o.Y(`sources.${l}`,null,'missing required property "coordinates"'))),d.animate&&typeof d.animate!="boolean"&&this.fire(new o.j(new o.Y(`sources.${l}`,null,'optional "animate" property must be a boolean value'))),d.canvas?typeof d.canvas=="string"||d.canvas instanceof HTMLCanvasElement||this.fire(new o.j(new o.Y(`sources.${l}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.j(new o.Y(`sources.${l}`,null,'missing required property "canvas"'))),this.options=d,this.animate=d.animate===void 0||d.animate}getCanvas(){return this.canvas}onAdd(l){this.map=l,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const l of[this.canvas.width,this.canvas.height])if(isNaN(l)||l<=0)return!0;return!1}}const Ke={},rr=w=>{switch(w){case"geojson":return Ae;case"image":return Ce;case"raster":return Jt;case"raster-dem":return se;case"vector":return qt;case"video":return Pe;case"canvas":return Ve}return Ke[w]};function _e(w,l){const d=o.Z();return o.$(d,d,[1,1,0]),o.a0(d,d,[.5*w.width,.5*w.height,1]),o.a1(d,d,w.calculatePosMatrix(l.toUnwrapped()))}function Ut(w,l,d,m,v,E){const F=function(J,ct,Ct){if(J)for(const y of J){const S=ct[y];if(S&&S.source===Ct&&S.type==="fill-extrusion")return!0}else for(const y in ct){const S=ct[y];if(S.source===Ct&&S.type==="fill-extrusion")return!0}return!1}(v&&v.layers,l,w.id),M=E.maxPitchScaleFactor(),N=w.tilesIn(m,M,F);N.sort(pr);const G=[];for(const J of N)G.push({wrappedTileID:J.tileID.wrapped().key,queryResults:J.tile.queryRenderedFeatures(l,d,w._state,J.queryGeometry,J.cameraQueryGeometry,J.scale,v,E,M,_e(w.transform,J.tileID))});const $=function(J){const ct={},Ct={};for(const y of J){const S=y.queryResults,I=y.wrappedTileID,O=Ct[I]=Ct[I]||{};for(const V in S){const H=S[V],q=O[V]=O[V]||{},X=ct[V]=ct[V]||[];for(const Z of H)q[Z.featureIndex]||(q[Z.featureIndex]=!0,X.push(Z))}}return ct}(G);for(const J in $)$[J].forEach(ct=>{const Ct=ct.feature,y=w.getFeatureState(Ct.layer["source-layer"],Ct.id);Ct.source=Ct.layer.source,Ct.layer["source-layer"]&&(Ct.sourceLayer=Ct.layer["source-layer"]),Ct.state=y});return $}function pr(w,l){const d=w.tileID,m=l.tileID;return d.overscaledZ-m.overscaledZ||d.canonical.y-m.canonical.y||d.wrap-m.wrap||d.canonical.x-m.canonical.x}class ir{constructor(l,d){this.timeAdded=0,this.fadeEndTime=0,this.tileID=l,this.uid=o.a2(),this.uses=0,this.tileSize=d,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(l){const d=l+this.timeAdded;d<this.fadeEndTime||(this.fadeEndTime=d)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(l){this.demTexture&&l.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(l,d,m){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",l){l.featureIndex&&(this.latestFeatureIndex=l.featureIndex,l.rawTileData?(this.latestRawTileData=l.rawTileData,this.latestFeatureIndex.rawTileData=l.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=l.collisionBoxArray,this.buckets=function(v,E){const F={};if(!E)return F;for(const M of v){const N=M.layerIds.map(G=>E.getLayer(G)).filter(Boolean);if(N.length!==0){M.layers=N,M.stateDependentLayerIds&&(M.stateDependentLayers=M.stateDependentLayerIds.map(G=>N.filter($=>$.id===G)[0]));for(const G of N)F[G.id]=M}}return F}(l.buckets,d.style),this.hasSymbolBuckets=!1;for(const v in this.buckets){const E=this.buckets[v];if(E instanceof o.a4){if(this.hasSymbolBuckets=!0,!m)break;E.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const v in this.buckets){const E=this.buckets[v];if(E instanceof o.a4&&E.hasRTLText){this.hasRTLText=!0,o.a5();break}}this.queryPadding=0;for(const v in this.buckets){const E=this.buckets[v];this.queryPadding=Math.max(this.queryPadding,d.style.getLayer(v).queryRadius(E))}l.imageAtlas&&(this.imageAtlas=l.imageAtlas),l.glyphAtlasImage&&(this.glyphAtlasImage=l.glyphAtlasImage)}else this.collisionBoxArray=new o.a3}unloadVectorData(){for(const l in this.buckets)this.buckets[l].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(l){return this.buckets[l.id]}upload(l){for(const m in this.buckets){const v=this.buckets[m];v.uploadPending()&&v.upload(l)}const d=l.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new It(l,this.imageAtlas.image,d.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new It(l,this.glyphAtlasImage,d.ALPHA),this.glyphAtlasImage=null)}prepare(l){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(l,this.imageAtlasTexture)}queryRenderedFeatures(l,d,m,v,E,F,M,N,G,$){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:v,cameraQueryGeometry:E,scale:F,tileSize:this.tileSize,pixelPosMatrix:$,transform:N,params:M,queryPadding:this.queryPadding*G},l,d,m):{}}querySourceFeatures(l,d){const m=this.latestFeatureIndex;if(!m||!m.rawTileData)return;const v=m.loadVTLayers(),E=d&&d.sourceLayer?d.sourceLayer:"",F=v._geojsonTileLayer||v[E];if(!F)return;const M=o.a6(d&&d.filter),{z:N,x:G,y:$}=this.tileID.canonical,J={z:N,x:G,y:$};for(let ct=0;ct<F.length;ct++){const Ct=F.feature(ct);if(M.needGeometry){const I=o.a7(Ct,!0);if(!M.filter(new o.a8(this.tileID.overscaledZ),I,this.tileID.canonical))continue}else if(!M.filter(new o.a8(this.tileID.overscaledZ),Ct))continue;const y=m.getId(Ct,E),S=new o.a9(Ct,N,G,$,y);S.tile=J,l.push(S)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(l){const d=this.expirationTime;if(l.cacheControl){const m=o.aa(l.cacheControl);m["max-age"]&&(this.expirationTime=Date.now()+1e3*m["max-age"])}else l.expires&&(this.expirationTime=new Date(l.expires).getTime());if(this.expirationTime){const m=Date.now();let v=!1;if(this.expirationTime>m)v=!1;else if(d)if(this.expirationTime<d)v=!0;else{const E=this.expirationTime-d;E?this.expirationTime=m+Math.max(E,3e4):v=!0}else v=!0;v?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(l,d){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(l).length===0)return;const m=this.latestFeatureIndex.loadVTLayers();for(const v in this.buckets){if(!d.style.hasLayer(v))continue;const E=this.buckets[v],F=E.layers[0].sourceLayer||"_geojsonTileLayer",M=m[F],N=l[F];if(!M||!N||Object.keys(N).length===0)continue;E.update(N,M,this.imageAtlas&&this.imageAtlas.patternPositions||{});const G=d&&d.style&&d.style.getLayer(v);G&&(this.queryPadding=Math.max(this.queryPadding,G.queryRadius(E)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<o.h.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(l){this.symbolFadeHoldUntil=o.h.now()+l}setDependencies(l,d){const m={};for(const v of d)m[v]=!0;this.dependencies[l]=m}hasDependency(l,d){for(const m of l){const v=this.dependencies[m];if(v){for(const E of d)if(v[E])return!0}}return!1}}class Se{constructor(l,d){this.max=l,this.onRemove=d,this.reset()}reset(){for(const l in this.data)for(const d of this.data[l])d.timeout&&clearTimeout(d.timeout),this.onRemove(d.value);return this.data={},this.order=[],this}add(l,d,m){const v=l.wrapped().key;this.data[v]===void 0&&(this.data[v]=[]);const E={value:d,timeout:void 0};if(m!==void 0&&(E.timeout=setTimeout(()=>{this.remove(l,E)},m)),this.data[v].push(E),this.order.push(v),this.order.length>this.max){const F=this._getAndRemoveByKey(this.order[0]);F&&this.onRemove(F)}return this}has(l){return l.wrapped().key in this.data}getAndRemove(l){return this.has(l)?this._getAndRemoveByKey(l.wrapped().key):null}_getAndRemoveByKey(l){const d=this.data[l].shift();return d.timeout&&clearTimeout(d.timeout),this.data[l].length===0&&delete this.data[l],this.order.splice(this.order.indexOf(l),1),d.value}getByKey(l){const d=this.data[l];return d?d[0].value:null}get(l){return this.has(l)?this.data[l.wrapped().key][0].value:null}remove(l,d){if(!this.has(l))return this;const m=l.wrapped().key,v=d===void 0?0:this.data[m].indexOf(d),E=this.data[m][v];return this.data[m].splice(v,1),E.timeout&&clearTimeout(E.timeout),this.data[m].length===0&&delete this.data[m],this.onRemove(E.value),this.order.splice(this.order.indexOf(m),1),this}setMaxSize(l){for(this.max=l;this.order.length>this.max;){const d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this}filter(l){const d=[];for(const m in this.data)for(const v of this.data[m])l(v.value)||d.push(v);for(const m of d)this.remove(m.value.tileID,m)}}class Kt{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(l,d,m){const v=String(d);if(this.stateChanges[l]=this.stateChanges[l]||{},this.stateChanges[l][v]=this.stateChanges[l][v]||{},o.e(this.stateChanges[l][v],m),this.deletedStates[l]===null){this.deletedStates[l]={};for(const E in this.state[l])E!==v&&(this.deletedStates[l][E]=null)}else if(this.deletedStates[l]&&this.deletedStates[l][v]===null){this.deletedStates[l][v]={};for(const E in this.state[l][v])m[E]||(this.deletedStates[l][v][E]=null)}else for(const E in m)this.deletedStates[l]&&this.deletedStates[l][v]&&this.deletedStates[l][v][E]===null&&delete this.deletedStates[l][v][E]}removeFeatureState(l,d,m){if(this.deletedStates[l]===null)return;const v=String(d);if(this.deletedStates[l]=this.deletedStates[l]||{},m&&d!==void 0)this.deletedStates[l][v]!==null&&(this.deletedStates[l][v]=this.deletedStates[l][v]||{},this.deletedStates[l][v][m]=null);else if(d!==void 0)if(this.stateChanges[l]&&this.stateChanges[l][v])for(m in this.deletedStates[l][v]={},this.stateChanges[l][v])this.deletedStates[l][v][m]=null;else this.deletedStates[l][v]=null;else this.deletedStates[l]=null}getState(l,d){const m=String(d),v=o.e({},(this.state[l]||{})[m],(this.stateChanges[l]||{})[m]);if(this.deletedStates[l]===null)return{};if(this.deletedStates[l]){const E=this.deletedStates[l][d];if(E===null)return{};for(const F in E)delete v[F]}return v}initializeTileState(l,d){l.setFeatureState(this.state,d)}coalesceChanges(l,d){const m={};for(const v in this.stateChanges){this.state[v]=this.state[v]||{};const E={};for(const F in this.stateChanges[v])this.state[v][F]||(this.state[v][F]={}),o.e(this.state[v][F],this.stateChanges[v][F]),E[F]=this.state[v][F];m[v]=E}for(const v in this.deletedStates){this.state[v]=this.state[v]||{};const E={};if(this.deletedStates[v]===null)for(const F in this.state[v])E[F]={},this.state[v][F]={};else for(const F in this.deletedStates[v]){if(this.deletedStates[v][F]===null)this.state[v][F]={};else for(const M of Object.keys(this.deletedStates[v][F]))delete this.state[v][F][M];E[F]=this.state[v][F]}m[v]=m[v]||{},o.e(m[v],E)}if(this.stateChanges={},this.deletedStates={},Object.keys(m).length!==0)for(const v in l)l[v].setFeatureState(m,d)}}class Ie extends o.E{constructor(l,d,m){super(),this.id=l,this.dispatcher=m,this.on("data",v=>{v.dataType==="source"&&v.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&v.dataType==="source"&&v.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((v,E,F,M)=>{const N=new(rr(E.type))(v,E,F,M);if(N.id!==v)throw new Error(`Expected Source id to be ${v} instead of ${N.id}`);return N})(l,d,m,this),this._tiles={},this._cache=new Se(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Kt,this._didEmitContent=!1,this._updated=!1}onAdd(l){this.map=l,this._maxTileCacheSize=l?l._maxTileCacheSize:null,this._maxTileCacheZoomLevels=l?l._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(l)}onRemove(l){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(l)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const l in this._tiles){const d=this._tiles[l];if(d.state!=="loaded"&&d.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const l=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,l&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(l,d){return this._source.loadTile(l,d)}_unloadTile(l){if(this._source.unloadTile)return this._source.unloadTile(l,()=>{})}_abortTile(l){this._source.abortTile&&this._source.abortTile(l,()=>{}),this._source.fire(new o.k("dataabort",{tile:l,coord:l.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(l){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const d in this._tiles){const m=this._tiles[d];m.upload(l),m.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(l=>l.tileID).sort(ke).map(l=>l.key)}getRenderableIds(l){const d=[];for(const m in this._tiles)this._isIdRenderable(m,l)&&d.push(this._tiles[m]);return l?d.sort((m,v)=>{const E=m.tileID,F=v.tileID,M=new o.P(E.canonical.x,E.canonical.y)._rotate(this.transform.angle),N=new o.P(F.canonical.x,F.canonical.y)._rotate(this.transform.angle);return E.overscaledZ-F.overscaledZ||N.y-M.y||N.x-M.x}).map(m=>m.tileID.key):d.map(m=>m.tileID).sort(ke).map(m=>m.key)}hasRenderableParent(l){const d=this.findLoadedParent(l,0);return!!d&&this._isIdRenderable(d.tileID.key)}_isIdRenderable(l,d){return this._tiles[l]&&this._tiles[l].hasData()&&!this._coveredTiles[l]&&(d||!this._tiles[l].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const l in this._tiles)this._tiles[l].state!=="errored"&&this._reloadTile(l,"reloading")}}_reloadTile(l,d){const m=this._tiles[l];m&&(m.state!=="loading"&&(m.state=d),this._loadTile(m,this._tileLoaded.bind(this,m,l,d)))}_tileLoaded(l,d,m,v){if(v)return l.state="errored",void(v.status!==404?this._source.fire(new o.j(v,{tile:l})):this.update(this.transform,this.terrain));l.timeAdded=o.h.now(),m==="expired"&&(l.refreshedUponExpiration=!0),this._setTileReloadTimer(d,l),this.getSource().type==="raster-dem"&&l.dem&&this._backfillDEM(l),this._state.initializeTileState(l,this.map?this.map.painter:null),l.aborted||this._source.fire(new o.k("data",{dataType:"source",tile:l,coord:l.tileID}))}_backfillDEM(l){const d=this.getRenderableIds();for(let v=0;v<d.length;v++){const E=d[v];if(l.neighboringTiles&&l.neighboringTiles[E]){const F=this.getTileByID(E);m(l,F),m(F,l)}}function m(v,E){v.needsHillshadePrepare=!0,v.needsTerrainPrepare=!0;let F=E.tileID.canonical.x-v.tileID.canonical.x;const M=E.tileID.canonical.y-v.tileID.canonical.y,N=Math.pow(2,v.tileID.canonical.z),G=E.tileID.key;F===0&&M===0||Math.abs(M)>1||(Math.abs(F)>1&&(Math.abs(F+N)===1?F+=N:Math.abs(F-N)===1&&(F-=N)),E.dem&&v.dem&&(v.dem.backfillBorder(E.dem,F,M),v.neighboringTiles&&v.neighboringTiles[G]&&(v.neighboringTiles[G].backfilled=!0)))}}getTile(l){return this.getTileByID(l.key)}getTileByID(l){return this._tiles[l]}_retainLoadedChildren(l,d,m,v){for(const E in this._tiles){let F=this._tiles[E];if(v[E]||!F.hasData()||F.tileID.overscaledZ<=d||F.tileID.overscaledZ>m)continue;let M=F.tileID;for(;F&&F.tileID.overscaledZ>d+1;){const G=F.tileID.scaledTo(F.tileID.overscaledZ-1);F=this._tiles[G.key],F&&F.hasData()&&(M=G)}let N=M;for(;N.overscaledZ>d;)if(N=N.scaledTo(N.overscaledZ-1),l[N.key]){v[M.key]=M;break}}}findLoadedParent(l,d){if(l.key in this._loadedParentTiles){const m=this._loadedParentTiles[l.key];return m&&m.tileID.overscaledZ>=d?m:null}for(let m=l.overscaledZ-1;m>=d;m--){const v=l.scaledTo(m),E=this._getLoadedTile(v);if(E)return E}}_getLoadedTile(l){const d=this._tiles[l.key];return d&&d.hasData()?d:this._cache.getByKey(l.wrapped().key)}updateCacheSize(l){const d=Math.ceil(l.width/this._source.tileSize)+1,m=Math.ceil(l.height/this._source.tileSize)+1,v=Math.floor(d*m*(this._maxTileCacheZoomLevels===null?o.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),E=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,v):v;this._cache.setMaxSize(E)}handleWrapJump(l){const d=Math.round((l-(this._prevLng===void 0?l:this._prevLng))/360);if(this._prevLng=l,d){const m={};for(const v in this._tiles){const E=this._tiles[v];E.tileID=E.tileID.unwrapTo(E.tileID.wrap+d),m[E.tileID.key]=E}this._tiles=m;for(const v in this._timers)clearTimeout(this._timers[v]),delete this._timers[v];for(const v in this._tiles)this._setTileReloadTimer(v,this._tiles[v])}}update(l,d){if(this.transform=l,this.terrain=d,!this._sourceLoaded||this._paused)return;let m;this.updateCacheSize(l),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?m=l.getVisibleUnwrappedCoordinates(this._source.tileID).map($=>new o.O($.canonical.z,$.wrap,$.canonical.z,$.canonical.x,$.canonical.y)):(m=l.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:d}),this._source.hasTile&&(m=m.filter($=>this._source.hasTile($)))):m=[];const v=l.coveringZoomLevel(this._source),E=Math.max(v-Ie.maxOverzooming,this._source.minzoom),F=Math.max(v+Ie.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const $={};for(const J of m)if(J.canonical.z>this._source.minzoom){const ct=J.scaledTo(J.canonical.z-1);$[ct.key]=ct;const Ct=J.scaledTo(Math.max(this._source.minzoom,Math.min(J.canonical.z,5)));$[Ct.key]=Ct}m=m.concat(Object.values($))}const M=m.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,M&&this.fire(new o.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const N=this._updateRetainedTiles(m,v);if(He(this._source.type)){const $={},J={},ct=Object.keys(N),Ct=o.h.now();for(const y of ct){const S=N[y],I=this._tiles[y];if(!I||I.fadeEndTime!==0&&I.fadeEndTime<=Ct)continue;const O=this.findLoadedParent(S,E);O&&(this._addTile(O.tileID),$[O.tileID.key]=O.tileID),J[y]=S}this._retainLoadedChildren(J,v,F,N);for(const y in $)N[y]||(this._coveredTiles[y]=!0,N[y]=$[y]);if(d){const y={},S={};for(const I of m)this._tiles[I.key].hasData()?y[I.key]=I:S[I.key]=I;for(const I in S){const O=S[I].children(this._source.maxzoom);this._tiles[O[0].key]&&this._tiles[O[1].key]&&this._tiles[O[2].key]&&this._tiles[O[3].key]&&(y[O[0].key]=N[O[0].key]=O[0],y[O[1].key]=N[O[1].key]=O[1],y[O[2].key]=N[O[2].key]=O[2],y[O[3].key]=N[O[3].key]=O[3],delete S[I])}for(const I in S){const O=this.findLoadedParent(S[I],this._source.minzoom);if(O){y[O.tileID.key]=N[O.tileID.key]=O.tileID;for(const V in y)y[V].isChildOf(O.tileID)&&delete y[V]}}for(const I in this._tiles)y[I]||(this._coveredTiles[I]=!0)}}for(const $ in N)this._tiles[$].clearFadeHold();const G=o.ab(this._tiles,N);for(const $ of G){const J=this._tiles[$];J.hasSymbolBuckets&&!J.holdingForFade()?J.setHoldDuration(this.map._fadeDuration):J.hasSymbolBuckets&&!J.symbolFadeFinished()||this._removeTile($)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const l in this._tiles)this._tiles[l].holdingForFade()&&this._removeTile(l)}_updateRetainedTiles(l,d){const m={},v={},E=Math.max(d-Ie.maxOverzooming,this._source.minzoom),F=Math.max(d+Ie.maxUnderzooming,this._source.minzoom),M={};for(const N of l){const G=this._addTile(N);m[N.key]=N,G.hasData()||d<this._source.maxzoom&&(M[N.key]=N)}this._retainLoadedChildren(M,d,F,m);for(const N of l){let G=this._tiles[N.key];if(G.hasData())continue;if(d+1>this._source.maxzoom){const J=N.children(this._source.maxzoom)[0],ct=this.getTile(J);if(ct&&ct.hasData()){m[J.key]=J;continue}}else{const J=N.children(this._source.maxzoom);if(m[J[0].key]&&m[J[1].key]&&m[J[2].key]&&m[J[3].key])continue}let $=G.wasRequested();for(let J=N.overscaledZ-1;J>=E;--J){const ct=N.scaledTo(J);if(v[ct.key])break;if(v[ct.key]=!0,G=this.getTile(ct),!G&&$&&(G=this._addTile(ct)),G){const Ct=G.hasData();if(($||Ct)&&(m[ct.key]=ct),$=G.wasRequested(),Ct)break}}}return m}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const l in this._tiles){const d=[];let m,v=this._tiles[l].tileID;for(;v.overscaledZ>0;){if(v.key in this._loadedParentTiles){m=this._loadedParentTiles[v.key];break}d.push(v.key);const E=v.scaledTo(v.overscaledZ-1);if(m=this._getLoadedTile(E),m)break;v=E}for(const E of d)this._loadedParentTiles[E]=m}}_addTile(l){let d=this._tiles[l.key];if(d)return d;d=this._cache.getAndRemove(l),d&&(this._setTileReloadTimer(l.key,d),d.tileID=l,this._state.initializeTileState(d,this.map?this.map.painter:null),this._cacheTimers[l.key]&&(clearTimeout(this._cacheTimers[l.key]),delete this._cacheTimers[l.key],this._setTileReloadTimer(l.key,d)));const m=d;return d||(d=new ir(l,this._source.tileSize*l.overscaleFactor()),this._loadTile(d,this._tileLoaded.bind(this,d,l.key,d.state))),d.uses++,this._tiles[l.key]=d,m||this._source.fire(new o.k("dataloading",{tile:d,coord:d.tileID,dataType:"source"})),d}_setTileReloadTimer(l,d){l in this._timers&&(clearTimeout(this._timers[l]),delete this._timers[l]);const m=d.getExpiryTimeout();m&&(this._timers[l]=setTimeout(()=>{this._reloadTile(l,"expired"),delete this._timers[l]},m))}_removeTile(l){const d=this._tiles[l];d&&(d.uses--,delete this._tiles[l],this._timers[l]&&(clearTimeout(this._timers[l]),delete this._timers[l]),d.uses>0||(d.hasData()&&d.state!=="reloading"?this._cache.add(d.tileID,d,d.getExpiryTimeout()):(d.aborted=!0,this._abortTile(d),this._unloadTile(d))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const l in this._tiles)this._removeTile(l);this._cache.reset()}tilesIn(l,d,m){const v=[],E=this.transform;if(!E)return v;const F=m?E.getCameraQueryGeometry(l):l,M=l.map(y=>E.pointCoordinate(y,this.terrain)),N=F.map(y=>E.pointCoordinate(y,this.terrain)),G=this.getIds();let $=1/0,J=1/0,ct=-1/0,Ct=-1/0;for(const y of N)$=Math.min($,y.x),J=Math.min(J,y.y),ct=Math.max(ct,y.x),Ct=Math.max(Ct,y.y);for(let y=0;y<G.length;y++){const S=this._tiles[G[y]];if(S.holdingForFade())continue;const I=S.tileID,O=Math.pow(2,E.zoom-S.tileID.overscaledZ),V=d*S.queryPadding*o.N/S.tileSize/O,H=[I.getTilePoint(new o.U($,J)),I.getTilePoint(new o.U(ct,Ct))];if(H[0].x-V<o.N&&H[0].y-V<o.N&&H[1].x+V>=0&&H[1].y+V>=0){const q=M.map(Z=>I.getTilePoint(Z)),X=N.map(Z=>I.getTilePoint(Z));v.push({tile:S,tileID:I,queryGeometry:q,cameraQueryGeometry:X,scale:O})}}return v}getVisibleCoordinates(l){const d=this.getRenderableIds(l).map(m=>this._tiles[m].tileID);for(const m of d)m.posMatrix=this.transform.calculatePosMatrix(m.toUnwrapped());return d}hasTransition(){if(this._source.hasTransition())return!0;if(He(this._source.type)){const l=o.h.now();for(const d in this._tiles)if(this._tiles[d].fadeEndTime>=l)return!0}return!1}setFeatureState(l,d,m){this._state.updateState(l=l||"_geojsonTileLayer",d,m)}removeFeatureState(l,d,m){this._state.removeFeatureState(l=l||"_geojsonTileLayer",d,m)}getFeatureState(l,d){return this._state.getState(l=l||"_geojsonTileLayer",d)}setDependencies(l,d,m){const v=this._tiles[l];v&&v.setDependencies(d,m)}reloadTilesForDependencies(l,d){for(const m in this._tiles)this._tiles[m].hasDependency(l,d)&&this._reloadTile(m,"reloading");this._cache.filter(m=>!m.hasDependency(l,d))}}function ke(w,l){const d=Math.abs(2*w.wrap)-+(w.wrap<0),m=Math.abs(2*l.wrap)-+(l.wrap<0);return w.overscaledZ-l.overscaledZ||m-d||l.canonical.y-w.canonical.y||l.canonical.x-w.canonical.x}function He(w){return w==="raster"||w==="image"||w==="video"}Ie.maxOverzooming=10,Ie.maxUnderzooming=3;const De="mapboxgl_preloaded_worker_pool";class xr{constructor(){this.active={}}acquire(l){if(!this.workers)for(this.workers=[];this.workers.length<xr.workerCount;)this.workers.push(new Worker(o.c.WORKER_URL));return this.active[l]=!0,this.workers.slice()}release(l){delete this.active[l],this.numActive()===0&&(this.workers.forEach(d=>{d.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[De]}numActive(){return Object.keys(this.active).length}}const Pr=Math.floor(o.h.hardwareConcurrency/2);let Or;function nn(){return Or||(Or=new xr),Or}xr.workerCount=o.ac(globalThis)?Math.max(Math.min(Pr,3),1):1;class Br{constructor(l,d){this.reset(l,d)}reset(l,d){this.points=l||[],this._distances=[0];for(let m=1;m<this.points.length;m++)this._distances[m]=this._distances[m-1]+this.points[m].dist(this.points[m-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(l){if(this.points.length===1)return this.points[0];l=o.ad(l,0,1);let d=1,m=this._distances[d];const v=l*this.paddedLength+this.padding;for(;m<v&&d<this._distances.length;)m=this._distances[++d];const E=d-1,F=this._distances[E],M=m-F,N=M>0?(v-F)/M:0;return this.points[E].mult(1-N).add(this.points[d].mult(N))}}function Ur(w,l){let d=!0;return w==="always"||w!=="never"&&l!=="never"||(d=!1),d}class je{constructor(l,d,m){const v=this.boxCells=[],E=this.circleCells=[];this.xCellCount=Math.ceil(l/m),this.yCellCount=Math.ceil(d/m);for(let F=0;F<this.xCellCount*this.yCellCount;F++)v.push([]),E.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=d,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(l,d,m,v,E){this._forEachCell(d,m,v,E,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(d),this.bboxes.push(m),this.bboxes.push(v),this.bboxes.push(E)}insertCircle(l,d,m,v){this._forEachCell(d-v,m-v,d+v,m+v,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(d),this.circles.push(m),this.circles.push(v)}_insertBoxCell(l,d,m,v,E,F){this.boxCells[E].push(F)}_insertCircleCell(l,d,m,v,E,F){this.circleCells[E].push(F)}_query(l,d,m,v,E,F,M){if(m<0||l>this.width||v<0||d>this.height)return[];const N=[];if(l<=0&&d<=0&&this.width<=m&&this.height<=v){if(E)return[{key:null,x1:l,y1:d,x2:m,y2:v}];for(let G=0;G<this.boxKeys.length;G++)N.push({key:this.boxKeys[G],x1:this.bboxes[4*G],y1:this.bboxes[4*G+1],x2:this.bboxes[4*G+2],y2:this.bboxes[4*G+3]});for(let G=0;G<this.circleKeys.length;G++){const $=this.circles[3*G],J=this.circles[3*G+1],ct=this.circles[3*G+2];N.push({key:this.circleKeys[G],x1:$-ct,y1:J-ct,x2:$+ct,y2:J+ct})}}else this._forEachCell(l,d,m,v,this._queryCell,N,{hitTest:E,overlapMode:F,seenUids:{box:{},circle:{}}},M);return N}query(l,d,m,v){return this._query(l,d,m,v,!1,null)}hitTest(l,d,m,v,E,F){return this._query(l,d,m,v,!0,E,F).length>0}hitTestCircle(l,d,m,v,E){const F=l-m,M=l+m,N=d-m,G=d+m;if(M<0||F>this.width||G<0||N>this.height)return!1;const $=[];return this._forEachCell(F,N,M,G,this._queryCellCircle,$,{hitTest:!0,overlapMode:v,circle:{x:l,y:d,radius:m},seenUids:{box:{},circle:{}}},E),$.length>0}_queryCell(l,d,m,v,E,F,M,N){const{seenUids:G,hitTest:$,overlapMode:J}=M,ct=this.boxCells[E];if(ct!==null){const y=this.bboxes;for(const S of ct)if(!G.box[S]){G.box[S]=!0;const I=4*S,O=this.boxKeys[S];if(l<=y[I+2]&&d<=y[I+3]&&m>=y[I+0]&&v>=y[I+1]&&(!N||N(O))&&(!$||!Ur(J,O.overlapMode))&&(F.push({key:O,x1:y[I],y1:y[I+1],x2:y[I+2],y2:y[I+3]}),$))return!0}}const Ct=this.circleCells[E];if(Ct!==null){const y=this.circles;for(const S of Ct)if(!G.circle[S]){G.circle[S]=!0;const I=3*S,O=this.circleKeys[S];if(this._circleAndRectCollide(y[I],y[I+1],y[I+2],l,d,m,v)&&(!N||N(O))&&(!$||!Ur(J,O.overlapMode))){const V=y[I],H=y[I+1],q=y[I+2];if(F.push({key:O,x1:V-q,y1:H-q,x2:V+q,y2:H+q}),$)return!0}}}return!1}_queryCellCircle(l,d,m,v,E,F,M,N){const{circle:G,seenUids:$,overlapMode:J}=M,ct=this.boxCells[E];if(ct!==null){const y=this.bboxes;for(const S of ct)if(!$.box[S]){$.box[S]=!0;const I=4*S,O=this.boxKeys[S];if(this._circleAndRectCollide(G.x,G.y,G.radius,y[I+0],y[I+1],y[I+2],y[I+3])&&(!N||N(O))&&!Ur(J,O.overlapMode))return F.push(!0),!0}}const Ct=this.circleCells[E];if(Ct!==null){const y=this.circles;for(const S of Ct)if(!$.circle[S]){$.circle[S]=!0;const I=3*S,O=this.circleKeys[S];if(this._circlesCollide(y[I],y[I+1],y[I+2],G.x,G.y,G.radius)&&(!N||N(O))&&!Ur(J,O.overlapMode))return F.push(!0),!0}}}_forEachCell(l,d,m,v,E,F,M,N){const G=this._convertToXCellCoord(l),$=this._convertToYCellCoord(d),J=this._convertToXCellCoord(m),ct=this._convertToYCellCoord(v);for(let Ct=G;Ct<=J;Ct++)for(let y=$;y<=ct;y++)if(E.call(this,l,d,m,v,this.xCellCount*y+Ct,F,M,N))return}_convertToXCellCoord(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))}_convertToYCellCoord(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))}_circlesCollide(l,d,m,v,E,F){const M=v-l,N=E-d,G=m+F;return G*G>M*M+N*N}_circleAndRectCollide(l,d,m,v,E,F,M){const N=(F-v)/2,G=Math.abs(l-(v+N));if(G>N+m)return!1;const $=(M-E)/2,J=Math.abs(d-(E+$));if(J>$+m)return!1;if(G<=N||J<=$)return!0;const ct=G-N,Ct=J-$;return ct*ct+Ct*Ct<=m*m}}function Ee(w,l,d,m,v){const E=o.Z();return l?(o.a0(E,E,[1/v,1/v,1]),d||o.ae(E,E,m.angle)):o.a1(E,m.labelPlaneMatrix,w),E}function Nr(w,l,d,m,v){if(l){const E=o.af(w);return o.a0(E,E,[v,v,1]),d||o.ae(E,E,-m.angle),E}return m.glCoordMatrix}function Vr(w,l,d){let m;d?(m=[w.x,w.y,d(w.x,w.y),1],o.ag(m,m,l)):(m=[w.x,w.y,0,1],Tt(m,m,l));const v=m[3];return{point:new o.P(m[0]/v,m[1]/v),signedDistanceFromCamera:v}}function qr(w,l){return .5+w/l*.5}function rn(w,l){const d=w[0]/w[3],m=w[1]/w[3];return d>=-l[0]&&d<=l[0]&&m>=-l[1]&&m<=l[1]}function Fe(w,l,d,m,v,E,F,M,N,G){const $=m?w.textSizeData:w.iconSizeData,J=o.ah($,d.transform.zoom),ct=[256/d.width*2+1,256/d.height*2+1],Ct=m?w.text.dynamicLayoutVertexArray:w.icon.dynamicLayoutVertexArray;Ct.clear();const y=w.lineVertexArray,S=m?w.text.placedSymbolArray:w.icon.placedSymbolArray,I=d.transform.width/d.transform.height;let O=!1;for(let V=0;V<S.length;V++){const H=S.get(V);if(H.hidden||H.writingMode===o.ai.vertical&&!O){gt(H.numGlyphs,Ct);continue}let q;if(O=!1,G?(q=[H.anchorX,H.anchorY,G(H.anchorX,H.anchorY),1],o.ag(q,q,l)):(q=[H.anchorX,H.anchorY,0,1],Tt(q,q,l)),!rn(q,ct)){gt(H.numGlyphs,Ct);continue}const X=qr(d.transform.cameraToCenterDistance,q[3]),Z=o.aj($,J,H),ot=F?Z/X:Z*X,xt=new o.P(H.anchorX,H.anchorY),Lt=Vr(xt,v,G).point,kt={projections:{},offsets:{}},zt=Jr(H,ot,!1,M,l,v,E,w.glyphOffsetArray,y,Ct,Lt,xt,kt,I,N,G);O=zt.useVertical,(zt.notEnoughRoom||O||zt.needsFlipping&&Jr(H,ot,!0,M,l,v,E,w.glyphOffsetArray,y,Ct,Lt,xt,kt,I,N,G).notEnoughRoom)&&gt(H.numGlyphs,Ct)}m?w.text.dynamicLayoutVertexBuffer.updateData(Ct):w.icon.dynamicLayoutVertexBuffer.updateData(Ct)}function Ze(w,l,d,m,v,E,F,M,N,G,$,J,ct){const Ct=M.glyphStartIndex+M.numGlyphs,y=M.lineStartIndex,S=M.lineStartIndex+M.lineLength,I=l.getoffsetX(M.glyphStartIndex),O=l.getoffsetX(Ct-1),V=tt(w*I,d,m,v,E,F,M.segment,y,S,N,G,$,J,ct);if(!V)return null;const H=tt(w*O,d,m,v,E,F,M.segment,y,S,N,G,$,J,ct);return H?{first:V,last:H}:null}function ur(w,l,d,m){return w===o.ai.horizontal&&Math.abs(d.y-l.y)>Math.abs(d.x-l.x)*m?{useVertical:!0}:(w===o.ai.vertical?l.y<d.y:l.x>d.x)?{needsFlipping:!0}:null}function Jr(w,l,d,m,v,E,F,M,N,G,$,J,ct,Ct,y,S){const I=l/24,O=w.lineOffsetX*I,V=w.lineOffsetY*I;let H;if(w.numGlyphs>1){const q=w.glyphStartIndex+w.numGlyphs,X=w.lineStartIndex,Z=w.lineStartIndex+w.lineLength,ot=Ze(I,M,O,V,d,$,J,w,N,E,ct,y,S);if(!ot)return{notEnoughRoom:!0};const xt=Vr(ot.first.point,F,S).point,Lt=Vr(ot.last.point,F,S).point;if(m&&!d){const kt=ur(w.writingMode,xt,Lt,Ct);if(kt)return kt}H=[ot.first];for(let kt=w.glyphStartIndex+1;kt<q-1;kt++)H.push(tt(I*M.getoffsetX(kt),O,V,d,$,J,w.segment,X,Z,N,E,ct,y,S));H.push(ot.last)}else{if(m&&!d){const X=Vr(J,v,S).point,Z=w.lineStartIndex+w.segment+1,ot=new o.P(N.getx(Z),N.gety(Z)),xt=Vr(ot,v,S),Lt=xt.signedDistanceFromCamera>0?xt.point:Un(J,ot,X,1,v,S),kt=ur(w.writingMode,X,Lt,Ct);if(kt)return kt}const q=tt(I*M.getoffsetX(w.glyphStartIndex),O,V,d,$,J,w.segment,w.lineStartIndex,w.lineStartIndex+w.lineLength,N,E,ct,y,S);if(!q)return{notEnoughRoom:!0};H=[q]}for(const q of H)o.ak(G,q.point,q.angle);return{}}function Un(w,l,d,m,v,E){const F=Vr(w.add(w.sub(l)._unit()),v,E).point,M=d.sub(F);return d.add(M._mult(m/M.mag()))}function qe(w,l){const{projectionCache:d,lineVertexArray:m,labelPlaneMatrix:v,tileAnchorPoint:E,distanceFromAnchor:F,getElevation:M,previousVertex:N,direction:G,absOffsetX:$}=l;if(d.projections[w])return d.projections[w];const J=new o.P(m.getx(w),m.gety(w)),ct=Vr(J,v,M);if(ct.signedDistanceFromCamera>0)return d.projections[w]=ct.point,ct.point;const Ct=w-G;return Un(F===0?E:new o.P(m.getx(Ct),m.gety(Ct)),J,N,$-F+1,v,M)}function sn(w,l,d){return w._unit()._perp()._mult(l*d)}function _t(w,l,d,m,v,E,F,M){const{projectionCache:N,direction:G}=M;if(N.offsets[w])return N.offsets[w];const $=d.add(l);if(w+G<m||w+G>=v)return N.offsets[w]=$,$;const J=qe(w+G,M),ct=sn(J.sub(d),F,G),Ct=d.add(ct),y=J.add(ct);return N.offsets[w]=o.al(E,$,Ct,y)||$,N.offsets[w]}function tt(w,l,d,m,v,E,F,M,N,G,$,J,ct,Ct){const y=m?w-l:w+l;let S=y>0?1:-1,I=0;m&&(S*=-1,I=Math.PI),S<0&&(I+=Math.PI);let O,V,H=S>0?M+F:M+F+1,q=v,X=v,Z=0,ot=0;const xt=Math.abs(y),Lt=[];let kt;for(;Z+ot<=xt;){if(H+=S,H<M||H>=N)return null;Z+=ot,X=q,V=O;const Wt={projectionCache:J,lineVertexArray:G,labelPlaneMatrix:$,tileAnchorPoint:E,distanceFromAnchor:Z,getElevation:Ct,previousVertex:X,direction:S,absOffsetX:xt};if(q=qe(H,Wt),d===0)Lt.push(X),kt=q.sub(X);else{let Ot;const Nt=q.sub(X);Ot=Nt.mag()===0?sn(qe(H+S,Wt).sub(q),d,S):sn(Nt,d,S),V||(V=X.add(Ot)),O=_t(H,Ot,q,M,N,V,d,Wt),Lt.push(V),kt=O.sub(V)}ot=kt.mag()}const zt=kt._mult((xt-Z)/ot)._add(V||X),me=I+Math.atan2(q.y-X.y,q.x-X.x);return Lt.push(zt),{point:zt,angle:ct?me:0,path:Lt}}const at=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function gt(w,l){for(let d=0;d<w;d++){const m=l.length;l.resize(m+4),l.float32.set(at,3*m)}}function Tt(w,l,d){const m=l[0],v=l[1];return w[0]=d[0]*m+d[4]*v+d[12],w[1]=d[1]*m+d[5]*v+d[13],w[3]=d[3]*m+d[7]*v+d[15],w}const Ft=100;class Ht{constructor(l){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new je(l.width+200,l.height+200,25),m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new je(l.width+200,l.height+200,25);this.transform=l,this.grid=d,this.ignoredGrid=m,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+Ft,this.screenBottomBoundary=l.height+Ft,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(l,d,m,v,E,F){const M=this.projectAndGetPerspectiveRatio(v,l.anchorPointX,l.anchorPointY,F),N=m*M.perspectiveRatio,G=l.x1*N+M.point.x,$=l.y1*N+M.point.y,J=l.x2*N+M.point.x,ct=l.y2*N+M.point.y;return!this.isInsideGrid(G,$,J,ct)||d!=="always"&&this.grid.hitTest(G,$,J,ct,d,E)||M.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[G,$,J,ct],offscreen:this.isOffscreen(G,$,J,ct)}}placeCollisionCircles(l,d,m,v,E,F,M,N,G,$,J,ct,Ct,y){const S=[],I=new o.P(d.anchorX,d.anchorY),O=Vr(I,F,y),V=qr(this.transform.cameraToCenterDistance,O.signedDistanceFromCamera),H=($?E/V:E*V)/o.ap,q=Vr(I,M,y).point,X=Ze(H,v,d.lineOffsetX*H,d.lineOffsetY*H,!1,q,I,d,m,M,{projections:{},offsets:{}},!1,y);let Z=!1,ot=!1,xt=!0;if(X){const Lt=.5*ct*V+Ct,kt=new o.P(-100,-100),zt=new o.P(this.screenRightBoundary,this.screenBottomBoundary),me=new Br,Wt=X.first,Ot=X.last;let Nt=[];for(let he=Wt.path.length-1;he>=1;he--)Nt.push(Wt.path[he]);for(let he=1;he<Ot.path.length;he++)Nt.push(Ot.path[he]);const be=2.5*Lt;if(N){const he=Nt.map(Le=>Vr(Le,N,y));Nt=he.some(Le=>Le.signedDistanceFromCamera<=0)?[]:he.map(Le=>Le.point)}let ve=[];if(Nt.length>0){const he=Nt[0].clone(),Le=Nt[0].clone();for(let Oe=1;Oe<Nt.length;Oe++)he.x=Math.min(he.x,Nt[Oe].x),he.y=Math.min(he.y,Nt[Oe].y),Le.x=Math.max(Le.x,Nt[Oe].x),Le.y=Math.max(Le.y,Nt[Oe].y);ve=he.x>=kt.x&&Le.x<=zt.x&&he.y>=kt.y&&Le.y<=zt.y?[Nt]:Le.x<kt.x||he.x>zt.x||Le.y<kt.y||he.y>zt.y?[]:o.am([Nt],kt.x,kt.y,zt.x,zt.y)}for(const he of ve){me.reset(he,.25*Lt);let Le=0;Le=me.length<=.5*Lt?1:Math.ceil(me.paddedLength/be)+1;for(let Oe=0;Oe<Le;Oe++){const sr=Oe/Math.max(Le-1,1),Ge=me.lerp(sr),zr=Ge.x+Ft,Hr=Ge.y+Ft;S.push(zr,Hr,Lt,0);const tn=zr-Lt,Sr=Hr-Lt,pn=zr+Lt,hn=Hr+Lt;if(xt=xt&&this.isOffscreen(tn,Sr,pn,hn),ot=ot||this.isInsideGrid(tn,Sr,pn,hn),l!=="always"&&this.grid.hitTestCircle(zr,Hr,Lt,l,J)&&(Z=!0,!G))return{circles:[],offscreen:!1,collisionDetected:Z}}}}return{circles:!G&&Z||!ot||V<this.perspectiveRatioCutoff?[]:S,offscreen:xt,collisionDetected:Z}}queryRenderedSymbols(l){if(l.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const d=[];let m=1/0,v=1/0,E=-1/0,F=-1/0;for(const $ of l){const J=new o.P($.x+Ft,$.y+Ft);m=Math.min(m,J.x),v=Math.min(v,J.y),E=Math.max(E,J.x),F=Math.max(F,J.y),d.push(J)}const M=this.grid.query(m,v,E,F).concat(this.ignoredGrid.query(m,v,E,F)),N={},G={};for(const $ of M){const J=$.key;if(N[J.bucketInstanceId]===void 0&&(N[J.bucketInstanceId]={}),N[J.bucketInstanceId][J.featureIndex])continue;const ct=[new o.P($.x1,$.y1),new o.P($.x2,$.y1),new o.P($.x2,$.y2),new o.P($.x1,$.y2)];o.an(d,ct)&&(N[J.bucketInstanceId][J.featureIndex]=!0,G[J.bucketInstanceId]===void 0&&(G[J.bucketInstanceId]=[]),G[J.bucketInstanceId].push(J.featureIndex))}return G}insertCollisionBox(l,d,m,v,E,F){(m?this.ignoredGrid:this.grid).insert({bucketInstanceId:v,featureIndex:E,collisionGroupID:F,overlapMode:d},l[0],l[1],l[2],l[3])}insertCollisionCircles(l,d,m,v,E,F){const M=m?this.ignoredGrid:this.grid,N={bucketInstanceId:v,featureIndex:E,collisionGroupID:F,overlapMode:d};for(let G=0;G<l.length;G+=4)M.insertCircle(N,l[G],l[G+1],l[G+2])}projectAndGetPerspectiveRatio(l,d,m,v){let E;return v?(E=[d,m,v(d,m),1],o.ag(E,E,l)):(E=[d,m,0,1],Tt(E,E,l)),{point:new o.P((E[0]/E[3]+1)/2*this.transform.width+Ft,(-E[1]/E[3]+1)/2*this.transform.height+Ft),perspectiveRatio:.5+this.transform.cameraToCenterDistance/E[3]*.5}}isOffscreen(l,d,m,v){return m<Ft||l>=this.screenRightBoundary||v<Ft||d>this.screenBottomBoundary}isInsideGrid(l,d,m,v){return m>=0&&l<this.gridRightBoundary&&v>=0&&d<this.gridBottomBoundary}getViewportMatrix(){const l=o.ao([]);return o.$(l,l,[-100,-100,0]),l}}function Vt(w,l,d){return l*(o.N/(w.tileSize*Math.pow(2,d-w.tileID.overscaledZ)))}class Qt{constructor(l,d,m,v){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?d:-d))):v&&m?1:0,this.placed=m}isHidden(){return this.opacity===0&&!this.placed}}class $t{constructor(l,d,m,v,E){this.text=new Qt(l?l.text:null,d,m,E),this.icon=new Qt(l?l.icon:null,d,v,E)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class fe{constructor(l,d,m){this.text=l,this.icon=d,this.skipFade=m}}class ye{constructor(){this.invProjMatrix=o.Z(),this.viewportMatrix=o.Z(),this.circles=[]}}class we{constructor(l,d,m,v,E){this.bucketInstanceId=l,this.featureIndex=d,this.sourceLayerIndex=m,this.bucketIndex=v,this.tileID=E}}class hr{constructor(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}}get(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){const d=++this.maxGroupID;this.collisionGroups[l]={ID:d,predicate:m=>m.collisionGroupID===d}}return this.collisionGroups[l]}}function dr(w,l,d,m,v){const{horizontalAlign:E,verticalAlign:F}=o.au(w);return new o.P(-(E-.5)*l+m[0]*v,-(F-.5)*d+m[1]*v)}function Je(w,l,d,m,v,E){const{x1:F,x2:M,y1:N,y2:G,anchorPointX:$,anchorPointY:J}=w,ct=new o.P(l,d);return m&&ct._rotate(v?E:-E),{x1:F+ct.x,y1:N+ct.y,x2:M+ct.x,y2:G+ct.y,anchorPointX:$,anchorPointY:J}}class or{constructor(l,d,m,v,E){this.transform=l.clone(),this.terrain=d,this.collisionIndex=new Ht(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=m,this.retainedQueryData={},this.collisionGroups=new hr(v),this.collisionCircleArrays={},this.prevPlacement=E,E&&(E.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(l,d,m,v){const E=m.getBucket(d),F=m.latestFeatureIndex;if(!E||!F||d.id!==E.layerIds[0])return;const M=m.collisionBoxArray,N=E.layers[0].layout,G=Math.pow(2,this.transform.zoom-m.tileID.overscaledZ),$=m.tileSize/o.N,J=this.transform.calculatePosMatrix(m.tileID.toUnwrapped()),ct=N.get("text-pitch-alignment")==="map",Ct=N.get("text-rotation-alignment")==="map",y=Vt(m,1,this.transform.zoom),S=Ee(J,ct,Ct,this.transform,y);let I=null;if(ct){const V=Nr(J,ct,Ct,this.transform,y);I=o.a1([],this.transform.labelPlaneMatrix,V)}this.retainedQueryData[E.bucketInstanceId]=new we(E.bucketInstanceId,F,E.sourceLayerIndex,E.index,m.tileID);const O={bucket:E,layout:N,posMatrix:J,textLabelPlaneMatrix:S,labelToScreenMatrix:I,scale:G,textPixelRatio:$,holdingForFade:m.holdingForFade(),collisionBoxArray:M,partiallyEvaluatedTextSize:o.ah(E.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(E.sourceID)};if(v)for(const V of E.sortKeyRanges){const{sortKey:H,symbolInstanceStart:q,symbolInstanceEnd:X}=V;l.push({sortKey:H,symbolInstanceStart:q,symbolInstanceEnd:X,parameters:O})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:E.symbolInstances.length,parameters:O})}attemptAnchorPlacement(l,d,m,v,E,F,M,N,G,$,J,ct,Ct,y,S,I){const O=o.aq[l.textAnchor],V=[l.textOffset0,l.textOffset1],H=dr(O,m,v,V,E),q=this.collisionIndex.placeCollisionBox(Je(d,H.x,H.y,F,M,this.transform.angle),J,N,G,$.predicate,I);if((!S||this.collisionIndex.placeCollisionBox(Je(S,H.x,H.y,F,M,this.transform.angle),J,N,G,$.predicate,I).box.length!==0)&&q.box.length>0){let X;if(this.prevPlacement&&this.prevPlacement.variableOffsets[ct.crossTileID]&&this.prevPlacement.placements[ct.crossTileID]&&this.prevPlacement.placements[ct.crossTileID].text&&(X=this.prevPlacement.variableOffsets[ct.crossTileID].anchor),ct.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[ct.crossTileID]={textOffset:V,width:m,height:v,anchor:O,textBoxScale:E,prevAnchor:X},this.markUsedJustification(Ct,O,ct,y),Ct.allowVerticalPlacement&&(this.markUsedOrientation(Ct,y,ct),this.placedOrientations[ct.crossTileID]=y),{shift:H,placedGlyphBoxes:q}}}placeLayerBucketPart(l,d,m){const{bucket:v,layout:E,posMatrix:F,textLabelPlaneMatrix:M,labelToScreenMatrix:N,textPixelRatio:G,holdingForFade:$,collisionBoxArray:J,partiallyEvaluatedTextSize:ct,collisionGroup:Ct}=l.parameters,y=E.get("text-optional"),S=E.get("icon-optional"),I=o.ar(E,"text-overlap","text-allow-overlap"),O=I==="always",V=o.ar(E,"icon-overlap","icon-allow-overlap"),H=V==="always",q=E.get("text-rotation-alignment")==="map",X=E.get("text-pitch-alignment")==="map",Z=E.get("icon-text-fit")!=="none",ot=E.get("symbol-z-order")==="viewport-y",xt=O&&(H||!v.hasIconData()||S),Lt=H&&(O||!v.hasTextData()||y);!v.collisionArrays&&J&&v.deserializeCollisionBoxes(J);const kt=this.retainedQueryData[v.bucketInstanceId].tileID,zt=this.terrain?(Wt,Ot)=>this.terrain.getElevation(kt,Wt,Ot):null,me=(Wt,Ot)=>{var Nt,be;if(d[Wt.crossTileID])return;if($)return void(this.placements[Wt.crossTileID]=new fe(!1,!1,!1));let ve=!1,he=!1,Le=!0,Oe=null,sr={box:null,offscreen:null},Ge={box:null,offscreen:null},zr=null,Hr=null,tn=null,Sr=0,pn=0,hn=0;Ot.textFeatureIndex?Sr=Ot.textFeatureIndex:Wt.useRuntimeCollisionCircles&&(Sr=Wt.featureIndex),Ot.verticalTextFeatureIndex&&(pn=Ot.verticalTextFeatureIndex);const Gr=Ot.textBox;if(Gr){const vn=Bn=>{let gn=o.ai.horizontal;if(v.allowVerticalPlacement&&!Bn&&this.prevPlacement){const Mn=this.prevPlacement.placedOrientations[Wt.crossTileID];Mn&&(this.placedOrientations[Wt.crossTileID]=Mn,gn=Mn,this.markUsedOrientation(v,gn,Wt))}return gn},Fn=(Bn,gn)=>{if(v.allowVerticalPlacement&&Wt.numVerticalGlyphVertices>0&&Ot.verticalTextBox){for(const Mn of v.writingModes)if(Mn===o.ai.vertical?(sr=gn(),Ge=sr):sr=Bn(),sr&&sr.box&&sr.box.length)break}else sr=Bn()},en=Wt.textAnchorOffsetStartIndex,Ui=Wt.textAnchorOffsetEndIndex;if(Ui===en){const Bn=(gn,Mn)=>{const mn=this.collisionIndex.placeCollisionBox(gn,I,G,F,Ct.predicate,zt);return mn&&mn.box&&mn.box.length&&(this.markUsedOrientation(v,Mn,Wt),this.placedOrientations[Wt.crossTileID]=Mn),mn};Fn(()=>Bn(Gr,o.ai.horizontal),()=>{const gn=Ot.verticalTextBox;return v.allowVerticalPlacement&&Wt.numVerticalGlyphVertices>0&&gn?Bn(gn,o.ai.vertical):{box:null,offscreen:null}}),vn(sr&&sr.box&&sr.box.length)}else{let Bn=o.aq[(be=(Nt=this.prevPlacement)===null||Nt===void 0?void 0:Nt.variableOffsets[Wt.crossTileID])===null||be===void 0?void 0:be.anchor];const gn=(mn,Vi,ro)=>{const Ri=mn.x2-mn.x1,Ca=mn.y2-mn.y1,fl=Wt.textBoxScale,Cc=Z&&V==="never"?Vi:null;let is={box:[],offscreen:!1},Hn=I==="never"?1:2,Po="never";Bn&&Hn++;for(let no=0;no<Hn;no++){for(let ea=en;ea<Ui;ea++){const AA=v.textAnchorOffsets.get(ea);if(Bn&&AA.textAnchor!==Bn)continue;const io=this.attemptAnchorPlacement(AA,mn,Ri,Ca,fl,q,X,G,F,Ct,Po,Wt,v,ro,Cc,zt);if(io&&(is=io.placedGlyphBoxes,is&&is.box&&is.box.length))return ve=!0,Oe=io.shift,is}Bn?Bn=null:Po=I}return is};Fn(()=>gn(Gr,Ot.iconBox,o.ai.horizontal),()=>{const mn=Ot.verticalTextBox;return v.allowVerticalPlacement&&!(sr&&sr.box&&sr.box.length)&&Wt.numVerticalGlyphVertices>0&&mn?gn(mn,Ot.verticalIconBox,o.ai.vertical):{box:null,offscreen:null}}),sr&&(ve=sr.box,Le=sr.offscreen);const Mn=vn(sr&&sr.box);if(!ve&&this.prevPlacement){const mn=this.prevPlacement.variableOffsets[Wt.crossTileID];mn&&(this.variableOffsets[Wt.crossTileID]=mn,this.markUsedJustification(v,mn.anchor,Wt,Mn))}}}if(zr=sr,ve=zr&&zr.box&&zr.box.length>0,Le=zr&&zr.offscreen,Wt.useRuntimeCollisionCircles){const vn=v.text.placedSymbolArray.get(Wt.centerJustifiedTextSymbolIndex),Fn=o.aj(v.textSizeData,ct,vn),en=E.get("text-padding");Hr=this.collisionIndex.placeCollisionCircles(I,vn,v.lineVertexArray,v.glyphOffsetArray,Fn,F,M,N,m,X,Ct.predicate,Wt.collisionCircleDiameter,en,zt),Hr.circles.length&&Hr.collisionDetected&&!m&&o.w("Collisions detected, but collision boxes are not shown"),ve=O||Hr.circles.length>0&&!Hr.collisionDetected,Le=Le&&Hr.offscreen}if(Ot.iconFeatureIndex&&(hn=Ot.iconFeatureIndex),Ot.iconBox){const vn=Fn=>{const en=Z&&Oe?Je(Fn,Oe.x,Oe.y,q,X,this.transform.angle):Fn;return this.collisionIndex.placeCollisionBox(en,V,G,F,Ct.predicate,zt)};Ge&&Ge.box&&Ge.box.length&&Ot.verticalIconBox?(tn=vn(Ot.verticalIconBox),he=tn.box.length>0):(tn=vn(Ot.iconBox),he=tn.box.length>0),Le=Le&&tn.offscreen}const Yn=y||Wt.numHorizontalGlyphVertices===0&&Wt.numVerticalGlyphVertices===0,Pi=S||Wt.numIconVertices===0;if(Yn||Pi?Pi?Yn||(he=he&&ve):ve=he&&ve:he=ve=he&&ve,ve&&zr&&zr.box&&this.collisionIndex.insertCollisionBox(zr.box,I,E.get("text-ignore-placement"),v.bucketInstanceId,Ge&&Ge.box&&pn?pn:Sr,Ct.ID),he&&tn&&this.collisionIndex.insertCollisionBox(tn.box,V,E.get("icon-ignore-placement"),v.bucketInstanceId,hn,Ct.ID),Hr&&(ve&&this.collisionIndex.insertCollisionCircles(Hr.circles,I,E.get("text-ignore-placement"),v.bucketInstanceId,Sr,Ct.ID),m)){const vn=v.bucketInstanceId;let Fn=this.collisionCircleArrays[vn];Fn===void 0&&(Fn=this.collisionCircleArrays[vn]=new ye);for(let en=0;en<Hr.circles.length;en+=4)Fn.circles.push(Hr.circles[en+0]),Fn.circles.push(Hr.circles[en+1]),Fn.circles.push(Hr.circles[en+2]),Fn.circles.push(Hr.collisionDetected?1:0)}if(Wt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(v.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Wt.crossTileID]=new fe(ve||xt,he||Lt,Le||v.justReloaded),d[Wt.crossTileID]=!0};if(ot){if(l.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Wt=v.getSortedSymbolIndexes(this.transform.angle);for(let Ot=Wt.length-1;Ot>=0;--Ot){const Nt=Wt[Ot];me(v.symbolInstances.get(Nt),v.collisionArrays[Nt])}}else for(let Wt=l.symbolInstanceStart;Wt<l.symbolInstanceEnd;Wt++)me(v.symbolInstances.get(Wt),v.collisionArrays[Wt]);if(m&&v.bucketInstanceId in this.collisionCircleArrays){const Wt=this.collisionCircleArrays[v.bucketInstanceId];o.as(Wt.invProjMatrix,F),Wt.viewportMatrix=this.collisionIndex.getViewportMatrix()}v.justReloaded=!1}markUsedJustification(l,d,m,v){let E;E=v===o.ai.vertical?m.verticalPlacedTextSymbolIndex:{left:m.leftJustifiedTextSymbolIndex,center:m.centerJustifiedTextSymbolIndex,right:m.rightJustifiedTextSymbolIndex}[o.at(d)];const F=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex,m.verticalPlacedTextSymbolIndex];for(const M of F)M>=0&&(l.text.placedSymbolArray.get(M).crossTileID=E>=0&&M!==E?0:m.crossTileID)}markUsedOrientation(l,d,m){const v=d===o.ai.horizontal||d===o.ai.horizontalOnly?d:0,E=d===o.ai.vertical?d:0,F=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex];for(const M of F)l.text.placedSymbolArray.get(M).placedOrientation=v;m.verticalPlacedTextSymbolIndex&&(l.text.placedSymbolArray.get(m.verticalPlacedTextSymbolIndex).placedOrientation=E)}commit(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;const d=this.prevPlacement;let m=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;const v=d?d.symbolFadeChange(l):1,E=d?d.opacities:{},F=d?d.variableOffsets:{},M=d?d.placedOrientations:{};for(const N in this.placements){const G=this.placements[N],$=E[N];$?(this.opacities[N]=new $t($,v,G.text,G.icon),m=m||G.text!==$.text.placed||G.icon!==$.icon.placed):(this.opacities[N]=new $t(null,v,G.text,G.icon,G.skipFade),m=m||G.text||G.icon)}for(const N in E){const G=E[N];if(!this.opacities[N]){const $=new $t(G,v,!1,!1);$.isHidden()||(this.opacities[N]=$,m=m||G.text.placed||G.icon.placed)}}for(const N in F)this.variableOffsets[N]||!this.opacities[N]||this.opacities[N].isHidden()||(this.variableOffsets[N]=F[N]);for(const N in M)this.placedOrientations[N]||!this.opacities[N]||this.opacities[N].isHidden()||(this.placedOrientations[N]=M[N]);if(d&&d.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");m?this.lastPlacementChangeTime=l:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:l)}updateLayerOpacities(l,d){const m={};for(const v of d){const E=v.getBucket(l);E&&v.latestFeatureIndex&&l.id===E.layerIds[0]&&this.updateBucketOpacities(E,m,v.collisionBoxArray)}}updateBucketOpacities(l,d,m){l.hasTextData()&&(l.text.opacityVertexArray.clear(),l.text.hasVisibleVertices=!1),l.hasIconData()&&(l.icon.opacityVertexArray.clear(),l.icon.hasVisibleVertices=!1),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();const v=l.layers[0],E=v.layout,F=new $t(null,0,!1,!1,!0),M=E.get("text-allow-overlap"),N=E.get("icon-allow-overlap"),G=v._unevaluatedLayout.hasValue("text-variable-anchor")||v._unevaluatedLayout.hasValue("text-variable-anchor-offset"),$=E.get("text-rotation-alignment")==="map",J=E.get("text-pitch-alignment")==="map",ct=E.get("icon-text-fit")!=="none",Ct=new $t(null,0,M&&(N||!l.hasIconData()||E.get("icon-optional")),N&&(M||!l.hasTextData()||E.get("text-optional")),!0);!l.collisionArrays&&m&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(m);const y=(S,I,O)=>{for(let V=0;V<I/4;V++)S.opacityVertexArray.emplaceBack(O);S.hasVisibleVertices=S.hasVisibleVertices||O!==Sn};for(let S=0;S<l.symbolInstances.length;S++){const I=l.symbolInstances.get(S),{numHorizontalGlyphVertices:O,numVerticalGlyphVertices:V,crossTileID:H}=I;let q=this.opacities[H];d[H]?q=F:q||(q=Ct,this.opacities[H]=q),d[H]=!0;const X=I.numIconVertices>0,Z=this.placedOrientations[I.crossTileID],ot=Z===o.ai.vertical,xt=Z===o.ai.horizontal||Z===o.ai.horizontalOnly;if(O>0||V>0){const Lt=Kr(q.text);y(l.text,O,ot?Sn:Lt),y(l.text,V,xt?Sn:Lt);const kt=q.text.isHidden();[I.rightJustifiedTextSymbolIndex,I.centerJustifiedTextSymbolIndex,I.leftJustifiedTextSymbolIndex].forEach(Wt=>{Wt>=0&&(l.text.placedSymbolArray.get(Wt).hidden=kt||ot?1:0)}),I.verticalPlacedTextSymbolIndex>=0&&(l.text.placedSymbolArray.get(I.verticalPlacedTextSymbolIndex).hidden=kt||xt?1:0);const zt=this.variableOffsets[I.crossTileID];zt&&this.markUsedJustification(l,zt.anchor,I,Z);const me=this.placedOrientations[I.crossTileID];me&&(this.markUsedJustification(l,"left",I,me),this.markUsedOrientation(l,me,I))}if(X){const Lt=Kr(q.icon),kt=!(ct&&I.verticalPlacedIconSymbolIndex&&ot);I.placedIconSymbolIndex>=0&&(y(l.icon,I.numIconVertices,kt?Lt:Sn),l.icon.placedSymbolArray.get(I.placedIconSymbolIndex).hidden=q.icon.isHidden()),I.verticalPlacedIconSymbolIndex>=0&&(y(l.icon,I.numVerticalIconVertices,kt?Sn:Lt),l.icon.placedSymbolArray.get(I.verticalPlacedIconSymbolIndex).hidden=q.icon.isHidden())}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){const Lt=l.collisionArrays[S];if(Lt){let kt=new o.P(0,0);if(Lt.textBox||Lt.verticalTextBox){let me=!0;if(G){const Wt=this.variableOffsets[H];Wt?(kt=dr(Wt.anchor,Wt.width,Wt.height,Wt.textOffset,Wt.textBoxScale),$&&kt._rotate(J?this.transform.angle:-this.transform.angle)):me=!1}Lt.textBox&&_r(l.textCollisionBox.collisionVertexArray,q.text.placed,!me||ot,kt.x,kt.y),Lt.verticalTextBox&&_r(l.textCollisionBox.collisionVertexArray,q.text.placed,!me||xt,kt.x,kt.y)}const zt=!!(!xt&&Lt.verticalIconBox);Lt.iconBox&&_r(l.iconCollisionBox.collisionVertexArray,q.icon.placed,zt,ct?kt.x:0,ct?kt.y:0),Lt.verticalIconBox&&_r(l.iconCollisionBox.collisionVertexArray,q.icon.placed,!zt,ct?kt.x:0,ct?kt.y:0)}}}if(l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.text.opacityVertexArray.length!==l.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${l.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${l.text.layoutVertexArray.length}) / 4`);if(l.icon.opacityVertexArray.length!==l.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${l.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${l.icon.layoutVertexArray.length}) / 4`);if(l.bucketInstanceId in this.collisionCircleArrays){const S=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=S.invProjMatrix,l.placementViewportMatrix=S.viewportMatrix,l.collisionCircleArray=S.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}}symbolFadeChange(l){return this.fadeDuration===0?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(l){return Math.max(0,(this.transform.zoom-l)/1.5)}hasTransitions(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(l,d){const m=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*m>l}setStale(){this.stale=!0}}function _r(w,l,d,m,v){w.emplaceBack(l?1:0,d?1:0,m||0,v||0),w.emplaceBack(l?1:0,d?1:0,m||0,v||0),w.emplaceBack(l?1:0,d?1:0,m||0,v||0),w.emplaceBack(l?1:0,d?1:0,m||0,v||0)}const Rr=Math.pow(2,25),jr=Math.pow(2,24),Fr=Math.pow(2,17),Rt=Math.pow(2,16),Qe=Math.pow(2,9),Be=Math.pow(2,8),Er=Math.pow(2,1);function Kr(w){if(w.opacity===0&&!w.placed)return 0;if(w.opacity===1&&w.placed)return 4294967295;const l=w.placed?1:0,d=Math.floor(127*w.opacity);return d*Rr+l*jr+d*Fr+l*Rt+d*Qe+l*Be+d*Er+l}const Sn=0;class Rn{constructor(l){this._sortAcrossTiles=l.layout.get("symbol-z-order")!=="viewport-y"&&!l.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(l,d,m,v,E){const F=this._bucketParts;for(;this._currentTileIndex<l.length;)if(d.getBucketParts(F,v,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,E())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,F.sort((M,N)=>M.sortKey-N.sortKey));this._currentPartIndex<F.length;)if(d.placeLayerBucketPart(F[this._currentPartIndex],this._seenCrossTileIDs,m),this._currentPartIndex++,E())return!0;return!1}}class Vn{constructor(l,d,m,v,E,F,M,N){this.placement=new or(l,d,F,M,N),this._currentPlacementIndex=m.length-1,this._forceFullPlacement=v,this._showCollisionBoxes=E,this._done=!1}isDone(){return this._done}continuePlacement(l,d,m){const v=o.h.now(),E=()=>!this._forceFullPlacement&&o.h.now()-v>2;for(;this._currentPlacementIndex>=0;){const F=d[l[this._currentPlacementIndex]],M=this.placement.collisionIndex.transform.zoom;if(F.type==="symbol"&&(!F.minzoom||F.minzoom<=M)&&(!F.maxzoom||F.maxzoom>M)){if(this._inProgressLayer||(this._inProgressLayer=new Rn(F)),this._inProgressLayer.continuePlacement(m[F.source],this.placement,this._showCollisionBoxes,F,E))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(l){return this.placement.commit(l),this.placement}}const kn=512/o.N/2;class Qn{constructor(l,d,m){this.tileID=l,this.bucketInstanceId=m,this._symbolsByKey={};const v=new Map;for(let E=0;E<d.length;E++){const F=d.get(E),M=F.key,N=v.get(M);N?N.push(F):v.set(M,[F])}for(const[E,F]of v){const M={positions:F.map(N=>({x:Math.floor(N.anchorX*kn),y:Math.floor(N.anchorY*kn)})),crossTileIDs:F.map(N=>N.crossTileID)};if(M.positions.length>128){const N=new o.av(M.positions.length,16,Uint16Array);for(const{x:G,y:$}of M.positions)N.add(G,$);N.finish(),delete M.positions,M.index=N}this._symbolsByKey[E]=M}}getScaledCoordinates(l,d){const{x:m,y:v,z:E}=this.tileID.canonical,{x:F,y:M,z:N}=d.canonical,G=kn/Math.pow(2,N-E),$=(M*o.N+l.anchorY)*G,J=v*o.N*kn;return{x:Math.floor((F*o.N+l.anchorX)*G-m*o.N*kn),y:Math.floor($-J)}}findMatches(l,d,m){const v=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z);for(let E=0;E<l.length;E++){const F=l.get(E);if(F.crossTileID)continue;const M=this._symbolsByKey[F.key];if(!M)continue;const N=this.getScaledCoordinates(F,d);if(M.index){const G=M.index.range(N.x-v,N.y-v,N.x+v,N.y+v).sort();for(const $ of G){const J=M.crossTileIDs[$];if(!m[J]){m[J]=!0,F.crossTileID=J;break}}}else if(M.positions)for(let G=0;G<M.positions.length;G++){const $=M.positions[G],J=M.crossTileIDs[G];if(Math.abs($.x-N.x)<=v&&Math.abs($.y-N.y)<=v&&!m[J]){m[J]=!0,F.crossTileID=J;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(l=>{let{crossTileIDs:d}=l;return d})}}class Yr{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Xs{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(l){const d=Math.round((l-this.lng)/360);if(d!==0)for(const m in this.indexes){const v=this.indexes[m],E={};for(const F in v){const M=v[F];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+d),E[M.tileID.key]=M}this.indexes[m]=E}this.lng=l}addBucket(l,d,m){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(let E=0;E<d.symbolInstances.length;E++)d.symbolInstances.get(E).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]={});const v=this.usedCrossTileIDs[l.overscaledZ];for(const E in this.indexes){const F=this.indexes[E];if(Number(E)>l.overscaledZ)for(const M in F){const N=F[M];N.tileID.isChildOf(l)&&N.findMatches(d.symbolInstances,l,v)}else{const M=F[l.scaledTo(Number(E)).key];M&&M.findMatches(d.symbolInstances,l,v)}}for(let E=0;E<d.symbolInstances.length;E++){const F=d.symbolInstances.get(E);F.crossTileID||(F.crossTileID=m.generate(),v[F.crossTileID]=!0)}return this.indexes[l.overscaledZ]===void 0&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new Qn(l,d.symbolInstances,d.bucketInstanceId),!0}removeBucketCrossTileIDs(l,d){for(const m of d.getCrossTileIDsLists())for(const v of m)delete this.usedCrossTileIDs[l][v]}removeStaleBuckets(l){let d=!1;for(const m in this.indexes){const v=this.indexes[m];for(const E in v)l[v[E].bucketInstanceId]||(this.removeBucketCrossTileIDs(m,v[E]),delete v[E],d=!0)}return d}}class ts{constructor(){this.layerIndexes={},this.crossTileIDs=new Yr,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(l,d,m){let v=this.layerIndexes[l.id];v===void 0&&(v=this.layerIndexes[l.id]=new Xs);let E=!1;const F={};v.handleWrapJump(m);for(const M of d){const N=M.getBucket(l);N&&l.id===N.layerIds[0]&&(N.bucketInstanceId||(N.bucketInstanceId=++this.maxBucketInstanceId),v.addBucket(M.tileID,N,this.crossTileIDs)&&(E=!0),F[N.bucketInstanceId]=!0)}return v.removeStaleBuckets(F)&&(E=!0),E}pruneUnusedLayers(l){const d={};l.forEach(m=>{d[m]=!0});for(const m in this.layerIndexes)d[m]||delete this.layerIndexes[m]}}const Dn=(w,l)=>o.x(w,l&&l.filter(d=>d.identifier!=="source.canvas")),Gi=o.F(o.ax,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setGlyphs","setSprite"]),za=o.F(o.ax,["setCenter","setZoom","setBearing","setPitch"]),Ii=o.aw();class kr extends o.E{constructor(l){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),this.map=l,this.dispatcher=new Te(nn(),this,l._getMapId()),this.imageManager=new At,this.imageManager.setEventedParent(this),this.glyphManager=new ie(l._requestManager,d.localIdeographFontFamily),this.lineAtlas=new le(256,512),this.crossTileSymbolIndex=new ts,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new o.ay,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",o.az());const m=this;this._rtlTextPluginCallback=kr.registerForPluginStateChange(v=>{m.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:v.pluginStatus,pluginURL:v.pluginURL},(E,F)=>{if(o.aA(E),F&&F.every(M=>M))for(const M in m.sourceCaches){const N=m.sourceCaches[M].getSource().type;N!=="vector"&&N!=="geojson"||m.sourceCaches[M].reload()}})}),this.on("data",v=>{if(v.dataType!=="source"||v.sourceDataType!=="metadata")return;const E=this.sourceCaches[v.sourceId];if(!E)return;const F=E.getSource();if(F&&F.vectorLayerIds)for(const M in this._layers){const N=this._layers[M];N.source===F.id&&this._validateLayer(N)}})}loadURL(l){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},m=arguments.length>2?arguments[2]:void 0;this.fire(new o.k("dataloading",{dataType:"style"})),d.validate=typeof d.validate!="boolean"||d.validate;const v=this.map._requestManager.transformRequest(l,k.Style);this._request=o.f(v,(E,F)=>{this._request=null,E?this.fire(new o.j(E)):F&&this._load(F,d,m)})}loadJSON(l){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},m=arguments.length>2?arguments[2]:void 0;this.fire(new o.k("dataloading",{dataType:"style"})),this._request=o.h.frame(()=>{this._request=null,d.validate=d.validate!==!1,this._load(l,d,m)})}loadEmpty(){this.fire(new o.k("dataloading",{dataType:"style"})),this._load(Ii,{validate:!1})}_load(l,d,m){var v;const E=d.transformStyle?d.transformStyle(m,l):l;if(!d.validate||!Dn(this,o.y(E))){this._loaded=!0,this.stylesheet=E;for(const F in E.sources)this.addSource(F,E.sources[F],{validate:!1});E.sprite?this._loadSprite(E.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(E.glyphs),this._createLayers(),this.light=new ce(this.stylesheet.light),this.map.setTerrain((v=this.stylesheet.terrain)!==null&&v!==void 0?v:null),this.fire(new o.k("data",{dataType:"style"})),this.fire(new o.k("style.load"))}}_createLayers(){const l=o.aB(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",l),this._order=l.map(d=>d.id),this._layers={},this._serializedLayers=null;for(const d of l){const m=o.aC(d);m.setEventedParent(this,{layer:{id:d.id}}),this._layers[d.id]=m}}_loadSprite(l){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0;this.imageManager.setLoaded(!1),this._spriteRequest=function(v,E,F,M){const N=ft(v),G=N.length,$=F>1?"@2x":"",J={},ct={},Ct={};for(const{id:y,url:S}of N){const I=E.transformRequest(E.normalizeSpriteURL(S,$,".json"),k.SpriteJSON),O=`${y}_${I.url}`;J[O]=o.f(I,(q,X)=>{delete J[O],ct[y]=X,Dt(M,ct,Ct,q,G)});const V=E.transformRequest(E.normalizeSpriteURL(S,$,".png"),k.SpriteImage),H=`${y}_${V.url}`;J[H]=Q.getImage(V,(q,X)=>{delete J[H],Ct[y]=X,Dt(M,ct,Ct,q,G)})}return{cancel(){for(const y of Object.values(J))y.cancel()}}}(l,this.map._requestManager,this.map.getPixelRatio(),(v,E)=>{if(this._spriteRequest=null,v)this.fire(new o.j(v));else if(E)for(const F in E){this._spritesImagesIds[F]=[];const M=this._spritesImagesIds[F]?this._spritesImagesIds[F].filter(N=>!(N in E)):[];for(const N of M)this.imageManager.removeImage(N),this._changedImages[N]=!0;for(const N in E[F]){const G=F==="default"?N:`${F}:${N}`;this._spritesImagesIds[F].push(G),G in this.imageManager.images?this.imageManager.updateImage(G,E[F][N],!1):this.imageManager.addImage(G,E[F][N]),d&&(this._changedImages[G]=!0)}}this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),d&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.k("data",{dataType:"style"})),m&&m(v)})}_unloadSprite(){for(const l of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(l),this._changedImages[l]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.k("data",{dataType:"style"}))}_validateLayer(l){const d=this.sourceCaches[l.source];if(!d)return;const m=l.sourceLayer;if(!m)return;const v=d.getSource();(v.type==="geojson"||v.vectorLayerIds&&v.vectorLayerIds.indexOf(m)===-1)&&this.fire(new o.j(new Error(`Source layer "${m}" does not exist on source "${v.id}" as specified by style layer "${l.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const l in this.sourceCaches)if(!this.sourceCaches[l].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(l){const d=this._serializedAllLayers();if(!l||l.length===0)return Object.values(d);const m=[];for(const v of l)d[v]&&m.push(d[v]);return m}_serializedAllLayers(){let l=this._serializedLayers;if(l)return l;l=this._serializedLayers={};const d=Object.keys(this._layers);for(const m of d){const v=this._layers[m];v.type!=="custom"&&(l[m]=v.serialize())}return l}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const l in this.sourceCaches)if(this.sourceCaches[l].hasTransition())return!0;for(const l in this._layers)if(this._layers[l].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(l){if(!this._loaded)return;const d=this._changed;if(this._changed){const v=Object.keys(this._updatedLayers),E=Object.keys(this._removedLayers);(v.length||E.length)&&this._updateWorkerLayers(v,E);for(const F in this._updatedSources){const M=this._updatedSources[F];if(M==="reload")this._reloadSource(F);else{if(M!=="clear")throw new Error(`Invalid action ${M}`);this._clearSource(F)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const F in this._updatedPaintProps)this._layers[F].updateTransitions(l);this.light.updateTransitions(l),this._resetUpdates()}const m={};for(const v in this.sourceCaches){const E=this.sourceCaches[v];m[v]=E.used,E.used=!1}for(const v of this._order){const E=this._layers[v];E.recalculate(l,this._availableImages),!E.isHidden(l.zoom)&&E.source&&(this.sourceCaches[E.source].used=!0)}for(const v in m){const E=this.sourceCaches[v];m[v]!==E.used&&E.fire(new o.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:v}))}this.light.recalculate(l),this.z=l.zoom,d&&this.fire(new o.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const l=Object.keys(this._changedImages);if(l.length){for(const d in this.sourceCaches)this.sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],l);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const l in this.sourceCaches)this.sourceCaches[l].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(l,d){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(l),removedIds:d})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(l){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this._checkLoaded();const m=this.serialize();if(l=d.transformStyle?d.transformStyle(m,l):l,Dn(this,o.y(l)))return!1;(l=o.aD(l)).layers=o.aB(l.layers);const v=o.aE(m,l).filter(F=>!(F.command in za));if(v.length===0)return!1;const E=v.filter(F=>!(F.command in Gi));if(E.length>0)throw new Error(`Unimplemented: ${E.map(F=>F.command).join(", ")}.`);for(const F of v)F.command!=="setTransition"&&this[F.command].apply(this,F.args);return this.stylesheet=l,this._serializedLayers=null,!0}addImage(l,d){if(this.getImage(l))return this.fire(new o.j(new Error(`An image named "${l}" already exists.`)));this.imageManager.addImage(l,d),this._afterImageUpdated(l)}updateImage(l,d){this.imageManager.updateImage(l,d)}getImage(l){return this.imageManager.getImage(l)}removeImage(l){if(!this.getImage(l))return this.fire(new o.j(new Error(`An image named "${l}" does not exist.`)));this.imageManager.removeImage(l),this._afterImageUpdated(l)}_afterImageUpdated(l){this._availableImages=this.imageManager.listImages(),this._changedImages[l]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(l,d){let m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(this._checkLoaded(),this.sourceCaches[l]!==void 0)throw new Error(`Source "${l}" already exists.`);if(!d.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(d).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(o.y.source,`sources.${l}`,d,null,m))return;this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);const v=this.sourceCaches[l]=new Ie(l,d,this.dispatcher);v.style=this,v.setEventedParent(this,()=>({isSourceLoaded:v.loaded(),source:v.serialize(),sourceId:l})),v.onAdd(this.map),this._changed=!0}removeSource(l){if(this._checkLoaded(),this.sourceCaches[l]===void 0)throw new Error("There is no source with this ID");for(const m in this._layers)if(this._layers[m].source===l)return this.fire(new o.j(new Error(`Source "${l}" cannot be removed while layer "${m}" is using it.`)));const d=this.sourceCaches[l];delete this.sourceCaches[l],delete this._updatedSources[l],d.fire(new o.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:l})),d.setEventedParent(null),d.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(l,d){if(this._checkLoaded(),this.sourceCaches[l]===void 0)throw new Error(`There is no source with this ID=${l}`);const m=this.sourceCaches[l].getSource();if(m.type!=="geojson")throw new Error(`geojsonSource.type is ${m.type}, which is !== 'geojson`);m.setData(d),this._changed=!0}getSource(l){return this.sourceCaches[l]&&this.sourceCaches[l].getSource()}addLayer(l,d){let m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this._checkLoaded();const v=l.id;if(this.getLayer(v))return void this.fire(new o.j(new Error(`Layer "${v}" already exists on this map.`)));let E;if(l.type==="custom"){if(Dn(this,o.aF(l)))return;E=o.aC(l)}else{if("source"in l&&typeof l.source=="object"&&(this.addSource(v,l.source),l=o.aD(l),l=o.e(l,{source:v})),this._validate(o.y.layer,`layers.${v}`,l,{arrayIndex:-1},m))return;E=o.aC(l),this._validateLayer(E),E.setEventedParent(this,{layer:{id:v}})}const F=d?this._order.indexOf(d):this._order.length;if(d&&F===-1)this.fire(new o.j(new Error(`Cannot add layer "${v}" before non-existing layer "${d}".`)));else{if(this._order.splice(F,0,v),this._layerOrderChanged=!0,this._layers[v]=E,this._removedLayers[v]&&E.source&&E.type!=="custom"){const M=this._removedLayers[v];delete this._removedLayers[v],M.type!==E.type?this._updatedSources[E.source]="clear":(this._updatedSources[E.source]="reload",this.sourceCaches[E.source].pause())}this._updateLayer(E),E.onAdd&&E.onAdd(this.map)}}moveLayer(l,d){if(this._checkLoaded(),this._changed=!0,!this._layers[l])return void this.fire(new o.j(new Error(`The layer '${l}' does not exist in the map's style and cannot be moved.`)));if(l===d)return;const m=this._order.indexOf(l);this._order.splice(m,1);const v=d?this._order.indexOf(d):this._order.length;d&&v===-1?this.fire(new o.j(new Error(`Cannot move layer "${l}" before non-existing layer "${d}".`))):(this._order.splice(v,0,l),this._layerOrderChanged=!0)}removeLayer(l){this._checkLoaded();const d=this._layers[l];if(!d)return void this.fire(new o.j(new Error(`Cannot remove non-existing layer "${l}".`)));d.setEventedParent(null);const m=this._order.indexOf(l);this._order.splice(m,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[l]=d,delete this._layers[l],this._serializedLayers&&delete this._serializedLayers[l],delete this._updatedLayers[l],delete this._updatedPaintProps[l],d.onRemove&&d.onRemove(this.map)}getLayer(l){return this._layers[l]}getLayersOrder(){return[...this._order]}hasLayer(l){return l in this._layers}setLayerZoomRange(l,d,m){this._checkLoaded();const v=this.getLayer(l);v?v.minzoom===d&&v.maxzoom===m||(d!=null&&(v.minzoom=d),m!=null&&(v.maxzoom=m),this._updateLayer(v)):this.fire(new o.j(new Error(`Cannot set the zoom range of non-existing layer "${l}".`)))}setFilter(l,d){let m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this._checkLoaded();const v=this.getLayer(l);if(v){if(!o.aG(v.filter,d))return d==null?(v.filter=void 0,void this._updateLayer(v)):void(this._validate(o.y.filter,`layers.${v.id}.filter`,d,null,m)||(v.filter=o.aD(d),this._updateLayer(v)))}else this.fire(new o.j(new Error(`Cannot filter non-existing layer "${l}".`)))}getFilter(l){return o.aD(this.getLayer(l).filter)}setLayoutProperty(l,d,m){let v=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};this._checkLoaded();const E=this.getLayer(l);E?o.aG(E.getLayoutProperty(d),m)||(E.setLayoutProperty(d,m,v),this._updateLayer(E)):this.fire(new o.j(new Error(`Cannot style non-existing layer "${l}".`)))}getLayoutProperty(l,d){const m=this.getLayer(l);if(m)return m.getLayoutProperty(d);this.fire(new o.j(new Error(`Cannot get style of non-existing layer "${l}".`)))}setPaintProperty(l,d,m){let v=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};this._checkLoaded();const E=this.getLayer(l);E?o.aG(E.getPaintProperty(d),m)||(E.setPaintProperty(d,m,v)&&this._updateLayer(E),this._changed=!0,this._updatedPaintProps[l]=!0):this.fire(new o.j(new Error(`Cannot style non-existing layer "${l}".`)))}getPaintProperty(l,d){return this.getLayer(l).getPaintProperty(d)}setFeatureState(l,d){this._checkLoaded();const m=l.source,v=l.sourceLayer,E=this.sourceCaches[m];if(E===void 0)return void this.fire(new o.j(new Error(`The source '${m}' does not exist in the map's style.`)));const F=E.getSource().type;F==="geojson"&&v?this.fire(new o.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):F!=="vector"||v?(l.id===void 0&&this.fire(new o.j(new Error("The feature id parameter must be provided."))),E.setFeatureState(v,l.id,d)):this.fire(new o.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(l,d){this._checkLoaded();const m=l.source,v=this.sourceCaches[m];if(v===void 0)return void this.fire(new o.j(new Error(`The source '${m}' does not exist in the map's style.`)));const E=v.getSource().type,F=E==="vector"?l.sourceLayer:void 0;E!=="vector"||F?d&&typeof l.id!="string"&&typeof l.id!="number"?this.fire(new o.j(new Error("A feature id is required to remove its specific state property."))):v.removeFeatureState(F,l.id,d):this.fire(new o.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(l){this._checkLoaded();const d=l.source,m=l.sourceLayer,v=this.sourceCaches[d];if(v!==void 0)return v.getSource().type!=="vector"||m?(l.id===void 0&&this.fire(new o.j(new Error("The feature id parameter must be provided."))),v.getFeatureState(m,l.id)):void this.fire(new o.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new o.j(new Error(`The source '${d}' does not exist in the map's style.`)))}getTransition(){return o.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const l=o.aH(this.sourceCaches,E=>E.serialize()),d=this._serializeByIds(this._order),m=this.map.getTerrain()||void 0,v=this.stylesheet;return o.aI({version:v.version,name:v.name,metadata:v.metadata,light:v.light,center:v.center,zoom:v.zoom,bearing:v.bearing,pitch:v.pitch,sprite:v.sprite,glyphs:v.glyphs,transition:v.transition,sources:l,layers:d,terrain:m},E=>E!==void 0)}_updateLayer(l){this._updatedLayers[l.id]=!0,l.source&&!this._updatedSources[l.source]&&this.sourceCaches[l.source].getSource().type!=="raster"&&(this._updatedSources[l.source]="reload",this.sourceCaches[l.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(l){const d=F=>this._layers[F].type==="fill-extrusion",m={},v=[];for(let F=this._order.length-1;F>=0;F--){const M=this._order[F];if(d(M)){m[M]=F;for(const N of l){const G=N[M];if(G)for(const $ of G)v.push($)}}}v.sort((F,M)=>M.intersectionZ-F.intersectionZ);const E=[];for(let F=this._order.length-1;F>=0;F--){const M=this._order[F];if(d(M))for(let N=v.length-1;N>=0;N--){const G=v[N].feature;if(m[G.layer.id]<F)break;E.push(G),v.pop()}else for(const N of l){const G=N[M];if(G)for(const $ of G)E.push($.feature)}}return E}queryRenderedFeatures(l,d,m){d&&d.filter&&this._validate(o.y.filter,"queryRenderedFeatures.filter",d.filter,null,d);const v={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new o.j(new Error("parameters.layers must be an Array."))),[];for(const M of d.layers){const N=this._layers[M];if(!N)return this.fire(new o.j(new Error(`The layer '${M}' does not exist in the map's style and cannot be queried for features.`))),[];v[N.source]=!0}}const E=[];d.availableImages=this._availableImages;const F=this._serializedAllLayers();for(const M in this.sourceCaches)d.layers&&!v[M]||E.push(Ut(this.sourceCaches[M],this._layers,F,l,d,m));return this.placement&&E.push(function(M,N,G,$,J,ct,Ct){const y={},S=ct.queryRenderedSymbols($),I=[];for(const O of Object.keys(S).map(Number))I.push(Ct[O]);I.sort(pr);for(const O of I){const V=O.featureIndex.lookupSymbolFeatures(S[O.bucketInstanceId],N,O.bucketIndex,O.sourceLayerIndex,J.filter,J.layers,J.availableImages,M);for(const H in V){const q=y[H]=y[H]||[],X=V[H];X.sort((Z,ot)=>{const xt=O.featureSortOrder;if(xt){const Lt=xt.indexOf(Z.featureIndex);return xt.indexOf(ot.featureIndex)-Lt}return ot.featureIndex-Z.featureIndex});for(const Z of X)q.push(Z)}}for(const O in y)y[O].forEach(V=>{const H=V.feature,q=G[M[O].source].getFeatureState(H.layer["source-layer"],H.id);H.source=H.layer.source,H.layer["source-layer"]&&(H.sourceLayer=H.layer["source-layer"]),H.state=q});return y}(this._layers,F,this.sourceCaches,l,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(E)}querySourceFeatures(l,d){d&&d.filter&&this._validate(o.y.filter,"querySourceFeatures.filter",d.filter,null,d);const m=this.sourceCaches[l];return m?function(v,E){const F=v.getRenderableIds().map(G=>v.getTileByID(G)),M=[],N={};for(let G=0;G<F.length;G++){const $=F[G],J=$.tileID.canonical.key;N[J]||(N[J]=!0,$.querySourceFeatures(M,E))}return M}(m,d):[]}addSourceType(l,d,m){return rr(l)?m(new Error(`A source type called "${l}" already exists.`)):(((v,E)=>{Ke[v]=E})(l,d),d.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:l,url:d.workerSourceURL},m):m(null,null))}getLight(){return this.light.getLight()}setLight(l){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this._checkLoaded();const m=this.light.getLight();let v=!1;for(const F in l)if(!o.aG(l[F],m[F])){v=!0;break}if(!v)return;const E={now:o.h.now(),transition:o.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(l,d),this.light.updateTransitions(E)}_validate(l,d,m,v){let E=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};return(!E||E.validate!==!1)&&Dn(this,l.call(o.y,o.e({key:d,style:this.serialize(),value:m,styleSpec:o.v},v)))}_remove(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.aJ.off("pluginStateChange",this._rtlTextPluginCallback);for(const d in this._layers)this._layers[d].setEventedParent(null);for(const d in this.sourceCaches){const m=this.sourceCaches[d];m.setEventedParent(null),m.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(l)}_clearSource(l){this.sourceCaches[l].clearTiles()}_reloadSource(l){this.sourceCaches[l].resume(),this.sourceCaches[l].reload()}_updateSources(l){for(const d in this.sourceCaches)this.sourceCaches[d].update(l,this.map.terrain)}_generateCollisionBoxes(){for(const l in this.sourceCaches)this._reloadSource(l)}_updatePlacement(l,d,m,v){let E=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1,F=!1,M=!1;const N={};for(const G of this._order){const $=this._layers[G];if($.type!=="symbol")continue;if(!N[$.source]){const ct=this.sourceCaches[$.source];N[$.source]=ct.getRenderableIds(!0).map(Ct=>ct.getTileByID(Ct)).sort((Ct,y)=>y.tileID.overscaledZ-Ct.tileID.overscaledZ||(Ct.tileID.isLessThan(y.tileID)?-1:1))}const J=this.crossTileSymbolIndex.addLayer($,N[$.source],l.center.lng);F=F||J}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((E=E||this._layerOrderChanged||m===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.h.now(),l.zoom))&&(this.pauseablePlacement=new Vn(l,this.map.terrain,this._order,E,d,m,v,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,N),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.h.now()),M=!0),F&&this.pauseablePlacement.placement.setStale()),M||F)for(const G of this._order){const $=this._layers[G];$.type==="symbol"&&this.placement.updateLayerOpacities($,N[$.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.h.now())}_releaseSymbolFadeTiles(){for(const l in this.sourceCaches)this.sourceCaches[l].releaseSymbolFadeTiles()}getImages(l,d,m){this.imageManager.getImages(d.icons,m),this._updateTilesForChangedImages();const v=this.sourceCaches[d.source];v&&v.setDependencies(d.tileID.key,d.type,d.icons)}getGlyphs(l,d,m){this.glyphManager.getGlyphs(d.stacks,m);const v=this.sourceCaches[d.source];v&&v.setDependencies(d.tileID.key,d.type,[""])}getResource(l,d,m){return o.m(d,m)}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(l){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this._checkLoaded(),l&&this._validate(o.y.glyphs,"glyphs",l,null,d)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=l,this.glyphManager.entries={},this.glyphManager.setURL(l))}addSprite(l,d){let m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},v=arguments.length>3?arguments[3]:void 0;this._checkLoaded();const E=[{id:l,url:d}],F=[...ft(this.stylesheet.sprite),...E];this._validate(o.y.sprite,"sprite",F,null,m)||(this.stylesheet.sprite=F,this._loadSprite(E,!0,v))}removeSprite(l){this._checkLoaded();const d=ft(this.stylesheet.sprite);if(d.find(m=>m.id===l)){if(this._spritesImagesIds[l])for(const m of this._spritesImagesIds[l])this.imageManager.removeImage(m),this._changedImages[m]=!0;d.splice(d.findIndex(m=>m.id===l),1),this.stylesheet.sprite=d.length>0?d:void 0,delete this._spritesImagesIds[l],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.k("data",{dataType:"style"}))}else this.fire(new o.j(new Error(`Sprite "${l}" doesn't exists on this map.`)))}getSprite(){return ft(this.stylesheet.sprite)}setSprite(l){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},m=arguments.length>2?arguments[2]:void 0;this._checkLoaded(),l&&this._validate(o.y.sprite,"sprite",l,null,d)||(this.stylesheet.sprite=l,l?this._loadSprite(l,!0,m):(this._unloadSprite(),m&&m(null)))}}kr.registerForPluginStateChange=o.aK;var Bo=o.Q([{name:"a_pos",type:"Int16",components:2}]),Js="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const Tn={prelude:on(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:on(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:on(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:on(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:on("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:on(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:on(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:on("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:on("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:on("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:on(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:on(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:on(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:on(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:on(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:on(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:on(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:on(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:on(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:on(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:on(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:on(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:on(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:on(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:on(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:on(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:on("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Js),terrainDepth:on("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Js),terrainCoords:on("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Js)};function on(w,l){const d=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,m=l.match(/attribute ([\w]+) ([\w]+)/g),v=w.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),E=l.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),F=E?E.concat(v):v,M={};return{fragmentSource:w=w.replace(d,(N,G,$,J,ct)=>(M[ct]=!0,G==="define"?`
#ifndef HAS_UNIFORM_u_${ct}
varying ${$} ${J} ${ct};
#else
uniform ${$} ${J} u_${ct};
#endif
`:`
#ifdef HAS_UNIFORM_u_${ct}
    ${$} ${J} ${ct} = u_${ct};
#endif
`)),vertexSource:l=l.replace(d,(N,G,$,J,ct)=>{const Ct=J==="float"?"vec2":"vec4",y=ct.match(/color/)?"color":Ct;return M[ct]?G==="define"?`
#ifndef HAS_UNIFORM_u_${ct}
uniform lowp float u_${ct}_t;
attribute ${$} ${Ct} a_${ct};
varying ${$} ${J} ${ct};
#else
uniform ${$} ${J} u_${ct};
#endif
`:y==="vec4"?`
#ifndef HAS_UNIFORM_u_${ct}
    ${ct} = a_${ct};
#else
    ${$} ${J} ${ct} = u_${ct};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ct}
    ${ct} = unpack_mix_${y}(a_${ct}, u_${ct}_t);
#else
    ${$} ${J} ${ct} = u_${ct};
#endif
`:G==="define"?`
#ifndef HAS_UNIFORM_u_${ct}
uniform lowp float u_${ct}_t;
attribute ${$} ${Ct} a_${ct};
#else
uniform ${$} ${J} u_${ct};
#endif
`:y==="vec4"?`
#ifndef HAS_UNIFORM_u_${ct}
    ${$} ${J} ${ct} = a_${ct};
#else
    ${$} ${J} ${ct} = u_${ct};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ct}
    ${$} ${J} ${ct} = unpack_mix_${y}(a_${ct}, u_${ct}_t);
#else
    ${$} ${J} ${ct} = u_${ct};
#endif
`}),staticAttributes:m,staticUniforms:F}}class Ys{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(l,d,m,v,E,F,M,N,G){this.context=l;let $=this.boundPaintVertexBuffers.length!==v.length;for(let J=0;!$&&J<v.length;J++)this.boundPaintVertexBuffers[J]!==v[J]&&($=!0);!this.vao||this.boundProgram!==d||this.boundLayoutVertexBuffer!==m||$||this.boundIndexBuffer!==E||this.boundVertexOffset!==F||this.boundDynamicVertexBuffer!==M||this.boundDynamicVertexBuffer2!==N||this.boundDynamicVertexBuffer3!==G?this.freshBind(d,m,v,E,F,M,N,G):(l.bindVertexArray.set(this.vao),M&&M.bind(),E&&E.dynamicDraw&&E.bind(),N&&N.bind(),G&&G.bind())}freshBind(l,d,m,v,E,F,M,N){const G=l.numAttributes,$=this.context,J=$.gl;this.vao&&this.destroy(),this.vao=$.createVertexArray(),$.bindVertexArray.set(this.vao),this.boundProgram=l,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=m,this.boundIndexBuffer=v,this.boundVertexOffset=E,this.boundDynamicVertexBuffer=F,this.boundDynamicVertexBuffer2=M,this.boundDynamicVertexBuffer3=N,d.enableAttributes(J,l);for(const ct of m)ct.enableAttributes(J,l);F&&F.enableAttributes(J,l),M&&M.enableAttributes(J,l),N&&N.enableAttributes(J,l),d.bind(),d.setVertexAttribPointers(J,l,E);for(const ct of m)ct.bind(),ct.setVertexAttribPointers(J,l,E);F&&(F.bind(),F.setVertexAttribPointers(J,l,E)),v&&v.bind(),M&&(M.bind(),M.setVertexAttribPointers(J,l,E)),N&&(N.bind(),N.setVertexAttribPointers(J,l,E)),$.currentNumAttributes=G}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function An(w){const l=[];for(let d=0;d<w.length;d++){if(w[d]===null)continue;const m=w[d].split(" ");l.push(m.pop())}return l}class Li{constructor(l,d,m,v,E,F){const M=l.gl;this.program=M.createProgram();const N=An(d.staticAttributes),G=m?m.getBinderAttributes():[],$=N.concat(G),J=Tn.prelude.staticUniforms?An(Tn.prelude.staticUniforms):[],ct=d.staticUniforms?An(d.staticUniforms):[],Ct=m?m.getBinderUniforms():[],y=J.concat(ct).concat(Ct),S=[];for(const Z of y)S.indexOf(Z)<0&&S.push(Z);const I=m?m.defines():[];E&&I.push("#define OVERDRAW_INSPECTOR;"),F&&I.push("#define TERRAIN3D;");const O=I.concat(Tn.prelude.fragmentSource,d.fragmentSource).join(`
`),V=I.concat(Tn.prelude.vertexSource,d.vertexSource).join(`
`),H=M.createShader(M.FRAGMENT_SHADER);if(M.isContextLost())return void(this.failedToCreate=!0);if(M.shaderSource(H,O),M.compileShader(H),!M.getShaderParameter(H,M.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${M.getShaderInfoLog(H)}`);M.attachShader(this.program,H);const q=M.createShader(M.VERTEX_SHADER);if(M.isContextLost())return void(this.failedToCreate=!0);if(M.shaderSource(q,V),M.compileShader(q),!M.getShaderParameter(q,M.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${M.getShaderInfoLog(q)}`);M.attachShader(this.program,q),this.attributes={};const X={};this.numAttributes=$.length;for(let Z=0;Z<this.numAttributes;Z++)$[Z]&&(M.bindAttribLocation(this.program,Z,$[Z]),this.attributes[$[Z]]=Z);if(M.linkProgram(this.program),!M.getProgramParameter(this.program,M.LINK_STATUS))throw new Error(`Program failed to link: ${M.getProgramInfoLog(this.program)}`);M.deleteShader(q),M.deleteShader(H);for(let Z=0;Z<S.length;Z++){const ot=S[Z];if(ot&&!X[ot]){const xt=M.getUniformLocation(this.program,ot);xt&&(X[ot]=xt)}}this.fixedUniforms=v(l,X),this.terrainUniforms=((Z,ot)=>({u_depth:new o.aL(Z,ot.u_depth),u_terrain:new o.aL(Z,ot.u_terrain),u_terrain_dim:new o.aM(Z,ot.u_terrain_dim),u_terrain_matrix:new o.aN(Z,ot.u_terrain_matrix),u_terrain_unpack:new o.aO(Z,ot.u_terrain_unpack),u_terrain_exaggeration:new o.aM(Z,ot.u_terrain_exaggeration)}))(l,X),this.binderUniforms=m?m.getUniforms(l,X):[]}draw(l,d,m,v,E,F,M,N,G,$,J,ct,Ct,y,S,I,O,V){const H=l.gl;if(this.failedToCreate)return;if(l.program.set(this.program),l.setDepthMode(m),l.setStencilMode(v),l.setColorMode(E),l.setCullFace(F),N){l.activeTexture.set(H.TEXTURE2),H.bindTexture(H.TEXTURE_2D,N.depthTexture),l.activeTexture.set(H.TEXTURE3),H.bindTexture(H.TEXTURE_2D,N.texture);for(const X in this.terrainUniforms)this.terrainUniforms[X].set(N[X])}for(const X in this.fixedUniforms)this.fixedUniforms[X].set(M[X]);S&&S.setUniforms(l,this.binderUniforms,Ct,{zoom:y});let q=0;switch(d){case H.LINES:q=2;break;case H.TRIANGLES:q=3;break;case H.LINE_STRIP:q=1}for(const X of ct.get()){const Z=X.vaos||(X.vaos={});(Z[G]||(Z[G]=new Ys)).bind(l,this,$,S?S.getPaintVertexBuffers():[],J,X.vertexOffset,I,O,V),H.drawElements(d,X.primitiveLength*q,H.UNSIGNED_SHORT,X.primitiveOffset*q*2)}}}function jn(w,l,d){const m=1/Vt(d,1,l.transform.tileZoom),v=Math.pow(2,d.tileID.overscaledZ),E=d.tileSize*Math.pow(2,l.transform.tileZoom)/v,F=E*(d.tileID.canonical.x+d.tileID.wrap*v),M=E*d.tileID.canonical.y;return{u_image:0,u_texsize:d.imageAtlasTexture.size,u_scale:[m,w.fromScale,w.toScale],u_fade:w.t,u_pixel_coord_upper:[F>>16,M>>16],u_pixel_coord_lower:[65535&F,65535&M]}}const fa=(w,l,d,m)=>{const v=l.style.light,E=v.properties.get("position"),F=[E.x,E.y,E.z],M=function(){var G=new o.A(9);return o.A!=Float32Array&&(G[1]=0,G[2]=0,G[3]=0,G[5]=0,G[6]=0,G[7]=0),G[0]=1,G[4]=1,G[8]=1,G}();v.properties.get("anchor")==="viewport"&&function(G,$){var J=Math.sin($),ct=Math.cos($);G[0]=ct,G[1]=J,G[2]=0,G[3]=-J,G[4]=ct,G[5]=0,G[6]=0,G[7]=0,G[8]=1}(M,-l.transform.angle),function(G,$,J){var ct=$[0],Ct=$[1],y=$[2];G[0]=ct*J[0]+Ct*J[3]+y*J[6],G[1]=ct*J[1]+Ct*J[4]+y*J[7],G[2]=ct*J[2]+Ct*J[5]+y*J[8]}(F,F,M);const N=v.properties.get("color");return{u_matrix:w,u_lightpos:F,u_lightintensity:v.properties.get("intensity"),u_lightcolor:[N.r,N.g,N.b],u_vertical_gradient:+d,u_opacity:m}},Cs=(w,l,d,m,v,E,F)=>o.e(fa(w,l,d,m),jn(E,l,F),{u_height_factor:-Math.pow(2,v.overscaledZ)/F.tileSize/8}),Jc=w=>({u_matrix:w}),hc=(w,l,d,m)=>o.e(Jc(w),jn(d,l,m)),dc=(w,l)=>({u_matrix:w,u_world:l}),dt=(w,l,d,m,v)=>o.e(hc(w,l,d,m),{u_world:v}),bt=(w,l,d,m)=>{const v=w.transform;let E,F;if(m.paint.get("circle-pitch-alignment")==="map"){const M=Vt(d,1,v.zoom);E=!0,F=[M,M]}else E=!1,F=v.pixelsToGLUnits;return{u_camera_to_center_distance:v.cameraToCenterDistance,u_scale_with_map:+(m.paint.get("circle-pitch-scale")==="map"),u_matrix:w.translatePosMatrix(l.posMatrix,d,m.paint.get("circle-translate"),m.paint.get("circle-translate-anchor")),u_pitch_with_map:+E,u_device_pixel_ratio:w.pixelRatio,u_extrude_scale:F}},jt=(w,l,d)=>{const m=Vt(d,1,l.zoom),v=Math.pow(2,l.zoom-d.tileID.overscaledZ),E=d.tileID.overscaleFactor();return{u_matrix:w,u_camera_to_center_distance:l.cameraToCenterDistance,u_pixels_to_tile_units:m,u_extrude_scale:[l.pixelsToGLUnits[0]/(m*v),l.pixelsToGLUnits[1]/(m*v)],u_overscale_factor:E}},pe=function(w,l){let d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;return{u_matrix:w,u_color:l,u_overlay:0,u_overlay_scale:d}},Ue=w=>({u_matrix:w}),cr=(w,l,d,m)=>({u_matrix:w,u_extrude_scale:Vt(l,1,d),u_intensity:m});function Qr(w,l){const d=Math.pow(2,l.canonical.z),m=l.canonical.y;return[new o.U(0,m/d).toLngLat().lat,new o.U(0,(m+1)/d).toLngLat().lat]}const qn=(w,l,d,m)=>{const v=w.transform;return{u_matrix:Yc(w,l,d,m),u_ratio:1/Vt(l,1,v.zoom),u_device_pixel_ratio:w.pixelRatio,u_units_to_pixels:[1/v.pixelsToGLUnits[0],1/v.pixelsToGLUnits[1]]}},ti=(w,l,d,m,v)=>o.e(qn(w,l,d,v),{u_image:0,u_image_height:m}),Bi=(w,l,d,m,v)=>{const E=w.transform,F=Vu(l,E);return{u_matrix:Yc(w,l,d,v),u_texsize:l.imageAtlasTexture.size,u_ratio:1/Vt(l,1,E.zoom),u_device_pixel_ratio:w.pixelRatio,u_image:0,u_scale:[F,m.fromScale,m.toScale],u_fade:m.t,u_units_to_pixels:[1/E.pixelsToGLUnits[0],1/E.pixelsToGLUnits[1]]}},zn=(w,l,d,m,v,E)=>{const F=w.lineAtlas,M=Vu(l,w.transform),N=d.layout.get("line-cap")==="round",G=F.getDash(m.from,N),$=F.getDash(m.to,N),J=G.width*v.fromScale,ct=$.width*v.toScale;return o.e(qn(w,l,d,E),{u_patternscale_a:[M/J,-G.height/2],u_patternscale_b:[M/ct,-$.height/2],u_sdfgamma:F.width/(256*Math.min(J,ct)*w.pixelRatio)/2,u_image:0,u_tex_y_a:G.y,u_tex_y_b:$.y,u_mix:v.t})};function Vu(w,l){return 1/Vt(w,1,l.tileZoom)}function Yc(w,l,d,m){return w.translatePosMatrix(m?m.posMatrix:l.tileID.posMatrix,l,d.paint.get("line-translate"),d.paint.get("line-translate-anchor"))}const $r=(w,l,d,m,v)=>{return{u_matrix:w,u_tl_parent:l,u_scale_parent:d,u_buffer_scale:1,u_fade_t:m.mix,u_opacity:m.opacity*v.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:v.paint.get("raster-brightness-min"),u_brightness_high:v.paint.get("raster-brightness-max"),u_saturation_factor:(F=v.paint.get("raster-saturation"),F>0?1-1/(1.001-F):-F),u_contrast_factor:(E=v.paint.get("raster-contrast"),E>0?1/(1-E):1+E),u_spin_weights:ju(v.paint.get("raster-hue-rotate"))};var E,F};function ju(w){w*=Math.PI/180;const l=Math.sin(w),d=Math.cos(w);return[(2*d+1)/3,(-Math.sqrt(3)*l-d+1)/3,(Math.sqrt(3)*l-d+1)/3]}const HA=(w,l,d,m,v,E,F,M,N,G)=>{const $=v.transform;return{u_is_size_zoom_constant:+(w==="constant"||w==="source"),u_is_size_feature_constant:+(w==="constant"||w==="camera"),u_size_t:l?l.uSizeT:0,u_size:l?l.uSize:0,u_camera_to_center_distance:$.cameraToCenterDistance,u_pitch:$.pitch/360*2*Math.PI,u_rotate_symbol:+d,u_aspect_ratio:$.width/$.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_matrix:E,u_label_plane_matrix:F,u_coord_matrix:M,u_is_text:+N,u_pitch_with_map:+m,u_texsize:G,u_texture:0}},Co=(w,l,d,m,v,E,F,M,N,G,$)=>{const J=v.transform;return o.e(HA(w,l,d,m,v,E,F,M,N,G),{u_gamma_scale:m?Math.cos(J._pitch)*J.cameraToCenterDistance:1,u_device_pixel_ratio:v.pixelRatio,u_is_halo:+$})},pa=(w,l,d,m,v,E,F,M,N,G)=>o.e(Co(w,l,d,m,v,E,F,M,!0,N,!0),{u_texsize_icon:G,u_texture_icon:1}),Zc=(w,l,d)=>({u_matrix:w,u_opacity:l,u_color:d}),es=(w,l,d,m,v,E)=>o.e(function(F,M,N,G){const $=N.imageManager.getPattern(F.from.toString()),J=N.imageManager.getPattern(F.to.toString()),{width:ct,height:Ct}=N.imageManager.getPixelSize(),y=Math.pow(2,G.tileID.overscaledZ),S=G.tileSize*Math.pow(2,N.transform.tileZoom)/y,I=S*(G.tileID.canonical.x+G.tileID.wrap*y),O=S*G.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:$.tl,u_pattern_br_a:$.br,u_pattern_tl_b:J.tl,u_pattern_br_b:J.br,u_texsize:[ct,Ct],u_mix:M.t,u_pattern_size_a:$.displaySize,u_pattern_size_b:J.displaySize,u_scale_a:M.fromScale,u_scale_b:M.toScale,u_tile_units_to_pixels:1/Vt(G,1,N.transform.tileZoom),u_pixel_coord_upper:[I>>16,O>>16],u_pixel_coord_lower:[65535&I,65535&O]}}(m,E,d,v),{u_matrix:w,u_opacity:l}),fc={fillExtrusion:(w,l)=>({u_matrix:new o.aN(w,l.u_matrix),u_lightpos:new o.aP(w,l.u_lightpos),u_lightintensity:new o.aM(w,l.u_lightintensity),u_lightcolor:new o.aP(w,l.u_lightcolor),u_vertical_gradient:new o.aM(w,l.u_vertical_gradient),u_opacity:new o.aM(w,l.u_opacity)}),fillExtrusionPattern:(w,l)=>({u_matrix:new o.aN(w,l.u_matrix),u_lightpos:new o.aP(w,l.u_lightpos),u_lightintensity:new o.aM(w,l.u_lightintensity),u_lightcolor:new o.aP(w,l.u_lightcolor),u_vertical_gradient:new o.aM(w,l.u_vertical_gradient),u_height_factor:new o.aM(w,l.u_height_factor),u_image:new o.aL(w,l.u_image),u_texsize:new o.aQ(w,l.u_texsize),u_pixel_coord_upper:new o.aQ(w,l.u_pixel_coord_upper),u_pixel_coord_lower:new o.aQ(w,l.u_pixel_coord_lower),u_scale:new o.aP(w,l.u_scale),u_fade:new o.aM(w,l.u_fade),u_opacity:new o.aM(w,l.u_opacity)}),fill:(w,l)=>({u_matrix:new o.aN(w,l.u_matrix)}),fillPattern:(w,l)=>({u_matrix:new o.aN(w,l.u_matrix),u_image:new o.aL(w,l.u_image),u_texsize:new o.aQ(w,l.u_texsize),u_pixel_coord_upper:new o.aQ(w,l.u_pixel_coord_upper),u_pixel_coord_lower:new o.aQ(w,l.u_pixel_coord_lower),u_scale:new o.aP(w,l.u_scale),u_fade:new o.aM(w,l.u_fade)}),fillOutline:(w,l)=>({u_matrix:new o.aN(w,l.u_matrix),u_world:new o.aQ(w,l.u_world)}),fillOutlinePattern:(w,l)=>({u_matrix:new o.aN(w,l.u_matrix),u_world:new o.aQ(w,l.u_world),u_image:new o.aL(w,l.u_image),u_texsize:new o.aQ(w,l.u_texsize),u_pixel_coord_upper:new o.aQ(w,l.u_pixel_coord_upper),u_pixel_coord_lower:new o.aQ(w,l.u_pixel_coord_lower),u_scale:new o.aP(w,l.u_scale),u_fade:new o.aM(w,l.u_fade)}),circle:(w,l)=>({u_camera_to_center_distance:new o.aM(w,l.u_camera_to_center_distance),u_scale_with_map:new o.aL(w,l.u_scale_with_map),u_pitch_with_map:new o.aL(w,l.u_pitch_with_map),u_extrude_scale:new o.aQ(w,l.u_extrude_scale),u_device_pixel_ratio:new o.aM(w,l.u_device_pixel_ratio),u_matrix:new o.aN(w,l.u_matrix)}),collisionBox:(w,l)=>({u_matrix:new o.aN(w,l.u_matrix),u_camera_to_center_distance:new o.aM(w,l.u_camera_to_center_distance),u_pixels_to_tile_units:new o.aM(w,l.u_pixels_to_tile_units),u_extrude_scale:new o.aQ(w,l.u_extrude_scale),u_overscale_factor:new o.aM(w,l.u_overscale_factor)}),collisionCircle:(w,l)=>({u_matrix:new o.aN(w,l.u_matrix),u_inv_matrix:new o.aN(w,l.u_inv_matrix),u_camera_to_center_distance:new o.aM(w,l.u_camera_to_center_distance),u_viewport_size:new o.aQ(w,l.u_viewport_size)}),debug:(w,l)=>({u_color:new o.aR(w,l.u_color),u_matrix:new o.aN(w,l.u_matrix),u_overlay:new o.aL(w,l.u_overlay),u_overlay_scale:new o.aM(w,l.u_overlay_scale)}),clippingMask:(w,l)=>({u_matrix:new o.aN(w,l.u_matrix)}),heatmap:(w,l)=>({u_extrude_scale:new o.aM(w,l.u_extrude_scale),u_intensity:new o.aM(w,l.u_intensity),u_matrix:new o.aN(w,l.u_matrix)}),heatmapTexture:(w,l)=>({u_matrix:new o.aN(w,l.u_matrix),u_world:new o.aQ(w,l.u_world),u_image:new o.aL(w,l.u_image),u_color_ramp:new o.aL(w,l.u_color_ramp),u_opacity:new o.aM(w,l.u_opacity)}),hillshade:(w,l)=>({u_matrix:new o.aN(w,l.u_matrix),u_image:new o.aL(w,l.u_image),u_latrange:new o.aQ(w,l.u_latrange),u_light:new o.aQ(w,l.u_light),u_shadow:new o.aR(w,l.u_shadow),u_highlight:new o.aR(w,l.u_highlight),u_accent:new o.aR(w,l.u_accent)}),hillshadePrepare:(w,l)=>({u_matrix:new o.aN(w,l.u_matrix),u_image:new o.aL(w,l.u_image),u_dimension:new o.aQ(w,l.u_dimension),u_zoom:new o.aM(w,l.u_zoom),u_unpack:new o.aO(w,l.u_unpack)}),line:(w,l)=>({u_matrix:new o.aN(w,l.u_matrix),u_ratio:new o.aM(w,l.u_ratio),u_device_pixel_ratio:new o.aM(w,l.u_device_pixel_ratio),u_units_to_pixels:new o.aQ(w,l.u_units_to_pixels)}),lineGradient:(w,l)=>({u_matrix:new o.aN(w,l.u_matrix),u_ratio:new o.aM(w,l.u_ratio),u_device_pixel_ratio:new o.aM(w,l.u_device_pixel_ratio),u_units_to_pixels:new o.aQ(w,l.u_units_to_pixels),u_image:new o.aL(w,l.u_image),u_image_height:new o.aM(w,l.u_image_height)}),linePattern:(w,l)=>({u_matrix:new o.aN(w,l.u_matrix),u_texsize:new o.aQ(w,l.u_texsize),u_ratio:new o.aM(w,l.u_ratio),u_device_pixel_ratio:new o.aM(w,l.u_device_pixel_ratio),u_image:new o.aL(w,l.u_image),u_units_to_pixels:new o.aQ(w,l.u_units_to_pixels),u_scale:new o.aP(w,l.u_scale),u_fade:new o.aM(w,l.u_fade)}),lineSDF:(w,l)=>({u_matrix:new o.aN(w,l.u_matrix),u_ratio:new o.aM(w,l.u_ratio),u_device_pixel_ratio:new o.aM(w,l.u_device_pixel_ratio),u_units_to_pixels:new o.aQ(w,l.u_units_to_pixels),u_patternscale_a:new o.aQ(w,l.u_patternscale_a),u_patternscale_b:new o.aQ(w,l.u_patternscale_b),u_sdfgamma:new o.aM(w,l.u_sdfgamma),u_image:new o.aL(w,l.u_image),u_tex_y_a:new o.aM(w,l.u_tex_y_a),u_tex_y_b:new o.aM(w,l.u_tex_y_b),u_mix:new o.aM(w,l.u_mix)}),raster:(w,l)=>({u_matrix:new o.aN(w,l.u_matrix),u_tl_parent:new o.aQ(w,l.u_tl_parent),u_scale_parent:new o.aM(w,l.u_scale_parent),u_buffer_scale:new o.aM(w,l.u_buffer_scale),u_fade_t:new o.aM(w,l.u_fade_t),u_opacity:new o.aM(w,l.u_opacity),u_image0:new o.aL(w,l.u_image0),u_image1:new o.aL(w,l.u_image1),u_brightness_low:new o.aM(w,l.u_brightness_low),u_brightness_high:new o.aM(w,l.u_brightness_high),u_saturation_factor:new o.aM(w,l.u_saturation_factor),u_contrast_factor:new o.aM(w,l.u_contrast_factor),u_spin_weights:new o.aP(w,l.u_spin_weights)}),symbolIcon:(w,l)=>({u_is_size_zoom_constant:new o.aL(w,l.u_is_size_zoom_constant),u_is_size_feature_constant:new o.aL(w,l.u_is_size_feature_constant),u_size_t:new o.aM(w,l.u_size_t),u_size:new o.aM(w,l.u_size),u_camera_to_center_distance:new o.aM(w,l.u_camera_to_center_distance),u_pitch:new o.aM(w,l.u_pitch),u_rotate_symbol:new o.aL(w,l.u_rotate_symbol),u_aspect_ratio:new o.aM(w,l.u_aspect_ratio),u_fade_change:new o.aM(w,l.u_fade_change),u_matrix:new o.aN(w,l.u_matrix),u_label_plane_matrix:new o.aN(w,l.u_label_plane_matrix),u_coord_matrix:new o.aN(w,l.u_coord_matrix),u_is_text:new o.aL(w,l.u_is_text),u_pitch_with_map:new o.aL(w,l.u_pitch_with_map),u_texsize:new o.aQ(w,l.u_texsize),u_texture:new o.aL(w,l.u_texture)}),symbolSDF:(w,l)=>({u_is_size_zoom_constant:new o.aL(w,l.u_is_size_zoom_constant),u_is_size_feature_constant:new o.aL(w,l.u_is_size_feature_constant),u_size_t:new o.aM(w,l.u_size_t),u_size:new o.aM(w,l.u_size),u_camera_to_center_distance:new o.aM(w,l.u_camera_to_center_distance),u_pitch:new o.aM(w,l.u_pitch),u_rotate_symbol:new o.aL(w,l.u_rotate_symbol),u_aspect_ratio:new o.aM(w,l.u_aspect_ratio),u_fade_change:new o.aM(w,l.u_fade_change),u_matrix:new o.aN(w,l.u_matrix),u_label_plane_matrix:new o.aN(w,l.u_label_plane_matrix),u_coord_matrix:new o.aN(w,l.u_coord_matrix),u_is_text:new o.aL(w,l.u_is_text),u_pitch_with_map:new o.aL(w,l.u_pitch_with_map),u_texsize:new o.aQ(w,l.u_texsize),u_texture:new o.aL(w,l.u_texture),u_gamma_scale:new o.aM(w,l.u_gamma_scale),u_device_pixel_ratio:new o.aM(w,l.u_device_pixel_ratio),u_is_halo:new o.aL(w,l.u_is_halo)}),symbolTextAndIcon:(w,l)=>({u_is_size_zoom_constant:new o.aL(w,l.u_is_size_zoom_constant),u_is_size_feature_constant:new o.aL(w,l.u_is_size_feature_constant),u_size_t:new o.aM(w,l.u_size_t),u_size:new o.aM(w,l.u_size),u_camera_to_center_distance:new o.aM(w,l.u_camera_to_center_distance),u_pitch:new o.aM(w,l.u_pitch),u_rotate_symbol:new o.aL(w,l.u_rotate_symbol),u_aspect_ratio:new o.aM(w,l.u_aspect_ratio),u_fade_change:new o.aM(w,l.u_fade_change),u_matrix:new o.aN(w,l.u_matrix),u_label_plane_matrix:new o.aN(w,l.u_label_plane_matrix),u_coord_matrix:new o.aN(w,l.u_coord_matrix),u_is_text:new o.aL(w,l.u_is_text),u_pitch_with_map:new o.aL(w,l.u_pitch_with_map),u_texsize:new o.aQ(w,l.u_texsize),u_texsize_icon:new o.aQ(w,l.u_texsize_icon),u_texture:new o.aL(w,l.u_texture),u_texture_icon:new o.aL(w,l.u_texture_icon),u_gamma_scale:new o.aM(w,l.u_gamma_scale),u_device_pixel_ratio:new o.aM(w,l.u_device_pixel_ratio),u_is_halo:new o.aL(w,l.u_is_halo)}),background:(w,l)=>({u_matrix:new o.aN(w,l.u_matrix),u_opacity:new o.aM(w,l.u_opacity),u_color:new o.aR(w,l.u_color)}),backgroundPattern:(w,l)=>({u_matrix:new o.aN(w,l.u_matrix),u_opacity:new o.aM(w,l.u_opacity),u_image:new o.aL(w,l.u_image),u_pattern_tl_a:new o.aQ(w,l.u_pattern_tl_a),u_pattern_br_a:new o.aQ(w,l.u_pattern_br_a),u_pattern_tl_b:new o.aQ(w,l.u_pattern_tl_b),u_pattern_br_b:new o.aQ(w,l.u_pattern_br_b),u_texsize:new o.aQ(w,l.u_texsize),u_mix:new o.aM(w,l.u_mix),u_pattern_size_a:new o.aQ(w,l.u_pattern_size_a),u_pattern_size_b:new o.aQ(w,l.u_pattern_size_b),u_scale_a:new o.aM(w,l.u_scale_a),u_scale_b:new o.aM(w,l.u_scale_b),u_pixel_coord_upper:new o.aQ(w,l.u_pixel_coord_upper),u_pixel_coord_lower:new o.aQ(w,l.u_pixel_coord_lower),u_tile_units_to_pixels:new o.aM(w,l.u_tile_units_to_pixels)}),terrain:(w,l)=>({u_matrix:new o.aN(w,l.u_matrix),u_texture:new o.aL(w,l.u_texture),u_ele_delta:new o.aM(w,l.u_ele_delta)}),terrainDepth:(w,l)=>({u_matrix:new o.aN(w,l.u_matrix),u_ele_delta:new o.aM(w,l.u_ele_delta)}),terrainCoords:(w,l)=>({u_matrix:new o.aN(w,l.u_matrix),u_texture:new o.aL(w,l.u_texture),u_terrain_coords_id:new o.aM(w,l.u_terrain_coords_id),u_ele_delta:new o.aM(w,l.u_ele_delta)})};class ql{constructor(l,d,m){this.context=l;const v=l.gl;this.buffer=v.createBuffer(),this.dynamicDraw=!!m,this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),v.bufferData(v.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(l){const d=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const tl={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Kl{constructor(l,d,m,v){this.length=d.length,this.attributes=m,this.itemSize=d.bytesPerElement,this.dynamicDraw=v,this.context=l;const E=l.gl;this.buffer=E.createBuffer(),l.bindVertexBuffer.set(this.buffer),E.bufferData(E.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?E.DYNAMIC_DRAW:E.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(l){if(l.length!==this.length)throw new Error(`Length of new data is ${l.length}, which doesn't match current length of ${this.length}`);const d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,l.arrayBuffer)}enableAttributes(l,d){for(let m=0;m<this.attributes.length;m++){const v=d.attributes[this.attributes[m].name];v!==void 0&&l.enableVertexAttribArray(v)}}setVertexAttribPointers(l,d,m){for(let v=0;v<this.attributes.length;v++){const E=this.attributes[v],F=d.attributes[E.name];F!==void 0&&l.vertexAttribPointer(F,E.components,l[tl[E.type]],!1,this.itemSize,E.offset+this.itemSize*(m||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ga=new WeakMap;function Us(w){var l;if(ga.has(w))return ga.get(w);{const d=(l=w.getParameter(w.VERSION))===null||l===void 0?void 0:l.startsWith("WebGL 2.0");return ga.set(w,d),d}}class Zr{constructor(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(l){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class $l extends Zr{getDefault(){return o.aT.transparent}set(l){const d=this.current;(l.r!==d.r||l.g!==d.g||l.b!==d.b||l.a!==d.a||this.dirty)&&(this.gl.clearColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class Fi extends Zr{getDefault(){return 1}set(l){(l!==this.current||this.dirty)&&(this.gl.clearDepth(l),this.current=l,this.dirty=!1)}}class rs extends Zr{getDefault(){return 0}set(l){(l!==this.current||this.dirty)&&(this.gl.clearStencil(l),this.current=l,this.dirty=!1)}}class pc extends Zr{getDefault(){return[!0,!0,!0,!0]}set(l){const d=this.current;(l[0]!==d[0]||l[1]!==d[1]||l[2]!==d[2]||l[3]!==d[3]||this.dirty)&&(this.gl.colorMask(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class el extends Zr{getDefault(){return!0}set(l){(l!==this.current||this.dirty)&&(this.gl.depthMask(l),this.current=l,this.dirty=!1)}}class rl extends Zr{getDefault(){return 255}set(l){(l!==this.current||this.dirty)&&(this.gl.stencilMask(l),this.current=l,this.dirty=!1)}}class Wl extends Zr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(l){const d=this.current;(l.func!==d.func||l.ref!==d.ref||l.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(l.func,l.ref,l.mask),this.current=l,this.dirty=!1)}}class Xl extends Zr{getDefault(){const l=this.gl;return[l.KEEP,l.KEEP,l.KEEP]}set(l){const d=this.current;(l[0]!==d[0]||l[1]!==d[1]||l[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(l[0],l[1],l[2]),this.current=l,this.dirty=!1)}}class Eo extends Zr{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;l?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=l,this.dirty=!1}}class ma extends Zr{getDefault(){return[0,1]}set(l){const d=this.current;(l[0]!==d[0]||l[1]!==d[1]||this.dirty)&&(this.gl.depthRange(l[0],l[1]),this.current=l,this.dirty=!1)}}class GA extends Zr{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;l?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=l,this.dirty=!1}}class Wo extends Zr{getDefault(){return this.gl.LESS}set(l){(l!==this.current||this.dirty)&&(this.gl.depthFunc(l),this.current=l,this.dirty=!1)}}class So extends Zr{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;l?d.enable(d.BLEND):d.disable(d.BLEND),this.current=l,this.dirty=!1}}class Jl extends Zr{getDefault(){const l=this.gl;return[l.ONE,l.ZERO]}set(l){const d=this.current;(l[0]!==d[0]||l[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(l[0],l[1]),this.current=l,this.dirty=!1)}}class To extends Zr{getDefault(){return o.aT.transparent}set(l){const d=this.current;(l.r!==d.r||l.g!==d.g||l.b!==d.b||l.a!==d.a||this.dirty)&&(this.gl.blendColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class Xh extends Zr{getDefault(){return this.gl.FUNC_ADD}set(l){(l!==this.current||this.dirty)&&(this.gl.blendEquation(l),this.current=l,this.dirty=!1)}}class Yl extends Zr{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;l?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=l,this.dirty=!1}}class Jh extends Zr{getDefault(){return this.gl.BACK}set(l){(l!==this.current||this.dirty)&&(this.gl.cullFace(l),this.current=l,this.dirty=!1)}}class VA extends Zr{getDefault(){return this.gl.CCW}set(l){(l!==this.current||this.dirty)&&(this.gl.frontFace(l),this.current=l,this.dirty=!1)}}class jA extends Zr{getDefault(){return null}set(l){(l!==this.current||this.dirty)&&(this.gl.useProgram(l),this.current=l,this.dirty=!1)}}class qu extends Zr{getDefault(){return this.gl.TEXTURE0}set(l){(l!==this.current||this.dirty)&&(this.gl.activeTexture(l),this.current=l,this.dirty=!1)}}class gc extends Zr{getDefault(){const l=this.gl;return[0,0,l.drawingBufferWidth,l.drawingBufferHeight]}set(l){const d=this.current;(l[0]!==d[0]||l[1]!==d[1]||l[2]!==d[2]||l[3]!==d[3]||this.dirty)&&(this.gl.viewport(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class mc extends Zr{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,l),this.current=l,this.dirty=!1}}class nl extends Zr{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class Zl extends Zr{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.bindTexture(d.TEXTURE_2D,l),this.current=l,this.dirty=!1}}class yc extends Zr{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class il extends Zr{getDefault(){return null}set(l){const d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class _c extends Zr{getDefault(){return null}set(l){var d;if(l===this.current&&!this.dirty)return;const m=this.gl;Us(m)?m.bindVertexArray(l):(d=m.getExtension("OES_vertex_array_object"))===null||d===void 0||d.bindVertexArrayOES(l),this.current=l,this.dirty=!1}}class sl extends Zr{getDefault(){return 4}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,l),this.current=l,this.dirty=!1}}class Rs extends Zr{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,l),this.current=l,this.dirty=!1}}class tA extends Zr{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,l),this.current=l,this.dirty=!1}}class U extends Zr{constructor(l,d){super(l),this.context=l,this.parent=d}getDefault(){return null}}class nt extends U{setDirty(){this.dirty=!0}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,l,0),this.current=l,this.dirty=!1}}class Pt extends U{set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class Yt extends U{set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_STENCIL_ATTACHMENT,d.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class Zt{constructor(l,d,m,v,E){this.context=l,this.width=d,this.height=m;const F=l.gl,M=this.framebuffer=F.createFramebuffer();if(this.colorAttachment=new nt(l,M),v)this.depthAttachment=E?new Yt(l,M):new Pt(l,M);else if(E)throw new Error("Stencil cannot be setted without depth");if(F.checkFramebufferStatus(F.FRAMEBUFFER)!==F.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const l=this.context.gl,d=this.colorAttachment.get();if(d&&l.deleteTexture(d),this.depthAttachment){const m=this.depthAttachment.get();m&&l.deleteRenderbuffer(m)}l.deleteFramebuffer(this.framebuffer)}}class ge{constructor(l,d,m){this.blendFunction=l,this.blendColor=d,this.mask=m}}ge.Replace=[1,0],ge.disabled=new ge(ge.Replace,o.aT.transparent,[!1,!1,!1,!1]),ge.unblended=new ge(ge.Replace,o.aT.transparent,[!0,!0,!0,!0]),ge.alphaBlended=new ge([1,771],o.aT.transparent,[!0,!0,!0,!0]);class ze{constructor(l){var d,m;if(this.gl=l,this.clearColor=new $l(this),this.clearDepth=new Fi(this),this.clearStencil=new rs(this),this.colorMask=new pc(this),this.depthMask=new el(this),this.stencilMask=new rl(this),this.stencilFunc=new Wl(this),this.stencilOp=new Xl(this),this.stencilTest=new Eo(this),this.depthRange=new ma(this),this.depthTest=new GA(this),this.depthFunc=new Wo(this),this.blend=new So(this),this.blendFunc=new Jl(this),this.blendColor=new To(this),this.blendEquation=new Xh(this),this.cullFace=new Yl(this),this.cullFaceSide=new Jh(this),this.frontFace=new VA(this),this.program=new jA(this),this.activeTexture=new qu(this),this.viewport=new gc(this),this.bindFramebuffer=new mc(this),this.bindRenderbuffer=new nl(this),this.bindTexture=new Zl(this),this.bindVertexBuffer=new yc(this),this.bindElementBuffer=new il(this),this.bindVertexArray=new _c(this),this.pixelStoreUnpack=new sl(this),this.pixelStoreUnpackPremultiplyAlpha=new Rs(this),this.pixelStoreUnpackFlipY=new tA(this),this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE),Us(l)){this.HALF_FLOAT=l.HALF_FLOAT;const v=l.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(d=l.RGBA16F)!==null&&d!==void 0?d:v==null?void 0:v.RGBA16F_EXT,this.RGB16F=(m=l.RGB16F)!==null&&m!==void 0?m:v==null?void 0:v.RGB16F_EXT,l.getExtension("EXT_color_buffer_float")}else{l.getExtension("EXT_color_buffer_half_float"),l.getExtension("OES_texture_half_float_linear");const v=l.getExtension("OES_texture_half_float");this.HALF_FLOAT=v==null?void 0:v.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(l,d){return new ql(this,l,d)}createVertexBuffer(l,d,m){return new Kl(this,l,d,m)}createRenderbuffer(l,d,m){const v=this.gl,E=v.createRenderbuffer();return this.bindRenderbuffer.set(E),v.renderbufferStorage(v.RENDERBUFFER,l,d,m),this.bindRenderbuffer.set(null),E}createFramebuffer(l,d,m,v){return new Zt(this,l,d,m,v)}clear(l){let{color:d,depth:m,stencil:v}=l;const E=this.gl;let F=0;d&&(F|=E.COLOR_BUFFER_BIT,this.clearColor.set(d),this.colorMask.set([!0,!0,!0,!0])),m!==void 0&&(F|=E.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(m),this.depthMask.set(!0)),v!==void 0&&(F|=E.STENCIL_BUFFER_BIT,this.clearStencil.set(v),this.stencilMask.set(255)),E.clear(F)}setCullFace(l){l.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))}setDepthMode(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)}setStencilMode(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)}setColorMode(l){o.aG(l.blendFunction,ge.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor)),this.colorMask.set(l.mask)}createVertexArray(){var l;return Us(this.gl)?this.gl.createVertexArray():(l=this.gl.getExtension("OES_vertex_array_object"))===null||l===void 0?void 0:l.createVertexArrayOES()}deleteVertexArray(l){var d;return Us(this.gl)?this.gl.deleteVertexArray(l):(d=this.gl.getExtension("OES_vertex_array_object"))===null||d===void 0?void 0:d.deleteVertexArrayOES(l)}unbindVAO(){this.bindVertexArray.set(null)}}class Me{constructor(l,d,m){this.func=l,this.mask=d,this.range=m}}Me.ReadOnly=!1,Me.ReadWrite=!0,Me.disabled=new Me(519,Me.ReadOnly,[0,1]);const Ir=7680;class mr{constructor(l,d,m,v,E,F){this.test=l,this.ref=d,this.mask=m,this.fail=v,this.depthFail=E,this.pass=F}}mr.disabled=new mr({func:519,mask:0},0,0,Ir,Ir,Ir);class wr{constructor(l,d,m){this.enable=l,this.mode=d,this.frontFace=m}}let un;function si(w,l,d,m,v,E,F){const M=w.context,N=M.gl,G=w.useProgram("collisionBox"),$=[];let J=0,ct=0;for(let H=0;H<m.length;H++){const q=m[H],X=l.getTile(q),Z=X.getBucket(d);if(!Z)continue;let ot=q.posMatrix;v[0]===0&&v[1]===0||(ot=w.translatePosMatrix(q.posMatrix,X,v,E));const xt=F?Z.textCollisionBox:Z.iconCollisionBox,Lt=Z.collisionCircleArray;if(Lt.length>0){const kt=o.Z(),zt=ot;o.aU(kt,Z.placementInvProjMatrix,w.transform.glCoordMatrix),o.aU(kt,kt,Z.placementViewportMatrix),$.push({circleArray:Lt,circleOffset:ct,transform:zt,invTransform:kt,coord:q}),J+=Lt.length/4,ct=J}xt&&G.draw(M,N.LINES,Me.disabled,mr.disabled,w.colorModeForRenderPass(),wr.disabled,jt(ot,w.transform,X),w.style.map.terrain&&w.style.map.terrain.getTerrainData(q),d.id,xt.layoutVertexBuffer,xt.indexBuffer,xt.segments,null,w.transform.zoom,null,null,xt.collisionVertexBuffer)}if(!F||!$.length)return;const Ct=w.useProgram("collisionCircle"),y=new o.aV;y.resize(4*J),y._trim();let S=0;for(const H of $)for(let q=0;q<H.circleArray.length/4;q++){const X=4*q,Z=H.circleArray[X+0],ot=H.circleArray[X+1],xt=H.circleArray[X+2],Lt=H.circleArray[X+3];y.emplace(S++,Z,ot,xt,Lt,0),y.emplace(S++,Z,ot,xt,Lt,1),y.emplace(S++,Z,ot,xt,Lt,2),y.emplace(S++,Z,ot,xt,Lt,3)}(!un||un.length<2*J)&&(un=function(H){const q=2*H,X=new o.aX;X.resize(q),X._trim();for(let Z=0;Z<q;Z++){const ot=6*Z;X.uint16[ot+0]=4*Z+0,X.uint16[ot+1]=4*Z+1,X.uint16[ot+2]=4*Z+2,X.uint16[ot+3]=4*Z+2,X.uint16[ot+4]=4*Z+3,X.uint16[ot+5]=4*Z+0}return X}(J));const I=M.createIndexBuffer(un,!0),O=M.createVertexBuffer(y,o.aW.members,!0);for(const H of $){const q={u_matrix:H.transform,u_inv_matrix:H.invTransform,u_camera_to_center_distance:(V=w.transform).cameraToCenterDistance,u_viewport_size:[V.width,V.height]};Ct.draw(M,N.TRIANGLES,Me.disabled,mr.disabled,w.colorModeForRenderPass(),wr.disabled,q,w.style.map.terrain&&w.style.map.terrain.getTerrainData(H.coord),d.id,O,I,o.S.simpleSegment(0,2*H.circleOffset,H.circleArray.length,H.circleArray.length/2),null,w.transform.zoom,null,null,null)}var V;O.destroy(),I.destroy()}wr.disabled=new wr(!1,1029,2305),wr.backCCW=new wr(!0,1029,2305);const hi=o.ao(new Float32Array(16));function di(w,l,d,m,v,E){const{horizontalAlign:F,verticalAlign:M}=o.au(w);return new o.P((-(F-.5)*l/v+m[0])*E,(-(M-.5)*d/v+m[1])*E)}function Mi(w,l,d,m,v,E,F,M,N,G,$){const J=w.text.placedSymbolArray,ct=w.text.dynamicLayoutVertexArray,Ct=w.icon.dynamicLayoutVertexArray,y={};ct.clear();for(let S=0;S<J.length;S++){const I=J.get(S),O=I.hidden||!I.crossTileID||w.allowVerticalPlacement&&!I.placedOrientation?null:m[I.crossTileID];if(O){const V=new o.P(I.anchorX,I.anchorY),H=Vr(V,d?F:E,$),q=qr(v.cameraToCenterDistance,H.signedDistanceFromCamera);let X=o.aj(w.textSizeData,N,I)*q/o.ap;d&&(X*=w.tilePixelRatio/M);const{width:Z,height:ot,anchor:xt,textOffset:Lt,textBoxScale:kt}=O,zt=di(xt,Z,ot,Lt,kt,X),me=d?Vr(V.add(zt),E,$).point:H.point.add(l?zt.rotate(-v.angle):zt),Wt=w.allowVerticalPlacement&&I.placedOrientation===o.ai.vertical?Math.PI/2:0;for(let Ot=0;Ot<I.numGlyphs;Ot++)o.ak(ct,me,Wt);G&&I.associatedIconIndex>=0&&(y[I.associatedIconIndex]={shiftedAnchor:me,angle:Wt})}else gt(I.numGlyphs,ct)}if(G){Ct.clear();const S=w.icon.placedSymbolArray;for(let I=0;I<S.length;I++){const O=S.get(I);if(O.hidden)gt(O.numGlyphs,Ct);else{const V=y[I];if(V)for(let H=0;H<O.numGlyphs;H++)o.ak(Ct,V.shiftedAnchor,V.angle);else gt(O.numGlyphs,Ct)}}w.icon.dynamicLayoutVertexBuffer.updateData(Ct)}w.text.dynamicLayoutVertexBuffer.updateData(ct)}function Ci(w,l,d){return d.iconsInText&&l?"symbolTextAndIcon":w?"symbolSDF":"symbolIcon"}function Ds(w,l,d,m,v,E,F,M,N,G,$,J){const ct=w.context,Ct=ct.gl,y=w.transform,S=M==="map",I=N==="map",O=M!=="viewport"&&d.layout.get("symbol-placement")!=="point",V=S&&!I&&!O,H=!d.layout.get("symbol-sort-key").isConstant();let q=!1;const X=w.depthModeForSublayer(0,Me.ReadOnly),Z=d._unevaluatedLayout.hasValue("text-variable-anchor")||d._unevaluatedLayout.hasValue("text-variable-anchor-offset"),ot=[];for(const xt of m){const Lt=l.getTile(xt),kt=Lt.getBucket(d);if(!kt)continue;const zt=v?kt.text:kt.icon;if(!zt||!zt.segments.get().length||!zt.hasVisibleVertices)continue;const me=zt.programConfigurations.get(d.id),Wt=v||kt.sdfIcons,Ot=v?kt.textSizeData:kt.iconSizeData,Nt=I||y.pitch!==0,be=w.useProgram(Ci(Wt,v,kt),me),ve=o.ah(Ot,y.zoom),he=w.style.map.terrain&&w.style.map.terrain.getTerrainData(xt);let Le,Oe,sr,Ge,zr=[0,0],Hr=null;if(v)Oe=Lt.glyphAtlasTexture,sr=Ct.LINEAR,Le=Lt.glyphAtlasTexture.size,kt.iconsInText&&(zr=Lt.imageAtlasTexture.size,Hr=Lt.imageAtlasTexture,Ge=Nt||w.options.rotating||w.options.zooming||Ot.kind==="composite"||Ot.kind==="camera"?Ct.LINEAR:Ct.NEAREST);else{const Bn=d.layout.get("icon-size").constantOr(0)!==1||kt.iconsNeedLinear;Oe=Lt.imageAtlasTexture,sr=Wt||w.options.rotating||w.options.zooming||Bn||Nt?Ct.LINEAR:Ct.NEAREST,Le=Lt.imageAtlasTexture.size}const tn=Vt(Lt,1,w.transform.zoom),Sr=Ee(xt.posMatrix,I,S,w.transform,tn),pn=Nr(xt.posMatrix,I,S,w.transform,tn),hn=Z&&kt.hasTextData(),Gr=d.layout.get("icon-text-fit")!=="none"&&hn&&kt.hasIconData();if(O){const Bn=w.style.map.terrain?(Mn,mn)=>w.style.map.terrain.getElevation(xt,Mn,mn):null,gn=d.layout.get("text-rotation-alignment")==="map";Fe(kt,xt.posMatrix,w,v,Sr,pn,I,G,gn,Bn)}const Yn=w.translatePosMatrix(xt.posMatrix,Lt,E,F),Pi=O||v&&Z||Gr?hi:Sr,vn=w.translatePosMatrix(pn,Lt,E,F,!0),Fn=Wt&&d.paint.get(v?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let en;en=Wt?kt.iconsInText?pa(Ot.kind,ve,V,I,w,Yn,Pi,vn,Le,zr):Co(Ot.kind,ve,V,I,w,Yn,Pi,vn,v,Le,!0):HA(Ot.kind,ve,V,I,w,Yn,Pi,vn,v,Le);const Ui={program:be,buffers:zt,uniformValues:en,atlasTexture:Oe,atlasTextureIcon:Hr,atlasInterpolation:sr,atlasInterpolationIcon:Ge,isSDF:Wt,hasHalo:Fn};if(H&&kt.canOverlap){q=!0;const Bn=zt.segments.get();for(const gn of Bn)ot.push({segments:new o.S([gn]),sortKey:gn.sortKey,state:Ui,terrainData:he})}else ot.push({segments:zt.segments,sortKey:0,state:Ui,terrainData:he})}q&&ot.sort((xt,Lt)=>xt.sortKey-Lt.sortKey);for(const xt of ot){const Lt=xt.state;if(ct.activeTexture.set(Ct.TEXTURE0),Lt.atlasTexture.bind(Lt.atlasInterpolation,Ct.CLAMP_TO_EDGE),Lt.atlasTextureIcon&&(ct.activeTexture.set(Ct.TEXTURE1),Lt.atlasTextureIcon&&Lt.atlasTextureIcon.bind(Lt.atlasInterpolationIcon,Ct.CLAMP_TO_EDGE)),Lt.isSDF){const kt=Lt.uniformValues;Lt.hasHalo&&(kt.u_is_halo=1,Os(Lt.buffers,xt.segments,d,w,Lt.program,X,$,J,kt,xt.terrainData)),kt.u_is_halo=0}Os(Lt.buffers,xt.segments,d,w,Lt.program,X,$,J,Lt.uniformValues,xt.terrainData)}}function Os(w,l,d,m,v,E,F,M,N,G){const $=m.context;v.draw($,$.gl.TRIANGLES,E,F,M,wr.disabled,N,G,d.id,w.layoutVertexBuffer,w.indexBuffer,l,d.paint,m.transform.zoom,w.programConfigurations.get(d.id),w.dynamicLayoutVertexBuffer,w.opacityVertexBuffer)}function Zs(w,l,d,m,v){if(!d||!m||!m.imageAtlas)return;const E=m.imageAtlas.patternPositions;let F=E[d.to.toString()],M=E[d.from.toString()];if(!F&&M&&(F=M),!M&&F&&(M=F),!F||!M){const N=v.getPaintProperty(l);F=E[N],M=E[N]}F&&M&&w.setConstantPatternPositions(F,M)}function vc(w,l,d,m,v,E,F){const M=w.context.gl,N="fill-pattern",G=d.paint.get(N),$=G&&G.constantOr(1),J=d.getCrossfadeParameters();let ct,Ct,y,S,I;F?(Ct=$&&!d.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",ct=M.LINES):(Ct=$?"fillPattern":"fill",ct=M.TRIANGLES);const O=G.constantOr(null);for(const V of m){const H=l.getTile(V);if($&&!H.patternsLoaded())continue;const q=H.getBucket(d);if(!q)continue;const X=q.programConfigurations.get(d.id),Z=w.useProgram(Ct,X),ot=w.style.map.terrain&&w.style.map.terrain.getTerrainData(V);$&&(w.context.activeTexture.set(M.TEXTURE0),H.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),X.updatePaintBuffers(J)),Zs(X,N,O,H,d);const xt=ot?V:null,Lt=w.translatePosMatrix(xt?xt.posMatrix:V.posMatrix,H,d.paint.get("fill-translate"),d.paint.get("fill-translate-anchor"));if(F){S=q.indexBuffer2,I=q.segments2;const kt=[M.drawingBufferWidth,M.drawingBufferHeight];y=Ct==="fillOutlinePattern"&&$?dt(Lt,w,J,H,kt):dc(Lt,kt)}else S=q.indexBuffer,I=q.segments,y=$?hc(Lt,w,J,H):Jc(Lt);Z.draw(w.context,ct,v,w.stencilModeForClipping(V),E,wr.disabled,y,ot,d.id,q.layoutVertexBuffer,S,I,d.paint,w.transform.zoom,X)}}function Ha(w,l,d,m,v,E,F){const M=w.context,N=M.gl,G="fill-extrusion-pattern",$=d.paint.get(G),J=$.constantOr(1),ct=d.getCrossfadeParameters(),Ct=d.paint.get("fill-extrusion-opacity"),y=$.constantOr(null);for(const S of m){const I=l.getTile(S),O=I.getBucket(d);if(!O)continue;const V=w.style.map.terrain&&w.style.map.terrain.getTerrainData(S),H=O.programConfigurations.get(d.id),q=w.useProgram(J?"fillExtrusionPattern":"fillExtrusion",H);J&&(w.context.activeTexture.set(N.TEXTURE0),I.imageAtlasTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),H.updatePaintBuffers(ct)),Zs(H,G,y,I,d);const X=w.translatePosMatrix(S.posMatrix,I,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),Z=d.paint.get("fill-extrusion-vertical-gradient"),ot=J?Cs(X,w,Z,Ct,S,ct,I):fa(X,w,Z,Ct);q.draw(M,M.gl.TRIANGLES,v,E,F,wr.backCCW,ot,V,d.id,O.layoutVertexBuffer,O.indexBuffer,O.segments,d.paint,w.transform.zoom,H,w.style.map.terrain&&O.centroidVertexBuffer)}}function qA(w,l,d,m,v,E,F){const M=w.context,N=M.gl,G=d.fbo;if(!G)return;const $=w.useProgram("hillshade"),J=w.style.map.terrain&&w.style.map.terrain.getTerrainData(l);M.activeTexture.set(N.TEXTURE0),N.bindTexture(N.TEXTURE_2D,G.colorAttachment.get()),$.draw(M,N.TRIANGLES,v,E,F,wr.disabled,((ct,Ct,y,S)=>{const I=y.paint.get("hillshade-shadow-color"),O=y.paint.get("hillshade-highlight-color"),V=y.paint.get("hillshade-accent-color");let H=y.paint.get("hillshade-illumination-direction")*(Math.PI/180);y.paint.get("hillshade-illumination-anchor")==="viewport"&&(H-=ct.transform.angle);const q=!ct.options.moving;return{u_matrix:S?S.posMatrix:ct.transform.calculatePosMatrix(Ct.tileID.toUnwrapped(),q),u_image:0,u_latrange:Qr(0,Ct.tileID),u_light:[y.paint.get("hillshade-exaggeration"),H],u_shadow:I,u_highlight:O,u_accent:V}})(w,d,m,J?l:null),J,m.id,w.rasterBoundsBuffer,w.quadTriangleIndexBuffer,w.rasterBoundsSegments)}function bc(w,l,d,m,v,E){const F=w.context,M=F.gl,N=l.dem;if(N&&N.data){const G=N.dim,$=N.stride,J=N.getPixels();if(F.activeTexture.set(M.TEXTURE1),F.pixelStoreUnpackPremultiplyAlpha.set(!1),l.demTexture=l.demTexture||w.getTileTexture($),l.demTexture){const Ct=l.demTexture;Ct.update(J,{premultiply:!1}),Ct.bind(M.NEAREST,M.CLAMP_TO_EDGE)}else l.demTexture=new It(F,J,M.RGBA,{premultiply:!1}),l.demTexture.bind(M.NEAREST,M.CLAMP_TO_EDGE);F.activeTexture.set(M.TEXTURE0);let ct=l.fbo;if(!ct){const Ct=new It(F,{width:G,height:G,data:null},M.RGBA);Ct.bind(M.LINEAR,M.CLAMP_TO_EDGE),ct=l.fbo=F.createFramebuffer(G,G,!0,!1),ct.colorAttachment.set(Ct.texture)}F.bindFramebuffer.set(ct.framebuffer),F.viewport.set([0,0,G,G]),w.useProgram("hillshadePrepare").draw(F,M.TRIANGLES,m,v,E,wr.disabled,((Ct,y)=>{const S=y.stride,I=o.Z();return o.aS(I,0,o.N,-o.N,0,0,1),o.$(I,I,[0,-o.N,0]),{u_matrix:I,u_image:1,u_dimension:[S,S],u_zoom:Ct.overscaledZ,u_unpack:y.getUnpackVector()}})(l.tileID,N),null,d.id,w.rasterBoundsBuffer,w.quadTriangleIndexBuffer,w.rasterBoundsSegments),l.needsHillshadePrepare=!1}}function KA(w,l,d,m,v,E){const F=m.paint.get("raster-fade-duration");if(!E&&F>0){const M=o.h.now(),N=(M-w.timeAdded)/F,G=l?(M-l.timeAdded)/F:-1,$=d.getSource(),J=v.coveringZoomLevel({tileSize:$.tileSize,roundZoom:$.roundZoom}),ct=!l||Math.abs(l.tileID.overscaledZ-J)>Math.abs(w.tileID.overscaledZ-J),Ct=ct&&w.refreshedUponExpiration?1:o.ad(ct?N:1-G,0,1);return w.refreshedUponExpiration&&N>=1&&(w.refreshedUponExpiration=!1),l?{opacity:1,mix:1-Ct}:{opacity:Ct,mix:0}}return{opacity:1,mix:0}}const eA=new o.aT(1,0,0,1),Ga=new o.aT(0,1,0,1),ps=new o.aT(0,0,1,1),ol=new o.aT(1,0,1,1),al=new o.aT(0,1,1,1);function ya(w,l,d,m){ns(w,0,l+d/2,w.transform.width,d,m)}function wc(w,l,d,m){ns(w,l-d/2,0,d,w.transform.height,m)}function ns(w,l,d,m,v,E){const F=w.context,M=F.gl;M.enable(M.SCISSOR_TEST),M.scissor(l*w.pixelRatio,d*w.pixelRatio,m*w.pixelRatio,v*w.pixelRatio),F.clear({color:E}),M.disable(M.SCISSOR_TEST)}function Ku(w,l,d){const m=w.context,v=m.gl,E=d.posMatrix,F=w.useProgram("debug"),M=Me.disabled,N=mr.disabled,G=w.colorModeForRenderPass(),$="$debug",J=w.style.map.terrain&&w.style.map.terrain.getTerrainData(d);m.activeTexture.set(v.TEXTURE0);const ct=l.getTileByID(d.key).latestRawTileData,Ct=Math.floor((ct&&ct.byteLength||0)/1024),y=l.getTile(d).tileSize,S=512/Math.min(y,512)*(d.overscaledZ/w.transform.zoom)*.5;let I=d.canonical.toString();d.overscaledZ!==d.canonical.z&&(I+=` => ${d.overscaledZ}`),function(O,V){O.initDebugOverlayCanvas();const H=O.debugOverlayCanvas,q=O.context.gl,X=O.debugOverlayCanvas.getContext("2d");X.clearRect(0,0,H.width,H.height),X.shadowColor="white",X.shadowBlur=2,X.lineWidth=1.5,X.strokeStyle="white",X.textBaseline="top",X.font="bold 36px Open Sans, sans-serif",X.fillText(V,5,5),X.strokeText(V,5,5),O.debugOverlayTexture.update(H),O.debugOverlayTexture.bind(q.LINEAR,q.CLAMP_TO_EDGE)}(w,`${I} ${Ct}kB`),F.draw(m,v.TRIANGLES,M,N,ge.alphaBlended,wr.disabled,pe(E,o.aT.transparent,S),null,$,w.debugBuffer,w.quadTriangleIndexBuffer,w.debugSegments),F.draw(m,v.LINE_STRIP,M,N,G,wr.disabled,pe(E,o.aT.red),J,$,w.debugBuffer,w.tileBorderIndexBuffer,w.debugSegments)}function Kn(w,l,d){const m=w.context,v=m.gl,E=w.colorModeForRenderPass(),F=new Me(v.LEQUAL,Me.ReadWrite,w.depthRangeFor3D),M=w.useProgram("terrain"),N=l.getTerrainMesh();m.bindFramebuffer.set(null),m.viewport.set([0,0,w.width,w.height]);for(const G of d){const $=w.renderToTexture.getTexture(G),J=l.getTerrainData(G.tileID);m.activeTexture.set(v.TEXTURE0),v.bindTexture(v.TEXTURE_2D,$.texture);const ct={u_matrix:w.transform.calculatePosMatrix(G.tileID.toUnwrapped()),u_texture:0,u_ele_delta:l.getMeshFrameDelta(w.transform.zoom)};M.draw(m,v.TRIANGLES,F,mr.disabled,E,wr.backCCW,ct,J,"terrain",N.vertexBuffer,N.indexBuffer,N.segments)}}class _a{constructor(l,d){this.context=new ze(l),this.transform=d,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:o.Z(),renderTime:0},this.setup(),this.numSublayers=Ie.maxUnderzooming+Ie.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ts}resize(l,d,m){if(this.width=Math.floor(l*m),this.height=Math.floor(d*m),this.pixelRatio=m,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const v of this.style._order)this.style._layers[v].resize()}setup(){const l=this.context,d=new o.a_;d.emplaceBack(0,0),d.emplaceBack(o.N,0),d.emplaceBack(0,o.N),d.emplaceBack(o.N,o.N),this.tileExtentBuffer=l.createVertexBuffer(d,Bo.members),this.tileExtentSegments=o.S.simpleSegment(0,0,4,2);const m=new o.a_;m.emplaceBack(0,0),m.emplaceBack(o.N,0),m.emplaceBack(0,o.N),m.emplaceBack(o.N,o.N),this.debugBuffer=l.createVertexBuffer(m,Bo.members),this.debugSegments=o.S.simpleSegment(0,0,4,5);const v=new o.V;v.emplaceBack(0,0,0,0),v.emplaceBack(o.N,0,o.N,0),v.emplaceBack(0,o.N,0,o.N),v.emplaceBack(o.N,o.N,o.N,o.N),this.rasterBoundsBuffer=l.createVertexBuffer(v,oe.members),this.rasterBoundsSegments=o.S.simpleSegment(0,0,4,2);const E=new o.a_;E.emplaceBack(0,0),E.emplaceBack(1,0),E.emplaceBack(0,1),E.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(E,Bo.members),this.viewportSegments=o.S.simpleSegment(0,0,4,2);const F=new o.a$;F.emplaceBack(0),F.emplaceBack(1),F.emplaceBack(3),F.emplaceBack(2),F.emplaceBack(0),this.tileBorderIndexBuffer=l.createIndexBuffer(F);const M=new o.b0;M.emplaceBack(0,1,2),M.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(M);const N=this.context.gl;this.stencilClearMode=new mr({func:N.ALWAYS,mask:0},0,255,N.ZERO,N.ZERO,N.ZERO)}clearStencil(){const l=this.context,d=l.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const m=o.Z();o.aS(m,0,this.width,this.height,0,0,1),o.a0(m,m,[d.drawingBufferWidth,d.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(l,d.TRIANGLES,Me.disabled,this.stencilClearMode,ge.disabled,wr.disabled,Ue(m),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(l,d){if(this.currentStencilSource===l.source||!l.isTileClipped()||!d||!d.length)return;this.currentStencilSource=l.source;const m=this.context,v=m.gl;this.nextStencilID+d.length>256&&this.clearStencil(),m.setColorMode(ge.disabled),m.setDepthMode(Me.disabled);const E=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const F of d){const M=this._tileClippingMaskIDs[F.key]=this.nextStencilID++,N=this.style.map.terrain&&this.style.map.terrain.getTerrainData(F);E.draw(m,v.TRIANGLES,Me.disabled,new mr({func:v.ALWAYS,mask:0},M,255,v.KEEP,v.KEEP,v.REPLACE),ge.disabled,wr.disabled,Ue(F.posMatrix),N,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const l=this.nextStencilID++,d=this.context.gl;return new mr({func:d.NOTEQUAL,mask:255},l,255,d.KEEP,d.KEEP,d.REPLACE)}stencilModeForClipping(l){const d=this.context.gl;return new mr({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,d.KEEP,d.KEEP,d.REPLACE)}stencilConfigForOverlap(l){const d=this.context.gl,m=l.sort((F,M)=>M.overscaledZ-F.overscaledZ),v=m[m.length-1].overscaledZ,E=m[0].overscaledZ-v+1;if(E>1){this.currentStencilSource=void 0,this.nextStencilID+E>256&&this.clearStencil();const F={};for(let M=0;M<E;M++)F[M+v]=new mr({func:d.GEQUAL,mask:255},M+this.nextStencilID,255,d.KEEP,d.KEEP,d.REPLACE);return this.nextStencilID+=E,[F,m]}return[{[v]:mr.disabled},m]}colorModeForRenderPass(){const l=this.context.gl;return this._showOverdrawInspector?new ge([l.CONSTANT_COLOR,l.ONE],new o.aT(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?ge.unblended:ge.alphaBlended}depthModeForSublayer(l,d,m){if(!this.opaquePassEnabledForLayer())return Me.disabled;const v=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new Me(m||this.context.gl.LEQUAL,d,[v,v])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(l,d){this.style=l,this.options=d,this.lineAtlas=l.lineAtlas,this.imageManager=l.imageManager,this.glyphManager=l.glyphManager,this.symbolFadeChange=l.placement.symbolFadeChange(o.h.now()),this.imageManager.beginFrame();const m=this.style._order,v=this.style.sourceCaches,E={},F={},M={};for(const N in v){const G=v[N];G.used&&G.prepare(this.context),E[N]=G.getVisibleCoordinates(),F[N]=E[N].slice().reverse(),M[N]=G.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let N=0;N<m.length;N++)if(this.style._layers[m[N]].is3D()){this.opaquePassCutoff=N;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;const N=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!o.b1(this.terrainFacilitator.matrix,this.transform.projMatrix)||N.length)&&(o.b2(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(G,$){const J=G.context,ct=J.gl,Ct=ge.unblended,y=new Me(ct.LEQUAL,Me.ReadWrite,[0,1]),S=$.getTerrainMesh(),I=$.sourceCache.getRenderableTiles(),O=G.useProgram("terrainDepth");J.bindFramebuffer.set($.getFramebuffer("depth").framebuffer),J.viewport.set([0,0,G.width/devicePixelRatio,G.height/devicePixelRatio]),J.clear({color:o.aT.transparent,depth:1});for(const V of I){const H=$.getTerrainData(V.tileID),q={u_matrix:G.transform.calculatePosMatrix(V.tileID.toUnwrapped()),u_ele_delta:$.getMeshFrameDelta(G.transform.zoom)};O.draw(J,ct.TRIANGLES,y,mr.disabled,Ct,wr.backCCW,q,H,"terrain",S.vertexBuffer,S.indexBuffer,S.segments)}J.bindFramebuffer.set(null),J.viewport.set([0,0,G.width,G.height])}(this,this.style.map.terrain),function(G,$){const J=G.context,ct=J.gl,Ct=ge.unblended,y=new Me(ct.LEQUAL,Me.ReadWrite,[0,1]),S=$.getTerrainMesh(),I=$.getCoordsTexture(),O=$.sourceCache.getRenderableTiles(),V=G.useProgram("terrainCoords");J.bindFramebuffer.set($.getFramebuffer("coords").framebuffer),J.viewport.set([0,0,G.width/devicePixelRatio,G.height/devicePixelRatio]),J.clear({color:o.aT.transparent,depth:1}),$.coordsIndex=[];for(const H of O){const q=$.getTerrainData(H.tileID);J.activeTexture.set(ct.TEXTURE0),ct.bindTexture(ct.TEXTURE_2D,I.texture);const X={u_matrix:G.transform.calculatePosMatrix(H.tileID.toUnwrapped()),u_terrain_coords_id:(255-$.coordsIndex.length)/255,u_texture:0,u_ele_delta:$.getMeshFrameDelta(G.transform.zoom)};V.draw(J,ct.TRIANGLES,y,mr.disabled,Ct,wr.backCCW,X,q,"terrain",S.vertexBuffer,S.indexBuffer,S.segments),$.coordsIndex.push(H.tileID.key)}J.bindFramebuffer.set(null),J.viewport.set([0,0,G.width,G.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(const N of m){const G=this.style._layers[N];if(!G.hasOffscreenPass()||G.isHidden(this.transform.zoom))continue;const $=F[G.source];(G.type==="custom"||$.length)&&this.renderLayer(this,v[G.source],G,$)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:d.showOverdrawInspector?o.aT.black:o.aT.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=d.showOverdrawInspector,this.depthRangeFor3D=[0,1-(l._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=m.length-1;this.currentLayer>=0;this.currentLayer--){const N=this.style._layers[m[this.currentLayer]],G=v[N.source],$=E[N.source];this._renderTileClippingMasks(N,$),this.renderLayer(this,G,N,$)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<m.length;this.currentLayer++){const N=this.style._layers[m[this.currentLayer]],G=v[N.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(N))continue;const $=(N.type==="symbol"?M:F)[N.source];this._renderTileClippingMasks(N,E[N.source]),this.renderLayer(this,G,N,$)}if(this.options.showTileBoundaries){const N=function(G,$){let J=null;const ct=Object.values(G._layers).flatMap(I=>I.source&&!I.isHidden($)?[G.sourceCaches[I.source]]:[]),Ct=ct.filter(I=>I.getSource().type==="vector"),y=ct.filter(I=>I.getSource().type!=="vector"),S=I=>{(!J||J.getSource().maxzoom<I.getSource().maxzoom)&&(J=I)};return Ct.forEach(I=>S(I)),J||y.forEach(I=>S(I)),J}(this.style,this.transform.zoom);N&&function(G,$,J){for(let ct=0;ct<J.length;ct++)Ku(G,$,J[ct])}(this,N,N.getVisibleCoordinates())}this.options.showPadding&&function(N){const G=N.transform.padding;ya(N,N.transform.height-(G.top||0),3,eA),ya(N,G.bottom||0,3,Ga),wc(N,G.left||0,3,ps),wc(N,N.transform.width-(G.right||0),3,ol);const $=N.transform.centerPoint;(function(J,ct,Ct,y){ns(J,ct-1,Ct-10,2,20,y),ns(J,ct-10,Ct-1,20,2,y)})(N,$.x,N.transform.height-$.y,al)}(this),this.context.setDefault()}renderLayer(l,d,m,v){if(!m.isHidden(this.transform.zoom)&&(m.type==="background"||m.type==="custom"||(v||[]).length))switch(this.id=m.id,m.type){case"symbol":(function(E,F,M,N,G){if(E.renderPass!=="translucent")return;const $=mr.disabled,J=E.colorModeForRenderPass();(M._unevaluatedLayout.hasValue("text-variable-anchor")||M._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(ct,Ct,y,S,I,O,V){const H=Ct.transform,q=I==="map",X=O==="map";for(const Z of ct){const ot=S.getTile(Z),xt=ot.getBucket(y);if(!xt||!xt.text||!xt.text.segments.get().length)continue;const Lt=o.ah(xt.textSizeData,H.zoom),kt=Vt(ot,1,Ct.transform.zoom),zt=Ee(Z.posMatrix,X,q,Ct.transform,kt),me=y.layout.get("icon-text-fit")!=="none"&&xt.hasIconData();if(Lt){const Wt=Math.pow(2,H.zoom-ot.tileID.overscaledZ);Mi(xt,q,X,V,H,zt,Z.posMatrix,Wt,Lt,me,Ct.style.map.terrain?(Ot,Nt)=>Ct.style.map.terrain.getElevation(Z,Ot,Nt):null)}}}(N,E,M,F,M.layout.get("text-rotation-alignment"),M.layout.get("text-pitch-alignment"),G),M.paint.get("icon-opacity").constantOr(1)!==0&&Ds(E,F,M,N,!1,M.paint.get("icon-translate"),M.paint.get("icon-translate-anchor"),M.layout.get("icon-rotation-alignment"),M.layout.get("icon-pitch-alignment"),M.layout.get("icon-keep-upright"),$,J),M.paint.get("text-opacity").constantOr(1)!==0&&Ds(E,F,M,N,!0,M.paint.get("text-translate"),M.paint.get("text-translate-anchor"),M.layout.get("text-rotation-alignment"),M.layout.get("text-pitch-alignment"),M.layout.get("text-keep-upright"),$,J),F.map.showCollisionBoxes&&(si(E,F,M,N,M.paint.get("text-translate"),M.paint.get("text-translate-anchor"),!0),si(E,F,M,N,M.paint.get("icon-translate"),M.paint.get("icon-translate-anchor"),!1))})(l,d,m,v,this.style.placement.variableOffsets);break;case"circle":(function(E,F,M,N){if(E.renderPass!=="translucent")return;const G=M.paint.get("circle-opacity"),$=M.paint.get("circle-stroke-width"),J=M.paint.get("circle-stroke-opacity"),ct=!M.layout.get("circle-sort-key").isConstant();if(G.constantOr(1)===0&&($.constantOr(1)===0||J.constantOr(1)===0))return;const Ct=E.context,y=Ct.gl,S=E.depthModeForSublayer(0,Me.ReadOnly),I=mr.disabled,O=E.colorModeForRenderPass(),V=[];for(let H=0;H<N.length;H++){const q=N[H],X=F.getTile(q),Z=X.getBucket(M);if(!Z)continue;const ot=Z.programConfigurations.get(M.id),xt=E.useProgram("circle",ot),Lt=Z.layoutVertexBuffer,kt=Z.indexBuffer,zt=E.style.map.terrain&&E.style.map.terrain.getTerrainData(q),me={programConfiguration:ot,program:xt,layoutVertexBuffer:Lt,indexBuffer:kt,uniformValues:bt(E,q,X,M),terrainData:zt};if(ct){const Wt=Z.segments.get();for(const Ot of Wt)V.push({segments:new o.S([Ot]),sortKey:Ot.sortKey,state:me})}else V.push({segments:Z.segments,sortKey:0,state:me})}ct&&V.sort((H,q)=>H.sortKey-q.sortKey);for(const H of V){const{programConfiguration:q,program:X,layoutVertexBuffer:Z,indexBuffer:ot,uniformValues:xt,terrainData:Lt}=H.state;X.draw(Ct,y.TRIANGLES,S,I,O,wr.disabled,xt,Lt,M.id,Z,ot,H.segments,M.paint,E.transform.zoom,q)}})(l,d,m,v);break;case"heatmap":(function(E,F,M,N){if(M.paint.get("heatmap-opacity")!==0)if(E.renderPass==="offscreen"){const G=E.context,$=G.gl,J=mr.disabled,ct=new ge([$.ONE,$.ONE],o.aT.transparent,[!0,!0,!0,!0]);(function(Ct,y,S){const I=Ct.gl;Ct.activeTexture.set(I.TEXTURE1),Ct.viewport.set([0,0,y.width/4,y.height/4]);let O=S.heatmapFbo;if(O)I.bindTexture(I.TEXTURE_2D,O.colorAttachment.get()),Ct.bindFramebuffer.set(O.framebuffer);else{const V=I.createTexture();I.bindTexture(I.TEXTURE_2D,V),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_WRAP_S,I.CLAMP_TO_EDGE),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_WRAP_T,I.CLAMP_TO_EDGE),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_MIN_FILTER,I.LINEAR),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_MAG_FILTER,I.LINEAR),O=S.heatmapFbo=Ct.createFramebuffer(y.width/4,y.height/4,!1,!1),function(H,q,X,Z){var ot,xt;const Lt=H.gl,kt=(ot=H.HALF_FLOAT)!==null&&ot!==void 0?ot:Lt.UNSIGNED_BYTE,zt=(xt=H.RGBA16F)!==null&&xt!==void 0?xt:Lt.RGBA;Lt.texImage2D(Lt.TEXTURE_2D,0,zt,q.width/4,q.height/4,0,Lt.RGBA,kt,null),Z.colorAttachment.set(X)}(Ct,y,V,O)}})(G,E,M),G.clear({color:o.aT.transparent});for(let Ct=0;Ct<N.length;Ct++){const y=N[Ct];if(F.hasRenderableParent(y))continue;const S=F.getTile(y),I=S.getBucket(M);if(!I)continue;const O=I.programConfigurations.get(M.id),V=E.useProgram("heatmap",O),{zoom:H}=E.transform;V.draw(G,$.TRIANGLES,Me.disabled,J,ct,wr.disabled,cr(y.posMatrix,S,H,M.paint.get("heatmap-intensity")),null,M.id,I.layoutVertexBuffer,I.indexBuffer,I.segments,M.paint,E.transform.zoom,O)}G.viewport.set([0,0,E.width,E.height])}else E.renderPass==="translucent"&&(E.context.setColorMode(E.colorModeForRenderPass()),function(G,$){const J=G.context,ct=J.gl,Ct=$.heatmapFbo;if(!Ct)return;J.activeTexture.set(ct.TEXTURE0),ct.bindTexture(ct.TEXTURE_2D,Ct.colorAttachment.get()),J.activeTexture.set(ct.TEXTURE1);let y=$.colorRampTexture;y||(y=$.colorRampTexture=new It(J,$.colorRamp,ct.RGBA)),y.bind(ct.LINEAR,ct.CLAMP_TO_EDGE),G.useProgram("heatmapTexture").draw(J,ct.TRIANGLES,Me.disabled,mr.disabled,G.colorModeForRenderPass(),wr.disabled,((S,I,O,V)=>{const H=o.Z();o.aS(H,0,S.width,S.height,0,0,1);const q=S.context.gl;return{u_matrix:H,u_world:[q.drawingBufferWidth,q.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:I.paint.get("heatmap-opacity")}})(G,$),null,$.id,G.viewportBuffer,G.quadTriangleIndexBuffer,G.viewportSegments,$.paint,G.transform.zoom)}(E,M))})(l,d,m,v);break;case"line":(function(E,F,M,N){if(E.renderPass!=="translucent")return;const G=M.paint.get("line-opacity"),$=M.paint.get("line-width");if(G.constantOr(1)===0||$.constantOr(1)===0)return;const J=E.depthModeForSublayer(0,Me.ReadOnly),ct=E.colorModeForRenderPass(),Ct=M.paint.get("line-dasharray"),y=M.paint.get("line-pattern"),S=y.constantOr(1),I=M.paint.get("line-gradient"),O=M.getCrossfadeParameters(),V=S?"linePattern":Ct?"lineSDF":I?"lineGradient":"line",H=E.context,q=H.gl;let X=!0;for(const Z of N){const ot=F.getTile(Z);if(S&&!ot.patternsLoaded())continue;const xt=ot.getBucket(M);if(!xt)continue;const Lt=xt.programConfigurations.get(M.id),kt=E.context.program.get(),zt=E.useProgram(V,Lt),me=X||zt.program!==kt,Wt=E.style.map.terrain&&E.style.map.terrain.getTerrainData(Z),Ot=y.constantOr(null);if(Ot&&ot.imageAtlas){const ve=ot.imageAtlas,he=ve.patternPositions[Ot.to.toString()],Le=ve.patternPositions[Ot.from.toString()];he&&Le&&Lt.setConstantPatternPositions(he,Le)}const Nt=Wt?Z:null,be=S?Bi(E,ot,M,O,Nt):Ct?zn(E,ot,M,Ct,O,Nt):I?ti(E,ot,M,xt.lineClipsArray.length,Nt):qn(E,ot,M,Nt);if(S)H.activeTexture.set(q.TEXTURE0),ot.imageAtlasTexture.bind(q.LINEAR,q.CLAMP_TO_EDGE),Lt.updatePaintBuffers(O);else if(Ct&&(me||E.lineAtlas.dirty))H.activeTexture.set(q.TEXTURE0),E.lineAtlas.bind(H);else if(I){const ve=xt.gradients[M.id];let he=ve.texture;if(M.gradientVersion!==ve.version){let Le=256;if(M.stepInterpolant){const Oe=F.getSource().maxzoom,sr=Z.canonical.z===Oe?Math.ceil(1<<E.transform.maxZoom-Z.canonical.z):1;Le=o.ad(o.aY(xt.maxLineLength/o.N*1024*sr),256,H.maxTextureSize)}ve.gradient=o.aZ({expression:M.gradientExpression(),evaluationKey:"lineProgress",resolution:Le,image:ve.gradient||void 0,clips:xt.lineClipsArray}),ve.texture?ve.texture.update(ve.gradient):ve.texture=new It(H,ve.gradient,q.RGBA),ve.version=M.gradientVersion,he=ve.texture}H.activeTexture.set(q.TEXTURE0),he.bind(M.stepInterpolant?q.NEAREST:q.LINEAR,q.CLAMP_TO_EDGE)}zt.draw(H,q.TRIANGLES,J,E.stencilModeForClipping(Z),ct,wr.disabled,be,Wt,M.id,xt.layoutVertexBuffer,xt.indexBuffer,xt.segments,M.paint,E.transform.zoom,Lt,xt.layoutVertexBuffer2),X=!1}})(l,d,m,v);break;case"fill":(function(E,F,M,N){const G=M.paint.get("fill-color"),$=M.paint.get("fill-opacity");if($.constantOr(1)===0)return;const J=E.colorModeForRenderPass(),ct=M.paint.get("fill-pattern"),Ct=E.opaquePassEnabledForLayer()&&!ct.constantOr(1)&&G.constantOr(o.aT.transparent).a===1&&$.constantOr(0)===1?"opaque":"translucent";if(E.renderPass===Ct){const y=E.depthModeForSublayer(1,E.renderPass==="opaque"?Me.ReadWrite:Me.ReadOnly);vc(E,F,M,N,y,J,!1)}if(E.renderPass==="translucent"&&M.paint.get("fill-antialias")){const y=E.depthModeForSublayer(M.getPaintProperty("fill-outline-color")?2:0,Me.ReadOnly);vc(E,F,M,N,y,J,!0)}})(l,d,m,v);break;case"fill-extrusion":(function(E,F,M,N){const G=M.paint.get("fill-extrusion-opacity");if(G!==0&&E.renderPass==="translucent"){const $=new Me(E.context.gl.LEQUAL,Me.ReadWrite,E.depthRangeFor3D);if(G!==1||M.paint.get("fill-extrusion-pattern").constantOr(1))Ha(E,F,M,N,$,mr.disabled,ge.disabled),Ha(E,F,M,N,$,E.stencilModeFor3D(),E.colorModeForRenderPass());else{const J=E.colorModeForRenderPass();Ha(E,F,M,N,$,mr.disabled,J)}}})(l,d,m,v);break;case"hillshade":(function(E,F,M,N){if(E.renderPass!=="offscreen"&&E.renderPass!=="translucent")return;const G=E.context,$=E.depthModeForSublayer(0,Me.ReadOnly),J=E.colorModeForRenderPass(),[ct,Ct]=E.renderPass==="translucent"?E.stencilConfigForOverlap(N):[{},N];for(const y of Ct){const S=F.getTile(y);S.needsHillshadePrepare!==void 0&&S.needsHillshadePrepare&&E.renderPass==="offscreen"?bc(E,S,M,$,mr.disabled,J):E.renderPass==="translucent"&&qA(E,y,S,M,$,ct[y.overscaledZ],J)}G.viewport.set([0,0,E.width,E.height])})(l,d,m,v);break;case"raster":(function(E,F,M,N){if(E.renderPass!=="translucent"||M.paint.get("raster-opacity")===0||!N.length)return;const G=E.context,$=G.gl,J=F.getSource(),ct=E.useProgram("raster"),Ct=E.colorModeForRenderPass(),[y,S]=J instanceof Ce?[{},N]:E.stencilConfigForOverlap(N),I=S[S.length-1].overscaledZ,O=!E.options.moving;for(const V of S){const H=E.depthModeForSublayer(V.overscaledZ-I,M.paint.get("raster-opacity")===1?Me.ReadWrite:Me.ReadOnly,$.LESS),q=F.getTile(V);q.registerFadeDuration(M.paint.get("raster-fade-duration"));const X=F.findLoadedParent(V,0),Z=KA(q,X,F,M,E.transform,E.style.map.terrain);let ot,xt;const Lt=M.paint.get("raster-resampling")==="nearest"?$.NEAREST:$.LINEAR;G.activeTexture.set($.TEXTURE0),q.texture.bind(Lt,$.CLAMP_TO_EDGE,$.LINEAR_MIPMAP_NEAREST),G.activeTexture.set($.TEXTURE1),X?(X.texture.bind(Lt,$.CLAMP_TO_EDGE,$.LINEAR_MIPMAP_NEAREST),ot=Math.pow(2,X.tileID.overscaledZ-q.tileID.overscaledZ),xt=[q.tileID.canonical.x*ot%1,q.tileID.canonical.y*ot%1]):q.texture.bind(Lt,$.CLAMP_TO_EDGE,$.LINEAR_MIPMAP_NEAREST);const kt=E.style.map.terrain&&E.style.map.terrain.getTerrainData(V),zt=kt?V:null,me=zt?zt.posMatrix:E.transform.calculatePosMatrix(V.toUnwrapped(),O),Wt=$r(me,xt||[0,0],ot||1,Z,M);J instanceof Ce?ct.draw(G,$.TRIANGLES,H,mr.disabled,Ct,wr.disabled,Wt,kt,M.id,J.boundsBuffer,E.quadTriangleIndexBuffer,J.boundsSegments):ct.draw(G,$.TRIANGLES,H,y[V.overscaledZ],Ct,wr.disabled,Wt,kt,M.id,E.rasterBoundsBuffer,E.quadTriangleIndexBuffer,E.rasterBoundsSegments)}})(l,d,m,v);break;case"background":(function(E,F,M,N){const G=M.paint.get("background-color"),$=M.paint.get("background-opacity");if($===0)return;const J=E.context,ct=J.gl,Ct=E.transform,y=Ct.tileSize,S=M.paint.get("background-pattern");if(E.isPatternMissing(S))return;const I=!S&&G.a===1&&$===1&&E.opaquePassEnabledForLayer()?"opaque":"translucent";if(E.renderPass!==I)return;const O=mr.disabled,V=E.depthModeForSublayer(0,I==="opaque"?Me.ReadWrite:Me.ReadOnly),H=E.colorModeForRenderPass(),q=E.useProgram(S?"backgroundPattern":"background"),X=N||Ct.coveringTiles({tileSize:y,terrain:E.style.map.terrain});S&&(J.activeTexture.set(ct.TEXTURE0),E.imageManager.bind(E.context));const Z=M.getCrossfadeParameters();for(const ot of X){const xt=N?ot.posMatrix:E.transform.calculatePosMatrix(ot.toUnwrapped()),Lt=S?es(xt,$,E,S,{tileID:ot,tileSize:y},Z):Zc(xt,$,G),kt=E.style.map.terrain&&E.style.map.terrain.getTerrainData(ot);q.draw(J,ct.TRIANGLES,V,O,H,wr.disabled,Lt,kt,M.id,E.tileExtentBuffer,E.quadTriangleIndexBuffer,E.tileExtentSegments)}})(l,0,m,v);break;case"custom":(function(E,F,M){const N=E.context,G=M.implementation;if(E.renderPass==="offscreen"){const $=G.prerender;$&&(E.setCustomLayerDefaults(),N.setColorMode(E.colorModeForRenderPass()),$.call(G,N.gl,E.transform.customLayerMatrix()),N.setDirty(),E.setBaseState())}else if(E.renderPass==="translucent"){E.setCustomLayerDefaults(),N.setColorMode(E.colorModeForRenderPass()),N.setStencilMode(mr.disabled);const $=G.renderingMode==="3d"?new Me(E.context.gl.LEQUAL,Me.ReadWrite,E.depthRangeFor3D):E.depthModeForSublayer(0,Me.ReadOnly);N.setDepthMode($),G.render(N.gl,E.transform.customLayerMatrix()),N.setDirty(),E.setBaseState(),N.bindFramebuffer.set(null)}})(l,0,m)}}translatePosMatrix(l,d,m,v,E){if(!m[0]&&!m[1])return l;const F=E?v==="map"?this.transform.angle:0:v==="viewport"?-this.transform.angle:0;if(F){const G=Math.sin(F),$=Math.cos(F);m=[m[0]*$-m[1]*G,m[0]*G+m[1]*$]}const M=[E?m[0]:Vt(d,m[0],this.transform.zoom),E?m[1]:Vt(d,m[1],this.transform.zoom),0],N=new Float32Array(16);return o.$(N,l,M),N}saveTileTexture(l){const d=this._tileTextures[l.size[0]];d?d.push(l):this._tileTextures[l.size[0]]=[l]}getTileTexture(l){const d=this._tileTextures[l];return d&&d.length>0?d.pop():null}isPatternMissing(l){if(!l)return!1;if(!l.from||!l.to)return!0;const d=this.imageManager.getPattern(l.from.toString()),m=this.imageManager.getPattern(l.to.toString());return!d||!m}useProgram(l,d){this.cache=this.cache||{};const m=l+(d?d.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[m]||(this.cache[m]=new Li(this.context,Tn[l],d,fc[l],this._showOverdrawInspector,this.style.map.terrain)),this.cache[m]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new It(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:l,drawingBufferHeight:d}=this.context.gl;return this.width!==l||this.height!==d}}class oi{constructor(l,d){this.points=l,this.planes=d}static fromInvProjectionMatrix(l,d,m){const v=Math.pow(2,m),E=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(M=>{const N=1/(M=o.ag([],M,l))[3]/d*v;return o.b3(M,M,[N,N,1/M[3],N])}),F=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(M=>{const N=function(ct,Ct){var y=Ct[0],S=Ct[1],I=Ct[2],O=y*y+S*S+I*I;return O>0&&(O=1/Math.sqrt(O)),ct[0]=Ct[0]*O,ct[1]=Ct[1]*O,ct[2]=Ct[2]*O,ct}([],function(ct,Ct,y){var S=Ct[0],I=Ct[1],O=Ct[2],V=y[0],H=y[1],q=y[2];return ct[0]=I*q-O*H,ct[1]=O*V-S*q,ct[2]=S*H-I*V,ct}([],pt([],E[M[0]],E[M[1]]),pt([],E[M[2]],E[M[1]]))),G=-(($=N)[0]*(J=E[M[1]])[0]+$[1]*J[1]+$[2]*J[2]);var $,J;return N.concat(G)});return new oi(E,F)}}class va{constructor(l,d){this.min=l,this.max=d,this.center=function(m,v,E){return m[0]=.5*v[0],m[1]=.5*v[1],m[2]=.5*v[2],m}([],function(m,v,E){return m[0]=v[0]+E[0],m[1]=v[1]+E[1],m[2]=v[2]+E[2],m}([],this.min,this.max))}quadrant(l){const d=[l%2==0,l<2],m=st(this.min),v=st(this.max);for(let E=0;E<d.length;E++)m[E]=d[E]?this.min[E]:this.center[E],v[E]=d[E]?this.center[E]:this.max[E];return v[2]=this.max[2],new va(m,v)}distanceX(l){return Math.max(Math.min(this.max[0],l[0]),this.min[0])-l[0]}distanceY(l){return Math.max(Math.min(this.max[1],l[1]),this.min[1])-l[1]}intersects(l){const d=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let m=!0;for(let v=0;v<l.planes.length;v++){const E=l.planes[v];let F=0;for(let M=0;M<d.length;M++)o.b4(E,d[M])>=0&&F++;if(F===0)return 0;F!==d.length&&(m=!1)}if(m)return 2;for(let v=0;v<3;v++){let E=Number.MAX_VALUE,F=-Number.MAX_VALUE;for(let M=0;M<l.points.length;M++){const N=l.points[M][v]-this.min[v];E=Math.min(E,N),F=Math.max(F,N)}if(F<0||E>this.max[v]-this.min[v])return 0}return 1}}class cl{constructor(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,v=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;if(isNaN(l)||l<0||isNaN(d)||d<0||isNaN(m)||m<0||isNaN(v)||v<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=d,this.left=m,this.right=v}interpolate(l,d,m){return d.top!=null&&l.top!=null&&(this.top=o.B.number(l.top,d.top,m)),d.bottom!=null&&l.bottom!=null&&(this.bottom=o.B.number(l.bottom,d.bottom,m)),d.left!=null&&l.left!=null&&(this.left=o.B.number(l.left,d.left,m)),d.right!=null&&l.right!=null&&(this.right=o.B.number(l.right,d.right,m)),this}getCenter(l,d){const m=o.ad((this.left+l-this.right)/2,0,l),v=o.ad((this.top+d-this.bottom)/2,0,d);return new o.P(m,v)}equals(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right}clone(){return new cl(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class rA{constructor(l,d,m,v,E){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=E===void 0||!!E,this._minZoom=l||0,this._maxZoom=d||22,this._minPitch=m??0,this._maxPitch=v??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new o.L(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new cl,this._posMatrixCache={},this._alignedPosMatrixCache={},this._minEleveationForCurrentTile=0}clone(){const l=new rA(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return l.apply(this),l}apply(l){this.tileSize=l.tileSize,this.latRange=l.latRange,this.width=l.width,this.height=l.height,this._center=l._center,this._elevation=l._elevation,this._minEleveationForCurrentTile=l._minEleveationForCurrentTile,this.zoom=l.zoom,this.angle=l.angle,this._fov=l._fov,this._pitch=l._pitch,this._unmodified=l._unmodified,this._edgeInsets=l._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))}get maxZoom(){return this._maxZoom}set maxZoom(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))}get minPitch(){return this._minPitch}set minPitch(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))}get maxPitch(){return this._maxPitch}set maxPitch(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(l){l===void 0?l=!0:l===null&&(l=!1),this._renderWorldCopies=l}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(l){const d=-o.b5(l,-180,180)*Math.PI/180;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=function(){var m=new o.A(4);return o.A!=Float32Array&&(m[1]=0,m[2]=0),m[0]=1,m[3]=1,m}(),function(m,v,E){var F=v[0],M=v[1],N=v[2],G=v[3],$=Math.sin(E),J=Math.cos(E);m[0]=F*J+N*$,m[1]=M*J+G*$,m[2]=F*-$+N*J,m[3]=M*-$+G*J}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(l){const d=o.ad(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==d&&(this._unmodified=!1,this._pitch=d,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=l/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(l){const d=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==d&&(this._unmodified=!1,this._zoom=d,this.tileZoom=Math.max(0,Math.floor(d)),this.scale=this.zoomScale(d),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(l){l!==this._elevation&&(this._elevation=l,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(l){return this._edgeInsets.equals(l)}interpolatePadding(l,d,m){this._unmodified=!1,this._edgeInsets.interpolate(l,d,m),this._constrain(),this._calcMatrices()}coveringZoomLevel(l){const d=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,d)}getVisibleUnwrappedCoordinates(l){const d=[new o.b6(0,l)];if(this._renderWorldCopies){const m=this.pointCoordinate(new o.P(0,0)),v=this.pointCoordinate(new o.P(this.width,0)),E=this.pointCoordinate(new o.P(this.width,this.height)),F=this.pointCoordinate(new o.P(0,this.height)),M=Math.floor(Math.min(m.x,v.x,E.x,F.x)),N=Math.floor(Math.max(m.x,v.x,E.x,F.x)),G=1;for(let $=M-G;$<=N+G;$++)$!==0&&d.push(new o.b6($,l))}return d}coveringTiles(l){var d,m;let v=this.coveringZoomLevel(l);const E=v;if(l.minzoom!==void 0&&v<l.minzoom)return[];l.maxzoom!==void 0&&v>l.maxzoom&&(v=l.maxzoom);const F=this.pointCoordinate(this.getCameraPoint()),M=o.U.fromLngLat(this.center),N=Math.pow(2,v),G=[N*F.x,N*F.y,0],$=[N*M.x,N*M.y,0],J=oi.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,v);let ct=l.minzoom||0;!l.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(ct=v);const Ct=l.terrain?2/Math.min(this.tileSize,l.tileSize)*this.tileSize:3,y=H=>({aabb:new va([H*N,0,0],[(H+1)*N,N,0]),zoom:0,x:0,y:0,wrap:H,fullyVisible:!1}),S=[],I=[],O=v,V=l.reparseOverscaled?E:v;if(this._renderWorldCopies)for(let H=1;H<=3;H++)S.push(y(-H)),S.push(y(H));for(S.push(y(0));S.length>0;){const H=S.pop(),q=H.x,X=H.y;let Z=H.fullyVisible;if(!Z){const zt=H.aabb.intersects(J);if(zt===0)continue;Z=zt===2}const ot=l.terrain?G:$,xt=H.aabb.distanceX(ot),Lt=H.aabb.distanceY(ot),kt=Math.max(Math.abs(xt),Math.abs(Lt));if(H.zoom===O||kt>Ct+(1<<O-H.zoom)-2&&H.zoom>=ct){const zt=O-H.zoom,me=G[0]-.5-(q<<zt),Wt=G[1]-.5-(X<<zt);I.push({tileID:new o.O(H.zoom===O?V:H.zoom,H.wrap,H.zoom,q,X),distanceSq:yt([$[0]-.5-q,$[1]-.5-X]),tileDistanceToCamera:Math.sqrt(me*me+Wt*Wt)})}else for(let zt=0;zt<4;zt++){const me=(q<<1)+zt%2,Wt=(X<<1)+(zt>>1),Ot=H.zoom+1;let Nt=H.aabb.quadrant(zt);if(l.terrain){const be=new o.O(Ot,H.wrap,Ot,me,Wt),ve=l.terrain.getMinMaxElevation(be),he=(d=ve.minElevation)!==null&&d!==void 0?d:this.elevation,Le=(m=ve.maxElevation)!==null&&m!==void 0?m:this.elevation;Nt=new va([Nt.min[0],Nt.min[1],he],[Nt.max[0],Nt.max[1],Le])}S.push({aabb:Nt,zoom:Ot,x:me,y:Wt,wrap:H.wrap,fullyVisible:Z})}}return I.sort((H,q)=>H.distanceSq-q.distanceSq).map(H=>H.tileID)}resize(l,d){this.width=l,this.height=d,this.pixelsToGLUnits=[2/l,-2/d],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(l){return Math.pow(2,l)}scaleZoom(l){return Math.log(l)/Math.LN2}project(l){const d=o.ad(l.lat,-this.maxValidLatitude,this.maxValidLatitude);return new o.P(o.G(l.lng)*this.worldSize,o.H(d)*this.worldSize)}unproject(l){return new o.U(l.x/this.worldSize,l.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(l){const d=this.pointLocation(this.centerPoint,l),m=l.getElevationForLngLatZoom(d,this.tileZoom);if(!(this.elevation-m))return;const v=this.getCameraPosition(),E=o.U.fromLngLat(v.lngLat,v.altitude),F=o.U.fromLngLat(d,m),M=E.x-F.x,N=E.y-F.y,G=E.z-F.z,$=Math.sqrt(M*M+N*N+G*G),J=this.scaleZoom(this.cameraToCenterDistance/$/this.tileSize);this._elevation=m,this._center=d,this.zoom=J}setLocationAtPoint(l,d){const m=this.pointCoordinate(d),v=this.pointCoordinate(this.centerPoint),E=this.locationCoordinate(l),F=new o.U(E.x-(m.x-v.x),E.y-(m.y-v.y));this.center=this.coordinateLocation(F),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(l,d){return d?this.coordinatePoint(this.locationCoordinate(l),d.getElevationForLngLatZoom(l,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(l))}pointLocation(l,d){return this.coordinateLocation(this.pointCoordinate(l,d))}locationCoordinate(l){return o.U.fromLngLat(l)}coordinateLocation(l){return l&&l.toLngLat()}pointCoordinate(l,d){if(d){const ct=d.pointCoordinate(l);if(ct!=null)return ct}const m=[l.x,l.y,0,1],v=[l.x,l.y,1,1];o.ag(m,m,this.pixelMatrixInverse),o.ag(v,v,this.pixelMatrixInverse);const E=m[3],F=v[3],M=m[1]/E,N=v[1]/F,G=m[2]/E,$=v[2]/F,J=G===$?0:(0-G)/($-G);return new o.U(o.B.number(m[0]/E,v[0]/F,J)/this.worldSize,o.B.number(M,N,J)/this.worldSize)}coordinatePoint(l){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.pixelMatrix;const v=[l.x*this.worldSize,l.y*this.worldSize,d,1];return o.ag(v,v,m),new o.P(v[0]/v[3],v[1]/v[3])}getBounds(){const l=Math.max(0,this.height/2-this.getHorizon());return new wt().extend(this.pointLocation(new o.P(0,l))).extend(this.pointLocation(new o.P(this.width,l))).extend(this.pointLocation(new o.P(this.width,this.height))).extend(this.pointLocation(new o.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new wt([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(l){l?(this.lngRange=[l.getWest(),l.getEast()],this.latRange=[l.getSouth(),l.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(l){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const m=l.key,v=d?this._alignedPosMatrixCache:this._posMatrixCache;if(v[m])return v[m];const E=l.canonical,F=this.worldSize/this.zoomScale(E.z),M=E.x+Math.pow(2,E.z)*l.wrap,N=o.ao(new Float64Array(16));return o.$(N,N,[M*F,E.y*F,0]),o.a0(N,N,[F/o.N,F/o.N,1]),o.a1(N,d?this.alignedProjMatrix:this.projMatrix,N),v[m]=new Float32Array(N),v[m]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let l,d,m,v,E=-90,F=90,M=-180,N=180;const G=this.size,$=this._unmodified;if(this.latRange){const Ct=this.latRange;E=o.H(Ct[1])*this.worldSize,F=o.H(Ct[0])*this.worldSize,l=F-E<G.y?G.y/(F-E):0}if(this.lngRange){const Ct=this.lngRange;M=o.b5(o.G(Ct[0])*this.worldSize,0,this.worldSize),N=o.b5(o.G(Ct[1])*this.worldSize,0,this.worldSize),N<M&&(N+=this.worldSize),d=N-M<G.x?G.x/(N-M):0}const J=this.point,ct=Math.max(d||0,l||0);if(ct)return this.center=this.unproject(new o.P(d?(N+M)/2:J.x,l?(F+E)/2:J.y)),this.zoom+=this.scaleZoom(ct),this._unmodified=$,void(this._constraining=!1);if(this.latRange){const Ct=J.y,y=G.y/2;Ct-y<E&&(v=E+y),Ct+y>F&&(v=F-y)}if(this.lngRange){const Ct=(M+N)/2,y=o.b5(J.x,Ct-this.worldSize/2,Ct+this.worldSize/2),S=G.x/2;y-S<M&&(m=M+S),y+S>N&&(m=N-S)}m===void 0&&v===void 0||(this.center=this.unproject(new o.P(m!==void 0?m:J.x,v!==void 0?v:J.y)).wrap()),this._unmodified=$,this._constraining=!1}_calcMatrices(){if(!this.height)return;const l=this.centerOffset,d=this.point.x,m=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=o.b7(1,this.center.lat)*this.worldSize;let v=o.ao(new Float64Array(16));o.a0(v,v,[this.width/2,-this.height/2,1]),o.$(v,v,[1,-1,0]),this.labelPlaneMatrix=v,v=o.ao(new Float64Array(16)),o.a0(v,v,[1,-1,1]),o.$(v,v,[-1,-1,0]),o.a0(v,v,[2/this.width,2/this.height,1]),this.glCoordMatrix=v;const E=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),F=Math.min(this.elevation,this._minEleveationForCurrentTile),M=E-F*this._pixelPerMeter/Math.cos(this._pitch),N=F<0?M:E,G=Math.PI/2+this._pitch,$=this._fov*(.5+l.y/this.height),J=Math.sin($)*N/Math.sin(o.ad(Math.PI-G-$,.01,Math.PI-.01)),ct=this.getHorizon(),Ct=2*Math.atan(ct/this.cameraToCenterDistance)*(.5+l.y/(2*ct)),y=Math.sin(Ct)*N/Math.sin(o.ad(Math.PI-G-Ct,.01,Math.PI-.01)),S=Math.min(J,y),I=1.01*(Math.cos(Math.PI/2-this._pitch)*S+N),O=this.height/50;v=new Float64Array(16),o.b8(v,this._fov,this.width/this.height,O,I),v[8]=2*-l.x/this.width,v[9]=2*l.y/this.height,o.a0(v,v,[1,-1,1]),o.$(v,v,[0,0,-this.cameraToCenterDistance]),o.b9(v,v,this._pitch),o.ae(v,v,this.angle),o.$(v,v,[-d,-m,0]),this.mercatorMatrix=o.a0([],v,[this.worldSize,this.worldSize,this.worldSize]),o.a0(v,v,[1,1,this._pixelPerMeter]),this.pixelMatrix=o.a1(new Float64Array(16),this.labelPlaneMatrix,v),o.$(v,v,[0,0,-this.elevation]),this.projMatrix=v,this.invProjMatrix=o.as([],v),this.pixelMatrix3D=o.a1(new Float64Array(16),this.labelPlaneMatrix,v);const V=this.width%2/2,H=this.height%2/2,q=Math.cos(this.angle),X=Math.sin(this.angle),Z=d-Math.round(d)+q*V+X*H,ot=m-Math.round(m)+q*H+X*V,xt=new Float64Array(v);if(o.$(xt,xt,[Z>.5?Z-1:Z,ot>.5?ot-1:ot,0]),this.alignedProjMatrix=xt,v=o.as(new Float64Array(16),this.pixelMatrix),!v)throw new Error("failed to invert matrix");this.pixelMatrixInverse=v,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const l=this.pointCoordinate(new o.P(0,0)),d=[l.x*this.worldSize,l.y*this.worldSize,0,1];return o.ag(d,d,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(0,l))}getCameraQueryGeometry(l){const d=this.getCameraPoint();if(l.length===1)return[l[0],d];{let m=d.x,v=d.y,E=d.x,F=d.y;for(const M of l)m=Math.min(m,M.x),v=Math.min(v,M.y),E=Math.max(E,M.x),F=Math.max(F,M.y);return[new o.P(m,v),new o.P(E,v),new o.P(E,F),new o.P(m,F),new o.P(m,v)]}}}function Ns(w,l){var d=this;let m,v=!1,E=null,F=null;const M=()=>{E=null,v&&(w.apply(F,m),E=setTimeout(M,l),v=!1)};return function(){for(var N=arguments.length,G=new Array(N),$=0;$<N;$++)G[$]=arguments[$];return v=!0,F=d,m=G,E||M(),E}}class gs{constructor(l){this._getCurrentHash=()=>{const d=window.location.hash.replace("#","");if(this._hashName){let m;return d.split("&").map(v=>v.split("=")).forEach(v=>{v[0]===this._hashName&&(m=v)}),(m&&m[1]||"").split("/")}return d.split("/")},this._onHashChange=()=>{const d=this._getCurrentHash();if(d.length>=3&&!d.some(m=>isNaN(m))){const m=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(d[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+d[2],+d[1]],zoom:+d[0],bearing:m,pitch:+(d[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const d=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,d)}catch{}},this._updateHash=Ns(this._updateHashUnthrottled,300),this._hashName=l&&encodeURIComponent(l)}addTo(l){return this._map=l,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(l){const d=this._map.getCenter(),m=Math.round(100*this._map.getZoom())/100,v=Math.ceil((m*Math.LN2+Math.log(512/360/.5))/Math.LN10),E=Math.pow(10,v),F=Math.round(d.lng*E)/E,M=Math.round(d.lat*E)/E,N=this._map.getBearing(),G=this._map.getPitch();let $="";if($+=l?`/${F}/${M}/${m}`:`${m}/${M}/${F}`,(N||G)&&($+="/"+Math.round(10*N)/10),G&&($+=`/${Math.round(G)}`),this._hashName){const J=this._hashName;let ct=!1;const Ct=window.location.hash.slice(1).split("&").map(y=>{const S=y.split("=")[0];return S===J?(ct=!0,`${S}=${$}`):y}).filter(y=>y);return ct||Ct.push(`${J}=${$}`),`#${Ct.join("&")}`}return`#${$}`}}const ms={linearity:.3,easing:o.ba(0,0,.3,1)},Va=o.e({deceleration:2500,maxSpeed:1400},ms),Xo=o.e({deceleration:20,maxSpeed:1400},ms),ba=o.e({deceleration:1e3,maxSpeed:360},ms),ll=o.e({deceleration:1e3,maxSpeed:90},ms);class Io{constructor(l){this._map=l,this.clear()}clear(){this._inertiaBuffer=[]}record(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.h.now(),settings:l})}_drainInertiaBuffer(){const l=this._inertiaBuffer,d=o.h.now();for(;l.length>0&&d-l[0].time>160;)l.shift()}_onMoveEnd(l){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const d={zoom:0,bearing:0,pitch:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:E}of this._inertiaBuffer)d.zoom+=E.zoomDelta||0,d.bearing+=E.bearingDelta||0,d.pitch+=E.pitchDelta||0,E.panDelta&&d.pan._add(E.panDelta),E.around&&(d.around=E.around),E.pinchAround&&(d.pinchAround=E.pinchAround);const m=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,v={};if(d.pan.mag()){const E=ja(d.pan.mag(),m,o.e({},Va,l||{}));v.offset=d.pan.mult(E.amount/d.pan.mag()),v.center=this._map.transform.center,Es(v,E)}if(d.zoom){const E=ja(d.zoom,m,Xo);v.zoom=this._map.transform.zoom+E.amount,Es(v,E)}if(d.bearing){const E=ja(d.bearing,m,ba);v.bearing=this._map.transform.bearing+o.ad(E.amount,-179,179),Es(v,E)}if(d.pitch){const E=ja(d.pitch,m,ll);v.pitch=this._map.transform.pitch+E.amount,Es(v,E)}if(v.zoom||v.bearing){const E=d.pinchAround===void 0?d.around:d.pinchAround;v.around=E?this._map.unproject(E):this._map.getCenter()}return this.clear(),o.e(v,{noMoveStart:!0})}}function Es(w,l){(!w.duration||w.duration<l.duration)&&(w.duration=l.duration,w.easing=l.easing)}function ja(w,l,d){const{maxSpeed:m,linearity:v,deceleration:E}=d,F=o.ad(w*v/(l/1e3),-m,m),M=Math.abs(F)/(E*v);return{easing:d.easing,duration:1e3*M,amount:F*(M/2)}}class Ei extends o.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,d,m){let v=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const E=f.mousePos(d.getCanvasContainer(),m),F=d.unproject(E);super(l,o.e({point:E,lngLat:F,originalEvent:m},v)),this._defaultPrevented=!1,this.target=d}}class Ss extends o.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,d,m){const v=l==="touchend"?m.changedTouches:m.touches,E=f.touchPos(d.getCanvasContainer(),v),F=E.map(N=>d.unproject(N)),M=E.reduce((N,G,$,J)=>N.add(G.div(J.length)),new o.P(0,0));super(l,{points:E,point:M,lngLats:F,lngLat:d.unproject(M),originalEvent:m}),this._defaultPrevented=!1}}class wa extends o.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,d,m){super(l,{originalEvent:m}),this._defaultPrevented=!1}}class xc{constructor(l,d){this._map=l,this._clickTolerance=d.clickTolerance}reset(){delete this._mousedownPos}wheel(l){return this._firePreventable(new wa(l.type,this._map,l))}mousedown(l,d){return this._mousedownPos=d,this._firePreventable(new Ei(l.type,this._map,l))}mouseup(l){this._map.fire(new Ei(l.type,this._map,l))}click(l,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||this._map.fire(new Ei(l.type,this._map,l))}dblclick(l){return this._firePreventable(new Ei(l.type,this._map,l))}mouseover(l){this._map.fire(new Ei(l.type,this._map,l))}mouseout(l){this._map.fire(new Ei(l.type,this._map,l))}touchstart(l){return this._firePreventable(new Ss(l.type,this._map,l))}touchmove(l){this._map.fire(new Ss(l.type,this._map,l))}touchend(l){this._map.fire(new Ss(l.type,this._map,l))}touchcancel(l){this._map.fire(new Ss(l.type,this._map,l))}_firePreventable(l){if(this._map.fire(l),l.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Al{constructor(l){this._map=l}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(l){this._map.fire(new Ei(l.type,this._map,l))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ei("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(l){this._delayContextMenu?this._contextMenuEvent=l:this._ignoreContextMenu||this._map.fire(new Ei(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ts{constructor(l){this._map=l}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(l){return this.transform.pointLocation(o.P.convert(l),this._map.terrain)}}class qa{constructor(l,d){this._map=l,this._tr=new Ts(l),this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=d.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(l,d){this.isEnabled()&&l.shiftKey&&l.button===0&&(f.disableDrag(),this._startPos=this._lastPos=d,this._active=!0)}mousemoveWindow(l,d){if(!this._active)return;const m=d;if(this._lastPos.equals(m)||!this._box&&m.dist(this._startPos)<this._clickTolerance)return;const v=this._startPos;this._lastPos=m,this._box||(this._box=f.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",l));const E=Math.min(v.x,m.x),F=Math.max(v.x,m.x),M=Math.min(v.y,m.y),N=Math.max(v.y,m.y);f.setTransform(this._box,`translate(${E}px,${M}px)`),this._box.style.width=F-E+"px",this._box.style.height=N-M+"px"}mouseupWindow(l,d){if(!this._active||l.button!==0)return;const m=this._startPos,v=d;if(this.reset(),f.suppressClick(),m.x!==v.x||m.y!==v.y)return this._map.fire(new o.k("boxzoomend",{originalEvent:l})),{cameraAnimation:E=>E.fitScreenCoordinates(m,v,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",l)}keydown(l){this._active&&l.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",l))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(f.remove(this._box),this._box=null),f.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(l,d){return this._map.fire(new o.k(l,{originalEvent:d}))}}function ys(w,l){if(w.length!==l.length)throw new Error(`The number of touches and points are not equal - touches ${w.length}, points ${l.length}`);const d={};for(let m=0;m<w.length;m++)d[w[m].identifier]=l[m];return d}class Si{constructor(l){this.reset(),this.numTouches=l.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(l,d,m){(this.centroid||m.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=l.timeStamp),m.length===this.numTouches&&(this.centroid=function(v){const E=new o.P(0,0);for(const F of v)E._add(F);return E.div(v.length)}(d),this.touches=ys(m,d)))}touchmove(l,d,m){if(this.aborted||!this.centroid)return;const v=ys(m,d);for(const E in this.touches){const F=v[E];(!F||F.dist(this.touches[E])>30)&&(this.aborted=!0)}}touchend(l,d,m){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),m.length===0){const v=!this.aborted&&this.centroid;if(this.reset(),v)return v}}}class Lo{constructor(l){this.singleTap=new Si(l),this.numTaps=l.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(l,d,m){this.singleTap.touchstart(l,d,m)}touchmove(l,d,m){this.singleTap.touchmove(l,d,m)}touchend(l,d,m){const v=this.singleTap.touchend(l,d,m);if(v){const E=l.timeStamp-this.lastTime<500,F=!this.lastTap||this.lastTap.dist(v)<30;if(E&&F||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=v,this.count===this.numTaps)return this.reset(),v}}}class bn{constructor(l){this._tr=new Ts(l),this._zoomIn=new Lo({numTouches:1,numTaps:2}),this._zoomOut=new Lo({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(l,d,m){this._zoomIn.touchstart(l,d,m),this._zoomOut.touchstart(l,d,m)}touchmove(l,d,m){this._zoomIn.touchmove(l,d,m),this._zoomOut.touchmove(l,d,m)}touchend(l,d,m){const v=this._zoomIn.touchend(l,d,m),E=this._zoomOut.touchend(l,d,m),F=this._tr;return v?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:M=>M.easeTo({duration:300,zoom:F.zoom+1,around:F.unproject(v)},{originalEvent:l})}):E?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:M=>M.easeTo({duration:300,zoom:F.zoom-1,around:F.unproject(E)},{originalEvent:l})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class wn{constructor(l){this._enabled=!!l.enable,this._moveStateManager=l.moveStateManager,this._clickTolerance=l.clickTolerance||1,this._moveFunction=l.move,this._activateOnStart=!!l.activateOnStart,l.assignEvents(this),this.reset()}reset(l){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(l)}_move(){const l=this._moveFunction(...arguments);if(l.bearingDelta||l.pitchDelta||l.around||l.panDelta)return this._active=!0,l}dragStart(l,d){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(l)&&(this._moveStateManager.startMove(l),this._lastPoint=d.length?d[0]:d,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(l,d){if(!this.isEnabled())return;const m=this._lastPoint;if(!m)return;if(l.preventDefault(),!this._moveStateManager.isValidMoveEvent(l))return void this.reset(l);const v=d.length?d[0]:d;return!this._moved&&v.dist(m)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=v,this._move(m,v))}dragEnd(l){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(l)&&(this._moved&&f.suppressClick(),this.reset(l))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const bi={0:1,2:2};class wi{constructor(l){this._correctEvent=l.checkCorrectEvent}startMove(l){const d=f.mouseButton(l);this._eventButton=d}endMove(l){delete this._eventButton}isValidStartEvent(l){return this._correctEvent(l)}isValidMoveEvent(l){return!function(d,m){const v=bi[m];return d.buttons===void 0||(d.buttons&v)!==v}(l,this._eventButton)}isValidEndEvent(l){return f.mouseButton(l)===this._eventButton}}class xa{constructor(){this._firstTouch=void 0}_isOneFingerTouch(l){return l.targetTouches.length===1}_isSameTouchEvent(l){return l.targetTouches[0].identifier===this._firstTouch}startMove(l){this._firstTouch=l.targetTouches[0].identifier}endMove(l){delete this._firstTouch}isValidStartEvent(l){return this._isOneFingerTouch(l)}isValidMoveEvent(l){return this._isOneFingerTouch(l)&&this._isSameTouchEvent(l)}isValidEndEvent(l){return this._isOneFingerTouch(l)&&this._isSameTouchEvent(l)}}const Jo=w=>{w.mousedown=w.dragStart,w.mousemoveWindow=w.dragMove,w.mouseup=w.dragEnd,w.contextmenu=function(l){l.preventDefault()}},Yo=w=>{let{enable:l,clickTolerance:d,bearingDegreesPerPixelMoved:m=.8}=w;const v=new wi({checkCorrectEvent:E=>f.mouseButton(E)===0&&E.ctrlKey||f.mouseButton(E)===2});return new wn({clickTolerance:d,move:(E,F)=>({bearingDelta:(F.x-E.x)*m}),moveStateManager:v,enable:l,assignEvents:Jo})},Fo=w=>{let{enable:l,clickTolerance:d,pitchDegreesPerPixelMoved:m=-.5}=w;const v=new wi({checkCorrectEvent:E=>f.mouseButton(E)===0&&E.ctrlKey||f.mouseButton(E)===2});return new wn({clickTolerance:d,move:(E,F)=>({pitchDelta:(F.y-E.y)*m}),moveStateManager:v,enable:l,assignEvents:Jo})};class ar{constructor(l,d){this._minTouches=l.cooperativeGestures?2:1,this._clickTolerance=l.clickTolerance||1,this._map=d,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(l,d,m){return this._calculateTransform(l,d,m)}touchmove(l,d,m){if(this._map._cooperativeGestures&&(this._minTouches===2&&m.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(l,!1,m.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(m.length<this._minTouches))return l.preventDefault(),this._calculateTransform(l,d,m)}touchend(l,d,m){this._calculateTransform(l,d,m),this._active&&m.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(l,d,m){m.length>0&&(this._active=!0);const v=ys(m,d),E=new o.P(0,0),F=new o.P(0,0);let M=0;for(const G in v){const $=v[G],J=this._touches[G];J&&(E._add($),F._add($.sub(J)),M++,v[G]=$)}if(this._touches=v,M<this._minTouches||!F.mag())return;const N=F.div(M);return this._sum._add(N),this._sum.mag()<this._clickTolerance?void 0:{around:E.div(M),panDelta:N}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class $A{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(l,d,m){this._firstTwoTouches||m.length<2||(this._firstTwoTouches=[m[0].identifier,m[1].identifier],this._start([d[0],d[1]]))}touchmove(l,d,m){if(!this._firstTwoTouches)return;l.preventDefault();const[v,E]=this._firstTwoTouches,F=Ka(m,d,v),M=Ka(m,d,E);if(!F||!M)return;const N=this._aroundCenter?null:F.add(M).div(2);return this._move([F,M],N,l)}touchend(l,d,m){if(!this._firstTwoTouches)return;const[v,E]=this._firstTwoTouches,F=Ka(m,d,v),M=Ka(m,d,E);F&&M||(this._active&&f.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(l){this._enabled=!0,this._aroundCenter=!!l&&l.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Ka(w,l,d){for(let m=0;m<w.length;m++)if(w[m].identifier===d)return l[m]}function ul(w,l){return Math.log(w/l)/Math.LN2}class Yh extends $A{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(l){this._startDistance=this._distance=l[0].dist(l[1])}_move(l,d){const m=this._distance;if(this._distance=l[0].dist(l[1]),this._active||!(Math.abs(ul(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ul(this._distance,m),pinchAround:d}}}function tr(w,l){return 180*w.angleWith(l)/Math.PI}class WA extends $A{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(l){this._startVector=this._vector=l[0].sub(l[1]),this._minDiameter=l[0].dist(l[1])}_move(l,d){const m=this._vector;if(this._vector=l[0].sub(l[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:tr(this._vector,m),pinchAround:d}}_isBelowThreshold(l){this._minDiameter=Math.min(this._minDiameter,l.mag());const d=25/(Math.PI*this._minDiameter)*360,m=tr(l,this._startVector);return Math.abs(m)<d}}function nA(w){return Math.abs(w.y)>Math.abs(w.x)}class to extends $A{constructor(l){super(),this._map=l}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(l,d,m){super.touchstart(l,d,m),this._currentTouchCount=m.length}_start(l){this._lastPoints=l,nA(l[0].sub(l[1]))&&(this._valid=!1)}_move(l,d,m){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const v=l[0].sub(this._lastPoints[0]),E=l[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(v,E,m.timeStamp),this._valid?(this._lastPoints=l,this._active=!0,{pitchDelta:(v.y+E.y)/2*-.5}):void 0}gestureBeginsVertically(l,d,m){if(this._valid!==void 0)return this._valid;const v=l.mag()>=2,E=d.mag()>=2;if(!v&&!E)return;if(!v||!E)return this._firstMove===void 0&&(this._firstMove=m),m-this._firstMove<100&&void 0;const F=l.y>0==d.y>0;return nA(l)&&nA(d)&&F}}const ks={panStep:100,bearingStep:15,pitchStep:10};class XA{constructor(l){this._tr=new Ts(l);const d=ks;this._panStep=d.panStep,this._bearingStep=d.bearingStep,this._pitchStep=d.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(l){if(l.altKey||l.ctrlKey||l.metaKey)return;let d=0,m=0,v=0,E=0,F=0;switch(l.keyCode){case 61:case 107:case 171:case 187:d=1;break;case 189:case 109:case 173:d=-1;break;case 37:l.shiftKey?m=-1:(l.preventDefault(),E=-1);break;case 39:l.shiftKey?m=1:(l.preventDefault(),E=1);break;case 38:l.shiftKey?v=1:(l.preventDefault(),F=-1);break;case 40:l.shiftKey?v=-1:(l.preventDefault(),F=1);break;default:return}return this._rotationDisabled&&(m=0,v=0),{cameraAnimation:M=>{const N=this._tr;M.easeTo({duration:300,easeId:"keyboardHandler",easing:JA,zoom:d?Math.round(N.zoom)+d*(l.shiftKey?2:1):N.zoom,bearing:N.bearing+m*this._bearingStep,pitch:N.pitch+v*this._pitchStep,offset:[-E*this._panStep,-F*this._panStep],center:N.center},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function JA(w){return w*(2-w)}const Zh=4.000244140625;class $u{constructor(l,d){this._onTimeout=m=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(m)},this._map=l,this._tr=new Ts(l),this._el=l.getCanvasContainer(),this._triggerRenderFrame=d,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(l){this._defaultZoomRate=l}setWheelZoomRate(l){this._wheelZoomRate=l}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!l&&l.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(l){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!l[this._map._metaKey])return;l.preventDefault()}let d=l.deltaMode===WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY;const m=o.h.now(),v=m-(this._lastWheelEventTime||0);this._lastWheelEventTime=m,d!==0&&d%Zh==0?this._type="wheel":d!==0&&Math.abs(d)<4?this._type="trackpad":v>400?(this._type=null,this._lastValue=d,this._timeout=setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(v*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),l.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=l,this._delta-=d,this._active||this._start(l)),l.preventDefault()}_start(l){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const d=f.mousePos(this._el,l),m=this._tr;this._around=o.L.convert(this._aroundCenter?m.center:m.unproject(d)),this._aroundPoint=m.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const l=this._tr.transform;if(this._delta!==0){const M=this._type==="wheel"&&Math.abs(this._delta)>Zh?this._wheelZoomRate:this._defaultZoomRate;let N=2/(1+Math.exp(-Math.abs(this._delta*M)));this._delta<0&&N!==0&&(N=1/N);const G=typeof this._targetZoom=="number"?l.zoomScale(this._targetZoom):l.scale;this._targetZoom=Math.min(l.maxZoom,Math.max(l.minZoom,l.scaleZoom(G*N))),this._type==="wheel"&&(this._startZoom=l.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const d=typeof this._targetZoom=="number"?this._targetZoom:l.zoom,m=this._startZoom,v=this._easing;let E,F=!1;if(this._type==="wheel"&&m&&v){const M=Math.min((o.h.now()-this._lastWheelEventTime)/200,1),N=v(M);E=o.B.number(m,d,N),M<1?this._frameId||(this._frameId=!0):F=!0}else E=d,F=!0;return this._active=!0,F&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!F,zoomDelta:E-l.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(l){let d=o.bb;if(this._prevEase){const m=this._prevEase,v=(o.h.now()-m.start)/m.duration,E=m.easing(v+.01)-m.easing(v),F=.27/Math.sqrt(E*E+1e-4)*.01,M=Math.sqrt(.0729-F*F);d=o.ba(F,M,.25,1)}return this._prevEase={start:o.h.now(),duration:l,easing:d},d}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class iA{constructor(l,d){this._clickZoom=l,this._tapZoom=d}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class YA{constructor(l){this._tr=new Ts(l),this.reset()}reset(){this._active=!1}dblclick(l,d){return l.preventDefault(),{cameraAnimation:m=>{m.easeTo({duration:300,zoom:this._tr.zoom+(l.shiftKey?-1:1),around:this._tr.unproject(d)},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Wu{constructor(){this._tap=new Lo({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(l,d,m){if(!this._swipePoint)if(this._tapTime){const v=d[0],E=l.timeStamp-this._tapTime<500,F=this._tapPoint.dist(v)<30;E&&F?m.length>0&&(this._swipePoint=v,this._swipeTouch=m[0].identifier):this.reset()}else this._tap.touchstart(l,d,m)}touchmove(l,d,m){if(this._tapTime){if(this._swipePoint){if(m[0].identifier!==this._swipeTouch)return;const v=d[0],E=v.y-this._swipePoint.y;return this._swipePoint=v,l.preventDefault(),this._active=!0,{zoomDelta:E/128}}}else this._tap.touchmove(l,d,m)}touchend(l,d,m){if(this._tapTime)this._swipePoint&&m.length===0&&this.reset();else{const v=this._tap.touchend(l,d,m);v&&(this._tapTime=l.timeStamp,this._tapPoint=v)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ZA{constructor(l,d,m){this._el=l,this._mousePan=d,this._touchPan=m}enable(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class _s{constructor(l,d,m){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=d,this._mousePitch=m}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Zo{constructor(l,d,m,v){this._el=l,this._touchZoom=d,this._touchRotate=m,this._tapDragZoom=v,this._rotationDisabled=!1,this._enabled=!0}enable(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const hl=w=>w.zoom||w.drag||w.pitch||w.rotate;class td extends o.k{}function tu(w){return w.panDelta&&w.panDelta.mag()||w.zoomDelta||w.bearingDelta||w.pitchDelta}class Xu{constructor(l,d){this.handleWindowEvent=v=>{this.handleEvent(v,`${v.type}Window`)},this.handleEvent=(v,E)=>{if(v.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const F=v.type==="renderFrame"?void 0:v,M={needsRenderFrame:!1},N={},G={},$=v.touches,J=$?this._getMapTouches($):void 0,ct=J?f.touchPos(this._el,J):f.mousePos(this._el,v);for(const{handlerName:S,handler:I,allowed:O}of this._handlers){if(!I.isEnabled())continue;let V;this._blockedByActive(G,O,S)?I.reset():I[E||v.type]&&(V=I[E||v.type](v,ct,J),this.mergeHandlerResult(M,N,V,S,F),V&&V.needsRenderFrame&&this._triggerRenderFrame()),(V||I.isActive())&&(G[S]=I)}const Ct={};for(const S in this._previousActiveHandlers)G[S]||(Ct[S]=F);this._previousActiveHandlers=G,(Object.keys(Ct).length||tu(M))&&(this._changes.push([M,N,Ct]),this._triggerRenderFrame()),(Object.keys(G).length||tu(M))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:y}=M;y&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],y(this._map))},this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Io(l),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(d);const m=this._el;this._listeners=[[m,"touchstart",{passive:!0}],[m,"touchmove",{passive:!1}],[m,"touchend",void 0],[m,"touchcancel",void 0],[m,"mousedown",void 0],[m,"mousemove",void 0],[m,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[m,"mouseover",void 0],[m,"mouseout",void 0],[m,"dblclick",void 0],[m,"click",void 0],[m,"keydown",{capture:!1}],[m,"keyup",void 0],[m,"wheel",{passive:!1}],[m,"contextmenu",void 0],[window,"blur",void 0]];for(const[v,E,F]of this._listeners)f.addEventListener(v,E,v===document?this.handleWindowEvent:this.handleEvent,F)}destroy(){for(const[l,d,m]of this._listeners)f.removeEventListener(l,d,l===document?this.handleWindowEvent:this.handleEvent,m)}_addDefaultHandlers(l){const d=this._map,m=d.getCanvasContainer();this._add("mapEvent",new xc(d,l));const v=d.boxZoom=new qa(d,l);this._add("boxZoom",v),l.interactive&&l.boxZoom&&v.enable();const E=new bn(d),F=new YA(d);d.doubleClickZoom=new iA(F,E),this._add("tapZoom",E),this._add("clickZoom",F),l.interactive&&l.doubleClickZoom&&d.doubleClickZoom.enable();const M=new Wu;this._add("tapDragZoom",M);const N=d.touchPitch=new to(d);this._add("touchPitch",N),l.interactive&&l.touchPitch&&d.touchPitch.enable(l.touchPitch);const G=Yo(l),$=Fo(l);d.dragRotate=new _s(l,G,$),this._add("mouseRotate",G,["mousePitch"]),this._add("mousePitch",$,["mouseRotate"]),l.interactive&&l.dragRotate&&d.dragRotate.enable();const J=(O=>{let{enable:V,clickTolerance:H}=O;const q=new wi({checkCorrectEvent:X=>f.mouseButton(X)===0&&!X.ctrlKey});return new wn({clickTolerance:H,move:(X,Z)=>({around:Z,panDelta:Z.sub(X)}),activateOnStart:!0,moveStateManager:q,enable:V,assignEvents:Jo})})(l),ct=new ar(l,d);d.dragPan=new ZA(m,J,ct),this._add("mousePan",J),this._add("touchPan",ct,["touchZoom","touchRotate"]),l.interactive&&l.dragPan&&d.dragPan.enable(l.dragPan);const Ct=new WA,y=new Yh;d.touchZoomRotate=new Zo(m,y,Ct,M),this._add("touchRotate",Ct,["touchPan","touchZoom"]),this._add("touchZoom",y,["touchPan","touchRotate"]),l.interactive&&l.touchZoomRotate&&d.touchZoomRotate.enable(l.touchZoomRotate);const S=d.scrollZoom=new $u(d,()=>this._triggerRenderFrame());this._add("scrollZoom",S,["mousePan"]),l.interactive&&l.scrollZoom&&d.scrollZoom.enable(l.scrollZoom);const I=d.keyboard=new XA(d);this._add("keyboard",I),l.interactive&&l.keyboard&&d.keyboard.enable(),this._add("blockableMapEvent",new Al(d))}_add(l,d,m){this._handlers.push({handlerName:l,handler:d,allowed:m}),this._handlersById[l]=d}stop(l){if(!this._updatingCamera){for(const{handler:d}of this._handlers)d.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[]}}isActive(){for(const{handler:l}of this._handlers)if(l.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!hl(this._eventsInProgress)||this.isZooming()}_blockedByActive(l,d,m){for(const v in l)if(v!==m&&(!d||d.indexOf(v)<0))return!0;return!1}_getMapTouches(l){const d=[];for(const m of l)this._el.contains(m.target)&&d.push(m);return d}mergeHandlerResult(l,d,m,v,E){if(!m)return;o.e(l,m);const F={handlerName:v,originalEvent:m.originalEvent||E};m.zoomDelta!==void 0&&(d.zoom=F),m.panDelta!==void 0&&(d.drag=F),m.pitchDelta!==void 0&&(d.pitch=F),m.bearingDelta!==void 0&&(d.rotate=F)}_applyChanges(){const l={},d={},m={};for(const[v,E,F]of this._changes)v.panDelta&&(l.panDelta=(l.panDelta||new o.P(0,0))._add(v.panDelta)),v.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+v.zoomDelta),v.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+v.bearingDelta),v.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+v.pitchDelta),v.around!==void 0&&(l.around=v.around),v.pinchAround!==void 0&&(l.pinchAround=v.pinchAround),v.noInertia&&(l.noInertia=v.noInertia),o.e(d,E),o.e(m,F);this._updateMapTransform(l,d,m),this._changes=[]}_updateMapTransform(l,d,m){const v=this._map,E=v._getTransformForUpdate(),F=v.terrain;if(!(tu(l)||F&&this._terrainMovement))return this._fireEvents(d,m,!0);let{panDelta:M,zoomDelta:N,bearingDelta:G,pitchDelta:$,around:J,pinchAround:ct}=l;ct!==void 0&&(J=ct),v._stop(!0),J=J||v.transform.centerPoint;const Ct=E.pointLocation(M?J.sub(M):J);G&&(E.bearing+=G),$&&(E.pitch+=$),N&&(E.zoom+=N),F?this._terrainMovement||!d.drag&&!d.zoom?d.drag&&this._terrainMovement?E.center=E.pointLocation(E.centerPoint.sub(M)):E.setLocationAtPoint(Ct,J):(this._terrainMovement=!0,this._map._elevationFreeze=!0,E.setLocationAtPoint(Ct,J),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,E.recalculateZoom(v.terrain)})):E.setLocationAtPoint(Ct,J),v._applyUpdatedTransform(E),this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(d,m,!0)}_fireEvents(l,d,m){const v=hl(this._eventsInProgress),E=hl(l),F={};for(const $ in l){const{originalEvent:J}=l[$];this._eventsInProgress[$]||(F[`${$}start`]=J),this._eventsInProgress[$]=l[$]}!v&&E&&this._fireEvent("movestart",E.originalEvent);for(const $ in F)this._fireEvent($,F[$]);E&&this._fireEvent("move",E.originalEvent);for(const $ in l){const{originalEvent:J}=l[$];this._fireEvent($,J)}const M={};let N;for(const $ in this._eventsInProgress){const{handlerName:J,originalEvent:ct}=this._eventsInProgress[$];this._handlersById[J].isActive()||(delete this._eventsInProgress[$],N=d[J]||ct,M[`${$}end`]=N)}for(const $ in M)this._fireEvent($,M[$]);const G=hl(this._eventsInProgress);if(m&&(v||E)&&!G){this._updatingCamera=!0;const $=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),J=ct=>ct!==0&&-this._bearingSnap<ct&&ct<this._bearingSnap;!$||!$.essential&&o.h.prefersReducedMotion?(this._map.fire(new o.k("moveend",{originalEvent:N})),J(this._map.getBearing())&&this._map.resetNorth()):(J($.bearing||this._map.getBearing())&&($.bearing=0),$.freezeElevation=!0,this._map.easeTo($,{originalEvent:N})),this._updatingCamera=!1}}_fireEvent(l,d){this._map.fire(new o.k(l,d?{originalEvent:d}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(l=>{delete this._frameId,this.handleEvent(new td("renderFrame",{timeStamp:l})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Gf extends o.E{constructor(l,d){super(),this._renderFrameCallback=()=>{const m=Math.min((o.h.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(m)),m<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=l,this._bearingSnap=d.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new o.L(this.transform.center.lng,this.transform.center.lat)}setCenter(l,d){return this.jumpTo({center:l},d)}panBy(l,d,m){return l=o.P.convert(l).mult(-1),this.panTo(this.transform.center,o.e({offset:l},d),m)}panTo(l,d,m){return this.easeTo(o.e({center:l},d),m)}getZoom(){return this.transform.zoom}setZoom(l,d){return this.jumpTo({zoom:l},d),this}zoomTo(l,d,m){return this.easeTo(o.e({zoom:l},d),m)}zoomIn(l,d){return this.zoomTo(this.getZoom()+1,l,d),this}zoomOut(l,d){return this.zoomTo(this.getZoom()-1,l,d),this}getBearing(){return this.transform.bearing}setBearing(l,d){return this.jumpTo({bearing:l},d),this}getPadding(){return this.transform.padding}setPadding(l,d){return this.jumpTo({padding:l},d),this}rotateTo(l,d,m){return this.easeTo(o.e({bearing:l},d),m)}resetNorth(l,d){return this.rotateTo(0,o.e({duration:1e3},l),d),this}resetNorthPitch(l,d){return this.easeTo(o.e({bearing:0,pitch:0,duration:1e3},l),d),this}snapToNorth(l,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(l,d):this}getPitch(){return this.transform.pitch}setPitch(l,d){return this.jumpTo({pitch:l},d),this}cameraForBounds(l,d){l=wt.convert(l);const m=d&&d.bearing||0;return this._cameraForBoxAndBearing(l.getNorthWest(),l.getSouthEast(),m,d)}_cameraForBoxAndBearing(l,d,m,v){const E={top:0,bottom:0,right:0,left:0};if(typeof(v=o.e({padding:E,offset:[0,0],maxZoom:this.transform.maxZoom},v)).padding=="number"){const X=v.padding;v.padding={top:X,bottom:X,right:X,left:X}}v.padding=o.e(E,v.padding);const F=this.transform,M=F.padding,N=F.project(o.L.convert(l)),G=F.project(o.L.convert(d)),$=N.rotate(-m*Math.PI/180),J=G.rotate(-m*Math.PI/180),ct=new o.P(Math.max($.x,J.x),Math.max($.y,J.y)),Ct=new o.P(Math.min($.x,J.x),Math.min($.y,J.y)),y=ct.sub(Ct),S=(F.width-(M.left+M.right+v.padding.left+v.padding.right))/y.x,I=(F.height-(M.top+M.bottom+v.padding.top+v.padding.bottom))/y.y;if(I<0||S<0)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const O=Math.min(F.scaleZoom(F.scale*Math.min(S,I)),v.maxZoom),V=o.P.convert(v.offset),H=new o.P((v.padding.left-v.padding.right)/2,(v.padding.top-v.padding.bottom)/2).rotate(m*Math.PI/180),q=V.add(H).mult(F.scale/F.zoomScale(O));return{center:F.unproject(N.add(G).div(2).sub(q)),zoom:O,bearing:m}}fitBounds(l,d,m){return this._fitInternal(this.cameraForBounds(l,d),d,m)}fitScreenCoordinates(l,d,m,v,E){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(o.P.convert(l)),this.transform.pointLocation(o.P.convert(d)),m,v),v,E)}_fitInternal(l,d,m){return l?(delete(d=o.e(l,d)).padding,d.linear?this.easeTo(d,m):this.flyTo(d,m)):this}jumpTo(l,d){this.stop();const m=this._getTransformForUpdate();let v=!1,E=!1,F=!1;return"zoom"in l&&m.zoom!==+l.zoom&&(v=!0,m.zoom=+l.zoom),l.center!==void 0&&(m.center=o.L.convert(l.center)),"bearing"in l&&m.bearing!==+l.bearing&&(E=!0,m.bearing=+l.bearing),"pitch"in l&&m.pitch!==+l.pitch&&(F=!0,m.pitch=+l.pitch),l.padding==null||m.isPaddingEqual(l.padding)||(m.padding=l.padding),this._applyUpdatedTransform(m),this.fire(new o.k("movestart",d)).fire(new o.k("move",d)),v&&this.fire(new o.k("zoomstart",d)).fire(new o.k("zoom",d)).fire(new o.k("zoomend",d)),E&&this.fire(new o.k("rotatestart",d)).fire(new o.k("rotate",d)).fire(new o.k("rotateend",d)),F&&this.fire(new o.k("pitchstart",d)).fire(new o.k("pitch",d)).fire(new o.k("pitchend",d)),this.fire(new o.k("moveend",d))}calculateCameraOptionsFromTo(l,d,m){let v=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;const E=o.U.fromLngLat(l,d),F=o.U.fromLngLat(m,v),M=F.x-E.x,N=F.y-E.y,G=F.z-E.z,$=Math.hypot(M,N,G);if($===0)throw new Error("Can't calculate camera options with same From and To");const J=Math.hypot(M,N),ct=this.transform.scaleZoom(this.transform.cameraToCenterDistance/$/this.transform.tileSize),Ct=180*Math.atan2(M,-N)/Math.PI;let y=180*Math.acos(J/$)/Math.PI;return y=G<0?90-y:90+y,{center:F.toLngLat(),zoom:ct,pitch:y,bearing:Ct}}easeTo(l,d){this._stop(!1,l.easeId),((l=o.e({offset:[0,0],duration:500,easing:o.bb},l)).animate===!1||!l.essential&&o.h.prefersReducedMotion)&&(l.duration=0);const m=this._getTransformForUpdate(),v=this.getZoom(),E=this.getBearing(),F=this.getPitch(),M=this.getPadding(),N="zoom"in l?+l.zoom:v,G="bearing"in l?this._normalizeBearing(l.bearing,E):E,$="pitch"in l?+l.pitch:F,J="padding"in l?l.padding:m.padding,ct=o.P.convert(l.offset);let Ct=m.centerPoint.add(ct);const y=m.pointLocation(Ct),S=o.L.convert(l.center||y);this._normalizeCenter(S);const I=m.project(y),O=m.project(S).sub(I),V=m.zoomScale(N-v);let H,q;l.around&&(H=o.L.convert(l.around),q=m.locationPoint(H));const X={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||N!==v,this._rotating=this._rotating||E!==G,this._pitching=this._pitching||$!==F,this._padding=!m.isPaddingEqual(J),this._easeId=l.easeId,this._prepareEase(d,l.noMoveStart,X),this.terrain&&this._prepareElevation(S),this._ease(Z=>{if(this._zooming&&(m.zoom=o.B.number(v,N,Z)),this._rotating&&(m.bearing=o.B.number(E,G,Z)),this._pitching&&(m.pitch=o.B.number(F,$,Z)),this._padding&&(m.interpolatePadding(M,J,Z),Ct=m.centerPoint.add(ct)),this.terrain&&!l.freezeElevation&&this._updateElevation(Z),H)m.setLocationAtPoint(H,q);else{const ot=m.zoomScale(m.zoom-v),xt=N>v?Math.min(2,V):Math.max(.5,V),Lt=Math.pow(xt,1-Z),kt=m.unproject(I.add(O.mult(Z*Lt)).mult(ot));m.setLocationAtPoint(m.renderWorldCopies?kt.wrap():kt,Ct)}this._applyUpdatedTransform(m),this._fireMoveEvents(d)},Z=>{this.terrain&&this._finalizeElevation(),this._afterEase(d,Z)},l),this}_prepareEase(l,d){let m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this._moving=!0,d||m.moving||this.fire(new o.k("movestart",l)),this._zooming&&!m.zooming&&this.fire(new o.k("zoomstart",l)),this._rotating&&!m.rotating&&this.fire(new o.k("rotatestart",l)),this._pitching&&!m.pitching&&this.fire(new o.k("pitchstart",l))}_prepareElevation(l){this._elevationCenter=l,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(l,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(l){this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const d=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(l<1&&d!==this._elevationTarget){const m=this._elevationTarget-this._elevationStart;this._elevationStart+=l*(m-(d-(m*l+this._elevationStart))/(1-l)),this._elevationTarget=d}this.transform.elevation=o.B.number(this._elevationStart,this._elevationTarget,l)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(l){if(!this.transformCameraUpdate)return;const d=l.clone(),{center:m,zoom:v,pitch:E,bearing:F,elevation:M}=this.transformCameraUpdate(d);m&&(d.center=m),v!==void 0&&(d.zoom=v),E!==void 0&&(d.pitch=E),F!==void 0&&(d.bearing=F),M!==void 0&&(d.elevation=M),this.transform.apply(d)}_fireMoveEvents(l){this.fire(new o.k("move",l)),this._zooming&&this.fire(new o.k("zoom",l)),this._rotating&&this.fire(new o.k("rotate",l)),this._pitching&&this.fire(new o.k("pitch",l))}_afterEase(l,d){if(this._easeId&&d&&this._easeId===d)return;delete this._easeId;const m=this._zooming,v=this._rotating,E=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,m&&this.fire(new o.k("zoomend",l)),v&&this.fire(new o.k("rotateend",l)),E&&this.fire(new o.k("pitchend",l)),this.fire(new o.k("moveend",l))}flyTo(l,d){if(!l.essential&&o.h.prefersReducedMotion){const Nt=o.F(l,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Nt,d)}this.stop(),l=o.e({offset:[0,0],speed:1.2,curve:1.42,easing:o.bb},l);const m=this._getTransformForUpdate(),v=this.getZoom(),E=this.getBearing(),F=this.getPitch(),M=this.getPadding(),N="zoom"in l?o.ad(+l.zoom,m.minZoom,m.maxZoom):v,G="bearing"in l?this._normalizeBearing(l.bearing,E):E,$="pitch"in l?+l.pitch:F,J="padding"in l?l.padding:m.padding,ct=m.zoomScale(N-v),Ct=o.P.convert(l.offset);let y=m.centerPoint.add(Ct);const S=m.pointLocation(y),I=o.L.convert(l.center||S);this._normalizeCenter(I);const O=m.project(S),V=m.project(I).sub(O);let H=l.curve;const q=Math.max(m.width,m.height),X=q/ct,Z=V.mag();if("minZoom"in l){const Nt=o.ad(Math.min(l.minZoom,v,N),m.minZoom,m.maxZoom),be=q/m.zoomScale(Nt-v);H=Math.sqrt(be/Z*2)}const ot=H*H;function xt(Nt){const be=(X*X-q*q+(Nt?-1:1)*ot*ot*Z*Z)/(2*(Nt?X:q)*ot*Z);return Math.log(Math.sqrt(be*be+1)-be)}function Lt(Nt){return(Math.exp(Nt)-Math.exp(-Nt))/2}function kt(Nt){return(Math.exp(Nt)+Math.exp(-Nt))/2}const zt=xt(!1);let me=function(Nt){return kt(zt)/kt(zt+H*Nt)},Wt=function(Nt){return q*((kt(zt)*(Lt(be=zt+H*Nt)/kt(be))-Lt(zt))/ot)/Z;var be},Ot=(xt(!0)-zt)/H;if(Math.abs(Z)<1e-6||!isFinite(Ot)){if(Math.abs(q-X)<1e-6)return this.easeTo(l,d);const Nt=X<q?-1:1;Ot=Math.abs(Math.log(X/q))/H,Wt=function(){return 0},me=function(be){return Math.exp(Nt*H*be)}}return l.duration="duration"in l?+l.duration:1e3*Ot/("screenSpeed"in l?+l.screenSpeed/H:+l.speed),l.maxDuration&&l.duration>l.maxDuration&&(l.duration=0),this._zooming=!0,this._rotating=E!==G,this._pitching=$!==F,this._padding=!m.isPaddingEqual(J),this._prepareEase(d,!1),this.terrain&&this._prepareElevation(I),this._ease(Nt=>{const be=Nt*Ot,ve=1/me(be);m.zoom=Nt===1?N:v+m.scaleZoom(ve),this._rotating&&(m.bearing=o.B.number(E,G,Nt)),this._pitching&&(m.pitch=o.B.number(F,$,Nt)),this._padding&&(m.interpolatePadding(M,J,Nt),y=m.centerPoint.add(Ct)),this.terrain&&!l.freezeElevation&&this._updateElevation(Nt);const he=Nt===1?I:m.unproject(O.add(V.mult(Wt(be))).mult(ve));m.setLocationAtPoint(m.renderWorldCopies?he.wrap():he,y),this._applyUpdatedTransform(m),this._fireMoveEvents(d)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(d)},l),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(l,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const m=this._onEaseEnd;delete this._onEaseEnd,m.call(this,d)}if(!l){const m=this.handlers;m&&m.stop(!1)}return this}_ease(l,d,m){m.animate===!1||m.duration===0?(l(1),d()):(this._easeStart=o.h.now(),this._easeOptions=m,this._onEaseFrame=l,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(l,d){l=o.b5(l,-180,180);const m=Math.abs(l-d);return Math.abs(l-360-d)<m&&(l-=360),Math.abs(l+360-d)<m&&(l+=360),l}_normalizeCenter(l){const d=this.transform;if(!d.renderWorldCopies||d.lngRange)return;const m=l.lng-d.center.lng;l.lng+=m>180?-360:m<-180?360:0}queryTerrainElevation(l){return this.terrain?this.terrain.getElevationForLngLatZoom(o.L.convert(l),this.transform.tileZoom)-this.transform.elevation:null}}class eo{constructor(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=d=>{!d||d.sourceDataType!=="metadata"&&d.sourceDataType!=="visibility"&&d.dataType!=="style"&&d.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=l}getDefaultPosition(){return"bottom-right"}onAdd(l){return this._map=l,this._compact=this.options&&this.options.compact,this._container=f.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=f.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=f.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){f.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(l,d){const m=this._map._getUIString(`AttributionControl.${d}`);l.title=m,l.setAttribute("aria-label",m)}_updateAttributions(){if(!this._map.style)return;let l=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=l.concat(this.options.customAttribution.map(v=>typeof v!="string"?"":v)):typeof this.options.customAttribution=="string"&&l.push(this.options.customAttribution)),this._map.style.stylesheet){const v=this._map.style.stylesheet;this.styleOwner=v.owner,this.styleId=v.id}const d=this._map.style.sourceCaches;for(const v in d){const E=d[v];if(E.used||E.usedForTerrain){const F=E.getSource();F.attribution&&l.indexOf(F.attribution)<0&&l.push(F.attribution)}}l=l.filter(v=>String(v).trim()),l.sort((v,E)=>v.length-E.length),l=l.filter((v,E)=>{for(let F=E+1;F<l.length;F++)if(l[F].indexOf(v)>=0)return!1;return!0});const m=l.join(" | ");m!==this._attribHTML&&(this._attribHTML=m,l.length?(this._innerContainer.innerHTML=m,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Jn{constructor(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._updateCompact=()=>{const d=this._container.children;if(d.length){const m=d[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&m.classList.add("maplibregl-compact"):m.classList.remove("maplibregl-compact")}},this.options=l}getDefaultPosition(){return"bottom-left"}onAdd(l){this._map=l,this._compact=this.options&&this.options.compact,this._container=f.create("div","maplibregl-ctrl");const d=f.create("a","maplibregl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://maplibre.org/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){f.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Ju{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(l){const d=++this._id;return this._queue.push({callback:l,id:d,cancelled:!1}),d}remove(l){const d=this._currentlyRunning,m=d?this._queue.concat(d):this._queue;for(const v of m)if(v.id===l)return void(v.cancelled=!0)}run(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const d=this._currentlyRunning=this._queue;this._queue=[];for(const m of d)if(!m.cancelled&&(m.callback(l),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const ed={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"};var Yu=o.Q([{name:"a_pos3d",type:"Int16",components:3}]);class Zu extends o.E{constructor(l){super(),this.sourceCache=l,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,l.usedForTerrain=!0,l.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(l,d){this.sourceCache.update(l,d),this._renderableTilesKeys=[];const m={};for(const v of l.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:d}))m[v.key]=!0,this._renderableTilesKeys.push(v.key),this._tiles[v.key]||(v.posMatrix=new Float64Array(16),o.aS(v.posMatrix,0,o.N,0,o.N,0,1),this._tiles[v.key]=new ir(v,this.tileSize));for(const v in this._tiles)m[v]||delete this._tiles[v]}freeRtt(l){for(const d in this._tiles){const m=this._tiles[d];(!l||m.tileID.equals(l)||m.tileID.isChildOf(l)||l.isChildOf(m.tileID))&&(m.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(l=>this.getTileByID(l))}getTileByID(l){return this._tiles[l]}getTerrainCoords(l){const d={};for(const m of this._renderableTilesKeys){const v=this._tiles[m].tileID;if(v.canonical.equals(l.canonical)){const E=l.clone();E.posMatrix=new Float64Array(16),o.aS(E.posMatrix,0,o.N,0,o.N,0,1),d[m]=E}else if(v.canonical.isChildOf(l.canonical)){const E=l.clone();E.posMatrix=new Float64Array(16);const F=v.canonical.z-l.canonical.z,M=v.canonical.x-(v.canonical.x>>F<<F),N=v.canonical.y-(v.canonical.y>>F<<F),G=o.N>>F;o.aS(E.posMatrix,0,G,0,G,0,1),o.$(E.posMatrix,E.posMatrix,[-M*G,-N*G,0]),d[m]=E}else if(l.canonical.isChildOf(v.canonical)){const E=l.clone();E.posMatrix=new Float64Array(16);const F=l.canonical.z-v.canonical.z,M=l.canonical.x-(l.canonical.x>>F<<F),N=l.canonical.y-(l.canonical.y>>F<<F),G=o.N>>F;o.aS(E.posMatrix,0,o.N,0,o.N,0,1),o.$(E.posMatrix,E.posMatrix,[M*G,N*G,0]),o.a0(E.posMatrix,E.posMatrix,[1/2**F,1/2**F,0]),d[m]=E}}return d}getSourceTile(l,d){const m=this.sourceCache._source;let v=l.overscaledZ-this.deltaZoom;if(v>m.maxzoom&&(v=m.maxzoom),v<m.minzoom)return null;this._sourceTileCache[l.key]||(this._sourceTileCache[l.key]=l.scaledTo(v).key);let E=this.sourceCache.getTileByID(this._sourceTileCache[l.key]);if((!E||!E.dem)&&d)for(;v>=m.minzoom&&(!E||!E.dem);)E=this.sourceCache.getTileByID(l.scaledTo(v--).key);return E}tilesAfterTime(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Date.now();return Object.values(this._tiles).filter(d=>d.timeAdded>=l)}}class sA{constructor(l,d,m){this.painter=l,this.sourceCache=new Zu(d),this.options=m,this.exaggeration=typeof m.exaggeration=="number"?m.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(l,d,m){let v=arguments.length>3&&arguments[3]!==void 0?arguments[3]:o.N;var E;if(!(d>=0&&d<v&&m>=0&&m<v))return 0;const F=this.getTerrainData(l),M=(E=F.tile)===null||E===void 0?void 0:E.dem;if(!M)return 0;const N=function(y,S,I){var O=S[0],V=S[1];return y[0]=I[0]*O+I[4]*V+I[12],y[1]=I[1]*O+I[5]*V+I[13],y}([],[d/v*o.N,m/v*o.N],F.u_terrain_matrix),G=[N[0]*M.dim,N[1]*M.dim],$=Math.floor(G[0]),J=Math.floor(G[1]),ct=G[0]-$,Ct=G[1]-J;return M.get($,J)*(1-ct)*(1-Ct)+M.get($+1,J)*ct*(1-Ct)+M.get($,J+1)*(1-ct)*Ct+M.get($+1,J+1)*ct*Ct}getElevationForLngLatZoom(l,d){const{tileID:m,mercatorX:v,mercatorY:E}=this._getOverscaledTileIDFromLngLatZoom(l,d);return this.getElevation(m,v%o.N,E%o.N,o.N)}getElevation(l,d,m){let v=arguments.length>3&&arguments[3]!==void 0?arguments[3]:o.N;return this.getDEMElevation(l,d,m,v)*this.exaggeration}getTerrainData(l){if(!this._emptyDemTexture){const v=this.painter.context,E=new o.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new It(v,E,v.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new It(v,new o.R({width:1,height:1}),v.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(v.gl.NEAREST,v.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=o.ao([])}const d=this.sourceCache.getSourceTile(l,!0);if(d&&d.dem&&(!d.demTexture||d.needsTerrainPrepare)){const v=this.painter.context;d.demTexture=this.painter.getTileTexture(d.dem.stride),d.demTexture?d.demTexture.update(d.dem.getPixels(),{premultiply:!1}):d.demTexture=new It(v,d.dem.getPixels(),v.gl.RGBA,{premultiply:!1}),d.demTexture.bind(v.gl.NEAREST,v.gl.CLAMP_TO_EDGE),d.needsTerrainPrepare=!1}const m=d&&d+d.tileID.key+l.key;if(m&&!this._demMatrixCache[m]){const v=this.sourceCache.sourceCache._source.maxzoom;let E=l.canonical.z-d.tileID.canonical.z;l.overscaledZ>l.canonical.z&&(l.canonical.z>=v?E=l.canonical.z-v:o.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const F=l.canonical.x-(l.canonical.x>>E<<E),M=l.canonical.y-(l.canonical.y>>E<<E),N=o.bc(new Float64Array(16),[1/(o.N<<E),1/(o.N<<E),0]);o.$(N,N,[F*o.N,M*o.N,0]),this._demMatrixCache[l.key]={matrix:N,coord:l}}return{u_depth:2,u_terrain:3,u_terrain_dim:d&&d.dem&&d.dem.dim||1,u_terrain_matrix:m?this._demMatrixCache[l.key].matrix:this._emptyDemMatrix,u_terrain_unpack:d&&d.dem&&d.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(d&&d.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:d}}getFramebuffer(l){const d=this.painter,m=d.width/devicePixelRatio,v=d.height/devicePixelRatio;return!this._fbo||this._fbo.width===m&&this._fbo.height===v||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new It(d.context,{width:m,height:v,data:null},d.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(d.context.gl.NEAREST,d.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new It(d.context,{width:m,height:v,data:null},d.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(d.context.gl.NEAREST,d.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=d.context.createFramebuffer(m,v,!0,!1),this._fbo.depthAttachment.set(d.context.createRenderbuffer(d.context.gl.DEPTH_COMPONENT16,m,v))),this._fbo.colorAttachment.set(l==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const l=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const d=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let E=0,F=0;E<this._coordsTextureSize;E++)for(let M=0;M<this._coordsTextureSize;M++,F+=4)d[F+0]=255&M,d[F+1]=255&E,d[F+2]=M>>8<<4|E>>8,d[F+3]=0;const m=new o.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(d.buffer)),v=new It(l,m,l.gl.RGBA,{premultiply:!1});return v.bind(l.gl.NEAREST,l.gl.CLAMP_TO_EDGE),this._coordsTexture=v,v}pointCoordinate(l){const d=new Uint8Array(4),m=this.painter.context,v=m.gl;m.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),v.readPixels(l.x,this.painter.height/devicePixelRatio-l.y-1,1,1,v.RGBA,v.UNSIGNED_BYTE,d),m.bindFramebuffer.set(null);const E=d[0]+(d[2]>>4<<8),F=d[1]+((15&d[2])<<8),M=this.coordsIndex[255-d[3]],N=M&&this.sourceCache.getTileByID(M);if(!N)return null;const G=this._coordsTextureSize,$=(1<<N.tileID.canonical.z)*G;return new o.U(this._allowMercatorOverflow(l,(N.tileID.canonical.x*G+E)/$),(N.tileID.canonical.y*G+F)/$,this.getElevation(N.tileID,E,F,G))}getTerrainMesh(){if(this._mesh)return this._mesh;const l=this.painter.context,d=new o.bd,m=new o.b0,v=this.meshSize,E=o.N/v,F=v*v;for(let J=0;J<=v;J++)for(let ct=0;ct<=v;ct++)d.emplaceBack(ct*E,J*E,0);for(let J=0;J<F;J+=v+1)for(let ct=0;ct<v;ct++)m.emplaceBack(ct+J,v+ct+J+1,v+ct+J+2),m.emplaceBack(ct+J,v+ct+J+2,ct+J+1);const M=d.length,N=M+2*(v+1);for(const J of[0,1])for(let ct=0;ct<=v;ct++)for(const Ct of[0,1])d.emplaceBack(ct*E,J*o.N,Ct);for(let J=0;J<2*v;J+=2)m.emplaceBack(N+J,N+J+1,N+J+3),m.emplaceBack(N+J,N+J+3,N+J+2),m.emplaceBack(M+J,M+J+3,M+J+1),m.emplaceBack(M+J,M+J+2,M+J+3);const G=d.length,$=G+2*(v+1);for(const J of[0,1])for(let ct=0;ct<=v;ct++)for(const Ct of[0,1])d.emplaceBack(J*o.N,ct*E,Ct);for(let J=0;J<2*v;J+=2)m.emplaceBack(G+J,G+J+1,G+J+3),m.emplaceBack(G+J,G+J+3,G+J+2),m.emplaceBack($+J,$+J+3,$+J+1),m.emplaceBack($+J,$+J+2,$+J+3);return this._mesh={indexBuffer:l.createIndexBuffer(m),vertexBuffer:l.createVertexBuffer(d,Yu.members),segments:o.S.simpleSegment(0,0,d.length,m.length)},this._mesh}getMeshFrameDelta(l){return 2*Math.PI*o.be/Math.pow(2,l)/5}getMinTileElevationForLngLatZoom(l,d){var m;const{tileID:v}=this._getOverscaledTileIDFromLngLatZoom(l,d);return(m=this.getMinMaxElevation(v).minElevation)!==null&&m!==void 0?m:0}getMinMaxElevation(l){const d=this.getTerrainData(l).tile,m={minElevation:null,maxElevation:null};return d&&d.dem&&(m.minElevation=d.dem.min*this.exaggeration,m.maxElevation=d.dem.max*this.exaggeration),m}_getOverscaledTileIDFromLngLatZoom(l,d){const m=o.U.fromLngLat(l.wrap()),v=(1<<d)*o.N,E=m.x*v,F=m.y*v,M=Math.floor(E/o.N),N=Math.floor(F/o.N);return{tileID:new o.O(d,0,d,M,N),mercatorX:E,mercatorY:F}}_allowMercatorOverflow(l,d){const m=l.x<this.painter.width/2;let v=o.bf(d);const E=this.painter.transform.center.lng;return m&&Math.sign(v)>0&&Math.sign(E)<0||!m&&Math.sign(v)<0&&Math.sign(E)>0?(v=360*Math.sign(E)+v,o.G(v)):d}}class tm{constructor(l,d,m){this._context=l,this._size=d,this._tileSize=m,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const l of this._objects)l.texture.destroy(),l.fbo.destroy()}_createObject(l){const d=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),m=new It(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return m.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),d.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),d.colorAttachment.set(m.texture),{id:l,fbo:d,texture:m,stamp:-1,inUse:!1}}getObjectForId(l){return this._objects[l]}useObject(l){l.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(d=>l.id!==d),this._recentlyUsed.push(l.id)}stampObject(l){l.stamp=++this._stamp}getOrCreateFreeObject(){for(const d of this._recentlyUsed)if(!this._objects[d].inUse)return this._objects[d];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const l=this._createObject(this._objects.length);return this._objects.push(l),l}freeObject(l){l.inUse=!1}freeAllObjects(){for(const l of this._objects)this.freeObject(l)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(l=>!l.inUse)===!1}}const Is={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class eu{constructor(l,d){this.painter=l,this.terrain=d,this.pool=new tm(l.context,30,d.sourceCache.tileSize*d.qualityFactor)}destruct(){this.pool.destruct()}getTexture(l){return this.pool.getObjectForId(l.rtt[this._stacks.length-1].id).texture}prepareForRender(l,d){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=l._order.filter(m=>!l._layers[m].isHidden(d)),this._coordsDescendingInv={};for(const m in l.sourceCaches){this._coordsDescendingInv[m]={};const v=l.sourceCaches[m].getVisibleCoordinates();for(const E of v){const F=this.terrain.sourceCache.getTerrainCoords(E);for(const M in F)this._coordsDescendingInv[m][M]||(this._coordsDescendingInv[m][M]=[]),this._coordsDescendingInv[m][M].push(F[M])}}this._coordsDescendingInvStr={};for(const m of l._order){const v=l._layers[m],E=v.source;if(Is[v.type]&&!this._coordsDescendingInvStr[E]){this._coordsDescendingInvStr[E]={};for(const F in this._coordsDescendingInv[E])this._coordsDescendingInvStr[E][F]=this._coordsDescendingInv[E][F].map(M=>M.key).sort().join()}}for(const m of this._renderableTiles)for(const v in this._coordsDescendingInvStr){const E=this._coordsDescendingInvStr[v][m.tileID.key];E&&E!==m.rttCoords[v]&&(m.rtt=[])}}renderLayer(l){if(l.isHidden(this.painter.transform.zoom))return!1;const d=l.type,m=this.painter,v=this._renderableLayerIds[this._renderableLayerIds.length-1]===l.id;if(Is[d]&&(this._prevType&&Is[this._prevType]||this._stacks.push([]),this._prevType=d,this._stacks[this._stacks.length-1].push(l.id),!v))return!0;if(Is[this._prevType]||Is[d]&&v){this._prevType=d;const E=this._stacks.length-1,F=this._stacks[E]||[];for(const M of this._renderableTiles){if(this.pool.isFull()&&(Kn(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(M),M.rtt[E]){const G=this.pool.getObjectForId(M.rtt[E].id);if(G.stamp===M.rtt[E].stamp){this.pool.useObject(G);continue}}const N=this.pool.getOrCreateFreeObject();this.pool.useObject(N),this.pool.stampObject(N),M.rtt[E]={id:N.id,stamp:N.stamp},m.context.bindFramebuffer.set(N.fbo.framebuffer),m.context.clear({color:o.aT.transparent,stencil:0}),m.currentStencilSource=void 0;for(let G=0;G<F.length;G++){const $=m.style._layers[F[G]],J=$.source?this._coordsDescendingInv[$.source][M.tileID.key]:[M.tileID];m.context.viewport.set([0,0,N.fbo.width,N.fbo.height]),m._renderTileClippingMasks($,J),m.renderLayer(m,m.style.sourceCaches[$.source],$,J),$.source&&(M.rttCoords[$.source]=this._coordsDescendingInvStr[$.source][M.tileID.key])}}return Kn(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Is[d]}return!1}}const vr=h,Mr={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:o.c.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},ru=w=>{w.touchstart=w.dragStart,w.touchmoveWindow=w.dragMove,w.touchend=w.dragEnd},rd={showCompass:!0,showZoom:!0,visualizePitch:!1};class Ba{constructor(l,d){let m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;this.mousedown=F=>{this.startMouse(o.e({},F,{ctrlKey:!0,preventDefault:()=>F.preventDefault()}),f.mousePos(this.element,F)),f.addEventListener(window,"mousemove",this.mousemove),f.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=F=>{this.moveMouse(F,f.mousePos(this.element,F))},this.mouseup=F=>{this.mouseRotate.dragEnd(F),this.mousePitch&&this.mousePitch.dragEnd(F),this.offTemp()},this.touchstart=F=>{F.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=f.touchPos(this.element,F.targetTouches)[0],this.startTouch(F,this._startPos),f.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),f.addEventListener(window,"touchend",this.touchend))},this.touchmove=F=>{F.targetTouches.length!==1?this.reset():(this._lastPos=f.touchPos(this.element,F.targetTouches)[0],this.moveTouch(F,this._lastPos))},this.touchend=F=>{F.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const v=l.dragRotate._mouseRotate.getClickTolerance(),E=l.dragRotate._mousePitch.getClickTolerance();this.element=d,this.mouseRotate=Yo({clickTolerance:v,enable:!0}),this.touchRotate=(F=>{let{enable:M,clickTolerance:N,bearingDegreesPerPixelMoved:G=.8}=F;const $=new xa;return new wn({clickTolerance:N,move:(J,ct)=>({bearingDelta:(ct.x-J.x)*G}),moveStateManager:$,enable:M,assignEvents:ru})})({clickTolerance:v,enable:!0}),this.map=l,m&&(this.mousePitch=Fo({clickTolerance:E,enable:!0}),this.touchPitch=(F=>{let{enable:M,clickTolerance:N,pitchDegreesPerPixelMoved:G=-.5}=F;const $=new xa;return new wn({clickTolerance:N,move:(J,ct)=>({pitchDelta:(ct.y-J.y)*G}),moveStateManager:$,enable:M,assignEvents:ru})})({clickTolerance:E,enable:!0})),f.addEventListener(d,"mousedown",this.mousedown),f.addEventListener(d,"touchstart",this.touchstart,{passive:!1}),f.addEventListener(d,"touchcancel",this.reset)}startMouse(l,d){this.mouseRotate.dragStart(l,d),this.mousePitch&&this.mousePitch.dragStart(l,d),f.disableDrag()}startTouch(l,d){this.touchRotate.dragStart(l,d),this.touchPitch&&this.touchPitch.dragStart(l,d),f.disableDrag()}moveMouse(l,d){const m=this.map,{bearingDelta:v}=this.mouseRotate.dragMove(l,d)||{};if(v&&m.setBearing(m.getBearing()+v),this.mousePitch){const{pitchDelta:E}=this.mousePitch.dragMove(l,d)||{};E&&m.setPitch(m.getPitch()+E)}}moveTouch(l,d){const m=this.map,{bearingDelta:v}=this.touchRotate.dragMove(l,d)||{};if(v&&m.setBearing(m.getBearing()+v),this.touchPitch){const{pitchDelta:E}=this.touchPitch.dragMove(l,d)||{};E&&m.setPitch(m.getPitch()+E)}}off(){const l=this.element;f.removeEventListener(l,"mousedown",this.mousedown),f.removeEventListener(l,"touchstart",this.touchstart,{passive:!1}),f.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),f.removeEventListener(window,"touchend",this.touchend),f.removeEventListener(l,"touchcancel",this.reset),this.offTemp()}offTemp(){f.enableDrag(),f.removeEventListener(window,"mousemove",this.mousemove),f.removeEventListener(window,"mouseup",this.mouseup),f.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),f.removeEventListener(window,"touchend",this.touchend)}}let In;function ta(w,l,d){if(w=new o.L(w.lng,w.lat),l){const m=new o.L(w.lng-360,w.lat),v=new o.L(w.lng+360,w.lat),E=d.locationPoint(w).distSqr(l);d.locationPoint(m).distSqr(l)<E?w=m:d.locationPoint(v).distSqr(l)<E&&(w=v)}for(;Math.abs(w.lng-d.center.lng)>180;){const m=d.locationPoint(w);if(m.x>=0&&m.y>=0&&m.x<=d.width&&m.y<=d.height)break;w.lng>d.center.lng?w.lng-=360:w.lng+=360}return w}const Mo={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function nd(w,l,d){const m=w.classList;for(const v in Mo)m.remove(`maplibregl-${d}-anchor-${v}`);m.add(`maplibregl-${d}-anchor-${l}`)}class Qs extends o.E{constructor(l){if(super(),this._onKeyPress=d=>{const m=d.code,v=d.charCode||d.keyCode;m!=="Space"&&m!=="Enter"&&v!==32&&v!==13||this.togglePopup()},this._onMapClick=d=>{const m=d.originalEvent.target,v=this._element;this._popup&&(m===v||v.contains(m))&&this.togglePopup()},this._update=d=>{if(!this._map)return;const m=this._map.loaded()&&!this._map.isMoving();((d==null?void 0:d.type)==="terrain"||(d==null?void 0:d.type)==="render"&&!m)&&this._map.once("render",this._update),this._map.transform.renderWorldCopies&&(this._lngLat=ta(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let v="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?v=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(v=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let E="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?E="rotateX(0deg)":this._pitchAlignment==="map"&&(E=`rotateX(${this._map.getPitch()}deg)`),d&&d.type!=="moveend"||(this._pos=this._pos.round()),f.setTransform(this._element,`${Mo[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${E} ${v}`),this._map.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const F=this._map.unproject(this._pos),M=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=F.distanceTo(this._lngLat)>20*M?"0.2":"1.0",this._opacityTimeout=null},100))},this._onMove=d=>{if(!this._isDragging){const m=this._clickTolerance||this._map._clickTolerance;this._isDragging=d.point.dist(this._pointerdownPos)>=m}this._isDragging&&(this._pos=d.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.k("dragstart"))),this.fire(new o.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new o.k("dragend")),this._state="inactive"},this._addDragHandler=d=>{this._element.contains(d.originalEvent.target)&&(d.preventDefault(),this._positionDelta=d.point.sub(this._pos).add(this._offset),this._pointerdownPos=d.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=l&&l.anchor||"center",this._color=l&&l.color||"#3FB1CE",this._scale=l&&l.scale||1,this._draggable=l&&l.draggable||!1,this._clickTolerance=l&&l.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=l&&l.rotation||0,this._rotationAlignment=l&&l.rotationAlignment||"auto",this._pitchAlignment=l&&l.pitchAlignment&&l.pitchAlignment!=="auto"?l.pitchAlignment:this._rotationAlignment,l&&l.element)this._element=l.element,this._offset=o.P.convert(l&&l.offset||[0,0]);else{this._defaultMarker=!0,this._element=f.create("div"),this._element.setAttribute("aria-label","Map marker");const d=f.createNS("http://www.w3.org/2000/svg","svg"),m=41,v=27;d.setAttributeNS(null,"display","block"),d.setAttributeNS(null,"height",`${m}px`),d.setAttributeNS(null,"width",`${v}px`),d.setAttributeNS(null,"viewBox",`0 0 ${v} ${m}`);const E=f.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"stroke","none"),E.setAttributeNS(null,"stroke-width","1"),E.setAttributeNS(null,"fill","none"),E.setAttributeNS(null,"fill-rule","evenodd");const F=f.createNS("http://www.w3.org/2000/svg","g");F.setAttributeNS(null,"fill-rule","nonzero");const M=f.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"transform","translate(3.0, 29.0)"),M.setAttributeNS(null,"fill","#000000");const N=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const O of N){const V=f.createNS("http://www.w3.org/2000/svg","ellipse");V.setAttributeNS(null,"opacity","0.04"),V.setAttributeNS(null,"cx","10.5"),V.setAttributeNS(null,"cy","5.80029008"),V.setAttributeNS(null,"rx",O.rx),V.setAttributeNS(null,"ry",O.ry),M.appendChild(V)}const G=f.createNS("http://www.w3.org/2000/svg","g");G.setAttributeNS(null,"fill",this._color);const $=f.createNS("http://www.w3.org/2000/svg","path");$.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),G.appendChild($);const J=f.createNS("http://www.w3.org/2000/svg","g");J.setAttributeNS(null,"opacity","0.25"),J.setAttributeNS(null,"fill","#000000");const ct=f.createNS("http://www.w3.org/2000/svg","path");ct.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),J.appendChild(ct);const Ct=f.createNS("http://www.w3.org/2000/svg","g");Ct.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Ct.setAttributeNS(null,"fill","#FFFFFF");const y=f.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"transform","translate(8.0, 8.0)");const S=f.createNS("http://www.w3.org/2000/svg","circle");S.setAttributeNS(null,"fill","#000000"),S.setAttributeNS(null,"opacity","0.25"),S.setAttributeNS(null,"cx","5.5"),S.setAttributeNS(null,"cy","5.5"),S.setAttributeNS(null,"r","5.4999962");const I=f.createNS("http://www.w3.org/2000/svg","circle");I.setAttributeNS(null,"fill","#FFFFFF"),I.setAttributeNS(null,"cx","5.5"),I.setAttributeNS(null,"cy","5.5"),I.setAttributeNS(null,"r","5.4999962"),y.appendChild(S),y.appendChild(I),F.appendChild(M),F.appendChild(G),F.appendChild(J),F.appendChild(Ct),F.appendChild(y),d.appendChild(F),d.setAttributeNS(null,"height",m*this._scale+"px"),d.setAttributeNS(null,"width",v*this._scale+"px"),this._element.appendChild(d),this._offset=o.P.convert(l&&l.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",d=>{d.preventDefault()}),this._element.addEventListener("mousedown",d=>{d.preventDefault()}),nd(this._element,this._anchor,"marker"),l&&l.className)for(const d of l.className.split(" "))this._element.classList.add(d);this._popup=null}addTo(l){return this.remove(),this._map=l,l.getCanvasContainer().appendChild(this._element),l.on("move",this._update),l.on("moveend",this._update),l.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),f.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(l){return this._lngLat=o.L.convert(l),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(l){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),l){if(!("offset"in l.options)){const v=Math.abs(13.5)/Math.SQRT2;l.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[v,-1*(38.1-13.5+v)],"bottom-right":[-v,-1*(38.1-13.5+v)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=l,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const l=this._popup;return l?(l.isOpen()?l.remove():l.addTo(this._map),this):this}getOffset(){return this._offset}setOffset(l){return this._offset=o.P.convert(l),this._update(),this}addClassName(l){this._element.classList.add(l)}removeClassName(l){this._element.classList.remove(l)}toggleClassName(l){return this._element.classList.toggle(l)}setDraggable(l){return this._draggable=!!l,this._map&&(l?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(l){return this._rotation=l||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(l){return this._rotationAlignment=l||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(l){return this._pitchAlignment=l&&l!=="auto"?l:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const xn={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let ai=0,oA=!1;const aA={maxWidth:100,unit:"metric"};function cA(w,l,d){const m=d&&d.maxWidth||100,v=w._container.clientHeight/2,E=w.unproject([0,v]),F=w.unproject([m,v]),M=E.distanceTo(F);if(d&&d.unit==="imperial"){const N=3.2808*M;N>5280?Bc(l,m,N/5280,w._getUIString("ScaleControl.Miles")):Bc(l,m,N,w._getUIString("ScaleControl.Feet"))}else d&&d.unit==="nautical"?Bc(l,m,M/1852,w._getUIString("ScaleControl.NauticalMiles")):M>=1e3?Bc(l,m,M/1e3,w._getUIString("ScaleControl.Kilometers")):Bc(l,m,M,w._getUIString("ScaleControl.Meters"))}function Bc(w,l,d,m){const v=function(E){const F=Math.pow(10,`${Math.floor(E)}`.length-1);let M=E/F;return M=M>=10?10:M>=5?5:M>=3?3:M>=2?2:M>=1?1:function(N){const G=Math.pow(10,Math.ceil(-Math.log(N)/Math.LN10));return Math.round(N*G)/G}(M),F*M}(d);w.style.width=l*(v/d)+"px",w.innerHTML=`${v}&nbsp;${m}`}const th={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},id=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function $a(w){if(w){if(typeof w=="number"){const l=Math.round(Math.abs(w)/Math.SQRT2);return{center:new o.P(0,0),top:new o.P(0,w),"top-left":new o.P(l,l),"top-right":new o.P(-l,l),bottom:new o.P(0,-w),"bottom-left":new o.P(l,-l),"bottom-right":new o.P(-l,-l),left:new o.P(w,0),right:new o.P(-w,0)}}if(w instanceof o.P||Array.isArray(w)){const l=o.P.convert(w);return{center:l,top:l,"top-left":l,"top-right":l,bottom:l,"bottom-left":l,"bottom-right":l,left:l,right:l}}return{center:o.P.convert(w.center||[0,0]),top:o.P.convert(w.top||[0,0]),"top-left":o.P.convert(w["top-left"]||[0,0]),"top-right":o.P.convert(w["top-right"]||[0,0]),bottom:o.P.convert(w.bottom||[0,0]),"bottom-left":o.P.convert(w["bottom-left"]||[0,0]),"bottom-right":o.P.convert(w["bottom-right"]||[0,0]),left:o.P.convert(w.left||[0,0]),right:o.P.convert(w.right||[0,0])}}return $a(new o.P(0,0))}const lA={extend:function(w){for(var l=arguments.length,d=new Array(l>1?l-1:0),m=1;m<l;m++)d[m-1]=arguments[m];return o.e(w,...d)},run(w){w()},logToElement(w){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"log";const m=window.document.getElementById(d);m&&(l&&(m.innerHTML=""),m.innerHTML+=`<br>${w}`)}},dl=h;class _n{static get version(){return dl}static get workerCount(){return xr.workerCount}static set workerCount(l){xr.workerCount=l}static get maxParallelImageRequests(){return o.c.MAX_PARALLEL_IMAGE_REQUESTS}static set maxParallelImageRequests(l){o.c.MAX_PARALLEL_IMAGE_REQUESTS=l}static get workerUrl(){return o.c.WORKER_URL}static set workerUrl(l){o.c.WORKER_URL=l}static addProtocol(l,d){o.c.REGISTERED_PROTOCOLS[l]=d}static removeProtocol(l){delete o.c.REGISTERED_PROTOCOLS[l]}}return _n.Map=class extends Gf{constructor(w){if(o.bg.mark(o.bh.create),(w=o.e({},Mr,w)).minZoom!=null&&w.maxZoom!=null&&w.minZoom>w.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(w.minPitch!=null&&w.maxPitch!=null&&w.minPitch>w.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(w.minPitch!=null&&w.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(w.maxPitch!=null&&w.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new rA(w.minZoom,w.maxZoom,w.minPitch,w.maxPitch,w.renderWorldCopies),{bearingSnap:w.bearingSnap}),this._cooperativeGesturesOnWheel=l=>{this._onCooperativeGesture(l,l[this._metaKey],1)},this._contextLost=l=>{l.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.k("webglcontextlost",{originalEvent:l}))},this._contextRestored=l=>{this._setupPainter(),this.resize(),this._update(),this.fire(new o.k("webglcontextrestored",{originalEvent:l}))},this._onMapScroll=l=>{if(l.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=w.interactive,this._cooperativeGestures=w.cooperativeGestures,this._metaKey=navigator.platform.indexOf("Mac")===0?"metaKey":"ctrlKey",this._maxTileCacheSize=w.maxTileCacheSize,this._maxTileCacheZoomLevels=w.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=w.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=w.preserveDrawingBuffer,this._antialias=w.antialias,this._trackResize=w.trackResize,this._bearingSnap=w.bearingSnap,this._refreshExpiredTiles=w.refreshExpiredTiles,this._fadeDuration=w.fadeDuration,this._crossSourceCollisions=w.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=w.collectResourceTiming,this._renderTaskQueue=new Ju,this._controls=[],this._mapId=o.a2(),this._locale=o.e({},ed,w.locale),this._clickTolerance=w.clickTolerance,this._overridePixelRatio=w.pixelRatio,this._maxCanvasSize=w.maxCanvasSize,this.transformCameraUpdate=w.transformCameraUpdate,this._imageQueueHandle=Q.addThrottleControl(()=>this.isMoving()),this._requestManager=new j(w.transformRequest),typeof w.container=="string"){if(this._container=document.getElementById(w.container),!this._container)throw new Error(`Container '${w.container}' not found.`)}else{if(!(w.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=w.container}if(w.maxBounds&&this.setMaxBounds(w.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let l=!1;const d=Ns(m=>{this._trackResize&&!this._removed&&this.resize(m)._update()},50);this._resizeObserver=new ResizeObserver(m=>{l?d(m):l=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Xu(this,w),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=w.hash&&new gs(typeof w.hash=="string"&&w.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:w.center,zoom:w.zoom,bearing:w.bearing,pitch:w.pitch}),w.bounds&&(this.resize(),this.fitBounds(w.bounds,o.e({},w.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=w.localIdeographFontFamily,this._validateStyle=w.validateStyle,w.style&&this.setStyle(w.style,{localIdeographFontFamily:w.localIdeographFontFamily}),w.attributionControl&&this.addControl(new eo({customAttribution:w.customAttribution})),w.maplibreLogo&&this.addControl(new Jn,w.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",l=>{this._update(l.dataType==="style"),this.fire(new o.k(`${l.dataType}data`,l))}),this.on("dataloading",l=>{this.fire(new o.k(`${l.dataType}dataloading`,l))}),this.on("dataabort",l=>{this.fire(new o.k("sourcedataabort",l))})}_getMapId(){return this._mapId}addControl(w,l){if(l===void 0&&(l=w.getDefaultPosition?w.getDefaultPosition():"top-right"),!w||!w.onAdd)return this.fire(new o.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const d=w.onAdd(this);this._controls.push(w);const m=this._controlPositions[l];return l.indexOf("bottom")!==-1?m.insertBefore(d,m.firstChild):m.appendChild(d),this}removeControl(w){if(!w||!w.onRemove)return this.fire(new o.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const l=this._controls.indexOf(w);return l>-1&&this._controls.splice(l,1),w.onRemove(this),this}hasControl(w){return this._controls.indexOf(w)>-1}calculateCameraOptionsFromTo(w,l,d,m){return m==null&&this.terrain&&(m=this.terrain.getElevationForLngLatZoom(d,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(w,l,d,m)}resize(w){var l;const d=this._containerDimensions(),m=d[0],v=d[1],E=this._getClampedPixelRatio(m,v);if(this._resizeCanvas(m,v,E),this.painter.resize(m,v,E),this.painter.overLimit()){const M=this.painter.context.gl;this._maxCanvasSize=[M.drawingBufferWidth,M.drawingBufferHeight];const N=this._getClampedPixelRatio(m,v);this._resizeCanvas(m,v,N),this.painter.resize(m,v,N)}this.transform.resize(m,v),(l=this._requestedCameraState)===null||l===void 0||l.resize(m,v);const F=!this._moving;return F&&(this.stop(),this.fire(new o.k("movestart",w)).fire(new o.k("move",w))),this.fire(new o.k("resize",w)),F&&this.fire(new o.k("moveend",w)),this}_getClampedPixelRatio(w,l){const{0:d,1:m}=this._maxCanvasSize,v=this.getPixelRatio(),E=w*v,F=l*v;return Math.min(E>d?d/E:1,F>m?m/F:1)*v}getPixelRatio(){var w;return(w=this._overridePixelRatio)!==null&&w!==void 0?w:devicePixelRatio}setPixelRatio(w){this._overridePixelRatio=w,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(w){return this.transform.setMaxBounds(wt.convert(w)),this._update()}setMinZoom(w){if((w=w??-2)>=-2&&w<=this.transform.maxZoom)return this.transform.minZoom=w,this._update(),this.getZoom()<w&&this.setZoom(w),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(w){if((w=w??22)>=this.transform.minZoom)return this.transform.maxZoom=w,this._update(),this.getZoom()>w&&this.setZoom(w),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(w){if((w=w??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(w>=0&&w<=this.transform.maxPitch)return this.transform.minPitch=w,this._update(),this.getPitch()<w&&this.setPitch(w),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(w){if((w=w??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(w>=this.transform.minPitch)return this.transform.maxPitch=w,this._update(),this.getPitch()>w&&this.setPitch(w),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(w){return this.transform.renderWorldCopies=w,this._update()}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(w){return this._cooperativeGestures=w,this._cooperativeGestures?this._setupCooperativeGestures():this._destroyCooperativeGestures(),this}project(w){return this.transform.locationPoint(o.L.convert(w),this.style&&this.terrain)}unproject(w){return this.transform.pointLocation(o.P.convert(w),this.terrain)}isMoving(){var w;return this._moving||((w=this.handlers)===null||w===void 0?void 0:w.isMoving())}isZooming(){var w;return this._zooming||((w=this.handlers)===null||w===void 0?void 0:w.isZooming())}isRotating(){var w;return this._rotating||((w=this.handlers)===null||w===void 0?void 0:w.isRotating())}_createDelegatedListener(w,l,d){if(w==="mouseenter"||w==="mouseover"){let m=!1;return{layer:l,listener:d,delegates:{mousemove:E=>{const F=this.getLayer(l)?this.queryRenderedFeatures(E.point,{layers:[l]}):[];F.length?m||(m=!0,d.call(this,new Ei(w,this,E.originalEvent,{features:F}))):m=!1},mouseout:()=>{m=!1}}}}if(w==="mouseleave"||w==="mouseout"){let m=!1;return{layer:l,listener:d,delegates:{mousemove:F=>{(this.getLayer(l)?this.queryRenderedFeatures(F.point,{layers:[l]}):[]).length?m=!0:m&&(m=!1,d.call(this,new Ei(w,this,F.originalEvent)))},mouseout:F=>{m&&(m=!1,d.call(this,new Ei(w,this,F.originalEvent)))}}}}{const m=v=>{const E=this.getLayer(l)?this.queryRenderedFeatures(v.point,{layers:[l]}):[];E.length&&(v.features=E,d.call(this,v),delete v.features)};return{layer:l,listener:d,delegates:{[w]:m}}}}on(w,l,d){if(d===void 0)return super.on(w,l);const m=this._createDelegatedListener(w,l,d);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[w]=this._delegatedListeners[w]||[],this._delegatedListeners[w].push(m);for(const v in m.delegates)this.on(v,m.delegates[v]);return this}once(w,l,d){if(d===void 0)return super.once(w,l);const m=this._createDelegatedListener(w,l,d);for(const v in m.delegates)this.once(v,m.delegates[v]);return this}off(w,l,d){return d===void 0?super.off(w,l):(this._delegatedListeners&&this._delegatedListeners[w]&&(m=>{const v=this._delegatedListeners[w];for(let E=0;E<v.length;E++){const F=v[E];if(F.layer===l&&F.listener===d){for(const M in F.delegates)this.off(M,F.delegates[M]);return v.splice(E,1),this}}})(),this)}queryRenderedFeatures(w,l){if(!this.style)return[];let d;const m=w instanceof o.P||Array.isArray(w),v=m?w:[[0,0],[this.transform.width,this.transform.height]];if(l=l||(m?{}:w)||{},v instanceof o.P||typeof v[0]=="number")d=[o.P.convert(v)];else{const E=o.P.convert(v[0]),F=o.P.convert(v[1]);d=[E,new o.P(F.x,E.y),F,new o.P(E.x,F.y),E]}return this.style.queryRenderedFeatures(d,l,this.transform)}querySourceFeatures(w,l){return this.style.querySourceFeatures(w,l)}setStyle(w,l){return(l=o.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},l)).diff!==!1&&l.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&w?(this._diffStyle(w,l),this):(this._localIdeographFontFamily=l.localIdeographFontFamily,this._updateStyle(w,l))}setTransformRequest(w){return this._requestManager.setTransformRequest(w),this}_getUIString(w){const l=this._locale[w];if(l==null)throw new Error(`Missing UI string '${w}'`);return l}_updateStyle(w,l){if(l.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(w,l));const d=this.style&&l.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!w)),w?(this.style=new kr(this,l||{}),this.style.setEventedParent(this,{style:this.style}),typeof w=="string"?this.style.loadURL(w,l,d):this.style.loadJSON(w,l,d),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new kr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(w,l){if(typeof w=="string"){const d=this._requestManager.transformRequest(w,k.Style);o.f(d,(m,v)=>{m?this.fire(new o.j(m)):v&&this._updateDiff(v,l)})}else typeof w=="object"&&this._updateDiff(w,l)}_updateDiff(w,l){try{this.style.setState(w,l)&&this._update(!0)}catch(d){o.w(`Unable to perform style diff: ${d.message||d.error||d}.  Rebuilding the style from scratch.`),this._updateStyle(w,l)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():o.w("There is no style added to the map.")}addSource(w,l){return this._lazyInitEmptyStyle(),this.style.addSource(w,l),this._update(!0)}isSourceLoaded(w){const l=this.style&&this.style.sourceCaches[w];if(l!==void 0)return l.loaded();this.fire(new o.j(new Error(`There is no source with ID '${w}'`)))}setTerrain(w){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),w){const l=this.style.sourceCaches[w.source];if(!l)throw new Error(`cannot load terrain, because there exists no source with ID: ${w.source}`);for(const d in this.style._layers){const m=this.style._layers[d];m.type==="hillshade"&&m.source===w.source&&o.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new sA(this.painter,l,w),this.painter.renderToTexture=new eu(this.painter,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=d=>{d.dataType==="style"?this.terrain.sourceCache.freeRtt():d.dataType==="source"&&d.tile&&(d.sourceId!==w.source||this._elevationFreeze||(this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(d.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0;return this.fire(new o.k("terrain",{terrain:w})),this}getTerrain(){var w,l;return(l=(w=this.terrain)===null||w===void 0?void 0:w.options)!==null&&l!==void 0?l:null}areTilesLoaded(){const w=this.style&&this.style.sourceCaches;for(const l in w){const d=w[l]._tiles;for(const m in d){const v=d[m];if(v.state!=="loaded"&&v.state!=="errored")return!1}}return!0}addSourceType(w,l,d){return this._lazyInitEmptyStyle(),this.style.addSourceType(w,l,d)}removeSource(w){return this.style.removeSource(w),this._update(!0)}getSource(w){return this.style.getSource(w)}addImage(w,l){let d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{pixelRatio:m=1,sdf:v=!1,stretchX:E,stretchY:F,content:M}=d;if(this._lazyInitEmptyStyle(),!(l instanceof HTMLImageElement||o.a(l))){if(l.width===void 0||l.height===void 0)return this.fire(new o.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:N,height:G,data:$}=l,J=l;return this.style.addImage(w,{data:new o.R({width:N,height:G},new Uint8Array($)),pixelRatio:m,stretchX:E,stretchY:F,content:M,sdf:v,version:0,userImage:J}),J.onAdd&&J.onAdd(this,w),this}}{const{width:N,height:G,data:$}=o.h.getImageData(l);this.style.addImage(w,{data:new o.R({width:N,height:G},$),pixelRatio:m,stretchX:E,stretchY:F,content:M,sdf:v,version:0})}}updateImage(w,l){const d=this.style.getImage(w);if(!d)return this.fire(new o.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const m=l instanceof HTMLImageElement||o.a(l)?o.h.getImageData(l):l,{width:v,height:E,data:F}=m;if(v===void 0||E===void 0)return this.fire(new o.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(v!==d.data.width||E!==d.data.height)return this.fire(new o.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const M=!(l instanceof HTMLImageElement||o.a(l));return d.data.replace(F,M),this.style.updateImage(w,d),this}getImage(w){return this.style.getImage(w)}hasImage(w){return w?!!this.style.getImage(w):(this.fire(new o.j(new Error("Missing required image id"))),!1)}removeImage(w){this.style.removeImage(w)}loadImage(w,l){Q.getImage(this._requestManager.transformRequest(w,k.Image),l)}listImages(){return this.style.listImages()}addLayer(w,l){return this._lazyInitEmptyStyle(),this.style.addLayer(w,l),this._update(!0)}moveLayer(w,l){return this.style.moveLayer(w,l),this._update(!0)}removeLayer(w){return this.style.removeLayer(w),this._update(!0)}getLayer(w){return this.style.getLayer(w)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(w,l,d){return this.style.setLayerZoomRange(w,l,d),this._update(!0)}setFilter(w,l){let d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.style.setFilter(w,l,d),this._update(!0)}getFilter(w){return this.style.getFilter(w)}setPaintProperty(w,l,d){let m=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return this.style.setPaintProperty(w,l,d,m),this._update(!0)}getPaintProperty(w,l){return this.style.getPaintProperty(w,l)}setLayoutProperty(w,l,d){let m=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return this.style.setLayoutProperty(w,l,d,m),this._update(!0)}getLayoutProperty(w,l){return this.style.getLayoutProperty(w,l)}setGlyphs(w){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setGlyphs(w,l),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(w,l){let d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this._lazyInitEmptyStyle(),this.style.addSprite(w,l,d,m=>{m||this._update(!0)}),this}removeSprite(w){return this._lazyInitEmptyStyle(),this.style.removeSprite(w),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(w){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setSprite(w,l,d=>{d||this._update(!0)}),this}setLight(w){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setLight(w,l),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(w,l){return this.style.setFeatureState(w,l),this._update()}removeFeatureState(w,l){return this.style.removeFeatureState(w,l),this._update()}getFeatureState(w){return this.style.getFeatureState(w)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let w=0,l=0;return this._container&&(w=this._container.clientWidth||400,l=this._container.clientHeight||300),[w,l]}_setupContainer(){const w=this._container;w.classList.add("maplibregl-map");const l=this._canvasContainer=f.create("div","maplibregl-canvas-container",w);this._interactive&&l.classList.add("maplibregl-interactive"),this._canvas=f.create("canvas","maplibregl-canvas",l),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const d=this._containerDimensions(),m=this._getClampedPixelRatio(d[0],d[1]);this._resizeCanvas(d[0],d[1],m);const v=this._controlContainer=f.create("div","maplibregl-control-container",w),E=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(F=>{E[F]=f.create("div",`maplibregl-ctrl-${F} `,v)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){this._cooperativeGesturesScreen=f.create("div","maplibregl-cooperative-gesture-screen",this._container);let w=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(w=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use  + scroll to zoom the map"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${w}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,this._cooperativeGesturesScreen.setAttribute("aria-hidden","true"),this._canvasContainer.addEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.add("maplibregl-cooperative-gestures")}_destroyCooperativeGestures(){f.remove(this._cooperativeGesturesScreen),this._canvasContainer.removeEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.remove("maplibregl-cooperative-gestures")}_resizeCanvas(w,l,d){this._canvas.width=Math.floor(d*w),this._canvas.height=Math.floor(d*l),this._canvas.style.width=`${w}px`,this._canvas.style.height=`${l}px`}_setupPainter(){const w={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let l=null;this._canvas.addEventListener("webglcontextcreationerror",m=>{l={requestedAttributes:w},m&&(l.statusMessage=m.statusMessage,l.type=m.type)},{once:!0});const d=this._canvas.getContext("webgl2",w)||this._canvas.getContext("webgl",w);if(!d){const m="Failed to initialize WebGL";throw l?(l.message=m,new Error(JSON.stringify(l))):new Error(m)}this.painter=new _a(d,this.transform),g.testSupport(d)}_onCooperativeGesture(w,l,d){return!l&&d<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(w){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||w,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(w){return this._update(),this._renderTaskQueue.add(w)}_cancelRenderFrame(w){this._renderTaskQueue.remove(w)}_render(w){const l=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(w),this._removed)return;let d=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const v=this.transform.zoom,E=o.h.now();this.style.zoomHistory.update(v,E);const F=new o.a8(v,{now:E,fadeDuration:l,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),M=F.crossFadingFactor();M===1&&M===this._crossFadingFactor||(d=!0,this._crossFadingFactor=M),this.style.update(F)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,l,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:l,showPadding:this.showPadding}),this.fire(new o.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,o.bg.mark(o.bh.load),this.fire(new o.k("load"))),this.style&&(this.style.hasTransitions()||d)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const m=this._sourcesDirty||this._styleDirty||this._placementDirty;return m||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new o.k("idle")),!this._loaded||this._fullyLoaded||m||(this._fullyLoaded=!0,o.bg.mark(o.bh.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){var w;this._hash&&this._hash.remove();for(const d of this._controls)d.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Q.removeThrottleControl(this._imageQueueHandle),(w=this._resizeObserver)===null||w===void 0||w.disconnect();const l=this.painter.context.gl.getExtension("WEBGL_lose_context");l&&l.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),f.remove(this._canvasContainer),f.remove(this._controlContainer),this._cooperativeGestures&&this._destroyCooperativeGestures(),this._container.classList.remove("maplibregl-map"),o.bg.clearMetrics(),this._removed=!0,this.fire(new o.k("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=o.h.frame(w=>{o.bg.frame(w),this._frame=null,this._render(w)}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(w){this._showTileBoundaries!==w&&(this._showTileBoundaries=w,this._update())}get showPadding(){return!!this._showPadding}set showPadding(w){this._showPadding!==w&&(this._showPadding=w,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(w){this._showCollisionBoxes!==w&&(this._showCollisionBoxes=w,w?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(w){this._showOverdrawInspector!==w&&(this._showOverdrawInspector=w,this._update())}get repaint(){return!!this._repaint}set repaint(w){this._repaint!==w&&(this._repaint=w,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(w){this._vertices=w,this._update()}get version(){return vr}getCameraTargetElevation(){return this.transform.elevation}},_n.NavigationControl=class{constructor(w){this._updateZoomButtons=()=>{const l=this._map.getZoom(),d=l===this._map.getMaxZoom(),m=l===this._map.getMinZoom();this._zoomInButton.disabled=d,this._zoomOutButton.disabled=m,this._zoomInButton.setAttribute("aria-disabled",d.toString()),this._zoomOutButton.setAttribute("aria-disabled",m.toString())},this._rotateCompassArrow=()=>{const l=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=l},this._setButtonTitle=(l,d)=>{const m=this._map._getUIString(`NavigationControl.${d}`);l.title=m,l.setAttribute("aria-label",m)},this.options=o.e({},rd,w),this._container=f.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",l=>l.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",l=>this._map.zoomIn({},{originalEvent:l})),f.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",l=>this._map.zoomOut({},{originalEvent:l})),f.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",l=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:l}):this._map.resetNorth({},{originalEvent:l})}),this._compassIcon=f.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(w){return this._map=w,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ba(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){f.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(w,l){const d=f.create("button",w,this._container);return d.type="button",d.addEventListener("click",l),d}},_n.GeolocateControl=class extends o.E{constructor(w){super(),this._onSuccess=l=>{if(this._map){if(this._isOutOfMapMaxBounds(l))return this._setErrorState(),this.fire(new o.k("outofmaxbounds",l)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=l,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(l),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(l),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new o.k("geolocate",l)),this._finish()}},this._updateCamera=l=>{const d=new o.L(l.coords.longitude,l.coords.latitude),m=l.coords.accuracy,v=this._map.getBearing(),E=o.e({bearing:v},this.options.fitBoundsOptions),F=wt.fromLngLat(d,m);this._map.fitBounds(F,E,{geolocateSource:!0})},this._updateMarker=l=>{if(l){const d=new o.L(l.coords.longitude,l.coords.latitude);this._accuracyCircleMarker.setLngLat(d).addTo(this._map),this._userLocationDotMarker.setLngLat(d).addTo(this._map),this._accuracy=l.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=l=>{if(this._map){if(this.options.trackUserLocation)if(l.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(l.code===3&&oA)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new o.k("error",l)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=l=>{if(this._map){if(this._container.addEventListener("contextmenu",d=>d.preventDefault()),this._geolocateButton=f.create("button","maplibregl-ctrl-geolocate",this._container),f.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",l===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");const d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d)}else{const d=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=f.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Qs({element:this._dotElement}),this._circleElement=f.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Qs({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",d=>{d.geolocateSource||this._watchState!=="ACTIVE_LOCK"||d.originalEvent&&d.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new o.k("trackuserlocationend")))})}},this.options=o.e({},xn,w)}onAdd(w){return this._map=w,this._container=f.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(l){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;In===void 0||d?window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(m=>{In=m.state!=="denied",l(In)}).catch(()=>{In=!!window.navigator.geolocation,l(In)}):(In=!!window.navigator.geolocation,l(In)):l(In)}(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),f.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,ai=0,oA=!1}_isOutOfMapMaxBounds(w){const l=this._map.getMaxBounds(),d=w.coords;return l&&(d.longitude<l.getWest()||d.longitude>l.getEast()||d.latitude<l.getSouth()||d.latitude>l.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const w=this._map.getBounds(),l=w.getSouthEast(),d=w.getNorthEast(),m=l.distanceTo(d),v=Math.ceil(this._accuracy/(m/this._map._container.clientHeight)*2);this._circleElement.style.width=`${v}px`,this._circleElement.style.height=`${v}px`}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":ai--,oA=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new o.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let w;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),ai++,ai>1?(w={maximumAge:6e5,timeout:0},oA=!0):(w=this.options.positionOptions,oA=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,w)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},_n.AttributionControl=eo,_n.LogoControl=Jn,_n.ScaleControl=class{constructor(w){this._onMove=()=>{cA(this._map,this._container,this.options)},this.setUnit=l=>{this.options.unit=l,cA(this._map,this._container,this.options)},this.options=o.e({},aA,w)}getDefaultPosition(){return"bottom-left"}onAdd(w){return this._map=w,this._container=f.create("div","maplibregl-ctrl maplibregl-ctrl-scale",w.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){f.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},_n.FullscreenControl=class extends o.E{constructor(){let w=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,w&&w.container&&(w.container instanceof HTMLElement?this._container=w.container:o.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(w){return this._map=w,this._container||(this._container=this._map.getContainer()),this._controlContainer=f.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){f.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const w=this._fullscreenButton=f.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);f.create("span","maplibregl-ctrl-icon",w).setAttribute("aria-hidden","true"),w.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const w=this._getTitle();this._fullscreenButton.setAttribute("aria-label",w),this._fullscreenButton.title=w}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new o.k("fullscreenstart")),this._map._cooperativeGestures&&(this._prevCooperativeGestures=this._map._cooperativeGestures,this._map.setCooperativeGestures())):(this.fire(new o.k("fullscreenend")),this._prevCooperativeGestures&&(this._map.setCooperativeGestures(this._prevCooperativeGestures),delete this._prevCooperativeGestures))}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},_n.TerrainControl=class{constructor(w){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))},this.options=w}onAdd(w){return this._map=w,this._container=f.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=f.create("button","maplibregl-ctrl-terrain",this._container),f.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){f.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},_n.Popup=class extends o.E{constructor(w){super(),this.remove=()=>(this._content&&f.remove(this._content),this._container&&(f.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new o.k("close")),this),this._onMouseUp=l=>{this._update(l.point)},this._onMouseMove=l=>{this._update(l.point)},this._onDrag=l=>{this._update(l.point)},this._update=l=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=f.create("div","maplibregl-popup",this._map.getContainer()),this._tip=f.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const F of this.options.className.split(" "))this._container.classList.add(F);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=ta(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!l)return;const d=this._pos=this._trackPointer&&l?l:this._map.project(this._lngLat);let m=this.options.anchor;const v=$a(this.options.offset);if(!m){const F=this._container.offsetWidth,M=this._container.offsetHeight;let N;N=d.y+v.bottom.y<M?["top"]:d.y>this._map.transform.height-M?["bottom"]:[],d.x<F/2?N.push("left"):d.x>this._map.transform.width-F/2&&N.push("right"),m=N.length===0?"bottom":N.join("-")}const E=d.add(v[m]).round();f.setTransform(this._container,`${Mo[m]} translate(${E.x}px,${E.y}px)`),nd(this._container,m,"popup")},this._onClose=()=>{this.remove()},this.options=o.e(Object.create(th),w)}addTo(w){return this._map&&this.remove(),this._map=w,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new o.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(w){return this._lngLat=o.L.convert(w),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(w){return this.setDOMContent(document.createTextNode(w))}setHTML(w){const l=document.createDocumentFragment(),d=document.createElement("body");let m;for(d.innerHTML=w;m=d.firstChild,m;)l.appendChild(m);return this.setDOMContent(l)}getMaxWidth(){var w;return(w=this._container)===null||w===void 0?void 0:w.style.maxWidth}setMaxWidth(w){return this.options.maxWidth=w,this._update(),this}setDOMContent(w){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=f.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(w),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(w){this._container&&this._container.classList.add(w)}removeClassName(w){this._container&&this._container.classList.remove(w)}setOffset(w){return this.options.offset=w,this._update(),this}toggleClassName(w){if(this._container)return this._container.classList.toggle(w)}_createCloseButton(){this.options.closeButton&&(this._closeButton=f.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const w=this._container.querySelector(id);w&&w.focus()}},_n.Marker=Qs,_n.Style=kr,_n.LngLat=o.L,_n.LngLatBounds=wt,_n.Point=o.P,_n.MercatorCoordinate=o.U,_n.Evented=o.E,_n.AJAXError=o.bi,_n.config=o.c,_n.CanvasSource=Ve,_n.GeoJSONSource=Ae,_n.ImageSource=Ce,_n.RasterDEMTileSource=se,_n.RasterTileSource=Jt,_n.VectorTileSource=qt,_n.VideoSource=Pe,_n.setRTLTextPlugin=o.bj,_n.getRTLTextPluginStatus=o.bk,_n.prewarm=function(){nn().acquire(De)},_n.clearPrewarmedResources=function(){const w=Or;w&&(w.isPreloaded()&&w.numActive()===1?(w.release(De),Or=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},lA.extend(_n,{isSafari:o.ac,getPerformanceMetrics:o.bg.getPerformanceMetrics}),_n});var a=i;return a})})(sE);var oE=sE.exports;const No=xm(oE);class YN{constructor(){this._bearing=0,this._pitch=60,this._minpitchzoom=null}onAdd(t){this._map=t;let e=this;return this._btn=document.createElement("button"),this._btn.className="maplibregl-ctrl-icon maplibregl-ctrl-pitchtoggle-3d",this._btn.id="bt3D",this._btn.type="button",this._btn["aria-label"]="Vista 3D",this._btn.onclick=function(){if(e._btn.className.indexOf("3d")!=-1){let f={pitch:e._pitch,bearing:e._bearing};e._minpitchzoom&&t.getZoom()>e._minpitchzoom&&(f.zoom=e._minpitchzoom);var n=0,i=38.5,s=6,a=62.33,{longitude:o,latitude:h}=t.getCenter();t.getZoom()<10?t.setTerrain({source:"terrainMapZen",exaggeration:1.5}):o>=n&&o<=s&&h>=i&&h<=a?t.setTerrain({source:"terrainICGC",exaggeration:1.2}):t.setTerrain({source:"terrainMapZen",exaggeration:1.5}),t.easeTo(f),e._btn.className="maplibregl-ctrl-icon maplibregl-ctrl-pitchtoggle-2d"}else t.setTerrain(null),t.easeTo({pitch:0,bearing:0}),e._btn.className="maplibregl-ctrl-icon maplibregl-ctrl-pitchtoggle-3d"},this._container=document.createElement("div"),this._container.className="maplibregl-ctrl maplibregl-ctrl-group",this._container.title="Vista 3D",this._container.appendChild(this._btn),this._container}onRemove(){this._container.parentNode.removeChild(this._container),this._map=void 0}}function op(r){"@babel/helpers - typeof";return op=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},op(r)}function ZN(r,t){if(op(r)!="object"||!r)return r;var e=r[Symbol.toPrimitive];if(e!==void 0){var n=e.call(r,t||"default");if(op(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(r)}function t6(r){var t=ZN(r,"string");return op(t)=="symbol"?t:String(t)}function K(r,t,e){return t=t6(t),t in r?Object.defineProperty(r,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):r[t]=e,r}function li(r,t){if(!r)throw new Error(t||"loader assertion failed.")}const Bm=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),aE=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);aE&&parseFloat(aE[1]);const e6="3.4.14";function Bl(r,t){if(!r)throw new Error(t||"loaders.gl assertion failed.")}const b_={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document},r6=b_.global||b_.self||b_.window||{},mA=typeof process!="object"||String(process)!=="[object process]"||process.browser,w_=typeof importScripts=="function",n6=typeof window<"u"&&typeof window.orientation<"u",cE=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);cE&&parseFloat(cE[1]);class i6{constructor(t,e){K(this,"name",void 0),K(this,"workerThread",void 0),K(this,"isRunning",!0),K(this,"result",void 0),K(this,"_resolve",()=>{}),K(this,"_reject",()=>{}),this.name=t,this.workerThread=e,this.result=new Promise((n,i)=>{this._resolve=n,this._reject=i})}postMessage(t,e){this.workerThread.postMessage({source:"loaders.gl",type:t,payload:e})}done(t){Bl(this.isRunning),this.isRunning=!1,this._resolve(t)}error(t){Bl(this.isRunning),this.isRunning=!1,this._reject(t)}}let x_=class{terminate(){}};const B_=new Map;function s6(r){Bl(r.source&&!r.url||!r.source&&r.url);let t=B_.get(r.source||r.url);return t||(r.url&&(t=o6(r.url),B_.set(r.url,t)),r.source&&(t=lE(r.source),B_.set(r.source,t))),Bl(t),t}function o6(r){if(!r.startsWith("http"))return r;const t=a6(r);return lE(t)}function lE(r){const t=new Blob([r],{type:"application/javascript"});return URL.createObjectURL(t)}function a6(r){return`try {
  importScripts('`.concat(r,`');
} catch (error) {
  console.error(error);
  throw error;
}`)}function AE(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,e=arguments.length>2?arguments[2]:void 0;const n=e||new Set;if(r){if(uE(r))n.add(r);else if(uE(r.buffer))n.add(r.buffer);else if(!ArrayBuffer.isView(r)){if(t&&typeof r=="object")for(const i in r)AE(r[i],t,n)}}return e===void 0?Array.from(n):[]}function uE(r){return r?r instanceof ArrayBuffer||typeof MessagePort<"u"&&r instanceof MessagePort||typeof ImageBitmap<"u"&&r instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&r instanceof OffscreenCanvas:!1}const C_=()=>{};class E_{static isSupported(){return typeof Worker<"u"&&mA||typeof x_<"u"&&!mA}constructor(t){K(this,"name",void 0),K(this,"source",void 0),K(this,"url",void 0),K(this,"terminated",!1),K(this,"worker",void 0),K(this,"onMessage",void 0),K(this,"onError",void 0),K(this,"_loadableURL","");const{name:e,source:n,url:i}=t;Bl(n||i),this.name=e,this.source=n,this.url=i,this.onMessage=C_,this.onError=s=>console.log(s),this.worker=mA?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=C_,this.onError=C_,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(t,e){e=e||AE(t),this.worker.postMessage(t,e)}_getErrorFromErrorEvent(t){let e="Failed to load ";return e+="worker ".concat(this.name," from ").concat(this.url,". "),t.message&&(e+="".concat(t.message," in ")),t.lineno&&(e+=":".concat(t.lineno,":").concat(t.colno)),new Error(e)}_createBrowserWorker(){this._loadableURL=s6({source:this.source,url:this.url});const t=new Worker(this._loadableURL,{name:this.name});return t.onmessage=e=>{e.data?this.onMessage(e.data):this.onError(new Error("No data received"))},t.onerror=e=>{this.onError(this._getErrorFromErrorEvent(e)),this.terminated=!0},t.onmessageerror=e=>console.error(e),t}_createNodeWorker(){let t;if(this.url){const n=this.url.includes(":/")||this.url.startsWith("/")?this.url:"./".concat(this.url);t=new x_(n,{eval:!1})}else if(this.source)t=new x_(this.source,{eval:!0});else throw new Error("no worker");return t.on("message",e=>{this.onMessage(e)}),t.on("error",e=>{this.onError(e)}),t.on("exit",e=>{}),t}}class c6{static isSupported(){return E_.isSupported()}constructor(t){K(this,"name","unnamed"),K(this,"source",void 0),K(this,"url",void 0),K(this,"maxConcurrency",1),K(this,"maxMobileConcurrency",1),K(this,"onDebug",()=>{}),K(this,"reuseWorkers",!0),K(this,"props",{}),K(this,"jobQueue",[]),K(this,"idleQueue",[]),K(this,"count",0),K(this,"isDestroyed",!1),this.source=t.source,this.url=t.url,this.setProps(t)}destroy(){this.idleQueue.forEach(t=>t.destroy()),this.isDestroyed=!0}setProps(t){this.props={...this.props,...t},t.name!==void 0&&(this.name=t.name),t.maxConcurrency!==void 0&&(this.maxConcurrency=t.maxConcurrency),t.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=t.maxMobileConcurrency),t.reuseWorkers!==void 0&&(this.reuseWorkers=t.reuseWorkers),t.onDebug!==void 0&&(this.onDebug=t.onDebug)}async startJob(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:(s,a,o)=>s.done(o),n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:(s,a)=>s.error(a);const i=new Promise(s=>(this.jobQueue.push({name:t,onMessage:e,onError:n,onStart:s}),this));return this._startQueuedJob(),await i}async _startQueuedJob(){if(!this.jobQueue.length)return;const t=this._getAvailableWorker();if(!t)return;const e=this.jobQueue.shift();if(e){this.onDebug({message:"Starting job",name:e.name,workerThread:t,backlog:this.jobQueue.length});const n=new i6(e.name,t);t.onMessage=i=>e.onMessage(n,i.type,i.payload),t.onError=i=>e.onError(n,i),e.onStart(n);try{await n.result}finally{this.returnWorkerToQueue(t)}}}returnWorkerToQueue(t){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(t.destroy(),this.count--):this.idleQueue.push(t),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const t="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new E_({name:t,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return n6?this.maxMobileConcurrency:this.maxConcurrency}}const l6={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class yA{static isSupported(){return E_.isSupported()}static getWorkerFarm(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return yA._workerFarm=yA._workerFarm||new yA({}),yA._workerFarm.setProps(t),yA._workerFarm}constructor(t){K(this,"props",void 0),K(this,"workerPools",new Map),this.props={...l6},this.setProps(t),this.workerPools=new Map}destroy(){for(const t of this.workerPools.values())t.destroy();this.workerPools=new Map}setProps(t){this.props={...this.props,...t};for(const e of this.workerPools.values())e.setProps(this._getWorkerPoolProps())}getWorkerPool(t){const{name:e,source:n,url:i}=t;let s=this.workerPools.get(e);return s||(s=new c6({name:e,source:n,url:i}),s.setProps(this._getWorkerPoolProps()),this.workerPools.set(e,s)),s}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}K(yA,"_workerFarm",void 0);const A6="latest";function u6(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const e=t[r.id]||{},n="".concat(r.id,"-worker.js");let i=e.workerUrl;if(!i&&r.id==="compression"&&(i=t.workerUrl),t._workerType==="test"&&(i="modules/".concat(r.module,"/dist/").concat(n)),!i){let s=r.version;s==="latest"&&(s=A6);const a=s?"@".concat(s):"";i="https://unpkg.com/@loaders.gl/".concat(r.module).concat(a,"/dist/").concat(n)}return Bl(i),i}function h6(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:e6;Bl(r,"no worker provided");const e=r.version;return!(!t||!e)}const d6=null,f6=null,S_=null,hE=null,p6=Object.freeze(Object.defineProperty({__proto__:null,readFileAsArrayBuffer:d6,readFileAsText:f6,requireFromFile:S_,requireFromString:hE},Symbol.toStringTag,{value:"Module"})),g6="3.4.14",T_={};async function Ah(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return t&&(r=m6(r,t,e)),T_[r]=T_[r]||y6(r),await T_[r]}function m6(r,t,e){if(r.startsWith("http"))return r;const n=e.modules||{};return n[r]?n[r]:mA?e.CDN?(Bl(e.CDN.startsWith("http")),"".concat(e.CDN,"/").concat(t,"@").concat(g6,"/dist/libs/").concat(r)):w_?"../src/libs/".concat(r):"modules/".concat(t,"/src/libs/").concat(r):"modules/".concat(t,"/dist/libs/").concat(r)}async function y6(r){if(r.endsWith("wasm"))return await(await fetch(r)).arrayBuffer();if(!mA)try{return p6&&S_&&await S_(r)}catch{return null}if(w_)return importScripts(r);const e=await(await fetch(r)).text();return _6(e,r)}function _6(r,t){if(!mA)return hE;if(w_)return eval.call(r6,r),null;const e=document.createElement("script");e.id=t;try{e.appendChild(document.createTextNode(r))}catch{e.text=r}return document.body.appendChild(e),null}function v6(r,t){return!yA.isSupported()||!mA&&!(t!=null&&t._nodeWorkers)?!1:r.worker&&(t==null?void 0:t.worker)}async function b6(r,t,e,n,i){const s=r.id,a=u6(r,e),h=yA.getWorkerFarm(e).getWorkerPool({name:s,url:a});e=JSON.parse(JSON.stringify(e)),n=JSON.parse(JSON.stringify(n||{}));const f=await h.startJob("process-on-worker",w6.bind(null,i));return f.postMessage("process",{input:t,options:e,context:n}),await(await f.result).result}async function w6(r,t,e,n){switch(e){case"done":t.done(n);break;case"error":t.error(new Error(n.error));break;case"process":const{id:i,input:s,options:a}=n;try{const o=await r(s,a);t.postMessage("done",{id:i,result:o})}catch(o){const h=o instanceof Error?o.message:"unknown error";t.postMessage("error",{id:i,error:h})}break;default:console.warn("parse-with-worker unknown message ".concat(e))}}function x6(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof r=="string"?r.slice(0,t):ArrayBuffer.isView(r)?dE(r.buffer,r.byteOffset,t):r instanceof ArrayBuffer?dE(r,0,t):""}function dE(r,t,e){if(r.byteLength<=t+e)return"";const n=new DataView(r);let i="";for(let s=0;s<e;s++)i+=String.fromCharCode(n.getUint8(t+s));return i}function B6(r){try{return JSON.parse(r)}catch{throw new Error('Failed to parse JSON from data starting with "'.concat(x6(r),'"'))}}function C6(r,t,e){if(e=e||r.byteLength,r.byteLength<e||t.byteLength<e)return!1;const n=new Uint8Array(r),i=new Uint8Array(t);for(let s=0;s<n.length;++s)if(n[s]!==i[s])return!1;return!0}function E6(){for(var r=arguments.length,t=new Array(r),e=0;e<r;e++)t[e]=arguments[e];const n=t.map(o=>o instanceof ArrayBuffer?new Uint8Array(o):o),i=n.reduce((o,h)=>o+h.byteLength,0),s=new Uint8Array(i);let a=0;for(const o of n)s.set(o,a),a+=o.byteLength;return s.buffer}function I_(r,t,e){const n=e!==void 0?new Uint8Array(r).subarray(t,t+e):new Uint8Array(r).subarray(t);return new Uint8Array(n).buffer}function ap(r,t){return li(r>=0),li(t>0),r+(t-1)&~(t-1)}function S6(r,t,e){let n;if(r instanceof ArrayBuffer)n=new Uint8Array(r);else{const i=r.byteOffset,s=r.byteLength;n=new Uint8Array(r.buffer||r.arrayBuffer,i,s)}return t.set(n,e),e+ap(n.byteLength,4)}async function T6(r){const t=[];for await(const e of r)t.push(e);return E6(...t)}function fE(){let r;if(typeof window<"u"&&window.performance)r=window.performance.now();else if(typeof process<"u"&&process.hrtime){const t=process.hrtime();r=t[0]*1e3+t[1]/1e6}else r=Date.now();return r}let pE=class{constructor(t,e){this.name=void 0,this.type=void 0,this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=t,this.type=e,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(t){return this.sampleSize=t,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(t){return this._count+=t,this._samples++,this._checkSampling(),this}subtractCount(t){return this._count-=t,this._samples++,this._checkSampling(),this}addTime(t){return this._time+=t,this.lastTiming=t,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=fE(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(fE()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}},gE=class{constructor(t){this.id=void 0,this.stats={},this.id=t.id,this.stats={},this._initializeStats(t.stats),Object.seal(this)}get(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:t,type:e})}get size(){return Object.keys(this.stats).length}reset(){for(const t of Object.values(this.stats))t.reset();return this}forEach(t){for(const e of Object.values(this.stats))t(e)}getTable(){const t={};return this.forEach(e=>{t[e.name]={time:e.time||0,count:e.count||0,average:e.getAverageTime()||0,hz:e.getHz()||0}}),t}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(e=>this._getOrCreate(e))}_getOrCreate(t){const{name:e,type:n}=t;let i=this.stats[e];return i||(t instanceof pE?i=t:i=new pE(e,n),this.stats[e]=i),i}};const I6="Queued Requests",L6="Active Requests",F6="Cancelled Requests",M6="Queued Requests Ever",P6="Active Requests Ever",U6={id:"request-scheduler",throttleRequests:!0,maxRequests:6};class R6{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};K(this,"props",void 0),K(this,"stats",void 0),K(this,"activeRequestCount",0),K(this,"requestQueue",[]),K(this,"requestMap",new Map),K(this,"deferredUpdate",null),this.props={...U6,...t},this.stats=new gE({id:this.props.id}),this.stats.get(I6),this.stats.get(L6),this.stats.get(F6),this.stats.get(M6),this.stats.get(P6)}scheduleRequest(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:()=>0;if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(t))return this.requestMap.get(t);const n={handle:t,priority:0,getPriority:e},i=new Promise(s=>(n.resolve=s,n));return this.requestQueue.push(n),this.requestMap.set(t,i),this._issueNewRequests(),i}_issueRequest(t){const{handle:e,resolve:n}=t;let i=!1;const s=()=>{i||(i=!0,this.requestMap.delete(e),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,n?n({done:s}):Promise.resolve({done:s})}_issueNewRequests(){this.deferredUpdate||(this.deferredUpdate=setTimeout(()=>this._issueNewRequestsAsync(),0))}_issueNewRequestsAsync(){this.deferredUpdate=null;const t=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(t!==0){this._updateAllRequests();for(let e=0;e<t;++e){const n=this.requestQueue.shift();n&&this._issueRequest(n)}}}_updateAllRequests(){const t=this.requestQueue;for(let e=0;e<t.length;++e){const n=t[e];this._updateRequest(n)||(t.splice(e,1),this.requestMap.delete(n.handle),e--)}t.sort((e,n)=>e.priority-n.priority)}_updateRequest(t){return t.priority=t.getPriority(t.handle),t.priority<0?(t.resolve(null),!1):!0}}let D6="";const mE={};function O6(r){for(const t in mE)if(r.startsWith(t)){const e=mE[t];r=r.replace(t,e)}return!r.startsWith("http://")&&!r.startsWith("https://")&&(r="".concat(D6).concat(r)),r}function z_t(r){return r}function N6(r){return r&&typeof r=="object"&&r.isBuffer}function yE(r){if(N6(r))return r;if(r instanceof ArrayBuffer)return r;if(ArrayBuffer.isView(r))return r.byteOffset===0&&r.byteLength===r.buffer.byteLength?r.buffer:r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength);if(typeof r=="string"){const t=r;return new TextEncoder().encode(t).buffer}if(r&&typeof r=="object"&&r._toArrayBuffer)return r._toArrayBuffer();throw new Error("toArrayBuffer")}function _E(r){const t=r?r.lastIndexOf("/"):-1;return t>=0?r.substr(t+1):""}function L_(r){const t=r?r.lastIndexOf("/"):-1;return t>=0?r.substr(0,t):""}const k6=r=>typeof r=="boolean",cp=r=>typeof r=="function",lp=r=>r!==null&&typeof r=="object",vE=r=>lp(r)&&r.constructor==={}.constructor,Q6=r=>r&&typeof r[Symbol.iterator]=="function",z6=r=>r&&typeof r[Symbol.asyncIterator]=="function",uh=r=>typeof Response<"u"&&r instanceof Response||r&&r.arrayBuffer&&r.text&&r.json,hh=r=>typeof Blob<"u"&&r instanceof Blob,H6=r=>r&&typeof r=="object"&&r.isBuffer,G6=r=>typeof ReadableStream<"u"&&r instanceof ReadableStream||lp(r)&&cp(r.tee)&&cp(r.cancel)&&cp(r.getReader),V6=r=>lp(r)&&cp(r.read)&&cp(r.pipe)&&k6(r.readable),bE=r=>G6(r)||V6(r),j6=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,q6=/^([-\w.]+\/[-\w.+]+)/;function K6(r){const t=q6.exec(r);return t?t[1]:r}function wE(r){const t=j6.exec(r);return t?t[1]:""}const xE=/\?.*/;function $6(r){const t=r.match(xE);return t&&t[0]}function F_(r){return r.replace(xE,"")}function Cm(r){return uh(r)?r.url:hh(r)?r.name||"":typeof r=="string"?r:""}function M_(r){if(uh(r)){const t=r,e=t.headers.get("content-type")||"",n=F_(t.url);return K6(e)||wE(n)}return hh(r)?r.type||"":typeof r=="string"?wE(r):""}function W6(r){return uh(r)?r.headers["content-length"]||-1:hh(r)?r.size:typeof r=="string"?r.length:r instanceof ArrayBuffer||ArrayBuffer.isView(r)?r.byteLength:-1}async function BE(r){if(uh(r))return r;const t={},e=W6(r);e>=0&&(t["content-length"]=String(e));const n=Cm(r),i=M_(r);i&&(t["content-type"]=i);const s=await Y6(r);s&&(t["x-first-bytes"]=s),typeof r=="string"&&(r=new TextEncoder().encode(r));const a=new Response(r,{headers:t});return Object.defineProperty(a,"url",{value:n}),a}async function X6(r){if(!r.ok){const t=await J6(r);throw new Error(t)}}async function J6(r){let t="Failed to fetch resource ".concat(r.url," (").concat(r.status,"): ");try{const e=r.headers.get("Content-Type");let n=r.statusText;e.includes("application/json")&&(n+=" ".concat(await r.text())),t+=n,t=t.length>60?"".concat(t.slice(0,60),"..."):t}catch{}return t}async function Y6(r){if(typeof r=="string")return"data:,".concat(r.slice(0,5));if(r instanceof Blob){const e=r.slice(0,5);return await new Promise(n=>{const i=new FileReader;i.onload=s=>{var a;return n(s==null||(a=s.target)===null||a===void 0?void 0:a.result)},i.readAsDataURL(e)})}if(r instanceof ArrayBuffer){const e=r.slice(0,5),n=Z6(e);return"data:base64,".concat(n)}return null}function Z6(r){let t="";const e=new Uint8Array(r);for(let n=0;n<e.byteLength;n++)t+=String.fromCharCode(e[n]);return btoa(t)}async function CE(r,t){if(typeof r=="string"){r=O6(r);let e=t;return t!=null&&t.fetch&&typeof(t==null?void 0:t.fetch)!="function"&&(e=t.fetch),await fetch(r,e)}return await BE(r)}function tk(r){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron)return!0;const t=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,e=r||t;return!!(e&&e.indexOf("Electron")>=0)}function Ap(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||tk()}const Em=globalThis.window||globalThis.self||globalThis.global,up=globalThis.process||{},EE=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";Ap();function ek(r){try{const t=window[r],e="__storage_test__";return t.setItem(e,e),t.removeItem(e),t}catch{return null}}let rk=class{constructor(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";this.storage=void 0,this.id=void 0,this.config=void 0,this.storage=ek(n),this.id=t,this.config=e,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(t){if(Object.assign(this.config,t),this.storage){const e=JSON.stringify(this.config);this.storage.setItem(this.id,e)}}_loadConfiguration(){let t={};if(this.storage){const e=this.storage.getItem(this.id);t=e?JSON.parse(e):{}}return Object.assign(this.config,t),this}};function nk(r){let t;return r<10?t=`${r.toFixed(2)}ms`:r<100?t=`${r.toFixed(1)}ms`:r<1e3?t=`${r.toFixed(0)}ms`:t=`${(r/1e3).toFixed(2)}s`,t}function ik(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const e=Math.max(t-r.length,0);return`${" ".repeat(e)}${r}`}function P_(r,t,e){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const i=r.src.replace(/\(/g,"%28").replace(/\)/g,"%29");r.width>n&&(e=Math.min(e,n/r.width));const s=r.width*e,a=r.height*e,o=["font-size:1px;",`padding:${Math.floor(a/2)}px ${Math.floor(s/2)}px;`,`line-height:${a}px;`,`background:url(${i});`,`background-size:${s}px ${a}px;`,"color:transparent;"].join("");return[`${t} %c+`,o]}let Sm;(function(r){r[r.BLACK=30]="BLACK",r[r.RED=31]="RED",r[r.GREEN=32]="GREEN",r[r.YELLOW=33]="YELLOW",r[r.BLUE=34]="BLUE",r[r.MAGENTA=35]="MAGENTA",r[r.CYAN=36]="CYAN",r[r.WHITE=37]="WHITE",r[r.BRIGHT_BLACK=90]="BRIGHT_BLACK",r[r.BRIGHT_RED=91]="BRIGHT_RED",r[r.BRIGHT_GREEN=92]="BRIGHT_GREEN",r[r.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",r[r.BRIGHT_BLUE=94]="BRIGHT_BLUE",r[r.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",r[r.BRIGHT_CYAN=96]="BRIGHT_CYAN",r[r.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Sm||(Sm={}));const sk=10;function SE(r){return typeof r!="string"?r:(r=r.toUpperCase(),Sm[r]||Sm.WHITE)}function ok(r,t,e){return!Ap&&typeof r=="string"&&(t&&(r=`\x1B[${SE(t)}m${r}\x1B[39m`),e&&(r=`\x1B[${SE(e)+sk}m${r}\x1B[49m`)),r}function ak(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const e=Object.getPrototypeOf(r),n=Object.getOwnPropertyNames(e),i=r;for(const s of n){const a=i[s];typeof a=="function"&&(t.find(o=>s===o)||(i[s]=a.bind(r)))}}function Tm(r,t){if(!r)throw new Error(t||"Assertion failed")}function gd(){let r;if(Ap()&&Em.performance){var t,e;r=Em==null||(t=Em.performance)===null||t===void 0||(e=t.now)===null||e===void 0?void 0:e.call(t)}else if("hrtime"in up){var n;const i=up==null||(n=up.hrtime)===null||n===void 0?void 0:n.call(up);r=i[0]*1e3+i[1]/1e6}else r=Date.now();return r}const md={debug:Ap()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},ck={enabled:!0,level:0};function Ya(){}const TE={},IE={once:!0};let U_=class{constructor(){let{id:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};this.id=void 0,this.VERSION=EE,this._startTs=gd(),this._deltaTs=gd(),this._storage=void 0,this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=t,this.userData={},this._storage=new rk(`__probe-${this.id}__`,ck),this.timeStamp(`${this.id} started`),ak(this),Object.seal(this)}set level(t){this.setLevel(t)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((gd()-this._startTs).toPrecision(10))}getDelta(){return Number((gd()-this._deltaTs).toPrecision(10))}set priority(t){this.level=t}get priority(){return this.level}getPriority(){return this.level}enable(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.setConfiguration({enabled:t}),this}setLevel(t){return this._storage.setConfiguration({level:t}),this}get(t){return this._storage.config[t]}set(t,e){this._storage.setConfiguration({[t]:e})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(t,e){Tm(t,e)}warn(t){return this._getLogFunction(0,t,md.warn,arguments,IE)}error(t){return this._getLogFunction(0,t,md.error,arguments)}deprecated(t,e){return this.warn(`\`${t}\` is deprecated and will be removed in a later version. Use \`${e}\` instead`)}removed(t,e){return this.error(`\`${t}\` has been removed. Use \`${e}\` instead`)}probe(t,e){return this._getLogFunction(t,e,md.log,arguments,{time:!0,once:!0})}log(t,e){return this._getLogFunction(t,e,md.debug,arguments)}info(t,e){return this._getLogFunction(t,e,console.info,arguments)}once(t,e){return this._getLogFunction(t,e,md.debug||md.info,arguments,IE)}table(t,e,n){return e?this._getLogFunction(t,e,console.table||Ya,n&&[n],{tag:hk(e)}):Ya}image(t){let{logLevel:e,priority:n,image:i,message:s="",scale:a=1}=t;return this._shouldLog(e||n)?Ap()?uk({image:i,message:s,scale:a}):Ak():Ya}time(t,e){return this._getLogFunction(t,e,console.time?console.time:console.info)}timeEnd(t,e){return this._getLogFunction(t,e,console.timeEnd?console.timeEnd:console.info)}timeStamp(t,e){return this._getLogFunction(t,e,console.timeStamp||Ya)}group(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const i=FE({logLevel:t,message:e,opts:n}),{collapsed:s}=n;return i.method=(s?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(t,e,Object.assign({},n,{collapsed:!0}))}groupEnd(t){return this._getLogFunction(t,"",console.groupEnd||Ya)}withGroup(t,e,n){this.group(t,e)();try{n()}finally{this.groupEnd(t)()}}trace(){console.trace&&console.trace()}_shouldLog(t){return this.isEnabled()&&this.getLevel()>=LE(t)}_getLogFunction(t,e,n,i,s){if(this._shouldLog(t)){s=FE({logLevel:t,message:e,args:i,opts:s}),n=n||s.method,Tm(n),s.total=this.getTotal(),s.delta=this.getDelta(),this._deltaTs=gd();const a=s.tag||s.message;if(s.once&&a)if(!TE[a])TE[a]=gd();else return Ya;return e=lk(this.id,s.message,s),n.bind(console,e,...s.args)}return Ya}};U_.VERSION=EE;function LE(r){if(!r)return 0;let t;switch(typeof r){case"number":t=r;break;case"object":t=r.logLevel||r.priority||0;break;default:return 0}return Tm(Number.isFinite(t)&&t>=0),t}function FE(r){const{logLevel:t,message:e}=r;r.logLevel=LE(t);const n=r.args?Array.from(r.args):[];for(;n.length&&n.shift()!==e;);switch(typeof t){case"string":case"function":e!==void 0&&n.unshift(e),r.message=t;break;case"object":Object.assign(r,t);break}typeof r.message=="function"&&(r.message=r.message());const i=typeof r.message;return Tm(i==="string"||i==="object"),Object.assign(r,{args:n},r.opts)}function lk(r,t,e){if(typeof t=="string"){const n=e.time?ik(nk(e.total)):"";t=e.time?`${r}: ${n}  ${t}`:`${r}: ${t}`,t=ok(t,e.color,e.background)}return t}function Ak(r){return console.warn("removed"),Ya}function uk(r){let{image:t,message:e="",scale:n=1}=r;if(typeof t=="string"){const s=new Image;return s.onload=()=>{const a=P_(s,e,n);console.log(...a)},s.src=t,Ya}const i=t.nodeName||"";if(i.toLowerCase()==="img")return console.log(...P_(t,e,n)),Ya;if(i.toLowerCase()==="canvas"){const s=new Image;return s.onload=()=>console.log(...P_(s,e,n)),s.src=t.toDataURL(),Ya}return Ya}function hk(r){for(const t in r)for(const e in r[t])return e||"untitled";return"empty"}const ME=new U_({id:"loaders.gl"});class dk{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class fk{constructor(){K(this,"console",void 0),this.console=console}log(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.console.log.bind(this.console,...e)}info(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.console.info.bind(this.console,...e)}warn(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.console.warn.bind(this.console,...e)}error(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.console.error.bind(this.console,...e)}}const PE={fetch:null,mimeType:void 0,nothrow:!1,log:new fk,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:Bm,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},pk={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function UE(){globalThis.loaders=globalThis.loaders||{};const{loaders:r}=globalThis;return r._state=r._state||{},r._state}const RE=()=>{const r=UE();return r.globalOptions=r.globalOptions||{...PE},r.globalOptions};function gk(r,t,e,n){return e=e||[],e=Array.isArray(e)?e:[e],mk(r,e),_k(t,r,n)}function mk(r,t){DE(r,null,PE,pk,t);for(const e of t){const n=r&&r[e.id]||{},i=e.options&&e.options[e.id]||{},s=e.deprecatedOptions&&e.deprecatedOptions[e.id]||{};DE(n,e.id,i,s,t)}}function DE(r,t,e,n,i){const s=t||"Top level",a=t?"".concat(t,"."):"";for(const o in r){const h=!t&&lp(r[o]),f=o==="baseUri"&&!t,g=o==="workerUrl"&&t;if(!(o in e)&&!f&&!g){if(o in n)ME.warn("".concat(s," loader option '").concat(a).concat(o,"' no longer supported, use '").concat(n[o],"'"))();else if(!h){const b=yk(o,i);ME.warn("".concat(s," loader option '").concat(a).concat(o,"' not recognized. ").concat(b))()}}}}function yk(r,t){const e=r.toLowerCase();let n="";for(const i of t)for(const s in i.options){if(r===s)return"Did you mean '".concat(i.id,".").concat(s,"'?");const a=s.toLowerCase();(e.startsWith(a)||a.startsWith(e))&&(n=n||"Did you mean '".concat(i.id,".").concat(s,"'?"))}return n}function _k(r,t,e){const i={...r.options||{}};return vk(i,e),i.log===null&&(i.log=new dk),OE(i,RE()),OE(i,t),i}function OE(r,t){for(const e in t)if(e in t){const n=t[e];vE(n)&&vE(r[e])?r[e]={...r[e],...t[e]}:r[e]=t[e]}}function vk(r,t){t&&!("baseUri"in r)&&(r.baseUri=t)}function R_(r){var t;return r?(Array.isArray(r)&&(r=r[0]),Array.isArray((t=r)===null||t===void 0?void 0:t.extensions)):!1}function D_(r){var t,e;li(r,"null loader"),li(R_(r),"invalid loader");let n;return Array.isArray(r)&&(n=r[1],r=r[0],r={...r,options:{...r.options,...n}}),((t=r)!==null&&t!==void 0&&t.parseTextSync||(e=r)!==null&&e!==void 0&&e.parseText)&&(r.text=!0),r.text||(r.binary=!0),r}const NE=()=>{const r=UE();return r.loaderRegistry=r.loaderRegistry||[],r.loaderRegistry};function bk(r){const t=NE();r=Array.isArray(r)?r:[r];for(const e of r){const n=D_(e);t.find(i=>n===i)||t.unshift(n)}}function wk(){return NE()}const xk=new U_({id:"loaders.gl"}),Bk=/\.([^.]+)$/;async function Ck(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],e=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;if(!QE(r))return null;let i=kE(r,t,{...e,nothrow:!0},n);if(i)return i;if(hh(r)&&(r=await r.slice(0,10).arrayBuffer(),i=kE(r,t,e,n)),!i&&!(e!=null&&e.nothrow))throw new Error(zE(r));return i}function kE(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],e=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;if(!QE(r))return null;if(t&&!Array.isArray(t))return D_(t);let i=[];t&&(i=i.concat(t)),e!=null&&e.ignoreRegisteredLoaders||i.push(...wk()),Sk(i);const s=Ek(r,i,e,n);if(!s&&!(e!=null&&e.nothrow))throw new Error(zE(r));return s}function Ek(r,t,e,n){const i=Cm(r),s=M_(r),a=F_(i)||(n==null?void 0:n.url);let o=null,h="";if(e!=null&&e.mimeType&&(o=O_(t,e==null?void 0:e.mimeType),h="match forced by supplied MIME type ".concat(e==null?void 0:e.mimeType)),o=o||Tk(t,a),h=h||(o?"matched url ".concat(a):""),o=o||O_(t,s),h=h||(o?"matched MIME type ".concat(s):""),o=o||Lk(t,r),h=h||(o?"matched initial data ".concat(GE(r)):""),o=o||O_(t,e==null?void 0:e.fallbackMimeType),h=h||(o?"matched fallback MIME type ".concat(s):""),h){var f;xk.log(1,"selectLoader selected ".concat((f=o)===null||f===void 0?void 0:f.name,": ").concat(h,"."))}return o}function QE(r){return!(r instanceof Response&&r.status===204)}function zE(r){const t=Cm(r),e=M_(r);let n="No valid loader found (";n+=t?"".concat(_E(t),", "):"no url provided, ",n+="MIME type: ".concat(e?'"'.concat(e,'"'):"not provided",", ");const i=r?GE(r):"";return n+=i?' first bytes: "'.concat(i,'"'):"first bytes: not available",n+=")",n}function Sk(r){for(const t of r)D_(t)}function Tk(r,t){const e=t&&Bk.exec(t),n=e&&e[1];return n?Ik(r,n):null}function Ik(r,t){t=t.toLowerCase();for(const e of r)for(const n of e.extensions)if(n.toLowerCase()===t)return e;return null}function O_(r,t){for(const e of r)if(e.mimeTypes&&e.mimeTypes.includes(t)||t==="application/x.".concat(e.id))return e;return null}function Lk(r,t){if(!t)return null;for(const e of r)if(typeof t=="string"){if(Fk(t,e))return e}else if(ArrayBuffer.isView(t)){if(HE(t.buffer,t.byteOffset,e))return e}else if(t instanceof ArrayBuffer&&HE(t,0,e))return e;return null}function Fk(r,t){return t.testText?t.testText(r):(Array.isArray(t.tests)?t.tests:[t.tests]).some(n=>r.startsWith(n))}function HE(r,t,e){return(Array.isArray(e.tests)?e.tests:[e.tests]).some(i=>Mk(r,t,e,i))}function Mk(r,t,e,n){if(n instanceof ArrayBuffer)return C6(n,r,n.byteLength);switch(typeof n){case"function":return n(r,e);case"string":const i=N_(r,t,n.length);return n===i;default:return!1}}function GE(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof r=="string"?r.slice(0,t):ArrayBuffer.isView(r)?N_(r.buffer,r.byteOffset,t):r instanceof ArrayBuffer?N_(r,0,t):""}function N_(r,t,e){if(r.byteLength<t+e)return"";const n=new DataView(r);let i="";for(let s=0;s<e;s++)i+=String.fromCharCode(n.getUint8(t+s));return i}const Pk=256*1024;function*Uk(r,t){const e=(t==null?void 0:t.chunkSize)||Pk;let n=0;const i=new TextEncoder;for(;n<r.length;){const s=Math.min(r.length-n,e),a=r.slice(n,n+s);n+=s,yield i.encode(a)}}const Rk=256*1024;function Dk(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){const{chunkSize:e=Rk}=t;let n=0;for(;n<r.byteLength;){const i=Math.min(r.byteLength-n,e),s=new ArrayBuffer(i),a=new Uint8Array(r,n,i);new Uint8Array(s).set(a),n+=i,yield s}}()}const Ok=1024*1024;async function*Nk(r,t){const e=(t==null?void 0:t.chunkSize)||Ok;let n=0;for(;n<r.size;){const i=n+e,s=await r.slice(n,i).arrayBuffer();n=i,yield s}}function VE(r,t){return Bm?kk(r,t):Qk(r)}async function*kk(r,t){const e=r.getReader();let n;try{for(;;){const i=n||e.read();t!=null&&t._streamReadAhead&&(n=e.read());const{done:s,value:a}=await i;if(s)return;yield yE(a)}}catch{e.releaseLock()}}async function*Qk(r,t){for await(const e of r)yield yE(e)}function zk(r,t){if(typeof r=="string")return Uk(r,t);if(r instanceof ArrayBuffer)return Dk(r,t);if(hh(r))return Nk(r,t);if(bE(r))return VE(r,t);if(uh(r))return VE(r.body,t);throw new Error("makeIterator")}const jE="Cannot convert supplied data type";function Hk(r,t,e){if(t.text&&typeof r=="string")return r;if(H6(r)&&(r=r.buffer),r instanceof ArrayBuffer){const n=r;return t.text&&!t.binary?new TextDecoder("utf8").decode(n):n}if(ArrayBuffer.isView(r)){if(t.text&&!t.binary)return new TextDecoder("utf8").decode(r);let n=r.buffer;const i=r.byteLength||r.length;return(r.byteOffset!==0||i!==n.byteLength)&&(n=n.slice(r.byteOffset,r.byteOffset+i)),n}throw new Error(jE)}async function Gk(r,t,e){const n=r instanceof ArrayBuffer||ArrayBuffer.isView(r);if(typeof r=="string"||n)return Hk(r,t);if(hh(r)&&(r=await BE(r)),uh(r)){const i=r;return await X6(i),t.binary?await i.arrayBuffer():await i.text()}if(bE(r)&&(r=zk(r,e)),Q6(r)||z6(r))return T6(r);throw new Error(jE)}function qE(r,t){const e=RE(),n=r||e;return typeof n.fetch=="function"?n.fetch:lp(n.fetch)?i=>CE(i,n):t!=null&&t.fetch?t==null?void 0:t.fetch:CE}function Vk(r,t,e){if(e)return e;const n={fetch:qE(t,r),...r};if(n.url){const i=F_(n.url);n.baseUrl=i,n.queryString=$6(n.url),n.filename=_E(i),n.baseUrl=L_(i)}return Array.isArray(n.loaders)||(n.loaders=null),n}function jk(r,t){if(!t&&r&&!Array.isArray(r))return r;let e;if(r&&(e=Array.isArray(r)?r:[r]),t&&t.loaders){const n=Array.isArray(t.loaders)?t.loaders:[t.loaders];e=e?[...e,...n]:n}return e&&e.length?e:null}async function k_(r,t,e,n){Bl(!n||typeof n=="object"),t&&!Array.isArray(t)&&!R_(t)&&(n=void 0,e=t,t=void 0),r=await r,e=e||{};const i=Cm(r),a=jk(t,n),o=await Ck(r,a,e);return o?(e=gk(e,o,a,i),n=Vk({url:i,parse:k_,loaders:a},e,n||null),await qk(o,r,e,n)):null}async function qk(r,t,e,n){if(h6(r),uh(t)){const i=t,{ok:s,redirected:a,status:o,statusText:h,type:f,url:g}=i,b=Object.fromEntries(i.headers.entries());n.response={headers:b,ok:s,redirected:a,status:o,statusText:h,type:f,url:g}}if(t=await Gk(t,r,e),r.parseTextSync&&typeof t=="string")return e.dataType="text",r.parseTextSync(t,e,n,r);if(v6(r,e))return await b6(r,t,e,n,k_);if(r.parseText&&typeof t=="string")return await r.parseText(t,e,n,r);if(r.parse)return await r.parse(t,e,n,r);throw Bl(!r.parseSync),new Error("".concat(r.id," loader - no parser found and worker is disabled"))}async function uu(r,t,e,n){!Array.isArray(t)&&!R_(t)&&(e=t,t=void 0);const i=qE(e);let s=r;return typeof r=="string"&&(s=await i(r)),hh(r)&&(s=await i(r)),await k_(s,t,e)}const Kk="3.4.14",{_parseImageNode:$k}=globalThis,Q_=typeof Image<"u",z_=typeof ImageBitmap<"u",H_=Bm?!0:!!$k;function Wk(r){switch(r){case"auto":return z_||Q_||H_;case"imagebitmap":return z_;case"image":return Q_;case"data":return H_;default:throw new Error("@loaders.gl/images: image ".concat(r," not supported in this environment"))}}function Xk(){if(z_)return"imagebitmap";if(Q_)return"image";if(H_)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function Jk(r){const t=Zk(r);if(!t)throw new Error("Not an image");return t}function Yk(r){switch(Jk(r)){case"data":return r;case"image":case"imagebitmap":const t=document.createElement("canvas"),e=t.getContext("2d");if(!e)throw new Error("getImageData");return t.width=r.width,t.height=r.height,e.drawImage(r,0,0),e.getImageData(0,0,r.width,r.height);default:throw new Error("getImageData")}}function Zk(r){return typeof ImageBitmap<"u"&&r instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&r instanceof Image?"image":r&&typeof r=="object"&&r.data&&r.width&&r.height?"data":null}const t8=/^data:image\/svg\+xml/,e8=/\.svg((\?|#).*)?$/;function G_(r){return r&&(t8.test(r)||e8.test(r))}function r8(r,t){if(G_(t)){let n=new TextDecoder().decode(r);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(n=unescape(encodeURIComponent(n)))}catch(s){throw new Error(s.message)}return"data:image/svg+xml;base64,".concat(btoa(n))}return KE(r,t)}function KE(r,t){if(G_(t))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(r)])}async function $E(r,t,e){const n=r8(r,e),i=self.URL||self.webkitURL,s=typeof n!="string"&&i.createObjectURL(n);try{return await n8(s||n,t)}finally{s&&i.revokeObjectURL(s)}}async function n8(r,t){const e=new Image;return e.src=r,t.image&&t.image.decode&&e.decode?(await e.decode(),e):await new Promise((n,i)=>{try{e.onload=()=>n(e),e.onerror=s=>i(new Error("Could not load image ".concat(r,": ").concat(s)))}catch(s){i(s)}})}const i8={};let WE=!0;async function s8(r,t,e){let n;G_(e)?n=await $E(r,t,e):n=KE(r,e);const i=t&&t.imagebitmap;return await o8(n,i)}async function o8(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if((a8(t)||!WE)&&(t=null),t)try{return await createImageBitmap(r,t)}catch(e){console.warn(e),WE=!1}return await createImageBitmap(r)}function a8(r){for(const t in r||i8)return!1;return!0}function c8(r){return!h8(r,"ftyp",4)||!(r[8]&96)?null:l8(r)}function l8(r){switch(A8(r,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function A8(r,t,e){return String.fromCharCode(...r.slice(t,e))}function u8(r){return[...r].map(t=>t.charCodeAt(0))}function h8(r,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const n=u8(t);for(let i=0;i<n.length;++i)if(n[i]!==r[i+e])return!1;return!0}const Cl=!1,hp=!0;function V_(r){const t=dp(r);return f8(t)||m8(t)||p8(t)||g8(t)||d8(t)}function d8(r){const t=new Uint8Array(r instanceof DataView?r.buffer:r),e=c8(t);return e?{mimeType:e.mimeType,width:0,height:0}:null}function f8(r){const t=dp(r);return t.byteLength>=24&&t.getUint32(0,Cl)===2303741511?{mimeType:"image/png",width:t.getUint32(16,Cl),height:t.getUint32(20,Cl)}:null}function p8(r){const t=dp(r);return t.byteLength>=10&&t.getUint32(0,Cl)===1195984440?{mimeType:"image/gif",width:t.getUint16(6,hp),height:t.getUint16(8,hp)}:null}function g8(r){const t=dp(r);return t.byteLength>=14&&t.getUint16(0,Cl)===16973&&t.getUint32(2,hp)===t.byteLength?{mimeType:"image/bmp",width:t.getUint32(18,hp),height:t.getUint32(22,hp)}:null}function m8(r){const t=dp(r);if(!(t.byteLength>=3&&t.getUint16(0,Cl)===65496&&t.getUint8(2)===255))return null;const{tableMarkers:n,sofMarkers:i}=y8();let s=2;for(;s+9<t.byteLength;){const a=t.getUint16(s,Cl);if(i.has(a))return{mimeType:"image/jpeg",height:t.getUint16(s+5,Cl),width:t.getUint16(s+7,Cl)};if(!n.has(a))return null;s+=2,s+=t.getUint16(s,Cl)}return null}function y8(){const r=new Set([65499,65476,65484,65501,65534]);for(let e=65504;e<65520;++e)r.add(e);return{tableMarkers:r,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function dp(r){if(r instanceof DataView)return r;if(ArrayBuffer.isView(r))return new DataView(r.buffer);if(r instanceof ArrayBuffer)return new DataView(r);throw new Error("toDataView")}async function _8(r,t){const{mimeType:e}=V_(r)||{},n=globalThis._parseImageNode;return li(n),await n(r,e)}async function v8(r,t,e){t=t||{};const i=(t.image||{}).type||"auto",{url:s}=e||{},a=b8(i);let o;switch(a){case"imagebitmap":o=await s8(r,t,s);break;case"image":o=await $E(r,t,s);break;case"data":o=await _8(r);break;default:li(!1)}return i==="data"&&(o=Yk(o)),o}function b8(r){switch(r){case"auto":case"data":return Xk();default:return Wk(r),r}}const XE={id:"image",module:"images",name:"Images",version:Kk,mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],parse:v8,tests:[r=>!!V_(new DataView(r))],options:{image:{type:"auto",decode:!0}}},j_={};function w8(r){if(j_[r]===void 0){const t=Bm?B8(r):x8(r);j_[r]=t}return j_[r]}function x8(r){const t=["image/png","image/jpeg","image/gif"],{_parseImageNode:e,_imageFormatsNode:n=t}=globalThis;return!!e&&n.includes(r)}function B8(r){switch(r){case"image/avif":case"image/webp":return C8(r);default:return!0}}function C8(r){try{return document.createElement("canvas").toDataURL(r).indexOf("data:".concat(r))===0}catch{return!1}}function JE(r){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron)return!0;const t=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,e=r||t;return!!(e&&e.indexOf("Electron")>=0)}function yd(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||JE()}const Im={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document,process:typeof process=="object"&&process},Lm=Im.window||Im.self||Im.global,fp=Im.process||{},YE=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";yd();const q_=globalThis;function E8(r){if(!r&&!yd())return"Node";if(JE(r))return"Electron";const e=r||(typeof navigator<"u"?navigator:{}).userAgent||"";if(e.indexOf("Edge")>-1)return"Edge";const n=e.indexOf("MSIE ")!==-1,i=e.indexOf("Trident/")!==-1;return n||i?"IE":q_.chrome?"Chrome":q_.safari?"Safari":q_.mozInnerScreenX?"Firefox":"Unknown"}function S8(r){try{const t=window[r],e="__storage_test__";return t.setItem(e,e),t.removeItem(e),t}catch{return null}}let T8=class{constructor(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";K(this,"storage",void 0),K(this,"id",void 0),K(this,"config",void 0),this.storage=S8(n),this.id=t,this.config=e,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(t){if(Object.assign(this.config,t),this.storage){const e=JSON.stringify(this.config);this.storage.setItem(this.id,e)}}_loadConfiguration(){let t={};if(this.storage){const e=this.storage.getItem(this.id);t=e?JSON.parse(e):{}}return Object.assign(this.config,t),this}};function I8(r){let t;return r<10?t="".concat(r.toFixed(2),"ms"):r<100?t="".concat(r.toFixed(1),"ms"):r<1e3?t="".concat(r.toFixed(0),"ms"):t="".concat((r/1e3).toFixed(2),"s"),t}function L8(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const e=Math.max(t-r.length,0);return"".concat(" ".repeat(e)).concat(r)}function K_(r,t,e){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const i=r.src.replace(/\(/g,"%28").replace(/\)/g,"%29");r.width>n&&(e=Math.min(e,n/r.width));const s=r.width*e,a=r.height*e,o=["font-size:1px;","padding:".concat(Math.floor(a/2),"px ").concat(Math.floor(s/2),"px;"),"line-height:".concat(a,"px;"),"background:url(".concat(i,");"),"background-size:".concat(s,"px ").concat(a,"px;"),"color:transparent;"].join("");return["".concat(t," %c+"),o]}let Fm;(function(r){r[r.BLACK=30]="BLACK",r[r.RED=31]="RED",r[r.GREEN=32]="GREEN",r[r.YELLOW=33]="YELLOW",r[r.BLUE=34]="BLUE",r[r.MAGENTA=35]="MAGENTA",r[r.CYAN=36]="CYAN",r[r.WHITE=37]="WHITE",r[r.BRIGHT_BLACK=90]="BRIGHT_BLACK",r[r.BRIGHT_RED=91]="BRIGHT_RED",r[r.BRIGHT_GREEN=92]="BRIGHT_GREEN",r[r.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",r[r.BRIGHT_BLUE=94]="BRIGHT_BLUE",r[r.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",r[r.BRIGHT_CYAN=96]="BRIGHT_CYAN",r[r.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Fm||(Fm={}));function ZE(r){return typeof r=="string"?Fm[r.toUpperCase()]||Fm.WHITE:r}function F8(r,t,e){return!yd&&typeof r=="string"&&(t&&(t=ZE(t),r="\x1B[".concat(t,"m").concat(r,"\x1B[39m")),e&&(t=ZE(e),r="\x1B[".concat(e+10,"m").concat(r,"\x1B[49m"))),r}function M8(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const e=Object.getPrototypeOf(r),n=Object.getOwnPropertyNames(e);for(const i of n)typeof r[i]=="function"&&(t.find(s=>i===s)||(r[i]=r[i].bind(r)))}function Mm(r,t){if(!r)throw new Error(t||"Assertion failed")}function _d(){let r;if(yd&&"performance"in Lm){var t,e;r=Lm==null||(t=Lm.performance)===null||t===void 0||(e=t.now)===null||e===void 0?void 0:e.call(t)}else if("hrtime"in fp){var n;const i=fp==null||(n=fp.hrtime)===null||n===void 0?void 0:n.call(fp);r=i[0]*1e3+i[1]/1e6}else r=Date.now();return r}const vd={debug:yd&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},P8={enabled:!0,level:0};function Za(){}const tS={},eS={once:!0};let rS=class{constructor(){let{id:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};K(this,"id",void 0),K(this,"VERSION",YE),K(this,"_startTs",_d()),K(this,"_deltaTs",_d()),K(this,"_storage",void 0),K(this,"userData",{}),K(this,"LOG_THROTTLE_TIMEOUT",0),this.id=t,this.userData={},this._storage=new T8("__probe-".concat(this.id,"__"),P8),this.timeStamp("".concat(this.id," started")),M8(this),Object.seal(this)}set level(t){this.setLevel(t)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((_d()-this._startTs).toPrecision(10))}getDelta(){return Number((_d()-this._deltaTs).toPrecision(10))}set priority(t){this.level=t}get priority(){return this.level}getPriority(){return this.level}enable(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.setConfiguration({enabled:t}),this}setLevel(t){return this._storage.setConfiguration({level:t}),this}get(t){return this._storage.config[t]}set(t,e){this._storage.setConfiguration({[t]:e})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(t,e){Mm(t,e)}warn(t){return this._getLogFunction(0,t,vd.warn,arguments,eS)}error(t){return this._getLogFunction(0,t,vd.error,arguments)}deprecated(t,e){return this.warn("`".concat(t,"` is deprecated and will be removed in a later version. Use `").concat(e,"` instead"))}removed(t,e){return this.error("`".concat(t,"` has been removed. Use `").concat(e,"` instead"))}probe(t,e){return this._getLogFunction(t,e,vd.log,arguments,{time:!0,once:!0})}log(t,e){return this._getLogFunction(t,e,vd.debug,arguments)}info(t,e){return this._getLogFunction(t,e,console.info,arguments)}once(t,e){for(var n=arguments.length,i=new Array(n>2?n-2:0),s=2;s<n;s++)i[s-2]=arguments[s];return this._getLogFunction(t,e,vd.debug||vd.info,arguments,eS)}table(t,e,n){return e?this._getLogFunction(t,e,console.table||Za,n&&[n],{tag:O8(e)}):Za}image(t){let{logLevel:e,priority:n,image:i,message:s="",scale:a=1}=t;return this._shouldLog(e||n)?yd?D8({image:i,message:s,scale:a}):R8():Za}time(t,e){return this._getLogFunction(t,e,console.time?console.time:console.info)}timeEnd(t,e){return this._getLogFunction(t,e,console.timeEnd?console.timeEnd:console.info)}timeStamp(t,e){return this._getLogFunction(t,e,console.timeStamp||Za)}group(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const i=iS({logLevel:t,message:e,opts:n}),{collapsed:s}=n;return i.method=(s?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(t,e,Object.assign({},n,{collapsed:!0}))}groupEnd(t){return this._getLogFunction(t,"",console.groupEnd||Za)}withGroup(t,e,n){this.group(t,e)();try{n()}finally{this.groupEnd(t)()}}trace(){console.trace&&console.trace()}_shouldLog(t){return this.isEnabled()&&this.getLevel()>=nS(t)}_getLogFunction(t,e,n,i,s){if(this._shouldLog(t)){s=iS({logLevel:t,message:e,args:i,opts:s}),n=n||s.method,Mm(n),s.total=this.getTotal(),s.delta=this.getDelta(),this._deltaTs=_d();const a=s.tag||s.message;if(s.once)if(!tS[a])tS[a]=_d();else return Za;return e=U8(this.id,s.message,s),n.bind(console,e,...s.args)}return Za}};K(rS,"VERSION",YE);function nS(r){if(!r)return 0;let t;switch(typeof r){case"number":t=r;break;case"object":t=r.logLevel||r.priority||0;break;default:return 0}return Mm(Number.isFinite(t)&&t>=0),t}function iS(r){const{logLevel:t,message:e}=r;r.logLevel=nS(t);const n=r.args?Array.from(r.args):[];for(;n.length&&n.shift()!==e;);switch(typeof t){case"string":case"function":e!==void 0&&n.unshift(e),r.message=t;break;case"object":Object.assign(r,t);break}typeof r.message=="function"&&(r.message=r.message());const i=typeof r.message;return Mm(i==="string"||i==="object"),Object.assign(r,{args:n},r.opts)}function U8(r,t,e){if(typeof t=="string"){const n=e.time?L8(I8(e.total)):"";t=e.time?"".concat(r,": ").concat(n,"  ").concat(t):"".concat(r,": ").concat(t),t=F8(t,e.color,e.background)}return t}function R8(r){return console.warn("removed"),Za}function D8(r){let{image:t,message:e="",scale:n=1}=r;if(typeof t=="string"){const s=new Image;return s.onload=()=>{const a=K_(s,e,n);console.log(...a)},s.src=t,Za}const i=t.nodeName||"";if(i.toLowerCase()==="img")return console.log(...K_(t,e,n)),Za;if(i.toLowerCase()==="canvas"){const s=new Image;return s.onload=()=>console.log(...K_(s,e,n)),s.src=t.toDataURL(),Za}return Za}function O8(r){for(const t in r)for(const e in r[t])return e||"untitled";return"empty"}const Ln=new rS({id:"deck"}),hu={attributeUpdateStart:-1,attributeManagerUpdateStart:-1,attributeUpdateMessages:[]},$_=1,pp=2,W_=3,X_=4,N8=2,k8=r=>({"layer.changeFlag":(t,e,n)=>{r.log(W_,"".concat(t.id," ").concat(e,": "),n[e])()},"layer.initialize":t=>{r.log($_,"Initializing ".concat(t))()},"layer.update":(t,e)=>{if(e){const n=t.getChangeFlags();r.log(pp,"Updating ".concat(t," because: ").concat(Object.keys(n).filter(i=>n[i]).join(", ")))()}else r.log(X_,"".concat(t," does not need update"))()},"layer.matched":(t,e)=>{e&&r.log(X_,"Matched ".concat(t,", state transfered"))()},"layer.finalize":t=>{r.log($_,"Finalizing ".concat(t))()},"compositeLayer.renderLayers":(t,e,n)=>{e?r.log(pp,"Composite layer rendered new subLayers ".concat(t),n)():r.log(X_,"Composite layer reused subLayers ".concat(t),n)()},"layerManager.setLayers":(t,e,n)=>{e&&r.log(pp,"Updating ".concat(n.length," deck layers"))()},"layerManager.activateViewport":(t,e)=>{r.log(W_,"Viewport changed",e)()},"attributeManager.invalidate":(t,e,n)=>{r.log($_,n?"invalidated attributes ".concat(n," (").concat(e,") for ").concat(t.id):"invalidated all attributes for ".concat(t.id))()},"attributeManager.updateStart":t=>{hu.attributeUpdateMessages.length=0,hu.attributeManagerUpdateStart=Date.now()},"attributeManager.updateEnd":(t,e)=>{const n=Math.round(Date.now()-hu.attributeManagerUpdateStart);r.groupCollapsed(pp,"Updated attributes for ".concat(e," instances in ").concat(t.id," in ").concat(n,"ms"))();for(const i of hu.attributeUpdateMessages)r.log(W_,i)();r.groupEnd(pp)()},"attribute.updateStart":t=>{hu.attributeUpdateStart=Date.now()},"attribute.allocate":(t,e)=>{const n="".concat(t.id," allocated ").concat(e);hu.attributeUpdateMessages.push(n)},"attribute.updateEnd":(t,e)=>{const n=Math.round(Date.now()-hu.attributeUpdateStart),i="".concat(t.id," updated ").concat(e," in ").concat(n,"ms");hu.attributeUpdateMessages.push(i)},"deckRenderer.renderLayers":(t,e,n)=>{const{pass:i,redrawReason:s,stats:a}=n;for(const o of e){const{totalCount:h,visibleCount:f,compositeCount:g,pickableCount:b}=o,B=h-g-f;r.log(N8,"RENDER #".concat(t.renderCount,"   ").concat(f," (of ").concat(h," layers) to ").concat(i," because ").concat(s,"   (").concat(B," hidden, ").concat(g," composite ").concat(b," pickable)"))(),a&&a.get("Redraw Layers").add(f)}}});var Q8={};let Pm={};Q8.NODE_ENV!=="production"&&(Pm=k8(Ln));function z8(r){Pm=r}function Ao(r,t,e,n){Ln.level>0&&Pm[r]&&Pm[r].call(null,t,e,n)}function H8(r){const t=r[0],e=r[r.length-1];return t==="{"&&e==="}"||t==="["&&e==="]"}const G8={id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:H8,parseTextSync:JSON.parse};function V8(){const r="8.9.34",t=globalThis.deck&&globalThis.deck.VERSION;if(t&&t!==r)throw new Error("deck.gl - multiple versions detected: ".concat(t," vs ").concat(r));return t||(Ln.log(1,"deck.gl ".concat(r))(),globalThis.deck={...globalThis.deck,VERSION:r,version:r,log:Ln,_registerLoggers:z8},bk([G8,[XE,{imagebitmap:{premultiplyAlpha:"none"}}]])),r}const j8=V8(),En={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(En,"IDENTITY",{get:()=>(Ln.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const El={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},J_={common:0,meters:1,pixels:2},sS={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}};function q8(r){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron)return!0;const t=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,e=r||t;return!!(e&&e.indexOf("Electron")>=0)}function bd(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||q8()}const Um={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document,process:typeof process=="object"&&process},Rm=Um.window||Um.self||Um.global,gp=Um.process||{},oS=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";bd();function K8(r){try{const t=window[r],e="__storage_test__";return t.setItem(e,e),t.removeItem(e),t}catch{return null}}class $8{constructor(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";K(this,"storage",void 0),K(this,"id",void 0),K(this,"config",void 0),this.storage=K8(n),this.id=t,this.config=e,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(t){if(Object.assign(this.config,t),this.storage){const e=JSON.stringify(this.config);this.storage.setItem(this.id,e)}}_loadConfiguration(){let t={};if(this.storage){const e=this.storage.getItem(this.id);t=e?JSON.parse(e):{}}return Object.assign(this.config,t),this}}function W8(r){let t;return r<10?t="".concat(r.toFixed(2),"ms"):r<100?t="".concat(r.toFixed(1),"ms"):r<1e3?t="".concat(r.toFixed(0),"ms"):t="".concat((r/1e3).toFixed(2),"s"),t}function X8(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const e=Math.max(t-r.length,0);return"".concat(" ".repeat(e)).concat(r)}function Y_(r,t,e){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const i=r.src.replace(/\(/g,"%28").replace(/\)/g,"%29");r.width>n&&(e=Math.min(e,n/r.width));const s=r.width*e,a=r.height*e,o=["font-size:1px;","padding:".concat(Math.floor(a/2),"px ").concat(Math.floor(s/2),"px;"),"line-height:".concat(a,"px;"),"background:url(".concat(i,");"),"background-size:".concat(s,"px ").concat(a,"px;"),"color:transparent;"].join("");return["".concat(t," %c+"),o]}let Dm;(function(r){r[r.BLACK=30]="BLACK",r[r.RED=31]="RED",r[r.GREEN=32]="GREEN",r[r.YELLOW=33]="YELLOW",r[r.BLUE=34]="BLUE",r[r.MAGENTA=35]="MAGENTA",r[r.CYAN=36]="CYAN",r[r.WHITE=37]="WHITE",r[r.BRIGHT_BLACK=90]="BRIGHT_BLACK",r[r.BRIGHT_RED=91]="BRIGHT_RED",r[r.BRIGHT_GREEN=92]="BRIGHT_GREEN",r[r.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",r[r.BRIGHT_BLUE=94]="BRIGHT_BLUE",r[r.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",r[r.BRIGHT_CYAN=96]="BRIGHT_CYAN",r[r.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Dm||(Dm={}));function aS(r){return typeof r=="string"?Dm[r.toUpperCase()]||Dm.WHITE:r}function J8(r,t,e){return!bd&&typeof r=="string"&&(t&&(t=aS(t),r="\x1B[".concat(t,"m").concat(r,"\x1B[39m")),e&&(t=aS(e),r="\x1B[".concat(e+10,"m").concat(r,"\x1B[49m"))),r}function Y8(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const e=Object.getPrototypeOf(r),n=Object.getOwnPropertyNames(e);for(const i of n)typeof r[i]=="function"&&(t.find(s=>i===s)||(r[i]=r[i].bind(r)))}function Om(r,t){if(!r)throw new Error(t||"Assertion failed")}function wd(){let r;if(bd&&"performance"in Rm){var t,e;r=Rm==null||(t=Rm.performance)===null||t===void 0||(e=t.now)===null||e===void 0?void 0:e.call(t)}else if("hrtime"in gp){var n;const i=gp==null||(n=gp.hrtime)===null||n===void 0?void 0:n.call(gp);r=i[0]*1e3+i[1]/1e6}else r=Date.now();return r}const xd={debug:bd&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},Z8={enabled:!0,level:0};function tc(){}const cS={},lS={once:!0};class AS{constructor(){let{id:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};K(this,"id",void 0),K(this,"VERSION",oS),K(this,"_startTs",wd()),K(this,"_deltaTs",wd()),K(this,"_storage",void 0),K(this,"userData",{}),K(this,"LOG_THROTTLE_TIMEOUT",0),this.id=t,this.userData={},this._storage=new $8("__probe-".concat(this.id,"__"),Z8),this.timeStamp("".concat(this.id," started")),Y8(this),Object.seal(this)}set level(t){this.setLevel(t)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((wd()-this._startTs).toPrecision(10))}getDelta(){return Number((wd()-this._deltaTs).toPrecision(10))}set priority(t){this.level=t}get priority(){return this.level}getPriority(){return this.level}enable(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.setConfiguration({enabled:t}),this}setLevel(t){return this._storage.setConfiguration({level:t}),this}get(t){return this._storage.config[t]}set(t,e){this._storage.setConfiguration({[t]:e})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(t,e){Om(t,e)}warn(t){return this._getLogFunction(0,t,xd.warn,arguments,lS)}error(t){return this._getLogFunction(0,t,xd.error,arguments)}deprecated(t,e){return this.warn("`".concat(t,"` is deprecated and will be removed in a later version. Use `").concat(e,"` instead"))}removed(t,e){return this.error("`".concat(t,"` has been removed. Use `").concat(e,"` instead"))}probe(t,e){return this._getLogFunction(t,e,xd.log,arguments,{time:!0,once:!0})}log(t,e){return this._getLogFunction(t,e,xd.debug,arguments)}info(t,e){return this._getLogFunction(t,e,console.info,arguments)}once(t,e){for(var n=arguments.length,i=new Array(n>2?n-2:0),s=2;s<n;s++)i[s-2]=arguments[s];return this._getLogFunction(t,e,xd.debug||xd.info,arguments,lS)}table(t,e,n){return e?this._getLogFunction(t,e,console.table||tc,n&&[n],{tag:nQ(e)}):tc}image(t){let{logLevel:e,priority:n,image:i,message:s="",scale:a=1}=t;return this._shouldLog(e||n)?bd?rQ({image:i,message:s,scale:a}):eQ():tc}time(t,e){return this._getLogFunction(t,e,console.time?console.time:console.info)}timeEnd(t,e){return this._getLogFunction(t,e,console.timeEnd?console.timeEnd:console.info)}timeStamp(t,e){return this._getLogFunction(t,e,console.timeStamp||tc)}group(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const i=hS({logLevel:t,message:e,opts:n}),{collapsed:s}=n;return i.method=(s?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(t,e,Object.assign({},n,{collapsed:!0}))}groupEnd(t){return this._getLogFunction(t,"",console.groupEnd||tc)}withGroup(t,e,n){this.group(t,e)();try{n()}finally{this.groupEnd(t)()}}trace(){console.trace&&console.trace()}_shouldLog(t){return this.isEnabled()&&this.getLevel()>=uS(t)}_getLogFunction(t,e,n,i,s){if(this._shouldLog(t)){s=hS({logLevel:t,message:e,args:i,opts:s}),n=n||s.method,Om(n),s.total=this.getTotal(),s.delta=this.getDelta(),this._deltaTs=wd();const a=s.tag||s.message;if(s.once)if(!cS[a])cS[a]=wd();else return tc;return e=tQ(this.id,s.message,s),n.bind(console,e,...s.args)}return tc}}K(AS,"VERSION",oS);function uS(r){if(!r)return 0;let t;switch(typeof r){case"number":t=r;break;case"object":t=r.logLevel||r.priority||0;break;default:return 0}return Om(Number.isFinite(t)&&t>=0),t}function hS(r){const{logLevel:t,message:e}=r;r.logLevel=uS(t);const n=r.args?Array.from(r.args):[];for(;n.length&&n.shift()!==e;);switch(typeof t){case"string":case"function":e!==void 0&&n.unshift(e),r.message=t;break;case"object":Object.assign(r,t);break}typeof r.message=="function"&&(r.message=r.message());const i=typeof r.message;return Om(i==="string"||i==="object"),Object.assign(r,{args:n},r.opts)}function tQ(r,t,e){if(typeof t=="string"){const n=e.time?X8(W8(e.total)):"";t=e.time?"".concat(r,": ").concat(n,"  ").concat(t):"".concat(r,": ").concat(t),t=J8(t,e.color,e.background)}return t}function eQ(r){return console.warn("removed"),tc}function rQ(r){let{image:t,message:e="",scale:n=1}=r;if(typeof t=="string"){const s=new Image;return s.onload=()=>{const a=Y_(s,e,n);console.log(...a)},s.src=t,tc}const i=t.nodeName||"";if(i.toLowerCase()==="img")return console.log(...Y_(t,e,n)),tc;if(i.toLowerCase()==="canvas"){const s=new Image;return s.onload=()=>console.log(...Y_(s,e,n)),s.src=t.toDataURL(),tc}return tc}function nQ(r){for(const t in r)for(const e in r[t])return e||"untitled";return"empty"}const Cr=new AS({id:"luma.gl"});function ko(r,t){if(!r)throw new Error(t||"luma.gl: assertion failed.")}const iQ="Invalid WebGLRenderingContext",sQ="Requires WebGL2";function Nm(r){return typeof WebGLRenderingContext<"u"&&r instanceof WebGLRenderingContext||typeof WebGL2RenderingContext<"u"&&r instanceof WebGL2RenderingContext?!0:!!(r&&Number.isFinite(r._version))}function yn(r){return typeof WebGL2RenderingContext<"u"&&r instanceof WebGL2RenderingContext?!0:!!(r&&r._version===2)}function oQ(r){return yn(r)?r:null}function km(r){return ko(Nm(r),iQ),r}function Qo(r){return ko(yn(r),sQ),r}const mp={};function aQ(r){globalThis.console&&globalThis.console.error&&globalThis.console.error(r)}function cQ(r){globalThis.console&&globalThis.console.log&&globalThis.console.log(r)}function lQ(r,t){mp[r]=!0,t!==void 0&&aQ(t)}function AQ(r){const t=r.getError;r.getError=function(){let n;do n=t.apply(r),n!==0&&(mp[n]=!0);while(n!==0);for(n in mp)if(mp[n])return delete mp[n],parseInt(n,10);return 0}}const yp=function r(t){const e=t.gl;this.ext=t,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(t.maxVertexAttribs);for(let n=0;n<this.attribs.length;n++){const i=new r.VertexAttrib(e);this.attribs[n]=i}this.maxAttrib=0};yp.VertexAttrib=function(t){this.enabled=!1,this.buffer=null,this.size=4,this.type=5126,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()},yp.VertexAttrib.prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};const dh=function(t){const e=this;this.gl=t,AQ(t);const n=this.original={getParameter:t.getParameter,enableVertexAttribArray:t.enableVertexAttribArray,disableVertexAttribArray:t.disableVertexAttribArray,bindBuffer:t.bindBuffer,getVertexAttrib:t.getVertexAttrib,vertexAttribPointer:t.vertexAttribPointer};t.getParameter=function(s){return s===e.VERTEX_ARRAY_BINDING_OES?e.currentVertexArrayObject===e.defaultVertexArrayObject?null:e.currentVertexArrayObject:n.getParameter.apply(this,arguments)},t.enableVertexAttribArray=function(s){const a=e.currentVertexArrayObject;a.maxAttrib=Math.max(a.maxAttrib,s);const o=a.attribs[s];return o.enabled=!0,n.enableVertexAttribArray.apply(this,arguments)},t.disableVertexAttribArray=function(s){const a=e.currentVertexArrayObject;a.maxAttrib=Math.max(a.maxAttrib,s);const o=a.attribs[s];return o.enabled=!1,n.disableVertexAttribArray.apply(this,arguments)},t.bindBuffer=function(s,a){switch(s){case 34962:e.currentArrayBuffer=a;break;case 34963:e.currentVertexArrayObject.elementArrayBuffer=a;break}return n.bindBuffer.apply(this,arguments)},t.getVertexAttrib=function(s,a){const h=e.currentVertexArrayObject.attribs[s];switch(a){case 34975:return h.buffer;case 34338:return h.enabled;case 34339:return h.size;case 34340:return h.stride;case 34341:return h.type;case 34922:return h.normalized;default:return n.getVertexAttrib.apply(this,arguments)}},t.vertexAttribPointer=function(s,a,o,h,f,g){const b=e.currentVertexArrayObject;b.maxAttrib=Math.max(b.maxAttrib,s);const C=b.attribs[s];return C.buffer=e.currentArrayBuffer,C.size=a,C.type=o,C.normalized=h,C.stride=f,C.offset=g,C.recache(),n.vertexAttribPointer.apply(this,arguments)},t.instrumentExtension&&t.instrumentExtension(this,"OES_vertex_array_object"),t.canvas&&t.canvas.addEventListener("webglcontextrestored",()=>{cQ("OESVertexArrayObject emulation library context restored"),e.reset_()},!0),this.reset_()};dh.prototype.VERTEX_ARRAY_BINDING_OES=34229,dh.prototype.reset_=function(){if(this.vertexArrayObjects!==void 0)for(let n=0;n<this.vertexArrayObjects.length;++n)this.vertexArrayObjects.isAlive=!1;const e=this.gl;this.maxVertexAttribs=e.getParameter(34921),this.defaultVertexArrayObject=new yp(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)},dh.prototype.createVertexArrayOES=function(){const t=new yp(this);return this.vertexArrayObjects.push(t),t},dh.prototype.deleteVertexArrayOES=function(t){t.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(t),1),this.currentVertexArrayObject===t&&this.bindVertexArrayOES(null)},dh.prototype.isVertexArrayOES=function(t){return!!(t&&t instanceof yp&&t.hasBeenBound&&t.ext===this)},dh.prototype.bindVertexArrayOES=function(t){const e=this.gl;if(t&&!t.isAlive){lQ(1282,"bindVertexArrayOES: attempt to bind deleted arrayObject");return}const n=this.original,i=this.currentVertexArrayObject;this.currentVertexArrayObject=t||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;const s=this.currentVertexArrayObject;if(i===s)return;(!i||s.elementArrayBuffer!==i.elementArrayBuffer)&&n.bindBuffer.call(e,34963,s.elementArrayBuffer);let a=this.currentArrayBuffer;const o=Math.max(i?i.maxAttrib:0,s.maxAttrib);for(let h=0;h<=o;h++){const f=s.attribs[h],g=i?i.attribs[h]:null;if((!i||f.enabled!==g.enabled)&&(f.enabled?n.enableVertexAttribArray.call(e,h):n.disableVertexAttribArray.call(e,h)),f.enabled){let b=!1;(!i||f.buffer!==g.buffer)&&(a!==f.buffer&&(n.bindBuffer.call(e,34962,f.buffer),a=f.buffer),b=!0),(b||f.cached!==g.cached)&&n.vertexAttribPointer.call(e,h,f.size,f.type,f.normalized,f.stride,f.offset)}}this.currentArrayBuffer!==a&&n.bindBuffer.call(e,34962,this.currentArrayBuffer)};function uQ(r){if(typeof r.createVertexArray=="function")return;const t=r.getSupportedExtensions;r.getSupportedExtensions=function(){const i=t.call(this)||[];return i.indexOf("OES_vertex_array_object")<0&&i.push("OES_vertex_array_object"),i};const e=r.getExtension;r.getExtension=function(i){const s=e.call(this,i);return s||(i!=="OES_vertex_array_object"?null:(r.__OESVertexArrayObject||(this.__OESVertexArrayObject=new dh(this)),this.__OESVertexArrayObject))}}const dS="OES_element_index",fS="WEBGL_draw_buffers",hQ="EXT_disjoint_timer_query",dQ="EXT_disjoint_timer_query_webgl2",fQ="EXT_texture_filter_anisotropic",pS="WEBGL_debug_renderer_info",pQ=35723,gQ=4352,mQ=36795,yQ=34047,_Q=37445,vQ=37446,pi=r=>yn(r)?void 0:0,bQ={3074:r=>yn(r)?void 0:36064,[pQ]:r=>yn(r)?void 0:gQ,35977:pi,32937:pi,[mQ]:(r,t)=>{const e=yn(r)?r.getExtension(dQ):r.getExtension(hQ);return e&&e.GPU_DISJOINT_EXT?t(e.GPU_DISJOINT_EXT):0},[_Q]:(r,t)=>{const e=r.getExtension(pS);return t(e&&e.UNMASKED_VENDOR_WEBGL||7936)},[vQ]:(r,t)=>{const e=r.getExtension(pS);return t(e&&e.UNMASKED_RENDERER_WEBGL||7937)},[yQ]:(r,t)=>{const e=r.luma.extensions[fQ];return e?t(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1},32883:pi,35071:pi,37447:pi,36063:(r,t)=>{if(!yn(r)){const e=r.getExtension(fS);return e?t(e.MAX_COLOR_ATTACHMENTS_WEBGL):0}},35379:pi,35374:pi,35377:pi,34852:r=>{if(!yn(r)){const t=r.getExtension(fS);return t?t.MAX_DRAW_BUFFERS_WEBGL:0}},36203:r=>r.getExtension(dS)?2147483647:65535,33001:r=>r.getExtension(dS)?16777216:65535,33e3:r=>16777216,37157:pi,35373:pi,35657:pi,36183:pi,37137:pi,34045:pi,35978:pi,35979:pi,35968:pi,35376:pi,35375:pi,35659:pi,37154:pi,35371:pi,35658:pi,35076:pi,35077:pi,35380:pi};function wQ(r,t,e){const n=bQ[e],i=typeof n=="function"?n(r,t,e):n;return i!==void 0?i:t(e)}const xQ="OES_vertex_array_object",gS="ANGLE_instanced_arrays",BQ="WEBGL_draw_buffers",CQ="EXT_disjoint_timer_query",EQ="EXT_texture_filter_anisotropic",SQ="VertexArray requires WebGL2 or OES_vertex_array_object extension";function TQ(r,t){return{webgl2:yn(r),ext:r.getExtension(t)}}const mS={[xQ]:{meta:{suffix:"OES"},createVertexArray:()=>{ko(!1,SQ)},deleteVertexArray:()=>{},bindVertexArray:()=>{},isVertexArray:()=>!1},[gS]:{meta:{suffix:"ANGLE"},vertexAttribDivisor(r,t){ko(t===0,"WebGL instanced rendering not supported")},drawElementsInstanced:()=>{},drawArraysInstanced:()=>{}},[BQ]:{meta:{suffix:"WEBGL"},drawBuffers:()=>{ko(!1)}},[CQ]:{meta:{suffix:"EXT"},createQuery:()=>{ko(!1)},deleteQuery:()=>{ko(!1)},beginQuery:()=>{ko(!1)},endQuery:()=>{},getQuery(r,t){return this.getQueryObject(r,t)},getQueryParameter(r,t){return this.getQueryObject(r,t)},getQueryObject:()=>{}}},Z_={readBuffer:(r,t,e)=>{yn(r)&&t(e)},getVertexAttrib:(r,t,e,n)=>{const{webgl2:i,ext:s}=TQ(r,gS);let a;switch(n){case 35069:a=i?void 0:!1;break;case 35070:a=!i&&!s?0:void 0;break}return a!==void 0?a:t(e,n)},getProgramParameter:(r,t,e,n)=>{if(!yn(r))switch(n){case 35967:return 35981;case 35971:return 0;case 35382:return 0}return t(e,n)},getInternalformatParameter:(r,t,e,n,i)=>{if(!yn(r))switch(i){case 32937:return new Int32Array([0])}return r.getInternalformatParameter(e,n,i)},getTexParameter(r,t,e,n){switch(n){case 34046:const{extensions:i}=r.luma,s=i[EQ];n=s&&s.TEXTURE_MAX_ANISOTROPY_EXT||34046;break}return t(e,n)},getParameter:wQ,hint(r,t,e,n){return t(e,n)}};function IQ(r){r.luma=r.luma||{};const{luma:t}=r;return t.polyfilled||(uQ(r),LQ(r),MQ(r,mS),FQ(r,{target:t,target2:r}),t.polyfilled=!0),r}globalThis.polyfillContext=IQ;function LQ(r){r.luma.extensions={};const t=r.getSupportedExtensions()||[];for(const e of t)r.luma[e]=r.getExtension(e)}function FQ(r,t){let{target:e,target2:n}=t;Object.keys(Z_).forEach(i=>{if(typeof Z_[i]=="function"){const s=r[i]?r[i].bind(r):()=>{},a=Z_[i].bind(null,r,s);e[i]=a,n[i]=a}})}function MQ(r,t){for(const e of Object.getOwnPropertyNames(t))e!=="overrides"&&PQ(r,{extension:e,target:r.luma,target2:r})}function PQ(r,t){let{extension:e,target:n,target2:i}=t;const s=mS[e];ko(s);const{meta:a={}}=s,{suffix:o=""}=a,h=r.getExtension(e);for(const f of Object.keys(s)){const g="".concat(f).concat(o);let b=null;f==="meta"||typeof r[f]=="function"||(h&&typeof h[g]=="function"?b=function(){return h[g](...arguments)}:typeof s[f]=="function"&&(b=s[f].bind(n))),b&&(n[f]=b,i[f]=b)}}const tv={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,36006:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],3333:4,3317:4,37440:!1,37441:!1,37443:37444,35723:4352,36010:null,35977:!1,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},du=(r,t,e)=>t?r.enable(e):r.disable(e),yS=(r,t,e)=>r.hint(e,t),Ia=(r,t,e)=>r.pixelStorei(e,t),UQ=(r,t)=>{const e=yn(r)?36009:36160;return r.bindFramebuffer(e,t)},RQ=(r,t)=>r.bindFramebuffer(36008,t);function _p(r){return Array.isArray(r)||ArrayBuffer.isView(r)}const DQ={3042:du,32773:(r,t)=>r.blendColor(...t),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(r,t)=>r.clearColor(...t),3107:(r,t)=>r.colorMask(...t),2884:du,2885:(r,t)=>r.cullFace(t),2929:du,2931:(r,t)=>r.clearDepth(t),2932:(r,t)=>r.depthFunc(t),2928:(r,t)=>r.depthRange(...t),2930:(r,t)=>r.depthMask(t),3024:du,35723:yS,36006:UQ,2886:(r,t)=>r.frontFace(t),33170:yS,2849:(r,t)=>r.lineWidth(t),32823:du,32824:"polygonOffset",10752:"polygonOffset",35977:du,32938:"sampleCoverage",32939:"sampleCoverage",3089:du,3088:(r,t)=>r.scissor(...t),2960:du,2961:(r,t)=>r.clearStencil(t),2968:(r,t)=>r.stencilMaskSeparate(1028,t),36005:(r,t)=>r.stencilMaskSeparate(1029,t),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(r,t)=>r.viewport(...t),3333:Ia,3317:Ia,37440:Ia,37441:Ia,37443:Ia,3330:Ia,3332:Ia,3331:Ia,36010:RQ,3314:Ia,32878:Ia,3316:Ia,3315:Ia,32877:Ia,framebuffer:(r,t)=>{const e=t&&"handle"in t?t.handle:t;return r.bindFramebuffer(36160,e)},blend:(r,t)=>t?r.enable(3042):r.disable(3042),blendColor:(r,t)=>r.blendColor(...t),blendEquation:(r,t)=>{t=_p(t)?t:[t,t],r.blendEquationSeparate(...t)},blendFunc:(r,t)=>{t=_p(t)&&t.length===2?[...t,...t]:t,r.blendFuncSeparate(...t)},clearColor:(r,t)=>r.clearColor(...t),clearDepth:(r,t)=>r.clearDepth(t),clearStencil:(r,t)=>r.clearStencil(t),colorMask:(r,t)=>r.colorMask(...t),cull:(r,t)=>t?r.enable(2884):r.disable(2884),cullFace:(r,t)=>r.cullFace(t),depthTest:(r,t)=>t?r.enable(2929):r.disable(2929),depthFunc:(r,t)=>r.depthFunc(t),depthMask:(r,t)=>r.depthMask(t),depthRange:(r,t)=>r.depthRange(...t),dither:(r,t)=>t?r.enable(3024):r.disable(3024),derivativeHint:(r,t)=>{r.hint(35723,t)},frontFace:(r,t)=>r.frontFace(t),mipmapHint:(r,t)=>r.hint(33170,t),lineWidth:(r,t)=>r.lineWidth(t),polygonOffsetFill:(r,t)=>t?r.enable(32823):r.disable(32823),polygonOffset:(r,t)=>r.polygonOffset(...t),sampleCoverage:(r,t)=>r.sampleCoverage(...t),scissorTest:(r,t)=>t?r.enable(3089):r.disable(3089),scissor:(r,t)=>r.scissor(...t),stencilTest:(r,t)=>t?r.enable(2960):r.disable(2960),stencilMask:(r,t)=>{t=_p(t)?t:[t,t];const[e,n]=t;r.stencilMaskSeparate(1028,e),r.stencilMaskSeparate(1029,n)},stencilFunc:(r,t)=>{t=_p(t)&&t.length===3?[...t,...t]:t;const[e,n,i,s,a,o]=t;r.stencilFuncSeparate(1028,e,n,i),r.stencilFuncSeparate(1029,s,a,o)},stencilOp:(r,t)=>{t=_p(t)&&t.length===3?[...t,...t]:t;const[e,n,i,s,a,o]=t;r.stencilOpSeparate(1028,e,n,i),r.stencilOpSeparate(1029,s,a,o)},viewport:(r,t)=>r.viewport(...t)};function Oi(r,t,e){return t[r]!==void 0?t[r]:e[r]}const OQ={blendEquation:(r,t,e)=>r.blendEquationSeparate(Oi(32777,t,e),Oi(34877,t,e)),blendFunc:(r,t,e)=>r.blendFuncSeparate(Oi(32969,t,e),Oi(32968,t,e),Oi(32971,t,e),Oi(32970,t,e)),polygonOffset:(r,t,e)=>r.polygonOffset(Oi(32824,t,e),Oi(10752,t,e)),sampleCoverage:(r,t,e)=>r.sampleCoverage(Oi(32938,t,e),Oi(32939,t,e)),stencilFuncFront:(r,t,e)=>r.stencilFuncSeparate(1028,Oi(2962,t,e),Oi(2967,t,e),Oi(2963,t,e)),stencilFuncBack:(r,t,e)=>r.stencilFuncSeparate(1029,Oi(34816,t,e),Oi(36003,t,e),Oi(36004,t,e)),stencilOpFront:(r,t,e)=>r.stencilOpSeparate(1028,Oi(2964,t,e),Oi(2965,t,e),Oi(2966,t,e)),stencilOpBack:(r,t,e)=>r.stencilOpSeparate(1029,Oi(34817,t,e),Oi(34818,t,e),Oi(34819,t,e))},_S={enable:(r,t)=>r({[t]:!0}),disable:(r,t)=>r({[t]:!1}),pixelStorei:(r,t,e)=>r({[t]:e}),hint:(r,t,e)=>r({[t]:e}),bindFramebuffer:(r,t,e)=>{switch(t){case 36160:return r({36006:e,36010:e});case 36009:return r({36006:e});case 36008:return r({36010:e});default:return null}},blendColor:(r,t,e,n,i)=>r({32773:new Float32Array([t,e,n,i])}),blendEquation:(r,t)=>r({32777:t,34877:t}),blendEquationSeparate:(r,t,e)=>r({32777:t,34877:e}),blendFunc:(r,t,e)=>r({32969:t,32968:e,32971:t,32970:e}),blendFuncSeparate:(r,t,e,n,i)=>r({32969:t,32968:e,32971:n,32970:i}),clearColor:(r,t,e,n,i)=>r({3106:new Float32Array([t,e,n,i])}),clearDepth:(r,t)=>r({2931:t}),clearStencil:(r,t)=>r({2961:t}),colorMask:(r,t,e,n,i)=>r({3107:[t,e,n,i]}),cullFace:(r,t)=>r({2885:t}),depthFunc:(r,t)=>r({2932:t}),depthRange:(r,t,e)=>r({2928:new Float32Array([t,e])}),depthMask:(r,t)=>r({2930:t}),frontFace:(r,t)=>r({2886:t}),lineWidth:(r,t)=>r({2849:t}),polygonOffset:(r,t,e)=>r({32824:t,10752:e}),sampleCoverage:(r,t,e)=>r({32938:t,32939:e}),scissor:(r,t,e,n,i)=>r({3088:new Int32Array([t,e,n,i])}),stencilMask:(r,t)=>r({2968:t,36005:t}),stencilMaskSeparate:(r,t,e)=>r({[t===1028?2968:36005]:e}),stencilFunc:(r,t,e,n)=>r({2962:t,2967:e,2963:n,34816:t,36003:e,36004:n}),stencilFuncSeparate:(r,t,e,n,i)=>r({[t===1028?2962:34816]:e,[t===1028?2967:36003]:n,[t===1028?2963:36004]:i}),stencilOp:(r,t,e,n)=>r({2964:t,2965:e,2966:n,34817:t,34818:e,34819:n}),stencilOpSeparate:(r,t,e,n,i)=>r({[t===1028?2964:34817]:e,[t===1028?2965:34818]:n,[t===1028?2966:34819]:i}),viewport:(r,t,e,n,i)=>r({2978:[t,e,n,i]})},Sl=(r,t)=>r.isEnabled(t),vS={3042:Sl,2884:Sl,2929:Sl,3024:Sl,32823:Sl,32926:Sl,32928:Sl,3089:Sl,2960:Sl,35977:Sl};function bS(r){for(const t in r)return!1;return!0}function NQ(r,t){if(r===t)return!0;const e=Array.isArray(r)||ArrayBuffer.isView(r),n=Array.isArray(t)||ArrayBuffer.isView(t);if(e&&n&&r.length===t.length){for(let i=0;i<r.length;++i)if(r[i]!==t[i])return!1;return!0}return!1}function wS(r,t){const e=r[t].bind(r);r[t]=function(){const i=arguments.length<=0?void 0:arguments[0];return i in r.state.cache?r.state.enable?r.state.cache[i]:e(...arguments):e(...arguments)},Object.defineProperty(r[t],"name",{value:"".concat(t,"-from-cache"),configurable:!1})}function kQ(r,t,e){const n=r[t].bind(r);r[t]=function(){for(var s=arguments.length,a=new Array(s),o=0;o<s;o++)a[o]=arguments[o];const{valueChanged:h,oldValue:f}=e(r.state._updateCache,...a);return h&&n(...a),f},Object.defineProperty(r[t],"name",{value:"".concat(t,"-to-cache"),configurable:!1})}function QQ(r){const t=r.useProgram.bind(r);r.useProgram=function(n){r.state.program!==n&&(t(n),r.state.program=n)}}class zQ{constructor(t){let{copyState:e=!1,log:n=()=>{}}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=t,this.program=null,this.stateStack=[],this.enable=!0,this.cache=e?GQ(t):Object.assign({},tv),this.log=n,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(){this.stateStack.push({})}pop(){ko(this.stateStack.length>0);const t=this.stateStack[this.stateStack.length-1];_A(this.gl,t),this.stateStack.pop()}_updateCache(t){let e=!1,n;const i=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(const s in t){ko(s!==void 0);const a=t[s],o=this.cache[s];NQ(a,o)||(e=!0,n=o,i&&!(s in i)&&(i[s]=o),this.cache[s]=a)}return{valueChanged:e,oldValue:n}}}function xS(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{enable:e=!0,copyState:n}=t;if(ko(n!==void 0),!r.state){const{polyfillContext:i}=globalThis;i&&i(r),r.state=new zQ(r,{copyState:n}),QQ(r);for(const s in _S){const a=_S[s];kQ(r,s,a)}wS(r,"getParameter"),wS(r,"isEnabled")}return r.state.enable=e,r}function HQ(r){r.state||xS(r,{copyState:!1}),r.state.push()}function BS(r){ko(r.state),r.state.pop()}function _A(r,t){if(ko(Nm(r),"setParameters requires a WebGL context"),bS(t))return;const e={};for(const i in t){const s=Number(i),a=DQ[i];a&&(typeof a=="string"?e[a]=!0:a(r,t[i],s))}const n=r.state&&r.state.cache;if(n)for(const i in e){const s=OQ[i];s(r,t,n)}}function GQ(r,t){if(t=t||tv,typeof t=="number"){const i=t,s=vS[i];return s?s(r,i):r.getParameter(i)}const e=Array.isArray(t)?t:Object.keys(t),n={};for(const i of e){const s=vS[i];n[i]=s?s(r,Number(i)):r.getParameter(Number(i))}return n}function VQ(r){_A(r,tv)}function Ic(r,t,e){if(bS(t))return e(r);const{nocatch:n=!0}=t;HQ(r),_A(r,t);let i;if(n)i=e(r),BS(r);else try{i=e(r)}finally{BS(r)}return i}function Bd(r){const{luma:t}=r;if(r.canvas&&t){const e=t.canvasSizeInfo,n="clientWidth"in e?e.clientWidth:r.canvas.clientWidth;return n?r.drawingBufferWidth/n:1}return 1}function ev(r,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const n=Bd(r),i=r.drawingBufferWidth,s=r.drawingBufferHeight;return qQ(t,n,i,s,e)}function jQ(r){const t=typeof window>"u"?1:window.devicePixelRatio||1;return Number.isFinite(r)?r<=0?1:r:r?t:1}function qQ(r,t,e,n,i){const s=CS(r[0],t,e);let a=ES(r[1],t,n,i),o=CS(r[0]+1,t,e);const h=o===e-1?o:o-1;o=ES(r[1]+1,t,n,i);let f;return i?(o=o===0?o:o+1,f=a,a=o):f=o===n-1?o:o-1,{x:s,y:a,width:Math.max(h-s+1,1),height:Math.max(f-a+1,1)}}function CS(r,t,e){return Math.min(Math.round(r*t),e-1)}function ES(r,t,e,n){return n?Math.max(0,e-1-Math.round(r*t)):Math.min(Math.round(r*t),e-1)}const rv=bd(),KQ=rv&&typeof document<"u",SS={webgl2:!0,webgl1:!0,throwOnError:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function TS(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};ko(rv,`createGLContext only available in the browser.
Create your own headless context or use 'createHeadlessContext' from @luma.gl/test-utils`),r=Object.assign({},SS,r);const{width:t,height:e}=r;function n(o){if(r.throwOnError)throw new Error(o);return console.error(o),null}r.onError=n;let i;const{canvas:s}=r,a=JQ({canvas:s,width:t,height:e,onError:n});return i=XQ(a,r),i?(i=nv(i,r),YQ(i),i):null}function nv(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!r||r._instrumented)return r;r._version=r._version||ZQ(r),r.luma=r.luma||{},r.luma.canvasSizeInfo=r.luma.canvasSizeInfo||{},t=Object.assign({},SS,t);const{manageState:e,debug:n}=t;return e&&xS(r,{copyState:!1,log:function(){for(var i=arguments.length,s=new Array(i),a=0;a<i;a++)s[a]=arguments[a];return Cr.log(1,...s)()}}),rv&&n&&(globalThis.makeDebugContext?(r=globalThis.makeDebugContext(r,t),Cr.level=Math.max(Cr.level,1)):Cr.warn('WebGL debug mode not activated. import "@luma.gl/debug" to enable.')()),r._instrumented=!0,r}function $Q(r){const t=r.getParameter(7936),e=r.getParameter(7937),n=r.getExtension("WEBGL_debug_renderer_info"),i=n&&r.getParameter(n.UNMASKED_VENDOR_WEBGL||7936),s=n&&r.getParameter(n.UNMASKED_RENDERER_WEBGL||7937);return{vendor:i||t,renderer:s||e,vendorMasked:t,rendererMasked:e,version:r.getParameter(7938),shadingLanguageVersion:r.getParameter(35724)}}function WQ(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(r.canvas){const n=jQ(t.useDevicePixels);tz(r,n,t);return}const e=r.getExtension("STACKGL_resize_drawingbuffer");e&&"width"in t&&"height"in t&&e.resize(t.width,t.height)}function XQ(r,t){const{onError:e}=t;let n=null;const i=h=>n=h.statusMessage||n;r.addEventListener("webglcontextcreationerror",i,!1);const{webgl1:s=!0,webgl2:a=!0}=t;let o=null;return a&&(o=o||r.getContext("webgl2",t),o=o||r.getContext("experimental-webgl2",t)),s&&(o=o||r.getContext("webgl",t),o=o||r.getContext("experimental-webgl",t)),r.removeEventListener("webglcontextcreationerror",i,!1),o?(t.onContextLost&&r.addEventListener("webglcontextlost",t.onContextLost,!1),t.onContextRestored&&r.addEventListener("webglcontextrestored",t.onContextRestored,!1),o):e("Failed to create ".concat(a&&!s?"WebGL2":"WebGL"," context: ").concat(n||"Unknown error"))}function JQ(r){let{canvas:t,width:e=800,height:n=600,onError:i}=r,s;return typeof t=="string"?(KQ&&document.readyState==="complete"||i("createGLContext called on canvas '".concat(t,"' before page was loaded")),s=document.getElementById(t)):t?s=t:(s=document.createElement("canvas"),s.id="lumagl-canvas",s.style.width=Number.isFinite(e)?"".concat(e,"px"):"100%",s.style.height=Number.isFinite(n)?"".concat(n,"px"):"100%",document.body.insertBefore(s,document.body.firstChild)),s}function YQ(r){const t=yn(r)?"WebGL2":"WebGL1",e=$Q(r),n=e?"(".concat(e.vendor,",").concat(e.renderer,")"):"",i=r.debug?" debug":"";Cr.info(1,"".concat(t).concat(i," context ").concat(n))()}function ZQ(r){return typeof WebGL2RenderingContext<"u"&&r instanceof WebGL2RenderingContext?2:1}function tz(r,t,e){let n="width"in e?e.width:r.canvas.clientWidth,i="height"in e?e.height:r.canvas.clientHeight;(!n||!i)&&(Cr.log(1,"Canvas clientWidth/clientHeight is 0")(),t=1,n=r.canvas.width||1,i=r.canvas.height||1),r.luma=r.luma||{},r.luma.canvasSizeInfo=r.luma.canvasSizeInfo||{};const s=r.luma.canvasSizeInfo;if(s.clientWidth!==n||s.clientHeight!==i||s.devicePixelRatio!==t){let a=t;const o=Math.floor(n*a),h=Math.floor(i*a);r.canvas.width=o,r.canvas.height=h,(r.drawingBufferWidth!==o||r.drawingBufferHeight!==h)&&(Cr.warn("Device pixel ratio clamped")(),a=Math.min(r.drawingBufferWidth/n,r.drawingBufferHeight/i),r.canvas.width=Math.floor(n*a),r.canvas.height=Math.floor(i*a)),Object.assign(r.luma.canvasSizeInfo,{clientWidth:n,clientHeight:i,devicePixelRatio:t})}}function IS(){let r;if(typeof window<"u"&&window.performance)r=window.performance.now();else if(typeof process<"u"&&process.hrtime){const t=process.hrtime();r=t[0]*1e3+t[1]/1e6}else r=Date.now();return r}let LS=class{constructor(t,e){K(this,"name",void 0),K(this,"type",void 0),K(this,"sampleSize",1),K(this,"time",void 0),K(this,"count",void 0),K(this,"samples",void 0),K(this,"lastTiming",void 0),K(this,"lastSampleTime",void 0),K(this,"lastSampleCount",void 0),K(this,"_count",0),K(this,"_time",0),K(this,"_samples",0),K(this,"_startTime",0),K(this,"_timerPending",!1),this.name=t,this.type=e,this.reset()}setSampleSize(t){return this.sampleSize=t,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(t){return this._count+=t,this._samples++,this._checkSampling(),this}subtractCount(t){return this._count-=t,this._samples++,this._checkSampling(),this}addTime(t){return this._time+=t,this.lastTiming=t,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=IS(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(IS()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}},ez=class{constructor(t){K(this,"id",void 0),K(this,"stats",{}),this.id=t.id,this.stats={},this._initializeStats(t.stats),Object.seal(this)}get(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:t,type:e})}get size(){return Object.keys(this.stats).length}reset(){for(const t in this.stats)this.stats[t].reset();return this}forEach(t){for(const e in this.stats)t(this.stats[e])}getTable(){const t={};return this.forEach(e=>{t[e.name]={time:e.time||0,count:e.count||0,average:e.getAverageTime()||0,hz:e.getHz()||0}}),t}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(e=>this._getOrCreate(e))}_getOrCreate(t){if(!t||!t.name)return null;const{name:e,type:n}=t;return this.stats[e]||(t instanceof LS?this.stats[e]=t:this.stats[e]=new LS(e,n)),this.stats[e]}};function FS(r){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron)return!0;const t=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,e=r||t;return!!(e&&e.indexOf("Electron")>=0)}function MS(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||FS()}const iv=globalThis;function rz(r){if(!r&&!MS())return"Node";if(FS(r))return"Electron";const e=r||(typeof navigator<"u"?navigator:{}).userAgent||"";if(e.indexOf("Edge")>-1)return"Edge";const n=e.indexOf("MSIE ")!==-1,i=e.indexOf("Trident/")!==-1;return n||i?"IE":iv.chrome?"Chrome":iv.safari?"Safari":iv.mozInnerScreenX?"Firefox":"Unknown"}const vp="8.5.21",nz="set luma.log.level=1 (or higher) to trace rendering";class iz{constructor(){this.stats=new Map}get(t){return this.stats.has(t)||this.stats.set(t,new ez({id:t})),this.stats.get(t)}}const fh=new iz;if(globalThis.luma&&globalThis.luma.VERSION!==vp)throw new Error("luma.gl - multiple VERSIONs detected: ".concat(globalThis.luma.VERSION," vs ").concat(vp));globalThis.luma||(MS()&&Cr.log(1,"luma.gl ".concat(vp," - ").concat(nz))(),globalThis.luma=globalThis.luma||{VERSION:vp,version:vp,log:Cr,stats:fh,globals:{modules:{},nodeIO:{}}});function sz(r){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(r):setTimeout(r,1e3/60)}function oz(r){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(r):clearTimeout(r)}function Ar(r,t){if(!r)throw new Error(t||"luma.gl: assertion failed.")}function sv(r,t){if(typeof t!="string")return t;const e=Number(t);if(!isNaN(e))return e;t=t.replace(/^.*\./,"");const n=r[t];return Ar(n!==void 0,"Accessing undefined constant GL.".concat(t)),n}function fu(r,t){t=Number(t);for(const e in r)if(r[e]===t)return"GL.".concat(e);return String(t)}const ov={};function vA(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"id";ov[r]=ov[r]||1;const t=ov[r]++;return"".concat(r,"-").concat(t)}function PS(r){return Ar(typeof r=="number","Input must be a number"),r&&(r&r-1)===0}function Cd(r){let t=!0;for(const e in r){t=!1;break}return t}function US(r,t,e,n){const i="See luma.gl ".concat(e," Upgrade Guide at https://luma.gl/docs/upgrade-guide"),s=Object.getPrototypeOf(r);n.forEach(a=>{s.methodName||(s[a]=()=>{throw Cr.removed("Calling removed method ".concat(t,".").concat(a,": "),i)(),new Error(a)})})}const Ed="Resource subclass must define virtual methods";let bA=class{get[Symbol.toStringTag](){return"Resource"}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};km(t);const{id:n,userData:i={}}=e;this.gl=t,this.gl2=t,this.id=n||vA(this[Symbol.toStringTag]),this.userData=i,this._bound=!1,this._handle=e.handle,this._handle===void 0&&(this._handle=this._createHandle()),this.byteLength=0,this._addStats()}toString(){return"".concat(this[Symbol.toStringTag]||this.constructor.name,"(").concat(this.id,")")}get handle(){return this._handle}delete(){let{deleteChildren:t=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=this._handle&&this._deleteHandle(this._handle);return this._handle&&this._removeStats(),this._handle=null,e&&t&&e.filter(Boolean).forEach(n=>n.delete()),this}bind(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.handle;if(typeof t!="function")return this._bindHandle(t),this;let e;return this._bound?e=t():(this._bindHandle(this.handle),this._bound=!0,e=t(),this._bound=!1,this._bindHandle(null)),e}unbind(){this.bind(null)}getParameter(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};t=sv(this.gl,t),Ar(t);const i=(this.constructor.PARAMETERS||{})[t];if(i){const s=yn(this.gl);if(!((!("webgl2"in i)||s)&&(!("extension"in i)||this.gl.getExtension(i.extension)))){const o=i.webgl1,h="webgl2"in i?i.webgl2:i.webgl1;return s?h:o}}return this._getParameter(t,e)}getParameters(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{parameters:e,keys:n}=t,i=this.constructor.PARAMETERS||{},s=yn(this.gl),a={},o=e||Object.keys(i);for(const h of o){const f=i[h];if(f&&(!("webgl2"in f)||s)&&(!("extension"in f)||this.gl.getExtension(f.extension))){const b=n?fu(this.gl,h):h;a[b]=this.getParameter(h,t),n&&f.type==="GLenum"&&(a[b]=fu(this.gl,a[b]))}}return a}setParameter(t,e){t=sv(this.gl,t),Ar(t);const i=(this.constructor.PARAMETERS||{})[t];if(i){const s=yn(this.gl);if(!((!("webgl2"in i)||s)&&(!("extension"in i)||this.gl.getExtension(i.extension))))throw new Error("Parameter not available on this platform");i.type==="GLenum"&&(e=sv(e))}return this._setParameter(t,e),this}setParameters(t){for(const e in t)this.setParameter(e,t[e]);return this}stubRemovedMethods(t,e,n){return US(this,t,e,n)}initialize(t){}_createHandle(){throw new Error(Ed)}_deleteHandle(){throw new Error(Ed)}_bindHandle(t){throw new Error(Ed)}_getOptsFromHandle(){throw new Error(Ed)}_getParameter(t,e){throw new Error(Ed)}_setParameter(t,e){throw new Error(Ed)}_context(){return this.gl.luma=this.gl.luma||{},this.gl.luma}_addStats(){const t=this[Symbol.toStringTag],e=fh.get("Resource Counts");e.get("Resources Created").incrementCount(),e.get("".concat(t,"s Created")).incrementCount(),e.get("".concat(t,"s Active")).incrementCount()}_removeStats(){const t=this[Symbol.toStringTag];fh.get("Resource Counts").get("".concat(t,"s Active")).decrementCount()}_trackAllocatedMemory(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag];this._trackAllocatedMemoryForContext(t,e),this._trackAllocatedMemoryForContext(t,e,this.gl.canvas&&this.gl.canvas.id),this.byteLength=t}_trackAllocatedMemoryForContext(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag],n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";const i=fh.get("Memory Usage".concat(n));i.get("GPU Memory").addCount(t),i.get("".concat(e," Memory")).addCount(t)}_trackDeallocatedMemory(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag];this._trackDeallocatedMemoryForContext(t),this._trackDeallocatedMemoryForContext(t,this.gl.canvas&&this.gl.canvas.id),this.byteLength=0}_trackDeallocatedMemoryForContext(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const n=fh.get("Memory Usage".concat(e));n.get("GPU Memory").subtractCount(this.byteLength),n.get("".concat(t," Memory")).subtractCount(this.byteLength)}};const az="Failed to deduce GL constant from typed array";function av(r){switch(ArrayBuffer.isView(r)?r.constructor:r){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(az)}}function bp(r){let{clamped:t=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};switch(r){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return t?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function cz(r){let{data:t,width:e,height:n,bytesPerPixel:i=4,temp:s}=r;const a=e*i;s=s||new Uint8Array(a);for(let o=0;o<n/2;++o){const h=o*a,f=(n-o-1)*a;s.set(t.subarray(h,h+a)),t.copyWithin(h,f,f+a),t.set(s,f)}}function lz(r){let{data:t,width:e,height:n}=r;const i=Math.round(e/2),s=Math.round(n/2),a=new Uint8Array(i*s*4);for(let o=0;o<s;o++)for(let h=0;h<i;h++)for(let f=0;f<4;f++)a[(o*i+h)*4+f]=t[(o*2*e+h*2)*4+f];return{data:a,width:i,height:s}}function cv(r,t,e){const{removedProps:n={},deprecatedProps:i={},replacedProps:s={}}=e;for(const o in n)if(o in t){const f=n[o]?"".concat(r,".").concat(n[o]):"N/A";Cr.removed("".concat(r,".").concat(o),f)()}for(const o in i)if(o in t){const h=i[o];Cr.deprecated("".concat(r,".").concat(o),"".concat(r,".").concat(h))()}let a=null;for(const o in s)if(o in t){const h=s[o];Cr.deprecated("".concat(r,".").concat(o),"".concat(r,".").concat(h))(),a=a||Object.assign({},t),a[h]=t[o],delete a[o]}return a||t}const Az={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},uz={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class oa{static getBytesPerElement(t){return bp(t.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(t){return Ar(t.size),bp(t.type||5126).BYTES_PER_ELEMENT*t.size}static resolve(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return new oa(Az,...e)}constructor(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];e.forEach(i=>this._assign(i)),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return oa.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return oa.getBytesPerVertex(this)}_assign(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t=cv("Accessor",t,uz),t.type!==void 0&&(this.type=t.type,(t.type===5124||t.type===5125)&&(this.integer=!0)),t.size!==void 0&&(this.size=t.size),t.offset!==void 0&&(this.offset=t.offset),t.stride!==void 0&&(this.stride=t.stride),t.normalized!==void 0&&(this.normalized=t.normalized),t.integer!==void 0&&(this.integer=t.integer),t.divisor!==void 0&&(this.divisor=t.divisor),t.buffer!==void 0&&(this.buffer=t.buffer),t.index!==void 0&&(typeof t.index=="boolean"?this.index=t.index?1:0:this.index=t.index),t.instanced!==void 0&&(this.divisor=t.instanced?1:0),t.isInstanced!==void 0&&(this.divisor=t.isInstanced?1:0),this}}const RS=10,DS={offset:"accessor.offset",stride:"accessor.stride",type:"accessor.type",size:"accessor.size",divisor:"accessor.divisor",normalized:"accessor.normalized",integer:"accessor.integer",instanced:"accessor.divisor",isInstanced:"accessor.divisor"},hz={removedProps:{},replacedProps:{bytes:"byteLength"},deprecatedProps:DS},dz={removedProps:DS};class ri extends bA{get[Symbol.toStringTag](){return"Buffer"}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(t,e),this.stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),this.target=e.target||(this.gl.webgl2?36662:34962),this.initialize(e),Object.seal(this)}getElementCount(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/oa.getBytesPerElement(t))}getVertexCount(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/oa.getBytesPerVertex(t))}initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return ArrayBuffer.isView(t)&&(t={data:t}),Number.isFinite(t)&&(t={byteLength:t}),t=cv("Buffer",t,hz),this.usage=t.usage||35044,this.debugData=null,this.setAccessor(Object.assign({},t,t.accessor)),t.data?this._setData(t.data,t.offset,t.byteLength):this._setByteLength(t.byteLength||0),this}setProps(t){return t=cv("Buffer",t,dz),"accessor"in t&&this.setAccessor(t.accessor),this}setAccessor(t){return t=Object.assign({},t),delete t.buffer,this.accessor=new oa(t),this}reallocate(t){return t>this.byteLength?(this._setByteLength(t),!0):(this.bytesUsed=t,!1)}setData(t){return this.initialize(t)}subData(t){ArrayBuffer.isView(t)&&(t={data:t});const{data:e,offset:n=0,srcOffset:i=0}=t,s=t.byteLength||t.length;Ar(e);const a=this.gl.webgl2?36663:this.target;return this.gl.bindBuffer(a,this.handle),i!==0||s!==void 0?(Qo(this.gl),this.gl.bufferSubData(this.target,n,e,i,s)):this.gl.bufferSubData(a,n,e),this.gl.bindBuffer(a,null),this.debugData=null,this._inferType(e),this}copyData(t){let{sourceBuffer:e,readOffset:n=0,writeOffset:i=0,size:s}=t;const{gl:a}=this;return Qo(a),a.bindBuffer(36662,e.handle),a.bindBuffer(36663,this.handle),a.copyBufferSubData(36662,36663,n,i,s),a.bindBuffer(36662,null),a.bindBuffer(36663,null),this.debugData=null,this}getData(){let{dstData:t=null,srcByteOffset:e=0,dstOffset:n=0,length:i=0}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Qo(this.gl);const s=bp(this.accessor.type||5126,{clamped:!1}),a=this._getAvailableElementCount(e),o=n;let h,f;t?(f=t.length,h=f-o):(h=Math.min(a,i||a),f=o+h);const g=Math.min(a,h);return i=i||g,Ar(i<=g),t=t||new s(f),this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,e,t,n,i),this.gl.bindBuffer(36662,null),t}bind(){let{target:t=this.target,index:e=this.accessor&&this.accessor.index,offset:n=0,size:i}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t===35345||t===35982?i!==void 0?this.gl.bindBufferRange(t,e,this.handle,n,i):(Ar(n===0),this.gl.bindBufferBase(t,e,this.handle)):this.gl.bindBuffer(t,this.handle),this}unbind(){let{target:t=this.target,index:e=this.accessor&&this.accessor.index}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t===35345||t===35982?this.gl.bindBufferBase(t,e,null):this.gl.bindBuffer(t,null),this}getDebugData(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:Math.min(RS,this.byteLength)}),{data:this.debugData,changed:!0})}invalidateDebugData(){this.debugData=null}_setData(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:t.byteLength+e;Ar(ArrayBuffer.isView(t)),this._trackDeallocatedMemory();const i=this._getTarget();this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,n,this.usage),this.gl.bufferSubData(i,e,t),this.gl.bindBuffer(i,null),this.debugData=t.slice(0,RS),this.bytesUsed=n,this._trackAllocatedMemory(n);const s=av(t);return Ar(s),this.setAccessor(new oa(this.accessor,{type:s})),this}_setByteLength(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.usage;Ar(t>=0),this._trackDeallocatedMemory();let n=t;t===0&&(n=new Float32Array(0));const i=this._getTarget();return this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,n,e),this.gl.bindBuffer(i,null),this.usage=e,this.debugData=null,this.bytesUsed=t,this._trackAllocatedMemory(t),this}_getTarget(){return this.gl.webgl2?36663:this.target}_getAvailableElementCount(t){const e=bp(this.accessor.type||5126,{clamped:!1}),n=t/e.BYTES_PER_ELEMENT;return this.getElementCount()-n}_inferType(t){this.accessor.type||this.setAccessor(new oa(this.accessor,{type:av(t)}))}_createHandle(){return this.gl.createBuffer()}_deleteHandle(){this.gl.deleteBuffer(this.handle),this._trackDeallocatedMemory()}_getParameter(t){this.gl.bindBuffer(this.target,this.handle);const e=this.gl.getBufferParameter(this.target,t);return this.gl.bindBuffer(this.target,null),e}get type(){return Cr.deprecated("Buffer.type","Buffer.accessor.type")(),this.accessor.type}get bytes(){return Cr.deprecated("Buffer.bytes","Buffer.byteLength")(),this.byteLength}setByteLength(t){return Cr.deprecated("setByteLength","reallocate")(),this.reallocate(t)}updateAccessor(t){return Cr.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)")(),this.accessor=new oa(this.accessor,t),this}}const lv={6407:{dataFormat:6407,types:[5121,33635]},6408:{dataFormat:6408,types:[5121,32819,32820]},6406:{dataFormat:6406,types:[5121]},6409:{dataFormat:6409,types:[5121]},6410:{dataFormat:6410,types:[5121]},33326:{dataFormat:6403,types:[5126],gl2:!0},33328:{dataFormat:33319,types:[5126],gl2:!0},34837:{dataFormat:6407,types:[5126],gl2:!0},34836:{dataFormat:6408,types:[5126],gl2:!0}},OS={6403:1,36244:1,33319:2,33320:2,6407:3,36248:3,6408:4,36249:4,6402:1,34041:1,6406:1,6409:1,6410:2},NS={5126:4,5125:4,5124:4,5123:2,5122:2,5131:2,5120:1,5121:1};function fz(r,t){const e=lv[t];if(!e)return!1;if(e.gl1===void 0&&e.gl2===void 0)return!0;const n=yn(r)&&e.gl2||e.gl1;return typeof n=="string"?r.getExtension(n):n}function pz(r,t){const e=lv[t];switch(e&&e.types[0]){case 5126:return r.getExtension("OES_texture_float_linear");case 5131:return r.getExtension("OES_texture_half_float_linear");default:return!0}}const gz=[9729,9728],kS=globalThis.WebGLBuffer||function(){};class Sd extends bA{get[Symbol.toStringTag](){return"Texture"}static isSupported(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{format:n,linearFiltering:i}=e;let s=!0;return n&&(s=s&&fz(t,n),s=s&&(!i||pz(t,n))),s}constructor(t,e){const{id:n=vA("texture"),handle:i,target:s}=e;super(t,{id:n,handle:i}),this.target=s,this.textureUnit=void 0,this.loaded=!1,this.width=void 0,this.height=void 0,this.depth=void 0,this.format=void 0,this.type=void 0,this.dataFormat=void 0,this.border=void 0,this.textureUnit=void 0,this.mipmaps=void 0}toString(){return"Texture(".concat(this.id,",").concat(this.width,"x").concat(this.height,")")}initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=t.data;if(e instanceof Promise)return e.then(j=>this.initialize(Object.assign({},t,{pixels:j,data:j}))),this;const n=typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement;if(n&&e.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,e.addEventListener("loadeddata",()=>this.initialize(t)),this;const{pixels:i=null,format:s=6408,border:a=0,recreate:o=!1,parameters:h={},pixelStore:f={},textureUnit:g=void 0}=t;e||(e=i);let{width:b,height:C,dataFormat:B,type:R,compressed:D=!1,mipmaps:Q=!0}=t;const{depth:k=0}=t;return{width:b,height:C,compressed:D,dataFormat:B,type:R}=this._deduceParameters({format:s,type:R,dataFormat:B,compressed:D,data:e,width:b,height:C}),this.width=b,this.height=C,this.depth=k,this.format=s,this.type=R,this.dataFormat=B,this.border=a,this.textureUnit=g,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),Q&&this._isNPOT()&&(Cr.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),Q=!1,this._updateForNPOT(h)),this.mipmaps=Q,this.setImageData({data:e,width:b,height:C,depth:k,format:s,type:R,dataFormat:B,border:a,mipmaps:Q,parameters:f,compressed:D}),Q&&this.generateMipmap(),this.setParameters(h),o&&(this.data=e),n&&(this._video={video:e,parameters:h,lastTime:e.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?e.currentTime:-1}),this}update(){if(this._video){const{video:t,parameters:e,lastTime:n}=this._video;if(n===t.currentTime||t.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:t,parameters:e}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=t.currentTime}}resize(t){let{height:e,width:n,mipmaps:i=!1}=t;return n!==this.width||e!==this.height?this.initialize({width:n,height:e,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:i}):this}generateMipmap(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isNPOT()?(Cr.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),this):(this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),Ic(this.gl,t,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this)}setImageData(t){this._trackDeallocatedMemory("Texture");const{target:e=this.target,pixels:n=null,level:i=0,format:s=this.format,border:a=this.border,offset:o=0,parameters:h={}}=t;let{data:f=null,type:g=this.type,width:b=this.width,height:C=this.height,dataFormat:B=this.dataFormat,compressed:R=!1}=t;f||(f=n),{type:g,dataFormat:B,compressed:R,width:b,height:C}=this._deduceParameters({format:s,type:g,dataFormat:B,compressed:R,data:f,width:b,height:C});const{gl:D}=this;D.bindTexture(this.target,this.handle);let Q=null;({data:f,dataType:Q}=this._getDataType({data:f,compressed:R}));let k,j=0;if(Ic(this.gl,h,()=>{switch(Q){case"null":D.texImage2D(e,i,s,b,C,a,B,g,f);break;case"typed-array":D.texImage2D(e,i,s,b,C,a,B,g,f,o);break;case"buffer":k=Qo(D),k.bindBuffer(35052,f.handle||f),k.texImage2D(e,i,s,b,C,a,B,g,o),k.bindBuffer(35052,null);break;case"browser-object":yn(D)?D.texImage2D(e,i,s,b,C,a,B,g,f):D.texImage2D(e,i,s,B,g,f);break;case"compressed":for(const[et,st]of f.entries())D.compressedTexImage2D(e,et,st.format,st.width,st.height,a,st.data),j+=st.levelSize;break;default:Ar(!1,"Unknown image data type")}}),Q==="compressed")this._trackAllocatedMemory(j,"Texture");else if(f&&f.byteLength)this._trackAllocatedMemory(f.byteLength,"Texture");else{const et=OS[this.dataFormat]||4,st=NS[this.type]||1;this._trackAllocatedMemory(this.width*this.height*et*st,"Texture")}return this.loaded=!0,this}setSubImageData(t){let{target:e=this.target,pixels:n=null,data:i=null,x:s=0,y:a=0,width:o=this.width,height:h=this.height,level:f=0,format:g=this.format,type:b=this.type,dataFormat:C=this.dataFormat,compressed:B=!1,offset:R=0,border:D=this.border,parameters:Q={}}=t;if({type:b,dataFormat:C,compressed:B,width:o,height:h}=this._deduceParameters({format:g,type:b,dataFormat:C,compressed:B,data:i,width:o,height:h}),Ar(this.depth===0,"texSubImage not supported for 3D textures"),i||(i=n),i&&i.data){const k=i;i=k.data,o=k.shape[0],h=k.shape[1]}i instanceof ri&&(i=i.handle),this.gl.bindTexture(this.target,this.handle),Ic(this.gl,Q,()=>{if(B)this.gl.compressedTexSubImage2D(e,f,s,a,o,h,g,i);else if(i===null)this.gl.texSubImage2D(e,f,s,a,o,h,C,b,null);else if(ArrayBuffer.isView(i))this.gl.texSubImage2D(e,f,s,a,o,h,C,b,i,R);else if(i instanceof kS){const k=Qo(this.gl);k.bindBuffer(35052,i),k.texSubImage2D(e,f,s,a,o,h,C,b,R),k.bindBuffer(35052,null)}else yn(this.gl)?Qo(this.gl).texSubImage2D(e,f,s,a,o,h,C,b,i):this.gl.texSubImage2D(e,f,s,a,C,b,i)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(){return Cr.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:e}=this;return t!==void 0&&(this.textureUnit=t,e.activeTexture(33984+t)),e.bindTexture(this.target,this.handle),t}unbind(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:e}=this;return t!==void 0&&(this.textureUnit=t,e.activeTexture(33984+t)),e.bindTexture(this.target,null),t}_getDataType(t){let{data:e,compressed:n=!1}=t;return n?{data:e,dataType:"compressed"}:e===null?{data:e,dataType:"null"}:ArrayBuffer.isView(e)?{data:e,dataType:"typed-array"}:e instanceof ri?{data:e.handle,dataType:"buffer"}:e instanceof kS?{data:e,dataType:"buffer"}:{data:e,dataType:"browser-object"}}_deduceParameters(t){const{format:e,data:n}=t;let{width:i,height:s,dataFormat:a,type:o,compressed:h}=t;const f=lv[e];return a=a||f&&f.dataFormat,o=o||f&&f.types[0],h=h||f&&f.compressed,{width:i,height:s}=this._deduceImageSize(n,i,s),{dataFormat:a,type:o,compressed:h,width:i,height:s,format:e,data:n}}_deduceImageSize(t,e,n){let i;return typeof ImageData<"u"&&t instanceof ImageData?i={width:t.width,height:t.height}:typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement?i={width:t.naturalWidth,height:t.naturalHeight}:typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement?i={width:t.width,height:t.height}:typeof ImageBitmap<"u"&&t instanceof ImageBitmap?i={width:t.width,height:t.height}:typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement?i={width:t.videoWidth,height:t.videoHeight}:t?i={width:e,height:n}:i={width:e>=0?e:1,height:n>=0?n:1},Ar(i,"Could not deduced texture size"),Ar(e===void 0||i.width===e,"Deduced texture width does not match supplied width"),Ar(n===void 0||i.height===n,"Deduced texture height does not match supplied height"),i}_createHandle(){return this.gl.createTexture()}_deleteHandle(){this.gl.deleteTexture(this.handle),this._trackDeallocatedMemory("Texture")}_getParameter(t){switch(t){case 4096:return this.width;case 4097:return this.height;default:this.gl.bindTexture(this.target,this.handle);const e=this.gl.getTexParameter(this.target,t);return this.gl.bindTexture(this.target,null),e}}_setParameter(t,e){switch(this.gl.bindTexture(this.target,this.handle),e=this._getNPOTParam(t,e),t){case 33082:case 33083:this.gl.texParameterf(this.handle,t,e);break;case 4096:case 4097:Ar(!1);break;default:this.gl.texParameteri(this.target,t,e);break}return this.gl.bindTexture(this.target,null),this}_isNPOT(){return yn(this.gl)||!this.width||!this.height?!1:!PS(this.width)||!PS(this.height)}_updateForNPOT(t){t[this.gl.TEXTURE_MIN_FILTER]===void 0&&(t[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),t[this.gl.TEXTURE_WRAP_S]===void 0&&(t[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),t[this.gl.TEXTURE_WRAP_T]===void 0&&(t[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}_getNPOTParam(t,e){if(this._isNPOT())switch(t){case 10241:gz.indexOf(e)===-1&&(e=9729);break;case 10242:case 10243:e!==33071&&(e=33071);break}return e}}let mz="";function yz(r,t){return Ar(typeof r=="string"),r=mz+r,new Promise((e,n)=>{try{const i=new Image;i.onload=()=>e(i),i.onerror=()=>n(new Error("Could not load image ".concat(r,"."))),i.crossOrigin=t&&t.crossOrigin||"anonymous",i.src=r}catch(i){n(i)}})}class La extends Sd{get[Symbol.toStringTag](){return"Texture2D"}static isSupported(t,e){return Sd.isSupported(t,e)}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};km(t),(e instanceof Promise||typeof e=="string")&&(e={data:e}),typeof e.data=="string"&&(e=Object.assign({},e,{data:yz(e.data)})),super(t,Object.assign({},e,{target:3553})),this.initialize(e),Object.seal(this)}}const Av=[34069,34070,34071,34072,34073,34074];class QS extends Sd{get[Symbol.toStringTag](){return"TextureCube"}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};km(t),super(t,Object.assign({},e,{target:34067})),this.initialize(e),Object.seal(this)}initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{mipmaps:e=!0,parameters:n={}}=t;return this.opts=t,this.setCubeMapImageData(t).then(()=>{this.loaded=!0,e&&this.generateMipmap(t),this.setParameters(n)}),this}subImage(t){let{face:e,data:n,x:i=0,y:s=0,mipmapLevel:a=0}=t;return this._subImage({target:e,data:n,x:i,y:s,mipmapLevel:a})}async setCubeMapImageData(t){let{width:e,height:n,pixels:i,data:s,border:a=0,format:o=6408,type:h=5121}=t;const{gl:f}=this,g=i||s,b=await Promise.all(Av.map(C=>{const B=g[C];return Promise.all(Array.isArray(B)?B:[B])}));this.bind(),Av.forEach((C,B)=>{b[B].length>1&&this.opts.mipmaps!==!1&&Cr.warn("".concat(this.id," has mipmap and multiple LODs."))(),b[B].forEach((R,D)=>{e&&n?f.texImage2D(C,D,o,e,n,a,o,h,R):f.texImage2D(C,D,o,o,h,R)})}),this.unbind()}setImageDataForFace(t){const{face:e,width:n,height:i,pixels:s,data:a,border:o=0,format:h=6408,type:f=5121}=t,{gl:g}=this,b=s||a;return this.bind(),b instanceof Promise?b.then(C=>this.setImageDataForFace(Object.assign({},t,{face:e,data:C,pixels:C}))):this.width||this.height?g.texImage2D(e,0,h,n,i,o,h,f,b):g.texImage2D(e,0,h,h,f,b),this}}QS.FACES=Av;class _z extends Sd{get[Symbol.toStringTag](){return"Texture3D"}static isSupported(t){return yn(t)}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Qo(t),e=Object.assign({depth:1},e,{target:32879,unpackFlipY:!1}),super(t,e),this.initialize(e),Object.seal(this)}setImageData(t){let{level:e=0,dataFormat:n=6408,width:i,height:s,depth:a=1,border:o=0,format:h,type:f=5121,offset:g=0,data:b,parameters:C={}}=t;if(this._trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle),Ic(this.gl,C,()=>{ArrayBuffer.isView(b)&&this.gl.texImage3D(this.target,e,n,i,s,a,o,h,f,b),b instanceof ri&&(this.gl.bindBuffer(35052,b.handle),this.gl.texImage3D(this.target,e,n,i,s,a,o,h,f,g))}),b&&b.byteLength)this._trackAllocatedMemory(b.byteLength,"Texture");else{const B=OS[this.dataFormat]||4,R=NS[this.type]||1;this._trackAllocatedMemory(this.width*this.height*this.depth*B*R,"Texture")}return this.loaded=!0,this}}const ph="EXT_color_buffer_float",zS={33189:{bpp:2},33190:{gl2:!0,bpp:3},36012:{gl2:!0,bpp:4},36168:{bpp:1},34041:{bpp:4},35056:{gl2:!0,bpp:4},36013:{gl2:!0,bpp:5},32854:{bpp:2},36194:{bpp:2},32855:{bpp:2},33321:{gl2:!0,bpp:1},33330:{gl2:!0,bpp:1},33329:{gl2:!0,bpp:1},33332:{gl2:!0,bpp:2},33331:{gl2:!0,bpp:2},33334:{gl2:!0,bpp:4},33333:{gl2:!0,bpp:4},33323:{gl2:!0,bpp:2},33336:{gl2:!0,bpp:2},33335:{gl2:!0,bpp:2},33338:{gl2:!0,bpp:4},33337:{gl2:!0,bpp:4},33340:{gl2:!0,bpp:8},33339:{gl2:!0,bpp:8},32849:{gl2:!0,bpp:3},32856:{gl2:!0,bpp:4},32857:{gl2:!0,bpp:4},36220:{gl2:!0,bpp:4},36238:{gl2:!0,bpp:4},36975:{gl2:!0,bpp:4},36214:{gl2:!0,bpp:8},36232:{gl2:!0,bpp:8},36226:{gl2:!0,bpp:16},36208:{gl2:!0,bpp:16},33325:{gl2:ph,bpp:2},33327:{gl2:ph,bpp:4},34842:{gl2:ph,bpp:8},33326:{gl2:ph,bpp:4},33328:{gl2:ph,bpp:8},34836:{gl2:ph,bpp:16},35898:{gl2:ph,bpp:4}};function vz(r,t,e){const n=e[t];if(!n)return!1;const i=yn(r)&&n.gl2||n.gl1;return typeof i=="string"?r.getExtension(i):i}class Td extends bA{get[Symbol.toStringTag](){return"Renderbuffer"}static isSupported(t){let{format:e}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{format:null};return!e||vz(t,e,zS)}static getSamplesForFormat(t,e){let{format:n}=e;return t.getInternalformatParameter(36161,n,32937)}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(t,e),this.initialize(e),Object.seal(this)}initialize(t){let{format:e,width:n=1,height:i=1,samples:s=0}=t;return Ar(e,"Needs format"),this._trackDeallocatedMemory(),this.gl.bindRenderbuffer(36161,this.handle),s!==0&&yn(this.gl)?this.gl.renderbufferStorageMultisample(36161,s,e,n,i):this.gl.renderbufferStorage(36161,e,n,i),this.format=e,this.width=n,this.height=i,this.samples=s,this._trackAllocatedMemory(this.width*this.height*(this.samples||1)*zS[this.format].bpp),this}resize(t){let{width:e,height:n}=t;return e!==this.width||n!==this.height?this.initialize({width:e,height:n,format:this.format,samples:this.samples}):this}_createHandle(){return this.gl.createRenderbuffer()}_deleteHandle(){this.gl.deleteRenderbuffer(this.handle),this._trackDeallocatedMemory()}_bindHandle(t){this.gl.bindRenderbuffer(36161,t)}_syncHandle(t){this.format=this.getParameter(36164),this.width=this.getParameter(36162),this.height=this.getParameter(36163),this.samples=this.getParameter(36011)}_getParameter(t){return this.gl.bindRenderbuffer(36161,this.handle),this.gl.getRenderbufferParameter(36161,t)}}const bz=256,wz=1024,xz=16384,HS=6144,GS=6145,VS=6146,jS=34041,qS="clear: bad arguments";function uv(r){let{framebuffer:t=null,color:e=null,depth:n=null,stencil:i=null}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s={};t&&(s.framebuffer=t);let a=0;e&&(a|=xz,e!==!0&&(s.clearColor=e)),n&&(a|=bz,n!==!0&&(s.clearDepth=n)),i&&(a|=wz,n!==!0&&(s.clearStencil=n)),Ar(a!==0,qS),Ic(r,s,()=>{r.clear(a)})}function Bz(r){let{framebuffer:t=null,buffer:e=HS,drawBuffer:n=0,value:i=[0,0,0,0]}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Qo(r),Ic(r,{framebuffer:t},()=>{switch(e){case HS:switch(i.constructor){case Int32Array:r.clearBufferiv(e,n,i);break;case Uint32Array:r.clearBufferuiv(e,n,i);break;case Float32Array:default:r.clearBufferfv(e,n,i)}break;case GS:r.clearBufferfv(GS,0,[i]);break;case VS:r.clearBufferiv(VS,0,[i]);break;case jS:const[s,a]=i;r.clearBufferfi(jS,0,s,a);break;default:Ar(!1,qS)}})}function Cz(r){switch(r){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return Ar(!1),0}}function Qm(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{sourceX:e=0,sourceY:n=0,sourceFormat:i=6408}=t;let{sourceAttachment:s=36064,target:a=null,sourceWidth:o,sourceHeight:h,sourceType:f}=t;const{framebuffer:g,deleteFramebuffer:b}=Ez(r);Ar(g);const{gl:C,handle:B,attachments:R}=g;o=o||g.width,h=h||g.height,s===36064&&B===null&&(s=1028),Ar(R[s]),f=f||R[s].type,a=Sz(a,f,i,o,h),f=f||av(a);const D=C.bindFramebuffer(36160,B);return C.readPixels(e,n,o,h,i,f,a),C.bindFramebuffer(36160,D||null),b&&g.delete(),a}function KS(r){let{sourceAttachment:t=36064,targetMaxHeight:e=Number.MAX_SAFE_INTEGER}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=Qm(r,{sourceAttachment:t}),{width:i,height:s}=r;for(;s>e;)({data:n,width:i,height:s}=lz({data:n,width:i,height:s}));cz({data:n,width:i,height:s});const a=document.createElement("canvas");a.width=i,a.height=s;const o=a.getContext("2d"),h=o.createImageData(i,s);return h.data.set(n),o.putImageData(h,0,0),a.toDataURL()}function Ez(r){return r instanceof vs?{framebuffer:r,deleteFramebuffer:!1}:{framebuffer:Dz(r),deleteFramebuffer:!0}}function Sz(r,t,e,n,i){if(r)return r;t=t||5121;const s=bp(t,{clamped:!1}),a=Cz(e);return new s(n*i*a)}const gi={WEBGL2:"WEBGL2",VERTEX_ARRAY_OBJECT:"VERTEX_ARRAY_OBJECT",TIMER_QUERY:"TIMER_QUERY",INSTANCED_RENDERING:"INSTANCED_RENDERING",MULTIPLE_RENDER_TARGETS:"MULTIPLE_RENDER_TARGETS",ELEMENT_INDEX_UINT32:"ELEMENT_INDEX_UINT32",BLEND_EQUATION_MINMAX:"BLEND_EQUATION_MINMAX",FLOAT_BLEND:"FLOAT_BLEND",COLOR_ENCODING_SRGB:"COLOR_ENCODING_SRGB",TEXTURE_DEPTH:"TEXTURE_DEPTH",TEXTURE_FLOAT:"TEXTURE_FLOAT",TEXTURE_HALF_FLOAT:"TEXTURE_HALF_FLOAT",TEXTURE_FILTER_LINEAR_FLOAT:"TEXTURE_FILTER_LINEAR_FLOAT",TEXTURE_FILTER_LINEAR_HALF_FLOAT:"TEXTURE_FILTER_LINEAR_HALF_FLOAT",TEXTURE_FILTER_ANISOTROPIC:"TEXTURE_FILTER_ANISOTROPIC",COLOR_ATTACHMENT_RGBA32F:"COLOR_ATTACHMENT_RGBA32F",COLOR_ATTACHMENT_FLOAT:"COLOR_ATTACHMENT_FLOAT",COLOR_ATTACHMENT_HALF_FLOAT:"COLOR_ATTACHMENT_HALF_FLOAT",GLSL_FRAG_DATA:"GLSL_FRAG_DATA",GLSL_FRAG_DEPTH:"GLSL_FRAG_DEPTH",GLSL_DERIVATIVES:"GLSL_DERIVATIVES",GLSL_TEXTURE_LOD:"GLSL_TEXTURE_LOD"};function Tz(r){const t=new La(r,{format:6408,type:5126,dataFormat:6408}),e=new vs(r,{id:"test-framebuffer",check:!1,attachments:{36064:t}}),n=e.getStatus();return t.delete(),e.delete(),n===36053}const $S={[gi.WEBGL2]:[!1,!0],[gi.VERTEX_ARRAY_OBJECT]:["OES_vertex_array_object",!0],[gi.TIMER_QUERY]:["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"],[gi.INSTANCED_RENDERING]:["ANGLE_instanced_arrays",!0],[gi.MULTIPLE_RENDER_TARGETS]:["WEBGL_draw_buffers",!0],[gi.ELEMENT_INDEX_UINT32]:["OES_element_index_uint",!0],[gi.BLEND_EQUATION_MINMAX]:["EXT_blend_minmax",!0],[gi.FLOAT_BLEND]:["EXT_float_blend"],[gi.COLOR_ENCODING_SRGB]:["EXT_sRGB",!0],[gi.TEXTURE_DEPTH]:["WEBGL_depth_texture",!0],[gi.TEXTURE_FLOAT]:["OES_texture_float",!0],[gi.TEXTURE_HALF_FLOAT]:["OES_texture_half_float",!0],[gi.TEXTURE_FILTER_LINEAR_FLOAT]:["OES_texture_float_linear"],[gi.TEXTURE_FILTER_LINEAR_HALF_FLOAT]:["OES_texture_half_float_linear"],[gi.TEXTURE_FILTER_ANISOTROPIC]:["EXT_texture_filter_anisotropic"],[gi.COLOR_ATTACHMENT_RGBA32F]:[Tz,"EXT_color_buffer_float"],[gi.COLOR_ATTACHMENT_FLOAT]:[!1,"EXT_color_buffer_float"],[gi.COLOR_ATTACHMENT_HALF_FLOAT]:["EXT_color_buffer_half_float"],[gi.GLSL_FRAG_DATA]:["WEBGL_draw_buffers",!0],[gi.GLSL_FRAG_DEPTH]:["EXT_frag_depth",!0],[gi.GLSL_DERIVATIVES]:["OES_standard_derivatives",!0],[gi.GLSL_TEXTURE_LOD]:["EXT_shader_texture_lod",!0]},Iz=2;function hv(r,t){return WS(r,t)}function WS(r,t){return t=Array.isArray(t)?t:[t],t.every(e=>XS(r,e))}function Lz(r){r.luma=r.luma||{},r.luma.caps=r.luma.caps||{};for(const t in $S)r.luma.caps[t]===void 0&&(r.luma.caps[t]=XS(r,t));return r.luma.caps}function XS(r,t){return r.luma=r.luma||{},r.luma.caps=r.luma.caps||{},r.luma.caps[t]===void 0&&(r.luma.caps[t]=Fz(r,t)),r.luma.caps[t]||Cr.log(Iz,"Feature: ".concat(t," not supported"))(),r.luma.caps[t]}function Fz(r,t){const e=$S[t];Ar(e,t);let n;const i=yn(r)&&e[1]||e[0];if(typeof i=="function")n=i(r);else if(Array.isArray(i)){n=!0;for(const s of i)n=n&&!!r.getExtension(s)}else typeof i=="string"?n=!!r.getExtension(i):typeof i=="boolean"?n=i:Ar(!1);return n}const JS="Multiple render targets not supported";class vs extends bA{get[Symbol.toStringTag](){return"Framebuffer"}static isSupported(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{colorBufferFloat:n,colorBufferHalfFloat:i}=e;let s=!0;return n&&(s=!!(t.getExtension("EXT_color_buffer_float")||t.getExtension("WEBGL_color_buffer_float")||t.getExtension("OES_texture_float"))),i&&(s=s&&!!(t.getExtension("EXT_color_buffer_float")||t.getExtension("EXT_color_buffer_half_float"))),s}static getDefaultFramebuffer(t){return t.luma=t.luma||{},t.luma.defaultFramebuffer=t.luma.defaultFramebuffer||new vs(t,{id:"default-framebuffer",handle:null,attachments:{}}),t.luma.defaultFramebuffer}get MAX_COLOR_ATTACHMENTS(){const t=Qo(this.gl);return t.getParameter(t.MAX_COLOR_ATTACHMENTS)}get MAX_DRAW_BUFFERS(){const t=Qo(this.gl);return t.getParameter(t.MAX_DRAW_BUFFERS)}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(t,e),this.width=null,this.height=null,this.attachments={},this.readBuffer=36064,this.drawBuffers=[36064],this.ownResources=[],this.initialize(e),Object.seal(this)}get color(){return this.attachments[36064]||null}get texture(){return this.attachments[36064]||null}get depth(){return this.attachments[36096]||this.attachments[33306]||null}get stencil(){return this.attachments[36128]||this.attachments[33306]||null}initialize(t){let{width:e=1,height:n=1,attachments:i=null,color:s=!0,depth:a=!0,stencil:o=!1,check:h=!0,readBuffer:f=void 0,drawBuffers:g=void 0}=t;if(Ar(e>=0&&n>=0,"Width and height need to be integers"),this.width=e,this.height=n,i)for(const b in i){const C=i[b];(Array.isArray(C)?C[0]:C).resize({width:e,height:n})}else i=this._createDefaultAttachments(s,a,o,e,n);this.update({clearAttachments:!0,attachments:i,readBuffer:f,drawBuffers:g}),i&&h&&this.checkStatus()}delete(){for(const t of this.ownResources)t.delete();return super.delete(),this}update(t){let{attachments:e={},readBuffer:n,drawBuffers:i,clearAttachments:s=!1,resizeAttachments:a=!0}=t;this.attach(e,{clearAttachments:s,resizeAttachments:a});const{gl:o}=this,h=o.bindFramebuffer(36160,this.handle);return n&&this._setReadBuffer(n),i&&this._setDrawBuffers(i),o.bindFramebuffer(36160,h||null),this}resize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{width:e,height:n}=t;if(this.handle===null)return Ar(e===void 0&&n===void 0),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;e===void 0&&(e=this.gl.drawingBufferWidth),n===void 0&&(n=this.gl.drawingBufferHeight),e!==this.width&&n!==this.height&&Cr.log(2,"Resizing framebuffer ".concat(this.id," to ").concat(e,"x").concat(n))();for(const i in this.attachments)this.attachments[i].resize({width:e,height:n});return this.width=e,this.height=n,this}attach(t){let{clearAttachments:e=!1,resizeAttachments:n=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i={};e&&Object.keys(this.attachments).forEach(a=>{i[a]=null}),Object.assign(i,t);const s=this.gl.bindFramebuffer(36160,this.handle);for(const a in i){Ar(a!==void 0,"Misspelled framebuffer binding point?");const o=Number(a),h=i[o];let f=h;if(!f)this._unattach(o);else if(f instanceof Td)this._attachRenderbuffer({attachment:o,renderbuffer:f});else if(Array.isArray(h)){const[g,b=0,C=0]=h;f=g,this._attachTexture({attachment:o,texture:g,layer:b,level:C})}else this._attachTexture({attachment:o,texture:f,layer:0,level:0});n&&f&&f.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(36160,s||null),Object.assign(this.attachments,t),Object.keys(this.attachments).filter(a=>!this.attachments[a]).forEach(a=>{delete this.attachments[a]})}checkStatus(){const t=this.getStatus();if(t!==36053)throw new Error(Pz(t));return this}getStatus(){const{gl:t}=this,e=t.bindFramebuffer(36160,this.handle),n=t.checkFramebufferStatus(36160);return t.bindFramebuffer(36160,e||null),n}clear(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{color:e,depth:n,stencil:i,drawBuffers:s=[]}=t,a=this.gl.bindFramebuffer(36160,this.handle);return(e||n||i)&&uv(this.gl,{color:e,depth:n,stencil:i}),s.forEach((o,h)=>{Bz(this.gl,{drawBuffer:h,value:o})}),this.gl.bindFramebuffer(36160,a||null),this}readPixels(){return Cr.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")(),null}readPixelsToBuffer(){return Cr.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")(),null}copyToDataUrl(){return Cr.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")(),null}copyToImage(){return Cr.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")(),null}copyToTexture(){return Cr.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}blit(){return Cr.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")(),null}invalidate(t){let{attachments:e=[],x:n=0,y:i=0,width:s,height:a}=t;const o=Qo(this.gl),h=o.bindFramebuffer(36008,this.handle);return n===0&&i===0&&s===void 0&&a===void 0?o.invalidateFramebuffer(36008,e):o.invalidateFramebuffer(36008,e,n,i,s,a),o.bindFramebuffer(36008,h),this}getAttachmentParameter(t,e,n){let i=this._getAttachmentParameterFallback(e);return i===null&&(this.gl.bindFramebuffer(36160,this.handle),i=this.gl.getFramebufferAttachmentParameter(36160,t,e),this.gl.bindFramebuffer(36160,null)),n&&i>1e3&&(i=fu(this.gl,i)),i}getAttachmentParameters(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:36064,e=arguments.length>1?arguments[1]:void 0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.constructor.ATTACHMENT_PARAMETERS||[];const i={};for(const s of n){const a=e?fu(this.gl,s):s;i[a]=this.getAttachmentParameter(t,s,e)}return i}getParameters(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;const e=Object.keys(this.attachments),n={};for(const i of e){const s=Number(i),a=t?fu(this.gl,s):s;n[a]=this.getAttachmentParameters(s,t)}return n}show(){return typeof window<"u"&&window.open(KS(this),"luma-debug-texture"),this}log(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(t>Cr.level||typeof window>"u")return this;e=e||"Framebuffer ".concat(this.id);const n=KS(this,{targetMaxHeight:100});return Cr.image({logLevel:t,message:e,image:n},e)(),this}bind(){let{target:t=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(t,this.handle),this}unbind(){let{target:t=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(t,null),this}_createDefaultAttachments(t,e,n,i,s){let a=null;return t&&(a=a||{},a[36064]=new La(this.gl,{id:"".concat(this.id,"-color0"),pixels:null,format:6408,type:5121,width:i,height:s,mipmaps:!1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.ownResources.push(a[36064])),e&&n?(a=a||{},a[33306]=new Td(this.gl,{id:"".concat(this.id,"-depth-stencil"),format:35056,width:i,height:111}),this.ownResources.push(a[33306])):e?(a=a||{},a[36096]=new Td(this.gl,{id:"".concat(this.id,"-depth"),format:33189,width:i,height:s}),this.ownResources.push(a[36096])):n&&Ar(!1),a}_unattach(t){const e=this.attachments[t];e&&(e instanceof Td?this.gl.framebufferRenderbuffer(36160,t,36161,null):this.gl.framebufferTexture2D(36160,t,3553,null,0),delete this.attachments[t])}_attachRenderbuffer(t){let{attachment:e=36064,renderbuffer:n}=t;const{gl:i}=this;i.framebufferRenderbuffer(36160,e,36161,n.handle),this.attachments[e]=n}_attachTexture(t){let{attachment:e=36064,texture:n,layer:i,level:s}=t;const{gl:a}=this;switch(a.bindTexture(n.target,n.handle),n.target){case 35866:case 32879:Qo(a).framebufferTextureLayer(36160,e,n.target,s,i);break;case 34067:const h=Mz(i);a.framebufferTexture2D(36160,e,h,n.handle,s);break;case 3553:a.framebufferTexture2D(36160,e,3553,n.handle,s);break;default:Ar(!1,"Illegal texture type")}a.bindTexture(n.target,null),this.attachments[e]=n}_setReadBuffer(t){const e=oQ(this.gl);e?e.readBuffer(t):Ar(t===36064||t===1029,JS),this.readBuffer=t}_setDrawBuffers(t){const{gl:e}=this,n=Qo(e);if(n)n.drawBuffers(t);else{const i=e.getExtension("WEBGL_draw_buffers");i?i.drawBuffersWEBGL(t):Ar(t.length===1&&(t[0]===36064||t[0]===1029),JS)}this.drawBuffers=t}_getAttachmentParameterFallback(t){const e=Lz(this.gl);switch(t){case 36052:return e.WEBGL2?null:0;case 33298:case 33299:case 33300:case 33301:case 33302:case 33303:return e.WEBGL2?null:8;case 33297:return e.WEBGL2?null:5125;case 33296:return!e.WEBGL2&&!e.EXT_sRGB?9729:null;default:return null}}_createHandle(){return this.gl.createFramebuffer()}_deleteHandle(){this.gl.deleteFramebuffer(this.handle)}_bindHandle(t){return this.gl.bindFramebuffer(36160,t)}}function Mz(r){return r<34069?r+34069:r}function Pz(r){return(vs.STATUS||{})[r]||"Framebuffer error ".concat(r)}const Uz=[36049,36048,33296,33298,33299,33300,33301,33302,33303];vs.ATTACHMENT_PARAMETERS=Uz;function Rz(r,t){Ar(r instanceof La||r instanceof QS||r instanceof _z);const e=r.constructor,{gl:n,width:i,height:s,format:a,type:o,dataFormat:h,border:f,mipmaps:g}=r,b=Object.assign({width:i,height:s,format:a,type:o,dataFormat:h,border:f,mipmaps:g},t);return new e(n,b)}function Dz(r,t){const{gl:e,width:n,height:i,id:s}=r;return new vs(e,Object.assign({},t,{id:"framebuffer-for-".concat(s),width:n,height:i,attachments:{36064:r}}))}function zm(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"unnamed";const e=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/,n=r.match(e);return n?n[1]:t}const Oz=35632,Nz=35633;function kz(r){switch(r){case Oz:return"fragment";case Nz:return"vertex";default:return"unknown type"}}function Qz(r,t,e,n){const i=r.split(/\r?\n/),s={},a={},o=n||zm(t)||"(unnamed)",h="".concat(kz(e)," shader ").concat(o);for(let g=0;g<i.length;g++){const b=i[g];if(b.length<=1)continue;const C=b.split(":"),B=C[0],R=parseInt(C[2],10);if(isNaN(R))throw new Error("GLSL compilation error in ".concat(h,": ").concat(r));B!=="WARNING"?s[R]=b:a[R]=b}const f=zz(t);return{shaderName:h,errors:YS(s,f),warnings:YS(a,f)}}function YS(r,t){let e="";for(let n=0;n<t.length;n++){const i=t[n];if(!(!r[n+3]&&!r[n+2]&&!r[n+1])&&(e+="".concat(i,`
`),r[n+1])){const s=r[n+1],a=s.split(":",3),o=a[0],h=parseInt(a[1],10)||0,f=s.substring(a.join(":").length+1).trim();e+=ZS("^^^ ".concat(o,": ").concat(f,`

`),h)}}return e}function zz(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:": ";const n=r.split(/\r?\n/),i=String(n.length+t-1).length;return n.map((s,a)=>{const o=String(a+t),h=o.length;return ZS(o,i-h)+e+s})}function ZS(r,t){let e="";for(let n=0;n<t;++n)e+=" ";return"".concat(e).concat(r)}function t5(r){let t=100;const e=r.match(/[^\s]+/g);if(e.length>=2&&e[0]==="#version"){const n=parseInt(e[1],10);Number.isFinite(n)&&(t=n)}return t}const Hz="Shader: GLSL source code must be a JavaScript string";class wp extends bA{get[Symbol.toStringTag](){return"Shader"}static getTypeName(t){switch(t){case 35633:return"vertex-shader";case 35632:return"fragment-shader";default:return Ar(!1),"unknown"}}constructor(t,e){km(t),Ar(typeof e.source=="string",Hz);const n=zm(e.source,null)||e.id||vA("unnamed ".concat(wp.getTypeName(e.shaderType)));super(t,{id:n}),this.shaderType=e.shaderType,this.source=e.source,this.initialize(e)}initialize(t){let{source:e}=t;const n=zm(e,null);n&&(this.id=vA(n)),this._compile(e)}getParameter(t){return this.gl.getShaderParameter(this.handle,t)}toString(){return"".concat(wp.getTypeName(this.shaderType),":").concat(this.id)}getName(){return zm(this.source)||"unnamed-shader"}getSource(){return this.gl.getShaderSource(this.handle)}getTranslatedSource(){const t=this.gl.getExtension("WEBGL_debug_shaders");return t?t.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL_debug_shaders not implemented"}_compile(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.source;if(t.startsWith("#version ")||(t=`#version 100
`.concat(t)),this.source=t,this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle),!this.getParameter(35713)){const n=this.gl.getShaderInfoLog(this.handle),{shaderName:i,errors:s,warnings:a}=Qz(n,this.source,this.shaderType,this.id);throw Cr.error("GLSL compilation errors in ".concat(i,`
`).concat(s))(),Cr.warn("GLSL compilation warnings in ".concat(i,`
`).concat(a))(),new Error("GLSL compilation errors in ".concat(i))}}_deleteHandle(){this.gl.deleteShader(this.handle)}_getOptsFromHandle(){return{type:this.getParameter(35663),source:this.getSource()}}}class dv extends wp{get[Symbol.toStringTag](){return"VertexShader"}constructor(t,e){typeof e=="string"&&(e={source:e}),super(t,Object.assign({},e,{shaderType:35633}))}_createHandle(){return this.gl.createShader(35633)}}class fv extends wp{get[Symbol.toStringTag](){return"FragmentShader"}constructor(t,e){typeof e=="string"&&(e={source:e}),super(t,Object.assign({},e,{shaderType:35632}))}_createHandle(){return this.gl.createShader(35632)}}const Gz={5126:_i.bind(null,"uniform1fv",Fa,1,uo),35664:_i.bind(null,"uniform2fv",Fa,2,uo),35665:_i.bind(null,"uniform3fv",Fa,3,uo),35666:_i.bind(null,"uniform4fv",Fa,4,uo),5124:_i.bind(null,"uniform1iv",pu,1,uo),35667:_i.bind(null,"uniform2iv",pu,2,uo),35668:_i.bind(null,"uniform3iv",pu,3,uo),35669:_i.bind(null,"uniform4iv",pu,4,uo),35670:_i.bind(null,"uniform1iv",pu,1,uo),35671:_i.bind(null,"uniform2iv",pu,2,uo),35672:_i.bind(null,"uniform3iv",pu,3,uo),35673:_i.bind(null,"uniform4iv",pu,4,uo),35674:_i.bind(null,"uniformMatrix2fv",Fa,4,wA),35675:_i.bind(null,"uniformMatrix3fv",Fa,9,wA),35676:_i.bind(null,"uniformMatrix4fv",Fa,16,wA),35678:js,35680:js,5125:_i.bind(null,"uniform1uiv",Hm,1,uo),36294:_i.bind(null,"uniform2uiv",Hm,2,uo),36295:_i.bind(null,"uniform3uiv",Hm,3,uo),36296:_i.bind(null,"uniform4uiv",Hm,4,uo),35685:_i.bind(null,"uniformMatrix2x3fv",Fa,6,wA),35686:_i.bind(null,"uniformMatrix2x4fv",Fa,8,wA),35687:_i.bind(null,"uniformMatrix3x2fv",Fa,6,wA),35688:_i.bind(null,"uniformMatrix3x4fv",Fa,12,wA),35689:_i.bind(null,"uniformMatrix4x2fv",Fa,8,wA),35690:_i.bind(null,"uniformMatrix4x3fv",Fa,12,wA),35678:js,35680:js,35679:js,35682:js,36289:js,36292:js,36293:js,36298:js,36299:js,36300:js,36303:js,36306:js,36307:js,36308:js,36311:js},Vz={},jz={},qz={},e5=[0];function pv(r,t,e,n){t===1&&typeof r=="boolean"&&(r=r?1:0),Number.isFinite(r)&&(e5[0]=r,r=e5);const i=r.length;if(i%t&&Cr.warn("Uniform size should be multiples of ".concat(t),r)(),r instanceof e)return r;let s=n[i];s||(s=new e(i),n[i]=s);for(let a=0;a<i;a++)s[a]=r[a];return s}function Fa(r,t){return pv(r,t,Float32Array,Vz)}function pu(r,t){return pv(r,t,Int32Array,jz)}function Hm(r,t){return pv(r,t,Uint32Array,qz)}function r5(r,t,e){const n=Gz[e.type];if(!n)throw new Error("Unknown GLSL uniform type ".concat(e.type));return n().bind(null,r,t)}function Kz(r){if(r[r.length-1]!=="]")return{name:r,length:1,isArray:!1};const t=/([^[]*)(\[[0-9]+\])?/,e=r.match(t);if(!e||e.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(r));return{name:e[1],length:e[2]||1,isArray:!!e[2]}}function $z(r,t,e){for(const n in r){const i=r[n];if((!e||!!e[n])&&!Wz(i))throw t=t?"".concat(t," "):"",console.error("".concat(t," Bad uniform ").concat(n),i),new Error("".concat(t," Bad uniform ").concat(n))}return!0}function Wz(r){return Array.isArray(r)||ArrayBuffer.isView(r)?Jz(r):isFinite(r)||r===!0||r===!1||r instanceof Sd||r instanceof Td?!0:r instanceof vs?!!r.texture:!1}function Xz(r,t,e){if(Array.isArray(e)||ArrayBuffer.isView(e))if(r[t]){const n=r[t];for(let i=0,s=e.length;i<s;++i)n[i]=e[i]}else r[t]=e.slice();else r[t]=e}function Jz(r){if(r.length===0)return!1;const t=Math.min(r.length,16);for(let e=0;e<t;++e)if(!Number.isFinite(r[e]))return!1;return!0}function js(){let r=null;return(t,e,n)=>{const i=r!==n;return i&&(t.uniform1i(e,n),r=n),i}}function _i(r,t,e,n){let i=null,s=null;return(a,o,h)=>{const f=t(h,e),g=f.length;let b=!1;if(i===null)i=new Float32Array(g),s=g,b=!0;else{Ar(s===g,"Uniform length cannot change.");for(let C=0;C<g;++C)if(f[C]!==i[C]){b=!0;break}}return b&&(n(a,r,o,f),i.set(f)),b}}function uo(r,t,e,n){r[t](e,n)}function wA(r,t,e,n){r[t](e,!1,n)}const Yz=5120,Zz=5121,tH=5122,eH=5123,n5=0,Gm=1,rH=2,nH=3,Vm=4,iH=5,sH=6,bs=5126,oH=35664,aH=35665,cH=35666,xp=5124,lH=35667,AH=35668,uH=35669,Bp=5125,hH=36294,dH=36295,fH=36296,pH=35670,gH=35671,mH=35672,yH=35673,_H=35674,vH=35675,bH=35676,wH=35685,xH=35686,BH=35687,CH=35688,EH=35689,SH=35690,gv={[bs]:[bs,1,"float"],[oH]:[bs,2,"vec2"],[aH]:[bs,3,"vec3"],[cH]:[bs,4,"vec4"],[xp]:[xp,1,"int"],[lH]:[xp,2,"ivec2"],[AH]:[xp,3,"ivec3"],[uH]:[xp,4,"ivec4"],[Bp]:[Bp,1,"uint"],[hH]:[Bp,2,"uvec2"],[dH]:[Bp,3,"uvec3"],[fH]:[Bp,4,"uvec4"],[pH]:[bs,1,"bool"],[gH]:[bs,2,"bvec2"],[mH]:[bs,3,"bvec3"],[yH]:[bs,4,"bvec4"],[_H]:[bs,8,"mat2"],[wH]:[bs,8,"mat2x3"],[xH]:[bs,8,"mat2x4"],[vH]:[bs,12,"mat3"],[BH]:[bs,12,"mat3x2"],[CH]:[bs,12,"mat3x4"],[bH]:[bs,16,"mat4"],[EH]:[bs,16,"mat4x2"],[SH]:[bs,16,"mat4x3"]};function TH(r){switch(r){case n5:return n5;case Gm:return Gm;case nH:return Gm;case rH:return Gm;case Vm:return Vm;case iH:return Vm;case sH:return Vm;default:return Ar(!1),0}}function i5(r){const t=gv[r];if(!t)return null;const[e,n]=t;return{type:e,components:n}}function s5(r,t){switch(r){case Yz:case Zz:case tH:case eH:r=bs;break}for(const e in gv){const[n,i,s]=gv[e];if(n===r&&i===t)return{glType:e,name:s}}return null}class IH{constructor(t){this.id=t.id,this.attributeInfos=[],this.attributeInfosByName={},this.attributeInfosByLocation=[],this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(t),this._readVaryingsFromProgram(t)}getAttributeInfo(t){const e=Number(t);return Number.isFinite(e)?this.attributeInfosByLocation[e]:this.attributeInfosByName[t]||null}getAttributeLocation(t){const e=this.getAttributeInfo(t);return e?e.location:-1}getAttributeAccessor(t){const e=this.getAttributeInfo(t);return e?e.accessor:null}getVaryingInfo(t){const e=Number(t);return Number.isFinite(e)?this.varyingInfos[e]:this.varyingInfosByName[t]||null}getVaryingIndex(t){const e=this.getVaryingInfo();return e?e.location:-1}getVaryingAccessor(t){const e=this.getVaryingInfo();return e?e.accessor:null}_readAttributesFromProgram(t){const{gl:e}=t,n=e.getProgramParameter(t.handle,35721);for(let i=0;i<n;i++){const{name:s,type:a,size:o}=e.getActiveAttrib(t.handle,i),h=e.getAttribLocation(t.handle,s);h>=0&&this._addAttribute(h,s,a,o)}this.attributeInfos.sort((i,s)=>i.location-s.location)}_readVaryingsFromProgram(t){const{gl:e}=t;if(!yn(e))return;const n=e.getProgramParameter(t.handle,35971);for(let i=0;i<n;i++){const{name:s,type:a,size:o}=e.getTransformFeedbackVarying(t.handle,i);this._addVarying(i,s,a,o)}this.varyingInfos.sort((i,s)=>i.location-s.location)}_addAttribute(t,e,n,i){const{type:s,components:a}=i5(n),o={type:s,size:i*a};this._inferProperties(t,e,o);const h={location:t,name:e,accessor:new oa(o)};this.attributeInfos.push(h),this.attributeInfosByLocation[t]=h,this.attributeInfosByName[h.name]=h}_inferProperties(t,e,n){/instance/i.test(e)&&(n.divisor=1)}_addVarying(t,e,n,i){const{type:s,components:a}=i5(n),o=new oa({type:s,size:i*a}),h={location:t,name:e,accessor:o};this.varyingInfos.push(h),this.varyingInfosByName[h.name]=h}}const o5=4,LH=35981,FH=["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"];class a5 extends bA{get[Symbol.toStringTag](){return"Program"}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(t,e),this.stubRemovedMethods("Program","v6.0",FH),this._isCached=!1,this.initialize(e),Object.seal(this),this._setId(e.id)}initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{hash:e,vs:n,fs:i,varyings:s,bufferMode:a=LH}=t;return this.hash=e||"",this.vs=typeof n=="string"?new dv(this.gl,{id:"".concat(t.id,"-vs"),source:n}):n,this.fs=typeof i=="string"?new fv(this.gl,{id:"".concat(t.id,"-fs"),source:i}):i,Ar(this.vs instanceof dv),Ar(this.fs instanceof fv),this.uniforms={},this._textureUniforms={},s&&s.length>0&&(Qo(this.gl),this.varyings=s,this.gl2.transformFeedbackVaryings(this.handle,s,a)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new IH(this),this.setProps(t)}delete(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isCached?this:super.delete(t)}setProps(t){return"uniforms"in t&&this.setUniforms(t.uniforms),this}draw(t){let{logPriority:e,drawMode:n=4,vertexCount:i,offset:s=0,start:a,end:o,isIndexed:h=!1,indexType:f=5123,instanceCount:g=0,isInstanced:b=g>0,vertexArray:C=null,transformFeedback:B,framebuffer:R,parameters:D={},uniforms:Q,samplers:k}=t;if((Q||k)&&(Cr.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(Q||{})),Cr.priority>=e){const j=R?R.id:"default",et="mode=".concat(fu(this.gl,n)," verts=").concat(i," ")+"instances=".concat(g," indexType=").concat(fu(this.gl,f)," ")+"isInstanced=".concat(b," isIndexed=").concat(h," ")+"Framebuffer=".concat(j);Cr.log(e,et)()}return Ar(C),this.gl.useProgram(this.handle),!this._areTexturesRenderable()||i===0||b&&g===0?!1:(C.bindForDraw(i,g,()=>{if(R!==void 0&&(D=Object.assign({},D,{framebuffer:R})),B){const j=TH(n);B.begin(j)}this._bindTextures(),Ic(this.gl,D,()=>{h&&b?this.gl2.drawElementsInstanced(n,i,f,s,g):h&&yn(this.gl)&&!isNaN(a)&&!isNaN(o)?this.gl2.drawRangeElements(n,a,o,i,f,s):h?this.gl.drawElements(n,i,f,s):b?this.gl2.drawArraysInstanced(n,s,i,g):this.gl.drawArrays(n,s,i)}),B&&B.end()}),!0)}setUniforms(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Cr.priority>=2&&$z(t,this.id,this._uniformSetters),this.gl.useProgram(this.handle);for(const e in t){const n=t[e],i=this._uniformSetters[e];if(i){let s=n,a=!1;if(s instanceof vs&&(s=s.texture),s instanceof Sd)if(a=this.uniforms[e]!==n,a){i.textureIndex===void 0&&(i.textureIndex=this._textureIndexCounter++);const o=s,{textureIndex:h}=i;o.bind(h),s=h,this._textureUniforms[e]=o}else s=i.textureIndex;else this._textureUniforms[e]&&delete this._textureUniforms[e];(i(s)||a)&&Xz(this.uniforms,e,n)}}return this}_areTexturesRenderable(){let t=!0;for(const e in this._textureUniforms){const n=this._textureUniforms[e];n.update(),t=t&&n.loaded}return t}_bindTextures(){for(const t in this._textureUniforms){const e=this._uniformSetters[t].textureIndex;this._textureUniforms[t].bind(e)}}_createHandle(){return this.gl.createProgram()}_deleteHandle(){this.gl.deleteProgram(this.handle)}_getOptionsFromHandle(t){const e=this.gl.getAttachedShaders(t),n={};for(const i of e)switch(this.gl.getShaderParameter(this.handle,35663)){case 35633:n.vs=new dv({handle:i});break;case 35632:n.fs=new fv({handle:i});break}return n}_getParameter(t){return this.gl.getProgramParameter(this.handle,t)}_setId(t){if(!t){const e=this._getName();this.id=vA(e)}}_getName(){let t=this.vs.getName()||this.fs.getName();return t=t.replace(/shader/i,""),t=t?"".concat(t,"-program"):"program",t}_compileAndLink(){const{gl:t}=this;if(t.attachShader(this.handle,this.vs.handle),t.attachShader(this.handle,this.fs.handle),Cr.time(o5,"linkProgram for ".concat(this._getName()))(),t.linkProgram(this.handle),Cr.timeEnd(o5,"linkProgram for ".concat(this._getName()))(),t.debug||Cr.level>0){if(!t.getProgramParameter(this.handle,35714))throw new Error("Error linking: ".concat(t.getProgramInfoLog(this.handle)));if(t.validateProgram(this.handle),!t.getProgramParameter(this.handle,35715))throw new Error("Error validating: ".concat(t.getProgramInfoLog(this.handle)))}}_readUniformLocationsFromLinkedProgram(){const{gl:t}=this;this._uniformSetters={},this._uniformCount=this._getParameter(35718);for(let e=0;e<this._uniformCount;e++){const n=this.gl.getActiveUniform(this.handle,e),{name:i}=Kz(n.name);let s=t.getUniformLocation(this.handle,i);if(this._uniformSetters[i]=r5(t,s,n),n.size>1)for(let a=0;a<n.size;a++)s=t.getUniformLocation(this.handle,"".concat(i,"[").concat(a,"]")),this._uniformSetters["".concat(i,"[").concat(a,"]")]=r5(t,s,n)}this._textureIndexCounter=0}getActiveUniforms(t,e){return this.gl2.getActiveUniforms(this.handle,t,e)}getUniformBlockIndex(t){return this.gl2.getUniformBlockIndex(this.handle,t)}getActiveUniformBlockParameter(t,e){return this.gl2.getActiveUniformBlockParameter(this.handle,t,e)}uniformBlockBinding(t,e){this.gl2.uniformBlockBinding(this.handle,t,e)}}const MH=34918,PH=34919,UH=35007,RH=36795,DH=35976,OH=35887,NH=36202;class jm extends bA{get[Symbol.toStringTag](){return"Query"}static isSupported(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const n=yn(t),i=WS(t,gi.TIMER_QUERY);let s=n||i;for(const a of e)switch(a){case"queries":s=s&&n;break;case"timers":s=s&&i;break;default:Ar(!1)}return s}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(t,e),this.target=null,this._queryPending=!1,this._pollingPromise=null,Object.seal(this)}beginTimeElapsedQuery(){return this.begin(UH)}beginOcclusionQuery(){let{conservative:t=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.begin(t?NH:OH)}beginTransformFeedbackQuery(){return this.begin(DH)}begin(t){return this._queryPending?this:(this.target=t,this.gl2.beginQuery(this.target,this.handle),this)}end(){return this._queryPending?this:(this.target&&(this.gl2.endQuery(this.target),this.target=null,this._queryPending=!0),this)}isResultAvailable(){if(!this._queryPending)return!1;const t=this.gl2.getQueryParameter(this.handle,PH);return t&&(this._queryPending=!1),t}isTimerDisjoint(){return this.gl2.getParameter(RH)}getResult(){return this.gl2.getQueryParameter(this.handle,MH)}getTimerMilliseconds(){return this.getResult()/1e6}createPoll(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Number.POSITIVE_INFINITY;if(this._pollingPromise)return this._pollingPromise;let e=0;return this._pollingPromise=new Promise((n,i)=>{const s=()=>{this.isResultAvailable()?(n(this.getResult()),this._pollingPromise=null):e++>t?(i("Timed out"),this._pollingPromise=null):requestAnimationFrame(s)};requestAnimationFrame(s)}),this._pollingPromise}_createHandle(){return jm.isSupported(this.gl)?this.gl2.createQuery():null}_deleteHandle(){this.gl2.deleteQuery(this.handle)}}class c5 extends bA{get[Symbol.toStringTag](){return"TransformFeedback"}static isSupported(t){return yn(t)}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Qo(t),super(t,e),this.initialize(e),this.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal(this)}initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,Cd(this.buffers)||this.bind(()=>this._unbindBuffers()),this.setProps(t),this}setProps(t){"program"in t&&(this.configuration=t.program&&t.program.configuration),"configuration"in t&&(this.configuration=t.configuration),"bindOnUse"in t&&(t=t.bindOnUse),"buffers"in t&&this.setBuffers(t.buffers)}setBuffers(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.bind(()=>{for(const e in t)this.setBuffer(e,t[e])}),this}setBuffer(t,e){const n=this._getVaryingIndex(t),{buffer:i,byteSize:s,byteOffset:a}=this._getBufferParams(e);return n<0?(this.unused[t]=i,Cr.warn("".concat(this.id," unused varying buffer ").concat(t))(),this):(this.buffers[n]=e,this.bindOnUse||this._bindBuffer(n,i,a,s),this)}begin(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.gl.bindTransformFeedback(36386,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(t),this}end(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null),this}_getBufferParams(t){let e,n,i;return t instanceof ri?i=t:(i=t.buffer,n=t.byteSize,e=t.byteOffset),(e!==void 0||n!==void 0)&&(e=e||0,n=n||i.byteLength-e),{buffer:i,byteOffset:e,byteSize:n}}_getVaryingInfo(t){return this.configuration&&this.configuration.getVaryingInfo(t)}_getVaryingIndex(t){if(this.configuration)return this.configuration.getVaryingInfo(t).location;const e=Number(t);return Number.isFinite(e)?e:-1}_bindBuffers(){if(this.bindOnUse)for(const t in this.buffers){const{buffer:e,byteSize:n,byteOffset:i}=this._getBufferParams(this.buffers[t]);this._bindBuffer(t,e,i,n)}}_unbindBuffers(){if(this.bindOnUse)for(const t in this.buffers)this._bindBuffer(t,null)}_bindBuffer(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0;const s=e&&e.handle;return!s||i===void 0?this.gl.bindBufferBase(35982,t,s):this.gl.bindBufferRange(35982,t,s,n,i),this}_createHandle(){return this.gl.createTransformFeedback()}_deleteHandle(){this.gl.deleteTransformFeedback(this.handle)}_bindHandle(t){this.gl.bindTransformFeedback(36386,this.handle)}}let qm=null;function kH(r){return(!qm||qm.byteLength<r)&&(qm=new ArrayBuffer(r)),qm}function QH(r,t){const e=kH(r.BYTES_PER_ELEMENT*t);return new r(e,0,t)}function zH(r){let{target:t,source:e,start:n=0,count:i=1}=r;const s=e.length,a=i*s;let o=0;for(let h=n;o<s;o++)t[h++]=e[o];for(;o<a;)o<a-o?(t.copyWithin(n+o,n,n+o),o*=2):(t.copyWithin(n+o,n,n+a-o),o=a);return t}const HH="elements must be GL.ELEMENT_ARRAY_BUFFER";class Ma extends bA{get[Symbol.toStringTag](){return"VertexArrayObject"}static isSupported(t){return(arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}).constantAttributeZero?yn(t)||rz()==="Chrome":!0}static getDefaultArray(t){return t.luma=t.luma||{},t.luma.defaultVertexArray||(t.luma.defaultVertexArray=new Ma(t,{handle:null,isDefaultArray:!0})),t.luma.defaultVertexArray}static getMaxAttributes(t){return Ma.MAX_ATTRIBUTES=Ma.MAX_ATTRIBUTES||t.getParameter(34921),Ma.MAX_ATTRIBUTES}static setConstant(t,e,n){switch(n.constructor){case Float32Array:Ma._setConstantFloatArray(t,e,n);break;case Int32Array:Ma._setConstantIntArray(t,e,n);break;case Uint32Array:Ma._setConstantUintArray(t,e,n);break;default:Ar(!1)}}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=e.id||e.program&&e.program.id;super(t,Object.assign({},e,{id:n})),this.buffer=null,this.bufferValue=null,this.isDefaultArray=e.isDefaultArray||!1,this.gl2=t,this.initialize(e),Object.seal(this)}delete(){return super.delete(),this.buffer&&this.buffer.delete(),this}get MAX_ATTRIBUTES(){return Ma.getMaxAttributes(this.gl)}initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.setProps(t)}setProps(t){return this}setElementBuffer(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return Ar(!t||t.target===34963,HH),this.bind(()=>{this.gl.bindBuffer(34963,t?t.handle:null)}),this}setBuffer(t,e,n){if(e.target===34963)return this.setElementBuffer(e,n);const{size:i,type:s,stride:a,offset:o,normalized:h,integer:f,divisor:g}=n,{gl:b,gl2:C}=this;return t=Number(t),this.bind(()=>{b.bindBuffer(34962,e.handle),f?(Ar(yn(b)),C.vertexAttribIPointer(t,i,s,a,o)):b.vertexAttribPointer(t,i,s,h,a,o),b.enableVertexAttribArray(t),C.vertexAttribDivisor(t,g||0)}),this}enable(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return!e&&t===0&&!Ma.isSupported(this.gl,{constantAttributeZero:!0})||(t=Number(t),this.bind(()=>e?this.gl.enableVertexAttribArray(t):this.gl.disableVertexAttribArray(t))),this}getConstantBuffer(t,e){const n=this._normalizeConstantArrayValue(e),i=n.byteLength*t,s=n.length*t;let a=!this.buffer;if(this.buffer=this.buffer||new ri(this.gl,i),a=a||this.buffer.reallocate(i),a=a||!this._compareConstantArrayValues(n,this.bufferValue),a){const o=QH(e.constructor,s);zH({target:o,source:n,start:0,count:s}),this.buffer.subData(o),this.bufferValue=e}return this.buffer}_normalizeConstantArrayValue(t){return Array.isArray(t)?new Float32Array(t):t}_compareConstantArrayValues(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}static _setConstantFloatArray(t,e,n){switch(n.length){case 1:t.vertexAttrib1fv(e,n);break;case 2:t.vertexAttrib2fv(e,n);break;case 3:t.vertexAttrib3fv(e,n);break;case 4:t.vertexAttrib4fv(e,n);break;default:Ar(!1)}}static _setConstantIntArray(t,e,n){switch(Ar(yn(t)),n.length){case 1:t.vertexAttribI1iv(e,n);break;case 2:t.vertexAttribI2iv(e,n);break;case 3:t.vertexAttribI3iv(e,n);break;case 4:t.vertexAttribI4iv(e,n);break;default:Ar(!1)}}static _setConstantUintArray(t,e,n){switch(Ar(yn(t)),n.length){case 1:t.vertexAttribI1uiv(e,n);break;case 2:t.vertexAttribI2uiv(e,n);break;case 3:t.vertexAttribI3uiv(e,n);break;case 4:t.vertexAttribI4uiv(e,n);break;default:Ar(!1)}}_createHandle(){return this.gl.createVertexArray()}_deleteHandle(t){return this.gl2.deleteVertexArray(t),[this.elements]}_bindHandle(t){this.gl2.bindVertexArray(t)}_getParameter(t,e){let{location:n}=e;return Ar(Number.isFinite(n)),this.bind(()=>{switch(t){case 34373:return this.gl.getVertexAttribOffset(n,t);default:return this.gl.getVertexAttrib(n,t)}})}}const GH="VertexArray: attributes must be Buffers or constants (i.e. typed array)",VH=/^(.+)__LOCATION_([0-9]+)$/,jH=["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"];class qH{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=e.id||e.program&&e.program.id;this.id=n,this.gl=t,this.configuration=null,this.elements=null,this.elementsAccessor=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.attributes={},this.vertexArrayObject=new Ma(t),US(this,"VertexArray","v6.0",jH),this.initialize(e),Object.seal(this)}delete(){this.buffer&&this.buffer.delete(),this.vertexArrayObject.delete()}initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(t)}reset(){this.elements=null,this.elementsAccessor=null;const{MAX_ATTRIBUTES:t}=this.vertexArrayObject;return this.values=new Array(t).fill(null),this.accessors=new Array(t).fill(null),this.unused={},this.drawParams=null,this}setProps(t){return"program"in t&&(this.configuration=t.program&&t.program.configuration),"configuration"in t&&(this.configuration=t.configuration),"attributes"in t&&this.setAttributes(t.attributes),"elements"in t&&this.setElementBuffer(t.elements),"bindOnUse"in t&&(t=t.bindOnUse),this}clearDrawParams(){this.drawParams=null}getDrawParams(){return this.drawParams=this.drawParams||this._updateDrawParams(),this.drawParams}setAttributes(t){return Object.assign(this.attributes,t),this.vertexArrayObject.bind(()=>{for(const e in t){const n=t[e];this._setAttribute(e,n)}this.gl.bindBuffer(34962,null)}),this}setElementBuffer(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.elements=t,this.elementsAccessor=e,this.clearDrawParams(),this.vertexArrayObject.setElementBuffer(t,e),this}setBuffer(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e.target===34963)return this.setElementBuffer(e,n);const{location:i,accessor:s}=this._resolveLocationAndAccessor(t,e,e.accessor,n);return i>=0&&(this.values[i]=e,this.accessors[i]=s,this.clearDrawParams(),this.vertexArrayObject.setBuffer(i,e,s)),this}setConstant(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{location:i,accessor:s}=this._resolveLocationAndAccessor(t,e,Object.assign({size:e.length},n));return i>=0&&(e=this.vertexArrayObject._normalizeConstantArrayValue(e),this.values[i]=e,this.accessors[i]=s,this.clearDrawParams(),this.vertexArrayObject.enable(i,!1)),this}unbindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.vertexArrayObject.setElementBuffer(null),this.buffer=this.buffer||new ri(this.gl,{accessor:{size:4}});for(let t=0;t<this.vertexArrayObject.MAX_ATTRIBUTES;t++)this.values[t]instanceof ri&&(this.gl.disableVertexAttribArray(t),this.gl.bindBuffer(34962,this.buffer.handle),this.gl.vertexAttribPointer(t,1,5126,!1,0,0))}),this}bindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.setElementBuffer(this.elements);for(let t=0;t<this.vertexArrayObject.MAX_ATTRIBUTES;t++){const e=this.values[t];e instanceof ri&&this.setBuffer(t,e)}}),this}bindForDraw(t,e,n){let i;return this.vertexArrayObject.bind(()=>{this._setConstantAttributes(t,e),i=n()}),i}_resolveLocationAndAccessor(t,e,n,i){const s={location:-1,accessor:null},{location:a,name:o}=this._getAttributeIndex(t);if(!Number.isFinite(a)||a<0)return this.unused[t]=e,Cr.once(3,()=>"unused value ".concat(t," in ").concat(this.id))(),s;const h=this._getAttributeInfo(o||a);if(!h)return s;const f=this.accessors[a]||{},g=oa.resolve(h.accessor,f,n,i),{size:b,type:C}=g;return Ar(Number.isFinite(b)&&Number.isFinite(C)),{location:a,accessor:g}}_getAttributeInfo(t){return this.configuration&&this.configuration.getAttributeInfo(t)}_getAttributeIndex(t){const e=Number(t);if(Number.isFinite(e))return{location:e};const n=VH.exec(t),i=n?n[1]:t,s=n?Number(n[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(i)+s,name:i}:{location:-1}}_setAttribute(t,e){if(e instanceof ri)this.setBuffer(t,e);else if(Array.isArray(e)&&e.length&&e[0]instanceof ri){const n=e[0],i=e[1];this.setBuffer(t,n,i)}else if(ArrayBuffer.isView(e)||Array.isArray(e)){const n=e;this.setConstant(t,n)}else if(e.buffer instanceof ri){const n=e;this.setBuffer(t,n.buffer,n)}else throw new Error(GH)}_setConstantAttributes(t,e){const n=Math.max(t|0,e|0);let i=this.values[0];ArrayBuffer.isView(i)&&this._setConstantAttributeZero(i,n);for(let s=1;s<this.vertexArrayObject.MAX_ATTRIBUTES;s++)i=this.values[s],ArrayBuffer.isView(i)&&this._setConstantAttribute(s,i)}_setConstantAttributeZero(t,e){if(Ma.isSupported(this.gl,{constantAttributeZero:!0})){this._setConstantAttribute(0,t);return}const n=this.vertexArrayObject.getConstantBuffer(e,t);this.vertexArrayObject.setBuffer(0,n,this.accessors[0])}_setConstantAttribute(t,e){Ma.setConstant(this.gl,t,e)}_updateDrawParams(){const t={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0};for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++)this._updateDrawParamsForLocation(t,e);return this.elements&&(t.elementCount=this.elements.getElementCount(this.elements.accessor),t.isIndexed=!0,t.indexType=this.elementsAccessor.type||this.elements.accessor.type,t.indexOffset=this.elementsAccessor.offset||0),t.indexCount===1/0&&(t.indexCount=0),t.vertexCount===1/0&&(t.vertexCount=0),t.instanceCount===1/0&&(t.instanceCount=0),t}_updateDrawParamsForLocation(t,e){const n=this.values[e],i=this.accessors[e];if(!n)return;const{divisor:s}=i,a=s>0;if(t.isInstanced=t.isInstanced||a,n instanceof ri){const o=n;if(a){const h=o.getVertexCount(i);t.instanceCount=Math.min(t.instanceCount,h)}else{const h=o.getVertexCount(i);t.vertexCount=Math.min(t.vertexCount,h)}}}setElements(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Cr.deprecated("setElements","setElementBuffer")(),this.setElementBuffer(t,e)}}function KH(r,t){const{maxElts:e=16,size:n=1}=t;let i="[";for(let a=0;a<r.length&&a<e;++a)a>0&&(i+=",".concat(a%n===0?" ":"")),i+=Cp(r[a],t);const s=r.length>e?"...":"]";return"".concat(i).concat(s)}function Cp(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const e=1e-16,{isInteger:n=!1}=t;if(Array.isArray(r)||ArrayBuffer.isView(r))return KH(r,t);if(!Number.isFinite(r))return String(r);if(Math.abs(r)<e)return n?"0":"0.";if(n||Math.abs(r)>100&&Math.abs(r)<1e4)return r.toFixed(0);const i=r.toPrecision(2);return i.indexOf(".0")===i.length-2?i.slice(0,-1):i}function l5(r){let{header:t="Uniforms",program:e,uniforms:n,undefinedOnly:i=!1}=r;Ar(e);const s=".*_.*",a=".*Matrix",o=e._uniformSetters,h={},f=Object.keys(o).sort();let g=0;for(const B of f)!B.match(s)&&!B.match(a)&&mv({table:h,header:t,uniforms:n,uniformName:B,undefinedOnly:i})&&g++;for(const B of f)B.match(a)&&mv({table:h,header:t,uniforms:n,uniformName:B,undefinedOnly:i})&&g++;for(const B of f)h[B]||mv({table:h,header:t,uniforms:n,uniformName:B,undefinedOnly:i})&&g++;let b=0;const C={};if(!i)for(const B in n){const R=n[B];h[B]||(b++,C[B]={Type:"NOT USED: ".concat(R),[t]:Cp(R)})}return{table:h,count:g,unusedTable:C,unusedCount:b}}function mv(r){let{table:t,header:e,uniforms:n,uniformName:i,undefinedOnly:s}=r;const a=n[i],o=$H(a);return!s||!o?(t[i]={[e]:o?Cp(a):"N/A","Uniform Type":o?a:"NOT PROVIDED"},!0):!1}function $H(r){return r!=null}function WH(r){let{vertexArray:t,header:e="Attributes"}=r;if(!t.configuration)return{};const n={};t.elements&&(n.ELEMENT_ARRAY_BUFFER=A5(t,t.elements,null,e));const i=t.values;for(const s in i){const a=t._getAttributeInfo(s);if(a){let o="".concat(s,": ").concat(a.name);const h=t.accessors[a.location];h&&(o="".concat(s,": ").concat(XH(a.name,h))),n[o]=A5(t,i[s],h,e)}}return n}function A5(r,t,e,n){const{gl:i}=r;if(!t)return{[n]:"null","Format ":"N/A"};let s="NOT PROVIDED",a=1,o=0,h=0,f,g,b;if(e&&(s=e.type,a=e.size,s=String(s).replace("Array",""),f=s.indexOf("nt")!==-1),t instanceof ri){const C=t,{data:B,changed:R}=C.getDebugData();g=R?"*":"",b=B,h=C.byteLength,o=h/B.BYTES_PER_ELEMENT/a;let D;if(e){const Q=e.divisor>0;D="".concat(Q?"I ":"P "," ").concat(o," (x").concat(a,"=").concat(h," bytes ").concat(fu(i,s),")")}else f=!0,D="".concat(h," bytes");return{[n]:"".concat(g).concat(Cp(b,{size:a,isInteger:f})),"Format ":D}}return b=t,a=t.length,s=String(t.constructor.name).replace("Array",""),f=s.indexOf("nt")!==-1,{[n]:"".concat(Cp(b,{size:a,isInteger:f})," (constant)"),"Format ":"".concat(a,"x").concat(s," (constant)")}}function XH(r,t){const{type:e,size:n}=t,i=s5(e,n);return i?"".concat(r," (").concat(i.name,")"):r}function JH(r){const t={},e="Accessors for ".concat(r.id);for(const n of r.attributeInfos)if(n){const i=u5(n);t["in ".concat(i)]={[e]:JSON.stringify(n.accessor)}}for(const n of r.varyingInfos)if(n){const i=u5(n);t["out ".concat(i)]={[e]:JSON.stringify(n.accessor)}}return t}function u5(r){const{type:t,size:e}=r.accessor,n=s5(t,e);return n?"".concat(n.name," ").concat(r.name):r.name}function YH(r){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron)return!0;const t=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,e=r||t;return!!(e&&e.indexOf("Electron")>=0)}function ZH(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||YH()}const h5=ZH()&&typeof document<"u";let t9=0;class e9{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{onCreateContext:e=Q=>TS(Q),onAddHTML:n=null,onInitialize:i=()=>{},onRender:s=()=>{},onFinalize:a=()=>{},onError:o,gl:h=null,glOptions:f={},debug:g=!1,createFramebuffer:b=!1,autoResizeViewport:C=!0,autoResizeDrawingBuffer:B=!0,stats:R=fh.get("animation-loop-".concat(t9++))}=t;let{useDevicePixels:D=!0}=t;"useDevicePixelRatio"in t&&(Cr.deprecated("useDevicePixelRatio","useDevicePixels")(),D=t.useDevicePixelRatio),this.props={onCreateContext:e,onAddHTML:n,onInitialize:i,onRender:s,onFinalize:a,onError:o,gl:h,glOptions:f,debug:g,createFramebuffer:b},this.gl=h,this.needsRedraw=null,this.timeline=null,this.stats=R,this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.setProps({autoResizeViewport:C,autoResizeDrawingBuffer:B,useDevicePixels:D}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._pageLoadPromise=null,this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}delete(){this.stop(),this._setDisplay(null)}setNeedsRedraw(t){return Ar(typeof t=="string"),this.needsRedraw=this.needsRedraw||t,this}setProps(t){return"autoResizeViewport"in t&&(this.autoResizeViewport=t.autoResizeViewport),"autoResizeDrawingBuffer"in t&&(this.autoResizeDrawingBuffer=t.autoResizeDrawingBuffer),"useDevicePixels"in t&&(this.useDevicePixels=t.useDevicePixels),this}start(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this._running)return this;this._running=!0;const e=this._getPageLoadPromise().then(()=>!this._running||this._initialized?null:(this._createWebGLContext(t),this._createFramebuffer(),this._startEventHandling(),this._initializeCallbackData(),this._updateCallbackData(),this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._gpuTimeQuery=jm.isSupported(this.gl,["timers"])?new jm(this.gl):null,this._initialized=!0,this.onInitialize(this.animationProps))).then(n=>{this._running&&(this._addCallbackData(n||{}),n!==!1&&this._startLoop())});return this.props.onError&&e.catch(this.props.onError),this}redraw(){return this.isContextLost()?this:(this._beginTimers(),this._setupFrame(),this._updateCallbackData(),this._renderFrame(this.animationProps),this._clearNeedsRedraw(),this.offScreen&&this.gl.commit&&this.gl.commit(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endTimers(),this)}stop(){return this._running&&(this._finalizeCallbackData(),this._cancelAnimationFrame(this._animationFrameId),this._nextFramePromise=null,this._resolveNextFrame=null,this._animationFrameId=null,this._running=!1),this}attachTimeline(t){return this.timeline=t,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(t=>{this._resolveNextFrame=t})),this._nextFramePromise}async toDataURL(){return this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.gl.canvas.toDataURL()}isContextLost(){return this.gl.isContextLost()}onCreateContext(){return this.props.onCreateContext(...arguments)}onInitialize(){return this.props.onInitialize(...arguments)}onRender(){return this.props.onRender(...arguments)}onFinalize(){return this.props.onFinalize(...arguments)}getHTMLControlValue(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const n=document.getElementById(t);return n?Number(n.value):e}setViewParameters(){return Cr.removed("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this}_startLoop(){const t=()=>{this._running&&(this.redraw(),this._animationFrameId=this._requestAnimationFrame(t))};this._cancelAnimationFrame(this._animationFrameId),this._animationFrameId=this._requestAnimationFrame(t)}_getPageLoadPromise(){return this._pageLoadPromise||(this._pageLoadPromise=h5?new Promise((t,e)=>{if(h5&&document.readyState==="complete"){t(document);return}window.addEventListener("load",()=>{t(document)})}):Promise.resolve({})),this._pageLoadPromise}_setDisplay(t){this.display&&(this.display.delete(),this.display.animationLoop=null),t&&(t.animationLoop=this),this.display=t}_cancelAnimationFrame(t){return this.display&&this.display.cancelAnimationFrame?this.display.cancelAnimationFrame(t):oz(t)}_requestAnimationFrame(t){if(this._running)return this.display&&this.display.requestAnimationFrame?this.display.requestAnimationFrame(t):sz(t)}_renderFrame(){if(this.display){this.display._renderFrame(...arguments);return}this.onRender(...arguments)}_clearNeedsRedraw(){this.needsRedraw=null}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer()}_initializeCallbackData(){this.animationProps={gl:this.gl,stop:this.stop,canvas:this.gl.canvas,framebuffer:this.framebuffer,useDevicePixels:this.useDevicePixels,needsRedraw:null,startTime:Date.now(),engineTime:0,tick:0,tock:0,time:0,_timeline:this.timeline,_loop:this,_animationLoop:this,_mousePosition:null}}_updateCallbackData(){const{width:t,height:e,aspect:n}=this._getSizeAndAspect();(t!==this.animationProps.width||e!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),n!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=t,this.animationProps.height=e,this.animationProps.aspect=n,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime,this.animationProps._offScreen=this.offScreen}_finalizeCallbackData(){this.onFinalize(this.animationProps)}_addCallbackData(t){typeof t=="object"&&t!==null&&(this.animationProps=Object.assign({},this.animationProps,t))}_createWebGLContext(t){if(this.offScreen=t.canvas&&typeof OffscreenCanvas<"u"&&t.canvas instanceof OffscreenCanvas,t=Object.assign({},t,this.props.glOptions),this.gl=this.props.gl?nv(this.props.gl,t):this.onCreateContext(t),!Nm(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");VQ(this.gl),this._createInfoDiv()}_createInfoDiv(){if(this.gl.canvas&&this.props.onAddHTML){const t=document.createElement("div");document.body.appendChild(t),t.style.position="relative";const e=document.createElement("div");e.style.position="absolute",e.style.left="10px",e.style.bottom="10px",e.style.width="300px",e.style.background="white",t.appendChild(this.gl.canvas),t.appendChild(e);const n=this.props.onAddHTML(e);n&&(e.innerHTML=n)}}_getSizeAndAspect(){const t=this.gl.drawingBufferWidth,e=this.gl.drawingBufferHeight;let n=1;const{canvas:i}=this.gl;return i&&i.clientHeight?n=i.clientWidth/i.clientHeight:t>0&&e>0&&(n=t/e),{width:t,height:e,aspect:n}}_resizeViewport(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.autoResizeDrawingBuffer&&WQ(this.gl,{useDevicePixels:this.useDevicePixels})}_createFramebuffer(){this.props.createFramebuffer&&(this.framebuffer=new vs(this.gl))}_resizeFramebuffer(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}_beginTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this._gpuTimeQuery&&this._gpuTimeQuery.isResultAvailable()&&!this._gpuTimeQuery.isTimerDisjoint()&&this.stats.get("GPU Time").addTime(this._gpuTimeQuery.getTimerMilliseconds()),this._gpuTimeQuery&&this._gpuTimeQuery.beginTimeElapsedQuery(),this.cpuTime.timeStart()}_endTimers(){this.cpuTime.timeEnd(),this._gpuTimeQuery&&this._gpuTimeQuery.end()}_startEventHandling(){const{canvas:t}=this.gl;t&&(t.addEventListener("mousemove",this._onMousemove),t.addEventListener("mouseleave",this._onMouseleave))}_onMousemove(t){this.animationProps._mousePosition=[t.offsetX,t.offsetY]}_onMouseleave(t){this.animationProps._mousePosition=null}}const Ep="vs",yv="fs";function Pa(r,t){if(!r)throw new Error(t||"shadertools: assertion failed.")}const _v={number:{validate(r,t){return Number.isFinite(r)&&(!("max"in t)||r<=t.max)&&(!("min"in t)||r>=t.min)}},array:{validate(r,t){return Array.isArray(r)||ArrayBuffer.isView(r)}}};function r9(r){const t={};for(const e in r){const n=r[e],i=n9(n);t[e]=i}return t}function n9(r){let t=d5(r);return t==="object"?r?"type"in r?Object.assign({},r,_v[r.type]):"value"in r?(t=d5(r.value),Object.assign({type:t},r,_v[t])):{type:"object",value:r}:{type:"object",value:null}:Object.assign({type:t,value:r},_v[t])}function d5(r){return Array.isArray(r)||ArrayBuffer.isView(r)?"array":typeof r}const i9="vs",s9="fs";class f5{constructor(t){let{name:e,vs:n,fs:i,dependencies:s=[],uniforms:a,getUniforms:o,deprecations:h=[],defines:f={},inject:g={},vertexShader:b,fragmentShader:C}=t;Pa(typeof e=="string"),this.name=e,this.vs=n||b,this.fs=i||C,this.getModuleUniforms=o,this.dependencies=s,this.deprecations=this._parseDeprecationDefinitions(h),this.defines=f,this.injections=o9(g),a&&(this.uniforms=r9(a))}getModuleSource(t){let e;switch(t){case i9:e=this.vs||"";break;case s9:e=this.fs||"";break;default:Pa(!1)}return"#define MODULE_".concat(this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_"),`
`).concat(e,"// END MODULE_").concat(this.name,`

`)}getUniforms(t,e){return this.getModuleUniforms?this.getModuleUniforms(t,e):this.uniforms?this._defaultGetUniforms(t):{}}getDefines(){return this.defines}checkDeprecations(t,e){this.deprecations.forEach(n=>{n.regex.test(t)&&(n.deprecated?e.deprecated(n.old,n.new)():e.removed(n.old,n.new)())})}_parseDeprecationDefinitions(t){return t.forEach(e=>{switch(e.type){case"function":e.regex=new RegExp("\\b".concat(e.old,"\\("));break;default:e.regex=new RegExp("".concat(e.type," ").concat(e.old,";"))}}),t}_defaultGetUniforms(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e={},n=this.uniforms;for(const i in n){const s=n[i];i in t&&!s.private?(s.validate&&Pa(s.validate(t[i],s),"".concat(this.name,": invalid ").concat(i)),e[i]=t[i]):e[i]=s.value}return e}}function o9(r){const t={vs:{},fs:{}};for(const e in r){let n=r[e];const i=e.slice(0,2);typeof n=="string"&&(n={order:0,injection:n}),t[i][e]=n}return t}function a9(r){return c9(g5(r))}function c9(r){const t={},e={};return p5({modules:r,level:0,moduleMap:t,moduleDepth:e}),Object.keys(e).sort((n,i)=>e[i]-e[n]).map(n=>t[n])}function p5(r){let{modules:t,level:e,moduleMap:n,moduleDepth:i}=r;if(e>=5)throw new Error("Possible loop in shader dependency graph");for(const s of t)n[s.name]=s,(i[s.name]===void 0||i[s.name]<e)&&(i[s.name]=e);for(const s of t)s.dependencies&&p5({modules:s.dependencies,level:e+1,moduleMap:n,moduleDepth:i})}function g5(r,t){return r.map(e=>(e instanceof f5||(Pa(typeof e!="string","Shader module use by name is deprecated. Import shader module '".concat(e,"' and use it directly.")),Pa(e.name,"shader module has no name"),e=new f5(e),e.dependencies=g5(e.dependencies)),e))}function l9(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=typeof window<"u"?window.navigator||{}:{},e=r.userAgent||t.userAgent||"",n=e.indexOf("MSIE ")!==-1,i=e.indexOf("Trident/")!==-1;return n||i}const A9=7936,u9=7937,h9=7938,d9=35724,vv={GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},gh={};Object.keys(vv).forEach(r=>{gh[r]=r});function f9(r){return typeof WebGL2RenderingContext<"u"&&r instanceof WebGL2RenderingContext?!0:!!(r&&r._version===2)}function p9(r){const t=r.getExtension("WEBGL_debug_renderer_info"),e=r.getParameter(t&&t.UNMASKED_VENDOR_WEBGL||A9),n=r.getParameter(t&&t.UNMASKED_RENDERER_WEBGL||u9);return{gpuVendor:g9(e,n),vendor:e,renderer:n,version:r.getParameter(h9),shadingLanguageVersion:r.getParameter(d9)}}function g9(r,t){return r.match(/NVIDIA/i)||t.match(/NVIDIA/i)?"NVIDIA":r.match(/INTEL/i)||t.match(/INTEL/i)?"INTEL":r.match(/AMD/i)||t.match(/AMD/i)||r.match(/ATI/i)||t.match(/ATI/i)?"AMD":"UNKNOWN GPU"}const bv={};function m5(r,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const n=vv[t];if(Pa(n,t),!l9(e))return!0;if(t in bv)return bv[t];const i=n[0],s=e.behavior||"enable",a="#extension GL_".concat(i," : ").concat(s,`
void main(void) {}`),o=r.createShader(35633);r.shaderSource(o,a),r.compileShader(o);const h=r.getShaderParameter(o,35713);return r.deleteShader(o),bv[t]=h,h}function m9(r,t){const e=vv[t];Pa(e,t);const n=f9(r)&&e[1]||e[0],i=typeof n=="string"?!!r.getExtension(n):n;return Pa(i===!1||i===!0),i}function Km(r,t){return t=Array.isArray(t)?t:[t],t.every(e=>m9(r,e))}function y9(r){switch(p9(r).gpuVendor.toLowerCase()){case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function _9(r,t,e){let n=`#if (__VERSION__ > 120)

# define FEATURE_GLSL_DERIVATIVES
# define FEATURE_GLSL_DRAW_BUFFERS
# define FEATURE_GLSL_FRAG_DEPTH
# define FEATURE_GLSL_TEXTURE_LOD

// DEPRECATED FLAGS, remove in v9
# define FRAG_DEPTH
# define DERIVATIVES
# define DRAW_BUFFERS
# define TEXTURE_LOD

#endif // __VERSION
`;return Km(r,gh.GLSL_FRAG_DEPTH)&&(n+=`
// FRAG_DEPTH => gl_FragDepth is available
#ifdef GL_EXT_frag_depth
#extension GL_EXT_frag_depth : enable
# define FEATURE_GLSL_FRAG_DEPTH
# define FRAG_DEPTH
# define gl_FragDepth gl_FragDepthEXT
#endif
`),Km(r,gh.GLSL_DERIVATIVES)&&m5(r,gh.GLSL_DERIVATIVES)&&(n+=`
// DERIVATIVES => dxdF, dxdY and fwidth are available
#ifdef GL_OES_standard_derivatives
#extension GL_OES_standard_derivatives : enable
# define FEATURE_GLSL_DERIVATIVES
# define DERIVATIVES
#endif
`),Km(r,gh.GLSL_FRAG_DATA)&&m5(r,gh.GLSL_FRAG_DATA,{behavior:"require"})&&(n+=`
// DRAW_BUFFERS => gl_FragData[] is available
#ifdef GL_EXT_draw_buffers
#extension GL_EXT_draw_buffers : require
#define FEATURE_GLSL_DRAW_BUFFERS
#define DRAW_BUFFERS
#endif
`),Km(r,gh.GLSL_TEXTURE_LOD)&&(n+=`// TEXTURE_LOD => texture2DLod etc are available
#ifdef GL_EXT_shader_texture_lod
#extension GL_EXT_shader_texture_lod : enable

# define FEATURE_GLSL_TEXTURE_LOD
# define TEXTURE_LOD

#endif
`),n}const v9=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,b9=`#ifdef MODULE_MATERIAL
  gl_FragColor = material_filterColor(gl_FragColor);
#endif

#ifdef MODULE_LIGHTING
  gl_FragColor = lighting_filterColor(gl_FragColor);
#endif

#ifdef MODULE_FOG
  gl_FragColor = fog_filterColor(gl_FragColor);
#endif

#ifdef MODULE_PICKING
  gl_FragColor = picking_filterHighlightColor(gl_FragColor);
  gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,w9={[Ep]:v9,[yv]:b9},$m="__LUMA_INJECT_DECLARATIONS__",y5=/void\s+main\s*\([^)]*\)\s*\{\n?/,_5=/}\n?[^{}]*$/,wv=[];function v5(r,t,e){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const i=t===Ep;for(const s in e){const a=e[s];a.sort((h,f)=>h.order-f.order),wv.length=a.length;for(let h=0,f=a.length;h<f;++h)wv[h]=a[h].injection;const o="".concat(wv.join(`
`),`
`);switch(s){case"vs:#decl":i&&(r=r.replace($m,o));break;case"vs:#main-start":i&&(r=r.replace(y5,h=>h+o));break;case"vs:#main-end":i&&(r=r.replace(_5,h=>o+h));break;case"fs:#decl":i||(r=r.replace($m,o));break;case"fs:#main-start":i||(r=r.replace(y5,h=>h+o));break;case"fs:#main-end":i||(r=r.replace(_5,h=>o+h));break;default:r=r.replace(s,h=>h+o)}}return r=r.replace($m,""),n&&(r=r.replace(/\}\s*$/,s=>s+w9[t])),r}function xv(r){const t={};return Pa(Array.isArray(r)&&r.length>1),r.forEach(e=>{for(const n in e)t[n]=t[n]?"".concat(t[n],`
`).concat(e[n]):e[n]}),t}function Id(r){return new RegExp("\\b".concat(r,"[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)"),"g")}const b5=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],x9=[...b5,[Id("attribute"),"in $1"],[Id("varying"),"out $1"]],B9=[...b5,[Id("varying"),"in $1"]],w5=[[/^#version[ \t]+300[ \t]+es/,"#version 100"],[/\btexture(2D|2DProj|Cube)Lod\(/g,"texture$1LodEXT("],[/\btexture\(/g,"texture2D("],[/\btextureLod\(/g,"texture2DLodEXT("]],C9=[...w5,[Id("in"),"attribute $1"],[Id("out"),"varying $1"]],E9=[...w5,[Id("in"),"varying $1"]],Bv="gl_FragColor",Cv=/\bout[ \t]+vec4[ \t]+(\w+)[ \t]*;\n?/,S9=/void\s+main\s*\([^)]*\)\s*\{\n?/;function T9(r,t,e){switch(t){case 300:return e?Wm(r,x9):I9(r);case 100:return e?Wm(r,C9):L9(r);default:throw new Error("unknown GLSL version ".concat(t))}}function Wm(r,t){for(const[e,n]of t)r=r.replace(e,n);return r}function I9(r){r=Wm(r,B9);const t=r.match(Cv);if(t){const e=t[1];r=r.replace(new RegExp("\\b".concat(Bv,"\\b"),"g"),e)}else{const e="fragmentColor";r=r.replace(S9,n=>"out vec4 ".concat(e,`;
`).concat(n)).replace(new RegExp("\\b".concat(Bv,"\\b"),"g"),e)}return r}function L9(r){r=Wm(r,E9);const t=r.match(Cv);if(t){const e=t[1];r=r.replace(Cv,"").replace(new RegExp("\\b".concat(e,"\\b"),"g"),Bv)}return r}const F9=`

`.concat($m,`

`),x5={[Ep]:"vertex",[yv]:"fragment"},M9=`precision highp float;

`;function P9(r,t){const{vs:e,fs:n}=t,i=a9(t.modules||[]);return{gl:r,vs:B5(r,Object.assign({},t,{source:e,type:Ep,modules:i})),fs:B5(r,Object.assign({},t,{source:n,type:yv,modules:i})),getUniforms:U9(i)}}function B5(r,t){let{id:e,source:n,type:i,modules:s,defines:a={},hookFunctions:o=[],inject:h={},transpileToGLSL100:f=!1,prologue:g=!0,log:b}=t;Pa(typeof n=="string","shader source must be a string");const C=i===Ep,B=n.split(`
`);let R=100,D="",Q=n;B[0].indexOf("#version ")===0?(R=300,D=B[0],Q=B.slice(1).join(`
`)):D="#version ".concat(R);const k={};s.forEach(yt=>{Object.assign(k,yt.getDefines())}),Object.assign(k,a);let j=g?"".concat(D,`
`).concat(D9({id:e,source:n,type:i}),`
`).concat(R9({type:i}),`
`).concat(y9(r),`
`).concat(_9(r),`
`).concat(O9(k),`
`).concat(C?"":M9,`
`):"".concat(D,`
`);const et=k9(o),st={},mt={},pt={};for(const yt in h){const ft=typeof h[yt]=="string"?{injection:h[yt],order:0}:h[yt],Dt=yt.match(/^(v|f)s:(#)?([\w-]+)$/);if(Dt){const It=Dt[2],ut=Dt[3];It?ut==="decl"?mt[yt]=[ft]:pt[yt]=[ft]:st[yt]=[ft]}else pt[yt]=[ft]}for(const yt of s){b&&yt.checkDeprecations(Q,b);const ft=yt.getModuleSource(i,R);j+=ft;const Dt=yt.injections[i];for(const It in Dt){const ut=It.match(/^(v|f)s:#([\w-]+)$/);if(ut){const Bt=ut[2]==="decl"?mt:pt;Bt[It]=Bt[It]||[],Bt[It].push(Dt[It])}else st[It]=st[It]||[],st[It].push(Dt[It])}}return j+=F9,j=v5(j,i,mt),j+=N9(et[i],st),j+=Q,j=v5(j,i,pt),j=T9(j,f?100:R,C),j}function U9(r){return function(e){const n={};for(const i of r){const s=i.getUniforms(e,n);Object.assign(n,s)}return n}}function R9(r){let{type:t}=r;return`
#define SHADER_TYPE_`.concat(x5[t].toUpperCase(),`
`)}function D9(r){let{id:t,source:e,type:n}=r;return t&&typeof t=="string"&&e.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME `.concat(t,"_").concat(x5[n],`

`):""}function O9(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=0,e="";for(const n in r){t===0&&(e+=`
// APPLICATION DEFINES
`),t++;const i=r[n];(i||Number.isFinite(i))&&(e+="#define ".concat(n.toUpperCase()," ").concat(r[n],`
`))}return t===0&&(e+=`
`),e}function N9(r,t){let e="";for(const n in r){const i=r[n];if(e+="void ".concat(i.signature,` {
`),i.header&&(e+="  ".concat(i.header)),t[n]){const s=t[n];s.sort((a,o)=>a.order-o.order);for(const a of s)e+="  ".concat(a.injection,`
`)}i.footer&&(e+="  ".concat(i.footer)),e+=`}
`}return e}function k9(r){const t={vs:{},fs:{}};return r.forEach(e=>{let n;typeof e!="string"?(n=e,e=n.hook):n={},e=e.trim();const[i,s]=e.split(":"),a=e.replace(/\(.+/,"");t[i][a]=Object.assign(n,{signature:s})}),t}const Q9="void main() {gl_FragColor = vec4(0);}",C5=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,z9=`#version 300 es
`.concat(C5);function E5(r,t){t=Array.isArray(t)?t:[t];const e=r.replace(/^\s+/,"").split(/\s+/),[n,i,s]=e;if(!t.includes(n)||!i||!s)return null;const a=s.split(";")[0];return{qualifier:n,type:i,name:a}}function S5(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{version:t=100,input:e,inputType:n,output:i}=r;if(!e)return t===300?z9:t>300?"#version ".concat(t,`
`).concat(C5):Q9;const s=V9(e,n);return t>=300?"#version ".concat(t," ").concat(t===300?"es":"",`
in `).concat(n," ").concat(e,`;
out vec4 `).concat(i,`;
void main() {
  `).concat(i," = ").concat(s,`;
}`):"varying ".concat(n," ").concat(e,`;
void main() {
  gl_FragColor = `).concat(s,`;
}`)}function H9(r){switch(r){case"float":return"x";case"vec2":return"xy";case"vec3":return"xyz";case"vec4":return"xyzw";default:return Pa(!1),null}}function G9(r){switch(r){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;default:return Pa(!1),null}}function V9(r,t){switch(t){case"float":return"vec4(".concat(r,", 0.0, 0.0, 1.0)");case"vec2":return"vec4(".concat(r,", 0.0, 1.0)");case"vec3":return"vec4(".concat(r,", 1.0)");case"vec4":return r;default:return Pa(!1),null}}const j9={name:"fp32",vs:`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,fs:null};function Lc(r,t){if(!r)throw new Error("math.gl assertion ".concat(t))}const q9=1/Math.PI*180,K9=1/180*Math.PI,ws={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0};function $9(r){let{precision:t=ws.precision}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return r=Y9(r),"".concat(parseFloat(r.toPrecision(t)))}function gu(r){return Array.isArray(r)||ArrayBuffer.isView(r)&&!(r instanceof DataView)}function W9(r){return J9(r)}function X9(r){return xA(r)}function J9(r,t){return Ev(r,e=>e*K9,t)}function xA(r,t){return Ev(r,e=>e*q9,t)}function BA(r,t,e){return Ev(r,n=>Math.max(t,Math.min(e,n)))}function Xm(r,t,e){return gu(r)?r.map((n,i)=>Xm(n,t[i],e)):e*t+(1-e)*r}function Fc(r,t,e){const n=ws.EPSILON;e&&(ws.EPSILON=e);try{if(r===t)return!0;if(gu(r)&&gu(t)){if(r.length!==t.length)return!1;for(let i=0;i<r.length;++i)if(!Fc(r[i],t[i]))return!1;return!0}return r&&r.equals?r.equals(t):t&&t.equals?t.equals(r):typeof r=="number"&&typeof t=="number"?Math.abs(r-t)<=ws.EPSILON*Math.max(1,Math.abs(r),Math.abs(t)):!1}finally{ws.EPSILON=n}}function Y9(r){return Math.round(r/ws.EPSILON)*ws.EPSILON}function Z9(r){return r.clone?r.clone():new Array(r.length)}function Ev(r,t,e){if(gu(r)){const n=r;e=e||Z9(n);for(let i=0;i<e.length&&i<n.length;++i)e[i]=t(r[i],i,e);return e}return t(r)}function t7(r){function t(){var e=Reflect.construct(r,Array.from(arguments));return Object.setPrototypeOf(e,Object.getPrototypeOf(this)),e}return t.prototype=Object.create(r.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r,t}class Sv extends t7(Array){clone(){return new this.constructor().copy(this)}fromArray(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;for(let n=0;n<this.ELEMENTS;++n)this[n]=t[n+e];return this.check()}toArray(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;for(let n=0;n<this.ELEMENTS;++n)t[e+n]=this[n];return t}from(t){return Array.isArray(t)?this.copy(t):this.fromObject(t)}to(t){return t===this?this:gu(t)?this.toArray(t):this.toObject(t)}toTarget(t){return t?this.to(t):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(ws)}formatString(t){let e="";for(let n=0;n<this.ELEMENTS;++n)e+=(n>0?", ":"")+$9(this[n],t);return"".concat(t.printTypes?this.constructor.name:"","[").concat(e,"]")}equals(t){if(!t||this.length!==t.length)return!1;for(let e=0;e<this.ELEMENTS;++e)if(!Fc(this[e],t[e]))return!1;return!0}exactEquals(t){if(!t||this.length!==t.length)return!1;for(let e=0;e<this.ELEMENTS;++e)if(this[e]!==t[e])return!1;return!0}negate(){for(let t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}lerp(t,e,n){if(n===void 0)return this.lerp(this,t,e);for(let i=0;i<this.ELEMENTS;++i){const s=t[i];this[i]=s+n*(e[i]-s)}return this.check()}min(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=Math.min(t[e],this[e]);return this.check()}max(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=Math.max(t[e],this[e]);return this.check()}clamp(t,e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],t[n]),e[n]);return this.check()}add(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(const i of e)for(let s=0;s<this.ELEMENTS;++s)this[s]+=i[s];return this.check()}subtract(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(const i of e)for(let s=0;s<this.ELEMENTS;++s)this[s]-=i[s];return this.check()}scale(t){if(typeof t=="number")for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;else for(let e=0;e<this.ELEMENTS&&e<t.length;++e)this[e]*=t[e];return this.check()}multiplyByScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}check(){if(ws.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let t=this.length===this.ELEMENTS;for(let e=0;e<this.ELEMENTS;++e)t=t&&Number.isFinite(this[e]);return t}sub(t){return this.subtract(t)}setScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=t;return this.check()}addScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]+=t;return this.check()}subScalar(t){return this.addScalar(-t)}multiplyScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}divideScalar(t){return this.multiplyByScalar(1/t)}clampScalar(t,e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],t),e);return this.check()}get elements(){return this}}function e7(r,t){if(r.length!==t)return!1;for(let e=0;e<r.length;++e)if(!Number.isFinite(r[e]))return!1;return!0}function Gn(r){if(!Number.isFinite(r))throw new Error("Invalid number ".concat(r));return r}function Sp(r,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";if(ws.debug&&!e7(r,t))throw new Error("math.gl: ".concat(e," some fields set to invalid numbers'"));return r}let Tv=class extends Sv{get x(){return this[0]}set x(t){this[0]=Gn(t)}get y(){return this[1]}set y(t){this[1]=Gn(t)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let t=0;for(let e=0;e<this.ELEMENTS;++e)t+=this[e]*this[e];return t}magnitudeSquared(){return this.lengthSquared()}distance(t){return Math.sqrt(this.distanceSquared(t))}distanceSquared(t){let e=0;for(let n=0;n<this.ELEMENTS;++n){const i=this[n]-t[n];e+=i*i}return Gn(e)}dot(t){let e=0;for(let n=0;n<this.ELEMENTS;++n)e+=this[n]*t[n];return Gn(e)}normalize(){const t=this.magnitude();if(t!==0)for(let e=0;e<this.ELEMENTS;++e)this[e]/=t;return this.check()}multiply(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(const i of e)for(let s=0;s<this.ELEMENTS;++s)this[s]*=i[s];return this.check()}divide(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(const i of e)for(let s=0;s<this.ELEMENTS;++s)this[s]/=i[s];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(t){return this.distance(t)}distanceToSquared(t){return this.distanceSquared(t)}getComponent(t){return Lc(t>=0&&t<this.ELEMENTS,"index is out of range"),Gn(this[t])}setComponent(t,e){return Lc(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=e,this.check()}addVectors(t,e){return this.copy(t).add(e)}subVectors(t,e){return this.copy(t).subtract(e)}multiplyVectors(t,e){return this.copy(t).multiply(e)}addScaledVector(t,e){return this.add(new this.constructor(t).multiplyScalar(e))}};var Tp=1e-6,Mc=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var r=0,t=arguments.length;t--;)r+=arguments[t]*arguments[t];return Math.sqrt(r)});function r7(){var r=new Mc(2);return Mc!=Float32Array&&(r[0]=0,r[1]=0),r}function T5(r,t,e){return r[0]=t[0]+e[0],r[1]=t[1]+e[1],r}function n7(r,t){return r[0]=-t[0],r[1]=-t[1],r}function I5(r,t,e,n){var i=t[0],s=t[1];return r[0]=i+n*(e[0]-i),r[1]=s+n*(e[1]-s),r}function i7(r,t,e){var n=t[0],i=t[1];return r[0]=e[0]*n+e[2]*i,r[1]=e[1]*n+e[3]*i,r}function s7(r,t,e){var n=t[0],i=t[1];return r[0]=e[0]*n+e[2]*i+e[4],r[1]=e[1]*n+e[3]*i+e[5],r}function L5(r,t,e){var n=t[0],i=t[1];return r[0]=e[0]*n+e[3]*i+e[6],r[1]=e[1]*n+e[4]*i+e[7],r}function F5(r,t,e){var n=t[0],i=t[1];return r[0]=e[0]*n+e[4]*i+e[12],r[1]=e[1]*n+e[5]*i+e[13],r}(function(){var r=r7();return function(t,e,n,i,s,a){var o,h;for(e||(e=2),n||(n=0),i?h=Math.min(i*e+n,t.length):h=t.length,o=n;o<h;o+=e)r[0]=t[o],r[1]=t[o+1],s(r,r,a),t[o]=r[0],t[o+1]=r[1];return t}})();function M5(r,t,e){const n=t[0],i=t[1],s=e[3]*n+e[7]*i||1;return r[0]=(e[0]*n+e[4]*i)/s,r[1]=(e[1]*n+e[5]*i)/s,r}function P5(r,t,e){const n=t[0],i=t[1],s=t[2],a=e[3]*n+e[7]*i+e[11]*s||1;return r[0]=(e[0]*n+e[4]*i+e[8]*s)/a,r[1]=(e[1]*n+e[5]*i+e[9]*s)/a,r[2]=(e[2]*n+e[6]*i+e[10]*s)/a,r}function o7(r,t,e){const n=t[0],i=t[1];return r[0]=e[0]*n+e[2]*i,r[1]=e[1]*n+e[3]*i,r[2]=t[2],r}function a7(r,t,e){const n=t[0],i=t[1];return r[0]=e[0]*n+e[2]*i,r[1]=e[1]*n+e[3]*i,r[2]=t[2],r[3]=t[3],r}function U5(r,t,e){const n=t[0],i=t[1],s=t[2];return r[0]=e[0]*n+e[3]*i+e[6]*s,r[1]=e[1]*n+e[4]*i+e[7]*s,r[2]=e[2]*n+e[5]*i+e[8]*s,r[3]=t[3],r}class Iv extends Tv{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;super(2),gu(t)&&arguments.length===1?this.copy(t):(ws.debug&&(Gn(t),Gn(e)),this[0]=t,this[1]=e)}set(t,e){return this[0]=t,this[1]=e,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this.check()}fromObject(t){return ws.debug&&(Gn(t.x),Gn(t.y)),this[0]=t.x,this[1]=t.y,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return F5(this,this,t),this.check()}transformAsVector(t){return M5(this,this,t),this.check()}transformByMatrix3(t){return L5(this,this,t),this.check()}transformByMatrix2x3(t){return s7(this,this,t),this.check()}transformByMatrix2(t){return i7(this,this,t),this.check()}}function R5(){var r=new Mc(3);return Mc!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function D5(r){var t=r[0],e=r[1],n=r[2];return Math.hypot(t,e,n)}function O5(r,t,e){var n=new Mc(3);return n[0]=r,n[1]=t,n[2]=e,n}function c7(r,t,e){return r[0]=t[0]-e[0],r[1]=t[1]-e[1],r[2]=t[2]-e[2],r}function l7(r,t){return r[0]=-t[0],r[1]=-t[1],r[2]=-t[2],r}function A7(r,t){var e=t[0],n=t[1],i=t[2],s=e*e+n*n+i*i;return s>0&&(s=1/Math.sqrt(s)),r[0]=t[0]*s,r[1]=t[1]*s,r[2]=t[2]*s,r}function Lv(r,t){return r[0]*t[0]+r[1]*t[1]+r[2]*t[2]}function Jm(r,t,e){var n=t[0],i=t[1],s=t[2],a=e[0],o=e[1],h=e[2];return r[0]=i*h-s*o,r[1]=s*a-n*h,r[2]=n*o-i*a,r}function Fv(r,t,e){var n=t[0],i=t[1],s=t[2],a=e[3]*n+e[7]*i+e[11]*s+e[15];return a=a||1,r[0]=(e[0]*n+e[4]*i+e[8]*s+e[12])/a,r[1]=(e[1]*n+e[5]*i+e[9]*s+e[13])/a,r[2]=(e[2]*n+e[6]*i+e[10]*s+e[14])/a,r}function N5(r,t,e){var n=t[0],i=t[1],s=t[2];return r[0]=n*e[0]+i*e[3]+s*e[6],r[1]=n*e[1]+i*e[4]+s*e[7],r[2]=n*e[2]+i*e[5]+s*e[8],r}function k5(r,t,e){var n=e[0],i=e[1],s=e[2],a=e[3],o=t[0],h=t[1],f=t[2],g=i*f-s*h,b=s*o-n*f,C=n*h-i*o,B=i*C-s*b,R=s*g-n*C,D=n*b-i*g,Q=a*2;return g*=Q,b*=Q,C*=Q,B*=2,R*=2,D*=2,r[0]=o+g+B,r[1]=h+b+R,r[2]=f+C+D,r}function u7(r,t,e,n){var i=[],s=[];return i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],s[0]=i[0],s[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),s[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),r[0]=s[0]+e[0],r[1]=s[1]+e[1],r[2]=s[2]+e[2],r}function h7(r,t,e,n){var i=[],s=[];return i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],s[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),s[1]=i[1],s[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),r[0]=s[0]+e[0],r[1]=s[1]+e[1],r[2]=s[2]+e[2],r}function d7(r,t,e,n){var i=[],s=[];return i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],s[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),s[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),s[2]=i[2],r[0]=s[0]+e[0],r[1]=s[1]+e[1],r[2]=s[2]+e[2],r}function f7(r,t){var e=r[0],n=r[1],i=r[2],s=t[0],a=t[1],o=t[2],h=Math.sqrt(e*e+n*n+i*i),f=Math.sqrt(s*s+a*a+o*o),g=h*f,b=g&&Lv(r,t)/g;return Math.acos(Math.min(Math.max(b,-1),1))}var p7=c7,g7=D5;(function(){var r=R5();return function(t,e,n,i,s,a){var o,h;for(e||(e=3),n||(n=0),i?h=Math.min(i*e+n,t.length):h=t.length,o=n;o<h;o+=e)r[0]=t[o],r[1]=t[o+1],r[2]=t[o+2],s(r,r,a),t[o]=r[0],t[o+1]=r[1],t[o+2]=r[2];return t}})();const Mv=[0,0,0];let Ym;class ue extends Tv{static get ZERO(){return Ym||(Ym=new ue(0,0,0),Object.freeze(Ym)),Ym}constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;super(-0,-0,-0),arguments.length===1&&gu(t)?this.copy(t):(ws.debug&&(Gn(t),Gn(e),Gn(n)),this[0]=t,this[1]=e,this[2]=n)}set(t,e,n){return this[0]=t,this[1]=e,this[2]=n,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.check()}fromObject(t){return ws.debug&&(Gn(t.x),Gn(t.y),Gn(t.z)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t}get ELEMENTS(){return 3}get z(){return this[2]}set z(t){this[2]=Gn(t)}angle(t){return f7(this,t)}cross(t){return Jm(this,this,t),this.check()}rotateX(t){let{radians:e,origin:n=Mv}=t;return u7(this,this,n,e),this.check()}rotateY(t){let{radians:e,origin:n=Mv}=t;return h7(this,this,n,e),this.check()}rotateZ(t){let{radians:e,origin:n=Mv}=t;return d7(this,this,n,e),this.check()}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return Fv(this,this,t),this.check()}transformAsVector(t){return P5(this,this,t),this.check()}transformByMatrix3(t){return N5(this,this,t),this.check()}transformByMatrix2(t){return o7(this,this,t),this.check()}transformByQuaternion(t){return k5(this,this,t),this.check()}}let Zm;class Pv extends Tv{static get ZERO(){return Zm||(Zm=new Pv(0,0,0,0),Object.freeze(Zm)),Zm}constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;super(-0,-0,-0,-0),gu(t)&&arguments.length===1?this.copy(t):(ws.debug&&(Gn(t),Gn(e),Gn(n),Gn(i)),this[0]=t,this[1]=e,this[2]=n,this[3]=i)}set(t,e,n,i){return this[0]=t,this[1]=e,this[2]=n,this[3]=i,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}fromObject(t){return ws.debug&&(Gn(t.x),Gn(t.y),Gn(t.z),Gn(t.w)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this[3]=t.w,this}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t.w=this[3],t}get ELEMENTS(){return 4}get z(){return this[2]}set z(t){this[2]=Gn(t)}get w(){return this[3]}set w(t){this[3]=Gn(t)}transform(t){return Fv(this,this,t),this.check()}transformByMatrix3(t){return U5(this,this,t),this.check()}transformByMatrix2(t){return a7(this,this,t),this.check()}transformByQuaternion(t){return k5(this,this,t),this.check()}applyMatrix4(t){return t.transform(this,this),this}}class Q5 extends Sv{toString(){let t="[";if(ws.printRowMajor){t+="row-major:";for(let e=0;e<this.RANK;++e)for(let n=0;n<this.RANK;++n)t+=" ".concat(this[n*this.RANK+e])}else{t+="column-major:";for(let e=0;e<this.ELEMENTS;++e)t+=" ".concat(this[e])}return t+="]",t}getElementIndex(t,e){return e*this.RANK+t}getElement(t,e){return this[e*this.RANK+t]}setElement(t,e,n){return this[e*this.RANK+t]=Gn(n),this}getColumn(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Array(this.RANK).fill(-0);const n=t*this.RANK;for(let i=0;i<this.RANK;++i)e[i]=this[n+i];return e}setColumn(t,e){const n=t*this.RANK;for(let i=0;i<this.RANK;++i)this[n+i]=e[i];return this}}function m7(){var r=new Mc(9);return Mc!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r}function y7(r,t){if(r===t){var e=t[1],n=t[2],i=t[5];r[1]=t[3],r[2]=t[6],r[3]=e,r[5]=t[7],r[6]=n,r[7]=i}else r[0]=t[0],r[1]=t[3],r[2]=t[6],r[3]=t[1],r[4]=t[4],r[5]=t[7],r[6]=t[2],r[7]=t[5],r[8]=t[8];return r}function _7(r,t){var e=t[0],n=t[1],i=t[2],s=t[3],a=t[4],o=t[5],h=t[6],f=t[7],g=t[8],b=g*a-o*f,C=-g*s+o*h,B=f*s-a*h,R=e*b+n*C+i*B;return R?(R=1/R,r[0]=b*R,r[1]=(-g*n+i*f)*R,r[2]=(o*n-i*a)*R,r[3]=C*R,r[4]=(g*e-i*h)*R,r[5]=(-o*e+i*s)*R,r[6]=B*R,r[7]=(-f*e+n*h)*R,r[8]=(a*e-n*s)*R,r):null}function v7(r){var t=r[0],e=r[1],n=r[2],i=r[3],s=r[4],a=r[5],o=r[6],h=r[7],f=r[8];return t*(f*s-a*h)+e*(-f*i+a*o)+n*(h*i-s*o)}function z5(r,t,e){var n=t[0],i=t[1],s=t[2],a=t[3],o=t[4],h=t[5],f=t[6],g=t[7],b=t[8],C=e[0],B=e[1],R=e[2],D=e[3],Q=e[4],k=e[5],j=e[6],et=e[7],st=e[8];return r[0]=C*n+B*a+R*f,r[1]=C*i+B*o+R*g,r[2]=C*s+B*h+R*b,r[3]=D*n+Q*a+k*f,r[4]=D*i+Q*o+k*g,r[5]=D*s+Q*h+k*b,r[6]=j*n+et*a+st*f,r[7]=j*i+et*o+st*g,r[8]=j*s+et*h+st*b,r}function b7(r,t,e){var n=t[0],i=t[1],s=t[2],a=t[3],o=t[4],h=t[5],f=t[6],g=t[7],b=t[8],C=e[0],B=e[1];return r[0]=n,r[1]=i,r[2]=s,r[3]=a,r[4]=o,r[5]=h,r[6]=C*n+B*a+f,r[7]=C*i+B*o+g,r[8]=C*s+B*h+b,r}function w7(r,t,e){var n=t[0],i=t[1],s=t[2],a=t[3],o=t[4],h=t[5],f=t[6],g=t[7],b=t[8],C=Math.sin(e),B=Math.cos(e);return r[0]=B*n+C*a,r[1]=B*i+C*o,r[2]=B*s+C*h,r[3]=B*a-C*n,r[4]=B*o-C*i,r[5]=B*h-C*s,r[6]=f,r[7]=g,r[8]=b,r}function H5(r,t,e){var n=e[0],i=e[1];return r[0]=n*t[0],r[1]=n*t[1],r[2]=n*t[2],r[3]=i*t[3],r[4]=i*t[4],r[5]=i*t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r}function x7(r,t){var e=t[0],n=t[1],i=t[2],s=t[3],a=e+e,o=n+n,h=i+i,f=e*a,g=n*a,b=n*o,C=i*a,B=i*o,R=i*h,D=s*a,Q=s*o,k=s*h;return r[0]=1-b-R,r[3]=g-k,r[6]=C+Q,r[1]=g+k,r[4]=1-f-R,r[7]=B-D,r[2]=C-Q,r[5]=B+D,r[8]=1-f-b,r}var Uv;(function(r){r[r.COL0ROW0=0]="COL0ROW0",r[r.COL0ROW1=1]="COL0ROW1",r[r.COL0ROW2=2]="COL0ROW2",r[r.COL1ROW0=3]="COL1ROW0",r[r.COL1ROW1=4]="COL1ROW1",r[r.COL1ROW2=5]="COL1ROW2",r[r.COL2ROW0=6]="COL2ROW0",r[r.COL2ROW1=7]="COL2ROW1",r[r.COL2ROW2=8]="COL2ROW2"})(Uv||(Uv={}));const B7=Object.freeze([1,0,0,0,1,0,0,0,1]);class Ni extends Q5{static get IDENTITY(){return E7()}static get ZERO(){return C7()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return Uv}constructor(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(t)?this.copy(t):n.length>0?this.copy([t,...n]):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this.check()}identity(){return this.copy(B7)}fromObject(t){return this.check()}fromQuaternion(t){return x7(this,t),this.check()}set(t,e,n,i,s,a,o,h,f){return this[0]=t,this[1]=e,this[2]=n,this[3]=i,this[4]=s,this[5]=a,this[6]=o,this[7]=h,this[8]=f,this.check()}setRowMajor(t,e,n,i,s,a,o,h,f){return this[0]=t,this[1]=i,this[2]=o,this[3]=e,this[4]=s,this[5]=h,this[6]=n,this[7]=a,this[8]=f,this.check()}determinant(){return v7(this)}transpose(){return y7(this,this),this.check()}invert(){return _7(this,this),this.check()}multiplyLeft(t){return z5(this,t,this),this.check()}multiplyRight(t){return z5(this,this,t),this.check()}rotate(t){return w7(this,this,t),this.check()}scale(t){return Array.isArray(t)?H5(this,this,t):H5(this,this,[t,t]),this.check()}translate(t){return b7(this,this,t),this.check()}transform(t,e){let n;switch(t.length){case 2:n=L5(e||[-0,-0],t,this);break;case 3:n=N5(e||[-0,-0,-0],t,this);break;case 4:n=U5(e||[-0,-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return Sp(n,t.length),n}transformVector(t,e){return this.transform(t,e)}transformVector2(t,e){return this.transform(t,e)}transformVector3(t,e){return this.transform(t,e)}}let t0,e0;function C7(){return t0||(t0=new Ni([0,0,0,0,0,0,0,0,0]),Object.freeze(t0)),t0}function E7(){return e0||(e0=new Ni,Object.freeze(e0)),e0}function S7(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function T7(r,t){if(r===t){var e=t[1],n=t[2],i=t[3],s=t[6],a=t[7],o=t[11];r[1]=t[4],r[2]=t[8],r[3]=t[12],r[4]=e,r[6]=t[9],r[7]=t[13],r[8]=n,r[9]=s,r[11]=t[14],r[12]=i,r[13]=a,r[14]=o}else r[0]=t[0],r[1]=t[4],r[2]=t[8],r[3]=t[12],r[4]=t[1],r[5]=t[5],r[6]=t[9],r[7]=t[13],r[8]=t[2],r[9]=t[6],r[10]=t[10],r[11]=t[14],r[12]=t[3],r[13]=t[7],r[14]=t[11],r[15]=t[15];return r}function Rv(r,t){var e=t[0],n=t[1],i=t[2],s=t[3],a=t[4],o=t[5],h=t[6],f=t[7],g=t[8],b=t[9],C=t[10],B=t[11],R=t[12],D=t[13],Q=t[14],k=t[15],j=e*o-n*a,et=e*h-i*a,st=e*f-s*a,mt=n*h-i*o,pt=n*f-s*o,yt=i*f-s*h,ft=g*D-b*R,Dt=g*Q-C*R,It=g*k-B*R,ut=b*Q-C*D,At=b*k-B*D,Bt=C*k-B*Q,vt=j*Bt-et*At+st*ut+mt*It-pt*Dt+yt*ft;return vt?(vt=1/vt,r[0]=(o*Bt-h*At+f*ut)*vt,r[1]=(i*At-n*Bt-s*ut)*vt,r[2]=(D*yt-Q*pt+k*mt)*vt,r[3]=(C*pt-b*yt-B*mt)*vt,r[4]=(h*It-a*Bt-f*Dt)*vt,r[5]=(e*Bt-i*It+s*Dt)*vt,r[6]=(Q*st-R*yt-k*et)*vt,r[7]=(g*yt-C*st+B*et)*vt,r[8]=(a*At-o*It+f*ft)*vt,r[9]=(n*It-e*At-s*ft)*vt,r[10]=(R*pt-D*st+k*j)*vt,r[11]=(b*st-g*pt-B*j)*vt,r[12]=(o*Dt-a*ut-h*ft)*vt,r[13]=(e*ut-n*Dt+i*ft)*vt,r[14]=(D*et-R*mt-Q*j)*vt,r[15]=(g*mt-b*et+C*j)*vt,r):null}function I7(r){var t=r[0],e=r[1],n=r[2],i=r[3],s=r[4],a=r[5],o=r[6],h=r[7],f=r[8],g=r[9],b=r[10],C=r[11],B=r[12],R=r[13],D=r[14],Q=r[15],k=t*a-e*s,j=t*o-n*s,et=t*h-i*s,st=e*o-n*a,mt=e*h-i*a,pt=n*h-i*o,yt=f*R-g*B,ft=f*D-b*B,Dt=f*Q-C*B,It=g*D-b*R,ut=g*Q-C*R,At=b*Q-C*D;return k*At-j*ut+et*It+st*Dt-mt*ft+pt*yt}function mh(r,t,e){var n=t[0],i=t[1],s=t[2],a=t[3],o=t[4],h=t[5],f=t[6],g=t[7],b=t[8],C=t[9],B=t[10],R=t[11],D=t[12],Q=t[13],k=t[14],j=t[15],et=e[0],st=e[1],mt=e[2],pt=e[3];return r[0]=et*n+st*o+mt*b+pt*D,r[1]=et*i+st*h+mt*C+pt*Q,r[2]=et*s+st*f+mt*B+pt*k,r[3]=et*a+st*g+mt*R+pt*j,et=e[4],st=e[5],mt=e[6],pt=e[7],r[4]=et*n+st*o+mt*b+pt*D,r[5]=et*i+st*h+mt*C+pt*Q,r[6]=et*s+st*f+mt*B+pt*k,r[7]=et*a+st*g+mt*R+pt*j,et=e[8],st=e[9],mt=e[10],pt=e[11],r[8]=et*n+st*o+mt*b+pt*D,r[9]=et*i+st*h+mt*C+pt*Q,r[10]=et*s+st*f+mt*B+pt*k,r[11]=et*a+st*g+mt*R+pt*j,et=e[12],st=e[13],mt=e[14],pt=e[15],r[12]=et*n+st*o+mt*b+pt*D,r[13]=et*i+st*h+mt*C+pt*Q,r[14]=et*s+st*f+mt*B+pt*k,r[15]=et*a+st*g+mt*R+pt*j,r}function r0(r,t,e){var n=e[0],i=e[1],s=e[2],a,o,h,f,g,b,C,B,R,D,Q,k;return t===r?(r[12]=t[0]*n+t[4]*i+t[8]*s+t[12],r[13]=t[1]*n+t[5]*i+t[9]*s+t[13],r[14]=t[2]*n+t[6]*i+t[10]*s+t[14],r[15]=t[3]*n+t[7]*i+t[11]*s+t[15]):(a=t[0],o=t[1],h=t[2],f=t[3],g=t[4],b=t[5],C=t[6],B=t[7],R=t[8],D=t[9],Q=t[10],k=t[11],r[0]=a,r[1]=o,r[2]=h,r[3]=f,r[4]=g,r[5]=b,r[6]=C,r[7]=B,r[8]=R,r[9]=D,r[10]=Q,r[11]=k,r[12]=a*n+g*i+R*s+t[12],r[13]=o*n+b*i+D*s+t[13],r[14]=h*n+C*i+Q*s+t[14],r[15]=f*n+B*i+k*s+t[15]),r}function Dv(r,t,e){var n=e[0],i=e[1],s=e[2];return r[0]=t[0]*n,r[1]=t[1]*n,r[2]=t[2]*n,r[3]=t[3]*n,r[4]=t[4]*i,r[5]=t[5]*i,r[6]=t[6]*i,r[7]=t[7]*i,r[8]=t[8]*s,r[9]=t[9]*s,r[10]=t[10]*s,r[11]=t[11]*s,r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r}function L7(r,t,e,n){var i=n[0],s=n[1],a=n[2],o=Math.hypot(i,s,a),h,f,g,b,C,B,R,D,Q,k,j,et,st,mt,pt,yt,ft,Dt,It,ut,At,Bt,vt,ne;return o<Tp?null:(o=1/o,i*=o,s*=o,a*=o,h=Math.sin(e),f=Math.cos(e),g=1-f,b=t[0],C=t[1],B=t[2],R=t[3],D=t[4],Q=t[5],k=t[6],j=t[7],et=t[8],st=t[9],mt=t[10],pt=t[11],yt=i*i*g+f,ft=s*i*g+a*h,Dt=a*i*g-s*h,It=i*s*g-a*h,ut=s*s*g+f,At=a*s*g+i*h,Bt=i*a*g+s*h,vt=s*a*g-i*h,ne=a*a*g+f,r[0]=b*yt+D*ft+et*Dt,r[1]=C*yt+Q*ft+st*Dt,r[2]=B*yt+k*ft+mt*Dt,r[3]=R*yt+j*ft+pt*Dt,r[4]=b*It+D*ut+et*At,r[5]=C*It+Q*ut+st*At,r[6]=B*It+k*ut+mt*At,r[7]=R*It+j*ut+pt*At,r[8]=b*Bt+D*vt+et*ne,r[9]=C*Bt+Q*vt+st*ne,r[10]=B*Bt+k*vt+mt*ne,r[11]=R*Bt+j*vt+pt*ne,t!==r&&(r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r)}function G5(r,t,e){var n=Math.sin(e),i=Math.cos(e),s=t[4],a=t[5],o=t[6],h=t[7],f=t[8],g=t[9],b=t[10],C=t[11];return t!==r&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[4]=s*i+f*n,r[5]=a*i+g*n,r[6]=o*i+b*n,r[7]=h*i+C*n,r[8]=f*i-s*n,r[9]=g*i-a*n,r[10]=b*i-o*n,r[11]=C*i-h*n,r}function F7(r,t,e){var n=Math.sin(e),i=Math.cos(e),s=t[0],a=t[1],o=t[2],h=t[3],f=t[8],g=t[9],b=t[10],C=t[11];return t!==r&&(r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[0]=s*i-f*n,r[1]=a*i-g*n,r[2]=o*i-b*n,r[3]=h*i-C*n,r[8]=s*n+f*i,r[9]=a*n+g*i,r[10]=o*n+b*i,r[11]=h*n+C*i,r}function V5(r,t,e){var n=Math.sin(e),i=Math.cos(e),s=t[0],a=t[1],o=t[2],h=t[3],f=t[4],g=t[5],b=t[6],C=t[7];return t!==r&&(r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[0]=s*i+f*n,r[1]=a*i+g*n,r[2]=o*i+b*n,r[3]=h*i+C*n,r[4]=f*i-s*n,r[5]=g*i-a*n,r[6]=b*i-o*n,r[7]=C*i-h*n,r}function M7(r,t){var e=t[0],n=t[1],i=t[2],s=t[4],a=t[5],o=t[6],h=t[8],f=t[9],g=t[10];return r[0]=Math.hypot(e,n,i),r[1]=Math.hypot(s,a,o),r[2]=Math.hypot(h,f,g),r}function P7(r,t){var e=t[0],n=t[1],i=t[2],s=t[3],a=e+e,o=n+n,h=i+i,f=e*a,g=n*a,b=n*o,C=i*a,B=i*o,R=i*h,D=s*a,Q=s*o,k=s*h;return r[0]=1-b-R,r[1]=g+k,r[2]=C-Q,r[3]=0,r[4]=g-k,r[5]=1-f-R,r[6]=B+D,r[7]=0,r[8]=C+Q,r[9]=B-D,r[10]=1-f-b,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function U7(r,t,e,n,i,s,a){var o=1/(e-t),h=1/(i-n),f=1/(s-a);return r[0]=s*2*o,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=s*2*h,r[6]=0,r[7]=0,r[8]=(e+t)*o,r[9]=(i+n)*h,r[10]=(a+s)*f,r[11]=-1,r[12]=0,r[13]=0,r[14]=a*s*2*f,r[15]=0,r}function R7(r,t,e,n,i){var s=1/Math.tan(t/2),a;return r[0]=s/e,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=s,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,i!=null&&i!==1/0?(a=1/(n-i),r[10]=(i+n)*a,r[14]=2*i*n*a):(r[10]=-1,r[14]=-2*n),r}var D7=R7;function O7(r,t,e,n,i,s,a){var o=1/(t-e),h=1/(n-i),f=1/(s-a);return r[0]=-2*o,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*h,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*f,r[11]=0,r[12]=(t+e)*o,r[13]=(i+n)*h,r[14]=(a+s)*f,r[15]=1,r}var N7=O7;function k7(r,t,e,n){var i,s,a,o,h,f,g,b,C,B,R=t[0],D=t[1],Q=t[2],k=n[0],j=n[1],et=n[2],st=e[0],mt=e[1],pt=e[2];return Math.abs(R-st)<Tp&&Math.abs(D-mt)<Tp&&Math.abs(Q-pt)<Tp?S7(r):(g=R-st,b=D-mt,C=Q-pt,B=1/Math.hypot(g,b,C),g*=B,b*=B,C*=B,i=j*C-et*b,s=et*g-k*C,a=k*b-j*g,B=Math.hypot(i,s,a),B?(B=1/B,i*=B,s*=B,a*=B):(i=0,s=0,a=0),o=b*a-C*s,h=C*i-g*a,f=g*s-b*i,B=Math.hypot(o,h,f),B?(B=1/B,o*=B,h*=B,f*=B):(o=0,h=0,f=0),r[0]=i,r[1]=o,r[2]=g,r[3]=0,r[4]=s,r[5]=h,r[6]=b,r[7]=0,r[8]=a,r[9]=f,r[10]=C,r[11]=0,r[12]=-(i*R+s*D+a*Q),r[13]=-(o*R+h*D+f*Q),r[14]=-(g*R+b*D+C*Q),r[15]=1,r)}function Q7(){var r=new Mc(4);return Mc!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0,r[3]=0),r}function z7(r,t,e){return r[0]=t[0]+e[0],r[1]=t[1]+e[1],r[2]=t[2]+e[2],r[3]=t[3]+e[3],r}function j5(r,t,e){return r[0]=t[0]*e,r[1]=t[1]*e,r[2]=t[2]*e,r[3]=t[3]*e,r}function H7(r){var t=r[0],e=r[1],n=r[2],i=r[3];return Math.hypot(t,e,n,i)}function G7(r){var t=r[0],e=r[1],n=r[2],i=r[3];return t*t+e*e+n*n+i*i}function V7(r,t){var e=t[0],n=t[1],i=t[2],s=t[3],a=e*e+n*n+i*i+s*s;return a>0&&(a=1/Math.sqrt(a)),r[0]=e*a,r[1]=n*a,r[2]=i*a,r[3]=s*a,r}function j7(r,t){return r[0]*t[0]+r[1]*t[1]+r[2]*t[2]+r[3]*t[3]}function q7(r,t,e,n){var i=t[0],s=t[1],a=t[2],o=t[3];return r[0]=i+n*(e[0]-i),r[1]=s+n*(e[1]-s),r[2]=a+n*(e[2]-a),r[3]=o+n*(e[3]-o),r}function Ip(r,t,e){var n=t[0],i=t[1],s=t[2],a=t[3];return r[0]=e[0]*n+e[4]*i+e[8]*s+e[12]*a,r[1]=e[1]*n+e[5]*i+e[9]*s+e[13]*a,r[2]=e[2]*n+e[6]*i+e[10]*s+e[14]*a,r[3]=e[3]*n+e[7]*i+e[11]*s+e[15]*a,r}function K7(r,t,e){var n=t[0],i=t[1],s=t[2],a=e[0],o=e[1],h=e[2],f=e[3],g=f*n+o*s-h*i,b=f*i+h*n-a*s,C=f*s+a*i-o*n,B=-a*n-o*i-h*s;return r[0]=g*f+B*-a+b*-h-C*-o,r[1]=b*f+B*-o+C*-a-g*-h,r[2]=C*f+B*-h+g*-o-b*-a,r[3]=t[3],r}(function(){var r=Q7();return function(t,e,n,i,s,a){var o,h;for(e||(e=4),n||(n=0),i?h=Math.min(i*e+n,t.length):h=t.length,o=n;o<h;o+=e)r[0]=t[o],r[1]=t[o+1],r[2]=t[o+2],r[3]=t[o+3],s(r,r,a),t[o]=r[0],t[o+1]=r[1],t[o+2]=r[2],t[o+3]=r[3];return t}})();var Ov;(function(r){r[r.COL0ROW0=0]="COL0ROW0",r[r.COL0ROW1=1]="COL0ROW1",r[r.COL0ROW2=2]="COL0ROW2",r[r.COL0ROW3=3]="COL0ROW3",r[r.COL1ROW0=4]="COL1ROW0",r[r.COL1ROW1=5]="COL1ROW1",r[r.COL1ROW2=6]="COL1ROW2",r[r.COL1ROW3=7]="COL1ROW3",r[r.COL2ROW0=8]="COL2ROW0",r[r.COL2ROW1=9]="COL2ROW1",r[r.COL2ROW2=10]="COL2ROW2",r[r.COL2ROW3=11]="COL2ROW3",r[r.COL3ROW0=12]="COL3ROW0",r[r.COL3ROW1=13]="COL3ROW1",r[r.COL3ROW2=14]="COL3ROW2",r[r.COL3ROW3=15]="COL3ROW3"})(Ov||(Ov={}));const $7=45*Math.PI/180,W7=1,Nv=.1,kv=500,X7=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Cn extends Q5{static get IDENTITY(){return Y7()}static get ZERO(){return J7()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return Ov}constructor(t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(t)?this.copy(t):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this[9]=t[9],this[10]=t[10],this[11]=t[11],this[12]=t[12],this[13]=t[13],this[14]=t[14],this[15]=t[15],this.check()}set(t,e,n,i,s,a,o,h,f,g,b,C,B,R,D,Q){return this[0]=t,this[1]=e,this[2]=n,this[3]=i,this[4]=s,this[5]=a,this[6]=o,this[7]=h,this[8]=f,this[9]=g,this[10]=b,this[11]=C,this[12]=B,this[13]=R,this[14]=D,this[15]=Q,this.check()}setRowMajor(t,e,n,i,s,a,o,h,f,g,b,C,B,R,D,Q){return this[0]=t,this[1]=s,this[2]=f,this[3]=B,this[4]=e,this[5]=a,this[6]=g,this[7]=R,this[8]=n,this[9]=o,this[10]=b,this[11]=D,this[12]=i,this[13]=h,this[14]=C,this[15]=Q,this.check()}toRowMajor(t){return t[0]=this[0],t[1]=this[4],t[2]=this[8],t[3]=this[12],t[4]=this[1],t[5]=this[5],t[6]=this[9],t[7]=this[13],t[8]=this[2],t[9]=this[6],t[10]=this[10],t[11]=this[14],t[12]=this[3],t[13]=this[7],t[14]=this[11],t[15]=this[15],t}identity(){return this.copy(X7)}fromObject(t){return this.check()}fromQuaternion(t){return P7(this,t),this.check()}frustum(t){const{left:e,right:n,bottom:i,top:s,near:a=Nv,far:o=kv}=t;return o===1/0?Z7(this,e,n,i,s,a):U7(this,e,n,i,s,a,o),this.check()}lookAt(t){const{eye:e,center:n=[0,0,0],up:i=[0,1,0]}=t;return k7(this,e,n,i),this.check()}ortho(t){const{left:e,right:n,bottom:i,top:s,near:a=Nv,far:o=kv}=t;return N7(this,e,n,i,s,a,o),this.check()}orthographic(t){const{fovy:e=$7,aspect:n=W7,focalDistance:i=1,near:s=Nv,far:a=kv}=t;q5(e);const o=e/2,h=i*Math.tan(o),f=h*n;return this.ortho({left:-f,right:f,bottom:-h,top:h,near:s,far:a})}perspective(t){const{fovy:e=45*Math.PI/180,aspect:n=1,near:i=.1,far:s=500}=t;return q5(e),D7(this,e,n,i,s),this.check()}determinant(){return I7(this)}getScale(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[-0,-0,-0];return t[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),t[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),t[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),t}getTranslation(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[-0,-0,-0];return t[0]=this[12],t[1]=this[13],t[2]=this[14],t}getRotation(t,e){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],e=e||[-0,-0,-0];const n=this.getScale(e),i=1/n[0],s=1/n[1],a=1/n[2];return t[0]=this[0]*i,t[1]=this[1]*s,t[2]=this[2]*a,t[3]=0,t[4]=this[4]*i,t[5]=this[5]*s,t[6]=this[6]*a,t[7]=0,t[8]=this[8]*i,t[9]=this[9]*s,t[10]=this[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}getRotationMatrix3(t,e){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0],e=e||[-0,-0,-0];const n=this.getScale(e),i=1/n[0],s=1/n[1],a=1/n[2];return t[0]=this[0]*i,t[1]=this[1]*s,t[2]=this[2]*a,t[3]=this[4]*i,t[4]=this[5]*s,t[5]=this[6]*a,t[6]=this[8]*i,t[7]=this[9]*s,t[8]=this[10]*a,t}transpose(){return T7(this,this),this.check()}invert(){return Rv(this,this),this.check()}multiplyLeft(t){return mh(this,t,this),this.check()}multiplyRight(t){return mh(this,this,t),this.check()}rotateX(t){return G5(this,this,t),this.check()}rotateY(t){return F7(this,this,t),this.check()}rotateZ(t){return V5(this,this,t),this.check()}rotateXYZ(t){return this.rotateX(t[0]).rotateY(t[1]).rotateZ(t[2])}rotateAxis(t,e){return L7(this,this,t,e),this.check()}scale(t){return Dv(this,this,Array.isArray(t)?t:[t,t,t]),this.check()}translate(t){return r0(this,this,t),this.check()}transform(t,e){return t.length===4?(e=Ip(e||[-0,-0,-0,-0],t,this),Sp(e,4),e):this.transformAsPoint(t,e)}transformAsPoint(t,e){const{length:n}=t;let i;switch(n){case 2:i=F5(e||[-0,-0],t,this);break;case 3:i=Fv(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return Sp(i,t.length),i}transformAsVector(t,e){let n;switch(t.length){case 2:n=M5(e||[-0,-0],t,this);break;case 3:n=P5(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return Sp(n,t.length),n}transformPoint(t,e){return this.transformAsPoint(t,e)}transformVector(t,e){return this.transformAsPoint(t,e)}transformDirection(t,e){return this.transformAsVector(t,e)}makeRotationX(t){return this.identity().rotateX(t)}makeTranslation(t,e,n){return this.identity().translate([t,e,n])}}let n0,i0;function J7(){return n0||(n0=new Cn([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(n0)),n0}function Y7(){return i0||(i0=new Cn,Object.freeze(i0)),i0}function q5(r){if(r>Math.PI*2)throw Error("expected radians")}function Z7(r,t,e,n,i,s){const a=2*s/(e-t),o=2*s/(i-n),h=(e+t)/(e-t),f=(i+n)/(i-n),g=-1,b=-1,C=-2*s;return r[0]=a,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=o,r[6]=0,r[7]=0,r[8]=h,r[9]=f,r[10]=g,r[11]=b,r[12]=0,r[13]=0,r[14]=C,r[15]=0,r}function K5(){var r=new Mc(4);return Mc!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function tG(r){return r[0]=0,r[1]=0,r[2]=0,r[3]=1,r}function $5(r,t,e){e=e*.5;var n=Math.sin(e);return r[0]=n*t[0],r[1]=n*t[1],r[2]=n*t[2],r[3]=Math.cos(e),r}function W5(r,t,e){var n=t[0],i=t[1],s=t[2],a=t[3],o=e[0],h=e[1],f=e[2],g=e[3];return r[0]=n*g+a*o+i*f-s*h,r[1]=i*g+a*h+s*o-n*f,r[2]=s*g+a*f+n*h-i*o,r[3]=a*g-n*o-i*h-s*f,r}function eG(r,t,e){e*=.5;var n=t[0],i=t[1],s=t[2],a=t[3],o=Math.sin(e),h=Math.cos(e);return r[0]=n*h+a*o,r[1]=i*h+s*o,r[2]=s*h-i*o,r[3]=a*h-n*o,r}function rG(r,t,e){e*=.5;var n=t[0],i=t[1],s=t[2],a=t[3],o=Math.sin(e),h=Math.cos(e);return r[0]=n*h-s*o,r[1]=i*h+a*o,r[2]=s*h+n*o,r[3]=a*h-i*o,r}function nG(r,t,e){e*=.5;var n=t[0],i=t[1],s=t[2],a=t[3],o=Math.sin(e),h=Math.cos(e);return r[0]=n*h+i*o,r[1]=i*h-n*o,r[2]=s*h+a*o,r[3]=a*h-s*o,r}function iG(r,t){var e=t[0],n=t[1],i=t[2];return r[0]=e,r[1]=n,r[2]=i,r[3]=Math.sqrt(Math.abs(1-e*e-n*n-i*i)),r}function s0(r,t,e,n){var i=t[0],s=t[1],a=t[2],o=t[3],h=e[0],f=e[1],g=e[2],b=e[3],C,B,R,D,Q;return B=i*h+s*f+a*g+o*b,B<0&&(B=-B,h=-h,f=-f,g=-g,b=-b),1-B>Tp?(C=Math.acos(B),R=Math.sin(C),D=Math.sin((1-n)*C)/R,Q=Math.sin(n*C)/R):(D=1-n,Q=n),r[0]=D*i+Q*h,r[1]=D*s+Q*f,r[2]=D*a+Q*g,r[3]=D*o+Q*b,r}function sG(r,t){var e=t[0],n=t[1],i=t[2],s=t[3],a=e*e+n*n+i*i+s*s,o=a?1/a:0;return r[0]=-e*o,r[1]=-n*o,r[2]=-i*o,r[3]=s*o,r}function oG(r,t){return r[0]=-t[0],r[1]=-t[1],r[2]=-t[2],r[3]=t[3],r}function X5(r,t){var e=t[0]+t[4]+t[8],n;if(e>0)n=Math.sqrt(e+1),r[3]=.5*n,n=.5/n,r[0]=(t[5]-t[7])*n,r[1]=(t[6]-t[2])*n,r[2]=(t[1]-t[3])*n;else{var i=0;t[4]>t[0]&&(i=1),t[8]>t[i*3+i]&&(i=2);var s=(i+1)%3,a=(i+2)%3;n=Math.sqrt(t[i*3+i]-t[s*3+s]-t[a*3+a]+1),r[i]=.5*n,n=.5/n,r[3]=(t[s*3+a]-t[a*3+s])*n,r[s]=(t[s*3+i]+t[i*3+s])*n,r[a]=(t[a*3+i]+t[i*3+a])*n}return r}var aG=z7,cG=j5,lG=j7,AG=q7,uG=H7,hG=G7,J5=V7,dG=function(){var r=R5(),t=O5(1,0,0),e=O5(0,1,0);return function(n,i,s){var a=Lv(i,s);return a<-.999999?(Jm(r,t,i),g7(r)<1e-6&&Jm(r,e,i),A7(r,r),$5(n,r,Math.PI),n):a>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(Jm(r,i,s),n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=1+a,J5(n,n))}}();(function(){var r=K5(),t=K5();return function(e,n,i,s,a,o){return s0(r,n,a,o),s0(t,i,s,o),s0(e,r,t,2*o*(1-o)),e}})(),function(){var r=m7();return function(t,e,n,i){return r[0]=n[0],r[3]=n[1],r[6]=n[2],r[1]=i[0],r[4]=i[1],r[7]=i[2],r[2]=-e[0],r[5]=-e[1],r[8]=-e[2],J5(t,X5(t,r))}}();const fG=[0,0,0,1];class Lp extends Sv{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;super(-0,-0,-0,-0),Array.isArray(t)&&arguments.length===1?this.copy(t):this.set(t,e,n,i)}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}set(t,e,n,i){return this[0]=t,this[1]=e,this[2]=n,this[3]=i,this.check()}fromObject(t){return this[0]=t.x,this[1]=t.y,this[2]=t.z,this[3]=t.w,this.check()}fromMatrix3(t){return X5(this,t),this.check()}fromAxisRotation(t,e){return $5(this,t,e),this.check()}identity(){return tG(this),this.check()}setAxisAngle(t,e){return this.fromAxisRotation(t,e)}get ELEMENTS(){return 4}get x(){return this[0]}set x(t){this[0]=Gn(t)}get y(){return this[1]}set y(t){this[1]=Gn(t)}get z(){return this[2]}set z(t){this[2]=Gn(t)}get w(){return this[3]}set w(t){this[3]=Gn(t)}len(){return uG(this)}lengthSquared(){return hG(this)}dot(t){return lG(this,t)}rotationTo(t,e){return dG(this,t,e),this.check()}add(t){return aG(this,this,t),this.check()}calculateW(){return iG(this,this),this.check()}conjugate(){return oG(this,this),this.check()}invert(){return sG(this,this),this.check()}lerp(t,e,n){return n===void 0?this.lerp(this,t,e):(AG(this,t,e,n),this.check())}multiplyRight(t){return W5(this,this,t),this.check()}multiplyLeft(t){return W5(this,t,this),this.check()}normalize(){const t=this.len(),e=t>0?1/t:0;return this[0]=this[0]*e,this[1]=this[1]*e,this[2]=this[2]*e,this[3]=this[3]*e,t===0&&(this[3]=1),this.check()}rotateX(t){return eG(this,this,t),this.check()}rotateY(t){return rG(this,this,t),this.check()}rotateZ(t){return nG(this,this,t),this.check()}scale(t){return cG(this,this,t),this.check()}slerp(t,e,n){let i,s,a;switch(arguments.length){case 1:({start:i=fG,target:s,ratio:a}=t);break;case 2:i=this,s=t,a=e;break;default:i=t,s=e,a=n}return s0(this,i,s,a),this.check()}transformVector4(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Pv;return K7(e,t,this),Sp(e,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(t,e){return this.setAxisAngle(t,e)}premultiply(t){return this.multiplyLeft(t)}multiply(t){return this.multiplyRight(t)}}const Fp={EPSILON1:.1,EPSILON2:.01,EPSILON3:.001,EPSILON4:1e-4,EPSILON5:1e-5,EPSILON6:1e-6,EPSILON7:1e-7,EPSILON8:1e-8,EPSILON9:1e-9,EPSILON10:1e-10,EPSILON11:1e-11,EPSILON12:1e-12,EPSILON13:1e-13,EPSILON14:1e-14,EPSILON15:1e-15,EPSILON16:1e-16,EPSILON17:1e-17,EPSILON18:1e-18,EPSILON19:1e-19,EPSILON20:1e-20,PI_OVER_TWO:Math.PI/2,PI_OVER_FOUR:Math.PI/4,PI_OVER_SIX:Math.PI/6,TWO_PI:Math.PI*2},Y5=`#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))

struct AmbientLight {
 vec3 color;
};

struct PointLight {
 vec3 color;
 vec3 position;
 vec3 attenuation;
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform AmbientLight lighting_uAmbientLight;
uniform PointLight lighting_uPointLight[MAX_LIGHTS];
uniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];
uniform int lighting_uPointLightCount;
uniform int lighting_uDirectionalLightCount;

uniform bool lighting_uEnabled;

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

#endif
`,pG={lightSources:{}};function Qv(){let{color:r=[0,0,0],intensity:t=1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return r.map(e=>e*t/255)}function gG(r){let{ambientLight:t,pointLights:e=[],directionalLights:n=[]}=r;const i={};return t?i["lighting_uAmbientLight.color"]=Qv(t):i["lighting_uAmbientLight.color"]=[0,0,0],e.forEach((s,a)=>{i["lighting_uPointLight[".concat(a,"].color")]=Qv(s),i["lighting_uPointLight[".concat(a,"].position")]=s.position,i["lighting_uPointLight[".concat(a,"].attenuation")]=s.attenuation||[1,0,0]}),i.lighting_uPointLightCount=e.length,n.forEach((s,a)=>{i["lighting_uDirectionalLight[".concat(a,"].color")]=Qv(s),i["lighting_uDirectionalLight[".concat(a,"].direction")]=s.direction}),i.lighting_uDirectionalLightCount=n.length,i}function Z5(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:pG;if("lightSources"in r){const{ambientLight:t,pointLights:e,directionalLights:n}=r.lightSources||{};return t||e&&e.length>0||n&&n.length>0?Object.assign({},gG({ambientLight:t,pointLights:e,directionalLights:n}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in r){const t={pointLights:[],directionalLights:[]};for(const e of r.lights||[])switch(e.type){case"ambient":t.ambientLight=e;break;case"directional":t.directionalLights.push(e);break;case"point":t.pointLights.push(e);break}return Z5({lightSources:t})}return{}}const zv={name:"lights",vs:Y5,fs:Y5,getUniforms:Z5,defines:{MAX_LIGHTS:3}},mG={pickingSelectedColor:null,pickingHighlightColor:new Uint8Array([0,255,255,255]),pickingActive:!1,pickingAttribute:!1};function yG(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:mG;const t={};if(r.pickingSelectedColor!==void 0)if(!r.pickingSelectedColor)t.picking_uSelectedColorValid=0;else{const e=r.pickingSelectedColor.slice(0,3);t.picking_uSelectedColorValid=1,t.picking_uSelectedColor=e}if(r.pickingHighlightColor){const e=Array.from(r.pickingHighlightColor,n=>n/255);Number.isFinite(e[3])||(e[3]=1),t.picking_uHighlightColor=e}return r.pickingActive!==void 0&&(t.picking_uActive=!!r.pickingActive,t.picking_uAttribute=!!r.pickingAttribute),t}const _G={name:"picking",vs:`uniform bool picking_uActive;
uniform bool picking_uAttribute;
uniform vec3 picking_uSelectedColor;
uniform bool picking_uSelectedColorValid;

out vec4 picking_vRGBcolor_Avalid;

const float COLOR_SCALE = 1. / 255.;

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.001;
}

bool isVertexPicked(vec3 vertexColor) {
  return
    picking_uSelectedColorValid &&
    !picking_isColorValid(abs(vertexColor - picking_uSelectedColor));
}

void picking_setPickingColor(vec3 pickingColor) {
  if (picking_uActive) {
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!picking_uAttribute) {
      picking_vRGBcolor_Avalid.rgb = pickingColor * COLOR_SCALE;
    }
  } else {
    picking_vRGBcolor_Avalid.a = float(isVertexPicked(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.r = value;
  }
}
void picking_setPickingAttribute(vec2 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}
void picking_setPickingAttribute(vec3 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,fs:`uniform bool picking_uActive;
uniform vec3 picking_uSelectedColor;
uniform vec4 picking_uHighlightColor;

in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
  if (picking_uActive) {
    return color;
  }
  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    float highLightAlpha = picking_uHighlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking_uHighlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}
vec4 picking_filterPickingColor(vec4 color) {
  if (picking_uActive) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}
vec4 picking_filterColor(vec4 color) {
  vec4 highightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highightColor);
}

`,getUniforms:yG},tT=`
uniform float lighting_uAmbient;
uniform float lighting_uDiffuse;
uniform float lighting_uShininess;
uniform vec3  lighting_uSpecularColor;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
    vec3 halfway_direction = normalize(light_direction + view_direction);
    float lambertian = dot(light_direction, normal_worldspace);
    float specular = 0.0;
    if (lambertian > 0.0) {
      float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
      specular = pow(specular_angle, lighting_uShininess);
    }
    lambertian = max(lambertian, 0.0);
    return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);
    lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}

vec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = vec3(0, 0, 0);
  vec3 surfaceColor = vec3(0, 0, 0);

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}
`,vG={};function bG(r){const{ambient:t=.35,diffuse:e=.6,shininess:n=32,specularColor:i=[30,30,30]}=r;return{lighting_uAmbient:t,lighting_uDiffuse:e,lighting_uShininess:n,lighting_uSpecularColor:i.map(s=>s/255)}}function eT(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:vG;if(!("material"in r))return{};const{material:t}=r;return t?bG(t):{lighting_uEnabled:!1}}const wG={name:"gouraud-lighting",dependencies:[zv],vs:tT,defines:{LIGHTING_VERTEX:1},getUniforms:eT},xG={name:"phong-lighting",dependencies:[zv],fs:tT,defines:{LIGHTING_FRAGMENT:1},getUniforms:eT},Hv={name:"pbr",vs:`uniform mat4 u_MVPMatrix;
uniform mat4 u_ModelMatrix;
uniform mat4 u_NormalMatrix;

varying vec3 pbr_vPosition;
varying vec2 pbr_vUV;

#ifdef HAS_NORMALS
# ifdef HAS_TANGENTS
varying mat3 pbr_vTBN;
# else
varying vec3 pbr_vNormal;
# endif
#endif

void pbr_setPositionNormalTangentUV(vec4 position, vec4 normal, vec4 tangent, vec2 uv)
{
  vec4 pos = u_ModelMatrix * position;
  pbr_vPosition = vec3(pos.xyz) / pos.w;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
  vec3 normalW = normalize(vec3(u_NormalMatrix * vec4(normal.xyz, 0.0)));
  vec3 tangentW = normalize(vec3(u_ModelMatrix * vec4(tangent.xyz, 0.0)));
  vec3 bitangentW = cross(normalW, tangentW) * tangent.w;
  pbr_vTBN = mat3(tangentW, bitangentW, normalW);
#else
  pbr_vNormal = normalize(vec3(u_ModelMatrix * vec4(normal.xyz, 0.0)));
#endif
#endif

#ifdef HAS_UV
  pbr_vUV = uv;
#else
  pbr_vUV = vec2(0.,0.);
#endif
}
`,fs:`#if defined(USE_TEX_LOD) && !defined(FEATURE_GLSL_TEXTURE_LOD)
# error PBR fragment shader: Texture LOD is not available
#endif

#if !defined(HAS_TANGENTS) && !defined(FEATURE_GLSL_DERIVATIVES)
# error PBR fragment shader: Derivatives are not available
#endif


#if (__VERSION__ < 300)
  #define SMART_FOR(INIT, WEBGL1COND, WEBGL2COND, INCR) for (INIT; WEBGL1COND; INCR)
#else
  #define SMART_FOR(INIT, WEBGL1COND, WEBGL2COND, INCR) for (INIT; WEBGL2COND; INCR)
#endif

precision highp float;

uniform bool pbr_uUnlit;

#ifdef USE_IBL
uniform samplerCube u_DiffuseEnvSampler;
uniform samplerCube u_SpecularEnvSampler;
uniform sampler2D u_brdfLUT;
uniform vec2 u_ScaleIBLAmbient;
#endif

#ifdef HAS_BASECOLORMAP
uniform sampler2D u_BaseColorSampler;
#endif
#ifdef HAS_NORMALMAP
uniform sampler2D u_NormalSampler;
uniform float u_NormalScale;
#endif
#ifdef HAS_EMISSIVEMAP
uniform sampler2D u_EmissiveSampler;
uniform vec3 u_EmissiveFactor;
#endif
#ifdef HAS_METALROUGHNESSMAP
uniform sampler2D u_MetallicRoughnessSampler;
#endif
#ifdef HAS_OCCLUSIONMAP
uniform sampler2D u_OcclusionSampler;
uniform float u_OcclusionStrength;
#endif

#ifdef ALPHA_CUTOFF
uniform float u_AlphaCutoff;
#endif

uniform vec2 u_MetallicRoughnessValues;
uniform vec4 u_BaseColorFactor;

uniform vec3 u_Camera;
#ifdef PBR_DEBUG
uniform vec4 u_ScaleDiffBaseMR;
uniform vec4 u_ScaleFGDSpec;
#endif

varying vec3 pbr_vPosition;

varying vec2 pbr_vUV;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
varying mat3 pbr_vTBN;
#else
varying vec3 pbr_vNormal;
#endif
#endif


struct PBRInfo
{
  float NdotL;
  float NdotV;
  float NdotH;
  float LdotH;
  float VdotH;
  float perceptualRoughness;
  float metalness;
  vec3 reflectance0;
  vec3 reflectance90;
  float alphaRoughness;
  vec3 diffuseColor;
  vec3 specularColor;
  vec3 n;
  vec3 v;
};

const float M_PI = 3.141592653589793;
const float c_MinRoughness = 0.04;

vec4 SRGBtoLINEAR(vec4 srgbIn)
{
#ifdef MANUAL_SRGB
#ifdef SRGB_FAST_APPROXIMATION
  vec3 linOut = pow(srgbIn.xyz,vec3(2.2));
#else
  vec3 bLess = step(vec3(0.04045),srgbIn.xyz);
  vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );
#endif
  return vec4(linOut,srgbIn.w);;
#else
  return srgbIn;
#endif
}

vec3 getNormal()
{
#ifndef HAS_TANGENTS
  vec3 pos_dx = dFdx(pbr_vPosition);
  vec3 pos_dy = dFdy(pbr_vPosition);
  vec3 tex_dx = dFdx(vec3(pbr_vUV, 0.0));
  vec3 tex_dy = dFdy(vec3(pbr_vUV, 0.0));
  vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);

#ifdef HAS_NORMALS
  vec3 ng = normalize(pbr_vNormal);
#else
  vec3 ng = cross(pos_dx, pos_dy);
#endif

  t = normalize(t - ng * dot(ng, t));
  vec3 b = normalize(cross(ng, t));
  mat3 tbn = mat3(t, b, ng);
#else
  mat3 tbn = pbr_vTBN;
#endif

#ifdef HAS_NORMALMAP
  vec3 n = texture2D(u_NormalSampler, pbr_vUV).rgb;
  n = normalize(tbn * ((2.0 * n - 1.0) * vec3(u_NormalScale, u_NormalScale, 1.0)));
#else
  vec3 n = normalize(tbn[2].xyz);
#endif

  return n;
}


#ifdef USE_IBL
vec3 getIBLContribution(PBRInfo pbrInputs, vec3 n, vec3 reflection)
{
  float mipCount = 9.0;
  float lod = (pbrInputs.perceptualRoughness * mipCount);
  vec3 brdf = SRGBtoLINEAR(texture2D(u_brdfLUT,
    vec2(pbrInputs.NdotV, 1.0 - pbrInputs.perceptualRoughness))).rgb;
  vec3 diffuseLight = SRGBtoLINEAR(textureCube(u_DiffuseEnvSampler, n)).rgb;

#ifdef USE_TEX_LOD
  vec3 specularLight = SRGBtoLINEAR(textureCubeLod(u_SpecularEnvSampler, reflection, lod)).rgb;
#else
  vec3 specularLight = SRGBtoLINEAR(textureCube(u_SpecularEnvSampler, reflection)).rgb;
#endif

  vec3 diffuse = diffuseLight * pbrInputs.diffuseColor;
  vec3 specular = specularLight * (pbrInputs.specularColor * brdf.x + brdf.y);
  diffuse *= u_ScaleIBLAmbient.x;
  specular *= u_ScaleIBLAmbient.y;

  return diffuse + specular;
}
#endif


vec3 diffuse(PBRInfo pbrInputs)
{
  return pbrInputs.diffuseColor / M_PI;
}

vec3 specularReflection(PBRInfo pbrInputs)
{
  return pbrInputs.reflectance0 +
    (pbrInputs.reflectance90 - pbrInputs.reflectance0) *
    pow(clamp(1.0 - pbrInputs.VdotH, 0.0, 1.0), 5.0);
}



float geometricOcclusion(PBRInfo pbrInputs)
{
  float NdotL = pbrInputs.NdotL;
  float NdotV = pbrInputs.NdotV;
  float r = pbrInputs.alphaRoughness;

  float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));
  float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));
  return attenuationL * attenuationV;
}





float microfacetDistribution(PBRInfo pbrInputs)
{
  float roughnessSq = pbrInputs.alphaRoughness * pbrInputs.alphaRoughness;
  float f = (pbrInputs.NdotH * roughnessSq - pbrInputs.NdotH) * pbrInputs.NdotH + 1.0;
  return roughnessSq / (M_PI * f * f);
}

void PBRInfo_setAmbientLight(inout PBRInfo pbrInputs) {
  pbrInputs.NdotL = 1.0;
  pbrInputs.NdotH = 0.0;
  pbrInputs.LdotH = 0.0;
  pbrInputs.VdotH = 1.0;
}

void PBRInfo_setDirectionalLight(inout PBRInfo pbrInputs, vec3 lightDirection) {
  vec3 n = pbrInputs.n;
  vec3 v = pbrInputs.v;
  vec3 l = normalize(lightDirection);
  vec3 h = normalize(l+v);

  pbrInputs.NdotL = clamp(dot(n, l), 0.001, 1.0);
  pbrInputs.NdotH = clamp(dot(n, h), 0.0, 1.0);
  pbrInputs.LdotH = clamp(dot(l, h), 0.0, 1.0);
  pbrInputs.VdotH = clamp(dot(v, h), 0.0, 1.0);
}

void PBRInfo_setPointLight(inout PBRInfo pbrInputs, PointLight pointLight) {
  vec3 light_direction = normalize(pointLight.position - pbr_vPosition);
  PBRInfo_setDirectionalLight(pbrInputs, light_direction);
}

vec3 calculateFinalColor(PBRInfo pbrInputs, vec3 lightColor) {
  vec3 F = specularReflection(pbrInputs);
  float G = geometricOcclusion(pbrInputs);
  float D = microfacetDistribution(pbrInputs);
  vec3 diffuseContrib = (1.0 - F) * diffuse(pbrInputs);
  vec3 specContrib = F * G * D / (4.0 * pbrInputs.NdotL * pbrInputs.NdotV);
  return pbrInputs.NdotL * lightColor * (diffuseContrib + specContrib);
}

vec4 pbr_filterColor(vec4 colorUnused)
{
#ifdef HAS_BASECOLORMAP
  vec4 baseColor = SRGBtoLINEAR(texture2D(u_BaseColorSampler, pbr_vUV)) * u_BaseColorFactor;
#else
  vec4 baseColor = u_BaseColorFactor;
#endif

#ifdef ALPHA_CUTOFF
  if (baseColor.a < u_AlphaCutoff) {
    discard;
  }
#endif

  vec3 color = vec3(0, 0, 0);

  if(pbr_uUnlit){
    color.rgb = baseColor.rgb;
  }
  else{


    float perceptualRoughness = u_MetallicRoughnessValues.y;
    float metallic = u_MetallicRoughnessValues.x;
#ifdef HAS_METALROUGHNESSMAP

    vec4 mrSample = texture2D(u_MetallicRoughnessSampler, pbr_vUV);
    perceptualRoughness = mrSample.g * perceptualRoughness;
    metallic = mrSample.b * metallic;
#endif
    perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);
    metallic = clamp(metallic, 0.0, 1.0);

    float alphaRoughness = perceptualRoughness * perceptualRoughness;

    vec3 f0 = vec3(0.04);
    vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);
    diffuseColor *= 1.0 - metallic;
    vec3 specularColor = mix(f0, baseColor.rgb, metallic);
    float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);



    float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);
    vec3 specularEnvironmentR0 = specularColor.rgb;
    vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;

    vec3 n = getNormal();
    vec3 v = normalize(u_Camera - pbr_vPosition);

    float NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);
    vec3 reflection = -normalize(reflect(v, n));

    PBRInfo pbrInputs = PBRInfo(
      0.0,
      NdotV,
      0.0,
      0.0,
      0.0,
      perceptualRoughness,
      metallic,
      specularEnvironmentR0,
      specularEnvironmentR90,
      alphaRoughness,
      diffuseColor,
      specularColor,
      n,
      v
    );

#ifdef USE_LIGHTS
    PBRInfo_setAmbientLight(pbrInputs);
    color += calculateFinalColor(pbrInputs, lighting_uAmbientLight.color);
    SMART_FOR(int i = 0, i < MAX_LIGHTS, i < lighting_uDirectionalLightCount, i++) {
      if (i < lighting_uDirectionalLightCount) {
        PBRInfo_setDirectionalLight(pbrInputs, lighting_uDirectionalLight[i].direction);
        color += calculateFinalColor(pbrInputs, lighting_uDirectionalLight[i].color);
      }
    }
    SMART_FOR(int i = 0, i < MAX_LIGHTS, i < lighting_uPointLightCount, i++) {
      if (i < lighting_uPointLightCount) {
        PBRInfo_setPointLight(pbrInputs, lighting_uPointLight[i]);
        float attenuation = getPointLightAttenuation(lighting_uPointLight[i], distance(lighting_uPointLight[i].position, pbr_vPosition));
        color += calculateFinalColor(pbrInputs, lighting_uPointLight[i].color / attenuation);
      }
    }
#endif
#ifdef USE_IBL
    color += getIBLContribution(pbrInputs, n, reflection);
#endif
#ifdef HAS_OCCLUSIONMAP
    float ao = texture2D(u_OcclusionSampler, pbr_vUV).r;
    color = mix(color, color * ao, u_OcclusionStrength);
#endif

#ifdef HAS_EMISSIVEMAP
    vec3 emissive = SRGBtoLINEAR(texture2D(u_EmissiveSampler, pbr_vUV)).rgb * u_EmissiveFactor;
    color += emissive;
#endif

#ifdef PBR_DEBUG





    color = mix(color, baseColor.rgb, u_ScaleDiffBaseMR.y);
    color = mix(color, vec3(metallic), u_ScaleDiffBaseMR.z);
    color = mix(color, vec3(perceptualRoughness), u_ScaleDiffBaseMR.w);
#endif

  }

  return vec4(pow(color,vec3(1.0/2.2)), baseColor.a);
}
`,defines:{LIGHTING_FRAGMENT:1},dependencies:[zv]},BG={name:"transform",vs:`attribute float transform_elementID;
vec2 transform_getPixelSizeHalf(vec2 size) {
  return vec2(1.) / (2. * size);
}

vec2 transform_getPixelIndices(vec2 texSize, vec2 pixelSizeHalf) {
  float yIndex = floor((transform_elementID / texSize[0]) + pixelSizeHalf[1]);
  float xIndex = transform_elementID - (yIndex * texSize[0]);
  return vec2(xIndex, yIndex);
}
vec2 transform_getTexCoord(vec2 size) {
  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);
  vec2 indices = transform_getPixelIndices(size, pixelSizeHalf);
  vec2 coord = indices / size + pixelSizeHalf;
  return coord;
}
vec2 transform_getPos(vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec2 pos = (texCoord * (2.0, 2.0)) - (1., 1.);
  return pos;
}
vec4 transform_getInput(sampler2D texSampler, vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec4 textureColor = texture2D(texSampler, texCoord);
  return textureColor;
}
`,fs:null};class Mp{static getDefaultProgramManager(t){return t.luma=t.luma||{},t.luma.defaultProgramManager=t.luma.defaultProgramManager||new Mp(t),t.luma.defaultProgramManager}constructor(t){this.gl=t,this._programCache={},this._getUniforms={},this._registeredModules={},this._hookFunctions=[],this._defaultModules=[],this._hashes={},this._hashCounter=0,this.stateHash=0,this._useCounts={}}addDefaultModule(t){this._defaultModules.find(e=>e.name===t.name)||this._defaultModules.push(t),this.stateHash++}removeDefaultModule(t){const e=typeof t=="string"?t:t.name;this._defaultModules=this._defaultModules.filter(n=>n.name!==e),this.stateHash++}addShaderHook(t,e){e&&(t=Object.assign(e,{hook:t})),this._hookFunctions.push(t),this.stateHash++}get(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{vs:e="",fs:n="",defines:i={},inject:s={},varyings:a=[],bufferMode:o=35981,transpileToGLSL100:h=!1}=t,f=this._getModuleList(t.modules),g=this._getHash(e),b=this._getHash(n),C=f.map(et=>this._getHash(et.name)).sort(),B=a.map(et=>this._getHash(et)),R=Object.keys(i).sort(),D=Object.keys(s).sort(),Q=[],k=[];for(const et of R)Q.push(this._getHash(et)),Q.push(this._getHash(i[et]));for(const et of D)k.push(this._getHash(et)),k.push(this._getHash(s[et]));const j="".concat(g,"/").concat(b,"D").concat(Q.join("/"),"M").concat(C.join("/"),"I").concat(k.join("/"),"V").concat(B.join("/"),"H").concat(this.stateHash,"B").concat(o).concat(h?"T":"");if(!this._programCache[j]){const et=P9(this.gl,{vs:e,fs:n,modules:f,inject:s,defines:i,hookFunctions:this._hookFunctions,transpileToGLSL100:h});this._programCache[j]=new a5(this.gl,{hash:j,vs:et.vs,fs:et.fs,varyings:a,bufferMode:o}),this._getUniforms[j]=et.getUniforms||(st=>{}),this._useCounts[j]=0}return this._useCounts[j]++,this._programCache[j]}getUniforms(t){return this._getUniforms[t.hash]||null}release(t){const e=t.hash;this._useCounts[e]--,this._useCounts[e]===0&&(this._programCache[e].delete(),delete this._programCache[e],delete this._getUniforms[e],delete this._useCounts[e])}_getHash(t){return this._hashes[t]===void 0&&(this._hashes[t]=this._hashCounter++),this._hashes[t]}_getModuleList(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const e=new Array(this._defaultModules.length+t.length),n={};let i=0;for(let s=0,a=this._defaultModules.length;s<a;++s){const o=this._defaultModules[s],h=o.name;e[i++]=o,n[h]=!0}for(let s=0,a=t.length;s<a;++s){const o=t[s],h=o.name;n[h]||(e[i++]=o,n[h]=!0)}return e.length=i,e}}const CG={POSITION:"positions",NORMAL:"normals",COLOR_0:"colors",TEXCOORD_0:"texCoords",TEXCOORD_1:"texCoords1",TEXCOORD_2:"texCoords2"};function EG(r,t,e){const n={};let i=t.indices;for(const s in t.attributes){const a=t.attributes[s],o=SG(s,e);if(s==="indices")i=a;else if(a.constant)n[o]=a.value;else{const h=a.value,f={...a};delete f.value,n[o]=[new ri(r,h),f],TG(s,f)}}if(i){const s=i.value||i;Ar(s instanceof Uint16Array||s instanceof Uint32Array,'attribute array for "indices" must be of integer type');const a={size:1,isIndexed:i.isIndexed===void 0?!0:i.isIndexed};n.indices=[new ri(r,{data:s,target:34963}),a]}return n}function SG(r,t){const{attributeMap:e=CG}=t||{};return e&&e[r]||r}function TG(r,t){let e;switch(r){case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":e="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":e="vectors";break}switch(e){case"vectors":t.size=t.size||3;break;case"uvs":t.size=t.size||2;break}Ar(Number.isFinite(t.size),"attribute ".concat(r," needs size"))}const Ld=2,IG=1e4,LG="Model needs drawMode and vertexCount",rT=()=>{},FG={};class Fd{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{id:n=vA("model")}=e;Ar(Nm(t)),this.id=n,this.gl=t,this.id=e.id||vA("Model"),this.lastLogTime=0,this.animated=!1,this.initialize(e)}initialize(t){this.props={},this.programManager=t.programManager||Mp.getDefaultProgramManager(this.gl),this._programManagerState=-1,this._managedProgram=!1;const{program:e=null,vs:n,fs:i,modules:s,defines:a,inject:o,varyings:h,bufferMode:f,transpileToGLSL100:g}=t;this.programProps={program:e,vs:n,fs:i,modules:s,defines:a,inject:o,varyings:h,bufferMode:f,transpileToGLSL100:g},this.program=null,this.vertexArray=null,this._programDirty=!0,this.userData={},this.needsRedraw=!0,this._attributes={},this.attributes={},this.uniforms={},this.pickable=!0,this._checkProgram(),this.setUniforms(Object.assign({},this.getModuleUniforms(t.moduleSettings))),this.drawMode=t.drawMode!==void 0?t.drawMode:4,this.vertexCount=t.vertexCount||0,this.geometryBuffers={},this.isInstanced=t.isInstanced||t.instanced||t.instanceCount>0,this._setModelProps(t),this.geometry={},Ar(this.drawMode!==void 0&&Number.isFinite(this.vertexCount),LG)}setProps(t){this._setModelProps(t)}delete(){for(const t in this._attributes)this._attributes[t]!==this.attributes[t]&&this._attributes[t].delete();this._managedProgram&&(this.programManager.release(this.program),this._managedProgram=!1),this.vertexArray.delete(),this._deleteGeometryBuffers()}getDrawMode(){return this.drawMode}getVertexCount(){return this.vertexCount}getInstanceCount(){return this.instanceCount}getAttributes(){return this.attributes}getProgram(){return this.program}setProgram(t){const{program:e,vs:n,fs:i,modules:s,defines:a,inject:o,varyings:h,bufferMode:f,transpileToGLSL100:g}=t;this.programProps={program:e,vs:n,fs:i,modules:s,defines:a,inject:o,varyings:h,bufferMode:f,transpileToGLSL100:g},this._programDirty=!0}getUniforms(){return this.uniforms}setDrawMode(t){return this.drawMode=t,this}setVertexCount(t){return Ar(Number.isFinite(t)),this.vertexCount=t,this}setInstanceCount(t){return Ar(Number.isFinite(t)),this.instanceCount=t,this}setGeometry(t){return this.drawMode=t.drawMode,this.vertexCount=t.getVertexCount(),this._deleteGeometryBuffers(),this.geometryBuffers=EG(this.gl,t),this.vertexArray.setAttributes(this.geometryBuffers),this}setAttributes(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(Cd(t))return this;const e={};for(const n in t){const i=t[n];e[n]=i.getValue?i.getValue():i}return this.vertexArray.setAttributes(e),this}setUniforms(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Object.assign(this.uniforms,t),this}getModuleUniforms(t){this._checkProgram();const e=this.programManager.getUniforms(this.program);return e?e(t):{}}updateModuleSettings(t){const e=this.getModuleUniforms(t||{});return this.setUniforms(e)}clear(t){return uv(this.program.gl,t),this}draw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._checkProgram();const{moduleSettings:e=null,framebuffer:n,uniforms:i={},attributes:s={},transformFeedback:a=this.transformFeedback,parameters:o={},vertexArray:h=this.vertexArray}=t;this.setAttributes(s),this.updateModuleSettings(e),this.setUniforms(i);let f;Cr.priority>=Ld&&(f=this._logDrawCallStart(Ld));const g=this.vertexArray.getDrawParams(),{isIndexed:b=g.isIndexed,indexType:C=g.indexType,indexOffset:B=g.indexOffset,vertexArrayInstanced:R=g.isInstanced}=this.props;R&&!this.isInstanced&&Cr.warn("Found instanced attributes on non-instanced model",this.id)();const{isInstanced:D,instanceCount:Q}=this,{onBeforeRender:k=rT,onAfterRender:j=rT}=this.props;k(),this.program.setUniforms(this.uniforms);const et=this.program.draw(Object.assign(FG,t,{logPriority:f,uniforms:null,framebuffer:n,parameters:o,drawMode:this.getDrawMode(),vertexCount:this.getVertexCount(),vertexArray:h,transformFeedback:a,isIndexed:b,indexType:C,isInstanced:D,instanceCount:Q,offset:b?B:0}));return j(),Cr.priority>=Ld&&this._logDrawCallEnd(f,h,n),et}transform(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{discard:e=!0,feedbackBuffers:n,unbindModels:i=[]}=t;let{parameters:s}=t;n&&this._setFeedbackBuffers(n),e&&(s=Object.assign({},s,{35977:e})),i.forEach(a=>a.vertexArray.unbindBuffers());try{this.draw(Object.assign({},t,{parameters:s}))}finally{i.forEach(a=>a.vertexArray.bindBuffers())}return this}render(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Cr.warn("Model.render() is deprecated. Use Model.setUniforms() and Model.draw()")(),this.setUniforms(t).draw()}_setModelProps(t){Object.assign(this.props,t),"uniforms"in t&&this.setUniforms(t.uniforms),"pickable"in t&&(this.pickable=t.pickable),"instanceCount"in t&&(this.instanceCount=t.instanceCount),"geometry"in t&&this.setGeometry(t.geometry),"attributes"in t&&this.setAttributes(t.attributes),"_feedbackBuffers"in t&&this._setFeedbackBuffers(t._feedbackBuffers)}_checkProgram(){if(!(this._programDirty||this.programManager.stateHash!==this._programManagerState))return;let{program:e}=this.programProps;if(e)this._managedProgram=!1;else{const{vs:n,fs:i,modules:s,inject:a,defines:o,varyings:h,bufferMode:f,transpileToGLSL100:g}=this.programProps;e=this.programManager.get({vs:n,fs:i,modules:s,inject:a,defines:o,varyings:h,bufferMode:f,transpileToGLSL100:g}),this.program&&this._managedProgram&&this.programManager.release(this.program),this._programManagerState=this.programManager.stateHash,this._managedProgram=!0}Ar(e instanceof a5,"Model needs a program"),this._programDirty=!1,e!==this.program&&(this.program=e,this.vertexArray?this.vertexArray.setProps({program:this.program,attributes:this.vertexArray.attributes}):this.vertexArray=new qH(this.gl,{program:this.program}),this.setUniforms(Object.assign({},this.getModuleUniforms())))}_deleteGeometryBuffers(){for(const t in this.geometryBuffers){const e=this.geometryBuffers[t][0]||this.geometryBuffers[t];e instanceof ri&&e.delete()}}_setAnimationProps(t){this.animated&&Ar(t,"Model.draw(): animated uniforms but no animationProps")}_setFeedbackBuffers(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(Cd(t))return this;const{gl:e}=this.program;return this.transformFeedback=this.transformFeedback||new c5(e,{program:this.program}),this.transformFeedback.setBuffers(t),this}_logDrawCallStart(t){const e=t>3?0:IG;if(!(Date.now()-this.lastLogTime<e))return this.lastLogTime=Date.now(),Cr.group(Ld,">>> DRAWING MODEL ".concat(this.id),{collapsed:Cr.level<=2})(),t}_logDrawCallEnd(t,e,n,i){if(t===void 0)return;const s=WH({vertexArray:e,header:"".concat(this.id," attributes"),attributes:this._attributes}),{table:a,unusedTable:o,unusedCount:h}=l5({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,n)}),{table:f,count:g}=l5({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,n),undefinedOnly:!0});g>0&&Cr.log("MISSING UNIFORMS",Object.keys(f))(),h>0&&Cr.log("UNUSED UNIFORMS",Object.keys(o))();const b=JH(this.vertexArray.configuration);Cr.table(t,s)(),Cr.table(t,a)(),Cr.table(t+1,b)(),i&&i.log({logLevel:Ld,message:"Rendered to ".concat(i.id)}),Cr.groupEnd(Ld)()}}class MG{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=t,this.currentIndex=0,this.feedbackMap={},this.varyings=null,this.bindings=[],this.resources={},this._initialize(e),Object.seal(this)}setupResources(t){for(const e of this.bindings)this._setupTransformFeedback(e,t)}updateModelProps(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyings:e}=this;return e.length>0&&(t=Object.assign({},t,{varyings:e})),t}getDrawOptions(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=this.bindings[this.currentIndex],{sourceBuffers:n,transformFeedback:i}=e;return{attributes:Object.assign({},n,t.attributes),transformFeedback:i}}swap(){return this.feedbackMap?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(t)}getBuffer(t){const{feedbackBuffers:e}=this.bindings[this.currentIndex],n=t?e[t]:null;return n?n instanceof ri?n:n.buffer:null}getData(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyingName:e}=t,n=this.getBuffer(e);return n?n.getData():null}delete(){for(const t in this.resources)this.resources[t].delete()}_initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(t),this.varyings=t.varyings||Object.keys(this.bindings[this.currentIndex].feedbackBuffers),this.varyings.length>0&&Ar(yn(this.gl))}_getFeedbackBuffers(t){const{sourceBuffers:e={}}=t,n={};if(this.bindings[this.currentIndex]&&Object.assign(n,this.bindings[this.currentIndex].feedbackBuffers),this.feedbackMap)for(const i in this.feedbackMap){const s=this.feedbackMap[i];i in e&&(n[s]=i)}Object.assign(n,t.feedbackBuffers);for(const i in n){const s=n[i];if(typeof s=="string"){const a=e[s],{byteLength:o,usage:h,accessor:f}=a;n[i]=this._createNewBuffer(i,{byteLength:o,usage:h,accessor:f})}}return n}_setupBuffers(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:e=null}=t;Object.assign(this.feedbackMap,t.feedbackMap);const n=this._getFeedbackBuffers(t);this._updateBindings({sourceBuffers:e,feedbackBuffers:n})}_setupTransformFeedback(t,e){let{model:n}=e;const{program:i}=n;t.transformFeedback=new c5(this.gl,{program:i,buffers:t.feedbackBuffers})}_updateBindings(t){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],t),this.feedbackMap){const{sourceBuffers:e,feedbackBuffers:n}=this._swapBuffers(this.bindings[this.currentIndex]),i=this._getNextIndex();this.bindings[i]=this._updateBinding(this.bindings[i],{sourceBuffers:e,feedbackBuffers:n})}}_updateBinding(t,e){return t?(Object.assign(t.sourceBuffers,e.sourceBuffers),Object.assign(t.feedbackBuffers,e.feedbackBuffers),t.transformFeedback&&t.transformFeedback.setBuffers(t.feedbackBuffers),t):{sourceBuffers:Object.assign({},e.sourceBuffers),feedbackBuffers:Object.assign({},e.feedbackBuffers)}}_swapBuffers(t){if(!this.feedbackMap)return null;const e=Object.assign({},t.sourceBuffers),n=Object.assign({},t.feedbackBuffers);for(const i in this.feedbackMap){const s=this.feedbackMap[i];e[i]=t.feedbackBuffers[s],n[s]=t.sourceBuffers[i],Ar(n[s]instanceof ri)}return{sourceBuffers:e,feedbackBuffers:n}}_createNewBuffer(t,e){const n=new ri(this.gl,e);return this.resources[t]&&this.resources[t].delete(),this.resources[t]=n,n}_getNextIndex(){return(this.currentIndex+1)%2}}const PG="transform_uSampler_",o0="transform_uSize_",nT="transform_position";function UG(r){let{vs:t,sourceTextureMap:e,targetTextureVarying:n,targetTexture:i}=r,a=Object.keys(e).length,o=null;const h={};let f=t,g={};if(a>0||n){const b=f.split(`
`),C=b.slice();if(b.forEach((B,R,D)=>{if(a>0){const Q=kG(B,e);if(Q){const{updatedLine:k,inject:j}=Q;C[R]=k,g=xv([g,j]),Object.assign(h,Q.samplerTextureMap),a--}}n&&!o&&(o=NG(B,n))}),n){Ar(i);const B="".concat(o0).concat(n),R="uniform vec2 ".concat(B,`;
`),D="     vec2 ".concat(nT," = transform_getPos(").concat(B,`);
     gl_Position = vec4(`).concat(nT,`, 0, 1.);
`);g=xv([g,{"vs:#decl":R,"vs:#main-start":D}])}f=C.join(`
`)}return{vs:f,targetTextureType:o,inject:g,samplerTextureMap:h}}function RG(r){let{sourceTextureMap:t,targetTextureVarying:e,targetTexture:n}=r;const i={};let s,a;e&&({width:s,height:a}=n,i["".concat(o0).concat(e)]=[s,a]);for(const o in t)({width:s,height:a}=t[o]),i["".concat(o0).concat(o)]=[s,a];return i}function DG(r){return E5(r,["attribute","in"])}function OG(r){const t="".concat(PG).concat(r),e="".concat(o0).concat(r),n="  uniform sampler2D ".concat(t,`;
  uniform vec2 `).concat(e,";");return{samplerName:t,sizeName:e,uniformDeclerations:n}}function NG(r,t){const e=E5(r,["varying","out"]);return e&&e.name===t?e.type:null}function kG(r,t){const e={},n=DG(r);if(!n)return null;const{type:i,name:s}=n;if(s&&t[s]){const a="// ".concat(r," => Replaced by Transform with a sampler"),{samplerName:o,sizeName:h,uniformDeclerations:f}=OG(s),g=H9(i),b="  ".concat(i," ").concat(s," = transform_getInput(").concat(o,", ").concat(h,").").concat(g,`;
`);return e[o]=s,{updatedLine:a,inject:{"vs:#decl":f,"vs:#main-start":b},samplerTextureMap:e}}return null}const QG={10241:9728,10240:9728,10242:33071,10243:33071},zG="transform_output";class HG{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=t,this.id=this.currentIndex=0,this._swapTexture=null,this.targetTextureVarying=null,this.targetTextureType=null,this.samplerTextureMap=null,this.bindings=[],this.resources={},this._initialize(e),Object.seal(this)}updateModelProps(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=this._processVertexShader(t);return Object.assign({},t,e)}getDrawOptions(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:e,sourceTextures:n,framebuffer:i,targetTexture:s}=this.bindings[this.currentIndex],a=Object.assign({},e,t.attributes),o=Object.assign({},t.uniforms),h=Object.assign({},t.parameters);let f=t.discard;if(this.hasSourceTextures||this.hasTargetTexture){a.transform_elementID=this.elementIDBuffer;for(const b in this.samplerTextureMap){const C=this.samplerTextureMap[b];o[b]=n[C]}this._setSourceTextureParameters();const g=RG({sourceTextureMap:n,targetTextureVarying:this.targetTextureVarying,targetTexture:s});Object.assign(o,g)}return this.hasTargetTexture&&(f=!1,h.viewport=[0,0,i.width,i.height]),{attributes:a,framebuffer:i,uniforms:o,discard:f,parameters:h}}swap(){return this._swapTexture?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupTextures(t)}getTargetTexture(){const{targetTexture:t}=this.bindings[this.currentIndex];return t}getData(){let{packed:t=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{framebuffer:e}=this.bindings[this.currentIndex],n=Qm(e);if(!t)return n;const i=n.constructor,s=G9(this.targetTextureType),a=new i(n.length*s/4);let o=0;for(let h=0;h<n.length;h+=4)for(let f=0;f<s;f++)a[o++]=n[h+f];return a}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}delete(){this.ownTexture&&this.ownTexture.delete(),this.elementIDBuffer&&this.elementIDBuffer.delete()}_initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{_targetTextureVarying:e,_swapTexture:n}=t;this._swapTexture=n,this.targetTextureVarying=e,this.hasTargetTexture=e,this._setupTextures(t)}_createTargetTexture(t){const{sourceTextures:e,textureOrReference:n}=t;if(n instanceof La)return n;const i=e[n];return i?(this._targetRefTexName=n,this._createNewTexture(i)):null}_setupTextures(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:e,_sourceTextures:n={},_targetTexture:i}=t,s=this._createTargetTexture({sourceTextures:n,textureOrReference:i});this.hasSourceTextures=this.hasSourceTextures||n&&Object.keys(n).length>0,this._updateBindings({sourceBuffers:e,sourceTextures:n,targetTexture:s}),"elementCount"in t&&this._updateElementIDBuffer(t.elementCount)}_updateElementIDBuffer(t){if(typeof t!="number"||this.elementCount>=t)return;const e=new Float32Array(t);e.forEach((n,i,s)=>{s[i]=i}),this.elementIDBuffer?this.elementIDBuffer.setData({data:e}):this.elementIDBuffer=new ri(this.gl,{data:e,accessor:{size:1}}),this.elementCount=t}_updateBindings(t){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],t),this._swapTexture){const{sourceTextures:e,targetTexture:n}=this._swapTextures(this.bindings[this.currentIndex]),i=this._getNextIndex();this.bindings[i]=this._updateBinding(this.bindings[i],{sourceTextures:e,targetTexture:n})}}_updateBinding(t,e){const{sourceBuffers:n,sourceTextures:i,targetTexture:s}=e;if(t||(t={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(t.sourceTextures,i),Object.assign(t.sourceBuffers,n),s){t.targetTexture=s;const{width:a,height:o}=s,{framebuffer:h}=t;h?(h.update({attachments:{36064:s},resizeAttachments:!1}),h.resize({width:a,height:o})):t.framebuffer=new vs(this.gl,{id:"transform-framebuffer",width:a,height:o,attachments:{36064:s}})}return t}_setSourceTextureParameters(){const t=this.currentIndex,{sourceTextures:e}=this.bindings[t];for(const n in e)e[n].setParameters(QG)}_swapTextures(t){if(!this._swapTexture)return null;const e=Object.assign({},t.sourceTextures);e[this._swapTexture]=t.targetTexture;const n=t.sourceTextures[this._swapTexture];return{sourceTextures:e,targetTexture:n}}_createNewTexture(t){const e=Rz(t,{parameters:{10241:9728,10240:9728,10242:33071,10243:33071},pixelStore:{37440:!1}});return this.ownTexture&&this.ownTexture.delete(),this.ownTexture=e,e}_getNextIndex(){return(this.currentIndex+1)%2}_processVertexShader(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceTextures:e,targetTexture:n}=this.bindings[this.currentIndex],{vs:i,uniforms:s,targetTextureType:a,inject:o,samplerTextureMap:h}=UG({vs:t.vs,sourceTextureMap:e,targetTextureVarying:this.targetTextureVarying,targetTexture:n}),f=xv([t.inject||{},o]);this.targetTextureType=a,this.samplerTextureMap=h;const g=t._fs||S5({version:t5(i),input:this.targetTextureVarying,inputType:a,output:zG}),b=this.hasSourceTextures||this.targetTextureVarying?[BG].concat(t.modules||[]):t.modules;return{vs:i,fs:g,modules:b,uniforms:s,inject:f}}}class Gv{static isSupported(t){return yn(t)}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=t,this.model=null,this.elementCount=0,this.bufferTransform=null,this.textureTransform=null,this.elementIDBuffer=null,this._initialize(e),Object.seal(this)}delete(){const{model:t,bufferTransform:e,textureTransform:n}=this;t&&t.delete(),e&&e.delete(),n&&n.delete()}run(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{clearRenderTarget:e=!0}=t,n=this._updateDrawOptions(t);e&&n.framebuffer&&n.framebuffer.clear({color:!0}),this.model.transform(n)}swap(){let t=!1;const e=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const n of e)t=t||n.swap();Ar(t,"Nothing to swap")}getBuffer(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return this.bufferTransform&&this.bufferTransform.getBuffer(t)}getData(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const n of e){const i=n.getData(t);if(i)return i}return null}getFramebuffer(){return this.textureTransform&&this.textureTransform.getFramebuffer()}update(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};"elementCount"in t&&this.model.setVertexCount(t.elementCount);const e=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const n of e)n.update(t)}_initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{gl:e}=this;this._buildResourceTransforms(e,t),t=this._updateModelProps(t),this.model=new Fd(e,Object.assign({},t,{fs:t.fs||S5({version:t5(t.vs)}),id:t.id||"transform-model",drawMode:t.drawMode||0,vertexCount:t.elementCount})),this.bufferTransform&&this.bufferTransform.setupResources({model:this.model})}_updateModelProps(t){let e=Object.assign({},t);const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of n)e=i.updateModelProps(e);return e}_buildResourceTransforms(t,e){GG(e)&&(this.bufferTransform=new MG(t,e)),VG(e)&&(this.textureTransform=new HG(t,e)),Ar(this.bufferTransform||this.textureTransform,"must provide source/feedback buffers or source/target textures")}_updateDrawOptions(t){let e=Object.assign({},t);const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of n)e=Object.assign(e,i.getDrawOptions(e));return e}}function GG(r){return!!(!Cd(r.feedbackBuffers)||!Cd(r.feedbackMap)||r.varyings&&r.varyings.length>0)}function VG(r){return!!(!Cd(r._sourceTextures)||r._targetTexture||r._targetTextureVarying)}const iT={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class Pp{static get DRAW_MODE(){return iT}constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:e=vA("geometry"),drawMode:n=iT.TRIANGLES,attributes:i={},indices:s=null,vertexCount:a=null}=t;this.id=e,this.drawMode=n|0,this.attributes={},this.userData={},this._setAttributes(i,s),this.vertexCount=a||this._calculateVertexCount(this.attributes,this.indices)}get mode(){return this.drawMode}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(t){return"Geometry ".concat(this.id," attribute ").concat(t)}_setAttributes(t,e){e&&(this.indices=ArrayBuffer.isView(e)?{value:e,size:1}:e);for(const n in t){let i=t[n];i=ArrayBuffer.isView(i)?{value:i}:i,Ar(ArrayBuffer.isView(i.value),"".concat(this._print(n),": must be typed array or object with value as typed array")),(n==="POSITION"||n==="positions")&&!i.size&&(i.size=3),n==="indices"?(Ar(!this.indices),this.indices=i):this.attributes[n]=i}return this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this}_calculateVertexCount(t,e){if(e)return e.value.length;let n=1/0;for(const i in t){const s=t[i],{value:a,size:o,constant:h}=s;!h&&a&&o>=1&&(n=Math.min(n,a.length/o))}return Ar(Number.isFinite(n)),n}}let jG=1,qG=1;class sT{constructor(){this.time=0,this.channels=new Map,this.animations=new Map,this.playing=!1,this.lastEngineTime=-1}addChannel(t){const{delay:e=0,duration:n=Number.POSITIVE_INFINITY,rate:i=1,repeat:s=1}=t,a=jG++,o={time:0,delay:e,duration:n,rate:i,repeat:s};return this._setChannelTime(o,this.time),this.channels.set(a,o),a}removeChannel(t){this.channels.delete(t);for(const[e,n]of this.animations)n.channel===t&&this.detachAnimation(e)}isFinished(t){const e=this.channels.get(t);return e===void 0?!1:this.time>=e.delay+e.duration*e.repeat}getTime(t){if(t===void 0)return this.time;const e=this.channels.get(t);return e===void 0?-1:e.time}setTime(t){this.time=Math.max(0,t);const e=this.channels.values();for(const i of e)this._setChannelTime(i,this.time);const n=this.animations.values();for(const i of n){const{animation:s,channel:a}=i;s.setTime(this.getTime(a))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(t,e){const n=qG++;return this.animations.set(n,{animation:t,channel:e}),t.setTime(this.getTime(e)),n}detachAnimation(t){this.animations.delete(t)}update(t){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=t),this.setTime(this.time+(t-this.lastEngineTime)),this.lastEngineTime=t)}_setChannelTime(t,e){const n=e-t.delay,i=t.duration*t.repeat;n>=i?t.time=t.duration*t.rate:(t.time=Math.max(0,n)%t.duration,t.time*=t.rate)}}const KG=[255,255,255],$G=1;let WG=0;class oT{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};K(this,"id",void 0),K(this,"color",void 0),K(this,"intensity",void 0),K(this,"type","ambient");const{color:e=KG}=t,{intensity:n=$G}=t;this.id=t.id||"ambient-".concat(WG++),this.color=e,this.intensity=n}}const XG=[255,255,255],JG=1,YG=[0,0,-1];let ZG=0;class aT{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};K(this,"id",void 0),K(this,"color",void 0),K(this,"intensity",void 0),K(this,"type","directional"),K(this,"direction",void 0),K(this,"shadow",void 0);const{color:e=XG}=t,{intensity:n=JG}=t,{direction:i=YG}=t,{_shadow:s=!1}=t;this.id=t.id||"directional-".concat(ZG++),this.color=e,this.intensity=n,this.type="directional",this.direction=new ue(i).normalize().toArray(),this.shadow=s}getProjectedLight(t){return this}}class tV{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{id:"pass"};K(this,"id",void 0),K(this,"gl",void 0),K(this,"props",void 0);const{id:n}=e;this.id=n,this.gl=t,this.props={...e}}setProps(t){Object.assign(this.props,t)}render(t){}cleanup(){}}class Vv extends tV{constructor(){super(...arguments),K(this,"_lastRenderIndex",-1)}render(t){const e=this.gl;return _A(e,{framebuffer:t.target}),this._drawLayers(t)}_drawLayers(t){const{target:e,moduleParameters:n,viewports:i,views:s,onViewportActive:a,clearStack:o=!0,clearCanvas:h=!0}=t;t.pass=t.pass||"unknown";const f=this.gl;h&&rV(f,e),o&&(this._lastRenderIndex=-1);const g=[];for(const b of i){const C=s&&s[b.id];a==null||a(b);const B=this._getDrawLayerParams(b,t),R=b.subViewports||[b];for(const D of R){const Q=this._drawLayersInViewport(f,{target:e,moduleParameters:n,viewport:D,view:C,pass:t.pass,layers:t.layers},B);g.push(Q)}}return g}_getDrawLayerParams(t,e){let{layers:n,pass:i,isPicking:s=!1,layerFilter:a,cullRect:o,effects:h,moduleParameters:f}=e,g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const b=[],C=cT(this._lastRenderIndex+1),B={layer:n[0],viewport:t,isPicking:s,renderPass:i,cullRect:o},R={};for(let D=0;D<n.length;D++){const Q=n[D],k=this._shouldDrawLayer(Q,B,a,R),j={shouldDrawLayer:k};k&&!g&&(j.layerRenderIndex=C(Q,k),j.moduleParameters=this._getModuleParameters(Q,h,i,f),j.layerParameters=this.getLayerParameters(Q,D,t)),b[D]=j}return b}_drawLayersInViewport(t,e,n){let{layers:i,moduleParameters:s,pass:a,target:o,viewport:h,view:f}=e;const g=eV(t,{moduleParameters:s,target:o,viewport:h});if(f&&f.props.clear){const C=f.props.clear===!0?{color:!0,depth:!0}:f.props.clear;Ic(t,{scissorTest:!0,scissor:g},()=>uv(t,C))}const b={totalCount:i.length,visibleCount:0,compositeCount:0,pickableCount:0};_A(t,{viewport:g});for(let C=0;C<i.length;C++){const B=i[C],{shouldDrawLayer:R,layerRenderIndex:D,moduleParameters:Q,layerParameters:k}=n[C];if(R&&B.props.pickable&&b.pickableCount++,B.isComposite)b.compositeCount++;else if(R){b.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,D),Q.viewport=h;try{B._drawLayer({moduleParameters:Q,uniforms:{layerIndex:D},parameters:k})}catch(j){B.raiseError(j,"drawing ".concat(B," to ").concat(a))}}}return b}shouldDrawLayer(t){return!0}getModuleParameters(t,e){return null}getLayerParameters(t,e,n){return t.props.parameters}_shouldDrawLayer(t,e,n,i){if(!(t.props.visible&&this.shouldDrawLayer(t)))return!1;e.layer=t;let a=t.parent;for(;a;){if(!a.props.visible||!a.filterSubLayer(e))return!1;e.layer=a,a=a.parent}if(n){const o=e.layer.id;if(o in i||(i[o]=n(e)),!i[o])return!1}return t.activateViewport(e.viewport),!0}_getModuleParameters(t,e,n,i){var s;const a=Object.assign(Object.create(((s=t.internalState)===null||s===void 0?void 0:s.propsInTransition)||t.props),{autoWrapLongitude:t.wrapLongitude,viewport:t.context.viewport,mousePosition:t.context.mousePosition,pickingActive:0,devicePixelRatio:Bd(this.gl)});if(e)for(const h of e){var o;Object.assign(a,(o=h.getModuleParameters)===null||o===void 0?void 0:o.call(h,t))}return Object.assign(a,this.getModuleParameters(t,e),i)}}function cT(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const e={},n=(i,s)=>{const a=i.props._offset,o=i.id,h=i.parent&&i.parent.id;let f;if(h&&!(h in t)&&n(i.parent,!1),h in e){const g=e[h]=e[h]||cT(t[h],t);f=g(i,s),e[o]=g}else Number.isFinite(a)?(f=a+(t[h]||0),e[o]=null):f=r;return s&&f>=r&&(r=f+1),t[o]=f,f};return n}function eV(r,t){let{moduleParameters:e,target:n,viewport:i}=t;const s=n&&n.id!=="default-framebuffer",a=e&&e.devicePixelRatio||Bd(r),o=s?n.height:r.drawingBufferHeight,h=i;return[h.x*a,o-(h.y+h.height)*a,h.width*a,h.height*a]}function rV(r,t){const e=t?t.width:r.drawingBufferWidth,n=t?t.height:r.drawingBufferHeight;_A(r,{viewport:[0,0,e,n]}),r.clear(16640)}class nV extends Vv{constructor(t,e){super(t,e),K(this,"shadowMap",void 0),K(this,"depthBuffer",void 0),K(this,"fbo",void 0),this.shadowMap=new La(t,{width:1,height:1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.depthBuffer=new Td(t,{format:33189,width:1,height:1}),this.fbo=new vs(t,{id:"shadowmap",width:1,height:1,attachments:{36064:this.shadowMap,36096:this.depthBuffer}})}render(t){const e=this.fbo;Ic(this.gl,{depthRange:[0,1],depthTest:!0,blend:!1,clearColor:[1,1,1,1]},()=>{const n=t.viewports[0],i=Bd(this.gl),s=n.width*i,a=n.height*i;(s!==e.width||a!==e.height)&&e.resize({width:s,height:a}),super.render({...t,target:e,pass:"shadow"})})}shouldDrawLayer(t){return t.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.delete(),this.fbo=null),this.shadowMap&&(this.shadowMap.delete(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.delete(),this.depthBuffer=null)}}const lT="#define SMOOTH_EDGE_RADIUS 0.5",iV=`
`.concat(lT,`

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`),sV=`
`.concat(lT,`

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`),oV={name:"geometry",vs:iV,fs:sV},aV=Object.keys(En).map(r=>"const int COORDINATE_SYSTEM_".concat(r," = ").concat(En[r],";")).join(""),cV=Object.keys(El).map(r=>"const int PROJECTION_MODE_".concat(r," = ").concat(El[r],";")).join(""),lV=Object.keys(J_).map(r=>"const int UNIT_".concat(r.toUpperCase()," = ").concat(J_[r],";")).join(""),AV="".concat(aV,`
`).concat(cV,`
`).concat(lV,`

uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;

const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
  float y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

float project_size() {
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
    project_uPseudoMeters == false) {
    
    if (geometry.position.w == 0.0) {
      return project_size_at_latitude(geometry.worldPosition.y);
    }
  
    float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    float y2 = y * y;
    float y4 = y2 * y2;
    float y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

float project_size_at_latitude(float meters, float lat) {
  return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
  return meters * project_uCommonUnitsPerMeter.z * project_size();
}

vec2 project_size(vec2 meters) {
  return meters * project_uCommonUnitsPerMeter.xy * project_size();
}

vec3 project_size(vec3 meters) {
  return meters * project_uCommonUnitsPerMeter * project_size();
}

vec4 project_size(vec4 meters) {
  return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
  vec3 uz = normalize(up);
  vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
  vec3 uy = cross(uz, ux);
  return mat3(ux, uy, uz);
}

bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    transform = project_get_orientation_matrix(commonPosition);
    return true;
  }
  return false;
}
vec3 project_normal(vec3 vector) {
  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
  vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
  mat3 rotation;
  if (project_needs_rotation(geometry.position.xyz, rotation)) {
    n = rotation * n;
  }
  return n;
}

vec4 project_offset_(vec4 offset) {
  float dy = offset.y;
  vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
  return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
  float x = lnglat.x;
  if (project_uWrapLongitude) {
    x = mod(x + 180., 360.0) - 180.;
  }
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

vec3 project_globe_(vec3 lnglatz) {
  float lambda = radians(lnglatz.x);
  float phi = radians(lnglatz.y);
  float cosPhi = cos(phi);
  float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;

  return vec3(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
  vec4 position_world = project_uModelMatrix * position;
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_mercator_(position_world.xy),
        project_size_at_latitude(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world.xyz += project_uCoordinateOrigin;
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
        return vec4(
          project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
          project_size(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
    (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
    (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
     project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world.xyz -= project_uCoordinateOrigin;
  }
  return project_offset_(position_world + project_uModelMatrix * vec4(position64Low, 0.0));
}

vec4 project_position(vec4 position) {
  return project_position(position, ZERO_64_LOW);
}

vec3 project_position(vec3 position, vec3 position64Low) {
  vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
  return projected_position.xyz;
}

vec3 project_position(vec3 position) {
  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

vec2 project_position(vec2 position) {
  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
  return offset * project_uFocalDistance;
}

float project_size_to_pixel(float meters) {
  return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
  if (unit == UNIT_METERS) return project_size_to_pixel(size);
  if (unit == UNIT_COMMON) return size * project_uScale;
  return size;
}
float project_pixel_size(float pixels) {
  return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
  return pixels / project_uScale;
}
`);function uV(r,t){if(r===t)return!0;if(Array.isArray(r)){const e=r.length;if(!t||t.length!==e)return!1;for(let n=0;n<e;n++)if(r[n]!==t[n])return!1;return!0}return!1}function Up(r){let t={},e;return n=>{for(const i in n)if(!uV(n[i],t[i])){e=r(n),t=n;break}return e}}const AT=[0,0,0,0],hV=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],uT=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],dV=[0,0,0],hT=[0,0,0],fV=Up(mV);function dT(r,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:hT;e.length<3&&(e=[e[0],e[1],0]);let n=e,i,s=!0;switch(t===En.LNGLAT_OFFSETS||t===En.METER_OFFSETS?i=e:i=r.isGeospatial?[Math.fround(r.longitude),Math.fround(r.latitude),0]:null,r.projectionMode){case El.WEB_MERCATOR:(t===En.LNGLAT||t===En.CARTESIAN)&&(i=[0,0,0],s=!1);break;case El.WEB_MERCATOR_AUTO_OFFSET:t===En.LNGLAT?n=i:t===En.CARTESIAN&&(n=[Math.fround(r.center[0]),Math.fround(r.center[1]),0],i=r.unprojectPosition(n),n[0]-=e[0],n[1]-=e[1],n[2]-=e[2]);break;case El.IDENTITY:n=r.position.map(Math.fround),n[2]=n[2]||0;break;case El.GLOBE:s=!1,i=null;break;default:s=!1}return{geospatialOrigin:i,shaderCoordinateOrigin:n,offsetMode:s}}function pV(r,t,e){const{viewMatrixUncentered:n,projectionMatrix:i}=r;let{viewMatrix:s,viewProjectionMatrix:a}=r,o=AT,h=AT,f=r.cameraPosition;const{geospatialOrigin:g,shaderCoordinateOrigin:b,offsetMode:C}=dT(r,t,e);return C&&(h=r.projectPosition(g||b),f=[f[0]-h[0],f[1]-h[1],f[2]-h[2]],h[3]=1,o=Ip([],h,a),s=n||s,a=mh([],i,s),a=mh([],a,hV)),{viewMatrix:s,viewProjectionMatrix:a,projectionCenter:o,originCommon:h,cameraPosCommon:f,shaderCoordinateOrigin:b,geospatialOrigin:g}}function gV(r){let{viewport:t,devicePixelRatio:e=1,modelMatrix:n=null,coordinateSystem:i=En.DEFAULT,coordinateOrigin:s=hT,autoWrapLongitude:a=!1}=r;i===En.DEFAULT&&(i=t.isGeospatial?En.LNGLAT:En.CARTESIAN);const o=fV({viewport:t,devicePixelRatio:e,coordinateSystem:i,coordinateOrigin:s});return o.project_uWrapLongitude=a,o.project_uModelMatrix=n||uT,o}function mV(r){let{viewport:t,devicePixelRatio:e,coordinateSystem:n,coordinateOrigin:i}=r;const{projectionCenter:s,viewProjectionMatrix:a,originCommon:o,cameraPosCommon:h,shaderCoordinateOrigin:f,geospatialOrigin:g}=pV(t,n,i),b=t.getDistanceScales(),C=[t.width*e,t.height*e],B=Ip([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,R={project_uCoordinateSystem:n,project_uProjectionMode:t.projectionMode,project_uCoordinateOrigin:f,project_uCommonOrigin:o.slice(0,3),project_uCenter:s,project_uPseudoMeters:!!t._pseudoMeters,project_uViewportSize:C,project_uDevicePixelRatio:e,project_uFocalDistance:B,project_uCommonUnitsPerMeter:b.unitsPerMeter,project_uCommonUnitsPerWorldUnit:b.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:dV,project_uScale:t.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:a,project_uModelMatrix:uT,project_uCameraPosition:h};if(g){const D=t.getDistanceScales(g);switch(n){case En.METER_OFFSETS:R.project_uCommonUnitsPerWorldUnit=D.unitsPerMeter,R.project_uCommonUnitsPerWorldUnit2=D.unitsPerMeter2;break;case En.LNGLAT:case En.LNGLAT_OFFSETS:t._pseudoMeters||(R.project_uCommonUnitsPerMeter=D.unitsPerMeter),R.project_uCommonUnitsPerWorldUnit=D.unitsPerDegree,R.project_uCommonUnitsPerWorldUnit2=D.unitsPerDegree2;break;case En.CARTESIAN:R.project_uCommonUnitsPerWorldUnit=[1,1,D.unitsPerMeter[2]],R.project_uCommonUnitsPerWorldUnit2=[0,0,D.unitsPerMeter2[2]];break}}return R}const yV={};function _V(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:yV;return"viewport"in r?gV(r):{}}const jv={name:"project",dependencies:[j9,oV],vs:AV,getUniforms:_V};function vV(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Md(r,t){const e=Ip([],t,r);return j5(e,e,1/e[3]),e}function fT(r,t){const e=r%t;return e<0?t+e:e}function qv(r,t,e){return r<t?t:r>e?e:r}function bV(r){return Math.log(r)*Math.LOG2E}const Kv=Math.log2||bV;function CA(r,t){if(!r)throw new Error(t||"@math.gl/web-mercator: assertion failed.")}const Pc=Math.PI,pT=Pc/4,ec=Pc/180,$v=180/Pc,Pd=512,a0=4003e4,c0=85.051129,wV=1.5;function xV(r){return Kv(r)}function Rp(r){const[t,e]=r;CA(Number.isFinite(t)),CA(Number.isFinite(e)&&e>=-90&&e<=90,"invalid latitude");const n=t*ec,i=e*ec,s=Pd*(n+Pc)/(2*Pc),a=Pd*(Pc+Math.log(Math.tan(pT+i*.5)))/(2*Pc);return[s,a]}function Ud(r){const[t,e]=r,n=t/Pd*(2*Pc)-Pc,i=2*(Math.atan(Math.exp(e/Pd*(2*Pc)-Pc))-pT);return[n*$v,i*$v]}function BV(r){const{latitude:t}=r;CA(Number.isFinite(t));const e=Math.cos(t*ec);return xV(a0*e)-9}function l0(r){const t=Math.cos(r*ec);return Pd/a0/t}function Wv(r){const{latitude:t,longitude:e,highPrecision:n=!1}=r;CA(Number.isFinite(t)&&Number.isFinite(e));const i=Pd,s=Math.cos(t*ec),a=i/360,o=a/s,h=i/a0/s,f={unitsPerMeter:[h,h,h],metersPerUnit:[1/h,1/h,1/h],unitsPerDegree:[a,o,h],degreesPerUnit:[1/a,1/o,1/h]};if(n){const g=ec*Math.tan(t*ec)/s,b=a*g/2,C=i/a0*g,B=C/o*h;f.unitsPerDegree2=[0,b,C],f.unitsPerMeter2=[B,0,B]}return f}function gT(r,t){const[e,n,i]=r,[s,a,o]=t,{unitsPerMeter:h,unitsPerMeter2:f}=Wv({longitude:e,latitude:n,highPrecision:!0}),g=Rp(r);g[0]+=s*(h[0]+f[0]*a),g[1]+=a*(h[1]+f[1]*a);const b=Ud(g),C=(i||0)+(o||0);return Number.isFinite(i)||Number.isFinite(o)?[b[0],b[1],C]:b}function CV(r){const{height:t,pitch:e,bearing:n,altitude:i,scale:s,center:a}=r,o=vV();r0(o,o,[0,0,-i]),G5(o,o,-e*ec),V5(o,o,n*ec);const h=s/t;return Dv(o,o,[h,h,h]),a&&r0(o,o,l7([],a)),o}function EV(r){const{width:t,height:e,altitude:n,pitch:i=0,offset:s,center:a,scale:o,nearZMultiplier:h=1,farZMultiplier:f=1}=r;let{fovy:g=A0(wV)}=r;n!==void 0&&(g=A0(n));const b=g*ec,C=i*ec,B=mT(g);let R=B;a&&(R+=a[2]*o/Math.cos(C)/e);const D=b*(.5+(s?s[1]:0)/e),Q=Math.sin(D)*R/Math.sin(qv(Math.PI/2-C-D,.01,Math.PI-.01)),k=Math.sin(C)*Q+R,j=R*10,et=Math.min(k*f,j);return{fov:b,aspect:t/e,focalDistance:B,near:h,far:et}}function A0(r){return 2*Math.atan(.5/r)*$v}function mT(r){return .5/Math.tan(.5*r*ec)}function yT(r,t){const[e,n,i=0]=r;return CA(Number.isFinite(e)&&Number.isFinite(n)&&Number.isFinite(i)),Md(t,[e,n,i,1])}function Xv(r,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const[n,i,s]=r;if(CA(Number.isFinite(n)&&Number.isFinite(i),"invalid pixel coordinate"),Number.isFinite(s))return Md(t,[n,i,s,1]);const a=Md(t,[n,i,0,1]),o=Md(t,[n,i,1,1]),h=a[2],f=o[2],g=h===f?0:((e||0)-h)/(f-h);return I5([],a,o,g)}function SV(r){const{width:t,height:e,bounds:n,minExtent:i=0,maxZoom:s=24,offset:a=[0,0]}=r,[[o,h],[f,g]]=n,b=TV(r.padding),C=Rp([o,qv(g,-c0,c0)]),B=Rp([f,qv(h,-c0,c0)]),R=[Math.max(Math.abs(B[0]-C[0]),i),Math.max(Math.abs(B[1]-C[1]),i)],D=[t-b.left-b.right-Math.abs(a[0])*2,e-b.top-b.bottom-Math.abs(a[1])*2];CA(D[0]>0&&D[1]>0);const Q=D[0]/R[0],k=D[1]/R[1],j=(b.right-b.left)/2/Q,et=(b.top-b.bottom)/2/k,st=[(B[0]+C[0])/2+j,(B[1]+C[1])/2+et],mt=Ud(st),pt=Math.min(s,Kv(Math.abs(Math.min(Q,k))));return CA(Number.isFinite(pt)),{longitude:mt[0],latitude:mt[1],zoom:pt}}function TV(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return typeof r=="number"?{top:r,bottom:r,left:r,right:r}:(CA(Number.isFinite(r.top)&&Number.isFinite(r.bottom)&&Number.isFinite(r.left)&&Number.isFinite(r.right)),r)}const _T=Math.PI/180;function IV(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const{width:e,height:n,unproject:i}=r,s={targetZ:t},a=i([0,n],s),o=i([e,n],s);let h,f;const g=r.fovy?.5*r.fovy*_T:Math.atan(.5/r.altitude),b=(90-r.pitch)*_T;return g>b-.01?(h=vT(r,0,t),f=vT(r,e,t)):(h=i([0,0],s),f=i([e,0],s)),[a,o,f,h]}function vT(r,t,e){const{pixelUnprojectionMatrix:n}=r,i=Md(n,[t,0,1,1]),s=Md(n,[t,r.height,1,1]),o=(e*r.distanceScales.unitsPerMeter[2]-i[2])/(s[2]-i[2]),h=I5([],i,s,o),f=Ud(h);return f.push(e),f}const bT=512;function LV(r){const{width:t,height:e,pitch:n=0}=r;let{longitude:i,latitude:s,zoom:a,bearing:o=0}=r;(i<-180||i>180)&&(i=fT(i+180,360)-180),(o<-180||o>180)&&(o=fT(o+180,360)-180);const h=Kv(e/bT);if(a<=h)a=h,s=0;else{const f=e/2/Math.pow(2,a),g=Ud([0,f])[1];if(s<g)s=g;else{const b=Ud([0,bT-f])[1];s>b&&(s=b)}}return{width:t,height:e,longitude:i,latitude:s,zoom:a,pitch:n,bearing:o}}const FV=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,MV=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture2D(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,PV=Up(NV),UV=Up(kV),RV=[0,0,0,1],DV=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function OV(r,t){const[e,n,i]=r,s=Xv([e,n,i],t);return Number.isFinite(i)?s:[s[0],s[1],0]}function NV(r){let{viewport:t,center:e}=r;return new Cn(t.viewProjectionMatrix).invert().transform(e)}function kV(r){let{viewport:t,shadowMatrices:e}=r;const n=[],i=t.pixelUnprojectionMatrix,s=t.isGeospatial?void 0:1,a=[[0,0,s],[t.width,0,s],[0,t.height,s],[t.width,t.height,s],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(o=>OV(o,i));for(const o of e){const h=o.clone().translate(new ue(t.center).negate()),f=a.map(b=>h.transform(b)),g=new Cn().ortho({left:Math.min(...f.map(b=>b[0])),right:Math.max(...f.map(b=>b[0])),bottom:Math.min(...f.map(b=>b[1])),top:Math.max(...f.map(b=>b[1])),near:Math.min(...f.map(b=>-b[2])),far:Math.max(...f.map(b=>-b[2]))});n.push(g.multiplyRight(o))}return n}function QV(r,t){const{shadowEnabled:e=!0}=r;if(!e||!r.shadowMatrices||!r.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1};const n={shadow_uDrawShadowMap:!!r.drawToShadowMap,shadow_uUseShadowMap:r.shadowMaps?r.shadowMaps.length>0:!1,shadow_uColor:r.shadowColor||RV,shadow_uLightId:r.shadowLightId||0,shadow_uLightCount:r.shadowMatrices.length},i=PV({viewport:r.viewport,center:t.project_uCenter}),s=[],a=UV({shadowMatrices:r.shadowMatrices,viewport:r.viewport}).slice();for(let o=0;o<r.shadowMatrices.length;o++){const h=a[o],f=h.clone().translate(new ue(r.viewport.center).negate());t.project_uCoordinateSystem===En.LNGLAT&&t.project_uProjectionMode===El.WEB_MERCATOR?(a[o]=f,s[o]=i):(a[o]=h.clone().multiplyRight(DV),s[o]=f.transform(i))}for(let o=0;o<a.length;o++)n["shadow_uViewProjectionMatrices[".concat(o,"]")]=a[o],n["shadow_uProjectCenters[".concat(o,"]")]=s[o],r.shadowMaps&&r.shadowMaps.length>0?n["shadow_uShadowMap".concat(o)]=r.shadowMaps[o]:n["shadow_uShadowMap".concat(o)]=r.dummyShadowMap;return n}const Jv={name:"shadow",dependencies:[jv],vs:FV,fs:MV,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return"viewport"in r&&(r.drawToShadowMap||r.shadowMaps&&r.shadowMaps.length>0)?QV(r,t):{}}},zV={color:[255,255,255],intensity:1},wT=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],HV=[0,0,0,200/255];class Yv{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};K(this,"id","lighting-effect"),K(this,"props",void 0),K(this,"shadowColor",HV),K(this,"shadow",void 0),K(this,"ambientLight",void 0),K(this,"directionalLights",void 0),K(this,"pointLights",void 0),K(this,"shadowPasses",[]),K(this,"shadowMaps",[]),K(this,"dummyShadowMap",null),K(this,"programManager",void 0),K(this,"shadowMatrices",void 0),this.setProps(t)}setProps(t){this.ambientLight=null,this.directionalLights=[],this.pointLights=[];for(const e in t){const n=t[e];switch(n.type){case"ambient":this.ambientLight=n;break;case"directional":this.directionalLights.push(n);break;case"point":this.pointLights.push(n);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(e=>e.shadow),this.props=t}preRender(t,e){let{layers:n,layerFilter:i,viewports:s,onViewportActive:a,views:o}=e;if(this.shadow){this.shadowMatrices=this._calculateMatrices(),this.shadowPasses.length===0&&this._createShadowPasses(t),this.programManager||(this.programManager=Mp.getDefaultProgramManager(t),Jv&&this.programManager.addDefaultModule(Jv)),this.dummyShadowMap||(this.dummyShadowMap=new La(t,{width:1,height:1}));for(let h=0;h<this.shadowPasses.length;h++)this.shadowPasses[h].render({layers:n,layerFilter:i,viewports:s,onViewportActive:a,views:o,moduleParameters:{shadowLightId:h,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(t){const e=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return e.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(n=>n.getProjectedLight({layer:t})),pointLights:this.pointLights.map(n=>n.getProjectedLight({layer:t}))},e}cleanup(){for(const t of this.shadowPasses)t.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.delete(),this.dummyShadowMap=null),this.shadow&&this.programManager&&(this.programManager.removeDefaultModule(Jv),this.programManager=null)}_calculateMatrices(){const t=[];for(const e of this.directionalLights){const n=new Cn().lookAt({eye:new ue(e.direction).negate()});t.push(n)}return t}_createShadowPasses(t){for(let e=0;e<this.directionalLights.length;e++){const n=new nV(t);this.shadowPasses[e]=n,this.shadowMaps[e]=n.shadowMap}}_applyDefaultLights(){const{ambientLight:t,pointLights:e,directionalLights:n}=this;!t&&e.length===0&&n.length===0&&(this.ambientLight=new oT(zV),this.directionalLights.push(new aT(wT[0]),new aT(wT[1])))}}class GV{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};K(this,"_pool",[]),K(this,"opts",{overAlloc:2,poolSize:100}),this.setOptions(t)}setOptions(t){Object.assign(this.opts,t)}allocate(t,e,n){let{size:i=1,type:s,padding:a=0,copy:o=!1,initialize:h=!1,maxCount:f}=n;const g=s||t&&t.constructor||Float32Array,b=e*i+a;if(ArrayBuffer.isView(t)){if(b<=t.length)return t;if(b*t.BYTES_PER_ELEMENT<=t.buffer.byteLength)return new g(t.buffer,0,b)}let C=1/0;f&&(C=f*i+a);const B=this._allocate(g,b,h,C);return t&&o?B.set(t):h||B.fill(0,0,4),this._release(t),B}release(t){this._release(t)}_allocate(t,e,n,i){let s=Math.max(Math.ceil(e*this.opts.overAlloc),1);s>i&&(s=i);const a=this._pool,o=t.BYTES_PER_ELEMENT*s,h=a.findIndex(f=>f.byteLength>=o);if(h>=0){const f=new t(a.splice(h,1)[0],0,s);return n&&f.fill(0),f}return new t(s)}_release(t){if(!ArrayBuffer.isView(t))return;const e=this._pool,{buffer:n}=t,{byteLength:i}=n,s=e.findIndex(a=>a.byteLength>=i);s<0?e.push(n):(s>0||e.length<this.opts.poolSize)&&e.splice(s,0,n),e.length>this.opts.poolSize&&e.shift()}}const Dp=new GV;function Op(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function VV(r){return[r[12],r[13],r[14]]}function jV(r){return{left:Rd(r[3]+r[0],r[7]+r[4],r[11]+r[8],r[15]+r[12]),right:Rd(r[3]-r[0],r[7]-r[4],r[11]-r[8],r[15]-r[12]),bottom:Rd(r[3]+r[1],r[7]+r[5],r[11]+r[9],r[15]+r[13]),top:Rd(r[3]-r[1],r[7]-r[5],r[11]-r[9],r[15]-r[13]),near:Rd(r[3]+r[2],r[7]+r[6],r[11]+r[10],r[15]+r[14]),far:Rd(r[3]-r[2],r[7]-r[6],r[11]-r[10],r[15]-r[14])}}const xT=new ue;function Rd(r,t,e,n){xT.set(r,t,e);const i=xT.len();return{distance:n/i,normal:new ue(-r/i,-t/i,-e/i)}}function qV(r){return r-Math.fround(r)}let Np;function Zv(r,t){const{size:e=1,startIndex:n=0}=t,i=t.endIndex!==void 0?t.endIndex:r.length,s=(i-n)/e;Np=Dp.allocate(Np,s,{type:Float32Array,size:e*2});let a=n,o=0;for(;a<i;){for(let h=0;h<e;h++){const f=r[a++];Np[o+h]=f,Np[o+h+e]=qV(f)}o+=e*2}return Np.subarray(0,s*e*2)}function KV(r){let t=null,e=!1;for(const n of r)n&&(t?(e||(t=[[t[0][0],t[0][1]],[t[1][0],t[1][1]]],e=!0),t[0][0]=Math.min(t[0][0],n[0][0]),t[0][1]=Math.min(t[0][1],n[0][1]),t[1][0]=Math.max(t[1][0],n[1][0]),t[1][1]=Math.max(t[1][1],n[1][1])):t=n);return t}const $V=Math.PI/180,WV=Op(),BT=[0,0,0],XV={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function JV(r){let{width:t,height:e,orthographic:n,fovyRadians:i,focalDistance:s,padding:a,near:o,far:h}=r;const f=t/e,g=n?new Cn().orthographic({fovy:i,aspect:f,focalDistance:s,near:o,far:h}):new Cn().perspective({fovy:i,aspect:f,near:o,far:h});if(a){const{left:b=0,right:C=0,top:B=0,bottom:R=0}=a,D=BA((b+t-C)/2,0,t)-t/2,Q=BA((B+e-R)/2,0,e)-e/2;g[8]-=D*2/t,g[9]+=Q*2/e}return g}class Dd{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};K(this,"id",void 0),K(this,"x",void 0),K(this,"y",void 0),K(this,"width",void 0),K(this,"height",void 0),K(this,"padding",void 0),K(this,"isGeospatial",void 0),K(this,"zoom",void 0),K(this,"focalDistance",void 0),K(this,"position",void 0),K(this,"modelMatrix",void 0),K(this,"distanceScales",void 0),K(this,"scale",void 0),K(this,"center",void 0),K(this,"cameraPosition",void 0),K(this,"projectionMatrix",void 0),K(this,"viewMatrix",void 0),K(this,"viewMatrixUncentered",void 0),K(this,"viewMatrixInverse",void 0),K(this,"viewProjectionMatrix",void 0),K(this,"pixelProjectionMatrix",void 0),K(this,"pixelUnprojectionMatrix",void 0),K(this,"resolution",void 0),K(this,"_frustumPlanes",{}),this.id=t.id||this.constructor.displayName||"viewport",this.x=t.x||0,this.y=t.y||0,this.width=t.width||1,this.height=t.height||1,this.zoom=t.zoom||0,this.padding=t.padding,this.distanceScales=t.distanceScales||XV,this.focalDistance=t.focalDistance||1,this.position=t.position||BT,this.modelMatrix=t.modelMatrix||null;const{longitude:e,latitude:n}=t;this.isGeospatial=Number.isFinite(n)&&Number.isFinite(e),this._initProps(t),this._initMatrices(t),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?El.WEB_MERCATOR:El.WEB_MERCATOR_AUTO_OFFSET:El.IDENTITY}equals(t){return t instanceof Dd?this===t?!0:t.width===this.width&&t.height===this.height&&t.scale===this.scale&&Fc(t.projectionMatrix,this.projectionMatrix)&&Fc(t.viewMatrix,this.viewMatrix):!1}project(t){let{topLeft:e=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=this.projectPosition(t),i=yT(n,this.pixelProjectionMatrix),[s,a]=i,o=e?a:this.height-a;return t.length===2?[s,o]:[s,o,i[2]]}unproject(t){let{topLeft:e=!0,targetZ:n}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const[i,s,a]=t,o=e?s:this.height-s,h=n&&n*this.distanceScales.unitsPerMeter[2],f=Xv([i,o,a],this.pixelUnprojectionMatrix,h),[g,b,C]=this.unprojectPosition(f);return Number.isFinite(a)?[g,b,C]:Number.isFinite(n)?[g,b,n]:[g,b]}projectPosition(t){const[e,n]=this.projectFlat(t),i=(t[2]||0)*this.distanceScales.unitsPerMeter[2];return[e,n,i]}unprojectPosition(t){const[e,n]=this.unprojectFlat(t),i=(t[2]||0)*this.distanceScales.metersPerUnit[2];return[e,n,i]}projectFlat(t){if(this.isGeospatial){const e=Rp(t);return e[1]=BA(e[1],-318,830),e}return t}unprojectFlat(t){return this.isGeospatial?Ud(t):t}getBounds(){const e={targetZ:(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{}).z||0},n=this.unproject([0,0],e),i=this.unproject([this.width,0],e),s=this.unproject([0,this.height],e),a=this.unproject([this.width,this.height],e);return[Math.min(n[0],i[0],s[0],a[0]),Math.min(n[1],i[1],s[1],a[1]),Math.max(n[0],i[0],s[0],a[0]),Math.max(n[1],i[1],s[1],a[1])]}getDistanceScales(t){return t?Wv({longitude:t[0],latitude:t[1],highPrecision:!0}):this.distanceScales}containsPixel(t){let{x:e,y:n,width:i=1,height:s=1}=t;return e<this.x+this.width&&this.x<e+i&&n<this.y+this.height&&this.y<n+s}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,jV(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(t,e){return null}_initProps(t){const e=t.longitude,n=t.latitude;this.isGeospatial&&(Number.isFinite(t.zoom)||(this.zoom=BV({latitude:n})+Math.log2(this.focalDistance)),this.distanceScales=t.distanceScales||Wv({latitude:n,longitude:e}));const i=Math.pow(2,this.zoom);this.scale=i;const{position:s,modelMatrix:a}=t;let o=BT;if(s&&(o=a?new Cn(a).transformAsVector(s,[]):s),this.isGeospatial){const h=this.projectPosition([e,n,0]);this.center=new ue(o).scale(this.distanceScales.unitsPerMeter).add(h)}else this.center=this.projectPosition(o)}_initMatrices(t){const{viewMatrix:e=WV,projectionMatrix:n=null,orthographic:i=!1,fovyRadians:s,fovy:a=75,near:o=.1,far:h=1e3,padding:f=null,focalDistance:g=1}=t;this.viewMatrixUncentered=e,this.viewMatrix=new Cn().multiplyRight(e).translate(new ue(this.center).negate()),this.projectionMatrix=n||JV({width:this.width,height:this.height,orthographic:i,fovyRadians:s||a*$V,focalDistance:g,padding:f,near:o,far:h});const b=Op();mh(b,b,this.projectionMatrix),mh(b,b,this.viewMatrix),this.viewProjectionMatrix=b,this.viewMatrixInverse=Rv([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=VV(this.viewMatrixInverse);const C=Op(),B=Op();Dv(C,C,[this.width/2,-this.height/2,1]),r0(C,C,[1,-1,0]),mh(B,C,this.viewProjectionMatrix),this.pixelProjectionMatrix=B,this.pixelUnprojectionMatrix=Rv(Op(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||Ln.warn("Pixel project matrix not invertible")()}}K(Dd,"displayName","Viewport");class yh extends Dd{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{latitude:e=0,longitude:n=0,zoom:i=0,pitch:s=0,bearing:a=0,nearZMultiplier:o=.1,farZMultiplier:h=1.01,nearZ:f,farZ:g,orthographic:b=!1,projectionMatrix:C,repeat:B=!1,worldOffset:R=0,position:D,padding:Q,legacyMeterSizes:k=!1}=t;let{width:j,height:et,altitude:st=1.5}=t;const mt=Math.pow(2,i);j=j||1,et=et||1;let pt,yt=null;if(C)st=C[5]/2,pt=A0(st);else{t.fovy?(pt=t.fovy,st=mT(pt)):pt=A0(st);let Dt;if(Q){const{top:It=0,bottom:ut=0}=Q;Dt=[0,BA((It+et-ut)/2,0,et)-et/2]}yt=EV({width:j,height:et,scale:mt,center:D&&[0,0,D[2]*l0(e)],offset:Dt,pitch:s,fovy:pt,nearZMultiplier:o,farZMultiplier:h}),Number.isFinite(f)&&(yt.near=f),Number.isFinite(g)&&(yt.far=g)}let ft=CV({height:et,pitch:s,bearing:a,scale:mt,altitude:st});R&&(ft=new Cn().translate([512*R,0,0]).multiplyLeft(ft)),super({...t,width:j,height:et,viewMatrix:ft,longitude:n,latitude:e,zoom:i,...yt,fovy:pt,focalDistance:st}),K(this,"longitude",void 0),K(this,"latitude",void 0),K(this,"pitch",void 0),K(this,"bearing",void 0),K(this,"altitude",void 0),K(this,"fovy",void 0),K(this,"orthographic",void 0),K(this,"_subViewports",void 0),K(this,"_pseudoMeters",void 0),this.latitude=e,this.longitude=n,this.zoom=i,this.pitch=s,this.bearing=a,this.altitude=st,this.fovy=pt,this.orthographic=b,this._subViewports=B?[]:null,this._pseudoMeters=k,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const t=this.getBounds(),e=Math.floor((t[0]+180)/360),n=Math.ceil((t[2]-180)/360);for(let i=e;i<=n;i++){const s=i?new yh({...this,worldOffset:i}):this;this._subViewports.push(s)}}return this._subViewports}projectPosition(t){if(this._pseudoMeters)return super.projectPosition(t);const[e,n]=this.projectFlat(t),i=(t[2]||0)*l0(t[1]);return[e,n,i]}unprojectPosition(t){if(this._pseudoMeters)return super.unprojectPosition(t);const[e,n]=this.unprojectFlat(t),i=(t[2]||0)/l0(n);return[e,n,i]}addMetersToLngLat(t,e){return gT(t,e)}panByPosition(t,e){const n=Xv(e,this.pixelUnprojectionMatrix),i=this.projectFlat(t),s=T5([],i,n7([],n)),a=T5([],this.center,s),[o,h]=this.unprojectFlat(a);return{longitude:o,latitude:h}}getBounds(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=IV(this,t.z||0);return[Math.min(e[0][0],e[1][0],e[2][0],e[3][0]),Math.min(e[0][1],e[1][1],e[2][1],e[3][1]),Math.max(e[0][0],e[1][0],e[2][0],e[3][0]),Math.max(e[0][1],e[1][1],e[2][1],e[3][1])]}fitBounds(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{width:n,height:i}=this,{longitude:s,latitude:a,zoom:o}=SV({width:n,height:i,bounds:t,...e});return new yh({width:n,height:i,longitude:s,latitude:a,zoom:o})}}K(yh,"displayName","WebMercatorViewport");const CT=[0,0,0];function tb(r,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const n=t.projectPosition(r);if(e&&t instanceof yh){const[i,s,a=0]=r,o=t.getDistanceScales([i,s]);n[2]=a*o.unitsPerMeter[2]}return n}function YV(r){const{viewport:t,modelMatrix:e,coordinateOrigin:n}=r;let{coordinateSystem:i,fromCoordinateSystem:s,fromCoordinateOrigin:a}=r;return i===En.DEFAULT&&(i=t.isGeospatial?En.LNGLAT:En.CARTESIAN),s===void 0&&(s=i),a===void 0&&(a=n),{viewport:t,coordinateSystem:i,coordinateOrigin:n,modelMatrix:e,fromCoordinateSystem:s,fromCoordinateOrigin:a}}function ET(r,t){let{viewport:e,modelMatrix:n,coordinateSystem:i,coordinateOrigin:s,offsetMode:a}=t,[o,h,f=0]=r;switch(n&&([o,h,f]=Ip([],[o,h,f,1],n)),i){case En.LNGLAT:return tb([o,h,f],e,a);case En.LNGLAT_OFFSETS:return tb([o+s[0],h+s[1],f+(s[2]||0)],e,a);case En.METER_OFFSETS:return tb(gT(s,[o,h,f]),e,a);case En.CARTESIAN:default:return e.isGeospatial?[o+s[0],h+s[1],f+s[2]]:e.projectPosition([o,h,f])}}function ZV(r,t){const{viewport:e,coordinateSystem:n,coordinateOrigin:i,modelMatrix:s,fromCoordinateSystem:a,fromCoordinateOrigin:o}=YV(t),{autoOffset:h=!0}=t,{geospatialOrigin:f=CT,shaderCoordinateOrigin:g=CT,offsetMode:b=!1}=h?dT(e,n,i):{},C=ET(r,{viewport:e,modelMatrix:s,coordinateSystem:a,coordinateOrigin:o,offsetMode:b});if(b){const B=e.projectPosition(f||g);p7(C,C,B)}return C}const ST={blendFunc:[1,0,32771,0],blendEquation:32774};class TT extends Vv{constructor(){super(...arguments),K(this,"pickZ",void 0),K(this,"_colorEncoderState",null)}render(t){return"pickingFBO"in t?this._drawPickingBuffer(t):super.render(t)}_drawPickingBuffer(t){let{layers:e,layerFilter:n,views:i,viewports:s,onViewportActive:a,pickingFBO:o,deviceRect:{x:h,y:f,width:g,height:b},cullRect:C,effects:B,pass:R="picking",pickZ:D,moduleParameters:Q}=t;const k=this.gl;this.pickZ=D;const j=this._resetColorEncoder(D),et=Ic(k,{scissorTest:!0,scissor:[h,f,g,b],clearColor:[0,0,0,0],depthMask:!0,depthTest:!0,depthRange:[0,1],colorMask:[!0,!0,!0,!0],...ST,blend:!D},()=>super.render({target:o,layers:e,layerFilter:n,views:i,viewports:s,onViewportActive:a,cullRect:C,effects:B==null?void 0:B.filter(mt=>mt.useInPicking),pass:R,isPicking:!0,moduleParameters:Q}));return this._colorEncoderState=null,{decodePickingColor:j&&ej.bind(null,j),stats:et}}shouldDrawLayer(t){const{pickable:e,operation:n}=t.props;return e&&n.includes("draw")||n.includes("terrain")||n.includes("mask")}getModuleParameters(){return{pickingActive:1,pickingAttribute:this.pickZ,lightSources:{}}}getLayerParameters(t,e,n){const i={...t.props.parameters},{pickable:s,operation:a}=t.props;return this._colorEncoderState?s&&a.includes("draw")&&(Object.assign(i,ST),i.blend=!0,i.blendColor=tj(this._colorEncoderState,t,n)):i.blend=!1,a.includes("terrain")&&(i.blend=!1),i}_resetColorEncoder(t){return this._colorEncoderState=t?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function tj(r,t,e){const{byLayer:n,byAlpha:i}=r;let s,a=n.get(t);return a?(a.viewports.push(e),s=a.a):(s=n.size+1,s<=255?(a={a:s,layer:t,viewports:[e]},n.set(t,a),i[s]=a):(Ln.warn("Too many pickable layers, only picking the first 255")(),s=0)),[0,0,0,s/255]}function ej(r,t){const e=r.byAlpha[t[3]];return e&&{pickedLayer:e.layer,pickedViewports:e.viewports,pickedObjectIndex:e.layer.decodePickingColor(t)}}const Od={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},u0=Symbol.for("component"),mu=Symbol.for("propTypes"),eb=Symbol.for("deprecatedProps"),Nd=Symbol.for("asyncPropDefaults"),_h=Symbol.for("asyncPropOriginal"),yu=Symbol.for("asyncPropResolved");function h0(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:()=>!0;return Array.isArray(r)?IT(r,t,[]):t(r)?[r]:[]}function IT(r,t,e){let n=-1;for(;++n<r.length;){const i=r[n];Array.isArray(i)?IT(i,t,e):t(i)&&e.push(i)}return e}function rj(r){let{target:t,source:e,start:n=0,count:i=1}=r;const s=e.length,a=i*s;let o=0;for(let h=n;o<s;o++)t[h++]=e[o];for(;o<a;)o<a-o?(t.copyWithin(n+o,n,n+o),o*=2):(t.copyWithin(n+o,n,n+a-o),o=a);return t}function LT(){let r;if(typeof window<"u"&&window.performance)r=window.performance.now();else if(typeof process<"u"&&process.hrtime){const t=process.hrtime();r=t[0]*1e3+t[1]/1e6}else r=Date.now();return r}class FT{constructor(t,e){K(this,"name",void 0),K(this,"type",void 0),K(this,"sampleSize",1),K(this,"time",void 0),K(this,"count",void 0),K(this,"samples",void 0),K(this,"lastTiming",void 0),K(this,"lastSampleTime",void 0),K(this,"lastSampleCount",void 0),K(this,"_count",0),K(this,"_time",0),K(this,"_samples",0),K(this,"_startTime",0),K(this,"_timerPending",!1),this.name=t,this.type=e,this.reset()}setSampleSize(t){return this.sampleSize=t,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(t){return this._count+=t,this._samples++,this._checkSampling(),this}subtractCount(t){return this._count-=t,this._samples++,this._checkSampling(),this}addTime(t){return this._time+=t,this.lastTiming=t,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=LT(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(LT()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class MT{constructor(t){K(this,"id",void 0),K(this,"stats",{}),this.id=t.id,this.stats={},this._initializeStats(t.stats),Object.seal(this)}get(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:t,type:e})}get size(){return Object.keys(this.stats).length}reset(){for(const t in this.stats)this.stats[t].reset();return this}forEach(t){for(const e in this.stats)t(this.stats[e])}getTable(){const t={};return this.forEach(e=>{t[e.name]={time:e.time||0,count:e.count||0,average:e.getAverageTime()||0,hz:e.getHz()||0}}),t}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(e=>this._getOrCreate(e))}_getOrCreate(t){if(!t||!t.name)return null;const{name:e,type:n}=t;return this.stats[e]||(t instanceof FT?this.stats[e]=t:this.stats[e]=new FT(e,n)),this.stats[e]}}class nj{constructor(t,e,n){K(this,"id",void 0),K(this,"context",void 0),K(this,"isLoaded",void 0),K(this,"persistent",void 0),K(this,"_loadCount",0),K(this,"_subscribers",new Set),K(this,"_data",void 0),K(this,"_loader",void 0),K(this,"_error",void 0),K(this,"_content",void 0),this.id=t,this.context=n,this.setData(e)}subscribe(t){this._subscribers.add(t)}unsubscribe(t){this._subscribers.delete(t)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(t,e){if(t===this._data&&!e)return;this._data=t;const n=++this._loadCount;let i=t;typeof t=="string"&&(i=uu(t)),i instanceof Promise?(this.isLoaded=!1,this._loader=i.then(s=>{this._loadCount===n&&(this.isLoaded=!0,this._error=void 0,this._content=s)}).catch(s=>{this._loadCount===n&&(this.isLoaded=!0,this._error=s||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=t);for(const s of this._subscribers)s.onChange(this.getData())}}class ij{constructor(t){let{gl:e,protocol:n}=t;K(this,"protocol",void 0),K(this,"_context",void 0),K(this,"_resources",void 0),K(this,"_consumers",void 0),K(this,"_pruneRequest",void 0),this.protocol=n||"resource://",this._context={gl:e,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(t){return t.startsWith(this.protocol)?!0:t in this._resources}add(t){let{resourceId:e,data:n,forceUpdate:i=!1,persistent:s=!0}=t,a=this._resources[e];a?a.setData(n,i):(a=new nj(e,n,this._context),this._resources[e]=a),a.persistent=s}remove(t){const e=this._resources[t];e&&(e.delete(),delete this._resources[t])}unsubscribe(t){let{consumerId:e}=t;const n=this._consumers[e];if(n){for(const i in n){const s=n[i],a=this._resources[s.resourceId];a&&a.unsubscribe(s)}delete this._consumers[e],this.prune()}}subscribe(t){let{resourceId:e,onChange:n,consumerId:i,requestId:s="default"}=t;const{_resources:a,protocol:o}=this;e.startsWith(o)&&(e=e.replace(o,""),a[e]||this.add({resourceId:e,data:null,persistent:!1}));const h=a[e];if(this._track(i,s,h,n),h)return h.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const t in this._resources)this._resources[t].delete()}_track(t,e,n,i){const s=this._consumers,a=s[t]=s[t]||{},o=a[e]||{},h=o.resourceId&&this._resources[o.resourceId];h&&(h.unsubscribe(o),this.prune()),n&&(a[e]=o,o.onChange=i,o.resourceId=n.id,n.subscribe(o))}_prune(){this._pruneRequest=null;for(const t of Object.keys(this._resources)){const e=this._resources[t];!e.persistent&&!e.inUse()&&(e.delete(),delete this._resources[t])}}}const rb={name:"project32",dependencies:[jv],vs:`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`},nb={inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:#decl":`
uniform bool picking_uAttribute;
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}},..._G},sj=[jv],oj=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function aj(r){const t=Mp.getDefaultProgramManager(r);for(const e of sj)t.addDefaultModule(e);for(const e of oj)t.addShaderHook(e);return t}const cj="layerManager.setLayers",lj="layerManager.activateViewport";class Aj{constructor(t){let{deck:e,stats:n,viewport:i,timeline:s}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};K(this,"layers",void 0),K(this,"context",void 0),K(this,"resourceManager",void 0),K(this,"_lastRenderedLayers",[]),K(this,"_needsRedraw",!1),K(this,"_needsUpdate",!1),K(this,"_nextLayers",null),K(this,"_debug",!1),K(this,"activateViewport",a=>{Ao(lj,this,a),a&&(this.context.viewport=a)}),this.layers=[],this.resourceManager=new ij({gl:t,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,gl:t,deck:e,programManager:t&&aj(t),stats:n||new MT({id:"deck.gl"}),viewport:i||new Dd({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:s||new sT,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const t of this.layers)this._finalizeLayer(t)}needsRedraw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1},e=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);for(const n of this.layers){const i=n.getNeedsRedraw(t);e=e||i}return e}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._needsUpdate}setNeedsRedraw(t){this._needsRedraw=this._needsRedraw||t}setNeedsUpdate(t){this._needsUpdate=this._needsUpdate||t}getLayers(){let{layerIds:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t?this.layers.filter(e=>t.find(n=>e.id.indexOf(n)===0)):this.layers}setProps(t){"debug"in t&&(this._debug=t.debug),"userData"in t&&(this.context.userData=t.userData),"layers"in t&&(this._nextLayers=t.layers),"onError"in t&&(this.context.onError=t.onError)}setLayers(t,e){Ao(cj,this,e,t),this._lastRenderedLayers=t;const n=h0(t,Boolean);for(const i of n)i.context=this.context;this._updateLayers(this.layers,n)}updateLayers(){const t=this.needsUpdate();t&&(this.setNeedsRedraw("updating layers: ".concat(t)),this.setLayers(this._nextLayers||this._lastRenderedLayers,t)),this._nextLayers=null}_handleError(t,e,n){n.raiseError(e,"".concat(t," of ").concat(n))}_updateLayers(t,e){const n={};for(const a of t)n[a.id]?Ln.warn("Multiple old layers with same id ".concat(a.id))():n[a.id]=a;const i=[];this._updateSublayersRecursively(e,n,i),this._finalizeOldLayers(n);let s=!1;for(const a of i)if(a.hasUniformTransition()){s="Uniform transition in ".concat(a);break}this._needsUpdate=s,this.layers=i}_updateSublayersRecursively(t,e,n){for(const i of t){i.context=this.context;const s=e[i.id];s===null&&Ln.warn("Multiple new layers with same id ".concat(i.id))(),e[i.id]=null;let a=null;try{this._debug&&s!==i&&i.validateProps(),s?(this._transferLayerState(s,i),this._updateLayer(i)):this._initializeLayer(i),n.push(i),a=i.isComposite?i.getSubLayers():null}catch(o){this._handleError("matching",o,i)}a&&this._updateSublayersRecursively(a,e,n)}}_finalizeOldLayers(t){for(const e in t){const n=t[e];n&&this._finalizeLayer(n)}}_initializeLayer(t){try{t._initialize(),t.lifecycle=Od.INITIALIZED}catch(e){this._handleError("initialization",e,t)}}_transferLayerState(t,e){e._transferState(t),e.lifecycle=Od.MATCHED,e!==t&&(t.lifecycle=Od.AWAITING_GC)}_updateLayer(t){try{t._update()}catch(e){this._handleError("update",e,t)}}_finalizeLayer(t){this._needsRedraw=this._needsRedraw||"finalized ".concat(t),t.lifecycle=Od.AWAITING_FINALIZATION;try{t._finalize(),t.lifecycle=Od.FINALIZED}catch(e){this._handleError("finalization",e,t)}}}function Tl(r,t,e){if(r===t)return!0;if(!e||!r||!t)return!1;if(Array.isArray(r)){if(!Array.isArray(t)||r.length!==t.length)return!1;for(let n=0;n<r.length;n++)if(!Tl(r[n],t[n],e-1))return!1;return!0}if(Array.isArray(t))return!1;if(typeof r=="object"&&typeof t=="object"){const n=Object.keys(r),i=Object.keys(t);if(n.length!==i.length)return!1;for(const s of n)if(!t.hasOwnProperty(s)||!Tl(r[s],t[s],e-1))return!1;return!0}return!1}class uj{constructor(t){K(this,"width",void 0),K(this,"height",void 0),K(this,"views",void 0),K(this,"viewState",void 0),K(this,"controllers",void 0),K(this,"timeline",void 0),K(this,"_viewports",void 0),K(this,"_viewportMap",void 0),K(this,"_isUpdating",void 0),K(this,"_needsRedraw",void 0),K(this,"_needsUpdate",void 0),K(this,"_eventManager",void 0),K(this,"_eventCallbacks",void 0),this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=t.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=t.eventManager,this._eventCallbacks={onViewStateChange:t.onViewStateChange,onInteractionStateChange:t.onInteractionStateChange},Object.seal(this),this.setProps(t)}finalize(){for(const t in this.controllers){const e=this.controllers[t];e&&e.finalize()}this.controllers={}}needsRedraw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};const e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}setNeedsUpdate(t){this._needsUpdate=this._needsUpdate||t,this._needsRedraw=this._needsRedraw||t}updateViewStates(){for(const t in this.controllers){const e=this.controllers[t];e&&e.updateTransition()}}getViewports(t){return t?this._viewports.filter(e=>e.containsPixel(t)):this._viewports}getViews(){const t={};return this.views.forEach(e=>{t[e.id]=e}),t}getView(t){return this.views.find(e=>e.id===t)}getViewState(t){const e=typeof t=="string"?this.getView(t):t,n=e&&this.viewState[e.getViewStateId()]||this.viewState;return e?e.filterViewState(n):n}getViewport(t){return this._viewportMap[t]}unproject(t,e){const n=this.getViewports(),i={x:t[0],y:t[1]};for(let s=n.length-1;s>=0;--s){const a=n[s];if(a.containsPixel(i)){const o=t.slice();return o[0]-=a.x,o[1]-=a.y,a.unproject(o,e)}}return null}setProps(t){t.views&&this._setViews(t.views),t.viewState&&this._setViewState(t.viewState),("width"in t||"height"in t)&&this._setSize(t.width,t.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(t,e){(t!==this.width||e!==this.height)&&(this.width=t,this.height=e,this.setNeedsUpdate("Size changed"))}_setViews(t){t=h0(t,Boolean),this._diffViews(t,this.views)&&this.setNeedsUpdate("views changed"),this.views=t}_setViewState(t){t?(!Tl(t,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=t):Ln.warn("missing `viewState` or `initialViewState`")()}_onViewStateChange(t,e){this._eventCallbacks.onViewStateChange&&this._eventCallbacks.onViewStateChange({...e,viewId:t})}_createController(t,e){const n=e.type;return new n({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,e.id),onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:s=>{var a;return(a=this.getView(t.id))===null||a===void 0?void 0:a.makeViewport({viewState:s,width:this.width,height:this.height})}})}_updateController(t,e,n,i){const s=t.controller;if(s&&n){const a={...e,...s,id:t.id,x:n.x,y:n.y,width:n.width,height:n.height};return(!i||i.constructor!==s.type)&&(i=this._createController(t,a)),i&&i.setProps(a),i}return null}_rebuildViewports(){const{views:t}=this,e=this.controllers;this._viewports=[],this.controllers={};let n=!1;for(let i=t.length;i--;){const s=t[i],a=this.getViewState(s),o=s.makeViewport({viewState:a,width:this.width,height:this.height});let h=e[s.id];const f=!!s.controller;f&&!h&&(n=!0),(n||!f)&&h&&(h.finalize(),h=null),this.controllers[s.id]=this._updateController(s,a,o,h),o&&this._viewports.unshift(o)}for(const i in e){const s=e[i];s&&!this.controllers[i]&&s.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(t=>{t.id&&(this._viewportMap[t.id]=this._viewportMap[t.id]||t)})}_diffViews(t,e){return t.length!==e.length?!0:t.some((n,i)=>!t[i].equals(e[i]))}}const hj=/([0-9]+\.?[0-9]*)(%|px)/;function _u(r){switch(typeof r){case"number":return{position:r,relative:!1};case"string":const t=hj.exec(r);if(t&&t.length>=3){const e=t[2]==="%",n=parseFloat(t[1]);return{position:e?n/100:n,relative:e}}default:throw new Error("Could not parse position string ".concat(r))}}function vu(r,t){return r.relative?Math.round(r.position*t):r.position}function qs(r,t){if(!r)throw new Error(t||"deck.gl: assertion failed.")}class dj{constructor(t){K(this,"id",void 0),K(this,"viewportInstance",void 0),K(this,"_x",void 0),K(this,"_y",void 0),K(this,"_width",void 0),K(this,"_height",void 0),K(this,"_padding",void 0),K(this,"props",void 0);const{id:e,x:n=0,y:i=0,width:s="100%",height:a="100%",padding:o=null,viewportInstance:h}=t||{};qs(!h||h instanceof Dd),this.viewportInstance=h,this.id=e||this.constructor.displayName||"view",this.props={...t,id:this.id},this._x=_u(n),this._y=_u(i),this._width=_u(s),this._height=_u(a),this._padding=o&&{left:_u(o.left||0),right:_u(o.right||0),top:_u(o.top||0),bottom:_u(o.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(t){return this===t?!0:this.viewportInstance?t.viewportInstance?this.viewportInstance.equals(t.viewportInstance):!1:this.ViewportType===t.ViewportType&&Tl(this.props,t.props,2)}makeViewport(t){let{width:e,height:n,viewState:i}=t;if(this.viewportInstance)return this.viewportInstance;i=this.filterViewState(i);const s=this.getDimensions({width:e,height:n});return!s.height||!s.width?null:new this.ViewportType({...i,...this.props,...s})}getViewStateId(){const{viewState:t}=this.props;return typeof t=="string"?t:(t==null?void 0:t.id)||this.id}filterViewState(t){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const e={...t};for(const n in this.props.viewState)n!=="id"&&(e[n]=this.props.viewState[n]);return e}return t}getDimensions(t){let{width:e,height:n}=t;const i={x:vu(this._x,e),y:vu(this._y,n),width:vu(this._width,e),height:vu(this._height,n)};return this._padding&&(i.padding={left:vu(this._padding.left,e),top:vu(this._padding.top,n),right:vu(this._padding.right,e),bottom:vu(this._padding.bottom,n)}),i}get controller(){const t=this.props.controller;return t?t===!0?{type:this.ControllerType}:typeof t=="function"?{type:t}:{type:this.ControllerType,...t}:null}}class kp{constructor(t){K(this,"_inProgress",void 0),K(this,"_handle",void 0),K(this,"_timeline",void 0),K(this,"time",void 0),K(this,"settings",void 0),this._inProgress=!1,this._handle=null,this._timeline=t,this.time=0,this.settings={duration:0}}get inProgress(){return this._inProgress}start(t){var e,n;this.cancel(),this.settings=t,this._inProgress=!0,(e=(n=this.settings).onStart)===null||e===void 0||e.call(n,this)}end(){if(this._inProgress){var t,e;this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(t=(e=this.settings).onEnd)===null||t===void 0||t.call(e,this)}}cancel(){if(this._inProgress){var t,e;(t=(e=this.settings).onInterrupt)===null||t===void 0||t.call(e,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1}}update(){var t,e;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:n,settings:i}=this;this._handle=n.addChannel({delay:n.getTime(),duration:i.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(t=(e=this.settings).onUpdate)===null||t===void 0||t.call(e,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const PT=()=>{},ib={BREAK:1,SNAP_TO_END:2,IGNORE:3},fj=r=>r,pj=ib.BREAK;class gj{constructor(t){K(this,"getControllerState",void 0),K(this,"props",void 0),K(this,"propsInTransition",void 0),K(this,"transition",void 0),K(this,"onViewStateChange",void 0),K(this,"onStateChange",void 0),K(this,"_onTransitionUpdate",e=>{const{time:n,settings:{interpolator:i,startProps:s,endProps:a,duration:o,easing:h}}=e,f=h(n/o),g=i.interpolateProps(s,a,f);this.propsInTransition=this.getControllerState({...this.props,...g}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})}),this.getControllerState=t.getControllerState,this.propsInTransition=null,this.transition=new kp(t.timeline),this.onViewStateChange=t.onViewStateChange||PT,this.onStateChange=t.onStateChange||PT}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(t){let e=!1;const n=this.props;if(this.props=t,!n||this._shouldIgnoreViewportChange(n,t))return!1;if(this._isTransitionEnabled(t)){let i=n;if(this.transition.inProgress){const{interruption:s,endProps:a}=this.transition.settings;i={...n,...s===ib.SNAP_TO_END?a:this.propsInTransition||n}}this._triggerTransition(i,t),e=!0}else this.transition.cancel();return e}updateTransition(){this.transition.update()}_isTransitionEnabled(t){const{transitionDuration:e,transitionInterpolator:n}=t;return(e>0||e==="auto")&&!!n}_isUpdateDueToCurrentTransition(t){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(t,this.propsInTransition):!1}_shouldIgnoreViewportChange(t,e){return this.transition.inProgress?this.transition.settings.interruption===ib.IGNORE||this._isUpdateDueToCurrentTransition(e):this._isTransitionEnabled(e)?e.transitionInterpolator.arePropsEqual(t,e):!0}_triggerTransition(t,e){const n=this.getControllerState(t),i=this.getControllerState(e).shortestPathFrom(n),s=e.transitionInterpolator,a=s.getDuration?s.getDuration(t,e):e.transitionDuration;if(a===0)return;const o=s.initializeProps(t,i);this.propsInTransition={};const h={duration:a,easing:e.transitionEasing||fj,interpolator:s,interruption:e.transitionInterruption||pj,startProps:o.start,endProps:o.end,onStart:e.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(e.onTransitionInterrupt),onEnd:this._onTransitionEnd(e.onTransitionEnd)};this.transition.start(h),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(t){return e=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),t==null||t(e)}}}class mj{constructor(t){K(this,"_propsToCompare",void 0),K(this,"_propsToExtract",void 0),K(this,"_requiredProps",void 0);const{compare:e,extract:n,required:i}=t;this._propsToCompare=e,this._propsToExtract=n||e,this._requiredProps=i}arePropsEqual(t,e){for(const n of this._propsToCompare)if(!(n in t)||!(n in e)||!Fc(t[n],e[n]))return!1;return!0}initializeProps(t,e){const n={},i={};for(const s of this._propsToExtract)(s in t||s in e)&&(n[s]=t[s],i[s]=e[s]);return this._checkRequiredProps(n),this._checkRequiredProps(i),{start:n,end:i}}getDuration(t,e){return e.transitionDuration}_checkRequiredProps(t){this._requiredProps&&this._requiredProps.forEach(e=>{const n=t[e];qs(Number.isFinite(n)||Array.isArray(n),"".concat(e," is required for transition"))})}}const yj=["longitude","latitude","zoom","bearing","pitch"],_j=["longitude","latitude","zoom"];class UT extends mj{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=Array.isArray(t)?t:t.transitionProps,n=Array.isArray(t)?{}:t;n.transitionProps=Array.isArray(e)?{compare:e,required:e}:e||{compare:yj,required:_j},super(n.transitionProps),K(this,"opts",void 0),this.opts=n}initializeProps(t,e){const n=super.initializeProps(t,e),{makeViewport:i,around:s}=this.opts;if(i&&s){const a=i(t),o=i(e),h=a.unproject(s);n.start.around=s,Object.assign(n.end,{around:o.project(h),aroundPosition:h,width:e.width,height:e.height})}return n}interpolateProps(t,e,n){const i={};for(const s of this._propsToExtract)i[s]=Xm(t[s]||0,e[s]||0,n);if(e.aroundPosition&&this.opts.makeViewport){const s=this.opts.makeViewport({...e,...i});Object.assign(i,s.panByPosition(e.aroundPosition,Xm(t.around,e.around,n)))}return i}}const bu={transitionDuration:0},vj=300,d0=r=>1-(1-r)*(1-r),kd={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},vh={};class bj{constructor(t){K(this,"props",void 0),K(this,"state",{}),K(this,"transitionManager",void 0),K(this,"eventManager",void 0),K(this,"onViewStateChange",void 0),K(this,"onStateChange",void 0),K(this,"makeViewport",void 0),K(this,"_controllerState",void 0),K(this,"_events",{}),K(this,"_interactionState",{isDragging:!1}),K(this,"_customEvents",[]),K(this,"_eventStartBlocked",null),K(this,"_panMove",!1),K(this,"invertPan",!1),K(this,"dragMode","rotate"),K(this,"inertia",0),K(this,"scrollZoom",!0),K(this,"dragPan",!0),K(this,"dragRotate",!0),K(this,"doubleClickZoom",!0),K(this,"touchZoom",!0),K(this,"touchRotate",!1),K(this,"keyboard",!0),this.transitionManager=new gj({...t,getControllerState:e=>new this.ControllerState(e),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=t.eventManager,this.onViewStateChange=t.onViewStateChange||(()=>{}),this.onStateChange=t.onStateChange||(()=>{}),this.makeViewport=t.makeViewport}set events(t){this.toggleEvents(this._customEvents,!1),this.toggleEvents(t,!0),this._customEvents=t,this.props&&this.setProps(this.props)}finalize(){for(const e in this._events)if(this._events[e]){var t;(t=this.eventManager)===null||t===void 0||t.off(e,this.handleEvent)}this.transitionManager.finalize()}handleEvent(t){this._controllerState=void 0;const e=this._eventStartBlocked;switch(t.type){case"panstart":return e?!1:this._onPanStart(t);case"panmove":return this._onPan(t);case"panend":return this._onPanEnd(t);case"pinchstart":return e?!1:this._onPinchStart(t);case"pinchmove":return this._onPinch(t);case"pinchend":return this._onPinchEnd(t);case"tripanstart":return e?!1:this._onTriplePanStart(t);case"tripanmove":return this._onTriplePan(t);case"tripanend":return this._onTriplePanEnd(t);case"doubletap":return this._onDoubleTap(t);case"wheel":return this._onWheel(t);case"keydown":return this._onKeyDown(t);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(t){const{x:e,y:n}=this.props,{offsetCenter:i}=t;return[i.x-e,i.y-n]}isPointInBounds(t,e){const{width:n,height:i}=this.props;if(e&&e.handled)return!1;const s=t[0]>=0&&t[0]<=n&&t[1]>=0&&t[1]<=i;return s&&e&&e.stopPropagation(),s}isFunctionKeyPressed(t){const{srcEvent:e}=t;return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(t){const e=setTimeout(()=>{this._eventStartBlocked===e&&(this._eventStartBlocked=null)},t);this._eventStartBlocked=e}setProps(t){t.dragMode&&(this.dragMode=t.dragMode),this.props=t,"transitionInterpolator"in t||(t.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(t);const{inertia:e}=t;this.inertia=Number.isFinite(e)?e:e===!0?vj:0;const{scrollZoom:n=!0,dragPan:i=!0,dragRotate:s=!0,doubleClickZoom:a=!0,touchZoom:o=!0,touchRotate:h=!1,keyboard:f=!0}=t,g=!!this.onViewStateChange;this.toggleEvents(kd.WHEEL,g&&n),this.toggleEvents(kd.PAN,g),this.toggleEvents(kd.PINCH,g&&(o||h)),this.toggleEvents(kd.TRIPLE_PAN,g&&h),this.toggleEvents(kd.DOUBLE_TAP,g&&a),this.toggleEvents(kd.KEYBOARD,g&&f),this.scrollZoom=n,this.dragPan=i,this.dragRotate=s,this.doubleClickZoom=a,this.touchZoom=o,this.touchRotate=h,this.keyboard=f}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(t,e){this.eventManager&&t.forEach(n=>{this._events[n]!==e&&(this._events[n]=e,e?this.eventManager.on(n,this.handleEvent):this.eventManager.off(n,this.handleEvent))})}updateViewport(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const i={...t.getViewportProps(),...e},s=this.controllerState!==t;if(this.state=t.getState(),this._setInteractionState(n),s){const a=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:i,interactionState:this._interactionState,oldViewState:a})}}_onTransition(t){this.onViewStateChange({...t,interactionState:this._interactionState})}_setInteractionState(t){Object.assign(this._interactionState,t),this.onStateChange(this._interactionState)}_onPanStart(t){const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;let n=this.isFunctionKeyPressed(t)||t.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(n=!n);const i=this.controllerState[n?"panStart":"rotateStart"]({pos:e});return this._panMove=n,this.updateViewport(i,bu,{isDragging:!0}),!0}_onPan(t){return this.isDragging()?this._panMove?this._onPanMove(t):this._onPanRotate(t):!1}_onPanEnd(t){return this.isDragging()?this._panMove?this._onPanMoveEnd(t):this._onPanRotateEnd(t):!1}_onPanMove(t){if(!this.dragPan)return!1;const e=this.getCenter(t),n=this.controllerState.pan({pos:e});return this.updateViewport(n,bu,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(t){const{inertia:e}=this;if(this.dragPan&&e&&t.velocity){const n=this.getCenter(t),i=[n[0]+t.velocityX*e/2,n[1]+t.velocityY*e/2],s=this.controllerState.pan({pos:i}).panEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:e,transitionEasing:d0},{isDragging:!1,isPanning:!0})}else{const n=this.controllerState.panEnd();this.updateViewport(n,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(t){if(!this.dragRotate)return!1;const e=this.getCenter(t),n=this.controllerState.rotate({pos:e});return this.updateViewport(n,bu,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(t){const{inertia:e}=this;if(this.dragRotate&&e&&t.velocity){const n=this.getCenter(t),i=[n[0]+t.velocityX*e/2,n[1]+t.velocityY*e/2],s=this.controllerState.rotate({pos:i}).rotateEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:e,transitionEasing:d0},{isDragging:!1,isRotating:!0})}else{const n=this.controllerState.rotateEnd();this.updateViewport(n,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(t){if(!this.scrollZoom)return!1;const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;t.srcEvent.preventDefault();const{speed:n=.01,smooth:i=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:s}=t;let a=2/(1+Math.exp(-Math.abs(s*n)));s<0&&a!==0&&(a=1/a);const o=this.controllerState.zoom({pos:e,scale:a});return this.updateViewport(o,{...this._getTransitionProps({around:e}),transitionDuration:i?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(t){const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;const n=this.controllerState.rotateStart({pos:e});return this.updateViewport(n,bu,{isDragging:!0}),!0}_onTriplePan(t){if(!this.touchRotate||!this.isDragging())return!1;const e=this.getCenter(t);e[0]-=t.deltaX;const n=this.controllerState.rotate({pos:e});return this.updateViewport(n,bu,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(t){if(!this.isDragging())return!1;const{inertia:e}=this;if(this.touchRotate&&e&&t.velocityY){const n=this.getCenter(t),i=[n[0],n[1]+=t.velocityY*e/2],s=this.controllerState.rotate({pos:i});this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:e,transitionEasing:d0},{isDragging:!1,isRotating:!0}),this.blockEvents(e)}else{const n=this.controllerState.rotateEnd();this.updateViewport(n,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(t){const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;const n=this.controllerState.zoomStart({pos:e}).rotateStart({pos:e});return vh._startPinchRotation=t.rotation,vh._lastPinchEvent=t,this.updateViewport(n,bu,{isDragging:!0}),!0}_onPinch(t){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let e=this.controllerState;if(this.touchZoom){const{scale:n}=t,i=this.getCenter(t);e=e.zoom({pos:i,scale:n})}if(this.touchRotate){const{rotation:n}=t;e=e.rotate({deltaAngleX:vh._startPinchRotation-n})}return this.updateViewport(e,bu,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),vh._lastPinchEvent=t,!0}_onPinchEnd(t){if(!this.isDragging())return!1;const{inertia:e}=this,{_lastPinchEvent:n}=vh;if(this.touchZoom&&e&&n&&t.scale!==n.scale){const i=this.getCenter(t);let s=this.controllerState.rotateEnd();const a=Math.log2(t.scale),o=(a-Math.log2(n.scale))/(t.deltaTime-n.deltaTime),h=Math.pow(2,a+o*e/2);s=s.zoom({pos:i,scale:h}).zoomEnd(),this.updateViewport(s,{...this._getTransitionProps({around:i}),transitionDuration:e,transitionEasing:d0},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(e)}else{const i=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return vh._startPinchRotation=null,vh._lastPinchEvent=null,!0}_onDoubleTap(t){if(!this.doubleClickZoom)return!1;const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;const n=this.isFunctionKeyPressed(t),i=this.controllerState.zoom({pos:e,scale:n?.5:2});return this.updateViewport(i,this._getTransitionProps({around:e}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(t){if(!this.keyboard)return!1;const e=this.isFunctionKeyPressed(t),{zoomSpeed:n,moveSpeed:i,rotateSpeedX:s,rotateSpeedY:a}=this.keyboard===!0?{}:this.keyboard,{controllerState:o}=this;let h;const f={};switch(t.srcEvent.code){case"Minus":h=e?o.zoomOut(n).zoomOut(n):o.zoomOut(n),f.isZooming=!0;break;case"Equal":h=e?o.zoomIn(n).zoomIn(n):o.zoomIn(n),f.isZooming=!0;break;case"ArrowLeft":e?(h=o.rotateLeft(s),f.isRotating=!0):(h=o.moveLeft(i),f.isPanning=!0);break;case"ArrowRight":e?(h=o.rotateRight(s),f.isRotating=!0):(h=o.moveRight(i),f.isPanning=!0);break;case"ArrowUp":e?(h=o.rotateUp(a),f.isRotating=!0):(h=o.moveUp(i),f.isPanning=!0);break;case"ArrowDown":e?(h=o.rotateDown(a),f.isRotating=!0):(h=o.moveDown(i),f.isPanning=!0);break;default:return!1}return this.updateViewport(h,this._getTransitionProps(),f),!0}_getTransitionProps(t){const{transition:e}=this;return!e||!e.transitionInterpolator?bu:t?{...e,transitionInterpolator:new UT({...t,...e.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:e}}class wj{constructor(t,e){K(this,"_viewportProps",void 0),K(this,"_state",void 0),this._viewportProps=this.applyConstraints(t),this._state=e}getViewportProps(){return this._viewportProps}getState(){return this._state}}const RT=5,xj=1.2;class Bj extends wj{constructor(t){const{width:e,height:n,latitude:i,longitude:s,zoom:a,bearing:o=0,pitch:h=0,altitude:f=1.5,position:g=[0,0,0],maxZoom:b=20,minZoom:C=0,maxPitch:B=60,minPitch:R=0,startPanLngLat:D,startZoomLngLat:Q,startRotatePos:k,startBearing:j,startPitch:et,startZoom:st,normalize:mt=!0}=t;qs(Number.isFinite(s)),qs(Number.isFinite(i)),qs(Number.isFinite(a)),super({width:e,height:n,latitude:i,longitude:s,zoom:a,bearing:o,pitch:h,altitude:f,maxZoom:b,minZoom:C,maxPitch:B,minPitch:R,normalize:mt,position:g},{startPanLngLat:D,startZoomLngLat:Q,startRotatePos:k,startBearing:j,startPitch:et,startZoom:st}),K(this,"makeViewport",void 0),this.makeViewport=t.makeViewport}panStart(t){let{pos:e}=t;return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan(t){let{pos:e,startPos:n}=t;const i=this.getState().startPanLngLat||this._unproject(n);if(!i)return this;const a=this.makeViewport(this.getViewportProps()).panByPosition(i,e);return this._getUpdatedState(a)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart(t){let{pos:e}=t;return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate(t){let{pos:e,deltaAngleX:n=0,deltaAngleY:i=0}=t;const{startRotatePos:s,startBearing:a,startPitch:o}=this.getState();if(!s||a===void 0||o===void 0)return this;let h;return e?h=this._getNewRotation(e,s,o,a):h={bearing:a+n,pitch:o+i},this._getUpdatedState(h)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart(t){let{pos:e}=t;return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom(t){let{pos:e,startPos:n,scale:i}=t,{startZoom:s,startZoomLngLat:a}=this.getState();if(a||(s=this.getViewportProps().zoom,a=this._unproject(n)||this._unproject(e)),!a)return this;const{maxZoom:o,minZoom:h}=this.getViewportProps();let f=s+Math.log2(i);f=BA(f,h,o);const g=this.makeViewport({...this.getViewportProps(),zoom:f});return this._getUpdatedState({zoom:f,...g.panByPosition(a,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2;return this._zoomFromCenter(t)}zoomOut(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2;return this._zoomFromCenter(1/t)}moveLeft(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([t,0])}moveRight(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([-t,0])}moveUp(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([0,t])}moveDown(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([0,-t])}rotateLeft(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:15;return this._getUpdatedState({bearing:this.getViewportProps().bearing-t})}rotateRight(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:15;return this._getUpdatedState({bearing:this.getViewportProps().bearing+t})}rotateUp(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;return this._getUpdatedState({pitch:this.getViewportProps().pitch+t})}rotateDown(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;return this._getUpdatedState({pitch:this.getViewportProps().pitch-t})}shortestPathFrom(t){const e=t.getViewportProps(),n={...this.getViewportProps()},{bearing:i,longitude:s}=n;return Math.abs(i-e.bearing)>180&&(n.bearing=i<0?i+360:i-360),Math.abs(s-e.longitude)>180&&(n.longitude=s<0?s+360:s-360),n}applyConstraints(t){const{maxZoom:e,minZoom:n,zoom:i}=t;t.zoom=BA(i,n,e);const{maxPitch:s,minPitch:a,pitch:o}=t;t.pitch=BA(o,a,s);const{normalize:h=!0}=t;return h&&Object.assign(t,LV(t)),t}_zoomFromCenter(t){const{width:e,height:n}=this.getViewportProps();return this.zoom({pos:[e/2,n/2],scale:t})}_panFromCenter(t){const{width:e,height:n}=this.getViewportProps();return this.pan({startPos:[e/2,n/2],pos:[e/2+t[0],n/2+t[1]]})}_getUpdatedState(t){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...t})}_unproject(t){const e=this.makeViewport(this.getViewportProps());return t&&e.unproject(t)}_getNewRotation(t,e,n,i){const s=t[0]-e[0],a=t[1]-e[1],o=t[1],h=e[1],{width:f,height:g}=this.getViewportProps(),b=s/f;let C=0;a>0?Math.abs(g-h)>RT&&(C=a/(h-g)*xj):a<0&&h>RT&&(C=1-o/h),C=BA(C,-1,1);const{minPitch:B,maxPitch:R}=this.getViewportProps(),D=i+180*b;let Q=n;return C>0?Q=n+C*(R-n):C<0&&(Q=n-C*(B-n)),{pitch:Q,bearing:D}}}class Cj extends bj{constructor(){super(...arguments),K(this,"ControllerState",Bj),K(this,"transition",{transitionDuration:300,transitionInterpolator:new UT({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})}),K(this,"dragMode","pan")}setProps(t){t.position=t.position||[0,0,0];const e=this.props;super.setProps(t),(!e||e.height!==t.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...t,...this.state}))}}class sb extends dj{get ViewportType(){return yh}get ControllerType(){return Cj}}K(sb,"displayName","MapView");const Ej=new Yv;function Sj(r,t){var e,n;const i=(e=r.order)!==null&&e!==void 0?e:1/0,s=(n=t.order)!==null&&n!==void 0?n:1/0;return i-s}class Tj{constructor(){K(this,"effects",void 0),K(this,"_resolvedEffects",[]),K(this,"_defaultEffects",[]),K(this,"_needsRedraw",void 0),this.effects=[],this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(t){const e=this._defaultEffects;if(!e.find(n=>n.id===t.id)){const n=e.findIndex(i=>Sj(i,t)>0);n<0?e.push(t):e.splice(n,0,t),this._setEffects(this.effects)}}setProps(t){"effects"in t&&(Tl(t.effects,this.effects,1)||this._setEffects(t.effects))}needsRedraw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};const e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}getEffects(){return this._resolvedEffects}_setEffects(t){const e={};for(const i of this.effects)e[i.id]=i;const n=[];for(const i of t){const s=e[i.id];s&&s!==i?s.setProps?(s.setProps(i.props),n.push(s)):(s.cleanup(),n.push(i)):n.push(i),delete e[i.id]}for(const i in e)e[i].cleanup();this.effects=n,this._resolvedEffects=n.concat(this._defaultEffects),t.some(i=>i instanceof Yv)||this._resolvedEffects.push(Ej),this._needsRedraw="effects changed"}finalize(){for(const t of this._resolvedEffects)t.cleanup();this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class Ij extends Vv{shouldDrawLayer(t){const{operation:e}=t.props;return e.includes("draw")||e.includes("terrain")}}const Lj="deckRenderer.renderLayers";class Fj{constructor(t){K(this,"gl",void 0),K(this,"layerFilter",void 0),K(this,"drawPickingColors",void 0),K(this,"drawLayersPass",void 0),K(this,"pickLayersPass",void 0),K(this,"renderCount",void 0),K(this,"_needsRedraw",void 0),K(this,"renderBuffers",void 0),K(this,"lastPostProcessEffect",void 0),this.gl=t,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new Ij(t),this.pickLayersPass=new TT(t),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(t){this.layerFilter!==t.layerFilter&&(this.layerFilter=t.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==t.drawPickingColors&&(this.drawPickingColors=t.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(t){if(!t.viewports.length)return;const e=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,n={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...t,target:t.target||vs.getDefaultFramebuffer(this.gl)};n.effects&&this._preRender(n.effects,n);const i=this.lastPostProcessEffect?this.renderBuffers[0]:n.target,s=e.render({...n,target:i});n.effects&&this._postRender(n.effects,n),this.renderCount++,Ao(Lj,this,s,t)}needsRedraw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};const e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}finalize(){const{renderBuffers:t}=this;for(const e of t)e.delete();t.length=0}_preRender(t,e){this.lastPostProcessEffect=null,e.preRenderStats=e.preRenderStats||{};for(const n of t)e.preRenderStats[n.id]=n.preRender(this.gl,e),n.postRender&&(this.lastPostProcessEffect=n.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:t}=this;t.length===0&&t.push(new vs(this.gl),new vs(this.gl));for(const e of t)e.resize()}_postRender(t,e){const{renderBuffers:n}=this,i={...e,inputBuffer:n[0],swapBuffer:n[1],target:null};for(const s of t)if(s.postRender){if(s.id===this.lastPostProcessEffect){i.target=e.target,s.postRender(this.gl,i);break}const a=s.postRender(this.gl,i);i.inputBuffer=a,i.swapBuffer=a===n[0]?n[1]:n[0]}}}const Mj={pickedColor:null,pickedObjectIndex:-1};function Pj(r){let{pickedColors:t,decodePickingColor:e,deviceX:n,deviceY:i,deviceRadius:s,deviceRect:a}=r;const{x:o,y:h,width:f,height:g}=a;let b=s*s,C=-1,B=0;for(let R=0;R<g;R++){const D=R+h-i,Q=D*D;if(Q>b)B+=4*f;else for(let k=0;k<f;k++){if(t[B+3]-1>=0){const et=k+o-n,st=et*et+Q;st<=b&&(b=st,C=B)}B+=4}}if(C>=0){const R=t.slice(C,C+4),D=e(R);if(D){const Q=Math.floor(C/4/f),k=C/4-Q*f;return{...D,pickedColor:R,pickedX:o+k,pickedY:h+Q}}Ln.error("Picked non-existent layer. Is picking buffer corrupt?")()}return Mj}function Uj(r){let{pickedColors:t,decodePickingColor:e}=r;const n=new Map;if(t){for(let i=0;i<t.length;i+=4)if(t[i+3]-1>=0){const a=t.slice(i,i+4),o=a.join(",");if(!n.has(o)){const h=e(a);h?n.set(o,{...h,color:a}):Ln.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(n.values())}function DT(r){let{pickInfo:t,viewports:e,pixelRatio:n,x:i,y:s,z:a}=r,o=e[0];e.length>1&&(o=Dj((t==null?void 0:t.pickedViewports)||e,{x:i,y:s}));let h;if(o){const f=[i-o.x,s-o.y];a!==void 0&&(f[2]=a),h=o.unproject(f)}return{color:null,layer:null,viewport:o,index:-1,picked:!1,x:i,y:s,pixel:[i,s],coordinate:h,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:n}}function Rj(r){const{pickInfo:t,lastPickedInfo:e,mode:n,layers:i}=r,{pickedColor:s,pickedLayer:a,pickedObjectIndex:o}=t,h=a?[a]:[];if(n==="hover"){const b=e.index,C=e.layerId,B=a?a.props.id:null;if(B!==C||o!==b){if(B!==C){const R=i.find(D=>D.props.id===C);R&&h.unshift(R)}e.layerId=B,e.index=o,e.info=null}}const f=DT(r),g=new Map;return g.set(null,f),h.forEach(b=>{let C={...f};b===a&&(C.color=s,C.index=o,C.picked=!0),C=OT({layer:b,info:C,mode:n});const B=C.layer;b===a&&n==="hover"&&(e.info=C),g.set(B.id,C),n==="hover"&&B.updateAutoHighlight(C)}),g}function OT(r){let{layer:t,info:e,mode:n}=r;for(;t&&e;){const i=e.layer||null;e.sourceLayer=i,e.layer=t,e=t.getPickingInfo({info:e,mode:n,sourceLayer:i}),t=t.parent}return e}function Dj(r,t){for(let e=r.length-1;e>=0;e--){const n=r[e];if(n.containsPixel(t))return n}return r[0]}class Oj{constructor(t){K(this,"gl",void 0),K(this,"pickingFBO",void 0),K(this,"depthFBO",void 0),K(this,"pickLayersPass",void 0),K(this,"layerFilter",void 0),K(this,"lastPickedInfo",void 0),K(this,"_pickable",!0),this.gl=t,this.pickLayersPass=new TT(t),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(t){"layerFilter"in t&&(this.layerFilter=t.layerFilter),"_pickable"in t&&(this._pickable=t._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.delete(),this.depthFBO&&(this.depthFBO.color.delete(),this.depthFBO.delete())}pickObject(t){return this._pickClosestObject(t)}pickObjects(t){return this._pickVisibleObjects(t)}getLastPickedObject(t){let{x:e,y:n,layers:i,viewports:s}=t,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.lastPickedInfo.info;const o=a&&a.layer&&a.layer.id,h=a&&a.viewport&&a.viewport.id,f=o?i.find(B=>B.id===o):null,g=h&&s.find(B=>B.id===h)||s[0],b=g&&g.unproject([e-g.x,n-g.y]);return{...a,...{x:e,y:n,viewport:g,coordinate:b,layer:f}}}_resizeBuffer(){var t,e;const{gl:n}=this;if(!this.pickingFBO&&(this.pickingFBO=new vs(n),vs.isSupported(n,{colorBufferFloat:!0}))){const i=new vs(n);i.attach({36064:new La(n,{format:yn(n)?34836:6408,type:5126})}),this.depthFBO=i}(t=this.pickingFBO)===null||t===void 0||t.resize({width:n.canvas.width,height:n.canvas.height}),(e=this.depthFBO)===null||e===void 0||e.resize({width:n.canvas.width,height:n.canvas.height})}_getPickable(t){if(this._pickable===!1)return null;const e=t.filter(n=>this.pickLayersPass.shouldDrawLayer(n)&&!n.isComposite);return e.length?e:null}_pickClosestObject(t){let{layers:e,views:n,viewports:i,x:s,y:a,radius:o=0,depth:h=1,mode:f="query",unproject3D:g,onViewportActive:b,effects:C}=t;const B=this._getPickable(e),R=Bd(this.gl);if(!B)return{result:[],emptyInfo:DT({viewports:i,x:s,y:a,pixelRatio:R})};this._resizeBuffer();const D=ev(this.gl,[s,a],!0),Q=[D.x+Math.floor(D.width/2),D.y+Math.floor(D.height/2)],k=Math.round(o*R),{width:j,height:et}=this.pickingFBO,st=this._getPickingRect({deviceX:Q[0],deviceY:Q[1],deviceRadius:k,deviceWidth:j,deviceHeight:et}),mt={x:s-o,y:a-o,width:o*2+1,height:o*2+1};let pt;const yt=[],ft=new Set;for(let Dt=0;Dt<h;Dt++){let It;if(st){const At=this._drawAndSample({layers:B,views:n,viewports:i,onViewportActive:b,deviceRect:st,cullRect:mt,effects:C,pass:"picking:".concat(f)});It=Pj({...At,deviceX:Q[0],deviceY:Q[1],deviceRadius:k,deviceRect:st})}else It={pickedColor:null,pickedObjectIndex:-1};let ut;if(It.pickedLayer&&g&&this.depthFBO){const{pickedColors:At}=this._drawAndSample({layers:[It.pickedLayer],views:n,viewports:i,onViewportActive:b,deviceRect:{x:It.pickedX,y:It.pickedY,width:1,height:1},cullRect:mt,effects:C,pass:"picking:".concat(f,":z")},!0);At[3]&&(ut=At[0])}It.pickedLayer&&Dt+1<h&&(ft.add(It.pickedLayer),It.pickedLayer.disablePickingIndex(It.pickedObjectIndex)),pt=Rj({pickInfo:It,lastPickedInfo:this.lastPickedInfo,mode:f,layers:B,viewports:i,x:s,y:a,z:ut,pixelRatio:R});for(const At of pt.values())At.layer&&yt.push(At);if(!It.pickedColor)break}for(const Dt of ft)Dt.restorePickingColors();return{result:yt,emptyInfo:pt.get(null)}}_pickVisibleObjects(t){let{layers:e,views:n,viewports:i,x:s,y:a,width:o=1,height:h=1,mode:f="query",maxObjects:g=null,onViewportActive:b,effects:C}=t;const B=this._getPickable(e);if(!B)return[];this._resizeBuffer();const R=Bd(this.gl),D=ev(this.gl,[s,a],!0),Q=D.x,k=D.y+D.height,j=ev(this.gl,[s+o,a+h],!0),et=j.x+j.width,st=j.y,mt={x:Q,y:st,width:et-Q,height:k-st},pt=this._drawAndSample({layers:B,views:n,viewports:i,onViewportActive:b,deviceRect:mt,cullRect:{x:s,y:a,width:o,height:h},effects:C,pass:"picking:".concat(f)}),yt=Uj(pt),ft=new Map,Dt=Number.isFinite(g);for(let ut=0;ut<yt.length;ut++){var It;if(Dt&&g&&ft.size>=g)break;const At=yt[ut];let Bt={color:At.pickedColor,layer:null,index:At.pickedObjectIndex,picked:!0,x:s,y:a,pixelRatio:R};Bt=OT({layer:At.pickedLayer,info:Bt,mode:f});const vt=(It=Bt.object)!==null&&It!==void 0?It:"".concat(Bt.layer.id,"[").concat(Bt.index,"]");ft.has(vt)||ft.set(vt,Bt)}return Array.from(ft.values())}_drawAndSample(t){let{layers:e,views:n,viewports:i,onViewportActive:s,deviceRect:a,cullRect:o,effects:h,pass:f}=t,g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const b=g?this.depthFBO:this.pickingFBO,C={layers:e,layerFilter:this.layerFilter,views:n,viewports:i,onViewportActive:s,pickingFBO:b,deviceRect:a,cullRect:o,effects:h,pass:f,pickZ:g,preRenderStats:{}};for(const et of h)et.useInPicking&&(C.preRenderStats[et.id]=et.preRender(this.gl,C));const{decodePickingColor:B}=this.pickLayersPass.render(C),{x:R,y:D,width:Q,height:k}=a,j=new(g?Float32Array:Uint8Array)(Q*k*4);return Qm(b,{sourceX:R,sourceY:D,sourceWidth:Q,sourceHeight:k,target:j}),{pickedColors:j,decodePickingColor:B}}_getPickingRect(t){let{deviceX:e,deviceY:n,deviceRadius:i,deviceWidth:s,deviceHeight:a}=t;const o=Math.max(0,e-i),h=Math.max(0,n-i),f=Math.min(s,e+i+1)-o,g=Math.min(a,n+i+1)-h;return f<=0||g<=0?null:{x:o,y:h,width:f,height:g}}}const Nj={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class kj{constructor(t){K(this,"el",null),K(this,"isVisible",!1);const e=t.parentElement;e&&(this.el=document.createElement("div"),this.el.className="deck-tooltip",Object.assign(this.el.style,Nj),e.appendChild(this.el))}setTooltip(t,e,n){const i=this.el;if(i){if(typeof t=="string")i.innerText=t;else if(t)t.text&&(i.innerText=t.text),t.html&&(i.innerHTML=t.html),t.className&&(i.className=t.className);else{this.isVisible=!1,i.style.display="none";return}this.isVisible=!0,i.style.display="block",i.style.transform="translate(".concat(e,"px, ").concat(n,"px)"),t&&typeof t=="object"&&"style"in t&&Object.assign(i.style,t.style)}}remove(){this.el&&(this.el.remove(),this.el=null)}}var NT={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(r){(function(t,e,n,i){var s=["","webkit","Moz","MS","ms","o"],a=e.createElement("div"),o="function",h=Math.round,f=Math.abs,g=Date.now;function b(dt,bt,jt){return setTimeout(et(dt,jt),bt)}function C(dt,bt,jt){return Array.isArray(dt)?(B(dt,jt[bt],jt),!0):!1}function B(dt,bt,jt){var pe;if(dt)if(dt.forEach)dt.forEach(bt,jt);else if(dt.length!==i)for(pe=0;pe<dt.length;)bt.call(jt,dt[pe],pe,dt),pe++;else for(pe in dt)dt.hasOwnProperty(pe)&&bt.call(jt,dt[pe],pe,dt)}function R(dt,bt,jt){var pe="DEPRECATED METHOD: "+bt+`
`+jt+` AT 
`;return function(){var Ue=new Error("get-stack-trace"),cr=Ue&&Ue.stack?Ue.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Qr=t.console&&(t.console.warn||t.console.log);return Qr&&Qr.call(t.console,pe,cr),dt.apply(this,arguments)}}var D;typeof Object.assign!="function"?D=function(bt){if(bt===i||bt===null)throw new TypeError("Cannot convert undefined or null to object");for(var jt=Object(bt),pe=1;pe<arguments.length;pe++){var Ue=arguments[pe];if(Ue!==i&&Ue!==null)for(var cr in Ue)Ue.hasOwnProperty(cr)&&(jt[cr]=Ue[cr])}return jt}:D=Object.assign;var Q=R(function(bt,jt,pe){for(var Ue=Object.keys(jt),cr=0;cr<Ue.length;)(!pe||pe&&bt[Ue[cr]]===i)&&(bt[Ue[cr]]=jt[Ue[cr]]),cr++;return bt},"extend","Use `assign`."),k=R(function(bt,jt){return Q(bt,jt,!0)},"merge","Use `assign`.");function j(dt,bt,jt){var pe=bt.prototype,Ue;Ue=dt.prototype=Object.create(pe),Ue.constructor=dt,Ue._super=pe,jt&&D(Ue,jt)}function et(dt,bt){return function(){return dt.apply(bt,arguments)}}function st(dt,bt){return typeof dt==o?dt.apply(bt&&bt[0]||i,bt):dt}function mt(dt,bt){return dt===i?bt:dt}function pt(dt,bt,jt){B(It(bt),function(pe){dt.addEventListener(pe,jt,!1)})}function yt(dt,bt,jt){B(It(bt),function(pe){dt.removeEventListener(pe,jt,!1)})}function ft(dt,bt){for(;dt;){if(dt==bt)return!0;dt=dt.parentNode}return!1}function Dt(dt,bt){return dt.indexOf(bt)>-1}function It(dt){return dt.trim().split(/\s+/g)}function ut(dt,bt,jt){if(dt.indexOf&&!jt)return dt.indexOf(bt);for(var pe=0;pe<dt.length;){if(jt&&dt[pe][jt]==bt||!jt&&dt[pe]===bt)return pe;pe++}return-1}function At(dt){return Array.prototype.slice.call(dt,0)}function Bt(dt,bt,jt){for(var pe=[],Ue=[],cr=0;cr<dt.length;){var Qr=bt?dt[cr][bt]:dt[cr];ut(Ue,Qr)<0&&pe.push(dt[cr]),Ue[cr]=Qr,cr++}return jt&&(bt?pe=pe.sort(function(ti,Bi){return ti[bt]>Bi[bt]}):pe=pe.sort()),pe}function vt(dt,bt){for(var jt,pe,Ue=bt[0].toUpperCase()+bt.slice(1),cr=0;cr<s.length;){if(jt=s[cr],pe=jt?jt+Ue:bt,pe in dt)return pe;cr++}return i}var ne=1;function ie(){return ne++}function ae(dt){var bt=dt.ownerDocument||dt;return bt.defaultView||bt.parentWindow||t}var te=/mobile|tablet|ip(ad|hone|od)|android/i,ce="ontouchstart"in t,le=vt(t,"PointerEvent")!==i,Te=ce&&te.test(navigator.userAgent),rt="touch",wt="pen",St="mouse",qt="kinect",Jt=25,se=1,Ae=2,oe=4,Ce=8,Pe=1,Ve=2,Ke=4,rr=8,_e=16,Ut=Ve|Ke,pr=rr|_e,ir=Ut|pr,Se=["x","y"],Kt=["clientX","clientY"];function Ie(dt,bt){var jt=this;this.manager=dt,this.callback=bt,this.element=dt.element,this.target=dt.options.inputTarget,this.domHandler=function(pe){st(dt.options.enable,[dt])&&jt.handler(pe)},this.init()}Ie.prototype={handler:function(){},init:function(){this.evEl&&pt(this.element,this.evEl,this.domHandler),this.evTarget&&pt(this.target,this.evTarget,this.domHandler),this.evWin&&pt(ae(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&yt(this.element,this.evEl,this.domHandler),this.evTarget&&yt(this.target,this.evTarget,this.domHandler),this.evWin&&yt(ae(this.element),this.evWin,this.domHandler)}};function ke(dt){var bt,jt=dt.options.inputClass;return jt?bt=jt:le?bt=sn:Te?bt=Vt:ce?bt=ye:bt=Ze,new bt(dt,He)}function He(dt,bt,jt){var pe=jt.pointers.length,Ue=jt.changedPointers.length,cr=bt&se&&pe-Ue===0,Qr=bt&(oe|Ce)&&pe-Ue===0;jt.isFirst=!!cr,jt.isFinal=!!Qr,cr&&(dt.session={}),jt.eventType=bt,De(dt,jt),dt.emit("hammer.input",jt),dt.recognize(jt),dt.session.prevInput=jt}function De(dt,bt){var jt=dt.session,pe=bt.pointers,Ue=pe.length;jt.firstInput||(jt.firstInput=Or(bt)),Ue>1&&!jt.firstMultiple?jt.firstMultiple=Or(bt):Ue===1&&(jt.firstMultiple=!1);var cr=jt.firstInput,Qr=jt.firstMultiple,qn=Qr?Qr.center:cr.center,ti=bt.center=nn(pe);bt.timeStamp=g(),bt.deltaTime=bt.timeStamp-cr.timeStamp,bt.angle=Ee(qn,ti),bt.distance=je(qn,ti),xr(jt,bt),bt.offsetDirection=Ur(bt.deltaX,bt.deltaY);var Bi=Br(bt.deltaTime,bt.deltaX,bt.deltaY);bt.overallVelocityX=Bi.x,bt.overallVelocityY=Bi.y,bt.overallVelocity=f(Bi.x)>f(Bi.y)?Bi.x:Bi.y,bt.scale=Qr?Vr(Qr.pointers,pe):1,bt.rotation=Qr?Nr(Qr.pointers,pe):0,bt.maxPointers=jt.prevInput?bt.pointers.length>jt.prevInput.maxPointers?bt.pointers.length:jt.prevInput.maxPointers:bt.pointers.length,Pr(jt,bt);var zn=dt.element;ft(bt.srcEvent.target,zn)&&(zn=bt.srcEvent.target),bt.target=zn}function xr(dt,bt){var jt=bt.center,pe=dt.offsetDelta||{},Ue=dt.prevDelta||{},cr=dt.prevInput||{};(bt.eventType===se||cr.eventType===oe)&&(Ue=dt.prevDelta={x:cr.deltaX||0,y:cr.deltaY||0},pe=dt.offsetDelta={x:jt.x,y:jt.y}),bt.deltaX=Ue.x+(jt.x-pe.x),bt.deltaY=Ue.y+(jt.y-pe.y)}function Pr(dt,bt){var jt=dt.lastInterval||bt,pe=bt.timeStamp-jt.timeStamp,Ue,cr,Qr,qn;if(bt.eventType!=Ce&&(pe>Jt||jt.velocity===i)){var ti=bt.deltaX-jt.deltaX,Bi=bt.deltaY-jt.deltaY,zn=Br(pe,ti,Bi);cr=zn.x,Qr=zn.y,Ue=f(zn.x)>f(zn.y)?zn.x:zn.y,qn=Ur(ti,Bi),dt.lastInterval=bt}else Ue=jt.velocity,cr=jt.velocityX,Qr=jt.velocityY,qn=jt.direction;bt.velocity=Ue,bt.velocityX=cr,bt.velocityY=Qr,bt.direction=qn}function Or(dt){for(var bt=[],jt=0;jt<dt.pointers.length;)bt[jt]={clientX:h(dt.pointers[jt].clientX),clientY:h(dt.pointers[jt].clientY)},jt++;return{timeStamp:g(),pointers:bt,center:nn(bt),deltaX:dt.deltaX,deltaY:dt.deltaY}}function nn(dt){var bt=dt.length;if(bt===1)return{x:h(dt[0].clientX),y:h(dt[0].clientY)};for(var jt=0,pe=0,Ue=0;Ue<bt;)jt+=dt[Ue].clientX,pe+=dt[Ue].clientY,Ue++;return{x:h(jt/bt),y:h(pe/bt)}}function Br(dt,bt,jt){return{x:bt/dt||0,y:jt/dt||0}}function Ur(dt,bt){return dt===bt?Pe:f(dt)>=f(bt)?dt<0?Ve:Ke:bt<0?rr:_e}function je(dt,bt,jt){jt||(jt=Se);var pe=bt[jt[0]]-dt[jt[0]],Ue=bt[jt[1]]-dt[jt[1]];return Math.sqrt(pe*pe+Ue*Ue)}function Ee(dt,bt,jt){jt||(jt=Se);var pe=bt[jt[0]]-dt[jt[0]],Ue=bt[jt[1]]-dt[jt[1]];return Math.atan2(Ue,pe)*180/Math.PI}function Nr(dt,bt){return Ee(bt[1],bt[0],Kt)+Ee(dt[1],dt[0],Kt)}function Vr(dt,bt){return je(bt[0],bt[1],Kt)/je(dt[0],dt[1],Kt)}var qr={mousedown:se,mousemove:Ae,mouseup:oe},rn="mousedown",Fe="mousemove mouseup";function Ze(){this.evEl=rn,this.evWin=Fe,this.pressed=!1,Ie.apply(this,arguments)}j(Ze,Ie,{handler:function(bt){var jt=qr[bt.type];jt&se&&bt.button===0&&(this.pressed=!0),jt&Ae&&bt.which!==1&&(jt=oe),this.pressed&&(jt&oe&&(this.pressed=!1),this.callback(this.manager,jt,{pointers:[bt],changedPointers:[bt],pointerType:St,srcEvent:bt}))}});var ur={pointerdown:se,pointermove:Ae,pointerup:oe,pointercancel:Ce,pointerout:Ce},Jr={2:rt,3:wt,4:St,5:qt},Un="pointerdown",qe="pointermove pointerup pointercancel";t.MSPointerEvent&&!t.PointerEvent&&(Un="MSPointerDown",qe="MSPointerMove MSPointerUp MSPointerCancel");function sn(){this.evEl=Un,this.evWin=qe,Ie.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}j(sn,Ie,{handler:function(bt){var jt=this.store,pe=!1,Ue=bt.type.toLowerCase().replace("ms",""),cr=ur[Ue],Qr=Jr[bt.pointerType]||bt.pointerType,qn=Qr==rt,ti=ut(jt,bt.pointerId,"pointerId");cr&se&&(bt.button===0||qn)?ti<0&&(jt.push(bt),ti=jt.length-1):cr&(oe|Ce)&&(pe=!0),!(ti<0)&&(jt[ti]=bt,this.callback(this.manager,cr,{pointers:jt,changedPointers:[bt],pointerType:Qr,srcEvent:bt}),pe&&jt.splice(ti,1))}});var _t={touchstart:se,touchmove:Ae,touchend:oe,touchcancel:Ce},tt="touchstart",at="touchstart touchmove touchend touchcancel";function gt(){this.evTarget=tt,this.evWin=at,this.started=!1,Ie.apply(this,arguments)}j(gt,Ie,{handler:function(bt){var jt=_t[bt.type];if(jt===se&&(this.started=!0),!!this.started){var pe=Tt.call(this,bt,jt);jt&(oe|Ce)&&pe[0].length-pe[1].length===0&&(this.started=!1),this.callback(this.manager,jt,{pointers:pe[0],changedPointers:pe[1],pointerType:rt,srcEvent:bt})}}});function Tt(dt,bt){var jt=At(dt.touches),pe=At(dt.changedTouches);return bt&(oe|Ce)&&(jt=Bt(jt.concat(pe),"identifier",!0)),[jt,pe]}var Ft={touchstart:se,touchmove:Ae,touchend:oe,touchcancel:Ce},Ht="touchstart touchmove touchend touchcancel";function Vt(){this.evTarget=Ht,this.targetIds={},Ie.apply(this,arguments)}j(Vt,Ie,{handler:function(bt){var jt=Ft[bt.type],pe=Qt.call(this,bt,jt);pe&&this.callback(this.manager,jt,{pointers:pe[0],changedPointers:pe[1],pointerType:rt,srcEvent:bt})}});function Qt(dt,bt){var jt=At(dt.touches),pe=this.targetIds;if(bt&(se|Ae)&&jt.length===1)return pe[jt[0].identifier]=!0,[jt,jt];var Ue,cr,Qr=At(dt.changedTouches),qn=[],ti=this.target;if(cr=jt.filter(function(Bi){return ft(Bi.target,ti)}),bt===se)for(Ue=0;Ue<cr.length;)pe[cr[Ue].identifier]=!0,Ue++;for(Ue=0;Ue<Qr.length;)pe[Qr[Ue].identifier]&&qn.push(Qr[Ue]),bt&(oe|Ce)&&delete pe[Qr[Ue].identifier],Ue++;if(qn.length)return[Bt(cr.concat(qn),"identifier",!0),qn]}var $t=2500,fe=25;function ye(){Ie.apply(this,arguments);var dt=et(this.handler,this);this.touch=new Vt(this.manager,dt),this.mouse=new Ze(this.manager,dt),this.primaryTouch=null,this.lastTouches=[]}j(ye,Ie,{handler:function(bt,jt,pe){var Ue=pe.pointerType==rt,cr=pe.pointerType==St;if(!(cr&&pe.sourceCapabilities&&pe.sourceCapabilities.firesTouchEvents)){if(Ue)we.call(this,jt,pe);else if(cr&&dr.call(this,pe))return;this.callback(bt,jt,pe)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function we(dt,bt){dt&se?(this.primaryTouch=bt.changedPointers[0].identifier,hr.call(this,bt)):dt&(oe|Ce)&&hr.call(this,bt)}function hr(dt){var bt=dt.changedPointers[0];if(bt.identifier===this.primaryTouch){var jt={x:bt.clientX,y:bt.clientY};this.lastTouches.push(jt);var pe=this.lastTouches,Ue=function(){var cr=pe.indexOf(jt);cr>-1&&pe.splice(cr,1)};setTimeout(Ue,$t)}}function dr(dt){for(var bt=dt.srcEvent.clientX,jt=dt.srcEvent.clientY,pe=0;pe<this.lastTouches.length;pe++){var Ue=this.lastTouches[pe],cr=Math.abs(bt-Ue.x),Qr=Math.abs(jt-Ue.y);if(cr<=fe&&Qr<=fe)return!0}return!1}var Je=vt(a.style,"touchAction"),or=Je!==i,_r="compute",Rr="auto",jr="manipulation",Fr="none",Rt="pan-x",Qe="pan-y",Be=Sn();function Er(dt,bt){this.manager=dt,this.set(bt)}Er.prototype={set:function(dt){dt==_r&&(dt=this.compute()),or&&this.manager.element.style&&Be[dt]&&(this.manager.element.style[Je]=dt),this.actions=dt.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var dt=[];return B(this.manager.recognizers,function(bt){st(bt.options.enable,[bt])&&(dt=dt.concat(bt.getTouchAction()))}),Kr(dt.join(" "))},preventDefaults:function(dt){var bt=dt.srcEvent,jt=dt.offsetDirection;if(this.manager.session.prevented){bt.preventDefault();return}var pe=this.actions,Ue=Dt(pe,Fr)&&!Be[Fr],cr=Dt(pe,Qe)&&!Be[Qe],Qr=Dt(pe,Rt)&&!Be[Rt];if(Ue){var qn=dt.pointers.length===1,ti=dt.distance<2,Bi=dt.deltaTime<250;if(qn&&ti&&Bi)return}if(!(Qr&&cr)&&(Ue||cr&&jt&Ut||Qr&&jt&pr))return this.preventSrc(bt)},preventSrc:function(dt){this.manager.session.prevented=!0,dt.preventDefault()}};function Kr(dt){if(Dt(dt,Fr))return Fr;var bt=Dt(dt,Rt),jt=Dt(dt,Qe);return bt&&jt?Fr:bt||jt?bt?Rt:Qe:Dt(dt,jr)?jr:Rr}function Sn(){if(!or)return!1;var dt={},bt=t.CSS&&t.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(jt){dt[jt]=bt?t.CSS.supports("touch-action",jt):!0}),dt}var Rn=1,Vn=2,kn=4,Qn=8,Yr=Qn,Xs=16,ts=32;function Dn(dt){this.options=D({},this.defaults,dt||{}),this.id=ie(),this.manager=null,this.options.enable=mt(this.options.enable,!0),this.state=Rn,this.simultaneous={},this.requireFail=[]}Dn.prototype={defaults:{},set:function(dt){return D(this.options,dt),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(dt){if(C(dt,"recognizeWith",this))return this;var bt=this.simultaneous;return dt=Ii(dt,this),bt[dt.id]||(bt[dt.id]=dt,dt.recognizeWith(this)),this},dropRecognizeWith:function(dt){return C(dt,"dropRecognizeWith",this)?this:(dt=Ii(dt,this),delete this.simultaneous[dt.id],this)},requireFailure:function(dt){if(C(dt,"requireFailure",this))return this;var bt=this.requireFail;return dt=Ii(dt,this),ut(bt,dt)===-1&&(bt.push(dt),dt.requireFailure(this)),this},dropRequireFailure:function(dt){if(C(dt,"dropRequireFailure",this))return this;dt=Ii(dt,this);var bt=ut(this.requireFail,dt);return bt>-1&&this.requireFail.splice(bt,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(dt){return!!this.simultaneous[dt.id]},emit:function(dt){var bt=this,jt=this.state;function pe(Ue){bt.manager.emit(Ue,dt)}jt<Qn&&pe(bt.options.event+Gi(jt)),pe(bt.options.event),dt.additionalEvent&&pe(dt.additionalEvent),jt>=Qn&&pe(bt.options.event+Gi(jt))},tryEmit:function(dt){if(this.canEmit())return this.emit(dt);this.state=ts},canEmit:function(){for(var dt=0;dt<this.requireFail.length;){if(!(this.requireFail[dt].state&(ts|Rn)))return!1;dt++}return!0},recognize:function(dt){var bt=D({},dt);if(!st(this.options.enable,[this,bt])){this.reset(),this.state=ts;return}this.state&(Yr|Xs|ts)&&(this.state=Rn),this.state=this.process(bt),this.state&(Vn|kn|Qn|Xs)&&this.tryEmit(bt)},process:function(dt){},getTouchAction:function(){},reset:function(){}};function Gi(dt){return dt&Xs?"cancel":dt&Qn?"end":dt&kn?"move":dt&Vn?"start":""}function za(dt){return dt==_e?"down":dt==rr?"up":dt==Ve?"left":dt==Ke?"right":""}function Ii(dt,bt){var jt=bt.manager;return jt?jt.get(dt):dt}function kr(){Dn.apply(this,arguments)}j(kr,Dn,{defaults:{pointers:1},attrTest:function(dt){var bt=this.options.pointers;return bt===0||dt.pointers.length===bt},process:function(dt){var bt=this.state,jt=dt.eventType,pe=bt&(Vn|kn),Ue=this.attrTest(dt);return pe&&(jt&Ce||!Ue)?bt|Xs:pe||Ue?jt&oe?bt|Qn:bt&Vn?bt|kn:Vn:ts}});function Bo(){kr.apply(this,arguments),this.pX=null,this.pY=null}j(Bo,kr,{defaults:{event:"pan",threshold:10,pointers:1,direction:ir},getTouchAction:function(){var dt=this.options.direction,bt=[];return dt&Ut&&bt.push(Qe),dt&pr&&bt.push(Rt),bt},directionTest:function(dt){var bt=this.options,jt=!0,pe=dt.distance,Ue=dt.direction,cr=dt.deltaX,Qr=dt.deltaY;return Ue&bt.direction||(bt.direction&Ut?(Ue=cr===0?Pe:cr<0?Ve:Ke,jt=cr!=this.pX,pe=Math.abs(dt.deltaX)):(Ue=Qr===0?Pe:Qr<0?rr:_e,jt=Qr!=this.pY,pe=Math.abs(dt.deltaY))),dt.direction=Ue,jt&&pe>bt.threshold&&Ue&bt.direction},attrTest:function(dt){return kr.prototype.attrTest.call(this,dt)&&(this.state&Vn||!(this.state&Vn)&&this.directionTest(dt))},emit:function(dt){this.pX=dt.deltaX,this.pY=dt.deltaY;var bt=za(dt.direction);bt&&(dt.additionalEvent=this.options.event+bt),this._super.emit.call(this,dt)}});function Js(){kr.apply(this,arguments)}j(Js,kr,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Fr]},attrTest:function(dt){return this._super.attrTest.call(this,dt)&&(Math.abs(dt.scale-1)>this.options.threshold||this.state&Vn)},emit:function(dt){if(dt.scale!==1){var bt=dt.scale<1?"in":"out";dt.additionalEvent=this.options.event+bt}this._super.emit.call(this,dt)}});function Tn(){Dn.apply(this,arguments),this._timer=null,this._input=null}j(Tn,Dn,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Rr]},process:function(dt){var bt=this.options,jt=dt.pointers.length===bt.pointers,pe=dt.distance<bt.threshold,Ue=dt.deltaTime>bt.time;if(this._input=dt,!pe||!jt||dt.eventType&(oe|Ce)&&!Ue)this.reset();else if(dt.eventType&se)this.reset(),this._timer=b(function(){this.state=Yr,this.tryEmit()},bt.time,this);else if(dt.eventType&oe)return Yr;return ts},reset:function(){clearTimeout(this._timer)},emit:function(dt){this.state===Yr&&(dt&&dt.eventType&oe?this.manager.emit(this.options.event+"up",dt):(this._input.timeStamp=g(),this.manager.emit(this.options.event,this._input)))}});function on(){kr.apply(this,arguments)}j(on,kr,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Fr]},attrTest:function(dt){return this._super.attrTest.call(this,dt)&&(Math.abs(dt.rotation)>this.options.threshold||this.state&Vn)}});function Ys(){kr.apply(this,arguments)}j(Ys,kr,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Ut|pr,pointers:1},getTouchAction:function(){return Bo.prototype.getTouchAction.call(this)},attrTest:function(dt){var bt=this.options.direction,jt;return bt&(Ut|pr)?jt=dt.overallVelocity:bt&Ut?jt=dt.overallVelocityX:bt&pr&&(jt=dt.overallVelocityY),this._super.attrTest.call(this,dt)&&bt&dt.offsetDirection&&dt.distance>this.options.threshold&&dt.maxPointers==this.options.pointers&&f(jt)>this.options.velocity&&dt.eventType&oe},emit:function(dt){var bt=za(dt.offsetDirection);bt&&this.manager.emit(this.options.event+bt,dt),this.manager.emit(this.options.event,dt)}});function An(){Dn.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}j(An,Dn,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[jr]},process:function(dt){var bt=this.options,jt=dt.pointers.length===bt.pointers,pe=dt.distance<bt.threshold,Ue=dt.deltaTime<bt.time;if(this.reset(),dt.eventType&se&&this.count===0)return this.failTimeout();if(pe&&Ue&&jt){if(dt.eventType!=oe)return this.failTimeout();var cr=this.pTime?dt.timeStamp-this.pTime<bt.interval:!0,Qr=!this.pCenter||je(this.pCenter,dt.center)<bt.posThreshold;this.pTime=dt.timeStamp,this.pCenter=dt.center,!Qr||!cr?this.count=1:this.count+=1,this._input=dt;var qn=this.count%bt.taps;if(qn===0)return this.hasRequireFailures()?(this._timer=b(function(){this.state=Yr,this.tryEmit()},bt.interval,this),Vn):Yr}return ts},failTimeout:function(){return this._timer=b(function(){this.state=ts},this.options.interval,this),ts},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Yr&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Li(dt,bt){return bt=bt||{},bt.recognizers=mt(bt.recognizers,Li.defaults.preset),new Cs(dt,bt)}Li.VERSION="2.0.7",Li.defaults={domEvents:!1,touchAction:_r,enable:!0,inputTarget:null,inputClass:null,preset:[[on,{enable:!1}],[Js,{enable:!1},["rotate"]],[Ys,{direction:Ut}],[Bo,{direction:Ut},["swipe"]],[An],[An,{event:"doubletap",taps:2},["tap"]],[Tn]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var jn=1,fa=2;function Cs(dt,bt){this.options=D({},Li.defaults,bt||{}),this.options.inputTarget=this.options.inputTarget||dt,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=dt,this.input=ke(this),this.touchAction=new Er(this,this.options.touchAction),Jc(this,!0),B(this.options.recognizers,function(jt){var pe=this.add(new jt[0](jt[1]));jt[2]&&pe.recognizeWith(jt[2]),jt[3]&&pe.requireFailure(jt[3])},this)}Cs.prototype={set:function(dt){return D(this.options,dt),dt.touchAction&&this.touchAction.update(),dt.inputTarget&&(this.input.destroy(),this.input.target=dt.inputTarget,this.input.init()),this},stop:function(dt){this.session.stopped=dt?fa:jn},recognize:function(dt){var bt=this.session;if(!bt.stopped){this.touchAction.preventDefaults(dt);var jt,pe=this.recognizers,Ue=bt.curRecognizer;(!Ue||Ue&&Ue.state&Yr)&&(Ue=bt.curRecognizer=null);for(var cr=0;cr<pe.length;)jt=pe[cr],bt.stopped!==fa&&(!Ue||jt==Ue||jt.canRecognizeWith(Ue))?jt.recognize(dt):jt.reset(),!Ue&&jt.state&(Vn|kn|Qn)&&(Ue=bt.curRecognizer=jt),cr++}},get:function(dt){if(dt instanceof Dn)return dt;for(var bt=this.recognizers,jt=0;jt<bt.length;jt++)if(bt[jt].options.event==dt)return bt[jt];return null},add:function(dt){if(C(dt,"add",this))return this;var bt=this.get(dt.options.event);return bt&&this.remove(bt),this.recognizers.push(dt),dt.manager=this,this.touchAction.update(),dt},remove:function(dt){if(C(dt,"remove",this))return this;if(dt=this.get(dt),dt){var bt=this.recognizers,jt=ut(bt,dt);jt!==-1&&(bt.splice(jt,1),this.touchAction.update())}return this},on:function(dt,bt){if(dt!==i&&bt!==i){var jt=this.handlers;return B(It(dt),function(pe){jt[pe]=jt[pe]||[],jt[pe].push(bt)}),this}},off:function(dt,bt){if(dt!==i){var jt=this.handlers;return B(It(dt),function(pe){bt?jt[pe]&&jt[pe].splice(ut(jt[pe],bt),1):delete jt[pe]}),this}},emit:function(dt,bt){this.options.domEvents&&hc(dt,bt);var jt=this.handlers[dt]&&this.handlers[dt].slice();if(!(!jt||!jt.length)){bt.type=dt,bt.preventDefault=function(){bt.srcEvent.preventDefault()};for(var pe=0;pe<jt.length;)jt[pe](bt),pe++}},destroy:function(){this.element&&Jc(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Jc(dt,bt){var jt=dt.element;if(jt.style){var pe;B(dt.options.cssProps,function(Ue,cr){pe=vt(jt.style,cr),bt?(dt.oldCssProps[pe]=jt.style[pe],jt.style[pe]=Ue):jt.style[pe]=dt.oldCssProps[pe]||""}),bt||(dt.oldCssProps={})}}function hc(dt,bt){var jt=e.createEvent("Event");jt.initEvent(dt,!0,!0),jt.gesture=bt,bt.target.dispatchEvent(jt)}D(Li,{INPUT_START:se,INPUT_MOVE:Ae,INPUT_END:oe,INPUT_CANCEL:Ce,STATE_POSSIBLE:Rn,STATE_BEGAN:Vn,STATE_CHANGED:kn,STATE_ENDED:Qn,STATE_RECOGNIZED:Yr,STATE_CANCELLED:Xs,STATE_FAILED:ts,DIRECTION_NONE:Pe,DIRECTION_LEFT:Ve,DIRECTION_RIGHT:Ke,DIRECTION_UP:rr,DIRECTION_DOWN:_e,DIRECTION_HORIZONTAL:Ut,DIRECTION_VERTICAL:pr,DIRECTION_ALL:ir,Manager:Cs,Input:Ie,TouchAction:Er,TouchInput:Vt,MouseInput:Ze,PointerEventInput:sn,TouchMouseInput:ye,SingleTouchInput:gt,Recognizer:Dn,AttrRecognizer:kr,Tap:An,Pan:Bo,Swipe:Ys,Pinch:Js,Rotate:on,Press:Tn,on:pt,off:yt,each:B,merge:k,extend:Q,assign:D,inherit:j,bindFn:et,prefixed:vt});var dc=typeof t<"u"?t:typeof self<"u"?self:{};dc.Hammer=Li,typeof i=="function"&&i.amd?i(function(){return Li}):r.exports?r.exports=Li:t[n]=Li})(window,document,"Hammer")})(NT);var Qp=NT.exports;const Il=sp({__proto__:null,default:xm(Qp)},[Qp]),kT=1,QT=2,ob=4,Qj={mousedown:kT,mousemove:QT,mouseup:ob};function zj(r,t){for(let e=0;e<r.length;e++)if(t(r[e]))return!0;return!1}function Hj(r){const t=r.prototype.handler;r.prototype.handler=function(n){const i=this.store;n.button>0&&n.type==="pointerdown"&&(zj(i,s=>s.pointerId===n.pointerId)||i.push(n)),t.call(this,n)}}function Gj(r){r.prototype.handler=function(e){let n=Qj[e.type];n&kT&&e.button>=0&&(this.pressed=!0),n&QT&&e.which===0&&(n=ob),this.pressed&&(n&ob&&(this.pressed=!1),this.callback(this.manager,n,{pointers:[e],changedPointers:[e],pointerType:"mouse",srcEvent:e}))}}Hj(Qp.PointerEventInput),Gj(Qp.MouseInput);const Vj=Qp.Manager;class f0{constructor(t,e,n){this.element=t,this.callback=e,this.options={enable:!0,...n}}}const jj=Il?[[Il.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[Il.Rotate,{enable:!1}],[Il.Pinch,{enable:!1}],[Il.Swipe,{enable:!1}],[Il.Pan,{threshold:0,enable:!1}],[Il.Press,{enable:!1}],[Il.Tap,{event:"doubletap",taps:2,enable:!1}],[Il.Tap,{event:"anytap",enable:!1}],[Il.Tap,{enable:!1}]]:null,zT={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},qj={doubletap:["tap"]},Kj={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},ab={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},$j={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},HT={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},Wj=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",Qd=typeof window<"u"?window:global;let cb=!1;try{const r={get passive(){return cb=!0,!0}};Qd.addEventListener("test",null,r),Qd.removeEventListener("test",null)}catch{cb=!1}const Xj=Wj.indexOf("firefox")!==-1,{WHEEL_EVENTS:Jj}=ab,GT="wheel",VT=4.000244140625,Yj=40,Zj=.25;class tq extends f0{constructor(t,e,n){super(t,e,n),this.handleEvent=i=>{if(!this.options.enable)return;let s=i.deltaY;Qd.WheelEvent&&(Xj&&i.deltaMode===Qd.WheelEvent.DOM_DELTA_PIXEL&&(s/=Qd.devicePixelRatio),i.deltaMode===Qd.WheelEvent.DOM_DELTA_LINE&&(s*=Yj)),s!==0&&s%VT===0&&(s=Math.floor(s/VT)),i.shiftKey&&s&&(s=s*Zj),this.callback({type:GT,center:{x:i.clientX,y:i.clientY},delta:-s,srcEvent:i,pointerType:"mouse",target:i.target})},this.events=(this.options.events||[]).concat(Jj),this.events.forEach(i=>t.addEventListener(i,this.handleEvent,cb?{passive:!1}:!1))}destroy(){this.events.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,e){t===GT&&(this.options.enable=e)}}const{MOUSE_EVENTS:eq}=ab,jT="pointermove",qT="pointerover",KT="pointerout",$T="pointerenter",WT="pointerleave";class rq extends f0{constructor(t,e,n){super(t,e,n),this.handleEvent=s=>{this.handleOverEvent(s),this.handleOutEvent(s),this.handleEnterEvent(s),this.handleLeaveEvent(s),this.handleMoveEvent(s)},this.pressed=!1;const{enable:i}=this.options;this.enableMoveEvent=i,this.enableLeaveEvent=i,this.enableEnterEvent=i,this.enableOutEvent=i,this.enableOverEvent=i,this.events=(this.options.events||[]).concat(eq),this.events.forEach(s=>t.addEventListener(s,this.handleEvent))}destroy(){this.events.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,e){t===jT&&(this.enableMoveEvent=e),t===qT&&(this.enableOverEvent=e),t===KT&&(this.enableOutEvent=e),t===$T&&(this.enableEnterEvent=e),t===WT&&(this.enableLeaveEvent=e)}handleOverEvent(t){this.enableOverEvent&&t.type==="mouseover"&&this._emit(qT,t)}handleOutEvent(t){this.enableOutEvent&&t.type==="mouseout"&&this._emit(KT,t)}handleEnterEvent(t){this.enableEnterEvent&&t.type==="mouseenter"&&this._emit($T,t)}handleLeaveEvent(t){this.enableLeaveEvent&&t.type==="mouseleave"&&this._emit(WT,t)}handleMoveEvent(t){if(this.enableMoveEvent)switch(t.type){case"mousedown":t.button>=0&&(this.pressed=!0);break;case"mousemove":t.which===0&&(this.pressed=!1),this.pressed||this._emit(jT,t);break;case"mouseup":this.pressed=!1;break}}_emit(t,e){this.callback({type:t,center:{x:e.clientX,y:e.clientY},srcEvent:e,pointerType:"mouse",target:e.target})}}const{KEY_EVENTS:nq}=ab,XT="keydown",JT="keyup";class iq extends f0{constructor(t,e,n){super(t,e,n),this.handleEvent=i=>{const s=i.target||i.srcElement;s.tagName==="INPUT"&&s.type==="text"||s.tagName==="TEXTAREA"||(this.enableDownEvent&&i.type==="keydown"&&this.callback({type:XT,srcEvent:i,key:i.key,target:i.target}),this.enableUpEvent&&i.type==="keyup"&&this.callback({type:JT,srcEvent:i,key:i.key,target:i.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(nq),t.tabIndex=this.options.tabIndex||0,t.style.outline="none",this.events.forEach(i=>t.addEventListener(i,this.handleEvent))}destroy(){this.events.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,e){t===XT&&(this.enableDownEvent=e),t===JT&&(this.enableUpEvent=e)}}const YT="contextmenu";class sq extends f0{constructor(t,e,n){super(t,e,n),this.handleEvent=i=>{this.options.enable&&this.callback({type:YT,center:{x:i.clientX,y:i.clientY},srcEvent:i,pointerType:"mouse",target:i.target})},t.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(t,e){t===YT&&(this.options.enable=e)}}const lb=1,p0=2,Ab=4,oq={pointerdown:lb,pointermove:p0,pointerup:Ab,mousedown:lb,mousemove:p0,mouseup:Ab},aq=1,cq=2,lq=3,Aq=0,uq=1,hq=2,dq=1,fq=2,pq=4;function gq(r){const t=oq[r.srcEvent.type];if(!t)return null;const{buttons:e,button:n,which:i}=r.srcEvent;let s=!1,a=!1,o=!1;return t===Ab||t===p0&&!Number.isFinite(e)?(s=i===aq,a=i===cq,o=i===lq):t===p0?(s=!!(e&dq),a=!!(e&pq),o=!!(e&fq)):t===lb&&(s=n===Aq,a=n===uq,o=n===hq),{leftButton:s,middleButton:a,rightButton:o}}function mq(r,t){const e=r.center;if(!e)return null;const n=t.getBoundingClientRect(),i=n.width/t.offsetWidth||1,s=n.height/t.offsetHeight||1,a={x:(e.x-n.left-t.clientLeft)/i,y:(e.y-n.top-t.clientTop)/s};return{center:e,offsetCenter:a}}const ub={srcElement:"root",priority:0};class yq{constructor(t){this.handleEvent=e=>{if(this.isEmpty())return;const n=this._normalizeEvent(e);let i=e.srcEvent.target;for(;i&&i!==n.rootElement;){if(this._emit(n,i),n.handled)return;i=i.parentNode}this._emit(n,"root")},this.eventManager=t,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(t,e,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;const{handlers:a,handlersByElement:o}=this;let h=ub;typeof n=="string"||n&&n.addEventListener?h={...ub,srcElement:n}:n&&(h={...ub,...n});let f=o.get(h.srcElement);f||(f=[],o.set(h.srcElement,f));const g={type:t,handler:e,srcElement:h.srcElement,priority:h.priority};i&&(g.once=!0),s&&(g.passive=!0),a.push(g),this._active=this._active||!g.passive;let b=f.length-1;for(;b>=0&&!(f[b].priority>=g.priority);)b--;f.splice(b+1,0,g)}remove(t,e){const{handlers:n,handlersByElement:i}=this;for(let s=n.length-1;s>=0;s--){const a=n[s];if(a.type===t&&a.handler===e){n.splice(s,1);const o=i.get(a.srcElement);o.splice(o.indexOf(a),1),o.length===0&&i.delete(a.srcElement)}}this._active=n.some(s=>!s.passive)}_emit(t,e){const n=this.handlersByElement.get(e);if(n){let i=!1;const s=()=>{t.handled=!0},a=()=>{t.handled=!0,i=!0},o=[];for(let h=0;h<n.length;h++){const{type:f,handler:g,once:b}=n[h];if(g({...t,type:f,stopPropagation:s,stopImmediatePropagation:a}),b&&o.push(n[h]),i)break}for(let h=0;h<o.length;h++){const{type:f,handler:g}=o[h];this.remove(f,g)}}}_normalizeEvent(t){const e=this.eventManager.getElement();return{...t,...gq(t),...mq(t,e),preventDefault:()=>{t.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:e}}}const _q={events:null,recognizers:null,recognizerOptions:{},Manager:Vj,touchAction:"none",tabIndex:0};class vq{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,e=arguments.length>1?arguments[1]:void 0;this._onBasicInput=i=>{const{srcEvent:s}=i,a=Kj[s.type];a&&this.manager.emit(a,i)},this._onOtherEvent=i=>{this.manager.emit(i.type,i)},this.options={..._q,...e},this.events=new Map,this.setElement(t);const{events:n}=this.options;n&&this.on(n)}getElement(){return this.element}setElement(t){if(this.element&&this.destroy(),this.element=t,!t)return;const{options:e}=this,n=e.Manager;this.manager=new n(t,{touchAction:e.touchAction,recognizers:e.recognizers||jj}).on("hammer.input",this._onBasicInput),e.recognizers||Object.keys(zT).forEach(i=>{const s=this.manager.get(i);s&&zT[i].forEach(a=>{s.recognizeWith(a)})});for(const i in e.recognizerOptions){const s=this.manager.get(i);if(s){const a=e.recognizerOptions[i];delete a.enable,s.set(a)}}this.wheelInput=new tq(t,this._onOtherEvent,{enable:!1}),this.moveInput=new rq(t,this._onOtherEvent,{enable:!1}),this.keyInput=new iq(t,this._onOtherEvent,{enable:!1,tabIndex:e.tabIndex}),this.contextmenuInput=new sq(t,this._onOtherEvent,{enable:!1});for(const[i,s]of this.events)s.isEmpty()||(this._toggleRecognizer(s.recognizerName,!0),this.manager.on(i,s.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(t,e,n){this._addEventHandler(t,e,n,!1)}once(t,e,n){this._addEventHandler(t,e,n,!0)}watch(t,e,n){this._addEventHandler(t,e,n,!1,!0)}off(t,e){this._removeEventHandler(t,e)}_toggleRecognizer(t,e){const{manager:n}=this;if(!n)return;const i=n.get(t);if(i&&i.options.enable!==e){i.set({enable:e});const s=qj[t];s&&!this.options.recognizers&&s.forEach(a=>{const o=n.get(a);e?(o.requireFailure(t),i.dropRequireFailure(a)):o.dropRequireFailure(t)})}this.wheelInput.enableEventType(t,e),this.moveInput.enableEventType(t,e),this.keyInput.enableEventType(t,e),this.contextmenuInput.enableEventType(t,e)}_addEventHandler(t,e,n,i,s){if(typeof t!="string"){n=e;for(const g in t)this._addEventHandler(g,t[g],n,i,s);return}const{manager:a,events:o}=this,h=HT[t]||t;let f=o.get(h);f||(f=new yq(this),o.set(h,f),f.recognizerName=$j[h]||h,a&&a.on(h,f.handleEvent)),f.add(t,e,n,i,s),f.isEmpty()||this._toggleRecognizer(f.recognizerName,!0)}_removeEventHandler(t,e){if(typeof t!="string"){for(const a in t)this._removeEventHandler(a,t[a]);return}const{events:n}=this,i=HT[t]||t,s=n.get(i);if(s&&(s.remove(t,e),s.isEmpty())){const{recognizerName:a}=s;let o=!1;for(const h of n.values())if(h.recognizerName===a&&!h.isEmpty()){o=!0;break}o||this._toggleRecognizer(a,!1)}}}function bh(){}const ZT={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,glOptions:{},parameters:{},parent:null,gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,onWebGLInitialized:bh,onResize:bh,onViewStateChange:bh,onInteractionStateChange:bh,onBeforeRender:bh,onAfterRender:bh,onLoad:bh,onError:r=>Ln.error(r.message,r.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:r=>{let{isDragging:t}=r;return t?"grabbing":"grab"},getTooltip:null,debug:!1,drawPickingColors:!1};class hb{constructor(t){K(this,"props",void 0),K(this,"width",0),K(this,"height",0),K(this,"userData",{}),K(this,"canvas",null),K(this,"viewManager",null),K(this,"layerManager",null),K(this,"effectManager",null),K(this,"deckRenderer",null),K(this,"deckPicker",null),K(this,"eventManager",null),K(this,"tooltip",null),K(this,"metrics",void 0),K(this,"animationLoop",void 0),K(this,"stats",void 0),K(this,"viewState",void 0),K(this,"cursorState",void 0),K(this,"_needsRedraw",void 0),K(this,"_pickRequest",void 0),K(this,"_lastPointerDownInfo",null),K(this,"_metricsCounter",void 0),K(this,"_onPointerMove",e=>{const{_pickRequest:n}=this;if(e.type==="pointerleave")n.x=-1,n.y=-1,n.radius=0;else{if(e.leftButton||e.rightButton)return;{const i=e.offsetCenter;if(!i)return;n.x=i.x,n.y=i.y,n.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:n.x,y:n.y}),n.event=e}),K(this,"_onEvent",e=>{const n=sS[e.type],i=e.offsetCenter;if(!n||!i||!this.layerManager)return;const s=this.layerManager.getLayers(),a=this.deckPicker.getLastPickedObject({x:i.x,y:i.y,layers:s,viewports:this.getViewports(i)},this._lastPointerDownInfo),{layer:o}=a,h=o&&(o[n.handler]||o.props[n.handler]),f=this.props[n.handler];let g=!1;h&&(g=h.call(o,a,e)),!g&&f&&f(a,e)}),K(this,"_onPointerDown",e=>{const n=e.offsetCenter,i=this._pick("pickObject","pickObject Time",{x:n.x,y:n.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=i.result[0]||i.emptyInfo}),this.props={...ZT,...t},t=this.props,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this.cursorState={isHovering:!1,isDragging:!1},t.viewState&&t.initialViewState&&Ln.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),E8()==="IE"&&Ln.warn("IE 11 is not supported")(),this.viewState=t.initialViewState,t.gl||typeof document<"u"&&(this.canvas=this._createCanvas(t)),this.animationLoop=this._createAnimationLoop(t),this.stats=new MT({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this.setProps(t),t._typedArrayManagerProps&&Dp.setOptions(t._typedArrayManagerProps),this.animationLoop.start()}finalize(){var t,e,n,i,s,a,o,h;if((t=this.animationLoop)===null||t===void 0||t.stop(),this.animationLoop=null,this._lastPointerDownInfo=null,(e=this.layerManager)===null||e===void 0||e.finalize(),this.layerManager=null,(n=this.viewManager)===null||n===void 0||n.finalize(),this.viewManager=null,(i=this.effectManager)===null||i===void 0||i.finalize(),this.effectManager=null,(s=this.deckRenderer)===null||s===void 0||s.finalize(),this.deckRenderer=null,(a=this.deckPicker)===null||a===void 0||a.finalize(),this.deckPicker=null,(o=this.eventManager)===null||o===void 0||o.destroy(),this.eventManager=null,(h=this.tooltip)===null||h===void 0||h.remove(),this.tooltip=null,!this.props.canvas&&!this.props.gl&&this.canvas){var f;(f=this.canvas.parentElement)===null||f===void 0||f.removeChild(this.canvas),this.canvas=null}}setProps(t){this.stats.get("setProps Time").timeStart(),"onLayerHover"in t&&Ln.removed("onLayerHover","onHover")(),"onLayerClick"in t&&Ln.removed("onLayerClick","onClick")(),t.initialViewState&&!Tl(this.props.initialViewState,t.initialViewState,3)&&(this.viewState=t.initialViewState),Object.assign(this.props,t),this._setCanvasSize(this.props);const e=Object.create(this.props);Object.assign(e,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop.setProps(e),this.layerManager&&(this.viewManager.setProps(e),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(e),this.effectManager.setProps(e),this.deckRenderer.setProps(e),this.deckPicker.setProps(e)),this.stats.get("setProps Time").timeEnd()}needsRedraw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let e=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);const n=this.viewManager.needsRedraw(t),i=this.layerManager.needsRedraw(t),s=this.effectManager.needsRedraw(t),a=this.deckRenderer.needsRedraw(t);return e=e||n||i||s||a,e}redraw(t){if(!this.layerManager)return;let e=this.needsRedraw({clearRedrawFlags:!0});e=t||e,e&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(e):this._drawLayers(e))}get isInitialized(){return this.viewManager!==null}getViews(){return qs(this.viewManager),this.viewManager.views}getViewports(t){return qs(this.viewManager),this.viewManager.getViewports(t)}getCanvas(){return this.canvas}pickObject(t){const e=this._pick("pickObject","pickObject Time",t).result;return e.length?e[0]:null}pickMultipleObjects(t){return t.depth=t.depth||10,this._pick("pickObject","pickMultipleObjects Time",t).result}pickObjects(t){return this._pick("pickObjects","pickObjects Time",t)}_addResources(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;for(const n in t)this.layerManager.resourceManager.add({resourceId:n,data:t[n],forceUpdate:e})}_removeResources(t){for(const e of t)this.layerManager.resourceManager.remove(e)}_addDefaultEffect(t){this.effectManager.addDefaultEffect(t)}_pick(t,e,n){qs(this.deckPicker);const{stats:i}=this;i.get("Pick Count").incrementCount(),i.get(e).timeStart();const s=this.deckPicker[t]({layers:this.layerManager.getLayers(n),views:this.viewManager.getViews(),viewports:this.getViewports(n),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...n});return i.get(e).timeEnd(),s}_createCanvas(t){let e=t.canvas;return typeof e=="string"&&(e=document.getElementById(e),qs(e)),e||(e=document.createElement("canvas"),e.id=t.id||"deckgl-overlay",(t.parent||document.body).appendChild(e)),Object.assign(e.style,t.style),e}_setCanvasSize(t){if(!this.canvas)return;const{width:e,height:n}=t;if(e||e===0){const s=Number.isFinite(e)?"".concat(e,"px"):e;this.canvas.style.width=s}if(n||n===0){var i;const s=Number.isFinite(n)?"".concat(n,"px"):n;this.canvas.style.position=((i=t.style)===null||i===void 0?void 0:i.position)||"absolute",this.canvas.style.height=s}}_updateCanvasSize(){var t,e;const{canvas:n}=this;if(!n)return;const i=(t=n.clientWidth)!==null&&t!==void 0?t:n.width,s=(e=n.clientHeight)!==null&&e!==void 0?e:n.height;if(i!==this.width||s!==this.height){var a,o;this.width=i,this.height=s,(a=this.viewManager)===null||a===void 0||a.setProps({width:i,height:s}),(o=this.layerManager)===null||o===void 0||o.activateViewport(this.getViewports()[0]),this.props.onResize({width:i,height:s})}}_createAnimationLoop(t){const{width:e,height:n,gl:i,glOptions:s,debug:a,onError:o,onBeforeRender:h,onAfterRender:f,useDevicePixels:g}=t;return new e9({width:e,height:n,useDevicePixels:g,autoResizeDrawingBuffer:!i,autoResizeViewport:!1,gl:i,onCreateContext:b=>TS({...s,...b,canvas:this.canvas,debug:a,onContextLost:()=>this._onContextLost()}),onInitialize:b=>this._setGLContext(b.gl),onRender:this._onRenderFrame.bind(this),onBeforeRender:h,onAfterRender:f,onError:o})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){let t=this.props.views||[new sb({id:"default-view"})];return t=Array.isArray(t)?t:[t],t.length&&this.props.controller&&(t[0].props.controller=this.props.controller),t}_onContextLost(){const{onError:t}=this.props;this.animationLoop&&t&&t(new Error("WebGL context is lost"))}_pickAndCallback(){const{_pickRequest:t}=this;if(t.event){const{result:n,emptyInfo:i}=this._pick("pickObject","pickObject Time",t);this.cursorState.isHovering=n.length>0;let s=i,a=!1;for(const o of n){var e;s=o,a=((e=o.layer)===null||e===void 0?void 0:e.onHover(o,t.event))||a}if(!a&&this.props.onHover&&this.props.onHover(s,t.event),this.props.getTooltip&&this.tooltip){const o=this.props.getTooltip(s);this.tooltip.setTooltip(o,s.x,s.y)}t.event=null}}_updateCursor(){const t=this.props.parent||this.canvas;t&&(t.style.cursor=this.props.getCursor(this.cursorState))}_setGLContext(t){if(this.layerManager)return;this.canvas||(this.canvas=t.canvas,nv(t,{enable:!0,copyState:!0})),this.tooltip=new kj(this.canvas),_A(t,{blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onWebGLInitialized(t);const e=new sT;e.play(),this.animationLoop.attachTimeline(e),this.eventManager=new vq(this.props.parent||t.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const i in sS)this.eventManager.on(i,this._onEvent);this.viewManager=new uj({timeline:e,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const n=this.viewManager.getViewports()[0];this.layerManager=new Aj(t,{deck:this,stats:this.stats,viewport:n,timeline:e}),this.effectManager=new Tj,this.deckRenderer=new Fj(t),this.deckPicker=new Oj(t),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(t,e){const{gl:n}=this.layerManager.context;_A(n,this.props.parameters),this.props.onBeforeRender({gl:n}),this.deckRenderer.renderLayers({target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...e}),this.props.onAfterRender({gl:n})}_onRenderFrame(t){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),Ln.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.tooltip.isVisible&&this.viewManager.needsRedraw()&&this.tooltip.setTooltip(null),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(t){const e=this.props.onViewStateChange(t)||t.viewState;this.viewState&&(this.viewState={...this.viewState,[t.viewId]:e},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(t){this.cursorState.isDragging=t.isDragging||!1,this.props.onInteractionStateChange(t)}_getFrameStats(){const{stats:t}=this;t.get("frameRate").timeEnd(),t.get("frameRate").timeStart();const e=this.animationLoop.stats;t.get("GPU Time").addTime(e.get("GPU Time").lastTiming),t.get("CPU Time").addTime(e.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:t,stats:e}=this;t.fps=e.get("frameRate").getHz(),t.setPropsTime=e.get("setProps Time").time,t.updateAttributesTime=e.get("Update Attributes").time,t.framesRedrawn=e.get("Redraw Count").count,t.pickTime=e.get("pickObject Time").time+e.get("pickMultipleObjects Time").time+e.get("pickObjects Time").time,t.pickCount=e.get("Pick Count").count,t.gpuTime=e.get("GPU Time").time,t.cpuTime=e.get("CPU Time").time,t.gpuTimePerFrame=e.get("GPU Time").getAverageTime(),t.cpuTimePerFrame=e.get("CPU Time").getAverageTime();const n=fh.get("Memory Usage");t.bufferMemory=n.get("Buffer Memory").count,t.textureMemory=n.get("Texture Memory").count,t.renderbufferMemory=n.get("Renderbuffer Memory").count,t.gpuMemory=n.get("GPU Memory").count}}K(hb,"defaultProps",ZT),K(hb,"VERSION",j8);class db{constructor(t,e){K(this,"opts",void 0),K(this,"source",void 0),this.opts=e,this.source=t}get value(){return this.source.value}getValue(){const t=this.source.getBuffer(),e=this.getAccessor();if(t)return[t,e];const{value:n}=this.source,{size:i}=e;let s=n;if(n&&n.length!==i){s=new Float32Array(i);const a=e.elementOffset||0;for(let o=0;o<i;++o)s[o]=n[a+o]}return s}getAccessor(){return{...this.source.getAccessor(),...this.opts}}}function bq(r){switch(r){case 5126:return Float32Array;case 5130:return Float64Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return Uint8ClampedArray;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Unknown GL type")}}function g0(r){return r.stride||r.size*r.bytesPerElement}function t3(r,t){t.offset&&Ln.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const e=g0(r),n=t.vertexOffset!==void 0?t.vertexOffset:r.vertexOffset||0,i=t.elementOffset||0,s=n*e+i*r.bytesPerElement+(r.offset||0);return{...t,offset:s,stride:e}}function wq(r,t){const e=t3(r,t);return{high:e,low:{...e,offset:e.offset+r.size*4}}}class xq{constructor(t,e,n){K(this,"gl",void 0),K(this,"id",void 0),K(this,"size",void 0),K(this,"settings",void 0),K(this,"value",void 0),K(this,"doublePrecision",void 0),K(this,"_buffer",void 0),K(this,"state",void 0),this.gl=t,this.id=e.id||"",this.size=e.size||1;const i=e.logicalType||e.type,s=i===5130;let{defaultValue:a}=e;a=Number.isFinite(a)?[a]:a||new Array(this.size).fill(0);let o;s?o=5126:!i&&e.isIndexed?o=t&&hv(t,gi.ELEMENT_INDEX_UINT32)?5125:5123:o=i||5126;let h=bq(i||o||5126);this.doublePrecision=s,s&&e.fp64===!1&&(h=Float32Array),this.value=null,this.settings={...e,defaultType:h,defaultValue:a,logicalType:i,type:o,size:this.size,bytesPerElement:h.BYTES_PER_ELEMENT},this.state={...n,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1},this._buffer=null}get isConstant(){return this.state.constant}get buffer(){if(!this._buffer){const{isIndexed:t,type:e}=this.settings;this._buffer=new ri(this.gl,{id:this.id,target:t?34963:34962,accessor:{type:e}})}return this._buffer}get byteOffset(){const t=this.getAccessor();return t.vertexOffset?t.vertexOffset*g0(t):0}get numInstances(){return this.state.numInstances}set numInstances(t){this.state.numInstances=t}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),Dp.release(this.state.allocatedValue)}getShaderAttributes(t,e){if(this.doublePrecision){const n={},i=this.value instanceof Float64Array,s=wq(this.getAccessor(),e||{});return n[t]=new db(this,s.high),n["".concat(t,"64Low")]=i?new db(this,s.low):new Float32Array(this.size),n}if(e){const n=t3(this.getAccessor(),e);return{[t]:new db(this,n)}}return{[t]:this}}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(){return this.state.constant?this.value:[this.getBuffer(),this.getAccessor()]}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let t=null;if(this.state.constant&&this.value){const e=Array.from(this.value);t=[e,e]}else{const{value:e,numInstances:n,size:i}=this,s=n*i;if(e&&s&&e.length>=s){const a=new Array(i).fill(1/0),o=new Array(i).fill(-1/0);for(let h=0;h<s;)for(let f=0;f<i;f++){const g=e[h++];g<a[f]&&(a[f]=g),g>o[f]&&(o[f]=g)}t=[a,o]}}return this.state.bounds=t,t}setData(t){const{state:e}=this;let n;ArrayBuffer.isView(t)?n={value:t}:t instanceof ri?n={buffer:t}:n=t;const i={...this.settings,...n};if(e.bufferAccessor=i,e.bounds=null,n.constant){let s=n.value;if(s=this._normalizeValue(s,[],0),this.settings.normalized&&(s=this.normalizeConstant(s)),!(!e.constant||!this._areValuesEqual(s,this.value)))return!1;e.externalBuffer=null,e.constant=!0,this.value=s}else if(n.buffer){const s=n.buffer;e.externalBuffer=s,e.constant=!1,this.value=n.value||null;const a=n.value instanceof Float64Array;i.type=n.type||s.accessor.type,i.bytesPerElement=s.accessor.BYTES_PER_ELEMENT*(a?2:1),i.stride=g0(i)}else if(n.value){this._checkExternalBuffer(n);let s=n.value;e.externalBuffer=null,e.constant=!1,this.value=s,i.bytesPerElement=s.BYTES_PER_ELEMENT,i.stride=g0(i);const{buffer:a,byteOffset:o}=this;this.doublePrecision&&s instanceof Float64Array&&(s=Zv(s,i));const h=s.byteLength+o+i.stride*2;a.byteLength<h&&a.reallocate(h),a.setAccessor(null),a.subData({data:s,offset:o}),i.type=n.type||a.accessor.type}return!0}updateSubBuffer(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.state.bounds=null;const e=this.value,{startOffset:n=0,endOffset:i}=t;this.buffer.subData({data:this.doublePrecision&&e instanceof Float64Array?Zv(e,{size:this.size,startIndex:n,endIndex:i}):e.subarray(n,i),offset:n*e.BYTES_PER_ELEMENT+this.byteOffset})}allocate(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const{state:n}=this,i=n.allocatedValue,s=Dp.allocate(i,t+1,{size:this.size,type:this.settings.defaultType,copy:e});this.value=s;const{buffer:a,byteOffset:o}=this;return a.byteLength<s.byteLength+o&&(a.reallocate(s.byteLength+o),e&&i&&a.subData({data:i instanceof Float64Array?Zv(i,this):i,offset:o})),n.allocatedValue=s,n.constant=!1,n.externalBuffer=null,n.bufferAccessor=this.settings,!0}_checkExternalBuffer(t){const{value:e}=t;if(!ArrayBuffer.isView(e))throw new Error("Attribute ".concat(this.id," value is not TypedArray"));const n=this.settings.defaultType;let i=!1;if(this.doublePrecision&&(i=e.BYTES_PER_ELEMENT<4),i)throw new Error("Attribute ".concat(this.id," does not support ").concat(e.constructor.name));!(e instanceof n)&&this.settings.normalized&&!("normalized"in t)&&Ln.warn("Attribute ".concat(this.id," is normalized"))()}normalizeConstant(t){switch(this.settings.type){case 5120:return new Float32Array(t).map(e=>(e+128)/255*2-1);case 5122:return new Float32Array(t).map(e=>(e+32768)/65535*2-1);case 5121:return new Float32Array(t).map(e=>e/255);case 5123:return new Float32Array(t).map(e=>e/65535);default:return t}}_normalizeValue(t,e,n){const{defaultValue:i,size:s}=this.settings;if(Number.isFinite(t))return e[n]=t,e;if(!t){let a=s;for(;--a>=0;)e[n+a]=i[a];return e}switch(s){case 4:e[n+3]=Number.isFinite(t[3])?t[3]:i[3];case 3:e[n+2]=Number.isFinite(t[2])?t[2]:i[2];case 2:e[n+1]=Number.isFinite(t[1])?t[1]:i[1];case 1:e[n+0]=Number.isFinite(t[0])?t[0]:i[0];break;default:let a=s;for(;--a>=0;)e[n+a]=Number.isFinite(t[a])?t[a]:i[a]}return e}_areValuesEqual(t,e){if(!t||!e)return!1;const{size:n}=this;for(let i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}}const e3=[],r3=[];function n3(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1/0,n=e3;const i={index:-1,data:r,target:[]};return r?typeof r[Symbol.iterator]=="function"?n=r:r.length>0&&(r3.length=r.length,n=r3):n=e3,(t>0||Number.isFinite(e))&&(n=(Array.isArray(n)?n:Array.from(n)).slice(t,e),i.index=t-1),{iterable:n,objectInfo:i}}function i3(r){return r&&r[Symbol.asyncIterator]}function Bq(r,t){const{size:e,stride:n,offset:i,startIndices:s,nested:a}=t,o=r.BYTES_PER_ELEMENT,h=n?n/o:e,f=i?i/o:0,g=Math.floor((r.length-f)/h);return(b,C)=>{let{index:B,target:R}=C;if(!s){const j=B*h+f;for(let et=0;et<e;et++)R[et]=r[j+et];return R}const D=s[B],Q=s[B+1]||g;let k;if(a){k=new Array(Q-D);for(let j=D;j<Q;j++){const et=j*h+f;R=new Array(e);for(let st=0;st<e;st++)R[st]=r[et+st];k[j-D]=R}}else if(h===e)k=r.subarray(D*e+f,Q*e+f);else{k=new r.constructor((Q-D)*e);let j=0;for(let et=D;et<Q;et++){const st=et*h+f;for(let mt=0;mt<e;mt++)k[j++]=r[st+mt]}}return k}}const Cq=[],m0=[[0,1/0]];function Eq(r,t){if(r===m0||(t[0]<0&&(t[0]=0),t[0]>=t[1]))return r;const e=[],n=r.length;let i=0;for(let s=0;s<n;s++){const a=r[s];a[1]<t[0]?(e.push(a),i=s+1):a[0]>t[1]?e.push(a):t=[Math.min(a[0],t[0]),Math.max(a[1],t[1])]}return e.splice(i,0,t),e}function fb(r){const{source:t,target:e,start:n=0,size:i,getData:s}=r,a=r.end||e.length,o=t.length,h=a-n;if(o>h){e.set(t.subarray(0,h),n);return}if(e.set(t,n),!s)return;let f=o;for(;f<h;){const g=s(f,t);for(let b=0;b<i;b++)e[n+f]=g[b]||0,f++}}function Sq(r){let{source:t,target:e,size:n,getData:i,sourceStartIndices:s,targetStartIndices:a}=r;if(!Array.isArray(a))return fb({source:t,target:e,size:n,getData:i}),e;let o=0,h=0;const f=i&&((b,C)=>i(b+h,C)),g=Math.min(s.length,a.length);for(let b=1;b<g;b++){const C=s[b]*n,B=a[b]*n;fb({source:t.subarray(o,C),target:e,start:h,end:B,size:n,getData:f}),o=C,h=B}return h<e.length&&fb({source:[],target:e,start:h,size:n,getData:f}),e}const Tq={interpolation:{duration:0,easing:r=>r},spring:{stiffness:.05,damping:.5}};function s3(r,t){if(!r)return null;Number.isFinite(r)&&(r={type:"interpolation",duration:r});const e=r.type||"interpolation";return{...Tq[e],...t,...r,type:e}}function o3(r,t){const e=t.getBuffer();return e?[e,{divisor:0,size:t.size,normalized:t.settings.normalized}]:t.value}function a3(r){switch(r){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error('No defined attribute type for size "'.concat(r,'"'))}}function c3(r){r.push(r.shift())}function pb(r,t){const{doublePrecision:e,settings:n,value:i,size:s}=r,a=e&&i instanceof Float64Array?2:1;return(n.noAlloc?i.length:t*s)*a}function l3(r){let{buffer:t,numInstances:e,attribute:n,fromLength:i,fromStartIndices:s,getData:a=j=>j}=r;const o=n.doublePrecision&&n.value instanceof Float64Array?2:1,h=n.size*o,f=n.byteOffset,g=n.startIndices,b=s&&g,C=pb(n,e),B=n.isConstant;if(!b&&i>=C)return;const R=B?n.value:n.getBuffer().getData({srcByteOffset:f});if(n.settings.normalized&&!B){const j=a;a=(et,st)=>n.normalizeConstant(j(et,st))}const D=B?(j,et)=>a(R,et):(j,et)=>a(R.subarray(j,j+h),et),Q=t.getData({length:i}),k=new Float32Array(C);Sq({source:Q,target:k,sourceStartIndices:s,targetStartIndices:g,size:h,getData:D}),t.byteLength<k.byteLength+f&&t.reallocate(k.byteLength+f),t.subData({data:k,offset:f})}class gb extends xq{constructor(t,e){super(t,e,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,updateRanges:m0}),K(this,"constant",!1),this.settings.update=e.update||(e.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(t){this.state.startIndices=t}needsUpdate(){return this.state.needsUpdate}needsRedraw(){let{clearChangedFlags:t=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=this.state.needsRedraw;return this.state.needsRedraw=e&&!t,e}getUpdateTriggers(){const{accessor:t}=this.settings;return[this.id].concat(typeof t!="function"&&t||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(t){if(!t||!this.supportsTransition())return null;const{accessor:e}=this.settings,n=this.settings.transition,i=Array.isArray(e)?t[e.find(s=>t[s])]:t[e];return s3(i,n)}setNeedsUpdate(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.id,e=arguments.length>1?arguments[1]:void 0;if(this.state.needsUpdate=this.state.needsUpdate||t,this.setNeedsRedraw(t),e){const{startRow:n=0,endRow:i=1/0}=e;this.state.updateRanges=Eq(this.state.updateRanges,[n,i])}else this.state.updateRanges=m0}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=Cq}setNeedsRedraw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.id;this.state.needsRedraw=this.state.needsRedraw||t}allocate(t){const{state:e,settings:n}=this;return n.noAlloc?!1:n.update?(super.allocate(t,e.updateRanges!==m0),!0):!1}updateBuffer(t){let{numInstances:e,data:n,props:i,context:s}=t;if(!this.needsUpdate())return!1;const{state:{updateRanges:a},settings:{update:o,noAlloc:h}}=this;let f=!0;if(o){for(const[g,b]of a)o.call(s,this,{data:n,startRow:g,endRow:b,props:i,numInstances:e});if(this.value)if(this.constant||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[g,b]of a){const C=Number.isFinite(g)?this.getVertexOffset(g):0,B=Number.isFinite(b)?this.getVertexOffset(b):h||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:C,endOffset:B})}this._checkAttributeArray()}else f=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),f}setConstantValue(t){return t===void 0||typeof t=="function"?!1:(this.setData({constant:!0,value:t})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(t){const{state:e}=this;return t?(this.clearNeedsUpdate(),e.lastExternalBuffer===t||(e.lastExternalBuffer=t,this.setNeedsRedraw(),this.setData(t)),!0):(e.lastExternalBuffer=null,!1)}setBinaryValue(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const{state:n,settings:i}=this;if(!t)return n.binaryValue=null,n.binaryAccessor=null,!1;if(i.noAlloc)return!1;if(n.binaryValue===t)return this.clearNeedsUpdate(),!0;if(n.binaryValue=t,this.setNeedsRedraw(),i.transform||e!==this.startIndices){ArrayBuffer.isView(t)&&(t={value:t});const a=t;qs(ArrayBuffer.isView(a.value),"invalid ".concat(i.accessor));const o=!!a.size&&a.size!==this.size;return n.binaryAccessor=Bq(a.value,{size:a.size||this.size,stride:a.stride,offset:a.offset,startIndices:e,nested:o}),!1}return this.clearNeedsUpdate(),this.setData(t),!0}getVertexOffset(t){const{startIndices:e}=this;return(e?t<e.length?e[t]:this.numInstances:t)*this.size}getShaderAttributes(){const t=this.settings.shaderAttributes||{[this.id]:null},e={};for(const n in t)Object.assign(e,super.getShaderAttributes(n,t[n]));return e}_autoUpdater(t,e){let{data:n,startRow:i,endRow:s,props:a,numInstances:o}=e;if(t.constant)return;const{settings:h,state:f,value:g,size:b,startIndices:C}=t,{accessor:B,transform:R}=h,D=f.binaryAccessor||(typeof B=="function"?B:a[B]);qs(typeof D=="function",'accessor "'.concat(B,'" is not a function'));let Q=t.getVertexOffset(i);const{iterable:k,objectInfo:j}=n3(n,i,s);for(const et of k){j.index++;let st=D(et,j);if(R&&(st=R.call(this,st)),C){const mt=(j.index<C.length-1?C[j.index+1]:o)-C[j.index];if(st&&Array.isArray(st[0])){let pt=Q;for(const yt of st)t._normalizeValue(yt,g,pt),pt+=b}else st&&st.length>b?g.set(st,Q):(t._normalizeValue(st,j.target,0),rj({target:g,source:j.target,start:Q,count:mt}));Q+=mt*b}else t._normalizeValue(st,g,Q),Q+=b}}_validateAttributeUpdaters(){const{settings:t}=this;if(!(t.noAlloc||typeof t.update=="function"))throw new Error("Attribute ".concat(this.id," missing update or accessor"))}_checkAttributeArray(){const{value:t}=this,e=Math.min(4,this.size);if(t&&t.length>=e){let n=!0;switch(e){case 4:n=n&&Number.isFinite(t[3]);case 3:n=n&&Number.isFinite(t[2]);case 2:n=n&&Number.isFinite(t[1]);case 1:n=n&&Number.isFinite(t[0]);break;default:n=!1}if(!n)throw new Error("Illegal attribute generated for ".concat(this.id))}}}class Iq{constructor(t){let{gl:e,attribute:n,timeline:i}=t;K(this,"gl",void 0),K(this,"type","interpolation"),K(this,"attributeInTransition",void 0),K(this,"settings",void 0),K(this,"attribute",void 0),K(this,"transition",void 0),K(this,"currentStartIndices",void 0),K(this,"currentLength",void 0),K(this,"transform",void 0),K(this,"buffers",void 0),this.gl=e,this.transition=new kp(i),this.attribute=n,this.attributeInTransition=new gb(e,n.settings),this.currentStartIndices=n.startIndices,this.currentLength=0,this.transform=Fq(e,n);const s={byteLength:0,usage:35050};this.buffers=[new ri(e,s),new ri(e,s)]}get inProgress(){return this.transition.inProgress}start(t,e){if(t.duration<=0){this.transition.cancel();return}this.settings=t;const{gl:n,buffers:i,attribute:s}=this;c3(i);const a={numInstances:e,attribute:s,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:t.enter};for(const o of i)l3({buffer:o,...a});this.currentStartIndices=s.startIndices,this.currentLength=pb(s,e),this.attributeInTransition.setData({buffer:i[1],value:s.value}),this.transition.start(t),this.transform.update({elementCount:Math.floor(this.currentLength/s.size),sourceBuffers:{aFrom:i[0],aTo:o3(n,s)},feedbackBuffers:{vCurrent:i[1]}})}update(){const t=this.transition.update();if(t){const{duration:e,easing:n}=this.settings,{time:i}=this.transition;let s=i/e;n&&(s=n(s)),this.transform.run({uniforms:{time:s}})}return t}cancel(){this.transition.cancel(),this.transform.delete();for(const t of this.buffers)t.delete();this.buffers.length=0}}const Lq=`
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
attribute ATTRIBUTE_TYPE aFrom;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`;function Fq(r,t){const e=a3(t.size);return new Gv(r,{vs:Lq,defines:{ATTRIBUTE_TYPE:e},varyings:["vCurrent"]})}class Mq{constructor(t){let{gl:e,attribute:n,timeline:i}=t;K(this,"gl",void 0),K(this,"type","spring"),K(this,"attributeInTransition",void 0),K(this,"settings",void 0),K(this,"attribute",void 0),K(this,"transition",void 0),K(this,"currentStartIndices",void 0),K(this,"currentLength",void 0),K(this,"texture",void 0),K(this,"framebuffer",void 0),K(this,"transform",void 0),K(this,"buffers",void 0),this.gl=e,this.type="spring",this.transition=new kp(i),this.attribute=n,this.attributeInTransition=new gb(e,{...n.settings,normalized:!1}),this.currentStartIndices=n.startIndices,this.currentLength=0,this.texture=Uq(e),this.framebuffer=Rq(e,this.texture),this.transform=Pq(e,n,this.framebuffer);const s={byteLength:0,usage:35050};this.buffers=[new ri(e,s),new ri(e,s),new ri(e,s)]}get inProgress(){return this.transition.inProgress}start(t,e){const{gl:n,buffers:i,attribute:s}=this,a={numInstances:e,attribute:s,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:t.enter};for(const o of i)l3({buffer:o,...a});this.settings=t,this.currentStartIndices=s.startIndices,this.currentLength=pb(s,e),this.attributeInTransition.setData({buffer:i[1],value:s.value}),this.transition.start({...t,duration:1/0}),this.transform.update({elementCount:Math.floor(this.currentLength/s.size),sourceBuffers:{aTo:o3(n,s)}})}update(){const{buffers:t,transform:e,framebuffer:n,transition:i}=this;if(!i.update())return!1;const a=this.settings;return e.update({sourceBuffers:{aPrev:t[0],aCur:t[1]},feedbackBuffers:{vNext:t[2]}}),e.run({framebuffer:n,discard:!1,clearRenderTarget:!0,uniforms:{stiffness:a.stiffness,damping:a.damping},parameters:{depthTest:!1,blend:!0,viewport:[0,0,1,1],blendFunc:[1,1],blendEquation:[32776,32776]}}),c3(t),this.attributeInTransition.setData({buffer:t[1],value:this.attribute.value}),Qm(n)[0]>0||i.end(),!0}cancel(){this.transition.cancel(),this.transform.delete();for(const t of this.buffers)t.delete();this.buffers.length=0,this.texture.delete(),this.framebuffer.delete()}}function Pq(r,t,e){const n=a3(t.size);return new Gv(r,{framebuffer:e,vs:`
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
attribute ATTRIBUTE_TYPE aPrev;
attribute ATTRIBUTE_TYPE aCur;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vNext;
varying float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,fs:`
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

varying float vIsTransitioningFlag;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  gl_FragColor = vec4(1.0);
}`,defines:{ATTRIBUTE_TYPE:n},varyings:["vNext"]})}function Uq(r){return new La(r,{data:new Uint8Array(4),format:6408,type:5121,border:0,mipmaps:!1,dataFormat:6408,width:1,height:1})}function Rq(r,t){return new vs(r,{id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,attachments:{36064:t}})}const Dq={interpolation:Iq,spring:Mq};class Oq{constructor(t,e){let{id:n,timeline:i}=e;K(this,"id",void 0),K(this,"isSupported",void 0),K(this,"gl",void 0),K(this,"timeline",void 0),K(this,"transitions",void 0),K(this,"needsRedraw",void 0),K(this,"numInstances",void 0),this.id=n,this.gl=t,this.timeline=i,this.transitions={},this.needsRedraw=!1,this.numInstances=1,this.isSupported=Gv.isSupported(t)}finalize(){for(const t in this.transitions)this._removeTransition(t)}update(t){let{attributes:e,transitions:n,numInstances:i}=t;this.numInstances=i||1;for(const s in e){const a=e[s],o=a.getTransitionSetting(n);o&&this._updateAttribute(s,a,o)}for(const s in this.transitions){const a=e[s];(!a||!a.getTransitionSetting(n))&&this._removeTransition(s)}}hasAttribute(t){const e=this.transitions[t];return e&&e.inProgress}getAttributes(){const t={};for(const e in this.transitions){const n=this.transitions[e];n.inProgress&&(t[e]=n.attributeInTransition)}return t}run(){if(!this.isSupported||this.numInstances===0)return!1;for(const e in this.transitions)this.transitions[e].update()&&(this.needsRedraw=!0);const t=this.needsRedraw;return this.needsRedraw=!1,t}_removeTransition(t){this.transitions[t].cancel(),delete this.transitions[t]}_updateAttribute(t,e,n){const i=this.transitions[t];let s=!i||i.type!==n.type;if(s){if(!this.isSupported){Ln.warn("WebGL2 not supported by this browser. Transition for ".concat(t," is disabled."))();return}i&&this._removeTransition(t);const a=Dq[n.type];a?this.transitions[t]=new a({attribute:e,timeline:this.timeline,gl:this.gl}):(Ln.error("unsupported transition type '".concat(n.type,"'"))(),s=!1)}(s||e.needsRedraw())&&(this.needsRedraw=!0,this.transitions[t].start(n,this.numInstances))}}const A3="attributeManager.invalidate",Nq="attributeManager.updateStart",kq="attributeManager.updateEnd",Qq="attribute.updateStart",zq="attribute.allocate",Hq="attribute.updateEnd";class Gq{constructor(t){let{id:e="attribute-manager",stats:n,timeline:i}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};K(this,"id",void 0),K(this,"gl",void 0),K(this,"attributes",void 0),K(this,"updateTriggers",void 0),K(this,"needsRedraw",void 0),K(this,"userData",void 0),K(this,"stats",void 0),K(this,"attributeTransitionManager",void 0),K(this,"mergeBoundsMemoized",Up(KV)),this.id=e,this.gl=t,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=n,this.attributeTransitionManager=new Oq(t,{id:"".concat(e,"-transitions"),timeline:i}),Object.seal(this)}finalize(){for(const t in this.attributes)this.attributes[t].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};const e=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!t.clearRedrawFlags,e&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(t){this._add(t)}addInstanced(t){this._add(t,{instanced:1})}remove(t){for(const e of t)this.attributes[e]!==void 0&&(this.attributes[e].delete(),delete this.attributes[e])}invalidate(t,e){const n=this._invalidateTrigger(t,e);Ao(A3,this,t,n)}invalidateAll(t){for(const e in this.attributes)this.attributes[e].setNeedsUpdate(e,t);Ao(A3,this,"all")}update(t){let{data:e,numInstances:n,startIndices:i=null,transitions:s,props:a={},buffers:o={},context:h={}}=t,f=!1;Ao(Nq,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const g in this.attributes){const b=this.attributes[g],C=b.settings.accessor;b.startIndices=i,b.numInstances=n,a[g]&&Ln.removed("props.".concat(g),"data.attributes.".concat(g))(),b.setExternalBuffer(o[g])||b.setBinaryValue(typeof C=="string"?o[C]:void 0,e.startIndices)||typeof C=="string"&&!o[C]&&b.setConstantValue(a[C])||b.needsUpdate()&&(f=!0,this._updateAttribute({attribute:b,numInstances:n,data:e,props:a,context:h})),this.needsRedraw=this.needsRedraw||b.needsRedraw()}f&&Ao(kq,this,n),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:n,transitions:s})}updateTransition(){const{attributeTransitionManager:t}=this,e=t.run();return this.needsRedraw=this.needsRedraw||e,e}getAttributes(){return this.attributes}getBounds(t){const e=t.map(n=>{var i;return(i=this.attributes[n])===null||i===void 0?void 0:i.getBounds()});return this.mergeBoundsMemoized(e)}getChangedAttributes(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearChangedFlags:!1};const{attributes:e,attributeTransitionManager:n}=this,i={...n.getAttributes()};for(const s in e){const a=e[s];a.needsRedraw(t)&&!n.hasAttribute(s)&&(i[s]=a)}return i}getShaderAttributes(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};t||(t=this.getAttributes());const n={};for(const i in t)e[i]||Object.assign(n,t[i].getShaderAttributes());return n}_add(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};for(const n in t){const i=t[n];this.attributes[n]=this._createAttribute(n,i,e)}this._mapUpdateTriggersToAttributes()}_createAttribute(t,e,n){const i={...e,id:t,size:e.isIndexed&&1||e.size||1,divisor:n.instanced?1:e.divisor||0};return new gb(this.gl,i)}_mapUpdateTriggersToAttributes(){const t={};for(const e in this.attributes)this.attributes[e].getUpdateTriggers().forEach(i=>{t[i]||(t[i]=[]),t[i].push(e)});this.updateTriggers=t}_invalidateTrigger(t,e){const{attributes:n,updateTriggers:i}=this,s=i[t];return s&&s.forEach(a=>{const o=n[a];o&&o.setNeedsUpdate(o.id,e)}),s}_updateAttribute(t){const{attribute:e,numInstances:n}=t;if(Ao(Qq,e),e.constant){e.setConstantValue(e.value);return}e.allocate(n)&&Ao(zq,e,n),e.updateBuffer(t)&&(this.needsRedraw=!0,Ao(Hq,e,n))}}class Vq extends kp{get value(){return this._value}_onUpdate(){const{time:t,settings:{fromValue:e,toValue:n,duration:i,easing:s}}=this,a=s(t/i);this._value=Xm(e,n,a)}}const u3=1e-5;function h3(r,t,e,n,i){const s=t-r,o=(e-t)*i,h=-s*n;return o+h+s+t}function jq(r,t,e,n,i){if(Array.isArray(e)){const s=[];for(let a=0;a<e.length;a++)s[a]=h3(r[a],t[a],e[a],n,i);return s}return h3(r,t,e,n,i)}function d3(r,t){if(Array.isArray(r)){let e=0;for(let n=0;n<r.length;n++){const i=r[n]-t[n];e+=i*i}return Math.sqrt(e)}return Math.abs(r-t)}class qq extends kp{get value(){return this._currValue}_onUpdate(){const{fromValue:t,toValue:e,damping:n,stiffness:i}=this.settings,{_prevValue:s=t,_currValue:a=t}=this;let o=jq(s,a,e,n,i);const h=d3(o,e),f=d3(o,a);h<u3&&f<u3&&(o=e,this.end()),this._prevValue=a,this._currValue=o}}const Kq={interpolation:Vq,spring:qq};class $q{constructor(t){this.transitions=new Map,this.timeline=t}get active(){return this.transitions.size>0}add(t,e,n,i){const{transitions:s}=this;if(s.has(t)){const h=s.get(t),{value:f=h.settings.fromValue}=h;e=f,this.remove(t)}if(i=s3(i),!i)return;const a=Kq[i.type];if(!a){Ln.error("unsupported transition type '".concat(i.type,"'"))();return}const o=new a(this.timeline);o.start({...i,fromValue:e,toValue:n}),s.set(t,o)}remove(t){const{transitions:e}=this;e.has(t)&&(e.get(t).cancel(),e.delete(t))}update(){const t={};for(const[e,n]of this.transitions)n.update(),t[e]=n.value,n.inProgress||this.remove(e);return t}clear(){for(const t of this.transitions.keys())this.remove(t)}}function Wq(r){const t=r[mu];for(const e in t){const n=t[e],{validate:i}=n;if(i&&!i(r[e],n))throw new Error("Invalid prop ".concat(e,": ").concat(r[e]))}}function Xq(r,t){const e=f3({newProps:r,oldProps:t,propTypes:r[mu],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),n=Yq(r,t);let i=!1;return n||(i=Zq(r,t)),{dataChanged:n,propsChanged:e,updateTriggersChanged:i,extensionsChanged:tK(r,t),transitionsChanged:Jq(r,t)}}function Jq(r,t){if(!r.transitions)return!1;const e={},n=r[mu];let i=!1;for(const s in r.transitions){const a=n[s],o=a&&a.type;(o==="number"||o==="color"||o==="array")&&mb(r[s],t[s],a)&&(e[s]=!0,i=!0)}return i?e:!1}function f3(r){let{newProps:t,oldProps:e,ignoreProps:n={},propTypes:i={},triggerName:s="props"}=r;if(e===t)return!1;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return"".concat(s," changed shallowly");for(const a of Object.keys(t))if(!(a in n)){if(!(a in e))return"".concat(s,".").concat(a," added");const o=mb(t[a],e[a],i[a]);if(o)return"".concat(s,".").concat(a," ").concat(o)}for(const a of Object.keys(e))if(!(a in n)){if(!(a in t))return"".concat(s,".").concat(a," dropped");if(!Object.hasOwnProperty.call(t,a)){const o=mb(t[a],e[a],i[a]);if(o)return"".concat(s,".").concat(a," ").concat(o)}}return!1}function mb(r,t,e){let n=e&&e.equal;return n&&!n(r,t,e)||!n&&(n=r&&t&&r.equals,n&&!n.call(r,t))?"changed deeply":!n&&t!==r?"changed shallowly":null}function Yq(r,t){if(t===null)return"oldProps is null, initial diff";let e=!1;const{dataComparator:n,_dataDiff:i}=r;return n?n(r.data,t.data)||(e="Data comparator detected a change"):r.data!==t.data&&(e="A new data container was supplied"),e&&i&&(e=i(r.data,t.data)||e),e}function Zq(r,t){if(t===null)return{all:!0};if("all"in r.updateTriggers&&p3(r,t,"all"))return{all:!0};const e={};let n=!1;for(const i in r.updateTriggers)i!=="all"&&p3(r,t,i)&&(e[i]=!0,n=!0);return n?e:!1}function tK(r,t){if(t===null)return!0;const e=t.extensions,{extensions:n}=r;if(n===e)return!1;if(!e||!n||n.length!==e.length)return!0;for(let i=0;i<n.length;i++)if(!n[i].equals(e[i]))return!0;return!1}function p3(r,t,e){let n=r.updateTriggers[e];n=n??{};let i=t.updateTriggers[e];return i=i??{},f3({oldProps:i,newProps:n,triggerName:e})}const eK="count(): argument not an object",rK="count(): argument not a container";function nK(r){if(!sK(r))throw new Error(eK);if(typeof r.count=="function")return r.count();if(Number.isFinite(r.size))return r.size;if(Number.isFinite(r.length))return r.length;if(iK(r))return Object.keys(r).length;throw new Error(rK)}function iK(r){return r!==null&&typeof r=="object"&&r.constructor===Object}function sK(r){return r!==null&&typeof r=="object"}function oK(r,t){if(!t)return r;const e={...r,...t};if("defines"in t&&(e.defines={...r.defines,...t.defines}),"modules"in t&&(e.modules=(r.modules||[]).concat(t.modules),t.modules.some(n=>n.name==="project64"))){const n=e.modules.findIndex(i=>i.name==="project32");n>=0&&e.modules.splice(n,1)}if("inject"in t)if(!r.inject)e.inject=t.inject;else{const n={...r.inject};for(const i in t.inject)n[i]=(n[i]||"")+t.inject[i];e.inject=n}return e}const aK={10241:9987,10240:9729,10242:33071,10243:33071},yb={};function cK(r,t,e,n){if(e instanceof La)return e;e.constructor&&e.constructor.name!=="Object"&&(e={data:e});let i=null;e.compressed&&(i={10241:e.data.length>1?9985:9729});const s=new La(t,{...e,parameters:{...aK,...i,...n}});return yb[s.id]=r,s}function lK(r,t){!t||!(t instanceof La)||yb[t.id]===r&&(t.delete(),delete yb[t.id])}const AK={boolean:{validate(r,t){return!0},equal(r,t,e){return!!r==!!t}},number:{validate(r,t){return Number.isFinite(r)&&(!("max"in t)||r<=t.max)&&(!("min"in t)||r>=t.min)}},color:{validate(r,t){return t.optional&&!r||_b(r)&&(r.length===3||r.length===4)},equal(r,t,e){return Tl(r,t,1)}},accessor:{validate(r,t){const e=y0(r);return e==="function"||e===y0(t.value)},equal(r,t,e){return typeof t=="function"?!0:Tl(r,t,1)}},array:{validate(r,t){return t.optional&&!r||_b(r)},equal(r,t,e){const{compare:n}=e,i=Number.isInteger(n)?n:n?1:0;return n?Tl(r,t,i):r===t}},object:{equal(r,t,e){if(e.ignore)return!0;const{compare:n}=e,i=Number.isInteger(n)?n:n?1:0;return n?Tl(r,t,i):r===t}},function:{validate(r,t){return t.optional&&!r||typeof r=="function"},equal(r,t,e){return!e.compare&&e.ignore!==!1||r===t}},data:{transform:(r,t,e)=>{const{dataTransform:n}=e.props;return n&&r?n(r):r}},image:{transform:(r,t,e)=>{const n=e.context;return!n||!n.gl?null:cK(e.id,n.gl,r,{...t.parameters,...e.props.textureParameters})},release:(r,t,e)=>{lK(e.id,r)}}};function uK(r){const t={},e={},n={};for(const[i,s]of Object.entries(r)){const a=s==null?void 0:s.deprecatedFor;if(a)n[i]=Array.isArray(a)?a:[a];else{const o=hK(i,s);t[i]=o,e[i]=o.value}}return{propTypes:t,defaultProps:e,deprecatedProps:n}}function hK(r,t){switch(y0(t)){case"object":return zp(r,t);case"array":return zp(r,{type:"array",value:t,compare:!1});case"boolean":return zp(r,{type:"boolean",value:t});case"number":return zp(r,{type:"number",value:t});case"function":return zp(r,{type:"function",value:t,compare:!0});default:return{name:r,type:"unknown",value:t}}}function zp(r,t){return"type"in t?{name:r,...AK[t.type],...t}:"value"in t?{name:r,type:y0(t.value),...t}:{name:r,type:"object",value:t}}function _b(r){return Array.isArray(r)||ArrayBuffer.isView(r)}function y0(r){return _b(r)?"array":r===null?"null":typeof r}function dK(r,t){let e;for(let s=t.length-1;s>=0;s--){const a=t[s];"extensions"in a&&(e=a.extensions)}const n=vb(r.constructor,e),i=Object.create(n);i[u0]=r,i[_h]={},i[yu]={};for(let s=0;s<t.length;++s){const a=t[s];for(const o in a)i[o]=a[o]}return Object.freeze(i),i}const fK="_mergedDefaultProps";function vb(r,t){let e=fK;if(t)for(const i of t){const s=i.constructor;s&&(e+=":".concat(s.extensionName||s.name))}const n=g3(r,e);return n||(r[e]=pK(r,t||[]))}function pK(r,t){if(!r.prototype)return null;const n=Object.getPrototypeOf(r),i=vb(n),s=g3(r,"defaultProps")||{},a=uK(s),o=Object.assign(Object.create(null),i,a.defaultProps),h=Object.assign(Object.create(null),i==null?void 0:i[mu],a.propTypes),f=Object.assign(Object.create(null),i==null?void 0:i[eb],a.deprecatedProps);for(const g of t){const b=vb(g.constructor);b&&(Object.assign(o,b),Object.assign(h,b[mu]),Object.assign(f,b[eb]))}return gK(o,r),yK(o,h),mK(o,f),o[mu]=h,o[eb]=f,t.length===0&&!bb(r,"_propTypes")&&(r._propTypes=h),o}function gK(r,t){const e=vK(t);Object.defineProperties(r,{id:{writable:!0,value:e}})}function mK(r,t){for(const e in t)Object.defineProperty(r,e,{enumerable:!1,set(n){const i="".concat(this.id,": ").concat(e);for(const s of t[e])bb(this,s)||(this[s]=n);Ln.deprecated(i,t[e].join("/"))()}})}function yK(r,t){const e={},n={};for(const i in t){const s=t[i],{name:a,value:o}=s;s.async&&(e[a]=o,n[a]=_K(a))}r[Nd]=e,r[_h]={},Object.defineProperties(r,n)}function _K(r){return{enumerable:!0,set(t){typeof t=="string"||t instanceof Promise||i3(t)?this[_h][r]=t:this[yu][r]=t},get(){if(this[yu]){if(r in this[yu])return this[yu][r]||this[Nd][r];if(r in this[_h]){const t=this[u0]&&this[u0].internalState;if(t&&t.hasAsyncProp(r))return t.getAsyncProp(r)||this[Nd][r]}}return this[Nd][r]}}}function bb(r,t){return Object.prototype.hasOwnProperty.call(r,t)}function g3(r,t){return bb(r,t)&&r[t]}function vK(r){const t=r.componentName;return t||Ln.warn("".concat(r.name,".componentName not specified"))(),t||r.name}let bK=0;class wb{constructor(){K(this,"id",void 0),K(this,"props",void 0),K(this,"count",void 0);for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this.props=dK(this,e),this.id=this.props.id,this.count=bK++}clone(t){const{props:e}=this,n={};for(const i in e[Nd])i in e[yu]?n[i]=e[yu][i]:i in e[_h]&&(n[i]=e[_h][i]);return new this.constructor({...e,...n,...t})}}K(wb,"componentName","Component"),K(wb,"defaultProps",{});const wK=Object.freeze({});class xK{constructor(t){K(this,"component",void 0),K(this,"onAsyncPropUpdated",void 0),K(this,"asyncProps",void 0),K(this,"oldProps",void 0),K(this,"oldAsyncProps",void 0),this.component=t,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const t in this.asyncProps){const e=this.asyncProps[t];e&&e.type&&e.type.release&&e.type.release(e.resolvedValue,e.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||wK}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(t){return t in this.asyncProps}getAsyncProp(t){const e=this.asyncProps[t];return e&&e.resolvedValue}isAsyncPropLoading(t){if(t){const e=this.asyncProps[t];return!!(e&&e.pendingLoadCount>0&&e.pendingLoadCount!==e.resolvedLoadCount)}for(const e in this.asyncProps)if(this.isAsyncPropLoading(e))return!0;return!1}reloadAsyncProp(t,e){this._watchPromise(t,Promise.resolve(e))}setAsyncProps(t){this.component=t[u0]||this.component;const e=t[yu]||{},n=t[_h]||t,i=t[Nd]||{};for(const s in e){const a=e[s];this._createAsyncPropData(s,i[s]),this._updateAsyncProp(s,a),e[s]=this.getAsyncProp(s)}for(const s in n){const a=n[s];this._createAsyncPropData(s,i[s]),this._updateAsyncProp(s,a)}}_fetch(t,e){return null}_onResolve(t,e){}_onError(t,e){}_updateAsyncProp(t,e){if(this._didAsyncInputValueChange(t,e)){if(typeof e=="string"&&(e=this._fetch(t,e)),e instanceof Promise){this._watchPromise(t,e);return}if(i3(e)){this._resolveAsyncIterable(t,e);return}this._setPropValue(t,e)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const t in this.asyncProps)Object.defineProperty(this.oldAsyncProps,t,{enumerable:!0,value:this.oldProps[t]})}}_didAsyncInputValueChange(t,e){const n=this.asyncProps[t];return e===n.resolvedValue||e===n.lastValue?!1:(n.lastValue=e,!0)}_setPropValue(t,e){this._freezeAsyncOldProps();const n=this.asyncProps[t];n&&(e=this._postProcessValue(n,e),n.resolvedValue=e,n.pendingLoadCount++,n.resolvedLoadCount=n.pendingLoadCount)}_setAsyncPropValue(t,e,n){const i=this.asyncProps[t];i&&n>=i.resolvedLoadCount&&e!==void 0&&(this._freezeAsyncOldProps(),i.resolvedValue=e,i.resolvedLoadCount=n,this.onAsyncPropUpdated(t,e))}_watchPromise(t,e){const n=this.asyncProps[t];if(n){n.pendingLoadCount++;const i=n.pendingLoadCount;e.then(s=>{this.component&&(s=this._postProcessValue(n,s),this._setAsyncPropValue(t,s,i),this._onResolve(t,s))}).catch(s=>{this._onError(t,s)})}}async _resolveAsyncIterable(t,e){if(t!=="data"){this._setPropValue(t,e);return}const n=this.asyncProps[t];if(!n)return;n.pendingLoadCount++;const i=n.pendingLoadCount;let s=[],a=0;for await(const o of e){if(!this.component)return;const{dataTransform:h}=this.component.props;h?s=h(o,s):s=s.concat(o),Object.defineProperty(s,"__diff",{enumerable:!1,value:[{startRow:a,endRow:s.length}]}),a=s.length,this._setAsyncPropValue(t,s,i)}this._onResolve(t,s)}_postProcessValue(t,e){const n=t.type;return n&&this.component&&(n.release&&n.release(t.resolvedValue,n,this.component),n.transform)?n.transform(e,n,this.component):e}_createAsyncPropData(t,e){if(!this.asyncProps[t]){const i=this.component&&this.component.props[mu];this.asyncProps[t]={type:i&&i[t],lastValue:null,resolvedValue:e,pendingLoadCount:0,resolvedLoadCount:0}}}}class BK extends xK{constructor(t){let{attributeManager:e,layer:n}=t;super(n),K(this,"attributeManager",void 0),K(this,"needsRedraw",void 0),K(this,"needsUpdate",void 0),K(this,"subLayers",void 0),K(this,"usesPickingColorCache",void 0),K(this,"hasPickingBuffer",void 0),K(this,"changeFlags",void 0),K(this,"viewport",void 0),K(this,"uniformTransitions",void 0),K(this,"propsInTransition",void 0),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(t,e){const n=this.layer,i=n==null?void 0:n.props.fetch;return i?i(e,{propName:t,layer:n}):super._fetch(t,e)}_onResolve(t,e){const n=this.layer;if(n){const i=n.props.onDataLoad;t==="data"&&i&&i(e,{propName:t,layer:n})}}_onError(t,e){const n=this.layer;n&&n.raiseError(e,"loading ".concat(t," of ").concat(this.layer))}}const CK="layer.changeFlag",EK="layer.initialize",SK="layer.update",TK="layer.finalize",IK="layer.matched",m3=2**24-1,LK=Object.freeze([]),FK=Up(r=>{let{oldViewport:t,viewport:e}=r;return t.equals(e)});let Ll=new Uint8ClampedArray(0);const MK={data:{type:"data",value:LK,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:r=>r&&r.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(r,t)=>{let{propName:e,layer:n,loaders:i,loadOptions:s,signal:a}=t;const{resourceManager:o}=n.context;if(s=s||n.getLoadOptions(),i=i||n.props.loaders,a){var h;s={...s,fetch:{...(h=s)===null||h===void 0?void 0:h.fetch,signal:a}}}let f=o.contains(r);return!f&&!s&&(o.add({resourceId:r,data:uu(r,i),persistent:!1}),f=!0),f?o.subscribe({resourceId:r,onChange:g=>{var b;return(b=n.internalState)===null||b===void 0?void 0:b.reloadAsyncProp(e,g)},consumerId:n.id,requestId:e}):uu(r,i,s)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:En.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:r=>{let{layerIndex:t}=r;return[0,-t*100]}},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class zd extends wb{constructor(){super(...arguments),K(this,"internalState",null),K(this,"lifecycle",Od.NO_STATE),K(this,"context",void 0),K(this,"state",void 0),K(this,"parent",null)}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let t=this;for(;t.parent;)t=t.parent;return t}toString(){const t=this.constructor.layerName||this.constructor.name;return"".concat(t,"({id: '").concat(this.props.id,"'})")}project(t){qs(this.internalState);const e=this.internalState.viewport||this.context.viewport,n=ET(t,{viewport:e,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[i,s,a]=yT(n,e.pixelProjectionMatrix);return t.length===2?[i,s]:[i,s,a]}unproject(t){return qs(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(t)}projectPosition(t,e){qs(this.internalState);const n=this.internalState.viewport||this.context.viewport;return ZV(t,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...e})}get isComposite(){return!1}setState(t){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,t),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){return this.state&&(this.state.models||this.state.model&&[this.state.model])||[]}setModuleParameters(t){for(const e of this.getModels())e.updateModuleSettings(t)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:t}=this.props;return t===En.DEFAULT||t===En.LNGLAT||t===En.CARTESIAN}onHover(t,e){return this.props.onHover&&this.props.onHover(t,e)||!1}onClick(t,e){return this.props.onClick&&this.props.onClick(t,e)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return e[0]=t+1&255,e[1]=t+1>>8&255,e[2]=t+1>>8>>8&255,e}decodePickingColor(t){qs(t instanceof Uint8Array);const[e,n,i]=t;return e+n*256+i*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:nK(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var t;return(t=this.getAttributeManager())===null||t===void 0?void 0:t.getBounds(["positions","instancePositions"])}getShaders(t){for(const e of this.props.extensions)t=oK(t,e.getShaders.call(this,e));return t}shouldUpdateState(t){return t.changeFlags.propsOrDataChanged}updateState(t){const e=this.getAttributeManager(),{dataChanged:n}=t.changeFlags;if(n&&e)if(Array.isArray(n))for(const i of n)e.invalidateAll(i);else e.invalidateAll();if(e){const{props:i}=t,s=this.internalState.hasPickingBuffer,a=Number.isInteger(i.highlightedObjectIndex)||i.pickable||i.extensions.some(o=>o.getNeedsPickingBuffer.call(this,o));if(s!==a){this.internalState.hasPickingBuffer=a;const{pickingColors:o,instancePickingColors:h}=e.attributes,f=o||h;f&&(a&&f.constant&&(f.constant=!1,e.invalidate(f.id)),!f.value&&!a&&(f.constant=!0,f.value=[0,0,0]))}}}finalizeState(t){for(const n of this.getModels())n.delete();const e=this.getAttributeManager();e&&e.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(t){for(const e of this.getModels())e.draw(t)}getPickingInfo(t){let{info:e,mode:n,sourceLayer:i}=t;const{index:s}=e;return s>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[s]),e}raiseError(t,e){var n,i;if(e&&(t=new Error("".concat(e,": ").concat(t.message),{cause:t})),!((n=(i=this.props).onError)!==null&&n!==void 0&&n.call(i,t))){var s,a;(s=this.context)===null||s===void 0||(a=s.onError)===null||a===void 0||a.call(s,t,this)}}getNeedsRedraw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};return this._getNeedsRedraw(t)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var t;return((t=this.internalState)===null||t===void 0?void 0:t.uniformTransitions.active)||!1}activateViewport(t){if(!this.internalState)return;const e=this.internalState.viewport;this.internalState.viewport=t,(!e||!FK({oldViewport:e,viewport:t}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"all";const e=this.getAttributeManager();e&&(t==="all"?e.invalidateAll():e.invalidate(t))}updateAttributes(t){for(const e of this.getModels())this._setModelAttributes(e,t)}_updateAttributes(){const t=this.getAttributeManager();if(!t)return;const e=this.props,n=this.getNumInstances(),i=this.getStartIndices();t.update({data:e.data,numInstances:n,startIndices:i,props:e,transitions:e.transitions,buffers:e.data.attributes,context:this});const s=t.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(s)}_updateAttributeTransition(){const t=this.getAttributeManager();t&&t.updateTransition()}_updateUniformTransition(){const{uniformTransitions:t}=this.internalState;if(t.active){const e=t.update(),n=Object.create(this.props);for(const i in e)Object.defineProperty(n,i,{value:e[i]});return n}return this.props}calculateInstancePickingColors(t,e){let{numInstances:n}=e;if(t.constant)return;const i=Math.floor(Ll.length/3);if(this.internalState.usesPickingColorCache=!0,i<n){n>m3&&Ln.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),Ll=Dp.allocate(Ll,n,{size:3,copy:!0,maxCount:Math.max(n,m3)});const s=Math.floor(Ll.length/3),a=[];for(let o=i;o<s;o++)this.encodePickingColor(o,a),Ll[o*3+0]=a[0],Ll[o*3+1]=a[1],Ll[o*3+2]=a[2]}t.value=Ll.subarray(0,n*3)}_setModelAttributes(t,e){const n=this.getAttributeManager(),i=t.userData.excludeAttributes||{},s=n.getShaderAttributes(e,i);t.setAttributes(s)}disablePickingIndex(t){const e=this.props.data;if(!("attributes"in e)){this._disablePickingIndex(t);return}const{pickingColors:n,instancePickingColors:i}=this.getAttributeManager().attributes,s=n||i,a=s&&e.attributes&&e.attributes[s.id];if(a&&a.value){const o=a.value,h=this.encodePickingColor(t);for(let f=0;f<e.length;f++){const g=s.getVertexOffset(f);o[g]===h[0]&&o[g+1]===h[1]&&o[g+2]===h[2]&&this._disablePickingIndex(f)}}else this._disablePickingIndex(t)}_disablePickingIndex(t){const{pickingColors:e,instancePickingColors:n}=this.getAttributeManager().attributes,i=e||n;if(!i)return;const s=i.getVertexOffset(t),a=i.getVertexOffset(t+1);i.buffer.subData({data:new Uint8Array(a-s),offset:s})}restorePickingColors(){const{pickingColors:t,instancePickingColors:e}=this.getAttributeManager().attributes,n=t||e;n&&(this.internalState.usesPickingColorCache&&n.value.buffer!==Ll.buffer&&(n.value=Ll.subarray(0,n.value.length)),n.updateSubBuffer({startOffset:0}))}_initialize(){qs(!this.internalState),qs(Number.isFinite(this.props.coordinateSystem)),Ao(EK,this);const t=this._getAttributeManager();t&&t.addInstanced({instancePickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new BK({attributeManager:t,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(Ln.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),t)}),this.internalState.uniformTransitions=new $q(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const e of this.props.extensions)e.initializeState.call(this,this.context,e);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(t){Ao(IK,this,this===t);const{state:e,internalState:n}=t;this!==t&&(this.internalState=n,this.state=e,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const t=this.needsUpdate();if(Ao(SK,this,t),!t)return;const e=this.props,n=this.context,i=this.internalState,s=n.viewport,a=this._updateUniformTransition();i.propsInTransition=a,n.viewport=i.viewport||s,this.props=a;try{const o=this._getUpdateParams(),h=this.getModels();if(n.gl)this.updateState(o);else try{this.updateState(o)}catch{}for(const g of this.props.extensions)g.updateState.call(this,o,g);const f=this.getModels()[0]!==h[0];this._postUpdate(o,f)}finally{n.viewport=s,this.props=e,this._clearChangeFlags(),i.needsUpdate=!1,i.resetOldProps()}}_finalize(){Ao(TK,this),this.finalizeState(this.context);for(const t of this.props.extensions)t.finalizeState.call(this,this.context,t)}_drawLayer(t){let{moduleParameters:e=null,uniforms:n={},parameters:i={}}=t;this._updateAttributeTransition();const s=this.props,a=this.context;this.props=this.internalState.propsInTransition||s;const o=this.props.opacity;n.opacity=Math.pow(o,1/2.2);try{e&&this.setModuleParameters(e);const{getPolygonOffset:h}=this.props,f=h&&h(n)||[0,0];_A(a.gl,{polygonOffset:f}),Ic(a.gl,i,()=>{const g={moduleParameters:e,uniforms:n,parameters:i,context:a};for(const b of this.props.extensions)b.draw.call(this,g,b);this.draw(g)})}finally{this.props=s}}getChangeFlags(){var t;return(t=this.internalState)===null||t===void 0?void 0:t.changeFlags}setChangeFlags(t){if(!this.internalState)return;const{changeFlags:e}=this.internalState;for(const i in t)if(t[i]){let s=!1;switch(i){case"dataChanged":const a=t[i],o=e[i];a&&Array.isArray(o)&&(e.dataChanged=Array.isArray(a)?o.concat(a):a,s=!0);default:e[i]||(e[i]=t[i],s=!0)}s&&Ao(CK,this,i,t)}const n=!!(e.dataChanged||e.updateTriggersChanged||e.propsChanged||e.extensionsChanged);e.propsOrDataChanged=n,e.somethingChanged=n||e.viewportChanged||e.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(t,e){const n=Xq(t,e);if(n.updateTriggersChanged)for(const s in n.updateTriggersChanged)n.updateTriggersChanged[s]&&this.invalidateAttribute(s);if(n.transitionsChanged)for(const s in n.transitionsChanged){var i;this.internalState.uniformTransitions.add(s,e[s],t[s],(i=t.transitions)===null||i===void 0?void 0:i[s])}return this.setChangeFlags(n)}validateProps(){Wq(this.props)}updateAutoHighlight(t){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(t)}_updateAutoHighlight(t){const e={pickingSelectedColor:t.picked?t.color:null},{highlightColor:n}=this.props;t.picked&&typeof n=="function"&&(e.pickingHighlightColor=n(t)),this.setModuleParameters(e),this.setNeedsRedraw()}_getAttributeManager(){const t=this.context;return new Gq(t.gl,{id:this.props.id,stats:t.stats,timeline:t.timeline})}_postUpdate(t,e){const{props:n,oldProps:i}=t;this.setNeedsRedraw(),this._updateAttributes();const{model:s}=this.state;s==null||s.setInstanceCount(this.getNumInstances());const{autoHighlight:a,highlightedObjectIndex:o,highlightColor:h}=n;if(e||i.autoHighlight!==a||i.highlightedObjectIndex!==o||i.highlightColor!==h){const f={};a||(f.pickingSelectedColor=null),Array.isArray(h)&&(f.pickingHighlightColor=h),(e||o!==i.highlightedObjectIndex)&&(f.pickingSelectedColor=Number.isFinite(o)&&o>=0?this.encodePickingColor(o):null),this.setModuleParameters(f)}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(t){if(!this.internalState)return!1;let e=!1;e=e||this.internalState.needsRedraw&&this.id;const n=this.getAttributeManager(),i=n?n.getNeedsRedraw(t):!1;if(e=e||i,e)for(const s of this.props.extensions)s.onNeedsRedraw.call(this,s);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!t.clearRedrawFlags,e}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}K(zd,"defaultProps",MK),K(zd,"layerName","Layer");const PK="compositeLayer.renderLayers";class y3 extends zd{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(t=>t.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(t){}setState(t){super.setState(t),this.setNeedsUpdate()}getPickingInfo(t){let{info:e}=t;const{object:n}=e;return n&&n.__source&&n.__source.parent&&n.__source.parent.id===this.id&&(e.object=n.__source.object,e.index=n.__source.index),e}filterSubLayer(t){return!0}shouldRenderSubLayer(t,e){return e&&e.length}getSubLayerClass(t,e){const{_subLayerProps:n}=this.props;return n&&n[t]&&n[t].type||e}getSubLayerRow(t,e,n){return t.__source={parent:this,object:e,index:n},t}getSubLayerAccessor(t){if(typeof t=="function"){const e={index:-1,data:this.props.data,target:[]};return(n,i)=>n&&n.__source?(e.index=n.__source.index,t(n.__source.object,e)):t(n,i)}return t}getSubLayerProps(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};var e;const{opacity:n,pickable:i,visible:s,parameters:a,getPolygonOffset:o,highlightedObjectIndex:h,autoHighlight:f,highlightColor:g,coordinateSystem:b,coordinateOrigin:C,wrapLongitude:B,positionFormat:R,modelMatrix:D,extensions:Q,fetch:k,operation:j,_subLayerProps:et}=this.props,st={id:"",updateTriggers:{},opacity:n,pickable:i,visible:s,parameters:a,getPolygonOffset:o,highlightedObjectIndex:h,autoHighlight:f,highlightColor:g,coordinateSystem:b,coordinateOrigin:C,wrapLongitude:B,positionFormat:R,modelMatrix:D,extensions:Q,fetch:k,operation:j},mt=et&&t.id&&et[t.id],pt=mt&&mt.updateTriggers,yt=t.id||"sublayer";if(mt){const ft=this.props[mu],Dt=t.type?t.type._propTypes:{};for(const It in mt){const ut=Dt[It]||ft[It];ut&&ut.type==="accessor"&&(mt[It]=this.getSubLayerAccessor(mt[It]))}}Object.assign(st,t,mt),st.id="".concat(this.props.id,"-").concat(yt),st.updateTriggers={all:(e=this.props.updateTriggers)===null||e===void 0?void 0:e.all,...t.updateTriggers,...pt};for(const ft of Q){const Dt=ft.getSubLayerProps.call(this,ft);Dt&&Object.assign(st,Dt,{updateTriggers:Object.assign(st.updateTriggers,Dt.updateTriggers)})}return st}_updateAutoHighlight(t){for(const e of this.getSubLayers())e.updateAutoHighlight(t)}_getAttributeManager(){return null}_postUpdate(t,e){let n=this.internalState.subLayers;const i=!n||this.needsUpdate();if(i){const s=this.renderLayers();n=h0(s,Boolean),this.internalState.subLayers=n}Ao(PK,this,i,n);for(const s of n)s.parent=this}}K(y3,"layerName","CompositeLayer");const xb=512,UK=Math.PI/180;function RK(r){let{map:t,gl:e,deck:n}=r;if(t.__deck)return t.__deck;const i=n==null?void 0:n.props._customRender,s=n==null?void 0:n.props.onLoad,a=OK({...n==null?void 0:n.props,_customRender:()=>{t.triggerRepaint(),i==null||i("")}});let o;return(!n||n.props.gl===e)&&(Object.assign(a,{gl:e,width:null,height:null,touchAction:"unset",viewState:Bb(t)}),n!=null&&n.isInitialized?_3(n,t):a.onLoad=()=>{s==null||s(),_3(o,t)}),n?(o=n,n.setProps(a),n.userData.isExternal=!0):(o=new hb(a),t.on("remove",()=>{DK(t)})),o.userData.mapboxLayers=new Set,t.__deck=o,t.on("render",()=>{o.isInitialized&&GK(o,t)}),o}function _3(r,t){const e=()=>{r.isInitialized?VK(r,t):t.off("move",e)};t.on("move",e)}function DK(r){var t;(t=r.__deck)===null||t===void 0||t.finalize(),r.__deck=null}function OK(r){return{...r,parameters:{depthMask:!0,depthTest:!0,blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthFunc:515,blendEquation:32774,...r.parameters},views:r.views||[new sb({id:"mapbox"})]}}function NK(r,t){r.userData.mapboxLayers.add(t),Cb(r)}function kK(r,t){r.userData.mapboxLayers.delete(t),Cb(r)}function QK(r,t){Cb(r)}function zK(r,t,e){let{currentViewport:n}=r.userData,i=!1;n||(n=v3(r,t,!0),r.userData.currentViewport=n,i=!0),r.isInitialized&&r._drawLayers("mapbox-repaint",{viewports:[n],layerFilter:s=>{let{layer:a}=s;return e.id===a.id||a.props.operation.includes("terrain")},clearStack:i,clearCanvas:!1})}function Bb(r){var t;const{lng:e,lat:n}=r.getCenter(),i={longitude:(e+540)%360-180,latitude:n,zoom:r.getZoom(),bearing:r.getBearing(),pitch:r.getPitch(),padding:r.getPadding(),repeat:r.getRenderWorldCopies()};return(t=r.getTerrain)!==null&&t!==void 0&&t.call(r)&&HK(r,i),i}function HK(r,t){if(r.getFreeCameraOptions){const{position:e}=r.getFreeCameraOptions();if(!e||e.z===void 0)return;const n=r.transform.height,{longitude:i,latitude:s,pitch:a}=t,o=e.x*xb,h=(1-e.y)*xb,f=e.z*xb,g=Rp([i,s]),b=o-g[0],C=h-g[1],B=Math.sqrt(b*b+C*C),R=a*UK,D=1.5*n,Q=R<.001?D*Math.cos(R)/f:D*Math.sin(R)/B;t.zoom=Math.log2(Q);const k=D*Math.cos(R)/Q,j=f-k;t.position=[0,0,j/l0(s)]}else typeof r.transform.elevation=="number"&&(t.position=[0,0,r.transform.elevation])}function v3(r,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return new yh({id:"mapbox",x:0,y:0,width:r.width,height:r.height,...Bb(t),nearZMultiplier:e?.02:.1,nearZ:t.transform._nearZ/t.transform.height,farZ:t.transform._farZ/t.transform.height})}function GK(r,t){const{mapboxLayers:e,isExternal:n}=r.userData;if(n){const i=Array.from(e,g=>g.id),a=h0(r.props.layers,Boolean).some(g=>g&&!i.includes(g.id));let o=r.getViewports();const h=o.findIndex(g=>g.id==="mapbox"),f=o.length>1||h<0;(a||f)&&(h>=0&&(o=o.slice(),o[h]=v3(r,t,!1)),r._drawLayers("mapbox-repaint",{viewports:o,layerFilter:g=>(!r.props.layerFilter||r.props.layerFilter(g))&&(g.viewport.id!=="mapbox"||!i.includes(g.layer.id)),clearCanvas:!1}))}r.userData.currentViewport=null}function VK(r,t){r.setProps({viewState:Bb(t)}),r.needsRedraw({clearRedrawFlags:!0})}function Cb(r){if(r.userData.isExternal)return;const t=[];r.userData.mapboxLayers.forEach(e=>{const n=e.props.type,i=new n(e.props);t.push(i)}),r.setProps({layers:t})}class jK{constructor(t){if(K(this,"id",void 0),K(this,"type",void 0),K(this,"renderingMode",void 0),K(this,"map",void 0),K(this,"deck",void 0),K(this,"props",void 0),!t.id)throw new Error("Layer must have an unique id");this.id=t.id,this.type="custom",this.renderingMode=t.renderingMode||"3d",this.map=null,this.deck=null,this.props=t}onAdd(t,e){this.map=t,this.deck=RK({map:t,gl:e,deck:this.props.deck}),NK(this.deck,this)}onRemove(){this.deck&&kK(this.deck,this)}setProps(t){Object.assign(this.props,t,{id:this.id}),this.deck&&QK(this.deck)}render(){zK(this.deck,this.map,this)}}const qK=`#define SHADER_NAME point-cloud-layer-vertex-shader

attribute vec3 positions;
attribute vec3 instanceNormals;
attribute vec4 instanceColors;
attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute vec3 instancePickingColors;

uniform float opacity;
uniform float radiusPixels;
uniform int sizeUnits;

varying vec4 vColor;
varying vec2 unitPosition;

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.normal = project_normal(instanceNormals);
  unitPosition = positions.xy;
  geometry.uv = unitPosition;
  geometry.pickingColor = instancePickingColors;
  vec3 offset = vec3(positions.xy * project_size_to_pixel(radiusPixels, sizeUnits), 0.0);
  DECKGL_FILTER_SIZE(offset, geometry);

  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
  vColor = vec4(lightColor, instanceColors.a * opacity);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,KK=`#define SHADER_NAME point-cloud-layer-fragment-shader

precision highp float;

varying vec4 vColor;
varying vec2 unitPosition;

void main(void) {
  geometry.uv = unitPosition;

  float distToCenter = length(unitPosition);

  if (distToCenter > 1.0) {
    discard;
  }

  gl_FragColor = vColor;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,b3=[0,0,0,255],w3=[0,0,1],$K={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:r=>r.position},getNormal:{type:"accessor",value:w3},getColor:{type:"accessor",value:b3},material:!0,radiusPixels:{deprecatedFor:"pointSize"}};function WK(r){const{header:t,attributes:e}=r;!t||!e||(r.length=t.vertexCount,e.POSITION&&(e.instancePositions=e.POSITION),e.NORMAL&&(e.instanceNormals=e.NORMAL),e.COLOR_0&&(e.instanceColors=e.COLOR_0))}class Eb extends zd{getShaders(){return super.getShaders({vs:qK,fs:KK,modules:[rb,wG,nb]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:w3},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:b3}})}updateState(t){const{changeFlags:e,props:n}=t;if(super.updateState(t),e.extensionsChanged){var i;const{gl:s}=this.context;(i=this.state.model)===null||i===void 0||i.delete(),this.state.model=this._getModel(s),this.getAttributeManager().invalidateAll()}e.dataChanged&&WK(n.data)}draw(t){let{uniforms:e}=t;const{pointSize:n,sizeUnits:i}=this.props;this.state.model.setUniforms(e).setUniforms({sizeUnits:J_[i],radiusPixels:n}).draw()}_getModel(t){const e=[];for(let n=0;n<3;n++){const i=n/3*Math.PI*2;e.push(Math.cos(i)*2,Math.sin(i)*2,0)}return new Fd(t,{...this.getShaders(),id:this.props.id,geometry:new Pp({drawMode:4,attributes:{positions:new Float32Array(e)}}),isInstanced:!0})}}K(Eb,"layerName","PointCloudLayer"),K(Eb,"defaultProps",$K);const Ua={OUTSIDE:-1,INTERSECTING:0,INSIDE:1};new ue,new ue;const Hp=new ue,x3=new ue;class Gp{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,0],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;K(this,"center",void 0),K(this,"radius",void 0),this.radius=-0,this.center=new ue,this.fromCenterRadius(t,e)}fromCenterRadius(t,e){return this.center.from(t),this.radius=e,this}fromCornerPoints(t,e){return e=Hp.from(e),this.center=new ue().from(t).add(e).scale(.5),this.radius=this.center.distance(e),this}equals(t){return this===t||!!t&&this.center.equals(t.center)&&this.radius===t.radius}clone(){return new Gp(this.center,this.radius)}union(t){const e=this.center,n=this.radius,i=t.center,s=t.radius,a=Hp.copy(i).subtract(e),o=a.magnitude();if(n>=o+s)return this.clone();if(s>=o+n)return t.clone();const h=(n+o+s)*.5;return x3.copy(a).scale((-n+h)/o).add(e),this.center.copy(x3),this.radius=h,this}expand(t){const n=Hp.from(t).subtract(this.center).magnitude();return n>this.radius&&(this.radius=n),this}transform(t){this.center.transform(t);const e=M7(Hp,t);return this.radius=Math.max(e[0],Math.max(e[1],e[2]))*this.radius,this}distanceSquaredTo(t){const e=this.distanceTo(t);return e*e}distanceTo(t){const n=Hp.from(t).subtract(this.center);return Math.max(0,n.len()-this.radius)}intersectPlane(t){const e=this.center,n=this.radius,s=t.normal.dot(e)+t.distance;return s<-n?Ua.OUTSIDE:s<n?Ua.INTERSECTING:Ua.INSIDE}}const XK=new ue,JK=new ue,_0=new ue,v0=new ue,b0=new ue,YK=new ue,ZK=new ue,EA={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class Vp{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,0],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0,0,0,0,0,0,0];K(this,"center",void 0),K(this,"halfAxes",void 0),this.center=new ue().from(t),this.halfAxes=new Ni(e)}get halfSize(){const t=this.halfAxes.getColumn(0),e=this.halfAxes.getColumn(1),n=this.halfAxes.getColumn(2);return[new ue(t).len(),new ue(e).len(),new ue(n).len()]}get quaternion(){const t=this.halfAxes.getColumn(0),e=this.halfAxes.getColumn(1),n=this.halfAxes.getColumn(2),i=new ue(t).normalize(),s=new ue(e).normalize(),a=new ue(n).normalize();return new Lp().fromMatrix3(new Ni([...i,...s,...a]))}fromCenterHalfSizeQuaternion(t,e,n){const i=new Lp(n),s=new Ni().fromQuaternion(i);return s[0]=s[0]*e[0],s[1]=s[1]*e[0],s[2]=s[2]*e[0],s[3]=s[3]*e[1],s[4]=s[4]*e[1],s[5]=s[5]*e[1],s[6]=s[6]*e[2],s[7]=s[7]*e[2],s[8]=s[8]*e[2],this.center=new ue().from(t),this.halfAxes=s,this}clone(){return new Vp(this.center,this.halfAxes)}equals(t){return this===t||!!t&&this.center.equals(t.center)&&this.halfAxes.equals(t.halfAxes)}getBoundingSphere(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:new Gp;const e=this.halfAxes,n=e.getColumn(0,_0),i=e.getColumn(1,v0),s=e.getColumn(2,b0),a=XK.copy(n).add(i).add(s);return t.center.copy(this.center),t.radius=a.magnitude(),t}intersectPlane(t){const e=this.center,n=t.normal,i=this.halfAxes,s=n.x,a=n.y,o=n.z,h=Math.abs(s*i[EA.COLUMN0ROW0]+a*i[EA.COLUMN0ROW1]+o*i[EA.COLUMN0ROW2])+Math.abs(s*i[EA.COLUMN1ROW0]+a*i[EA.COLUMN1ROW1]+o*i[EA.COLUMN1ROW2])+Math.abs(s*i[EA.COLUMN2ROW0]+a*i[EA.COLUMN2ROW1]+o*i[EA.COLUMN2ROW2]),f=n.dot(e)+t.distance;return f<=-h?Ua.OUTSIDE:f>=h?Ua.INSIDE:Ua.INTERSECTING}distanceTo(t){return Math.sqrt(this.distanceSquaredTo(t))}distanceSquaredTo(t){const e=JK.from(t).subtract(this.center),n=this.halfAxes,i=n.getColumn(0,_0),s=n.getColumn(1,v0),a=n.getColumn(2,b0),o=i.magnitude(),h=s.magnitude(),f=a.magnitude();i.normalize(),s.normalize(),a.normalize();let g=0,b;return b=Math.abs(e.dot(i))-o,b>0&&(g+=b*b),b=Math.abs(e.dot(s))-h,b>0&&(g+=b*b),b=Math.abs(e.dot(a))-f,b>0&&(g+=b*b),g}computePlaneDistances(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[-0,-0],i=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY;const a=this.center,o=this.halfAxes,h=o.getColumn(0,_0),f=o.getColumn(1,v0),g=o.getColumn(2,b0),b=YK.copy(h).add(f).add(g).add(a),C=ZK.copy(b).subtract(t);let B=e.dot(C);return i=Math.min(B,i),s=Math.max(B,s),b.copy(a).add(h).add(f).subtract(g),C.copy(b).subtract(t),B=e.dot(C),i=Math.min(B,i),s=Math.max(B,s),b.copy(a).add(h).subtract(f).add(g),C.copy(b).subtract(t),B=e.dot(C),i=Math.min(B,i),s=Math.max(B,s),b.copy(a).add(h).subtract(f).subtract(g),C.copy(b).subtract(t),B=e.dot(C),i=Math.min(B,i),s=Math.max(B,s),a.copy(b).subtract(h).add(f).add(g),C.copy(b).subtract(t),B=e.dot(C),i=Math.min(B,i),s=Math.max(B,s),a.copy(b).subtract(h).add(f).subtract(g),C.copy(b).subtract(t),B=e.dot(C),i=Math.min(B,i),s=Math.max(B,s),a.copy(b).subtract(h).subtract(f).add(g),C.copy(b).subtract(t),B=e.dot(C),i=Math.min(B,i),s=Math.max(B,s),a.copy(b).subtract(h).subtract(f).subtract(g),C.copy(b).subtract(t),B=e.dot(C),i=Math.min(B,i),s=Math.max(B,s),n[0]=i,n[1]=s,n}transform(t){this.center.transformAsPoint(t);const e=this.halfAxes.getColumn(0,_0);e.transformAsPoint(t);const n=this.halfAxes.getColumn(1,v0);n.transformAsPoint(t);const i=this.halfAxes.getColumn(2,b0);return i.transformAsPoint(t),this.halfAxes=new Ni([...e,...n,...i]),this}getTransform(){throw new Error("not implemented")}}const B3=new ue,C3=new ue;class Uc{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,1],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;K(this,"normal",void 0),K(this,"distance",void 0),this.normal=new ue,this.distance=-0,this.fromNormalDistance(t,e)}fromNormalDistance(t,e){return Lc(Number.isFinite(e)),this.normal.from(t).normalize(),this.distance=e,this}fromPointNormal(t,e){t=B3.from(t),this.normal.from(e).normalize();const n=-this.normal.dot(t);return this.distance=n,this}fromCoefficients(t,e,n,i){return this.normal.set(t,e,n),Lc(Fc(this.normal.len(),1)),this.distance=i,this}clone(){return new Uc(this.normal,this.distance)}equals(t){return Fc(this.distance,t.distance)&&Fc(this.normal,t.normal)}getPointDistance(t){return this.normal.dot(t)+this.distance}transform(t){const e=C3.copy(this.normal).transformAsVector(t).normalize(),n=this.normal.scale(-this.distance).transform(t);return this.fromPointNormal(n,e)}projectPointOntoPlane(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];t=B3.from(t);const n=this.getPointDistance(t),i=C3.copy(this.normal).scale(n);return t.subtract(i).to(e)}}const E3=[new ue([1,0,0]),new ue([0,1,0]),new ue([0,0,1])],S3=new ue,t$=new ue;new Uc(new ue(1,0,0),0);class rc{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];K(this,"planes",void 0),this.planes=t}fromBoundingSphere(t){this.planes.length=2*E3.length;const e=t.center,n=t.radius;let i=0;for(const s of E3){let a=this.planes[i],o=this.planes[i+1];a||(a=this.planes[i]=new Uc),o||(o=this.planes[i+1]=new Uc);const h=S3.copy(s).scale(-n).add(e);-s.dot(h),a.fromPointNormal(h,s);const f=S3.copy(s).scale(n).add(e),g=t$.copy(s).negate();-g.dot(f),o.fromPointNormal(f,g),i+=2}return this}computeVisibility(t){let e=Ua.INSIDE;for(const n of this.planes)switch(t.intersectPlane(n)){case Ua.OUTSIDE:return Ua.OUTSIDE;case Ua.INTERSECTING:e=Ua.INTERSECTING;break}return e}computeVisibilityWithPlaneMask(t,e){if(Lc(Number.isFinite(e),"parentPlaneMask is required."),e===rc.MASK_OUTSIDE||e===rc.MASK_INSIDE)return e;let n=rc.MASK_INSIDE;const i=this.planes;for(let s=0;s<this.planes.length;++s){const a=s<31?1<<s:0;if(s<31&&!(e&a))continue;const o=i[s],h=t.intersectPlane(o);if(h===Ua.OUTSIDE)return rc.MASK_OUTSIDE;h===Ua.INTERSECTING&&(n|=a)}return n}}K(rc,"MASK_OUTSIDE",4294967295),K(rc,"MASK_INSIDE",0),K(rc,"MASK_INDETERMINATE",2147483647),new ue,new ue,new ue,new ue,new ue,new ue,new ue,new ue,new ue,new ue,new ue,new ue,new ue,new ue,new ue,new ue,new ue;const Fl=new Ni,e$=new Ni,r$=new Ni,w0=new Ni,T3=new Ni;function n$(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const e=Fp.EPSILON20,n=10;let i=0,s=0;const a=e$,o=r$;a.identity(),o.copy(r);const h=e*i$(o);for(;s<n&&s$(o)>h;)o$(o,w0),T3.copy(w0).transpose(),o.multiplyRight(w0),o.multiplyLeft(T3),a.multiplyRight(w0),++i>2&&(++s,i=0);return t.unitary=a.toTarget(t.unitary),t.diagonal=o.toTarget(t.diagonal),t}function i$(r){let t=0;for(let e=0;e<9;++e){const n=r[e];t+=n*n}return Math.sqrt(t)}const Sb=[1,0,0],Tb=[2,2,1];function s$(r){let t=0;for(let e=0;e<3;++e){const n=r[Fl.getElementIndex(Tb[e],Sb[e])];t+=2*n*n}return Math.sqrt(t)}function o$(r,t){const e=Fp.EPSILON15;let n=0,i=1;for(let f=0;f<3;++f){const g=Math.abs(r[Fl.getElementIndex(Tb[f],Sb[f])]);g>n&&(i=f,n=g)}const s=Sb[i],a=Tb[i];let o=1,h=0;if(Math.abs(r[Fl.getElementIndex(a,s)])>e){const f=r[Fl.getElementIndex(a,a)],g=r[Fl.getElementIndex(s,s)],b=r[Fl.getElementIndex(a,s)],C=(f-g)/2/b;let B;C<0?B=-1/(-C+Math.sqrt(1+C*C)):B=1/(C+Math.sqrt(1+C*C)),o=1/Math.sqrt(1+B*B),h=B*o}return Ni.IDENTITY.to(t),t[Fl.getElementIndex(s,s)]=t[Fl.getElementIndex(a,a)]=o,t[Fl.getElementIndex(a,s)]=h,t[Fl.getElementIndex(s,a)]=-h,t}const wu=new ue,a$=new ue,c$=new ue,l$=new ue,A$=new ue,u$=new Ni,h$={diagonal:new Ni,unitary:new Ni};function d$(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Vp;if(!r||r.length===0)return t.halfAxes=new Ni([0,0,0,0,0,0,0,0,0]),t.center=new ue,t;const e=r.length,n=new ue(0,0,0);for(const Dt of r)n.add(Dt);const i=1/e;n.multiplyByScalar(i);let s=0,a=0,o=0,h=0,f=0,g=0;for(const Dt of r){const It=wu.copy(Dt).subtract(n);s+=It.x*It.x,a+=It.x*It.y,o+=It.x*It.z,h+=It.y*It.y,f+=It.y*It.z,g+=It.z*It.z}s*=i,a*=i,o*=i,h*=i,f*=i,g*=i;const b=u$;b[0]=s,b[1]=a,b[2]=o,b[3]=a,b[4]=h,b[5]=f,b[6]=o,b[7]=f,b[8]=g;const{unitary:C}=n$(b,h$),B=t.halfAxes.copy(C);let R=B.getColumn(0,c$),D=B.getColumn(1,l$),Q=B.getColumn(2,A$),k=-Number.MAX_VALUE,j=-Number.MAX_VALUE,et=-Number.MAX_VALUE,st=Number.MAX_VALUE,mt=Number.MAX_VALUE,pt=Number.MAX_VALUE;for(const Dt of r)wu.copy(Dt),k=Math.max(wu.dot(R),k),j=Math.max(wu.dot(D),j),et=Math.max(wu.dot(Q),et),st=Math.min(wu.dot(R),st),mt=Math.min(wu.dot(D),mt),pt=Math.min(wu.dot(Q),pt);R=R.multiplyByScalar(.5*(st+k)),D=D.multiplyByScalar(.5*(mt+j)),Q=Q.multiplyByScalar(.5*(pt+et)),t.center.copy(R).add(D).add(Q);const yt=a$.set(k-st,j-mt,et-pt).multiplyByScalar(.5),ft=new Ni([yt[0],0,0,0,yt[1],0,0,0,yt[2]]);return t.halfAxes.multiplyRight(ft),t}const Ib=Math.PI/180,x0=new Float32Array(16),I3=new Float32Array(12);function L3(r,t,e){const n=t[0]*Ib,i=t[1]*Ib,s=t[2]*Ib,a=Math.sin(s),o=Math.sin(n),h=Math.sin(i),f=Math.cos(s),g=Math.cos(n),b=Math.cos(i),C=e[0],B=e[1],R=e[2];r[0]=C*b*g,r[1]=C*h*g,r[2]=C*-o,r[3]=B*(-h*f+b*o*a),r[4]=B*(b*f+h*o*a),r[5]=B*g*a,r[6]=R*(h*a+b*o*f),r[7]=R*(-b*a+h*o*f),r[8]=R*g*f}function F3(r){return r[0]=r[0],r[1]=r[1],r[2]=r[2],r[3]=r[4],r[4]=r[5],r[5]=r[6],r[6]=r[8],r[7]=r[9],r[8]=r[10],r[9]=r[12],r[10]=r[13],r[11]=r[14],r.subarray(0,12)}const M3={size:12,accessor:["getOrientation","getScale","getTranslation","getTransformMatrix"],shaderAttributes:{instanceModelMatrix__LOCATION_0:{size:3,elementOffset:0},instanceModelMatrix__LOCATION_1:{size:3,elementOffset:3},instanceModelMatrix__LOCATION_2:{size:3,elementOffset:6},instanceTranslation:{size:3,elementOffset:9}},update(r,t){let{startRow:e,endRow:n}=t;const{data:i,getOrientation:s,getScale:a,getTranslation:o,getTransformMatrix:h}=this.props,f=Array.isArray(h),g=f&&h.length===16,b=Array.isArray(a),C=Array.isArray(s),B=Array.isArray(o),R=g||!f&&!!h(i[0]);R?r.constant=g:r.constant=C&&b&&B;const D=r.value;if(r.constant){let Q;R?(x0.set(h),Q=F3(x0)):(Q=I3,L3(Q,s,a),Q.set(o,9)),r.value=new Float32Array(Q)}else{let Q=e*r.size;const{iterable:k,objectInfo:j}=n3(i,e,n);for(const et of k){j.index++;let st;if(R)x0.set(g?h:h(et,j)),st=F3(x0);else{st=I3;const mt=C?s:s(et,j),pt=b?a:a(et,j);L3(st,mt,pt),st.set(B?o:o(et,j),9)}D[Q++]=st[0],D[Q++]=st[1],D[Q++]=st[2],D[Q++]=st[3],D[Q++]=st[4],D[Q++]=st[5],D[Q++]=st[6],D[Q++]=st[7],D[Q++]=st[8],D[Q++]=st[9],D[Q++]=st[10],D[Q++]=st[11]}}}};function P3(r,t){return t===En.CARTESIAN||t===En.METER_OFFSETS||t===En.DEFAULT&&!r.isGeospatial}const f$=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
uniform float sizeScale;
uniform bool composeModelMatrix;
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
in vec3 instanceTranslation;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = texCoords;
  geometry.pickingColor = instancePickingColors;

  vTexCoord = texCoords;
  cameraPosition = project_uCameraPosition;
  vColor = vec4(colors * instanceColors.rgb, instanceColors.a);

  vec3 pos = (instanceModelMatrix * positions) * sizeScale + instanceTranslation;

  if (composeModelMatrix) {
    DECKGL_FILTER_SIZE(pos, geometry);
    normals_commonspace = project_normal(instanceModelMatrix * normals);
    geometry.worldPosition += pos;
    gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), position_commonspace);
    geometry.position = position_commonspace;
  }
  else {
    pos = project_size(pos);
    DECKGL_FILTER_SIZE(pos, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, position_commonspace);
    geometry.position = position_commonspace;
    normals_commonspace = project_normal(instanceModelMatrix * normals);
  }

  geometry.normal = normals_commonspace;
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,p$=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs

precision highp float;

uniform bool hasTexture;
uniform sampler2D sampler;
uniform bool flatShading;
uniform float opacity;

in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;

out vec4 fragColor;

void main(void) {
  geometry.uv = vTexCoord;

  vec3 normal;
  if (flatShading) {
#ifdef DERIVATIVES_AVAILABLE
    normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
#else
    normal = vec3(0.0, 0.0, 1.0);
#endif
  } else {
    normal = normals_commonspace;
  }

  vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;
  DECKGL_FILTER_COLOR(color, geometry);

  vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
  fragColor = vec4(lightColor, color.a * opacity);
}
`;function U3(r){let t=1/0,e=1/0,n=1/0,i=-1/0,s=-1/0,a=-1/0;const o=r.POSITION?r.POSITION.value:[],h=o&&o.length;for(let f=0;f<h;f+=3){const g=o[f],b=o[f+1],C=o[f+2];t=g<t?g:t,e=b<e?b:e,n=C<n?C:n,i=g>i?g:i,s=b>s?b:s,a=C>a?C:a}return[[t,e,n],[i,s,a]]}function g$(r,t){if(!r)throw new Error(t||"loader assertion failed.")}class Hd{constructor(t,e){K(this,"fields",void 0),K(this,"metadata",void 0),g$(Array.isArray(t)),m$(t),this.fields=t,this.metadata=e||new Map}compareTo(t){if(this.metadata!==t.metadata||this.fields.length!==t.fields.length)return!1;for(let e=0;e<this.fields.length;++e)if(!this.fields[e].compareTo(t.fields[e]))return!1;return!0}select(){const t=Object.create(null);for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];for(const a of n)t[a]=!0;const s=this.fields.filter(a=>t[a.name]);return new Hd(s,this.metadata)}selectAt(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=e.map(s=>this.fields[s]).filter(Boolean);return new Hd(i,this.metadata)}assign(t){let e,n=this.metadata;if(t instanceof Hd){const a=t;e=a.fields,n=R3(R3(new Map,this.metadata),a.metadata)}else e=t;const i=Object.create(null);for(const a of this.fields)i[a.name]=a;for(const a of e)i[a.name]=a;const s=Object.values(i);return new Hd(s,n)}}function m$(r){const t={};for(const e of r)t[e.name]&&console.warn("Schema: duplicated field name",e.name,e),t[e.name]=!0}function R3(r,t){return new Map([...r||new Map,...t||new Map])}class B0{constructor(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:new Map;K(this,"name",void 0),K(this,"type",void 0),K(this,"nullable",void 0),K(this,"metadata",void 0),this.name=t,this.type=e,this.nullable=n,this.metadata=i}get typeId(){return this.type&&this.type.typeId}clone(){return new B0(this.name,this.type,this.nullable,this.metadata)}compareTo(t){return this.name===t.name&&this.type===t.type&&this.nullable===t.nullable&&this.metadata===t.metadata}toString(){return"".concat(this.type).concat(this.nullable?", nullable":"").concat(this.metadata?", metadata: ".concat(this.metadata):"")}}let ki=function(r){return r[r.NONE=0]="NONE",r[r.Null=1]="Null",r[r.Int=2]="Int",r[r.Float=3]="Float",r[r.Binary=4]="Binary",r[r.Utf8=5]="Utf8",r[r.Bool=6]="Bool",r[r.Decimal=7]="Decimal",r[r.Date=8]="Date",r[r.Time=9]="Time",r[r.Timestamp=10]="Timestamp",r[r.Interval=11]="Interval",r[r.List=12]="List",r[r.Struct=13]="Struct",r[r.Union=14]="Union",r[r.FixedSizeBinary=15]="FixedSizeBinary",r[r.FixedSizeList=16]="FixedSizeList",r[r.Map=17]="Map",r[r.Dictionary=-1]="Dictionary",r[r.Int8=-2]="Int8",r[r.Int16=-3]="Int16",r[r.Int32=-4]="Int32",r[r.Int64=-5]="Int64",r[r.Uint8=-6]="Uint8",r[r.Uint16=-7]="Uint16",r[r.Uint32=-8]="Uint32",r[r.Uint64=-9]="Uint64",r[r.Float16=-10]="Float16",r[r.Float32=-11]="Float32",r[r.Float64=-12]="Float64",r[r.DateDay=-13]="DateDay",r[r.DateMillisecond=-14]="DateMillisecond",r[r.TimestampSecond=-15]="TimestampSecond",r[r.TimestampMillisecond=-16]="TimestampMillisecond",r[r.TimestampMicrosecond=-17]="TimestampMicrosecond",r[r.TimestampNanosecond=-18]="TimestampNanosecond",r[r.TimeSecond=-19]="TimeSecond",r[r.TimeMillisecond=-20]="TimeMillisecond",r[r.TimeMicrosecond=-21]="TimeMicrosecond",r[r.TimeNanosecond=-22]="TimeNanosecond",r[r.DenseUnion=-23]="DenseUnion",r[r.SparseUnion=-24]="SparseUnion",r[r.IntervalDayTime=-25]="IntervalDayTime",r[r.IntervalYearMonth=-26]="IntervalYearMonth",r}({}),D3,O3,N3;class Lb{static isNull(t){return t&&t.typeId===ki.Null}static isInt(t){return t&&t.typeId===ki.Int}static isFloat(t){return t&&t.typeId===ki.Float}static isBinary(t){return t&&t.typeId===ki.Binary}static isUtf8(t){return t&&t.typeId===ki.Utf8}static isBool(t){return t&&t.typeId===ki.Bool}static isDecimal(t){return t&&t.typeId===ki.Decimal}static isDate(t){return t&&t.typeId===ki.Date}static isTime(t){return t&&t.typeId===ki.Time}static isTimestamp(t){return t&&t.typeId===ki.Timestamp}static isInterval(t){return t&&t.typeId===ki.Interval}static isList(t){return t&&t.typeId===ki.List}static isStruct(t){return t&&t.typeId===ki.Struct}static isUnion(t){return t&&t.typeId===ki.Union}static isFixedSizeBinary(t){return t&&t.typeId===ki.FixedSizeBinary}static isFixedSizeList(t){return t&&t.typeId===ki.FixedSizeList}static isMap(t){return t&&t.typeId===ki.Map}static isDictionary(t){return t&&t.typeId===ki.Dictionary}get typeId(){return ki.NONE}compareTo(t){return this===t}}D3=Symbol.toStringTag;class Gd extends Lb{constructor(t,e){super(),K(this,"isSigned",void 0),K(this,"bitWidth",void 0),this.isSigned=t,this.bitWidth=e}get typeId(){return ki.Int}get[D3](){return"Int"}toString(){return"".concat(this.isSigned?"I":"Ui","nt").concat(this.bitWidth)}}class y$ extends Gd{constructor(){super(!0,8)}}class _$ extends Gd{constructor(){super(!0,16)}}class v$ extends Gd{constructor(){super(!0,32)}}class b$ extends Gd{constructor(){super(!1,8)}}class w$ extends Gd{constructor(){super(!1,16)}}class x$ extends Gd{constructor(){super(!1,32)}}const k3={HALF:16,SINGLE:32,DOUBLE:64};O3=Symbol.toStringTag;class Q3 extends Lb{constructor(t){super(),K(this,"precision",void 0),this.precision=t}get typeId(){return ki.Float}get[O3](){return"Float"}toString(){return"Float".concat(this.precision)}}class B$ extends Q3{constructor(){super(k3.SINGLE)}}class C$ extends Q3{constructor(){super(k3.DOUBLE)}}N3=Symbol.toStringTag;class E$ extends Lb{constructor(t,e){super(),K(this,"listSize",void 0),K(this,"children",void 0),this.listSize=t,this.children=[e]}get typeId(){return ki.FixedSizeList}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get[N3](){return"FixedSizeList"}toString(){return"FixedSizeList[".concat(this.listSize,"]<").concat(this.valueType,">")}}function S$(r){switch(r.constructor){case Int8Array:return new y$;case Uint8Array:return new b$;case Int16Array:return new _$;case Uint16Array:return new w$;case Int32Array:return new v$;case Uint32Array:return new x$;case Float32Array:return new B$;case Float64Array:return new C$;default:throw new Error("array type not supported")}}function T$(r,t,e){const n=S$(t.value),i=e||I$(t);return new B0(r,new E$(t.size,new B0("value",n)),!1,i)}function I$(r){const t=new Map;return"byteOffset"in r&&t.set("byteOffset",r.byteOffset.toString(10)),"byteStride"in r&&t.set("byteStride",r.byteStride.toString(10)),"normalized"in r&&t.set("normalized",r.normalized.toString()),t}function z3(r,t){(r.COLOR_0||r.colors)&&t||(r.colors={constant:!0,value:new Float32Array([1,1,1])}),Ln.assert(r.positions||r.POSITION,'no "postions" or "POSITION" attribute in mesh')}function H3(r,t){if(r.attributes)return z3(r.attributes,t),r instanceof Pp?r:new Pp(r);if(r.positions||r.POSITION)return z3(r,t),new Pp({attributes:r});throw Error("Invalid mesh")}const L$={mesh:{type:"object",value:null,async:!0},texture:{type:"image",value:null,async:!0},sizeScale:{type:"number",value:1,min:0},_useMeshColors:{type:"boolean",value:!1},_instanced:!0,wireframe:!1,material:!0,getPosition:{type:"accessor",value:r=>r.position},getColor:{type:"accessor",value:[0,0,0,255]},getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},textureParameters:{type:"object",ignore:!0}};class Fb extends zd{constructor(){super(...arguments),K(this,"state",void 0)}getShaders(){const t=!yn(this.context.gl),e={};return hv(this.context.gl,gi.GLSL_DERIVATIVES)&&(e.DERIVATIVES_AVAILABLE=1),super.getShaders({vs:f$,fs:p$,modules:[rb,xG,nb],transpileToGLSL100:t,defines:e})}getBounds(){var t;if(this.props._instanced)return super.getBounds();let e=this.state.positionBounds;if(e)return e;const{mesh:n}=this.props;if(!n)return null;if(e=(t=n.header)===null||t===void 0?void 0:t.boundingBox,!e){const{attributes:i}=H3(n,this.props._useMeshColors);i.POSITION=i.POSITION||i.positions,e=U3(i)}return this.state.positionBounds=e,e}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{transition:!0,type:5130,fp64:this.use64bitPositions(),size:3,accessor:"getPosition"},instanceColors:{type:5121,transition:!0,size:this.props.colorFormat.length,normalized:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceModelMatrix:M3}),this.setState({emptyTexture:new La(this.context.gl,{data:new Uint8Array(4),width:1,height:1})})}updateState(t){super.updateState(t);const{props:e,oldProps:n,changeFlags:i}=t;if(e.mesh!==n.mesh||i.extensionsChanged){var s;if(this.state.positionBounds=null,(s=this.state.model)===null||s===void 0||s.delete(),e.mesh){this.state.model=this.getModel(e.mesh);const a=e.mesh.attributes||e.mesh;this.setState({hasNormals:!!(a.NORMAL||a.normals)})}this.getAttributeManager().invalidateAll()}e.texture!==n.texture&&this.setTexture(e.texture),this.state.model&&this.state.model.setDrawMode(this.props.wireframe?3:4)}finalizeState(t){super.finalizeState(t),this.state.emptyTexture.delete()}draw(t){let{uniforms:e}=t;if(!this.state.model)return;const{viewport:n}=this.context,{sizeScale:i,coordinateSystem:s,_instanced:a}=this.props;this.state.model.setUniforms(e).setUniforms({sizeScale:i,composeModelMatrix:!a||P3(n,s),flatShading:!this.state.hasNormals}).draw()}get isLoaded(){var t;return((t=this.state)===null||t===void 0?void 0:t.model)&&super.isLoaded}getModel(t){const e=new Fd(this.context.gl,{...this.getShaders(),id:this.props.id,geometry:H3(t,this.props._useMeshColors),isInstanced:!0}),{texture:n}=this.props,{emptyTexture:i}=this.state;return e.setUniforms({sampler:n||i,hasTexture:!!n}),e}setTexture(t){const{emptyTexture:e,model:n}=this.state;n&&n.setUniforms({sampler:t||e,hasTexture:!!t})}}K(Fb,"defaultProps",L$),K(Fb,"layerName","SimpleMeshLayer");class Vd{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:e}=t;this.id=e||vA(this.constructor.name),this.display=!0,this.position=new ue,this.rotation=new ue,this.scale=new ue(1,1,1),this.matrix=new Cn,this.userData={},this.props={},this._setScenegraphNodeProps(t)}delete(){}setProps(t){return this._setScenegraphNodeProps(t),this}toString(){return"{type: ScenegraphNode, id: ".concat(this.id,")}")}getBounds(){return null}setPosition(t){return Ar(t.length===3,"setPosition requires vector argument"),this.position=t,this}setRotation(t){return Ar(t.length===3,"setRotation requires vector argument"),this.rotation=t,this}setScale(t){return Ar(t.length===3,"setScale requires vector argument"),this.scale=t,this}setMatrix(t){(arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0)?this.matrix.copy(t):this.matrix=t}setMatrixComponents(t){let{position:e,rotation:n,scale:i,update:s=!0}=t;return e&&this.setPosition(e),n&&this.setRotation(n),i&&this.setScale(i),s&&this.updateMatrix(),this}updateMatrix(){const t=this.position,e=this.rotation,n=this.scale;return this.matrix.identity(),this.matrix.translate(t),this.matrix.rotateXYZ(e),this.matrix.scale(n),this}update(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{position:e,rotation:n,scale:i}=t;return e&&this.setPosition(e),n&&this.setRotation(n),i&&this.setScale(i),this.updateMatrix(),this}getCoordinateUniforms(t,e){Ar(t),e=e||this.matrix;const n=new Cn(t).multiplyRight(e),i=n.invert(),s=i.transpose();return{viewMatrix:t,modelMatrix:e,objectMatrix:e,worldMatrix:n,worldInverseMatrix:i,worldInverseTransposeMatrix:s}}_setScenegraphNodeProps(t){"display"in t&&(this.display=t.display),"position"in t&&this.setPosition(t.position),"rotation"in t&&this.setRotation(t.rotation),"scale"in t&&this.setScale(t.scale),"matrix"in t&&this.setMatrix(t.matrix),Object.assign(this.props,t)}}class jp extends Vd{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};t=Array.isArray(t)?{children:t}:t;const{children:e=[]}=t;Cr.assert(e.every(n=>n instanceof Vd),"every child must an instance of ScenegraphNode"),super(t),this.children=e}add(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(const i of e)Array.isArray(i)?this.add(...i):this.children.push(i);return this}remove(t){const e=this.children,n=e.indexOf(t);return n>-1&&e.splice(n,1),this}removeAll(){return this.children=[],this}delete(){this.children.forEach(t=>t.delete()),this.removeAll(),super.delete()}getBounds(){const t=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]];return this.traverse((e,n)=>{let{worldMatrix:i}=n;const s=e.getBounds();if(!s)return;const[a,o]=s,h=new ue(a).add(o).divide([2,2,2]);i.transformAsPoint(h,h);const f=new ue(o).subtract(a).divide([2,2,2]);i.transformAsVector(f,f);for(let g=0;g<8;g++){const b=new ue(g&1?-1:1,g&2?-1:1,g&4?-1:1).multiply(f).add(h);for(let C=0;C<3;C++)t[0][C]=Math.min(t[0][C],b[C]),t[1][C]=Math.max(t[1][C],b[C])}}),Number.isFinite(t[0][0])?t:null}traverse(t){let{worldMatrix:e=new Cn}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=new Cn(e).multiplyRight(this.matrix);for(const i of this.children)i instanceof jp?i.traverse(t,{worldMatrix:n}):t(i,{worldMatrix:n})}}const F$={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},M$={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function G3(r){if(!r._animation){const t=M$[r.componentType],e=F$[r.type],n=e*r.count,{buffer:i,byteOffset:s}=r.bufferView.data,a=new t(i,s+(r.byteOffset||0),n);if(e===1)r._animation=Array.from(a);else{const o=[];for(let h=0;h<a.length;h+=e)o.push(Array.from(a.slice(h,h+e)));r._animation=o}}return r._animation}const P$=new Cn;function U$(r,t){if(t.matrix.identity(),r.translation&&t.matrix.translate(r.translation),r.rotation){const e=P$.fromQuaternion(r.rotation);t.matrix.multiplyRight(e)}r.scale&&t.matrix.scale(r.scale)}const Mb=new Lp;function R$(r,t,e,n,i){if(t==="rotation"){Mb.slerp({start:e,target:n,ratio:i});for(let s=0;s<Mb.length;s++)r[t][s]=Mb[s]}else for(let s=0;s<e.length;s++)r[t][s]=i*n[s]+(1-i)*e[s]}function D$(r,t,e){let{p0:n,outTangent0:i,inTangent1:s,p1:a,tDiff:o,ratio:h}=e;for(let f=0;f<r[t].length;f++){const g=i[f]*o,b=s[f]*o;r[t][f]=(2*Math.pow(h,3)-3*Math.pow(h,2)+1)*n[f]+(Math.pow(h,3)-2*Math.pow(h,2)+h)*g+(-2*Math.pow(h,3)+3*Math.pow(h,2))*a[f]+(Math.pow(h,3)-Math.pow(h,2))*b}}function O$(r,t,e){for(let n=0;n<e.length;n++)r[t][n]=e[n]}function N$(r,t,e,n){let{input:i,interpolation:s,output:a}=t;const o=i[i.length-1],h=r%o,f=i.findIndex(B=>B>=h),g=Math.max(0,f-1);if(!Array.isArray(e[n]))switch(n){case"translation":e[n]=[0,0,0];break;case"rotation":e[n]=[0,0,0,1];break;case"scale":e[n]=[1,1,1];break;default:Cr.warn("Bad animation path ".concat(n))()}Ar(e[n].length===a[g].length);const b=i[g],C=i[f];switch(s){case"STEP":O$(e,n,a[g]);break;case"LINEAR":if(C>b){const B=(h-b)/(C-b);R$(e,n,a[g],a[f],B)}break;case"CUBICSPLINE":if(C>b){const B=(h-b)/(C-b),R=C-b,D=a[3*g+1],Q=a[3*g+2],k=a[3*f+0],j=a[3*f+1];D$(e,n,{p0:D,outTangent0:Q,inTangent1:k,p1:j,tDiff:R,ratio:B})}break;default:Cr.warn("Interpolation ".concat(s," not supported"))();break}}class k${constructor(t){this.startTime=0,this.playing=!0,this.speed=1,this.channels=[],Object.assign(this,t)}animate(t){if(!this.playing)return;const n=(t/1e3-this.startTime)*this.speed;this.channels.forEach(i=>{let{sampler:s,target:a,path:o}=i;N$(n,s,a,o),U$(a,a._node)})}}class Q${constructor(t){this.animations=t.animations.map((e,n)=>{const i=e.name||"Animation-".concat(n),s=e.samplers.map(o=>{let{input:h,interpolation:f="LINEAR",output:g}=o;return{input:G3(t.accessors[h]),interpolation:f,output:G3(t.accessors[g])}}),a=e.channels.map(o=>{let{sampler:h,target:f}=o;return{sampler:s[h],target:t.nodes[f.node],path:f.path}});return new k$({name:i,channels:a})})}animate(t){this.setTime(t)}setTime(t){this.animations.forEach(e=>e.animate(t))}getAnimations(){return this.animations}}class z$ extends Vd{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e),this.onBeforeRender=null,this.AfterRender=null,t instanceof Fd?(this.model=t,this._setModelNodeProps(e)):this.model=new Fd(t,e),this.bounds=null,this.managedResources=e.managedResources||[]}setProps(t){return super.setProps(t),this._setModelNodeProps(t),this}getBounds(){return this.bounds}delete(){this.model&&(this.model.delete(),this.model=null),this.managedResources.forEach(t=>t.delete()),this.managedResources=[]}draw(){return this.model.draw(...arguments)}setUniforms(){return this.model.setUniforms(...arguments),this}setAttributes(){return this.model.setAttributes(...arguments),this}updateModuleSettings(){return this.model.updateModuleSettings(...arguments),this}_setModelNodeProps(t){this.model.setProps(t)}}class V3{constructor(t,e){let{attributes:n,material:i,pbrDebug:s,imageBasedLightingEnvironment:a,lights:o,useTangents:h}=e;this.gl=t,this.defines={MANUAL_SRGB:1,SRGB_FAST_APPROXIMATION:1},hv(t,gi.GLSL_TEXTURE_LOD)&&(this.defines.USE_TEX_LOD=1),this.uniforms={u_Camera:[0,0,0],u_MetallicRoughnessValues:[1,1]},this.parameters={},this.generatedTextures=[],a&&(this.uniforms.u_DiffuseEnvSampler=a.getDiffuseEnvSampler(),this.uniforms.u_SpecularEnvSampler=a.getSpecularEnvSampler(),this.uniforms.u_brdfLUT=a.getBrdfTexture(),this.uniforms.u_ScaleIBLAmbient=[1,1]),s&&(this.uniforms.u_ScaleDiffBaseMR=[0,0,0,0],this.uniforms.u_ScaleFGDSpec=[0,0,0,0]),this.defineIfPresent(n.NORMAL,"HAS_NORMALS"),this.defineIfPresent(n.TANGENT&&h,"HAS_TANGENTS"),this.defineIfPresent(n.TEXCOORD_0,"HAS_UV"),this.defineIfPresent(a,"USE_IBL"),this.defineIfPresent(o,"USE_LIGHTS"),this.defineIfPresent(s,"PBR_DEBUG"),i&&this.parseMaterial(i)}defineIfPresent(t,e){t&&(this.defines[e]=1)}parseTexture(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;const i=t.texture&&t.texture.sampler&&t.texture.sampler.parameters||{},s=t.texture.source.image;let a,o={};s.compressed?(a=s,o={[this.gl.TEXTURE_MIN_FILTER]:s.data.length>1?this.gl.LINEAR_MIPMAP_NEAREST:this.gl.LINEAR}):a={data:s};const h=new La(this.gl,{id:t.name||t.id,parameters:{...i,...o},pixelStore:{[this.gl.UNPACK_FLIP_Y_WEBGL]:!1},...a});this.uniforms[e]=h,this.defineIfPresent(n,n),this.generatedTextures.push(h)}parsePbrMetallicRoughness(t){t.baseColorTexture&&this.parseTexture(t.baseColorTexture,"u_BaseColorSampler","HAS_BASECOLORMAP"),this.uniforms.u_BaseColorFactor=t.baseColorFactor||[1,1,1,1],t.metallicRoughnessTexture&&this.parseTexture(t.metallicRoughnessTexture,"u_MetallicRoughnessSampler","HAS_METALROUGHNESSMAP");const{metallicFactor:e=1,roughnessFactor:n=1}=t;this.uniforms.u_MetallicRoughnessValues=[e,n]}parseMaterial(t){if(this.uniforms.pbr_uUnlit=!!t.unlit,t.pbrMetallicRoughness&&this.parsePbrMetallicRoughness(t.pbrMetallicRoughness),t.normalTexture){this.parseTexture(t.normalTexture,"u_NormalSampler","HAS_NORMALMAP");const{scale:e=1}=t.normalTexture;this.uniforms.u_NormalScale=e}if(t.occlusionTexture){this.parseTexture(t.occlusionTexture,"u_OcclusionSampler","HAS_OCCLUSIONMAP");const{strength:e=1}=t.occlusionTexture;this.uniforms.u_OcclusionStrength=e}if(t.emissiveTexture&&(this.parseTexture(t.emissiveTexture,"u_EmissiveSampler","HAS_EMISSIVEMAP"),this.uniforms.u_EmissiveFactor=t.emissiveFactor||[0,0,0]),t.alphaMode==="MASK"){const{alphaCutoff:e=.5}=t;this.defines.ALPHA_CUTOFF=1,this.uniforms.u_AlphaCutoff=e}else t.alphaMode==="BLEND"&&(Cr.warn("BLEND alphaMode might not work well because it requires mesh sorting")(),Object.assign(this.parameters,{blend:!0,blendEquation:this.gl.FUNC_ADD,blendFunc:[this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA,this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA]}))}delete(){this.generatedTextures.forEach(t=>t.delete())}}const H$=`
#if (__VERSION__ < 300)
  #define _attr attribute
#else
  #define _attr in
#endif

  _attr vec4 POSITION;

  #ifdef HAS_NORMALS
    _attr vec4 NORMAL;
  #endif

  #ifdef HAS_TANGENTS
    _attr vec4 TANGENT;
  #endif

  #ifdef HAS_UV
    _attr vec2 TEXCOORD_0;
  #endif

  void main(void) {
    vec4 _NORMAL = vec4(0.);
    vec4 _TANGENT = vec4(0.);
    vec2 _TEXCOORD_0 = vec2(0.);

    #ifdef HAS_NORMALS
      _NORMAL = NORMAL;
    #endif

    #ifdef HAS_TANGENTS
      _TANGENT = TANGENT;
    #endif

    #ifdef HAS_UV
      _TEXCOORD_0 = TEXCOORD_0;
    #endif

    pbr_setPositionNormalTangentUV(POSITION, _NORMAL, _TANGENT, _TEXCOORD_0);
    gl_Position = u_MVPMatrix * POSITION;
  }
`,G$=`
#if (__VERSION__ < 300)
  #define fragmentColor gl_FragColor
#else
  out vec4 fragmentColor;
#endif

  void main(void) {
    fragmentColor = pbr_filterColor(vec4(0));
  }
`;function j3(r,t){return yn(r)?`#version 300 es
`.concat(t):t}function V$(r,t){const{id:e,drawMode:n,vertexCount:i,attributes:s,modelOptions:a}=t,o=new V3(r,t);Cr.info(4,"createGLTFModel defines: ",o.defines)();const h=[];h.push(...o.generatedTextures),h.push(...Object.values(s).map(g=>g.buffer));const f=new z$(r,{id:e,drawMode:n,vertexCount:i,modules:[Hv],parameters:o.parameters,vs:j3(r,H$),fs:j3(r,G$),managedResources:h,...a,defines:{...o.defines,...a.defines}});return f.setProps({attributes:s}),f.setUniforms(o.uniforms),f}const j$={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},q$={modelOptions:{},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1};class K${constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=t,this.options=Object.assign({},q$,e)}instantiate(t){return this.gltf=t,(t.scenes||[]).map(n=>this.createScene(n))}createAnimator(){return Array.isArray(this.gltf.animations)?new Q$(this.gltf):null}createScene(t){const n=(t.nodes||[]).map(s=>this.createNode(s));return new jp({id:t.name||t.id,children:n})}createNode(t){if(!t._node){const n=(t.children||[]).map(s=>this.createNode(s));t.mesh&&n.push(this.createMesh(t.mesh));const i=new jp({id:t.name||t.id,children:n});if(t.matrix)i.setMatrix(t.matrix);else{if(i.matrix.identity(),t.translation&&i.matrix.translate(t.translation),t.rotation){const s=new Cn().fromQuaternion(t.rotation);i.matrix.multiplyRight(s)}t.scale&&i.matrix.scale(t.scale)}t._node=i}return t._node}createMesh(t){if(!t._mesh){const n=(t.primitives||[]).map((s,a)=>this.createPrimitive(s,a,t)),i=new jp({id:t.name||t.id,children:n});t._mesh=i}return t._mesh}getVertexCount(t){Cr.warn("getVertexCount() not found")()}createPrimitive(t,e,n){const i=V$(this.gl,Object.assign({id:t.name||"".concat(n.name||n.id,"-primitive-").concat(e),drawMode:t.mode||4,vertexCount:t.indices?t.indices.count:this.getVertexCount(t.attributes),attributes:this.createAttributes(t.attributes,t.indices),material:t.material},this.options));return i.bounds=[t.attributes.POSITION.min,t.attributes.POSITION.max],i}createAttributes(t,e){const n={};return Object.keys(t).forEach(i=>{n[i]=this.createAccessor(t[i],this.createBuffer(t[i],this.gl.ARRAY_BUFFER))}),e&&(n.indices=this.createAccessor(e,this.createBuffer(e,this.gl.ELEMENT_ARRAY_BUFFER))),Cr.info(4,"glTF Attributes",{attributes:t,indices:e,generated:n})(),n}createBuffer(t,e){t.bufferView||(t.bufferView={});const{bufferView:n}=t;return n.lumaBuffers||(n.lumaBuffers={}),n.lumaBuffers[e]||(n.lumaBuffers[e]=new ri(this.gl,{id:"from-".concat(n.id),data:n.data||t.value,target:e})),n.lumaBuffers[e]}createAccessor(t,e){return new oa({buffer:e,offset:t.byteOffset||0,stride:t.bufferView.byteStride||0,type:t.componentType,size:j$[t.type]})}createSampler(t){return t}needsPOT(){return!1}}function $$(r,t,e){const n=new K$(r,e),i=n.instantiate(t),s=n.createAnimator();return{scenes:i,animator:s}}const W$="3.4.14",X$="3.4.14",q3="3.4.14",J$="https://unpkg.com/@loaders.gl/textures@".concat(q3,"/dist/libs/basis_encoder.wasm"),Y$="https://unpkg.com/@loaders.gl/textures@".concat(q3,"/dist/libs/basis_encoder.js");let Pb;async function K3(r){const t=r.modules||{};return t.basis?t.basis:(Pb=Pb||Z$(r),await Pb)}async function Z$(r){let t=null,e=null;return[t,e]=await Promise.all([await Ah("basis_transcoder.js","textures",r),await Ah("basis_transcoder.wasm","textures",r)]),t=t||globalThis.BASIS,await tW(t,e)}function tW(r,t){const e={};return t&&(e.wasmBinary=t),new Promise(n=>{r(e).then(i=>{const{BasisFile:s,initializeBasis:a}=i;a(),n({BasisFile:s})})})}let Ub;async function $3(r){const t=r.modules||{};return t.basisEncoder?t.basisEncoder:(Ub=Ub||eW(r),await Ub)}async function eW(r){let t=null,e=null;return[t,e]=await Promise.all([await Ah(Y$,"textures",r),await Ah(J$,"textures",r)]),t=t||globalThis.BASIS,await rW(t,e)}function rW(r,t){const e={};return t&&(e.wasmBinary=t),new Promise(n=>{r(e).then(i=>{const{BasisFile:s,KTX2File:a,initializeBasis:o,BasisEncoder:h}=i;o(),n({BasisFile:s,KTX2File:a,BasisEncoder:h})})})}const jd={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35987,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,COMPRESSED_RGBA_ASTC_4X4_KHR:37808,COMPRESSED_RGBA_ASTC_5X4_KHR:37809,COMPRESSED_RGBA_ASTC_5X5_KHR:37810,COMPRESSED_RGBA_ASTC_6X5_KHR:37811,COMPRESSED_RGBA_ASTC_6X6_KHR:37812,COMPRESSED_RGBA_ASTC_8X5_KHR:37813,COMPRESSED_RGBA_ASTC_8X6_KHR:37814,COMPRESSED_RGBA_ASTC_8X8_KHR:37815,COMPRESSED_RGBA_ASTC_10X5_KHR:37816,COMPRESSED_RGBA_ASTC_10X6_KHR:37817,COMPRESSED_RGBA_ASTC_10X8_KHR:37818,COMPRESSED_RGBA_ASTC_10X10_KHR:37819,COMPRESSED_RGBA_ASTC_12X10_KHR:37820,COMPRESSED_RGBA_ASTC_12X12_KHR:37821,COMPRESSED_SRGB8_ALPHA8_ASTC_4X4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5X4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5X5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6X5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6X6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8X5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8X6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8X8_KHR:37847,COMPRESSED_SRGB8_ALPHA8_ASTC_10X5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10X6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10X8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_10X10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_12X10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12X12_KHR:37853,COMPRESSED_RED_RGTC1_EXT:36283,COMPRESSED_SIGNED_RED_RGTC1_EXT:36284,COMPRESSED_RED_GREEN_RGTC2_EXT:36285,COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT:36286,COMPRESSED_SRGB_S3TC_DXT1_EXT:35916,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:35919},nW=["","WEBKIT_","MOZ_"],W3={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let C0=null;function iW(r){if(!C0){r=r||sW()||void 0,C0=new Set;for(const t of nW)for(const e in W3)if(r&&r.getExtension("".concat(t).concat(e))){const n=W3[e];C0.add(n)}}return C0}function sW(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}var X3,J3,Y3,Z3,tI,eI,rI,nI;(function(r){r[r.NONE=0]="NONE",r[r.BASISLZ=1]="BASISLZ",r[r.ZSTD=2]="ZSTD",r[r.ZLIB=3]="ZLIB"})(X3||(X3={})),function(r){r[r.BASICFORMAT=0]="BASICFORMAT"}(J3||(J3={})),function(r){r[r.UNSPECIFIED=0]="UNSPECIFIED",r[r.ETC1S=163]="ETC1S",r[r.UASTC=166]="UASTC"}(Y3||(Y3={})),function(r){r[r.UNSPECIFIED=0]="UNSPECIFIED",r[r.SRGB=1]="SRGB"}(Z3||(Z3={})),function(r){r[r.UNSPECIFIED=0]="UNSPECIFIED",r[r.LINEAR=1]="LINEAR",r[r.SRGB=2]="SRGB",r[r.ITU=3]="ITU",r[r.NTSC=4]="NTSC",r[r.SLOG=5]="SLOG",r[r.SLOG2=6]="SLOG2"}(tI||(tI={})),function(r){r[r.ALPHA_STRAIGHT=0]="ALPHA_STRAIGHT",r[r.ALPHA_PREMULTIPLIED=1]="ALPHA_PREMULTIPLIED"}(eI||(eI={})),function(r){r[r.RGB=0]="RGB",r[r.RRR=3]="RRR",r[r.GGG=4]="GGG",r[r.AAA=15]="AAA"}(rI||(rI={})),function(r){r[r.RGB=0]="RGB",r[r.RGBA=3]="RGBA",r[r.RRR=4]="RRR",r[r.RRRG=5]="RRRG"}(nI||(nI={}));const Ra=[171,75,84,88,32,50,48,187,13,10,26,10];function oW(r){const t=new Uint8Array(r);return!(t.byteLength<Ra.length||t[0]!==Ra[0]||t[1]!==Ra[1]||t[2]!==Ra[2]||t[3]!==Ra[3]||t[4]!==Ra[4]||t[5]!==Ra[5]||t[6]!==Ra[6]||t[7]!==Ra[7]||t[8]!==Ra[8]||t[9]!==Ra[9]||t[10]!==Ra[10]||t[11]!==Ra[11])}const aW={etc1:{basisFormat:0,compressed:!0,format:jd.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:jd.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:jd.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:jd.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:jd.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:jd.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function cW(r,t){if(t.basis.containerFormat==="auto"){if(oW(r)){const n=await $3(t);return iI(n.KTX2File,r,t)}const{BasisFile:e}=await K3(t);return Rb(e,r,t)}switch(t.basis.module){case"encoder":const e=await $3(t);switch(t.basis.containerFormat){case"ktx2":return iI(e.KTX2File,r,t);case"basis":default:return Rb(e.BasisFile,r,t)}case"transcoder":default:const{BasisFile:n}=await K3(t);return Rb(n,r,t)}}function Rb(r,t,e){const n=new r(new Uint8Array(t));try{if(!n.startTranscoding())throw new Error("Failed to start basis transcoding");const i=n.getNumImages(),s=[];for(let a=0;a<i;a++){const o=n.getNumLevels(a),h=[];for(let f=0;f<o;f++)h.push(lW(n,a,f,e));s.push(h)}return s}finally{n.close(),n.delete()}}function lW(r,t,e,n){const i=r.getImageWidth(t,e),s=r.getImageHeight(t,e),a=r.getHasAlpha(),{compressed:o,format:h,basisFormat:f}=sI(n,a),g=r.getImageTranscodedSizeInBytes(t,e,f),b=new Uint8Array(g);if(!r.transcodeImage(b,t,e,f,0,0))throw new Error("failed to start Basis transcoding");return{width:i,height:s,data:b,compressed:o,format:h,hasAlpha:a}}function iI(r,t,e){const n=new r(new Uint8Array(t));try{if(!n.startTranscoding())throw new Error("failed to start KTX2 transcoding");const i=n.getLevels(),s=[];for(let a=0;a<i;a++){s.push(AW(n,a,e));break}return[s]}finally{n.close(),n.delete()}}function AW(r,t,e){const{alphaFlag:n,height:i,width:s}=r.getImageLevelInfo(t,0,0),{compressed:a,format:o,basisFormat:h}=sI(e,n),f=r.getImageTranscodedSizeInBytes(t,0,0,h),g=new Uint8Array(f);if(!r.transcodeImage(g,t,0,0,h,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:s,height:i,data:g,compressed:a,levelSize:f,hasAlpha:n,format:o}}function sI(r,t){let e=r&&r.basis&&r.basis.format;return e==="auto"&&(e=oI()),typeof e=="object"&&(e=t?e.alpha:e.noAlpha),e=e.toLowerCase(),aW[e]}function oI(){const r=iW();return r.has("astc")?"astc-4x4":r.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:r.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:r.has("etc1")?"etc1":r.has("etc2")?"etc2":"rgb565"}const uW={...{name:"Basis",id:mA?"basis":"basis-nodejs",module:"textures",version:X$,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},parse:cW};function Da(r,t){if(!r)throw new Error(t||"assert failed: gltf")}function aI(r,t){if(r.startsWith("data:")||r.startsWith("http:")||r.startsWith("https:"))return r;const n=t.baseUri||t.uri;if(!n)throw new Error("'baseUri' must be provided to resolve relative url ".concat(r));return n.substr(0,n.lastIndexOf("/")+1)+r}function hW(r,t,e){const n=r.bufferViews[e];Da(n);const i=n.buffer,s=t[i];Da(s);const a=(n.byteOffset||0)+s.byteOffset;return new Uint8Array(s.arrayBuffer,a,n.byteLength)}const cI=["SCALAR","VEC2","VEC3","VEC4"],dW=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],fW=new Map(dW),pW={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},gW={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},mW={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function lI(r){return cI[r-1]||cI[0]}function AI(r){const t=fW.get(r.constructor);if(!t)throw new Error("Illegal typed array");return t}function Db(r,t){const e=mW[r.componentType],n=pW[r.type],i=gW[r.componentType],s=r.count*n,a=r.count*n*i;return Da(a>=0&&a<=t.byteLength),{ArrayType:e,length:s,byteLength:a}}function uI(r){let{images:t,bufferViews:e}=r;t=t||[],e=e||[];const n=t.map(a=>a.bufferView);e=e.filter(a=>!n.includes(a));const i=e.reduce((a,o)=>a+o.byteLength,0),s=t.reduce((a,o)=>{const{width:h,height:f}=o.image;return a+h*f},0);return i+Math.ceil(4*s*1.33)}const yW={asset:{version:"2.0",generator:"loaders.gl"},buffers:[]};class aa{constructor(t){K(this,"gltf",void 0),K(this,"sourceBuffers",void 0),K(this,"byteLength",void 0),this.gltf=t||{json:{...yW},buffers:[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(t){return this.json[t]}getExtraData(t){return(this.json.extras||{})[t]}getExtension(t){const e=this.getUsedExtensions().find(i=>i===t),n=this.json.extensions||{};return e?n[t]||!0:null}getRequiredExtension(t){return this.getRequiredExtensions().find(n=>n===t)?this.getExtension(t):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(t,e){return(t.extensions||{})[e]}getScene(t){return this.getObject("scenes",t)}getNode(t){return this.getObject("nodes",t)}getSkin(t){return this.getObject("skins",t)}getMesh(t){return this.getObject("meshes",t)}getMaterial(t){return this.getObject("materials",t)}getAccessor(t){return this.getObject("accessors",t)}getTexture(t){return this.getObject("textures",t)}getSampler(t){return this.getObject("samplers",t)}getImage(t){return this.getObject("images",t)}getBufferView(t){return this.getObject("bufferViews",t)}getBuffer(t){return this.getObject("buffers",t)}getObject(t,e){if(typeof e=="object")return e;const n=this.json[t]&&this.json[t][e];if(!n)throw new Error("glTF file error: Could not find ".concat(t,"[").concat(e,"]"));return n}getTypedArrayForBufferView(t){t=this.getBufferView(t);const e=t.buffer,n=this.gltf.buffers[e];Da(n);const i=(t.byteOffset||0)+n.byteOffset;return new Uint8Array(n.arrayBuffer,i,t.byteLength)}getTypedArrayForAccessor(t){t=this.getAccessor(t);const e=this.getBufferView(t.bufferView),i=this.getBuffer(e.buffer).data,{ArrayType:s,length:a}=Db(t,e),o=e.byteOffset+t.byteOffset;return new s(i,o,a)}getTypedArrayForImageData(t){t=this.getAccessor(t);const e=this.getBufferView(t.bufferView),i=this.getBuffer(e.buffer).data,s=e.byteOffset||0;return new Uint8Array(i,s,e.byteLength)}addApplicationData(t,e){return this.json[t]=e,this}addExtraData(t,e){return this.json.extras=this.json.extras||{},this.json.extras[t]=e,this}addObjectExtension(t,e,n){return t.extensions=t.extensions||{},t.extensions[e]=n,this.registerUsedExtension(e),this}setObjectExtension(t,e,n){const i=t.extensions||{};i[e]=n}removeObjectExtension(t,e){const n=t.extensions||{},i=n[e];return delete n[e],i}addExtension(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Da(e),this.json.extensions=this.json.extensions||{},this.json.extensions[t]=e,this.registerUsedExtension(t),e}addRequiredExtension(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Da(e),this.addExtension(t,e),this.registerRequiredExtension(t),e}registerUsedExtension(t){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(e=>e===t)||this.json.extensionsUsed.push(t)}registerRequiredExtension(t){this.registerUsedExtension(t),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(e=>e===t)||this.json.extensionsRequired.push(t)}removeExtension(t){if(!this.getExtension(t))return;this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,t),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,t),this.json.extensions&&delete this.json.extensions[t],Array.isArray(this.json.extensionsRemoved)||(this.json.extensionsRemoved=[]);const e=this.json.extensionsRemoved;e.includes(t)||e.push(t)}setDefaultScene(t){this.json.scene=t}addScene(t){const{nodeIndices:e}=t;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:e}),this.json.scenes.length-1}addNode(t){const{meshIndex:e,matrix:n}=t;this.json.nodes=this.json.nodes||[];const i={mesh:e};return n&&(i.matrix=n),this.json.nodes.push(i),this.json.nodes.length-1}addMesh(t){const{attributes:e,indices:n,material:i,mode:s=4}=t,o={primitives:[{attributes:this._addAttributes(e),mode:s}]};if(n){const h=this._addIndices(n);o.primitives[0].indices=h}return Number.isFinite(i)&&(o.primitives[0].material=i),this.json.meshes=this.json.meshes||[],this.json.meshes.push(o),this.json.meshes.length-1}addPointCloud(t){const n={primitives:[{attributes:this._addAttributes(t),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(n),this.json.meshes.length-1}addImage(t,e){const n=V_(t),i=e||(n==null?void 0:n.mimeType),a={bufferView:this.addBufferView(t),mimeType:i};return this.json.images=this.json.images||[],this.json.images.push(a),this.json.images.length-1}addBufferView(t){const e=t.byteLength;Da(Number.isFinite(e)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(t);const n={buffer:0,byteOffset:this.byteLength,byteLength:e};return this.byteLength+=ap(e,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(n),this.json.bufferViews.length-1}addAccessor(t,e){const n={bufferView:t,type:lI(e.size),componentType:e.componentType,count:e.count,max:e.max,min:e.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(n),this.json.accessors.length-1}addBinaryBuffer(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{size:3};const n=this.addBufferView(t);let i={min:e.min,max:e.max};(!i.min||!i.max)&&(i=this._getAccessorMinMax(t,e.size));const s={size:e.size,componentType:AI(t),count:Math.round(t.length/e.size),min:i.min,max:i.max};return this.addAccessor(n,Object.assign(s,e))}addTexture(t){const{imageIndex:e}=t,n={source:e};return this.json.textures=this.json.textures||[],this.json.textures.push(n),this.json.textures.length-1}addMaterial(t){return this.json.materials=this.json.materials||[],this.json.materials.push(t),this.json.materials.length-1}createBinaryChunk(){var t,e;this.gltf.buffers=[];const n=this.byteLength,i=new ArrayBuffer(n),s=new Uint8Array(i);let a=0;for(const o of this.sourceBuffers||[])a=S6(o,s,a);(t=this.json)!==null&&t!==void 0&&(e=t.buffers)!==null&&e!==void 0&&e[0]?this.json.buffers[0].byteLength=n:this.json.buffers=[{byteLength:n}],this.gltf.binary=i,this.sourceBuffers=[i]}_removeStringFromArray(t,e){let n=!0;for(;n;){const i=t.indexOf(e);i>-1?t.splice(i,1):n=!1}}_addAttributes(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e={};for(const n in t){const i=t[n],s=this._getGltfAttributeName(n),a=this.addBinaryBuffer(i.value,i);e[s]=a}return e}_addIndices(t){return this.addBinaryBuffer(t,{size:1})}_getGltfAttributeName(t){switch(t.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return t}}_getAccessorMinMax(t,e){const n={min:null,max:null};if(t.length<e)return n;n.min=[],n.max=[];const i=t.subarray(0,e);for(const s of i)n.min.push(s),n.max.push(s);for(let s=e;s<t.length;s+=e)for(let a=0;a<e;a++)n.min[0+a]=Math.min(n.min[0+a],t[s+a]),n.max[0+a]=Math.max(n.max[0+a],t[s+a]);return n}}const _W="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",vW="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",bW=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),wW=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),xW={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},BW={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function CW(r,t,e,n,i){let s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"NONE";const a=await EW();IW(a,a.exports[BW[i]],r,t,e,n,a.exports[xW[s||"NONE"]])}let Ob;async function EW(){return Ob||(Ob=SW()),Ob}async function SW(){let r=_W;WebAssembly.validate(bW)&&(r=vW,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const t=await WebAssembly.instantiate(TW(r),{});return await t.instance.exports.__wasm_call_ctors(),t.instance}function TW(r){const t=new Uint8Array(r.length);for(let n=0;n<r.length;++n){const i=r.charCodeAt(n);t[n]=i>96?i-71:i>64?i-65:i>47?i+4:i>46?63:62}let e=0;for(let n=0;n<r.length;++n)t[e++]=t[n]<60?wW[t[n]]:(t[n]-60)*64+t[++n];return t.buffer.slice(0,e)}function IW(r,t,e,n,i,s,a){const o=r.exports.sbrk,h=n+3&-4,f=o(h*i),g=o(s.length),b=new Uint8Array(r.exports.memory.buffer);b.set(s,g);const C=t(f,n,i,g,s.length);if(C===0&&a&&a(f,h,i),e.set(b.subarray(f,f+n*i)),o(f-o(0)),C!==0)throw new Error("Malformed buffer data: ".concat(C))}const Nb="EXT_meshopt_compression",LW=Nb;async function FW(r,t){var e;const n=new aa(r);if(!(t!=null&&(e=t.gltf)!==null&&e!==void 0&&e.decompressMeshes))return;const i=[];for(const s of r.json.bufferViews||[])i.push(MW(n,s));await Promise.all(i),n.removeExtension(Nb)}async function MW(r,t){const e=r.getObjectExtension(t,Nb);if(e){const{byteOffset:n=0,byteLength:i=0,byteStride:s,count:a,mode:o,filter:h="NONE",buffer:f}=e,g=r.gltf.buffers[f],b=new Uint8Array(g.arrayBuffer,g.byteOffset+n,i),C=new Uint8Array(r.gltf.buffers[t.buffer].arrayBuffer,t.byteOffset,t.byteLength);return await CW(C,a,s,b,o,h),C}return null}const PW=Object.freeze(Object.defineProperty({__proto__:null,decode:FW,name:LW},Symbol.toStringTag,{value:"Module"})),qd="EXT_texture_webp",UW=qd;function RW(r,t){const e=new aa(r);if(!w8("image/webp")){if(e.getRequiredExtensions().includes(qd))throw new Error("gltf: Required extension ".concat(qd," not supported by browser"));return}const{json:n}=e;for(const i of n.textures||[]){const s=e.getObjectExtension(i,qd);s&&(i.source=s.source),e.removeObjectExtension(i,qd)}e.removeExtension(qd)}const DW=Object.freeze(Object.defineProperty({__proto__:null,name:UW,preprocess:RW},Symbol.toStringTag,{value:"Module"})),E0="KHR_texture_basisu",OW=E0;function NW(r,t){const e=new aa(r),{json:n}=e;for(const i of n.textures||[]){const s=e.getObjectExtension(i,E0);s&&(i.source=s.source),e.removeObjectExtension(i,E0)}e.removeExtension(E0)}const kW=Object.freeze(Object.defineProperty({__proto__:null,name:OW,preprocess:NW},Symbol.toStringTag,{value:"Module"})),QW={name:"Draco",id:mA?"draco":"draco-nodejs",module:"draco",shapes:["mesh"],version:"3.4.14",worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};function zW(r,t,e){const n=dI(t.metadata),i=[],s=HW(t.attributes);for(const a in r){const o=r[a],h=hI(a,o,s[a]);i.push(h)}if(e){const a=hI("indices",e);i.push(a)}return new Hd(i,n)}function HW(r){const t={};for(const e in r){const n=r[e];t[n.name||"undefined"]=n}return t}function hI(r,t,e){const n=e?dI(e.metadata):void 0;return T$(r,t,n)}function dI(r){const t=new Map;for(const e in r)t.set("".concat(e,".string"),JSON.stringify(r[e]));return t}const fI={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},GW={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},VW=4;class jW{constructor(t){K(this,"draco",void 0),K(this,"decoder",void 0),K(this,"metadataQuerier",void 0),this.draco=t,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=new this.draco.DecoderBuffer;n.Init(new Int8Array(t),t.byteLength),this._disableAttributeTransforms(e);const i=this.decoder.GetEncodedGeometryType(n),s=i===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let a;switch(i){case this.draco.TRIANGULAR_MESH:a=this.decoder.DecodeBufferToMesh(n,s);break;case this.draco.POINT_CLOUD:a=this.decoder.DecodeBufferToPointCloud(n,s);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!a.ok()||!s.ptr){const C="DRACO decompression failed: ".concat(a.error_msg());throw new Error(C)}const o=this._getDracoLoaderData(s,i,e),h=this._getMeshData(s,o,e),f=U3(h.attributes),g=zW(h.attributes,o,h.indices);return{loader:"draco",loaderData:o,header:{vertexCount:s.num_points(),boundingBox:f},...h,schema:g}}finally{this.draco.destroy(n),s&&this.draco.destroy(s)}}_getDracoLoaderData(t,e,n){const i=this._getTopLevelMetadata(t),s=this._getDracoAttributes(t,n);return{geometry_type:e,num_attributes:t.num_attributes(),num_points:t.num_points(),num_faces:t instanceof this.draco.Mesh?t.num_faces():0,metadata:i,attributes:s}}_getDracoAttributes(t,e){const n={};for(let i=0;i<t.num_attributes();i++){const s=this.decoder.GetAttribute(t,i),a=this._getAttributeMetadata(t,i);n[s.unique_id()]={unique_id:s.unique_id(),attribute_type:s.attribute_type(),data_type:s.data_type(),num_components:s.num_components(),byte_offset:s.byte_offset(),byte_stride:s.byte_stride(),normalized:s.normalized(),attribute_index:i,metadata:a};const o=this._getQuantizationTransform(s,e);o&&(n[s.unique_id()].quantization_transform=o);const h=this._getOctahedronTransform(s,e);h&&(n[s.unique_id()].octahedron_transform=h)}return n}_getMeshData(t,e,n){const i=this._getMeshAttributes(e,t,n);if(!i.POSITION)throw new Error("DRACO: No position attribute found.");if(t instanceof this.draco.Mesh)switch(n.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:i,indices:{value:this._getTriangleStripIndices(t),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:i,indices:{value:this._getTriangleListIndices(t),size:1}}}return{topology:"point-list",mode:0,attributes:i}}_getMeshAttributes(t,e,n){const i={};for(const s of Object.values(t.attributes)){const a=this._deduceAttributeName(s,n);s.name=a;const{value:o,size:h}=this._getAttributeValues(e,s);i[a]={value:o,size:h,byteOffset:s.byte_offset,byteStride:s.byte_stride,normalized:s.normalized}}return i}_getTriangleListIndices(t){const n=t.num_faces()*3,i=n*VW,s=this.draco._malloc(i);try{return this.decoder.GetTrianglesUInt32Array(t,i,s),new Uint32Array(this.draco.HEAPF32.buffer,s,n).slice()}finally{this.draco._free(s)}}_getTriangleStripIndices(t){const e=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(t,e),$W(e)}finally{this.draco.destroy(e)}}_getAttributeValues(t,e){const n=GW[e.data_type],i=e.num_components,a=t.num_points()*i,o=a*n.BYTES_PER_ELEMENT,h=qW(this.draco,n);let f;const g=this.draco._malloc(o);try{const b=this.decoder.GetAttribute(t,e.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(t,b,h,o,g),f=new n(this.draco.HEAPF32.buffer,g,a).slice()}finally{this.draco._free(g)}return{value:f,size:i}}_deduceAttributeName(t,e){const n=t.unique_id;for(const[a,o]of Object.entries(e.extraAttributes||{}))if(o===n)return a;const i=t.attribute_type;for(const a in fI)if(this.draco[a]===i)return fI[a];const s=e.attributeNameEntry||"name";return t.metadata[s]?t.metadata[s].string:"CUSTOM_ATTRIBUTE_".concat(n)}_getTopLevelMetadata(t){const e=this.decoder.GetMetadata(t);return this._getDracoMetadata(e)}_getAttributeMetadata(t,e){const n=this.decoder.GetAttributeMetadata(t,e);return this._getDracoMetadata(n)}_getDracoMetadata(t){if(!t||!t.ptr)return{};const e={},n=this.metadataQuerier.NumEntries(t);for(let i=0;i<n;i++){const s=this.metadataQuerier.GetEntryName(t,i);e[s]=this._getDracoMetadataField(t,s)}return e}_getDracoMetadataField(t,e){const n=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(t,e,n);const i=KW(n);return{int:this.metadataQuerier.GetIntEntry(t,e),string:this.metadataQuerier.GetStringEntry(t,e),double:this.metadataQuerier.GetDoubleEntry(t,e),intArray:i}}finally{this.draco.destroy(n)}}_disableAttributeTransforms(t){const{quantizedAttributes:e=[],octahedronAttributes:n=[]}=t,i=[...e,...n];for(const s of i)this.decoder.SkipAttributeTransform(this.draco[s])}_getQuantizationTransform(t,e){const{quantizedAttributes:n=[]}=e,i=t.attribute_type();if(n.map(a=>this.decoder[a]).includes(i)){const a=new this.draco.AttributeQuantizationTransform;try{if(a.InitFromAttribute(t))return{quantization_bits:a.quantization_bits(),range:a.range(),min_values:new Float32Array([1,2,3]).map(o=>a.min_value(o))}}finally{this.draco.destroy(a)}}return null}_getOctahedronTransform(t,e){const{octahedronAttributes:n=[]}=e,i=t.attribute_type();if(n.map(a=>this.decoder[a]).includes(i)){const a=new this.draco.AttributeQuantizationTransform;try{if(a.InitFromAttribute(t))return{quantization_bits:a.quantization_bits()}}finally{this.draco.destroy(a)}}return null}}function qW(r,t){switch(t){case Float32Array:return r.DT_FLOAT32;case Int8Array:return r.DT_INT8;case Int16Array:return r.DT_INT16;case Int32Array:return r.DT_INT32;case Uint8Array:return r.DT_UINT8;case Uint16Array:return r.DT_UINT16;case Uint32Array:return r.DT_UINT32;default:return r.DT_INVALID}}function KW(r){const t=r.size(),e=new Int32Array(t);for(let n=0;n<t;n++)e[n]=r.GetValue(n);return e}function $W(r){const t=r.size(),e=new Int32Array(t);for(let n=0;n<t;n++)e[n]=r.GetValue(n);return e}const kb="https://www.gstatic.com/draco/versioned/decoders/".concat("1.5.5"),WW="".concat(kb,"/draco_decoder.js"),XW="".concat(kb,"/draco_wasm_wrapper.js"),JW="".concat(kb,"/draco_decoder.wasm");let qp;async function YW(r){const t=r.modules||{};return t.draco3d?qp=qp||t.draco3d.createDecoderModule({}).then(e=>({draco:e})):qp=qp||ZW(r),await qp}async function ZW(r){let t,e;switch(r.draco&&r.draco.decoderType){case"js":t=await Ah(WW,"draco",r);break;case"wasm":default:[t,e]=await Promise.all([await Ah(XW,"draco",r),await Ah(JW,"draco",r)])}return t=t||globalThis.DracoDecoderModule,await tX(t,e)}function tX(r,t){const e={};return t&&(e.wasmBinary=t),new Promise(n=>{r({...e,onModuleLoaded:i=>n({draco:i})})})}const pI={...QW,parse:eX};async function eX(r,t){const{draco:e}=await YW(t),n=new jW(e);try{return n.parseSync(r,t==null?void 0:t.draco)}finally{n.destroy()}}function rX(r){const t={};for(const e in r){const n=r[e];if(e!=="indices"){const i=gI(n);t[e]=i}}return t}function gI(r){const{buffer:t,size:e,count:n}=nX(r);return{value:t,size:e,byteOffset:0,count:n,type:lI(e),componentType:AI(t)}}function nX(r){let t=r,e=1,n=0;return r&&r.value&&(t=r.value,e=r.size||1),t&&(ArrayBuffer.isView(t)||(t=iX(t,Float32Array)),n=t.length/e),{buffer:t,size:e,count:n}}function iX(r,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return r?Array.isArray(r)?new t(r):e&&!(r instanceof t)?new t(r):r:null}const wh="KHR_draco_mesh_compression",sX=wh;function oX(r,t,e){const n=new aa(r);for(const i of mI(n))n.getObjectExtension(i,wh)}async function aX(r,t,e){var n;if(!(t!=null&&(n=t.gltf)!==null&&n!==void 0&&n.decompressMeshes))return;const i=new aa(r),s=[];for(const a of mI(i))i.getObjectExtension(a,wh)&&s.push(lX(i,a,t,e));await Promise.all(s),i.removeExtension(wh)}function cX(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const e=new aa(r);for(const n of e.json.meshes||[])AX(n,t),e.addRequiredExtension(wh)}async function lX(r,t,e,n){const i=r.getObjectExtension(t,wh);if(!i)return;const s=r.getTypedArrayForBufferView(i.bufferView),a=I_(s.buffer,s.byteOffset),{parse:o}=n,h={...e};delete h["3d-tiles"];const f=await o(a,pI,h,n),g=rX(f.attributes);for(const[b,C]of Object.entries(g))if(b in t.attributes){const B=t.attributes[b],R=r.getAccessor(B);R!=null&&R.min&&R!==null&&R!==void 0&&R.max&&(C.min=R.min,C.max=R.max)}t.attributes=g,f.indices&&(t.indices=gI(f.indices)),uX(t)}function AX(r,t){var e;let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:4,i=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0;if(!i.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const a=i.DracoWriter.encodeSync({attributes:r}),o=s==null||(e=s.parseSync)===null||e===void 0?void 0:e.call(s,{attributes:r}),h=i._addFauxAttributes(o.attributes),f=i.addBufferView(a);return{primitives:[{attributes:h,mode:n,extensions:{[wh]:{bufferView:f,attributes:h}}}]}}function uX(r){if(!r.attributes&&Object.keys(r.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*mI(r){for(const t of r.json.meshes||[])for(const e of t.primitives)yield e}const hX=Object.freeze(Object.defineProperty({__proto__:null,decode:aX,encode:cX,name:sX,preprocess:oX},Symbol.toStringTag,{value:"Module"})),dX={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},fX={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Qb="KHR_texture_transform",pX=Qb,S0=new ue,gX=new Ni,mX=new Ni;async function yX(r,t){if(!new aa(r).getExtension(Qb))return;const i=r.json.materials||[];for(let s=0;s<i.length;s++)_X(s,r)}function _X(r,t){var e,n,i;const s=[],a=(e=t.json.materials)===null||e===void 0?void 0:e[r],o=a==null||(n=a.pbrMetallicRoughness)===null||n===void 0?void 0:n.baseColorTexture;o&&Kp(t,r,o,s);const h=a==null?void 0:a.emissiveTexture;h&&Kp(t,r,h,s);const f=a==null?void 0:a.normalTexture;f&&Kp(t,r,f,s);const g=a==null?void 0:a.occlusionTexture;g&&Kp(t,r,g,s);const b=a==null||(i=a.pbrMetallicRoughness)===null||i===void 0?void 0:i.metallicRoughnessTexture;b&&Kp(t,r,b,s)}function Kp(r,t,e,n){const i=vX(e,n);if(!i)return;const s=r.json.meshes||[];for(const a of s)for(const o of a.primitives){const h=o.material;Number.isFinite(h)&&t===h&&bX(r,o,i)}}function vX(r,t){var e;const n=(e=r.extensions)===null||e===void 0?void 0:e[Qb],{texCoord:i=0}=r,{texCoord:s=i}=n;if(!(t.findIndex(o=>{let[h,f]=o;return h===i&&f===s})!==-1)){const o=BX(n);return i!==s&&(r.texCoord=s),t.push([i,s]),{originalTexCoord:i,texCoord:s,matrix:o}}return null}function bX(r,t,e){const{originalTexCoord:n,texCoord:i,matrix:s}=e,a=t.attributes["TEXCOORD_".concat(n)];if(Number.isFinite(a)){var o;const f=(o=r.json.accessors)===null||o===void 0?void 0:o[a];if(f&&f.bufferView){var h;const g=(h=r.json.bufferViews)===null||h===void 0?void 0:h[f.bufferView];if(g){const{arrayBuffer:b,byteOffset:C}=r.buffers[g.buffer],B=(C||0)+(f.byteOffset||0)+(g.byteOffset||0),{ArrayType:R,length:D}=Db(f,g),Q=fX[f.componentType],k=dX[f.type],j=g.byteStride||Q*k,et=new Float32Array(D);for(let st=0;st<f.count;st++){const mt=new R(b,B+st*j,2);S0.set(mt[0],mt[1],1),S0.transformByMatrix3(s),et.set([S0[0],S0[1]],st*k)}n===i?wX(f,g,r.buffers,et):xX(i,f,t,r,et)}}}}function wX(r,t,e,n){r.componentType=5126,e.push({arrayBuffer:n.buffer,byteOffset:0,byteLength:n.buffer.byteLength}),t.buffer=e.length-1,t.byteLength=n.buffer.byteLength,t.byteOffset=0,delete t.byteStride}function xX(r,t,e,n,i){n.buffers.push({arrayBuffer:i.buffer,byteOffset:0,byteLength:i.buffer.byteLength});const s=n.json.bufferViews;if(!s)return;s.push({buffer:n.buffers.length-1,byteLength:i.buffer.byteLength,byteOffset:0});const a=n.json.accessors;a&&(a.push({bufferView:(s==null?void 0:s.length)-1,byteOffset:0,componentType:5126,count:t.count,type:"VEC2"}),e.attributes["TEXCOORD_".concat(r)]=a.length-1)}function BX(r){const{offset:t=[0,0],rotation:e=0,scale:n=[1,1]}=r,i=new Ni().set(1,0,0,0,1,0,t[0],t[1],1),s=gX.set(Math.cos(e),Math.sin(e),0,-Math.sin(e),Math.cos(e),0,0,0,1),a=mX.set(n[0],0,0,0,n[1],0,0,0,1);return i.multiplyRight(s).multiplyRight(a)}const CX=Object.freeze(Object.defineProperty({__proto__:null,decode:yX,name:pX},Symbol.toStringTag,{value:"Module"})),xh="KHR_lights_punctual",EX=xh;async function SX(r){const t=new aa(r),{json:e}=t,n=t.getExtension(xh);n&&(t.json.lights=n.lights,t.removeExtension(xh));for(const i of e.nodes||[]){const s=t.getObjectExtension(i,xh);s&&(i.light=s.light),t.removeObjectExtension(i,xh)}}async function TX(r){const t=new aa(r),{json:e}=t;if(e.lights){const n=t.addExtension(xh);Da(!n.lights),n.lights=e.lights,delete e.lights}if(t.json.lights){for(const n of t.json.lights){const i=n.node;t.addObjectExtension(i,xh,n)}delete t.json.lights}}const IX=Object.freeze(Object.defineProperty({__proto__:null,decode:SX,encode:TX,name:EX},Symbol.toStringTag,{value:"Module"})),$p="KHR_materials_unlit",LX=$p;async function FX(r){const t=new aa(r),{json:e}=t;for(const n of e.materials||[])n.extensions&&n.extensions.KHR_materials_unlit&&(n.unlit=!0),t.removeObjectExtension(n,$p);t.removeExtension($p)}function MX(r){const t=new aa(r),{json:e}=t;if(t.materials)for(const n of e.materials||[])n.unlit&&(delete n.unlit,t.addObjectExtension(n,$p,{}),t.addExtension($p))}const PX=Object.freeze(Object.defineProperty({__proto__:null,decode:FX,encode:MX,name:LX},Symbol.toStringTag,{value:"Module"})),Wp="KHR_techniques_webgl",UX=Wp;async function RX(r){const t=new aa(r),{json:e}=t,n=t.getExtension(Wp);if(n){const i=OX(n,t);for(const s of e.materials||[]){const a=t.getObjectExtension(s,Wp);a&&(s.technique=Object.assign({},a,i[a.technique]),s.technique.values=NX(s.technique,t)),t.removeObjectExtension(s,Wp)}t.removeExtension(Wp)}}async function DX(r,t){}function OX(r,t){const{programs:e=[],shaders:n=[],techniques:i=[]}=r,s=new TextDecoder;return n.forEach(a=>{if(Number.isFinite(a.bufferView))a.code=s.decode(t.getTypedArrayForBufferView(a.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),e.forEach(a=>{a.fragmentShader=n[a.fragmentShader],a.vertexShader=n[a.vertexShader]}),i.forEach(a=>{a.program=e[a.program]}),i}function NX(r,t){const e=Object.assign({},r.values);return Object.keys(r.uniforms||{}).forEach(n=>{r.uniforms[n].value&&!(n in e)&&(e[n]=r.uniforms[n].value)}),Object.keys(e).forEach(n=>{typeof e[n]=="object"&&e[n].index!==void 0&&(e[n].texture=t.getTexture(e[n].index))}),e}const kX=Object.freeze(Object.defineProperty({__proto__:null,decode:RX,encode:DX,name:UX},Symbol.toStringTag,{value:"Module"})),yI="EXT_feature_metadata",QX=yI;async function zX(r){const t=new aa(r);HX(t)}function HX(r){var t;const e=r.getExtension(yI),n=e==null||(t=e.schema)===null||t===void 0?void 0:t.classes,i=e==null?void 0:e.featureTables;if((e==null?void 0:e.featureTextures)&&console.warn('featureTextures is not yet supported in the "EXT_feature_metadata" extension.'),n&&i)for(const a in n){const o=n[a],h=jX(i,a);h&&GX(r,h,o)}}function GX(r,t,e){for(const i in e.properties){var n;const s=e.properties[i],a=t==null||(n=t.properties)===null||n===void 0?void 0:n[i],o=t.count;if(a){const h=VX(r,s,o,a);a.data=h}}}function VX(r,t,e,n){const i=n.bufferView;let s=r.getTypedArrayForBufferView(i);switch(t.type){case"STRING":{const a=n.stringOffsetBufferView,o=r.getTypedArrayForBufferView(a);s=qX(s,o,e);break}}return s}function jX(r,t){for(const e in r){const n=r[e];if(n.class===t)return n}return null}function qX(r,t,e){const n=[],i=new TextDecoder("utf8");let s=0;const a=4;for(let o=0;o<e;o++){const h=t[(o+1)*a]-t[o*a],f=r.subarray(s,h+s),g=i.decode(f);n.push(g),s+=h}return n}const _I=[PW,DW,kW,hX,IX,PX,kX,CX,Object.freeze(Object.defineProperty({__proto__:null,decode:zX,name:QX},Symbol.toStringTag,{value:"Module"}))];function KX(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=arguments.length>2?arguments[2]:void 0;const n=_I.filter(s=>vI(s.name,t));for(const s of n){var i;(i=s.preprocess)===null||i===void 0||i.call(s,r,t,e)}}async function $X(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=arguments.length>2?arguments[2]:void 0;const n=_I.filter(s=>vI(s.name,t));for(const s of n){var i;await((i=s.decode)===null||i===void 0?void 0:i.call(s,r,t,e))}}function vI(r,t){var e;const n=(t==null||(e=t.gltf)===null||e===void 0?void 0:e.excludeExtensions)||{};return!(r in n&&!n[r])}const zb="KHR_binary_glTF";function WX(r){const t=new aa(r),{json:e}=t;for(const n of e.images||[]){const i=t.getObjectExtension(n,zb);i&&Object.assign(n,i),t.removeObjectExtension(n,zb)}e.buffers&&e.buffers[0]&&delete e.buffers[0].uri,t.removeExtension(zb)}const bI={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},XX={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class JX{constructor(){K(this,"idToIndexMap",{animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}}),K(this,"json",void 0)}normalize(t,e){this.json=t.json;const n=t.json;switch(n.asset&&n.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn("glTF: Unknown version ".concat(n.asset.version));return}if(!e.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(n),this._convertTopLevelObjectsToArrays(n),WX(t),this._convertObjectIdsToArrayIndices(n),this._updateObjects(n),this._updateMaterial(n)}_addAsset(t){t.asset=t.asset||{},t.asset.version="2.0",t.asset.generator=t.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(t){for(const e in bI)this._convertTopLevelObjectToArray(t,e)}_convertTopLevelObjectToArray(t,e){const n=t[e];if(!(!n||Array.isArray(n))){t[e]=[];for(const i in n){const s=n[i];s.id=s.id||i;const a=t[e].length;t[e].push(s),this.idToIndexMap[e][i]=a}}}_convertObjectIdsToArrayIndices(t){for(const e in bI)this._convertIdsToIndices(t,e);"scene"in t&&(t.scene=this._convertIdToIndex(t.scene,"scene"));for(const e of t.textures)this._convertTextureIds(e);for(const e of t.meshes)this._convertMeshIds(e);for(const e of t.nodes)this._convertNodeIds(e);for(const e of t.scenes)this._convertSceneIds(e)}_convertTextureIds(t){t.source&&(t.source=this._convertIdToIndex(t.source,"image"))}_convertMeshIds(t){for(const e of t.primitives){const{attributes:n,indices:i,material:s}=e;for(const a in n)n[a]=this._convertIdToIndex(n[a],"accessor");i&&(e.indices=this._convertIdToIndex(i,"accessor")),s&&(e.material=this._convertIdToIndex(s,"material"))}}_convertNodeIds(t){t.children&&(t.children=t.children.map(e=>this._convertIdToIndex(e,"node"))),t.meshes&&(t.meshes=t.meshes.map(e=>this._convertIdToIndex(e,"mesh")))}_convertSceneIds(t){t.nodes&&(t.nodes=t.nodes.map(e=>this._convertIdToIndex(e,"node")))}_convertIdsToIndices(t,e){t[e]||(console.warn("gltf v1: json doesn't contain attribute ".concat(e)),t[e]=[]);for(const n of t[e])for(const i in n){const s=n[i],a=this._convertIdToIndex(s,i);n[i]=a}}_convertIdToIndex(t,e){const n=XX[e];if(n in this.idToIndexMap){const i=this.idToIndexMap[n][t];if(!Number.isFinite(i))throw new Error("gltf v1: failed to resolve ".concat(e," with id ").concat(t));return i}return t}_updateObjects(t){for(const e of this.json.buffers)delete e.type}_updateMaterial(t){for(const s of t.materials){var e,n,i;s.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const a=((e=s.values)===null||e===void 0?void 0:e.tex)||((n=s.values)===null||n===void 0?void 0:n.texture2d_0)||((i=s.values)===null||i===void 0?void 0:i.diffuseTex),o=t.textures.findIndex(h=>h.id===a);o!==-1&&(s.pbrMetallicRoughness.baseColorTexture={index:o})}}}function YX(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new JX().normalize(r,t)}const ZX={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},tJ={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},nc={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},eJ={magFilter:nc.TEXTURE_MAG_FILTER,minFilter:nc.TEXTURE_MIN_FILTER,wrapS:nc.TEXTURE_WRAP_S,wrapT:nc.TEXTURE_WRAP_T},rJ={[nc.TEXTURE_MAG_FILTER]:nc.LINEAR,[nc.TEXTURE_MIN_FILTER]:nc.NEAREST_MIPMAP_LINEAR,[nc.TEXTURE_WRAP_S]:nc.REPEAT,[nc.TEXTURE_WRAP_T]:nc.REPEAT};function nJ(r){return tJ[r]}function iJ(r){return ZX[r]}class sJ{constructor(){K(this,"baseUri",""),K(this,"json",{}),K(this,"buffers",[]),K(this,"images",[])}postProcess(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{json:n,buffers:i=[],images:s=[],baseUri:a=""}=t;return Da(n),this.baseUri=a,this.json=n,this.buffers=i,this.images=s,this._resolveTree(this.json,e),this.json}_resolveTree(t){t.bufferViews&&(t.bufferViews=t.bufferViews.map((e,n)=>this._resolveBufferView(e,n))),t.images&&(t.images=t.images.map((e,n)=>this._resolveImage(e,n))),t.samplers&&(t.samplers=t.samplers.map((e,n)=>this._resolveSampler(e,n))),t.textures&&(t.textures=t.textures.map((e,n)=>this._resolveTexture(e,n))),t.accessors&&(t.accessors=t.accessors.map((e,n)=>this._resolveAccessor(e,n))),t.materials&&(t.materials=t.materials.map((e,n)=>this._resolveMaterial(e,n))),t.meshes&&(t.meshes=t.meshes.map((e,n)=>this._resolveMesh(e,n))),t.nodes&&(t.nodes=t.nodes.map((e,n)=>this._resolveNode(e,n))),t.skins&&(t.skins=t.skins.map((e,n)=>this._resolveSkin(e,n))),t.scenes&&(t.scenes=t.scenes.map((e,n)=>this._resolveScene(e,n))),t.scene!==void 0&&(t.scene=t.scenes[this.json.scene])}getScene(t){return this._get("scenes",t)}getNode(t){return this._get("nodes",t)}getSkin(t){return this._get("skins",t)}getMesh(t){return this._get("meshes",t)}getMaterial(t){return this._get("materials",t)}getAccessor(t){return this._get("accessors",t)}getCamera(t){return null}getTexture(t){return this._get("textures",t)}getSampler(t){return this._get("samplers",t)}getImage(t){return this._get("images",t)}getBufferView(t){return this._get("bufferViews",t)}getBuffer(t){return this._get("buffers",t)}_get(t,e){if(typeof e=="object")return e;const n=this.json[t]&&this.json[t][e];return n||console.warn("glTF file error: Could not find ".concat(t,"[").concat(e,"]")),n}_resolveScene(t,e){return t.id=t.id||"scene-".concat(e),t.nodes=(t.nodes||[]).map(n=>this.getNode(n)),t}_resolveNode(t,e){return t.id=t.id||"node-".concat(e),t.children&&(t.children=t.children.map(n=>this.getNode(n))),t.mesh!==void 0?t.mesh=this.getMesh(t.mesh):t.meshes!==void 0&&t.meshes.length&&(t.mesh=t.meshes.reduce((n,i)=>{const s=this.getMesh(i);return n.id=s.id,n.primitives=n.primitives.concat(s.primitives),n},{primitives:[]})),t.camera!==void 0&&(t.camera=this.getCamera(t.camera)),t.skin!==void 0&&(t.skin=this.getSkin(t.skin)),t}_resolveSkin(t,e){return t.id=t.id||"skin-".concat(e),t.inverseBindMatrices=this.getAccessor(t.inverseBindMatrices),t}_resolveMesh(t,e){return t.id=t.id||"mesh-".concat(e),t.primitives&&(t.primitives=t.primitives.map(n=>{n={...n};const i=n.attributes;n.attributes={};for(const s in i)n.attributes[s]=this.getAccessor(i[s]);return n.indices!==void 0&&(n.indices=this.getAccessor(n.indices)),n.material!==void 0&&(n.material=this.getMaterial(n.material)),n})),t}_resolveMaterial(t,e){if(t.id=t.id||"material-".concat(e),t.normalTexture&&(t.normalTexture={...t.normalTexture},t.normalTexture.texture=this.getTexture(t.normalTexture.index)),t.occlusionTexture&&(t.occlustionTexture={...t.occlustionTexture},t.occlusionTexture.texture=this.getTexture(t.occlusionTexture.index)),t.emissiveTexture&&(t.emmisiveTexture={...t.emmisiveTexture},t.emissiveTexture.texture=this.getTexture(t.emissiveTexture.index)),t.emissiveFactor||(t.emissiveFactor=t.emmisiveTexture?[1,1,1]:[0,0,0]),t.pbrMetallicRoughness){t.pbrMetallicRoughness={...t.pbrMetallicRoughness};const n=t.pbrMetallicRoughness;n.baseColorTexture&&(n.baseColorTexture={...n.baseColorTexture},n.baseColorTexture.texture=this.getTexture(n.baseColorTexture.index)),n.metallicRoughnessTexture&&(n.metallicRoughnessTexture={...n.metallicRoughnessTexture},n.metallicRoughnessTexture.texture=this.getTexture(n.metallicRoughnessTexture.index))}return t}_resolveAccessor(t,e){if(t.id=t.id||"accessor-".concat(e),t.bufferView!==void 0&&(t.bufferView=this.getBufferView(t.bufferView)),t.bytesPerComponent=nJ(t.componentType),t.components=iJ(t.type),t.bytesPerElement=t.bytesPerComponent*t.components,t.bufferView){const n=t.bufferView.buffer,{ArrayType:i,byteLength:s}=Db(t,t.bufferView),a=(t.bufferView.byteOffset||0)+(t.byteOffset||0)+n.byteOffset;let o=n.arrayBuffer.slice(a,a+s);t.bufferView.byteStride&&(o=this._getValueFromInterleavedBuffer(n,a,t.bufferView.byteStride,t.bytesPerElement,t.count)),t.value=new i(o)}return t}_getValueFromInterleavedBuffer(t,e,n,i,s){const a=new Uint8Array(s*i);for(let o=0;o<s;o++){const h=e+o*n;a.set(new Uint8Array(t.arrayBuffer.slice(h,h+i)),o*i)}return a.buffer}_resolveTexture(t,e){return t.id=t.id||"texture-".concat(e),t.sampler="sampler"in t?this.getSampler(t.sampler):rJ,t.source=this.getImage(t.source),t}_resolveSampler(t,e){t.id=t.id||"sampler-".concat(e),t.parameters={};for(const n in t){const i=this._enumSamplerParameter(n);i!==void 0&&(t.parameters[i]=t[n])}return t}_enumSamplerParameter(t){return eJ[t]}_resolveImage(t,e){t.id=t.id||"image-".concat(e),t.bufferView!==void 0&&(t.bufferView=this.getBufferView(t.bufferView));const n=this.images[e];return n&&(t.image=n),t}_resolveBufferView(t,e){const n=t.buffer,i={id:"bufferView-".concat(e),...t,buffer:this.buffers[n]},s=this.buffers[n].arrayBuffer;let a=this.buffers[n].byteOffset||0;return"byteOffset"in t&&(a+=t.byteOffset),i.data=new Uint8Array(s,a,t.byteLength),i}_resolveCamera(t,e){return t.id=t.id||"camera-".concat(e),t.perspective,t.orthographic,t}}function oJ(r,t){return new sJ().postProcess(r,t)}const wI=1735152710,Hb=12,T0=8,aJ=1313821514,cJ=5130562,lJ=0,AJ=1,uJ=0,Kd=!0;function hJ(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return"".concat(String.fromCharCode(r.getUint8(t+0))).concat(String.fromCharCode(r.getUint8(t+1))).concat(String.fromCharCode(r.getUint8(t+2))).concat(String.fromCharCode(r.getUint8(t+3)))}function dJ(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const n=new DataView(r),{magic:i=wI}=e,s=n.getUint32(t,!1);return s===i||s===wI}function fJ(r,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const n=new DataView(t),i=hJ(n,e+0),s=n.getUint32(e+4,Kd),a=n.getUint32(e+8,Kd);switch(Object.assign(r,{header:{byteOffset:e,byteLength:a,hasBinChunk:!1},type:i,version:s,json:{},binChunks:[]}),e+=Hb,r.version){case 1:return pJ(r,n,e);case 2:return gJ(r,n,e,{});default:throw new Error("Invalid GLB version ".concat(r.version,". Only supports v1 and v2."))}}function pJ(r,t,e){li(r.header.byteLength>Hb+T0);const n=t.getUint32(e+0,Kd),i=t.getUint32(e+4,Kd);return e+=T0,li(i===uJ),Gb(r,t,e,n),e+=n,e+=Vb(r,t,e,r.header.byteLength),e}function gJ(r,t,e,n){return li(r.header.byteLength>Hb+T0),mJ(r,t,e,n),e+r.header.byteLength}function mJ(r,t,e,n){for(;e+8<=r.header.byteLength;){const i=t.getUint32(e+0,Kd),s=t.getUint32(e+4,Kd);switch(e+=T0,s){case aJ:Gb(r,t,e,i);break;case cJ:Vb(r,t,e,i);break;case lJ:n.strict||Gb(r,t,e,i);break;case AJ:n.strict||Vb(r,t,e,i);break}e+=ap(i,4)}return e}function Gb(r,t,e,n){const i=new Uint8Array(t.buffer,e,n),a=new TextDecoder("utf8").decode(i);return r.json=JSON.parse(a),ap(n,4)}function Vb(r,t,e,n){return r.header.hasBinChunk=!0,r.binChunks.push({byteOffset:e,byteLength:n,arrayBuffer:t.buffer}),ap(n,4)}async function yJ(r,t){var e,n,i,s;let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,o=arguments.length>3?arguments[3]:void 0,h=arguments.length>4?arguments[4]:void 0;_J(r,t,a,o),YX(r,{normalize:o==null||(e=o.gltf)===null||e===void 0?void 0:e.normalize}),KX(r,o,h);const f=[];if(o!=null&&(n=o.gltf)!==null&&n!==void 0&&n.loadBuffers&&r.json.buffers&&await vJ(r,o,h),o!=null&&(i=o.gltf)!==null&&i!==void 0&&i.loadImages){const b=bJ(r,o,h);f.push(b)}const g=$X(r,o,h);return f.push(g),await Promise.all(f),o!=null&&(s=o.gltf)!==null&&s!==void 0&&s.postProcess?oJ(r,o):r}function _J(r,t,e,n){if(n.uri&&(r.baseUri=n.uri),t instanceof ArrayBuffer&&!dJ(t,e,n)&&(t=new TextDecoder().decode(t)),typeof t=="string")r.json=B6(t);else if(t instanceof ArrayBuffer){const a={};e=fJ(a,t,e,n.glb),Da(a.type==="glTF","Invalid GLB magic string ".concat(a.type)),r._glb=a,r.json=a.json}else Da(!1,"GLTF: must be ArrayBuffer or string");const i=r.json.buffers||[];if(r.buffers=new Array(i.length).fill(null),r._glb&&r._glb.header.hasBinChunk){const{binChunks:a}=r._glb;r.buffers[0]={arrayBuffer:a[0].arrayBuffer,byteOffset:a[0].byteOffset,byteLength:a[0].byteLength}}const s=r.json.images||[];r.images=new Array(s.length).fill({})}async function vJ(r,t,e){const n=r.json.buffers||[];for(let a=0;a<n.length;++a){const o=n[a];if(o.uri){var i,s;const{fetch:h}=e;Da(h);const f=aI(o.uri,t),g=await(e==null||(i=e.fetch)===null||i===void 0?void 0:i.call(e,f)),b=await(g==null||(s=g.arrayBuffer)===null||s===void 0?void 0:s.call(g));r.buffers[a]={arrayBuffer:b,byteOffset:0,byteLength:b.byteLength},delete o.uri}else r.buffers[a]===null&&(r.buffers[a]={arrayBuffer:new ArrayBuffer(o.byteLength),byteOffset:0,byteLength:o.byteLength})}}async function bJ(r,t,e){const n=wJ(r),i=r.json.images||[],s=[];for(const a of n)s.push(xJ(r,i[a],a,t,e));return await Promise.all(s)}function wJ(r){const t=new Set,e=r.json.textures||[];for(const n of e)n.source!==void 0&&t.add(n.source);return Array.from(t).sort()}async function xJ(r,t,e,n,i){const{fetch:s,parse:a}=i;let o;if(t.uri&&!t.hasOwnProperty("bufferView")){const f=aI(t.uri,n);o=await(await s(f)).arrayBuffer(),t.bufferView={data:o}}if(Number.isFinite(t.bufferView)){const f=hW(r.json,r.buffers,t.bufferView);o=I_(f.buffer,f.byteOffset,f.byteLength)}Da(o,"glTF image has no data");let h=await a(o,[XE,uW],{mimeType:t.mimeType,basis:n.basis||{format:oI()}},i);h&&h[0]&&(h={compressed:!0,mipmaps:!1,width:h[0].width,height:h[0].height,data:h[0]}),r.images=r.images||[],r.images[e]=h}const Xp={name:"glTF",id:"gltf",module:"gltf",version:W$,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:BJ,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0,postProcess:!0},log:console},deprecatedOptions:{fetchImages:"gltf.loadImages",createImages:"gltf.loadImages",decompress:"gltf.decompressMeshes",postProcess:"gltf.postProcess",gltf:{decompress:"gltf.decompressMeshes"}}};async function BJ(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=arguments.length>2?arguments[2]:void 0;t={...Xp.options,...t},t.gltf={...Xp.options.gltf,...t.gltf};const{byteOffset:n=0}=t;return await yJ({},r,n,t,e)}async function CJ(r){const t=[];return r.scenes.forEach(e=>{e.traverse(n=>{Object.values(n.model.getUniforms()).forEach(i=>{i.loaded===!1&&t.push(i)})})}),await EJ(()=>t.some(e=>!e.loaded))}async function EJ(r){for(;r();)await new Promise(t=>requestAnimationFrame(t))}const SJ=`#version 300 es
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
in vec3 instanceTranslation;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform mat4 sceneModelMatrix;
uniform bool composeModelMatrix;
in vec4 POSITION;

#ifdef HAS_UV
  in vec2 TEXCOORD_0;
#endif

#ifdef MODULE_PBR
  #ifdef HAS_NORMALS
    in vec4 NORMAL;
  #endif
#endif
out vec4 vColor;
#ifndef MODULE_PBR
  #ifdef HAS_UV
    out vec2 vTEXCOORD_0;
  #endif
#endif
void main(void) {
  #if defined(HAS_UV) && !defined(MODULE_PBR)
    vTEXCOORD_0 = TEXCOORD_0;
    geometry.uv = vTEXCOORD_0;
  #endif

  geometry.worldPosition = instancePositions;
  geometry.pickingColor = instancePickingColors;

  vec3 normal = vec3(0.0, 0.0, 1.0);
  #ifdef MODULE_PBR
    #ifdef HAS_NORMALS
      normal = instanceModelMatrix * (sceneModelMatrix * vec4(NORMAL.xyz, 0.0)).xyz;
    #endif
  #endif

  float originalSize = project_size_to_pixel(sizeScale);
  float clampedSize = clamp(originalSize, sizeMinPixels, sizeMaxPixels);

  vec3 pos = (instanceModelMatrix * (sceneModelMatrix * POSITION).xyz) * sizeScale * (clampedSize / originalSize) + instanceTranslation;
  if(composeModelMatrix) {
    DECKGL_FILTER_SIZE(pos, geometry);
    geometry.normal = project_normal(normal);
    geometry.worldPosition += pos;
    gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
  }
  else {
    pos = project_size(pos);
    DECKGL_FILTER_SIZE(pos, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, geometry.position);
    geometry.normal = project_normal(normal);
  }
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  #ifdef MODULE_PBR
    pbr_vPosition = geometry.position.xyz;
    #ifdef HAS_NORMALS
      pbr_vNormal = geometry.normal;
    #endif

    #ifdef HAS_UV
      pbr_vUV = TEXCOORD_0;
    #else
      pbr_vUV = vec2(0., 0.);
    #endif
    geometry.uv = pbr_vUV;
  #endif

  vColor = instanceColors;
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,TJ=`#version 300 es
uniform float opacity;
in vec4 vColor;

out vec4 fragmentColor;
#ifndef MODULE_PBR
  #if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
    in vec2 vTEXCOORD_0;
    uniform sampler2D u_BaseColorSampler;
  #endif
#endif

void main(void) {
  #ifdef MODULE_PBR
    fragmentColor = vColor * pbr_filterColor(vec4(0));
    geometry.uv = pbr_vUV;
  #else
    #if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
      fragmentColor = vColor * texture2D(u_BaseColorSampler, vTEXCOORD_0);
      geometry.uv = vTEXCOORD_0;
    #else
      fragmentColor = vColor;
    #endif
  #endif

  fragmentColor.a *= opacity;
  DECKGL_FILTER_COLOR(fragmentColor, geometry);
}
`,xI=[255,255,255,255],IJ={scenegraph:{type:"object",value:null,async:!0},getScene:r=>r&&r.scenes?typeof r.scene=="object"?r.scene:r.scenes[r.scene||0]:r,getAnimator:r=>r&&r.animator,_animations:null,sizeScale:{type:"number",value:1,min:0},sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},getPosition:{type:"accessor",value:r=>r.position},getColor:{type:"accessor",value:xI},_lighting:"flat",_imageBasedLightingEnvironment:null,getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},loaders:[Xp]};class jb extends zd{constructor(){super(...arguments),K(this,"state",void 0)}getShaders(){const t=[rb,nb];return this.props._lighting==="pbr"&&t.push(Hv),super.getShaders({vs:SJ,fs:TJ,modules:t})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),accessor:"getPosition",transition:!0},instanceColors:{type:5121,size:this.props.colorFormat.length,accessor:"getColor",normalized:!0,defaultValue:xI,transition:!0},instanceModelMatrix:M3})}updateState(t){super.updateState(t);const{props:e,oldProps:n}=t;e.scenegraph!==n.scenegraph?this._updateScenegraph():e._animations!==n._animations&&this._applyAnimationsProp(this.state.scenegraph,this.state.animator,e._animations)}finalizeState(t){super.finalizeState(t),this._deleteScenegraph()}get isLoaded(){var t;return((t=this.state)===null||t===void 0?void 0:t.scenegraph)&&super.isLoaded}_updateScenegraph(){const t=this.props,{gl:e}=this.context;let n=null;if(t.scenegraph instanceof Vd)n={scenes:[t.scenegraph]};else if(t.scenegraph&&!t.scenegraph.gltf){const o=t.scenegraph,h=$$(e,o,this._getModelOptions());n={gltf:o,...h},CJ(h).then(()=>this.setNeedsRedraw())}else t.scenegraph&&(Ln.deprecated("ScenegraphLayer.props.scenegraph","Use GLTFLoader instead of GLTFScenegraphLoader")(),n=t.scenegraph);const i={layer:this,gl:e},s=t.getScene(n,i),a=t.getAnimator(n,i);s instanceof Vd?(this._deleteScenegraph(),this._applyAllAttributes(s),this._applyAnimationsProp(s,a,t._animations),this.setState({scenegraph:s,animator:a})):s!==null&&Ln.warn("invalid scenegraph:",s)()}_applyAllAttributes(t){if(this.state.attributesAvailable){const e=this.getAttributeManager().getAttributes();t.traverse(n=>{this._setModelAttributes(n.model,e)})}}_applyAnimationsProp(t,e,n){if(!t||!e||!n)return;const i=e.getAnimations();Object.keys(n).sort().forEach(s=>{const a=n[s];if(s==="*")i.forEach(o=>{Object.assign(o,a)});else if(Number.isFinite(Number(s))){const o=Number(s);o>=0&&o<i.length?Object.assign(i[o],a):Ln.warn("animation ".concat(s," not found"))()}else{const o=i.find(h=>{let{name:f}=h;return f===s});o?Object.assign(o,a):Ln.warn("animation ".concat(s," not found"))()}})}_deleteScenegraph(){const{scenegraph:t}=this.state;t instanceof Vd&&t.delete()}_getModelOptions(){const{_imageBasedLightingEnvironment:t}=this.props;let e=null;return t&&(typeof t=="function"?e=t({gl:this.context.gl,layer:this}):e=t),{gl:this.context.gl,waitForFullLoad:!0,imageBasedLightingEnvironment:e,modelOptions:{isInstanced:!0,transpileToGLSL100:!yn(this.context.gl),...this.getShaders()},useTangents:!1}}updateAttributes(t){this.setState({attributesAvailable:!0}),this.state.scenegraph&&this.state.scenegraph.traverse(e=>{this._setModelAttributes(e.model,t)})}draw(t){let{moduleParameters:e=null,parameters:n={},context:i}=t;if(!this.state.scenegraph)return;this.props._animations&&this.state.animator&&(this.state.animator.animate(i.timeline.getTime()),this.setNeedsRedraw());const{viewport:s}=this.context,{sizeScale:a,sizeMinPixels:o,sizeMaxPixels:h,opacity:f,coordinateSystem:g}=this.props,b=this.getNumInstances();this.state.scenegraph.traverse((C,B)=>{let{worldMatrix:R}=B;C.model.setInstanceCount(b),C.updateModuleSettings(e),C.draw({parameters:n,uniforms:{sizeScale:a,opacity:f,sizeMinPixels:o,sizeMaxPixels:h,composeModelMatrix:P3(s,g),sceneModelMatrix:R,u_Camera:C.model.getUniforms().project_uCameraPosition}})})}}K(jb,"defaultProps",IJ),K(jb,"layerName","ScenegraphLayer");const LJ=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
uniform float sizeScale;
uniform bool composeModelMatrix;
uniform bool pickFeatureIds;
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec4 uvRegions;
in vec3 featureIdsPickingColors;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;

vec2 applyUVRegion(vec2 uv) {
  #ifdef HAS_UV_REGIONS
    return fract(uv) * (uvRegions.zw - uvRegions.xy) + uvRegions.xy;
  #else
    return uv;
  #endif
}

void main(void) {
  vec2 uv = applyUVRegion(texCoords);
  geometry.uv = uv;

  if (pickFeatureIds) {
    geometry.pickingColor = featureIdsPickingColors;
  } else {
    geometry.pickingColor = instancePickingColors;
  }

  vTexCoord = uv;
  cameraPosition = project_uCameraPosition;
  vColor = vec4(colors * instanceColors.rgb, instanceColors.a);

  vec3 pos = (instanceModelMatrix * positions) * sizeScale;
  vec3 projectedPosition = project_position(positions);
  position_commonspace = vec4(projectedPosition, 1.0);
  gl_Position = project_common_position_to_clipspace(position_commonspace);

  geometry.position = position_commonspace;
  normals_commonspace = project_normal(instanceModelMatrix * normals);
  geometry.normal = normals_commonspace;

  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  #ifdef MODULE_PBR
    pbr_vPosition = geometry.position.xyz;
    #ifdef HAS_NORMALS
      pbr_vNormal = geometry.normal;
    #endif

    #ifdef HAS_UV
      pbr_vUV = uv;
    #else
      pbr_vUV = vec2(0., 0.);
    #endif
    geometry.uv = pbr_vUV;
  #endif

  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,FJ=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs

precision highp float;

uniform bool hasTexture;
uniform sampler2D sampler;
uniform bool flatShading;
uniform float opacity;

in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;

out vec4 fragColor;

void main(void) {
  
#ifdef MODULE_PBR

  fragColor = vColor * pbr_filterColor(vec4(0));
  geometry.uv = pbr_vUV;
  fragColor.a *= opacity;

#else

  geometry.uv = vTexCoord;

  vec3 normal;
  if (flatShading) {
#ifdef DERIVATIVES_AVAILABLE
    normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
#else
    normal = vec3(0.0, 0.0, 1.0);
#endif
  } else {
    normal = normals_commonspace;
  }

  vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;
  vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
  fragColor = vec4(lightColor, color.a * opacity);

#endif

  DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;function MJ(r){r.COLOR_0||r.colors||(r.colors={constant:!0,value:new Float32Array([1,1,1])})}const PJ={pbrMaterial:{type:"object",value:null},featureIds:{type:"array",value:null,optional:!0}};class qb extends Fb{getShaders(){const t=super.getShaders();return t.modules.push(Hv),{...t,vs:LJ,fs:FJ}}initializeState(){const{featureIds:t}=this.props;super.initializeState();const e=this.getAttributeManager();t&&e.add({featureIdsPickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateFeatureIdsPickingColors}})}updateState(t){super.updateState(t);const{props:e,oldProps:n}=t;e.pbrMaterial!==n.pbrMaterial&&this.updatePbrMaterialUniforms(e.pbrMaterial)}draw(t){const{featureIds:e}=this.props;this.state.model&&(this.state.model.setUniforms({u_Camera:this.state.model.getUniforms().project_uCameraPosition,pickFeatureIds:!!e}),super.draw(t))}getModel(t){const{id:e,pbrMaterial:n}=this.props,i=this.parseMaterial(n,t);this.setState({materialParser:i});const s=this.getShaders();return MJ(t.attributes),new Fd(this.context.gl,{...this.getShaders(),id:e,geometry:t,defines:{...s.defines,...i==null?void 0:i.defines,HAS_UV_REGIONS:t.attributes.uvRegions},parameters:i==null?void 0:i.parameters,isInstanced:!0})}updatePbrMaterialUniforms(t){const{model:e}=this.state;if(e){const{mesh:n}=this.props,i=this.parseMaterial(t,n);this.setState({materialParser:i}),e.setUniforms(i.uniforms)}}parseMaterial(t,e){var n;const i=!!(t.pbrMetallicRoughness&&t.pbrMetallicRoughness.baseColorTexture);return(n=this.state.materialParser)===null||n===void 0||n.delete(),new V3(this.context.gl,{attributes:{NORMAL:e.attributes.normals,TEXCOORD_0:e.attributes.texCoords},material:{unlit:i,...t},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1})}calculateFeatureIdsPickingColors(t){const e=this.props.featureIds,n=new Uint8ClampedArray(e.length*t.size),i=[];for(let s=0;s<e.length;s++)this.encodePickingColor(e[s],i),n[s*3]=i[0],n[s*3+1]=i[1],n[s*3+2]=i[2];t.value=n}finalizeState(t){var e;super.finalizeState(t),(e=this.state.materialParser)===null||e===void 0||e.delete(),this.setState({materialParser:null})}}K(qb,"layerName","MeshLayer"),K(qb,"defaultProps",PJ);const UJ=6378137,RJ=6378137,DJ=6356752314245179e-9;function I0(r){return r}new ue;function OJ(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:I0;return"longitude"in r?(t[0]=e(r.longitude),t[1]=e(r.latitude),t[2]=r.height):"x"in r?(t[0]=e(r.x),t[1]=e(r.y),t[2]=r.z):(t[0]=e(r[0]),t[1]=e(r[1]),t[2]=r[2]),t}function NJ(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return OJ(r,t,ws._cartographicRadians?I0:W9)}function kJ(r,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:I0;return"longitude"in t?(t.longitude=e(r[0]),t.latitude=e(r[1]),t.height=r[2]):"x"in t?(t.x=e(r[0]),t.y=e(r[1]),t.z=r[2]):(t[0]=e(r[0]),t[1]=e(r[1]),t[2]=r[2]),t}function QJ(r,t){return kJ(r,t,ws._cartographicRadians?I0:X9)}const $d=new ue,zJ=new ue,HJ=new ue;function GJ(r,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];const{oneOverRadii:n,oneOverRadiiSquared:i,centerToleranceSquared:s}=t;$d.from(r);const a=$d.x,o=$d.y,h=$d.z,f=n.x,g=n.y,b=n.z,C=a*a*f*f,B=o*o*g*g,R=h*h*b*b,D=C+B+R,Q=Math.sqrt(1/D);if(!Number.isFinite(Q))return;const k=zJ;if(k.copy(r).scale(Q),D<s)return k.to(e);const j=i.x,et=i.y,st=i.z,mt=HJ;mt.set(k.x*j*2,k.y*et*2,k.z*st*2);let pt=(1-Q)*$d.len()/(.5*mt.len()),yt=0,ft,Dt,It,ut;do{pt-=yt,ft=1/(1+pt*j),Dt=1/(1+pt*et),It=1/(1+pt*st);const At=ft*ft,Bt=Dt*Dt,vt=It*It,ne=At*ft,ie=Bt*Dt,ae=vt*It;ut=C*At+B*Bt+R*vt-1;const ce=-2*(C*ne*j+B*ie*et+R*ae*st);yt=ut/ce}while(Math.abs(ut)>Fp.EPSILON12);return $d.scale([ft,Dt,It]).to(e)}const BI=1e-14,VJ=new ue,CI={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},Kb={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},Jp={east:new ue,north:new ue,up:new ue,west:new ue,south:new ue,down:new ue},jJ=new ue,qJ=new ue,KJ=new ue;function EI(r,t,e,n,i,s){const a=CI[t]&&CI[t][e];Lc(a&&(!n||n===a));let o,h,f;const g=VJ.copy(i);if(Fc(g.x,0,BI)&&Fc(g.y,0,BI)){const C=Math.sign(g.z);o=jJ.fromArray(Kb[t]),t!=="east"&&t!=="west"&&o.scale(C),h=qJ.fromArray(Kb[e]),e!=="east"&&e!=="west"&&h.scale(C),f=KJ.fromArray(Kb[n]),n!=="east"&&n!=="west"&&f.scale(C)}else{const{up:C,east:B,north:R}=Jp;B.set(-g.y,g.x,0).normalize(),r.geodeticSurfaceNormal(g,C),R.copy(C).cross(B);const{down:D,west:Q,south:k}=Jp;D.copy(C).scale(-1),Q.copy(B).scale(-1),k.copy(R).scale(-1),o=Jp[t],h=Jp[e],f=Jp[n]}return s[0]=o.x,s[1]=o.y,s[2]=o.z,s[3]=0,s[4]=h.x,s[5]=h.y,s[6]=h.z,s[7]=0,s[8]=f.x,s[9]=f.y,s[10]=f.z,s[11]=0,s[12]=g.x,s[13]=g.y,s[14]=g.z,s[15]=1,s}const L0=new ue,SI=new ue,$J=new ue,Rc=new ue,WJ=new ue,F0=new ue;class Ti{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;K(this,"radii",void 0),K(this,"radiiSquared",void 0),K(this,"radiiToTheFourth",void 0),K(this,"oneOverRadii",void 0),K(this,"oneOverRadiiSquared",void 0),K(this,"minimumRadius",void 0),K(this,"maximumRadius",void 0),K(this,"centerToleranceSquared",Fp.EPSILON1),K(this,"squaredXOverSquaredZ",void 0),Lc(t>=0),Lc(e>=0),Lc(n>=0),this.radii=new ue(t,e,n),this.radiiSquared=new ue(t*t,e*e,n*n),this.radiiToTheFourth=new ue(t*t*t*t,e*e*e*e,n*n*n*n),this.oneOverRadii=new ue(t===0?0:1/t,e===0?0:1/e,n===0?0:1/n),this.oneOverRadiiSquared=new ue(t===0?0:1/(t*t),e===0?0:1/(e*e),n===0?0:1/(n*n)),this.minimumRadius=Math.min(t,e,n),this.maximumRadius=Math.max(t,e,n),this.radiiSquared.z!==0&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}equals(t){return this===t||!!(t&&this.radii.equals(t.radii))}toString(){return this.radii.toString()}cartographicToCartesian(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];const n=SI,i=$J,[,,s]=t;this.geodeticSurfaceNormalCartographic(t,n),i.copy(this.radiiSquared).scale(n);const a=Math.sqrt(n.dot(i));return i.scale(1/a),n.scale(s),i.add(n),i.to(e)}cartesianToCartographic(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];F0.from(t);const n=this.scaleToGeodeticSurface(F0,Rc);if(!n)return;const i=this.geodeticSurfaceNormal(n,SI),s=WJ;s.copy(F0).subtract(n);const a=Math.atan2(i.y,i.x),o=Math.asin(i.z),h=Math.sign(Lv(s,F0))*D5(s);return QJ([a,o,h],e)}eastNorthUpToFixedFrame(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Cn;return EI(this,"east","north","up",t,e)}localFrameToFixedFrame(t,e,n,i){let s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:new Cn;return EI(this,t,e,n,i,s)}geocentricSurfaceNormal(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return L0.from(t).normalize().to(e)}geodeticSurfaceNormalCartographic(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];const n=NJ(t),i=n[0],s=n[1],a=Math.cos(s);return L0.set(a*Math.cos(i),a*Math.sin(i),Math.sin(s)).normalize(),L0.to(e)}geodeticSurfaceNormal(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return L0.from(t).scale(this.oneOverRadiiSquared).normalize().to(e)}scaleToGeodeticSurface(t,e){return GJ(t,this,e)}scaleToGeocentricSurface(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];Rc.from(t);const n=Rc.x,i=Rc.y,s=Rc.z,a=this.oneOverRadiiSquared,o=1/Math.sqrt(n*n*a.x+i*i*a.y+s*s*a.z);return Rc.multiplyScalar(o).to(e)}transformPositionToScaledSpace(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return Rc.from(t).scale(this.oneOverRadii).to(e)}transformPositionFromScaledSpace(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return Rc.from(t).scale(this.radii).to(e)}getSurfaceNormalIntersectionWithZAxis(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[0,0,0];Lc(Fc(this.radii.x,this.radii.y,Fp.EPSILON15)),Lc(this.radii.z>0),Rc.from(t);const i=Rc.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(i)>=this.radii.z-e))return Rc.set(0,0,i).to(n)}}K(Ti,"WGS84",new Ti(UJ,RJ,DJ));class XJ{constructor(t,e,n){K(this,"item",void 0),K(this,"previous",void 0),K(this,"next",void 0),this.item=t,this.previous=e,this.next=n}}class JJ{constructor(){K(this,"head",null),K(this,"tail",null),K(this,"_length",0)}get length(){return this._length}add(t){const e=new XJ(t,this.tail,null);return this.tail?(this.tail.next=e,this.tail=e):(this.head=e,this.tail=e),++this._length,e}remove(t){t&&(t.previous&&t.next?(t.previous.next=t.next,t.next.previous=t.previous):t.previous?(t.previous.next=null,this.tail=t.previous):t.next?(t.next.previous=null,this.head=t.next):(this.head=null,this.tail=null),t.next=null,t.previous=null,--this._length)}splice(t,e){t!==e&&(this.remove(e),this._insert(t,e))}_insert(t,e){const n=t.next;t.next=e,this.tail===t?this.tail=e:n.previous=e,e.next=n,e.previous=t,++this._length}}class YJ{constructor(){K(this,"_list",void 0),K(this,"_sentinel",void 0),K(this,"_trimTiles",void 0),this._list=new JJ,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(t){const e=t._cacheNode;e&&this._list.splice(this._sentinel,e)}add(t,e,n){e._cacheNode||(e._cacheNode=this._list.add(e),n&&n(t,e))}unloadTile(t,e,n){const i=e._cacheNode;i&&(this._list.remove(i),e._cacheNode=null,n&&n(t,e))}unloadTiles(t,e){const n=this._trimTiles;this._trimTiles=!1;const i=this._list,s=t.maximumMemoryUsage*1024*1024,a=this._sentinel;let o=i.head;for(;o!==a&&(t.gpuMemoryUsageInBytes>s||n);){const h=o.item;o=o.next,this.unloadTile(t,h,e)}}trim(){this._trimTiles=!0}}function ZJ(r,t){li(r),li(t);const{rtcCenter:e,gltfUpAxis:n}=t,{computedTransform:i,boundingVolume:{center:s}}=r;let a=new Cn(i);switch(e&&a.translate(e),n){case"Z":break;case"Y":const b=new Cn().rotateX(Math.PI/2);a=a.multiplyRight(b);break;case"X":const C=new Cn().rotateY(-Math.PI/2);a=a.multiplyRight(C);break}t.isQuantized&&a.translate(t.quantizedVolumeOffset).scale(t.quantizedVolumeScale);const o=new ue(s);t.cartesianModelMatrix=a,t.cartesianOrigin=o;const h=Ti.WGS84.cartesianToCartographic(o,new ue),g=Ti.WGS84.eastNorthUpToFixedFrame(o).invert();t.cartographicModelMatrix=g.multiplyRight(a),t.cartographicOrigin=h,t.coordinateSystem||(t.modelMatrix=t.cartographicModelMatrix)}const TI=new ue,$b=new ue,Wb=new rc([new Uc,new Uc,new Uc,new Uc,new Uc,new Uc]);function tY(r,t){const{cameraDirection:e,cameraUp:n,height:i}=r,{metersPerUnit:s}=r.distanceScales,a=M0(r,r.center),o=Ti.WGS84.eastNorthUpToFixedFrame(a),h=r.unprojectPosition(r.cameraPosition),f=Ti.WGS84.cartographicToCartesian(h,new ue),g=new ue(o.transformAsVector(new ue(e).scale(s))).normalize(),b=new ue(o.transformAsVector(new ue(n).scale(s))).normalize();rY(r);const C=r.constructor,{longitude:B,latitude:R,width:D,bearing:Q,zoom:k}=r,j=new C({longitude:B,latitude:R,height:i,width:D,bearing:Q,zoom:k,pitch:0});return{camera:{position:f,direction:g,up:b},viewport:r,topDownViewport:j,height:i,cullingVolume:Wb,frameNumber:t,sseDenominator:1.15}}function eY(r,t,e){if(e===0||r.length<=e)return[r,[]];const n=[],{longitude:i,latitude:s}=t.viewport;for(const[f,g]of r.entries()){const[b,C]=g.header.mbs,B=Math.abs(i-b),R=Math.abs(s-C),D=Math.sqrt(R*R+B*B);n.push([f,D])}const a=n.sort((f,g)=>f[1]-g[1]),o=[];for(let f=0;f<e;f++)o.push(r[a[f][0]]);const h=[];for(let f=e;f<a.length;f++)h.push(r[a[f][0]]);return[o,h]}function rY(r){const t=r.getFrustumPlanes(),e=II(t.near,r.cameraPosition),n=M0(r,e),i=M0(r,r.cameraPosition,$b);let s=0;Wb.planes[s++].fromPointNormal(n,TI.copy(n).subtract(i));for(const a in t){if(a==="near")continue;const o=t[a],h=II(o,e,$b),f=M0(r,h,$b);Wb.planes[s++].fromPointNormal(f,TI.copy(n).subtract(f))}}function II(r,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new ue;const n=r.normal.dot(t);return e.copy(r.normal).scale(r.distance-n).add(t),e}function M0(r,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new ue;const n=r.unprojectPosition(t);return Ti.WGS84.cartographicToCartesian(n,e)}const nY=6378137,iY=6378137,Xb=6356752314245179e-9,LI=new ue;function sY(r,t){if(r instanceof Vp){const{halfAxes:e}=r,n=aY(e);return Math.log2(Xb/(n+t[2]))}else if(r instanceof Gp){const{radius:e}=r;return Math.log2(Xb/(e+t[2]))}else if(r.width&&r.height){const{width:e,height:n}=r,i=Math.log2(nY/e),s=Math.log2(iY/n);return(i+s)/2}return 1}function FI(r,t,e){const n=Ti.WGS84.cartographicToCartesian([r.xmax,r.ymax,r.zmax],new ue),i=Math.sqrt(Math.pow(n[0]-e[0],2)+Math.pow(n[1]-e[1],2)+Math.pow(n[2]-e[2],2));return Math.log2(Xb/(i+t[2]))}function oY(r,t,e){const[n,i,s,a]=r;return FI({xmin:n,xmax:s,ymin:i,ymax:a,zmin:0,zmax:0},t,e)}function aY(r){r.getColumn(0,LI);const t=r.getColumn(1),e=r.getColumn(2);return LI.add(t).add(e).len()}const Oa={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5},SA={ADD:1,REPLACE:2},Wd={EMPTY:"empty",SCENEGRAPH:"scenegraph",POINTCLOUD:"pointcloud",MESH:"mesh"},ic={I3S:"I3S",TILES3D:"TILES3D"},P0={GEOMETRIC_ERROR:"geometricError",MAX_SCREEN_THRESHOLD:"maxScreenThreshold"},cY={NOT_COMPUTED:-1,USE_OPTIMIZATION:1,SKIP_OPTIMIZATION:0};function MI(r){return r!=null}const ho=new ue,U0=new ue,lY=new ue,AY=new ue;function Jb(r,t,e){if(li(r,"3D Tile: boundingVolume must be defined"),r.box)return hY(r.box,t,e);if(r.region){const[n,i,s,a,o,h]=r.region,f=Ti.WGS84.cartographicToCartesian([xA(n),xA(a),o],lY),g=Ti.WGS84.cartographicToCartesian([xA(s),xA(i),h],AY),b=new ue().addVectors(f,g).multiplyScalar(.5),C=new ue().subVectors(f,g).len()/2;return PI([b[0],b[1],b[2],C],new Cn)}if(r.sphere)return PI(r.sphere,t,e);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function uY(r,t){if(r.box)return dY(t);if(r.region){const[e,n,i,s,a,o]=r.region;return[[xA(e),xA(n),a],[xA(i),xA(s),o]]}if(r.sphere)return fY(t);throw new Error("Unkown boundingVolume type")}function hY(r,t,e){const n=new ue(r[0],r[1],r[2]);t.transform(n,n);let i=[];if(r.length===10){const f=r.slice(3,6),g=new Lp;g.fromArray(r,6);const b=new ue([1,0,0]),C=new ue([0,1,0]),B=new ue([0,0,1]);b.transformByQuaternion(g),b.scale(f[0]),C.transformByQuaternion(g),C.scale(f[1]),B.transformByQuaternion(g),B.scale(f[2]),i=[...b.toArray(),...C.toArray(),...B.toArray()]}else i=[...r.slice(3,6),...r.slice(6,9),...r.slice(9,12)];const s=t.transformAsVector(i.slice(0,3)),a=t.transformAsVector(i.slice(3,6)),o=t.transformAsVector(i.slice(6,9)),h=new Ni([s[0],s[1],s[2],a[0],a[1],a[2],o[0],o[1],o[2]]);return MI(e)?(e.center=n,e.halfAxes=h,e):new Vp(n,h)}function PI(r,t,e){const n=new ue(r[0],r[1],r[2]);t.transform(n,n);const i=t.getScale(U0),s=Math.max(Math.max(i[0],i[1]),i[2]),a=r[3]*s;return MI(e)?(e.center=n,e.radius=a,e):new Gp(n,a)}function dY(r){const t=UI(),{halfAxes:e}=r,n=new ue(e.getColumn(0)),i=new ue(e.getColumn(1)),s=new ue(e.getColumn(2));for(let a=0;a<2;a++){for(let o=0;o<2;o++){for(let h=0;h<2;h++)ho.copy(r.center),ho.add(n),ho.add(i),ho.add(s),RI(t,ho),s.negate();i.negate()}n.negate()}return t}function fY(r){const t=UI(),{center:e,radius:n}=r,i=Ti.WGS84.scaleToGeodeticSurface(e,ho);let s;i?s=Ti.WGS84.geodeticSurfaceNormal(i):s=new ue(0,0,1);let a=new ue(s[2],-s[1],0);a.len()>0?a.normalize():a=new ue(0,1,0);const o=a.clone().cross(s);for(const h of[a,o,s]){U0.copy(h).scale(n);for(let f=0;f<2;f++)ho.copy(e),ho.add(U0),RI(t,ho),U0.negate()}return t}function UI(){return[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]]}function RI(r,t){Ti.WGS84.cartesianToCartographic(t,ho),r[0][0]=Math.min(r[0][0],ho[0]),r[0][1]=Math.min(r[0][1],ho[1]),r[0][2]=Math.min(r[0][2],ho[2]),r[1][0]=Math.max(r[1][0],ho[0]),r[1][1]=Math.max(r[1][1],ho[1]),r[1][2]=Math.max(r[1][2],ho[2])}new ue,new ue,new Cn,new ue,new ue,new ue;function pY(r,t){const e=r*t;return 1-Math.exp(-(e*e))}function gY(r,t){if(r.dynamicScreenSpaceError&&r.dynamicScreenSpaceErrorComputedDensity){const e=r.dynamicScreenSpaceErrorComputedDensity,n=r.dynamicScreenSpaceErrorFactor;return pY(t,e)*n}return 0}function mY(r,t,e){const n=r.tileset,i=r.parent&&r.parent.lodMetricValue||r.lodMetricValue,s=e?i:r.lodMetricValue;if(s===0)return 0;const a=Math.max(r._distanceToCamera,1e-7),{height:o,sseDenominator:h}=t,{viewDistanceScale:f}=n.options;let g=s*o*(f||1)/(a*h);return g-=gY(n,a),g}const Yb=new ue,DI=new ue,xu=new ue,OI=new ue,yY=new ue,Zb=new Cn,NI=new Cn;function _Y(r,t){if(r.lodMetricValue===0||isNaN(r.lodMetricValue))return"DIG";const e=2*kI(r,t);return e<2?"OUT":!r.header.children||e<=r.lodMetricValue?"DRAW":r.header.children?"DIG":"OUT"}function kI(r,t){const{topDownViewport:e}=t,n=r.header.mbs[1],i=r.header.mbs[0],s=r.header.mbs[2],a=r.header.mbs[3],o=[...r.boundingVolume.center],h=e.unprojectPosition(e.cameraPosition);Ti.WGS84.cartographicToCartesian(h,Yb),DI.copy(Yb).subtract(o).normalize(),Ti.WGS84.eastNorthUpToFixedFrame(o,Zb),NI.copy(Zb).invert(),xu.copy(Yb).transform(NI);const f=Math.sqrt(xu[0]*xu[0]+xu[1]*xu[1]),g=f*f/xu[2];OI.copy([xu[0],xu[1],g]);const C=OI.transform(Zb).subtract(o).normalize(),R=DI.cross(C).normalize().scale(a).add(o),D=Ti.WGS84.cartesianToCartographic(R),Q=e.project([i,n,s]),k=e.project(D);return yY.copy(Q).subtract(k).magnitude()}function vY(r){return{assetGltfUpAxis:r.asset&&r.asset.gltfUpAxis||"Y"}}class QI{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;K(this,"_map",new Map),K(this,"_array",void 0),K(this,"_length",void 0),this._array=new Array(t),this._length=t}get length(){return this._length}set length(t){this._length=t,t>this._array.length&&(this._array.length=t)}get values(){return this._array}get(t){return li(t<this._array.length),this._array[t]}set(t,e){li(t>=0),t>=this.length&&(this.length=t+1),this._map.has(this._array[t])&&this._map.delete(this._array[t]),this._array[t]=e,this._map.set(e,t)}delete(t){const e=this._map.get(t);e>=0&&(this._array.splice(e,1),this._map.delete(t),this.length--)}peek(){return this._array[this._length-1]}push(t){if(!this._map.has(t)){const e=this.length++;this._array[e]=t,this._map.set(t,e)}}pop(){const t=this._array[--this.length];return this._map.delete(t),t}reserve(t){li(t>=0),t>this._array.length&&(this._array.length=t)}resize(t){li(t>=0),this.length=t}trim(t){t==null&&(t=this.length),this._array.length=t}reset(){this._array=[],this._map=new Map,this._length=0}find(t){return this._map.has(t)}}const bY={loadSiblings:!1,skipLevelOfDetail:!1,maximumScreenSpaceError:2,updateTransforms:!0,onTraversalEnd:()=>{},viewportTraversersMap:{},basePath:""};class R0{traversalFinished(t){return!0}constructor(t){K(this,"options",void 0),K(this,"root",null),K(this,"selectedTiles",{}),K(this,"requestedTiles",{}),K(this,"emptyTiles",{}),K(this,"lastUpdate",new Date().getTime()),K(this,"updateDebounceTime",1e3),K(this,"_traversalStack",new QI),K(this,"_emptyTraversalStack",new QI),K(this,"_frameNumber",null),this.options={...bY,...t}}traverse(t,e,n){this.root=t,this.options={...this.options,...n},this.reset(),this.updateTile(t,e),this._frameNumber=e.frameNumber,this.executeTraversal(t,e)}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}executeTraversal(t,e){const n=this._traversalStack;for(t._selectionDepth=1,n.push(t);n.length>0;){const s=n.pop();let a=!1;this.canTraverse(s,e)&&(this.updateChildTiles(s,e),a=this.updateAndPushChildren(s,e,n,s.hasRenderContent?s._selectionDepth+1:s._selectionDepth));const o=s.parent,h=!!(!o||o._shouldRefine),f=!a;s.hasRenderContent?s.refine===SA.ADD?(this.loadTile(s,e),this.selectTile(s,e)):s.refine===SA.REPLACE&&(this.loadTile(s,e),f&&this.selectTile(s,e)):(this.emptyTiles[s.id]=s,this.loadTile(s,e),f&&this.selectTile(s,e)),this.touchTile(s,e),s._shouldRefine=a&&h}const i=new Date().getTime();(this.traversalFinished(e)||i-this.lastUpdate>this.updateDebounceTime)&&(this.lastUpdate=i,this.options.onTraversalEnd(e))}updateChildTiles(t,e){const n=t.children;for(const i of n)this.updateTile(i,e)}updateAndPushChildren(t,e,n,i){const{loadSiblings:s,skipLevelOfDetail:a}=this.options,o=t.children;o.sort(this.compareDistanceToCamera.bind(this));const h=t.refine===SA.REPLACE&&t.hasRenderContent&&!a;let f=!1,g=!0;for(const b of o)if(b._selectionDepth=i,b.isVisibleAndInRequestVolume?(n.find(b)&&n.delete(b),n.push(b),f=!0):(h||s)&&(this.loadTile(b,e),this.touchTile(b,e)),h){let C;if(b._inRequestVolume?b.hasRenderContent?C=b.contentAvailable:C=this.executeEmptyTraversal(b,e):C=!1,g=g&&C,!g)return!1}return f||(g=!1),g}updateTile(t,e){this.updateTileVisibility(t,e)}selectTile(t,e){this.shouldSelectTile(t)&&(t._selectedFrame=e.frameNumber,this.selectedTiles[t.id]=t)}loadTile(t,e){this.shouldLoadTile(t)&&(t._requestedFrame=e.frameNumber,t._priority=t._getPriority(),this.requestedTiles[t.id]=t)}touchTile(t,e){t.tileset._cache.touch(t),t._touchedFrame=e.frameNumber}canTraverse(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;return t.hasChildren?t.hasTilesetContent?!t.contentExpired:!i&&!t.isVisibleAndInRequestVolume?!1:this.shouldRefine(t,e,n):!1}shouldLoadTile(t){return t.hasUnloadedContent||t.contentExpired}shouldSelectTile(t){return t.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=t._screenSpaceError;return n&&(i=t.getScreenSpaceError(e,!0)),i>this.options.maximumScreenSpaceError}updateTileVisibility(t,e){const n=[];if(this.options.viewportTraversersMap)for(const i in this.options.viewportTraversersMap)this.options.viewportTraversersMap[i]===e.viewport.id&&n.push(i);else n.push(e.viewport.id);t.updateVisibility(e,n)}compareDistanceToCamera(t,e){return t._distanceToCamera-e._distanceToCamera}anyChildrenVisible(t,e){let n=!1;for(const i of t.children)i.updateVisibility(e),n=n||i.isVisibleAndInRequestVolume;return n}executeEmptyTraversal(t,e){let n=!0;const i=this._emptyTraversalStack;for(i.push(t);i.length>0&&n;){const s=i.pop();if(this.updateTile(s,e),s.isVisibleAndInRequestVolume||this.loadTile(s,e),this.touchTile(s,e),!s.hasRenderContent&&this.canTraverse(s,e,!1,!0)){const o=s.children;for(const h of o)i.find(h)&&i.delete(h),i.push(h)}else!s.contentAvailable&&!s.hasEmptyContent&&(n=!1)}return n}}const zI=new ue;function wY(r){return r!=null}class tw{constructor(t,e,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"";K(this,"tileset",void 0),K(this,"header",void 0),K(this,"id",void 0),K(this,"url",void 0),K(this,"parent",void 0),K(this,"refine",void 0),K(this,"type",void 0),K(this,"contentUrl",void 0),K(this,"lodMetricType","geometricError"),K(this,"lodMetricValue",0),K(this,"boundingVolume",null),K(this,"content",null),K(this,"contentState",Oa.UNLOADED),K(this,"gpuMemoryUsageInBytes",0),K(this,"children",[]),K(this,"depth",0),K(this,"viewportIds",[]),K(this,"transform",new Cn),K(this,"extensions",null),K(this,"implicitTiling",null),K(this,"userData",{}),K(this,"computedTransform",void 0),K(this,"hasEmptyContent",!1),K(this,"hasTilesetContent",!1),K(this,"traverser",new R0({})),K(this,"_cacheNode",null),K(this,"_frameNumber",null),K(this,"_expireDate",null),K(this,"_expiredContent",null),K(this,"_boundingBox",void 0),K(this,"_distanceToCamera",0),K(this,"_screenSpaceError",0),K(this,"_visibilityPlaneMask",void 0),K(this,"_visible",void 0),K(this,"_contentBoundingVolume",void 0),K(this,"_viewerRequestVolume",void 0),K(this,"_initialTransform",new Cn),K(this,"_priority",0),K(this,"_selectedFrame",0),K(this,"_requestedFrame",0),K(this,"_selectionDepth",0),K(this,"_touchedFrame",0),K(this,"_centerZDepth",0),K(this,"_shouldRefine",!1),K(this,"_stackLength",0),K(this,"_visitedFrame",0),K(this,"_inRequestVolume",!1),K(this,"_lodJudge",null),this.header=e,this.tileset=t,this.id=i||e.id,this.url=e.url,this.parent=n,this.refine=this._getRefine(e.refine),this.type=e.type,this.contentUrl=e.contentUrl,this._initializeLodMetric(e),this._initializeTransforms(e),this._initializeBoundingVolumes(e),this._initializeContent(e),this._initializeRenderingState(e),Object.seal(this)}destroy(){this.header=null}isDestroyed(){return this.header===null}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return this.contentState===Oa.READY||this.hasEmptyContent}get contentAvailable(){return!!(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return this.contentState===Oa.UNLOADED}get contentExpired(){return this.contentState===Oa.EXPIRED}get contentFailed(){return this.contentState===Oa.FAILED}get distanceToCamera(){return this._distanceToCamera}get screenSpaceError(){return this._screenSpaceError}get boundingBox(){return this._boundingBox||(this._boundingBox=uY(this.header.boundingVolume,this.boundingVolume)),this._boundingBox}getScreenSpaceError(t,e){switch(this.tileset.type){case ic.I3S:return kI(this,t);case ic.TILES3D:return mY(this,t,e);default:throw new Error("Unsupported tileset type")}}unselect(){this._selectedFrame=0}_getGpuMemoryUsageInBytes(){return this.content.gpuMemoryUsageInBytes||this.content.byteLength||0}_getPriority(){const t=this.tileset._traverser,{skipLevelOfDetail:e}=t.options,n=this.refine===SA.ADD||e;if(n&&!this.isVisible&&this._visible!==void 0||this.tileset._frameNumber-this._touchedFrame>=1||this.contentState===Oa.UNLOADED)return-1;const i=this.parent,a=i&&(!n||this._screenSpaceError===0||i.hasTilesetContent)?i._screenSpaceError:this._screenSpaceError,o=t.root?t.root._screenSpaceError:0;return Math.max(o-a,0)}async loadContent(){if(this.hasEmptyContent)return!1;if(this.content)return!0;this.contentExpired&&(this._expireDate=null),this.contentState=Oa.LOADING;const e=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));if(!e)return this.contentState=Oa.UNLOADED,!1;try{const n=this.tileset.getTileUrl(this.contentUrl),i=this.tileset.loader,s={...this.tileset.loadOptions,[i.id]:{...this.tileset.loadOptions[i.id],isTileset:this.type==="json",...this._getLoaderSpecificOptions(i.id)}};return this.content=await uu(n,i,s),this.tileset.options.contentLoader&&await this.tileset.options.contentLoader(this),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=Oa.READY,this._onContentLoaded(),!0}catch(n){throw this.contentState=Oa.FAILED,n}finally{e.done()}}unloadContent(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=Oa.UNLOADED,!0}updateVisibility(t,e){if(this._frameNumber===t.frameNumber)return;const n=this.parent,i=n?n._visibilityPlaneMask:rc.MASK_INDETERMINATE;if(this.tileset._traverser.options.updateTransforms){const s=n?n.computedTransform:this.tileset.modelMatrix;this._updateTransform(s)}this._distanceToCamera=this.distanceToTile(t),this._screenSpaceError=this.getScreenSpaceError(t,!1),this._visibilityPlaneMask=this.visibility(t,i),this._visible=this._visibilityPlaneMask!==rc.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(t),this._frameNumber=t.frameNumber,this.viewportIds=e}visibility(t,e){const{cullingVolume:n}=t,{boundingVolume:i}=this;return n.computeVisibilityWithPlaneMask(i,e)}contentVisibility(){return!0}distanceToTile(t){const e=this.boundingVolume;return Math.sqrt(Math.max(e.distanceSquaredTo(t.camera.position),0))}cameraSpaceZDepth(t){let{camera:e}=t;const n=this.boundingVolume;return zI.subVectors(n.center,e.position),e.direction.dot(zI)}insideViewerRequestVolume(t){const e=this._viewerRequestVolume;return!e||e.distanceSquaredTo(t.camera.position)<=0}updateExpiration(){if(wY(this._expireDate)&&this.contentReady&&!this.hasEmptyContent){const t=Date.now();Date.lessThan(this._expireDate,t)&&(this.contentState=Oa.EXPIRED,this._expiredContent=this.content)}}get extras(){return this.header.extras}_initializeLodMetric(t){"lodMetricType"in t?this.lodMetricType=t.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in t?this.lodMetricValue=t.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}_initializeTransforms(t){this.transform=t.transform?new Cn(t.transform):new Cn;const e=this.parent,n=this.tileset,i=e&&e.computedTransform?e.computedTransform.clone():n.modelMatrix.clone();this.computedTransform=new Cn(i).multiplyRight(this.transform);const s=e&&e._initialTransform?e._initialTransform.clone():new Cn;this._initialTransform=new Cn(s).multiplyRight(this.transform)}_initializeBoundingVolumes(t){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(t)}_initializeContent(t){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=Oa.UNLOADED,this.hasTilesetContent=!1,t.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}_initializeRenderingState(t){this.depth=t.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=rc.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}_getRefine(t){return t||this.parent&&this.parent.refine||SA.REPLACE}_isTileset(){return this.contentUrl.indexOf(".json")!==-1}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0;break}this._isTileset()?this.hasTilesetContent=!0:this.gpuMemoryUsageInBytes=this._getGpuMemoryUsageInBytes()}_updateBoundingVolume(t){this.boundingVolume=Jb(t.boundingVolume,this.computedTransform,this.boundingVolume);const e=t.content;e&&(e.boundingVolume&&(this._contentBoundingVolume=Jb(e.boundingVolume,this.computedTransform,this._contentBoundingVolume)),t.viewerRequestVolume&&(this._viewerRequestVolume=Jb(t.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}_updateTransform(){const e=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:new Cn).clone().multiplyRight(this.transform);e.equals(this.computedTransform)||(this.computedTransform=e,this._updateBoundingVolume(this.header))}_getLoaderSpecificOptions(t){switch(t){case"i3s":return{...this.tileset.options.i3s,_tileOptions:{attributeUrls:this.header.attributeUrls,textureUrl:this.header.textureUrl,textureFormat:this.header.textureFormat,textureLoaderOptions:this.header.textureLoaderOptions,materialDefinition:this.header.materialDefinition,isDracoGeometry:this.header.isDracoGeometry,mbs:this.header.mbs},_tilesetOptions:{store:this.tileset.tileset.store,attributeStorageInfo:this.tileset.tileset.attributeStorageInfo,fields:this.tileset.tileset.fields},isTileHeader:!1};case"3d-tiles":case"cesium-ion":default:return vY(this.tileset.tileset)}}}class xY extends R0{compareDistanceToCamera(t,e){return e._distanceToCamera===0&&t._distanceToCamera===0?e._centerZDepth-t._centerZDepth:e._distanceToCamera-t._distanceToCamera}updateTileVisibility(t,e){if(super.updateTileVisibility(t,e),!t.isVisibleAndInRequestVolume)return;const n=t.children.length>0;if(t.hasTilesetContent&&n){const a=t.children[0];this.updateTileVisibility(a,e),t._visible=a._visible;return}if(this.meetsScreenSpaceErrorEarly(t,e)){t._visible=!1;return}const i=t.refine===SA.REPLACE,s=t._optimChildrenWithinParent===cY.USE_OPTIMIZATION;if(i&&s&&n&&!this.anyChildrenVisible(t,e)){t._visible=!1;return}}meetsScreenSpaceErrorEarly(t,e){const{parent:n}=t;return!n||n.hasTilesetContent||n.refine!==SA.ADD?!1:!this.shouldRefine(t,e,!0)}}class BY{constructor(){K(this,"frameNumberMap",new Map)}register(t,e){const n=this.frameNumberMap.get(t)||new Map,i=n.get(e)||0;n.set(e,i+1),this.frameNumberMap.set(t,n)}deregister(t,e){const n=this.frameNumberMap.get(t);if(!n)return;const i=n.get(e)||1;n.set(e,i-1)}isZero(t,e){var n;return(((n=this.frameNumberMap.get(t))===null||n===void 0?void 0:n.get(e))||0)===0}}const ew={REQUESTED:"REQUESTED",COMPLETED:"COMPLETED",ERROR:"ERROR"};class CY{constructor(){K(this,"_statusMap",void 0),K(this,"pendingTilesRegister",new BY),this._statusMap={}}add(t,e,n,i){if(!this._statusMap[e]){const{frameNumber:s,viewport:{id:a}}=i;this._statusMap[e]={request:t,callback:n,key:e,frameState:i,status:ew.REQUESTED},this.pendingTilesRegister.register(a,s),t().then(o=>{this._statusMap[e].status=ew.COMPLETED;const{frameNumber:h,viewport:{id:f}}=this._statusMap[e].frameState;this.pendingTilesRegister.deregister(f,h),this._statusMap[e].callback(o,i)}).catch(o=>{this._statusMap[e].status=ew.ERROR;const{frameNumber:h,viewport:{id:f}}=this._statusMap[e].frameState;this.pendingTilesRegister.deregister(f,h),n(o)})}}update(t,e){if(this._statusMap[t]){const{frameNumber:n,viewport:{id:i}}=this._statusMap[t].frameState;this.pendingTilesRegister.deregister(i,n);const{frameNumber:s,viewport:{id:a}}=e;this.pendingTilesRegister.register(a,s),this._statusMap[t].frameState=e}}find(t){return this._statusMap[t]}hasPendingTiles(t,e){return!this.pendingTilesRegister.isZero(t,e)}}class EY extends R0{constructor(t){super(t),K(this,"_tileManager",void 0),this._tileManager=new CY}traversalFinished(t){return!this._tileManager.hasPendingTiles(t.viewport.id,this._frameNumber||0)}shouldRefine(t,e){return t._lodJudge=_Y(t,e),t._lodJudge==="DIG"}updateChildTiles(t,e){const n=t.header.children||[],i=t.children,s=t.tileset;for(const a of n){const o="".concat(a.id,"-").concat(e.viewport.id),h=i&&i.find(f=>f.id===o);if(h)h&&this.updateTile(h,e);else{let f=()=>this._loadTile(a.id,s);this._tileManager.find(o)?this._tileManager.update(o,e):(s.tileset.nodePages&&(f=()=>s.tileset.nodePagesTile.formTileFromNodePages(a.id)),this._tileManager.add(f,o,b=>this._onTileLoad(b,t,o),e))}}return!1}async _loadTile(t,e){const{loader:n}=e,i=e.getTileUrl("".concat(e.url,"/nodes/").concat(t)),s={...e.loadOptions,i3s:{...e.loadOptions.i3s,isTileHeader:!0}};return await uu(i,n,s)}_onTileLoad(t,e,n){const i=new tw(e.tileset,t,e,n);e.children.push(i);const s=this._tileManager.find(i.id).frameState;this.updateTile(i,s),this._frameNumber===s.frameNumber&&(this.traversalFinished(s)||new Date().getTime()-this.lastUpdate>this.updateDebounceTime)&&this.executeTraversal(i,s)}}const SY={description:"",ellipsoid:Ti.WGS84,modelMatrix:new Cn,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,maximumTilesSelected:0,debounceTime:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{},onTraversalComplete:r=>r,contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},D0="Tiles In Tileset(s)",rw="Tiles In Memory",HI="Tiles In View",GI="Tiles To Render",VI="Tiles Loaded",nw="Tiles Loading",jI="Tiles Unloaded",qI="Failed Tile Loads",KI="Points/Vertices",iw="Tile Memory Use";class TY{constructor(t,e){K(this,"options",void 0),K(this,"loadOptions",void 0),K(this,"type",void 0),K(this,"tileset",void 0),K(this,"loader",void 0),K(this,"url",void 0),K(this,"basePath",void 0),K(this,"modelMatrix",void 0),K(this,"ellipsoid",void 0),K(this,"lodMetricType",void 0),K(this,"lodMetricValue",void 0),K(this,"refine",void 0),K(this,"root",null),K(this,"roots",{}),K(this,"asset",{}),K(this,"description",""),K(this,"properties",void 0),K(this,"extras",null),K(this,"attributions",{}),K(this,"credits",{}),K(this,"stats",void 0),K(this,"contentFormats",{draco:!1,meshopt:!1,dds:!1,ktx2:!1}),K(this,"cartographicCenter",null),K(this,"cartesianCenter",null),K(this,"zoom",1),K(this,"boundingVolume",null),K(this,"dynamicScreenSpaceErrorComputedDensity",0),K(this,"maximumMemoryUsage",32),K(this,"gpuMemoryUsageInBytes",0),K(this,"_frameNumber",0),K(this,"_queryParams",{}),K(this,"_extensionsUsed",[]),K(this,"_tiles",{}),K(this,"_pendingCount",0),K(this,"selectedTiles",[]),K(this,"traverseCounter",0),K(this,"geometricError",0),K(this,"lastUpdatedVieports",null),K(this,"_requestedTiles",[]),K(this,"_emptyTiles",[]),K(this,"frameStateData",{}),K(this,"_traverser",void 0),K(this,"_cache",new YJ),K(this,"_requestScheduler",void 0),K(this,"updatePromise",null),K(this,"tilesetInitializationPromise",void 0),this.options={...SY,...e},this.tileset=t,this.loader=t.loader,this.type=t.type,this.url=t.url,this.basePath=t.basePath||L_(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=t.lodMetricType,this.lodMetricValue=t.lodMetricValue,this.refine=t.root.refine,this.loadOptions=this.options.loadOptions||{},this._traverser=this._initializeTraverser(),this._requestScheduler=new R6({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this.stats=new gE({id:this.url}),this._initializeStats(),this.tilesetInitializationPromise=this._initializeTileSet(t)}destroy(){this._destroy()}isLoaded(){return this._pendingCount===0&&this._frameNumber!==0&&this._requestedTiles.length===0}get tiles(){return Object.values(this._tiles)}get frameNumber(){return this._frameNumber}get queryParams(){return new URLSearchParams(this._queryParams).toString()}setProps(t){this.options={...this.options,...t}}setOptions(t){this.options={...this.options,...t}}getTileUrl(t){return t.startsWith("data:")?t:"".concat(t).concat(t.includes("?")?"&":"?").concat(this.queryParams)}hasExtension(t){return this._extensionsUsed.indexOf(t)>-1}update(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;this.tilesetInitializationPromise.then(()=>{!t&&this.lastUpdatedVieports?t=this.lastUpdatedVieports:this.lastUpdatedVieports=t,t&&this.doUpdate(t)})}async selectTiles(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return await this.tilesetInitializationPromise,t&&(this.lastUpdatedVieports=t),this.updatePromise||(this.updatePromise=new Promise(e=>{setTimeout(()=>{this.lastUpdatedVieports&&this.doUpdate(this.lastUpdatedVieports),e(this._frameNumber),this.updatePromise=null},this.options.debounceTime)})),this.updatePromise}doUpdate(t){if("loadTiles"in this.options&&!this.options.loadTiles||this.traverseCounter>0)return;const e=t instanceof Array?t:[t];this._cache.reset(),this._frameNumber++,this.traverseCounter=e.length;const n=[];for(const i of e){const s=i.id;this._needTraverse(s)?n.push(s):this.traverseCounter--}for(const i of e){const s=i.id;if(this.roots[s]||(this.roots[s]=this._initializeTileHeaders(this.tileset,null)),!n.includes(s))continue;const a=tY(i,this._frameNumber);this._traverser.traverse(this.roots[s],a,this.options)}}_needTraverse(t){let e=t;return this.options.viewportTraversersMap&&(e=this.options.viewportTraversersMap[t]),e===t}_onTraversalEnd(t){const e=t.viewport.id;this.frameStateData[e]||(this.frameStateData[e]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});const n=this.frameStateData[e],i=Object.values(this._traverser.selectedTiles),[s,a]=eY(i,t,this.options.maximumTilesSelected);n.selectedTiles=s;for(const o of a)o.unselect();n._requestedTiles=Object.values(this._traverser.requestedTiles),n._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,!(this.traverseCounter>0)&&this._updateTiles()}_updateTiles(){this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[];for(const t in this.frameStateData){const e=this.frameStateData[t];this.selectedTiles=this.selectedTiles.concat(e.selectedTiles),this._requestedTiles=this._requestedTiles.concat(e._requestedTiles),this._emptyTiles=this._emptyTiles.concat(e._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);for(const t of this.selectedTiles)this._tiles[t.id]=t;this._loadTiles(),this._unloadTiles(),this._updateStats()}_tilesChanged(t,e){if(t.length!==e.length)return!0;const n=new Set(t.map(a=>a.id)),i=new Set(e.map(a=>a.id));let s=t.filter(a=>!i.has(a.id)).length>0;return s=s||e.filter(a=>!n.has(a.id)).length>0,s}_loadTiles(){for(const t of this._requestedTiles)t.contentUnloaded&&this._loadTile(t)}_unloadTiles(){this._cache.unloadTiles(this,(t,e)=>t._unloadTile(e))}_updateStats(){let t=0,e=0;for(const n of this.selectedTiles)n.contentAvailable&&n.content&&(t++,n.content.pointCount?e+=n.content.pointCount:e+=n.content.vertexCount);this.stats.get(HI).count=this.selectedTiles.length,this.stats.get(GI).count=t,this.stats.get(KI).count=e}async _initializeTileSet(t){this.type===ic.I3S&&(this.calculateViewPropsI3S(),t.root=await t.root),this.root=this._initializeTileHeaders(t,null),this.type===ic.TILES3D&&(this._initializeTiles3DTileset(t),this.calculateViewPropsTiles3D()),this.type===ic.I3S&&this._initializeI3STileset()}calculateViewPropsI3S(){var t;const e=this.tileset.fullExtent;if(e){const{xmin:i,xmax:s,ymin:a,ymax:o,zmin:h,zmax:f}=e;this.cartographicCenter=new ue(i+(s-i)/2,a+(o-a)/2,h+(f-h)/2),this.cartesianCenter=Ti.WGS84.cartographicToCartesian(this.cartographicCenter,new ue),this.zoom=FI(e,this.cartographicCenter,this.cartesianCenter);return}const n=(t=this.tileset.store)===null||t===void 0?void 0:t.extent;if(n){const[i,s,a,o]=n;this.cartographicCenter=new ue(i+(a-i)/2,s+(o-s)/2,0),this.cartesianCenter=Ti.WGS84.cartographicToCartesian(this.cartographicCenter,new ue),this.zoom=oY(n,this.cartographicCenter,this.cartesianCenter);return}console.warn("Extent is not defined in the tileset header"),this.cartographicCenter=new ue,this.zoom=1}calculateViewPropsTiles3D(){const t=this.root,{center:e}=t.boundingVolume;if(!e){console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new ue,this.zoom=1;return}e[0]!==0||e[1]!==0||e[2]!==0?this.cartographicCenter=Ti.WGS84.cartesianToCartographic(e,new ue):this.cartographicCenter=new ue(0,0,-Ti.WGS84.radii[0]),this.cartesianCenter=e,this.zoom=sY(t.boundingVolume,this.cartographicCenter)}_initializeStats(){this.stats.get(D0),this.stats.get(nw),this.stats.get(rw),this.stats.get(HI),this.stats.get(GI),this.stats.get(VI),this.stats.get(jI),this.stats.get(qI),this.stats.get(KI),this.stats.get(iw,"memory")}_initializeTileHeaders(t,e){const n=new tw(this,t.root,e);if(e&&(e.children.push(n),n.depth=e.depth+1),this.type===ic.TILES3D){const s=[];for(s.push(n);s.length>0;){const a=s.pop();this.stats.get(D0).incrementCount();const o=a.header.children||[];for(const h of o){var i;const f=new tw(this,h,a);if((i=f.contentUrl)!==null&&i!==void 0&&i.includes("?session=")){const b=new URL(f.contentUrl).searchParams.get("session");b&&(this._queryParams.session=b)}a.children.push(f),f.depth=a.depth+1,s.push(f)}}}return n}_initializeTraverser(){let t;switch(this.type){case ic.TILES3D:t=xY;break;case ic.I3S:t=EY;break;default:t=R0}return new t({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(t){this._destroySubtree(t)}async _loadTile(t){let e;try{this._onStartTileLoading(),e=await t.loadContent()}catch(n){this._onTileLoadError(t,n instanceof Error?n:new Error("load failed"))}finally{this._onEndTileLoading(),this._onTileLoad(t,e)}}_onTileLoadError(t,e){this.stats.get(qI).incrementCount();const n=e.message||e.toString(),i=t.url;console.error("A 3D tile failed to load: ".concat(t.url," ").concat(n)),this.options.onTileError(t,n,i)}_onTileLoad(t,e){if(e){if(this.type===ic.I3S){var n,i;const s=((n=this.tileset)===null||n===void 0||(i=n.nodePagesTile)===null||i===void 0?void 0:i.nodesInNodePages)||0;this.stats.get(D0).reset(),this.stats.get(D0).addCount(s)}t&&t.content&&ZJ(t,t.content),this.updateContentTypes(t),this._addTileToCache(t),this.options.onTileLoad(t)}}updateContentTypes(t){if(this.type===ic.I3S)switch(t.header.isDracoGeometry&&(this.contentFormats.draco=!0),t.header.textureFormat){case"dds":this.contentFormats.dds=!0;break;case"ktx2":this.contentFormats.ktx2=!0;break}else if(this.type===ic.TILES3D){var e;const{extensionsRemoved:n=[]}=((e=t.content)===null||e===void 0?void 0:e.gltf)||{};n.includes("KHR_draco_mesh_compression")&&(this.contentFormats.draco=!0),n.includes("EXT_meshopt_compression")&&(this.contentFormats.meshopt=!0),n.includes("KHR_texture_basisu")&&(this.contentFormats.ktx2=!0)}}_onStartTileLoading(){this._pendingCount++,this.stats.get(nw).incrementCount()}_onEndTileLoading(){this._pendingCount--,this.stats.get(nw).decrementCount()}_addTileToCache(t){this._cache.add(this,t,e=>e._updateCacheStats(t))}_updateCacheStats(t){this.stats.get(VI).incrementCount(),this.stats.get(rw).incrementCount(),this.gpuMemoryUsageInBytes+=t.gpuMemoryUsageInBytes||0,this.stats.get(iw).count=this.gpuMemoryUsageInBytes}_unloadTile(t){this.gpuMemoryUsageInBytes-=t.gpuMemoryUsageInBytes||0,this.stats.get(rw).decrementCount(),this.stats.get(jI).incrementCount(),this.stats.get(iw).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(t),t.unloadContent()}_destroy(){const t=[];for(this.root&&t.push(this.root);t.length>0;){const e=t.pop();for(const n of e.children)t.push(n);this._destroyTile(e)}this.root=null}_destroySubtree(t){const e=t,n=[];for(n.push(e);n.length>0;){t=n.pop();for(const i of t.children)n.push(i);t!==e&&this._destroyTile(t)}e.children=[]}_destroyTile(t){this._cache.unloadTile(this,t),this._unloadTile(t),t.destroy()}_initializeTiles3DTileset(t){if(t.queryString){const e=new URLSearchParams(t.queryString),n=Object.fromEntries(e.entries());this._queryParams={...this._queryParams,...n}}if(this.asset=t.asset,!this.asset)throw new Error("Tileset must have an asset property.");if(this.asset.version!=="0.0"&&this.asset.version!=="1.0")throw new Error("The tileset must be 3D Tiles version 0.0 or 1.0.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=t.properties,this.geometricError=t.geometricError,this._extensionsUsed=t.extensionsUsed||[],this.extras=t.extras}_initializeI3STileset(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}}const $I="3.4.14",Yp={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GEOMETRY:"geom",VECTOR:"vect",GLTF:"glTF"};function WI(r,t,e){li(r instanceof ArrayBuffer);const n=new TextDecoder("utf8"),i=new Uint8Array(r,t,e);return n.decode(i)}function IY(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const e=new DataView(r);return"".concat(String.fromCharCode(e.getUint8(t+0))).concat(String.fromCharCode(e.getUint8(t+1))).concat(String.fromCharCode(e.getUint8(t+2))).concat(String.fromCharCode(e.getUint8(t+3)))}const LY={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},us={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},Pn={...LY,...us},sw={[us.DOUBLE]:Float64Array,[us.FLOAT]:Float32Array,[us.UNSIGNED_SHORT]:Uint16Array,[us.UNSIGNED_INT]:Uint32Array,[us.UNSIGNED_BYTE]:Uint8Array,[us.BYTE]:Int8Array,[us.SHORT]:Int16Array,[us.INT]:Int32Array},FY={DOUBLE:us.DOUBLE,FLOAT:us.FLOAT,UNSIGNED_SHORT:us.UNSIGNED_SHORT,UNSIGNED_INT:us.UNSIGNED_INT,UNSIGNED_BYTE:us.UNSIGNED_BYTE,BYTE:us.BYTE,SHORT:us.SHORT,INT:us.INT},ow="Failed to convert GL type";class Ml{static fromTypedArray(t){t=ArrayBuffer.isView(t)?t.constructor:t;for(const e in sw)if(sw[e]===t)return e;throw new Error(ow)}static fromName(t){const e=FY[t];if(!e)throw new Error(ow);return e}static getArrayType(t){switch(t){case us.UNSIGNED_SHORT_5_6_5:case us.UNSIGNED_SHORT_4_4_4_4:case us.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:const e=sw[t];if(!e)throw new Error(ow);return e}}static getByteSize(t){return Ml.getArrayType(t).BYTES_PER_ELEMENT}static validate(t){return!!Ml.getArrayType(t)}static createTypedArray(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0;i===void 0&&(i=(e.byteLength-n)/Ml.getByteSize(t));const s=Ml.getArrayType(t);return new s(e,n,i)}}function MY(r,t){if(!r)throw new Error("math.gl assertion failed. ".concat(t))}function PY(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];const e=r>>11&31,n=r>>5&63,i=r&31;return t[0]=e<<3,t[1]=n<<2,t[2]=i<<3,t}new Iv,new ue,new Iv,new Iv;function XI(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:255;return BA(r,0,t)/t*2-1}function JI(r){return r<0?-1:1}function UY(r,t,e,n){if(MY(n),r<0||r>e||t<0||t>e)throw new Error("x and y must be unsigned normalized integers between 0 and ".concat(e));if(n.x=XI(r,e),n.y=XI(t,e),n.z=1-(Math.abs(n.x)+Math.abs(n.y)),n.z<0){const i=n.x;n.x=(1-Math.abs(n.y))*JI(i),n.y=(1-Math.abs(i))*JI(n.y)}return n.normalize()}function RY(r,t,e){return UY(r,t,255,e)}class aw{constructor(t,e){K(this,"json",void 0),K(this,"buffer",void 0),K(this,"featuresLength",0),K(this,"_cachedTypedArrays",{}),this.json=t,this.buffer=e}getExtension(t){return this.json.extensions&&this.json.extensions[t]}hasProperty(t){return!!this.json[t]}getGlobalProperty(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Pn.UNSIGNED_INT,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const i=this.json[t];return i&&Number.isFinite(i.byteOffset)?this._getTypedArrayFromBinary(t,e,n,1,i.byteOffset):i}getPropertyArray(t,e,n){const i=this.json[t];return i&&Number.isFinite(i.byteOffset)?("componentType"in i&&(e=Ml.fromName(i.componentType)),this._getTypedArrayFromBinary(t,e,n,this.featuresLength,i.byteOffset)):this._getTypedArrayFromArray(t,e,i)}getProperty(t,e,n,i,s){const a=this.json[t];if(!a)return a;const o=this.getPropertyArray(t,e,n);if(n===1)return o[i];for(let h=0;h<n;++h)s[h]=o[n*i+h];return s}_getTypedArrayFromBinary(t,e,n,i,s){const a=this._cachedTypedArrays;let o=a[t];return o||(o=Ml.createTypedArray(e,this.buffer.buffer,this.buffer.byteOffset+s,i*n),a[t]=o),o}_getTypedArrayFromArray(t,e,n){const i=this._cachedTypedArrays;let s=i[t];return s||(s=Ml.createTypedArray(e,n),i[t]=s),s}}const DY={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},OY={SCALAR:(r,t)=>r[t],VEC2:(r,t)=>[r[2*t+0],r[2*t+1]],VEC3:(r,t)=>[r[3*t+0],r[3*t+1],r[3*t+2]],VEC4:(r,t)=>[r[4*t+0],r[4*t+1],r[4*t+2],r[4*t+3]],MAT2:(r,t)=>[r[4*t+0],r[4*t+1],r[4*t+2],r[4*t+3]],MAT3:(r,t)=>[r[9*t+0],r[9*t+1],r[9*t+2],r[9*t+3],r[9*t+4],r[9*t+5],r[9*t+6],r[9*t+7],r[9*t+8]],MAT4:(r,t)=>[r[16*t+0],r[16*t+1],r[16*t+2],r[16*t+3],r[16*t+4],r[16*t+5],r[16*t+6],r[16*t+7],r[16*t+8],r[16*t+9],r[16*t+10],r[16*t+11],r[16*t+12],r[16*t+13],r[16*t+14],r[16*t+15]]},NY={SCALAR:(r,t,e)=>{t[e]=r},VEC2:(r,t,e)=>{t[2*e+0]=r[0],t[2*e+1]=r[1]},VEC3:(r,t,e)=>{t[3*e+0]=r[0],t[3*e+1]=r[1],t[3*e+2]=r[2]},VEC4:(r,t,e)=>{t[4*e+0]=r[0],t[4*e+1]=r[1],t[4*e+2]=r[2],t[4*e+3]=r[3]},MAT2:(r,t,e)=>{t[4*e+0]=r[0],t[4*e+1]=r[1],t[4*e+2]=r[2],t[4*e+3]=r[3]},MAT3:(r,t,e)=>{t[9*e+0]=r[0],t[9*e+1]=r[1],t[9*e+2]=r[2],t[9*e+3]=r[3],t[9*e+4]=r[4],t[9*e+5]=r[5],t[9*e+6]=r[6],t[9*e+7]=r[7],t[9*e+8]=r[8],t[9*e+9]=r[9]},MAT4:(r,t,e)=>{t[16*e+0]=r[0],t[16*e+1]=r[1],t[16*e+2]=r[2],t[16*e+3]=r[3],t[16*e+4]=r[4],t[16*e+5]=r[5],t[16*e+6]=r[6],t[16*e+7]=r[7],t[16*e+8]=r[8],t[16*e+9]=r[9],t[16*e+10]=r[10],t[16*e+11]=r[11],t[16*e+12]=r[12],t[16*e+13]=r[13],t[16*e+14]=r[14],t[16*e+15]=r[15]}};function kY(r,t,e,n){const{componentType:i}=r;li(r.componentType);const s=typeof i=="string"?Ml.fromName(i):i,a=DY[r.type],o=OY[r.type],h=NY[r.type];return e+=r.byteOffset,{values:Ml.createTypedArray(s,t,e,a*n),type:s,size:a,unpacker:o,packer:h}}const Pl=r=>r!==void 0;function QY(r,t,e){if(!t)return null;let n=r.getExtension("3DTILES_batch_table_hierarchy");const i=t.HIERARCHY;return i&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),t.extensions=t.extensions||{},t.extensions["3DTILES_batch_table_hierarchy"]=i,n=i),n?zY(n,e):null}function zY(r,t){let e,n,i;const s=r.instancesLength,a=r.classes;let o=r.classIds,h=r.parentCounts,f=r.parentIds,g=s;Pl(o.byteOffset)&&(o.componentType=defaultValue(o.componentType,GL.UNSIGNED_SHORT),o.type=AttributeType.SCALAR,i=getBinaryAccessor(o),o=i.createArrayBufferView(t.buffer,t.byteOffset+o.byteOffset,s));let b;if(Pl(h))for(Pl(h.byteOffset)&&(h.componentType=defaultValue(h.componentType,GL.UNSIGNED_SHORT),h.type=AttributeType.SCALAR,i=getBinaryAccessor(h),h=i.createArrayBufferView(t.buffer,t.byteOffset+h.byteOffset,s)),b=new Uint16Array(s),g=0,e=0;e<s;++e)b[e]=g,g+=h[e];Pl(f)&&Pl(f.byteOffset)&&(f.componentType=defaultValue(f.componentType,GL.UNSIGNED_SHORT),f.type=AttributeType.SCALAR,i=getBinaryAccessor(f),f=i.createArrayBufferView(t.buffer,t.byteOffset+f.byteOffset,g));const C=a.length;for(e=0;e<C;++e){const Q=a[e].length,k=a[e].instances,j=getBinaryProperties(Q,k,t);a[e].instances=combine(j,k)}const B=new Array(C).fill(0),R=new Uint16Array(s);for(e=0;e<s;++e)n=o[e],R[e]=B[n],++B[n];const D={classes:a,classIds:o,classIndexes:R,parentCounts:h,parentIndexes:b,parentIds:f};return VY(D),D}function Zp(r,t,e){if(!r)return;const n=r.parentCounts;return r.parentIds?e(r,t):n>0?HY(r,t,e):GY(r,t,e)}function HY(r,t,e){const n=r.classIds,i=r.parentCounts,s=r.parentIds,a=r.parentIndexes,o=n.length,h=scratchVisited;h.length=Math.max(h.length,o);const f=++marker,g=scratchStack;for(g.length=0,g.push(t);g.length>0;){if(t=g.pop(),h[t]===f)continue;h[t]=f;const b=e(r,t);if(Pl(b))return b;const C=i[t],B=a[t];for(let R=0;R<C;++R){const D=s[B+R];D!==t&&g.push(D)}}return null}function GY(r,t,e){let n=!0;for(;n;){const i=e(r,t);if(Pl(i))return i;const s=r.parentIds[t];n=s!==t,t=s}throw new Error("traverseHierarchySingleParent")}function VY(r){const e=r.classIds.length;for(let n=0;n<e;++n)YI(r,n,stack)}function YI(r,t,e){const n=r.parentCounts,i=r.parentIds,s=r.parentIndexes,o=r.classIds.length;if(!Pl(i))return;assert(t<o,"Parent index ".concat(t," exceeds the total number of instances: ").concat(o)),assert(e.indexOf(t)===-1,"Circular dependency detected in the batch table hierarchy."),e.push(t);const h=Pl(n)?n[t]:1,f=Pl(n)?s[t]:t;for(let g=0;g<h;++g){const b=i[f+g];b!==t&&YI(r,b,e)}e.pop(t)}function ca(r){return r!=null}const O0=(r,t)=>r,jY={HIERARCHY:!0,extensions:!0,extras:!0};class ZI{constructor(t,e,n){var i;let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};K(this,"json",void 0),K(this,"binary",void 0),K(this,"featureCount",void 0),K(this,"_extensions",void 0),K(this,"_properties",void 0),K(this,"_binaryProperties",void 0),K(this,"_hierarchy",void 0),li(n>=0),this.json=t||{},this.binary=e,this.featureCount=n,this._extensions=((i=this.json)===null||i===void 0?void 0:i.extensions)||{},this._properties={};for(const a in this.json)jY[a]||(this._properties[a]=this.json[a]);this._binaryProperties=this._initializeBinaryProperties(),s["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=QY(this,this.json,this.binary))}getExtension(t){return this.json&&this.json.extensions&&this.json.extensions[t]}memorySizeInBytes(){return 0}isClass(t,e){if(this._checkBatchId(t),li(typeof e=="string",e),this._hierarchy){const n=Zp(this._hierarchy,t,(i,s)=>{const a=i.classIds[s];return i.classes[a].name===e});return ca(n)}return!1}isExactClass(t,e){return li(typeof e=="string",e),this.getExactClassName(t)===e}getExactClassName(t){if(this._checkBatchId(t),this._hierarchy){const e=this._hierarchy.classIds[t];return this._hierarchy.classes[e].name}}hasProperty(t,e){return this._checkBatchId(t),li(typeof e=="string",e),ca(this._properties[e])||this._hasPropertyInHierarchy(t,e)}getPropertyNames(t,e){this._checkBatchId(t),e=ca(e)?e:[],e.length=0;const n=Object.keys(this._properties);return e.push(...n),this._hierarchy&&this._getPropertyNamesInHierarchy(t,e),e}getProperty(t,e){if(this._checkBatchId(t),li(typeof e=="string",e),this._binaryProperties){const i=this._binaryProperties[e];if(ca(i))return this._getBinaryProperty(i,t)}const n=this._properties[e];if(ca(n))return O0(n[t]);if(this._hierarchy){const i=this._getHierarchyProperty(t,e);if(ca(i))return i}}setProperty(t,e,n){const i=this.featureCount;if(this._checkBatchId(t),li(typeof e=="string",e),this._binaryProperties){const a=this._binaryProperties[e];if(a){this._setBinaryProperty(a,t,n);return}}if(this._hierarchy&&this._setHierarchyProperty(this,t,e,n))return;let s=this._properties[e];ca(s)||(this._properties[e]=new Array(i),s=this._properties[e]),s[t]=O0(n)}_checkBatchId(t){if(!(t>=0&&t<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(t,e){return t.unpack(t.typedArray,e)}_setBinaryProperty(t,e,n){t.pack(n,t.typedArray,e)}_initializeBinaryProperties(){let t=null;for(const e in this._properties){const n=this._properties[e],i=this._initializeBinaryProperty(e,n);i&&(t=t||{},t[e]=i)}return t}_initializeBinaryProperty(t,e){if("byteOffset"in e){const n=e;li(this.binary,"Property ".concat(t," requires a batch table binary.")),li(n.type,"Property ".concat(t," requires a type."));const i=kY(n,this.binary.buffer,this.binary.byteOffset|0,this.featureCount);return{typedArray:i.values,componentCount:i.size,unpack:i.unpacker,pack:i.packer}}return null}_hasPropertyInHierarchy(t,e){if(!this._hierarchy)return!1;const n=Zp(this._hierarchy,t,(i,s)=>{const a=i.classIds[s],o=i.classes[a].instances;return ca(o[e])});return ca(n)}_getPropertyNamesInHierarchy(t,e){Zp(this._hierarchy,t,(n,i)=>{const s=n.classIds[i],a=n.classes[s].instances;for(const o in a)a.hasOwnProperty(o)&&e.indexOf(o)===-1&&e.push(o)})}_getHierarchyProperty(t,e){return Zp(this._hierarchy,t,(n,i)=>{const s=n.classIds[i],a=n.classes[s],o=n.classIndexes[i],h=a.instances[e];return ca(h)?ca(h.typedArray)?this._getBinaryProperty(h,o):O0(h[o]):null})}_setHierarchyProperty(t,e,n,i){const s=Zp(this._hierarchy,e,(a,o)=>{const h=a.classIds[o],f=a.classes[h],g=a.classIndexes[o],b=f.instances[n];return ca(b)?(li(o===e,'Inherited property "'.concat(n,'" is read-only.')),ca(b.typedArray)?this._setBinaryProperty(b,g,i):b[g]=O0(i),!0):!1});return ca(s)}}const cw=4;function N0(r,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const n=new DataView(t);if(r.magic=n.getUint32(e,!0),e+=cw,r.version=n.getUint32(e,!0),e+=cw,r.byteLength=n.getUint32(e,!0),e+=cw,r.version!==1)throw new Error("3D Tile Version ".concat(r.version," not supported"));return e}const Xd=4,tL="b3dm tile in legacy format.";function lw(r,t,e){const n=new DataView(t);let i;r.header=r.header||{};let s=n.getUint32(e,!0);e+=Xd;let a=n.getUint32(e,!0);e+=Xd;let o=n.getUint32(e,!0);e+=Xd;let h=n.getUint32(e,!0);return e+=Xd,o>=570425344?(e-=Xd*2,i=s,o=a,h=0,s=0,a=0,console.warn(tL)):h>=570425344&&(e-=Xd,i=o,o=s,h=a,s=0,a=0,console.warn(tL)),r.header.featureTableJsonByteLength=s,r.header.featureTableBinaryByteLength=a,r.header.batchTableJsonByteLength=o,r.header.batchTableBinaryByteLength=h,r.header.batchLength=i,e}function Aw(r,t,e,n){return e=qY(r,t,e),e=KY(r,t,e),e}function qY(r,t,e,n){const{featureTableJsonByteLength:i,featureTableBinaryByteLength:s,batchLength:a}=r.header;if(r.featureTableJson={BATCH_LENGTH:a||0},i>0){const o=WI(t,e,i);r.featureTableJson=JSON.parse(o)}return e+=i,r.featureTableBinary=new Uint8Array(t,e,s),e+=s,e}function KY(r,t,e,n){const{batchTableJsonByteLength:i,batchTableBinaryByteLength:s}=r.header;if(i>0){const a=WI(t,e,i);r.batchTableJson=JSON.parse(a),e+=i,s>0&&(r.batchTableBinary=new Uint8Array(t,e,s),r.batchTableBinary=new Uint8Array(r.batchTableBinary),e+=s)}return e}function eL(r,t,e){if(!t&&(!r||!r.batchIds||!e))return null;const{batchIds:n,isRGB565:i,pointCount:s}=r;if(n&&e){const a=new Uint8ClampedArray(s*3);for(let o=0;o<s;o++){const h=n[o],g=e.getProperty(h,"dimensions").map(b=>b*255);a[o*3]=g[0],a[o*3+1]=g[1],a[o*3+2]=g[2]}return{type:Pn.UNSIGNED_BYTE,value:a,size:3,normalized:!0}}if(i){const a=new Uint8ClampedArray(s*3);for(let o=0;o<s;o++){const h=PY(t[o]);a[o*3]=h[0],a[o*3+1]=h[1],a[o*3+2]=h[2]}return{type:Pn.UNSIGNED_BYTE,value:a,size:3,normalized:!0}}return t&&t.length===s*3?{type:Pn.UNSIGNED_BYTE,value:t,size:3,normalized:!0}:{type:Pn.UNSIGNED_BYTE,value:t,size:4,normalized:!0}}const rL=new ue;function $Y(r,t){if(!t)return null;if(r.isOctEncoded16P){const e=new Float32Array(r.pointsLength*3);for(let n=0;n<r.pointsLength;n++)RY(t[n*2],t[n*2+1],rL),rL.toArray(e,n*3);return{type:Pn.FLOAT,size:2,value:e}}return{type:Pn.FLOAT,size:2,value:t}}function WY(r,t,e){return r.isQuantized?e["3d-tiles"]&&e["3d-tiles"].decodeQuantizedPositions?(r.isQuantized=!1,XY(r,t)):{type:Pn.UNSIGNED_SHORT,value:t,size:3,normalized:!0}:t}function XY(r,t){const e=new ue,n=new Float32Array(r.pointCount*3);for(let i=0;i<r.pointCount;i++)e.set(t[i*3],t[i*3+1],t[i*3+2]).scale(1/r.quantizedRange).multiply(r.quantizedVolumeScale).add(r.quantizedVolumeOffset).toArray(n,i*3);return n}async function JY(r,t,e,n,i){e=N0(r,t,e),e=lw(r,t,e),e=Aw(r,t,e),YY(r);const{featureTable:s,batchTable:a}=ZY(r);return await iZ(r,s,a,n,i),tZ(r,s,n),eZ(r,s,a),rZ(r,s),e}function YY(r){r.attributes={positions:null,colors:null,normals:null,batchIds:null},r.isQuantized=!1,r.isTranslucent=!1,r.isRGB565=!1,r.isOctEncoded16P=!1}function ZY(r){const t=new aw(r.featureTableJson,r.featureTableBinary),e=t.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(e))throw new Error("POINTS_LENGTH must be defined");t.featuresLength=e,r.featuresLength=e,r.pointsLength=e,r.pointCount=e,r.rtcCenter=t.getGlobalProperty("RTC_CENTER",Pn.FLOAT,3);const n=nZ(r,t);return{featureTable:t,batchTable:n}}function tZ(r,t,e){if(!r.attributes.positions){if(t.hasProperty("POSITION"))r.attributes.positions=t.getPropertyArray("POSITION",Pn.FLOAT,3);else if(t.hasProperty("POSITION_QUANTIZED")){const n=t.getPropertyArray("POSITION_QUANTIZED",Pn.UNSIGNED_SHORT,3);if(r.isQuantized=!0,r.quantizedRange=65535,r.quantizedVolumeScale=t.getGlobalProperty("QUANTIZED_VOLUME_SCALE",Pn.FLOAT,3),!r.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(r.quantizedVolumeOffset=t.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",Pn.FLOAT,3),!r.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");r.attributes.positions=WY(r,n,e)}}if(!r.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}function eZ(r,t,e){if(!r.attributes.colors){let n=null;t.hasProperty("RGBA")?(n=t.getPropertyArray("RGBA",Pn.UNSIGNED_BYTE,4),r.isTranslucent=!0):t.hasProperty("RGB")?n=t.getPropertyArray("RGB",Pn.UNSIGNED_BYTE,3):t.hasProperty("RGB565")&&(n=t.getPropertyArray("RGB565",Pn.UNSIGNED_SHORT,1),r.isRGB565=!0),r.attributes.colors=eL(r,n,e)}t.hasProperty("CONSTANT_RGBA")&&(r.constantRGBA=t.getGlobalProperty("CONSTANT_RGBA",Pn.UNSIGNED_BYTE,4))}function rZ(r,t){if(!r.attributes.normals){let e=null;t.hasProperty("NORMAL")?e=t.getPropertyArray("NORMAL",Pn.FLOAT,3):t.hasProperty("NORMAL_OCT16P")&&(e=t.getPropertyArray("NORMAL_OCT16P",Pn.UNSIGNED_BYTE,2),r.isOctEncoded16P=!0),r.attributes.normals=$Y(r,e)}}function nZ(r,t){let e=null;if(!r.batchIds&&t.hasProperty("BATCH_ID")&&(r.batchIds=t.getPropertyArray("BATCH_ID",Pn.UNSIGNED_SHORT,1),r.batchIds)){const n=t.getGlobalProperty("BATCH_LENGTH");if(!n)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");const{batchTableJson:i,batchTableBinary:s}=r;e=new ZI(i,s,n)}return e}async function iZ(r,t,e,n,i){let s,a,o;const h=r.batchTableJson&&r.batchTableJson.extensions&&r.batchTableJson.extensions["3DTILES_draco_point_compression"];h&&(o=h.properties);const f=t.getExtension("3DTILES_draco_point_compression");if(f){a=f.properties;const b=f.byteOffset,C=f.byteLength;if(!a||!Number.isFinite(b)||!C)throw new Error("Draco properties, byteOffset, and byteLength must be defined");s=r.featureTableBinary.slice(b,b+C),r.hasPositions=Number.isFinite(a.POSITION),r.hasColors=Number.isFinite(a.RGB)||Number.isFinite(a.RGBA),r.hasNormals=Number.isFinite(a.NORMAL),r.hasBatchIds=Number.isFinite(a.BATCH_ID),r.isTranslucent=Number.isFinite(a.RGBA)}if(!s)return!0;const g={buffer:s,properties:{...a,...o},featureTableProperties:a,batchTableProperties:o,dequantizeInShader:!1};return await sZ(r,g,n,i)}async function sZ(r,t,e,n){const{parse:i}=n,s={...e,draco:{...e.draco,extraAttributes:t.batchTableProperties||{}}};delete s["3d-tiles"];const a=await i(t.buffer,pI,s),o=a.attributes.POSITION&&a.attributes.POSITION.value,h=a.attributes.COLOR_0&&a.attributes.COLOR_0.value,f=a.attributes.NORMAL&&a.attributes.NORMAL.value,g=a.attributes.BATCH_ID&&a.attributes.BATCH_ID.value,b=o&&a.attributes.POSITION.value.quantization,C=f&&a.attributes.NORMAL.value.quantization;if(b){const R=a.POSITION.data.quantization,D=R.range;r.quantizedVolumeScale=new ue(D,D,D),r.quantizedVolumeOffset=new ue(R.minValues),r.quantizedRange=(1<<R.quantizationBits)-1,r.isQuantizedDraco=!0}C&&(r.octEncodedRange=(1<<a.NORMAL.data.quantization.quantizationBits)-1,r.isOctEncodedDraco=!0);const B={};if(t.batchTableProperties)for(const R of Object.keys(t.batchTableProperties))a.attributes[R]&&a.attributes[R].value&&(B[R.toLowerCase()]=a.attributes[R].value);r.attributes={positions:o,colors:eL(r,h,void 0),normals:f,batchIds:g,...B}}const uw={URI:0,EMBEDDED:1};function nL(r,t,e,n){r.rotateYtoZ=!0;const i=r.byteOffset+r.byteLength-e;if(i===0)throw new Error("glTF byte length must be greater than 0.");return r.gltfUpAxis=n["3d-tiles"]&&n["3d-tiles"].assetGltfUpAxis?n["3d-tiles"].assetGltfUpAxis:"Y",r.gltfArrayBuffer=I_(t,e,i),r.gltfByteOffset=0,r.gltfByteLength=i,e%4===0||console.warn("".concat(r.type,": embedded glb is not aligned to a 4-byte boundary.")),r.byteOffset+r.byteLength}async function iL(r,t,e,n){const i=e["3d-tiles"]||{};if(oZ(r,t),i.loadGLTF){const{parse:s,fetch:a}=n;r.gltfUrl&&(r.gltfArrayBuffer=await a(r.gltfUrl,e),r.gltfByteOffset=0),r.gltfArrayBuffer&&(r.gltf=await s(r.gltfArrayBuffer,Xp,e,n),r.gpuMemoryUsageInBytes=uI(r.gltf),delete r.gltfArrayBuffer,delete r.gltfByteOffset,delete r.gltfByteLength)}}function oZ(r,t,e){switch(t){case uw.URI:const n=new Uint8Array(r.gltfArrayBuffer,r.gltfByteOffset),s=new TextDecoder().decode(n);r.gltfUrl=s.replace(/[\s\0]+$/,""),delete r.gltfArrayBuffer,delete r.gltfByteOffset,delete r.gltfByteLength;break;case uw.EMBEDDED:break;default:throw new Error("b3dm: Illegal glTF format field")}}async function aZ(r,t,e,n,i){var s;e=cZ(r,t,e,n),await iL(r,uw.EMBEDDED,n,i);const a=r==null||(s=r.gltf)===null||s===void 0?void 0:s.extensions;return a&&a.CESIUM_RTC&&(r.rtcCenter=a.CESIUM_RTC.center),e}function cZ(r,t,e,n,i){e=N0(r,t,e),e=lw(r,t,e),e=Aw(r,t,e),e=nL(r,t,e,n);const s=new aw(r.featureTableJson,r.featureTableBinary);return r.rtcCenter=s.getGlobalProperty("RTC_CENTER",Pn.FLOAT,3),e}async function lZ(r,t,e,n,i){return e=AZ(r,t,e,n),await iL(r,r.gltfFormat,n,i),e}function AZ(r,t,e,n,i){if(e=N0(r,t,e),r.version!==1)throw new Error("Instanced 3D Model version ".concat(r.version," is not supported"));e=lw(r,t,e);const s=new DataView(t);if(r.gltfFormat=s.getUint32(e,!0),e+=4,e=Aw(r,t,e),e=nL(r,t,e,n),r.featureTableJsonByteLength===0)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");const a=new aw(r.featureTableJson,r.featureTableBinary),o=a.getGlobalProperty("INSTANCES_LENGTH");if(a.featuresLength=o,!Number.isFinite(o))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");r.eastNorthUp=a.getGlobalProperty("EAST_NORTH_UP"),r.rtcCenter=a.getGlobalProperty("RTC_CENTER",Pn.FLOAT,3);const h=new ZI(r.batchTableJson,r.batchTableBinary,o);return uZ(r,a,h,o),e}function uZ(r,t,e,n){const s={instances:new Array(n),batchTable:r._batchTable,cull:!1,url:void 0,gltf:void 0,basePath:void 0,incrementallyLoadTextures:!1,forwardAxis:[1,0,0]}.instances,a=new ue;new ue,new ue,new ue;const o=new Ni,h=new Lp,f=new ue,g={},b=new Cn,C=[],B=[],R=new ue,D=new ue;for(let Q=0;Q<n;Q++){let k;if(t.hasProperty("POSITION"))k=t.getProperty("POSITION",Pn.FLOAT,3,Q,a);else if(t.hasProperty("POSITION_QUANTIZED")){k=t.getProperty("POSITION_QUANTIZED",Pn.UNSIGNED_SHORT,3,Q,a);const yt=t.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",Pn.FLOAT,3,R);if(!yt)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const ft=t.getGlobalProperty("QUANTIZED_VOLUME_SCALE",Pn.FLOAT,3,D);if(!ft)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const Dt=65535;for(let It=0;It<3;It++)k[It]=k[It]/Dt*ft[It]+yt[It]}if(!k)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");if(a.copy(k),g.translation=a,r.normalUp=t.getProperty("NORMAL_UP",Pn.FLOAT,3,Q,C),r.normalRight=t.getProperty("NORMAL_RIGHT",Pn.FLOAT,3,Q,B),r.normalUp){if(!r.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");r.hasCustomOrientation=!0}else{if(r.octNormalUp=t.getProperty("NORMAL_UP_OCT32P",Pn.UNSIGNED_SHORT,2,C),r.octNormalRight=t.getProperty("NORMAL_RIGHT_OCT32P",Pn.UNSIGNED_SHORT,2,B),r.octNormalUp)throw r.octNormalRight?new Error("i3dm: oct-encoded orientation not implemented"):new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");r.eastNorthUp?(Ti.WGS84.eastNorthUpToFixedFrame(a,b),b.getRotationMatrix3(o)):o.identity()}h.fromMatrix3(o),g.rotation=h,f.set(1,1,1);const j=t.getProperty("SCALE",Pn.FLOAT,1,Q);Number.isFinite(j)&&f.multiplyByScalar(j);const et=t.getProperty("SCALE_NON_UNIFORM",Pn.FLOAT,3,Q,C);et&&f.scale(et),g.scale=f;let st=t.getProperty("BATCH_ID",Pn.UNSIGNED_SHORT,1,Q);st===void 0&&(st=Q);const mt=new Cn().fromQuaternion(g.rotation);b.identity(),b.translate(g.translation),b.multiplyRight(mt),b.scale(g.scale);const pt=b.clone();s[Q]={modelMatrix:pt,batchId:st}}r.instances=s}async function hZ(r,t,e,n,i,s){e=N0(r,t,e);const a=new DataView(t);for(r.tilesLength=a.getUint32(e,!0),e+=4,r.tiles=[];r.tiles.length<r.tilesLength&&r.byteLength-e>12;){const o={};r.tiles.push(o),e=await s(t,e,n,i,o)}return e}async function dZ(r,t,e,n){r.rotateYtoZ=!0,r.gltfUpAxis=e["3d-tiles"]&&e["3d-tiles"].assetGltfUpAxis?e["3d-tiles"].assetGltfUpAxis:"Y";const{parse:i}=n;r.gltf=await i(t,Xp,e,n),r.gpuMemoryUsageInBytes=uI(r.gltf)}async function sL(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,e=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};switch(i.byteOffset=t,i.type=IY(r,t),i.type){case Yp.COMPOSITE:return await hZ(i,r,t,e,n,sL);case Yp.BATCHED_3D_MODEL:return await aZ(i,r,t,e,n);case Yp.GLTF:return await dZ(i,r,e,n);case Yp.INSTANCED_3D_MODEL:return await lZ(i,r,t,e,n);case Yp.POINT_CLOUD:return await JY(i,r,t,e,n);default:throw new Error("3DTileLoader: unknown type ".concat(i.type))}}const fZ=1952609651,pZ=1;async function gZ(r,t,e){if(new Uint32Array(r.slice(0,4))[0]!==fZ)throw new Error("Wrong subtree file magic number");if(new Uint32Array(r.slice(4,8))[0]!==pZ)throw new Error("Wrong subtree file verson, must be 1");const s=oL(r.slice(8,16)),a=new Uint8Array(r,24,s),h=new TextDecoder("utf8").decode(a),f=JSON.parse(h),g=oL(r.slice(16,24));let b=new ArrayBuffer(0);return g&&(b=r.slice(24+s)),"bufferView"in f.tileAvailability&&(f.tileAvailability.explicitBitstream=await hw(f,"tileAvailability",b,e)),"bufferView"in f.contentAvailability&&(f.contentAvailability.explicitBitstream=await hw(f,"contentAvailability",b,e)),"bufferView"in f.childSubtreeAvailability&&(f.childSubtreeAvailability.explicitBitstream=await hw(f,"childSubtreeAvailability",b,e)),f}function mZ(r,t){if(t.startsWith("http")){const s=new URL(r,t);return decodeURI(s.toString())}const n="http://".concat(t),i=new URL(r,n);return"/".concat(i.host).concat(i.pathname)}async function hw(r,t,e,n){const i=r[t].bufferView,s=r.bufferViews[i],a=r.buffers[s.buffer];if(!(n!=null&&n.url)||!n.fetch)throw new Error("Url is not provided");if(!n.fetch)throw new Error("fetch is not provided");if(a.uri){const o=mZ(a.uri,n==null?void 0:n.url),f=await(await n.fetch(o)).arrayBuffer();return new Uint8Array(f,s.byteOffset,s.byteLength)}return new Uint8Array(e,s.byteOffset,s.byteLength)}function oL(r){const t=new DataView(r),e=t.getUint32(0,!0),n=t.getUint32(4,!0);return e+2**32*n}const aL={id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:$I,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:gZ,options:{}};/**
 * @license
 * Copyright 2009 The Closure Library Authors
 * Copyright 2020 Daniel Wirtz / The long.js Authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * SPDX-License-Identifier: Apache-2.0
 */var sc=null;try{sc=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function Zn(r,t,e){this.low=r|0,this.high=t|0,this.unsigned=!!e}Zn.prototype.__isLong__,Object.defineProperty(Zn.prototype,"__isLong__",{value:!0});function fo(r){return(r&&r.__isLong__)===!0}function cL(r){var t=Math.clz32(r&-r);return r?31-t:t}Zn.isLong=fo;var lL={},AL={};function Bh(r,t){var e,n,i;return t?(r>>>=0,(i=0<=r&&r<256)&&(n=AL[r],n)?n:(e=On(r,0,!0),i&&(AL[r]=e),e)):(r|=0,(i=-128<=r&&r<128)&&(n=lL[r],n)?n:(e=On(r,r<0?-1:0,!1),i&&(lL[r]=e),e))}Zn.fromInt=Bh;function oc(r,t){if(isNaN(r))return t?TA:Oc;if(t){if(r<0)return TA;if(r>=hL)return mL}else{if(r<=-dL)return la;if(r+1>=dL)return gL}return r<0?oc(-r,t).neg():On(r%Jd|0,r/Jd|0,t)}Zn.fromNumber=oc;function On(r,t,e){return new Zn(r,t,e)}Zn.fromBits=On;var k0=Math.pow;function dw(r,t,e){if(r.length===0)throw Error("empty string");if(typeof t=="number"?(e=t,t=!1):t=!!t,r==="NaN"||r==="Infinity"||r==="+Infinity"||r==="-Infinity")return t?TA:Oc;if(e=e||10,e<2||36<e)throw RangeError("radix");var n;if((n=r.indexOf("-"))>0)throw Error("interior hyphen");if(n===0)return dw(r.substring(1),t,e).neg();for(var i=oc(k0(e,8)),s=Oc,a=0;a<r.length;a+=8){var o=Math.min(8,r.length-a),h=parseInt(r.substring(a,a+o),e);if(o<8){var f=oc(k0(e,o));s=s.mul(f).add(oc(h))}else s=s.mul(i),s=s.add(oc(h))}return s.unsigned=t,s}Zn.fromString=dw;function Dc(r,t){return typeof r=="number"?oc(r,t):typeof r=="string"?dw(r,t):On(r.low,r.high,typeof t=="boolean"?t:r.unsigned)}Zn.fromValue=Dc;var uL=65536,yZ=1<<24,Jd=uL*uL,hL=Jd*Jd,dL=hL/2,fL=Bh(yZ),Oc=Bh(0);Zn.ZERO=Oc;var TA=Bh(0,!0);Zn.UZERO=TA;var Yd=Bh(1);Zn.ONE=Yd;var pL=Bh(1,!0);Zn.UONE=pL;var fw=Bh(-1);Zn.NEG_ONE=fw;var gL=On(-1,2147483647,!1);Zn.MAX_VALUE=gL;var mL=On(-1,-1,!0);Zn.MAX_UNSIGNED_VALUE=mL;var la=On(0,-2147483648,!1);Zn.MIN_VALUE=la;var We=Zn.prototype;We.toInt=function(){return this.unsigned?this.low>>>0:this.low},We.toNumber=function(){return this.unsigned?(this.high>>>0)*Jd+(this.low>>>0):this.high*Jd+(this.low>>>0)},We.toString=function(t){if(t=t||10,t<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(la)){var e=oc(t),n=this.div(e),i=n.mul(e).sub(this);return n.toString(t)+i.toInt().toString(t)}else return"-"+this.neg().toString(t);for(var s=oc(k0(t,6),this.unsigned),a=this,o="";;){var h=a.div(s),f=a.sub(h.mul(s)).toInt()>>>0,g=f.toString(t);if(a=h,a.isZero())return g+o;for(;g.length<6;)g="0"+g;o=""+g+o}},We.getHighBits=function(){return this.high},We.getHighBitsUnsigned=function(){return this.high>>>0},We.getLowBits=function(){return this.low},We.getLowBitsUnsigned=function(){return this.low>>>0},We.getNumBitsAbs=function(){if(this.isNegative())return this.eq(la)?64:this.neg().getNumBitsAbs();for(var t=this.high!=0?this.high:this.low,e=31;e>0&&!(t&1<<e);e--);return this.high!=0?e+33:e+1},We.isZero=function(){return this.high===0&&this.low===0},We.eqz=We.isZero,We.isNegative=function(){return!this.unsigned&&this.high<0},We.isPositive=function(){return this.unsigned||this.high>=0},We.isOdd=function(){return(this.low&1)===1},We.isEven=function(){return(this.low&1)===0},We.equals=function(t){return fo(t)||(t=Dc(t)),this.unsigned!==t.unsigned&&this.high>>>31===1&&t.high>>>31===1?!1:this.high===t.high&&this.low===t.low},We.eq=We.equals,We.notEquals=function(t){return!this.eq(t)},We.neq=We.notEquals,We.ne=We.notEquals,We.lessThan=function(t){return this.comp(t)<0},We.lt=We.lessThan,We.lessThanOrEqual=function(t){return this.comp(t)<=0},We.lte=We.lessThanOrEqual,We.le=We.lessThanOrEqual,We.greaterThan=function(t){return this.comp(t)>0},We.gt=We.greaterThan,We.greaterThanOrEqual=function(t){return this.comp(t)>=0},We.gte=We.greaterThanOrEqual,We.ge=We.greaterThanOrEqual,We.compare=function(t){if(fo(t)||(t=Dc(t)),this.eq(t))return 0;var e=this.isNegative(),n=t.isNegative();return e&&!n?-1:!e&&n?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},We.comp=We.compare,We.negate=function(){return!this.unsigned&&this.eq(la)?la:this.not().add(Yd)},We.neg=We.negate,We.add=function(t){fo(t)||(t=Dc(t));var e=this.high>>>16,n=this.high&65535,i=this.low>>>16,s=this.low&65535,a=t.high>>>16,o=t.high&65535,h=t.low>>>16,f=t.low&65535,g=0,b=0,C=0,B=0;return B+=s+f,C+=B>>>16,B&=65535,C+=i+h,b+=C>>>16,C&=65535,b+=n+o,g+=b>>>16,b&=65535,g+=e+a,g&=65535,On(C<<16|B,g<<16|b,this.unsigned)},We.subtract=function(t){return fo(t)||(t=Dc(t)),this.add(t.neg())},We.sub=We.subtract,We.multiply=function(t){if(this.isZero())return this;if(fo(t)||(t=Dc(t)),sc){var e=sc.mul(this.low,this.high,t.low,t.high);return On(e,sc.get_high(),this.unsigned)}if(t.isZero())return this.unsigned?TA:Oc;if(this.eq(la))return t.isOdd()?la:Oc;if(t.eq(la))return this.isOdd()?la:Oc;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(fL)&&t.lt(fL))return oc(this.toNumber()*t.toNumber(),this.unsigned);var n=this.high>>>16,i=this.high&65535,s=this.low>>>16,a=this.low&65535,o=t.high>>>16,h=t.high&65535,f=t.low>>>16,g=t.low&65535,b=0,C=0,B=0,R=0;return R+=a*g,B+=R>>>16,R&=65535,B+=s*g,C+=B>>>16,B&=65535,B+=a*f,C+=B>>>16,B&=65535,C+=i*g,b+=C>>>16,C&=65535,C+=s*f,b+=C>>>16,C&=65535,C+=a*h,b+=C>>>16,C&=65535,b+=n*g+i*f+s*h+a*o,b&=65535,On(B<<16|R,b<<16|C,this.unsigned)},We.mul=We.multiply,We.divide=function(t){if(fo(t)||(t=Dc(t)),t.isZero())throw Error("division by zero");if(sc){if(!this.unsigned&&this.high===-2147483648&&t.low===-1&&t.high===-1)return this;var e=(this.unsigned?sc.div_u:sc.div_s)(this.low,this.high,t.low,t.high);return On(e,sc.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?TA:Oc;var n,i,s;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return TA;if(t.gt(this.shru(1)))return pL;s=TA}else{if(this.eq(la)){if(t.eq(Yd)||t.eq(fw))return la;if(t.eq(la))return Yd;var a=this.shr(1);return n=a.div(t).shl(1),n.eq(Oc)?t.isNegative()?Yd:fw:(i=this.sub(t.mul(n)),s=n.add(i.div(t)),s)}else if(t.eq(la))return this.unsigned?TA:Oc;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();s=Oc}for(i=this;i.gte(t);){n=Math.max(1,Math.floor(i.toNumber()/t.toNumber()));for(var o=Math.ceil(Math.log(n)/Math.LN2),h=o<=48?1:k0(2,o-48),f=oc(n),g=f.mul(t);g.isNegative()||g.gt(i);)n-=h,f=oc(n,this.unsigned),g=f.mul(t);f.isZero()&&(f=Yd),s=s.add(f),i=i.sub(g)}return s},We.div=We.divide,We.modulo=function(t){if(fo(t)||(t=Dc(t)),sc){var e=(this.unsigned?sc.rem_u:sc.rem_s)(this.low,this.high,t.low,t.high);return On(e,sc.get_high(),this.unsigned)}return this.sub(this.div(t).mul(t))},We.mod=We.modulo,We.rem=We.modulo,We.not=function(){return On(~this.low,~this.high,this.unsigned)},We.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},We.clz=We.countLeadingZeros,We.countTrailingZeros=function(){return this.low?cL(this.low):cL(this.high)+32},We.ctz=We.countTrailingZeros,We.and=function(t){return fo(t)||(t=Dc(t)),On(this.low&t.low,this.high&t.high,this.unsigned)},We.or=function(t){return fo(t)||(t=Dc(t)),On(this.low|t.low,this.high|t.high,this.unsigned)},We.xor=function(t){return fo(t)||(t=Dc(t)),On(this.low^t.low,this.high^t.high,this.unsigned)},We.shiftLeft=function(t){return fo(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?On(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):On(0,this.low<<t-32,this.unsigned)},We.shl=We.shiftLeft,We.shiftRight=function(t){return fo(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?On(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):On(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},We.shr=We.shiftRight,We.shiftRightUnsigned=function(t){return fo(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?On(this.low>>>t|this.high<<32-t,this.high>>>t,this.unsigned):t===32?On(this.high,0,this.unsigned):On(this.high>>>t-32,0,this.unsigned)},We.shru=We.shiftRightUnsigned,We.shr_u=We.shiftRightUnsigned,We.rotateLeft=function(t){var e;return fo(t)&&(t=t.toInt()),(t&=63)===0?this:t===32?On(this.high,this.low,this.unsigned):t<32?(e=32-t,On(this.low<<t|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned)):(t-=32,e=32-t,On(this.high<<t|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned))},We.rotl=We.rotateLeft,We.rotateRight=function(t){var e;return fo(t)&&(t=t.toInt()),(t&=63)===0?this:t===32?On(this.high,this.low,this.unsigned):t<32?(e=32-t,On(this.high<<e|this.low>>>t,this.low<<e|this.high>>>t,this.unsigned)):(t-=32,e=32-t,On(this.low<<e|this.high>>>t,this.high<<e|this.low>>>t,this.unsigned))},We.rotr=We.rotateRight,We.toSigned=function(){return this.unsigned?On(this.low,this.high,!1):this},We.toUnsigned=function(){return this.unsigned?this:On(this.low,this.high,!0)},We.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},We.toBytesLE=function(){var t=this.high,e=this.low;return[e&255,e>>>8&255,e>>>16&255,e>>>24,t&255,t>>>8&255,t>>>16&255,t>>>24]},We.toBytesBE=function(){var t=this.high,e=this.low;return[t>>>24,t>>>16&255,t>>>8&255,t&255,e>>>24,e>>>16&255,e>>>8&255,e&255]},Zn.fromBytes=function(t,e,n){return n?Zn.fromBytesLE(t,e):Zn.fromBytesBE(t,e)},Zn.fromBytesLE=function(t,e){return new Zn(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,e)},Zn.fromBytesBE=function(t,e){return new Zn(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],e)};const _Z=16;function yL(r){r==="X"&&(r="");const t=r.padEnd(_Z,"0");return Zn.fromString(t,!0,16)}function vZ(r){if(r.isZero())return"X";let t=r.countTrailingZeros();const e=t%4;t=(t-e)/4;const n=t;t*=4;const s=r.shiftRightUnsigned(t).toString(16).replace(/0+$/,"");return Array(17-n-s.length).join("0")+s}function bZ(r,t){const e=wZ(r).shiftRightUnsigned(2);return r.add(Zn.fromNumber(2*t+1-4).multiply(e))}function wZ(r){return r.and(r.not().add(1))}const xZ=3,BZ=2*30+1,_L=180/Math.PI;function CZ(r){if(r.length===0)throw new Error("Invalid Hilbert quad key ".concat(r));const t=r.split("/"),e=parseInt(t[0],10),n=t[1],i=n.length;let s=0;const a=[0,0];for(let o=i-1;o>=0;o--){s=i-o;const h=n[o];let f=0,g=0;h==="1"?g=1:h==="2"?(f=1,g=1):h==="3"&&(f=1);const b=Math.pow(2,s-1);SZ(b,a,f,g),a[0]+=b*f,a[1]+=b*g}if(e%2===1){const o=a[0];a[0]=a[1],a[1]=o}return{face:e,ij:a,level:s}}function EZ(r){if(r.isZero())return"";let t=r.toString(2);for(;t.length<xZ+BZ;)t="0"+t;const e=t.lastIndexOf("1"),n=t.substring(0,3),i=t.substring(3,e),s=i.length/2,a=Zn.fromString(n,!0,2).toString(10);let o="";if(s!==0)for(o=Zn.fromString(i,!0,2).toString(4);o.length<s;)o="0"+o;return"".concat(a,"/").concat(o)}function vL(r,t,e){const n=1<<t;return[(r[0]+e[0])/n,(r[1]+e[1])/n]}function bL(r){return r>=.5?1/3*(4*r*r-1):1/3*(1-4*(1-r)*(1-r))}function wL(r){return[bL(r[0]),bL(r[1])]}function xL(r,t){let[e,n]=t;switch(r){case 0:return[1,e,n];case 1:return[-e,1,n];case 2:return[-e,-n,1];case 3:return[-1,-n,-e];case 4:return[n,-1,-e];case 5:return[n,e,-1];default:throw new Error("Invalid face")}}function BL(r){let[t,e,n]=r;const i=Math.atan2(n,Math.sqrt(t*t+e*e));return[Math.atan2(e,t)*_L,i*_L]}function SZ(r,t,e,n){if(n===0){e===1&&(t[0]=r-1-t[0],t[1]=r-1-t[1]);const i=t[0];t[0]=t[1],t[1]=i}}function TZ(r){const t=vL(r.ij,r.level,[.5,.5]),e=wL(t),n=xL(r.face,e);return BL(n)}const IZ=100;function CL(r){const{face:t,ij:e,level:n}=r,i=[[0,0],[0,1],[1,1],[1,0],[0,0]],s=Math.max(1,Math.ceil(IZ*Math.pow(2,-n))),a=new Float64Array(4*s*2+2);let o=0,h=0;for(let f=0;f<4;f++){const g=i[f].slice(0),b=i[f+1],C=(b[0]-g[0])/s,B=(b[1]-g[1])/s;for(let R=0;R<s;R++){g[0]+=C,g[1]+=B;const D=vL(e,n,g),Q=wL(D),k=xL(t,Q),j=BL(k);Math.abs(j[1])>89.999&&(j[0]=h);const et=j[0]-h;j[0]+=et>180?-360:et<-180?360:0,a[o++]=j[0],a[o++]=j[1],h=j[0]}}return a[o++]=a[0],a[o++]=a[1],a}function pw(r){const t=LZ(r);return CZ(t)}function LZ(r){if(r.indexOf("/")>0)return r;const t=yL(r);return EZ(t)}function FZ(r){const t=pw(r);return TZ(t)}function MZ(r){let t;if(r.face===2||r.face===5){let e=null,n=0;for(let i=0;i<4;i++){const s="".concat(r.face,"/").concat(i),a=pw(s),o=CL(a);(typeof e>"u"||e===null)&&(e=new Float64Array(4*o.length)),e.set(o,n),n+=o.length}t=EL(e)}else{const e=CL(r);t=EL(e)}return t}function EL(r){if(r.length%2!==0)throw new Error("Invalid corners");const t=[],e=[];for(let n=0;n<r.length;n+=2)t.push(r[n]),e.push(r[n+1]);return t.sort((n,i)=>n-i),e.sort((n,i)=>n-i),{west:t[0],east:t[t.length-1],north:e[e.length-1],south:e[0]}}function PZ(r,t){const e=(t==null?void 0:t.minimumHeight)||0,n=(t==null?void 0:t.maximumHeight)||0,i=pw(r),s=MZ(i),a=s.west,o=s.south,h=s.east,f=s.north,g=[];return g.push(new ue(a,f,e)),g.push(new ue(h,f,e)),g.push(new ue(h,o,e)),g.push(new ue(a,o,e)),g.push(new ue(a,f,n)),g.push(new ue(h,f,n)),g.push(new ue(h,o,n)),g.push(new ue(a,o,n)),g}function SL(r){const t=r.token,e={minimumHeight:r.minimumHeight,maximumHeight:r.maximumHeight},n=PZ(t,e),i=FZ(t),s=i[0],a=i[1],o=Ti.WGS84.cartographicToCartesian([s,a,e.maximumHeight]),h=new ue(o[0],o[1],o[2]);n.push(h);const f=d$(n);return[...f.center,...f.halfAxes]}const UZ={QUADTREE:4,OCTREE:8};function RZ(r,t,e){if(r!=null&&r.box){const n=yL(r.s2VolumeInfo.token),i=bZ(n,t),s=vZ(i),a={...r.s2VolumeInfo};switch(a.token=s,e){case"OCTREE":const f=r.s2VolumeInfo,g=f.maximumHeight-f.minimumHeight,b=g/2,C=f.minimumHeight+g/2;f.minimumHeight=C-b,f.maximumHeight=C+b;break}return{box:SL(a),s2VolumeInfo:a}}}async function TL(r){const{options:t,parentData:e={mortonIndex:0,x:0,y:0,z:0},childIndex:n=0,globalData:i={level:0,mortonIndex:0,x:0,y:0,z:0},s2VolumeBox:s}=r;let{subtree:a,level:o=0}=r;const{subdivisionScheme:h,subtreeLevels:f,maximumLevel:g,contentUrlTemplate:b,subtreesUriTemplate:C,basePath:B}=t,R={children:[],lodMetricValue:0,contentUrl:""},D=UZ[h],Q=n&1,k=n>>1&1,j=n>>2&1,et=(D**o-1)/(D-1);let st=Ch(e.mortonIndex,n),mt=et+st,pt=Ch(e.x,Q),yt=Ch(e.y,k),ft=Ch(e.z,j),Dt=!1;o+1>f&&(Dt=gw(a.childSubtreeAvailability,st));const It=Ch(i.x,pt),ut=Ch(i.y,yt),At=Ch(i.z,ft),Bt=o+i.level;if(Dt){const te="".concat(B,"/").concat(C),ce=mw(te,Bt,It,ut,At);a=await uu(ce,aL),i.mortonIndex=st,i.x=pt,i.y=yt,i.z=ft,i.level=o,st=0,mt=0,pt=0,yt=0,ft=0,o=0}if(!gw(a.tileAvailability,mt)||o>g)return R;gw(a.contentAvailability,mt)&&(R.contentUrl=mw(b,Bt,It,ut,At));const ie=o+1,ae={mortonIndex:st,x:pt,y:yt,z:ft};for(let te=0;te<D;te++){const ce=RZ(s,te,h),le=await TL({subtree:a,options:t,parentData:ae,childIndex:te,level:ie,globalData:i,s2VolumeBox:ce});if(le.contentUrl||le.children.length){const Te=Bt+1,wt=DZ(le,Te,{childTileX:pt,childTileY:yt,childTileZ:ft},t,s);R.children.push(wt)}}return R}function gw(r,t){return"constant"in r?!!r.constant:r.explicitBitstream?kZ(t,r.explicitBitstream):!1}function DZ(r,t,e,n,i){const{basePath:s,refine:a,getRefine:o,lodMetricType:h,getTileType:f,rootLodMetricValue:g,rootBoundingVolume:b}=n,C=r.contentUrl&&r.contentUrl.replace("".concat(s,"/"),""),B=g/2**t,R=i!=null&&i.box?{box:i.box}:b,D=OZ(t,R,e);return{children:r.children,contentUrl:r.contentUrl,content:{uri:C},id:r.contentUrl,refine:o(a),type:f(r),lodMetricType:h,lodMetricValue:B,geometricError:B,transform:r.transform,boundingVolume:D}}function OZ(r,t,e){if(t.region){const{childTileX:n,childTileY:i,childTileZ:s}=e,[a,o,h,f,g,b]=t.region,C=2**r,B=(h-a)/C,R=(f-o)/C,D=(b-g)/C,[Q,k]=[a+B*n,a+B*(n+1)],[j,et]=[o+R*i,o+R*(i+1)],[st,mt]=[g+D*s,g+D*(s+1)];return{region:[Q,j,k,et,st,mt]}}if(t.box)return t;throw new Error("Unsupported bounding volume type ".concat(t))}function Ch(r,t){return parseInt(r.toString(2)+t.toString(2),2)}function mw(r,t,e,n,i){const s=NZ({level:t,x:e,y:n,z:i});return r.replace(/{level}|{x}|{y}|{z}/gi,a=>s[a])}function NZ(r){const t={};for(const e in r)t["{".concat(e,"}")]=r[e];return t}function kZ(r,t){const e=Math.floor(r/8),n=r%8;return(t[e]>>n&1)===1}function yw(r){if(!r.contentUrl)return Wd.EMPTY;const e=r.contentUrl.split("?")[0].split(".").pop();switch(e){case"pnts":return Wd.POINTCLOUD;case"i3dm":case"b3dm":case"glb":case"gltf":return Wd.SCENEGRAPH;default:return e}}function _w(r){switch(r){case"REPLACE":case"replace":return SA.REPLACE;case"ADD":case"add":return SA.ADD;default:return r}}function vw(r,t){if(/^[a-z][0-9a-z+.-]*:/i.test(t)){const n=new URL(r,"".concat(t,"/"));return decodeURI(n.toString())}else if(r.startsWith("/"))return r;return"".concat(t,"/").concat(r)}function IL(r,t){if(!r)return null;if(r.content){const e=r.content.uri||r.content.url;r.contentUrl=vw(e,t.basePath)}return r.id=r.contentUrl,r.lodMetricType=P0.GEOMETRIC_ERROR,r.lodMetricValue=r.geometricError,r.transformMatrix=r.transform,r.type=yw(r),r.refine=_w(r.refine),r}async function QZ(r,t){const e=r.basePath;let n;const i=FL(r==null?void 0:r.root);i&&r.root?n=await LL(r.root,r,i,t):n=IL(r.root,r);const s=[];for(s.push(n);s.length>0;){const o=(s.pop()||{}).children||[];for(let h of o){const f=FL(h);f?h=await LL(h,r,f,t):IL(h,{basePath:e}),s.push(h)}}return n}async function LL(r,t,e,n){var i,s;const a=t.basePath,{subdivisionScheme:o,maximumLevel:h,subtreeLevels:f,subtrees:{uri:g}}=e,b=mw(g,0,0,0,0),C=vw(b,a),B=await uu(C,aL,n),R=vw(r.content.uri,a),D=t==null||(i=t.root)===null||i===void 0?void 0:i.refine,Q=r.geometricError,k=(s=r.boundingVolume.extensions)===null||s===void 0?void 0:s["3DTILES_bounding_volume_S2"];if(k){const mt={box:SL(k),s2VolumeInfo:k};r.boundingVolume=mt}const j=r.boundingVolume,et={contentUrlTemplate:R,subtreesUriTemplate:g,subdivisionScheme:o,subtreeLevels:f,maximumLevel:h,refine:D,basePath:a,lodMetricType:P0.GEOMETRIC_ERROR,rootLodMetricValue:Q,rootBoundingVolume:j,getTileType:yw,getRefine:_w};return await zZ(r,B,et)}async function zZ(r,t,e){if(!r)return null;r.lodMetricType=P0.GEOMETRIC_ERROR,r.lodMetricValue=r.geometricError,r.transformMatrix=r.transform;const{children:n,contentUrl:i}=await TL({subtree:t,options:e,s2VolumeBox:r});return i&&(r.contentUrl=i,r.content={uri:i.replace("".concat(e.basePath,"/"),"")}),r.refine=_w(r.refine),r.type=yw(r),r.children=n,r.id=r.contentUrl,r}function FL(r){var t;return(r==null||(t=r.extensions)===null||t===void 0?void 0:t["3DTILES_implicit_tiling"])||(r==null?void 0:r.implicitTiling)}const bw={id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:$I,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:jZ,options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}};function HZ(r){return L_(r.url)}async function GZ(r,t,e){const n={content:{featureIds:null}};return await sL(r,0,t,e,n.content),n.content}async function VZ(r,t,e){var n;const i=JSON.parse(new TextDecoder().decode(r));return i.loader=t.loader||bw,i.url=e.url,i.queryString=e.queryString,i.basePath=HZ(i),i.root=await QZ(i,t),i.type=ic.TILES3D,i.lodMetricType=P0.GEOMETRIC_ERROR,i.lodMetricValue=((n=i.root)===null||n===void 0?void 0:n.lodMetricValue)||0,i}async function jZ(r,t,e){const n=t["3d-tiles"]||{};let i;return n.isTileset==="auto"?i=e.url&&e.url.indexOf(".json")!==-1:i=n.isTileset,i?r=await VZ(r,t,e):r=await GZ(r,t,e),r}const ML=[0],qZ={getPointColor:{type:"accessor",value:[0,0,0,255]},pointSize:1,data:"",loader:bw,onTilesetLoad:{type:"function",value:r=>{}},onTileLoad:{type:"function",value:r=>{}},onTileUnload:{type:"function",value:r=>{}},onTileError:{type:"function",value:(r,t,e)=>{}},_getMeshColor:{type:"function",value:r=>[255,255,255]}};class ww extends y3{constructor(){super(...arguments),K(this,"state",void 0)}initializeState(){"onTileLoadFail"in this.props&&Ln.removed("onTileLoadFail","onTileError")(),this.state={layerMap:{},tileset3d:null,activeViewports:{},lastUpdatedViewports:null}}get isLoaded(){var t,e;return!!(!((t=this.state)===null||t===void 0||(e=t.tileset3d)===null||e===void 0)&&e.isLoaded()&&super.isLoaded)}shouldUpdateState(t){let{changeFlags:e}=t;return e.somethingChanged}updateState(t){let{props:e,oldProps:n,changeFlags:i}=t;if(e.data&&e.data!==n.data&&this._loadTileset(e.data),i.viewportChanged){const{activeViewports:s}=this.state;Object.keys(s).length&&(this._updateTileset(s),this.state.lastUpdatedViewports=s,this.state.activeViewports={})}if(i.propsChanged){const{layerMap:s}=this.state;for(const a in s)s[a].needsUpdate=!0}}activateViewport(t){const{activeViewports:e,lastUpdatedViewports:n}=this.state;this.internalState.viewport=t,e[t.id]=t;const i=n==null?void 0:n[t.id];(!i||!t.equals(i))&&(this.setChangeFlags({viewportChanged:!0}),this.setNeedsUpdate())}getPickingInfo(t){let{info:e,sourceLayer:n}=t;const i=n&&n.props.tile;return e.picked&&(e.object=i),e.sourceTile=i,e}filterSubLayer(t){let{layer:e,viewport:n}=t;const{tile:i}=e.props,{id:s}=n;return i.selected&&i.viewportIds.includes(s)}_updateAutoHighlight(t){const e=t.sourceTile,n=this.state.layerMap[e==null?void 0:e.id];n&&n.layer&&n.layer.updateAutoHighlight(t)}async _loadTileset(t){const{loadOptions:e={}}=this.props;let n=this.props.loader||this.props.loaders;Array.isArray(n)&&(n=n[0]);const i={loadOptions:{...e}};let s=t;if(n.preload){const h=await n.preload(t,e);h.url&&(s=h.url),h.headers&&(i.loadOptions.fetch={...i.loadOptions.fetch,headers:h.headers}),Object.assign(i,h)}const a=await uu(s,n,i.loadOptions),o=new TY(a,{onTileLoad:this._onTileLoad.bind(this),onTileUnload:this._onTileUnload.bind(this),onTileError:this.props.onTileError,...i});this.setState({tileset3d:o,layerMap:{}}),this._updateTileset(this.state.activeViewports),this.props.onTilesetLoad(o)}_onTileLoad(t){const{lastUpdatedViewports:e}=this.state;this.props.onTileLoad(t),this._updateTileset(e),this.setNeedsUpdate()}_onTileUnload(t){delete this.state.layerMap[t.id],this.props.onTileUnload(t)}_updateTileset(t){if(!t)return;const{tileset3d:e}=this.state,{timeline:n}=this.context,i=Object.keys(t).length;!n||!i||!e||e.selectTiles(Object.values(t)).then(s=>{this.state.frameNumber!==s&&this.setState({frameNumber:s})})}_getSubLayer(t,e){if(!t.content)return null;switch(t.type){case Wd.POINTCLOUD:return this._makePointCloudLayer(t,e);case Wd.SCENEGRAPH:return this._make3DModelLayer(t);case Wd.MESH:return this._makeSimpleMeshLayer(t,e);default:throw new Error("Tile3DLayer: Failed to render layer of type ".concat(t.content.type))}}_makePointCloudLayer(t,e){const{attributes:n,pointCount:i,constantRGBA:s,cartographicOrigin:a,modelMatrix:o}=t.content,{positions:h,normals:f,colors:g}=n;if(!h)return null;const b=e&&e.props.data||{header:{vertexCount:i},attributes:{POSITION:h,NORMAL:f,COLOR_0:g}},{pointSize:C,getPointColor:B}=this.props,R=this.getSubLayerClass("pointcloud",Eb);return new R({pointSize:C},this.getSubLayerProps({id:"pointcloud"}),{id:"".concat(this.id,"-pointcloud-").concat(t.id),tile:t,data:b,coordinateSystem:En.METER_OFFSETS,coordinateOrigin:a,modelMatrix:o,getColor:s||B,_offset:0})}_make3DModelLayer(t){const{gltf:e,instances:n,cartographicOrigin:i,modelMatrix:s}=t.content,a=this.getSubLayerClass("scenegraph",jb);return new a({_lighting:"pbr"},this.getSubLayerProps({id:"scenegraph"}),{id:"".concat(this.id,"-scenegraph-").concat(t.id),tile:t,data:n||ML,scenegraph:e,coordinateSystem:En.METER_OFFSETS,coordinateOrigin:i,modelMatrix:s,getTransformMatrix:o=>o.modelMatrix,getPosition:[0,0,0],_offset:0})}_makeSimpleMeshLayer(t,e){const n=t.content,{attributes:i,indices:s,modelMatrix:a,cartographicOrigin:o,coordinateSystem:h=En.METER_OFFSETS,material:f,featureIds:g}=n,{_getMeshColor:b}=this.props,C=e&&e.props.mesh||new Pp({drawMode:4,attributes:KZ(i),indices:s}),B=this.getSubLayerClass("mesh",qb);return new B(this.getSubLayerProps({id:"mesh"}),{id:"".concat(this.id,"-mesh-").concat(t.id),tile:t,mesh:C,data:ML,getColor:b(t),pbrMaterial:f,modelMatrix:a,coordinateOrigin:o,coordinateSystem:h,featureIds:g,_offset:0})}renderLayers(){const{tileset3d:t,layerMap:e}=this.state;return t?t.tiles.map(n=>{const i=e[n.id]=e[n.id]||{tile:n};let{layer:s}=i;return n.selected&&(s?i.needsUpdate&&(s=this._getSubLayer(n,s),i.needsUpdate=!1):s=this._getSubLayer(n)),i.layer=s,s}).filter(Boolean):null}}K(ww,"defaultProps",qZ),K(ww,"layerName","Tile3DLayer");function KZ(r){const t={};return t.positions={...r.positions,value:new Float32Array(r.positions.value)},r.normals&&(t.normals=r.normals),r.texCoords&&(t.texCoords=r.texCoords),r.colors&&(t.colors=r.colors),r.uvRegions&&(t.uvRegions=r.uvRegions),t}var $Z=Object.defineProperty,WZ=(r,t,e)=>t in r?$Z(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,Ai=(r,t,e)=>(WZ(r,typeof t!="symbol"?t+"":t,e),e);let XZ=class{constructor(t){Ai(this,"map"),Ai(this,"width"),Ai(this,"height"),Ai(this,"svgCanvas"),Ai(this,"xLine"),Ai(this,"yLine"),Ai(this,"color","#535353"),this.map=t,this.mapResize=this.mapResize.bind(this)}create(){this.updateValues(),this.map!==void 0?(this.map.on("resize",this.mapResize),this.createCanvas(this.map.getCanvasContainer())):console.error("map object is null")}updateValues(){var t,e;this.width=(t=this.map)==null?void 0:t.getCanvas().clientWidth,this.height=(e=this.map)==null?void 0:e.getCanvas().clientHeight}mapResize(){this.updateValues(),this.updateCanvas()}updateCanvas(){if(this.svgCanvas!==void 0&&this.yLine!==void 0&&this.xLine!==void 0&&this.width!==void 0&&this.height!==void 0){this.svgCanvas.setAttribute("width",`${this.width}px`),this.svgCanvas.setAttribute("height",`${this.height}px`);const t=this.width/2,e=this.height/2;this.yLine.setAttribute("x1",`${t}px`),this.yLine.setAttribute("y1","0px"),this.yLine.setAttribute("x2",`${t}px`),this.yLine.setAttribute("y2",`${this.height}px`),this.xLine.setAttribute("x1","0px"),this.xLine.setAttribute("y1",`${e}px`),this.xLine.setAttribute("x2",`${this.width}px`),this.xLine.setAttribute("y2",`${e}px`)}else console.error("element value is null")}createCanvas(t){if(this.width!==void 0&&this.height!==void 0){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.style.position="relative",e.setAttribute("width",`${this.width}px`),e.setAttribute("height",`${this.height}px`);const n=this.width/2,i=this.height/2;this.yLine=e.appendChild(this.createLine(n,0,n,this.height,this.color,"2px")),this.xLine=e.appendChild(this.createLine(0,i,this.width,i,this.color,"2px")),t==null||t.appendChild(e),this.svgCanvas=e}}createLine(t,e,n,i,s,a){const o=document.createElementNS("http://www.w3.org/2000/svg","line");return o.setAttribute("x1",t),o.setAttribute("y1",e),o.setAttribute("x2",n),o.setAttribute("y2",i),o.setAttribute("stroke-dasharray","5,5"),o.setAttribute("stroke",s),o.setAttribute("stroke-width",a),o}destroy(){this.xLine!==void 0&&(this.xLine.remove(),this.xLine=void 0),this.yLine!==void 0&&(this.yLine.remove(),this.yLine=void 0),this.svgCanvas!==void 0&&(this.svgCanvas.remove(),this.svgCanvas=void 0),this.map!==void 0&&(this.map.off("resize",this.mapResize),this.map=void 0)}};function Nn(r){"@babel/helpers - typeof";return Nn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Nn(r)}var zo=Uint8Array,Ho=Uint16Array,tg=Uint32Array,Q0=new zo([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),z0=new zo([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),xw=new zo([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),PL=function(r,t){for(var e=new Ho(31),n=0;n<31;++n)e[n]=t+=1<<r[n-1];for(var i=new tg(e[30]),n=1;n<30;++n)for(var s=e[n];s<e[n+1];++s)i[s]=s-e[n]<<5|n;return[e,i]},UL=PL(Q0,2),RL=UL[0],Bw=UL[1];RL[28]=258,Bw[258]=28;for(var DL=PL(z0,0),JZ=DL[0],OL=DL[1],Cw=new Ho(32768),vi=0;vi<32768;++vi){var Bu=(vi&43690)>>>1|(vi&21845)<<1;Bu=(Bu&52428)>>>2|(Bu&13107)<<2,Bu=(Bu&61680)>>>4|(Bu&3855)<<4,Cw[vi]=((Bu&65280)>>>8|(Bu&255)<<8)>>>1}for(var Ul=function(r,t,e){for(var n=r.length,i=0,s=new Ho(t);i<n;++i)++s[r[i]-1];var a=new Ho(t);for(i=0;i<t;++i)a[i]=a[i-1]+s[i-1]<<1;var o;if(e){o=new Ho(1<<t);var h=15-t;for(i=0;i<n;++i)if(r[i])for(var f=i<<4|r[i],g=t-r[i],b=a[r[i]-1]++<<g,C=b|(1<<g)-1;b<=C;++b)o[Cw[b]>>>h]=f}else for(o=new Ho(n),i=0;i<n;++i)o[i]=Cw[a[r[i]-1]++]>>>15-r[i];return o},Cu=new zo(288),vi=0;vi<144;++vi)Cu[vi]=8;for(var vi=144;vi<256;++vi)Cu[vi]=9;for(var vi=256;vi<280;++vi)Cu[vi]=7;for(var vi=280;vi<288;++vi)Cu[vi]=8;for(var eg=new zo(32),vi=0;vi<32;++vi)eg[vi]=5;var YZ=Ul(Cu,9,0),ZZ=Ul(Cu,9,1),ttt=Ul(eg,5,0),ett=Ul(eg,5,1),Ew=function(r){for(var t=r[0],e=1;e<r.length;++e)r[e]>t&&(t=r[e]);return t},Nc=function(r,t,e){var n=t/8>>0;return(r[n]|r[n+1]<<8)>>>(t&7)&e},Sw=function(r,t){var e=t/8>>0;return(r[e]|r[e+1]<<8|r[e+2]<<16)>>>(t&7)},Tw=function(r){return(r/8>>0)+(r&7&&1)},NL=function(r,t,e){(t==null||t<0)&&(t=0),(e==null||e>r.length)&&(e=r.length);var n=new(r instanceof Ho?Ho:r instanceof tg?tg:zo)(e-t);return n.set(r.subarray(t,e)),n},rtt=function(r,t,e){var n=r.length,i=!t||e,s=!e||e.i;e||(e={}),t||(t=new zo(n*3));var a=function(Jt){var se=t.length;if(Jt>se){var Ae=new zo(Math.max(se*2,Jt));Ae.set(t),t=Ae}},o=e.f||0,h=e.p||0,f=e.b||0,g=e.l,b=e.d,C=e.m,B=e.n,R=n*8;do{if(!g){e.f=o=Nc(r,h,1);var D=Nc(r,h+1,3);if(h+=3,D)if(D==1)g=ZZ,b=ett,C=9,B=5;else if(D==2){var Q=Nc(r,h,31)+257,k=Nc(r,h+10,15)+4,j=Q+Nc(r,h+5,31)+1;h+=14;for(var et=new zo(j),st=new zo(19),mt=0;mt<k;++mt)st[xw[mt]]=Nc(r,h+mt*3,7);h+=k*3;var pt=Ew(st),yt=(1<<pt)-1;if(!s&&h+j*(pt+7)>R)break;for(var ft=Ul(st,pt,1),mt=0;mt<j;){var Dt=ft[Nc(r,h,yt)];h+=Dt&15;var It=Dt>>>4;if(It<16)et[mt++]=It;else{var ut=0,At=0;for(It==16?(At=3+Nc(r,h,3),h+=2,ut=et[mt-1]):It==17?(At=3+Nc(r,h,7),h+=3):It==18&&(At=11+Nc(r,h,127),h+=7);At--;)et[mt++]=ut}}var Bt=et.subarray(0,Q),vt=et.subarray(Q);C=Ew(Bt),B=Ew(vt),g=Ul(Bt,C,1),b=Ul(vt,B,1)}else throw"invalid block type";else{var It=Tw(h)+4,ne=r[It-4]|r[It-3]<<8,ie=It+ne;if(ie>n){if(s)throw"unexpected EOF";break}i&&a(f+ne),t.set(r.subarray(It,ie),f),e.b=f+=ne,e.p=h=ie*8;continue}if(h>R)throw"unexpected EOF"}i&&a(f+131072);for(var ae=(1<<C)-1,te=(1<<B)-1,ce=C+B+18;s||h+ce<R;){var ut=g[Sw(r,h)&ae],le=ut>>>4;if(h+=ut&15,h>R)throw"unexpected EOF";if(!ut)throw"invalid length/literal";if(le<256)t[f++]=le;else if(le==256){g=null;break}else{var Te=le-254;if(le>264){var mt=le-257,rt=Q0[mt];Te=Nc(r,h,(1<<rt)-1)+RL[mt],h+=rt}var wt=b[Sw(r,h)&te],St=wt>>>4;if(!wt)throw"invalid distance";h+=wt&15;var vt=JZ[St];if(St>3){var rt=z0[St];vt+=Sw(r,h)&(1<<rt)-1,h+=rt}if(h>R)throw"unexpected EOF";i&&a(f+131072);for(var qt=f+Te;f<qt;f+=4)t[f]=t[f-vt],t[f+1]=t[f+1-vt],t[f+2]=t[f+2-vt],t[f+3]=t[f+3-vt];f=qt}}e.l=g,e.p=h,e.b=f,g&&(o=1,e.m=C,e.d=b,e.n=B)}while(!o);return f==t.length?t:NL(t,0,f)},IA=function(r,t,e){e<<=t&7;var n=t/8>>0;r[n]|=e,r[n+1]|=e>>>8},rg=function(r,t,e){e<<=t&7;var n=t/8>>0;r[n]|=e,r[n+1]|=e>>>8,r[n+2]|=e>>>16},Iw=function(r,t){for(var e=[],n=0;n<r.length;++n)r[n]&&e.push({s:n,f:r[n]});var i=e.length,s=e.slice();if(!i)return[new zo(0),0];if(i==1){var a=new zo(e[0].s+1);return a[e[0].s]=1,[a,1]}e.sort(function(mt,pt){return mt.f-pt.f}),e.push({s:-1,f:25001});var o=e[0],h=e[1],f=0,g=1,b=2;for(e[0]={s:-1,f:o.f+h.f,l:o,r:h};g!=i-1;)o=e[e[f].f<e[b].f?f++:b++],h=e[f!=g&&e[f].f<e[b].f?f++:b++],e[g++]={s:-1,f:o.f+h.f,l:o,r:h};for(var C=s[0].s,n=1;n<i;++n)s[n].s>C&&(C=s[n].s);var B=new Ho(C+1),R=Lw(e[g-1],B,0);if(R>t){var n=0,D=0,Q=R-t,k=1<<Q;for(s.sort(function(pt,yt){return B[yt.s]-B[pt.s]||pt.f-yt.f});n<i;++n){var j=s[n].s;if(B[j]>t)D+=k-(1<<R-B[j]),B[j]=t;else break}for(D>>>=Q;D>0;){var et=s[n].s;B[et]<t?D-=1<<t-B[et]++-1:++n}for(;n>=0&&D;--n){var st=s[n].s;B[st]==t&&(--B[st],++D)}R=t}return[new zo(B),R]},Lw=function(r,t,e){return r.s==-1?Math.max(Lw(r.l,t,e+1),Lw(r.r,t,e+1)):t[r.s]=e},kL=function(r){for(var t=r.length;t&&!r[--t];);for(var e=new Ho(++t),n=0,i=r[0],s=1,a=function(h){e[n++]=h},o=1;o<=t;++o)if(r[o]==i&&o!=t)++s;else{if(!i&&s>2){for(;s>138;s-=138)a(32754);s>2&&(a(s>10?s-11<<5|28690:s-3<<5|12305),s=0)}else if(s>3){for(a(i),--s;s>6;s-=6)a(8304);s>2&&(a(s-3<<5|8208),s=0)}for(;s--;)a(i);s=1,i=r[o]}return[e.subarray(0,n),t]},ng=function(r,t){for(var e=0,n=0;n<t.length;++n)e+=r[n]*t[n];return e},H0=function(r,t,e){var n=e.length,i=Tw(t+2);r[i]=n&255,r[i+1]=n>>>8,r[i+2]=r[i]^255,r[i+3]=r[i+1]^255;for(var s=0;s<n;++s)r[i+s+4]=e[s];return(i+4+n)*8},QL=function(r,t,e,n,i,s,a,o,h,f,g){IA(t,g++,e),++i[256];for(var b=Iw(i,15),C=b[0],B=b[1],R=Iw(s,15),D=R[0],Q=R[1],k=kL(C),j=k[0],et=k[1],st=kL(D),mt=st[0],pt=st[1],yt=new Ho(19),ft=0;ft<j.length;++ft)yt[j[ft]&31]++;for(var ft=0;ft<mt.length;++ft)yt[mt[ft]&31]++;for(var Dt=Iw(yt,7),It=Dt[0],ut=Dt[1],At=19;At>4&&!It[xw[At-1]];--At);var Bt=f+5<<3,vt=ng(i,Cu)+ng(s,eg)+a,ne=ng(i,C)+ng(s,D)+a+14+3*At+ng(yt,It)+(2*yt[16]+3*yt[17]+7*yt[18]);if(Bt<=vt&&Bt<=ne)return H0(t,g,r.subarray(h,h+f));var ie,ae,te,ce;if(IA(t,g,1+(ne<vt)),g+=2,ne<vt){ie=Ul(C,B,0),ae=C,te=Ul(D,Q,0),ce=D;var le=Ul(It,ut,0);IA(t,g,et-257),IA(t,g+5,pt-1),IA(t,g+10,At-4),g+=14;for(var ft=0;ft<At;++ft)IA(t,g+3*ft,It[xw[ft]]);g+=3*At;for(var Te=[j,mt],rt=0;rt<2;++rt)for(var wt=Te[rt],ft=0;ft<wt.length;++ft){var St=wt[ft]&31;IA(t,g,le[St]),g+=It[St],St>15&&(IA(t,g,wt[ft]>>>5&127),g+=wt[ft]>>>12)}}else ie=YZ,ae=Cu,te=ttt,ce=eg;for(var ft=0;ft<o;++ft)if(n[ft]>255){var St=n[ft]>>>18&31;rg(t,g,ie[St+257]),g+=ae[St+257],St>7&&(IA(t,g,n[ft]>>>23&31),g+=Q0[St]);var qt=n[ft]&31;rg(t,g,te[qt]),g+=ce[qt],qt>3&&(rg(t,g,n[ft]>>>5&8191),g+=z0[qt])}else rg(t,g,ie[n[ft]]),g+=ae[n[ft]];return rg(t,g,ie[256]),g+ae[256]},ntt=new tg([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),itt=new zo(0),stt=function(r,t,e,n,i,s){var a=r.length,o=new zo(n+a+5*(1+Math.floor(a/7e3))+i),h=o.subarray(n,o.length-i),f=0;if(!t||a<8)for(var g=0;g<=a;g+=65535){var b=g+65535;b<a?f=H0(h,f,r.subarray(g,b)):(h[g]=s,f=H0(h,f,r.subarray(g,a)))}else{for(var C=ntt[t-1],B=C>>>13,R=C&8191,D=(1<<e)-1,Q=new Ho(32768),k=new Ho(D+1),j=Math.ceil(e/3),et=2*j,st=function(rr){return(r[rr]^r[rr+1]<<j^r[rr+2]<<et)&D},mt=new tg(25e3),pt=new Ho(288),yt=new Ho(32),ft=0,Dt=0,g=0,It=0,ut=0,At=0;g<a;++g){var Bt=st(g),vt=g&32767,ne=k[Bt];if(Q[vt]=ne,k[Bt]=vt,ut<=g){var ie=a-g;if((ft>7e3||It>24576)&&ie>423){f=QL(r,h,0,mt,pt,yt,Dt,It,At,g-At,f),It=ft=Dt=0,At=g;for(var ae=0;ae<286;++ae)pt[ae]=0;for(var ae=0;ae<30;++ae)yt[ae]=0}var te=2,ce=0,le=R,Te=vt-ne&32767;if(ie>2&&Bt==st(g-Te))for(var rt=Math.min(B,ie)-1,wt=Math.min(32767,g),St=Math.min(258,ie);Te<=wt&&--le&&vt!=ne;){if(r[g+te]==r[g+te-Te]){for(var qt=0;qt<St&&r[g+qt]==r[g+qt-Te];++qt);if(qt>te){if(te=qt,ce=Te,qt>rt)break;for(var Jt=Math.min(Te,qt-2),se=0,ae=0;ae<Jt;++ae){var Ae=g-Te+ae+32768&32767,oe=Q[Ae],Ce=Ae-oe+32768&32767;Ce>se&&(se=Ce,ne=Ae)}}}vt=ne,ne=Q[vt],Te+=vt-ne+32768&32767}if(ce){mt[It++]=268435456|Bw[te]<<18|OL[ce];var Pe=Bw[te]&31,Ve=OL[ce]&31;Dt+=Q0[Pe]+z0[Ve],++pt[257+Pe],++yt[Ve],ut=g+te,++ft}else mt[It++]=r[g],++pt[r[g]]}}f=QL(r,h,s,mt,pt,yt,Dt,It,At,g-At,f),s||(f=H0(h,f,itt))}return NL(o,0,n+Tw(f)+i)},ott=function(){var r=1,t=0;return{p:function(e){for(var n=r,i=t,s=e.length,a=0;a!=s;){for(var o=Math.min(a+5552,s);a<o;++a)n+=e[a],i+=n;n%=65521,i%=65521}r=n,t=i},d:function(){return(r>>>8<<16|(t&255)<<8|t>>>8)+((r&255)<<23)*2}}},att=function(r,t,e,n,i){return stt(r,t.level==null?6:t.level,t.mem==null?Math.ceil(Math.max(8,Math.min(13,Math.log(r.length)))*1.5):12+t.mem,e,n,!i)},ctt=function(r,t,e){for(;e;++t)r[t]=e,e>>>=8},ltt=function(r,t){var e=t.level,n=e==0?0:e<6?1:e==9?3:2;r[0]=120,r[1]=n<<6|(n?32-2*n:1)},Att=function(r){if((r[0]&15)!=8||r[0]>>>4>7||(r[0]<<8|r[1])%31)throw"invalid zlib data";if(r[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function Fw(r,t){t===void 0&&(t={});var e=ott();e.p(r);var n=att(r,t,2,4);return ltt(n,t),ctt(n,n.length-4,e.d()),n}function utt(r,t){return rtt((Att(r),r.subarray(2,-4)),t)}/** @license
*
* jsPDF - PDF Document creation from JavaScript
* Version 2.5.1 Built on 2022-01-28T15:37:57.791Z
*                      CommitID 00000000
*
* Copyright (c) 2010-2021 James Hall <james@parall.ax>, https://github.com/MrRio/jsPDF
*               2015-2021 yWorks GmbH, http://www.yworks.com
*               2015-2021 Lukas Hollnder <lukas.hollaender@yworks.com>, https://github.com/HackbrettXXX
*               2016-2018 Aras Abbasi <aras.abbasi@gmail.com>
*               2010 Aaron Spike, https://github.com/acspike
*               2012 Willow Systems Corporation, https://github.com/willowsystems
*               2012 Pablo Hess, https://github.com/pablohess
*               2012 Florian Jenett, https://github.com/fjenett
*               2013 Warren Weckesser, https://github.com/warrenweckesser
*               2013 Youssef Beddad, https://github.com/lifof
*               2013 Lee Driscoll, https://github.com/lsdriscoll
*               2013 Stefan Slonevskiy, https://github.com/stefslon
*               2013 Jeremy Morel, https://github.com/jmorel
*               2013 Christoph Hartmann, https://github.com/chris-rock
*               2014 Juan Pablo Gaviria, https://github.com/juanpgaviria
*               2014 James Makes, https://github.com/dollaruw
*               2014 Diego Casorran, https://github.com/diegocr
*               2014 Steven Spungin, https://github.com/Flamenco
*               2014 Kenneth Glassey, https://github.com/Gavvers
*
* Permission is hereby granted, free of charge, to any person obtaining
* a copy of this software and associated documentation files (the
* "Software"), to deal in the Software without restriction, including
* without limitation the rights to use, copy, modify, merge, publish,
* distribute, sublicense, and/or sell copies of the Software, and to
* permit persons to whom the Software is furnished to do so, subject to
* the following conditions:
*
* The above copyright notice and this permission notice shall be
* included in all copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
* MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
* LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
* OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
* WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
*
* Contributor(s):
*    siefkenj, ahwolf, rickygu, Midnith, saintclair, eaparango,
*    kim3er, mfo, alnorth, Flamenco
*/var Wr=function(){return typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:this}();function Mw(){Wr.console&&typeof Wr.console.log=="function"&&Wr.console.log.apply(Wr.console,arguments)}var ui={log:Mw,warn:function(r){Wr.console&&(typeof Wr.console.warn=="function"?Wr.console.warn.apply(Wr.console,arguments):Mw.call(null,arguments))},error:function(r){Wr.console&&(typeof Wr.console.error=="function"?Wr.console.error.apply(Wr.console,arguments):Mw(r))}};function Pw(r,t,e){var n=new XMLHttpRequest;n.open("GET",r),n.responseType="blob",n.onload=function(){Eh(n.response,t,e)},n.onerror=function(){ui.error("could not download file")},n.send()}function zL(r){var t=new XMLHttpRequest;t.open("HEAD",r,!1);try{t.send()}catch{}return t.status>=200&&t.status<=299}function G0(r){try{r.dispatchEvent(new MouseEvent("click"))}catch{var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),r.dispatchEvent(t)}}var ig,Uw,Eh=Wr.saveAs||((typeof window>"u"?"undefined":Nn(window))!=="object"||window!==Wr?function(){}:typeof HTMLAnchorElement<"u"&&"download"in HTMLAnchorElement.prototype?function(r,t,e){var n=Wr.URL||Wr.webkitURL,i=document.createElement("a");t=t||r.name||"download",i.download=t,i.rel="noopener",typeof r=="string"?(i.href=r,i.origin!==location.origin?zL(i.href)?Pw(r,t,e):G0(i,i.target="_blank"):G0(i)):(i.href=n.createObjectURL(r),setTimeout(function(){n.revokeObjectURL(i.href)},4e4),setTimeout(function(){G0(i)},0))}:"msSaveOrOpenBlob"in navigator?function(r,t,e){if(t=t||r.name||"download",typeof r=="string")if(zL(r))Pw(r,t,e);else{var n=document.createElement("a");n.href=r,n.target="_blank",setTimeout(function(){G0(n)})}else navigator.msSaveOrOpenBlob(function(i,s){return s===void 0?s={autoBom:!1}:Nn(s)!=="object"&&(ui.warn("Deprecated: Expected third argument to be a object"),s={autoBom:!s}),s.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(i.type)?new Blob(["\uFEFF",i],{type:i.type}):i}(r,e),t)}:function(r,t,e,n){if((n=n||open("","_blank"))&&(n.document.title=n.document.body.innerText="downloading..."),typeof r=="string")return Pw(r,t,e);var i=r.type==="application/octet-stream",s=/constructor/i.test(Wr.HTMLElement)||Wr.safari,a=/CriOS\/[\d]+/.test(navigator.userAgent);if((a||i&&s)&&(typeof FileReader>"u"?"undefined":Nn(FileReader))==="object"){var o=new FileReader;o.onloadend=function(){var g=o.result;g=a?g:g.replace(/^data:[^;]*;/,"data:attachment/file;"),n?n.location.href=g:location=g,n=null},o.readAsDataURL(r)}else{var h=Wr.URL||Wr.webkitURL,f=h.createObjectURL(r);n?n.location=f:location.href=f,n=null,setTimeout(function(){h.revokeObjectURL(f)},4e4)}});/**
* A class to parse color values
* @author Stoyan Stefanov <sstoo@gmail.com>
* {@link   http://www.phpied.com/rgb-color-parser-in-javascript/}
* @license Use it if you like it
*/function HL(r){var t;r=r||"",this.ok=!1,r.charAt(0)=="#"&&(r=r.substr(1,6)),r={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"}[r=(r=r.replace(/ /g,"")).toLowerCase()]||r;for(var e=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(o){return[parseInt(o[1]),parseInt(o[2]),parseInt(o[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(o){return[parseInt(o[1],16),parseInt(o[2],16),parseInt(o[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(o){return[parseInt(o[1]+o[1],16),parseInt(o[2]+o[2],16),parseInt(o[3]+o[3],16)]}}],n=0;n<e.length;n++){var i=e[n].re,s=e[n].process,a=i.exec(r);a&&(t=s(a),this.r=t[0],this.g=t[1],this.b=t[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var o=this.r.toString(16),h=this.g.toString(16),f=this.b.toString(16);return o.length==1&&(o="0"+o),h.length==1&&(h="0"+h),f.length==1&&(f="0"+f),"#"+o+h+f}}/**
* @license
* Joseph Myers does not specify a particular license for his work.
*
* Author: Joseph Myers
* Accessed from: http://www.myersdaily.org/joseph/javascript/md5.js
*
* Modified by: Owen Leong
*/function Rw(r,t){var e=r[0],n=r[1],i=r[2],s=r[3];e=po(e,n,i,s,t[0],7,-680876936),s=po(s,e,n,i,t[1],12,-389564586),i=po(i,s,e,n,t[2],17,606105819),n=po(n,i,s,e,t[3],22,-1044525330),e=po(e,n,i,s,t[4],7,-176418897),s=po(s,e,n,i,t[5],12,1200080426),i=po(i,s,e,n,t[6],17,-1473231341),n=po(n,i,s,e,t[7],22,-45705983),e=po(e,n,i,s,t[8],7,1770035416),s=po(s,e,n,i,t[9],12,-1958414417),i=po(i,s,e,n,t[10],17,-42063),n=po(n,i,s,e,t[11],22,-1990404162),e=po(e,n,i,s,t[12],7,1804603682),s=po(s,e,n,i,t[13],12,-40341101),i=po(i,s,e,n,t[14],17,-1502002290),e=go(e,n=po(n,i,s,e,t[15],22,1236535329),i,s,t[1],5,-165796510),s=go(s,e,n,i,t[6],9,-1069501632),i=go(i,s,e,n,t[11],14,643717713),n=go(n,i,s,e,t[0],20,-373897302),e=go(e,n,i,s,t[5],5,-701558691),s=go(s,e,n,i,t[10],9,38016083),i=go(i,s,e,n,t[15],14,-660478335),n=go(n,i,s,e,t[4],20,-405537848),e=go(e,n,i,s,t[9],5,568446438),s=go(s,e,n,i,t[14],9,-1019803690),i=go(i,s,e,n,t[3],14,-187363961),n=go(n,i,s,e,t[8],20,1163531501),e=go(e,n,i,s,t[13],5,-1444681467),s=go(s,e,n,i,t[2],9,-51403784),i=go(i,s,e,n,t[7],14,1735328473),e=mo(e,n=go(n,i,s,e,t[12],20,-1926607734),i,s,t[5],4,-378558),s=mo(s,e,n,i,t[8],11,-2022574463),i=mo(i,s,e,n,t[11],16,1839030562),n=mo(n,i,s,e,t[14],23,-35309556),e=mo(e,n,i,s,t[1],4,-1530992060),s=mo(s,e,n,i,t[4],11,1272893353),i=mo(i,s,e,n,t[7],16,-155497632),n=mo(n,i,s,e,t[10],23,-1094730640),e=mo(e,n,i,s,t[13],4,681279174),s=mo(s,e,n,i,t[0],11,-358537222),i=mo(i,s,e,n,t[3],16,-722521979),n=mo(n,i,s,e,t[6],23,76029189),e=mo(e,n,i,s,t[9],4,-640364487),s=mo(s,e,n,i,t[12],11,-421815835),i=mo(i,s,e,n,t[15],16,530742520),e=yo(e,n=mo(n,i,s,e,t[2],23,-995338651),i,s,t[0],6,-198630844),s=yo(s,e,n,i,t[7],10,1126891415),i=yo(i,s,e,n,t[14],15,-1416354905),n=yo(n,i,s,e,t[5],21,-57434055),e=yo(e,n,i,s,t[12],6,1700485571),s=yo(s,e,n,i,t[3],10,-1894986606),i=yo(i,s,e,n,t[10],15,-1051523),n=yo(n,i,s,e,t[1],21,-2054922799),e=yo(e,n,i,s,t[8],6,1873313359),s=yo(s,e,n,i,t[15],10,-30611744),i=yo(i,s,e,n,t[6],15,-1560198380),n=yo(n,i,s,e,t[13],21,1309151649),e=yo(e,n,i,s,t[4],6,-145523070),s=yo(s,e,n,i,t[11],10,-1120210379),i=yo(i,s,e,n,t[2],15,718787259),n=yo(n,i,s,e,t[9],21,-343485551),r[0]=Eu(e,r[0]),r[1]=Eu(n,r[1]),r[2]=Eu(i,r[2]),r[3]=Eu(s,r[3])}function V0(r,t,e,n,i,s){return t=Eu(Eu(t,r),Eu(n,s)),Eu(t<<i|t>>>32-i,e)}function po(r,t,e,n,i,s,a){return V0(t&e|~t&n,r,t,i,s,a)}function go(r,t,e,n,i,s,a){return V0(t&n|e&~n,r,t,i,s,a)}function mo(r,t,e,n,i,s,a){return V0(t^e^n,r,t,i,s,a)}function yo(r,t,e,n,i,s,a){return V0(e^(t|~n),r,t,i,s,a)}function VL(r){var t,e=r.length,n=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=r.length;t+=64)Rw(n,htt(r.substring(t-64,t)));r=r.substring(t-64);var i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<r.length;t++)i[t>>2]|=r.charCodeAt(t)<<(t%4<<3);if(i[t>>2]|=128<<(t%4<<3),t>55)for(Rw(n,i),t=0;t<16;t++)i[t]=0;return i[14]=8*e,Rw(n,i),n}function htt(r){var t,e=[];for(t=0;t<64;t+=4)e[t>>2]=r.charCodeAt(t)+(r.charCodeAt(t+1)<<8)+(r.charCodeAt(t+2)<<16)+(r.charCodeAt(t+3)<<24);return e}ig=Wr.atob.bind(Wr),Uw=Wr.btoa.bind(Wr);var jL="0123456789abcdef".split("");function dtt(r){for(var t="",e=0;e<4;e++)t+=jL[r>>8*e+4&15]+jL[r>>8*e&15];return t}function ftt(r){return String.fromCharCode((255&r)>>0,(65280&r)>>8,(16711680&r)>>16,(4278190080&r)>>24)}function Dw(r){return VL(r).map(ftt).join("")}var ptt=function(r){for(var t=0;t<r.length;t++)r[t]=dtt(r[t]);return r.join("")}(VL("hello"))!="5d41402abc4b2a76b9719d911017c592";function Eu(r,t){if(ptt){var e=(65535&r)+(65535&t);return(r>>16)+(t>>16)+(e>>16)<<16|65535&e}return r+t&4294967295}/**
* @license
* FPDF is released under a permissive license: there is no usage restriction.
* You may embed it freely in your application (commercial or not), with or
* without modifications.
*
* Reference: http://www.fpdf.org/en/script/script37.php
*/function Ow(r,t){var e,n,i,s;if(r!==e){for(var a=(i=r,s=1+(256/r.length>>0),new Array(s+1).join(i)),o=[],h=0;h<256;h++)o[h]=h;var f=0;for(h=0;h<256;h++){var g=o[h];f=(f+g+a.charCodeAt(h))%256,o[h]=o[f],o[f]=g}e=r,n=o}else o=n;var b=t.length,C=0,B=0,R="";for(h=0;h<b;h++)B=(B+(g=o[C=(C+1)%256]))%256,o[C]=o[B],o[B]=g,a=o[(o[C]+o[B])%256],R+=String.fromCharCode(t.charCodeAt(h)^a);return R}/**
* @license
* Licensed under the MIT License.
* http://opensource.org/licenses/mit-license
* Author: Owen Leong (@owenl131)
* Date: 15 Oct 2020
* References:
* https://www.cs.cmu.edu/~dst/Adobe/Gallery/anon21jul01-pdf-encryption.txt
* https://github.com/foliojs/pdfkit/blob/master/lib/security.js
* http://www.fpdf.org/en/script/script37.php
*/var qL={print:4,modify:8,copy:16,"annot-forms":32};function Zd(r,t,e,n){this.v=1,this.r=2;var i=192;r.forEach(function(o){if(qL.perm!==void 0)throw new Error("Invalid permission: "+o);i+=qL[o]}),this.padding="(N^NuAd\0NV\b..\0h>/\fdSiz";var s=(t+this.padding).substr(0,32),a=(e+this.padding).substr(0,32);this.O=this.processOwnerPassword(s,a),this.P=-(1+(255^i)),this.encryptionKey=Dw(s+this.O+this.lsbFirstWord(this.P)+this.hexToBytes(n)).substr(0,5),this.U=Ow(this.encryptionKey,this.padding)}function tf(r){if(/[^\u0000-\u00ff]/.test(r))throw new Error("Invalid PDF Name Object: "+r+", Only accept ASCII characters.");for(var t="",e=r.length,n=0;n<e;n++){var i=r.charCodeAt(n);i<33||i===35||i===37||i===40||i===41||i===47||i===60||i===62||i===91||i===93||i===123||i===125||i>126?t+="#"+("0"+i.toString(16)).slice(-2):t+=r[n]}return t}function KL(r){if(Nn(r)!=="object")throw new Error("Invalid Context passed to initialize PubSub (jsPDF-module)");var t={};this.subscribe=function(e,n,i){if(i=i||!1,typeof e!="string"||typeof n!="function"||typeof i!="boolean")throw new Error("Invalid arguments passed to PubSub.subscribe (jsPDF-module)");t.hasOwnProperty(e)||(t[e]={});var s=Math.random().toString(35);return t[e][s]=[n,!!i],s},this.unsubscribe=function(e){for(var n in t)if(t[n][e])return delete t[n][e],Object.keys(t[n]).length===0&&delete t[n],!0;return!1},this.publish=function(e){if(t.hasOwnProperty(e)){var n=Array.prototype.slice.call(arguments,1),i=[];for(var s in t[e]){var a=t[e][s];try{a[0].apply(r,n)}catch(o){Wr.console&&ui.error("jsPDF PubSub Error",o.message,o)}a[1]&&i.push(s)}i.length&&i.forEach(this.unsubscribe)}},this.getTopics=function(){return t}}function j0(r){if(!(this instanceof j0))return new j0(r);var t="opacity,stroke-opacity".split(",");for(var e in r)r.hasOwnProperty(e)&&t.indexOf(e)>=0&&(this[e]=r[e]);this.id="",this.objectNumber=-1}function $L(r,t){this.gState=r,this.matrix=t,this.id="",this.objectNumber=-1}function Sh(r,t,e,n,i){if(!(this instanceof Sh))return new Sh(r,t,e,n,i);this.type=r==="axial"?2:3,this.coords=t,this.colors=e,$L.call(this,n,i)}function ef(r,t,e,n,i){if(!(this instanceof ef))return new ef(r,t,e,n,i);this.boundingBox=r,this.xStep=t,this.yStep=e,this.stream="",this.cloneIndex=0,$L.call(this,n,i)}function Xr(r){var t,e=typeof arguments[0]=="string"?arguments[0]:"p",n=arguments[1],i=arguments[2],s=arguments[3],a=[],o=1,h=16,f="S",g=null;Nn(r=r||{})==="object"&&(e=r.orientation,n=r.unit||n,i=r.format||i,s=r.compress||r.compressPdf||s,(g=r.encryption||null)!==null&&(g.userPassword=g.userPassword||"",g.ownerPassword=g.ownerPassword||"",g.userPermissions=g.userPermissions||[]),o=typeof r.userUnit=="number"?Math.abs(r.userUnit):1,r.precision!==void 0&&(t=r.precision),r.floatPrecision!==void 0&&(h=r.floatPrecision),f=r.defaultPathOperation||"S"),a=r.filters||(s===!0?["FlateEncode"]:a),n=n||"mm",e=(""+(e||"P")).toLowerCase();var b=r.putOnlyUsedFonts||!1,C={},B={internal:{},__private__:{}};B.__private__.PubSub=KL;var R="1.3",D=B.__private__.getPdfVersion=function(){return R};B.__private__.setPdfVersion=function(U){R=U};var Q={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};B.__private__.getPageFormats=function(){return Q};var k=B.__private__.getPageFormat=function(U){return Q[U]};i=i||"a4";var j={COMPAT:"compat",ADVANCED:"advanced"},et=j.COMPAT;function st(){this.saveGraphicsState(),Ut(new Ht(je,0,0,-je,0,Rs()*je).toString()+" cm"),this.setFontSize(this.getFontSize()/je),f="n",et=j.ADVANCED}function mt(){this.restoreGraphicsState(),f="S",et=j.COMPAT}var pt=B.__private__.combineFontStyleAndFontWeight=function(U,nt){if(U=="bold"&&nt=="normal"||U=="bold"&&nt==400||U=="normal"&&nt=="italic"||U=="bold"&&nt=="italic")throw new Error("Invalid Combination of fontweight and fontstyle");return nt&&(U=nt==400||nt==="normal"?U==="italic"?"italic":"normal":nt!=700&&nt!=="bold"||U!=="normal"?(nt==700?"bold":nt)+""+U:"bold"),U};B.advancedAPI=function(U){var nt=et===j.COMPAT;return nt&&st.call(this),typeof U!="function"||(U(this),nt&&mt.call(this)),this},B.compatAPI=function(U){var nt=et===j.ADVANCED;return nt&&mt.call(this),typeof U!="function"||(U(this),nt&&st.call(this)),this},B.isAdvancedAPI=function(){return et===j.ADVANCED};var yt,ft=function(U){if(et!==j.ADVANCED)throw new Error(U+" is only available in 'advanced' API mode. You need to call advancedAPI() first.")},Dt=B.roundToPrecision=B.__private__.roundToPrecision=function(U,nt){var Pt=t||nt;if(isNaN(U)||isNaN(Pt))throw new Error("Invalid argument passed to jsPDF.roundToPrecision");return U.toFixed(Pt).replace(/0+$/,"")};yt=B.hpf=B.__private__.hpf=typeof h=="number"?function(U){if(isNaN(U))throw new Error("Invalid argument passed to jsPDF.hpf");return Dt(U,h)}:h==="smart"?function(U){if(isNaN(U))throw new Error("Invalid argument passed to jsPDF.hpf");return Dt(U,U>-1&&U<1?16:5)}:function(U){if(isNaN(U))throw new Error("Invalid argument passed to jsPDF.hpf");return Dt(U,16)};var It=B.f2=B.__private__.f2=function(U){if(isNaN(U))throw new Error("Invalid argument passed to jsPDF.f2");return Dt(U,2)},ut=B.__private__.f3=function(U){if(isNaN(U))throw new Error("Invalid argument passed to jsPDF.f3");return Dt(U,3)},At=B.scale=B.__private__.scale=function(U){if(isNaN(U))throw new Error("Invalid argument passed to jsPDF.scale");return et===j.COMPAT?U*je:et===j.ADVANCED?U:void 0},Bt=function(U){return et===j.COMPAT?Rs()-U:et===j.ADVANCED?U:void 0},vt=function(U){return At(Bt(U))};B.__private__.setPrecision=B.setPrecision=function(U){typeof parseInt(U,10)=="number"&&(t=parseInt(U,10))};var ne,ie="00000000000000000000000000000000",ae=B.__private__.getFileId=function(){return ie},te=B.__private__.setFileId=function(U){return ie=U!==void 0&&/^[a-fA-F0-9]{32}$/.test(U)?U.toUpperCase():ie.split("").map(function(){return"ABCDEF0123456789".charAt(Math.floor(16*Math.random()))}).join(""),g!==null&&(zn=new Zd(g.userPermissions,g.userPassword,g.ownerPassword,ie)),ie};B.setFileId=function(U){return te(U),this},B.getFileId=function(){return ae()};var ce=B.__private__.convertDateToPDFDate=function(U){var nt=U.getTimezoneOffset(),Pt=nt<0?"+":"-",Yt=Math.floor(Math.abs(nt/60)),Zt=Math.abs(nt%60),ge=[Pt,St(Yt),"'",St(Zt),"'"].join("");return["D:",U.getFullYear(),St(U.getMonth()+1),St(U.getDate()),St(U.getHours()),St(U.getMinutes()),St(U.getSeconds()),ge].join("")},le=B.__private__.convertPDFDateToDate=function(U){var nt=parseInt(U.substr(2,4),10),Pt=parseInt(U.substr(6,2),10)-1,Yt=parseInt(U.substr(8,2),10),Zt=parseInt(U.substr(10,2),10),ge=parseInt(U.substr(12,2),10),ze=parseInt(U.substr(14,2),10);return new Date(nt,Pt,Yt,Zt,ge,ze,0)},Te=B.__private__.setCreationDate=function(U){var nt;if(U===void 0&&(U=new Date),U instanceof Date)nt=ce(U);else{if(!/^D:(20[0-2][0-9]|203[0-7]|19[7-9][0-9])(0[0-9]|1[0-2])([0-2][0-9]|3[0-1])(0[0-9]|1[0-9]|2[0-3])(0[0-9]|[1-5][0-9])(0[0-9]|[1-5][0-9])(\+0[0-9]|\+1[0-4]|-0[0-9]|-1[0-1])'(0[0-9]|[1-5][0-9])'?$/.test(U))throw new Error("Invalid argument passed to jsPDF.setCreationDate");nt=U}return ne=nt},rt=B.__private__.getCreationDate=function(U){var nt=ne;return U==="jsDate"&&(nt=le(ne)),nt};B.setCreationDate=function(U){return Te(U),this},B.getCreationDate=function(U){return rt(U)};var wt,St=B.__private__.padd2=function(U){return("0"+parseInt(U)).slice(-2)},qt=B.__private__.padd2Hex=function(U){return("00"+(U=U.toString())).substr(U.length)},Jt=0,se=[],Ae=[],oe=0,Ce=[],Pe=[],Ve=!1,Ke=Ae,rr=function(){Jt=0,oe=0,Ae=[],se=[],Ce=[],dr=ye(),Je=ye()};B.__private__.setCustomOutputDestination=function(U){Ve=!0,Ke=U};var _e=function(U){Ve||(Ke=U)};B.__private__.resetCustomOutputDestination=function(){Ve=!1,Ke=Ae};var Ut=B.__private__.out=function(U){return U=U.toString(),oe+=U.length+1,Ke.push(U),Ke},pr=B.__private__.write=function(U){return Ut(arguments.length===1?U.toString():Array.prototype.join.call(arguments," "))},ir=B.__private__.getArrayBuffer=function(U){for(var nt=U.length,Pt=new ArrayBuffer(nt),Yt=new Uint8Array(Pt);nt--;)Yt[nt]=U.charCodeAt(nt);return Pt},Se=[["Helvetica","helvetica","normal","WinAnsiEncoding"],["Helvetica-Bold","helvetica","bold","WinAnsiEncoding"],["Helvetica-Oblique","helvetica","italic","WinAnsiEncoding"],["Helvetica-BoldOblique","helvetica","bolditalic","WinAnsiEncoding"],["Courier","courier","normal","WinAnsiEncoding"],["Courier-Bold","courier","bold","WinAnsiEncoding"],["Courier-Oblique","courier","italic","WinAnsiEncoding"],["Courier-BoldOblique","courier","bolditalic","WinAnsiEncoding"],["Times-Roman","times","normal","WinAnsiEncoding"],["Times-Bold","times","bold","WinAnsiEncoding"],["Times-Italic","times","italic","WinAnsiEncoding"],["Times-BoldItalic","times","bolditalic","WinAnsiEncoding"],["ZapfDingbats","zapfdingbats","normal",null],["Symbol","symbol","normal",null]];B.__private__.getStandardFonts=function(){return Se};var Kt=r.fontSize||16;B.__private__.setFontSize=B.setFontSize=function(U){return Kt=et===j.ADVANCED?U/je:U,this};var Ie,ke=B.__private__.getFontSize=B.getFontSize=function(){return et===j.COMPAT?Kt:Kt*je},He=r.R2L||!1;B.__private__.setR2L=B.setR2L=function(U){return He=U,this},B.__private__.getR2L=B.getR2L=function(){return He};var De,xr=B.__private__.setZoomMode=function(U){var nt=[void 0,null,"fullwidth","fullheight","fullpage","original"];if(/^(?:\d+\.\d*|\d*\.\d+|\d+)%$/.test(U))Ie=U;else if(isNaN(U)){if(nt.indexOf(U)===-1)throw new Error('zoom must be Integer (e.g. 2), a percentage Value (e.g. 300%) or fullwidth, fullheight, fullpage, original. "'+U+'" is not recognized.');Ie=U}else Ie=parseInt(U,10)};B.__private__.getZoomMode=function(){return Ie};var Pr,Or=B.__private__.setPageMode=function(U){if([void 0,null,"UseNone","UseOutlines","UseThumbs","FullScreen"].indexOf(U)==-1)throw new Error('Page mode must be one of UseNone, UseOutlines, UseThumbs, or FullScreen. "'+U+'" is not recognized.');De=U};B.__private__.getPageMode=function(){return De};var nn=B.__private__.setLayoutMode=function(U){if([void 0,null,"continuous","single","twoleft","tworight","two"].indexOf(U)==-1)throw new Error('Layout mode must be one of continuous, single, twoleft, tworight. "'+U+'" is not recognized.');Pr=U};B.__private__.getLayoutMode=function(){return Pr},B.__private__.setDisplayMode=B.setDisplayMode=function(U,nt,Pt){return xr(U),nn(nt),Or(Pt),this};var Br={title:"",subject:"",author:"",keywords:"",creator:""};B.__private__.getDocumentProperty=function(U){if(Object.keys(Br).indexOf(U)===-1)throw new Error("Invalid argument passed to jsPDF.getDocumentProperty");return Br[U]},B.__private__.getDocumentProperties=function(){return Br},B.__private__.setDocumentProperties=B.setProperties=B.setDocumentProperties=function(U){for(var nt in Br)Br.hasOwnProperty(nt)&&U[nt]&&(Br[nt]=U[nt]);return this},B.__private__.setDocumentProperty=function(U,nt){if(Object.keys(Br).indexOf(U)===-1)throw new Error("Invalid arguments passed to jsPDF.setDocumentProperty");return Br[U]=nt};var Ur,je,Ee,Nr,Vr,qr={},rn={},Fe=[],Ze={},ur={},Jr={},Un={},qe=null,sn=0,_t=[],tt=new KL(B),at=r.hotfixes||[],gt={},Tt={},Ft=[],Ht=function U(nt,Pt,Yt,Zt,ge,ze){if(!(this instanceof U))return new U(nt,Pt,Yt,Zt,ge,ze);isNaN(nt)&&(nt=1),isNaN(Pt)&&(Pt=0),isNaN(Yt)&&(Yt=0),isNaN(Zt)&&(Zt=1),isNaN(ge)&&(ge=0),isNaN(ze)&&(ze=0),this._matrix=[nt,Pt,Yt,Zt,ge,ze]};Object.defineProperty(Ht.prototype,"sx",{get:function(){return this._matrix[0]},set:function(U){this._matrix[0]=U}}),Object.defineProperty(Ht.prototype,"shy",{get:function(){return this._matrix[1]},set:function(U){this._matrix[1]=U}}),Object.defineProperty(Ht.prototype,"shx",{get:function(){return this._matrix[2]},set:function(U){this._matrix[2]=U}}),Object.defineProperty(Ht.prototype,"sy",{get:function(){return this._matrix[3]},set:function(U){this._matrix[3]=U}}),Object.defineProperty(Ht.prototype,"tx",{get:function(){return this._matrix[4]},set:function(U){this._matrix[4]=U}}),Object.defineProperty(Ht.prototype,"ty",{get:function(){return this._matrix[5]},set:function(U){this._matrix[5]=U}}),Object.defineProperty(Ht.prototype,"a",{get:function(){return this._matrix[0]},set:function(U){this._matrix[0]=U}}),Object.defineProperty(Ht.prototype,"b",{get:function(){return this._matrix[1]},set:function(U){this._matrix[1]=U}}),Object.defineProperty(Ht.prototype,"c",{get:function(){return this._matrix[2]},set:function(U){this._matrix[2]=U}}),Object.defineProperty(Ht.prototype,"d",{get:function(){return this._matrix[3]},set:function(U){this._matrix[3]=U}}),Object.defineProperty(Ht.prototype,"e",{get:function(){return this._matrix[4]},set:function(U){this._matrix[4]=U}}),Object.defineProperty(Ht.prototype,"f",{get:function(){return this._matrix[5]},set:function(U){this._matrix[5]=U}}),Object.defineProperty(Ht.prototype,"rotation",{get:function(){return Math.atan2(this.shx,this.sx)}}),Object.defineProperty(Ht.prototype,"scaleX",{get:function(){return this.decompose().scale.sx}}),Object.defineProperty(Ht.prototype,"scaleY",{get:function(){return this.decompose().scale.sy}}),Object.defineProperty(Ht.prototype,"isIdentity",{get:function(){return this.sx===1&&this.shy===0&&this.shx===0&&this.sy===1&&this.tx===0&&this.ty===0}}),Ht.prototype.join=function(U){return[this.sx,this.shy,this.shx,this.sy,this.tx,this.ty].map(yt).join(U)},Ht.prototype.multiply=function(U){var nt=U.sx*this.sx+U.shy*this.shx,Pt=U.sx*this.shy+U.shy*this.sy,Yt=U.shx*this.sx+U.sy*this.shx,Zt=U.shx*this.shy+U.sy*this.sy,ge=U.tx*this.sx+U.ty*this.shx+this.tx,ze=U.tx*this.shy+U.ty*this.sy+this.ty;return new Ht(nt,Pt,Yt,Zt,ge,ze)},Ht.prototype.decompose=function(){var U=this.sx,nt=this.shy,Pt=this.shx,Yt=this.sy,Zt=this.tx,ge=this.ty,ze=Math.sqrt(U*U+nt*nt),Me=(U/=ze)*Pt+(nt/=ze)*Yt;Pt-=U*Me,Yt-=nt*Me;var Ir=Math.sqrt(Pt*Pt+Yt*Yt);return Me/=Ir,U*(Yt/=Ir)<nt*(Pt/=Ir)&&(U=-U,nt=-nt,Me=-Me,ze=-ze),{scale:new Ht(ze,0,0,Ir,0,0),translate:new Ht(1,0,0,1,Zt,ge),rotate:new Ht(U,nt,-nt,U,0,0),skew:new Ht(1,0,Me,1,0,0)}},Ht.prototype.toString=function(U){return this.join(" ")},Ht.prototype.inversed=function(){var U=this.sx,nt=this.shy,Pt=this.shx,Yt=this.sy,Zt=this.tx,ge=this.ty,ze=1/(U*Yt-nt*Pt),Me=Yt*ze,Ir=-nt*ze,mr=-Pt*ze,wr=U*ze;return new Ht(Me,Ir,mr,wr,-Me*Zt-mr*ge,-Ir*Zt-wr*ge)},Ht.prototype.applyToPoint=function(U){var nt=U.x*this.sx+U.y*this.shx+this.tx,Pt=U.x*this.shy+U.y*this.sy+this.ty;return new gc(nt,Pt)},Ht.prototype.applyToRectangle=function(U){var nt=this.applyToPoint(U),Pt=this.applyToPoint(new gc(U.x+U.w,U.y+U.h));return new mc(nt.x,nt.y,Pt.x-nt.x,Pt.y-nt.y)},Ht.prototype.clone=function(){var U=this.sx,nt=this.shy,Pt=this.shx,Yt=this.sy,Zt=this.tx,ge=this.ty;return new Ht(U,nt,Pt,Yt,Zt,ge)},B.Matrix=Ht;var Vt=B.matrixMult=function(U,nt){return nt.multiply(U)},Qt=new Ht(1,0,0,1,0,0);B.unitMatrix=B.identityMatrix=Qt;var $t=function(U,nt){if(!ur[U]){var Pt=(nt instanceof Sh?"Sh":"P")+(Object.keys(Ze).length+1).toString(10);nt.id=Pt,ur[U]=Pt,Ze[Pt]=nt,tt.publish("addPattern",nt)}};B.ShadingPattern=Sh,B.TilingPattern=ef,B.addShadingPattern=function(U,nt){return ft("addShadingPattern()"),$t(U,nt),this},B.beginTilingPattern=function(U){ft("beginTilingPattern()"),Zl(U.boundingBox[0],U.boundingBox[1],U.boundingBox[2]-U.boundingBox[0],U.boundingBox[3]-U.boundingBox[1],U.matrix)},B.endTilingPattern=function(U,nt){ft("endTilingPattern()"),nt.stream=Pe[wt].join(`
`),$t(U,nt),tt.publish("endTilingPattern",nt),Ft.pop().restore()};var fe=B.__private__.newObject=function(){var U=ye();return we(U,!0),U},ye=B.__private__.newObjectDeferred=function(){return Jt++,se[Jt]=function(){return oe},Jt},we=function(U,nt){return nt=typeof nt=="boolean"&&nt,se[U]=oe,nt&&Ut(U+" 0 obj"),U},hr=B.__private__.newAdditionalObject=function(){var U={objId:ye(),content:""};return Ce.push(U),U},dr=ye(),Je=ye(),or=B.__private__.decodeColorString=function(U){var nt=U.split(" ");if(nt.length!==2||nt[1]!=="g"&&nt[1]!=="G")nt.length===5&&(nt[4]==="k"||nt[4]==="K")&&(nt=[(1-nt[0])*(1-nt[3]),(1-nt[1])*(1-nt[3]),(1-nt[2])*(1-nt[3]),"r"]);else{var Pt=parseFloat(nt[0]);nt=[Pt,Pt,Pt,"r"]}for(var Yt="#",Zt=0;Zt<3;Zt++)Yt+=("0"+Math.floor(255*parseFloat(nt[Zt])).toString(16)).slice(-2);return Yt},_r=B.__private__.encodeColorString=function(U){var nt;typeof U=="string"&&(U={ch1:U});var Pt=U.ch1,Yt=U.ch2,Zt=U.ch3,ge=U.ch4,ze=U.pdfColorType==="draw"?["G","RG","K"]:["g","rg","k"];if(typeof Pt=="string"&&Pt.charAt(0)!=="#"){var Me=new HL(Pt);if(Me.ok)Pt=Me.toHex();else if(!/^\d*\.?\d*$/.test(Pt))throw new Error('Invalid color "'+Pt+'" passed to jsPDF.encodeColorString.')}if(typeof Pt=="string"&&/^#[0-9A-Fa-f]{3}$/.test(Pt)&&(Pt="#"+Pt[1]+Pt[1]+Pt[2]+Pt[2]+Pt[3]+Pt[3]),typeof Pt=="string"&&/^#[0-9A-Fa-f]{6}$/.test(Pt)){var Ir=parseInt(Pt.substr(1),16);Pt=Ir>>16&255,Yt=Ir>>8&255,Zt=255&Ir}if(Yt===void 0||ge===void 0&&Pt===Yt&&Yt===Zt)if(typeof Pt=="string")nt=Pt+" "+ze[0];else switch(U.precision){case 2:nt=It(Pt/255)+" "+ze[0];break;case 3:default:nt=ut(Pt/255)+" "+ze[0]}else if(ge===void 0||Nn(ge)==="object"){if(ge&&!isNaN(ge.a)&&ge.a===0)return nt=["1.","1.","1.",ze[1]].join(" ");if(typeof Pt=="string")nt=[Pt,Yt,Zt,ze[1]].join(" ");else switch(U.precision){case 2:nt=[It(Pt/255),It(Yt/255),It(Zt/255),ze[1]].join(" ");break;default:case 3:nt=[ut(Pt/255),ut(Yt/255),ut(Zt/255),ze[1]].join(" ")}}else if(typeof Pt=="string")nt=[Pt,Yt,Zt,ge,ze[2]].join(" ");else switch(U.precision){case 2:nt=[It(Pt),It(Yt),It(Zt),It(ge),ze[2]].join(" ");break;case 3:default:nt=[ut(Pt),ut(Yt),ut(Zt),ut(ge),ze[2]].join(" ")}return nt},Rr=B.__private__.getFilters=function(){return a},jr=B.__private__.putStream=function(U){var nt=(U=U||{}).data||"",Pt=U.filters||Rr(),Yt=U.alreadyAppliedFilters||[],Zt=U.addLength1||!1,ge=nt.length,ze=U.objectId,Me=function(Mi){return Mi};if(g!==null&&ze===void 0)throw new Error("ObjectId must be passed to putStream for file encryption");g!==null&&(Me=zn.encryptor(ze,0));var Ir={};Pt===!0&&(Pt=["FlateEncode"]);var mr=U.additionalKeyValues||[],wr=(Ir=Xr.API.processDataByFilters!==void 0?Xr.API.processDataByFilters(nt,Pt):{data:nt,reverseChain:[]}).reverseChain+(Array.isArray(Yt)?Yt.join(" "):Yt.toString());if(Ir.data.length!==0&&(mr.push({key:"Length",value:Ir.data.length}),Zt===!0&&mr.push({key:"Length1",value:ge})),wr.length!=0)if(wr.split("/").length-1==1)mr.push({key:"Filter",value:wr});else{mr.push({key:"Filter",value:"["+wr+"]"});for(var un=0;un<mr.length;un+=1)if(mr[un].key==="DecodeParms"){for(var si=[],hi=0;hi<Ir.reverseChain.split("/").length-1;hi+=1)si.push("null");si.push(mr[un].value),mr[un].value="["+si.join(" ")+"]"}}Ut("<<");for(var di=0;di<mr.length;di++)Ut("/"+mr[di].key+" "+mr[di].value);Ut(">>"),Ir.data.length!==0&&(Ut("stream"),Ut(Me(Ir.data)),Ut("endstream"))},Fr=B.__private__.putPage=function(U){var nt=U.number,Pt=U.data,Yt=U.objId,Zt=U.contentsObjId;we(Yt,!0),Ut("<</Type /Page"),Ut("/Parent "+U.rootDictionaryObjId+" 0 R"),Ut("/Resources "+U.resourceDictionaryObjId+" 0 R"),Ut("/MediaBox ["+parseFloat(yt(U.mediaBox.bottomLeftX))+" "+parseFloat(yt(U.mediaBox.bottomLeftY))+" "+yt(U.mediaBox.topRightX)+" "+yt(U.mediaBox.topRightY)+"]"),U.cropBox!==null&&Ut("/CropBox ["+yt(U.cropBox.bottomLeftX)+" "+yt(U.cropBox.bottomLeftY)+" "+yt(U.cropBox.topRightX)+" "+yt(U.cropBox.topRightY)+"]"),U.bleedBox!==null&&Ut("/BleedBox ["+yt(U.bleedBox.bottomLeftX)+" "+yt(U.bleedBox.bottomLeftY)+" "+yt(U.bleedBox.topRightX)+" "+yt(U.bleedBox.topRightY)+"]"),U.trimBox!==null&&Ut("/TrimBox ["+yt(U.trimBox.bottomLeftX)+" "+yt(U.trimBox.bottomLeftY)+" "+yt(U.trimBox.topRightX)+" "+yt(U.trimBox.topRightY)+"]"),U.artBox!==null&&Ut("/ArtBox ["+yt(U.artBox.bottomLeftX)+" "+yt(U.artBox.bottomLeftY)+" "+yt(U.artBox.topRightX)+" "+yt(U.artBox.topRightY)+"]"),typeof U.userUnit=="number"&&U.userUnit!==1&&Ut("/UserUnit "+U.userUnit),tt.publish("putPage",{objId:Yt,pageContext:_t[nt],pageNumber:nt,page:Pt}),Ut("/Contents "+Zt+" 0 R"),Ut(">>"),Ut("endobj");var ge=Pt.join(`
`);return et===j.ADVANCED&&(ge+=`
Q`),we(Zt,!0),jr({data:ge,filters:Rr(),objectId:Zt}),Ut("endobj"),Yt},Rt=B.__private__.putPages=function(){var U,nt,Pt=[];for(U=1;U<=sn;U++)_t[U].objId=ye(),_t[U].contentsObjId=ye();for(U=1;U<=sn;U++)Pt.push(Fr({number:U,data:Pe[U],objId:_t[U].objId,contentsObjId:_t[U].contentsObjId,mediaBox:_t[U].mediaBox,cropBox:_t[U].cropBox,bleedBox:_t[U].bleedBox,trimBox:_t[U].trimBox,artBox:_t[U].artBox,userUnit:_t[U].userUnit,rootDictionaryObjId:dr,resourceDictionaryObjId:Je}));we(dr,!0),Ut("<</Type /Pages");var Yt="/Kids [";for(nt=0;nt<sn;nt++)Yt+=Pt[nt]+" 0 R ";Ut(Yt+"]"),Ut("/Count "+sn),Ut(">>"),Ut("endobj"),tt.publish("postPutPages")},Qe=function(U){tt.publish("putFont",{font:U,out:Ut,newObject:fe,putStream:jr}),U.isAlreadyPutted!==!0&&(U.objectNumber=fe(),Ut("<<"),Ut("/Type /Font"),Ut("/BaseFont /"+tf(U.postScriptName)),Ut("/Subtype /Type1"),typeof U.encoding=="string"&&Ut("/Encoding /"+U.encoding),Ut("/FirstChar 32"),Ut("/LastChar 255"),Ut(">>"),Ut("endobj"))},Be=function(){for(var U in qr)qr.hasOwnProperty(U)&&(b===!1||b===!0&&C.hasOwnProperty(U))&&Qe(qr[U])},Er=function(U){U.objectNumber=fe();var nt=[];nt.push({key:"Type",value:"/XObject"}),nt.push({key:"Subtype",value:"/Form"}),nt.push({key:"BBox",value:"["+[yt(U.x),yt(U.y),yt(U.x+U.width),yt(U.y+U.height)].join(" ")+"]"}),nt.push({key:"Matrix",value:"["+U.matrix.toString()+"]"});var Pt=U.pages[1].join(`
`);jr({data:Pt,additionalKeyValues:nt,objectId:U.objectNumber}),Ut("endobj")},Kr=function(){for(var U in gt)gt.hasOwnProperty(U)&&Er(gt[U])},Sn=function(U,nt){var Pt,Yt=[],Zt=1/(nt-1);for(Pt=0;Pt<1;Pt+=Zt)Yt.push(Pt);if(Yt.push(1),U[0].offset!=0){var ge={offset:0,color:U[0].color};U.unshift(ge)}if(U[U.length-1].offset!=1){var ze={offset:1,color:U[U.length-1].color};U.push(ze)}for(var Me="",Ir=0,mr=0;mr<Yt.length;mr++){for(Pt=Yt[mr];Pt>U[Ir+1].offset;)Ir++;var wr=U[Ir].offset,un=(Pt-wr)/(U[Ir+1].offset-wr),si=U[Ir].color,hi=U[Ir+1].color;Me+=qt(Math.round((1-un)*si[0]+un*hi[0]).toString(16))+qt(Math.round((1-un)*si[1]+un*hi[1]).toString(16))+qt(Math.round((1-un)*si[2]+un*hi[2]).toString(16))}return Me.trim()},Rn=function(U,nt){nt||(nt=21);var Pt=fe(),Yt=Sn(U.colors,nt),Zt=[];Zt.push({key:"FunctionType",value:"0"}),Zt.push({key:"Domain",value:"[0.0 1.0]"}),Zt.push({key:"Size",value:"["+nt+"]"}),Zt.push({key:"BitsPerSample",value:"8"}),Zt.push({key:"Range",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),Zt.push({key:"Decode",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),jr({data:Yt,additionalKeyValues:Zt,alreadyAppliedFilters:["/ASCIIHexDecode"],objectId:Pt}),Ut("endobj"),U.objectNumber=fe(),Ut("<< /ShadingType "+U.type),Ut("/ColorSpace /DeviceRGB");var ge="/Coords ["+yt(parseFloat(U.coords[0]))+" "+yt(parseFloat(U.coords[1]))+" ";U.type===2?ge+=yt(parseFloat(U.coords[2]))+" "+yt(parseFloat(U.coords[3])):ge+=yt(parseFloat(U.coords[2]))+" "+yt(parseFloat(U.coords[3]))+" "+yt(parseFloat(U.coords[4]))+" "+yt(parseFloat(U.coords[5])),Ut(ge+="]"),U.matrix&&Ut("/Matrix ["+U.matrix.toString()+"]"),Ut("/Function "+Pt+" 0 R"),Ut("/Extend [true true]"),Ut(">>"),Ut("endobj")},Vn=function(U,nt){var Pt=ye(),Yt=fe();nt.push({resourcesOid:Pt,objectOid:Yt}),U.objectNumber=Yt;var Zt=[];Zt.push({key:"Type",value:"/Pattern"}),Zt.push({key:"PatternType",value:"1"}),Zt.push({key:"PaintType",value:"1"}),Zt.push({key:"TilingType",value:"1"}),Zt.push({key:"BBox",value:"["+U.boundingBox.map(yt).join(" ")+"]"}),Zt.push({key:"XStep",value:yt(U.xStep)}),Zt.push({key:"YStep",value:yt(U.yStep)}),Zt.push({key:"Resources",value:Pt+" 0 R"}),U.matrix&&Zt.push({key:"Matrix",value:"["+U.matrix.toString()+"]"}),jr({data:U.stream,additionalKeyValues:Zt,objectId:U.objectNumber}),Ut("endobj")},kn=function(U){var nt;for(nt in Ze)Ze.hasOwnProperty(nt)&&(Ze[nt]instanceof Sh?Rn(Ze[nt]):Ze[nt]instanceof ef&&Vn(Ze[nt],U))},Qn=function(U){for(var nt in U.objectNumber=fe(),Ut("<<"),U)switch(nt){case"opacity":Ut("/ca "+It(U[nt]));break;case"stroke-opacity":Ut("/CA "+It(U[nt]))}Ut(">>"),Ut("endobj")},Yr=function(){var U;for(U in Jr)Jr.hasOwnProperty(U)&&Qn(Jr[U])},Xs=function(){for(var U in Ut("/XObject <<"),gt)gt.hasOwnProperty(U)&&gt[U].objectNumber>=0&&Ut("/"+U+" "+gt[U].objectNumber+" 0 R");tt.publish("putXobjectDict"),Ut(">>")},ts=function(){zn.oid=fe(),Ut("<<"),Ut("/Filter /Standard"),Ut("/V "+zn.v),Ut("/R "+zn.r),Ut("/U <"+zn.toHexString(zn.U)+">"),Ut("/O <"+zn.toHexString(zn.O)+">"),Ut("/P "+zn.P),Ut(">>"),Ut("endobj")},Dn=function(){for(var U in Ut("/Font <<"),qr)qr.hasOwnProperty(U)&&(b===!1||b===!0&&C.hasOwnProperty(U))&&Ut("/"+U+" "+qr[U].objectNumber+" 0 R");Ut(">>")},Gi=function(){if(Object.keys(Ze).length>0){for(var U in Ut("/Shading <<"),Ze)Ze.hasOwnProperty(U)&&Ze[U]instanceof Sh&&Ze[U].objectNumber>=0&&Ut("/"+U+" "+Ze[U].objectNumber+" 0 R");tt.publish("putShadingPatternDict"),Ut(">>")}},za=function(U){if(Object.keys(Ze).length>0){for(var nt in Ut("/Pattern <<"),Ze)Ze.hasOwnProperty(nt)&&Ze[nt]instanceof B.TilingPattern&&Ze[nt].objectNumber>=0&&Ze[nt].objectNumber<U&&Ut("/"+nt+" "+Ze[nt].objectNumber+" 0 R");tt.publish("putTilingPatternDict"),Ut(">>")}},Ii=function(){if(Object.keys(Jr).length>0){var U;for(U in Ut("/ExtGState <<"),Jr)Jr.hasOwnProperty(U)&&Jr[U].objectNumber>=0&&Ut("/"+U+" "+Jr[U].objectNumber+" 0 R");tt.publish("putGStateDict"),Ut(">>")}},kr=function(U){we(U.resourcesOid,!0),Ut("<<"),Ut("/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]"),Dn(),Gi(),za(U.objectOid),Ii(),Xs(),Ut(">>"),Ut("endobj")},Bo=function(){var U=[];Be(),Yr(),Kr(),kn(U),tt.publish("putResources"),U.forEach(kr),kr({resourcesOid:Je,objectOid:Number.MAX_SAFE_INTEGER}),tt.publish("postPutResources")},Js=function(){tt.publish("putAdditionalObjects");for(var U=0;U<Ce.length;U++){var nt=Ce[U];we(nt.objId,!0),Ut(nt.content),Ut("endobj")}tt.publish("postPutAdditionalObjects")},Tn=function(U){rn[U.fontName]=rn[U.fontName]||{},rn[U.fontName][U.fontStyle]=U.id},on=function(U,nt,Pt,Yt,Zt){var ge={id:"F"+(Object.keys(qr).length+1).toString(10),postScriptName:U,fontName:nt,fontStyle:Pt,encoding:Yt,isStandardFont:Zt||!1,metadata:{}};return tt.publish("addFont",{font:ge,instance:this}),qr[ge.id]=ge,Tn(ge),ge.id},Ys=function(U){for(var nt=0,Pt=Se.length;nt<Pt;nt++){var Yt=on.call(this,U[nt][0],U[nt][1],U[nt][2],Se[nt][3],!0);b===!1&&(C[Yt]=!0);var Zt=U[nt][0].split("-");Tn({id:Yt,fontName:Zt[0],fontStyle:Zt[1]||""})}tt.publish("addFonts",{fonts:qr,dictionary:rn})},An=function(U){return U.foo=function(){try{return U.apply(this,arguments)}catch(Yt){var nt=Yt.stack||"";~nt.indexOf(" at ")&&(nt=nt.split(" at ")[1]);var Pt="Error in function "+nt.split(`
`)[0].split("<")[0]+": "+Yt.message;if(!Wr.console)throw new Error(Pt);Wr.console.error(Pt,Yt),Wr.alert&&alert(Pt)}},U.foo.bar=U,U.foo},Li=function(U,nt){var Pt,Yt,Zt,ge,ze,Me,Ir,mr,wr;if(Zt=(nt=nt||{}).sourceEncoding||"Unicode",ze=nt.outputEncoding,(nt.autoencode||ze)&&qr[Ur].metadata&&qr[Ur].metadata[Zt]&&qr[Ur].metadata[Zt].encoding&&(ge=qr[Ur].metadata[Zt].encoding,!ze&&qr[Ur].encoding&&(ze=qr[Ur].encoding),!ze&&ge.codePages&&(ze=ge.codePages[0]),typeof ze=="string"&&(ze=ge[ze]),ze)){for(Ir=!1,Me=[],Pt=0,Yt=U.length;Pt<Yt;Pt++)(mr=ze[U.charCodeAt(Pt)])?Me.push(String.fromCharCode(mr)):Me.push(U[Pt]),Me[Pt].charCodeAt(0)>>8&&(Ir=!0);U=Me.join("")}for(Pt=U.length;Ir===void 0&&Pt!==0;)U.charCodeAt(Pt-1)>>8&&(Ir=!0),Pt--;if(!Ir)return U;for(Me=nt.noBOM?[]:[254,255],Pt=0,Yt=U.length;Pt<Yt;Pt++){if((wr=(mr=U.charCodeAt(Pt))>>8)>>8)throw new Error("Character at position "+Pt+" of string '"+U+"' exceeds 16bits. Cannot be encoded into UCS-2 BE");Me.push(wr),Me.push(mr-(wr<<8))}return String.fromCharCode.apply(void 0,Me)},jn=B.__private__.pdfEscape=B.pdfEscape=function(U,nt){return Li(U,nt).replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},fa=B.__private__.beginPage=function(U){Pe[++sn]=[],_t[sn]={objId:0,contentsObjId:0,userUnit:Number(o),artBox:null,bleedBox:null,cropBox:null,trimBox:null,mediaBox:{bottomLeftX:0,bottomLeftY:0,topRightX:Number(U[0]),topRightY:Number(U[1])}},hc(sn),_e(Pe[wt])},Cs=function(U,nt){var Pt,Yt,Zt;switch(e=nt||e,typeof U=="string"&&(Pt=k(U.toLowerCase()),Array.isArray(Pt)&&(Yt=Pt[0],Zt=Pt[1])),Array.isArray(U)&&(Yt=U[0]*je,Zt=U[1]*je),isNaN(Yt)&&(Yt=i[0],Zt=i[1]),(Yt>14400||Zt>14400)&&(ui.warn("A page in a PDF can not be wider or taller than 14400 userUnit. jsPDF limits the width/height to 14400"),Yt=Math.min(14400,Yt),Zt=Math.min(14400,Zt)),i=[Yt,Zt],e.substr(0,1)){case"l":Zt>Yt&&(i=[Zt,Yt]);break;case"p":Yt>Zt&&(i=[Zt,Yt])}fa(i),el(rs),Ut(So),VA!==0&&Ut(VA+" J"),jA!==0&&Ut(jA+" j"),tt.publish("addPage",{pageNumber:sn})},Jc=function(U){U>0&&U<=sn&&(Pe.splice(U,1),_t.splice(U,1),sn--,wt>sn&&(wt=sn),this.setPage(wt))},hc=function(U){U>0&&U<=sn&&(wt=U)},dc=B.__private__.getNumberOfPages=B.getNumberOfPages=function(){return Pe.length-1},dt=function(U,nt,Pt){var Yt,Zt=void 0;return Pt=Pt||{},U=U!==void 0?U:qr[Ur].fontName,nt=nt!==void 0?nt:qr[Ur].fontStyle,Yt=U.toLowerCase(),rn[Yt]!==void 0&&rn[Yt][nt]!==void 0?Zt=rn[Yt][nt]:rn[U]!==void 0&&rn[U][nt]!==void 0?Zt=rn[U][nt]:Pt.disableWarning===!1&&ui.warn("Unable to look up font label for font '"+U+"', '"+nt+"'. Refer to getFontList() for available fonts."),Zt||Pt.noFallback||(Zt=rn.times[nt])==null&&(Zt=rn.times.normal),Zt},bt=B.__private__.putInfo=function(){var U=fe(),nt=function(Yt){return Yt};for(var Pt in g!==null&&(nt=zn.encryptor(U,0)),Ut("<<"),Ut("/Producer ("+jn(nt("jsPDF "+Xr.version))+")"),Br)Br.hasOwnProperty(Pt)&&Br[Pt]&&Ut("/"+Pt.substr(0,1).toUpperCase()+Pt.substr(1)+" ("+jn(nt(Br[Pt]))+")");Ut("/CreationDate ("+jn(nt(ne))+")"),Ut(">>"),Ut("endobj")},jt=B.__private__.putCatalog=function(U){var nt=(U=U||{}).rootDictionaryObjId||dr;switch(fe(),Ut("<<"),Ut("/Type /Catalog"),Ut("/Pages "+nt+" 0 R"),Ie||(Ie="fullwidth"),Ie){case"fullwidth":Ut("/OpenAction [3 0 R /FitH null]");break;case"fullheight":Ut("/OpenAction [3 0 R /FitV null]");break;case"fullpage":Ut("/OpenAction [3 0 R /Fit]");break;case"original":Ut("/OpenAction [3 0 R /XYZ null null 1]");break;default:var Pt=""+Ie;Pt.substr(Pt.length-1)==="%"&&(Ie=parseInt(Ie)/100),typeof Ie=="number"&&Ut("/OpenAction [3 0 R /XYZ null null "+It(Ie)+"]")}switch(Pr||(Pr="continuous"),Pr){case"continuous":Ut("/PageLayout /OneColumn");break;case"single":Ut("/PageLayout /SinglePage");break;case"two":case"twoleft":Ut("/PageLayout /TwoColumnLeft");break;case"tworight":Ut("/PageLayout /TwoColumnRight")}De&&Ut("/PageMode /"+De),tt.publish("putCatalog"),Ut(">>"),Ut("endobj")},pe=B.__private__.putTrailer=function(){Ut("trailer"),Ut("<<"),Ut("/Size "+(Jt+1)),Ut("/Root "+Jt+" 0 R"),Ut("/Info "+(Jt-1)+" 0 R"),g!==null&&Ut("/Encrypt "+zn.oid+" 0 R"),Ut("/ID [ <"+ie+"> <"+ie+"> ]"),Ut(">>")},Ue=B.__private__.putHeader=function(){Ut("%PDF-"+R),Ut("%")},cr=B.__private__.putXRef=function(){var U="0000000000";Ut("xref"),Ut("0 "+(Jt+1)),Ut("0000000000 65535 f ");for(var nt=1;nt<=Jt;nt++)typeof se[nt]=="function"?Ut((U+se[nt]()).slice(-10)+" 00000 n "):se[nt]!==void 0?Ut((U+se[nt]).slice(-10)+" 00000 n "):Ut("0000000000 00000 n ")},Qr=B.__private__.buildDocument=function(){rr(),_e(Ae),tt.publish("buildDocument"),Ue(),Rt(),Js(),Bo(),g!==null&&ts(),bt(),jt();var U=oe;return cr(),pe(),Ut("startxref"),Ut(""+U),Ut("%%EOF"),_e(Pe[wt]),Ae.join(`
`)},qn=B.__private__.getBlob=function(U){return new Blob([ir(U)],{type:"application/pdf"})},ti=B.output=B.__private__.output=An(function(U,nt){switch(typeof(nt=nt||{})=="string"?nt={filename:nt}:nt.filename=nt.filename||"generated.pdf",U){case void 0:return Qr();case"save":B.save(nt.filename);break;case"arraybuffer":return ir(Qr());case"blob":return qn(Qr());case"bloburi":case"bloburl":if(Wr.URL!==void 0&&typeof Wr.URL.createObjectURL=="function")return Wr.URL&&Wr.URL.createObjectURL(qn(Qr()))||void 0;ui.warn("bloburl is not supported by your system, because URL.createObjectURL is not supported by your browser.");break;case"datauristring":case"dataurlstring":var Pt="",Yt=Qr();try{Pt=Uw(Yt)}catch{Pt=Uw(unescape(encodeURIComponent(Yt)))}return"data:application/pdf;filename="+nt.filename+";base64,"+Pt;case"pdfobjectnewwindow":if(Object.prototype.toString.call(Wr)==="[object Window]"){var Zt="https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.1.1/pdfobject.min.js",ge=' integrity="sha512-4ze/a9/4jqu+tX9dfOqJYSvyYd5M6qum/3HpCLr+/Jqf0whc37VUbkpNGHR7/8pSnCFw47T1fmIpwBV7UySh3g==" crossorigin="anonymous"';nt.pdfObjectUrl&&(Zt=nt.pdfObjectUrl,ge="");var ze='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><script src="'+Zt+'"'+ge+'><\/script><script >PDFObject.embed("'+this.output("dataurlstring")+'", '+JSON.stringify(nt)+");<\/script></body></html>",Me=Wr.open();return Me!==null&&Me.document.write(ze),Me}throw new Error("The option pdfobjectnewwindow just works in a browser-environment.");case"pdfjsnewwindow":if(Object.prototype.toString.call(Wr)==="[object Window]"){var Ir='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe id="pdfViewer" src="'+(nt.pdfJsUrl||"examples/PDF.js/web/viewer.html")+"?file=&downloadName="+nt.filename+'" width="500px" height="400px" /></body></html>',mr=Wr.open();if(mr!==null){mr.document.write(Ir);var wr=this;mr.document.documentElement.querySelector("#pdfViewer").onload=function(){mr.document.title=nt.filename,mr.document.documentElement.querySelector("#pdfViewer").contentWindow.PDFViewerApplication.open(wr.output("bloburl"))}}return mr}throw new Error("The option pdfjsnewwindow just works in a browser-environment.");case"dataurlnewwindow":if(Object.prototype.toString.call(Wr)!=="[object Window]")throw new Error("The option dataurlnewwindow just works in a browser-environment.");var un='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe src="'+this.output("datauristring",nt)+'"></iframe></body></html>',si=Wr.open();if(si!==null&&(si.document.write(un),si.document.title=nt.filename),si||typeof safari>"u")return si;break;case"datauri":case"dataurl":return Wr.document.location.href=this.output("datauristring",nt);default:return null}}),Bi=function(U){return Array.isArray(at)===!0&&at.indexOf(U)>-1};switch(n){case"pt":je=1;break;case"mm":je=72/25.4;break;case"cm":je=72/2.54;break;case"in":je=72;break;case"px":je=Bi("px_scaling")==1?.75:96/72;break;case"pc":case"em":je=12;break;case"ex":je=6;break;default:if(typeof n!="number")throw new Error("Invalid unit: "+n);je=n}var zn=null;Te(),te();var Vu=function(U){return g!==null?zn.encryptor(U,0):function(nt){return nt}},Yc=B.__private__.getPageInfo=B.getPageInfo=function(U){if(isNaN(U)||U%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfo");return{objId:_t[U].objId,pageNumber:U,pageContext:_t[U]}},$r=B.__private__.getPageInfoByObjId=function(U){if(isNaN(U)||U%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfoByObjId");for(var nt in _t)if(_t[nt].objId===U)break;return Yc(nt)},ju=B.__private__.getCurrentPageInfo=B.getCurrentPageInfo=function(){return{objId:_t[wt].objId,pageNumber:wt,pageContext:_t[wt]}};B.addPage=function(){return Cs.apply(this,arguments),this},B.setPage=function(){return hc.apply(this,arguments),_e.call(this,Pe[wt]),this},B.insertPage=function(U){return this.addPage(),this.movePage(wt,U),this},B.movePage=function(U,nt){var Pt,Yt;if(U>nt){Pt=Pe[U],Yt=_t[U];for(var Zt=U;Zt>nt;Zt--)Pe[Zt]=Pe[Zt-1],_t[Zt]=_t[Zt-1];Pe[nt]=Pt,_t[nt]=Yt,this.setPage(nt)}else if(U<nt){Pt=Pe[U],Yt=_t[U];for(var ge=U;ge<nt;ge++)Pe[ge]=Pe[ge+1],_t[ge]=_t[ge+1];Pe[nt]=Pt,_t[nt]=Yt,this.setPage(nt)}return this},B.deletePage=function(){return Jc.apply(this,arguments),this},B.__private__.text=B.text=function(U,nt,Pt,Yt,Zt){var ge,ze,Me,Ir,mr,wr,un,si,hi,di=(Yt=Yt||{}).scope||this;if(typeof U=="number"&&typeof nt=="number"&&(typeof Pt=="string"||Array.isArray(Pt))){var Mi=Pt;Pt=nt,nt=U,U=Mi}if(arguments[3]instanceof Ht?(ft("The transform parameter of text() with a Matrix value"),hi=Zt):(Me=arguments[4],Ir=arguments[5],Nn(un=arguments[3])==="object"&&un!==null||(typeof Me=="string"&&(Ir=Me,Me=null),typeof un=="string"&&(Ir=un,un=null),typeof un=="number"&&(Me=un,un=null),Yt={flags:un,angle:Me,align:Ir})),isNaN(nt)||isNaN(Pt)||U==null)throw new Error("Invalid arguments passed to jsPDF.text");if(U.length===0)return di;var Ci="",Ds=!1,Os=typeof Yt.lineHeightFactor=="number"?Yt.lineHeightFactor:Fi,Zs=di.internal.scaleFactor;function vc(bn){return bn=bn.split("	").join(Array(Yt.TabLen||9).join(" ")),jn(bn,un)}function Ha(bn){for(var wn,bi=bn.concat(),wi=[],xa=bi.length;xa--;)typeof(wn=bi.shift())=="string"?wi.push(wn):Array.isArray(bn)&&(wn.length===1||wn[1]===void 0&&wn[2]===void 0)?wi.push(wn[0]):wi.push([wn[0],wn[1],wn[2]]);return wi}function qA(bn,wn){var bi;if(typeof bn=="string")bi=wn(bn)[0];else if(Array.isArray(bn)){for(var wi,xa,Jo=bn.concat(),Yo=[],Fo=Jo.length;Fo--;)typeof(wi=Jo.shift())=="string"?Yo.push(wn(wi)[0]):Array.isArray(wi)&&typeof wi[0]=="string"&&(xa=wn(wi[0],wi[1],wi[2]),Yo.push([xa[0],xa[1],xa[2]]));bi=Yo}return bi}var bc=!1,KA=!0;if(typeof U=="string")bc=!0;else if(Array.isArray(U)){var eA=U.concat();ze=[];for(var Ga,ps=eA.length;ps--;)(typeof(Ga=eA.shift())!="string"||Array.isArray(Ga)&&typeof Ga[0]!="string")&&(KA=!1);bc=KA}if(bc===!1)throw new Error('Type of text must be string or Array. "'+U+'" is not recognized.');typeof U=="string"&&(U=U.match(/[\r?\n]/)?U.split(/\r\n|\r|\n/g):[U]);var ol=Kt/di.internal.scaleFactor,al=ol*(Os-1);switch(Yt.baseline){case"bottom":Pt-=al;break;case"top":Pt+=ol-al;break;case"hanging":Pt+=ol-2*al;break;case"middle":Pt+=ol/2-al}if((wr=Yt.maxWidth||0)>0&&(typeof U=="string"?U=di.splitTextToSize(U,wr):Object.prototype.toString.call(U)==="[object Array]"&&(U=U.reduce(function(bn,wn){return bn.concat(di.splitTextToSize(wn,wr))},[]))),ge={text:U,x:nt,y:Pt,options:Yt,mutex:{pdfEscape:jn,activeFontKey:Ur,fonts:qr,activeFontSize:Kt}},tt.publish("preProcessText",ge),U=ge.text,Me=(Yt=ge.options).angle,!(hi instanceof Ht)&&Me&&typeof Me=="number"){Me*=Math.PI/180,Yt.rotationDirection===0&&(Me=-Me),et===j.ADVANCED&&(Me=-Me);var ya=Math.cos(Me),wc=Math.sin(Me);hi=new Ht(ya,wc,-wc,ya,0,0)}else Me&&Me instanceof Ht&&(hi=Me);et!==j.ADVANCED||hi||(hi=Qt),(mr=Yt.charSpace||Yl)!==void 0&&(Ci+=yt(At(mr))+` Tc
`,this.setCharSpace(this.getCharSpace()||0)),(si=Yt.horizontalScale)!==void 0&&(Ci+=yt(100*si)+` Tz
`),Yt.lang;var ns=-1,Ku=Yt.renderingMode!==void 0?Yt.renderingMode:Yt.stroke,Kn=di.internal.getCurrentPageInfo().pageContext;switch(Ku){case 0:case!1:case"fill":ns=0;break;case 1:case!0:case"stroke":ns=1;break;case 2:case"fillThenStroke":ns=2;break;case 3:case"invisible":ns=3;break;case 4:case"fillAndAddForClipping":ns=4;break;case 5:case"strokeAndAddPathForClipping":ns=5;break;case 6:case"fillThenStrokeAndAddToPathForClipping":ns=6;break;case 7:case"addToPathForClipping":ns=7}var _a=Kn.usedRenderingMode!==void 0?Kn.usedRenderingMode:-1;ns!==-1?Ci+=ns+` Tr
`:_a!==-1&&(Ci+=`0 Tr
`),ns!==-1&&(Kn.usedRenderingMode=ns),Ir=Yt.align||"left";var oi,va=Kt*Os,cl=di.internal.pageSize.getWidth(),rA=qr[Ur];mr=Yt.charSpace||Yl,wr=Yt.maxWidth||0,un=Object.assign({autoencode:!0,noBOM:!0},Yt.flags);var Ns=[];if(Object.prototype.toString.call(U)==="[object Array]"){var gs;ze=Ha(U),Ir!=="left"&&(oi=ze.map(function(bn){return di.getStringUnitWidth(bn,{font:rA,charSpace:mr,fontSize:Kt,doKerning:!1})*Kt/Zs}));var ms,Va=0;if(Ir==="right"){nt-=oi[0],U=[],ps=ze.length;for(var Xo=0;Xo<ps;Xo++)Xo===0?(ms=Eo(nt),gs=ma(Pt)):(ms=At(Va-oi[Xo]),gs=-va),U.push([ze[Xo],ms,gs]),Va=oi[Xo]}else if(Ir==="center"){nt-=oi[0]/2,U=[],ps=ze.length;for(var ba=0;ba<ps;ba++)ba===0?(ms=Eo(nt),gs=ma(Pt)):(ms=At((Va-oi[ba])/2),gs=-va),U.push([ze[ba],ms,gs]),Va=oi[ba]}else if(Ir==="left"){U=[],ps=ze.length;for(var ll=0;ll<ps;ll++)U.push(ze[ll])}else{if(Ir!=="justify")throw new Error('Unrecognized alignment option, use "left", "center", "right" or "justify".');U=[],ps=ze.length,wr=wr!==0?wr:cl;for(var Io=0;Io<ps;Io++)gs=Io===0?ma(Pt):-va,ms=Io===0?Eo(nt):0,Io<ps-1?Ns.push(yt(At((wr-oi[Io])/(ze[Io].split(" ").length-1)))):Ns.push(0),U.push([ze[Io],ms,gs])}}var Es=typeof Yt.R2L=="boolean"?Yt.R2L:He;Es===!0&&(U=qA(U,function(bn,wn,bi){return[bn.split("").reverse().join(""),wn,bi]})),ge={text:U,x:nt,y:Pt,options:Yt,mutex:{pdfEscape:jn,activeFontKey:Ur,fonts:qr,activeFontSize:Kt}},tt.publish("postProcessText",ge),U=ge.text,Ds=ge.mutex.isHex||!1;var ja=qr[Ur].encoding;ja!=="WinAnsiEncoding"&&ja!=="StandardEncoding"||(U=qA(U,function(bn,wn,bi){return[vc(bn),wn,bi]})),ze=Ha(U),U=[];for(var Ei,Ss,wa,xc=0,Al=1,Ts=Array.isArray(ze[0])?Al:xc,qa="",ys=function(bn,wn,bi){var wi="";return bi instanceof Ht?(bi=typeof Yt.angle=="number"?Vt(bi,new Ht(1,0,0,1,bn,wn)):Vt(new Ht(1,0,0,1,bn,wn),bi),et===j.ADVANCED&&(bi=Vt(new Ht(1,0,0,-1,0,0),bi)),wi=bi.join(" ")+` Tm
`):wi=yt(bn)+" "+yt(wn)+` Td
`,wi},Si=0;Si<ze.length;Si++){switch(qa="",Ts){case Al:wa=(Ds?"<":"(")+ze[Si][0]+(Ds?">":")"),Ei=parseFloat(ze[Si][1]),Ss=parseFloat(ze[Si][2]);break;case xc:wa=(Ds?"<":"(")+ze[Si]+(Ds?">":")"),Ei=Eo(nt),Ss=ma(Pt)}Ns!==void 0&&Ns[Si]!==void 0&&(qa=Ns[Si]+` Tw
`),Si===0?U.push(qa+ys(Ei,Ss,hi)+wa):Ts===xc?U.push(qa+wa):Ts===Al&&U.push(qa+ys(Ei,Ss,hi)+wa)}U=Ts===xc?U.join(` Tj
T* `):U.join(` Tj
`),U+=` Tj
`;var Lo=`BT
/`;return Lo+=Ur+" "+Kt+` Tf
`,Lo+=yt(Kt*Os)+` TL
`,Lo+=To+`
`,Lo+=Ci,Lo+=U,Ut(Lo+="ET"),C[Ur]=!0,di};var HA=B.__private__.clip=B.clip=function(U){return Ut(U==="evenodd"?"W*":"W"),this};B.clipEvenOdd=function(){return HA("evenodd")},B.__private__.discardPath=B.discardPath=function(){return Ut("n"),this};var Co=B.__private__.isValidStyle=function(U){var nt=!1;return[void 0,null,"S","D","F","DF","FD","f","f*","B","B*","n"].indexOf(U)!==-1&&(nt=!0),nt};B.__private__.setDefaultPathOperation=B.setDefaultPathOperation=function(U){return Co(U)&&(f=U),this};var pa=B.__private__.getStyle=B.getStyle=function(U){var nt=f;switch(U){case"D":case"S":nt="S";break;case"F":nt="f";break;case"FD":case"DF":nt="B";break;case"f":case"f*":case"B":case"B*":nt=U}return nt},Zc=B.close=function(){return Ut("h"),this};B.stroke=function(){return Ut("S"),this},B.fill=function(U){return es("f",U),this},B.fillEvenOdd=function(U){return es("f*",U),this},B.fillStroke=function(U){return es("B",U),this},B.fillStrokeEvenOdd=function(U){return es("B*",U),this};var es=function(U,nt){Nn(nt)==="object"?tl(nt,U):Ut(U)},fc=function(U){U===null||et===j.ADVANCED&&U===void 0||(U=pa(U),Ut(U))};function ql(U,nt,Pt,Yt,Zt){var ge=new ef(nt||this.boundingBox,Pt||this.xStep,Yt||this.yStep,this.gState,Zt||this.matrix);ge.stream=this.stream;var ze=U+"$$"+this.cloneIndex+++"$$";return $t(ze,ge),ge}var tl=function(U,nt){var Pt=ur[U.key],Yt=Ze[Pt];if(Yt instanceof Sh)Ut("q"),Ut(Kl(nt)),Yt.gState&&B.setGState(Yt.gState),Ut(U.matrix.toString()+" cm"),Ut("/"+Pt+" sh"),Ut("Q");else if(Yt instanceof ef){var Zt=new Ht(1,0,0,-1,0,Rs());U.matrix&&(Zt=Zt.multiply(U.matrix||Qt),Pt=ql.call(Yt,U.key,U.boundingBox,U.xStep,U.yStep,Zt).id),Ut("q"),Ut("/Pattern cs"),Ut("/"+Pt+" scn"),Yt.gState&&B.setGState(Yt.gState),Ut(nt),Ut("Q")}},Kl=function(U){switch(U){case"f":case"F":return"W n";case"f*":return"W* n";case"B":return"W S";case"B*":return"W* S";case"S":return"W S";case"n":return"W n"}},ga=B.moveTo=function(U,nt){return Ut(yt(At(U))+" "+yt(vt(nt))+" m"),this},Us=B.lineTo=function(U,nt){return Ut(yt(At(U))+" "+yt(vt(nt))+" l"),this},Zr=B.curveTo=function(U,nt,Pt,Yt,Zt,ge){return Ut([yt(At(U)),yt(vt(nt)),yt(At(Pt)),yt(vt(Yt)),yt(At(Zt)),yt(vt(ge)),"c"].join(" ")),this};B.__private__.line=B.line=function(U,nt,Pt,Yt,Zt){if(isNaN(U)||isNaN(nt)||isNaN(Pt)||isNaN(Yt)||!Co(Zt))throw new Error("Invalid arguments passed to jsPDF.line");return et===j.COMPAT?this.lines([[Pt-U,Yt-nt]],U,nt,[1,1],Zt||"S"):this.lines([[Pt-U,Yt-nt]],U,nt,[1,1]).stroke()},B.__private__.lines=B.lines=function(U,nt,Pt,Yt,Zt,ge){var ze,Me,Ir,mr,wr,un,si,hi,di,Mi,Ci,Ds;if(typeof U=="number"&&(Ds=Pt,Pt=nt,nt=U,U=Ds),Yt=Yt||[1,1],ge=ge||!1,isNaN(nt)||isNaN(Pt)||!Array.isArray(U)||!Array.isArray(Yt)||!Co(Zt)||typeof ge!="boolean")throw new Error("Invalid arguments passed to jsPDF.lines");for(ga(nt,Pt),ze=Yt[0],Me=Yt[1],mr=U.length,Mi=nt,Ci=Pt,Ir=0;Ir<mr;Ir++)(wr=U[Ir]).length===2?(Mi=wr[0]*ze+Mi,Ci=wr[1]*Me+Ci,Us(Mi,Ci)):(un=wr[0]*ze+Mi,si=wr[1]*Me+Ci,hi=wr[2]*ze+Mi,di=wr[3]*Me+Ci,Mi=wr[4]*ze+Mi,Ci=wr[5]*Me+Ci,Zr(un,si,hi,di,Mi,Ci));return ge&&Zc(),fc(Zt),this},B.path=function(U){for(var nt=0;nt<U.length;nt++){var Pt=U[nt],Yt=Pt.c;switch(Pt.op){case"m":ga(Yt[0],Yt[1]);break;case"l":Us(Yt[0],Yt[1]);break;case"c":Zr.apply(this,Yt);break;case"h":Zc()}}return this},B.__private__.rect=B.rect=function(U,nt,Pt,Yt,Zt){if(isNaN(U)||isNaN(nt)||isNaN(Pt)||isNaN(Yt)||!Co(Zt))throw new Error("Invalid arguments passed to jsPDF.rect");return et===j.COMPAT&&(Yt=-Yt),Ut([yt(At(U)),yt(vt(nt)),yt(At(Pt)),yt(At(Yt)),"re"].join(" ")),fc(Zt),this},B.__private__.triangle=B.triangle=function(U,nt,Pt,Yt,Zt,ge,ze){if(isNaN(U)||isNaN(nt)||isNaN(Pt)||isNaN(Yt)||isNaN(Zt)||isNaN(ge)||!Co(ze))throw new Error("Invalid arguments passed to jsPDF.triangle");return this.lines([[Pt-U,Yt-nt],[Zt-Pt,ge-Yt],[U-Zt,nt-ge]],U,nt,[1,1],ze,!0),this},B.__private__.roundedRect=B.roundedRect=function(U,nt,Pt,Yt,Zt,ge,ze){if(isNaN(U)||isNaN(nt)||isNaN(Pt)||isNaN(Yt)||isNaN(Zt)||isNaN(ge)||!Co(ze))throw new Error("Invalid arguments passed to jsPDF.roundedRect");var Me=4/3*(Math.SQRT2-1);return Zt=Math.min(Zt,.5*Pt),ge=Math.min(ge,.5*Yt),this.lines([[Pt-2*Zt,0],[Zt*Me,0,Zt,ge-ge*Me,Zt,ge],[0,Yt-2*ge],[0,ge*Me,-Zt*Me,ge,-Zt,ge],[2*Zt-Pt,0],[-Zt*Me,0,-Zt,-ge*Me,-Zt,-ge],[0,2*ge-Yt],[0,-ge*Me,Zt*Me,-ge,Zt,-ge]],U+Zt,nt,[1,1],ze,!0),this},B.__private__.ellipse=B.ellipse=function(U,nt,Pt,Yt,Zt){if(isNaN(U)||isNaN(nt)||isNaN(Pt)||isNaN(Yt)||!Co(Zt))throw new Error("Invalid arguments passed to jsPDF.ellipse");var ge=4/3*(Math.SQRT2-1)*Pt,ze=4/3*(Math.SQRT2-1)*Yt;return ga(U+Pt,nt),Zr(U+Pt,nt-ze,U+ge,nt-Yt,U,nt-Yt),Zr(U-ge,nt-Yt,U-Pt,nt-ze,U-Pt,nt),Zr(U-Pt,nt+ze,U-ge,nt+Yt,U,nt+Yt),Zr(U+ge,nt+Yt,U+Pt,nt+ze,U+Pt,nt),fc(Zt),this},B.__private__.circle=B.circle=function(U,nt,Pt,Yt){if(isNaN(U)||isNaN(nt)||isNaN(Pt)||!Co(Yt))throw new Error("Invalid arguments passed to jsPDF.circle");return this.ellipse(U,nt,Pt,Pt,Yt)},B.setFont=function(U,nt,Pt){return Pt&&(nt=pt(nt,Pt)),Ur=dt(U,nt,{disableWarning:!1}),this};var $l=B.__private__.getFont=B.getFont=function(){return qr[dt.apply(B,arguments)]};B.__private__.getFontList=B.getFontList=function(){var U,nt,Pt={};for(U in rn)if(rn.hasOwnProperty(U))for(nt in Pt[U]=[],rn[U])rn[U].hasOwnProperty(nt)&&Pt[U].push(nt);return Pt},B.addFont=function(U,nt,Pt,Yt,Zt){var ge=["StandardEncoding","MacRomanEncoding","Identity-H","WinAnsiEncoding"];return arguments[3]&&ge.indexOf(arguments[3])!==-1?Zt=arguments[3]:arguments[3]&&ge.indexOf(arguments[3])==-1&&(Pt=pt(Pt,Yt)),Zt=Zt||"Identity-H",on.call(this,U,nt,Pt,Zt)};var Fi,rs=r.lineWidth||.200025,pc=B.__private__.getLineWidth=B.getLineWidth=function(){return rs},el=B.__private__.setLineWidth=B.setLineWidth=function(U){return rs=U,Ut(yt(At(U))+" w"),this};B.__private__.setLineDash=Xr.API.setLineDash=Xr.API.setLineDashPattern=function(U,nt){if(U=U||[],nt=nt||0,isNaN(nt)||!Array.isArray(U))throw new Error("Invalid arguments passed to jsPDF.setLineDash");return U=U.map(function(Pt){return yt(At(Pt))}).join(" "),nt=yt(At(nt)),Ut("["+U+"] "+nt+" d"),this};var rl=B.__private__.getLineHeight=B.getLineHeight=function(){return Kt*Fi};B.__private__.getLineHeight=B.getLineHeight=function(){return Kt*Fi};var Wl=B.__private__.setLineHeightFactor=B.setLineHeightFactor=function(U){return typeof(U=U||1.15)=="number"&&(Fi=U),this},Xl=B.__private__.getLineHeightFactor=B.getLineHeightFactor=function(){return Fi};Wl(r.lineHeight);var Eo=B.__private__.getHorizontalCoordinate=function(U){return At(U)},ma=B.__private__.getVerticalCoordinate=function(U){return et===j.ADVANCED?U:_t[wt].mediaBox.topRightY-_t[wt].mediaBox.bottomLeftY-At(U)},GA=B.__private__.getHorizontalCoordinateString=B.getHorizontalCoordinateString=function(U){return yt(Eo(U))},Wo=B.__private__.getVerticalCoordinateString=B.getVerticalCoordinateString=function(U){return yt(ma(U))},So=r.strokeColor||"0 G";B.__private__.getStrokeColor=B.getDrawColor=function(){return or(So)},B.__private__.setStrokeColor=B.setDrawColor=function(U,nt,Pt,Yt){return So=_r({ch1:U,ch2:nt,ch3:Pt,ch4:Yt,pdfColorType:"draw",precision:2}),Ut(So),this};var Jl=r.fillColor||"0 g";B.__private__.getFillColor=B.getFillColor=function(){return or(Jl)},B.__private__.setFillColor=B.setFillColor=function(U,nt,Pt,Yt){return Jl=_r({ch1:U,ch2:nt,ch3:Pt,ch4:Yt,pdfColorType:"fill",precision:2}),Ut(Jl),this};var To=r.textColor||"0 g",Xh=B.__private__.getTextColor=B.getTextColor=function(){return or(To)};B.__private__.setTextColor=B.setTextColor=function(U,nt,Pt,Yt){return To=_r({ch1:U,ch2:nt,ch3:Pt,ch4:Yt,pdfColorType:"text",precision:3}),this};var Yl=r.charSpace,Jh=B.__private__.getCharSpace=B.getCharSpace=function(){return parseFloat(Yl||0)};B.__private__.setCharSpace=B.setCharSpace=function(U){if(isNaN(U))throw new Error("Invalid argument passed to jsPDF.setCharSpace");return Yl=U,this};var VA=0;B.CapJoinStyles={0:0,butt:0,but:0,miter:0,1:1,round:1,rounded:1,circle:1,2:2,projecting:2,project:2,square:2,bevel:2},B.__private__.setLineCap=B.setLineCap=function(U){var nt=B.CapJoinStyles[U];if(nt===void 0)throw new Error("Line cap style of '"+U+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return VA=nt,Ut(nt+" J"),this};var jA=0;B.__private__.setLineJoin=B.setLineJoin=function(U){var nt=B.CapJoinStyles[U];if(nt===void 0)throw new Error("Line join style of '"+U+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return jA=nt,Ut(nt+" j"),this},B.__private__.setLineMiterLimit=B.__private__.setMiterLimit=B.setLineMiterLimit=B.setMiterLimit=function(U){if(U=U||0,isNaN(U))throw new Error("Invalid argument passed to jsPDF.setLineMiterLimit");return Ut(yt(At(U))+" M"),this},B.GState=j0,B.setGState=function(U){(U=typeof U=="string"?Jr[Un[U]]:qu(null,U)).equals(qe)||(Ut("/"+U.id+" gs"),qe=U)};var qu=function(U,nt){if(!U||!Un[U]){var Pt=!1;for(var Yt in Jr)if(Jr.hasOwnProperty(Yt)&&Jr[Yt].equals(nt)){Pt=!0;break}if(Pt)nt=Jr[Yt];else{var Zt="GS"+(Object.keys(Jr).length+1).toString(10);Jr[Zt]=nt,nt.id=Zt}return U&&(Un[U]=nt.id),tt.publish("addGState",nt),nt}};B.addGState=function(U,nt){return qu(U,nt),this},B.saveGraphicsState=function(){return Ut("q"),Fe.push({key:Ur,size:Kt,color:To}),this},B.restoreGraphicsState=function(){Ut("Q");var U=Fe.pop();return Ur=U.key,Kt=U.size,To=U.color,qe=null,this},B.setCurrentTransformationMatrix=function(U){return Ut(U.toString()+" cm"),this},B.comment=function(U){return Ut("#"+U),this};var gc=function(U,nt){var Pt=U||0;Object.defineProperty(this,"x",{enumerable:!0,get:function(){return Pt},set:function(ge){isNaN(ge)||(Pt=parseFloat(ge))}});var Yt=nt||0;Object.defineProperty(this,"y",{enumerable:!0,get:function(){return Yt},set:function(ge){isNaN(ge)||(Yt=parseFloat(ge))}});var Zt="pt";return Object.defineProperty(this,"type",{enumerable:!0,get:function(){return Zt},set:function(ge){Zt=ge.toString()}}),this},mc=function(U,nt,Pt,Yt){gc.call(this,U,nt),this.type="rect";var Zt=Pt||0;Object.defineProperty(this,"w",{enumerable:!0,get:function(){return Zt},set:function(ze){isNaN(ze)||(Zt=parseFloat(ze))}});var ge=Yt||0;return Object.defineProperty(this,"h",{enumerable:!0,get:function(){return ge},set:function(ze){isNaN(ze)||(ge=parseFloat(ze))}}),this},nl=function(){this.page=sn,this.currentPage=wt,this.pages=Pe.slice(0),this.pagesContext=_t.slice(0),this.x=Ee,this.y=Nr,this.matrix=Vr,this.width=_c(wt),this.height=Rs(wt),this.outputDestination=Ke,this.id="",this.objectNumber=-1};nl.prototype.restore=function(){sn=this.page,wt=this.currentPage,_t=this.pagesContext,Pe=this.pages,Ee=this.x,Nr=this.y,Vr=this.matrix,sl(wt,this.width),tA(wt,this.height),Ke=this.outputDestination};var Zl=function(U,nt,Pt,Yt,Zt){Ft.push(new nl),sn=wt=0,Pe=[],Ee=U,Nr=nt,Vr=Zt,fa([Pt,Yt])},yc=function(U){if(Tt[U])Ft.pop().restore();else{var nt=new nl,Pt="Xo"+(Object.keys(gt).length+1).toString(10);nt.id=Pt,Tt[U]=Pt,gt[Pt]=nt,tt.publish("addFormObject",nt),Ft.pop().restore()}};for(var il in B.beginFormObject=function(U,nt,Pt,Yt,Zt){return Zl(U,nt,Pt,Yt,Zt),this},B.endFormObject=function(U){return yc(U),this},B.doFormObject=function(U,nt){var Pt=gt[Tt[U]];return Ut("q"),Ut(nt.toString()+" cm"),Ut("/"+Pt.id+" Do"),Ut("Q"),this},B.getFormObject=function(U){var nt=gt[Tt[U]];return{x:nt.x,y:nt.y,width:nt.width,height:nt.height,matrix:nt.matrix}},B.save=function(U,nt){return U=U||"generated.pdf",(nt=nt||{}).returnPromise=nt.returnPromise||!1,nt.returnPromise===!1?(Eh(qn(Qr()),U),typeof Eh.unload=="function"&&Wr.setTimeout&&setTimeout(Eh.unload,911),this):new Promise(function(Pt,Yt){try{var Zt=Eh(qn(Qr()),U);typeof Eh.unload=="function"&&Wr.setTimeout&&setTimeout(Eh.unload,911),Pt(Zt)}catch(ge){Yt(ge.message)}})},Xr.API)Xr.API.hasOwnProperty(il)&&(il==="events"&&Xr.API.events.length?function(U,nt){var Pt,Yt,Zt;for(Zt=nt.length-1;Zt!==-1;Zt--)Pt=nt[Zt][0],Yt=nt[Zt][1],U.subscribe.apply(U,[Pt].concat(typeof Yt=="function"?[Yt]:Yt))}(tt,Xr.API.events):B[il]=Xr.API[il]);var _c=B.getPageWidth=function(U){return(_t[U=U||wt].mediaBox.topRightX-_t[U].mediaBox.bottomLeftX)/je},sl=B.setPageWidth=function(U,nt){_t[U].mediaBox.topRightX=nt*je+_t[U].mediaBox.bottomLeftX},Rs=B.getPageHeight=function(U){return(_t[U=U||wt].mediaBox.topRightY-_t[U].mediaBox.bottomLeftY)/je},tA=B.setPageHeight=function(U,nt){_t[U].mediaBox.topRightY=nt*je+_t[U].mediaBox.bottomLeftY};return B.internal={pdfEscape:jn,getStyle:pa,getFont:$l,getFontSize:ke,getCharSpace:Jh,getTextColor:Xh,getLineHeight:rl,getLineHeightFactor:Xl,getLineWidth:pc,write:pr,getHorizontalCoordinate:Eo,getVerticalCoordinate:ma,getCoordinateString:GA,getVerticalCoordinateString:Wo,collections:{},newObject:fe,newAdditionalObject:hr,newObjectDeferred:ye,newObjectDeferredBegin:we,getFilters:Rr,putStream:jr,events:tt,scaleFactor:je,pageSize:{getWidth:function(){return _c(wt)},setWidth:function(U){sl(wt,U)},getHeight:function(){return Rs(wt)},setHeight:function(U){tA(wt,U)}},encryptionOptions:g,encryption:zn,getEncryptor:Vu,output:ti,getNumberOfPages:dc,pages:Pe,out:Ut,f2:It,f3:ut,getPageInfo:Yc,getPageInfoByObjId:$r,getCurrentPageInfo:ju,getPDFVersion:D,Point:gc,Rectangle:mc,Matrix:Ht,hasHotfix:Bi},Object.defineProperty(B.internal.pageSize,"width",{get:function(){return _c(wt)},set:function(U){sl(wt,U)},enumerable:!0,configurable:!0}),Object.defineProperty(B.internal.pageSize,"height",{get:function(){return Rs(wt)},set:function(U){tA(wt,U)},enumerable:!0,configurable:!0}),Ys.call(B,Se),Ur="F1",Cs(i,e),tt.publish("initialized"),B}Zd.prototype.lsbFirstWord=function(r){return String.fromCharCode(r>>0&255,r>>8&255,r>>16&255,r>>24&255)},Zd.prototype.toHexString=function(r){return r.split("").map(function(t){return("0"+(255&t.charCodeAt(0)).toString(16)).slice(-2)}).join("")},Zd.prototype.hexToBytes=function(r){for(var t=[],e=0;e<r.length;e+=2)t.push(String.fromCharCode(parseInt(r.substr(e,2),16)));return t.join("")},Zd.prototype.processOwnerPassword=function(r,t){return Ow(Dw(t).substr(0,5),r)},Zd.prototype.encryptor=function(r,t){var e=Dw(this.encryptionKey+String.fromCharCode(255&r,r>>8&255,r>>16&255,255&t,t>>8&255)).substr(0,10);return function(n){return Ow(e,n)}},j0.prototype.equals=function(r){var t,e="id,objectNumber,equals";if(!r||Nn(r)!==Nn(this))return!1;var n=0;for(t in this)if(!(e.indexOf(t)>=0)){if(this.hasOwnProperty(t)&&!r.hasOwnProperty(t)||this[t]!==r[t])return!1;n++}for(t in r)r.hasOwnProperty(t)&&e.indexOf(t)<0&&n--;return n===0},Xr.API={events:[]},Xr.version="2.5.1";var Qi=Xr.API,Nw=1,Th=function(r){return r.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},rf=function(r){return r.replace(/\\\\/g,"\\").replace(/\\\(/g,"(").replace(/\\\)/g,")")},an=function(r){return r.toFixed(2)},Su=function(r){return r.toFixed(5)};Qi.__acroform__={};var Aa=function(r,t){r.prototype=Object.create(t.prototype),r.prototype.constructor=r},WL=function(r){return r*Nw},Rl=function(r){var t=new JL,e=Tr.internal.getHeight(r)||0,n=Tr.internal.getWidth(r)||0;return t.BBox=[0,0,Number(an(n)),Number(an(e))],t},gtt=Qi.__acroform__.setBit=function(r,t){if(r=r||0,t=t||0,isNaN(r)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBit");return r|=1<<t},mtt=Qi.__acroform__.clearBit=function(r,t){if(r=r||0,t=t||0,isNaN(r)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBit");return r&=~(1<<t)},ytt=Qi.__acroform__.getBit=function(r,t){if(isNaN(r)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBit");return r&1<<t?1:0},qi=Qi.__acroform__.getBitForPdf=function(r,t){if(isNaN(r)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBitForPdf");return ytt(r,t-1)},Ki=Qi.__acroform__.setBitForPdf=function(r,t){if(isNaN(r)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBitForPdf");return gtt(r,t-1)},$i=Qi.__acroform__.clearBitForPdf=function(r,t){if(isNaN(r)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBitForPdf");return mtt(r,t-1)},_tt=Qi.__acroform__.calculateCoordinates=function(r,t){var e=t.internal.getHorizontalCoordinate,n=t.internal.getVerticalCoordinate,i=r[0],s=r[1],a=r[2],o=r[3],h={};return h.lowerLeft_X=e(i)||0,h.lowerLeft_Y=n(s+o)||0,h.upperRight_X=e(i+a)||0,h.upperRight_Y=n(s)||0,[Number(an(h.lowerLeft_X)),Number(an(h.lowerLeft_Y)),Number(an(h.upperRight_X)),Number(an(h.upperRight_Y))]},vtt=function(r){if(r.appearanceStreamContent)return r.appearanceStreamContent;if(r.V||r.DV){var t=[],e=r._V||r.DV,n=kw(r,e),i=r.scope.internal.getFont(r.fontName,r.fontStyle).id;t.push("/Tx BMC"),t.push("q"),t.push("BT"),t.push(r.scope.__private__.encodeColorString(r.color)),t.push("/"+i+" "+an(n.fontSize)+" Tf"),t.push("1 0 0 1 0 0 Tm"),t.push(n.text),t.push("ET"),t.push("Q"),t.push("EMC");var s=Rl(r);return s.scope=r.scope,s.stream=t.join(`
`),s}},kw=function(r,t){var e=r.fontSize===0?r.maxFontSize:r.fontSize,n={text:"",fontSize:""},i=(t=(t=t.substr(0,1)=="("?t.substr(1):t).substr(t.length-1)==")"?t.substr(0,t.length-1):t).split(" ");i=r.multiline?i.map(function(ut){return ut.split(`
`)}):i.map(function(ut){return[ut]});var s=e,a=Tr.internal.getHeight(r)||0;a=a<0?-a:a;var o=Tr.internal.getWidth(r)||0;o=o<0?-o:o;var h=function(ut,At,Bt){if(ut+1<i.length){var vt=At+" "+i[ut+1][0];return q0(vt,r,Bt).width<=o-4}return!1};s++;t:for(;s>0;){t="",s--;var f,g,b=q0("3",r,s).height,C=r.multiline?a-s:(a-b)/2,B=C+=2,R=0,D=0,Q=0;if(s<=0){t=`(...) Tj
`,t+="% Width of Text: "+q0(t,r,s=12).width+", FieldWidth:"+o+`
`;break}for(var k="",j=0,et=0;et<i.length;et++)if(i.hasOwnProperty(et)){var st=!1;if(i[et].length!==1&&Q!==i[et].length-1){if((b+2)*(j+2)+2>a)continue t;k+=i[et][Q],st=!0,D=et,et--}else{k=(k+=i[et][Q]+" ").substr(k.length-1)==" "?k.substr(0,k.length-1):k;var mt=parseInt(et),pt=h(mt,k,s),yt=et>=i.length-1;if(pt&&!yt){k+=" ",Q=0;continue}if(pt||yt){if(yt)D=mt;else if(r.multiline&&(b+2)*(j+2)+2>a)continue t}else{if(!r.multiline||(b+2)*(j+2)+2>a)continue t;D=mt}}for(var ft="",Dt=R;Dt<=D;Dt++){var It=i[Dt];if(r.multiline){if(Dt===D){ft+=It[Q]+" ",Q=(Q+1)%It.length;continue}if(Dt===R){ft+=It[It.length-1]+" ";continue}}ft+=It[0]+" "}switch(ft=ft.substr(ft.length-1)==" "?ft.substr(0,ft.length-1):ft,g=q0(ft,r,s).width,r.textAlign){case"right":f=o-g-2;break;case"center":f=(o-g)/2;break;case"left":default:f=2}t+=an(f)+" "+an(B)+` Td
`,t+="("+Th(ft)+`) Tj
`,t+=-an(f)+` 0 Td
`,B=-(s+2),g=0,R=st?D:D+1,j++,k=""}break}return n.text=t,n.fontSize=s,n},q0=function(r,t,e){var n=t.scope.internal.getFont(t.fontName,t.fontStyle),i=t.scope.getStringUnitWidth(r,{font:n,fontSize:parseFloat(e),charSpace:0})*parseFloat(e);return{height:t.scope.getStringUnitWidth("3",{font:n,fontSize:parseFloat(e),charSpace:0})*parseFloat(e)*1.5,width:i}},btt={fields:[],xForms:[],acroFormDictionaryRoot:null,printedOut:!1,internal:null,isInitialized:!1},wtt=function(r,t){var e={type:"reference",object:r};t.internal.getPageInfo(r.page).pageContext.annotations.find(function(n){return n.type===e.type&&n.object===e.object})===void 0&&t.internal.getPageInfo(r.page).pageContext.annotations.push(e)},xtt=function(r,t){for(var e in r)if(r.hasOwnProperty(e)){var n=e,i=r[e];t.internal.newObjectDeferredBegin(i.objId,!0),Nn(i)==="object"&&typeof i.putStream=="function"&&i.putStream(),delete r[n]}},Btt=function(r,t){if(t.scope=r,r.internal!==void 0&&(r.internal.acroformPlugin===void 0||r.internal.acroformPlugin.isInitialized===!1)){if(kc.FieldNum=0,r.internal.acroformPlugin=JSON.parse(JSON.stringify(btt)),r.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("Exception while creating AcroformDictionary");Nw=r.internal.scaleFactor,r.internal.acroformPlugin.acroFormDictionaryRoot=new YL,r.internal.acroformPlugin.acroFormDictionaryRoot.scope=r,r.internal.acroformPlugin.acroFormDictionaryRoot._eventID=r.internal.events.subscribe("postPutResources",function(){(function(e){e.internal.events.unsubscribe(e.internal.acroformPlugin.acroFormDictionaryRoot._eventID),delete e.internal.acroformPlugin.acroFormDictionaryRoot._eventID,e.internal.acroformPlugin.printedOut=!0})(r)}),r.internal.events.subscribe("buildDocument",function(){(function(e){e.internal.acroformPlugin.acroFormDictionaryRoot.objId=void 0;var n=e.internal.acroformPlugin.acroFormDictionaryRoot.Fields;for(var i in n)if(n.hasOwnProperty(i)){var s=n[i];s.objId=void 0,s.hasAnnotation&&wtt(s,e)}})(r)}),r.internal.events.subscribe("putCatalog",function(){(function(e){if(e.internal.acroformPlugin.acroFormDictionaryRoot===void 0)throw new Error("putCatalogCallback: Root missing.");e.internal.write("/AcroForm "+e.internal.acroformPlugin.acroFormDictionaryRoot.objId+" 0 R")})(r)}),r.internal.events.subscribe("postPutPages",function(e){(function(n,i){var s=!n;for(var a in n||(i.internal.newObjectDeferredBegin(i.internal.acroformPlugin.acroFormDictionaryRoot.objId,!0),i.internal.acroformPlugin.acroFormDictionaryRoot.putStream()),n=n||i.internal.acroformPlugin.acroFormDictionaryRoot.Kids)if(n.hasOwnProperty(a)){var o=n[a],h=[],f=o.Rect;if(o.Rect&&(o.Rect=_tt(o.Rect,i)),i.internal.newObjectDeferredBegin(o.objId,!0),o.DA=Tr.createDefaultAppearanceStream(o),Nn(o)==="object"&&typeof o.getKeyValueListForStream=="function"&&(h=o.getKeyValueListForStream()),o.Rect=f,o.hasAppearanceStream&&!o.appearanceStreamContent){var g=vtt(o);h.push({key:"AP",value:"<</N "+g+">>"}),i.internal.acroformPlugin.xForms.push(g)}if(o.appearanceStreamContent){var b="";for(var C in o.appearanceStreamContent)if(o.appearanceStreamContent.hasOwnProperty(C)){var B=o.appearanceStreamContent[C];if(b+="/"+C+" ",b+="<<",Object.keys(B).length>=1||Array.isArray(B)){for(var a in B)if(B.hasOwnProperty(a)){var R=B[a];typeof R=="function"&&(R=R.call(i,o)),b+="/"+a+" "+R+" ",i.internal.acroformPlugin.xForms.indexOf(R)>=0||i.internal.acroformPlugin.xForms.push(R)}}else typeof(R=B)=="function"&&(R=R.call(i,o)),b+="/"+a+" "+R,i.internal.acroformPlugin.xForms.indexOf(R)>=0||i.internal.acroformPlugin.xForms.push(R);b+=">>"}h.push({key:"AP",value:`<<
`+b+">>"})}i.internal.putStream({additionalKeyValues:h,objectId:o.objId}),i.internal.out("endobj")}s&&xtt(i.internal.acroformPlugin.xForms,i)})(e,r)}),r.internal.acroformPlugin.isInitialized=!0}},XL=Qi.__acroform__.arrayToPdfArray=function(r,t,e){var n=function(a){return a};if(Array.isArray(r)){for(var i="[",s=0;s<r.length;s++)switch(s!==0&&(i+=" "),Nn(r[s])){case"boolean":case"number":case"object":i+=r[s].toString();break;case"string":r[s].substr(0,1)!=="/"?(t!==void 0&&e&&(n=e.internal.getEncryptor(t)),i+="("+Th(n(r[s].toString()))+")"):i+=r[s].toString()}return i+="]"}throw new Error("Invalid argument passed to jsPDF.__acroform__.arrayToPdfArray")},Qw=function(r,t,e){var n=function(i){return i};return t!==void 0&&e&&(n=e.internal.getEncryptor(t)),(r=r||"").toString(),r="("+Th(n(r))+")"},Dl=function(){this._objId=void 0,this._scope=void 0,Object.defineProperty(this,"objId",{get:function(){if(this._objId===void 0){if(this.scope===void 0)return;this._objId=this.scope.internal.newObjectDeferred()}return this._objId},set:function(r){this._objId=r}}),Object.defineProperty(this,"scope",{value:this._scope,writable:!0})};Dl.prototype.toString=function(){return this.objId+" 0 R"},Dl.prototype.putStream=function(){var r=this.getKeyValueListForStream();this.scope.internal.putStream({data:this.stream,additionalKeyValues:r,objectId:this.objId}),this.scope.internal.out("endobj")},Dl.prototype.getKeyValueListForStream=function(){var r=[],t=Object.getOwnPropertyNames(this).filter(function(s){return s!="content"&&s!="appearanceStreamContent"&&s!="scope"&&s!="objId"&&s.substring(0,1)!="_"});for(var e in t)if(Object.getOwnPropertyDescriptor(this,t[e]).configurable===!1){var n=t[e],i=this[n];i&&(Array.isArray(i)?r.push({key:n,value:XL(i,this.objId,this.scope)}):i instanceof Dl?(i.scope=this.scope,r.push({key:n,value:i.objId+" 0 R"})):typeof i!="function"&&r.push({key:n,value:i}))}return r};var JL=function(){Dl.call(this),Object.defineProperty(this,"Type",{value:"/XObject",configurable:!1,writable:!0}),Object.defineProperty(this,"Subtype",{value:"/Form",configurable:!1,writable:!0}),Object.defineProperty(this,"FormType",{value:1,configurable:!1,writable:!0});var r,t=[];Object.defineProperty(this,"BBox",{configurable:!1,get:function(){return t},set:function(e){t=e}}),Object.defineProperty(this,"Resources",{value:"2 0 R",configurable:!1,writable:!0}),Object.defineProperty(this,"stream",{enumerable:!1,configurable:!0,set:function(e){r=e.trim()},get:function(){return r||null}})};Aa(JL,Dl);var YL=function(){Dl.call(this);var r,t=[];Object.defineProperty(this,"Kids",{enumerable:!1,configurable:!0,get:function(){return t.length>0?t:void 0}}),Object.defineProperty(this,"Fields",{enumerable:!1,configurable:!1,get:function(){return t}}),Object.defineProperty(this,"DA",{enumerable:!1,configurable:!1,get:function(){if(r){var e=function(n){return n};return this.scope&&(e=this.scope.internal.getEncryptor(this.objId)),"("+Th(e(r))+")"}},set:function(e){r=e}})};Aa(YL,Dl);var kc=function r(){Dl.call(this);var t=4;Object.defineProperty(this,"F",{enumerable:!1,configurable:!1,get:function(){return t},set:function(k){if(isNaN(k))throw new Error('Invalid value "'+k+'" for attribute F supplied.');t=k}}),Object.defineProperty(this,"showWhenPrinted",{enumerable:!0,configurable:!0,get:function(){return!!qi(t,3)},set:function(k){k?this.F=Ki(t,3):this.F=$i(t,3)}});var e=0;Object.defineProperty(this,"Ff",{enumerable:!1,configurable:!1,get:function(){return e},set:function(k){if(isNaN(k))throw new Error('Invalid value "'+k+'" for attribute Ff supplied.');e=k}});var n=[];Object.defineProperty(this,"Rect",{enumerable:!1,configurable:!1,get:function(){if(n.length!==0)return n},set:function(k){n=k!==void 0?k:[]}}),Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[0])?0:n[0]},set:function(k){n[0]=k}}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[1])?0:n[1]},set:function(k){n[1]=k}}),Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[2])?0:n[2]},set:function(k){n[2]=k}}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[3])?0:n[3]},set:function(k){n[3]=k}});var i="";Object.defineProperty(this,"FT",{enumerable:!0,configurable:!1,get:function(){return i},set:function(k){switch(k){case"/Btn":case"/Tx":case"/Ch":case"/Sig":i=k;break;default:throw new Error('Invalid value "'+k+'" for attribute FT supplied.')}}});var s=null;Object.defineProperty(this,"T",{enumerable:!0,configurable:!1,get:function(){if(!s||s.length<1){if(this instanceof W0)return;s="FieldObject"+r.FieldNum++}var k=function(j){return j};return this.scope&&(k=this.scope.internal.getEncryptor(this.objId)),"("+Th(k(s))+")"},set:function(k){s=k.toString()}}),Object.defineProperty(this,"fieldName",{configurable:!0,enumerable:!0,get:function(){return s},set:function(k){s=k}});var a="helvetica";Object.defineProperty(this,"fontName",{enumerable:!0,configurable:!0,get:function(){return a},set:function(k){a=k}});var o="normal";Object.defineProperty(this,"fontStyle",{enumerable:!0,configurable:!0,get:function(){return o},set:function(k){o=k}});var h=0;Object.defineProperty(this,"fontSize",{enumerable:!0,configurable:!0,get:function(){return h},set:function(k){h=k}});var f=void 0;Object.defineProperty(this,"maxFontSize",{enumerable:!0,configurable:!0,get:function(){return f===void 0?50/Nw:f},set:function(k){f=k}});var g="black";Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,get:function(){return g},set:function(k){g=k}});var b="/F1 0 Tf 0 g";Object.defineProperty(this,"DA",{enumerable:!0,configurable:!1,get:function(){if(!(!b||this instanceof W0||this instanceof Ih))return Qw(b,this.objId,this.scope)},set:function(k){k=k.toString(),b=k}});var C=null;Object.defineProperty(this,"DV",{enumerable:!1,configurable:!1,get:function(){if(C)return this instanceof Fs?C:Qw(C,this.objId,this.scope)},set:function(k){k=k.toString(),C=this instanceof Fs?k:k.substr(0,1)==="("?rf(k.substr(1,k.length-2)):rf(k)}}),Object.defineProperty(this,"defaultValue",{enumerable:!0,configurable:!0,get:function(){return this instanceof Fs?rf(C.substr(1,C.length-1)):C},set:function(k){k=k.toString(),C=this instanceof Fs?"/"+k:k}});var B=null;Object.defineProperty(this,"_V",{enumerable:!1,configurable:!1,get:function(){if(B)return B},set:function(k){this.V=k}}),Object.defineProperty(this,"V",{enumerable:!1,configurable:!1,get:function(){if(B)return this instanceof Fs?B:Qw(B,this.objId,this.scope)},set:function(k){k=k.toString(),B=this instanceof Fs?k:k.substr(0,1)==="("?rf(k.substr(1,k.length-2)):rf(k)}}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,get:function(){return this instanceof Fs?rf(B.substr(1,B.length-1)):B},set:function(k){k=k.toString(),B=this instanceof Fs?"/"+k:k}}),Object.defineProperty(this,"hasAnnotation",{enumerable:!0,configurable:!0,get:function(){return this.Rect}}),Object.defineProperty(this,"Type",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Annot":null}}),Object.defineProperty(this,"Subtype",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Widget":null}});var R,D=!1;Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return D},set:function(k){k=!!k,D=k}}),Object.defineProperty(this,"page",{enumerable:!0,configurable:!0,get:function(){if(R)return R},set:function(k){R=k}}),Object.defineProperty(this,"readOnly",{enumerable:!0,configurable:!0,get:function(){return!!qi(this.Ff,1)},set:function(k){k?this.Ff=Ki(this.Ff,1):this.Ff=$i(this.Ff,1)}}),Object.defineProperty(this,"required",{enumerable:!0,configurable:!0,get:function(){return!!qi(this.Ff,2)},set:function(k){k?this.Ff=Ki(this.Ff,2):this.Ff=$i(this.Ff,2)}}),Object.defineProperty(this,"noExport",{enumerable:!0,configurable:!0,get:function(){return!!qi(this.Ff,3)},set:function(k){k?this.Ff=Ki(this.Ff,3):this.Ff=$i(this.Ff,3)}});var Q=null;Object.defineProperty(this,"Q",{enumerable:!0,configurable:!1,get:function(){if(Q!==null)return Q},set:function(k){if([0,1,2].indexOf(k)===-1)throw new Error('Invalid value "'+k+'" for attribute Q supplied.');Q=k}}),Object.defineProperty(this,"textAlign",{get:function(){var k;switch(Q){case 0:default:k="left";break;case 1:k="center";break;case 2:k="right"}return k},configurable:!0,enumerable:!0,set:function(k){switch(k){case"right":case 2:Q=2;break;case"center":case 1:Q=1;break;case"left":case 0:default:Q=0}}})};Aa(kc,Dl);var nf=function(){kc.call(this),this.FT="/Ch",this.V="()",this.fontName="zapfdingbats";var r=0;Object.defineProperty(this,"TI",{enumerable:!0,configurable:!1,get:function(){return r},set:function(e){r=e}}),Object.defineProperty(this,"topIndex",{enumerable:!0,configurable:!0,get:function(){return r},set:function(e){r=e}});var t=[];Object.defineProperty(this,"Opt",{enumerable:!0,configurable:!1,get:function(){return XL(t,this.objId,this.scope)},set:function(e){var n,i;i=[],typeof(n=e)=="string"&&(i=function(s,a,o){o||(o=1);for(var h,f=[];h=a.exec(s);)f.push(h[o]);return f}(n,/\((.*?)\)/g)),t=i}}),this.getOptions=function(){return t},this.setOptions=function(e){t=e,this.sort&&t.sort()},this.addOption=function(e){e=(e=e||"").toString(),t.push(e),this.sort&&t.sort()},this.removeOption=function(e,n){for(n=n||!1,e=(e=e||"").toString();t.indexOf(e)!==-1&&(t.splice(t.indexOf(e),1),n!==!1););},Object.defineProperty(this,"combo",{enumerable:!0,configurable:!0,get:function(){return!!qi(this.Ff,18)},set:function(e){e?this.Ff=Ki(this.Ff,18):this.Ff=$i(this.Ff,18)}}),Object.defineProperty(this,"edit",{enumerable:!0,configurable:!0,get:function(){return!!qi(this.Ff,19)},set:function(e){this.combo===!0&&(e?this.Ff=Ki(this.Ff,19):this.Ff=$i(this.Ff,19))}}),Object.defineProperty(this,"sort",{enumerable:!0,configurable:!0,get:function(){return!!qi(this.Ff,20)},set:function(e){e?(this.Ff=Ki(this.Ff,20),t.sort()):this.Ff=$i(this.Ff,20)}}),Object.defineProperty(this,"multiSelect",{enumerable:!0,configurable:!0,get:function(){return!!qi(this.Ff,22)},set:function(e){e?this.Ff=Ki(this.Ff,22):this.Ff=$i(this.Ff,22)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!qi(this.Ff,23)},set:function(e){e?this.Ff=Ki(this.Ff,23):this.Ff=$i(this.Ff,23)}}),Object.defineProperty(this,"commitOnSelChange",{enumerable:!0,configurable:!0,get:function(){return!!qi(this.Ff,27)},set:function(e){e?this.Ff=Ki(this.Ff,27):this.Ff=$i(this.Ff,27)}}),this.hasAppearanceStream=!1};Aa(nf,kc);var sf=function(){nf.call(this),this.fontName="helvetica",this.combo=!1};Aa(sf,nf);var of=function(){sf.call(this),this.combo=!0};Aa(of,sf);var K0=function(){of.call(this),this.edit=!0};Aa(K0,of);var Fs=function(){kc.call(this),this.FT="/Btn",Object.defineProperty(this,"noToggleToOff",{enumerable:!0,configurable:!0,get:function(){return!!qi(this.Ff,15)},set:function(e){e?this.Ff=Ki(this.Ff,15):this.Ff=$i(this.Ff,15)}}),Object.defineProperty(this,"radio",{enumerable:!0,configurable:!0,get:function(){return!!qi(this.Ff,16)},set:function(e){e?this.Ff=Ki(this.Ff,16):this.Ff=$i(this.Ff,16)}}),Object.defineProperty(this,"pushButton",{enumerable:!0,configurable:!0,get:function(){return!!qi(this.Ff,17)},set:function(e){e?this.Ff=Ki(this.Ff,17):this.Ff=$i(this.Ff,17)}}),Object.defineProperty(this,"radioIsUnison",{enumerable:!0,configurable:!0,get:function(){return!!qi(this.Ff,26)},set:function(e){e?this.Ff=Ki(this.Ff,26):this.Ff=$i(this.Ff,26)}});var r,t={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var e=function(s){return s};if(this.scope&&(e=this.scope.internal.getEncryptor(this.objId)),Object.keys(t).length!==0){var n,i=[];for(n in i.push("<<"),t)i.push("/"+n+" ("+Th(e(t[n]))+")");return i.push(">>"),i.join(`
`)}},set:function(e){Nn(e)==="object"&&(t=e)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return t.CA||""},set:function(e){typeof e=="string"&&(t.CA=e)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return r},set:function(e){r=e}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return r.substr(1,r.length-1)},set:function(e){r="/"+e}})};Aa(Fs,kc);var $0=function(){Fs.call(this),this.pushButton=!0};Aa($0,Fs);var af=function(){Fs.call(this),this.radio=!0,this.pushButton=!1;var r=[];Object.defineProperty(this,"Kids",{enumerable:!0,configurable:!1,get:function(){return r},set:function(t){r=t!==void 0?t:[]}})};Aa(af,Fs);var W0=function(){var r,t;kc.call(this),Object.defineProperty(this,"Parent",{enumerable:!1,configurable:!1,get:function(){return r},set:function(i){r=i}}),Object.defineProperty(this,"optionName",{enumerable:!1,configurable:!0,get:function(){return t},set:function(i){t=i}});var e,n={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var i=function(o){return o};this.scope&&(i=this.scope.internal.getEncryptor(this.objId));var s,a=[];for(s in a.push("<<"),n)a.push("/"+s+" ("+Th(i(n[s]))+")");return a.push(">>"),a.join(`
`)},set:function(i){Nn(i)==="object"&&(n=i)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return n.CA||""},set:function(i){typeof i=="string"&&(n.CA=i)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return e},set:function(i){e=i}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return e.substr(1,e.length-1)},set:function(i){e="/"+i}}),this.caption="l",this.appearanceState="Off",this._AppearanceType=Tr.RadioButton.Circle,this.appearanceStreamContent=this._AppearanceType.createAppearanceStream(this.optionName)};Aa(W0,kc),af.prototype.setAppearance=function(r){if(!("createAppearanceStream"in r)||!("getCA"in r))throw new Error("Couldn't assign Appearance to RadioButton. Appearance was Invalid!");for(var t in this.Kids)if(this.Kids.hasOwnProperty(t)){var e=this.Kids[t];e.appearanceStreamContent=r.createAppearanceStream(e.optionName),e.caption=r.getCA()}},af.prototype.createOption=function(r){var t=new W0;return t.Parent=this,t.optionName=r,this.Kids.push(t),Ctt.call(this.scope,t),t};var X0=function(){Fs.call(this),this.fontName="zapfdingbats",this.caption="3",this.appearanceState="On",this.value="On",this.textAlign="center",this.appearanceStreamContent=Tr.CheckBox.createAppearanceStream()};Aa(X0,Fs);var Ih=function(){kc.call(this),this.FT="/Tx",Object.defineProperty(this,"multiline",{enumerable:!0,configurable:!0,get:function(){return!!qi(this.Ff,13)},set:function(t){t?this.Ff=Ki(this.Ff,13):this.Ff=$i(this.Ff,13)}}),Object.defineProperty(this,"fileSelect",{enumerable:!0,configurable:!0,get:function(){return!!qi(this.Ff,21)},set:function(t){t?this.Ff=Ki(this.Ff,21):this.Ff=$i(this.Ff,21)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!qi(this.Ff,23)},set:function(t){t?this.Ff=Ki(this.Ff,23):this.Ff=$i(this.Ff,23)}}),Object.defineProperty(this,"doNotScroll",{enumerable:!0,configurable:!0,get:function(){return!!qi(this.Ff,24)},set:function(t){t?this.Ff=Ki(this.Ff,24):this.Ff=$i(this.Ff,24)}}),Object.defineProperty(this,"comb",{enumerable:!0,configurable:!0,get:function(){return!!qi(this.Ff,25)},set:function(t){t?this.Ff=Ki(this.Ff,25):this.Ff=$i(this.Ff,25)}}),Object.defineProperty(this,"richText",{enumerable:!0,configurable:!0,get:function(){return!!qi(this.Ff,26)},set:function(t){t?this.Ff=Ki(this.Ff,26):this.Ff=$i(this.Ff,26)}});var r=null;Object.defineProperty(this,"MaxLen",{enumerable:!0,configurable:!1,get:function(){return r},set:function(t){r=t}}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,get:function(){return r},set:function(t){Number.isInteger(t)&&(r=t)}}),Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return this.V||this.DV}})};Aa(Ih,kc);var J0=function(){Ih.call(this),Object.defineProperty(this,"password",{enumerable:!0,configurable:!0,get:function(){return!!qi(this.Ff,14)},set:function(r){r?this.Ff=Ki(this.Ff,14):this.Ff=$i(this.Ff,14)}}),this.password=!0};Aa(J0,Ih);var Tr={CheckBox:{createAppearanceStream:function(){return{N:{On:Tr.CheckBox.YesNormal},D:{On:Tr.CheckBox.YesPushDown,Off:Tr.CheckBox.OffPushDown}}},YesPushDown:function(r){var t=Rl(r);t.scope=r.scope;var e=[],n=r.scope.internal.getFont(r.fontName,r.fontStyle).id,i=r.scope.__private__.encodeColorString(r.color),s=kw(r,r.caption);return e.push("0.749023 g"),e.push("0 0 "+an(Tr.internal.getWidth(r))+" "+an(Tr.internal.getHeight(r))+" re"),e.push("f"),e.push("BMC"),e.push("q"),e.push("0 0 1 rg"),e.push("/"+n+" "+an(s.fontSize)+" Tf "+i),e.push("BT"),e.push(s.text),e.push("ET"),e.push("Q"),e.push("EMC"),t.stream=e.join(`
`),t},YesNormal:function(r){var t=Rl(r);t.scope=r.scope;var e=r.scope.internal.getFont(r.fontName,r.fontStyle).id,n=r.scope.__private__.encodeColorString(r.color),i=[],s=Tr.internal.getHeight(r),a=Tr.internal.getWidth(r),o=kw(r,r.caption);return i.push("1 g"),i.push("0 0 "+an(a)+" "+an(s)+" re"),i.push("f"),i.push("q"),i.push("0 0 1 rg"),i.push("0 0 "+an(a-1)+" "+an(s-1)+" re"),i.push("W"),i.push("n"),i.push("0 g"),i.push("BT"),i.push("/"+e+" "+an(o.fontSize)+" Tf "+n),i.push(o.text),i.push("ET"),i.push("Q"),t.stream=i.join(`
`),t},OffPushDown:function(r){var t=Rl(r);t.scope=r.scope;var e=[];return e.push("0.749023 g"),e.push("0 0 "+an(Tr.internal.getWidth(r))+" "+an(Tr.internal.getHeight(r))+" re"),e.push("f"),t.stream=e.join(`
`),t}},RadioButton:{Circle:{createAppearanceStream:function(r){var t={D:{Off:Tr.RadioButton.Circle.OffPushDown},N:{}};return t.N[r]=Tr.RadioButton.Circle.YesNormal,t.D[r]=Tr.RadioButton.Circle.YesPushDown,t},getCA:function(){return"l"},YesNormal:function(r){var t=Rl(r);t.scope=r.scope;var e=[],n=Tr.internal.getWidth(r)<=Tr.internal.getHeight(r)?Tr.internal.getWidth(r)/4:Tr.internal.getHeight(r)/4;n=Number((.9*n).toFixed(5));var i=Tr.internal.Bezier_C,s=Number((n*i).toFixed(5));return e.push("q"),e.push("1 0 0 1 "+Su(Tr.internal.getWidth(r)/2)+" "+Su(Tr.internal.getHeight(r)/2)+" cm"),e.push(n+" 0 m"),e.push(n+" "+s+" "+s+" "+n+" 0 "+n+" c"),e.push("-"+s+" "+n+" -"+n+" "+s+" -"+n+" 0 c"),e.push("-"+n+" -"+s+" -"+s+" -"+n+" 0 -"+n+" c"),e.push(s+" -"+n+" "+n+" -"+s+" "+n+" 0 c"),e.push("f"),e.push("Q"),t.stream=e.join(`
`),t},YesPushDown:function(r){var t=Rl(r);t.scope=r.scope;var e=[],n=Tr.internal.getWidth(r)<=Tr.internal.getHeight(r)?Tr.internal.getWidth(r)/4:Tr.internal.getHeight(r)/4;n=Number((.9*n).toFixed(5));var i=Number((2*n).toFixed(5)),s=Number((i*Tr.internal.Bezier_C).toFixed(5)),a=Number((n*Tr.internal.Bezier_C).toFixed(5));return e.push("0.749023 g"),e.push("q"),e.push("1 0 0 1 "+Su(Tr.internal.getWidth(r)/2)+" "+Su(Tr.internal.getHeight(r)/2)+" cm"),e.push(i+" 0 m"),e.push(i+" "+s+" "+s+" "+i+" 0 "+i+" c"),e.push("-"+s+" "+i+" -"+i+" "+s+" -"+i+" 0 c"),e.push("-"+i+" -"+s+" -"+s+" -"+i+" 0 -"+i+" c"),e.push(s+" -"+i+" "+i+" -"+s+" "+i+" 0 c"),e.push("f"),e.push("Q"),e.push("0 g"),e.push("q"),e.push("1 0 0 1 "+Su(Tr.internal.getWidth(r)/2)+" "+Su(Tr.internal.getHeight(r)/2)+" cm"),e.push(n+" 0 m"),e.push(n+" "+a+" "+a+" "+n+" 0 "+n+" c"),e.push("-"+a+" "+n+" -"+n+" "+a+" -"+n+" 0 c"),e.push("-"+n+" -"+a+" -"+a+" -"+n+" 0 -"+n+" c"),e.push(a+" -"+n+" "+n+" -"+a+" "+n+" 0 c"),e.push("f"),e.push("Q"),t.stream=e.join(`
`),t},OffPushDown:function(r){var t=Rl(r);t.scope=r.scope;var e=[],n=Tr.internal.getWidth(r)<=Tr.internal.getHeight(r)?Tr.internal.getWidth(r)/4:Tr.internal.getHeight(r)/4;n=Number((.9*n).toFixed(5));var i=Number((2*n).toFixed(5)),s=Number((i*Tr.internal.Bezier_C).toFixed(5));return e.push("0.749023 g"),e.push("q"),e.push("1 0 0 1 "+Su(Tr.internal.getWidth(r)/2)+" "+Su(Tr.internal.getHeight(r)/2)+" cm"),e.push(i+" 0 m"),e.push(i+" "+s+" "+s+" "+i+" 0 "+i+" c"),e.push("-"+s+" "+i+" -"+i+" "+s+" -"+i+" 0 c"),e.push("-"+i+" -"+s+" -"+s+" -"+i+" 0 -"+i+" c"),e.push(s+" -"+i+" "+i+" -"+s+" "+i+" 0 c"),e.push("f"),e.push("Q"),t.stream=e.join(`
`),t}},Cross:{createAppearanceStream:function(r){var t={D:{Off:Tr.RadioButton.Cross.OffPushDown},N:{}};return t.N[r]=Tr.RadioButton.Cross.YesNormal,t.D[r]=Tr.RadioButton.Cross.YesPushDown,t},getCA:function(){return"8"},YesNormal:function(r){var t=Rl(r);t.scope=r.scope;var e=[],n=Tr.internal.calculateCross(r);return e.push("q"),e.push("1 1 "+an(Tr.internal.getWidth(r)-2)+" "+an(Tr.internal.getHeight(r)-2)+" re"),e.push("W"),e.push("n"),e.push(an(n.x1.x)+" "+an(n.x1.y)+" m"),e.push(an(n.x2.x)+" "+an(n.x2.y)+" l"),e.push(an(n.x4.x)+" "+an(n.x4.y)+" m"),e.push(an(n.x3.x)+" "+an(n.x3.y)+" l"),e.push("s"),e.push("Q"),t.stream=e.join(`
`),t},YesPushDown:function(r){var t=Rl(r);t.scope=r.scope;var e=Tr.internal.calculateCross(r),n=[];return n.push("0.749023 g"),n.push("0 0 "+an(Tr.internal.getWidth(r))+" "+an(Tr.internal.getHeight(r))+" re"),n.push("f"),n.push("q"),n.push("1 1 "+an(Tr.internal.getWidth(r)-2)+" "+an(Tr.internal.getHeight(r)-2)+" re"),n.push("W"),n.push("n"),n.push(an(e.x1.x)+" "+an(e.x1.y)+" m"),n.push(an(e.x2.x)+" "+an(e.x2.y)+" l"),n.push(an(e.x4.x)+" "+an(e.x4.y)+" m"),n.push(an(e.x3.x)+" "+an(e.x3.y)+" l"),n.push("s"),n.push("Q"),t.stream=n.join(`
`),t},OffPushDown:function(r){var t=Rl(r);t.scope=r.scope;var e=[];return e.push("0.749023 g"),e.push("0 0 "+an(Tr.internal.getWidth(r))+" "+an(Tr.internal.getHeight(r))+" re"),e.push("f"),t.stream=e.join(`
`),t}}},createDefaultAppearanceStream:function(r){var t=r.scope.internal.getFont(r.fontName,r.fontStyle).id,e=r.scope.__private__.encodeColorString(r.color);return"/"+t+" "+r.fontSize+" Tf "+e}};Tr.internal={Bezier_C:.551915024494,calculateCross:function(r){var t=Tr.internal.getWidth(r),e=Tr.internal.getHeight(r),n=Math.min(t,e);return{x1:{x:(t-n)/2,y:(e-n)/2+n},x2:{x:(t-n)/2+n,y:(e-n)/2},x3:{x:(t-n)/2,y:(e-n)/2},x4:{x:(t-n)/2+n,y:(e-n)/2+n}}}},Tr.internal.getWidth=function(r){var t=0;return Nn(r)==="object"&&(t=WL(r.Rect[2])),t},Tr.internal.getHeight=function(r){var t=0;return Nn(r)==="object"&&(t=WL(r.Rect[3])),t};var Ctt=Qi.addField=function(r){if(Btt(this,r),!(r instanceof kc))throw new Error("Invalid argument passed to jsPDF.addField.");var t;return(t=r).scope.internal.acroformPlugin.printedOut&&(t.scope.internal.acroformPlugin.printedOut=!1,t.scope.internal.acroformPlugin.acroFormDictionaryRoot=null),t.scope.internal.acroformPlugin.acroFormDictionaryRoot.Fields.push(t),r.page=r.scope.internal.getCurrentPageInfo().pageNumber,this};Qi.AcroFormChoiceField=nf,Qi.AcroFormListBox=sf,Qi.AcroFormComboBox=of,Qi.AcroFormEditBox=K0,Qi.AcroFormButton=Fs,Qi.AcroFormPushButton=$0,Qi.AcroFormRadioButton=af,Qi.AcroFormCheckBox=X0,Qi.AcroFormTextField=Ih,Qi.AcroFormPasswordField=J0,Qi.AcroFormAppearance=Tr,Qi.AcroForm={ChoiceField:nf,ListBox:sf,ComboBox:of,EditBox:K0,Button:Fs,PushButton:$0,RadioButton:af,CheckBox:X0,TextField:Ih,PasswordField:J0,Appearance:Tr},Xr.AcroForm={ChoiceField:nf,ListBox:sf,ComboBox:of,EditBox:K0,Button:Fs,PushButton:$0,RadioButton:af,CheckBox:X0,TextField:Ih,PasswordField:J0,Appearance:Tr};function ZL(r){return r.reduce(function(t,e,n){return t[e]=n,t},{})}(function(r){r.__addimage__={};var t="UNKNOWN",e={PNG:[[137,80,78,71]],TIFF:[[77,77,0,42],[73,73,42,0]],JPEG:[[255,216,255,224,void 0,void 0,74,70,73,70,0],[255,216,255,225,void 0,void 0,69,120,105,102,0,0],[255,216,255,219],[255,216,255,238]],JPEG2000:[[0,0,0,12,106,80,32,32]],GIF87a:[[71,73,70,56,55,97]],GIF89a:[[71,73,70,56,57,97]],WEBP:[[82,73,70,70,void 0,void 0,void 0,void 0,87,69,66,80]],BMP:[[66,77],[66,65],[67,73],[67,80],[73,67],[80,84]]},n=r.__addimage__.getImageFileTypeByImageData=function(ut,At){var Bt,vt,ne,ie,ae,te=t;if((At=At||t)==="RGBA"||ut.data!==void 0&&ut.data instanceof Uint8ClampedArray&&"height"in ut&&"width"in ut)return"RGBA";if(pt(ut))for(ae in e)for(ne=e[ae],Bt=0;Bt<ne.length;Bt+=1){for(ie=!0,vt=0;vt<ne[Bt].length;vt+=1)if(ne[Bt][vt]!==void 0&&ne[Bt][vt]!==ut[vt]){ie=!1;break}if(ie===!0){te=ae;break}}else for(ae in e)for(ne=e[ae],Bt=0;Bt<ne.length;Bt+=1){for(ie=!0,vt=0;vt<ne[Bt].length;vt+=1)if(ne[Bt][vt]!==void 0&&ne[Bt][vt]!==ut.charCodeAt(vt)){ie=!1;break}if(ie===!0){te=ae;break}}return te===t&&At!==t&&(te=At),te},i=function ut(At){for(var Bt=this.internal.write,vt=this.internal.putStream,ne=(0,this.internal.getFilters)();ne.indexOf("FlateEncode")!==-1;)ne.splice(ne.indexOf("FlateEncode"),1);At.objectId=this.internal.newObject();var ie=[];if(ie.push({key:"Type",value:"/XObject"}),ie.push({key:"Subtype",value:"/Image"}),ie.push({key:"Width",value:At.width}),ie.push({key:"Height",value:At.height}),At.colorSpace===Q.INDEXED?ie.push({key:"ColorSpace",value:"[/Indexed /DeviceRGB "+(At.palette.length/3-1)+" "+("sMask"in At&&At.sMask!==void 0?At.objectId+2:At.objectId+1)+" 0 R]"}):(ie.push({key:"ColorSpace",value:"/"+At.colorSpace}),At.colorSpace===Q.DEVICE_CMYK&&ie.push({key:"Decode",value:"[1 0 1 0 1 0 1 0]"})),ie.push({key:"BitsPerComponent",value:At.bitsPerComponent}),"decodeParameters"in At&&At.decodeParameters!==void 0&&ie.push({key:"DecodeParms",value:"<<"+At.decodeParameters+">>"}),"transparency"in At&&Array.isArray(At.transparency)){for(var ae="",te=0,ce=At.transparency.length;te<ce;te++)ae+=At.transparency[te]+" "+At.transparency[te]+" ";ie.push({key:"Mask",value:"["+ae+"]"})}At.sMask!==void 0&&ie.push({key:"SMask",value:At.objectId+1+" 0 R"});var le=At.filter!==void 0?["/"+At.filter]:void 0;if(vt({data:At.data,additionalKeyValues:ie,alreadyAppliedFilters:le,objectId:At.objectId}),Bt("endobj"),"sMask"in At&&At.sMask!==void 0){var Te="/Predictor "+At.predictor+" /Colors 1 /BitsPerComponent "+At.bitsPerComponent+" /Columns "+At.width,rt={width:At.width,height:At.height,colorSpace:"DeviceGray",bitsPerComponent:At.bitsPerComponent,decodeParameters:Te,data:At.sMask};"filter"in At&&(rt.filter=At.filter),ut.call(this,rt)}if(At.colorSpace===Q.INDEXED){var wt=this.internal.newObject();vt({data:ft(new Uint8Array(At.palette)),objectId:wt}),Bt("endobj")}},s=function(){var ut=this.internal.collections.addImage_images;for(var At in ut)i.call(this,ut[At])},a=function(){var ut,At=this.internal.collections.addImage_images,Bt=this.internal.write;for(var vt in At)Bt("/I"+(ut=At[vt]).index,ut.objectId,"0","R")},o=function(){this.internal.collections.addImage_images||(this.internal.collections.addImage_images={},this.internal.events.subscribe("putResources",s),this.internal.events.subscribe("putXobjectDict",a))},h=function(){var ut=this.internal.collections.addImage_images;return o.call(this),ut},f=function(){return Object.keys(this.internal.collections.addImage_images).length},g=function(ut){return typeof r["process"+ut.toUpperCase()]=="function"},b=function(ut){return Nn(ut)==="object"&&ut.nodeType===1},C=function(ut,At){if(ut.nodeName==="IMG"&&ut.hasAttribute("src")){var Bt=""+ut.getAttribute("src");if(Bt.indexOf("data:image/")===0)return ig(unescape(Bt).split("base64,").pop());var vt=r.loadFile(Bt,!0);if(vt!==void 0)return vt}if(ut.nodeName==="CANVAS"){if(ut.width===0||ut.height===0)throw new Error("Given canvas must have data. Canvas width: "+ut.width+", height: "+ut.height);var ne;switch(At){case"PNG":ne="image/png";break;case"WEBP":ne="image/webp";break;case"JPEG":case"JPG":default:ne="image/jpeg"}return ig(ut.toDataURL(ne,1).split("base64,").pop())}},B=function(ut){var At=this.internal.collections.addImage_images;if(At){for(var Bt in At)if(ut===At[Bt].alias)return At[Bt]}},R=function(ut,At,Bt){return ut||At||(ut=-96,At=-96),ut<0&&(ut=-1*Bt.width*72/ut/this.internal.scaleFactor),At<0&&(At=-1*Bt.height*72/At/this.internal.scaleFactor),ut===0&&(ut=At*Bt.width/Bt.height),At===0&&(At=ut*Bt.height/Bt.width),[ut,At]},D=function(ut,At,Bt,vt,ne,ie){var ae=R.call(this,Bt,vt,ne),te=this.internal.getCoordinateString,ce=this.internal.getVerticalCoordinateString,le=h.call(this);if(Bt=ae[0],vt=ae[1],le[ne.index]=ne,ie){ie*=Math.PI/180;var Te=Math.cos(ie),rt=Math.sin(ie),wt=function(qt){return qt.toFixed(4)},St=[wt(Te),wt(rt),wt(-1*rt),wt(Te),0,0,"cm"]}this.internal.write("q"),ie?(this.internal.write([1,"0","0",1,te(ut),ce(At+vt),"cm"].join(" ")),this.internal.write(St.join(" ")),this.internal.write([te(Bt),"0","0",te(vt),"0","0","cm"].join(" "))):this.internal.write([te(Bt),"0","0",te(vt),te(ut),ce(At+vt),"cm"].join(" ")),this.isAdvancedAPI()&&this.internal.write([1,0,0,-1,0,0,"cm"].join(" ")),this.internal.write("/I"+ne.index+" Do"),this.internal.write("Q")},Q=r.color_spaces={DEVICE_RGB:"DeviceRGB",DEVICE_GRAY:"DeviceGray",DEVICE_CMYK:"DeviceCMYK",CAL_GREY:"CalGray",CAL_RGB:"CalRGB",LAB:"Lab",ICC_BASED:"ICCBased",INDEXED:"Indexed",PATTERN:"Pattern",SEPARATION:"Separation",DEVICE_N:"DeviceN"};r.decode={DCT_DECODE:"DCTDecode",FLATE_DECODE:"FlateDecode",LZW_DECODE:"LZWDecode",JPX_DECODE:"JPXDecode",JBIG2_DECODE:"JBIG2Decode",ASCII85_DECODE:"ASCII85Decode",ASCII_HEX_DECODE:"ASCIIHexDecode",RUN_LENGTH_DECODE:"RunLengthDecode",CCITT_FAX_DECODE:"CCITTFaxDecode"};var k=r.image_compression={NONE:"NONE",FAST:"FAST",MEDIUM:"MEDIUM",SLOW:"SLOW"},j=r.__addimage__.sHashCode=function(ut){var At,Bt,vt=0;if(typeof ut=="string")for(Bt=ut.length,At=0;At<Bt;At++)vt=(vt<<5)-vt+ut.charCodeAt(At),vt|=0;else if(pt(ut))for(Bt=ut.byteLength/2,At=0;At<Bt;At++)vt=(vt<<5)-vt+ut[At],vt|=0;return vt},et=r.__addimage__.validateStringAsBase64=function(ut){(ut=ut||"").toString().trim();var At=!0;return ut.length===0&&(At=!1),ut.length%4!=0&&(At=!1),/^[A-Za-z0-9+/]+$/.test(ut.substr(0,ut.length-2))===!1&&(At=!1),/^[A-Za-z0-9/][A-Za-z0-9+/]|[A-Za-z0-9+/]=|==$/.test(ut.substr(-2))===!1&&(At=!1),At},st=r.__addimage__.extractImageFromDataUrl=function(ut){var At=(ut=ut||"").split("base64,"),Bt=null;if(At.length===2){var vt=/^data:(\w*\/\w*);*(charset=(?!charset=)[\w=-]*)*;*$/.exec(At[0]);Array.isArray(vt)&&(Bt={mimeType:vt[1],charset:vt[2],data:At[1]})}return Bt},mt=r.__addimage__.supportsArrayBuffer=function(){return typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"};r.__addimage__.isArrayBuffer=function(ut){return mt()&&ut instanceof ArrayBuffer};var pt=r.__addimage__.isArrayBufferView=function(ut){return mt()&&typeof Uint32Array<"u"&&(ut instanceof Int8Array||ut instanceof Uint8Array||typeof Uint8ClampedArray<"u"&&ut instanceof Uint8ClampedArray||ut instanceof Int16Array||ut instanceof Uint16Array||ut instanceof Int32Array||ut instanceof Uint32Array||ut instanceof Float32Array||ut instanceof Float64Array)},yt=r.__addimage__.binaryStringToUint8Array=function(ut){for(var At=ut.length,Bt=new Uint8Array(At),vt=0;vt<At;vt++)Bt[vt]=ut.charCodeAt(vt);return Bt},ft=r.__addimage__.arrayBufferToBinaryString=function(ut){for(var At="",Bt=pt(ut)?ut:new Uint8Array(ut),vt=0;vt<Bt.length;vt+=8192)At+=String.fromCharCode.apply(null,Bt.subarray(vt,vt+8192));return At};r.addImage=function(){var ut,At,Bt,vt,ne,ie,ae,te,ce;if(typeof arguments[1]=="number"?(At=t,Bt=arguments[1],vt=arguments[2],ne=arguments[3],ie=arguments[4],ae=arguments[5],te=arguments[6],ce=arguments[7]):(At=arguments[1],Bt=arguments[2],vt=arguments[3],ne=arguments[4],ie=arguments[5],ae=arguments[6],te=arguments[7],ce=arguments[8]),Nn(ut=arguments[0])==="object"&&!b(ut)&&"imageData"in ut){var le=ut;ut=le.imageData,At=le.format||At||t,Bt=le.x||Bt||0,vt=le.y||vt||0,ne=le.w||le.width||ne,ie=le.h||le.height||ie,ae=le.alias||ae,te=le.compression||te,ce=le.rotation||le.angle||ce}var Te=this.internal.getFilters();if(te===void 0&&Te.indexOf("FlateEncode")!==-1&&(te="SLOW"),isNaN(Bt)||isNaN(vt))throw new Error("Invalid coordinates passed to jsPDF.addImage");o.call(this);var rt=Dt.call(this,ut,At,ae,te);return D.call(this,Bt,vt,ne,ie,rt,ce),this};var Dt=function(ut,At,Bt,vt){var ne,ie,ae;if(typeof ut=="string"&&n(ut)===t){ut=unescape(ut);var te=It(ut,!1);(te!==""||(te=r.loadFile(ut,!0))!==void 0)&&(ut=te)}if(b(ut)&&(ut=C(ut,At)),At=n(ut,At),!g(At))throw new Error("addImage does not support files of type '"+At+"', please ensure that a plugin for '"+At+"' support is added.");if(((ae=Bt)==null||ae.length===0)&&(Bt=function(ce){return typeof ce=="string"||pt(ce)?j(ce):pt(ce.data)?j(ce.data):null}(ut)),(ne=B.call(this,Bt))||(mt()&&(ut instanceof Uint8Array||At==="RGBA"||(ie=ut,ut=yt(ut))),ne=this["process"+At.toUpperCase()](ut,f.call(this),Bt,function(ce){return ce&&typeof ce=="string"&&(ce=ce.toUpperCase()),ce in r.image_compression?ce:k.NONE}(vt),ie)),!ne)throw new Error("An unknown error occurred whilst processing the image.");return ne},It=r.__addimage__.convertBase64ToBinaryString=function(ut,At){var Bt;At=typeof At!="boolean"||At;var vt,ne="";if(typeof ut=="string"){vt=(Bt=st(ut))!==null?Bt.data:ut;try{ne=ig(vt)}catch(ie){if(At)throw et(vt)?new Error("atob-Error in jsPDF.convertBase64ToBinaryString "+ie.message):new Error("Supplied Data is not a valid base64-String jsPDF.convertBase64ToBinaryString ")}}return ne};r.getImageProperties=function(ut){var At,Bt,vt="";if(b(ut)&&(ut=C(ut)),typeof ut=="string"&&n(ut)===t&&((vt=It(ut,!1))===""&&(vt=r.loadFile(ut)||""),ut=vt),Bt=n(ut),!g(Bt))throw new Error("addImage does not support files of type '"+Bt+"', please ensure that a plugin for '"+Bt+"' support is added.");if(!mt()||ut instanceof Uint8Array||(ut=yt(ut)),!(At=this["process"+Bt.toUpperCase()](ut)))throw new Error("An unknown error occurred whilst processing the image");return At.fileType=Bt,At}})(Xr.API),function(r){var t=function(e){if(e!==void 0&&e!="")return!0};Xr.API.events.push(["addPage",function(e){this.internal.getPageInfo(e.pageNumber).pageContext.annotations=[]}]),r.events.push(["putPage",function(e){for(var n,i,s,a=this.internal.getCoordinateString,o=this.internal.getVerticalCoordinateString,h=this.internal.getPageInfoByObjId(e.objId),f=e.pageContext.annotations,g=!1,b=0;b<f.length&&!g;b++)switch((n=f[b]).type){case"link":(t(n.options.url)||t(n.options.pageNumber))&&(g=!0);break;case"reference":case"text":case"freetext":g=!0}if(g!=0){this.internal.write("/Annots [");for(var C=0;C<f.length;C++){n=f[C];var B=this.internal.pdfEscape,R=this.internal.getEncryptor(e.objId);switch(n.type){case"reference":this.internal.write(" "+n.object.objId+" 0 R ");break;case"text":var D=this.internal.newAdditionalObject(),Q=this.internal.newAdditionalObject(),k=this.internal.getEncryptor(D.objId),j=n.title||"Note";s="<</Type /Annot /Subtype /Text "+(i="/Rect ["+a(n.bounds.x)+" "+o(n.bounds.y+n.bounds.h)+" "+a(n.bounds.x+n.bounds.w)+" "+o(n.bounds.y)+"] ")+"/Contents ("+B(k(n.contents))+")",s+=" /Popup "+Q.objId+" 0 R",s+=" /P "+h.objId+" 0 R",s+=" /T ("+B(k(j))+") >>",D.content=s;var et=D.objId+" 0 R";s="<</Type /Annot /Subtype /Popup "+(i="/Rect ["+a(n.bounds.x+30)+" "+o(n.bounds.y+n.bounds.h)+" "+a(n.bounds.x+n.bounds.w+30)+" "+o(n.bounds.y)+"] ")+" /Parent "+et,n.open&&(s+=" /Open true"),s+=" >>",Q.content=s,this.internal.write(D.objId,"0 R",Q.objId,"0 R");break;case"freetext":i="/Rect ["+a(n.bounds.x)+" "+o(n.bounds.y)+" "+a(n.bounds.x+n.bounds.w)+" "+o(n.bounds.y+n.bounds.h)+"] ";var st=n.color||"#000000";s="<</Type /Annot /Subtype /FreeText "+i+"/Contents ("+B(R(n.contents))+")",s+=" /DS(font: Helvetica,sans-serif 12.0pt; text-align:left; color:#"+st+")",s+=" /Border [0 0 0]",s+=" >>",this.internal.write(s);break;case"link":if(n.options.name){var mt=this.annotations._nameMap[n.options.name];n.options.pageNumber=mt.page,n.options.top=mt.y}else n.options.top||(n.options.top=0);if(i="/Rect ["+n.finalBounds.x+" "+n.finalBounds.y+" "+n.finalBounds.w+" "+n.finalBounds.h+"] ",s="",n.options.url)s="<</Type /Annot /Subtype /Link "+i+"/Border [0 0 0] /A <</S /URI /URI ("+B(R(n.options.url))+") >>";else if(n.options.pageNumber)switch(s="<</Type /Annot /Subtype /Link "+i+"/Border [0 0 0] /Dest ["+this.internal.getPageInfo(n.options.pageNumber).objId+" 0 R",n.options.magFactor=n.options.magFactor||"XYZ",n.options.magFactor){case"Fit":s+=" /Fit]";break;case"FitH":s+=" /FitH "+n.options.top+"]";break;case"FitV":n.options.left=n.options.left||0,s+=" /FitV "+n.options.left+"]";break;case"XYZ":default:var pt=o(n.options.top);n.options.left=n.options.left||0,n.options.zoom===void 0&&(n.options.zoom=0),s+=" /XYZ "+n.options.left+" "+pt+" "+n.options.zoom+"]"}s!=""&&(s+=" >>",this.internal.write(s))}}this.internal.write("]")}}]),r.createAnnotation=function(e){var n=this.internal.getCurrentPageInfo();switch(e.type){case"link":this.link(e.bounds.x,e.bounds.y,e.bounds.w,e.bounds.h,e);break;case"text":case"freetext":n.pageContext.annotations.push(e)}},r.link=function(e,n,i,s,a){var o=this.internal.getCurrentPageInfo(),h=this.internal.getCoordinateString,f=this.internal.getVerticalCoordinateString;o.pageContext.annotations.push({finalBounds:{x:h(e),y:f(n),w:h(e+i),h:f(n+s)},options:a,type:"link"})},r.textWithLink=function(e,n,i,s){var a,o,h=this.getTextWidth(e),f=this.internal.getLineHeight()/this.internal.scaleFactor;if(s.maxWidth!==void 0){o=s.maxWidth;var g=this.splitTextToSize(e,o).length;a=Math.ceil(f*g)}else o=h,a=f;return this.text(e,n,i,s),i+=.2*f,s.align==="center"&&(n-=h/2),s.align==="right"&&(n-=h),this.link(n,i-f,o,a,s),h},r.getTextWidth=function(e){var n=this.internal.getFontSize();return this.getStringUnitWidth(e)*n/this.internal.scaleFactor}}(Xr.API),function(r){var t={1569:[65152],1570:[65153,65154],1571:[65155,65156],1572:[65157,65158],1573:[65159,65160],1574:[65161,65162,65163,65164],1575:[65165,65166],1576:[65167,65168,65169,65170],1577:[65171,65172],1578:[65173,65174,65175,65176],1579:[65177,65178,65179,65180],1580:[65181,65182,65183,65184],1581:[65185,65186,65187,65188],1582:[65189,65190,65191,65192],1583:[65193,65194],1584:[65195,65196],1585:[65197,65198],1586:[65199,65200],1587:[65201,65202,65203,65204],1588:[65205,65206,65207,65208],1589:[65209,65210,65211,65212],1590:[65213,65214,65215,65216],1591:[65217,65218,65219,65220],1592:[65221,65222,65223,65224],1593:[65225,65226,65227,65228],1594:[65229,65230,65231,65232],1601:[65233,65234,65235,65236],1602:[65237,65238,65239,65240],1603:[65241,65242,65243,65244],1604:[65245,65246,65247,65248],1605:[65249,65250,65251,65252],1606:[65253,65254,65255,65256],1607:[65257,65258,65259,65260],1608:[65261,65262],1609:[65263,65264,64488,64489],1610:[65265,65266,65267,65268],1649:[64336,64337],1655:[64477],1657:[64358,64359,64360,64361],1658:[64350,64351,64352,64353],1659:[64338,64339,64340,64341],1662:[64342,64343,64344,64345],1663:[64354,64355,64356,64357],1664:[64346,64347,64348,64349],1667:[64374,64375,64376,64377],1668:[64370,64371,64372,64373],1670:[64378,64379,64380,64381],1671:[64382,64383,64384,64385],1672:[64392,64393],1676:[64388,64389],1677:[64386,64387],1678:[64390,64391],1681:[64396,64397],1688:[64394,64395],1700:[64362,64363,64364,64365],1702:[64366,64367,64368,64369],1705:[64398,64399,64400,64401],1709:[64467,64468,64469,64470],1711:[64402,64403,64404,64405],1713:[64410,64411,64412,64413],1715:[64406,64407,64408,64409],1722:[64414,64415],1723:[64416,64417,64418,64419],1726:[64426,64427,64428,64429],1728:[64420,64421],1729:[64422,64423,64424,64425],1733:[64480,64481],1734:[64473,64474],1735:[64471,64472],1736:[64475,64476],1737:[64482,64483],1739:[64478,64479],1740:[64508,64509,64510,64511],1744:[64484,64485,64486,64487],1746:[64430,64431],1747:[64432,64433]},e={65247:{65154:65269,65156:65271,65160:65273,65166:65275},65248:{65154:65270,65156:65272,65160:65274,65166:65276},65165:{65247:{65248:{65258:65010}}},1617:{1612:64606,1613:64607,1614:64608,1615:64609,1616:64610}},n={1612:64606,1613:64607,1614:64608,1615:64609,1616:64610},i=[1570,1571,1573,1575];r.__arabicParser__={};var s=r.__arabicParser__.isInArabicSubstitutionA=function(D){return t[D.charCodeAt(0)]!==void 0},a=r.__arabicParser__.isArabicLetter=function(D){return typeof D=="string"&&/^[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]+$/.test(D)},o=r.__arabicParser__.isArabicEndLetter=function(D){return a(D)&&s(D)&&t[D.charCodeAt(0)].length<=2},h=r.__arabicParser__.isArabicAlfLetter=function(D){return a(D)&&i.indexOf(D.charCodeAt(0))>=0};r.__arabicParser__.arabicLetterHasIsolatedForm=function(D){return a(D)&&s(D)&&t[D.charCodeAt(0)].length>=1};var f=r.__arabicParser__.arabicLetterHasFinalForm=function(D){return a(D)&&s(D)&&t[D.charCodeAt(0)].length>=2};r.__arabicParser__.arabicLetterHasInitialForm=function(D){return a(D)&&s(D)&&t[D.charCodeAt(0)].length>=3};var g=r.__arabicParser__.arabicLetterHasMedialForm=function(D){return a(D)&&s(D)&&t[D.charCodeAt(0)].length==4},b=r.__arabicParser__.resolveLigatures=function(D){var Q=0,k=e,j="",et=0;for(Q=0;Q<D.length;Q+=1)k[D.charCodeAt(Q)]!==void 0?(et++,typeof(k=k[D.charCodeAt(Q)])=="number"&&(j+=String.fromCharCode(k),k=e,et=0),Q===D.length-1&&(k=e,j+=D.charAt(Q-(et-1)),Q-=et-1,et=0)):(k=e,j+=D.charAt(Q-et),Q-=et,et=0);return j};r.__arabicParser__.isArabicDiacritic=function(D){return D!==void 0&&n[D.charCodeAt(0)]!==void 0};var C=r.__arabicParser__.getCorrectForm=function(D,Q,k){return a(D)?s(D)===!1?-1:!f(D)||!a(Q)&&!a(k)||!a(k)&&o(Q)||o(D)&&!a(Q)||o(D)&&h(Q)||o(D)&&o(Q)?0:g(D)&&a(Q)&&!o(Q)&&a(k)&&f(k)?3:o(D)||!a(k)?1:2:-1},B=function(D){var Q=0,k=0,j=0,et="",st="",mt="",pt=(D=D||"").split("\\s+"),yt=[];for(Q=0;Q<pt.length;Q+=1){for(yt.push(""),k=0;k<pt[Q].length;k+=1)et=pt[Q][k],st=pt[Q][k-1],mt=pt[Q][k+1],a(et)?(j=C(et,st,mt),yt[Q]+=j!==-1?String.fromCharCode(t[et.charCodeAt(0)][j]):et):yt[Q]+=et;yt[Q]=b(yt[Q])}return yt.join(" ")},R=r.__arabicParser__.processArabic=r.processArabic=function(){var D,Q=typeof arguments[0]=="string"?arguments[0]:arguments[0].text,k=[];if(Array.isArray(Q)){var j=0;for(k=[],j=0;j<Q.length;j+=1)Array.isArray(Q[j])?k.push([B(Q[j][0]),Q[j][1],Q[j][2]]):k.push([B(Q[j])]);D=k}else D=B(Q);return typeof arguments[0]=="string"?D:(arguments[0].text=D,arguments[0])};r.events.push(["preProcessText",R])}(Xr.API),Xr.API.autoPrint=function(r){var t;switch((r=r||{}).variant=r.variant||"non-conform",r.variant){case"javascript":this.addJS("print({});");break;case"non-conform":default:this.internal.events.subscribe("postPutResources",function(){t=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /Named"),this.internal.out("/Type /Action"),this.internal.out("/N /Print"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){this.internal.out("/OpenAction "+t+" 0 R")})}return this},function(r){var t=function(){var e=void 0;Object.defineProperty(this,"pdf",{get:function(){return e},set:function(o){e=o}});var n=150;Object.defineProperty(this,"width",{get:function(){return n},set:function(o){n=isNaN(o)||Number.isInteger(o)===!1||o<0?150:o,this.getContext("2d").pageWrapXEnabled&&(this.getContext("2d").pageWrapX=n+1)}});var i=300;Object.defineProperty(this,"height",{get:function(){return i},set:function(o){i=isNaN(o)||Number.isInteger(o)===!1||o<0?300:o,this.getContext("2d").pageWrapYEnabled&&(this.getContext("2d").pageWrapY=i+1)}});var s=[];Object.defineProperty(this,"childNodes",{get:function(){return s},set:function(o){s=o}});var a={};Object.defineProperty(this,"style",{get:function(){return a},set:function(o){a=o}}),Object.defineProperty(this,"parentNode",{})};t.prototype.getContext=function(e,n){var i;if((e=e||"2d")!=="2d")return null;for(i in n)this.pdf.context2d.hasOwnProperty(i)&&(this.pdf.context2d[i]=n[i]);return this.pdf.context2d._canvas=this,this.pdf.context2d},t.prototype.toDataURL=function(){throw new Error("toDataURL is not implemented.")},r.events.push(["initialized",function(){this.canvas=new t,this.canvas.pdf=this}])}(Xr.API),function(r){var t={left:0,top:0,bottom:0,right:0},e=!1,n=function(){this.internal.__cell__===void 0&&(this.internal.__cell__={},this.internal.__cell__.padding=3,this.internal.__cell__.headerFunction=void 0,this.internal.__cell__.margins=Object.assign({},t),this.internal.__cell__.margins.width=this.getPageWidth(),i.call(this))},i=function(){this.internal.__cell__.lastCell=new s,this.internal.__cell__.pages=1},s=function(){var h=arguments[0];Object.defineProperty(this,"x",{enumerable:!0,get:function(){return h},set:function(D){h=D}});var f=arguments[1];Object.defineProperty(this,"y",{enumerable:!0,get:function(){return f},set:function(D){f=D}});var g=arguments[2];Object.defineProperty(this,"width",{enumerable:!0,get:function(){return g},set:function(D){g=D}});var b=arguments[3];Object.defineProperty(this,"height",{enumerable:!0,get:function(){return b},set:function(D){b=D}});var C=arguments[4];Object.defineProperty(this,"text",{enumerable:!0,get:function(){return C},set:function(D){C=D}});var B=arguments[5];Object.defineProperty(this,"lineNumber",{enumerable:!0,get:function(){return B},set:function(D){B=D}});var R=arguments[6];return Object.defineProperty(this,"align",{enumerable:!0,get:function(){return R},set:function(D){R=D}}),this};s.prototype.clone=function(){return new s(this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align)},s.prototype.toArray=function(){return[this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align]},r.setHeaderFunction=function(h){return n.call(this),this.internal.__cell__.headerFunction=typeof h=="function"?h:void 0,this},r.getTextDimensions=function(h,f){n.call(this);var g=(f=f||{}).fontSize||this.getFontSize(),b=f.font||this.getFont(),C=f.scaleFactor||this.internal.scaleFactor,B=0,R=0,D=0,Q=this;if(!Array.isArray(h)&&typeof h!="string"){if(typeof h!="number")throw new Error("getTextDimensions expects text-parameter to be of type String or type Number or an Array of Strings.");h=String(h)}var k=f.maxWidth;k>0?typeof h=="string"?h=this.splitTextToSize(h,k):Object.prototype.toString.call(h)==="[object Array]"&&(h=h.reduce(function(et,st){return et.concat(Q.splitTextToSize(st,k))},[])):h=Array.isArray(h)?h:[h];for(var j=0;j<h.length;j++)B<(D=this.getStringUnitWidth(h[j],{font:b})*g)&&(B=D);return B!==0&&(R=h.length),{w:B/=C,h:Math.max((R*g*this.getLineHeightFactor()-g*(this.getLineHeightFactor()-1))/C,0)}},r.cellAddPage=function(){n.call(this),this.addPage();var h=this.internal.__cell__.margins||t;return this.internal.__cell__.lastCell=new s(h.left,h.top,void 0,void 0),this.internal.__cell__.pages+=1,this};var a=r.cell=function(){var h;h=arguments[0]instanceof s?arguments[0]:new s(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]),n.call(this);var f=this.internal.__cell__.lastCell,g=this.internal.__cell__.padding,b=this.internal.__cell__.margins||t,C=this.internal.__cell__.tableHeaderRow,B=this.internal.__cell__.printHeaders;return f.lineNumber!==void 0&&(f.lineNumber===h.lineNumber?(h.x=(f.x||0)+(f.width||0),h.y=f.y||0):f.y+f.height+h.height+b.bottom>this.getPageHeight()?(this.cellAddPage(),h.y=b.top,B&&C&&(this.printHeaderRow(h.lineNumber,!0),h.y+=C[0].height)):h.y=f.y+f.height||h.y),h.text[0]!==void 0&&(this.rect(h.x,h.y,h.width,h.height,e===!0?"FD":void 0),h.align==="right"?this.text(h.text,h.x+h.width-g,h.y+g,{align:"right",baseline:"top"}):h.align==="center"?this.text(h.text,h.x+h.width/2,h.y+g,{align:"center",baseline:"top",maxWidth:h.width-g-g}):this.text(h.text,h.x+g,h.y+g,{align:"left",baseline:"top",maxWidth:h.width-g-g})),this.internal.__cell__.lastCell=h,this};r.table=function(h,f,g,b,C){if(n.call(this),!g)throw new Error("No data for PDF table.");var B,R,D,Q,k=[],j=[],et=[],st={},mt={},pt=[],yt=[],ft=(C=C||{}).autoSize||!1,Dt=C.printHeaders!==!1,It=C.css&&C.css["font-size"]!==void 0?16*C.css["font-size"]:C.fontSize||12,ut=C.margins||Object.assign({width:this.getPageWidth()},t),At=typeof C.padding=="number"?C.padding:3,Bt=C.headerBackgroundColor||"#c8c8c8",vt=C.headerTextColor||"#000";if(i.call(this),this.internal.__cell__.printHeaders=Dt,this.internal.__cell__.margins=ut,this.internal.__cell__.table_font_size=It,this.internal.__cell__.padding=At,this.internal.__cell__.headerBackgroundColor=Bt,this.internal.__cell__.headerTextColor=vt,this.setFontSize(It),b==null)j=k=Object.keys(g[0]),et=k.map(function(){return"left"});else if(Array.isArray(b)&&Nn(b[0])==="object")for(k=b.map(function(le){return le.name}),j=b.map(function(le){return le.prompt||le.name||""}),et=b.map(function(le){return le.align||"left"}),B=0;B<b.length;B+=1)mt[b[B].name]=b[B].width*(19.049976/25.4);else Array.isArray(b)&&typeof b[0]=="string"&&(j=k=b,et=k.map(function(){return"left"}));if(ft||Array.isArray(b)&&typeof b[0]=="string")for(B=0;B<k.length;B+=1){for(st[Q=k[B]]=g.map(function(le){return le[Q]}),this.setFont(void 0,"bold"),pt.push(this.getTextDimensions(j[B],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w),R=st[Q],this.setFont(void 0,"normal"),D=0;D<R.length;D+=1)pt.push(this.getTextDimensions(R[D],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w);mt[Q]=Math.max.apply(null,pt)+At+At,pt=[]}if(Dt){var ne={};for(B=0;B<k.length;B+=1)ne[k[B]]={},ne[k[B]].text=j[B],ne[k[B]].align=et[B];var ie=o.call(this,ne,mt);yt=k.map(function(le){return new s(h,f,mt[le],ie,ne[le].text,void 0,ne[le].align)}),this.setTableHeaderRow(yt),this.printHeaderRow(1,!1)}var ae=b.reduce(function(le,Te){return le[Te.name]=Te.align,le},{});for(B=0;B<g.length;B+=1){"rowStart"in C&&C.rowStart instanceof Function&&C.rowStart({row:B,data:g[B]},this);var te=o.call(this,g[B],mt);for(D=0;D<k.length;D+=1){var ce=g[B][k[D]];"cellStart"in C&&C.cellStart instanceof Function&&C.cellStart({row:B,col:D,data:ce},this),a.call(this,new s(h,f,mt[k[D]],te,ce,B+2,ae[k[D]]))}}return this.internal.__cell__.table_x=h,this.internal.__cell__.table_y=f,this};var o=function(h,f){var g=this.internal.__cell__.padding,b=this.internal.__cell__.table_font_size,C=this.internal.scaleFactor;return Object.keys(h).map(function(B){var R=h[B];return this.splitTextToSize(R.hasOwnProperty("text")?R.text:R,f[B]-g-g)},this).map(function(B){return this.getLineHeightFactor()*B.length*b/C+g+g},this).reduce(function(B,R){return Math.max(B,R)},0)};r.setTableHeaderRow=function(h){n.call(this),this.internal.__cell__.tableHeaderRow=h},r.printHeaderRow=function(h,f){if(n.call(this),!this.internal.__cell__.tableHeaderRow)throw new Error("Property tableHeaderRow does not exist.");var g;if(e=!0,typeof this.internal.__cell__.headerFunction=="function"){var b=this.internal.__cell__.headerFunction(this,this.internal.__cell__.pages);this.internal.__cell__.lastCell=new s(b[0],b[1],b[2],b[3],void 0,-1)}this.setFont(void 0,"bold");for(var C=[],B=0;B<this.internal.__cell__.tableHeaderRow.length;B+=1){g=this.internal.__cell__.tableHeaderRow[B].clone(),f&&(g.y=this.internal.__cell__.margins.top||0,C.push(g)),g.lineNumber=h;var R=this.getTextColor();this.setTextColor(this.internal.__cell__.headerTextColor),this.setFillColor(this.internal.__cell__.headerBackgroundColor),a.call(this,g),this.setTextColor(R)}C.length>0&&this.setTableHeaderRow(C),this.setFont(void 0,"normal"),e=!1}}(Xr.API);var tF={italic:["italic","oblique","normal"],oblique:["oblique","italic","normal"],normal:["normal","oblique","italic"]},eF=["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded"],zw=ZL(eF),rF=[100,200,300,400,500,600,700,800,900],Ett=ZL(rF);function Hw(r){var t=r.family.replace(/"|'/g,"").toLowerCase(),e=function(s){return tF[s=s||"normal"]?s:"normal"}(r.style),n=function(s){if(!s)return 400;if(typeof s=="number")return s>=100&&s<=900&&s%100==0?s:400;if(/^\d00$/.test(s))return parseInt(s);switch(s){case"bold":return 700;case"normal":default:return 400}}(r.weight),i=function(s){return typeof zw[s=s||"normal"]=="number"?s:"normal"}(r.stretch);return{family:t,style:e,weight:n,stretch:i,src:r.src||[],ref:r.ref||{name:t,style:[i,e,n].join(" ")}}}function nF(r,t,e,n){var i;for(i=e;i>=0&&i<t.length;i+=n)if(r[t[i]])return r[t[i]];for(i=e;i>=0&&i<t.length;i-=n)if(r[t[i]])return r[t[i]]}var Stt={"sans-serif":"helvetica",fixed:"courier",monospace:"courier",terminal:"courier",cursive:"times",fantasy:"times",serif:"times"},iF={caption:"times",icon:"times",menu:"times","message-box":"times","small-caption":"times","status-bar":"times"};function sF(r){return[r.stretch,r.style,r.weight,r.family].join(" ")}function Ttt(r,t,e){for(var n=(e=e||{}).defaultFontFamily||"times",i=Object.assign({},Stt,e.genericFontFamilies||{}),s=null,a=null,o=0;o<t.length;++o)if(i[(s=Hw(t[o])).family]&&(s.family=i[s.family]),r.hasOwnProperty(s.family)){a=r[s.family];break}if(!(a=a||r[n]))throw new Error("Could not find a font-family for the rule '"+sF(s)+"' and default family '"+n+"'.");if(a=function(h,f){if(f[h])return f[h];var g=zw[h],b=g<=zw.normal?-1:1,C=nF(f,eF,g,b);if(!C)throw new Error("Could not find a matching font-stretch value for "+h);return C}(s.stretch,a),a=function(h,f){if(f[h])return f[h];for(var g=tF[h],b=0;b<g.length;++b)if(f[g[b]])return f[g[b]];throw new Error("Could not find a matching font-style for "+h)}(s.style,a),!(a=function(h,f){if(f[h])return f[h];if(h===400&&f[500])return f[500];if(h===500&&f[400])return f[400];var g=Ett[h],b=nF(f,rF,g,h<400?-1:1);if(!b)throw new Error("Could not find a matching font-weight for value "+h);return b}(s.weight,a)))throw new Error("Failed to resolve a font for the rule '"+sF(s)+"'.");return a}function oF(r){return r.trimLeft()}function Itt(r,t){for(var e=0;e<r.length;){if(r.charAt(e)===t)return[r.substring(0,e),r.substring(e+1)];e+=1}return null}function Ltt(r){var t=r.match(/^(-[a-z_]|[a-z_])[a-z0-9_-]*/i);return t===null?null:[t[0],r.substring(t[0].length)]}var Y0,aF,cF,lF=["times"];(function(r){var t,e,n,i,s,a,o,h,f,g=function(rt){return rt=rt||{},this.isStrokeTransparent=rt.isStrokeTransparent||!1,this.strokeOpacity=rt.strokeOpacity||1,this.strokeStyle=rt.strokeStyle||"#000000",this.fillStyle=rt.fillStyle||"#000000",this.isFillTransparent=rt.isFillTransparent||!1,this.fillOpacity=rt.fillOpacity||1,this.font=rt.font||"10px sans-serif",this.textBaseline=rt.textBaseline||"alphabetic",this.textAlign=rt.textAlign||"left",this.lineWidth=rt.lineWidth||1,this.lineJoin=rt.lineJoin||"miter",this.lineCap=rt.lineCap||"butt",this.path=rt.path||[],this.transform=rt.transform!==void 0?rt.transform.clone():new h,this.globalCompositeOperation=rt.globalCompositeOperation||"normal",this.globalAlpha=rt.globalAlpha||1,this.clip_path=rt.clip_path||[],this.currentPoint=rt.currentPoint||new a,this.miterLimit=rt.miterLimit||10,this.lastPoint=rt.lastPoint||new a,this.lineDashOffset=rt.lineDashOffset||0,this.lineDash=rt.lineDash||[],this.margin=rt.margin||[0,0,0,0],this.prevPageLastElemOffset=rt.prevPageLastElemOffset||0,this.ignoreClearRect=typeof rt.ignoreClearRect!="boolean"||rt.ignoreClearRect,this};r.events.push(["initialized",function(){this.context2d=new b(this),t=this.internal.f2,e=this.internal.getCoordinateString,n=this.internal.getVerticalCoordinateString,i=this.internal.getHorizontalCoordinate,s=this.internal.getVerticalCoordinate,a=this.internal.Point,o=this.internal.Rectangle,h=this.internal.Matrix,f=new g}]);var b=function(rt){Object.defineProperty(this,"canvas",{get:function(){return{parentNode:!1,style:!1}}});var wt=rt;Object.defineProperty(this,"pdf",{get:function(){return wt}});var St=!1;Object.defineProperty(this,"pageWrapXEnabled",{get:function(){return St},set:function(_e){St=!!_e}});var qt=!1;Object.defineProperty(this,"pageWrapYEnabled",{get:function(){return qt},set:function(_e){qt=!!_e}});var Jt=0;Object.defineProperty(this,"posX",{get:function(){return Jt},set:function(_e){isNaN(_e)||(Jt=_e)}});var se=0;Object.defineProperty(this,"posY",{get:function(){return se},set:function(_e){isNaN(_e)||(se=_e)}}),Object.defineProperty(this,"margin",{get:function(){return f.margin},set:function(_e){var Ut;typeof _e=="number"?Ut=[_e,_e,_e,_e]:((Ut=new Array(4))[0]=_e[0],Ut[1]=_e.length>=2?_e[1]:Ut[0],Ut[2]=_e.length>=3?_e[2]:Ut[0],Ut[3]=_e.length>=4?_e[3]:Ut[1]),f.margin=Ut}});var Ae=!1;Object.defineProperty(this,"autoPaging",{get:function(){return Ae},set:function(_e){Ae=_e}});var oe=0;Object.defineProperty(this,"lastBreak",{get:function(){return oe},set:function(_e){oe=_e}});var Ce=[];Object.defineProperty(this,"pageBreaks",{get:function(){return Ce},set:function(_e){Ce=_e}}),Object.defineProperty(this,"ctx",{get:function(){return f},set:function(_e){_e instanceof g&&(f=_e)}}),Object.defineProperty(this,"path",{get:function(){return f.path},set:function(_e){f.path=_e}});var Pe=[];Object.defineProperty(this,"ctxStack",{get:function(){return Pe},set:function(_e){Pe=_e}}),Object.defineProperty(this,"fillStyle",{get:function(){return this.ctx.fillStyle},set:function(_e){var Ut;Ut=C(_e),this.ctx.fillStyle=Ut.style,this.ctx.isFillTransparent=Ut.a===0,this.ctx.fillOpacity=Ut.a,this.pdf.setFillColor(Ut.r,Ut.g,Ut.b,{a:Ut.a}),this.pdf.setTextColor(Ut.r,Ut.g,Ut.b,{a:Ut.a})}}),Object.defineProperty(this,"strokeStyle",{get:function(){return this.ctx.strokeStyle},set:function(_e){var Ut=C(_e);this.ctx.strokeStyle=Ut.style,this.ctx.isStrokeTransparent=Ut.a===0,this.ctx.strokeOpacity=Ut.a,Ut.a===0?this.pdf.setDrawColor(255,255,255):(Ut.a,this.pdf.setDrawColor(Ut.r,Ut.g,Ut.b))}}),Object.defineProperty(this,"lineCap",{get:function(){return this.ctx.lineCap},set:function(_e){["butt","round","square"].indexOf(_e)!==-1&&(this.ctx.lineCap=_e,this.pdf.setLineCap(_e))}}),Object.defineProperty(this,"lineWidth",{get:function(){return this.ctx.lineWidth},set:function(_e){isNaN(_e)||(this.ctx.lineWidth=_e,this.pdf.setLineWidth(_e))}}),Object.defineProperty(this,"lineJoin",{get:function(){return this.ctx.lineJoin},set:function(_e){["bevel","round","miter"].indexOf(_e)!==-1&&(this.ctx.lineJoin=_e,this.pdf.setLineJoin(_e))}}),Object.defineProperty(this,"miterLimit",{get:function(){return this.ctx.miterLimit},set:function(_e){isNaN(_e)||(this.ctx.miterLimit=_e,this.pdf.setMiterLimit(_e))}}),Object.defineProperty(this,"textBaseline",{get:function(){return this.ctx.textBaseline},set:function(_e){this.ctx.textBaseline=_e}}),Object.defineProperty(this,"textAlign",{get:function(){return this.ctx.textAlign},set:function(_e){["right","end","center","left","start"].indexOf(_e)!==-1&&(this.ctx.textAlign=_e)}});var Ve=null;function Ke(_e,Ut){if(Ve===null){var pr=function(ir){var Se=[];return Object.keys(ir).forEach(function(Kt){ir[Kt].forEach(function(Ie){var ke=null;switch(Ie){case"bold":ke={family:Kt,weight:"bold"};break;case"italic":ke={family:Kt,style:"italic"};break;case"bolditalic":ke={family:Kt,weight:"bold",style:"italic"};break;case"":case"normal":ke={family:Kt}}ke!==null&&(ke.ref={name:Kt,style:Ie},Se.push(ke))})}),Se}(_e.getFontList());Ve=function(ir){for(var Se={},Kt=0;Kt<ir.length;++Kt){var Ie=Hw(ir[Kt]),ke=Ie.family,He=Ie.stretch,De=Ie.style,xr=Ie.weight;Se[ke]=Se[ke]||{},Se[ke][He]=Se[ke][He]||{},Se[ke][He][De]=Se[ke][He][De]||{},Se[ke][He][De][xr]=Ie}return Se}(pr.concat(Ut))}return Ve}var rr=null;Object.defineProperty(this,"fontFaces",{get:function(){return rr},set:function(_e){Ve=null,rr=_e}}),Object.defineProperty(this,"font",{get:function(){return this.ctx.font},set:function(_e){var Ut;if(this.ctx.font=_e,(Ut=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-_,\"\'\sa-z]+?)\s*$/i.exec(_e))!==null){var pr=Ut[1],ir=(Ut[2],Ut[3]),Se=Ut[4],Kt=(Ut[5],Ut[6]),Ie=/^([.\d]+)((?:%|in|[cem]m|ex|p[ctx]))$/i.exec(Se)[2];Se=Math.floor(Ie==="px"?parseFloat(Se)*this.pdf.internal.scaleFactor:Ie==="em"?parseFloat(Se)*this.pdf.getFontSize():parseFloat(Se)*this.pdf.internal.scaleFactor),this.pdf.setFontSize(Se);var ke=function(Br){var Ur,je,Ee=[],Nr=Br.trim();if(Nr==="")return lF;if(Nr in iF)return[iF[Nr]];for(;Nr!=="";){switch(je=null,Ur=(Nr=oF(Nr)).charAt(0)){case'"':case"'":je=Itt(Nr.substring(1),Ur);break;default:je=Ltt(Nr)}if(je===null||(Ee.push(je[0]),(Nr=oF(je[1]))!==""&&Nr.charAt(0)!==","))return lF;Nr=Nr.replace(/^,/,"")}return Ee}(Kt);if(this.fontFaces){var He=Ttt(Ke(this.pdf,this.fontFaces),ke.map(function(Br){return{family:Br,stretch:"normal",weight:ir,style:pr}}));this.pdf.setFont(He.ref.name,He.ref.style)}else{var De="";(ir==="bold"||parseInt(ir,10)>=700||pr==="bold")&&(De="bold"),pr==="italic"&&(De+="italic"),De.length===0&&(De="normal");for(var xr="",Pr={arial:"Helvetica",Arial:"Helvetica",verdana:"Helvetica",Verdana:"Helvetica",helvetica:"Helvetica",Helvetica:"Helvetica","sans-serif":"Helvetica",fixed:"Courier",monospace:"Courier",terminal:"Courier",cursive:"Times",fantasy:"Times",serif:"Times"},Or=0;Or<ke.length;Or++){if(this.pdf.internal.getFont(ke[Or],De,{noFallback:!0,disableWarning:!0})!==void 0){xr=ke[Or];break}if(De==="bolditalic"&&this.pdf.internal.getFont(ke[Or],"bold",{noFallback:!0,disableWarning:!0})!==void 0)xr=ke[Or],De="bold";else if(this.pdf.internal.getFont(ke[Or],"normal",{noFallback:!0,disableWarning:!0})!==void 0){xr=ke[Or],De="normal";break}}if(xr===""){for(var nn=0;nn<ke.length;nn++)if(Pr[ke[nn]]){xr=Pr[ke[nn]];break}}xr=xr===""?"Times":xr,this.pdf.setFont(xr,De)}}}}),Object.defineProperty(this,"globalCompositeOperation",{get:function(){return this.ctx.globalCompositeOperation},set:function(_e){this.ctx.globalCompositeOperation=_e}}),Object.defineProperty(this,"globalAlpha",{get:function(){return this.ctx.globalAlpha},set:function(_e){this.ctx.globalAlpha=_e}}),Object.defineProperty(this,"lineDashOffset",{get:function(){return this.ctx.lineDashOffset},set:function(_e){this.ctx.lineDashOffset=_e,Te.call(this)}}),Object.defineProperty(this,"lineDash",{get:function(){return this.ctx.lineDash},set:function(_e){this.ctx.lineDash=_e,Te.call(this)}}),Object.defineProperty(this,"ignoreClearRect",{get:function(){return this.ctx.ignoreClearRect},set:function(_e){this.ctx.ignoreClearRect=!!_e}})};b.prototype.setLineDash=function(rt){this.lineDash=rt},b.prototype.getLineDash=function(){return this.lineDash.length%2?this.lineDash.concat(this.lineDash):this.lineDash.slice()},b.prototype.fill=function(){st.call(this,"fill",!1)},b.prototype.stroke=function(){st.call(this,"stroke",!1)},b.prototype.beginPath=function(){this.path=[{type:"begin"}]},b.prototype.moveTo=function(rt,wt){if(isNaN(rt)||isNaN(wt))throw ui.error("jsPDF.context2d.moveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.moveTo");var St=this.ctx.transform.applyToPoint(new a(rt,wt));this.path.push({type:"mt",x:St.x,y:St.y}),this.ctx.lastPoint=new a(rt,wt)},b.prototype.closePath=function(){var rt=new a(0,0),wt=0;for(wt=this.path.length-1;wt!==-1;wt--)if(this.path[wt].type==="begin"&&Nn(this.path[wt+1])==="object"&&typeof this.path[wt+1].x=="number"){rt=new a(this.path[wt+1].x,this.path[wt+1].y);break}this.path.push({type:"close"}),this.ctx.lastPoint=new a(rt.x,rt.y)},b.prototype.lineTo=function(rt,wt){if(isNaN(rt)||isNaN(wt))throw ui.error("jsPDF.context2d.lineTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.lineTo");var St=this.ctx.transform.applyToPoint(new a(rt,wt));this.path.push({type:"lt",x:St.x,y:St.y}),this.ctx.lastPoint=new a(St.x,St.y)},b.prototype.clip=function(){this.ctx.clip_path=JSON.parse(JSON.stringify(this.path)),st.call(this,null,!0)},b.prototype.quadraticCurveTo=function(rt,wt,St,qt){if(isNaN(St)||isNaN(qt)||isNaN(rt)||isNaN(wt))throw ui.error("jsPDF.context2d.quadraticCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.quadraticCurveTo");var Jt=this.ctx.transform.applyToPoint(new a(St,qt)),se=this.ctx.transform.applyToPoint(new a(rt,wt));this.path.push({type:"qct",x1:se.x,y1:se.y,x:Jt.x,y:Jt.y}),this.ctx.lastPoint=new a(Jt.x,Jt.y)},b.prototype.bezierCurveTo=function(rt,wt,St,qt,Jt,se){if(isNaN(Jt)||isNaN(se)||isNaN(rt)||isNaN(wt)||isNaN(St)||isNaN(qt))throw ui.error("jsPDF.context2d.bezierCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.bezierCurveTo");var Ae=this.ctx.transform.applyToPoint(new a(Jt,se)),oe=this.ctx.transform.applyToPoint(new a(rt,wt)),Ce=this.ctx.transform.applyToPoint(new a(St,qt));this.path.push({type:"bct",x1:oe.x,y1:oe.y,x2:Ce.x,y2:Ce.y,x:Ae.x,y:Ae.y}),this.ctx.lastPoint=new a(Ae.x,Ae.y)},b.prototype.arc=function(rt,wt,St,qt,Jt,se){if(isNaN(rt)||isNaN(wt)||isNaN(St)||isNaN(qt)||isNaN(Jt))throw ui.error("jsPDF.context2d.arc: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.arc");if(se=!!se,!this.ctx.transform.isIdentity){var Ae=this.ctx.transform.applyToPoint(new a(rt,wt));rt=Ae.x,wt=Ae.y;var oe=this.ctx.transform.applyToPoint(new a(0,St)),Ce=this.ctx.transform.applyToPoint(new a(0,0));St=Math.sqrt(Math.pow(oe.x-Ce.x,2)+Math.pow(oe.y-Ce.y,2))}Math.abs(Jt-qt)>=2*Math.PI&&(qt=0,Jt=2*Math.PI),this.path.push({type:"arc",x:rt,y:wt,radius:St,startAngle:qt,endAngle:Jt,counterclockwise:se})},b.prototype.arcTo=function(rt,wt,St,qt,Jt){throw new Error("arcTo not implemented.")},b.prototype.rect=function(rt,wt,St,qt){if(isNaN(rt)||isNaN(wt)||isNaN(St)||isNaN(qt))throw ui.error("jsPDF.context2d.rect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rect");this.moveTo(rt,wt),this.lineTo(rt+St,wt),this.lineTo(rt+St,wt+qt),this.lineTo(rt,wt+qt),this.lineTo(rt,wt),this.lineTo(rt+St,wt),this.lineTo(rt,wt)},b.prototype.fillRect=function(rt,wt,St,qt){if(isNaN(rt)||isNaN(wt)||isNaN(St)||isNaN(qt))throw ui.error("jsPDF.context2d.fillRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillRect");if(!B.call(this)){var Jt={};this.lineCap!=="butt"&&(Jt.lineCap=this.lineCap,this.lineCap="butt"),this.lineJoin!=="miter"&&(Jt.lineJoin=this.lineJoin,this.lineJoin="miter"),this.beginPath(),this.rect(rt,wt,St,qt),this.fill(),Jt.hasOwnProperty("lineCap")&&(this.lineCap=Jt.lineCap),Jt.hasOwnProperty("lineJoin")&&(this.lineJoin=Jt.lineJoin)}},b.prototype.strokeRect=function(rt,wt,St,qt){if(isNaN(rt)||isNaN(wt)||isNaN(St)||isNaN(qt))throw ui.error("jsPDF.context2d.strokeRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeRect");R.call(this)||(this.beginPath(),this.rect(rt,wt,St,qt),this.stroke())},b.prototype.clearRect=function(rt,wt,St,qt){if(isNaN(rt)||isNaN(wt)||isNaN(St)||isNaN(qt))throw ui.error("jsPDF.context2d.clearRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.clearRect");this.ignoreClearRect||(this.fillStyle="#ffffff",this.fillRect(rt,wt,St,qt))},b.prototype.save=function(rt){rt=typeof rt!="boolean"||rt;for(var wt=this.pdf.internal.getCurrentPageInfo().pageNumber,St=0;St<this.pdf.internal.getNumberOfPages();St++)this.pdf.setPage(St+1),this.pdf.internal.out("q");if(this.pdf.setPage(wt),rt){this.ctx.fontSize=this.pdf.internal.getFontSize();var qt=new g(this.ctx);this.ctxStack.push(this.ctx),this.ctx=qt}},b.prototype.restore=function(rt){rt=typeof rt!="boolean"||rt;for(var wt=this.pdf.internal.getCurrentPageInfo().pageNumber,St=0;St<this.pdf.internal.getNumberOfPages();St++)this.pdf.setPage(St+1),this.pdf.internal.out("Q");this.pdf.setPage(wt),rt&&this.ctxStack.length!==0&&(this.ctx=this.ctxStack.pop(),this.fillStyle=this.ctx.fillStyle,this.strokeStyle=this.ctx.strokeStyle,this.font=this.ctx.font,this.lineCap=this.ctx.lineCap,this.lineWidth=this.ctx.lineWidth,this.lineJoin=this.ctx.lineJoin,this.lineDash=this.ctx.lineDash,this.lineDashOffset=this.ctx.lineDashOffset)},b.prototype.toDataURL=function(){throw new Error("toDataUrl not implemented.")};var C=function(rt){var wt,St,qt,Jt;if(rt.isCanvasGradient===!0&&(rt=rt.getColor()),!rt)return{r:0,g:0,b:0,a:0,style:rt};if(/transparent|rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*0+\s*\)/.test(rt))wt=0,St=0,qt=0,Jt=0;else{var se=/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/.exec(rt);if(se!==null)wt=parseInt(se[1]),St=parseInt(se[2]),qt=parseInt(se[3]),Jt=1;else if((se=/rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.]+)\s*\)/.exec(rt))!==null)wt=parseInt(se[1]),St=parseInt(se[2]),qt=parseInt(se[3]),Jt=parseFloat(se[4]);else{if(Jt=1,typeof rt=="string"&&rt.charAt(0)!=="#"){var Ae=new HL(rt);rt=Ae.ok?Ae.toHex():"#000000"}rt.length===4?(wt=rt.substring(1,2),wt+=wt,St=rt.substring(2,3),St+=St,qt=rt.substring(3,4),qt+=qt):(wt=rt.substring(1,3),St=rt.substring(3,5),qt=rt.substring(5,7)),wt=parseInt(wt,16),St=parseInt(St,16),qt=parseInt(qt,16)}}return{r:wt,g:St,b:qt,a:Jt,style:rt}},B=function(){return this.ctx.isFillTransparent||this.globalAlpha==0},R=function(){return!!(this.ctx.isStrokeTransparent||this.globalAlpha==0)};b.prototype.fillText=function(rt,wt,St,qt){if(isNaN(wt)||isNaN(St)||typeof rt!="string")throw ui.error("jsPDF.context2d.fillText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillText");if(qt=isNaN(qt)?void 0:qt,!B.call(this)){var Jt=te(this.ctx.transform.rotation),se=this.ctx.transform.scaleX;At.call(this,{text:rt,x:wt,y:St,scale:se,angle:Jt,align:this.textAlign,maxWidth:qt})}},b.prototype.strokeText=function(rt,wt,St,qt){if(isNaN(wt)||isNaN(St)||typeof rt!="string")throw ui.error("jsPDF.context2d.strokeText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeText");if(!R.call(this)){qt=isNaN(qt)?void 0:qt;var Jt=te(this.ctx.transform.rotation),se=this.ctx.transform.scaleX;At.call(this,{text:rt,x:wt,y:St,scale:se,renderingMode:"stroke",angle:Jt,align:this.textAlign,maxWidth:qt})}},b.prototype.measureText=function(rt){if(typeof rt!="string")throw ui.error("jsPDF.context2d.measureText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.measureText");var wt=this.pdf,St=this.pdf.internal.scaleFactor,qt=wt.internal.getFontSize(),Jt=wt.getStringUnitWidth(rt)*qt/wt.internal.scaleFactor,se=function(Ae){var oe=(Ae=Ae||{}).width||0;return Object.defineProperty(this,"width",{get:function(){return oe}}),this};return new se({width:Jt*=Math.round(96*St/72*1e4)/1e4})},b.prototype.scale=function(rt,wt){if(isNaN(rt)||isNaN(wt))throw ui.error("jsPDF.context2d.scale: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.scale");var St=new h(rt,0,0,wt,0,0);this.ctx.transform=this.ctx.transform.multiply(St)},b.prototype.rotate=function(rt){if(isNaN(rt))throw ui.error("jsPDF.context2d.rotate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rotate");var wt=new h(Math.cos(rt),Math.sin(rt),-Math.sin(rt),Math.cos(rt),0,0);this.ctx.transform=this.ctx.transform.multiply(wt)},b.prototype.translate=function(rt,wt){if(isNaN(rt)||isNaN(wt))throw ui.error("jsPDF.context2d.translate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.translate");var St=new h(1,0,0,1,rt,wt);this.ctx.transform=this.ctx.transform.multiply(St)},b.prototype.transform=function(rt,wt,St,qt,Jt,se){if(isNaN(rt)||isNaN(wt)||isNaN(St)||isNaN(qt)||isNaN(Jt)||isNaN(se))throw ui.error("jsPDF.context2d.transform: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.transform");var Ae=new h(rt,wt,St,qt,Jt,se);this.ctx.transform=this.ctx.transform.multiply(Ae)},b.prototype.setTransform=function(rt,wt,St,qt,Jt,se){rt=isNaN(rt)?1:rt,wt=isNaN(wt)?0:wt,St=isNaN(St)?0:St,qt=isNaN(qt)?1:qt,Jt=isNaN(Jt)?0:Jt,se=isNaN(se)?0:se,this.ctx.transform=new h(rt,wt,St,qt,Jt,se)};var D=function(){return this.margin[0]>0||this.margin[1]>0||this.margin[2]>0||this.margin[3]>0};b.prototype.drawImage=function(rt,wt,St,qt,Jt,se,Ae,oe,Ce){var Pe=this.pdf.getImageProperties(rt),Ve=1,Ke=1,rr=1,_e=1;qt!==void 0&&oe!==void 0&&(rr=oe/qt,_e=Ce/Jt,Ve=Pe.width/qt*oe/qt,Ke=Pe.height/Jt*Ce/Jt),se===void 0&&(se=wt,Ae=St,wt=0,St=0),qt!==void 0&&oe===void 0&&(oe=qt,Ce=Jt),qt===void 0&&oe===void 0&&(oe=Pe.width,Ce=Pe.height);for(var Ut,pr=this.ctx.transform.decompose(),ir=te(pr.rotate.shx),Se=new h,Kt=(Se=(Se=(Se=Se.multiply(pr.translate)).multiply(pr.skew)).multiply(pr.scale)).applyToRectangle(new o(se-wt*rr,Ae-St*_e,qt*Ve,Jt*Ke)),Ie=Q.call(this,Kt),ke=[],He=0;He<Ie.length;He+=1)ke.indexOf(Ie[He])===-1&&ke.push(Ie[He]);if(et(ke),this.autoPaging)for(var De=ke[0],xr=ke[ke.length-1],Pr=De;Pr<xr+1;Pr++){this.pdf.setPage(Pr);var Or=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],nn=Pr===1?this.posY+this.margin[0]:this.margin[0],Br=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Ur=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],je=Pr===1?0:Br+(Pr-2)*Ur;if(this.ctx.clip_path.length!==0){var Ee=this.path;Ut=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=j(Ut,this.posX+this.margin[3],-je+nn+this.ctx.prevPageLastElemOffset),mt.call(this,"fill",!0),this.path=Ee}var Nr=JSON.parse(JSON.stringify(Kt));Nr=j([Nr],this.posX+this.margin[3],-je+nn+this.ctx.prevPageLastElemOffset)[0];var Vr=(Pr>De||Pr<xr)&&D.call(this);Vr&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Or,Ur,null).clip().discardPath()),this.pdf.addImage(rt,"JPEG",Nr.x,Nr.y,Nr.w,Nr.h,null,null,ir),Vr&&this.pdf.restoreGraphicsState()}else this.pdf.addImage(rt,"JPEG",Kt.x,Kt.y,Kt.w,Kt.h,null,null,ir)};var Q=function(rt,wt,St){var qt=[];wt=wt||this.pdf.internal.pageSize.width,St=St||this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2];var Jt=this.posY+this.ctx.prevPageLastElemOffset;switch(rt.type){default:case"mt":case"lt":qt.push(Math.floor((rt.y+Jt)/St)+1);break;case"arc":qt.push(Math.floor((rt.y+Jt-rt.radius)/St)+1),qt.push(Math.floor((rt.y+Jt+rt.radius)/St)+1);break;case"qct":var se=ce(this.ctx.lastPoint.x,this.ctx.lastPoint.y,rt.x1,rt.y1,rt.x,rt.y);qt.push(Math.floor((se.y+Jt)/St)+1),qt.push(Math.floor((se.y+se.h+Jt)/St)+1);break;case"bct":var Ae=le(this.ctx.lastPoint.x,this.ctx.lastPoint.y,rt.x1,rt.y1,rt.x2,rt.y2,rt.x,rt.y);qt.push(Math.floor((Ae.y+Jt)/St)+1),qt.push(Math.floor((Ae.y+Ae.h+Jt)/St)+1);break;case"rect":qt.push(Math.floor((rt.y+Jt)/St)+1),qt.push(Math.floor((rt.y+rt.h+Jt)/St)+1)}for(var oe=0;oe<qt.length;oe+=1)for(;this.pdf.internal.getNumberOfPages()<qt[oe];)k.call(this);return qt},k=function(){var rt=this.fillStyle,wt=this.strokeStyle,St=this.font,qt=this.lineCap,Jt=this.lineWidth,se=this.lineJoin;this.pdf.addPage(),this.fillStyle=rt,this.strokeStyle=wt,this.font=St,this.lineCap=qt,this.lineWidth=Jt,this.lineJoin=se},j=function(rt,wt,St){for(var qt=0;qt<rt.length;qt++)switch(rt[qt].type){case"bct":rt[qt].x2+=wt,rt[qt].y2+=St;case"qct":rt[qt].x1+=wt,rt[qt].y1+=St;case"mt":case"lt":case"arc":default:rt[qt].x+=wt,rt[qt].y+=St}return rt},et=function(rt){return rt.sort(function(wt,St){return wt-St})},st=function(rt,wt){for(var St,qt,Jt=this.fillStyle,se=this.strokeStyle,Ae=this.lineCap,oe=this.lineWidth,Ce=Math.abs(oe*this.ctx.transform.scaleX),Pe=this.lineJoin,Ve=JSON.parse(JSON.stringify(this.path)),Ke=JSON.parse(JSON.stringify(this.path)),rr=[],_e=0;_e<Ke.length;_e++)if(Ke[_e].x!==void 0)for(var Ut=Q.call(this,Ke[_e]),pr=0;pr<Ut.length;pr+=1)rr.indexOf(Ut[pr])===-1&&rr.push(Ut[pr]);for(var ir=0;ir<rr.length;ir++)for(;this.pdf.internal.getNumberOfPages()<rr[ir];)k.call(this);if(et(rr),this.autoPaging)for(var Se=rr[0],Kt=rr[rr.length-1],Ie=Se;Ie<Kt+1;Ie++){this.pdf.setPage(Ie),this.fillStyle=Jt,this.strokeStyle=se,this.lineCap=Ae,this.lineWidth=Ce,this.lineJoin=Pe;var ke=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],He=Ie===1?this.posY+this.margin[0]:this.margin[0],De=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],xr=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],Pr=Ie===1?0:De+(Ie-2)*xr;if(this.ctx.clip_path.length!==0){var Or=this.path;St=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=j(St,this.posX+this.margin[3],-Pr+He+this.ctx.prevPageLastElemOffset),mt.call(this,rt,!0),this.path=Or}if(qt=JSON.parse(JSON.stringify(Ve)),this.path=j(qt,this.posX+this.margin[3],-Pr+He+this.ctx.prevPageLastElemOffset),wt===!1||Ie===0){var nn=(Ie>Se||Ie<Kt)&&D.call(this);nn&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],ke,xr,null).clip().discardPath()),mt.call(this,rt,wt),nn&&this.pdf.restoreGraphicsState()}this.lineWidth=oe}else this.lineWidth=Ce,mt.call(this,rt,wt),this.lineWidth=oe;this.path=Ve},mt=function(rt,wt){if((rt!=="stroke"||wt||!R.call(this))&&(rt==="stroke"||wt||!B.call(this))){for(var St,qt,Jt=[],se=this.path,Ae=0;Ae<se.length;Ae++){var oe=se[Ae];switch(oe.type){case"begin":Jt.push({begin:!0});break;case"close":Jt.push({close:!0});break;case"mt":Jt.push({start:oe,deltas:[],abs:[]});break;case"lt":var Ce=Jt.length;if(se[Ae-1]&&!isNaN(se[Ae-1].x)&&(St=[oe.x-se[Ae-1].x,oe.y-se[Ae-1].y],Ce>0)){for(;Ce>=0;Ce--)if(Jt[Ce-1].close!==!0&&Jt[Ce-1].begin!==!0){Jt[Ce-1].deltas.push(St),Jt[Ce-1].abs.push(oe);break}}break;case"bct":St=[oe.x1-se[Ae-1].x,oe.y1-se[Ae-1].y,oe.x2-se[Ae-1].x,oe.y2-se[Ae-1].y,oe.x-se[Ae-1].x,oe.y-se[Ae-1].y],Jt[Jt.length-1].deltas.push(St);break;case"qct":var Pe=se[Ae-1].x+2/3*(oe.x1-se[Ae-1].x),Ve=se[Ae-1].y+2/3*(oe.y1-se[Ae-1].y),Ke=oe.x+2/3*(oe.x1-oe.x),rr=oe.y+2/3*(oe.y1-oe.y),_e=oe.x,Ut=oe.y;St=[Pe-se[Ae-1].x,Ve-se[Ae-1].y,Ke-se[Ae-1].x,rr-se[Ae-1].y,_e-se[Ae-1].x,Ut-se[Ae-1].y],Jt[Jt.length-1].deltas.push(St);break;case"arc":Jt.push({deltas:[],abs:[],arc:!0}),Array.isArray(Jt[Jt.length-1].abs)&&Jt[Jt.length-1].abs.push(oe)}}qt=wt?null:rt==="stroke"?"stroke":"fill";for(var pr=!1,ir=0;ir<Jt.length;ir++)if(Jt[ir].arc)for(var Se=Jt[ir].abs,Kt=0;Kt<Se.length;Kt++){var Ie=Se[Kt];Ie.type==="arc"?ft.call(this,Ie.x,Ie.y,Ie.radius,Ie.startAngle,Ie.endAngle,Ie.counterclockwise,void 0,wt,!pr):Bt.call(this,Ie.x,Ie.y),pr=!0}else if(Jt[ir].close===!0)this.pdf.internal.out("h"),pr=!1;else if(Jt[ir].begin!==!0){var ke=Jt[ir].start.x,He=Jt[ir].start.y;vt.call(this,Jt[ir].deltas,ke,He),pr=!0}qt&&Dt.call(this,qt),wt&&It.call(this)}},pt=function(rt){var wt=this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor,St=wt*(this.pdf.internal.getLineHeightFactor()-1);switch(this.ctx.textBaseline){case"bottom":return rt-St;case"top":return rt+wt-St;case"hanging":return rt+wt-2*St;case"middle":return rt+wt/2-St;case"ideographic":return rt;case"alphabetic":default:return rt}},yt=function(rt){return rt+this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor*(this.pdf.internal.getLineHeightFactor()-1)};b.prototype.createLinearGradient=function(){var rt=function(){};return rt.colorStops=[],rt.addColorStop=function(wt,St){this.colorStops.push([wt,St])},rt.getColor=function(){return this.colorStops.length===0?"#000000":this.colorStops[0][1]},rt.isCanvasGradient=!0,rt},b.prototype.createPattern=function(){return this.createLinearGradient()},b.prototype.createRadialGradient=function(){return this.createLinearGradient()};var ft=function(rt,wt,St,qt,Jt,se,Ae,oe,Ce){for(var Pe=ie.call(this,St,qt,Jt,se),Ve=0;Ve<Pe.length;Ve++){var Ke=Pe[Ve];Ve===0&&(Ce?ut.call(this,Ke.x1+rt,Ke.y1+wt):Bt.call(this,Ke.x1+rt,Ke.y1+wt)),ne.call(this,rt,wt,Ke.x2,Ke.y2,Ke.x3,Ke.y3,Ke.x4,Ke.y4)}oe?It.call(this):Dt.call(this,Ae)},Dt=function(rt){switch(rt){case"stroke":this.pdf.internal.out("S");break;case"fill":this.pdf.internal.out("f")}},It=function(){this.pdf.clip(),this.pdf.discardPath()},ut=function(rt,wt){this.pdf.internal.out(e(rt)+" "+n(wt)+" m")},At=function(rt){var wt;switch(rt.align){case"right":case"end":wt="right";break;case"center":wt="center";break;case"left":case"start":default:wt="left"}var St=this.pdf.getTextDimensions(rt.text),qt=pt.call(this,rt.y),Jt=yt.call(this,qt)-St.h,se=this.ctx.transform.applyToPoint(new a(rt.x,qt)),Ae=this.ctx.transform.decompose(),oe=new h;oe=(oe=(oe=oe.multiply(Ae.translate)).multiply(Ae.skew)).multiply(Ae.scale);for(var Ce,Pe,Ve,Ke=this.ctx.transform.applyToRectangle(new o(rt.x,qt,St.w,St.h)),rr=oe.applyToRectangle(new o(rt.x,Jt,St.w,St.h)),_e=Q.call(this,rr),Ut=[],pr=0;pr<_e.length;pr+=1)Ut.indexOf(_e[pr])===-1&&Ut.push(_e[pr]);if(et(Ut),this.autoPaging)for(var ir=Ut[0],Se=Ut[Ut.length-1],Kt=ir;Kt<Se+1;Kt++){this.pdf.setPage(Kt);var Ie=Kt===1?this.posY+this.margin[0]:this.margin[0],ke=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],He=this.pdf.internal.pageSize.height-this.margin[2],De=He-this.margin[0],xr=this.pdf.internal.pageSize.width-this.margin[1],Pr=xr-this.margin[3],Or=Kt===1?0:ke+(Kt-2)*De;if(this.ctx.clip_path.length!==0){var nn=this.path;Ce=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=j(Ce,this.posX+this.margin[3],-1*Or+Ie),mt.call(this,"fill",!0),this.path=nn}var Br=j([JSON.parse(JSON.stringify(rr))],this.posX+this.margin[3],-Or+Ie+this.ctx.prevPageLastElemOffset)[0];rt.scale>=.01&&(Pe=this.pdf.internal.getFontSize(),this.pdf.setFontSize(Pe*rt.scale),Ve=this.lineWidth,this.lineWidth=Ve*rt.scale);var Ur=this.autoPaging!=="text";if(Ur||Br.y+Br.h<=He){if(Ur||Br.y>=Ie&&Br.x<=xr){var je=Ur?rt.text:this.pdf.splitTextToSize(rt.text,rt.maxWidth||xr-Br.x)[0],Ee=j([JSON.parse(JSON.stringify(Ke))],this.posX+this.margin[3],-Or+Ie+this.ctx.prevPageLastElemOffset)[0],Nr=Ur&&(Kt>ir||Kt<Se)&&D.call(this);Nr&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Pr,De,null).clip().discardPath()),this.pdf.text(je,Ee.x,Ee.y,{angle:rt.angle,align:wt,renderingMode:rt.renderingMode}),Nr&&this.pdf.restoreGraphicsState()}}else Br.y<He&&(this.ctx.prevPageLastElemOffset+=He-Br.y);rt.scale>=.01&&(this.pdf.setFontSize(Pe),this.lineWidth=Ve)}else rt.scale>=.01&&(Pe=this.pdf.internal.getFontSize(),this.pdf.setFontSize(Pe*rt.scale),Ve=this.lineWidth,this.lineWidth=Ve*rt.scale),this.pdf.text(rt.text,se.x+this.posX,se.y+this.posY,{angle:rt.angle,align:wt,renderingMode:rt.renderingMode,maxWidth:rt.maxWidth}),rt.scale>=.01&&(this.pdf.setFontSize(Pe),this.lineWidth=Ve)},Bt=function(rt,wt,St,qt){St=St||0,qt=qt||0,this.pdf.internal.out(e(rt+St)+" "+n(wt+qt)+" l")},vt=function(rt,wt,St){return this.pdf.lines(rt,wt,St,null,null)},ne=function(rt,wt,St,qt,Jt,se,Ae,oe){this.pdf.internal.out([t(i(St+rt)),t(s(qt+wt)),t(i(Jt+rt)),t(s(se+wt)),t(i(Ae+rt)),t(s(oe+wt)),"c"].join(" "))},ie=function(rt,wt,St,qt){for(var Jt=2*Math.PI,se=Math.PI/2;wt>St;)wt-=Jt;var Ae=Math.abs(St-wt);Ae<Jt&&qt&&(Ae=Jt-Ae);for(var oe=[],Ce=qt?-1:1,Pe=wt;Ae>1e-5;){var Ve=Pe+Ce*Math.min(Ae,se);oe.push(ae.call(this,rt,Pe,Ve)),Ae-=Math.abs(Ve-Pe),Pe=Ve}return oe},ae=function(rt,wt,St){var qt=(St-wt)/2,Jt=rt*Math.cos(qt),se=rt*Math.sin(qt),Ae=Jt,oe=-se,Ce=Ae*Ae+oe*oe,Pe=Ce+Ae*Jt+oe*se,Ve=4/3*(Math.sqrt(2*Ce*Pe)-Pe)/(Ae*se-oe*Jt),Ke=Ae-Ve*oe,rr=oe+Ve*Ae,_e=Ke,Ut=-rr,pr=qt+wt,ir=Math.cos(pr),Se=Math.sin(pr);return{x1:rt*Math.cos(wt),y1:rt*Math.sin(wt),x2:Ke*ir-rr*Se,y2:Ke*Se+rr*ir,x3:_e*ir-Ut*Se,y3:_e*Se+Ut*ir,x4:rt*Math.cos(St),y4:rt*Math.sin(St)}},te=function(rt){return 180*rt/Math.PI},ce=function(rt,wt,St,qt,Jt,se){var Ae=rt+.5*(St-rt),oe=wt+.5*(qt-wt),Ce=Jt+.5*(St-Jt),Pe=se+.5*(qt-se),Ve=Math.min(rt,Jt,Ae,Ce),Ke=Math.max(rt,Jt,Ae,Ce),rr=Math.min(wt,se,oe,Pe),_e=Math.max(wt,se,oe,Pe);return new o(Ve,rr,Ke-Ve,_e-rr)},le=function(rt,wt,St,qt,Jt,se,Ae,oe){var Ce,Pe,Ve,Ke,rr,_e,Ut,pr,ir,Se,Kt,Ie,ke,He,De=St-rt,xr=qt-wt,Pr=Jt-St,Or=se-qt,nn=Ae-Jt,Br=oe-se;for(Pe=0;Pe<41;Pe++)ir=(Ut=(Ve=rt+(Ce=Pe/40)*De)+Ce*((rr=St+Ce*Pr)-Ve))+Ce*(rr+Ce*(Jt+Ce*nn-rr)-Ut),Se=(pr=(Ke=wt+Ce*xr)+Ce*((_e=qt+Ce*Or)-Ke))+Ce*(_e+Ce*(se+Ce*Br-_e)-pr),Pe==0?(Kt=ir,Ie=Se,ke=ir,He=Se):(Kt=Math.min(Kt,ir),Ie=Math.min(Ie,Se),ke=Math.max(ke,ir),He=Math.max(He,Se));return new o(Math.round(Kt),Math.round(Ie),Math.round(ke-Kt),Math.round(He-Ie))},Te=function(){if(this.prevLineDash||this.ctx.lineDash.length||this.ctx.lineDashOffset){var rt,wt,St=(rt=this.ctx.lineDash,wt=this.ctx.lineDashOffset,JSON.stringify({lineDash:rt,lineDashOffset:wt}));this.prevLineDash!==St&&(this.pdf.setLineDash(this.ctx.lineDash,this.ctx.lineDashOffset),this.prevLineDash=St)}}})(Xr.API),function(r){var t=function(s){var a,o,h,f,g,b,C,B,R,D;for(o=[],h=0,f=(s+=a="\0\0\0\0".slice(s.length%4||4)).length;f>h;h+=4)(g=(s.charCodeAt(h)<<24)+(s.charCodeAt(h+1)<<16)+(s.charCodeAt(h+2)<<8)+s.charCodeAt(h+3))!==0?(b=(g=((g=((g=((g=(g-(D=g%85))/85)-(R=g%85))/85)-(B=g%85))/85)-(C=g%85))/85)%85,o.push(b+33,C+33,B+33,R+33,D+33)):o.push(122);return function(Q,k){for(var j=k;j>0;j--)Q.pop()}(o,a.length),String.fromCharCode.apply(String,o)+"~>"},e=function(s){var a,o,h,f,g,b=String,C="length",B=255,R="charCodeAt",D="slice",Q="replace";for(s[D](-2),s=s[D](0,-2)[Q](/\s/g,"")[Q]("z","!!!!!"),h=[],f=0,g=(s+=a="uuuuu"[D](s[C]%5||5))[C];g>f;f+=5)o=52200625*(s[R](f)-33)+614125*(s[R](f+1)-33)+7225*(s[R](f+2)-33)+85*(s[R](f+3)-33)+(s[R](f+4)-33),h.push(B&o>>24,B&o>>16,B&o>>8,B&o);return function(k,j){for(var et=j;et>0;et--)k.pop()}(h,a[C]),b.fromCharCode.apply(b,h)},n=function(s){var a=new RegExp(/^([0-9A-Fa-f]{2})+$/);if((s=s.replace(/\s/g,"")).indexOf(">")!==-1&&(s=s.substr(0,s.indexOf(">"))),s.length%2&&(s+="0"),a.test(s)===!1)return"";for(var o="",h=0;h<s.length;h+=2)o+=String.fromCharCode("0x"+(s[h]+s[h+1]));return o},i=function(s){for(var a=new Uint8Array(s.length),o=s.length;o--;)a[o]=s.charCodeAt(o);return s=(a=Fw(a)).reduce(function(h,f){return h+String.fromCharCode(f)},"")};r.processDataByFilters=function(s,a){var o=0,h=s||"",f=[];for(typeof(a=a||[])=="string"&&(a=[a]),o=0;o<a.length;o+=1)switch(a[o]){case"ASCII85Decode":case"/ASCII85Decode":h=e(h),f.push("/ASCII85Encode");break;case"ASCII85Encode":case"/ASCII85Encode":h=t(h),f.push("/ASCII85Decode");break;case"ASCIIHexDecode":case"/ASCIIHexDecode":h=n(h),f.push("/ASCIIHexEncode");break;case"ASCIIHexEncode":case"/ASCIIHexEncode":h=h.split("").map(function(g){return("0"+g.charCodeAt().toString(16)).slice(-2)}).join("")+">",f.push("/ASCIIHexDecode");break;case"FlateEncode":case"/FlateEncode":h=i(h),f.push("/FlateDecode");break;default:throw new Error('The filter: "'+a[o]+'" is not implemented')}return{data:h,reverseChain:f.reverse().join(" ")}}}(Xr.API),function(r){r.loadFile=function(t,e,n){return function(i,s,a){s=s!==!1,a=typeof a=="function"?a:function(){};var o=void 0;try{o=function(h,f,g){var b=new XMLHttpRequest,C=0,B=function(R){var D=R.length,Q=[],k=String.fromCharCode;for(C=0;C<D;C+=1)Q.push(k(255&R.charCodeAt(C)));return Q.join("")};if(b.open("GET",h,!f),b.overrideMimeType("text/plain; charset=x-user-defined"),f===!1&&(b.onload=function(){b.status===200?g(B(this.responseText)):g(void 0)}),b.send(null),f&&b.status===200)return B(b.responseText)}(i,s,a)}catch{}return o}(t,e,n)},r.loadImageFile=r.loadFile}(Xr.API),function(r){function t(){return(Wr.html2canvas?Promise.resolve(Wr.html2canvas):Promise.resolve().then(()=>Fat)).catch(function(a){return Promise.reject(new Error("Could not load html2canvas: "+a))}).then(function(a){return a.default?a.default:a})}function e(){return(Wr.DOMPurify?Promise.resolve(Wr.DOMPurify):Promise.resolve().then(()=>act)).catch(function(a){return Promise.reject(new Error("Could not load dompurify: "+a))}).then(function(a){return a.default?a.default:a})}var n=function(a){var o=Nn(a);return o==="undefined"?"undefined":o==="string"||a instanceof String?"string":o==="number"||a instanceof Number?"number":o==="function"||a instanceof Function?"function":a&&a.constructor===Array?"array":a&&a.nodeType===1?"element":o==="object"?"object":"unknown"},i=function(a,o){var h=document.createElement(a);for(var f in o.className&&(h.className=o.className),o.innerHTML&&o.dompurify&&(h.innerHTML=o.dompurify.sanitize(o.innerHTML)),o.style)h.style[f]=o.style[f];return h},s=function a(o){var h=Object.assign(a.convert(Promise.resolve()),JSON.parse(JSON.stringify(a.template))),f=a.convert(Promise.resolve(),h);return f=(f=f.setProgress(1,a,1,[a])).set(o)};(s.prototype=Object.create(Promise.prototype)).constructor=s,s.convert=function(a,o){return a.__proto__=o||s.prototype,a},s.template={prop:{src:null,container:null,overlay:null,canvas:null,img:null,pdf:null,pageSize:null,callback:function(){}},progress:{val:0,state:null,n:0,stack:[]},opt:{filename:"file.pdf",margin:[0,0,0,0],enableLinks:!0,x:0,y:0,html2canvas:{},jsPDF:{},backgroundColor:"transparent"}},s.prototype.from=function(a,o){return this.then(function(){switch(o=o||function(h){switch(n(h)){case"string":return"string";case"element":return h.nodeName.toLowerCase()==="canvas"?"canvas":"element";default:return"unknown"}}(a)){case"string":return this.then(e).then(function(h){return this.set({src:i("div",{innerHTML:a,dompurify:h})})});case"element":return this.set({src:a});case"canvas":return this.set({canvas:a});case"img":return this.set({img:a});default:return this.error("Unknown source type.")}})},s.prototype.to=function(a){switch(a){case"container":return this.toContainer();case"canvas":return this.toCanvas();case"img":return this.toImg();case"pdf":return this.toPdf();default:return this.error("Invalid target.")}},s.prototype.toContainer=function(){return this.thenList([function(){return this.prop.src||this.error("Cannot duplicate - no source HTML.")},function(){return this.prop.pageSize||this.setPageSize()}]).then(function(){var a={position:"relative",display:"inline-block",width:(typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?Math.max(this.prop.src.clientWidth,this.prop.src.scrollWidth,this.prop.src.offsetWidth):this.opt.windowWidth)+"px",left:0,right:0,top:0,margin:"auto",backgroundColor:this.opt.backgroundColor},o=function h(f,g){for(var b=f.nodeType===3?document.createTextNode(f.nodeValue):f.cloneNode(!1),C=f.firstChild;C;C=C.nextSibling)g!==!0&&C.nodeType===1&&C.nodeName==="SCRIPT"||b.appendChild(h(C,g));return f.nodeType===1&&(f.nodeName==="CANVAS"?(b.width=f.width,b.height=f.height,b.getContext("2d").drawImage(f,0,0)):f.nodeName!=="TEXTAREA"&&f.nodeName!=="SELECT"||(b.value=f.value),b.addEventListener("load",function(){b.scrollTop=f.scrollTop,b.scrollLeft=f.scrollLeft},!0)),b}(this.prop.src,this.opt.html2canvas.javascriptEnabled);o.tagName==="BODY"&&(a.height=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)+"px"),this.prop.overlay=i("div",{className:"html2pdf__overlay",style:{position:"fixed",overflow:"hidden",zIndex:1e3,left:"-100000px",right:0,bottom:0,top:0}}),this.prop.container=i("div",{className:"html2pdf__container",style:a}),this.prop.container.appendChild(o),this.prop.container.firstChild.appendChild(i("div",{style:{clear:"both",border:"0 none transparent",margin:0,padding:0,height:0}})),this.prop.container.style.float="none",this.prop.overlay.appendChild(this.prop.container),document.body.appendChild(this.prop.overlay),this.prop.container.firstChild.style.position="relative",this.prop.container.height=Math.max(this.prop.container.firstChild.clientHeight,this.prop.container.firstChild.scrollHeight,this.prop.container.firstChild.offsetHeight)+"px"})},s.prototype.toCanvas=function(){var a=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(a).then(t).then(function(o){var h=Object.assign({},this.opt.html2canvas);return delete h.onrendered,o(this.prop.container,h)}).then(function(o){(this.opt.html2canvas.onrendered||function(){})(o),this.prop.canvas=o,document.body.removeChild(this.prop.overlay)})},s.prototype.toContext2d=function(){var a=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(a).then(t).then(function(o){var h=this.opt.jsPDF,f=this.opt.fontFaces,g=typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?1:this.opt.width/this.opt.windowWidth,b=Object.assign({async:!0,allowTaint:!0,scale:g,scrollX:this.opt.scrollX||0,scrollY:this.opt.scrollY||0,backgroundColor:"#ffffff",imageTimeout:15e3,logging:!0,proxy:null,removeContainer:!0,foreignObjectRendering:!1,useCORS:!1},this.opt.html2canvas);if(delete b.onrendered,h.context2d.autoPaging=this.opt.autoPaging===void 0||this.opt.autoPaging,h.context2d.posX=this.opt.x,h.context2d.posY=this.opt.y,h.context2d.margin=this.opt.margin,h.context2d.fontFaces=f,f)for(var C=0;C<f.length;++C){var B=f[C],R=B.src.find(function(D){return D.format==="truetype"});R&&h.addFont(R.url,B.ref.name,B.ref.style)}return b.windowHeight=b.windowHeight||0,b.windowHeight=b.windowHeight==0?Math.max(this.prop.container.clientHeight,this.prop.container.scrollHeight,this.prop.container.offsetHeight):b.windowHeight,h.context2d.save(!0),o(this.prop.container,b)}).then(function(o){this.opt.jsPDF.context2d.restore(!0),(this.opt.html2canvas.onrendered||function(){})(o),this.prop.canvas=o,document.body.removeChild(this.prop.overlay)})},s.prototype.toImg=function(){return this.thenList([function(){return this.prop.canvas||this.toCanvas()}]).then(function(){var a=this.prop.canvas.toDataURL("image/"+this.opt.image.type,this.opt.image.quality);this.prop.img=document.createElement("img"),this.prop.img.src=a})},s.prototype.toPdf=function(){return this.thenList([function(){return this.toContext2d()}]).then(function(){this.prop.pdf=this.prop.pdf||this.opt.jsPDF})},s.prototype.output=function(a,o,h){return(h=h||"pdf").toLowerCase()==="img"||h.toLowerCase()==="image"?this.outputImg(a,o):this.outputPdf(a,o)},s.prototype.outputPdf=function(a,o){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){return this.prop.pdf.output(a,o)})},s.prototype.outputImg=function(a){return this.thenList([function(){return this.prop.img||this.toImg()}]).then(function(){switch(a){case void 0:case"img":return this.prop.img;case"datauristring":case"dataurlstring":return this.prop.img.src;case"datauri":case"dataurl":return document.location.href=this.prop.img.src;default:throw'Image output type "'+a+'" is not supported.'}})},s.prototype.save=function(a){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).set(a?{filename:a}:null).then(function(){this.prop.pdf.save(this.opt.filename)})},s.prototype.doCallback=function(){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){this.prop.callback(this.prop.pdf)})},s.prototype.set=function(a){if(n(a)!=="object")return this;var o=Object.keys(a||{}).map(function(h){if(h in s.template.prop)return function(){this.prop[h]=a[h]};switch(h){case"margin":return this.setMargin.bind(this,a.margin);case"jsPDF":return function(){return this.opt.jsPDF=a.jsPDF,this.setPageSize()};case"pageSize":return this.setPageSize.bind(this,a.pageSize);default:return function(){this.opt[h]=a[h]}}},this);return this.then(function(){return this.thenList(o)})},s.prototype.get=function(a,o){return this.then(function(){var h=a in s.template.prop?this.prop[a]:this.opt[a];return o?o(h):h})},s.prototype.setMargin=function(a){return this.then(function(){switch(n(a)){case"number":a=[a,a,a,a];case"array":if(a.length===2&&(a=[a[0],a[1],a[0],a[1]]),a.length===4)break;default:return this.error("Invalid margin array.")}this.opt.margin=a}).then(this.setPageSize)},s.prototype.setPageSize=function(a){function o(h,f){return Math.floor(h*f/72*96)}return this.then(function(){(a=a||Xr.getPageSize(this.opt.jsPDF)).hasOwnProperty("inner")||(a.inner={width:a.width-this.opt.margin[1]-this.opt.margin[3],height:a.height-this.opt.margin[0]-this.opt.margin[2]},a.inner.px={width:o(a.inner.width,a.k),height:o(a.inner.height,a.k)},a.inner.ratio=a.inner.height/a.inner.width),this.prop.pageSize=a})},s.prototype.setProgress=function(a,o,h,f){return a!=null&&(this.progress.val=a),o!=null&&(this.progress.state=o),h!=null&&(this.progress.n=h),f!=null&&(this.progress.stack=f),this.progress.ratio=this.progress.val/this.progress.state,this},s.prototype.updateProgress=function(a,o,h,f){return this.setProgress(a?this.progress.val+a:null,o||null,h?this.progress.n+h:null,f?this.progress.stack.concat(f):null)},s.prototype.then=function(a,o){var h=this;return this.thenCore(a,o,function(f,g){return h.updateProgress(null,null,1,[f]),Promise.prototype.then.call(this,function(b){return h.updateProgress(null,f),b}).then(f,g).then(function(b){return h.updateProgress(1),b})})},s.prototype.thenCore=function(a,o,h){h=h||Promise.prototype.then,a&&(a=a.bind(this)),o&&(o=o.bind(this));var f=Promise.toString().indexOf("[native code]")!==-1&&Promise.name==="Promise"?this:s.convert(Object.assign({},this),Promise.prototype),g=h.call(f,a,o);return s.convert(g,this.__proto__)},s.prototype.thenExternal=function(a,o){return Promise.prototype.then.call(this,a,o)},s.prototype.thenList=function(a){var o=this;return a.forEach(function(h){o=o.thenCore(h)}),o},s.prototype.catch=function(a){a&&(a=a.bind(this));var o=Promise.prototype.catch.call(this,a);return s.convert(o,this)},s.prototype.catchExternal=function(a){return Promise.prototype.catch.call(this,a)},s.prototype.error=function(a){return this.then(function(){throw new Error(a)})},s.prototype.using=s.prototype.set,s.prototype.saveAs=s.prototype.save,s.prototype.export=s.prototype.output,s.prototype.run=s.prototype.then,Xr.getPageSize=function(a,o,h){if(Nn(a)==="object"){var f=a;a=f.orientation,o=f.unit||o,h=f.format||h}o=o||"mm",h=h||"a4",a=(""+(a||"P")).toLowerCase();var g,b=(""+h).toLowerCase(),C={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};switch(o){case"pt":g=1;break;case"mm":g=72/25.4;break;case"cm":g=72/2.54;break;case"in":g=72;break;case"px":g=.75;break;case"pc":case"em":g=12;break;case"ex":g=6;break;default:throw"Invalid unit: "+o}var B,R=0,D=0;if(C.hasOwnProperty(b))R=C[b][1]/g,D=C[b][0]/g;else try{R=h[1],D=h[0]}catch{throw new Error("Invalid format: "+h)}if(a==="p"||a==="portrait")a="p",D>R&&(B=D,D=R,R=B);else{if(a!=="l"&&a!=="landscape")throw"Invalid orientation: "+a;a="l",R>D&&(B=D,D=R,R=B)}return{width:D,height:R,unit:o,k:g,orientation:a}},r.html=function(a,o){(o=o||{}).callback=o.callback||function(){},o.html2canvas=o.html2canvas||{},o.html2canvas.canvas=o.html2canvas.canvas||this.canvas,o.jsPDF=o.jsPDF||this,o.fontFaces=o.fontFaces?o.fontFaces.map(Hw):null;var h=new s(o);return o.worker?h:h.from(a).doCallback()}}(Xr.API),Xr.API.addJS=function(r){return cF=r,this.internal.events.subscribe("postPutResources",function(){Y0=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/Names [(EmbeddedJS) "+(Y0+1)+" 0 R]"),this.internal.out(">>"),this.internal.out("endobj"),aF=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /JavaScript"),this.internal.out("/JS ("+cF+")"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){Y0!==void 0&&aF!==void 0&&this.internal.out("/Names <</JavaScript "+Y0+" 0 R>>")}),this},function(r){var t;r.events.push(["postPutResources",function(){var e=this,n=/^(\d+) 0 obj$/;if(this.outline.root.children.length>0)for(var i=e.outline.render().split(/\r\n/),s=0;s<i.length;s++){var a=i[s],o=n.exec(a);if(o!=null){var h=o[1];e.internal.newObjectDeferredBegin(h,!1)}e.internal.write(a)}if(this.outline.createNamedDestinations){var f=this.internal.pages.length,g=[];for(s=0;s<f;s++){var b=e.internal.newObject();g.push(b);var C=e.internal.getPageInfo(s+1);e.internal.write("<< /D["+C.objId+" 0 R /XYZ null null null]>> endobj")}var B=e.internal.newObject();for(e.internal.write("<< /Names [ "),s=0;s<g.length;s++)e.internal.write("(page_"+(s+1)+")"+g[s]+" 0 R");e.internal.write(" ] >>","endobj"),t=e.internal.newObject(),e.internal.write("<< /Dests "+B+" 0 R"),e.internal.write(">>","endobj")}}]),r.events.push(["putCatalog",function(){this.outline.root.children.length>0&&(this.internal.write("/Outlines",this.outline.makeRef(this.outline.root)),this.outline.createNamedDestinations&&this.internal.write("/Names "+t+" 0 R"))}]),r.events.push(["initialized",function(){var e=this;e.outline={createNamedDestinations:!1,root:{children:[]}},e.outline.add=function(n,i,s){var a={title:i,options:s,children:[]};return n==null&&(n=this.root),n.children.push(a),a},e.outline.render=function(){return this.ctx={},this.ctx.val="",this.ctx.pdf=e,this.genIds_r(this.root),this.renderRoot(this.root),this.renderItems(this.root),this.ctx.val},e.outline.genIds_r=function(n){n.id=e.internal.newObjectDeferred();for(var i=0;i<n.children.length;i++)this.genIds_r(n.children[i])},e.outline.renderRoot=function(n){this.objStart(n),this.line("/Type /Outlines"),n.children.length>0&&(this.line("/First "+this.makeRef(n.children[0])),this.line("/Last "+this.makeRef(n.children[n.children.length-1]))),this.line("/Count "+this.count_r({count:0},n)),this.objEnd()},e.outline.renderItems=function(n){for(var i=this.ctx.pdf.internal.getVerticalCoordinateString,s=0;s<n.children.length;s++){var a=n.children[s];this.objStart(a),this.line("/Title "+this.makeString(a.title)),this.line("/Parent "+this.makeRef(n)),s>0&&this.line("/Prev "+this.makeRef(n.children[s-1])),s<n.children.length-1&&this.line("/Next "+this.makeRef(n.children[s+1])),a.children.length>0&&(this.line("/First "+this.makeRef(a.children[0])),this.line("/Last "+this.makeRef(a.children[a.children.length-1])));var o=this.count=this.count_r({count:0},a);if(o>0&&this.line("/Count "+o),a.options&&a.options.pageNumber){var h=e.internal.getPageInfo(a.options.pageNumber);this.line("/Dest ["+h.objId+" 0 R /XYZ 0 "+i(0)+" 0]")}this.objEnd()}for(var f=0;f<n.children.length;f++)this.renderItems(n.children[f])},e.outline.line=function(n){this.ctx.val+=n+`\r
`},e.outline.makeRef=function(n){return n.id+" 0 R"},e.outline.makeString=function(n){return"("+e.internal.pdfEscape(n)+")"},e.outline.objStart=function(n){this.ctx.val+=`\r
`+n.id+` 0 obj\r
<<\r
`},e.outline.objEnd=function(){this.ctx.val+=`>> \r
endobj\r
`},e.outline.count_r=function(n,i){for(var s=0;s<i.children.length;s++)n.count++,this.count_r(n,i.children[s]);return n.count}}])}(Xr.API),function(r){var t=[192,193,194,195,196,197,198,199];r.processJPEG=function(e,n,i,s,a,o){var h,f=this.decode.DCT_DECODE,g=null;if(typeof e=="string"||this.__addimage__.isArrayBuffer(e)||this.__addimage__.isArrayBufferView(e)){switch(e=a||e,e=this.__addimage__.isArrayBuffer(e)?new Uint8Array(e):e,(h=function(b){for(var C,B=256*b.charCodeAt(4)+b.charCodeAt(5),R=b.length,D={width:0,height:0,numcomponents:1},Q=4;Q<R;Q+=2){if(Q+=B,t.indexOf(b.charCodeAt(Q+1))!==-1){C=256*b.charCodeAt(Q+5)+b.charCodeAt(Q+6),D={width:256*b.charCodeAt(Q+7)+b.charCodeAt(Q+8),height:C,numcomponents:b.charCodeAt(Q+9)};break}B=256*b.charCodeAt(Q+2)+b.charCodeAt(Q+3)}return D}(e=this.__addimage__.isArrayBufferView(e)?this.__addimage__.arrayBufferToBinaryString(e):e)).numcomponents){case 1:o=this.color_spaces.DEVICE_GRAY;break;case 4:o=this.color_spaces.DEVICE_CMYK;break;case 3:o=this.color_spaces.DEVICE_RGB}g={data:e,width:h.width,height:h.height,colorSpace:o,bitsPerComponent:8,filter:f,index:n,alias:i}}return g}}(Xr.API);var cf,Z0,AF,uF,hF,Ftt=function(){var r,t,e;function n(s){var a,o,h,f,g,b,C,B,R,D,Q,k,j,et;for(this.data=s,this.pos=8,this.palette=[],this.imgData=[],this.transparency={},this.animation=null,this.text={},b=null;;){switch(a=this.readUInt32(),R=(function(){var st,mt;for(mt=[],st=0;st<4;++st)mt.push(String.fromCharCode(this.data[this.pos++]));return mt}).call(this).join("")){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(a);break;case"fcTL":b&&this.animation.frames.push(b),this.pos+=4,b={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()},g=this.readUInt16(),f=this.readUInt16()||100,b.delay=1e3*g/f,b.disposeOp=this.data[this.pos++],b.blendOp=this.data[this.pos++],b.data=[];break;case"IDAT":case"fdAT":for(R==="fdAT"&&(this.pos+=4,a-=4),s=(b!=null?b.data:void 0)||this.imgData,k=0;0<=a?k<a:k>a;0<=a?++k:--k)s.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:if(h=this.palette.length/3,this.transparency.indexed=this.read(a),this.transparency.indexed.length>h)throw new Error("More transparent colors than palette size");if((D=h-this.transparency.indexed.length)>0)for(j=0;0<=D?j<D:j>D;0<=D?++j:--j)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(a)[0];break;case 2:this.transparency.rgb=this.read(a)}break;case"tEXt":C=(Q=this.read(a)).indexOf(0),B=String.fromCharCode.apply(String,Q.slice(0,C)),this.text[B]=String.fromCharCode.apply(String,Q.slice(C+1));break;case"IEND":return b&&this.animation.frames.push(b),this.colors=(function(){switch(this.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}).call(this),this.hasAlphaChannel=(et=this.colorType)===4||et===6,o=this.colors+(this.hasAlphaChannel?1:0),this.pixelBitlength=this.bits*o,this.colorSpace=(function(){switch(this.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}).call(this),void(this.imgData=new Uint8Array(this.imgData));default:this.pos+=a}if(this.pos+=4,this.pos>this.data.length)throw new Error("Incomplete or corrupt PNG file")}}n.prototype.read=function(s){var a,o;for(o=[],a=0;0<=s?a<s:a>s;0<=s?++a:--a)o.push(this.data[this.pos++]);return o},n.prototype.readUInt32=function(){return this.data[this.pos++]<<24|this.data[this.pos++]<<16|this.data[this.pos++]<<8|this.data[this.pos++]},n.prototype.readUInt16=function(){return this.data[this.pos++]<<8|this.data[this.pos++]},n.prototype.decodePixels=function(s){var a=this.pixelBitlength/8,o=new Uint8Array(this.width*this.height*a),h=0,f=this;if(s==null&&(s=this.imgData),s.length===0)return new Uint8Array(0);function g(b,C,B,R){var D,Q,k,j,et,st,mt,pt,yt,ft,Dt,It,ut,At,Bt,vt,ne,ie,ae,te,ce,le=Math.ceil((f.width-b)/B),Te=Math.ceil((f.height-C)/R),rt=f.width==le&&f.height==Te;for(At=a*le,It=rt?o:new Uint8Array(At*Te),st=s.length,ut=0,Q=0;ut<Te&&h<st;){switch(s[h++]){case 0:for(j=ne=0;ne<At;j=ne+=1)It[Q++]=s[h++];break;case 1:for(j=ie=0;ie<At;j=ie+=1)D=s[h++],et=j<a?0:It[Q-a],It[Q++]=(D+et)%256;break;case 2:for(j=ae=0;ae<At;j=ae+=1)D=s[h++],k=(j-j%a)/a,Bt=ut&&It[(ut-1)*At+k*a+j%a],It[Q++]=(Bt+D)%256;break;case 3:for(j=te=0;te<At;j=te+=1)D=s[h++],k=(j-j%a)/a,et=j<a?0:It[Q-a],Bt=ut&&It[(ut-1)*At+k*a+j%a],It[Q++]=(D+Math.floor((et+Bt)/2))%256;break;case 4:for(j=ce=0;ce<At;j=ce+=1)D=s[h++],k=(j-j%a)/a,et=j<a?0:It[Q-a],ut===0?Bt=vt=0:(Bt=It[(ut-1)*At+k*a+j%a],vt=k&&It[(ut-1)*At+(k-1)*a+j%a]),mt=et+Bt-vt,pt=Math.abs(mt-et),ft=Math.abs(mt-Bt),Dt=Math.abs(mt-vt),yt=pt<=ft&&pt<=Dt?et:ft<=Dt?Bt:vt,It[Q++]=(D+yt)%256;break;default:throw new Error("Invalid filter algorithm: "+s[h-1])}if(!rt){var wt=((C+ut*R)*f.width+b)*a,St=ut*At;for(j=0;j<le;j+=1){for(var qt=0;qt<a;qt+=1)o[wt++]=It[St++];wt+=(B-1)*a}}ut++}}return s=utt(s),f.interlaceMethod==1?(g(0,0,8,8),g(4,0,8,8),g(0,4,4,8),g(2,0,4,4),g(0,2,2,4),g(1,0,2,2),g(0,1,1,2)):g(0,0,1,1),o},n.prototype.decodePalette=function(){var s,a,o,h,f,g,b,C,B;for(o=this.palette,g=this.transparency.indexed||[],f=new Uint8Array((g.length||0)+o.length),h=0,s=0,a=b=0,C=o.length;b<C;a=b+=3)f[h++]=o[a],f[h++]=o[a+1],f[h++]=o[a+2],f[h++]=(B=g[s++])!=null?B:255;return f},n.prototype.copyToImageData=function(s,a){var o,h,f,g,b,C,B,R,D,Q,k;if(h=this.colors,D=null,o=this.hasAlphaChannel,this.palette.length&&(D=(k=this._decodedPalette)!=null?k:this._decodedPalette=this.decodePalette(),h=4,o=!0),R=(f=s.data||s).length,b=D||a,g=C=0,h===1)for(;g<R;)B=D?4*a[g/4]:C,Q=b[B++],f[g++]=Q,f[g++]=Q,f[g++]=Q,f[g++]=o?b[B++]:255,C=B;else for(;g<R;)B=D?4*a[g/4]:C,f[g++]=b[B++],f[g++]=b[B++],f[g++]=b[B++],f[g++]=o?b[B++]:255,C=B},n.prototype.decode=function(){var s;return s=new Uint8Array(this.width*this.height*4),this.copyToImageData(s,this.decodePixels()),s};var i=function(){if(Object.prototype.toString.call(Wr)==="[object Window]"){try{t=Wr.document.createElement("canvas"),e=t.getContext("2d")}catch{return!1}return!0}return!1};return i(),r=function(s){var a;if(i()===!0)return e.width=s.width,e.height=s.height,e.clearRect(0,0,s.width,s.height),e.putImageData(s,0,0),(a=new Image).src=t.toDataURL(),a;throw new Error("This method requires a Browser with Canvas-capability.")},n.prototype.decodeFrames=function(s){var a,o,h,f,g,b,C,B;if(this.animation){for(B=[],o=g=0,b=(C=this.animation.frames).length;g<b;o=++g)a=C[o],h=s.createImageData(a.width,a.height),f=this.decodePixels(new Uint8Array(a.data)),this.copyToImageData(h,f),a.imageData=h,B.push(a.image=r(h));return B}},n.prototype.renderFrame=function(s,a){var o,h,f;return o=(h=this.animation.frames)[a],f=h[a-1],a===0&&s.clearRect(0,0,this.width,this.height),(f!=null?f.disposeOp:void 0)===1?s.clearRect(f.xOffset,f.yOffset,f.width,f.height):(f!=null?f.disposeOp:void 0)===2&&s.putImageData(f.imageData,f.xOffset,f.yOffset),o.blendOp===0&&s.clearRect(o.xOffset,o.yOffset,o.width,o.height),s.drawImage(o.image,o.xOffset,o.yOffset)},n.prototype.animate=function(s){var a,o,h,f,g,b,C=this;return o=0,b=this.animation,f=b.numFrames,h=b.frames,g=b.numPlays,(a=function(){var B,R;if(B=o++%f,R=h[B],C.renderFrame(s,B),f>1&&o/f<g)return C.animation._timeout=setTimeout(a,R.delay)})()},n.prototype.stopAnimation=function(){var s;return clearTimeout((s=this.animation)!=null?s._timeout:void 0)},n.prototype.render=function(s){var a,o;return s._png&&s._png.stopAnimation(),s._png=this,s.width=this.width,s.height=this.height,a=s.getContext("2d"),this.animation?(this.decodeFrames(a),this.animate(a)):(o=a.createImageData(this.width,this.height),this.copyToImageData(o,this.decodePixels()),a.putImageData(o,0,0))},n}();/**
* @license
*
* Copyright (c) 2014 James Robb, https://github.com/jamesbrobb
*
* Permission is hereby granted, free of charge, to any person obtaining
* a copy of this software and associated documentation files (the
* "Software"), to deal in the Software without restriction, including
* without limitation the rights to use, copy, modify, merge, publish,
* distribute, sublicense, and/or sell copies of the Software, and to
* permit persons to whom the Software is furnished to do so, subject to
* the following conditions:
*
* The above copyright notice and this permission notice shall be
* included in all copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
* MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
* LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
* OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
* WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
* ====================================================================
*//**
* @license
* (c) Dean McNamee <dean@gmail.com>, 2013.
*
* https://github.com/deanm/omggif
*
* Permission is hereby granted, free of charge, to any person obtaining a copy
* of this software and associated documentation files (the "Software"), to
* deal in the Software without restriction, including without limitation the
* rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
* sell copies of the Software, and to permit persons to whom the Software is
* furnished to do so, subject to the following conditions:
*
* The above copyright notice and this permission notice shall be included in
* all copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
* FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
* AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
* LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
* FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
* IN THE SOFTWARE.
*
* omggif is a JavaScript implementation of a GIF 89a encoder and decoder,
* including animation and compression.  It does not rely on any specific
* underlying system, so should run in the browser, Node, or Plask.
*/function Mtt(r){var t=0;if(r[t++]!==71||r[t++]!==73||r[t++]!==70||r[t++]!==56||(r[t++]+1&253)!=56||r[t++]!==97)throw new Error("Invalid GIF 87a/89a header.");var e=r[t++]|r[t++]<<8,n=r[t++]|r[t++]<<8,i=r[t++],s=i>>7,a=1<<(7&i)+1;r[t++],r[t++];var o=null,h=null;s&&(o=t,h=a,t+=3*a);var f=!0,g=[],b=0,C=null,B=0,R=null;for(this.width=e,this.height=n;f&&t<r.length;)switch(r[t++]){case 33:switch(r[t++]){case 255:if(r[t]!==11||r[t+1]==78&&r[t+2]==69&&r[t+3]==84&&r[t+4]==83&&r[t+5]==67&&r[t+6]==65&&r[t+7]==80&&r[t+8]==69&&r[t+9]==50&&r[t+10]==46&&r[t+11]==48&&r[t+12]==3&&r[t+13]==1&&r[t+16]==0)t+=14,R=r[t++]|r[t++]<<8,t++;else for(t+=12;;){if(!((ut=r[t++])>=0))throw Error("Invalid block size");if(ut===0)break;t+=ut}break;case 249:if(r[t++]!==4||r[t+4]!==0)throw new Error("Invalid graphics extension block.");var D=r[t++];b=r[t++]|r[t++]<<8,C=r[t++],!(1&D)&&(C=null),B=D>>2&7,t++;break;case 254:for(;;){if(!((ut=r[t++])>=0))throw Error("Invalid block size");if(ut===0)break;t+=ut}break;default:throw new Error("Unknown graphic control label: 0x"+r[t-1].toString(16))}break;case 44:var Q=r[t++]|r[t++]<<8,k=r[t++]|r[t++]<<8,j=r[t++]|r[t++]<<8,et=r[t++]|r[t++]<<8,st=r[t++],mt=st>>6&1,pt=1<<(7&st)+1,yt=o,ft=h,Dt=!1;st>>7&&(Dt=!0,yt=t,ft=pt,t+=3*pt);var It=t;for(t++;;){var ut;if(!((ut=r[t++])>=0))throw Error("Invalid block size");if(ut===0)break;t+=ut}g.push({x:Q,y:k,width:j,height:et,has_local_palette:Dt,palette_offset:yt,palette_size:ft,data_offset:It,data_length:t-It,transparent_index:C,interlaced:!!mt,delay:b,disposal:B});break;case 59:f=!1;break;default:throw new Error("Unknown gif block: 0x"+r[t-1].toString(16))}this.numFrames=function(){return g.length},this.loopCount=function(){return R},this.frameInfo=function(At){if(At<0||At>=g.length)throw new Error("Frame index out of range.");return g[At]},this.decodeAndBlitFrameBGRA=function(At,Bt){var vt=this.frameInfo(At),ne=vt.width*vt.height,ie=new Uint8Array(ne);dF(r,vt.data_offset,ie,ne);var ae=vt.palette_offset,te=vt.transparent_index;te===null&&(te=256);var ce=vt.width,le=e-ce,Te=ce,rt=4*(vt.y*e+vt.x),wt=4*((vt.y+vt.height)*e+vt.x),St=rt,qt=4*le;vt.interlaced===!0&&(qt+=4*e*7);for(var Jt=8,se=0,Ae=ie.length;se<Ae;++se){var oe=ie[se];if(Te===0&&(Te=ce,(St+=qt)>=wt&&(qt=4*le+4*e*(Jt-1),St=rt+(ce+le)*(Jt<<1),Jt>>=1)),oe===te)St+=4;else{var Ce=r[ae+3*oe],Pe=r[ae+3*oe+1],Ve=r[ae+3*oe+2];Bt[St++]=Ve,Bt[St++]=Pe,Bt[St++]=Ce,Bt[St++]=255}--Te}},this.decodeAndBlitFrameRGBA=function(At,Bt){var vt=this.frameInfo(At),ne=vt.width*vt.height,ie=new Uint8Array(ne);dF(r,vt.data_offset,ie,ne);var ae=vt.palette_offset,te=vt.transparent_index;te===null&&(te=256);var ce=vt.width,le=e-ce,Te=ce,rt=4*(vt.y*e+vt.x),wt=4*((vt.y+vt.height)*e+vt.x),St=rt,qt=4*le;vt.interlaced===!0&&(qt+=4*e*7);for(var Jt=8,se=0,Ae=ie.length;se<Ae;++se){var oe=ie[se];if(Te===0&&(Te=ce,(St+=qt)>=wt&&(qt=4*le+4*e*(Jt-1),St=rt+(ce+le)*(Jt<<1),Jt>>=1)),oe===te)St+=4;else{var Ce=r[ae+3*oe],Pe=r[ae+3*oe+1],Ve=r[ae+3*oe+2];Bt[St++]=Ce,Bt[St++]=Pe,Bt[St++]=Ve,Bt[St++]=255}--Te}}}function dF(r,t,e,n){for(var i=r[t++],s=1<<i,a=s+1,o=a+1,h=i+1,f=(1<<h)-1,g=0,b=0,C=0,B=r[t++],R=new Int32Array(4096),D=null;;){for(;g<16&&B!==0;)b|=r[t++]<<g,g+=8,B===1?B=r[t++]:--B;if(g<h)break;var Q=b&f;if(b>>=h,g-=h,Q!==s){if(Q===a)break;for(var k=Q<o?Q:D,j=0,et=k;et>s;)et=R[et]>>8,++j;var st=et;if(C+j+(k!==Q?1:0)>n)return void ui.log("Warning, gif stream longer than expected.");e[C++]=st;var mt=C+=j;for(k!==Q&&(e[C++]=st),et=k;j--;)et=R[et],e[--mt]=255&et,et>>=8;D!==null&&o<4096&&(R[o++]=D<<8|st,o>=f+1&&h<12&&(++h,f=f<<1|1)),D=Q}else o=a+1,f=(1<<(h=i+1))-1,D=null}return C!==n&&ui.log("Warning, gif stream shorter than expected."),e}/**
	 * @license
	  Copyright (c) 2008, Adobe Systems Incorporated
	  All rights reserved.

	  Redistribution and use in source and binary forms, with or without 
	  modification, are permitted provided that the following conditions are
	  met:

	  * Redistributions of source code must retain the above copyright notice, 
	    this list of conditions and the following disclaimer.
	  
	  * Redistributions in binary form must reproduce the above copyright
	    notice, this list of conditions and the following disclaimer in the 
	    documentation and/or other materials provided with the distribution.
	  
	  * Neither the name of Adobe Systems Incorporated nor the names of its 
	    contributors may be used to endorse or promote products derived from 
	    this software without specific prior written permission.

	  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS
	  IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
	  THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
	  PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR 
	  CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
	  EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
	  PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
	  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
	  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
	  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
	  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
	*/function Gw(r){var t,e,n,i,s,a=Math.floor,o=new Array(64),h=new Array(64),f=new Array(64),g=new Array(64),b=new Array(65535),C=new Array(65535),B=new Array(64),R=new Array(64),D=[],Q=0,k=7,j=new Array(64),et=new Array(64),st=new Array(64),mt=new Array(256),pt=new Array(2048),yt=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],ft=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],Dt=[0,1,2,3,4,5,6,7,8,9,10,11],It=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],ut=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],At=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],Bt=[0,1,2,3,4,5,6,7,8,9,10,11],vt=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],ne=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function ie(rt,wt){for(var St=0,qt=0,Jt=new Array,se=1;se<=16;se++){for(var Ae=1;Ae<=rt[se];Ae++)Jt[wt[qt]]=[],Jt[wt[qt]][0]=St,Jt[wt[qt]][1]=se,qt++,St++;St*=2}return Jt}function ae(rt){for(var wt=rt[0],St=rt[1]-1;St>=0;)wt&1<<St&&(Q|=1<<k),St--,--k<0&&(Q==255?(te(255),te(0)):te(Q),k=7,Q=0)}function te(rt){D.push(rt)}function ce(rt){te(rt>>8&255),te(255&rt)}function le(rt,wt,St,qt,Jt){for(var se,Ae=Jt[0],oe=Jt[240],Ce=function(Se,Kt){var Ie,ke,He,De,xr,Pr,Or,nn,Br,Ur,je=0;for(Br=0;Br<8;++Br){Ie=Se[je],ke=Se[je+1],He=Se[je+2],De=Se[je+3],xr=Se[je+4],Pr=Se[je+5],Or=Se[je+6];var Ee=Ie+(nn=Se[je+7]),Nr=Ie-nn,Vr=ke+Or,qr=ke-Or,rn=He+Pr,Fe=He-Pr,Ze=De+xr,ur=De-xr,Jr=Ee+Ze,Un=Ee-Ze,qe=Vr+rn,sn=Vr-rn;Se[je]=Jr+qe,Se[je+4]=Jr-qe;var _t=.707106781*(sn+Un);Se[je+2]=Un+_t,Se[je+6]=Un-_t;var tt=.382683433*((Jr=ur+Fe)-(sn=qr+Nr)),at=.5411961*Jr+tt,gt=1.306562965*sn+tt,Tt=.707106781*(qe=Fe+qr),Ft=Nr+Tt,Ht=Nr-Tt;Se[je+5]=Ht+at,Se[je+3]=Ht-at,Se[je+1]=Ft+gt,Se[je+7]=Ft-gt,je+=8}for(je=0,Br=0;Br<8;++Br){Ie=Se[je],ke=Se[je+8],He=Se[je+16],De=Se[je+24],xr=Se[je+32],Pr=Se[je+40],Or=Se[je+48];var Vt=Ie+(nn=Se[je+56]),Qt=Ie-nn,$t=ke+Or,fe=ke-Or,ye=He+Pr,we=He-Pr,hr=De+xr,dr=De-xr,Je=Vt+hr,or=Vt-hr,_r=$t+ye,Rr=$t-ye;Se[je]=Je+_r,Se[je+32]=Je-_r;var jr=.707106781*(Rr+or);Se[je+16]=or+jr,Se[je+48]=or-jr;var Fr=.382683433*((Je=dr+we)-(Rr=fe+Qt)),Rt=.5411961*Je+Fr,Qe=1.306562965*Rr+Fr,Be=.707106781*(_r=we+fe),Er=Qt+Be,Kr=Qt-Be;Se[je+40]=Kr+Rt,Se[je+24]=Kr-Rt,Se[je+8]=Er+Qe,Se[je+56]=Er-Qe,je++}for(Br=0;Br<64;++Br)Ur=Se[Br]*Kt[Br],B[Br]=Ur>0?Ur+.5|0:Ur-.5|0;return B}(rt,wt),Pe=0;Pe<64;++Pe)R[yt[Pe]]=Ce[Pe];var Ve=R[0]-St;St=R[0],Ve==0?ae(qt[0]):(ae(qt[C[se=32767+Ve]]),ae(b[se]));for(var Ke=63;Ke>0&&R[Ke]==0;)Ke--;if(Ke==0)return ae(Ae),St;for(var rr,_e=1;_e<=Ke;){for(var Ut=_e;R[_e]==0&&_e<=Ke;)++_e;var pr=_e-Ut;if(pr>=16){rr=pr>>4;for(var ir=1;ir<=rr;++ir)ae(oe);pr&=15}se=32767+R[_e],ae(Jt[(pr<<4)+C[se]]),ae(b[se]),_e++}return Ke!=63&&ae(Ae),St}function Te(rt){rt=Math.min(Math.max(rt,1),100),s!=rt&&(function(wt){for(var St=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],qt=0;qt<64;qt++){var Jt=a((St[qt]*wt+50)/100);Jt=Math.min(Math.max(Jt,1),255),o[yt[qt]]=Jt}for(var se=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],Ae=0;Ae<64;Ae++){var oe=a((se[Ae]*wt+50)/100);oe=Math.min(Math.max(oe,1),255),h[yt[Ae]]=oe}for(var Ce=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],Pe=0,Ve=0;Ve<8;Ve++)for(var Ke=0;Ke<8;Ke++)f[Pe]=1/(o[yt[Pe]]*Ce[Ve]*Ce[Ke]*8),g[Pe]=1/(h[yt[Pe]]*Ce[Ve]*Ce[Ke]*8),Pe++}(rt<50?Math.floor(5e3/rt):Math.floor(200-2*rt)),s=rt)}this.encode=function(rt,wt){wt&&Te(wt),D=new Array,Q=0,k=7,ce(65496),ce(65504),ce(16),te(74),te(70),te(73),te(70),te(0),te(1),te(1),te(0),ce(1),ce(1),te(0),te(0),function(){ce(65499),ce(132),te(0);for(var ke=0;ke<64;ke++)te(o[ke]);te(1);for(var He=0;He<64;He++)te(h[He])}(),function(ke,He){ce(65472),ce(17),te(8),ce(He),ce(ke),te(3),te(1),te(17),te(0),te(2),te(17),te(1),te(3),te(17),te(1)}(rt.width,rt.height),function(){ce(65476),ce(418),te(0);for(var ke=0;ke<16;ke++)te(ft[ke+1]);for(var He=0;He<=11;He++)te(Dt[He]);te(16);for(var De=0;De<16;De++)te(It[De+1]);for(var xr=0;xr<=161;xr++)te(ut[xr]);te(1);for(var Pr=0;Pr<16;Pr++)te(At[Pr+1]);for(var Or=0;Or<=11;Or++)te(Bt[Or]);te(17);for(var nn=0;nn<16;nn++)te(vt[nn+1]);for(var Br=0;Br<=161;Br++)te(ne[Br])}(),ce(65498),ce(12),te(3),te(1),te(0),te(2),te(17),te(3),te(17),te(0),te(63),te(0);var St=0,qt=0,Jt=0;Q=0,k=7,this.encode.displayName="_encode_";for(var se,Ae,oe,Ce,Pe,Ve,Ke,rr,_e,Ut=rt.data,pr=rt.width,ir=rt.height,Se=4*pr,Kt=0;Kt<ir;){for(se=0;se<Se;){for(Pe=Se*Kt+se,Ke=-1,rr=0,_e=0;_e<64;_e++)Ve=Pe+(rr=_e>>3)*Se+(Ke=4*(7&_e)),Kt+rr>=ir&&(Ve-=Se*(Kt+1+rr-ir)),se+Ke>=Se&&(Ve-=se+Ke-Se+4),Ae=Ut[Ve++],oe=Ut[Ve++],Ce=Ut[Ve++],j[_e]=(pt[Ae]+pt[oe+256>>0]+pt[Ce+512>>0]>>16)-128,et[_e]=(pt[Ae+768>>0]+pt[oe+1024>>0]+pt[Ce+1280>>0]>>16)-128,st[_e]=(pt[Ae+1280>>0]+pt[oe+1536>>0]+pt[Ce+1792>>0]>>16)-128;St=le(j,f,St,t,n),qt=le(et,g,qt,e,i),Jt=le(st,g,Jt,e,i),se+=32}Kt+=8}if(k>=0){var Ie=[];Ie[1]=k+1,Ie[0]=(1<<k+1)-1,ae(Ie)}return ce(65497),new Uint8Array(D)},r=r||50,function(){for(var rt=String.fromCharCode,wt=0;wt<256;wt++)mt[wt]=rt(wt)}(),t=ie(ft,Dt),e=ie(At,Bt),n=ie(It,ut),i=ie(vt,ne),function(){for(var rt=1,wt=2,St=1;St<=15;St++){for(var qt=rt;qt<wt;qt++)C[32767+qt]=St,b[32767+qt]=[],b[32767+qt][1]=St,b[32767+qt][0]=qt;for(var Jt=-(wt-1);Jt<=-rt;Jt++)C[32767+Jt]=St,b[32767+Jt]=[],b[32767+Jt][1]=St,b[32767+Jt][0]=wt-1+Jt;rt<<=1,wt<<=1}}(),function(){for(var rt=0;rt<256;rt++)pt[rt]=19595*rt,pt[rt+256>>0]=38470*rt,pt[rt+512>>0]=7471*rt+32768,pt[rt+768>>0]=-11059*rt,pt[rt+1024>>0]=-21709*rt,pt[rt+1280>>0]=32768*rt+8421375,pt[rt+1536>>0]=-27439*rt,pt[rt+1792>>0]=-5329*rt}(),Te(r)}/**
* @license
* Copyright (c) 2017 Aras Abbasi
*
* Licensed under the MIT License.
* http://opensource.org/licenses/mit-license
*/function Qc(r,t){if(this.pos=0,this.buffer=r,this.datav=new DataView(r.buffer),this.is_with_alpha=!!t,this.bottom_up=!0,this.flag=String.fromCharCode(this.buffer[0])+String.fromCharCode(this.buffer[1]),this.pos+=2,["BM","BA","CI","CP","IC","PT"].indexOf(this.flag)===-1)throw new Error("Invalid BMP File");this.parseHeader(),this.parseBGR()}function fF(r){function t(ft){if(!ft)throw Error("assert :P")}function e(ft,Dt,It){for(var ut=0;4>ut;ut++)if(ft[Dt+ut]!=It.charCodeAt(ut))return!0;return!1}function n(ft,Dt,It,ut,At){for(var Bt=0;Bt<At;Bt++)ft[Dt+Bt]=It[ut+Bt]}function i(ft,Dt,It,ut){for(var At=0;At<ut;At++)ft[Dt+At]=It}function s(ft){return new Int32Array(ft)}function a(ft,Dt){for(var It=[],ut=0;ut<ft;ut++)It.push(new Dt);return It}function o(ft,Dt){var It=[];return function ut(At,Bt,vt){for(var ne=vt[Bt],ie=0;ie<ne&&(At.push(vt.length>Bt+1?[]:new Dt),!(vt.length<Bt+1));ie++)ut(At[ie],Bt+1,vt)}(It,0,ft),It}var h=function(){var ft=this;function Dt(y,S){for(var I=1<<S-1>>>0;y&I;)I>>>=1;return I?(y&I-1)+I:y}function It(y,S,I,O,V){t(!(O%I));do y[S+(O-=I)]=V;while(0<O)}function ut(y,S,I,O,V){if(t(2328>=V),512>=V)var H=s(512);else if((H=s(V))==null)return 0;return function(q,X,Z,ot,xt,Lt){var kt,zt,me=X,Wt=1<<Z,Ot=s(16),Nt=s(16);for(t(xt!=0),t(ot!=null),t(q!=null),t(0<Z),zt=0;zt<xt;++zt){if(15<ot[zt])return 0;++Ot[ot[zt]]}if(Ot[0]==xt)return 0;for(Nt[1]=0,kt=1;15>kt;++kt){if(Ot[kt]>1<<kt)return 0;Nt[kt+1]=Nt[kt]+Ot[kt]}for(zt=0;zt<xt;++zt)kt=ot[zt],0<ot[zt]&&(Lt[Nt[kt]++]=zt);if(Nt[15]==1)return(ot=new At).g=0,ot.value=Lt[0],It(q,me,1,Wt,ot),Wt;var be,ve=-1,he=Wt-1,Le=0,Oe=1,sr=1,Ge=1<<Z;for(zt=0,kt=1,xt=2;kt<=Z;++kt,xt<<=1){if(Oe+=sr<<=1,0>(sr-=Ot[kt]))return 0;for(;0<Ot[kt];--Ot[kt])(ot=new At).g=kt,ot.value=Lt[zt++],It(q,me+Le,xt,Ge,ot),Le=Dt(Le,kt)}for(kt=Z+1,xt=2;15>=kt;++kt,xt<<=1){if(Oe+=sr<<=1,0>(sr-=Ot[kt]))return 0;for(;0<Ot[kt];--Ot[kt]){if(ot=new At,(Le&he)!=ve){for(me+=Ge,be=1<<(ve=kt)-Z;15>ve&&!(0>=(be-=Ot[ve]));)++ve,be<<=1;Wt+=Ge=1<<(be=ve-Z),q[X+(ve=Le&he)].g=be+Z,q[X+ve].value=me-X-ve}ot.g=kt-Z,ot.value=Lt[zt++],It(q,me+(Le>>Z),xt,Ge,ot),Le=Dt(Le,kt)}}return Oe!=2*Nt[15]-1?0:Wt}(y,S,I,O,V,H)}function At(){this.value=this.g=0}function Bt(){this.value=this.g=0}function vt(){this.G=a(5,At),this.H=s(5),this.jc=this.Qb=this.qb=this.nd=0,this.pd=a(ps,Bt)}function ne(y,S,I,O){t(y!=null),t(S!=null),t(2147483648>O),y.Ca=254,y.I=0,y.b=-8,y.Ka=0,y.oa=S,y.pa=I,y.Jd=S,y.Yc=I+O,y.Zc=4<=O?I+O-4+1:I,se(y)}function ie(y,S){for(var I=0;0<S--;)I|=oe(y,128)<<S;return I}function ae(y,S){var I=ie(y,S);return Ae(y)?-I:I}function te(y,S,I,O){var V,H=0;for(t(y!=null),t(S!=null),t(4294967288>O),y.Sb=O,y.Ra=0,y.u=0,y.h=0,4<O&&(O=4),V=0;V<O;++V)H+=S[I+V]<<8*V;y.Ra=H,y.bb=O,y.oa=S,y.pa=I}function ce(y){for(;8<=y.u&&y.bb<y.Sb;)y.Ra>>>=8,y.Ra+=y.oa[y.pa+y.bb]<<ya-8>>>0,++y.bb,y.u-=8;St(y)&&(y.h=1,y.u=0)}function le(y,S){if(t(0<=S),!y.h&&S<=al){var I=wt(y)&ol[S];return y.u+=S,ce(y),I}return y.h=1,y.u=0}function Te(){this.b=this.Ca=this.I=0,this.oa=[],this.pa=0,this.Jd=[],this.Yc=0,this.Zc=[],this.Ka=0}function rt(){this.Ra=0,this.oa=[],this.h=this.u=this.bb=this.Sb=this.pa=0}function wt(y){return y.Ra>>>(y.u&ya-1)>>>0}function St(y){return t(y.bb<=y.Sb),y.h||y.bb==y.Sb&&y.u>ya}function qt(y,S){y.u=S,y.h=St(y)}function Jt(y){y.u>=wc&&(t(y.u>=wc),ce(y))}function se(y){t(y!=null&&y.oa!=null),y.pa<y.Zc?(y.I=(y.oa[y.pa++]|y.I<<8)>>>0,y.b+=8):(t(y!=null&&y.oa!=null),y.pa<y.Yc?(y.b+=8,y.I=y.oa[y.pa++]|y.I<<8):y.Ka?y.b=0:(y.I<<=8,y.b+=8,y.Ka=1))}function Ae(y){return ie(y,1)}function oe(y,S){var I=y.Ca;0>y.b&&se(y);var O=y.b,V=I*S>>>8,H=(y.I>>>O>V)+0;for(H?(I-=V,y.I-=V+1<<O>>>0):I=V+1,O=I,V=0;256<=O;)V+=8,O>>=8;return O=7^V+ns[O],y.b-=O,y.Ca=(I<<O)-1,H}function Ce(y,S,I){y[S+0]=I>>24&255,y[S+1]=I>>16&255,y[S+2]=I>>8&255,y[S+3]=I>>0&255}function Pe(y,S){return y[S+0]<<0|y[S+1]<<8}function Ve(y,S){return Pe(y,S)|y[S+2]<<16}function Ke(y,S){return Pe(y,S)|Pe(y,S+2)<<16}function rr(y,S){var I=1<<S;return t(y!=null),t(0<S),y.X=s(I),y.X==null?0:(y.Mb=32-S,y.Xa=S,1)}function _e(y,S){t(y!=null),t(S!=null),t(y.Xa==S.Xa),n(S.X,0,y.X,0,1<<S.Xa)}function Ut(){this.X=[],this.Xa=this.Mb=0}function pr(y,S,I,O){t(I!=null),t(O!=null);var V=I[0],H=O[0];return V==0&&(V=(y*H+S/2)/S),H==0&&(H=(S*V+y/2)/y),0>=V||0>=H?0:(I[0]=V,O[0]=H,1)}function ir(y,S){return y+(1<<S)-1>>>S}function Se(y,S){return((4278255360&y)+(4278255360&S)>>>0&4278255360)+((16711935&y)+(16711935&S)>>>0&16711935)>>>0}function Kt(y,S){ft[S]=function(I,O,V,H,q,X,Z){var ot;for(ot=0;ot<q;++ot){var xt=ft[y](X[Z+ot-1],V,H+ot);X[Z+ot]=Se(I[O+ot],xt)}}}function Ie(){this.ud=this.hd=this.jd=0}function ke(y,S){return((4278124286&(y^S))>>>1)+(y&S)>>>0}function He(y){return 0<=y&&256>y?y:0>y?0:255<y?255:void 0}function De(y,S){return He(y+(y-S+.5>>1))}function xr(y,S,I){return Math.abs(S-I)-Math.abs(y-I)}function Pr(y,S,I,O,V,H,q){for(O=H[q-1],I=0;I<V;++I)H[q+I]=O=Se(y[S+I],O)}function Or(y,S,I,O,V){var H;for(H=0;H<I;++H){var q=y[S+H],X=q>>8&255,Z=16711935&(Z=(Z=16711935&q)+((X<<16)+X));O[V+H]=(4278255360&q)+Z>>>0}}function nn(y,S){S.jd=y>>0&255,S.hd=y>>8&255,S.ud=y>>16&255}function Br(y,S,I,O,V,H){var q;for(q=0;q<O;++q){var X=S[I+q],Z=X>>>8,ot=X,xt=255&(xt=(xt=X>>>16)+((y.jd<<24>>24)*(Z<<24>>24)>>>5));ot=255&(ot=(ot=ot+((y.hd<<24>>24)*(Z<<24>>24)>>>5))+((y.ud<<24>>24)*(xt<<24>>24)>>>5)),V[H+q]=(4278255360&X)+(xt<<16)+ot}}function Ur(y,S,I,O,V){ft[S]=function(H,q,X,Z,ot,xt,Lt,kt,zt){for(Z=Lt;Z<kt;++Z)for(Lt=0;Lt<zt;++Lt)ot[xt++]=V(X[O(H[q++])])},ft[y]=function(H,q,X,Z,ot,xt,Lt){var kt=8>>H.b,zt=H.Ea,me=H.K[0],Wt=H.w;if(8>kt)for(H=(1<<H.b)-1,Wt=(1<<kt)-1;q<X;++q){var Ot,Nt=0;for(Ot=0;Ot<zt;++Ot)Ot&H||(Nt=O(Z[ot++])),xt[Lt++]=V(me[Nt&Wt]),Nt>>=kt}else ft["VP8LMapColor"+I](Z,ot,me,Wt,xt,Lt,q,X,zt)}}function je(y,S,I,O,V){for(I=S+I;S<I;){var H=y[S++];O[V++]=H>>16&255,O[V++]=H>>8&255,O[V++]=H>>0&255}}function Ee(y,S,I,O,V){for(I=S+I;S<I;){var H=y[S++];O[V++]=H>>16&255,O[V++]=H>>8&255,O[V++]=H>>0&255,O[V++]=H>>24&255}}function Nr(y,S,I,O,V){for(I=S+I;S<I;){var H=(q=y[S++])>>16&240|q>>12&15,q=q>>0&240|q>>28&15;O[V++]=H,O[V++]=q}}function Vr(y,S,I,O,V){for(I=S+I;S<I;){var H=(q=y[S++])>>16&248|q>>13&7,q=q>>5&224|q>>3&31;O[V++]=H,O[V++]=q}}function qr(y,S,I,O,V){for(I=S+I;S<I;){var H=y[S++];O[V++]=H>>0&255,O[V++]=H>>8&255,O[V++]=H>>16&255}}function rn(y,S,I,O,V,H){if(H==0)for(I=S+I;S<I;)Ce(O,((H=y[S++])[0]>>24|H[1]>>8&65280|H[2]<<8&16711680|H[3]<<24)>>>0),V+=32;else n(O,V,y,S,I)}function Fe(y,S){ft[S][0]=ft[y+"0"],ft[S][1]=ft[y+"1"],ft[S][2]=ft[y+"2"],ft[S][3]=ft[y+"3"],ft[S][4]=ft[y+"4"],ft[S][5]=ft[y+"5"],ft[S][6]=ft[y+"6"],ft[S][7]=ft[y+"7"],ft[S][8]=ft[y+"8"],ft[S][9]=ft[y+"9"],ft[S][10]=ft[y+"10"],ft[S][11]=ft[y+"11"],ft[S][12]=ft[y+"12"],ft[S][13]=ft[y+"13"],ft[S][14]=ft[y+"0"],ft[S][15]=ft[y+"0"]}function Ze(y){return y==ZA||y==_s||y==Zo||y==hl}function ur(){this.eb=[],this.size=this.A=this.fb=0}function Jr(){this.y=[],this.f=[],this.ea=[],this.F=[],this.Tc=this.Ed=this.Cd=this.Fd=this.lb=this.Db=this.Ab=this.fa=this.J=this.W=this.N=this.O=0}function Un(){this.Rd=this.height=this.width=this.S=0,this.f={},this.f.RGBA=new ur,this.f.kb=new Jr,this.sd=null}function qe(){this.width=[0],this.height=[0],this.Pd=[0],this.Qd=[0],this.format=[0]}function sn(){this.Id=this.fd=this.Md=this.hb=this.ib=this.da=this.bd=this.cd=this.j=this.v=this.Da=this.Sd=this.ob=0}function _t(y){return alert("todo:WebPSamplerProcessPlane"),y.T}function tt(y,S){var I=y.T,O=S.ba.f.RGBA,V=O.eb,H=O.fb+y.ka*O.A,q=xn[S.ba.S],X=y.y,Z=y.O,ot=y.f,xt=y.N,Lt=y.ea,kt=y.W,zt=S.cc,me=S.dc,Wt=S.Mc,Ot=S.Nc,Nt=y.ka,be=y.ka+y.T,ve=y.U,he=ve+1>>1;for(Nt==0?q(X,Z,null,null,ot,xt,Lt,kt,ot,xt,Lt,kt,V,H,null,null,ve):(q(S.ec,S.fc,X,Z,zt,me,Wt,Ot,ot,xt,Lt,kt,V,H-O.A,V,H,ve),++I);Nt+2<be;Nt+=2)zt=ot,me=xt,Wt=Lt,Ot=kt,xt+=y.Rc,kt+=y.Rc,H+=2*O.A,q(X,(Z+=2*y.fa)-y.fa,X,Z,zt,me,Wt,Ot,ot,xt,Lt,kt,V,H-O.A,V,H,ve);return Z+=y.fa,y.j+be<y.o?(n(S.ec,S.fc,X,Z,ve),n(S.cc,S.dc,ot,xt,he),n(S.Mc,S.Nc,Lt,kt,he),I--):1&be||q(X,Z,null,null,ot,xt,Lt,kt,ot,xt,Lt,kt,V,H+O.A,null,null,ve),I}function at(y,S,I){var O=y.F,V=[y.J];if(O!=null){var H=y.U,q=S.ba.S,X=q==iA||q==Zo;S=S.ba.f.RGBA;var Z=[0],ot=y.ka;Z[0]=y.T,y.Kb&&(ot==0?--Z[0]:(--ot,V[0]-=y.width),y.j+y.ka+y.T==y.o&&(Z[0]=y.o-y.j-ot));var xt=S.eb;ot=S.fb+ot*S.A,y=Fo(O,V[0],y.width,H,Z,xt,ot+(X?0:3),S.A),t(I==Z),y&&Ze(q)&&Jo(xt,ot,X,H,Z,S.A)}return 0}function gt(y){var S=y.ma,I=S.ba.S,O=11>I,V=I==JA||I==$u||I==iA||I==YA||I==12||Ze(I);if(S.memory=null,S.Ib=null,S.Jb=null,S.Nd=null,!KA(S.Oa,y,V?11:12))return 0;if(V&&Ze(I)&&ze(),y.da)alert("todo:use_scaling");else{if(O){if(S.Ib=_t,y.Kb){if(I=y.U+1>>1,S.memory=s(y.U+2*I),S.memory==null)return 0;S.ec=S.memory,S.fc=0,S.cc=S.ec,S.dc=S.fc+y.U,S.Mc=S.cc,S.Nc=S.dc+I,S.Ib=tt,ze()}}else alert("todo:EmitYUV");V&&(S.Jb=at,O&&Zt())}if(O&&!d){for(y=0;256>y;++y)m[y]=89858*(y-128)+lA>>$a,F[y]=-22014*(y-128)+lA,E[y]=-45773*(y-128),v[y]=113618*(y-128)+lA>>$a;for(y=dl;y<_n;++y)S=76283*(y-16)+lA>>$a,M[y-dl]=Os(S,255),N[y-dl]=Os(S+8>>4,15);d=1}return 1}function Tt(y){var S=y.ma,I=y.U,O=y.T;return t(!(1&y.ka)),0>=I||0>=O?0:(I=S.Ib(y,S),S.Jb!=null&&S.Jb(y,S,I),S.Dc+=I,1)}function Ft(y){y.ma.memory=null}function Ht(y,S,I,O){return le(y,8)!=47?0:(S[0]=le(y,14)+1,I[0]=le(y,14)+1,O[0]=le(y,1),le(y,3)!=0?0:!y.h)}function Vt(y,S){if(4>y)return y+1;var I=y-2>>1;return(2+(1&y)<<I)+le(S,I)+1}function Qt(y,S){return 120<S?S-120:1<=(I=((I=Jn[S-1])>>4)*y+(8-(15&I)))?I:1;var I}function $t(y,S,I){var O=wt(I),V=y[S+=255&O].g-8;return 0<V&&(qt(I,I.u+8),O=wt(I),S+=y[S].value,S+=O&(1<<V)-1),qt(I,I.u+y[S].g),y[S].value}function fe(y,S,I){return I.g+=y.g,I.value+=y.value<<S>>>0,t(8>=I.g),y.g}function ye(y,S,I){var O=y.xc;return t((S=O==0?0:y.vc[y.md*(I>>O)+(S>>O)])<y.Wb),y.Ya[S]}function we(y,S,I,O){var V=y.ab,H=y.c*S,q=y.C;S=q+S;var X=I,Z=O;for(O=y.Ta,I=y.Ua;0<V--;){var ot=y.gc[V],xt=q,Lt=S,kt=X,zt=Z,me=(Z=O,X=I,ot.Ea);switch(t(xt<Lt),t(Lt<=ot.nc),ot.hc){case 2:_a(kt,zt,(Lt-xt)*me,Z,X);break;case 0:var Wt=xt,Ot=Lt,Nt=Z,be=X,ve=(Ge=ot).Ea;Wt==0&&(Ku(kt,zt,null,null,1,Nt,be),Pr(kt,zt+1,0,0,ve-1,Nt,be+1),zt+=ve,be+=ve,++Wt);for(var he=1<<Ge.b,Le=he-1,Oe=ir(ve,Ge.b),sr=Ge.K,Ge=Ge.w+(Wt>>Ge.b)*Oe;Wt<Ot;){var zr=sr,Hr=Ge,tn=1;for(Kn(kt,zt,Nt,be-ve,1,Nt,be);tn<ve;){var Sr=(tn&~Le)+he;Sr>ve&&(Sr=ve),(0,Ns[zr[Hr++]>>8&15])(kt,zt+ +tn,Nt,be+tn-ve,Sr-tn,Nt,be+tn),tn=Sr}zt+=ve,be+=ve,++Wt&Le||(Ge+=Oe)}Lt!=ot.nc&&n(Z,X-me,Z,X+(Lt-xt-1)*me,me);break;case 1:for(me=kt,Ot=zt,ve=(kt=ot.Ea)-(be=kt&~(Nt=(zt=1<<ot.b)-1)),Wt=ir(kt,ot.b),he=ot.K,ot=ot.w+(xt>>ot.b)*Wt;xt<Lt;){for(Le=he,Oe=ot,sr=new Ie,Ge=Ot+be,zr=Ot+kt;Ot<Ge;)nn(Le[Oe++],sr),gs(sr,me,Ot,zt,Z,X),Ot+=zt,X+=zt;Ot<zr&&(nn(Le[Oe++],sr),gs(sr,me,Ot,ve,Z,X),Ot+=ve,X+=ve),++xt&Nt||(ot+=Wt)}break;case 3:if(kt==Z&&zt==X&&0<ot.b){for(Ot=Z,kt=me=X+(Lt-xt)*me-(be=(Lt-xt)*ir(ot.Ea,ot.b)),zt=Z,Nt=X,Wt=[],be=(ve=be)-1;0<=be;--be)Wt[be]=zt[Nt+be];for(be=ve-1;0<=be;--be)Ot[kt+be]=Wt[be];oi(ot,xt,Lt,Z,me,Z,X)}else oi(ot,xt,Lt,kt,zt,Z,X)}X=O,Z=I}Z!=I&&n(O,I,X,Z,H)}function hr(y,S){var I=y.V,O=y.Ba+y.c*y.C,V=S-y.C;if(t(S<=y.l.o),t(16>=V),0<V){var H=y.l,q=y.Ta,X=y.Ua,Z=H.width;if(we(y,V,I,O),V=X=[X],t((I=y.C)<(O=S)),t(H.v<H.va),O>H.o&&(O=H.o),I<H.j){var ot=H.j-I;I=H.j,V[0]+=ot*Z}if(I>=O?I=0:(V[0]+=4*H.v,H.ka=I-H.j,H.U=H.va-H.v,H.T=O-I,I=1),I){if(X=X[0],11>(I=y.ca).S){var xt=I.f.RGBA,Lt=(O=I.S,V=H.U,H=H.T,ot=xt.eb,xt.A),kt=H;for(xt=xt.fb+y.Ma*xt.A;0<kt--;){var zt=q,me=X,Wt=V,Ot=ot,Nt=xt;switch(O){case XA:ms(zt,me,Wt,Ot,Nt);break;case JA:Va(zt,me,Wt,Ot,Nt);break;case ZA:Va(zt,me,Wt,Ot,Nt),Jo(Ot,Nt,0,Wt,1,0);break;case Zh:ll(zt,me,Wt,Ot,Nt);break;case $u:rn(zt,me,Wt,Ot,Nt,1);break;case _s:rn(zt,me,Wt,Ot,Nt,1),Jo(Ot,Nt,0,Wt,1,0);break;case iA:rn(zt,me,Wt,Ot,Nt,0);break;case Zo:rn(zt,me,Wt,Ot,Nt,0),Jo(Ot,Nt,1,Wt,1,0);break;case YA:Xo(zt,me,Wt,Ot,Nt);break;case hl:Xo(zt,me,Wt,Ot,Nt),Yo(Ot,Nt,Wt,1,0);break;case Wu:ba(zt,me,Wt,Ot,Nt);break;default:t(0)}X+=Z,xt+=Lt}y.Ma+=H}else alert("todo:EmitRescaledRowsYUVA");t(y.Ma<=I.height)}}y.C=S,t(y.C<=y.i)}function dr(y){var S;if(0<y.ua)return 0;for(S=0;S<y.Wb;++S){var I=y.Ya[S].G,O=y.Ya[S].H;if(0<I[1][O[1]+0].g||0<I[2][O[2]+0].g||0<I[3][O[3]+0].g)return 0}return 1}function Je(y,S,I,O,V,H){if(y.Z!=0){var q=y.qd,X=y.rd;for(t(Qs[y.Z]!=null);S<I;++S)Qs[y.Z](q,X,O,V,O,V,H),q=O,X=V,V+=H;y.qd=q,y.rd=X}}function or(y,S){var I=y.l.ma,O=I.Z==0||I.Z==1?y.l.j:y.C;if(O=y.C<O?O:y.C,t(S<=y.l.o),S>O){var V=y.l.width,H=I.ca,q=I.tb+V*O,X=y.V,Z=y.Ba+y.c*O,ot=y.gc;t(y.ab==1),t(ot[0].hc==3),cl(ot[0],O,S,X,Z,H,q),Je(I,O,S,H,q,V)}y.C=y.Ma=S}function _r(y,S,I,O,V,H,q){var X=y.$/O,Z=y.$%O,ot=y.m,xt=y.s,Lt=I+y.$,kt=Lt;V=I+O*V;var zt=I+O*H,me=280+xt.ua,Wt=y.Pb?X:16777216,Ot=0<xt.ua?xt.Wa:null,Nt=xt.wc,be=Lt<zt?ye(xt,Z,X):null;t(y.C<H),t(zt<=V);var ve=!1;t:for(;;){for(;ve||Lt<zt;){var he=0;if(X>=Wt){var Le=Lt-I;t((Wt=y).Pb),Wt.wd=Wt.m,Wt.xd=Le,0<Wt.s.ua&&_e(Wt.s.Wa,Wt.s.vb),Wt=X+ed}if(Z&Nt||(be=ye(xt,Z,X)),t(be!=null),be.Qb&&(S[Lt]=be.qb,ve=!0),!ve)if(Jt(ot),be.jc){he=ot,Le=S;var Oe=Lt,sr=be.pd[wt(he)&ps-1];t(be.jc),256>sr.g?(qt(he,he.u+sr.g),Le[Oe]=sr.value,he=0):(qt(he,he.u+sr.g-256),t(256<=sr.value),he=sr.value),he==0&&(ve=!0)}else he=$t(be.G[0],be.H[0],ot);if(ot.h)break;if(ve||256>he){if(!ve)if(be.nd)S[Lt]=(be.qb|he<<8)>>>0;else{if(Jt(ot),ve=$t(be.G[1],be.H[1],ot),Jt(ot),Le=$t(be.G[2],be.H[2],ot),Oe=$t(be.G[3],be.H[3],ot),ot.h)break;S[Lt]=(Oe<<24|ve<<16|he<<8|Le)>>>0}if(ve=!1,++Lt,++Z>=O&&(Z=0,++X,q!=null&&X<=H&&!(X%16)&&q(y,X),Ot!=null))for(;kt<Lt;)he=S[kt++],Ot.X[(506832829*he&4294967295)>>>Ot.Mb]=he}else if(280>he){if(he=Vt(he-256,ot),Le=$t(be.G[4],be.H[4],ot),Jt(ot),Le=Qt(O,Le=Vt(Le,ot)),ot.h)break;if(Lt-I<Le||V-Lt<he)break t;for(Oe=0;Oe<he;++Oe)S[Lt+Oe]=S[Lt+Oe-Le];for(Lt+=he,Z+=he;Z>=O;)Z-=O,++X,q!=null&&X<=H&&!(X%16)&&q(y,X);if(t(Lt<=V),Z&Nt&&(be=ye(xt,Z,X)),Ot!=null)for(;kt<Lt;)he=S[kt++],Ot.X[(506832829*he&4294967295)>>>Ot.Mb]=he}else{if(!(he<me))break t;for(ve=he-280,t(Ot!=null);kt<Lt;)he=S[kt++],Ot.X[(506832829*he&4294967295)>>>Ot.Mb]=he;he=Lt,t(!(ve>>>(Le=Ot).Xa)),S[he]=Le.X[ve],ve=!0}ve||t(ot.h==St(ot))}if(y.Pb&&ot.h&&Lt<V)t(y.m.h),y.a=5,y.m=y.wd,y.$=y.xd,0<y.s.ua&&_e(y.s.vb,y.s.Wa);else{if(ot.h)break t;q!=null&&q(y,X>H?H:X),y.a=0,y.$=Lt-I}return 1}return y.a=3,0}function Rr(y){t(y!=null),y.vc=null,y.yc=null,y.Ya=null;var S=y.Wa;S!=null&&(S.X=null),y.vb=null,t(y!=null)}function jr(){var y=new yc;return y==null?null:(y.a=0,y.xb=nd,Fe("Predictor","VP8LPredictors"),Fe("Predictor","VP8LPredictors_C"),Fe("PredictorAdd","VP8LPredictorsAdd"),Fe("PredictorAdd","VP8LPredictorsAdd_C"),_a=Or,gs=Br,ms=je,Va=Ee,Xo=Nr,ba=Vr,ll=qr,ft.VP8LMapColor32b=va,ft.VP8LMapColor8b=rA,y)}function Fr(y,S,I,O,V){var H=1,q=[y],X=[S],Z=O.m,ot=O.s,xt=null,Lt=0;t:for(;;){if(I)for(;H&&le(Z,1);){var kt=q,zt=X,me=O,Wt=1,Ot=me.m,Nt=me.gc[me.ab],be=le(Ot,2);if(me.Oc&1<<be)H=0;else{switch(me.Oc|=1<<be,Nt.hc=be,Nt.Ea=kt[0],Nt.nc=zt[0],Nt.K=[null],++me.ab,t(4>=me.ab),be){case 0:case 1:Nt.b=le(Ot,3)+2,Wt=Fr(ir(Nt.Ea,Nt.b),ir(Nt.nc,Nt.b),0,me,Nt.K),Nt.K=Nt.K[0];break;case 3:var ve,he=le(Ot,8)+1,Le=16<he?0:4<he?1:2<he?2:3;if(kt[0]=ir(Nt.Ea,Le),Nt.b=Le,ve=Wt=Fr(he,1,0,me,Nt.K)){var Oe,sr=he,Ge=Nt,zr=1<<(8>>Ge.b),Hr=s(zr);if(Hr==null)ve=0;else{var tn=Ge.K[0],Sr=Ge.w;for(Hr[0]=Ge.K[0][0],Oe=1;Oe<1*sr;++Oe)Hr[Oe]=Se(tn[Sr+Oe],Hr[Oe-1]);for(;Oe<4*zr;++Oe)Hr[Oe]=0;Ge.K[0]=null,Ge.K[0]=Hr,ve=1}}Wt=ve;break;case 2:break;default:t(0)}H=Wt}}if(q=q[0],X=X[0],H&&le(Z,1)&&!(H=1<=(Lt=le(Z,4))&&11>=Lt)){O.a=3;break t}var pn;if(pn=H)e:{var hn,Gr,Yn,Pi=O,vn=q,Fn=X,en=Lt,Ui=I,Bn=Pi.m,gn=Pi.s,Mn=[null],mn=1,Vi=0,ro=Ju[en];r:for(;;){if(Ui&&le(Bn,1)){var Ri=le(Bn,3)+2,Ca=ir(vn,Ri),fl=ir(Fn,Ri),Cc=Ca*fl;if(!Fr(Ca,fl,0,Pi,Mn))break r;for(Mn=Mn[0],gn.xc=Ri,hn=0;hn<Cc;++hn){var is=Mn[hn]>>8&65535;Mn[hn]=is,is>=mn&&(mn=is+1)}}if(Bn.h)break r;for(Gr=0;5>Gr;++Gr){var Hn=Xu[Gr];!Gr&&0<en&&(Hn+=1<<en),Vi<Hn&&(Vi=Hn)}var Po=a(mn*ro,At),no=mn,ea=a(no,vt);if(ea==null)var AA=null;else t(65536>=no),AA=ea;var io=s(Vi);if(AA==null||io==null||Po==null){Pi.a=1;break r}var Vf=Po;for(hn=Yn=0;hn<mn;++hn){var Ea=AA[hn],ei=Ea.G,uA=Ea.H,em=0,Ec=1,hA=0;for(Gr=0;5>Gr;++Gr){Hn=Xu[Gr],ei[Gr]=Vf,uA[Gr]=Yn,!Gr&&0<en&&(Hn+=1<<en);i:{var nu,sd=Hn,od=Pi,ad=io,J1=Vf,wC=Yn,cd=0,dA=od.m,rm=le(dA,1);if(i(ad,0,0,sd),rm){var Y1=le(dA,1)+1,Z1=le(dA,1),iu=le(dA,Z1==0?1:8);ad[iu]=1,Y1==2&&(ad[iu=le(dA,8)]=1);var jf=1}else{var eh=s(19),ld=le(dA,4)+4;if(19<ld){od.a=3;var su=0;break i}for(nu=0;nu<ld;++nu)eh[eo[nu]]=le(dA,3);var qf=void 0,rh=void 0,t_=od,zs=eh,pl=sd,Kf=ad,$f=0,Sa=t_.m,e_=8,Ad=a(128,At);n:for(;ut(Ad,0,7,zs,19);){if(le(Sa,1)){var xC=2+2*le(Sa,3);if((qf=2+le(Sa,xC))>pl)break n}else qf=pl;for(rh=0;rh<pl&&qf--;){Jt(Sa);var nm=Ad[0+(127&wt(Sa))];qt(Sa,Sa.u+nm.g);var ou=nm.value;if(16>ou)Kf[rh++]=ou,ou!=0&&(e_=ou);else{var r_=ou==16,n_=ou-16,im=tu[n_],sm=le(Sa,td[n_])+im;if(rh+sm>pl)break n;for(var om=r_?e_:0;0<sm--;)Kf[rh++]=om}}$f=1;break n}$f||(t_.a=3),jf=$f}(jf=jf&&!dA.h)&&(cd=ut(J1,wC,8,ad,sd)),jf&&cd!=0?su=cd:(od.a=3,su=0)}if(su==0)break r;if(Ec&&Gf[Gr]==1&&(Ec=Vf[Yn].g==0),em+=Vf[Yn].g,Yn+=su,3>=Gr){var gl,so=io[0];for(gl=1;gl<Hn;++gl)io[gl]>so&&(so=io[gl]);hA+=so}}if(Ea.nd=Ec,Ea.Qb=0,Ec&&(Ea.qb=(ei[3][uA[3]+0].value<<24|ei[1][uA[1]+0].value<<16|ei[2][uA[2]+0].value)>>>0,em==0&&256>ei[0][uA[0]+0].value&&(Ea.Qb=1,Ea.qb+=ei[0][uA[0]+0].value<<8)),Ea.jc=!Ea.Qb&&6>hA,Ea.jc){var ud,ml=Ea;for(ud=0;ud<ps;++ud){var yl=ud,fA=ml.pd[yl],Wf=ml.G[0][ml.H[0]+yl];256<=Wf.value?(fA.g=Wf.g+256,fA.value=Wf.value):(fA.g=0,fA.value=0,yl>>=fe(Wf,8,fA),yl>>=fe(ml.G[1][ml.H[1]+yl],16,fA),yl>>=fe(ml.G[2][ml.H[2]+yl],0,fA),fe(ml.G[3][ml.H[3]+yl],24,fA))}}}gn.vc=Mn,gn.Wb=mn,gn.Ya=AA,gn.yc=Po,pn=1;break e}pn=0}if(!(H=pn)){O.a=3;break t}if(0<Lt){if(ot.ua=1<<Lt,!rr(ot.Wa,Lt)){O.a=1,H=0;break t}}else ot.ua=0;var am=O,i_=q,cm=X,nh=am.s,Xf=nh.xc;if(am.c=i_,am.i=cm,nh.md=ir(i_,Xf),nh.wc=Xf==0?-1:(1<<Xf)-1,I){O.xb=Mo;break t}if((xt=s(q*X))==null){O.a=1,H=0;break t}H=(H=_r(O,xt,0,q,X,X,null))&&!Z.h;break t}return H?(V!=null?V[0]=xt:(t(xt==null),t(I)),O.$=0,I||Rr(ot)):Rr(ot),H}function Rt(y,S){var I=y.c*y.i,O=I+S+16*S;return t(y.c<=S),y.V=s(O),y.V==null?(y.Ta=null,y.Ua=0,y.a=1,0):(y.Ta=y.V,y.Ua=y.Ba+I+S,1)}function Qe(y,S){var I=y.C,O=S-I,V=y.V,H=y.Ba+y.c*I;for(t(S<=y.l.o);0<O;){var q=16<O?16:O,X=y.l.ma,Z=y.l.width,ot=Z*q,xt=X.ca,Lt=X.tb+Z*I,kt=y.Ta,zt=y.Ua;we(y,q,V,H),ar(kt,zt,xt,Lt,ot),Je(X,I,I+q,xt,Lt,Z),O-=q,V+=q*y.c,I+=q}t(I==S),y.C=y.Ma=S}function Be(){this.ub=this.yd=this.td=this.Rb=0}function Er(){this.Kd=this.Ld=this.Ud=this.Td=this.i=this.c=0}function Kr(){this.Fb=this.Bb=this.Cb=0,this.Zb=s(4),this.Lb=s(4)}function Sn(){this.Yb=function(){var y=[];return function S(I,O,V){for(var H=V[O],q=0;q<H&&(I.push(V.length>O+1?[]:0),!(V.length<O+1));q++)S(I[q],O+1,V)}(y,0,[3,11]),y}()}function Rn(){this.jb=s(3),this.Wc=o([4,8],Sn),this.Xc=o([4,17],Sn)}function Vn(){this.Pc=this.wb=this.Tb=this.zd=0,this.vd=new s(4),this.od=new s(4)}function kn(){this.ld=this.La=this.dd=this.tc=0}function Qn(){this.Na=this.la=0}function Yr(){this.Sc=[0,0],this.Eb=[0,0],this.Qc=[0,0],this.ia=this.lc=0}function Xs(){this.ad=s(384),this.Za=0,this.Ob=s(16),this.$b=this.Ad=this.ia=this.Gc=this.Hc=this.Dd=0}function ts(){this.uc=this.M=this.Nb=0,this.wa=Array(new kn),this.Y=0,this.ya=Array(new Xs),this.aa=0,this.l=new za}function Dn(){this.y=s(16),this.f=s(8),this.ea=s(8)}function Gi(){this.cb=this.a=0,this.sc="",this.m=new Te,this.Od=new Be,this.Kc=new Er,this.ed=new Vn,this.Qa=new Kr,this.Ic=this.$c=this.Aa=0,this.D=new ts,this.Xb=this.Va=this.Hb=this.zb=this.yb=this.Ub=this.za=0,this.Jc=a(8,Te),this.ia=0,this.pb=a(4,Yr),this.Pa=new Rn,this.Bd=this.kc=0,this.Ac=[],this.Bc=0,this.zc=[0,0,0,0],this.Gd=Array(new Dn),this.Hd=0,this.rb=Array(new Qn),this.sb=0,this.wa=Array(new kn),this.Y=0,this.oc=[],this.pc=0,this.sa=[],this.ta=0,this.qa=[],this.ra=0,this.Ha=[],this.B=this.R=this.Ia=0,this.Ec=[],this.M=this.ja=this.Vb=this.Fc=0,this.ya=Array(new Xs),this.L=this.aa=0,this.gd=o([4,2],kn),this.ga=null,this.Fa=[],this.Cc=this.qc=this.P=0,this.Gb=[],this.Uc=0,this.mb=[],this.nb=0,this.rc=[],this.Ga=this.Vc=0}function za(){this.T=this.U=this.ka=this.height=this.width=0,this.y=[],this.f=[],this.ea=[],this.Rc=this.fa=this.W=this.N=this.O=0,this.ma="void",this.put="VP8IoPutHook",this.ac="VP8IoSetupHook",this.bc="VP8IoTeardownHook",this.ha=this.Kb=0,this.data=[],this.hb=this.ib=this.da=this.o=this.j=this.va=this.v=this.Da=this.ob=this.w=0,this.F=[],this.J=0}function Ii(){var y=new Gi;return y!=null&&(y.a=0,y.sc="OK",y.cb=0,y.Xb=0,sA||(sA=Tn)),y}function kr(y,S,I){return y.a==0&&(y.a=S,y.sc=I,y.cb=0),0}function Bo(y,S,I){return 3<=I&&y[S+0]==157&&y[S+1]==1&&y[S+2]==42}function Js(y,S){if(y==null)return 0;if(y.a=0,y.sc="OK",S==null)return kr(y,2,"null VP8Io passed to VP8GetHeaders()");var I=S.data,O=S.w,V=S.ha;if(4>V)return kr(y,7,"Truncated header.");var H=I[O+0]|I[O+1]<<8|I[O+2]<<16,q=y.Od;if(q.Rb=!(1&H),q.td=H>>1&7,q.yd=H>>4&1,q.ub=H>>5,3<q.td)return kr(y,3,"Incorrect keyframe parameters.");if(!q.yd)return kr(y,4,"Frame not displayable.");O+=3,V-=3;var X=y.Kc;if(q.Rb){if(7>V)return kr(y,7,"cannot parse picture header");if(!Bo(I,O,V))return kr(y,3,"Bad code word");X.c=16383&(I[O+4]<<8|I[O+3]),X.Td=I[O+4]>>6,X.i=16383&(I[O+6]<<8|I[O+5]),X.Ud=I[O+6]>>6,O+=7,V-=7,y.za=X.c+15>>4,y.Ub=X.i+15>>4,S.width=X.c,S.height=X.i,S.Da=0,S.j=0,S.v=0,S.va=S.width,S.o=S.height,S.da=0,S.ib=S.width,S.hb=S.height,S.U=S.width,S.T=S.height,i((H=y.Pa).jb,0,255,H.jb.length),t((H=y.Qa)!=null),H.Cb=0,H.Bb=0,H.Fb=1,i(H.Zb,0,0,H.Zb.length),i(H.Lb,0,0,H.Lb)}if(q.ub>V)return kr(y,7,"bad partition length");ne(H=y.m,I,O,q.ub),O+=q.ub,V-=q.ub,q.Rb&&(X.Ld=Ae(H),X.Kd=Ae(H)),X=y.Qa;var Z,ot=y.Pa;if(t(H!=null),t(X!=null),X.Cb=Ae(H),X.Cb){if(X.Bb=Ae(H),Ae(H)){for(X.Fb=Ae(H),Z=0;4>Z;++Z)X.Zb[Z]=Ae(H)?ae(H,7):0;for(Z=0;4>Z;++Z)X.Lb[Z]=Ae(H)?ae(H,6):0}if(X.Bb)for(Z=0;3>Z;++Z)ot.jb[Z]=Ae(H)?ie(H,8):255}else X.Bb=0;if(H.Ka)return kr(y,3,"cannot parse segment header");if((X=y.ed).zd=Ae(H),X.Tb=ie(H,6),X.wb=ie(H,3),X.Pc=Ae(H),X.Pc&&Ae(H)){for(ot=0;4>ot;++ot)Ae(H)&&(X.vd[ot]=ae(H,6));for(ot=0;4>ot;++ot)Ae(H)&&(X.od[ot]=ae(H,6))}if(y.L=X.Tb==0?0:X.zd?1:2,H.Ka)return kr(y,3,"cannot parse filter header");var xt=V;if(V=Z=O,O=Z+xt,X=xt,y.Xb=(1<<ie(y.m,2))-1,xt<3*(ot=y.Xb))I=7;else{for(Z+=3*ot,X-=3*ot,xt=0;xt<ot;++xt){var Lt=I[V+0]|I[V+1]<<8|I[V+2]<<16;Lt>X&&(Lt=X),ne(y.Jc[+xt],I,Z,Lt),Z+=Lt,X-=Lt,V+=3}ne(y.Jc[+ot],I,Z,X),I=Z<O?0:5}if(I!=0)return kr(y,I,"cannot parse partitions");for(I=ie(Z=y.m,7),V=Ae(Z)?ae(Z,4):0,O=Ae(Z)?ae(Z,4):0,X=Ae(Z)?ae(Z,4):0,ot=Ae(Z)?ae(Z,4):0,Z=Ae(Z)?ae(Z,4):0,xt=y.Qa,Lt=0;4>Lt;++Lt){if(xt.Cb){var kt=xt.Zb[Lt];xt.Fb||(kt+=I)}else{if(0<Lt){y.pb[Lt]=y.pb[0];continue}kt=I}var zt=y.pb[Lt];zt.Sc[0]=Yu[Os(kt+V,127)],zt.Sc[1]=Zu[Os(kt+0,127)],zt.Eb[0]=2*Yu[Os(kt+O,127)],zt.Eb[1]=101581*Zu[Os(kt+X,127)]>>16,8>zt.Eb[1]&&(zt.Eb[1]=8),zt.Qc[0]=Yu[Os(kt+ot,117)],zt.Qc[1]=Zu[Os(kt+Z,127)],zt.lc=kt+Z}if(!q.Rb)return kr(y,4,"Not a key frame.");for(Ae(H),q=y.Pa,I=0;4>I;++I){for(V=0;8>V;++V)for(O=0;3>O;++O)for(X=0;11>X;++X)ot=oe(H,ru[I][V][O][X])?ie(H,8):vr[I][V][O][X],q.Wc[I][V].Yb[O][X]=ot;for(V=0;17>V;++V)q.Xc[I][V]=q.Wc[I][rd[V]]}return y.kc=Ae(H),y.kc&&(y.Bd=ie(H,8)),y.cb=1}function Tn(y,S,I,O,V,H,q){var X=S[V].Yb[I];for(I=0;16>V;++V){if(!oe(y,X[I+0]))return V;for(;!oe(y,X[I+1]);)if(X=S[++V].Yb[0],I=0,V==16)return 16;var Z=S[V+1].Yb;if(oe(y,X[I+2])){var ot=y,xt=0;if(oe(ot,(kt=X)[(Lt=I)+3]))if(oe(ot,kt[Lt+6])){for(X=0,Lt=2*(xt=oe(ot,kt[Lt+8]))+(kt=oe(ot,kt[Lt+9+xt])),xt=0,kt=tm[Lt];kt[X];++X)xt+=xt+oe(ot,kt[X]);xt+=3+(8<<Lt)}else oe(ot,kt[Lt+7])?(xt=7+2*oe(ot,165),xt+=oe(ot,145)):xt=5+oe(ot,159);else xt=oe(ot,kt[Lt+4])?3+oe(ot,kt[Lt+5]):2;X=Z[2]}else xt=1,X=Z[1];Z=q+Is[V],0>(ot=y).b&&se(ot);var Lt,kt=ot.b,zt=(Lt=ot.Ca>>1)-(ot.I>>kt)>>31;--ot.b,ot.Ca+=zt,ot.Ca|=1,ot.I-=(Lt+1&zt)<<kt,H[Z]=((xt^zt)-zt)*O[(0<V)+0]}return 16}function on(y){var S=y.rb[y.sb-1];S.la=0,S.Na=0,i(y.zc,0,0,y.zc.length),y.ja=0}function Ys(y,S){if(y==null)return 0;if(S==null)return kr(y,2,"NULL VP8Io parameter in VP8Decode().");if(!y.cb&&!Js(y,S))return 0;if(t(y.cb),S.ac==null||S.ac(S)){S.ob&&(y.L=0);var I=$[y.L];if(y.L==2?(y.yb=0,y.zb=0):(y.yb=S.v-I>>4,y.zb=S.j-I>>4,0>y.yb&&(y.yb=0),0>y.zb&&(y.zb=0)),y.Va=S.o+15+I>>4,y.Hb=S.va+15+I>>4,y.Hb>y.za&&(y.Hb=y.za),y.Va>y.Ub&&(y.Va=y.Ub),0<y.L){var O=y.ed;for(I=0;4>I;++I){var V;if(y.Qa.Cb){var H=y.Qa.Lb[I];y.Qa.Fb||(H+=O.Tb)}else H=O.Tb;for(V=0;1>=V;++V){var q=y.gd[I][V],X=H;if(O.Pc&&(X+=O.vd[0],V&&(X+=O.od[0])),0<(X=0>X?0:63<X?63:X)){var Z=X;0<O.wb&&(Z=4<O.wb?Z>>2:Z>>1)>9-O.wb&&(Z=9-O.wb),1>Z&&(Z=1),q.dd=Z,q.tc=2*X+Z,q.ld=40<=X?2:15<=X?1:0}else q.tc=0;q.La=V}}}I=0}else kr(y,6,"Frame setup failed"),I=y.a;if(I=I==0){if(I){y.$c=0,0<y.Aa||(y.Ic=ct);t:{I=y.Ic,O=4*(Z=y.za);var ot=32*Z,xt=Z+1,Lt=0<y.L?Z*(0<y.Aa?2:1):0,kt=(y.Aa==2?2:1)*Z;if((q=O+832+(V=3*(16*I+$[y.L])/2*ot)+(H=y.Fa!=null&&0<y.Fa.length?y.Kc.c*y.Kc.i:0))!=q)I=0;else{if(q>y.Vb){if(y.Vb=0,y.Ec=s(q),y.Fc=0,y.Ec==null){I=kr(y,1,"no memory during frame initialization.");break t}y.Vb=q}q=y.Ec,X=y.Fc,y.Ac=q,y.Bc=X,X+=O,y.Gd=a(ot,Dn),y.Hd=0,y.rb=a(xt+1,Qn),y.sb=1,y.wa=Lt?a(Lt,kn):null,y.Y=0,y.D.Nb=0,y.D.wa=y.wa,y.D.Y=y.Y,0<y.Aa&&(y.D.Y+=Z),t(!0),y.oc=q,y.pc=X,X+=832,y.ya=a(kt,Xs),y.aa=0,y.D.ya=y.ya,y.D.aa=y.aa,y.Aa==2&&(y.D.aa+=Z),y.R=16*Z,y.B=8*Z,Z=(ot=$[y.L])*y.R,ot=ot/2*y.B,y.sa=q,y.ta=X+Z,y.qa=y.sa,y.ra=y.ta+16*I*y.R+ot,y.Ha=y.qa,y.Ia=y.ra+8*I*y.B+ot,y.$c=0,X+=V,y.mb=H?q:null,y.nb=H?X:null,t(X+H<=y.Fc+y.Vb),on(y),i(y.Ac,y.Bc,0,O),I=1}}if(I){if(S.ka=0,S.y=y.sa,S.O=y.ta,S.f=y.qa,S.N=y.ra,S.ea=y.Ha,S.Vd=y.Ia,S.fa=y.R,S.Rc=y.B,S.F=null,S.J=0,!tr){for(I=-255;255>=I;++I)$A[255+I]=0>I?-I:I;for(I=-1020;1020>=I;++I)Ka[1020+I]=-128>I?-128:127<I?127:I;for(I=-112;112>=I;++I)ul[112+I]=-16>I?-16:15<I?15:I;for(I=-255;510>=I;++I)Yh[255+I]=0>I?0:255<I?255:I;tr=1}Io=bt,Es=Jc,Ei=hc,Ss=dc,wa=dt,ja=Cs,xc=Jl,Al=To,Ts=Jh,qa=VA,ys=Xh,Si=Yl,Lo=jA,bn=qu,wn=Xl,bi=Eo,wi=ma,xa=GA,In[0]=Co,In[1]=pe,In[2]=ju,In[3]=HA,In[4]=pa,In[5]=es,In[6]=Zc,In[7]=fc,In[8]=tl,In[9]=ql,Ba[0]=Bi,Ba[1]=cr,Ba[2]=Qr,Ba[3]=qn,Ba[4]=zn,Ba[5]=Vu,Ba[6]=Yc,ta[0]=Zr,ta[1]=Ue,ta[2]=Kl,ta[3]=ga,ta[4]=Fi,ta[5]=$l,ta[6]=rs,I=1}else I=0}I&&(I=function(zt,me){for(zt.M=0;zt.M<zt.Va;++zt.M){var Wt,Ot=zt.Jc[zt.M&zt.Xb],Nt=zt.m,be=zt;for(Wt=0;Wt<be.za;++Wt){var ve=Nt,he=be,Le=he.Ac,Oe=he.Bc+4*Wt,sr=he.zc,Ge=he.ya[he.aa+Wt];if(he.Qa.Bb?Ge.$b=oe(ve,he.Pa.jb[0])?2+oe(ve,he.Pa.jb[2]):oe(ve,he.Pa.jb[1]):Ge.$b=0,he.kc&&(Ge.Ad=oe(ve,he.Bd)),Ge.Za=!oe(ve,145)+0,Ge.Za){var zr=Ge.Ob,Hr=0;for(he=0;4>he;++he){var tn,Sr=sr[0+he];for(tn=0;4>tn;++tn){Sr=Mr[Le[Oe+tn]][Sr];for(var pn=eu[oe(ve,Sr[0])];0<pn;)pn=eu[2*pn+oe(ve,Sr[pn])];Sr=-pn,Le[Oe+tn]=Sr}n(zr,Hr,Le,Oe,4),Hr+=4,sr[0+he]=Sr}}else Sr=oe(ve,156)?oe(ve,128)?1:3:oe(ve,163)?2:0,Ge.Ob[0]=Sr,i(Le,Oe,Sr,4),i(sr,0,Sr,4);Ge.Dd=oe(ve,142)?oe(ve,114)?oe(ve,183)?1:3:2:0}if(be.m.Ka)return kr(zt,7,"Premature end-of-partition0 encountered.");for(;zt.ja<zt.za;++zt.ja){if(be=Ot,ve=(Nt=zt).rb[Nt.sb-1],Le=Nt.rb[Nt.sb+Nt.ja],Wt=Nt.ya[Nt.aa+Nt.ja],Oe=Nt.kc?Wt.Ad:0)ve.la=Le.la=0,Wt.Za||(ve.Na=Le.Na=0),Wt.Hc=0,Wt.Gc=0,Wt.ia=0;else{var hn,Gr;if(ve=Le,Le=be,Oe=Nt.Pa.Xc,sr=Nt.ya[Nt.aa+Nt.ja],Ge=Nt.pb[sr.$b],he=sr.ad,zr=0,Hr=Nt.rb[Nt.sb-1],Sr=tn=0,i(he,zr,0,384),sr.Za)var Yn=0,Pi=Oe[3];else{pn=s(16);var vn=ve.Na+Hr.Na;if(vn=sA(Le,Oe[1],vn,Ge.Eb,0,pn,0),ve.Na=Hr.Na=(0<vn)+0,1<vn)Io(pn,0,he,zr);else{var Fn=pn[0]+3>>3;for(pn=0;256>pn;pn+=16)he[zr+pn]=Fn}Yn=1,Pi=Oe[0]}var en=15&ve.la,Ui=15&Hr.la;for(pn=0;4>pn;++pn){var Bn=1&Ui;for(Fn=Gr=0;4>Fn;++Fn)en=en>>1|(Bn=(vn=sA(Le,Pi,vn=Bn+(1&en),Ge.Sc,Yn,he,zr))>Yn)<<7,Gr=Gr<<2|(3<vn?3:1<vn?2:he[zr+0]!=0),zr+=16;en>>=4,Ui=Ui>>1|Bn<<7,tn=(tn<<8|Gr)>>>0}for(Pi=en,Yn=Ui>>4,hn=0;4>hn;hn+=2){for(Gr=0,en=ve.la>>4+hn,Ui=Hr.la>>4+hn,pn=0;2>pn;++pn){for(Bn=1&Ui,Fn=0;2>Fn;++Fn)vn=Bn+(1&en),en=en>>1|(Bn=0<(vn=sA(Le,Oe[2],vn,Ge.Qc,0,he,zr)))<<3,Gr=Gr<<2|(3<vn?3:1<vn?2:he[zr+0]!=0),zr+=16;en>>=2,Ui=Ui>>1|Bn<<5}Sr|=Gr<<4*hn,Pi|=en<<4<<hn,Yn|=(240&Ui)<<hn}ve.la=Pi,Hr.la=Yn,sr.Hc=tn,sr.Gc=Sr,sr.ia=43690&Sr?0:Ge.ia,Oe=!(tn|Sr)}if(0<Nt.L&&(Nt.wa[Nt.Y+Nt.ja]=Nt.gd[Wt.$b][Wt.Za],Nt.wa[Nt.Y+Nt.ja].La|=!Oe),be.Ka)return kr(zt,7,"Premature end-of-file encountered.")}if(on(zt),Nt=me,be=1,Wt=(Ot=zt).D,ve=0<Ot.L&&Ot.M>=Ot.zb&&Ot.M<=Ot.Va,Ot.Aa==0)t:{if(Wt.M=Ot.M,Wt.uc=ve,qA(Ot,Wt),be=1,Wt=(Gr=Ot.D).Nb,ve=(Sr=$[Ot.L])*Ot.R,Le=Sr/2*Ot.B,pn=16*Wt*Ot.R,Fn=8*Wt*Ot.B,Oe=Ot.sa,sr=Ot.ta-ve+pn,Ge=Ot.qa,he=Ot.ra-Le+Fn,zr=Ot.Ha,Hr=Ot.Ia-Le+Fn,Ui=(en=Gr.M)==0,tn=en>=Ot.Va-1,Ot.Aa==2&&qA(Ot,Gr),Gr.uc)for(Bn=(vn=Ot).D.M,t(vn.D.uc),Gr=vn.yb;Gr<vn.Hb;++Gr){Yn=Gr,Pi=Bn;var gn=(Mn=(Hn=vn).D).Nb;hn=Hn.R;var Mn=Mn.wa[Mn.Y+Yn],mn=Hn.sa,Vi=Hn.ta+16*gn*hn+16*Yn,ro=Mn.dd,Ri=Mn.tc;if(Ri!=0)if(t(3<=Ri),Hn.L==1)0<Yn&&bi(mn,Vi,hn,Ri+4),Mn.La&&xa(mn,Vi,hn,Ri),0<Pi&&wn(mn,Vi,hn,Ri+4),Mn.La&&wi(mn,Vi,hn,Ri);else{var Ca=Hn.B,fl=Hn.qa,Cc=Hn.ra+8*gn*Ca+8*Yn,is=Hn.Ha,Hn=Hn.Ia+8*gn*Ca+8*Yn;gn=Mn.ld,0<Yn&&(Al(mn,Vi,hn,Ri+4,ro,gn),qa(fl,Cc,is,Hn,Ca,Ri+4,ro,gn)),Mn.La&&(Si(mn,Vi,hn,Ri,ro,gn),bn(fl,Cc,is,Hn,Ca,Ri,ro,gn)),0<Pi&&(xc(mn,Vi,hn,Ri+4,ro,gn),Ts(fl,Cc,is,Hn,Ca,Ri+4,ro,gn)),Mn.La&&(ys(mn,Vi,hn,Ri,ro,gn),Lo(fl,Cc,is,Hn,Ca,Ri,ro,gn))}}if(Ot.ia&&alert("todo:DitherRow"),Nt.put!=null){if(Gr=16*en,en=16*(en+1),Ui?(Nt.y=Ot.sa,Nt.O=Ot.ta+pn,Nt.f=Ot.qa,Nt.N=Ot.ra+Fn,Nt.ea=Ot.Ha,Nt.W=Ot.Ia+Fn):(Gr-=Sr,Nt.y=Oe,Nt.O=sr,Nt.f=Ge,Nt.N=he,Nt.ea=zr,Nt.W=Hr),tn||(en-=Sr),en>Nt.o&&(en=Nt.o),Nt.F=null,Nt.J=null,Ot.Fa!=null&&0<Ot.Fa.length&&Gr<en&&(Nt.J=tA(Ot,Nt,Gr,en-Gr),Nt.F=Ot.mb,Nt.F==null&&Nt.F.length==0)){be=kr(Ot,3,"Could not decode alpha data.");break t}Gr<Nt.j&&(Sr=Nt.j-Gr,Gr=Nt.j,t(!(1&Sr)),Nt.O+=Ot.R*Sr,Nt.N+=Ot.B*(Sr>>1),Nt.W+=Ot.B*(Sr>>1),Nt.F!=null&&(Nt.J+=Nt.width*Sr)),Gr<en&&(Nt.O+=Nt.v,Nt.N+=Nt.v>>1,Nt.W+=Nt.v>>1,Nt.F!=null&&(Nt.J+=Nt.v),Nt.ka=Gr-Nt.j,Nt.U=Nt.va-Nt.v,Nt.T=en-Gr,be=Nt.put(Nt))}Wt+1!=Ot.Ic||tn||(n(Ot.sa,Ot.ta-ve,Oe,sr+16*Ot.R,ve),n(Ot.qa,Ot.ra-Le,Ge,he+8*Ot.B,Le),n(Ot.Ha,Ot.Ia-Le,zr,Hr+8*Ot.B,Le))}if(!be)return kr(zt,6,"Output aborted.")}return 1}(y,S)),S.bc!=null&&S.bc(S),I&=1}return I?(y.cb=0,I):0}function An(y,S,I,O,V){V=y[S+I+32*O]+(V>>3),y[S+I+32*O]=-256&V?0>V?0:255:V}function Li(y,S,I,O,V,H){An(y,S,0,I,O+V),An(y,S,1,I,O+H),An(y,S,2,I,O-H),An(y,S,3,I,O-V)}function jn(y){return(20091*y>>16)+y}function fa(y,S,I,O){var V,H=0,q=s(16);for(V=0;4>V;++V){var X=y[S+0]+y[S+8],Z=y[S+0]-y[S+8],ot=(35468*y[S+4]>>16)-jn(y[S+12]),xt=jn(y[S+4])+(35468*y[S+12]>>16);q[H+0]=X+xt,q[H+1]=Z+ot,q[H+2]=Z-ot,q[H+3]=X-xt,H+=4,S++}for(V=H=0;4>V;++V)X=(y=q[H+0]+4)+q[H+8],Z=y-q[H+8],ot=(35468*q[H+4]>>16)-jn(q[H+12]),An(I,O,0,0,X+(xt=jn(q[H+4])+(35468*q[H+12]>>16))),An(I,O,1,0,Z+ot),An(I,O,2,0,Z-ot),An(I,O,3,0,X-xt),H++,O+=32}function Cs(y,S,I,O){var V=y[S+0]+4,H=35468*y[S+4]>>16,q=jn(y[S+4]),X=35468*y[S+1]>>16;Li(I,O,0,V+q,y=jn(y[S+1]),X),Li(I,O,1,V+H,y,X),Li(I,O,2,V-H,y,X),Li(I,O,3,V-q,y,X)}function Jc(y,S,I,O,V){fa(y,S,I,O),V&&fa(y,S+16,I,O+4)}function hc(y,S,I,O){Es(y,S+0,I,O,1),Es(y,S+32,I,O+128,1)}function dc(y,S,I,O){var V;for(y=y[S+0]+4,V=0;4>V;++V)for(S=0;4>S;++S)An(I,O,S,V,y)}function dt(y,S,I,O){y[S+0]&&Ss(y,S+0,I,O),y[S+16]&&Ss(y,S+16,I,O+4),y[S+32]&&Ss(y,S+32,I,O+128),y[S+48]&&Ss(y,S+48,I,O+128+4)}function bt(y,S,I,O){var V,H=s(16);for(V=0;4>V;++V){var q=y[S+0+V]+y[S+12+V],X=y[S+4+V]+y[S+8+V],Z=y[S+4+V]-y[S+8+V],ot=y[S+0+V]-y[S+12+V];H[0+V]=q+X,H[8+V]=q-X,H[4+V]=ot+Z,H[12+V]=ot-Z}for(V=0;4>V;++V)q=(y=H[0+4*V]+3)+H[3+4*V],X=H[1+4*V]+H[2+4*V],Z=H[1+4*V]-H[2+4*V],ot=y-H[3+4*V],I[O+0]=q+X>>3,I[O+16]=ot+Z>>3,I[O+32]=q-X>>3,I[O+48]=ot-Z>>3,O+=64}function jt(y,S,I){var O,V=S-32,H=to,q=255-y[V-1];for(O=0;O<I;++O){var X,Z=H,ot=q+y[S-1];for(X=0;X<I;++X)y[S+X]=Z[ot+y[V+X]];S+=32}}function pe(y,S){jt(y,S,4)}function Ue(y,S){jt(y,S,8)}function cr(y,S){jt(y,S,16)}function Qr(y,S){var I;for(I=0;16>I;++I)n(y,S+32*I,y,S-32,16)}function qn(y,S){var I;for(I=16;0<I;--I)i(y,S,y[S-1],16),S+=32}function ti(y,S,I){var O;for(O=0;16>O;++O)i(S,I+32*O,y,16)}function Bi(y,S){var I,O=16;for(I=0;16>I;++I)O+=y[S-1+32*I]+y[S+I-32];ti(O>>5,y,S)}function zn(y,S){var I,O=8;for(I=0;16>I;++I)O+=y[S-1+32*I];ti(O>>4,y,S)}function Vu(y,S){var I,O=8;for(I=0;16>I;++I)O+=y[S+I-32];ti(O>>4,y,S)}function Yc(y,S){ti(128,y,S)}function $r(y,S,I){return y+2*S+I+2>>2}function ju(y,S){var I,O=S-32;for(O=new Uint8Array([$r(y[O-1],y[O+0],y[O+1]),$r(y[O+0],y[O+1],y[O+2]),$r(y[O+1],y[O+2],y[O+3]),$r(y[O+2],y[O+3],y[O+4])]),I=0;4>I;++I)n(y,S+32*I,O,0,O.length)}function HA(y,S){var I=y[S-1],O=y[S-1+32],V=y[S-1+64],H=y[S-1+96];Ce(y,S+0,16843009*$r(y[S-1-32],I,O)),Ce(y,S+32,16843009*$r(I,O,V)),Ce(y,S+64,16843009*$r(O,V,H)),Ce(y,S+96,16843009*$r(V,H,H))}function Co(y,S){var I,O=4;for(I=0;4>I;++I)O+=y[S+I-32]+y[S-1+32*I];for(O>>=3,I=0;4>I;++I)i(y,S+32*I,O,4)}function pa(y,S){var I=y[S-1+0],O=y[S-1+32],V=y[S-1+64],H=y[S-1-32],q=y[S+0-32],X=y[S+1-32],Z=y[S+2-32],ot=y[S+3-32];y[S+0+96]=$r(O,V,y[S-1+96]),y[S+1+96]=y[S+0+64]=$r(I,O,V),y[S+2+96]=y[S+1+64]=y[S+0+32]=$r(H,I,O),y[S+3+96]=y[S+2+64]=y[S+1+32]=y[S+0+0]=$r(q,H,I),y[S+3+64]=y[S+2+32]=y[S+1+0]=$r(X,q,H),y[S+3+32]=y[S+2+0]=$r(Z,X,q),y[S+3+0]=$r(ot,Z,X)}function Zc(y,S){var I=y[S+1-32],O=y[S+2-32],V=y[S+3-32],H=y[S+4-32],q=y[S+5-32],X=y[S+6-32],Z=y[S+7-32];y[S+0+0]=$r(y[S+0-32],I,O),y[S+1+0]=y[S+0+32]=$r(I,O,V),y[S+2+0]=y[S+1+32]=y[S+0+64]=$r(O,V,H),y[S+3+0]=y[S+2+32]=y[S+1+64]=y[S+0+96]=$r(V,H,q),y[S+3+32]=y[S+2+64]=y[S+1+96]=$r(H,q,X),y[S+3+64]=y[S+2+96]=$r(q,X,Z),y[S+3+96]=$r(X,Z,Z)}function es(y,S){var I=y[S-1+0],O=y[S-1+32],V=y[S-1+64],H=y[S-1-32],q=y[S+0-32],X=y[S+1-32],Z=y[S+2-32],ot=y[S+3-32];y[S+0+0]=y[S+1+64]=H+q+1>>1,y[S+1+0]=y[S+2+64]=q+X+1>>1,y[S+2+0]=y[S+3+64]=X+Z+1>>1,y[S+3+0]=Z+ot+1>>1,y[S+0+96]=$r(V,O,I),y[S+0+64]=$r(O,I,H),y[S+0+32]=y[S+1+96]=$r(I,H,q),y[S+1+32]=y[S+2+96]=$r(H,q,X),y[S+2+32]=y[S+3+96]=$r(q,X,Z),y[S+3+32]=$r(X,Z,ot)}function fc(y,S){var I=y[S+0-32],O=y[S+1-32],V=y[S+2-32],H=y[S+3-32],q=y[S+4-32],X=y[S+5-32],Z=y[S+6-32],ot=y[S+7-32];y[S+0+0]=I+O+1>>1,y[S+1+0]=y[S+0+64]=O+V+1>>1,y[S+2+0]=y[S+1+64]=V+H+1>>1,y[S+3+0]=y[S+2+64]=H+q+1>>1,y[S+0+32]=$r(I,O,V),y[S+1+32]=y[S+0+96]=$r(O,V,H),y[S+2+32]=y[S+1+96]=$r(V,H,q),y[S+3+32]=y[S+2+96]=$r(H,q,X),y[S+3+64]=$r(q,X,Z),y[S+3+96]=$r(X,Z,ot)}function ql(y,S){var I=y[S-1+0],O=y[S-1+32],V=y[S-1+64],H=y[S-1+96];y[S+0+0]=I+O+1>>1,y[S+2+0]=y[S+0+32]=O+V+1>>1,y[S+2+32]=y[S+0+64]=V+H+1>>1,y[S+1+0]=$r(I,O,V),y[S+3+0]=y[S+1+32]=$r(O,V,H),y[S+3+32]=y[S+1+64]=$r(V,H,H),y[S+3+64]=y[S+2+64]=y[S+0+96]=y[S+1+96]=y[S+2+96]=y[S+3+96]=H}function tl(y,S){var I=y[S-1+0],O=y[S-1+32],V=y[S-1+64],H=y[S-1+96],q=y[S-1-32],X=y[S+0-32],Z=y[S+1-32],ot=y[S+2-32];y[S+0+0]=y[S+2+32]=I+q+1>>1,y[S+0+32]=y[S+2+64]=O+I+1>>1,y[S+0+64]=y[S+2+96]=V+O+1>>1,y[S+0+96]=H+V+1>>1,y[S+3+0]=$r(X,Z,ot),y[S+2+0]=$r(q,X,Z),y[S+1+0]=y[S+3+32]=$r(I,q,X),y[S+1+32]=y[S+3+64]=$r(O,I,q),y[S+1+64]=y[S+3+96]=$r(V,O,I),y[S+1+96]=$r(H,V,O)}function Kl(y,S){var I;for(I=0;8>I;++I)n(y,S+32*I,y,S-32,8)}function ga(y,S){var I;for(I=0;8>I;++I)i(y,S,y[S-1],8),S+=32}function Us(y,S,I){var O;for(O=0;8>O;++O)i(S,I+32*O,y,8)}function Zr(y,S){var I,O=8;for(I=0;8>I;++I)O+=y[S+I-32]+y[S-1+32*I];Us(O>>4,y,S)}function $l(y,S){var I,O=4;for(I=0;8>I;++I)O+=y[S+I-32];Us(O>>3,y,S)}function Fi(y,S){var I,O=4;for(I=0;8>I;++I)O+=y[S-1+32*I];Us(O>>3,y,S)}function rs(y,S){Us(128,y,S)}function pc(y,S,I){var O=y[S-I],V=y[S+0],H=3*(V-O)+WA[1020+y[S-2*I]-y[S+I]],q=nA[112+(H+4>>3)];y[S-I]=to[255+O+nA[112+(H+3>>3)]],y[S+0]=to[255+V-q]}function el(y,S,I,O){var V=y[S+0],H=y[S+I];return ks[255+y[S-2*I]-y[S-I]]>O||ks[255+H-V]>O}function rl(y,S,I,O){return 4*ks[255+y[S-I]-y[S+0]]+ks[255+y[S-2*I]-y[S+I]]<=O}function Wl(y,S,I,O,V){var H=y[S-3*I],q=y[S-2*I],X=y[S-I],Z=y[S+0],ot=y[S+I],xt=y[S+2*I],Lt=y[S+3*I];return 4*ks[255+X-Z]+ks[255+q-ot]>O?0:ks[255+y[S-4*I]-H]<=V&&ks[255+H-q]<=V&&ks[255+q-X]<=V&&ks[255+Lt-xt]<=V&&ks[255+xt-ot]<=V&&ks[255+ot-Z]<=V}function Xl(y,S,I,O){var V=2*O+1;for(O=0;16>O;++O)rl(y,S+O,I,V)&&pc(y,S+O,I)}function Eo(y,S,I,O){var V=2*O+1;for(O=0;16>O;++O)rl(y,S+O*I,1,V)&&pc(y,S+O*I,1)}function ma(y,S,I,O){var V;for(V=3;0<V;--V)Xl(y,S+=4*I,I,O)}function GA(y,S,I,O){var V;for(V=3;0<V;--V)Eo(y,S+=4,I,O)}function Wo(y,S,I,O,V,H,q,X){for(H=2*H+1;0<V--;){if(Wl(y,S,I,H,q))if(el(y,S,I,X))pc(y,S,I);else{var Z=y,ot=S,xt=I,Lt=Z[ot-2*xt],kt=Z[ot-xt],zt=Z[ot+0],me=Z[ot+xt],Wt=Z[ot+2*xt],Ot=27*(be=WA[1020+3*(zt-kt)+WA[1020+Lt-me]])+63>>7,Nt=18*be+63>>7,be=9*be+63>>7;Z[ot-3*xt]=to[255+Z[ot-3*xt]+be],Z[ot-2*xt]=to[255+Lt+Nt],Z[ot-xt]=to[255+kt+Ot],Z[ot+0]=to[255+zt-Ot],Z[ot+xt]=to[255+me-Nt],Z[ot+2*xt]=to[255+Wt-be]}S+=O}}function So(y,S,I,O,V,H,q,X){for(H=2*H+1;0<V--;){if(Wl(y,S,I,H,q))if(el(y,S,I,X))pc(y,S,I);else{var Z=y,ot=S,xt=I,Lt=Z[ot-xt],kt=Z[ot+0],zt=Z[ot+xt],me=nA[112+((Wt=3*(kt-Lt))+4>>3)],Wt=nA[112+(Wt+3>>3)],Ot=me+1>>1;Z[ot-2*xt]=to[255+Z[ot-2*xt]+Ot],Z[ot-xt]=to[255+Lt+Wt],Z[ot+0]=to[255+kt-me],Z[ot+xt]=to[255+zt-Ot]}S+=O}}function Jl(y,S,I,O,V,H){Wo(y,S,I,1,16,O,V,H)}function To(y,S,I,O,V,H){Wo(y,S,1,I,16,O,V,H)}function Xh(y,S,I,O,V,H){var q;for(q=3;0<q;--q)So(y,S+=4*I,I,1,16,O,V,H)}function Yl(y,S,I,O,V,H){var q;for(q=3;0<q;--q)So(y,S+=4,1,I,16,O,V,H)}function Jh(y,S,I,O,V,H,q,X){Wo(y,S,V,1,8,H,q,X),Wo(I,O,V,1,8,H,q,X)}function VA(y,S,I,O,V,H,q,X){Wo(y,S,1,V,8,H,q,X),Wo(I,O,1,V,8,H,q,X)}function jA(y,S,I,O,V,H,q,X){So(y,S+4*V,V,1,8,H,q,X),So(I,O+4*V,V,1,8,H,q,X)}function qu(y,S,I,O,V,H,q,X){So(y,S+4,1,V,8,H,q,X),So(I,O+4,1,V,8,H,q,X)}function gc(){this.ba=new Un,this.ec=[],this.cc=[],this.Mc=[],this.Dc=this.Nc=this.dc=this.fc=0,this.Oa=new sn,this.memory=0,this.Ib="OutputFunc",this.Jb="OutputAlphaFunc",this.Nd="OutputRowFunc"}function mc(){this.data=[],this.offset=this.kd=this.ha=this.w=0,this.na=[],this.xa=this.gb=this.Ja=this.Sa=this.P=0}function nl(){this.nc=this.Ea=this.b=this.hc=0,this.K=[],this.w=0}function Zl(){this.ua=0,this.Wa=new Ut,this.vb=new Ut,this.md=this.xc=this.wc=0,this.vc=[],this.Wb=0,this.Ya=new vt,this.yc=new At}function yc(){this.xb=this.a=0,this.l=new za,this.ca=new Un,this.V=[],this.Ba=0,this.Ta=[],this.Ua=0,this.m=new rt,this.Pb=0,this.wd=new rt,this.Ma=this.$=this.C=this.i=this.c=this.xd=0,this.s=new Zl,this.ab=0,this.gc=a(4,nl),this.Oc=0}function il(){this.Lc=this.Z=this.$a=this.i=this.c=0,this.l=new za,this.ic=0,this.ca=[],this.tb=0,this.qd=null,this.rd=0}function _c(y,S,I,O,V,H,q){for(y=y==null?0:y[S+0],S=0;S<q;++S)V[H+S]=y+I[O+S]&255,y=V[H+S]}function sl(y,S,I,O,V,H,q){var X;if(y==null)_c(null,null,I,O,V,H,q);else for(X=0;X<q;++X)V[H+X]=y[S+X]+I[O+X]&255}function Rs(y,S,I,O,V,H,q){if(y==null)_c(null,null,I,O,V,H,q);else{var X,Z=y[S+0],ot=Z,xt=Z;for(X=0;X<q;++X)ot=xt+(Z=y[S+X])-ot,xt=I[O+X]+(-256&ot?0>ot?0:255:ot)&255,ot=Z,V[H+X]=xt}}function tA(y,S,I,O){var V=S.width,H=S.o;if(t(y!=null&&S!=null),0>I||0>=O||I+O>H)return null;if(!y.Cc){if(y.ga==null){var q;if(y.ga=new il,(q=y.ga==null)||(q=S.width*S.o,t(y.Gb.length==0),y.Gb=s(q),y.Uc=0,y.Gb==null?q=0:(y.mb=y.Gb,y.nb=y.Uc,y.rc=null,q=1),q=!q),!q){q=y.ga;var X=y.Fa,Z=y.P,ot=y.qc,xt=y.mb,Lt=y.nb,kt=Z+1,zt=ot-1,me=q.l;if(t(X!=null&&xt!=null&&S!=null),Qs[0]=null,Qs[1]=_c,Qs[2]=sl,Qs[3]=Rs,q.ca=xt,q.tb=Lt,q.c=S.width,q.i=S.height,t(0<q.c&&0<q.i),1>=ot)S=0;else if(q.$a=X[Z+0]>>0&3,q.Z=X[Z+0]>>2&3,q.Lc=X[Z+0]>>4&3,Z=X[Z+0]>>6&3,0>q.$a||1<q.$a||4<=q.Z||1<q.Lc||Z)S=0;else if(me.put=Tt,me.ac=gt,me.bc=Ft,me.ma=q,me.width=S.width,me.height=S.height,me.Da=S.Da,me.v=S.v,me.va=S.va,me.j=S.j,me.o=S.o,q.$a)t:{t(q.$a==1),S=jr();e:for(;;){if(S==null){S=0;break t}if(t(q!=null),q.mc=S,S.c=q.c,S.i=q.i,S.l=q.l,S.l.ma=q,S.l.width=q.c,S.l.height=q.i,S.a=0,te(S.m,X,kt,zt),!Fr(q.c,q.i,1,S,null)||(S.ab==1&&S.gc[0].hc==3&&dr(S.s)?(q.ic=1,X=S.c*S.i,S.Ta=null,S.Ua=0,S.V=s(X),S.Ba=0,S.V==null?(S.a=1,S=0):S=1):(q.ic=0,S=Rt(S,q.c)),!S))break e;S=1;break t}q.mc=null,S=0}else S=zt>=q.c*q.i;q=!S}if(q)return null;y.ga.Lc!=1?y.Ga=0:O=H-I}t(y.ga!=null),t(I+O<=H);t:{if(S=(X=y.ga).c,H=X.l.o,X.$a==0){if(kt=y.rc,zt=y.Vc,me=y.Fa,Z=y.P+1+I*S,ot=y.mb,xt=y.nb+I*S,t(Z<=y.P+y.qc),X.Z!=0)for(t(Qs[X.Z]!=null),q=0;q<O;++q)Qs[X.Z](kt,zt,me,Z,ot,xt,S),kt=ot,zt=xt,xt+=S,Z+=S;else for(q=0;q<O;++q)n(ot,xt,me,Z,S),kt=ot,zt=xt,xt+=S,Z+=S;y.rc=kt,y.Vc=zt}else{if(t(X.mc!=null),S=I+O,t((q=X.mc)!=null),t(S<=q.i),q.C>=S)S=1;else if(X.ic||Zt(),X.ic){X=q.V,kt=q.Ba,zt=q.c;var Wt=q.i,Ot=(me=1,Z=q.$/zt,ot=q.$%zt,xt=q.m,Lt=q.s,q.$),Nt=zt*Wt,be=zt*S,ve=Lt.wc,he=Ot<be?ye(Lt,ot,Z):null;t(Ot<=Nt),t(S<=Wt),t(dr(Lt));e:for(;;){for(;!xt.h&&Ot<be;){if(ot&ve||(he=ye(Lt,ot,Z)),t(he!=null),Jt(xt),256>(Wt=$t(he.G[0],he.H[0],xt)))X[kt+Ot]=Wt,++Ot,++ot>=zt&&(ot=0,++Z<=S&&!(Z%16)&&or(q,Z));else{if(!(280>Wt)){me=0;break e}Wt=Vt(Wt-256,xt);var Le,Oe=$t(he.G[4],he.H[4],xt);if(Jt(xt),!(Ot>=(Oe=Qt(zt,Oe=Vt(Oe,xt)))&&Nt-Ot>=Wt)){me=0;break e}for(Le=0;Le<Wt;++Le)X[kt+Ot+Le]=X[kt+Ot+Le-Oe];for(Ot+=Wt,ot+=Wt;ot>=zt;)ot-=zt,++Z<=S&&!(Z%16)&&or(q,Z);Ot<be&&ot&ve&&(he=ye(Lt,ot,Z))}t(xt.h==St(xt))}or(q,Z>S?S:Z);break e}!me||xt.h&&Ot<Nt?(me=0,q.a=xt.h?5:3):q.$=Ot,S=me}else S=_r(q,q.V,q.Ba,q.c,q.i,S,Qe);if(!S){O=0;break t}}I+O>=H&&(y.Cc=1),O=1}if(!O)return null;if(y.Cc&&((O=y.ga)!=null&&(O.mc=null),y.ga=null,0<y.Ga))return alert("todo:WebPDequantizeLevels"),null}return y.nb+I*V}function U(y,S,I,O,V,H){for(;0<V--;){var q,X=y,Z=S+(I?1:0),ot=y,xt=S+(I?0:3);for(q=0;q<O;++q){var Lt=ot[xt+4*q];Lt!=255&&(Lt*=32897,X[Z+4*q+0]=X[Z+4*q+0]*Lt>>23,X[Z+4*q+1]=X[Z+4*q+1]*Lt>>23,X[Z+4*q+2]=X[Z+4*q+2]*Lt>>23)}S+=H}}function nt(y,S,I,O,V){for(;0<O--;){var H;for(H=0;H<I;++H){var q=y[S+2*H+0],X=15&(ot=y[S+2*H+1]),Z=4369*X,ot=(240&ot|ot>>4)*Z>>16;y[S+2*H+0]=(240&q|q>>4)*Z>>16&240|(15&q|q<<4)*Z>>16>>4&15,y[S+2*H+1]=240&ot|X}S+=V}}function Pt(y,S,I,O,V,H,q,X){var Z,ot,xt=255;for(ot=0;ot<V;++ot){for(Z=0;Z<O;++Z){var Lt=y[S+Z];H[q+4*Z]=Lt,xt&=Lt}S+=I,q+=X}return xt!=255}function Yt(y,S,I,O,V){var H;for(H=0;H<V;++H)I[O+H]=y[S+H]>>8}function Zt(){Jo=U,Yo=nt,Fo=Pt,ar=Yt}function ge(y,S,I){ft[y]=function(O,V,H,q,X,Z,ot,xt,Lt,kt,zt,me,Wt,Ot,Nt,be,ve){var he,Le=ve-1>>1,Oe=X[Z+0]|ot[xt+0]<<16,sr=Lt[kt+0]|zt[me+0]<<16;t(O!=null);var Ge=3*Oe+sr+131074>>2;for(S(O[V+0],255&Ge,Ge>>16,Wt,Ot),H!=null&&(Ge=3*sr+Oe+131074>>2,S(H[q+0],255&Ge,Ge>>16,Nt,be)),he=1;he<=Le;++he){var zr=X[Z+he]|ot[xt+he]<<16,Hr=Lt[kt+he]|zt[me+he]<<16,tn=Oe+zr+sr+Hr+524296,Sr=tn+2*(zr+sr)>>3;Ge=Sr+Oe>>1,Oe=(tn=tn+2*(Oe+Hr)>>3)+zr>>1,S(O[V+2*he-1],255&Ge,Ge>>16,Wt,Ot+(2*he-1)*I),S(O[V+2*he-0],255&Oe,Oe>>16,Wt,Ot+(2*he-0)*I),H!=null&&(Ge=tn+sr>>1,Oe=Sr+Hr>>1,S(H[q+2*he-1],255&Ge,Ge>>16,Nt,be+(2*he-1)*I),S(H[q+2*he+0],255&Oe,Oe>>16,Nt,be+(2*he+0)*I)),Oe=zr,sr=Hr}1&ve||(Ge=3*Oe+sr+131074>>2,S(O[V+ve-1],255&Ge,Ge>>16,Wt,Ot+(ve-1)*I),H!=null&&(Ge=3*sr+Oe+131074>>2,S(H[q+ve-1],255&Ge,Ge>>16,Nt,be+(ve-1)*I)))}}function ze(){xn[XA]=ai,xn[JA]=aA,xn[Zh]=oA,xn[$u]=cA,xn[iA]=Bc,xn[YA]=th,xn[Wu]=id,xn[ZA]=aA,xn[_s]=cA,xn[Zo]=Bc,xn[hl]=th}function Me(y){return y&~l?0>y?0:255:y>>w}function Ir(y,S){return Me((19077*y>>8)+(26149*S>>8)-14234)}function mr(y,S,I){return Me((19077*y>>8)-(6419*S>>8)-(13320*I>>8)+8708)}function wr(y,S){return Me((19077*y>>8)+(33050*S>>8)-17685)}function un(y,S,I,O,V){O[V+0]=Ir(y,I),O[V+1]=mr(y,S,I),O[V+2]=wr(y,S)}function si(y,S,I,O,V){O[V+0]=wr(y,S),O[V+1]=mr(y,S,I),O[V+2]=Ir(y,I)}function hi(y,S,I,O,V){var H=mr(y,S,I);S=H<<3&224|wr(y,S)>>3,O[V+0]=248&Ir(y,I)|H>>5,O[V+1]=S}function di(y,S,I,O,V){var H=240&wr(y,S)|15;O[V+0]=240&Ir(y,I)|mr(y,S,I)>>4,O[V+1]=H}function Mi(y,S,I,O,V){O[V+0]=255,un(y,S,I,O,V+1)}function Ci(y,S,I,O,V){si(y,S,I,O,V),O[V+3]=255}function Ds(y,S,I,O,V){un(y,S,I,O,V),O[V+3]=255}function Os(y,S){return 0>y?0:y>S?S:y}function Zs(y,S,I){ft[y]=function(O,V,H,q,X,Z,ot,xt,Lt){for(var kt=xt+(-2&Lt)*I;xt!=kt;)S(O[V+0],H[q+0],X[Z+0],ot,xt),S(O[V+1],H[q+0],X[Z+0],ot,xt+I),V+=2,++q,++Z,xt+=2*I;1&Lt&&S(O[V+0],H[q+0],X[Z+0],ot,xt)}}function vc(y,S,I){return I==0?y==0?S==0?6:5:S==0?4:0:I}function Ha(y,S,I,O,V){switch(y>>>30){case 3:Es(S,I,O,V,0);break;case 2:ja(S,I,O,V);break;case 1:Ss(S,I,O,V)}}function qA(y,S){var I,O,V=S.M,H=S.Nb,q=y.oc,X=y.pc+40,Z=y.oc,ot=y.pc+584,xt=y.oc,Lt=y.pc+600;for(I=0;16>I;++I)q[X+32*I-1]=129;for(I=0;8>I;++I)Z[ot+32*I-1]=129,xt[Lt+32*I-1]=129;for(0<V?q[X-1-32]=Z[ot-1-32]=xt[Lt-1-32]=129:(i(q,X-32-1,127,21),i(Z,ot-32-1,127,9),i(xt,Lt-32-1,127,9)),O=0;O<y.za;++O){var kt=S.ya[S.aa+O];if(0<O){for(I=-1;16>I;++I)n(q,X+32*I-4,q,X+32*I+12,4);for(I=-1;8>I;++I)n(Z,ot+32*I-4,Z,ot+32*I+4,4),n(xt,Lt+32*I-4,xt,Lt+32*I+4,4)}var zt=y.Gd,me=y.Hd+O,Wt=kt.ad,Ot=kt.Hc;if(0<V&&(n(q,X-32,zt[me].y,0,16),n(Z,ot-32,zt[me].f,0,8),n(xt,Lt-32,zt[me].ea,0,8)),kt.Za){var Nt=q,be=X-32+16;for(0<V&&(O>=y.za-1?i(Nt,be,zt[me].y[15],4):n(Nt,be,zt[me+1].y,0,4)),I=0;4>I;I++)Nt[be+128+I]=Nt[be+256+I]=Nt[be+384+I]=Nt[be+0+I];for(I=0;16>I;++I,Ot<<=2)Nt=q,be=X+G[I],In[kt.Ob[I]](Nt,be),Ha(Ot,Wt,16*+I,Nt,be)}else if(Nt=vc(O,V,kt.Ob[0]),Ba[Nt](q,X),Ot!=0)for(I=0;16>I;++I,Ot<<=2)Ha(Ot,Wt,16*+I,q,X+G[I]);for(I=kt.Gc,Nt=vc(O,V,kt.Dd),ta[Nt](Z,ot),ta[Nt](xt,Lt),Ot=Wt,Nt=Z,be=ot,255&(kt=I>>0)&&(170&kt?Ei(Ot,256,Nt,be):wa(Ot,256,Nt,be)),kt=xt,Ot=Lt,255&(I>>=8)&&(170&I?Ei(Wt,320,kt,Ot):wa(Wt,320,kt,Ot)),V<y.Ub-1&&(n(zt[me].y,0,q,X+480,16),n(zt[me].f,0,Z,ot+224,8),n(zt[me].ea,0,xt,Lt+224,8)),I=8*H*y.B,zt=y.sa,me=y.ta+16*O+16*H*y.R,Wt=y.qa,kt=y.ra+8*O+I,Ot=y.Ha,Nt=y.Ia+8*O+I,I=0;16>I;++I)n(zt,me+I*y.R,q,X+32*I,16);for(I=0;8>I;++I)n(Wt,kt+I*y.B,Z,ot+32*I,8),n(Ot,Nt+I*y.B,xt,Lt+32*I,8)}}function bc(y,S,I,O,V,H,q,X,Z){var ot=[0],xt=[0],Lt=0,kt=Z!=null?Z.kd:0,zt=Z??new mc;if(y==null||12>I)return 7;zt.data=y,zt.w=S,zt.ha=I,S=[S],I=[I],zt.gb=[zt.gb];t:{var me=S,Wt=I,Ot=zt.gb;if(t(y!=null),t(Wt!=null),t(Ot!=null),Ot[0]=0,12<=Wt[0]&&!e(y,me[0],"RIFF")){if(e(y,me[0]+8,"WEBP")){Ot=3;break t}var Nt=Ke(y,me[0]+4);if(12>Nt||4294967286<Nt){Ot=3;break t}if(kt&&Nt>Wt[0]-8){Ot=7;break t}Ot[0]=Nt,me[0]+=12,Wt[0]-=12}Ot=0}if(Ot!=0)return Ot;for(Nt=0<zt.gb[0],I=I[0];;){t:{var be=y;Wt=S,Ot=I;var ve=ot,he=xt,Le=me=[0];if((Ge=Lt=[Lt])[0]=0,8>Ot[0])Ot=7;else{if(!e(be,Wt[0],"VP8X")){if(Ke(be,Wt[0]+4)!=10){Ot=3;break t}if(18>Ot[0]){Ot=7;break t}var Oe=Ke(be,Wt[0]+8),sr=1+Ve(be,Wt[0]+12);if(2147483648<=sr*(be=1+Ve(be,Wt[0]+15))){Ot=3;break t}Le!=null&&(Le[0]=Oe),ve!=null&&(ve[0]=sr),he!=null&&(he[0]=be),Wt[0]+=18,Ot[0]-=18,Ge[0]=1}Ot=0}}if(Lt=Lt[0],me=me[0],Ot!=0)return Ot;if(Wt=!!(2&me),!Nt&&Lt)return 3;if(H!=null&&(H[0]=!!(16&me)),q!=null&&(q[0]=Wt),X!=null&&(X[0]=0),q=ot[0],me=xt[0],Lt&&Wt&&Z==null){Ot=0;break}if(4>I){Ot=7;break}if(Nt&&Lt||!Nt&&!Lt&&!e(y,S[0],"ALPH")){I=[I],zt.na=[zt.na],zt.P=[zt.P],zt.Sa=[zt.Sa];t:{Oe=y,Ot=S,Nt=I;var Ge=zt.gb;ve=zt.na,he=zt.P,Le=zt.Sa,sr=22,t(Oe!=null),t(Nt!=null),be=Ot[0];var zr=Nt[0];for(t(ve!=null),t(Le!=null),ve[0]=null,he[0]=null,Le[0]=0;;){if(Ot[0]=be,Nt[0]=zr,8>zr){Ot=7;break t}var Hr=Ke(Oe,be+4);if(4294967286<Hr){Ot=3;break t}var tn=8+Hr+1&-2;if(sr+=tn,0<Ge&&sr>Ge){Ot=3;break t}if(!e(Oe,be,"VP8 ")||!e(Oe,be,"VP8L")){Ot=0;break t}if(zr[0]<tn){Ot=7;break t}e(Oe,be,"ALPH")||(ve[0]=Oe,he[0]=be+8,Le[0]=Hr),be+=tn,zr-=tn}}if(I=I[0],zt.na=zt.na[0],zt.P=zt.P[0],zt.Sa=zt.Sa[0],Ot!=0)break}I=[I],zt.Ja=[zt.Ja],zt.xa=[zt.xa];t:if(Ge=y,Ot=S,Nt=I,ve=zt.gb[0],he=zt.Ja,Le=zt.xa,Oe=Ot[0],be=!e(Ge,Oe,"VP8 "),sr=!e(Ge,Oe,"VP8L"),t(Ge!=null),t(Nt!=null),t(he!=null),t(Le!=null),8>Nt[0])Ot=7;else{if(be||sr){if(Ge=Ke(Ge,Oe+4),12<=ve&&Ge>ve-12){Ot=3;break t}if(kt&&Ge>Nt[0]-8){Ot=7;break t}he[0]=Ge,Ot[0]+=8,Nt[0]-=8,Le[0]=sr}else Le[0]=5<=Nt[0]&&Ge[Oe+0]==47&&!(Ge[Oe+4]>>5),he[0]=Nt[0];Ot=0}if(I=I[0],zt.Ja=zt.Ja[0],zt.xa=zt.xa[0],S=S[0],Ot!=0)break;if(4294967286<zt.Ja)return 3;if(X==null||Wt||(X[0]=zt.xa?2:1),q=[q],me=[me],zt.xa){if(5>I){Ot=7;break}X=q,kt=me,Wt=H,y==null||5>I?y=0:5<=I&&y[S+0]==47&&!(y[S+4]>>5)?(Nt=[0],Ge=[0],ve=[0],te(he=new rt,y,S,I),Ht(he,Nt,Ge,ve)?(X!=null&&(X[0]=Nt[0]),kt!=null&&(kt[0]=Ge[0]),Wt!=null&&(Wt[0]=ve[0]),y=1):y=0):y=0}else{if(10>I){Ot=7;break}X=me,y==null||10>I||!Bo(y,S+3,I-3)?y=0:(kt=y[S+0]|y[S+1]<<8|y[S+2]<<16,Wt=16383&(y[S+7]<<8|y[S+6]),y=16383&(y[S+9]<<8|y[S+8]),1&kt||3<(kt>>1&7)||!(kt>>4&1)||kt>>5>=zt.Ja||!Wt||!y?y=0:(q&&(q[0]=Wt),X&&(X[0]=y),y=1))}if(!y||(q=q[0],me=me[0],Lt&&(ot[0]!=q||xt[0]!=me)))return 3;Z!=null&&(Z[0]=zt,Z.offset=S-Z.w,t(4294967286>S-Z.w),t(Z.offset==Z.ha-I));break}return Ot==0||Ot==7&&Lt&&Z==null?(H!=null&&(H[0]|=zt.na!=null&&0<zt.na.length),O!=null&&(O[0]=q),V!=null&&(V[0]=me),0):Ot}function KA(y,S,I){var O=S.width,V=S.height,H=0,q=0,X=O,Z=V;if(S.Da=y!=null&&0<y.Da,S.Da&&(X=y.cd,Z=y.bd,H=y.v,q=y.j,11>I||(H&=-2,q&=-2),0>H||0>q||0>=X||0>=Z||H+X>O||q+Z>V))return 0;if(S.v=H,S.j=q,S.va=H+X,S.o=q+Z,S.U=X,S.T=Z,S.da=y!=null&&0<y.da,S.da){if(!pr(X,Z,I=[y.ib],H=[y.hb]))return 0;S.ib=I[0],S.hb=H[0]}return S.ob=y!=null&&y.ob,S.Kb=y==null||!y.Sd,S.da&&(S.ob=S.ib<3*O/4&&S.hb<3*V/4,S.Kb=0),1}function eA(y){if(y==null)return 2;if(11>y.S){var S=y.f.RGBA;S.fb+=(y.height-1)*S.A,S.A=-S.A}else S=y.f.kb,y=y.height,S.O+=(y-1)*S.fa,S.fa=-S.fa,S.N+=(y-1>>1)*S.Ab,S.Ab=-S.Ab,S.W+=(y-1>>1)*S.Db,S.Db=-S.Db,S.F!=null&&(S.J+=(y-1)*S.lb,S.lb=-S.lb);return 0}function Ga(y,S,I,O){if(O==null||0>=y||0>=S)return 2;if(I!=null){if(I.Da){var V=I.cd,H=I.bd,q=-2&I.v,X=-2&I.j;if(0>q||0>X||0>=V||0>=H||q+V>y||X+H>S)return 2;y=V,S=H}if(I.da){if(!pr(y,S,V=[I.ib],H=[I.hb]))return 2;y=V[0],S=H[0]}}O.width=y,O.height=S;t:{var Z=O.width,ot=O.height;if(y=O.S,0>=Z||0>=ot||!(y>=XA&&13>y))y=2;else{if(0>=O.Rd&&O.sd==null){q=H=V=S=0;var xt=(X=Z*Ct[y])*ot;if(11>y||(H=(ot+1)/2*(S=(Z+1)/2),y==12&&(q=(V=Z)*ot)),(ot=s(xt+2*H+q))==null){y=1;break t}O.sd=ot,11>y?((Z=O.f.RGBA).eb=ot,Z.fb=0,Z.A=X,Z.size=xt):((Z=O.f.kb).y=ot,Z.O=0,Z.fa=X,Z.Fd=xt,Z.f=ot,Z.N=0+xt,Z.Ab=S,Z.Cd=H,Z.ea=ot,Z.W=0+xt+H,Z.Db=S,Z.Ed=H,y==12&&(Z.F=ot,Z.J=0+xt+2*H),Z.Tc=q,Z.lb=V)}if(S=1,V=O.S,H=O.width,q=O.height,V>=XA&&13>V)if(11>V)y=O.f.RGBA,S&=(X=Math.abs(y.A))*(q-1)+H<=y.size,S&=X>=H*Ct[V],S&=y.eb!=null;else{y=O.f.kb,X=(H+1)/2,xt=(q+1)/2,Z=Math.abs(y.fa),ot=Math.abs(y.Ab);var Lt=Math.abs(y.Db),kt=Math.abs(y.lb),zt=kt*(q-1)+H;S&=Z*(q-1)+H<=y.Fd,S&=ot*(xt-1)+X<=y.Cd,S=(S&=Lt*(xt-1)+X<=y.Ed)&Z>=H&ot>=X&Lt>=X,S&=y.y!=null,S&=y.f!=null,S&=y.ea!=null,V==12&&(S&=kt>=H,S&=zt<=y.Tc,S&=y.F!=null)}else S=0;y=S?0:2}}return y!=0||I!=null&&I.fd&&(y=eA(O)),y}var ps=64,ol=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215],al=24,ya=32,wc=8,ns=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];Kt("Predictor0","PredictorAdd0"),ft.Predictor0=function(){return 4278190080},ft.Predictor1=function(y){return y},ft.Predictor2=function(y,S,I){return S[I+0]},ft.Predictor3=function(y,S,I){return S[I+1]},ft.Predictor4=function(y,S,I){return S[I-1]},ft.Predictor5=function(y,S,I){return ke(ke(y,S[I+1]),S[I+0])},ft.Predictor6=function(y,S,I){return ke(y,S[I-1])},ft.Predictor7=function(y,S,I){return ke(y,S[I+0])},ft.Predictor8=function(y,S,I){return ke(S[I-1],S[I+0])},ft.Predictor9=function(y,S,I){return ke(S[I+0],S[I+1])},ft.Predictor10=function(y,S,I){return ke(ke(y,S[I-1]),ke(S[I+0],S[I+1]))},ft.Predictor11=function(y,S,I){var O=S[I+0];return 0>=xr(O>>24&255,y>>24&255,(S=S[I-1])>>24&255)+xr(O>>16&255,y>>16&255,S>>16&255)+xr(O>>8&255,y>>8&255,S>>8&255)+xr(255&O,255&y,255&S)?O:y},ft.Predictor12=function(y,S,I){var O=S[I+0];return(He((y>>24&255)+(O>>24&255)-((S=S[I-1])>>24&255))<<24|He((y>>16&255)+(O>>16&255)-(S>>16&255))<<16|He((y>>8&255)+(O>>8&255)-(S>>8&255))<<8|He((255&y)+(255&O)-(255&S)))>>>0},ft.Predictor13=function(y,S,I){var O=S[I-1];return(De((y=ke(y,S[I+0]))>>24&255,O>>24&255)<<24|De(y>>16&255,O>>16&255)<<16|De(y>>8&255,O>>8&255)<<8|De(y>>0&255,O>>0&255))>>>0};var Ku=ft.PredictorAdd0;ft.PredictorAdd1=Pr,Kt("Predictor2","PredictorAdd2"),Kt("Predictor3","PredictorAdd3"),Kt("Predictor4","PredictorAdd4"),Kt("Predictor5","PredictorAdd5"),Kt("Predictor6","PredictorAdd6"),Kt("Predictor7","PredictorAdd7"),Kt("Predictor8","PredictorAdd8"),Kt("Predictor9","PredictorAdd9"),Kt("Predictor10","PredictorAdd10"),Kt("Predictor11","PredictorAdd11"),Kt("Predictor12","PredictorAdd12"),Kt("Predictor13","PredictorAdd13");var Kn=ft.PredictorAdd2;Ur("ColorIndexInverseTransform","MapARGB","32b",function(y){return y>>8&255},function(y){return y}),Ur("VP8LColorIndexInverseTransformAlpha","MapAlpha","8b",function(y){return y},function(y){return y>>8&255});var _a,oi=ft.ColorIndexInverseTransform,va=ft.MapARGB,cl=ft.VP8LColorIndexInverseTransformAlpha,rA=ft.MapAlpha,Ns=ft.VP8LPredictorsAdd=[];Ns.length=16,(ft.VP8LPredictors=[]).length=16,(ft.VP8LPredictorsAdd_C=[]).length=16,(ft.VP8LPredictors_C=[]).length=16;var gs,ms,Va,Xo,ba,ll,Io,Es,ja,Ei,Ss,wa,xc,Al,Ts,qa,ys,Si,Lo,bn,wn,bi,wi,xa,Jo,Yo,Fo,ar,$A=s(511),Ka=s(2041),ul=s(225),Yh=s(767),tr=0,WA=Ka,nA=ul,to=Yh,ks=$A,XA=0,JA=1,Zh=2,$u=3,iA=4,YA=5,Wu=6,ZA=7,_s=8,Zo=9,hl=10,td=[2,3,7],tu=[3,3,11],Xu=[280,256,256,256,40],Gf=[0,1,1,1,0],eo=[17,18,0,1,2,3,4,5,16,6,7,8,9,10,11,12,13,14,15],Jn=[24,7,23,25,40,6,39,41,22,26,38,42,56,5,55,57,21,27,54,58,37,43,72,4,71,73,20,28,53,59,70,74,36,44,88,69,75,52,60,3,87,89,19,29,86,90,35,45,68,76,85,91,51,61,104,2,103,105,18,30,102,106,34,46,84,92,67,77,101,107,50,62,120,1,119,121,83,93,17,31,100,108,66,78,118,122,33,47,117,123,49,63,99,109,82,94,0,116,124,65,79,16,32,98,110,48,115,125,81,95,64,114,126,97,111,80,113,127,96,112],Ju=[2954,2956,2958,2962,2970,2986,3018,3082,3212,3468,3980,5004],ed=8,Yu=[4,5,6,7,8,9,10,10,11,12,13,14,15,16,17,17,18,19,20,20,21,21,22,22,23,23,24,25,25,26,27,28,29,30,31,32,33,34,35,36,37,37,38,39,40,41,42,43,44,45,46,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,76,77,78,79,80,81,82,83,84,85,86,87,88,89,91,93,95,96,98,100,101,102,104,106,108,110,112,114,116,118,122,124,126,128,130,132,134,136,138,140,143,145,148,151,154,157],Zu=[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,119,122,125,128,131,134,137,140,143,146,149,152,155,158,161,164,167,170,173,177,181,185,189,193,197,201,205,209,213,217,221,225,229,234,239,245,249,254,259,264,269,274,279,284],sA=null,tm=[[173,148,140,0],[176,155,140,135,0],[180,157,141,134,130,0],[254,254,243,230,196,177,153,140,133,130,129,0]],Is=[0,1,4,8,5,2,3,6,9,12,13,10,7,11,14,15],eu=[-0,1,-1,2,-2,3,4,6,-3,5,-4,-5,-6,7,-7,8,-8,-9],vr=[[[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]],[[253,136,254,255,228,219,128,128,128,128,128],[189,129,242,255,227,213,255,219,128,128,128],[106,126,227,252,214,209,255,255,128,128,128]],[[1,98,248,255,236,226,255,255,128,128,128],[181,133,238,254,221,234,255,154,128,128,128],[78,134,202,247,198,180,255,219,128,128,128]],[[1,185,249,255,243,255,128,128,128,128,128],[184,150,247,255,236,224,128,128,128,128,128],[77,110,216,255,236,230,128,128,128,128,128]],[[1,101,251,255,241,255,128,128,128,128,128],[170,139,241,252,236,209,255,255,128,128,128],[37,116,196,243,228,255,255,255,128,128,128]],[[1,204,254,255,245,255,128,128,128,128,128],[207,160,250,255,238,128,128,128,128,128,128],[102,103,231,255,211,171,128,128,128,128,128]],[[1,152,252,255,240,255,128,128,128,128,128],[177,135,243,255,234,225,128,128,128,128,128],[80,129,211,255,194,224,128,128,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[246,1,255,128,128,128,128,128,128,128,128],[255,128,128,128,128,128,128,128,128,128,128]]],[[[198,35,237,223,193,187,162,160,145,155,62],[131,45,198,221,172,176,220,157,252,221,1],[68,47,146,208,149,167,221,162,255,223,128]],[[1,149,241,255,221,224,255,255,128,128,128],[184,141,234,253,222,220,255,199,128,128,128],[81,99,181,242,176,190,249,202,255,255,128]],[[1,129,232,253,214,197,242,196,255,255,128],[99,121,210,250,201,198,255,202,128,128,128],[23,91,163,242,170,187,247,210,255,255,128]],[[1,200,246,255,234,255,128,128,128,128,128],[109,178,241,255,231,245,255,255,128,128,128],[44,130,201,253,205,192,255,255,128,128,128]],[[1,132,239,251,219,209,255,165,128,128,128],[94,136,225,251,218,190,255,255,128,128,128],[22,100,174,245,186,161,255,199,128,128,128]],[[1,182,249,255,232,235,128,128,128,128,128],[124,143,241,255,227,234,128,128,128,128,128],[35,77,181,251,193,211,255,205,128,128,128]],[[1,157,247,255,236,231,255,255,128,128,128],[121,141,235,255,225,227,255,255,128,128,128],[45,99,188,251,195,217,255,224,128,128,128]],[[1,1,251,255,213,255,128,128,128,128,128],[203,1,248,255,255,128,128,128,128,128,128],[137,1,177,255,224,255,128,128,128,128,128]]],[[[253,9,248,251,207,208,255,192,128,128,128],[175,13,224,243,193,185,249,198,255,255,128],[73,17,171,221,161,179,236,167,255,234,128]],[[1,95,247,253,212,183,255,255,128,128,128],[239,90,244,250,211,209,255,255,128,128,128],[155,77,195,248,188,195,255,255,128,128,128]],[[1,24,239,251,218,219,255,205,128,128,128],[201,51,219,255,196,186,128,128,128,128,128],[69,46,190,239,201,218,255,228,128,128,128]],[[1,191,251,255,255,128,128,128,128,128,128],[223,165,249,255,213,255,128,128,128,128,128],[141,124,248,255,255,128,128,128,128,128,128]],[[1,16,248,255,255,128,128,128,128,128,128],[190,36,230,255,236,255,128,128,128,128,128],[149,1,255,128,128,128,128,128,128,128,128]],[[1,226,255,128,128,128,128,128,128,128,128],[247,192,255,128,128,128,128,128,128,128,128],[240,128,255,128,128,128,128,128,128,128,128]],[[1,134,252,255,255,128,128,128,128,128,128],[213,62,250,255,255,128,128,128,128,128,128],[55,93,255,128,128,128,128,128,128,128,128]],[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]]],[[[202,24,213,235,186,191,220,160,240,175,255],[126,38,182,232,169,184,228,174,255,187,128],[61,46,138,219,151,178,240,170,255,216,128]],[[1,112,230,250,199,191,247,159,255,255,128],[166,109,228,252,211,215,255,174,128,128,128],[39,77,162,232,172,180,245,178,255,255,128]],[[1,52,220,246,198,199,249,220,255,255,128],[124,74,191,243,183,193,250,221,255,255,128],[24,71,130,219,154,170,243,182,255,255,128]],[[1,182,225,249,219,240,255,224,128,128,128],[149,150,226,252,216,205,255,171,128,128,128],[28,108,170,242,183,194,254,223,255,255,128]],[[1,81,230,252,204,203,255,192,128,128,128],[123,102,209,247,188,196,255,233,128,128,128],[20,95,153,243,164,173,255,203,128,128,128]],[[1,222,248,255,216,213,128,128,128,128,128],[168,175,246,252,235,205,255,255,128,128,128],[47,116,215,255,211,212,255,255,128,128,128]],[[1,121,236,253,212,214,255,255,128,128,128],[141,84,213,252,201,202,255,219,128,128,128],[42,80,160,240,162,185,255,205,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[244,1,255,128,128,128,128,128,128,128,128],[238,1,255,128,128,128,128,128,128,128,128]]]],Mr=[[[231,120,48,89,115,113,120,152,112],[152,179,64,126,170,118,46,70,95],[175,69,143,80,85,82,72,155,103],[56,58,10,171,218,189,17,13,152],[114,26,17,163,44,195,21,10,173],[121,24,80,195,26,62,44,64,85],[144,71,10,38,171,213,144,34,26],[170,46,55,19,136,160,33,206,71],[63,20,8,114,114,208,12,9,226],[81,40,11,96,182,84,29,16,36]],[[134,183,89,137,98,101,106,165,148],[72,187,100,130,157,111,32,75,80],[66,102,167,99,74,62,40,234,128],[41,53,9,178,241,141,26,8,107],[74,43,26,146,73,166,49,23,157],[65,38,105,160,51,52,31,115,128],[104,79,12,27,217,255,87,17,7],[87,68,71,44,114,51,15,186,23],[47,41,14,110,182,183,21,17,194],[66,45,25,102,197,189,23,18,22]],[[88,88,147,150,42,46,45,196,205],[43,97,183,117,85,38,35,179,61],[39,53,200,87,26,21,43,232,171],[56,34,51,104,114,102,29,93,77],[39,28,85,171,58,165,90,98,64],[34,22,116,206,23,34,43,166,73],[107,54,32,26,51,1,81,43,31],[68,25,106,22,64,171,36,225,114],[34,19,21,102,132,188,16,76,124],[62,18,78,95,85,57,50,48,51]],[[193,101,35,159,215,111,89,46,111],[60,148,31,172,219,228,21,18,111],[112,113,77,85,179,255,38,120,114],[40,42,1,196,245,209,10,25,109],[88,43,29,140,166,213,37,43,154],[61,63,30,155,67,45,68,1,209],[100,80,8,43,154,1,51,26,71],[142,78,78,16,255,128,34,197,171],[41,40,5,102,211,183,4,1,221],[51,50,17,168,209,192,23,25,82]],[[138,31,36,171,27,166,38,44,229],[67,87,58,169,82,115,26,59,179],[63,59,90,180,59,166,93,73,154],[40,40,21,116,143,209,34,39,175],[47,15,16,183,34,223,49,45,183],[46,17,33,183,6,98,15,32,183],[57,46,22,24,128,1,54,17,37],[65,32,73,115,28,128,23,128,205],[40,3,9,115,51,192,18,6,223],[87,37,9,115,59,77,64,21,47]],[[104,55,44,218,9,54,53,130,226],[64,90,70,205,40,41,23,26,57],[54,57,112,184,5,41,38,166,213],[30,34,26,133,152,116,10,32,134],[39,19,53,221,26,114,32,73,255],[31,9,65,234,2,15,1,118,73],[75,32,12,51,192,255,160,43,51],[88,31,35,67,102,85,55,186,85],[56,21,23,111,59,205,45,37,192],[55,38,70,124,73,102,1,34,98]],[[125,98,42,88,104,85,117,175,82],[95,84,53,89,128,100,113,101,45],[75,79,123,47,51,128,81,171,1],[57,17,5,71,102,57,53,41,49],[38,33,13,121,57,73,26,1,85],[41,10,67,138,77,110,90,47,114],[115,21,2,10,102,255,166,23,6],[101,29,16,10,85,128,101,196,26],[57,18,10,102,102,213,34,20,43],[117,20,15,36,163,128,68,1,26]],[[102,61,71,37,34,53,31,243,192],[69,60,71,38,73,119,28,222,37],[68,45,128,34,1,47,11,245,171],[62,17,19,70,146,85,55,62,70],[37,43,37,154,100,163,85,160,1],[63,9,92,136,28,64,32,201,85],[75,15,9,9,64,255,184,119,16],[86,6,28,5,64,255,25,248,1],[56,8,17,132,137,255,55,116,128],[58,15,20,82,135,57,26,121,40]],[[164,50,31,137,154,133,25,35,218],[51,103,44,131,131,123,31,6,158],[86,40,64,135,148,224,45,183,128],[22,26,17,131,240,154,14,1,209],[45,16,21,91,64,222,7,1,197],[56,21,39,155,60,138,23,102,213],[83,12,13,54,192,255,68,47,28],[85,26,85,85,128,128,32,146,171],[18,11,7,63,144,171,4,4,246],[35,27,10,146,174,171,12,26,128]],[[190,80,35,99,180,80,126,54,45],[85,126,47,87,176,51,41,20,32],[101,75,128,139,118,146,116,128,85],[56,41,15,176,236,85,37,9,62],[71,30,17,119,118,255,17,18,138],[101,38,60,138,55,70,43,26,142],[146,36,19,30,171,255,97,27,20],[138,45,61,62,219,1,81,188,64],[32,41,20,117,151,142,20,21,163],[112,19,12,61,195,128,48,4,24]]],ru=[[[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[176,246,255,255,255,255,255,255,255,255,255],[223,241,252,255,255,255,255,255,255,255,255],[249,253,253,255,255,255,255,255,255,255,255]],[[255,244,252,255,255,255,255,255,255,255,255],[234,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255]],[[255,246,254,255,255,255,255,255,255,255,255],[239,253,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[251,255,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[251,254,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,254,253,255,254,255,255,255,255,255,255],[250,255,254,255,254,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[217,255,255,255,255,255,255,255,255,255,255],[225,252,241,253,255,255,254,255,255,255,255],[234,250,241,250,253,255,253,254,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[223,254,254,255,255,255,255,255,255,255,255],[238,253,254,254,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[249,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,255,255,255,255,255,255,255,255,255],[247,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[252,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[186,251,250,255,255,255,255,255,255,255,255],[234,251,244,254,255,255,255,255,255,255,255],[251,251,243,253,254,255,254,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[236,253,254,255,255,255,255,255,255,255,255],[251,253,253,254,254,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[254,254,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[254,254,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[248,255,255,255,255,255,255,255,255,255,255],[250,254,252,254,255,255,255,255,255,255,255],[248,254,249,253,255,255,255,255,255,255,255]],[[255,253,253,255,255,255,255,255,255,255,255],[246,253,253,255,255,255,255,255,255,255,255],[252,254,251,254,254,255,255,255,255,255,255]],[[255,254,252,255,255,255,255,255,255,255,255],[248,254,253,255,255,255,255,255,255,255,255],[253,255,254,254,255,255,255,255,255,255,255]],[[255,251,254,255,255,255,255,255,255,255,255],[245,251,254,255,255,255,255,255,255,255,255],[253,253,254,255,255,255,255,255,255,255,255]],[[255,251,253,255,255,255,255,255,255,255,255],[252,253,254,255,255,255,255,255,255,255,255],[255,254,255,255,255,255,255,255,255,255,255]],[[255,252,255,255,255,255,255,255,255,255,255],[249,255,254,255,255,255,255,255,255,255,255],[255,255,254,255,255,255,255,255,255,255,255]],[[255,255,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]]],rd=[0,1,2,3,6,4,5,6,6,6,6,6,6,6,6,7,0],Ba=[],In=[],ta=[],Mo=1,nd=2,Qs=[],xn=[];ge("UpsampleRgbLinePair",un,3),ge("UpsampleBgrLinePair",si,3),ge("UpsampleRgbaLinePair",Ds,4),ge("UpsampleBgraLinePair",Ci,4),ge("UpsampleArgbLinePair",Mi,4),ge("UpsampleRgba4444LinePair",di,2),ge("UpsampleRgb565LinePair",hi,2);var ai=ft.UpsampleRgbLinePair,oA=ft.UpsampleBgrLinePair,aA=ft.UpsampleRgbaLinePair,cA=ft.UpsampleBgraLinePair,Bc=ft.UpsampleArgbLinePair,th=ft.UpsampleRgba4444LinePair,id=ft.UpsampleRgb565LinePair,$a=16,lA=1<<$a-1,dl=-227,_n=482,w=6,l=(256<<w)-1,d=0,m=s(256),v=s(256),E=s(256),F=s(256),M=s(_n-dl),N=s(_n-dl);Zs("YuvToRgbRow",un,3),Zs("YuvToBgrRow",si,3),Zs("YuvToRgbaRow",Ds,4),Zs("YuvToBgraRow",Ci,4),Zs("YuvToArgbRow",Mi,4),Zs("YuvToRgba4444Row",di,2),Zs("YuvToRgb565Row",hi,2);var G=[0,4,8,12,128,132,136,140,256,260,264,268,384,388,392,396],$=[0,2,8],J=[8,7,6,4,4,2,2,2,1,1,1,1],ct=1;this.WebPDecodeRGBA=function(y,S,I,O,V){var H=JA,q=new gc,X=new Un;q.ba=X,X.S=H,X.width=[X.width],X.height=[X.height];var Z=X.width,ot=X.height,xt=new qe;if(xt==null||y==null)var Lt=2;else t(xt!=null),Lt=bc(y,S,I,xt.width,xt.height,xt.Pd,xt.Qd,xt.format,null);if(Lt!=0?Z=0:(Z!=null&&(Z[0]=xt.width[0]),ot!=null&&(ot[0]=xt.height[0]),Z=1),Z){X.width=X.width[0],X.height=X.height[0],O!=null&&(O[0]=X.width),V!=null&&(V[0]=X.height);t:{if(O=new za,(V=new mc).data=y,V.w=S,V.ha=I,V.kd=1,S=[0],t(V!=null),((y=bc(V.data,V.w,V.ha,null,null,null,S,null,V))==0||y==7)&&S[0]&&(y=4),(S=y)==0){if(t(q!=null),O.data=V.data,O.w=V.w+V.offset,O.ha=V.ha-V.offset,O.put=Tt,O.ac=gt,O.bc=Ft,O.ma=q,V.xa){if((y=jr())==null){q=1;break t}if(function(kt,zt){var me=[0],Wt=[0],Ot=[0];e:for(;;){if(kt==null)return 0;if(zt==null)return kt.a=2,0;if(kt.l=zt,kt.a=0,te(kt.m,zt.data,zt.w,zt.ha),!Ht(kt.m,me,Wt,Ot)){kt.a=3;break e}if(kt.xb=nd,zt.width=me[0],zt.height=Wt[0],!Fr(me[0],Wt[0],1,kt,null))break e;return 1}return t(kt.a!=0),0}(y,O)){if(O=(S=Ga(O.width,O.height,q.Oa,q.ba))==0){e:{O=y;r:for(;;){if(O==null){O=0;break e}if(t(O.s.yc!=null),t(O.s.Ya!=null),t(0<O.s.Wb),t((I=O.l)!=null),t((V=I.ma)!=null),O.xb!=0){if(O.ca=V.ba,O.tb=V.tb,t(O.ca!=null),!KA(V.Oa,I,$u)){O.a=2;break r}if(!Rt(O,I.width)||I.da)break r;if((I.da||Ze(O.ca.S))&&Zt(),11>O.ca.S||(alert("todo:WebPInitConvertARGBToYUV"),O.ca.f.kb.F!=null&&Zt()),O.Pb&&0<O.s.ua&&O.s.vb.X==null&&!rr(O.s.vb,O.s.Wa.Xa)){O.a=1;break r}O.xb=0}if(!_r(O,O.V,O.Ba,O.c,O.i,I.o,hr))break r;V.Dc=O.Ma,O=1;break e}t(O.a!=0),O=0}O=!O}O&&(S=y.a)}else S=y.a}else{if((y=new Ii)==null){q=1;break t}if(y.Fa=V.na,y.P=V.P,y.qc=V.Sa,Js(y,O)){if((S=Ga(O.width,O.height,q.Oa,q.ba))==0){if(y.Aa=0,I=q.Oa,t((V=y)!=null),I!=null){if(0<(Z=0>(Z=I.Md)?0:100<Z?255:255*Z/100)){for(ot=xt=0;4>ot;++ot)12>(Lt=V.pb[ot]).lc&&(Lt.ia=Z*J[0>Lt.lc?0:Lt.lc]>>3),xt|=Lt.ia;xt&&(alert("todo:VP8InitRandom"),V.ia=1)}V.Ga=I.Id,100<V.Ga?V.Ga=100:0>V.Ga&&(V.Ga=0)}Ys(y,O)||(S=y.a)}}else S=y.a}S==0&&q.Oa!=null&&q.Oa.fd&&(S=eA(q.ba))}q=S}H=q!=0?null:11>H?X.f.RGBA.eb:X.f.kb.y}else H=null;return H};var Ct=[3,4,3,4,4,2,2,4,4,4,2,1,1]};function f(ft,Dt){for(var It="",ut=0;ut<4;ut++)It+=String.fromCharCode(ft[Dt++]);return It}function g(ft,Dt){return(ft[Dt+0]<<0|ft[Dt+1]<<8|ft[Dt+2]<<16)>>>0}function b(ft,Dt){return(ft[Dt+0]<<0|ft[Dt+1]<<8|ft[Dt+2]<<16|ft[Dt+3]<<24)>>>0}new h;var C=[0],B=[0],R=[],D=new h,Q=r,k=function(ft,Dt){var It={},ut=0,At=!1,Bt=0,vt=0;if(It.frames=[],!function(wt,St,qt,Jt){for(var se=0;se<Jt;se++)if(wt[St+se]!=qt.charCodeAt(se))return!0;return!1}(ft,Dt,"RIFF",4)){var ne,ie;for(b(ft,Dt+=4),Dt+=8;Dt<ft.length;){var ae=f(ft,Dt),te=b(ft,Dt+=4);Dt+=4;var ce=te+(1&te);switch(ae){case"VP8 ":case"VP8L":It.frames[ut]===void 0&&(It.frames[ut]={}),(rt=It.frames[ut]).src_off=At?vt:Dt-8,rt.src_size=Bt+te+8,ut++,At&&(At=!1,Bt=0,vt=0);break;case"VP8X":(rt=It.header={}).feature_flags=ft[Dt];var le=Dt+4;rt.canvas_width=1+g(ft,le),le+=3,rt.canvas_height=1+g(ft,le),le+=3;break;case"ALPH":At=!0,Bt=ce+8,vt=Dt-8;break;case"ANIM":(rt=It.header).bgcolor=b(ft,Dt),le=Dt+4,rt.loop_count=(ne=ft)[(ie=le)+0]<<0|ne[ie+1]<<8,le+=2;break;case"ANMF":var Te,rt;(rt=It.frames[ut]={}).offset_x=2*g(ft,Dt),Dt+=3,rt.offset_y=2*g(ft,Dt),Dt+=3,rt.width=1+g(ft,Dt),Dt+=3,rt.height=1+g(ft,Dt),Dt+=3,rt.duration=g(ft,Dt),Dt+=3,Te=ft[Dt++],rt.dispose=1&Te,rt.blend=Te>>1&1}ae!="ANMF"&&(Dt+=ce)}return It}}(Q,0);k.response=Q,k.rgbaoutput=!0,k.dataurl=!1;var j=k.header?k.header:null,et=k.frames?k.frames:null;if(j){j.loop_counter=j.loop_count,C=[j.canvas_height],B=[j.canvas_width];for(var st=0;st<et.length&&et[st].blend!=0;st++);}var mt=et[0],pt=D.WebPDecodeRGBA(Q,mt.src_off,mt.src_size,B,C);mt.rgba=pt,mt.imgwidth=B[0],mt.imgheight=C[0];for(var yt=0;yt<B[0]*C[0]*4;yt++)R[yt]=pt[yt];return this.width=B,this.height=C,this.data=R,this}(function(r){var t=function(){return typeof Fw=="function"},e=function(C,B,R,D){var Q=4,k=a;switch(D){case r.image_compression.FAST:Q=1,k=s;break;case r.image_compression.MEDIUM:Q=6,k=o;break;case r.image_compression.SLOW:Q=9,k=h}C=n(C,B,R,k);var j=Fw(C,{level:Q});return r.__addimage__.arrayBufferToBinaryString(j)},n=function(C,B,R,D){for(var Q,k,j,et=C.length/B,st=new Uint8Array(C.length+et),mt=g(),pt=0;pt<et;pt+=1){if(j=pt*B,Q=C.subarray(j,j+B),D)st.set(D(Q,R,k),j+pt);else{for(var yt,ft=mt.length,Dt=[];yt<ft;yt+=1)Dt[yt]=mt[yt](Q,R,k);var It=b(Dt.concat());st.set(Dt[It],j+pt)}k=Q}return st},i=function(C){var B=Array.apply([],C);return B.unshift(0),B},s=function(C,B){var R,D=[],Q=C.length;D[0]=1;for(var k=0;k<Q;k+=1)R=C[k-B]||0,D[k+1]=C[k]-R+256&255;return D},a=function(C,B,R){var D,Q=[],k=C.length;Q[0]=2;for(var j=0;j<k;j+=1)D=R&&R[j]||0,Q[j+1]=C[j]-D+256&255;return Q},o=function(C,B,R){var D,Q,k=[],j=C.length;k[0]=3;for(var et=0;et<j;et+=1)D=C[et-B]||0,Q=R&&R[et]||0,k[et+1]=C[et]+256-(D+Q>>>1)&255;return k},h=function(C,B,R){var D,Q,k,j,et=[],st=C.length;et[0]=4;for(var mt=0;mt<st;mt+=1)D=C[mt-B]||0,Q=R&&R[mt]||0,k=R&&R[mt-B]||0,j=f(D,Q,k),et[mt+1]=C[mt]-j+256&255;return et},f=function(C,B,R){if(C===B&&B===R)return C;var D=Math.abs(B-R),Q=Math.abs(C-R),k=Math.abs(C+B-R-R);return D<=Q&&D<=k?C:Q<=k?B:R},g=function(){return[i,s,a,o,h]},b=function(C){var B=C.map(function(R){return R.reduce(function(D,Q){return D+Math.abs(Q)},0)});return B.indexOf(Math.min.apply(null,B))};r.processPNG=function(C,B,R,D){var Q,k,j,et,st,mt,pt,yt,ft,Dt,It,ut,At,Bt,vt,ne=this.decode.FLATE_DECODE,ie="";if(this.__addimage__.isArrayBuffer(C)&&(C=new Uint8Array(C)),this.__addimage__.isArrayBufferView(C)){if(C=(j=new Ftt(C)).imgData,k=j.bits,Q=j.colorSpace,st=j.colors,[4,6].indexOf(j.colorType)!==-1){if(j.bits===8){ft=(yt=j.pixelBitlength==32?new Uint32Array(j.decodePixels().buffer):j.pixelBitlength==16?new Uint16Array(j.decodePixels().buffer):new Uint8Array(j.decodePixels().buffer)).length,It=new Uint8Array(ft*j.colors),Dt=new Uint8Array(ft);var ae,te=j.pixelBitlength-j.bits;for(Bt=0,vt=0;Bt<ft;Bt++){for(At=yt[Bt],ae=0;ae<te;)It[vt++]=At>>>ae&255,ae+=j.bits;Dt[Bt]=At>>>ae&255}}if(j.bits===16){ft=(yt=new Uint32Array(j.decodePixels().buffer)).length,It=new Uint8Array(ft*(32/j.pixelBitlength)*j.colors),Dt=new Uint8Array(ft*(32/j.pixelBitlength)),ut=j.colors>1,Bt=0,vt=0;for(var ce=0;Bt<ft;)At=yt[Bt++],It[vt++]=At>>>0&255,ut&&(It[vt++]=At>>>16&255,At=yt[Bt++],It[vt++]=At>>>0&255),Dt[ce++]=At>>>16&255;k=8}D!==r.image_compression.NONE&&t()?(C=e(It,j.width*j.colors,j.colors,D),pt=e(Dt,j.width,1,D)):(C=It,pt=Dt,ne=void 0)}if(j.colorType===3&&(Q=this.color_spaces.INDEXED,mt=j.palette,j.transparency.indexed)){var le=j.transparency.indexed,Te=0;for(Bt=0,ft=le.length;Bt<ft;++Bt)Te+=le[Bt];if((Te/=255)===ft-1&&le.indexOf(0)!==-1)et=[le.indexOf(0)];else if(Te!==ft){for(yt=j.decodePixels(),Dt=new Uint8Array(yt.length),Bt=0,ft=yt.length;Bt<ft;Bt++)Dt[Bt]=le[yt[Bt]];pt=e(Dt,j.width,1)}}var rt=function(wt){var St;switch(wt){case r.image_compression.FAST:St=11;break;case r.image_compression.MEDIUM:St=13;break;case r.image_compression.SLOW:St=14;break;default:St=12}return St}(D);return ne===this.decode.FLATE_DECODE&&(ie="/Predictor "+rt+" "),ie+="/Colors "+st+" /BitsPerComponent "+k+" /Columns "+j.width,(this.__addimage__.isArrayBuffer(C)||this.__addimage__.isArrayBufferView(C))&&(C=this.__addimage__.arrayBufferToBinaryString(C)),(pt&&this.__addimage__.isArrayBuffer(pt)||this.__addimage__.isArrayBufferView(pt))&&(pt=this.__addimage__.arrayBufferToBinaryString(pt)),{alias:R,data:C,index:B,filter:ne,decodeParameters:ie,transparency:et,palette:mt,sMask:pt,predictor:rt,width:j.width,height:j.height,bitsPerComponent:k,colorSpace:Q}}}})(Xr.API),function(r){r.processGIF89A=function(t,e,n,i){var s=new Mtt(t),a=s.width,o=s.height,h=[];s.decodeAndBlitFrameRGBA(0,h);var f={data:h,width:a,height:o},g=new Gw(100).encode(f,100);return r.processJPEG.call(this,g,e,n,i)},r.processGIF87A=r.processGIF89A}(Xr.API),Qc.prototype.parseHeader=function(){if(this.fileSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.datav.getUint32(this.pos,!0),this.pos+=4,this.offset=this.datav.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.width=this.datav.getUint32(this.pos,!0),this.pos+=4,this.height=this.datav.getInt32(this.pos,!0),this.pos+=4,this.planes=this.datav.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.datav.getUint16(this.pos,!0),this.pos+=2,this.compress=this.datav.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.hr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.vr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.colors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.bitPP===16&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){var r=this.colors===0?1<<this.bitPP:this.colors;this.palette=new Array(r);for(var t=0;t<r;t++){var e=this.datav.getUint8(this.pos++,!0),n=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0);this.palette[t]={red:i,green:n,blue:e,quad:s}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)},Qc.prototype.parseBGR=function(){this.pos=this.offset;try{var r="bit"+this.bitPP,t=this.width*this.height*4;this.data=new Uint8Array(t),this[r]()}catch(e){ui.log("bit decode error:"+e)}},Qc.prototype.bit1=function(){var r,t=Math.ceil(this.width/8),e=t%4;for(r=this.height-1;r>=0;r--){for(var n=this.bottom_up?r:this.height-1-r,i=0;i<t;i++)for(var s=this.datav.getUint8(this.pos++,!0),a=n*this.width*4+8*i*4,o=0;o<8&&8*i+o<this.width;o++){var h=this.palette[s>>7-o&1];this.data[a+4*o]=h.blue,this.data[a+4*o+1]=h.green,this.data[a+4*o+2]=h.red,this.data[a+4*o+3]=255}e!==0&&(this.pos+=4-e)}},Qc.prototype.bit4=function(){for(var r=Math.ceil(this.width/2),t=r%4,e=this.height-1;e>=0;e--){for(var n=this.bottom_up?e:this.height-1-e,i=0;i<r;i++){var s=this.datav.getUint8(this.pos++,!0),a=n*this.width*4+2*i*4,o=s>>4,h=15&s,f=this.palette[o];if(this.data[a]=f.blue,this.data[a+1]=f.green,this.data[a+2]=f.red,this.data[a+3]=255,2*i+1>=this.width)break;f=this.palette[h],this.data[a+4]=f.blue,this.data[a+4+1]=f.green,this.data[a+4+2]=f.red,this.data[a+4+3]=255}t!==0&&(this.pos+=4-t)}},Qc.prototype.bit8=function(){for(var r=this.width%4,t=this.height-1;t>=0;t--){for(var e=this.bottom_up?t:this.height-1-t,n=0;n<this.width;n++){var i=this.datav.getUint8(this.pos++,!0),s=e*this.width*4+4*n;if(i<this.palette.length){var a=this.palette[i];this.data[s]=a.red,this.data[s+1]=a.green,this.data[s+2]=a.blue,this.data[s+3]=255}else this.data[s]=255,this.data[s+1]=255,this.data[s+2]=255,this.data[s+3]=255}r!==0&&(this.pos+=4-r)}},Qc.prototype.bit15=function(){for(var r=this.width%3,t=parseInt("11111",2),e=this.height-1;e>=0;e--){for(var n=this.bottom_up?e:this.height-1-e,i=0;i<this.width;i++){var s=this.datav.getUint16(this.pos,!0);this.pos+=2;var a=(s&t)/t*255|0,o=(s>>5&t)/t*255|0,h=(s>>10&t)/t*255|0,f=s>>15?255:0,g=n*this.width*4+4*i;this.data[g]=h,this.data[g+1]=o,this.data[g+2]=a,this.data[g+3]=f}this.pos+=r}},Qc.prototype.bit16=function(){for(var r=this.width%3,t=parseInt("11111",2),e=parseInt("111111",2),n=this.height-1;n>=0;n--){for(var i=this.bottom_up?n:this.height-1-n,s=0;s<this.width;s++){var a=this.datav.getUint16(this.pos,!0);this.pos+=2;var o=(a&t)/t*255|0,h=(a>>5&e)/e*255|0,f=(a>>11)/t*255|0,g=i*this.width*4+4*s;this.data[g]=f,this.data[g+1]=h,this.data[g+2]=o,this.data[g+3]=255}this.pos+=r}},Qc.prototype.bit24=function(){for(var r=this.height-1;r>=0;r--){for(var t=this.bottom_up?r:this.height-1-r,e=0;e<this.width;e++){var n=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0),a=t*this.width*4+4*e;this.data[a]=s,this.data[a+1]=i,this.data[a+2]=n,this.data[a+3]=255}this.pos+=this.width%4}},Qc.prototype.bit32=function(){for(var r=this.height-1;r>=0;r--)for(var t=this.bottom_up?r:this.height-1-r,e=0;e<this.width;e++){var n=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0),o=t*this.width*4+4*e;this.data[o]=s,this.data[o+1]=i,this.data[o+2]=n,this.data[o+3]=a}},Qc.prototype.getData=function(){return this.data},function(r){r.processBMP=function(t,e,n,i){var s=new Qc(t,!1),a=s.width,o=s.height,h={data:s.getData(),width:a,height:o},f=new Gw(100).encode(h,100);return r.processJPEG.call(this,f,e,n,i)}}(Xr.API),fF.prototype.getData=function(){return this.data},function(r){r.processWEBP=function(t,e,n,i){var s=new fF(t),a=s.width,o=s.height,h={data:s.getData(),width:a,height:o},f=new Gw(100).encode(h,100);return r.processJPEG.call(this,f,e,n,i)}}(Xr.API),Xr.API.processRGBA=function(r,t,e){for(var n=r.data,i=n.length,s=new Uint8Array(i/4*3),a=new Uint8Array(i/4),o=0,h=0,f=0;f<i;f+=4){var g=n[f],b=n[f+1],C=n[f+2],B=n[f+3];s[o++]=g,s[o++]=b,s[o++]=C,a[h++]=B}var R=this.__addimage__.arrayBufferToBinaryString(s);return{alpha:this.__addimage__.arrayBufferToBinaryString(a),data:R,index:t,alias:e,colorSpace:"DeviceRGB",bitsPerComponent:8,width:r.width,height:r.height}},Xr.API.setLanguage=function(r){return this.internal.languageSettings===void 0&&(this.internal.languageSettings={},this.internal.languageSettings.isSubscribed=!1),{af:"Afrikaans",sq:"Albanian",ar:"Arabic (Standard)","ar-DZ":"Arabic (Algeria)","ar-BH":"Arabic (Bahrain)","ar-EG":"Arabic (Egypt)","ar-IQ":"Arabic (Iraq)","ar-JO":"Arabic (Jordan)","ar-KW":"Arabic (Kuwait)","ar-LB":"Arabic (Lebanon)","ar-LY":"Arabic (Libya)","ar-MA":"Arabic (Morocco)","ar-OM":"Arabic (Oman)","ar-QA":"Arabic (Qatar)","ar-SA":"Arabic (Saudi Arabia)","ar-SY":"Arabic (Syria)","ar-TN":"Arabic (Tunisia)","ar-AE":"Arabic (U.A.E.)","ar-YE":"Arabic (Yemen)",an:"Aragonese",hy:"Armenian",as:"Assamese",ast:"Asturian",az:"Azerbaijani",eu:"Basque",be:"Belarusian",bn:"Bengali",bs:"Bosnian",br:"Breton",bg:"Bulgarian",my:"Burmese",ca:"Catalan",ch:"Chamorro",ce:"Chechen",zh:"Chinese","zh-HK":"Chinese (Hong Kong)","zh-CN":"Chinese (PRC)","zh-SG":"Chinese (Singapore)","zh-TW":"Chinese (Taiwan)",cv:"Chuvash",co:"Corsican",cr:"Cree",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch (Standard)","nl-BE":"Dutch (Belgian)",en:"English","en-AU":"English (Australia)","en-BZ":"English (Belize)","en-CA":"English (Canada)","en-IE":"English (Ireland)","en-JM":"English (Jamaica)","en-NZ":"English (New Zealand)","en-PH":"English (Philippines)","en-ZA":"English (South Africa)","en-TT":"English (Trinidad & Tobago)","en-GB":"English (United Kingdom)","en-US":"English (United States)","en-ZW":"English (Zimbabwe)",eo:"Esperanto",et:"Estonian",fo:"Faeroese",fj:"Fijian",fi:"Finnish",fr:"French (Standard)","fr-BE":"French (Belgium)","fr-CA":"French (Canada)","fr-FR":"French (France)","fr-LU":"French (Luxembourg)","fr-MC":"French (Monaco)","fr-CH":"French (Switzerland)",fy:"Frisian",fur:"Friulian",gd:"Gaelic (Scots)","gd-IE":"Gaelic (Irish)",gl:"Galacian",ka:"Georgian",de:"German (Standard)","de-AT":"German (Austria)","de-DE":"German (Germany)","de-LI":"German (Liechtenstein)","de-LU":"German (Luxembourg)","de-CH":"German (Switzerland)",el:"Greek",gu:"Gujurati",ht:"Haitian",he:"Hebrew",hi:"Hindi",hu:"Hungarian",is:"Icelandic",id:"Indonesian",iu:"Inuktitut",ga:"Irish",it:"Italian (Standard)","it-CH":"Italian (Switzerland)",ja:"Japanese",kn:"Kannada",ks:"Kashmiri",kk:"Kazakh",km:"Khmer",ky:"Kirghiz",tlh:"Klingon",ko:"Korean","ko-KP":"Korean (North Korea)","ko-KR":"Korean (South Korea)",la:"Latin",lv:"Latvian",lt:"Lithuanian",lb:"Luxembourgish",mk:"North Macedonia",ms:"Malay",ml:"Malayalam",mt:"Maltese",mi:"Maori",mr:"Marathi",mo:"Moldavian",nv:"Navajo",ng:"Ndonga",ne:"Nepali",no:"Norwegian",nb:"Norwegian (Bokmal)",nn:"Norwegian (Nynorsk)",oc:"Occitan",or:"Oriya",om:"Oromo",fa:"Persian","fa-IR":"Persian/Iran",pl:"Polish",pt:"Portuguese","pt-BR":"Portuguese (Brazil)",pa:"Punjabi","pa-IN":"Punjabi (India)","pa-PK":"Punjabi (Pakistan)",qu:"Quechua",rm:"Rhaeto-Romanic",ro:"Romanian","ro-MO":"Romanian (Moldavia)",ru:"Russian","ru-MO":"Russian (Moldavia)",sz:"Sami (Lappish)",sg:"Sango",sa:"Sanskrit",sc:"Sardinian",sd:"Sindhi",si:"Singhalese",sr:"Serbian",sk:"Slovak",sl:"Slovenian",so:"Somani",sb:"Sorbian",es:"Spanish","es-AR":"Spanish (Argentina)","es-BO":"Spanish (Bolivia)","es-CL":"Spanish (Chile)","es-CO":"Spanish (Colombia)","es-CR":"Spanish (Costa Rica)","es-DO":"Spanish (Dominican Republic)","es-EC":"Spanish (Ecuador)","es-SV":"Spanish (El Salvador)","es-GT":"Spanish (Guatemala)","es-HN":"Spanish (Honduras)","es-MX":"Spanish (Mexico)","es-NI":"Spanish (Nicaragua)","es-PA":"Spanish (Panama)","es-PY":"Spanish (Paraguay)","es-PE":"Spanish (Peru)","es-PR":"Spanish (Puerto Rico)","es-ES":"Spanish (Spain)","es-UY":"Spanish (Uruguay)","es-VE":"Spanish (Venezuela)",sx:"Sutu",sw:"Swahili",sv:"Swedish","sv-FI":"Swedish (Finland)","sv-SV":"Swedish (Sweden)",ta:"Tamil",tt:"Tatar",te:"Teluga",th:"Thai",tig:"Tigre",ts:"Tsonga",tn:"Tswana",tr:"Turkish",tk:"Turkmen",uk:"Ukrainian",hsb:"Upper Sorbian",ur:"Urdu",ve:"Venda",vi:"Vietnamese",vo:"Volapuk",wa:"Walloon",cy:"Welsh",xh:"Xhosa",ji:"Yiddish",zu:"Zulu"}[r]!==void 0&&(this.internal.languageSettings.languageCode=r,this.internal.languageSettings.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){this.internal.write("/Lang ("+this.internal.languageSettings.languageCode+")")}),this.internal.languageSettings.isSubscribed=!0)),this},cf=Xr.API,Z0=cf.getCharWidthsArray=function(r,t){var e,n,i=(t=t||{}).font||this.internal.getFont(),s=t.fontSize||this.internal.getFontSize(),a=t.charSpace||this.internal.getCharSpace(),o=t.widths?t.widths:i.metadata.Unicode.widths,h=o.fof?o.fof:1,f=t.kerning?t.kerning:i.metadata.Unicode.kerning,g=f.fof?f.fof:1,b=t.doKerning!==!1,C=0,B=r.length,R=0,D=o[0]||h,Q=[];for(e=0;e<B;e++)n=r.charCodeAt(e),typeof i.metadata.widthOfString=="function"?Q.push((i.metadata.widthOfGlyph(i.metadata.characterToGlyph(n))+a*(1e3/s)||0)/1e3):(C=b&&Nn(f[n])==="object"&&!isNaN(parseInt(f[n][R],10))?f[n][R]/g:0,Q.push((o[n]||D)/h+C)),R=n;return Q},AF=cf.getStringUnitWidth=function(r,t){var e=(t=t||{}).fontSize||this.internal.getFontSize(),n=t.font||this.internal.getFont(),i=t.charSpace||this.internal.getCharSpace();return cf.processArabic&&(r=cf.processArabic(r)),typeof n.metadata.widthOfString=="function"?n.metadata.widthOfString(r,e,i)/e:Z0.apply(this,arguments).reduce(function(s,a){return s+a},0)},uF=function(r,t,e,n){for(var i=[],s=0,a=r.length,o=0;s!==a&&o+t[s]<e;)o+=t[s],s++;i.push(r.slice(0,s));var h=s;for(o=0;s!==a;)o+t[s]>n&&(i.push(r.slice(h,s)),o=0,h=s),o+=t[s],s++;return h!==s&&i.push(r.slice(h,s)),i},hF=function(r,t,e){e||(e={});var n,i,s,a,o,h,f,g=[],b=[g],C=e.textIndent||0,B=0,R=0,D=r.split(" "),Q=Z0.apply(this,[" ",e])[0];if(h=e.lineIndent===-1?D[0].length+2:e.lineIndent||0){var k=Array(h).join(" "),j=[];D.map(function(st){(st=st.split(/\s*\n/)).length>1?j=j.concat(st.map(function(mt,pt){return(pt&&mt.length?`
`:"")+mt})):j.push(st[0])}),D=j,h=AF.apply(this,[k,e])}for(s=0,a=D.length;s<a;s++){var et=0;if(n=D[s],h&&n[0]==`
`&&(n=n.substr(1),et=1),C+B+(R=(i=Z0.apply(this,[n,e])).reduce(function(st,mt){return st+mt},0))>t||et){if(R>t){for(o=uF.apply(this,[n,i,t-(C+B),t]),g.push(o.shift()),g=[o.pop()];o.length;)b.push([o.shift()]);R=i.slice(n.length-(g[0]?g[0].length:0)).reduce(function(st,mt){return st+mt},0)}else g=[n];b.push(g),C=R+h,B=Q}else g.push(n),C+=B+R,B=Q}return f=h?function(st,mt){return(mt?k:"")+st.join(" ")}:function(st){return st.join(" ")},b.map(f)},cf.splitTextToSize=function(r,t,e){var n,i=(e=e||{}).fontSize||this.internal.getFontSize(),s=(function(g){if(g.widths&&g.kerning)return{widths:g.widths,kerning:g.kerning};var b=this.internal.getFont(g.fontName,g.fontStyle);return b.metadata.Unicode?{widths:b.metadata.Unicode.widths||{0:1},kerning:b.metadata.Unicode.kerning||{}}:{font:b.metadata,fontSize:this.internal.getFontSize(),charSpace:this.internal.getCharSpace()}}).call(this,e);n=Array.isArray(r)?r:String(r).split(/\r?\n/);var a=1*this.internal.scaleFactor*t/i;s.textIndent=e.textIndent?1*e.textIndent*this.internal.scaleFactor/i:0,s.lineIndent=e.lineIndent;var o,h,f=[];for(o=0,h=n.length;o<h;o++)f=f.concat(hF.apply(this,[n[o],a,s]));return f},function(r){r.__fontmetrics__=r.__fontmetrics__||{};for(var t="klmnopqrstuvwxyz",e={},n={},i=0;i<t.length;i++)e[t[i]]="0123456789abcdef"[i],n["0123456789abcdef"[i]]=t[i];var s=function(b){return"0x"+parseInt(b,10).toString(16)},a=r.__fontmetrics__.compress=function(b){var C,B,R,D,Q=["{"];for(var k in b){if(C=b[k],isNaN(parseInt(k,10))?B="'"+k+"'":(k=parseInt(k,10),B=(B=s(k).slice(2)).slice(0,-1)+n[B.slice(-1)]),typeof C=="number")C<0?(R=s(C).slice(3),D="-"):(R=s(C).slice(2),D=""),R=D+R.slice(0,-1)+n[R.slice(-1)];else{if(Nn(C)!=="object")throw new Error("Don't know what to do with value type "+Nn(C)+".");R=a(C)}Q.push(B+R)}return Q.push("}"),Q.join("")},o=r.__fontmetrics__.uncompress=function(b){if(typeof b!="string")throw new Error("Invalid argument passed to uncompress.");for(var C,B,R,D,Q={},k=1,j=Q,et=[],st="",mt="",pt=b.length-1,yt=1;yt<pt;yt+=1)(D=b[yt])=="'"?C?(R=C.join(""),C=void 0):C=[]:C?C.push(D):D=="{"?(et.push([j,R]),j={},R=void 0):D=="}"?((B=et.pop())[0][B[1]]=j,R=void 0,j=B[0]):D=="-"?k=-1:R===void 0?e.hasOwnProperty(D)?(st+=e[D],R=parseInt(st,16)*k,k=1,st=""):st+=D:e.hasOwnProperty(D)?(mt+=e[D],j[R]=parseInt(mt,16)*k,k=1,R=void 0,mt=""):mt+=D;return Q},h={codePages:["WinAnsiEncoding"],WinAnsiEncoding:o("{19m8n201n9q201o9r201s9l201t9m201u8m201w9n201x9o201y8o202k8q202l8r202m9p202q8p20aw8k203k8t203t8v203u9v2cq8s212m9t15m8w15n9w2dw9s16k8u16l9u17s9z17x8y17y9y}")},f={Unicode:{Courier:h,"Courier-Bold":h,"Courier-BoldOblique":h,"Courier-Oblique":h,Helvetica:h,"Helvetica-Bold":h,"Helvetica-BoldOblique":h,"Helvetica-Oblique":h,"Times-Roman":h,"Times-Bold":h,"Times-BoldItalic":h,"Times-Italic":h}},g={Unicode:{"Courier-Oblique":o("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-BoldItalic":o("{'widths'{k3o2q4ycx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2r202m2n2n3m2o3m2p5n202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5n4l4m4m4m4n4m4o4s4p4m4q4m4r4s4s4y4t2r4u3m4v4m4w3x4x5t4y4s4z4s5k3x5l4s5m4m5n3r5o3x5p4s5q4m5r5t5s4m5t3x5u3x5v2l5w1w5x2l5y3t5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q2l6r3m6s3r6t1w6u1w6v3m6w1w6x4y6y3r6z3m7k3m7l3m7m2r7n2r7o1w7p3r7q2w7r4m7s3m7t2w7u2r7v2n7w1q7x2n7y3t202l3mcl4mal2ram3man3mao3map3mar3mas2lat4uau1uav3maw3way4uaz2lbk2sbl3t'fof'6obo2lbp3tbq3mbr1tbs2lbu1ybv3mbz3mck4m202k3mcm4mcn4mco4mcp4mcq5ycr4mcs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz2w203k6o212m6o2dw2l2cq2l3t3m3u2l17s3x19m3m}'kerning'{cl{4qu5kt5qt5rs17ss5ts}201s{201ss}201t{cks4lscmscnscoscpscls2wu2yu201ts}201x{2wu2yu}2k{201ts}2w{4qx5kx5ou5qx5rs17su5tu}2x{17su5tu5ou}2y{4qx5kx5ou5qx5rs17ss5ts}'fof'-6ofn{17sw5tw5ou5qw5rs}7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qs}3v{17su5tu5os5qs}7p{17su5tu}ck{4qu5kt5qt5rs17ss5ts}4l{4qu5kt5qt5rs17ss5ts}cm{4qu5kt5qt5rs17ss5ts}cn{4qu5kt5qt5rs17ss5ts}co{4qu5kt5qt5rs17ss5ts}cp{4qu5kt5qt5rs17ss5ts}6l{4qu5ou5qw5rt17su5tu}5q{ckuclucmucnucoucpu4lu}5r{ckuclucmucnucoucpu4lu}7q{cksclscmscnscoscps4ls}6p{4qu5ou5qw5rt17sw5tw}ek{4qu5ou5qw5rt17su5tu}el{4qu5ou5qw5rt17su5tu}em{4qu5ou5qw5rt17su5tu}en{4qu5ou5qw5rt17su5tu}eo{4qu5ou5qw5rt17su5tu}ep{4qu5ou5qw5rt17su5tu}es{17ss5ts5qs4qu}et{4qu5ou5qw5rt17sw5tw}eu{4qu5ou5qw5rt17ss5ts}ev{17ss5ts5qs4qu}6z{17sw5tw5ou5qw5rs}fm{17sw5tw5ou5qw5rs}7n{201ts}fo{17sw5tw5ou5qw5rs}fp{17sw5tw5ou5qw5rs}fq{17sw5tw5ou5qw5rs}7r{cksclscmscnscoscps4ls}fs{17sw5tw5ou5qw5rs}ft{17su5tu}fu{17su5tu}fv{17su5tu}fw{17su5tu}fz{cksclscmscnscoscps4ls}}}"),"Helvetica-Bold":o("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),Courier:o("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-BoldOblique":o("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Bold":o("{'widths'{k3q2q5ncx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2l202m2n2n3m2o3m2p6o202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5x4l4s4m4m4n4s4o4s4p4m4q3x4r4y4s4y4t2r4u3m4v4y4w4m4x5y4y4s4z4y5k3x5l4y5m4s5n3r5o4m5p4s5q4s5r6o5s4s5t4s5u4m5v2l5w1w5x2l5y3u5z3m6k2l6l3m6m3r6n2w6o3r6p2w6q2l6r3m6s3r6t1w6u2l6v3r6w1w6x5n6y3r6z3m7k3r7l3r7m2w7n2r7o2l7p3r7q3m7r4s7s3m7t3m7u2w7v2r7w1q7x2r7y3o202l3mcl4sal2lam3man3mao3map3mar3mas2lat4uau1yav3maw3tay4uaz2lbk2sbl3t'fof'6obo2lbp3rbr1tbs2lbu2lbv3mbz3mck4s202k3mcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3rek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3m3u2l17s4s19m3m}'kerning'{cl{4qt5ks5ot5qy5rw17sv5tv}201t{cks4lscmscnscoscpscls4wv}2k{201ts}2w{4qu5ku7mu5os5qx5ru17su5tu}2x{17su5tu5ou5qs}2y{4qv5kv7mu5ot5qz5ru17su5tu}'fof'-6o7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qu}3v{17su5tu5os5qu}fu{17su5tu5ou5qu}7p{17su5tu5ou5qu}ck{4qt5ks5ot5qy5rw17sv5tv}4l{4qt5ks5ot5qy5rw17sv5tv}cm{4qt5ks5ot5qy5rw17sv5tv}cn{4qt5ks5ot5qy5rw17sv5tv}co{4qt5ks5ot5qy5rw17sv5tv}cp{4qt5ks5ot5qy5rw17sv5tv}6l{17st5tt5ou5qu}17s{ckuclucmucnucoucpu4lu4wu}5o{ckuclucmucnucoucpu4lu4wu}5q{ckzclzcmzcnzcozcpz4lz4wu}5r{ckxclxcmxcnxcoxcpx4lx4wu}5t{ckuclucmucnucoucpu4lu4wu}7q{ckuclucmucnucoucpu4lu}6p{17sw5tw5ou5qu}ek{17st5tt5qu}el{17st5tt5ou5qu}em{17st5tt5qu}en{17st5tt5qu}eo{17st5tt5qu}ep{17st5tt5ou5qu}es{17ss5ts5qu}et{17sw5tw5ou5qu}eu{17sw5tw5ou5qu}ev{17ss5ts5qu}6z{17sw5tw5ou5qu5rs}fm{17sw5tw5ou5qu5rs}fn{17sw5tw5ou5qu5rs}fo{17sw5tw5ou5qu5rs}fp{17sw5tw5ou5qu5rs}fq{17sw5tw5ou5qu5rs}7r{cktcltcmtcntcotcpt4lt5os}fs{17sw5tw5ou5qu5rs}ft{17su5tu5ou5qu}7m{5os}fv{17su5tu5ou5qu}fw{17su5tu5ou5qu}fz{cksclscmscnscoscps4ls}}}"),Symbol:o("{'widths'{k3uaw4r19m3m2k1t2l2l202m2y2n3m2p5n202q6o3k3m2s2l2t2l2v3r2w1t3m3m2y1t2z1wbk2sbl3r'fof'6o3n3m3o3m3p3m3q3m3r3m3s3m3t3m3u1w3v1w3w3r3x3r3y3r3z2wbp3t3l3m5v2l5x2l5z3m2q4yfr3r7v3k7w1o7x3k}'kerning'{'fof'-6o}}"),Helvetica:o("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}"),"Helvetica-BoldOblique":o("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),ZapfDingbats:o("{'widths'{k4u2k1w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-Bold":o("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Italic":o("{'widths'{k3n2q4ycx2l201n3m201o5t201s2l201t2l201u2l201w3r201x3r201y3r2k1t2l2l202m2n2n3m2o3m2p5n202q5t2r1p2s2l2t2l2u3m2v4n2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w4n3x4n3y4n3z3m4k5w4l3x4m3x4n4m4o4s4p3x4q3x4r4s4s4s4t2l4u2w4v4m4w3r4x5n4y4m4z4s5k3x5l4s5m3x5n3m5o3r5p4s5q3x5r5n5s3x5t3r5u3r5v2r5w1w5x2r5y2u5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q1w6r3m6s3m6t1w6u1w6v2w6w1w6x4s6y3m6z3m7k3m7l3m7m2r7n2r7o1w7p3m7q2w7r4m7s2w7t2w7u2r7v2s7w1v7x2s7y3q202l3mcl3xal2ram3man3mao3map3mar3mas2lat4wau1vav3maw4nay4waz2lbk2sbl4n'fof'6obo2lbp3mbq3obr1tbs2lbu1zbv3mbz3mck3x202k3mcm3xcn3xco3xcp3xcq5tcr4mcs3xct3xcu3xcv3xcw2l2m2ucy2lcz2ldl4mdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr4nfs3mft3mfu3mfv3mfw3mfz2w203k6o212m6m2dw2l2cq2l3t3m3u2l17s3r19m3m}'kerning'{cl{5kt4qw}201s{201sw}201t{201tw2wy2yy6q-t}201x{2wy2yy}2k{201tw}2w{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}2x{17ss5ts5os}2y{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}'fof'-6o6t{17ss5ts5qs}7t{5os}3v{5qs}7p{17su5tu5qs}ck{5kt4qw}4l{5kt4qw}cm{5kt4qw}cn{5kt4qw}co{5kt4qw}cp{5kt4qw}6l{4qs5ks5ou5qw5ru17su5tu}17s{2ks}5q{ckvclvcmvcnvcovcpv4lv}5r{ckuclucmucnucoucpu4lu}5t{2ks}6p{4qs5ks5ou5qw5ru17su5tu}ek{4qs5ks5ou5qw5ru17su5tu}el{4qs5ks5ou5qw5ru17su5tu}em{4qs5ks5ou5qw5ru17su5tu}en{4qs5ks5ou5qw5ru17su5tu}eo{4qs5ks5ou5qw5ru17su5tu}ep{4qs5ks5ou5qw5ru17su5tu}es{5ks5qs4qs}et{4qs5ks5ou5qw5ru17su5tu}eu{4qs5ks5qw5ru17su5tu}ev{5ks5qs4qs}ex{17ss5ts5qs}6z{4qv5ks5ou5qw5ru17su5tu}fm{4qv5ks5ou5qw5ru17su5tu}fn{4qv5ks5ou5qw5ru17su5tu}fo{4qv5ks5ou5qw5ru17su5tu}fp{4qv5ks5ou5qw5ru17su5tu}fq{4qv5ks5ou5qw5ru17su5tu}7r{5os}fs{4qv5ks5ou5qw5ru17su5tu}ft{17su5tu5qs}fu{17su5tu5qs}fv{17su5tu5qs}fw{17su5tu5qs}}}"),"Times-Roman":o("{'widths'{k3n2q4ycx2l201n3m201o6o201s2l201t2l201u2l201w2w201x2w201y2w2k1t2l2l202m2n2n3m2o3m2p5n202q6o2r1m2s2l2t2l2u3m2v3s2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v1w3w3s3x3s3y3s3z2w4k5w4l4s4m4m4n4m4o4s4p3x4q3r4r4s4s4s4t2l4u2r4v4s4w3x4x5t4y4s4z4s5k3r5l4s5m4m5n3r5o3x5p4s5q4s5r5y5s4s5t4s5u3x5v2l5w1w5x2l5y2z5z3m6k2l6l2w6m3m6n2w6o3m6p2w6q2l6r3m6s3m6t1w6u1w6v3m6w1w6x4y6y3m6z3m7k3m7l3m7m2l7n2r7o1w7p3m7q3m7r4s7s3m7t3m7u2w7v3k7w1o7x3k7y3q202l3mcl4sal2lam3man3mao3map3mar3mas2lat4wau1vav3maw3say4waz2lbk2sbl3s'fof'6obo2lbp3mbq2xbr1tbs2lbu1zbv3mbz2wck4s202k3mcm4scn4sco4scp4scq5tcr4mcs3xct3xcu3xcv3xcw2l2m2tcy2lcz2ldl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek2wel2wem2wen2weo2wep2weq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr3sfs3mft3mfu3mfv3mfw3mfz3m203k6o212m6m2dw2l2cq2l3t3m3u1w17s4s19m3m}'kerning'{cl{4qs5ku17sw5ou5qy5rw201ss5tw201ws}201s{201ss}201t{ckw4lwcmwcnwcowcpwclw4wu201ts}2k{201ts}2w{4qs5kw5os5qx5ru17sx5tx}2x{17sw5tw5ou5qu}2y{4qs5kw5os5qx5ru17sx5tx}'fof'-6o7t{ckuclucmucnucoucpu4lu5os5rs}3u{17su5tu5qs}3v{17su5tu5qs}7p{17sw5tw5qs}ck{4qs5ku17sw5ou5qy5rw201ss5tw201ws}4l{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cm{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cn{4qs5ku17sw5ou5qy5rw201ss5tw201ws}co{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cp{4qs5ku17sw5ou5qy5rw201ss5tw201ws}6l{17su5tu5os5qw5rs}17s{2ktclvcmvcnvcovcpv4lv4wuckv}5o{ckwclwcmwcnwcowcpw4lw4wu}5q{ckyclycmycnycoycpy4ly4wu5ms}5r{cktcltcmtcntcotcpt4lt4ws}5t{2ktclvcmvcnvcovcpv4lv4wuckv}7q{cksclscmscnscoscps4ls}6p{17su5tu5qw5rs}ek{5qs5rs}el{17su5tu5os5qw5rs}em{17su5tu5os5qs5rs}en{17su5qs5rs}eo{5qs5rs}ep{17su5tu5os5qw5rs}es{5qs}et{17su5tu5qw5rs}eu{17su5tu5qs5rs}ev{5qs}6z{17sv5tv5os5qx5rs}fm{5os5qt5rs}fn{17sv5tv5os5qx5rs}fo{17sv5tv5os5qx5rs}fp{5os5qt5rs}fq{5os5qt5rs}7r{ckuclucmucnucoucpu4lu5os}fs{17sv5tv5os5qx5rs}ft{17ss5ts5qs}fu{17sw5tw5qs}fv{17sw5tw5qs}fw{17ss5ts5qs}fz{ckuclucmucnucoucpu4lu5os5rs}}}"),"Helvetica-Oblique":o("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}")}};r.events.push(["addFont",function(b){var C=b.font,B=g.Unicode[C.postScriptName];B&&(C.metadata.Unicode={},C.metadata.Unicode.widths=B.widths,C.metadata.Unicode.kerning=B.kerning);var R=f.Unicode[C.postScriptName];R&&(C.metadata.Unicode.encoding=R,C.encoding=R.codePages[0])}])}(Xr.API),function(r){var t=function(e){for(var n=e.length,i=new Uint8Array(n),s=0;s<n;s++)i[s]=e.charCodeAt(s);return i};r.API.events.push(["addFont",function(e){var n=void 0,i=e.font,s=e.instance;if(!i.isStandardFont){if(s===void 0)throw new Error("Font does not exist in vFS, import fonts or remove declaration doc.addFont('"+i.postScriptName+"').");if(typeof(n=s.existsFileInVFS(i.postScriptName)===!1?s.loadFile(i.postScriptName):s.getFileFromVFS(i.postScriptName))!="string")throw new Error("Font is not stored as string-data in vFS, import fonts or remove declaration doc.addFont('"+i.postScriptName+"').");(function(a,o){o=/^\x00\x01\x00\x00/.test(o)?t(o):t(ig(o)),a.metadata=r.API.TTFFont.open(o),a.metadata.Unicode=a.metadata.Unicode||{encoding:{},kerning:{},widths:[]},a.metadata.glyIdsUsed=[0]})(i,n)}}])}(Xr),function(r){function t(){return(Wr.canvg?Promise.resolve(Wr.canvg):Promise.resolve().then(()=>o1t)).catch(function(e){return Promise.reject(new Error("Could not load canvg: "+e))}).then(function(e){return e.default?e.default:e})}Xr.API.addSvgAsImage=function(e,n,i,s,a,o,h,f){if(isNaN(n)||isNaN(i))throw ui.error("jsPDF.addSvgAsImage: Invalid coordinates",arguments),new Error("Invalid coordinates passed to jsPDF.addSvgAsImage");if(isNaN(s)||isNaN(a))throw ui.error("jsPDF.addSvgAsImage: Invalid measurements",arguments),new Error("Invalid measurements (width and/or height) passed to jsPDF.addSvgAsImage");var g=document.createElement("canvas");g.width=s,g.height=a;var b=g.getContext("2d");b.fillStyle="#fff",b.fillRect(0,0,g.width,g.height);var C={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0},B=this;return t().then(function(R){return R.fromString(b,e,C)},function(){return Promise.reject(new Error("Could not load canvg."))}).then(function(R){return R.render(C)}).then(function(){B.addImage(g.toDataURL("image/jpeg",1),n,i,s,a,h,f)})}}(),Xr.API.putTotalPages=function(r){var t,e=0;parseInt(this.internal.getFont().id.substr(1),10)<15?(t=new RegExp(r,"g"),e=this.internal.getNumberOfPages()):(t=new RegExp(this.pdfEscape16(r,this.internal.getFont()),"g"),e=this.pdfEscape16(this.internal.getNumberOfPages()+"",this.internal.getFont()));for(var n=1;n<=this.internal.getNumberOfPages();n++)for(var i=0;i<this.internal.pages[n].length;i++)this.internal.pages[n][i]=this.internal.pages[n][i].replace(t,e);return this},Xr.API.viewerPreferences=function(r,t){var e;r=r||{},t=t||!1;var n,i,s,a={HideToolbar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideMenubar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideWindowUI:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},FitWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},CenterWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},DisplayDocTitle:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.4},NonFullScreenPageMode:{defaultValue:"UseNone",value:"UseNone",type:"name",explicitSet:!1,valueSet:["UseNone","UseOutlines","UseThumbs","UseOC"],pdfVersion:1.3},Direction:{defaultValue:"L2R",value:"L2R",type:"name",explicitSet:!1,valueSet:["L2R","R2L"],pdfVersion:1.3},ViewArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},ViewClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintScaling:{defaultValue:"AppDefault",value:"AppDefault",type:"name",explicitSet:!1,valueSet:["AppDefault","None"],pdfVersion:1.6},Duplex:{defaultValue:"",value:"none",type:"name",explicitSet:!1,valueSet:["Simplex","DuplexFlipShortEdge","DuplexFlipLongEdge","none"],pdfVersion:1.7},PickTrayByPDFSize:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.7},PrintPageRange:{defaultValue:"",value:"",type:"array",explicitSet:!1,valueSet:null,pdfVersion:1.7},NumCopies:{defaultValue:1,value:1,type:"integer",explicitSet:!1,valueSet:null,pdfVersion:1.7}},o=Object.keys(a),h=[],f=0,g=0,b=0;function C(R,D){var Q,k=!1;for(Q=0;Q<R.length;Q+=1)R[Q]===D&&(k=!0);return k}if(this.internal.viewerpreferences===void 0&&(this.internal.viewerpreferences={},this.internal.viewerpreferences.configuration=JSON.parse(JSON.stringify(a)),this.internal.viewerpreferences.isSubscribed=!1),e=this.internal.viewerpreferences.configuration,r==="reset"||t===!0){var B=o.length;for(b=0;b<B;b+=1)e[o[b]].value=e[o[b]].defaultValue,e[o[b]].explicitSet=!1}if(Nn(r)==="object"){for(i in r)if(s=r[i],C(o,i)&&s!==void 0){if(e[i].type==="boolean"&&typeof s=="boolean")e[i].value=s;else if(e[i].type==="name"&&C(e[i].valueSet,s))e[i].value=s;else if(e[i].type==="integer"&&Number.isInteger(s))e[i].value=s;else if(e[i].type==="array"){for(f=0;f<s.length;f+=1)if(n=!0,s[f].length===1&&typeof s[f][0]=="number")h.push(String(s[f]-1));else if(s[f].length>1){for(g=0;g<s[f].length;g+=1)typeof s[f][g]!="number"&&(n=!1);n===!0&&h.push([s[f][0]-1,s[f][1]-1].join(" "))}e[i].value="["+h.join(" ")+"]"}else e[i].value=e[i].defaultValue;e[i].explicitSet=!0}}return this.internal.viewerpreferences.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){var R,D=[];for(R in e)e[R].explicitSet===!0&&(e[R].type==="name"?D.push("/"+R+" /"+e[R].value):D.push("/"+R+" "+e[R].value));D.length!==0&&this.internal.write(`/ViewerPreferences
<<
`+D.join(`
`)+`
>>`)}),this.internal.viewerpreferences.isSubscribed=!0),this.internal.viewerpreferences.configuration=e,this},function(r){var t=function(){var n='<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description rdf:about="" xmlns:jspdf="'+this.internal.__metadata__.namespaceuri+'"><jspdf:metadata>',i=unescape(encodeURIComponent('<x:xmpmeta xmlns:x="adobe:ns:meta/">')),s=unescape(encodeURIComponent(n)),a=unescape(encodeURIComponent(this.internal.__metadata__.metadata)),o=unescape(encodeURIComponent("</jspdf:metadata></rdf:Description></rdf:RDF>")),h=unescape(encodeURIComponent("</x:xmpmeta>")),f=s.length+a.length+o.length+i.length+h.length;this.internal.__metadata__.metadata_object_number=this.internal.newObject(),this.internal.write("<< /Type /Metadata /Subtype /XML /Length "+f+" >>"),this.internal.write("stream"),this.internal.write(i+s+a+o+h),this.internal.write("endstream"),this.internal.write("endobj")},e=function(){this.internal.__metadata__.metadata_object_number&&this.internal.write("/Metadata "+this.internal.__metadata__.metadata_object_number+" 0 R")};r.addMetadata=function(n,i){return this.internal.__metadata__===void 0&&(this.internal.__metadata__={metadata:n,namespaceuri:i||"http://jspdf.default.namespaceuri/"},this.internal.events.subscribe("putCatalog",e),this.internal.events.subscribe("postPutResources",t)),this}}(Xr.API),function(r){var t=r.API,e=t.pdfEscape16=function(s,a){for(var o,h=a.metadata.Unicode.widths,f=["","0","00","000","0000"],g=[""],b=0,C=s.length;b<C;++b){if(o=a.metadata.characterToGlyph(s.charCodeAt(b)),a.metadata.glyIdsUsed.push(o),a.metadata.toUnicode[o]=s.charCodeAt(b),h.indexOf(o)==-1&&(h.push(o),h.push([parseInt(a.metadata.widthOfGlyph(o),10)])),o=="0")return g.join("");o=o.toString(16),g.push(f[4-o.length],o)}return g.join("")},n=function(s){var a,o,h,f,g,b,C;for(g=`/CIDInit /ProcSet findresource begin
12 dict begin
begincmap
/CIDSystemInfo <<
  /Registry (Adobe)
  /Ordering (UCS)
  /Supplement 0
>> def
/CMapName /Adobe-Identity-UCS def
/CMapType 2 def
1 begincodespacerange
<0000><ffff>
endcodespacerange`,h=[],b=0,C=(o=Object.keys(s).sort(function(B,R){return B-R})).length;b<C;b++)a=o[b],h.length>=100&&(g+=`
`+h.length+` beginbfchar
`+h.join(`
`)+`
endbfchar`,h=[]),s[a]!==void 0&&s[a]!==null&&typeof s[a].toString=="function"&&(f=("0000"+s[a].toString(16)).slice(-4),a=("0000"+(+a).toString(16)).slice(-4),h.push("<"+a+"><"+f+">"));return h.length&&(g+=`
`+h.length+` beginbfchar
`+h.join(`
`)+`
endbfchar
`),g+=`endcmap
CMapName currentdict /CMap defineresource pop
end
end`};t.events.push(["putFont",function(s){(function(a){var o=a.font,h=a.out,f=a.newObject,g=a.putStream;if(o.metadata instanceof r.API.TTFFont&&o.encoding==="Identity-H"){for(var b=o.metadata.Unicode.widths,C=o.metadata.subset.encode(o.metadata.glyIdsUsed,1),B="",R=0;R<C.length;R++)B+=String.fromCharCode(C[R]);var D=f();g({data:B,addLength1:!0,objectId:D}),h("endobj");var Q=f();g({data:n(o.metadata.toUnicode),addLength1:!0,objectId:Q}),h("endobj");var k=f();h("<<"),h("/Type /FontDescriptor"),h("/FontName /"+tf(o.fontName)),h("/FontFile2 "+D+" 0 R"),h("/FontBBox "+r.API.PDFObject.convert(o.metadata.bbox)),h("/Flags "+o.metadata.flags),h("/StemV "+o.metadata.stemV),h("/ItalicAngle "+o.metadata.italicAngle),h("/Ascent "+o.metadata.ascender),h("/Descent "+o.metadata.decender),h("/CapHeight "+o.metadata.capHeight),h(">>"),h("endobj");var j=f();h("<<"),h("/Type /Font"),h("/BaseFont /"+tf(o.fontName)),h("/FontDescriptor "+k+" 0 R"),h("/W "+r.API.PDFObject.convert(b)),h("/CIDToGIDMap /Identity"),h("/DW 1000"),h("/Subtype /CIDFontType2"),h("/CIDSystemInfo"),h("<<"),h("/Supplement 0"),h("/Registry (Adobe)"),h("/Ordering ("+o.encoding+")"),h(">>"),h(">>"),h("endobj"),o.objectNumber=f(),h("<<"),h("/Type /Font"),h("/Subtype /Type0"),h("/ToUnicode "+Q+" 0 R"),h("/BaseFont /"+tf(o.fontName)),h("/Encoding /"+o.encoding),h("/DescendantFonts ["+j+" 0 R]"),h(">>"),h("endobj"),o.isAlreadyPutted=!0}})(s)}]),t.events.push(["putFont",function(s){(function(a){var o=a.font,h=a.out,f=a.newObject,g=a.putStream;if(o.metadata instanceof r.API.TTFFont&&o.encoding==="WinAnsiEncoding"){for(var b=o.metadata.rawData,C="",B=0;B<b.length;B++)C+=String.fromCharCode(b[B]);var R=f();g({data:C,addLength1:!0,objectId:R}),h("endobj");var D=f();g({data:n(o.metadata.toUnicode),addLength1:!0,objectId:D}),h("endobj");var Q=f();h("<<"),h("/Descent "+o.metadata.decender),h("/CapHeight "+o.metadata.capHeight),h("/StemV "+o.metadata.stemV),h("/Type /FontDescriptor"),h("/FontFile2 "+R+" 0 R"),h("/Flags 96"),h("/FontBBox "+r.API.PDFObject.convert(o.metadata.bbox)),h("/FontName /"+tf(o.fontName)),h("/ItalicAngle "+o.metadata.italicAngle),h("/Ascent "+o.metadata.ascender),h(">>"),h("endobj"),o.objectNumber=f();for(var k=0;k<o.metadata.hmtx.widths.length;k++)o.metadata.hmtx.widths[k]=parseInt(o.metadata.hmtx.widths[k]*(1e3/o.metadata.head.unitsPerEm));h("<</Subtype/TrueType/Type/Font/ToUnicode "+D+" 0 R/BaseFont/"+tf(o.fontName)+"/FontDescriptor "+Q+" 0 R/Encoding/"+o.encoding+" /FirstChar 29 /LastChar 255 /Widths "+r.API.PDFObject.convert(o.metadata.hmtx.widths)+">>"),h("endobj"),o.isAlreadyPutted=!0}})(s)}]);var i=function(s){var a,o=s.text||"",h=s.x,f=s.y,g=s.options||{},b=s.mutex||{},C=b.pdfEscape,B=b.activeFontKey,R=b.fonts,D=B,Q="",k=0,j="",et=R[D].encoding;if(R[D].encoding!=="Identity-H")return{text:o,x:h,y:f,options:g,mutex:b};for(j=o,D=B,Array.isArray(o)&&(j=o[0]),k=0;k<j.length;k+=1)R[D].metadata.hasOwnProperty("cmap")&&(a=R[D].metadata.cmap.unicode.codeMap[j[k].charCodeAt(0)]),a||j[k].charCodeAt(0)<256&&R[D].metadata.hasOwnProperty("Unicode")?Q+=j[k]:Q+="";var st="";return parseInt(D.slice(1))<14||et==="WinAnsiEncoding"?st=C(Q,D).split("").map(function(mt){return mt.charCodeAt(0).toString(16)}).join(""):et==="Identity-H"&&(st=e(Q,R[D])),b.isHex=!0,{text:st,x:h,y:f,options:g,mutex:b}};t.events.push(["postProcessText",function(s){var a=s.text||"",o=[],h={text:a,x:s.x,y:s.y,options:s.options,mutex:s.mutex};if(Array.isArray(a)){var f=0;for(f=0;f<a.length;f+=1)Array.isArray(a[f])&&a[f].length===3?o.push([i(Object.assign({},h,{text:a[f][0]})).text,a[f][1],a[f][2]]):o.push(i(Object.assign({},h,{text:a[f]})).text);s.text=o}else s.text=i(Object.assign({},h,{text:a})).text}])}(Xr),function(r){var t=function(){return this.internal.vFS===void 0&&(this.internal.vFS={}),!0};r.existsFileInVFS=function(e){return t.call(this),this.internal.vFS[e]!==void 0},r.addFileToVFS=function(e,n){return t.call(this),this.internal.vFS[e]=n,this},r.getFileFromVFS=function(e){return t.call(this),this.internal.vFS[e]!==void 0?this.internal.vFS[e]:null}}(Xr.API),function(r){r.__bidiEngine__=r.prototype.__bidiEngine__=function(n){var i,s,a,o,h,f,g,b=t,C=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],B=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],R={L:0,R:1,EN:2,AN:3,N:4,B:5,S:6},D={0:0,5:1,6:2,7:3,32:4,251:5,254:6,255:7},Q=["(",")","(","<",">","<","[","]","[","{","}","{","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],k=new RegExp(/^([1-4|9]|1[0-9]|2[0-9]|3[0168]|4[04589]|5[012]|7[78]|159|16[0-9]|17[0-2]|21[569]|22[03489]|250)$/),j=!1,et=0;this.__bidiEngine__={};var st=function(ut){var At=ut.charCodeAt(),Bt=At>>8,vt=D[Bt];return vt!==void 0?b[256*vt+(255&At)]:Bt===252||Bt===253?"AL":k.test(Bt)?"L":Bt===8?"R":"N"},mt=function(ut){for(var At,Bt=0;Bt<ut.length;Bt++){if((At=st(ut.charAt(Bt)))==="L")return!1;if(At==="R")return!0}return!1},pt=function(ut,At,Bt,vt){var ne,ie,ae,te,ce=At[vt];switch(ce){case"L":case"R":j=!1;break;case"N":case"AN":break;case"EN":j&&(ce="AN");break;case"AL":j=!0,ce="R";break;case"WS":ce="N";break;case"CS":vt<1||vt+1>=At.length||(ne=Bt[vt-1])!=="EN"&&ne!=="AN"||(ie=At[vt+1])!=="EN"&&ie!=="AN"?ce="N":j&&(ie="AN"),ce=ie===ne?ie:"N";break;case"ES":ce=(ne=vt>0?Bt[vt-1]:"B")==="EN"&&vt+1<At.length&&At[vt+1]==="EN"?"EN":"N";break;case"ET":if(vt>0&&Bt[vt-1]==="EN"){ce="EN";break}if(j){ce="N";break}for(ae=vt+1,te=At.length;ae<te&&At[ae]==="ET";)ae++;ce=ae<te&&At[ae]==="EN"?"EN":"N";break;case"NSM":if(a&&!o){for(te=At.length,ae=vt+1;ae<te&&At[ae]==="NSM";)ae++;if(ae<te){var le=ut[vt],Te=le>=1425&&le<=2303||le===64286;if(ne=At[ae],Te&&(ne==="R"||ne==="AL")){ce="R";break}}}ce=vt<1||(ne=At[vt-1])==="B"?"N":Bt[vt-1];break;case"B":j=!1,i=!0,ce=et;break;case"S":s=!0,ce="N";break;case"LRE":case"RLE":case"LRO":case"RLO":case"PDF":j=!1;break;case"BN":ce="N"}return ce},yt=function(ut,At,Bt){var vt=ut.split("");return Bt&&ft(vt,Bt,{hiLevel:et}),vt.reverse(),At&&At.reverse(),vt.join("")},ft=function(ut,At,Bt){var vt,ne,ie,ae,te,ce=-1,le=ut.length,Te=0,rt=[],wt=et?B:C,St=[];for(j=!1,i=!1,s=!1,ne=0;ne<le;ne++)St[ne]=st(ut[ne]);for(ie=0;ie<le;ie++){if(te=Te,rt[ie]=pt(ut,St,rt,ie),vt=240&(Te=wt[te][R[rt[ie]]]),Te&=15,At[ie]=ae=wt[Te][5],vt>0)if(vt===16){for(ne=ce;ne<ie;ne++)At[ne]=1;ce=-1}else ce=-1;if(wt[Te][6])ce===-1&&(ce=ie);else if(ce>-1){for(ne=ce;ne<ie;ne++)At[ne]=ae;ce=-1}St[ie]==="B"&&(At[ie]=0),Bt.hiLevel|=ae}s&&function(qt,Jt,se){for(var Ae=0;Ae<se;Ae++)if(qt[Ae]==="S"){Jt[Ae]=et;for(var oe=Ae-1;oe>=0&&qt[oe]==="WS";oe--)Jt[oe]=et}}(St,At,le)},Dt=function(ut,At,Bt,vt,ne){if(!(ne.hiLevel<ut)){if(ut===1&&et===1&&!i)return At.reverse(),void(Bt&&Bt.reverse());for(var ie,ae,te,ce,le=At.length,Te=0;Te<le;){if(vt[Te]>=ut){for(te=Te+1;te<le&&vt[te]>=ut;)te++;for(ce=Te,ae=te-1;ce<ae;ce++,ae--)ie=At[ce],At[ce]=At[ae],At[ae]=ie,Bt&&(ie=Bt[ce],Bt[ce]=Bt[ae],Bt[ae]=ie);Te=te}Te++}}},It=function(ut,At,Bt){var vt=ut.split(""),ne={hiLevel:et};return Bt||(Bt=[]),ft(vt,Bt,ne),function(ie,ae,te){if(te.hiLevel!==0&&g)for(var ce,le=0;le<ie.length;le++)ae[le]===1&&(ce=Q.indexOf(ie[le]))>=0&&(ie[le]=Q[ce+1])}(vt,Bt,ne),Dt(2,vt,At,Bt,ne),Dt(1,vt,At,Bt,ne),vt.join("")};return this.__bidiEngine__.doBidiReorder=function(ut,At,Bt){if(function(ne,ie){if(ie)for(var ae=0;ae<ne.length;ae++)ie[ae]=ae;o===void 0&&(o=mt(ne)),f===void 0&&(f=mt(ne))}(ut,At),a||!h||f)if(a&&h&&o^f)et=o?1:0,ut=yt(ut,At,Bt);else if(!a&&h&&f)et=o?1:0,ut=It(ut,At,Bt),ut=yt(ut,At);else if(!a||o||h||f){if(a&&!h&&o^f)ut=yt(ut,At),o?(et=0,ut=It(ut,At,Bt)):(et=1,ut=It(ut,At,Bt),ut=yt(ut,At));else if(a&&o&&!h&&f)et=1,ut=It(ut,At,Bt),ut=yt(ut,At);else if(!a&&!h&&o^f){var vt=g;o?(et=1,ut=It(ut,At,Bt),et=0,g=!1,ut=It(ut,At,Bt),g=vt):(et=0,ut=It(ut,At,Bt),ut=yt(ut,At),et=1,g=!1,ut=It(ut,At,Bt),g=vt,ut=yt(ut,At))}}else et=0,ut=It(ut,At,Bt);else et=o?1:0,ut=It(ut,At,Bt);return ut},this.__bidiEngine__.setOptions=function(ut){ut&&(a=ut.isInputVisual,h=ut.isOutputVisual,o=ut.isInputRtl,f=ut.isOutputRtl,g=ut.isSymmetricSwapping)},this.__bidiEngine__.setOptions(n),this.__bidiEngine__};var t=["BN","BN","BN","BN","BN","BN","BN","BN","BN","S","B","S","WS","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","B","B","B","S","WS","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","BN","BN","BN","BN","BN","BN","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","CS","N","ET","ET","ET","ET","N","N","N","N","L","N","N","BN","N","N","ET","ET","EN","EN","N","L","N","N","N","EN","L","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","N","N","N","N","N","ET","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","NSM","R","NSM","NSM","R","NSM","NSM","R","NSM","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","N","N","N","N","N","R","R","R","R","R","N","N","N","N","N","N","N","N","N","N","N","AN","AN","AN","AN","AN","AN","N","N","AL","ET","ET","AL","CS","AL","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","AN","AN","AN","AN","AN","AN","AN","AN","AN","ET","AN","AN","AL","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","N","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","NSM","NSM","N","NSM","NSM","NSM","NSM","AL","AL","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","R","N","N","N","N","R","N","N","N","N","N","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","BN","BN","BN","L","R","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","B","LRE","RLE","PDF","LRO","RLO","CS","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","BN","BN","BN","BN","BN","N","LRI","RLI","FSI","PDI","BN","BN","BN","BN","BN","BN","EN","L","N","N","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","L","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","N","N","N","N","N","R","NSM","R","R","R","R","R","R","R","R","R","R","ES","R","R","R","R","R","R","R","R","R","R","R","R","R","N","R","R","R","R","R","N","R","N","R","R","N","R","R","N","R","R","R","R","R","R","R","R","R","R","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","CS","N","N","CS","N","N","N","N","N","N","N","N","N","ET","N","N","ES","ES","N","N","N","N","N","ET","ET","N","N","N","N","N","AL","AL","AL","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","BN","N","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","N","N","N","ET","ET","N","N","N","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N"],e=new r.__bidiEngine__({isInputVisual:!0});r.API.events.push(["postProcessText",function(n){var i=n.text,s=(n.x,n.y,n.options||{}),a=(n.mutex,s.lang,[]);if(s.isInputVisual=typeof s.isInputVisual!="boolean"||s.isInputVisual,e.setOptions(s),Object.prototype.toString.call(i)==="[object Array]"){var o=0;for(a=[],o=0;o<i.length;o+=1)Object.prototype.toString.call(i[o])==="[object Array]"?a.push([e.doBidiReorder(i[o][0]),i[o][1],i[o][2]]):a.push([e.doBidiReorder(i[o])]);n.text=a}else n.text=e.doBidiReorder(i);e.setOptions({isInputVisual:!0})}])}(Xr),Xr.API.TTFFont=function(){function r(t){var e;if(this.rawData=t,e=this.contents=new Tu(t),this.contents.pos=4,e.readString(4)==="ttcf")throw new Error("TTCF not supported.");e.pos=0,this.parse(),this.subset=new Ktt(this),this.registerTTF()}return r.open=function(t){return new r(t)},r.prototype.parse=function(){return this.directory=new Ptt(this.contents),this.head=new Rtt(this),this.name=new Qtt(this),this.cmap=new gF(this),this.toUnicode={},this.hhea=new Dtt(this),this.maxp=new ztt(this),this.hmtx=new Htt(this),this.post=new Ntt(this),this.os2=new Ott(this),this.loca=new qtt(this),this.glyf=new Gtt(this),this.ascender=this.os2.exists&&this.os2.ascender||this.hhea.ascender,this.decender=this.os2.exists&&this.os2.decender||this.hhea.decender,this.lineGap=this.os2.exists&&this.os2.lineGap||this.hhea.lineGap,this.bbox=[this.head.xMin,this.head.yMin,this.head.xMax,this.head.yMax]},r.prototype.registerTTF=function(){var t,e,n,i,s;if(this.scaleFactor=1e3/this.head.unitsPerEm,this.bbox=(function(){var a,o,h,f;for(f=[],a=0,o=(h=this.bbox).length;a<o;a++)t=h[a],f.push(Math.round(t*this.scaleFactor));return f}).call(this),this.stemV=0,this.post.exists?(n=255&(i=this.post.italic_angle),32768&(e=i>>16)&&(e=-(1+(65535^e))),this.italicAngle=+(e+"."+n)):this.italicAngle=0,this.ascender=Math.round(this.ascender*this.scaleFactor),this.decender=Math.round(this.decender*this.scaleFactor),this.lineGap=Math.round(this.lineGap*this.scaleFactor),this.capHeight=this.os2.exists&&this.os2.capHeight||this.ascender,this.xHeight=this.os2.exists&&this.os2.xHeight||0,this.familyClass=(this.os2.exists&&this.os2.familyClass||0)>>8,this.isSerif=(s=this.familyClass)===1||s===2||s===3||s===4||s===5||s===7,this.isScript=this.familyClass===10,this.flags=0,this.post.isFixedPitch&&(this.flags|=1),this.isSerif&&(this.flags|=2),this.isScript&&(this.flags|=8),this.italicAngle!==0&&(this.flags|=64),this.flags|=32,!this.cmap.unicode)throw new Error("No unicode cmap for font")},r.prototype.characterToGlyph=function(t){var e;return((e=this.cmap.unicode)!=null?e.codeMap[t]:void 0)||0},r.prototype.widthOfGlyph=function(t){var e;return e=1e3/this.head.unitsPerEm,this.hmtx.forGlyph(t).advance*e},r.prototype.widthOfString=function(t,e,n){var i,s,a,o;for(a=0,s=0,o=(t=""+t).length;0<=o?s<o:s>o;s=0<=o?++s:--s)i=t.charCodeAt(s),a+=this.widthOfGlyph(this.characterToGlyph(i))+n*(1e3/e)||0;return a*(e/1e3)},r.prototype.lineHeight=function(t,e){var n;return e==null&&(e=!1),n=e?this.lineGap:0,(this.ascender+n-this.decender)/1e3*t},r}();var zc,Tu=function(){function r(t){this.data=t??[],this.pos=0,this.length=this.data.length}return r.prototype.readByte=function(){return this.data[this.pos++]},r.prototype.writeByte=function(t){return this.data[this.pos++]=t},r.prototype.readUInt32=function(){return 16777216*this.readByte()+(this.readByte()<<16)+(this.readByte()<<8)+this.readByte()},r.prototype.writeUInt32=function(t){return this.writeByte(t>>>24&255),this.writeByte(t>>16&255),this.writeByte(t>>8&255),this.writeByte(255&t)},r.prototype.readInt32=function(){var t;return(t=this.readUInt32())>=2147483648?t-4294967296:t},r.prototype.writeInt32=function(t){return t<0&&(t+=4294967296),this.writeUInt32(t)},r.prototype.readUInt16=function(){return this.readByte()<<8|this.readByte()},r.prototype.writeUInt16=function(t){return this.writeByte(t>>8&255),this.writeByte(255&t)},r.prototype.readInt16=function(){var t;return(t=this.readUInt16())>=32768?t-65536:t},r.prototype.writeInt16=function(t){return t<0&&(t+=65536),this.writeUInt16(t)},r.prototype.readString=function(t){var e,n;for(n=[],e=0;0<=t?e<t:e>t;e=0<=t?++e:--e)n[e]=String.fromCharCode(this.readByte());return n.join("")},r.prototype.writeString=function(t){var e,n,i;for(i=[],e=0,n=t.length;0<=n?e<n:e>n;e=0<=n?++e:--e)i.push(this.writeByte(t.charCodeAt(e)));return i},r.prototype.readShort=function(){return this.readInt16()},r.prototype.writeShort=function(t){return this.writeInt16(t)},r.prototype.readLongLong=function(){var t,e,n,i,s,a,o,h;return t=this.readByte(),e=this.readByte(),n=this.readByte(),i=this.readByte(),s=this.readByte(),a=this.readByte(),o=this.readByte(),h=this.readByte(),128&t?-1*(72057594037927940*(255^t)+281474976710656*(255^e)+1099511627776*(255^n)+4294967296*(255^i)+16777216*(255^s)+65536*(255^a)+256*(255^o)+(255^h)+1):72057594037927940*t+281474976710656*e+1099511627776*n+4294967296*i+16777216*s+65536*a+256*o+h},r.prototype.writeLongLong=function(t){var e,n;return e=Math.floor(t/4294967296),n=4294967295&t,this.writeByte(e>>24&255),this.writeByte(e>>16&255),this.writeByte(e>>8&255),this.writeByte(255&e),this.writeByte(n>>24&255),this.writeByte(n>>16&255),this.writeByte(n>>8&255),this.writeByte(255&n)},r.prototype.readInt=function(){return this.readInt32()},r.prototype.writeInt=function(t){return this.writeInt32(t)},r.prototype.read=function(t){var e,n;for(e=[],n=0;0<=t?n<t:n>t;n=0<=t?++n:--n)e.push(this.readByte());return e},r.prototype.write=function(t){var e,n,i,s;for(s=[],n=0,i=t.length;n<i;n++)e=t[n],s.push(this.writeByte(e));return s},r}(),Ptt=function(){var r;function t(e){var n,i,s;for(this.scalarType=e.readInt(),this.tableCount=e.readShort(),this.searchRange=e.readShort(),this.entrySelector=e.readShort(),this.rangeShift=e.readShort(),this.tables={},i=0,s=this.tableCount;0<=s?i<s:i>s;i=0<=s?++i:--i)n={tag:e.readString(4),checksum:e.readInt(),offset:e.readInt(),length:e.readInt()},this.tables[n.tag]=n}return t.prototype.encode=function(e){var n,i,s,a,o,h,f,g,b,C,B,R,D;for(D in B=Object.keys(e).length,h=Math.log(2),b=16*Math.floor(Math.log(B)/h),a=Math.floor(b/h),g=16*B-b,(i=new Tu).writeInt(this.scalarType),i.writeShort(B),i.writeShort(b),i.writeShort(a),i.writeShort(g),s=16*B,f=i.pos+s,o=null,R=[],e)for(C=e[D],i.writeString(D),i.writeInt(r(C)),i.writeInt(f),i.writeInt(C.length),R=R.concat(C),D==="head"&&(o=f),f+=C.length;f%4;)R.push(0),f++;return i.write(R),n=2981146554-r(i.data),i.pos=o+8,i.writeUInt32(n),i.data},r=function(e){var n,i,s,a;for(e=mF.call(e);e.length%4;)e.push(0);for(s=new Tu(e),i=0,n=0,a=e.length;n<a;n=n+=4)i+=s.readUInt32();return 4294967295&i},t}(),Utt={}.hasOwnProperty,Ol=function(r,t){for(var e in t)Utt.call(t,e)&&(r[e]=t[e]);function n(){this.constructor=r}return n.prototype=t.prototype,r.prototype=new n,r.__super__=t.prototype,r};zc=function(){function r(t){var e;this.file=t,e=this.file.directory.tables[this.tag],this.exists=!!e,e&&(this.offset=e.offset,this.length=e.length,this.parse(this.file.contents))}return r.prototype.parse=function(){},r.prototype.encode=function(){},r.prototype.raw=function(){return this.exists?(this.file.contents.pos=this.offset,this.file.contents.read(this.length)):null},r}();var Rtt=function(r){function t(){return t.__super__.constructor.apply(this,arguments)}return Ol(t,zc),t.prototype.tag="head",t.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.revision=e.readInt(),this.checkSumAdjustment=e.readInt(),this.magicNumber=e.readInt(),this.flags=e.readShort(),this.unitsPerEm=e.readShort(),this.created=e.readLongLong(),this.modified=e.readLongLong(),this.xMin=e.readShort(),this.yMin=e.readShort(),this.xMax=e.readShort(),this.yMax=e.readShort(),this.macStyle=e.readShort(),this.lowestRecPPEM=e.readShort(),this.fontDirectionHint=e.readShort(),this.indexToLocFormat=e.readShort(),this.glyphDataFormat=e.readShort()},t.prototype.encode=function(e){var n;return(n=new Tu).writeInt(this.version),n.writeInt(this.revision),n.writeInt(this.checkSumAdjustment),n.writeInt(this.magicNumber),n.writeShort(this.flags),n.writeShort(this.unitsPerEm),n.writeLongLong(this.created),n.writeLongLong(this.modified),n.writeShort(this.xMin),n.writeShort(this.yMin),n.writeShort(this.xMax),n.writeShort(this.yMax),n.writeShort(this.macStyle),n.writeShort(this.lowestRecPPEM),n.writeShort(this.fontDirectionHint),n.writeShort(e),n.writeShort(this.glyphDataFormat),n.data},t}(),pF=function(){function r(t,e){var n,i,s,a,o,h,f,g,b,C,B,R,D,Q,k,j,et;switch(this.platformID=t.readUInt16(),this.encodingID=t.readShort(),this.offset=e+t.readInt(),b=t.pos,t.pos=this.offset,this.format=t.readUInt16(),this.length=t.readUInt16(),this.language=t.readUInt16(),this.isUnicode=this.platformID===3&&this.encodingID===1&&this.format===4||this.platformID===0&&this.format===4,this.codeMap={},this.format){case 0:for(h=0;h<256;++h)this.codeMap[h]=t.readByte();break;case 4:for(B=t.readUInt16(),C=B/2,t.pos+=6,s=function(){var st,mt;for(mt=[],h=st=0;0<=C?st<C:st>C;h=0<=C?++st:--st)mt.push(t.readUInt16());return mt}(),t.pos+=2,D=function(){var st,mt;for(mt=[],h=st=0;0<=C?st<C:st>C;h=0<=C?++st:--st)mt.push(t.readUInt16());return mt}(),f=function(){var st,mt;for(mt=[],h=st=0;0<=C?st<C:st>C;h=0<=C?++st:--st)mt.push(t.readUInt16());return mt}(),g=function(){var st,mt;for(mt=[],h=st=0;0<=C?st<C:st>C;h=0<=C?++st:--st)mt.push(t.readUInt16());return mt}(),i=(this.length-t.pos+this.offset)/2,o=function(){var st,mt;for(mt=[],h=st=0;0<=i?st<i:st>i;h=0<=i?++st:--st)mt.push(t.readUInt16());return mt}(),h=k=0,et=s.length;k<et;h=++k)for(Q=s[h],n=j=R=D[h];R<=Q?j<=Q:j>=Q;n=R<=Q?++j:--j)g[h]===0?a=n+f[h]:(a=o[g[h]/2+(n-R)-(C-h)]||0)!==0&&(a+=f[h]),this.codeMap[n]=65535&a}t.pos=b}return r.encode=function(t,e){var n,i,s,a,o,h,f,g,b,C,B,R,D,Q,k,j,et,st,mt,pt,yt,ft,Dt,It,ut,At,Bt,vt,ne,ie,ae,te,ce,le,Te,rt,wt,St,qt,Jt,se,Ae,oe,Ce,Pe,Ve;switch(vt=new Tu,a=Object.keys(t).sort(function(Ke,rr){return Ke-rr}),e){case"macroman":for(D=0,Q=function(){var Ke=[];for(R=0;R<256;++R)Ke.push(0);return Ke}(),j={0:0},s={},ne=0,ce=a.length;ne<ce;ne++)j[oe=t[i=a[ne]]]==null&&(j[oe]=++D),s[i]={old:t[i],new:j[t[i]]},Q[i]=j[t[i]];return vt.writeUInt16(1),vt.writeUInt16(0),vt.writeUInt32(12),vt.writeUInt16(0),vt.writeUInt16(262),vt.writeUInt16(0),vt.write(Q),{charMap:s,subtable:vt.data,maxGlyphID:D+1};case"unicode":for(At=[],b=[],et=0,j={},n={},k=f=null,ie=0,le=a.length;ie<le;ie++)j[mt=t[i=a[ie]]]==null&&(j[mt]=++et),n[i]={old:mt,new:j[mt]},o=j[mt]-i,k!=null&&o===f||(k&&b.push(k),At.push(i),f=o),k=i;for(k&&b.push(k),b.push(65535),At.push(65535),It=2*(Dt=At.length),ft=2*Math.pow(Math.log(Dt)/Math.LN2,2),C=Math.log(ft/2)/Math.LN2,yt=2*Dt-ft,h=[],pt=[],B=[],R=ae=0,Te=At.length;ae<Te;R=++ae){if(ut=At[R],g=b[R],ut===65535){h.push(0),pt.push(0);break}if(ut-(Bt=n[ut].new)>=32768)for(h.push(0),pt.push(2*(B.length+Dt-R)),i=te=ut;ut<=g?te<=g:te>=g;i=ut<=g?++te:--te)B.push(n[i].new);else h.push(Bt-ut),pt.push(0)}for(vt.writeUInt16(3),vt.writeUInt16(1),vt.writeUInt32(12),vt.writeUInt16(4),vt.writeUInt16(16+8*Dt+2*B.length),vt.writeUInt16(0),vt.writeUInt16(It),vt.writeUInt16(ft),vt.writeUInt16(C),vt.writeUInt16(yt),se=0,rt=b.length;se<rt;se++)i=b[se],vt.writeUInt16(i);for(vt.writeUInt16(0),Ae=0,wt=At.length;Ae<wt;Ae++)i=At[Ae],vt.writeUInt16(i);for(Ce=0,St=h.length;Ce<St;Ce++)o=h[Ce],vt.writeUInt16(o);for(Pe=0,qt=pt.length;Pe<qt;Pe++)st=pt[Pe],vt.writeUInt16(st);for(Ve=0,Jt=B.length;Ve<Jt;Ve++)D=B[Ve],vt.writeUInt16(D);return{charMap:n,subtable:vt.data,maxGlyphID:et+1}}},r}(),gF=function(r){function t(){return t.__super__.constructor.apply(this,arguments)}return Ol(t,zc),t.prototype.tag="cmap",t.prototype.parse=function(e){var n,i,s;for(e.pos=this.offset,this.version=e.readUInt16(),s=e.readUInt16(),this.tables=[],this.unicode=null,i=0;0<=s?i<s:i>s;i=0<=s?++i:--i)n=new pF(e,this.offset),this.tables.push(n),n.isUnicode&&this.unicode==null&&(this.unicode=n);return!0},t.encode=function(e,n){var i,s;return n==null&&(n="macroman"),i=pF.encode(e,n),(s=new Tu).writeUInt16(0),s.writeUInt16(1),i.table=s.data.concat(i.subtable),i},t}(),Dtt=function(r){function t(){return t.__super__.constructor.apply(this,arguments)}return Ol(t,zc),t.prototype.tag="hhea",t.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.ascender=e.readShort(),this.decender=e.readShort(),this.lineGap=e.readShort(),this.advanceWidthMax=e.readShort(),this.minLeftSideBearing=e.readShort(),this.minRightSideBearing=e.readShort(),this.xMaxExtent=e.readShort(),this.caretSlopeRise=e.readShort(),this.caretSlopeRun=e.readShort(),this.caretOffset=e.readShort(),e.pos+=8,this.metricDataFormat=e.readShort(),this.numberOfMetrics=e.readUInt16()},t}(),Ott=function(r){function t(){return t.__super__.constructor.apply(this,arguments)}return Ol(t,zc),t.prototype.tag="OS/2",t.prototype.parse=function(e){if(e.pos=this.offset,this.version=e.readUInt16(),this.averageCharWidth=e.readShort(),this.weightClass=e.readUInt16(),this.widthClass=e.readUInt16(),this.type=e.readShort(),this.ySubscriptXSize=e.readShort(),this.ySubscriptYSize=e.readShort(),this.ySubscriptXOffset=e.readShort(),this.ySubscriptYOffset=e.readShort(),this.ySuperscriptXSize=e.readShort(),this.ySuperscriptYSize=e.readShort(),this.ySuperscriptXOffset=e.readShort(),this.ySuperscriptYOffset=e.readShort(),this.yStrikeoutSize=e.readShort(),this.yStrikeoutPosition=e.readShort(),this.familyClass=e.readShort(),this.panose=function(){var n,i;for(i=[],n=0;n<10;++n)i.push(e.readByte());return i}(),this.charRange=function(){var n,i;for(i=[],n=0;n<4;++n)i.push(e.readInt());return i}(),this.vendorID=e.readString(4),this.selection=e.readShort(),this.firstCharIndex=e.readShort(),this.lastCharIndex=e.readShort(),this.version>0&&(this.ascent=e.readShort(),this.descent=e.readShort(),this.lineGap=e.readShort(),this.winAscent=e.readShort(),this.winDescent=e.readShort(),this.codePageRange=function(){var n,i;for(i=[],n=0;n<2;n=++n)i.push(e.readInt());return i}(),this.version>1))return this.xHeight=e.readShort(),this.capHeight=e.readShort(),this.defaultChar=e.readShort(),this.breakChar=e.readShort(),this.maxContext=e.readShort()},t}(),Ntt=function(r){function t(){return t.__super__.constructor.apply(this,arguments)}return Ol(t,zc),t.prototype.tag="post",t.prototype.parse=function(e){var n,i,s;switch(e.pos=this.offset,this.format=e.readInt(),this.italicAngle=e.readInt(),this.underlinePosition=e.readShort(),this.underlineThickness=e.readShort(),this.isFixedPitch=e.readInt(),this.minMemType42=e.readInt(),this.maxMemType42=e.readInt(),this.minMemType1=e.readInt(),this.maxMemType1=e.readInt(),this.format){case 65536:break;case 131072:var a;for(i=e.readUInt16(),this.glyphNameIndex=[],a=0;0<=i?a<i:a>i;a=0<=i?++a:--a)this.glyphNameIndex.push(e.readUInt16());for(this.names=[],s=[];e.pos<this.offset+this.length;)n=e.readByte(),s.push(this.names.push(e.readString(n)));return s;case 151552:return i=e.readUInt16(),this.offsets=e.read(i);case 196608:break;case 262144:return this.map=(function(){var o,h,f;for(f=[],a=o=0,h=this.file.maxp.numGlyphs;0<=h?o<h:o>h;a=0<=h?++o:--o)f.push(e.readUInt32());return f}).call(this)}},t}(),ktt=function(r,t){this.raw=r,this.length=r.length,this.platformID=t.platformID,this.encodingID=t.encodingID,this.languageID=t.languageID},Qtt=function(r){function t(){return t.__super__.constructor.apply(this,arguments)}return Ol(t,zc),t.prototype.tag="name",t.prototype.parse=function(e){var n,i,s,a,o,h,f,g,b,C,B;for(e.pos=this.offset,e.readShort(),n=e.readShort(),h=e.readShort(),i=[],a=0;0<=n?a<n:a>n;a=0<=n?++a:--a)i.push({platformID:e.readShort(),encodingID:e.readShort(),languageID:e.readShort(),nameID:e.readShort(),length:e.readShort(),offset:this.offset+h+e.readShort()});for(f={},a=b=0,C=i.length;b<C;a=++b)s=i[a],e.pos=s.offset,g=e.readString(s.length),o=new ktt(g,s),f[B=s.nameID]==null&&(f[B]=[]),f[s.nameID].push(o);this.strings=f,this.copyright=f[0],this.fontFamily=f[1],this.fontSubfamily=f[2],this.uniqueSubfamily=f[3],this.fontName=f[4],this.version=f[5];try{this.postscriptName=f[6][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}catch{this.postscriptName=f[4][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}return this.trademark=f[7],this.manufacturer=f[8],this.designer=f[9],this.description=f[10],this.vendorUrl=f[11],this.designerUrl=f[12],this.license=f[13],this.licenseUrl=f[14],this.preferredFamily=f[15],this.preferredSubfamily=f[17],this.compatibleFull=f[18],this.sampleText=f[19]},t}(),ztt=function(r){function t(){return t.__super__.constructor.apply(this,arguments)}return Ol(t,zc),t.prototype.tag="maxp",t.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.numGlyphs=e.readUInt16(),this.maxPoints=e.readUInt16(),this.maxContours=e.readUInt16(),this.maxCompositePoints=e.readUInt16(),this.maxComponentContours=e.readUInt16(),this.maxZones=e.readUInt16(),this.maxTwilightPoints=e.readUInt16(),this.maxStorage=e.readUInt16(),this.maxFunctionDefs=e.readUInt16(),this.maxInstructionDefs=e.readUInt16(),this.maxStackElements=e.readUInt16(),this.maxSizeOfInstructions=e.readUInt16(),this.maxComponentElements=e.readUInt16(),this.maxComponentDepth=e.readUInt16()},t}(),Htt=function(r){function t(){return t.__super__.constructor.apply(this,arguments)}return Ol(t,zc),t.prototype.tag="hmtx",t.prototype.parse=function(e){var n,i,s,a,o,h,f;for(e.pos=this.offset,this.metrics=[],n=0,h=this.file.hhea.numberOfMetrics;0<=h?n<h:n>h;n=0<=h?++n:--n)this.metrics.push({advance:e.readUInt16(),lsb:e.readInt16()});for(s=this.file.maxp.numGlyphs-this.file.hhea.numberOfMetrics,this.leftSideBearings=function(){var g,b;for(b=[],n=g=0;0<=s?g<s:g>s;n=0<=s?++g:--g)b.push(e.readInt16());return b}(),this.widths=(function(){var g,b,C,B;for(B=[],g=0,b=(C=this.metrics).length;g<b;g++)a=C[g],B.push(a.advance);return B}).call(this),i=this.widths[this.widths.length-1],f=[],n=o=0;0<=s?o<s:o>s;n=0<=s?++o:--o)f.push(this.widths.push(i));return f},t.prototype.forGlyph=function(e){return e in this.metrics?this.metrics[e]:{advance:this.metrics[this.metrics.length-1].advance,lsb:this.leftSideBearings[e-this.metrics.length]}},t}(),mF=[].slice,Gtt=function(r){function t(){return t.__super__.constructor.apply(this,arguments)}return Ol(t,zc),t.prototype.tag="glyf",t.prototype.parse=function(){return this.cache={}},t.prototype.glyphFor=function(e){var n,i,s,a,o,h,f,g,b,C;return e in this.cache?this.cache[e]:(a=this.file.loca,n=this.file.contents,i=a.indexOf(e),(s=a.lengthOf(e))===0?this.cache[e]=null:(n.pos=this.offset+i,o=(h=new Tu(n.read(s))).readShort(),g=h.readShort(),C=h.readShort(),f=h.readShort(),b=h.readShort(),this.cache[e]=o===-1?new jtt(h,g,C,f,b):new Vtt(h,o,g,C,f,b),this.cache[e]))},t.prototype.encode=function(e,n,i){var s,a,o,h,f;for(o=[],a=[],h=0,f=n.length;h<f;h++)s=e[n[h]],a.push(o.length),s&&(o=o.concat(s.encode(i)));return a.push(o.length),{table:o,offsets:a}},t}(),Vtt=function(){function r(t,e,n,i,s,a){this.raw=t,this.numberOfContours=e,this.xMin=n,this.yMin=i,this.xMax=s,this.yMax=a,this.compound=!1}return r.prototype.encode=function(){return this.raw.data},r}(),jtt=function(){function r(t,e,n,i,s){var a,o;for(this.raw=t,this.xMin=e,this.yMin=n,this.xMax=i,this.yMax=s,this.compound=!0,this.glyphIDs=[],this.glyphOffsets=[],a=this.raw;o=a.readShort(),this.glyphOffsets.push(a.pos),this.glyphIDs.push(a.readUInt16()),32&o;)a.pos+=1&o?4:2,128&o?a.pos+=8:64&o?a.pos+=4:8&o&&(a.pos+=2)}return r.prototype.encode=function(){var t,e,n;for(e=new Tu(mF.call(this.raw.data)),t=0,n=this.glyphIDs.length;t<n;++t)e.pos=this.glyphOffsets[t];return e.data},r}(),qtt=function(r){function t(){return t.__super__.constructor.apply(this,arguments)}return Ol(t,zc),t.prototype.tag="loca",t.prototype.parse=function(e){var n,i;return e.pos=this.offset,n=this.file.head.indexToLocFormat,this.offsets=n===0?(function(){var s,a;for(a=[],i=0,s=this.length;i<s;i+=2)a.push(2*e.readUInt16());return a}).call(this):(function(){var s,a;for(a=[],i=0,s=this.length;i<s;i+=4)a.push(e.readUInt32());return a}).call(this)},t.prototype.indexOf=function(e){return this.offsets[e]},t.prototype.lengthOf=function(e){return this.offsets[e+1]-this.offsets[e]},t.prototype.encode=function(e,n){for(var i=new Uint32Array(this.offsets.length),s=0,a=0,o=0;o<i.length;++o)if(i[o]=s,a<n.length&&n[a]==o){++a,i[o]=s;var h=this.offsets[o],f=this.offsets[o+1]-h;f>0&&(s+=f)}for(var g=new Array(4*i.length),b=0;b<i.length;++b)g[4*b+3]=255&i[b],g[4*b+2]=(65280&i[b])>>8,g[4*b+1]=(16711680&i[b])>>16,g[4*b]=(4278190080&i[b])>>24;return g},t}(),Ktt=function(){function r(t){this.font=t,this.subset={},this.unicodes={},this.next=33}return r.prototype.generateCmap=function(){var t,e,n,i,s;for(e in i=this.font.cmap.tables[0].codeMap,t={},s=this.subset)n=s[e],t[e]=i[n];return t},r.prototype.glyphsFor=function(t){var e,n,i,s,a,o,h;for(i={},a=0,o=t.length;a<o;a++)i[s=t[a]]=this.font.glyf.glyphFor(s);for(s in e=[],i)(n=i[s])!=null&&n.compound&&e.push.apply(e,n.glyphIDs);if(e.length>0)for(s in h=this.glyphsFor(e))n=h[s],i[s]=n;return i},r.prototype.encode=function(t,e){var n,i,s,a,o,h,f,g,b,C,B,R,D,Q,k;for(i in n=gF.encode(this.generateCmap(),"unicode"),a=this.glyphsFor(t),B={0:0},k=n.charMap)B[(h=k[i]).old]=h.new;for(R in C=n.maxGlyphID,a)R in B||(B[R]=C++);return g=function(j){var et,st;for(et in st={},j)st[j[et]]=et;return st}(B),b=Object.keys(g).sort(function(j,et){return j-et}),D=function(){var j,et,st;for(st=[],j=0,et=b.length;j<et;j++)o=b[j],st.push(g[o]);return st}(),s=this.font.glyf.encode(a,D,B),f=this.font.loca.encode(s.offsets,D),Q={cmap:this.font.cmap.raw(),glyf:s.table,loca:f,hmtx:this.font.hmtx.raw(),hhea:this.font.hhea.raw(),maxp:this.font.maxp.raw(),post:this.font.post.raw(),name:this.font.name.raw(),head:this.font.head.encode(e)},this.font.os2.exists&&(Q["OS/2"]=this.font.os2.raw()),this.font.directory.encode(Q)},r}();Xr.API.PDFObject=function(){var r;function t(){}return r=function(e,n){return(Array(n+1).join("0")+e).slice(-n)},t.convert=function(e){var n,i,s,a;if(Array.isArray(e))return"["+function(){var o,h,f;for(f=[],o=0,h=e.length;o<h;o++)n=e[o],f.push(t.convert(n));return f}().join(" ")+"]";if(typeof e=="string")return"/"+e;if(e!=null&&e.isString)return"("+e+")";if(e instanceof Date)return"(D:"+r(e.getUTCFullYear(),4)+r(e.getUTCMonth(),2)+r(e.getUTCDate(),2)+r(e.getUTCHours(),2)+r(e.getUTCMinutes(),2)+r(e.getUTCSeconds(),2)+"Z)";if({}.toString.call(e)==="[object Object]"){for(i in s=["<<"],e)a=e[i],s.push("/"+i+" "+t.convert(a));return s.push(">>"),s.join(`
`)}return""+e},t}(),function(r){var t={};function e(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return r[n].call(i.exports,i,i.exports,e),i.l=!0,i.exports}e.m=r,e.c=t,e.d=function(n,i,s){e.o(n,i)||Object.defineProperty(n,i,{enumerable:!0,get:s})},e.r=function(n){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},e.t=function(n,i){if(1&i&&(n=e(n)),8&i||4&i&&typeof n=="object"&&n&&n.__esModule)return n;var s=Object.create(null);if(e.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:n}),2&i&&typeof n!="string")for(var a in n)e.d(s,a,(function(o){return n[o]}).bind(null,a));return s},e.n=function(n){var i=n&&n.__esModule?function(){return n.default}:function(){return n};return e.d(i,"a",i),i},e.o=function(n,i){return Object.prototype.hasOwnProperty.call(n,i)},e.p="",e(e.s=0)}([function(r,t,e){r.exports=e(1)},function(r,t){function e(i,s){for(var a=0;a<s.length;a++){var o=s[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(i,o.key,o)}}var n=function(){function i(){(function(o,h){if(!(o instanceof h))throw new TypeError("Cannot call a class as a function")})(this,i),this.options={overlayBackgroundColor:"#666666",overlayOpacity:.6,spinnerIcon:"ball-circus",spinnerColor:"#000",spinnerSize:"3x",overlayIDName:"overlay",spinnerIDName:"spinner",offsetY:0,offsetX:0,lockScroll:!1,containerID:null,spinnerZIndex:99999,overlayZIndex:99998},this.stylesheetBaseURL="https://cdn.jsdelivr.net/npm/load-awesome@1.1.0/css/",this.spinner=null,this.spinnerStylesheetURL=null,this.numberOfEmptyDivForSpinner={"ball-8bits":16,"ball-atom":4,"ball-beat":3,"ball-circus":5,"ball-climbing-dot":1,"ball-clip-rotate":1,"ball-clip-rotate-multiple":2,"ball-clip-rotate-pulse":2,"ball-elastic-dots":5,"ball-fall":3,"ball-fussion":4,"ball-grid-beat":9,"ball-grid-pulse":9,"ball-newton-cradle":4,"ball-pulse":3,"ball-pulse-rise":5,"ball-pulse-sync":3,"ball-rotate":1,"ball-running-dots":5,"ball-scale":1,"ball-scale-multiple":3,"ball-scale-pulse":2,"ball-scale-ripple":1,"ball-scale-ripple-multiple":3,"ball-spin":8,"ball-spin-clockwise":8,"ball-spin-clockwise-fade":8,"ball-spin-clockwise-fade-rotating":8,"ball-spin-fade":8,"ball-spin-fade-rotating":8,"ball-spin-rotate":2,"ball-square-clockwise-spin":8,"ball-square-spin":8,"ball-triangle-path":3,"ball-zig-zag":2,"ball-zig-zag-deflect":2,cog:1,"cube-transition":2,fire:3,"line-scale":5,"line-scale-party":5,"line-scale-pulse-out":5,"line-scale-pulse-out-rapid":5,"line-spin-clockwise-fade":8,"line-spin-clockwise-fade-rotating":8,"line-spin-fade":8,"line-spin-fade-rotating":8,pacman:6,"square-jelly-box":2,"square-loader":1,"square-spin":1,timer:1,"triangle-skew-spin":1}}var s,a;return s=i,(a=[{key:"show",value:function(o){this.setOptions(o),this.addSpinnerStylesheet(),this.generateSpinnerElement(),this.options.lockScroll&&(document.body.style.overflow="hidden",document.documentElement.style.overflow="hidden"),this.generateAndAddOverlayElement()}},{key:"hide",value:function(){this.options.lockScroll&&(document.body.style.overflow="",document.documentElement.style.overflow="");var o=document.getElementById("loading-overlay-stylesheet");o&&(o.disabled=!0,o.parentNode.removeChild(o),document.getElementById(this.options.overlayIDName).remove(),document.getElementById(this.options.spinnerIDName).remove())}},{key:"setOptions",value:function(o){if(o!==void 0)for(var h in o)this.options[h]=o[h]}},{key:"generateAndAddOverlayElement",value:function(){var o="50%";this.options.offsetX!==0&&(o="calc(50% + "+this.options.offsetX+")");var h="50%";if(this.options.offsetY!==0&&(h="calc(50% + "+this.options.offsetY+")"),this.options.containerID&&document.body.contains(document.getElementById(this.options.containerID))){var f='<div id="'.concat(this.options.overlayIDName,'" style="display: block !important; position: absolute; top: 0; left: 0; overflow: auto; opacity: ').concat(this.options.overlayOpacity,"; background: ").concat(this.options.overlayBackgroundColor,'; z-index: 50; width: 100%; height: 100%;"></div><div id="').concat(this.options.spinnerIDName,'" style="display: block !important; position: absolute; top: ').concat(h,"; left: ").concat(o,'; -webkit-transform: translate(-50%); -ms-transform: translate(-50%); transform: translate(-50%); z-index: 9999;">').concat(this.spinner,"</div>"),g=document.getElementById(this.options.containerID);return g.style.position="relative",void g.insertAdjacentHTML("beforeend",f)}var b='<div id="'.concat(this.options.overlayIDName,'" style="display: block !important; position: fixed; top: 0; left: 0; overflow: auto; opacity: ').concat(this.options.overlayOpacity,"; background: ").concat(this.options.overlayBackgroundColor,"; z-index: ").concat(this.options.overlayZIndex,'; width: 100%; height: 100%;"></div><div id="').concat(this.options.spinnerIDName,'" style="display: block !important; position: fixed; top: ').concat(h,"; left: ").concat(o,"; -webkit-transform: translate(-50%); -ms-transform: translate(-50%); transform: translate(-50%); z-index: ").concat(this.options.spinnerZIndex,';">').concat(this.spinner,"</div>");document.body.insertAdjacentHTML("beforeend",b)}},{key:"generateSpinnerElement",value:function(){var o=this,h=Object.keys(this.numberOfEmptyDivForSpinner).find(function(g){return g===o.options.spinnerIcon}),f=this.generateEmptyDivElement(this.numberOfEmptyDivForSpinner[h]);this.spinner='<div style="color: '.concat(this.options.spinnerColor,'" class="la-').concat(this.options.spinnerIcon," la-").concat(this.options.spinnerSize,'">').concat(f,"</div>")}},{key:"addSpinnerStylesheet",value:function(){this.setSpinnerStylesheetURL();var o=document.createElement("link");o.setAttribute("id","loading-overlay-stylesheet"),o.setAttribute("rel","stylesheet"),o.setAttribute("type","text/css"),o.setAttribute("href",this.spinnerStylesheetURL),document.getElementsByTagName("head")[0].appendChild(o)}},{key:"setSpinnerStylesheetURL",value:function(){this.spinnerStylesheetURL=this.stylesheetBaseURL+this.options.spinnerIcon+".min.css"}},{key:"generateEmptyDivElement",value:function(o){for(var h="",f=1;f<=o;f++)h+="<div></div>";return h}}])&&e(s.prototype,a),i}();window.JsLoadingOverlay=new n,r.exports=JsLoadingOverlay}]);const Iu={JPEG:"jpg",PNG:"png",PDF:"pdf",SVG:"svg"},sg={in:"in",mm:"mm"},lf={A2:[594,420],A3:[420,297],A4:[297,210],A5:[210,148],A6:[148,105],B2:[707,500],B3:[500,353],B4:[353,250],B5:[250,176],B6:[176,125]},og={Landscape:"landscape",Portrait:"portrait"},Vw={72:72,96:96,200:200,300:300,400:400};let $tt=class{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:lf.A4,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:300,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:Iu.PNG.toString(),s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:sg.mm,a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"map";Ai(this,"map"),Ai(this,"width"),Ai(this,"height"),Ai(this,"dpi"),Ai(this,"format"),Ai(this,"unit"),Ai(this,"fileName"),this.map=t,this.width=e[0],this.height=e[1],this.dpi=n,this.format=i,this.unit=s,this.fileName=a}generate(){const t=this;JsLoadingOverlay.show({overlayBackgroundColor:"#5D5959",overlayOpacity:"0.6",spinnerIcon:"ball-spin",spinnerColor:"#2400FD",spinnerSize:"2x",overlayIDName:"overlay",spinnerIDName:"spinner",offsetX:0,offsetY:0,containerID:null,lockScroll:!1,overlayZIndex:9998,spinnerZIndex:9999});const e=window.devicePixelRatio;Object.defineProperty(window,"devicePixelRatio",{get(){return t.dpi/96}});const n=document.createElement("div");n.className="hidden-map",document.body.appendChild(n);const i=document.createElement("div");i.style.width=this.toPixels(this.width),i.style.height=this.toPixels(this.height),n.appendChild(i);const s=this.map.getStyle();if(s&&s.sources){const o=s.sources;Object.keys(o).forEach(h=>{const f=o[h];Object.keys(f).forEach(g=>{f[g]||delete f[g]})})}const a=new oE.Map({container:i,style:s,center:this.map.getCenter(),zoom:this.map.getZoom(),bearing:this.map.getBearing(),pitch:this.map.getPitch(),interactive:!1,preserveDrawingBuffer:!0,fadeDuration:0,attributionControl:!1,transformRequest:this.map._requestManager._transformRequestFn});a.once("idle",()=>{var o;const h=a.getCanvas(),f=`${this.fileName}.${t.format}`;switch(t.format){case Iu.PNG:t.toPNG(h,f);break;case Iu.JPEG:t.toJPEG(h,f);break;case Iu.PDF:t.toPDF(a,f);break;case Iu.SVG:t.toSVG(h,f);break;default:console.error(`Invalid file format: ${t.format}`);break}a.remove(),(o=n.parentNode)==null||o.removeChild(n),Object.defineProperty(window,"devicePixelRatio",{get(){return e}}),n.remove(),JsLoadingOverlay.hide()})}toPNG(t,e){const n=document.createElement("a");n.href=t.toDataURL(),n.download=e,n.click(),n.remove()}toJPEG(t,e){const n=t.toDataURL("image/jpeg",.85);if(t.msToBlob){const i=this.toBlob(n);window.navigator.msSaveBlob(i,e)}else{const i=document.createElement("a");i.href=n,i.download=e,i.click(),i.remove()}}toPDF(t,e){const n=t.getCanvas(),i=new Xr({orientation:this.width>this.height?"l":"p",unit:this.unit,compress:!0,format:[this.width,this.height]});i.addImage(n.toDataURL("image/png"),"png",0,0,this.width,this.height,void 0,"FAST");const{lng:s,lat:a}=t.getCenter();i.setProperties({title:t.getStyle().name,subject:`center: [${s}, ${a}], zoom: ${t.getZoom()}`,creator:"Mapbox GL Export Plugin",author:"(c)Mapbox, (c)OpenStreetMap"}),i.save(e)}toSVG(t,e){const n=t.toDataURL("image/png"),i=Number(this.toPixels(this.width,this.dpi).replace("px","")),s=Number(this.toPixels(this.height,this.dpi).replace("px","")),a=`
    <svg xmlns="http://www.w3.org/2000/svg" 
      xmlns:xlink="http://www.w3.org/1999/xlink" 
      version="1.1" 
      width="${i}" 
      height="${s}" 
      viewBox="0 0 ${i} ${s}" 
      xml:space="preserve">
        <image style="stroke: none; stroke-width: 0; stroke-dasharray: none; stroke-linecap: butt; stroke-dashoffset: 0; stroke-linejoin: miter; stroke-miterlimit: 4; fill: rgb(0,0,0); fill-rule: nonzero; opacity: 1;"  
      xlink:href="${n}" width="${i}" height="${s}"></image>
    </svg>`,o=document.createElement("a");o.href=`data:application/xml,${encodeURIComponent(a)}`,o.download=e,o.click(),o.remove()}toPixels(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:96;return this.unit===sg.mm&&(e/=25.4),`${e*t}px`}toBlob(t){const e=atob(t.replace(/^.*,/,"")),n=new Uint8Array(e.length);for(let i=0;i<e.length;i+=1)n[i]=e.charCodeAt(i);return new Blob([n.buffer],{type:"image/png"})}},Wtt=class{constructor(t){Ai(this,"map"),Ai(this,"width"),Ai(this,"height"),Ai(this,"unit"),Ai(this,"svgCanvas"),Ai(this,"svgPath");var e,n,i;if(this.map=t,this.map===void 0)return;this.mapResize=this.mapResize.bind(this),this.map.on("resize",this.mapResize);const s=(e=this.map)==null?void 0:e.getCanvas().clientWidth,a=(n=this.map)==null?void 0:n.getCanvas().clientHeight,o=document.createElementNS("http://www.w3.org/2000/svg","svg");o.style.position="absolute",o.style.top="0px",o.style.left="0px",o.setAttribute("width",`${s}px`),o.setAttribute("height",`${a}px`);const h=document.createElementNS("http://www.w3.org/2000/svg","path");h.setAttribute("style","fill:#888888;stroke-width:0"),h.setAttribute("fill-opacity","0.5"),o.append(h),(i=this.map)==null||i.getCanvasContainer().appendChild(o),this.svgCanvas=o,this.svgPath=h}mapResize(){this.generateCutOut()}updateArea(t,e){this.width=t,this.height=e,this.unit=sg.mm,this.generateCutOut()}generateCutOut(){var t,e;if(this.map===void 0||this.svgCanvas===void 0||this.svgPath===void 0)return;const n=this.toPixels(this.width),i=this.toPixels(this.height),s=(t=this.map)==null?void 0:t.getCanvas().clientWidth,a=(e=this.map)==null?void 0:e.getCanvas().clientHeight,o=s/2-n/2,h=o+n,f=a/2-i/2,g=f+i;this.svgCanvas.setAttribute("width",`${s}px`),this.svgCanvas.setAttribute("height",`${a}px`),this.svgPath.setAttribute("d",`M 0 0 L ${s} 0 L ${s} ${a} L 0 ${a} M ${o} ${f} L ${o} ${g} L ${h} ${g} L ${h} ${f}`)}destroy(){this.svgCanvas!==void 0&&(this.svgCanvas.remove(),this.svgCanvas=void 0),this.map!==void 0&&(this.map=void 0)}toPixels(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:96;return this.unit===sg.mm&&(e/=25.4),e*t}};const yF={PageSize:"Page Size",PageOrientation:"Page Orientation",Format:"Format",DPI:"DPI",Generate:"Generate"},Xtt={PageSize:"Taille de page",PageOrientation:"Orientation de la page",Format:"Format",DPI:"DPI",Generate:"Gnrer"},Jtt={PageSize:"Sivukoko",PageOrientation:"Sivun suunta",Format:"Muoto",DPI:"DPI",Generate:"Generoi"},Ytt={PageSize:"Papierformat",PageOrientation:"Papierausrichtung",Format:"Dateiformat",DPI:"Druckauflsung",Generate:"Erstellen"},Ztt={PageSize:"Sidstorlek",PageOrientation:"Sidorientering",Format:"Format",DPI:"DPI",Generate:"Generera"},tet={PageSize:"Tamao de pgina",PageOrientation:"Orientacin de pgina",Format:"Formato",DPI:"DPI",Generate:"Generar"},eet={PageSize:"Kch thc trang",PageOrientation:"Loi trang",Format:"nh dng",DPI:"Mt  im nh (DPI)",Generate:"To"},ret={PageSize:" ",PageOrientation:" ",Format:"",DPI:"DPI",Generate:""},net={PageSize:"",PageOrientation:"",Format:"",DPI:"",Generate:""},iet={PageSize:"",PageOrientation:"",Format:"",DPI:"",Generate:""},set={PageSize:"",PageOrientation:"",Format:"",DPI:"DPI",Generate:""};let oet=class{constructor(t){Ai(this,"controlContainer"),Ai(this,"exportContainer"),Ai(this,"crosshair"),Ai(this,"printableArea"),Ai(this,"map"),Ai(this,"exportButton"),Ai(this,"options",{PageSize:lf.A4,PageOrientation:og.Landscape,Format:Iu.PDF,DPI:Vw[300],Crosshair:!1,PrintableArea:!1,Local:"en",AllowedSizes:Object.keys(lf),Filename:"map"}),t&&(this.options=Object.assign(this.options,t)),this.onDocumentClick=this.onDocumentClick.bind(this)}getDefaultPosition(){return"top-right"}getTranslation(){switch(this.options.Local){case"de":return Ytt;case"en":return yF;case"fr":return Xtt;case"fi":return Jtt;case"sv":return Ztt;case"es":return tet;case"vi":return eet;case"uk":return ret;case"zhHans":return net;case"zhHant":return iet;case"ja":return set;default:return yF}}onAdd(t){var e;this.map=t,this.controlContainer=document.createElement("div"),this.controlContainer.classList.add("maplibregl-ctrl"),this.controlContainer.classList.add("maplibregl-ctrl-group"),this.exportContainer=document.createElement("div"),this.exportContainer.classList.add("maplibregl-export-list"),this.exportButton=document.createElement("button"),this.exportButton.classList.add("maplibregl-ctrl-icon"),this.exportButton.classList.add("maplibregl-export-control"),this.exportButton.type="button",this.exportButton.addEventListener("click",()=>{this.exportButton.style.display="none",this.exportContainer.style.display="block",this.toggleCrosshair(!0),this.togglePrintableArea(!0)}),document.addEventListener("click",this.onDocumentClick),this.controlContainer.appendChild(this.exportButton),this.controlContainer.appendChild(this.exportContainer);const n=document.createElement("TABLE");n.className="print-table";const i={};(e=this.options.AllowedSizes)==null||e.forEach(g=>{lf[g]&&(i[g]=lf[g])});const s=this.createSelection(i,this.getTranslation().PageSize,"page-size",this.options.PageSize,(g,b)=>JSON.stringify(g[b]));n.appendChild(s);const a=this.createSelection(og,this.getTranslation().PageOrientation,"page-orientation",this.options.PageOrientation,(g,b)=>g[b]);n.appendChild(a);const o=this.createSelection(Iu,this.getTranslation().Format,"format-type",this.options.Format,(g,b)=>g[b]);n.appendChild(o);const h=this.createSelection(Vw,this.getTranslation().DPI,"dpi-type",this.options.DPI,(g,b)=>g[b]);n.appendChild(h),this.exportContainer.appendChild(n);const f=document.createElement("button");return f.type="button",f.textContent=this.getTranslation().Generate,f.classList.add("generate-button"),f.addEventListener("click",()=>{const g=document.getElementById("mapbox-gl-export-page-size"),b=document.getElementById("mapbox-gl-export-page-orientation"),C=document.getElementById("mapbox-gl-export-format-type"),B=document.getElementById("mapbox-gl-export-dpi-type"),R=b.value;let D=JSON.parse(g.value);R===og.Portrait&&(D=D.reverse()),new $tt(t,D,Number(B.value),C.value,sg.mm,this.options.Filename).generate()}),this.exportContainer.appendChild(f),this.controlContainer}createSelection(t,e,n,i,s){const a=document.createElement("label");a.textContent=e;const o=document.createElement("select");o.setAttribute("id",`mapbox-gl-export-${n}`),o.style.width="100%",Object.keys(t).forEach(b=>{const C=document.createElement("option");C.setAttribute("value",s(t,b)),C.appendChild(document.createTextNode(b)),C.setAttribute("name",n),i===t[b]&&(C.selected=!0),o.appendChild(C)}),o.addEventListener("change",()=>{this.updatePrintableArea()});const h=document.createElement("TR"),f=document.createElement("TD"),g=document.createElement("TD");return f.appendChild(a),g.appendChild(o),h.appendChild(f),h.appendChild(g),h}onRemove(){!this.controlContainer||!this.controlContainer.parentNode||!this.map||!this.exportButton||(this.exportButton.removeEventListener("click",this.onDocumentClick),this.controlContainer.parentNode.removeChild(this.controlContainer),document.removeEventListener("click",this.onDocumentClick),this.crosshair!==void 0&&(this.crosshair.destroy(),this.crosshair=void 0),this.map=void 0)}onDocumentClick(t){this.controlContainer&&!this.controlContainer.contains(t.target)&&this.exportContainer&&this.exportButton&&(this.exportContainer.style.display="none",this.exportButton.style.display="block",this.toggleCrosshair(!1),this.togglePrintableArea(!1))}toggleCrosshair(t){this.options.Crosshair===!0&&(t===!1?this.crosshair!==void 0&&(this.crosshair.destroy(),this.crosshair=void 0):(this.crosshair=new XZ(this.map),this.crosshair.create()))}togglePrintableArea(t){this.options.PrintableArea===!0&&(t===!1?this.printableArea!==void 0&&(this.printableArea.destroy(),this.printableArea=void 0):(this.printableArea=new Wtt(this.map),this.updatePrintableArea()))}updatePrintableArea(){if(this.printableArea===void 0)return;const t=document.getElementById("mapbox-gl-export-page-size"),e=document.getElementById("mapbox-gl-export-page-orientation").value;let n=JSON.parse(t.value);e===og.Portrait&&(n=n.reverse()),this.printableArea.updateArea(n[0],n[1])}};var _F=cet,aet=Object.prototype.hasOwnProperty;function cet(){for(var r={},t=0;t<arguments.length;t++){var e=arguments[t];for(var n in e)aet.call(e,n)&&(r[n]=e[n])}return r}var vF={exports:{}};(function(r,t){(function(){var e={};r.exports=e,e.simpleFilter=function(n,i){return i.filter(function(s){return e.test(n,s)})},e.test=function(n,i){return e.match(n,i)!==null},e.match=function(n,i,s){s=s||{};var a=0,o=[],h=i.length,f=0,g=0,b=s.pre||"",C=s.post||"",B=s.caseSensitive&&i||i.toLowerCase(),R;n=s.caseSensitive&&n||n.toLowerCase();for(var D=0;D<h;D++)R=i[D],B[D]===n[a]?(R=b+R+C,a+=1,g+=1+g):g=0,f+=g,o[o.length]=R;return a===n.length?(f=B===n?1/0:f,{rendered:o.join(""),score:f}):null},e.filter=function(n,i,s){return!i||i.length===0?[]:typeof n!="string"?i:(s=s||{},i.reduce(function(a,o,h,f){var g=o;s.extract&&(g=s.extract(o));var b=e.match(n,g,s);return b!=null&&(a[a.length]={string:b.rendered,score:b.score,index:h,original:o}),a},[]).sort(function(a,o){var h=o.score-a.score;return h||a.index-o.index}))}})()})(vF);var Aet=vF.exports,ua=function(r){return this.component=r,this.items=[],this.active=r.options.noInitialSelection?-1:0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,r.el.parentNode.insertBefore(this.wrapper,r.el.nextSibling),this};ua.prototype.show=function(){this.element.style.display="block"},ua.prototype.hide=function(){this.element.style.display="none"},ua.prototype.add=function(r){this.items.push(r)},ua.prototype.clear=function(){this.items=[],this.active=this.component.options.noInitialSelection?-1:0},ua.prototype.isEmpty=function(){return!this.items.length},ua.prototype.isVisible=function(){return this.element.style.display==="block"},ua.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var r=0;r<this.items.length;r++)this.drawItem(this.items[r],this.active===r);this.show()},ua.prototype.drawItem=function(r,t){var e=document.createElement("li"),n=document.createElement("a");t&&(e.className+=" active"),n.innerHTML=r.string,e.appendChild(n),this.element.appendChild(e),e.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),e.addEventListener("mouseup",(function(){this.handleMouseUp.call(this,r)}).bind(this))},ua.prototype.handleMouseUp=function(r){this.selectingListItem=!1,this.component.value(r.original),this.clear(),this.draw()},ua.prototype.move=function(r){this.active=r,this.draw()},ua.prototype.previous=function(){this.move(this.active<=0?this.items.length-1:this.active-1)},ua.prototype.next=function(){this.move(this.active>=this.items.length-1?0:this.active+1)},ua.prototype.drawError=function(r){var t=document.createElement("li");t.innerHTML=r,this.element.appendChild(t),this.show()};var uet=ua,het=_F,det=Aet,fet=uet,_o=function(r,t,e){return e=e||{},this.options=het({minLength:2,limit:5,filter:!0,hideOnBlur:!0,noInitialSelection:!0},e),this.el=r,this.data=t||[],this.list=new fet(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",(function(n){this.handleKeyUp(n.keyCode,n)}).bind(this),!1),this.el.addEventListener("keydown",(function(n){this.handleKeyDown(n)}).bind(this)),this.el.addEventListener("focus",(function(){this.handleFocus()}).bind(this)),this.el.addEventListener("blur",(function(){this.handleBlur()}).bind(this)),this.el.addEventListener("paste",(function(n){this.handlePaste(n)}).bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};_o.prototype.handleKeyUp=function(r,t){if(!(r===40||r===38||r===27||r===9)){if(r===13){this.list.items[this.list.active]&&(this.list.handleMouseUp(this.list.items[this.list.active]),t.stopPropagation());return}this.handleInputChange(this.el.value)}},_o.prototype.handleKeyDown=function(r){switch(r.keyCode){case 13:this.list.active>=0&&(this.list.selectingListItem=!0);break;case 9:this.list.isEmpty()||(this.list.isVisible()&&r.preventDefault(),this.value(this.list.active>=0?this.list.items[this.list.active].original:null),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}},_o.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()},_o.prototype.handlePaste=function(r){if(r.clipboardData)this.handleInputChange(r.clipboardData.getData("Text"));else{var t=this;setTimeout(function(){t.handleInputChange(r.target.value)},100)}},_o.prototype.handleInputChange=function(r){if(this.query=this.normalize(r),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates((function(t){for(var e=0;e<t.length&&(this.list.add(t[e]),e!==this.options.limit-1);e++);this.list.draw()}).bind(this))},_o.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1},_o.prototype.update=function(r){this.data=r,this.handleKeyUp()},_o.prototype.clear=function(){this.data=[],this.list.clear()},_o.prototype.normalize=function(r){return r=r.toLowerCase(),r},_o.prototype.match=function(r,t){return r.indexOf(t)>-1},_o.prototype.value=function(r){if(this.selected=r,this.el.value=this.getItemValue(r||{place_name:this.query}),document.createEvent){var t=document.createEvent("HTMLEvents");t.initEvent("change",!0,!1),this.el.dispatchEvent(t)}else this.el.fireEvent("onchange")},_o.prototype.getCandidates=function(r){var t={pre:"<strong>",post:"</strong>",extract:(function(n){return this.getItemValue(n)}).bind(this)},e;this.options.filter?(e=det.filter(this.query,this.data,t),e=e.map((function(n){return{original:n.original,string:this.render(n.original,n.string)}}).bind(this))):e=this.data.map((function(n){var i=this.render(n);return{original:n,string:i}}).bind(this)),r(e)},_o.prototype.getItemValue=function(r){return r},_o.prototype.render=function(r,t){if(t)return t;for(var e=r.original?this.getItemValue(r.original):this.getItemValue(r),n=this.normalize(e),i=n.lastIndexOf(this.query);i>-1;){var s=i+this.query.length;e=e.slice(0,i)+"<strong>"+e.slice(i,s)+"</strong>"+e.slice(s),i=n.slice(0,i).lastIndexOf(this.query)}return e},_o.prototype.renderError=function(r){this.list.drawError(r)};var pet=_o,bF=pet,get=bF;typeof window<"u"&&(window.Suggestions=bF);var met="Expected a function",wF=NaN,yet="[object Symbol]",_et=/^\s+|\s+$/g,vet=/^[-+]0x[0-9a-f]+$/i,bet=/^0b[01]+$/i,wet=/^0o[0-7]+$/i,xet=parseInt,Bet=typeof pd=="object"&&pd&&pd.Object===Object&&pd,Cet=typeof self=="object"&&self&&self.Object===Object&&self,Eet=Bet||Cet||Function("return this")(),Tet=Object.prototype,Iet=Tet.toString,Let=Math.max,Fet=Math.min,jw=function(){return Eet.Date.now()};function Met(r,t,e){var n,i,s,a,o,h,f=0,g=!1,b=!1,C=!0;if(typeof r!="function")throw new TypeError(met);t=xF(t)||0,qw(e)&&(g=!!e.leading,b="maxWait"in e,s=b?Let(xF(e.maxWait)||0,t):s,C="trailing"in e?!!e.trailing:C);function B(pt){var yt=n,ft=i;return n=i=void 0,f=pt,a=r.apply(ft,yt),a}function R(pt){return f=pt,o=setTimeout(k,t),g?B(pt):a}function D(pt){var yt=pt-h,ft=pt-f,Dt=t-yt;return b?Fet(Dt,s-ft):Dt}function Q(pt){var yt=pt-h,ft=pt-f;return h===void 0||yt>=t||yt<0||b&&ft>=s}function k(){var pt=jw();if(Q(pt))return j(pt);o=setTimeout(k,D(pt))}function j(pt){return o=void 0,C&&n?B(pt):(n=i=void 0,a)}function et(){o!==void 0&&clearTimeout(o),f=0,n=h=i=o=void 0}function st(){return o===void 0?a:j(jw())}function mt(){var pt=jw(),yt=Q(pt);if(n=arguments,i=this,h=pt,yt){if(o===void 0)return R(h);if(b)return o=setTimeout(k,t),B(h)}return o===void 0&&(o=setTimeout(k,t)),a}return mt.cancel=et,mt.flush=st,mt}function qw(r){var t=typeof r;return!!r&&(t=="object"||t=="function")}function Pet(r){return!!r&&typeof r=="object"}function Uet(r){return typeof r=="symbol"||Pet(r)&&Iet.call(r)==yet}function xF(r){if(typeof r=="number")return r;if(Uet(r))return wF;if(qw(r)){var t=typeof r.valueOf=="function"?r.valueOf():r;r=qw(t)?t+"":t}if(typeof r!="string")return r===0?r:+r;r=r.replace(_et,"");var e=bet.test(r);return e||wet.test(r)?xet(r.slice(2),e?2:8):vet.test(r)?wF:+r}var Ret=Met,Kw={exports:{}},Af=typeof Reflect=="object"?Reflect:null,BF=Af&&typeof Af.apply=="function"?Af.apply:function(t,e,n){return Function.prototype.apply.call(t,e,n)},ty;Af&&typeof Af.ownKeys=="function"?ty=Af.ownKeys:Object.getOwnPropertySymbols?ty=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:ty=function(t){return Object.getOwnPropertyNames(t)};function Det(r){console&&console.warn&&console.warn(r)}var CF=Number.isNaN||function(t){return t!==t};function ni(){ni.init.call(this)}Kw.exports=ni,Kw.exports.once=Qet,ni.EventEmitter=ni,ni.prototype._events=void 0,ni.prototype._eventsCount=0,ni.prototype._maxListeners=void 0;var EF=10;function ey(r){if(typeof r!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof r)}Object.defineProperty(ni,"defaultMaxListeners",{enumerable:!0,get:function(){return EF},set:function(r){if(typeof r!="number"||r<0||CF(r))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+r+".");EF=r}}),ni.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},ni.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||CF(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function SF(r){return r._maxListeners===void 0?ni.defaultMaxListeners:r._maxListeners}ni.prototype.getMaxListeners=function(){return SF(this)},ni.prototype.emit=function(t){for(var e=[],n=1;n<arguments.length;n++)e.push(arguments[n]);var i=t==="error",s=this._events;if(s!==void 0)i=i&&s.error===void 0;else if(!i)return!1;if(i){var a;if(e.length>0&&(a=e[0]),a instanceof Error)throw a;var o=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw o.context=a,o}var h=s[t];if(h===void 0)return!1;if(typeof h=="function")BF(h,this,e);else for(var f=h.length,g=MF(h,f),n=0;n<f;++n)BF(g[n],this,e);return!0};function TF(r,t,e,n){var i,s,a;if(ey(e),s=r._events,s===void 0?(s=r._events=Object.create(null),r._eventsCount=0):(s.newListener!==void 0&&(r.emit("newListener",t,e.listener?e.listener:e),s=r._events),a=s[t]),a===void 0)a=s[t]=e,++r._eventsCount;else if(typeof a=="function"?a=s[t]=n?[e,a]:[a,e]:n?a.unshift(e):a.push(e),i=SF(r),i>0&&a.length>i&&!a.warned){a.warned=!0;var o=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");o.name="MaxListenersExceededWarning",o.emitter=r,o.type=t,o.count=a.length,Det(o)}return r}ni.prototype.addListener=function(t,e){return TF(this,t,e,!1)},ni.prototype.on=ni.prototype.addListener,ni.prototype.prependListener=function(t,e){return TF(this,t,e,!0)};function Oet(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function IF(r,t,e){var n={fired:!1,wrapFn:void 0,target:r,type:t,listener:e},i=Oet.bind(n);return i.listener=e,n.wrapFn=i,i}ni.prototype.once=function(t,e){return ey(e),this.on(t,IF(this,t,e)),this},ni.prototype.prependOnceListener=function(t,e){return ey(e),this.prependListener(t,IF(this,t,e)),this},ni.prototype.removeListener=function(t,e){var n,i,s,a,o;if(ey(e),i=this._events,i===void 0)return this;if(n=i[t],n===void 0)return this;if(n===e||n.listener===e)--this._eventsCount===0?this._events=Object.create(null):(delete i[t],i.removeListener&&this.emit("removeListener",t,n.listener||e));else if(typeof n!="function"){for(s=-1,a=n.length-1;a>=0;a--)if(n[a]===e||n[a].listener===e){o=n[a].listener,s=a;break}if(s<0)return this;s===0?n.shift():Net(n,s),n.length===1&&(i[t]=n[0]),i.removeListener!==void 0&&this.emit("removeListener",t,o||e)}return this},ni.prototype.off=ni.prototype.removeListener,ni.prototype.removeAllListeners=function(t){var e,n,i;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[t]),this;if(arguments.length===0){var s=Object.keys(n),a;for(i=0;i<s.length;++i)a=s[i],a!=="removeListener"&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(e=n[t],typeof e=="function")this.removeListener(t,e);else if(e!==void 0)for(i=e.length-1;i>=0;i--)this.removeListener(t,e[i]);return this};function LF(r,t,e){var n=r._events;if(n===void 0)return[];var i=n[t];return i===void 0?[]:typeof i=="function"?e?[i.listener||i]:[i]:e?ket(i):MF(i,i.length)}ni.prototype.listeners=function(t){return LF(this,t,!0)},ni.prototype.rawListeners=function(t){return LF(this,t,!1)},ni.listenerCount=function(r,t){return typeof r.listenerCount=="function"?r.listenerCount(t):FF.call(r,t)},ni.prototype.listenerCount=FF;function FF(r){var t=this._events;if(t!==void 0){var e=t[r];if(typeof e=="function")return 1;if(e!==void 0)return e.length}return 0}ni.prototype.eventNames=function(){return this._eventsCount>0?ty(this._events):[]};function MF(r,t){for(var e=new Array(t),n=0;n<t;++n)e[n]=r[n];return e}function Net(r,t){for(;t+1<r.length;t++)r[t]=r[t+1];r.pop()}function ket(r){for(var t=new Array(r.length),e=0;e<t.length;++e)t[e]=r[e].listener||r[e];return t}function Qet(r,t){return new Promise(function(e,n){function i(a){r.removeListener(t,s),n(a)}function s(){typeof r.removeListener=="function"&&r.removeListener("error",i),e([].slice.call(arguments))}PF(r,t,s,{once:!0}),t!=="error"&&zet(r,i,{once:!0})})}function zet(r,t,e){typeof r.on=="function"&&PF(r,"error",t,e)}function PF(r,t,e,n){if(typeof r.on=="function")n.once?r.once(t,e):r.on(t,e);else if(typeof r.addEventListener=="function")r.addEventListener(t,function i(s){n.once&&r.removeEventListener(t,i),e(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof r)}var UF=Kw.exports,Het={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}},Get={de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"",ja:"",lv:"Meklt",pt:"Procurar",sr:"",zh:"",cs:"Vyhledvn",hu:"Keress",ka:"",nb:"Ske",sk:"Vyhadvanie",th:"",fi:"Hae",is:"Leita",ko:"",pl:"Szukaj",sl:"Iskanje",fa:"",ru:""},Vet={placeholder:Get},RF={exports:{}};(function(r){(function(t,e,n){r.exports?r.exports=n():t[e]=n()})(pd,"subtag",function(){var t="",e=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function n(h){return h.match(e)||[]}function i(h){return n(h).filter(function(f,g){return f&&g})}function s(h){return h=n(h),{language:h[1]||t,extlang:h[2]||t,script:h[3]||t,region:h[4]||t}}function a(h,f,g){Object.defineProperty(h,f,{value:g,enumerable:!0})}function o(h,f,g){function b(C){return n(C)[h]||t}a(b,"pattern",f),a(s,g,b)}return o(1,/^[a-zA-Z]{2,3}$/,"language"),o(2,/^[a-zA-Z]{3}$/,"extlang"),o(3,/^[a-zA-Z]{4}$/,"script"),o(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),a(s,"split",i),s})})(RF);var jet=RF.exports,qet=get,Ket=Ret,Na=_F,$et=UF.EventEmitter,DF=Het,Wet=Vet,Xet=jet;function OF(r,t){this._eventEmitter=new $et,this.options=Na({},this.options,t),this.inputString="",this.fresh=!0,this.lastSelected=null,this.geocoderApi=r}OF.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,showResultsWhileTyping:!1,minLength:2,reverseGeocode:!1,limit:5,enableEventLogging:!0,marker:!0,popup:!1,maplibregl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,getItemValue:function(r){return r.text!==void 0?r.text:r.place_name},render:function(r){if(r.geometry){var o=r.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--result maplibregl-ctrl-geocoder--result"><svg class="mapboxgl-ctrl-geocoder--result-icon maplibre-ctrl-geocoder--result-icon" viewBox="0 0 24 32" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 0C5.36571 0 0 5.38676 0 12.0471C0 21.0824 12 32 12 32C12 32 24 21.0824 24 12.0471C24 5.38676 18.6343 0 12 0ZM12 16.3496C9.63428 16.3496 7.71429 14.4221 7.71429 12.0471C7.71429 9.67207 9.63428 7.74454 12 7.74454C14.3657 7.74454 16.2857 9.67207 16.2857 12.0471C16.2857 14.4221 14.3657 16.3496 12 16.3496Z" fill="#687078"/></svg><div><div class="mapboxgl-ctrl-geocoder--result-title maplibregl-ctrl-geocoder--result-title">'+o[0]+'</div><div class="mapboxgl-ctrl-geocoder--result-address maplibregl-ctrl-geocoder--result-address">'+o.splice(1,o.length).join(",")+"</div></div></div>"}else{var t=r.text,e=t.toLowerCase().indexOf(this.query.toLowerCase()),n=this.query.length,i=t.substring(0,e),s=t.substring(e,e+n),a=t.substring(e+n);return'<div class="mapboxgl-ctrl-geocoder--suggestion maplibregl-ctrl-geocoder--suggestion"><svg class="mapboxgl-ctrl-geocoder--suggestion-icon maplibre-ctrl-geocoder--suggestion-icon" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><path d="M22.8702 20.1258H21.4248L20.9125 19.6318C22.7055 17.546 23.785 14.8382 23.785 11.8925C23.785 5.32419 18.4608 0 11.8925 0C5.32419 0 0 5.32419 0 11.8925C0 18.4608 5.32419 23.785 11.8925 23.785C14.8382 23.785 17.546 22.7055 19.6318 20.9125L20.1258 21.4248V22.8702L29.2739 32L32 29.2739L22.8702 20.1258ZM11.8925 20.1258C7.33676 20.1258 3.65923 16.4483 3.65923 11.8925C3.65923 7.33676 7.33676 3.65923 11.8925 3.65923C16.4483 3.65923 20.1258 7.33676 20.1258 11.8925C20.1258 16.4483 16.4483 20.1258 11.8925 20.1258Z" fill="#687078"/></svg><div class="mapboxgl-ctrl-geocoder--suggestion-info maplibregl-ctrl-geocoder--suggestion-info"><div class="mapboxgl-ctrl-geocoder--suggestion-title maplibregl-ctrl-geocoder--suggestion-title">'+i+'<span class="mapboxgl-ctrl-geocoder--suggestion-match maplibregl-ctrl-geocoder--suggestion-match">'+s+"</span>"+a+"</div></div></div>"}},popupRender:function(r){var t=r.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion maplibre-ctrl-geocoder--suggestion popup-suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title maplibre-ctrl-geocoder--suggestion-title popup-suggestion-title">'+t[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address maplibre-ctrl-geocoder--suggestion-address popup-suggestion-address">'+t.splice(1,t.length).join(",")+"</div></div>"},showResultMarkers:!0,debounceSearch:200},addTo:function(r){function t(n,i){if(!document.body.contains(i))throw new Error("Element provided to #addTo() exists, but is not in the DOM");var s=n.onAdd();i.appendChild(s)}if(r._controlContainer)r.addControl(this);else if(r instanceof HTMLElement)t(this,r);else if(typeof r=="string"){var e=document.querySelectorAll(r);if(e.length===0)throw new Error("Element ",r,"not found.");if(e.length>1)throw new Error("Geocoder can only be added to a single html element");t(this,e[0])}else throw new Error("Error: addTo must be a maplibre-gl-js map, an html element, or a CSS selector query for a single html element")},onAdd:function(r){if(r&&typeof r!="string"&&(this._map=r),this.setLanguage(),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this);var t=this.container=document.createElement("div");t.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl maplibregl-ctrl-geocoder maplibregl-ctrl";var e=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input maplibregl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",Ket(this._onKeyDown,this.options.debounceSearch)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton);var n=document.createElement("div");n.classList.add("mapboxgl-ctrl-geocoder--pin-right","maplibregl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button maplibregl-ctrl-geocoder--button";var i=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');return this._clearEl.appendChild(i),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),n.appendChild(this._clearEl),n.appendChild(this._loadingEl),t.appendChild(e),t.appendChild(this._inputEl),t.appendChild(n),this._typeahead=new qet(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit,noInitialSelection:!0}),this.setRenderFunction(this.options.render),this._typeahead.getItemValue=this.options.getItemValue,this.mapMarker=null,this.resultMarkers=[],this._handleMarker=this._handleMarker.bind(this),this._handleResultMarkers=this._handleResultMarkers.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._maplibregl=this.options.maplibregl,!this._maplibregl&&this.options.marker&&(console.error("No maplibregl detected in options. Map markers are disabled. Please set options.maplibregl."),this.options.marker=!1)),t},createIcon:function(r,t){var e=document.createElementNS("http://www.w3.org/2000/svg","svg");if(e.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+r+" maplibregl-ctrl-geocoder--icon maplibregl-ctrl-geocoder--icon-"+r),e.setAttribute("viewBox","0 0 18 18"),e.setAttribute("xml:space","preserve"),e.setAttribute("width",18),e.setAttribute("height",18),"innerHTML"in e)e.innerHTML=t;else{var n=document.createElement("div");n.innerHTML="<svg>"+t.valueOf().toString()+"</svg>";var i=n.firstChild,s=i.firstChild;e.appendChild(s)}return e},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_onPaste:function(r){var t=(r.clipboardData||window.clipboardData).getData("text");t.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(t)},_onKeyDown:function(r){var t=27,e=9;if(r.keyCode===t&&this.options.clearAndBlurOnEsc)return this._clear(r),this._inputEl.blur();var n=r.target&&r.target.shadowRoot?r.target.shadowRoot.activeElement:r.target,i=n?n.value:"";if(!i)return this.fresh=!0,r.keyCode!==e&&this.clear(r),this._clearEl.style.display="none";if(!(r.metaKey||[e,t,37,39,38,40].indexOf(r.keyCode)!==-1)){if(r.keyCode===13)if(!this.options.showResultsWhileTyping)this._typeahead.selected||this._geocode(n.value);else{this._typeahead.selected==null&&this.geocoderApi.getSuggestions?this._geocode(n.value,!0):this._typeahead.selected==null&&this.options.showResultMarkers&&this._fitBoundsForMarkers();return}n.value.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(n.value)}},_showButton:function(){this._inputEl.value.length>0&&(this._clearEl.style.display="block")},_hideButton:function(){this._typeahead.selected&&(this._clearEl.style.display="none")},_onBlur:function(r){this.options.clearOnBlur&&this._clearOnBlur(r),this.options.collapsed&&this._collapse()},_onChange:function(){var r=this._typeahead.selected;if(r&&!r.geometry)r.placeId?this._geocode(r.placeId,!0,!0):this._geocode(r.text,!0);else if(r&&JSON.stringify(r)!==this.lastSelected){if(this._clearEl.style.display="none",this.options.flyTo){var t;if(this._removeResultMarkers(),r.properties&&DF[r.properties.short_code])t=Na({},this.options.flyTo),this._map&&this._map.fitBounds(DF[r.properties.short_code].bbox,t);else if(r.bbox){var e=r.bbox;t=Na({},this.options.flyTo),this._map&&this._map.fitBounds([[e[0],e[1]],[e[2],e[3]]],t)}else{var n={zoom:this.options.zoom};t=Na({},n,this.options.flyTo),r.center?t.center=r.center:r.geometry&&r.geometry.type&&r.geometry.type==="Point"&&r.geometry.coordinates&&(t.center=r.geometry.coordinates),this._map&&this._map.flyTo(t)}}this.options.marker&&this._maplibregl&&this._handleMarker(r),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(r),this._typeahead.selected=null,this._eventEmitter.emit("result",{result:r})}},_getConfigForRequest:function(){var r=["bbox","limit","proximity","countries","types","language","reverseMode"],t=this,e=r.reduce(function(n,i){return t.options[i]&&(["countries","types","language"].indexOf(i)>-1?n[i]=t.options[i].split(/[\s,]+/):n[i]=t.options[i],i==="proximity"&&t.options[i]&&typeof t.options[i].longitude=="number"&&typeof t.options[i].latitude=="number"&&(n[i]=[t.options[i].longitude,t.options[i].latitude])),n},{});return e},_geocode:function(r,t,e){this._loadingEl.style.display="block",this._eventEmitter.emit("loading",{query:r}),this.inputString=r;var n=null,i=this._getConfigForRequest(),s;if(this.options.localGeocoderOnly)s=Promise.resolve();else if(this.options.reverseGeocode&&/(-?\d+\.?\d*)[, ]+(-?\d+\.?\d*)[ ]*$/.test(r)){var a=r.split(/[\s(,)?]+/).map(function(f){return parseFloat(f,10)}).reverse();i.types&&i.types[0],i=Na(i,{query:a,limit:1}),"proximity"in i&&delete i.proximity,s=this.geocoderApi.reverseGeocode(i)}else i=Na(i,{query:r}),this.geocoderApi.getSuggestions?t?this.geocoderApi.searchByPlaceId&&e?s=this.geocoderApi.searchByPlaceId(i):s=this.geocoderApi.forwardGeocode(i):s=this.geocoderApi.getSuggestions(i):s=this.geocoderApi.forwardGeocode(i);var o=[];this.options.localGeocoder&&(o=this.options.localGeocoder(r),o||(o=[]));var h=[];return s.catch((function(f){n=f}).bind(this)).then((function(f){this._loadingEl.style.display="none";var g={};return f?g=f:g={type:"FeatureCollection",features:[]},g.config=i,this.fresh&&(this.fresh=!1),g.features=g.features?o.concat(g.features):o,this.options.externalGeocoder?(h=this.options.externalGeocoder(r,g.features,i)||[],h.then(function(b){return g.features=g.features?b.concat(g.features):b,g},function(){return g})):g}).bind(this)).then((function(f){if(n)throw n;this.options.filter&&f.features.length&&(f.features=f.features.filter(this.options.filter));var g=[];f.suggestions?g=f.suggestions:f.place?g=[f.place]:g=f.features,g.length?(this._clearEl.style.display="block",this._typeahead.update(g),(!this.options.showResultsWhileTyping||t)&&this.options.showResultMarkers&&(f.features.length>0||f.place)&&this._fitBoundsForMarkers(),this._eventEmitter.emit("results",f)):(this._clearEl.style.display="none",this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",f))}).bind(this)).catch((function(f){this._loadingEl.style.display="none",o.length&&this.options.localGeocoder||h.length&&this.options.externalGeocoder?(this._clearEl.style.display="block",this._typeahead.update(o)):(this._clearEl.style.display="none",this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:o}),this._eventEmitter.emit("error",{error:f})}).bind(this)),s},_clear:function(r){r&&r.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._clearEl.style.display="none",this._removeMarker(),this._removeResultMarkers(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(r){this._clear(r),this._inputEl.focus()},_clearOnBlur:function(r){var t=this;r.relatedTarget&&t._clear(r)},_onQueryResult:function(r){var t=r;if(t.features.length){var e=t.features[0];this._typeahead.selected=e,this._inputEl.value=e.place_name,this._onChange()}},_updateProximity:function(){if(this._map)if(this._map.getZoom()>9){var r=this._map.getCenter().wrap();this.setProximity({longitude:r.lng,latitude:r.lat})}else this.setProximity(null)},_collapse:function(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed","maplibregl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed","maplibregl-ctrl-geocoder--collapsed")},query:function(r){return this._geocode(r).then(this._onQueryResult),this},_renderError:function(){var r="<div class='mapbox-gl-geocoder--error maplibre-gl-geocoder--error'>There was an error reaching the server</div>";this._renderMessage(r)},_renderNoResults:function(){var r="<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results maplibre-gl-geocoder--error maplibre-gl-geocoder--no-results'>No results found</div>";this._renderMessage(r)},_renderMessage:function(r){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(r)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var r=this.options.language.split(",")[0],t=Xet.language(r),e=Wet.placeholder[t];if(e)return e}return"Search"},_fitBoundsForMarkers:function(){if(!(this._typeahead.data.length<1)){var r=this._typeahead.data.filter(function(i){return typeof i!="string"}).slice(0,this.options.limit);if(this._clearEl.style.display="none",this.options.flyTo&&this._maplibregl&&this._map){var t={padding:100},e=Na({},t,this.options.flyTo),n=new this._maplibregl.LngLatBounds;r.forEach(function(i){n.extend(i.geometry.coordinates)}),this._map.fitBounds(n.toArray(),e)}return r.length>0&&this._maplibregl&&this._handleResultMarkers(r),this}},setInput:function(r){return this._inputEl.value=r,this._typeahead.selected=null,this._typeahead.clear(),r.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(r),this},setProximity:function(r){return this.options.proximity=r,this},getProximity:function(){return this.options.proximity},setRenderFunction:function(r){return r&&typeof r=="function"&&(this._typeahead.render=r),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(r){var t=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=r||this.options.language||t,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(r){return this.options.zoom=r,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(r){return this.options.flyTo=r,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(r){return this.placeholder=r||this._getPlaceholderText(),this._inputEl.placeholder=this.placeholder,this._inputEl.setAttribute("aria-label",this.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(r){return this.options.bbox=r,this},getCountries:function(){return this.options.countries},setCountries:function(r){return this.options.countries=r,this},getTypes:function(){return this.options.types},setTypes:function(r){return this.options.types=r,this},getMinLength:function(){return this.options.minLength},setMinLength:function(r){return this.options.minLength=r,this._typeahead&&(this._typeahead.options.minLength=r),this},getLimit:function(){return this.options.limit},setLimit:function(r){return this.options.limit=r,this._typeahead&&(this._typeahead.options.limit=r),this},getFilter:function(){return this.options.filter},setFilter:function(r){return this.options.filter=r,this},setGeocoderApi:function(r){return this.geocoderApi=r,this},getGeocoderApi:function(){return this.geocoderApi},_handleMarker:function(r){if(this._map){this._removeMarker();var t={color:"#4668F2"},e=Na({},t,this.options.marker);this.mapMarker=new this._maplibregl.Marker(e);var n;if(this.options.popup){var i={},s=Na({},i,this.options.popup);n=new this._maplibregl.Popup(s).setHTML(this.options.popupRender(r))}return r.center?(this.mapMarker.setLngLat(r.center).addTo(this._map),this.options.popup&&this.mapMarker.setPopup(n)):r.geometry&&r.geometry.type&&r.geometry.type==="Point"&&r.geometry.coordinates&&(this.mapMarker.setLngLat(r.geometry.coordinates).addTo(this._map),this.options.popup&&this.mapMarker.setPopup(n)),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},_handleResultMarkers:function(r){if(this._map){this._removeResultMarkers();var t={color:"#4668F2"},e=Na({},t,this.options.showResultMarkers);return r.forEach((function(n){if(this.options.showResultMarkers&&this.options.showResultMarkers.element){var i=this.options.showResultMarkers.element.cloneNode(!0);e=Na(e,{element:i})}var s=new this._maplibregl.Marker(Na({},e,{element:i})),a;if(this.options.popup){var o={},h=Na({},o,this.options.popup);a=new this._maplibregl.Popup(h).setHTML(this.options.popupRender(n))}n.center?(s.setLngLat(n.center).addTo(this._map),this.options.popup&&s.setPopup(a)):n.geometry&&n.geometry.type&&n.geometry.type==="Point"&&n.geometry.coordinates&&(s.setLngLat(n.geometry.coordinates).addTo(this._map),this.options.popup&&s.setPopup(a)),this.resultMarkers.push(s)}).bind(this)),this}},_removeResultMarkers:function(){this.resultMarkers&&this.resultMarkers.length>0&&(this.resultMarkers.forEach(function(r){r.remove()}),this.resultMarkers=[])},on:function(r,t){return this._eventEmitter.on(r,t),this},off:function(r,t){return this._eventEmitter.removeListener(r,t),this}};var Jet=OF;const Yet=xm(Jet),ry={ICGC5M:"https://tilemaps.icgc.cat/tileserver/tileserver/terreny-5m-30m-rgb-extent/{z}/{x}/{y}.png",WORLD30M:"https://s3.amazonaws.com/elevation-tiles-prod/terrarium/{z}/{x}/{y}.png"},uf={TOPO:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_estandard_general.json",ORTO:"https://geoserveis.icgc.cat/contextmaps/icgc_orto_estandard.json",ORTO3D:"https://tilemaps.icgc.cat/cdn/styles/icgc_orto_3d.json",ADMIN:"https://geoserveis.icgc.cat/contextmaps/icgc_delimitacio_limits_administratius.json",DARK:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_base_fosc.json",LIGHT:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_base_gris.json",GEOLOGY:"https://geoserveis.icgc.cat/contextmaps/icgc_geologic_informacio.json"},vo={Orto:{ortofotoColorProvisional:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_provisional",ortofotoColor2022:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2022",ortofotoColor2021:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2021",ortofotoColor2020:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2020",ortofotoColor2019:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2019",ortofotoColor2018:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2018",ortofotoColor2017:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2017",ortofotoColor2016:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2016",ortofotoColor2015:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2015",ortofotoColor2014:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2014",ortofotoColor2013:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2013",ortofotoColor2012:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2012",ortofotoColor2011:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2011",ortofotoColor2010:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2010",ortofotoColor2009:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2009",ortofotoColor2008:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2008",ortofotoColor20062007:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2006-2007",ortofotoColor20042005:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2004-2005",ortofotoColor20002003:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2000-2003",ortofotoBlancINegre1998:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1998",ortofotoBlancINegre19941997:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1994-1997",ortofotoColor1993:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_1993",ortofotoBlancINegre19831992:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1983-1992",ortofotoBlancINegre19701977:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1970-1977",ortofotoBlancINegre1956:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1956",ortofotoBlancINegre1945:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1945",ortofotoColorSerieAnual:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_serie_anual",ortofotoInfraroigProvisional:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_provisional",ortofotoInfraroig2022:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2022",ortofotoInfraroig2021:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2021",ortofotoInfraroig2020:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2020",ortofotoInfraroig2019:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2019",ortofotoInfraroig2018:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2018",ortofotoInfraroig2017:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2017",ortofotoInfraroig2016:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2016",ortofotoInfraroig2015:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2015",ortofotoInfraroig2014:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2014",ortofotoInfraroig2013:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2013",ortofotoInfraroig2012:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2012",ortofotoInfraroig2011:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2011",ortofotoInfraroig2010:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2010",ortofotoInfraroig2009:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2009",ortofotoInfraroig2008:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2008",ortofotoInfraroig20062007:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2006-2007",ortofotoInfraroig19961997:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_1996-1997",ortofotoInfraroigSerieAnual:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_serie_anual"},VectorAdmin:{agrupacionsCensals2015:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_2015.fgb",agrupacionsCensals2016:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_2016.fgb",agrupacionsCensals2017:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_2017.fgb",agrupacionsCensals2018:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_2018.fgb",agrupacionsCensals2019:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_2019.fgb",agrupacionsCensals2020:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_2020.fgb",agrupacionsCensals2021:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_2021.fgb",agrupacionsCensalsVigent:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_vigent.fgb",agrupacionsCensalsVigentText:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_vigent_text.fgb",areesBasiquesPolicials2019:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_2019.fgb",areesBasiquesPolicials2020:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_2020.fgb",areesBasiquesPolicials2022:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_2022.fgb",areesBasiquesPolicialsVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_vigent.fgb",areesBasiquesPolicialsVigentText:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_vigent_text.fgb",areesBasiquesSalutVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_salut_vigent.fgb",areesBasiquesServeisSocialsVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_serveis_socials_vigent.fgb",areesBasiquesServeisSocialsVigentText:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_serveis_socials_vigent_text.fgb",areesGestioAssistencialVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_gestio_assistencial_vigent.fgb",areesHidrogeologiquesAquifersVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_hidrogeologiques_aquifers_vigent.fgb",catalunyaVigent:"https://tilemaps.icgc.cat/vector/fgb/catalunya_vigent.fgb",catalunyaVigentText:"https://tilemaps.icgc.cat/vector/fgb/catalunya_vigent_text.fgb",comarques2022:"https://tilemaps.icgc.cat/vector/fgb/comarques_2022.fgb",comarquesVigent:"https://tilemaps.icgc.cat/vector/fgb/comarques_vigent.fgb",comarquesVigentText:"https://tilemaps.icgc.cat/vector/fgb/comarques_vigent_text.fgb",districtesCensals2002:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2002.fgb",districtesCensals2003:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2003.fgb",districtesCensals2004:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2004.fgb",districtesCensals2005:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2005.fgb",districtesCensals2006:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2006.fgb",districtesCensals2007:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2007.fgb",districtesCensals2008:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2008.fgb",districtesCensals2009:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2009.fgb",districtesCensals2010:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2010.fgb",districtesCensals2011:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2011.fgb",districtesCensals2012:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2012.fgb",districtesCensals2013:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2013.fgb",districtesCensals2014:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2014.fgb",districtesCensals2015:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2015.fgb",districtesCensals2016:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2016.fgb",districtesCensals2017:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2017.fgb",districtesCensals2018:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2018.fgb",districtesCensals2019:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2019.fgb",districtesCensals2020:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2020.fgb",districtesCensals2021:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2021.fgb",districtesCensals2022:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2022.fgb",districtesCensalsVigent:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_vigent.fgb",districtesCensalsVigentText:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_vigent_text.fgb",incendisForestalsVigent:"https://tilemaps.icgc.cat/vector/fgb/incendis_forestals_vigent.fgb",incendisForestalsVigentText:"https://tilemaps.icgc.cat/vector/fgb/incendis_forestals_vigent_text.fgb",municipis2022:"https://tilemaps.icgc.cat/vector/fgb/municipis_2022.fgb",municipis2022Text:"https://tilemaps.icgc.cat/vector/fgb/municipis_2022_text.fgb",municipisVigent:"https://tilemaps.icgc.cat/vector/fgb/municipis_vigent.fgb",municipisVigentText:"https://tilemaps.icgc.cat/vector/fgb/municipis_vigent_text.fgb",partitsJudicialsVigent:"https://tilemaps.icgc.cat/vector/fgb/partits_judicials_vigent.fgb",partitsJudicialsVigentText:"https://tilemaps.icgc.cat/vector/fgb/partits_judicials_vigent_text.fgb",plaTerritorial2015:"https://tilemaps.icgc.cat/vector/fgb/pla_territorial_2015.fgb",plaTerritorialVigent:"https://tilemaps.icgc.cat/vector/fgb/pla_territorial_vigent.fgb",plaTerritorialVigentText:"https://tilemaps.icgc.cat/vector/fgb/pla_territorial_vigent_text.fgb",provinciesVigent:"https://tilemaps.icgc.cat/vector/fgb/provincies_vigent.fgb",provinciesVigentText:"https://tilemaps.icgc.cat/vector/fgb/provincies_vigent_text.fgb",regionsPolicialsVigent:"https://tilemaps.icgc.cat/vector/fgb/regions_policials_vigent.fgb",regionsPolicialsVigentText:"https://tilemaps.icgc.cat/vector/fgb/regions_policials_vigent_text.fgb",regionsSanitariesVigent:"https://tilemaps.icgc.cat/vector/fgb/regions_sanitaries_vigent.fgb",regionsSanitariesVigentText:"https://tilemaps.icgc.cat/vector/fgb/regions_sanitaries_vigent_text.fgb",seccionsCensals2002:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2002.fgb",seccionsCensals2003:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2003.fgb",seccionsCensals2004:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2004.fgb",seccionsCensals2005:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2005.fgb",seccionsCensals2006:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2006.fgb",seccionsCensals2007:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2007.fgb",seccionsCensals2008:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2008.fgb",seccionsCensals2009:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2009.fgb",seccionsCensals2010:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2010.fgb",seccionsCensals2011:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2011.fgb",seccionsCensals2012:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2012.fgb",seccionsCensals2013:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2013.fgb",seccionsCensals2014:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2014.fgb",seccionsCensals2015:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2015.fgb",seccionsCensals2016:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2016.fgb",seccionsCensals2017:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2017.fgb",seccionsCensals2018:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2018.fgb",seccionsCensals2019:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2019.fgb",seccionsCensals2020:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2020.fgb",seccionsCensals2021:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2021.fgb",seccionsCensals2022:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2022.fgb",seccionsCensalsVigent:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_vigent.fgb",seccionsCensalsVigentText:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_vigent_text.fgb",sectorsSanitarisVigent:"https://tilemaps.icgc.cat/vector/fgb/sectors_sanitaris_vigent.fgb",vegueriesVigent:"https://tilemaps.icgc.cat/vector/fgb/vegueries_vigent.fgb",vegueriesVigentText:"https://tilemaps.icgc.cat/vector/fgb/vegueries_vigent_text.fgb"},WMS:{espaisInteresGeologic:"https://geoserveis.icgc.cat/servei/catalunya/espais-interes-geologic/wms/service?&service=WMS&request=GetMap&layers=espais-interes-geologic&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}",gravimetriaBouguer500000:"https://geoserveis.icgc.cat/servei/catalunya/gravimetria/wms/service?&service=WMS&request=GetMap&layers=anomalia_bouguer_500000&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}",cobertesSol2018:"https://geoserveis.icgc.cat/servei/catalunya/cobertes-sol/wms/service?&service=WMS&request=GetMap&layers=cobertes_2018&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}",administratiu:"http://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/administratiu/MON3857NW/{z}/{x}/{y}.png",simplificat:"http://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/simplificat/MON3857NW/{z}/{x}/{y}.png",cims:"https://geoserveis.icgc.cat/icc_100cims/wms/service?REQUEST=GetMap&SERVICE=WMS&VERSION=1.1.1&LAYERS=0&STYLES=&FORMAT=image/png&BGCOLOR=0xFFFFFF&TRANSPARENT=TRUE&SRS=EPSG:25831&BBOX=137118.923076923,4488408.75,650959.076923077,4749634.75&WIDTH=895&HEIGHT=455",cobertesSol:"http://geoserveis.icgc.cat/servei/catalunya/cobertes-sol/wms?REQUEST=GetMap&SERVICE=WMS&VERSION=1.3.0&LAYERS=cobertes_2009&STYLES=&FORMAT=image/png&BGCOLOR=0xFFFFFF&TRANSPARENT=TRUE&CRS=EPSG:25831&BBOX=374110.828167253,4639230.79853085,452621.120632226,4703578.45000215&WIDTH=1020&HEIGHT=836"},Vector:{altimetria:"https://betaserver.icgc.cat/tileserver3/tileserver.php/alti_bt5m/{z}/{x}/{y}.pbf"}},Wi={mapOptions:{container:"map",center:{0:1.537786,1:41.837539},zoom:7.5,bearing:0,pitch:0,hash:!1,style:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_base_gris.json.json",maxZoom:18,maxPitch:85},map3dOptions:{spaceErrorFactor:2,zfactor:25,minZoomRange:15.5,maxZoomRange:22,urlTilesetCities:"http://imtilemapsdev.icgc.local/terrenys/Ciutats/tilesetV1.0.json",layerIdOrder:"place-isolated",layerId3d:"edificisMapboxLayer",terrainSource:"ICGC5M",style3dName:"orto3d"},baseStyles:{0:{key:"TOPO",url:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_estandard_general.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_mapa_estandard.png"},1:{key:"ORTO",url:"https://geoserveis.icgc.cat/contextmaps/icgc_orto_estandard.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_orto_hibrida.png"},2:{key:"ORTO3D",url:"https://tilemaps.icgc.cat/cdn/styles/icgc_orto_3d.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_orto_hibrida.png"},3:{key:"ADMIN",url:"https://geoserveis.icgc.cat/contextmaps/icgc_delimitacio_limits_administratius.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_delimitacio_limits_administratius.png"},4:{key:"DARK",url:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_base_fosc.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_mapa_base_fosc.png"},5:{key:"LIGHT",url:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_base_gris.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_mapa_base_gris.png"},6:{key:"GEOLOGY",url:"https://geoserveis.icgc.cat/contextmaps/icgc_geologic_informacio.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_geologic_informacio.png"}},urlTerrainICGC:{0:{name:"ICGC5M",url:"https://tilemaps.icgc.cat/tileserver/tileserver/terreny-5m-30m-rgb-extent/{z}/{x}/{y}.png"},1:{name:"WORLD30M",url:"https://s3.amazonaws.com/elevation-tiles-prod/terrarium/{z}/{x}/{y}.png",encoding:"terrarium"}},ortoLayersICGC:{0:{name:"ortofotoColorProvisional",key:"ortofoto_color_provisional",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_provisional"},1:{name:"ortofotoColor2022",key:"ortofoto_color_2022",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2022"},2:{name:"ortofotoColor2021",key:"ortofoto_color_2021",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2021"},3:{name:"ortofotoColor2020",key:"ortofoto_color_2020",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2020"},4:{name:"ortofotoColor2019",key:"ortofoto_color_2019",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2019"},5:{name:"ortofotoColor2018",key:"ortofoto_color_2018",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2018"},6:{name:"ortofotoColor2017",key:"ortofoto_color_2017",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2017"},7:{name:"ortofotoColor2016",key:"ortofoto_color_2016",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2016"},8:{name:"ortofotoColor2015",key:"ortofoto_color_2015",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2015"},9:{name:"ortofotoColor2014",key:"ortofoto_color_2014",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2014"},10:{name:"ortofotoColor2013",key:"ortofoto_color_2013",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2013"},11:{name:"ortofotoColor2012",key:"ortofoto_color_2012",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2012"},12:{name:"ortofotoColor2011",key:"ortofoto_color_2011",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2011"},13:{name:"ortofotoColor2010",key:"ortofoto_color_2010",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2010"},14:{name:"ortofotoColor2009",key:"ortofoto_color_2009",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2009"},15:{name:"ortofotoColor2008",key:"ortofoto_color_2008",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2008"},16:{name:"ortofotoColor20062007",key:"ortofoto_color_2006-2007",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2006-2007"},17:{name:"ortofotoColor20042005",key:"ortofoto_color_2004-2005",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2004-2005"},18:{name:"ortofotoColor20002003",key:"ortofoto_color_2000-2003",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2000-2003"},19:{name:"ortofotoBlancINegre1998",key:"ortofoto_blanc_i_negre_1998",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1998"},20:{name:"ortofotoBlancINegre19941997",key:"ortofoto_blanc_i_negre_1994-1997",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1994-1997"},21:{name:"ortofotoColor1993",key:"ortofoto_color_1993",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_1993"},22:{name:"ortofotoBlancINegre19831992",key:"ortofoto_blanc_i_negre_1983-1992",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1983-1992"},23:{name:"ortofotoBlancINegre19701977",key:"ortofoto_blanc_i_negre_1970-1977",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1970-1977"},24:{name:"ortofotoBlancINegre1956",key:"ortofoto_blanc_i_negre_1956",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1956"},25:{name:"ortofotoBlancINegre1945",key:"ortofoto_blanc_i_negre_1945",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1945"},26:{name:"ortofotoColorSerieAnual",key:"ortofoto_color_serie_anual",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_serie_anual"},27:{name:"ortofotoInfraroigProvisional",key:"ortofoto_infraroig_provisional",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_provisional"},28:{name:"ortofotoInfraroig2022",key:"ortofoto_infraroig_2022",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2022"},29:{name:"ortofotoInfraroig2021",key:"ortofoto_infraroig_2021",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2021"},30:{name:"ortofotoInfraroig2020",key:"ortofoto_infraroig_2020",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2020"},31:{name:"ortofotoInfraroig2019",key:"ortofoto_infraroig_2019",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2019"},32:{name:"ortofotoInfraroig2018",key:"ortofoto_infraroig_2018",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2018"},33:{name:"ortofotoInfraroig2017",key:"ortofoto_infraroig_2017",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2017"},34:{name:"ortofotoInfraroig2016",key:"ortofoto_infraroig_2016",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2016"},35:{name:"ortofotoInfraroig2015",key:"ortofoto_infraroig_2015",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2015"},36:{name:"ortofotoInfraroig2014",key:"ortofoto_infraroig_2014",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2014"},37:{name:"ortofotoInfraroig2013",key:"ortofoto_infraroig_2013",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2013"},38:{name:"ortofotoInfraroig2012",key:"ortofoto_infraroig_2012",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2012"},39:{name:"ortofotoInfraroig2011",key:"ortofoto_infraroig_2011",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2011"},40:{name:"ortofotoInfraroig2010",key:"ortofoto_infraroig_2010",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2010"},41:{name:"ortofotoInfraroig2009",key:"ortofoto_infraroig_2009",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2009"},42:{name:"ortofotoInfraroig2008",key:"ortofoto_infraroig_2008",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2008"},43:{name:"ortofotoInfraroig20062007",key:"ortofoto_infraroig_2006-2007",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2006-2007"},44:{name:"ortofotoInfraroig19961997",key:"ortofoto_infraroig_1996-1997",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_1996-1997"},45:{name:"ortofotoInfraroigSerieAnual",key:"ortofoto_infraroig_serie_anual",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_serie_anual"}},vectorLayersICGC:{0:{name:"agrupacionsCensals2015",key:"agrupacions_censals_2015",url:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_2015.fgb"},1:{name:"agrupacionsCensals2016",key:"agrupacions_censals_2016",url:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_2016.fgb"},2:{name:"agrupacionsCensals2017",key:"agrupacions_censals_2017",url:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_2017.fgb"},3:{name:"agrupacionsCensals2018",key:"agrupacions_censals_2018",url:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_2018.fgb"},4:{name:"agrupacionsCensals2019",key:"agrupacions_censals_2019",url:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_2019.fgb"},5:{name:"agrupacionsCensals2020",key:"agrupacions_censals_2020",url:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_2020.fgb"},6:{name:"agrupacionsCensals2021",key:"agrupacions_censals_2021",url:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_2021.fgb"},7:{name:"agrupacionsCensalsVigent",key:"agrupacions_censals_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_vigent.fgb"},8:{name:"agrupacionsCensalsVigentText",key:"agrupacions_censals_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_vigent_text.fgb"},9:{name:"areesBasiquesPolicials2019",key:"arees_basiques_policials_2019",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_2019.fgb"},10:{name:"areesBasiquesPolicials2020",key:"arees_basiques_policials_2020",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_2020.fgb"},11:{name:"areesBasiquesPolicials2022",key:"arees_basiques_policials_2022",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_2022.fgb"},12:{name:"areesBasiquesPolicialsVigent",key:"arees_basiques_policials_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_vigent.fgb"},13:{name:"areesBasiquesPolicialsVigentText",key:"arees_basiques_policials_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_vigent_text.fgb"},14:{name:"areesBasiquesSalutVigent",key:"arees_basiques_salut_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_salut_vigent.fgb"},15:{name:"areesBasiquesServeisSocialsVigent",key:"arees_basiques_serveis_socials_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_serveis_socials_vigent.fgb"},16:{name:"areesBasiquesServeisSocialsVigentText",key:"arees_basiques_serveis_socials_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_serveis_socials_vigent_text.fgb"},17:{name:"areesGestioAssistencialVigent",key:"arees_gestio_assistencial_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_gestio_assistencial_vigent.fgb"},18:{name:"areesHidrogeologiquesAquifersVigent",key:"arees_hidrogeologiques_aquifers_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_hidrogeologiques_aquifers_vigent.fgb"},19:{name:"catalunyaVigent",key:"catalunya_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/catalunya_vigent.fgb"},20:{name:"catalunyaVigentText",key:"catalunya_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/catalunya_vigent_text.fgb"},21:{name:"comarques2022",key:"comarques_2022",url:"https://tilemaps.icgc.cat/vector/fgb/comarques_2022.fgb"},22:{name:"comarquesVigent",key:"comarques_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/comarques_vigent.fgb"},23:{name:"comarquesVigentText",key:"comarques_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/comarques_vigent_text.fgb"},24:{name:"districtesCensals2002",key:"districtes_censals_2002",url:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2002.fgb"},25:{name:"districtesCensals2003",key:"districtes_censals_2003",url:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2003.fgb"},26:{name:"districtesCensals2004",key:"districtes_censals_2004",url:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2004.fgb"},27:{name:"districtesCensals2005",key:"districtes_censals_2005",url:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2005.fgb"},28:{name:"districtesCensals2006",key:"districtes_censals_2006",url:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2006.fgb"},29:{name:"districtesCensals2007",key:"districtes_censals_2007",url:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2007.fgb"},30:{name:"districtesCensals2008",key:"districtes_censals_2008",url:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2008.fgb"},31:{name:"districtesCensals2009",key:"districtes_censals_2009",url:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2009.fgb"},32:{name:"districtesCensals2010",key:"districtes_censals_2010",url:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2010.fgb"},33:{name:"districtesCensals2011",key:"districtes_censals_2011",url:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2011.fgb"},34:{name:"districtesCensals2012",key:"districtes_censals_2012",url:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2012.fgb"},35:{name:"districtesCensals2013",key:"districtes_censals_2013",url:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2013.fgb"},36:{name:"districtesCensals2014",key:"districtes_censals_2014",url:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2014.fgb"},37:{name:"districtesCensals2015",key:"districtes_censals_2015",url:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2015.fgb"},38:{name:"districtesCensals2016",key:"districtes_censals_2016",url:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2016.fgb"},39:{name:"districtesCensals2017",key:"districtes_censals_2017",url:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2017.fgb"},40:{name:"districtesCensals2018",key:"districtes_censals_2018",url:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2018.fgb"},41:{name:"districtesCensals2019",key:"districtes_censals_2019",url:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2019.fgb"},42:{name:"districtesCensals2020",key:"districtes_censals_2020",url:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2020.fgb"},43:{name:"districtesCensals2021",key:"districtes_censals_2021",url:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2021.fgb"},44:{name:"districtesCensals2022",key:"districtes_censals_2022",url:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2022.fgb"},45:{name:"districtesCensalsVigent",key:"districtes_censals_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_vigent.fgb"},46:{name:"districtesCensalsVigentText",key:"districtes_censals_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_vigent_text.fgb"},47:{name:"incendisForestalsVigent",key:"incendis_forestals_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/incendis_forestals_vigent.fgb"},48:{name:"incendisForestalsVigentText",key:"incendis_forestals_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/incendis_forestals_vigent_text.fgb"},49:{name:"municipis2022",key:"municipis_2022",url:"https://tilemaps.icgc.cat/vector/fgb/municipis_2022.fgb"},50:{name:"municipis2022Text",key:"municipis_2022_text",url:"https://tilemaps.icgc.cat/vector/fgb/municipis_2022_text.fgb"},51:{name:"municipisVigent",key:"municipis_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/municipis_vigent.fgb"},52:{name:"municipisVigentText",key:"municipis_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/municipis_vigent_text.fgb"},53:{name:"partitsJudicialsVigent",key:"partits_judicials_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/partits_judicials_vigent.fgb"},54:{name:"partitsJudicialsVigentText",key:"partits_judicials_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/partits_judicials_vigent_text.fgb"},55:{name:"plaTerritorial2015",key:"pla_territorial_2015",url:"https://tilemaps.icgc.cat/vector/fgb/pla_territorial_2015.fgb"},56:{name:"plaTerritorialVigent",key:"pla_territorial_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/pla_territorial_vigent.fgb"},57:{name:"plaTerritorialVigentText",key:"pla_territorial_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/pla_territorial_vigent_text.fgb"},58:{name:"provinciesVigent",key:"provincies_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/provincies_vigent.fgb"},59:{name:"provinciesVigentText",key:"provincies_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/provincies_vigent_text.fgb"},60:{name:"regionsPolicialsVigent",key:"regions_policials_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/regions_policials_vigent.fgb"},61:{name:"regionsPolicialsVigentText",key:"regions_policials_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/regions_policials_vigent_text.fgb"},62:{name:"regionsSanitariesVigent",key:"regions_sanitaries_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/regions_sanitaries_vigent.fgb"},63:{name:"regionsSanitariesVigentText",key:"regions_sanitaries_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/regions_sanitaries_vigent_text.fgb"},64:{name:"seccionsCensals2002",key:"seccions_censals_2002",url:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2002.fgb"},65:{name:"seccionsCensals2003",key:"seccions_censals_2003",url:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2003.fgb"},66:{name:"seccionsCensals2004",key:"seccions_censals_2004",url:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2004.fgb"},67:{name:"seccionsCensals2005",key:"seccions_censals_2005",url:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2005.fgb"},68:{name:"seccionsCensals2006",key:"seccions_censals_2006",url:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2006.fgb"},69:{name:"seccionsCensals2007",key:"seccions_censals_2007",url:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2007.fgb"},70:{name:"seccionsCensals2008",key:"seccions_censals_2008",url:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2008.fgb"},71:{name:"seccionsCensals2009",key:"seccions_censals_2009",url:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2009.fgb"},72:{name:"seccionsCensals2010",key:"seccions_censals_2010",url:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2010.fgb"},73:{name:"seccionsCensals2011",key:"seccions_censals_2011",url:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2011.fgb"},74:{name:"seccionsCensals2012",key:"seccions_censals_2012",url:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2012.fgb"},75:{name:"seccionsCensals2013",key:"seccions_censals_2013",url:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2013.fgb"},76:{name:"seccionsCensals2014",key:"seccions_censals_2014",url:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2014.fgb"},77:{name:"seccionsCensals2015",key:"seccions_censals_2015",url:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2015.fgb"},78:{name:"seccionsCensals2016",key:"seccions_censals_2016",url:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2016.fgb"},79:{name:"seccionsCensals2017",key:"seccions_censals_2017",url:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2017.fgb"},80:{name:"seccionsCensals2018",key:"seccions_censals_2018",url:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2018.fgb"},81:{name:"seccionsCensals2019",key:"seccions_censals_2019",url:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2019.fgb"},82:{name:"seccionsCensals2020",key:"seccions_censals_2020",url:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2020.fgb"},83:{name:"seccionsCensals2021",key:"seccions_censals_2021",url:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2021.fgb"},84:{name:"seccionsCensals2022",key:"seccions_censals_2022",url:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2022.fgb"},85:{name:"seccionsCensalsVigent",key:"seccions_censals_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_vigent.fgb"},86:{name:"seccionsCensalsVigentText",key:"seccions_censals_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_vigent_text.fgb"},87:{name:"sectorsSanitarisVigent",key:"sectors_sanitaris_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/sectors_sanitaris_vigent.fgb"},88:{name:"vegueriesVigent",key:"vegueries_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/vegueries_vigent.fgb"},89:{name:"vegueriesVigentText",key:"vegueries_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/vegueries_vigent_text.fgb"}},vectorLayers:{0:{key:"altimetria",layer:"",url:"https://betaserver.icgc.cat/tileserver3/tileserver.php/alti_bt5m/{z}/{x}/{y}.pbf"}},wmsLayers:{0:{key:"espaisInteresGeologic",layer:"",url:"https://geoserveis.icgc.cat/servei/catalunya/espais-interes-geologic/wms/service?&service=WMS&request=GetMap&layers=espais-interes-geologic&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}"},1:{key:"gravimetriaBouguer500000",layer:"",url:"https://geoserveis.icgc.cat/servei/catalunya/gravimetria/wms/service?&service=WMS&request=GetMap&layers=anomalia_bouguer_500000&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}"},2:{key:"cobertesSol2018",layer:"",url:"https://geoserveis.icgc.cat/servei/catalunya/cobertes-sol/wms/service?&service=WMS&request=GetMap&layers=cobertes_2018&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}"},3:{key:"administratiu",layer:"",url:"http://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/administratiu/MON3857NW/{z}/{x}/{y}.png"},4:{key:"simplificat",layer:"",url:"http://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/simplificat/MON3857NW/{z}/{x}/{y}.png"},5:{key:"cims",layer:"",url:"https://geoserveis.icgc.cat/icc_100cims/wms/service?REQUEST=GetMap&SERVICE=WMS&VERSION=1.1.1&LAYERS=0&STYLES=&FORMAT=image/png&BGCOLOR=0xFFFFFF&TRANSPARENT=TRUE&SRS=EPSG:25831&BBOX=137118.923076923,4488408.75,650959.076923077,4749634.75&WIDTH=895&HEIGHT=455"},6:{key:"cobertesSol",layer:"",url:"http://geoserveis.icgc.cat/servei/catalunya/cobertes-sol/wms?REQUEST=GetMap&SERVICE=WMS&VERSION=1.3.0&LAYERS=cobertes_2009&STYLES=&FORMAT=image/png&BGCOLOR=0xFFFFFF&TRANSPARENT=TRUE&CRS=EPSG:25831&BBOX=374110.828167253,4639230.79853085,452621.120632226,4703578.45000215&WIDTH=1020&HEIGHT=836"}}};let Zet=class{constructor(t){if(!t)t=Wi.mapOptions;else for(const e in Wi.mapOptions){let n=[Wi.mapOptions.center[0],Wi.mapOptions.center[1]];Wi.mapOptions.center=n,t.hasOwnProperty(e)||(t[e]=Wi.mapOptions[e])}t.maxPitch=85,t.maplibreLogo=!1,t.attributionControl=!1,this.map=new No.Map(t),this.map.options=t,this.map.addControl(new No.AttributionControl({compact:!0})),this.map.on("load",()=>{if(window.document.querySelector(".maplibregl-compact-show")){var e=window.document.querySelector(".maplibregl-compact-show");e.classList.remove("maplibregl-compact-show")}this._dealOrto3dStyle(this.map.getStyle().name)})}_dealOrto3dStyle(t){try{if(t=="orto3d"){const e=new oT({intensity:4}),n=new Yv({ambientLight:e});this.map.setTerrain({source:Wi.map3dOptions.terrainSource,exaggeration:1});const i=this._createCitiesMapboxLayer();this.map.getLayer(Wi.map3dOptions.layerId3d)||(this.map.addLayer(i,Wi.map3dOptions.layerIdOrder),this.map.setLayerZoomRange(Wi.map3dOptions.layerId3d,Wi.map3dOptions.minZoomRange,Wi.map3dOptions.maxZoomRange),i.deck.setProps({effects:[n]}))}else this.map.getLayer(Wi.map3dOptions.layerId3d)&&(this.map.removeLayer(Wi.map3dOptions.layerId3d),this.map.setTerrain(null))}catch(e){return console.error(`Error dealing orto 3D: ${e.message}`),null}}_createCitiesMapboxLayer(){try{return new jK({id:Wi.map3dOptions.layerId3d,type:ww,data:Wi.map3dOptions.urlTilesetCities,loader:bw,loadOptions:{tileset:{viewDistanceScale:1,updateTransforms:!1,maximumScreenSpaceError:Wi.map3dOptions.spaceErrorFactor}},onTilesetLoad:e=>{e.options.maximumScreenSpaceError=Wi.map3dOptions.spaceErrorFactor},onTileLoad:e=>{e.content.cartographicOrigin.z-=Wi.map3dOptions.zfactor},operation:"terrain+draw"})}catch(t){return console.error(`Error adding MapboxLayer: ${t.message}`),null}}addGeocoderICGC(t){try{t===void 0&&(t="top-right");const e="https://eines.icgc.cat/geocodificador/autocompletar?text=";let n={collapsed:!0,marker:!0,popup:!0,showResultMarkers:!0,maplibregl:No,showResultsWhileTyping:!0,minLength:2};const i={forwardGeocode:async a=>{const o=[];try{const h=`https://nominatim.openstreetmap.org/search?q=${a.query}&format=geojson&polygon_geojson=1&addressdetails=1`,f=e+encodeURIComponent(a.query)+"&layers=topo1%2Ctopo2%2Caddress&size=5",b=await(await fetch(f)).json();for(const C of b.features){const B=C.geometry.coordinates,R={type:"Feature",geometry:{type:"Point",coordinates:B},place_name:C.properties.label,properties:C.properties,text:C.properties.label,place_type:["place"],center:B};o.push(R)}}catch(h){console.error(`Failed to forwardGeocode with error: ${h}`)}return{features:o}}};this.map.addControl(new Yet(i,n),t);let s=document.getElementsByClassName("maplibregl-ctrl-geocoder--input");s[0].attributes[2].nodeValue="Cerca...",s[0].addEventListener("input",function(a){a.target.value.length>3})}catch(e){console.error(`Error adding ICGC geocoder: ${e.message}`)}}getStyle(){try{return this.map.getStyle()}catch(t){console.error(`Error getting style: ${t.message}`)}}getConfigStyles(){try{let t=[];for(const e of uf)t.push(e.name);return t}catch(t){console.error(`Error retrieving base styles: ${t.message}`)}}getConfigWMSLayers(){try{let t=[];for(const e in vo.WMS)vo.WMS.hasOwnProperty(e)&&t.push(e);return t}catch(t){console.error(`Error retrieving WMS layers: ${t.message}`)}}getConfigOrtoLayers(){try{let t=[];for(const e in vo.Orto)vo.Orto.hasOwnProperty(e)&&t.push(e);return t}catch(t){console.error(`Error retrieving orto image layers: ${t.message}`)}}getConfigVectorLayers(){try{let t=[];for(const e in vo.Vector)vo.Vector.hasOwnProperty(e)&&t.push(e);return t}catch(t){console.error(`Error retrieving vector layers: ${t.message}`)}}getConfigVectorAdminLayers(){try{let t=[];for(const e in vo.VectorAdmin)vo.VectorAdmin.hasOwnProperty(e)&&t.push(e);return t}catch(t){console.error(`Error retrieving vectorAdmin layers: ${t.message}`)}}async fetchData(t,e,n){try{const s=await(await fetch(t)).json();let a=s.features[0].geometry.type;a.includes("ine")&&(n!==void 0?map.addLayer({id:e,type:"line",source:{type:"geojson",data:s},layout:{visibility:"visible"},paint:n}):map.addLayer({id:e,type:"line",source:{type:"geojson",data:s},layout:{visibility:"visible"},paint:{"line-color":"black","line-width":2,"line-opacity":1}})),a.includes("olygon")&&(n!==void 0?map.addLayer({id:e,type:"fill",source:{type:"geojson",data:s},layout:{visibility:"visible"},paint:n}):map.addLayer({id:e,type:"fill",source:{type:"geojson",data:s},layout:{visibility:"visible"},paint:{"fill-color":"blue","fill-opacity":.6}})),a.includes("oint")&&(n!==void 0?map.addLayer({id:e,type:"circle",source:{type:"geojson",data:s},layout:{visibility:"visible"},paint:n}):map.addLayer({id:e,type:"circle",source:{type:"geojson",data:s},layout:{visibility:"visible"},paint:{"circle-color":"red","circle-opacity":.85}}))}catch(i){console.error(`Error fetching data: ${i.message}`)}}async fetchDataAndMenu(t,e,n,i){try{const a=await(await fetch(t)).json(),o=document.getElementById("menu-group");if(n!=="all"){const f=document.createElement("div");f.id="titleDivMenu",f.textContent=e,o.appendChild(f);const g=document.createElement("div");g.id="titleDivMenuSub",g.textContent=` ${n}`,o.appendChild(g)}let h=a.features[0].geometry.type;if(n==="all")h.includes("ine")&&(i!==void 0?map.addLayer({id:e,type:"line",source:{type:"geojson",data:a},layout:{visibility:"visible"},paint:i}):map.addLayer({id:e,type:"line",source:{type:"geojson",data:a},layout:{visibility:"visible"},paint:{"line-color":"black","line-width":2,"line-opacity":1}})),h.includes("olygon")&&(i!==void 0?map.addLayer({id:e,type:"fill",source:{type:"geojson",data:a},layout:{visibility:"visible"},paint:i}):map.addLayer({id:e,type:"fill",source:{type:"geojson",data:a},layout:{visibility:"visible"},paint:{"fill-color":"blue","fill-opacity":.6}})),h.includes("oint")&&(i!==void 0?map.addLayer({id:e,type:"circle",source:{type:"geojson",data:a},layout:{visibility:"visible"},paint:i}):map.addLayer({id:e,type:"circle",source:{type:"geojson",data:a},layout:{visibility:"visible"},paint:{"circle-color":"red","circle-opacity":.85}})),map.addMenuItem(e);else{let f=n;const g={};a.features.forEach(b=>{const C=b.properties[f];g[C]||(h.includes("ine")&&(i!==void 0?map.addLayer({id:C,type:"line",source:{type:"geojson",data:a},layout:{visibility:"visible"},filter:["==",`${f}`,C],paint:i}):map.addLayer({id:C,type:"line",source:{type:"geojson",data:a},layout:{visibility:"visible"},filter:["==",`${f}`,C],paint:{"line-color":"black","line-width":2,"line-opacity":1}})),h.includes("olygon")&&(i!==void 0?map.addLayer({id:C,type:"fill",source:{type:"geojson",data:a},layout:{visibility:"visible"},filter:["==",`${f}`,C],paint:i}):map.addLayer({id:C,type:"fill",source:{type:"geojson",data:a},layout:{visibility:"visible"},filter:["==",`${f}`,C],paint:{"fill-color":"blue","fill-opacity":.6}})),h.includes("oint")&&(i!==void 0?map.addLayer({id:C,type:"circle",source:{type:"geojson",data:a},layout:{visibility:"visible"},filter:["==",`${f}`,C],paint:i}):map.addLayer({id:C,type:"circle",source:{type:"geojson",data:a},layout:{visibility:"visible"},filter:["==",`${f}`,C],paint:{"circle-color":"red","circle-opacity":.85}})),g[C]=!0,map.addMenuItem(C))})}}catch(s){console.error(`Error fetching data: ${s.message}`)}}on(t,e){try{this.map.on(t,e)}catch(n){console.error(`Error adding event listener: ${n.message}`)}}getSource(t){try{return this.map.getSource(t)}catch(e){console.error(`Error getting source: ${e.message}`)}}addSource(t,e){try{this.map.addSource(t,e)}catch(n){console.error(`Error adding source: ${n.message}`)}}setStyle(t,e){try{console.log("kk",t),console.log("base",t),e!==void 0?this.map.setStyle(t,e):this.map.setStyle(t),this.map.on("styledata",()=>{if(window.document.querySelector(".maplibregl-compact-show")){var n=window.document.querySelector(".maplibregl-compact-show");n.classList.remove("maplibregl-compact-show")}this._dealOrto3dStyle(this.map.getStyle().name)})}catch(n){console.error(`Error setting style: ${n.message}`)}}getLayer(t){try{return this.map.getLayer(t)}catch(e){console.error(`Error getting layer: ${e.message}`)}}setFilter(t,e,n){try{return this.map.setFilter(t,e,n)}catch(i){console.error(`Error setting filter: ${i.message}`)}}jumpTo(t){try{this.map.jumpTo(t)}catch(e){console.error(`Error jumping to ${t}: ${e.message}`)}}setLayoutProperty(t,e,n){try{this.map.setLayoutProperty(t,e,n)}catch(i){console.error(`Error setting layout property: ${i.message}`)}}setPaintProperty(t,e,n){try{this.map.setPaintProperty(t,e,n)}catch(i){console.error(`Error setting paint property: ${i.message}`)}}addControl(t,e){try{e===void 0&&(e="top-right"),this.map.addControl(t,e)}catch(n){console.error(`Error adding control: ${n.message}`)}}getZoom(){try{return this.map.getZoom()}catch(t){console.error(`Error getting zoom level: ${t.message}`)}}addMouseCoordControl(){try{this.map.on("mousemove",function(t){const e=t.lngLat.lat,i="Lon/Lat (WGS 84)   Lon: "+t.lngLat.lng.toFixed(6)+"  Lat: "+e.toFixed(6),s=document.getElementById("divInfo"),a=document.createElement("div");a.className="coordControl",a.innerHTML=i+" - ZL: "+map.getZoom().toFixed(1),s.appendChild(a)})}catch(t){console.error(`Error adding mouse coordinate control: ${t.message}`)}}addGeolocateControl(t,e){try{e===void 0&&(e="top-right"),t===void 0?this.map.addControl(new No.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0}),e):this.map.addControl(new No.GeolocateControl(t),e)}catch(n){console.error(`Error adding geolocate control: ${n.message}`)}}getBounds(){try{return this.map.getBounds()}catch(t){console.error(`Error getting bounds: ${t.message}`)}}getCenter(){try{return this.map.getCenter()}catch(t){console.error(`Error getting center: ${t.message}`)}}setTerrain(t){try{return this.map.setTerrain(t)}catch(e){console.error(`Error setting terrain: ${e.message}`)}}setLayerZoomRange(t,e,n){try{return this.map.setLayerZoomRange(t,e,n)}catch(i){console.error(`Error setting terrain: ${i.message}`)}}getCanvas(){try{return this.map.getCanvas()}catch(t){console.error(`Error getting canvas: ${t.message}`)}}setCenter(t){try{return this.map.setCenter(t)}catch(e){console.error(`Error setting center: ${e.message}`)}}addLayer(t,e){try{this.map.addLayer(t,e)}catch(n){console.error(`Error adding layer: ${n.message}`)}}addLayerGeoJSON(t){try{this.map.addSource(`${t.id}-sourceIcgcMap`,{type:"geojson",data:t.data}),this.map.addLayer({id:`${t.id}-layerIcgcMap`,type:t.layerType,source:`${t.id}-sourceIcgcMap`,layout:t.layout,paint:t.paint})}catch(e){console.error(`Error adding GeoJSON layer: ${e.message}`)}}addLayerWMS(t){try{console.log("holaaddlayerwms",t),this.map.addSource(`${t.id}-sourceIcgcMap`,{type:"raster",tiles:[t.tiles],tileSize:256}),this.map.addLayer({id:`${t.id}-layerIcgcMap`,type:"raster",source:`${t.id}-sourceIcgcMap`,paint:{}})}catch(e){console.error(`Error adding WMS layer: ${e.message}`)}}removeControl(t){try{this.map.removeControl(t)}catch(e){console.error(`Error removing control: ${e.message}`)}}removeLayer(t){try{this.map.removeLayer(t)}catch(e){console.error(`Error removing layer: ${e.message}`)}}removeSource(t){try{this.map.removeSource(t)}catch(e){console.error(`Error removing source: ${e.message}`)}}addLogo(t){try{const e=document.createElement("img");e.src=t.url,e.style.height="62px";const n=document.getElementById("logos"),i=document.createElement("a");i.id=t.id,i.href=t.href,i.target="_blank",i.style.position="relative",i.style.bottom="1px",i.appendChild(e),n.appendChild(i)}catch(e){console.error(`Error adding logo: ${e.message}`)}}addBasemapsICGC(t){try{const e=i=>{this.map.setStyle(i)},n=document.getElementById("basemap-group");for(const i of t)for(const s of Object.keys(Wi.baseStyles)){const a=Wi.baseStyles[s];if(i===a.url){const o=document.createElement("div");o.className="basemap-item",o.title=a.key,o.style.backgroundImage=`url('${a.image}')`,n.appendChild(o),o.addEventListener("click",()=>e(a.url))}}}catch(e){console.error(`Error adding basemaps: ${e.message}`)}}addBasemaps(t){try{const e=i=>{console.log("base",i),this.map.setStyle(i.url)},n=document.getElementById("basemap-group");t.forEach(i=>{const s=document.createElement("div");s.className="basemap-item",s.title=i.label,s.style.backgroundImage=`url('${i.image}')`,n.appendChild(s),s.addEventListener("click",()=>e(i))})}catch(e){console.error(`Error adding basemaps: ${e.message}`)}}addFeatureQuery(t,e){try{let n;this.map.on("mouseenter",t,()=>{this.map.getCanvas().style.cursor="pointer"}),this.map.on("mouseleave",t,()=>{this.map.getCanvas().style.cursor=""}),this.map.on("click",i=>{let s=this.map.queryRenderedFeatures(i.point);if(s&&s[0].source===t){let a=[i.lngLat.lng,i.lngLat.lat];if(e!==void 0&&e.length>0){if(e!==null){let o="";e.forEach(h=>{let f=s[0].properties[h];o=o+`<h4>${f}</h4>`}),n=o,map.addPopup(a,n)}}else{let o="";for(const h in s[0].properties)o+="<b>"+h+"</b>:"+s[0].properties[h]+"<br>";n=o,map.addPopup(a,n)}}})}catch(n){console.error(`Error adding feature query: ${n.message}`)}}addScaleControl(t,e){try{var n=new No.ScaleControl(t);this.map.addControl(n,e)}catch(i){console.error(`Error adding scale: ${i.message}`)}}removeMeasureControl(){try{const t=document.getElementById("xButton"),e=document.getElementById("distance");e.innerHTML="";let n=this.map.getStyle().layers;for(let i=0;i<n.length;i++)n[i].id.includes("measure")&&this.map.removeLayer(n[i].id)}catch(t){console.error(`Error removing measure control: ${t.message}`)}}addMeasureControl(){try{let f=function(b,C){const B=C.queryRenderedFeatures(b.point,{layers:["measure-points"]});if(o.features.length>1&&o.features.pop(),n.innerHTML="",B.length){const Q=B[0].properties.id;o.features=o.features.filter(k=>k.properties.id!==Q)}else{const Q={type:"Feature",geometry:{type:"Point",coordinates:[b.lngLat.lng,b.lngLat.lat]},properties:{id:String(new Date().getTime())}};o.features.push(Q)}h.geometry.coordinates=o.features.map(Q=>Q.geometry.coordinates),o.features.push(h);const R=document.createElement("pre");R.textContent=`Distncia total: ${turf.length(h).toLocaleString()}km`,n.appendChild(R);const D=document.createElement("div");D.id="xButton",D.textContent="X",D.onclick=()=>{try{const Q=document.getElementById("xButton"),k=document.getElementById("distance");k.innerHTML="";let j=C.getStyle().layers;for(let et=0;et<j.length;et++)j[et].id.includes("measure")&&C.removeLayer(j[et].id)}catch(Q){console.error(`Error adding measure control: ${Q.message}`)}},n.appendChild(D),C.getSource("geojson").setData(o)},g=function(b,C){C.getCanvas().style.cursor="grab",i=!0};const e=document.getElementById("distance"),n=document.getElementById("distanceTotal");let i=!1,s=!1;var t;const a=document.createElement("div");a.id="rulerButton",a.onclick=()=>{try{s?document.getElementById("rulerButton").style.backgroundColor="#ff597a":document.getElementById("rulerButton").style.backgroundColor="#41b883",s=!s}catch(b){console.error(`Error adding measure control: ${b.message}`)}},n.appendChild(a);const o={type:"FeatureCollection",features:[]},h={type:"Feature",geometry:{type:"LineString",coordinates:[]}};this.map.addSource("geojson",{type:"geojson",data:o}),this.map.addLayer({id:"measure-points",type:"circle",source:"geojson",paint:{"circle-radius":5,"circle-color":"#000"},filter:["in","$type","Point"]}),this.map.addLayer({id:"measure-lines",type:"line",source:"geojson",layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#000","line-width":2.5},filter:["in","$type","LineString"]}),this.map.on("click",b=>{clearTimeout(t),!i&&s&&(t=setTimeout(()=>{f(b,this.map)},50))}),this.map.on("dblclick",b=>{s&&(clearTimeout(t),g(b,this.map))}),this.map.on("mousemove",b=>{if(!i&&s){const C=this.map.queryRenderedFeatures(b.point,{layers:["measure-points"]});this.map.getCanvas().style.cursor=C.length?"pointer":"crosshair"}else this.map.getCanvas().style.cursor="grab"})}catch{}}addExportControl(t,e){try{typeof t=="string"&&(e=t,t=void 0),t===void 0&&(t={PageSize:lf.A4,PageOrientation:og.Landscape,Format:Iu.PNG,DPI:Vw[300],Crosshair:!0,PrintableArea:!0},e="top-right"),map.addControl(new oet(t),e)}catch(n){console.error(`Error adding export control: ${n.message}`)}}addPopup(t,e){try{new No.Popup().setLngLat(t).setHTML(e).addTo(this.map)}catch{}}addMarker(t){try{let e,n;return t.text===void 0?e=new No.Marker(t.options).setLngLat(t.coord).addTo(this.map):(n=new No.Popup({offset:t.textOffset}).setText(t.text),e=new No.Marker().setLngLat(t.coord).setPopup(n).addTo(this.map)),e}catch(e){return console.error(`Error adding marker: ${e.message}`),null}}addPopup(t,e){try{return new No.Popup().setLngLat(t).setHTML(e).addTo(this.map)}catch(n){return console.error(`Error adding popup: ${n.message}`),null}}addFullScreen(t){try{t===void 0&&(t="top-right"),this.map.addControl(new No.FullscreenControl,t)}catch(e){console.error(`Error adding fullscreen control: ${e.message}`)}}addMenuItem(t){try{if(t.length>0){const e=document.getElementById("menu-group"),n=document.createElement("input");n.type="checkbox",n.id=t,n.checked=!0,e.appendChild(n);const i=document.createElement("label");i.setAttribute("for",t),i.textContent=t,e.appendChild(i),n.addEventListener("change",s=>{this.map.setLayoutProperty(t,"visibility",s.target.checked?"visible":"none")})}}catch(e){console.error(`Error adding menu item: ${e.message}`)}}addLayerTree(t){try{let e=t.features;const n=document.getElementById("filter-group"),i=this.map.getStyle().layers;let s;for(let a=0;a<i.length;a++)if(i[a].type==="symbol"){s=i[a].id;break}this.map.addSource(`${t.id}-source`,{type:t.type,data:e}),e.features.forEach(a=>{const o=a.properties.icon,h=`poi-${o}`;if(!this.map.getLayer(h)){this.map.addLayer({id:h,type:"circle",source:`${t.id}-source`,paint:{"circle-radius":6,"circle-color":"#B42222"},filter:["==","icon",o]},s);const f=document.createElement("input");f.type="checkbox",f.id=h,f.checked=!0,n.appendChild(f);const g=document.createElement("label");g.setAttribute("for",h),g.textContent=o,n.appendChild(g),f.addEventListener("change",b=>{this.map.setLayoutProperty(h,"visibility",b.target.checked?"visible":"none")})}})}catch(e){console.error(`Error adding layer tree: ${e.message}`)}}createNavigationControl(t,e){try{e===void 0&&(e="top-right"),this.map.addControl(new No.NavigationControl(t),e)}catch(n){return console.error(`Error creating navigation control: ${n.message}`),null}}addNavigationControl(t,e){try{e===void 0&&(e="top-right"),this.map.addControl(new No.NavigationControl(t),e)}catch(n){console.error(`Error adding navigation control: ${n.message}`)}}addAttributionControl(t){try{this.map.addControl(new No.AttributionControl(t.options),t.position)}catch(e){console.error(`Error adding attribution control: ${e.message}`)}}_dealStyleMaps(t){try{if(t&&t.indexOf("icgc.cat")!=-1){for(const e in uf)if(uf.hasOwnProperty(e)){const n=uf[e];if(e===t)return n}return uf[0]}else return t}catch(e){return console.error(`Error dealing with map styles: ${e.message}`),null}}addImageLayerICGC(t){try{let n=function(s,a,o,h,f){console.log("hola",t);const g=[a,o,h,f];for(const b of g)for(const[C,B]of Object.entries(b))if(B===s)return C;return null};console.log("name",t);let e=null;e=n(t,vo.Orto,vo.VectorAdmin,vo.WMS,vo.Vector),console.log("op",e),e||console.log(" %c The layer: %c%s%c does not exist in the ICGC DB. Consult the documentation.","font-weight: bold; font-style: italic;","font-weight: normal; font-style: normal; color: red;",t,"font-weight: bold; font-style: italic;");let i={id:e,tiles:t};console.log("source",i),this.addLayerWMS(i)}catch(e){console.error(`Error adding ICGC image layer: ${e.message}`)}}async addVectorLayerICGC(t){try{let n=function(i){for(const s in vo.VectorAdmin)if(vo.VectorAdmin.hasOwnProperty(s)&&vo.VectorAdmin[s]===i)return s;return null}(t);if(n===null)console.log(" %c The layer: %c%s%c does not exist in the ICGC DB. Consult the documentation.","font-weight: bold; font-style: italic;","font-weight: normal; font-style: normal; color: red;",n,"font-weight: bold; font-style: italic;");else{const i=await fetch(t),s={type:"FeatureCollection",features:[]};for await(const o of flatgeobuf.deserialize(i.body))s.features.push(o);let a=n+"-source";this.map.addSource(a,{type:"geojson",data:s}),t.includes("text")?this.map.addLayer({id:n+"-text",type:"symbol",source:a,layout:{"text-letter-spacing":.1,"text-size":{base:1.2,stops:[[8,0],[12,14],[15,15]]},"text-font":["FiraSans-Regular"],"text-field":["get","NOM_AC"],"text-transform":"none","text-max-width":25,visibility:"visible","text-justify":"right","text-anchor":"top","text-allow-overlap":!1,"symbol-spacing":2,"text-line-height":1},paint:{"text-halo-blur":.5,"text-color":"rgba(90, 7, 7, 1)","text-halo-width":2,"text-halo-color":"rgba(255, 255, 255,0.8)"}}):(this.map.addLayer({id:n+"-fill",type:"fill",source:a,paint:{"fill-color":"#0000FF","fill-opacity":0}}),this.map.addLayer({id:n+"-underline",type:"line",source:a,paint:{"line-color":"#ffffff","line-opacity":1,"line-width":3}}),this.map.addLayer({id:n+"-line",type:"line",source:a,paint:{"line-color":"#4832a8","line-opacity":1,"line-width":1}}))}}catch(e){console.error(`Error adding ICGC vector layer: ${e.message}`)}}addTerrainICGC(t,e){try{let n;for(const s in ry)if(ry.hasOwnProperty(s)){const a=ry[s];a===t&&(n=a)}let i=n;t.includes("terrarium")?this.map.addSource("terrainICGC-src",{type:"raster-dem",tiles:[i],tileSize:512,encoding:"terrarium",maxzoom:16}):this.map.addSource("terrainICGC-src",{type:"raster-dem",tiles:[i],tileSize:512,maxzoom:16}),this.map.setTerrain({source:"terrainICGC-src",exaggeration:1.5}),e===void 0&&(e="top-right"),this.map.addControl(new YN({pitch:90,bearing:null,minpitchzoom:null}),e)}catch(n){console.error(`Error adding 3D terrain: ${n.message}`)}}};var NF={exports:{}};function trt(r,t){var e=r.getCenter(),n=r.getZoom(),i=r.getBearing(),s=r.getPitch();t.forEach(function(a){a.jumpTo({center:e,zoom:n,bearing:i,pitch:s})})}function ert(){var r,t=arguments.length;if(t===1)r=arguments[0];else{r=[];for(var e=0;e<t;e++)r.push(arguments[e])}var n=[];r.forEach(function(o,h){n[h]=a.bind(null,o,r.filter(function(f,g){return g!==h}))});function i(){r.forEach(function(o,h){o.on("move",n[h])})}function s(){r.forEach(function(o,h){o.off("move",n[h])})}function a(o,h){s(),trt(o,h),i()}return i(),function(){s(),n=[],r=[]}}var rrt=ert;(function(r){var t=rrt,e=UF.EventEmitter;function n(i,s,a,o){if(this.options=o||{},this._mapA=i,this._mapB=s,this._horizontal=this.options.orientation==="horizontal",this._onDown=this._onDown.bind(this),this._onMove=this._onMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._ev=new e,this._swiper=document.createElement("div"),this._swiper.className=this._horizontal?"compare-swiper-horizontal":"compare-swiper-vertical",this._controlContainer=document.createElement("div"),this._controlContainer.className=this._horizontal?"maplibregl-compare maplibregl-compare-horizontal":"maplibregl-compare",this._controlContainer.className=this._controlContainer.className,this._controlContainer.appendChild(this._swiper),typeof a=="string"&&document.body.querySelectorAll){var h=document.body.querySelectorAll(a)[0];if(!h)throw new Error("Cannot find element with specified container selector.");h.appendChild(this._controlContainer)}else if(a instanceof Element&&a.appendChild)a.appendChild(this._controlContainer);else throw new Error("Invalid container specified. Must be CSS selector or HTML element.");this._bounds=s.getContainer().getBoundingClientRect();var f=(this._horizontal?this._bounds.height:this._bounds.width)/2;this._setPosition(f),this._clearSync=t(i,s),this._onResize=(function(){this._bounds=s.getContainer().getBoundingClientRect(),this.currentPosition&&this._setPosition(this.currentPosition)}).bind(this),s.on("resize",this._onResize),this.options&&this.options.mousemove&&(i.getContainer().addEventListener("mousemove",this._onMove),s.getContainer().addEventListener("mousemove",this._onMove)),this._swiper.addEventListener("mousedown",this._onDown),this._swiper.addEventListener("touchstart",this._onDown)}n.prototype={_setPointerEvents:function(i){this._controlContainer.style.pointerEvents=i,this._swiper.style.pointerEvents=i},_onDown:function(i){i.touches?(document.addEventListener("touchmove",this._onMove),document.addEventListener("touchend",this._onTouchEnd)):(document.addEventListener("mousemove",this._onMove),document.addEventListener("mouseup",this._onMouseUp))},_setPosition:function(i){i=Math.min(i,this._horizontal?this._bounds.height:this._bounds.width);var s=this._horizontal?"translate(0, "+i+"px)":"translate("+i+"px, 0)";this._controlContainer.style.transform=s,this._controlContainer.style.WebkitTransform=s;var a=this._horizontal?"rect(0, 999em, "+i+"px, 0)":"rect(0, "+i+"px, "+this._bounds.height+"px, 0)",o=this._horizontal?"rect("+i+"px, 999em, "+this._bounds.height+"px,0)":"rect(0, 999em, "+this._bounds.height+"px,"+i+"px)";this._mapA.getContainer().style.clip=a,this._mapB.getContainer().style.clip=o,this.currentPosition=i},_onMove:function(i){this.options&&this.options.mousemove&&this._setPointerEvents(i.touches?"auto":"none"),this._horizontal?this._setPosition(this._getY(i)):this._setPosition(this._getX(i))},_onMouseUp:function(){document.removeEventListener("mousemove",this._onMove),document.removeEventListener("mouseup",this._onMouseUp),this.fire("slideend",{currentPosition:this.currentPosition})},_onTouchEnd:function(){document.removeEventListener("touchmove",this._onMove),document.removeEventListener("touchend",this._onTouchEnd),this.fire("slideend",{currentPosition:this.currentPosition})},_getX:function(i){i=i.touches?i.touches[0]:i;var s=i.clientX-this._bounds.left;return s<0&&(s=0),s>this._bounds.width&&(s=this._bounds.width),s},_getY:function(i){i=i.touches?i.touches[0]:i;var s=i.clientY-this._bounds.top;return s<0&&(s=0),s>this._bounds.height&&(s=this._bounds.height),s},setSlider:function(i){this._setPosition(i)},on:function(i,s){return this._ev.on(i,s),this},fire:function(i,s){return this._ev.emit(i,s),this},off:function(i,s){return this._ev.removeListener(i,s),this},remove:function(){this._clearSync(),this._mapB.off("resize",this._onResize);var i=this._mapA.getContainer();i&&(i.style.clip=null,i.removeEventListener("mousemove",this._onMove));var s=this._mapB.getContainer();s&&(s.style.clip=null,s.removeEventListener("mousemove",this._onMove)),this._swiper.removeEventListener("mousedown",this._onDown),this._swiper.removeEventListener("touchstart",this._onDown),this._controlContainer.remove()}},window.maplibregl?maplibregl.Compare=n:r.exports=n})(NF);var nrt=NF.exports;const irt=xm(nrt);class srt{constructor(t,e,n,i){this.mapCompare=new irt(t.map,e.map,n,{})}}/*!
 * html2canvas 1.4.1 <https://html2canvas.hertzen.com>
 * Copyright (c) 2022 Niklas von Hertzen <https://hertzen.com>
 * Released under MIT License
 *//*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var $w=function(r,t){return $w=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])},$w(r,t)};function Hc(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");$w(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var Ww=function(){return Ww=Object.assign||function(r){for(var t,e=1,n=arguments.length;e<n;e++){t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=t[i])}return r},Ww.apply(this,arguments)};function Go(r,t,e,n){function i(s){return s instanceof e?s:new e(function(a){a(s)})}return new(e||(e=Promise))(function(s,a){function o(g){try{f(n.next(g))}catch(b){a(b)}}function h(g){try{f(n.throw(g))}catch(b){a(b)}}function f(g){g.done?s(g.value):i(g.value).then(o,h)}f((n=n.apply(r,t||[])).next())})}function bo(r,t){var e={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,i,s,a;return a={next:o(0),throw:o(1),return:o(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function o(f){return function(g){return h([f,g])}}function h(f){if(n)throw new TypeError("Generator is already executing.");for(;e;)try{if(n=1,i&&(s=f[0]&2?i.return:f[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,f[1])).done)return s;switch(i=0,s&&(f=[f[0]&2,s.value]),f[0]){case 0:case 1:s=f;break;case 4:return e.label++,{value:f[1],done:!1};case 5:e.label++,i=f[1],f=[0];continue;case 7:f=e.ops.pop(),e.trys.pop();continue;default:if(s=e.trys,!(s=s.length>0&&s[s.length-1])&&(f[0]===6||f[0]===2)){e=0;continue}if(f[0]===3&&(!s||f[1]>s[0]&&f[1]<s[3])){e.label=f[1];break}if(f[0]===6&&e.label<s[1]){e.label=s[1],s=f;break}if(s&&e.label<s[2]){e.label=s[2],e.ops.push(f);break}s[2]&&e.ops.pop(),e.trys.pop();continue}f=t.call(r,e)}catch(g){f=[6,g],i=0}finally{n=s=0}if(f[0]&5)throw f[1];return{value:f[0]?f[1]:void 0,done:!0}}}function ny(r,t,e){if(e||arguments.length===2)for(var n=0,i=t.length,s;n<i;n++)(s||!(n in t))&&(s||(s=Array.prototype.slice.call(t,0,n)),s[n]=t[n]);return r.concat(s||t)}for(var LA=function(){function r(t,e,n,i){this.left=t,this.top=e,this.width=n,this.height=i}return r.prototype.add=function(t,e,n,i){return new r(this.left+t,this.top+e,this.width+n,this.height+i)},r.fromClientRect=function(t,e){return new r(e.left+t.windowBounds.left,e.top+t.windowBounds.top,e.width,e.height)},r.fromDOMRectList=function(t,e){var n=Array.from(e).find(function(i){return i.width!==0});return n?new r(n.left+t.windowBounds.left,n.top+t.windowBounds.top,n.width,n.height):r.EMPTY},r.EMPTY=new r(0,0,0,0),r}(),iy=function(r,t){return LA.fromClientRect(r,t.getBoundingClientRect())},ort=function(r){var t=r.body,e=r.documentElement;if(!t||!e)throw new Error("Unable to get document size");var n=Math.max(Math.max(t.scrollWidth,e.scrollWidth),Math.max(t.offsetWidth,e.offsetWidth),Math.max(t.clientWidth,e.clientWidth)),i=Math.max(Math.max(t.scrollHeight,e.scrollHeight),Math.max(t.offsetHeight,e.offsetHeight),Math.max(t.clientHeight,e.clientHeight));return new LA(0,0,n,i)},sy=function(r){for(var t=[],e=0,n=r.length;e<n;){var i=r.charCodeAt(e++);if(i>=55296&&i<=56319&&e<n){var s=r.charCodeAt(e++);(s&64512)===56320?t.push(((i&1023)<<10)+(s&1023)+65536):(t.push(i),e--)}else t.push(i)}return t},Xi=function(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];if(String.fromCodePoint)return String.fromCodePoint.apply(String,r);var e=r.length;if(!e)return"";for(var n=[],i=-1,s="";++i<e;){var a=r[i];a<=65535?n.push(a):(a-=65536,n.push((a>>10)+55296,a%1024+56320)),(i+1===e||n.length>16384)&&(s+=String.fromCharCode.apply(String,n),n.length=0)}return s},kF="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",art=typeof Uint8Array>"u"?[]:new Uint8Array(256),oy=0;oy<kF.length;oy++)art[kF.charCodeAt(oy)]=oy;for(var QF="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ag=typeof Uint8Array>"u"?[]:new Uint8Array(256),ay=0;ay<QF.length;ay++)ag[QF.charCodeAt(ay)]=ay;for(var crt=function(r){var t=r.length*.75,e=r.length,n,i=0,s,a,o,h;r[r.length-1]==="="&&(t--,r[r.length-2]==="="&&t--);var f=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"&&typeof Uint8Array.prototype.slice<"u"?new ArrayBuffer(t):new Array(t),g=Array.isArray(f)?f:new Uint8Array(f);for(n=0;n<e;n+=4)s=ag[r.charCodeAt(n)],a=ag[r.charCodeAt(n+1)],o=ag[r.charCodeAt(n+2)],h=ag[r.charCodeAt(n+3)],g[i++]=s<<2|a>>4,g[i++]=(a&15)<<4|o>>2,g[i++]=(o&3)<<6|h&63;return f},lrt=function(r){for(var t=r.length,e=[],n=0;n<t;n+=2)e.push(r[n+1]<<8|r[n]);return e},Art=function(r){for(var t=r.length,e=[],n=0;n<t;n+=4)e.push(r[n+3]<<24|r[n+2]<<16|r[n+1]<<8|r[n]);return e},Lh=5,Xw=11,Jw=2,urt=Xw-Lh,zF=65536>>Lh,hrt=1<<Lh,Yw=hrt-1,drt=1024>>Lh,frt=zF+drt,prt=frt,grt=32,mrt=prt+grt,yrt=65536>>Xw,_rt=1<<urt,vrt=_rt-1,HF=function(r,t,e){return r.slice?r.slice(t,e):new Uint16Array(Array.prototype.slice.call(r,t,e))},brt=function(r,t,e){return r.slice?r.slice(t,e):new Uint32Array(Array.prototype.slice.call(r,t,e))},wrt=function(r,t){var e=crt(r),n=Array.isArray(e)?Art(e):new Uint32Array(e),i=Array.isArray(e)?lrt(e):new Uint16Array(e),s=24,a=HF(i,s/2,n[4]/2),o=n[5]===2?HF(i,(s+n[4])/2):brt(n,Math.ceil((s+n[4])/4));return new xrt(n[0],n[1],n[2],n[3],a,o)},xrt=function(){function r(t,e,n,i,s,a){this.initialValue=t,this.errorValue=e,this.highStart=n,this.highValueIndex=i,this.index=s,this.data=a}return r.prototype.get=function(t){var e;if(t>=0){if(t<55296||t>56319&&t<=65535)return e=this.index[t>>Lh],e=(e<<Jw)+(t&Yw),this.data[e];if(t<=65535)return e=this.index[zF+(t-55296>>Lh)],e=(e<<Jw)+(t&Yw),this.data[e];if(t<this.highStart)return e=mrt-yrt+(t>>Xw),e=this.index[e],e+=t>>Lh&vrt,e=this.index[e],e=(e<<Jw)+(t&Yw),this.data[e];if(t<=1114111)return this.data[this.highValueIndex]}return this.errorValue},r}(),GF="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Brt=typeof Uint8Array>"u"?[]:new Uint8Array(256),cy=0;cy<GF.length;cy++)Brt[GF.charCodeAt(cy)]=cy;var Crt="KwAAAAAAAAAACA4AUD0AADAgAAACAAAAAAAIABAAGABAAEgAUABYAGAAaABgAGgAYgBqAF8AZwBgAGgAcQB5AHUAfQCFAI0AlQCdAKIAqgCyALoAYABoAGAAaABgAGgAwgDKAGAAaADGAM4A0wDbAOEA6QDxAPkAAQEJAQ8BFwF1AH0AHAEkASwBNAE6AUIBQQFJAVEBWQFhAWgBcAF4ATAAgAGGAY4BlQGXAZ8BpwGvAbUBvQHFAc0B0wHbAeMB6wHxAfkBAQIJAvEBEQIZAiECKQIxAjgCQAJGAk4CVgJeAmQCbAJ0AnwCgQKJApECmQKgAqgCsAK4ArwCxAIwAMwC0wLbAjAA4wLrAvMC+AIAAwcDDwMwABcDHQMlAy0DNQN1AD0DQQNJA0kDSQNRA1EDVwNZA1kDdQB1AGEDdQBpA20DdQN1AHsDdQCBA4kDkQN1AHUAmQOhA3UAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AKYDrgN1AHUAtgO+A8YDzgPWAxcD3gPjA+sD8wN1AHUA+wMDBAkEdQANBBUEHQQlBCoEFwMyBDgEYABABBcDSARQBFgEYARoBDAAcAQzAXgEgASIBJAEdQCXBHUAnwSnBK4EtgS6BMIEyAR1AHUAdQB1AHUAdQCVANAEYABgAGAAYABgAGAAYABgANgEYADcBOQEYADsBPQE/AQEBQwFFAUcBSQFLAU0BWQEPAVEBUsFUwVbBWAAYgVgAGoFcgV6BYIFigWRBWAAmQWfBaYFYABgAGAAYABgAKoFYACxBbAFuQW6BcEFwQXHBcEFwQXPBdMF2wXjBeoF8gX6BQIGCgYSBhoGIgYqBjIGOgZgAD4GRgZMBmAAUwZaBmAAYABgAGAAYABgAGAAYABgAGAAYABgAGIGYABpBnAGYABgAGAAYABgAGAAYABgAGAAYAB4Bn8GhQZgAGAAYAB1AHcDFQSLBmAAYABgAJMGdQA9A3UAmwajBqsGqwaVALMGuwbDBjAAywbSBtIG1QbSBtIG0gbSBtIG0gbdBuMG6wbzBvsGAwcLBxMHAwcbByMHJwcsBywHMQcsB9IGOAdAB0gHTgfSBkgHVgfSBtIG0gbSBtIG0gbSBtIG0gbSBiwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdgAGAALAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdbB2MHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB2kH0gZwB64EdQB1AHUAdQB1AHUAdQB1AHUHfQdgAIUHjQd1AHUAlQedB2AAYAClB6sHYACzB7YHvgfGB3UAzgfWBzMB3gfmB1EB7gf1B/0HlQENAQUIDQh1ABUIHQglCBcDLQg1CD0IRQhNCEEDUwh1AHUAdQBbCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIcAh3CHoIMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIgggwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAALAcsBywHLAcsBywHLAcsBywHLAcsB4oILAcsB44I0gaWCJ4Ipgh1AHUAqgiyCHUAdQB1AHUAdQB1AHUAdQB1AHUAtwh8AXUAvwh1AMUIyQjRCNkI4AjoCHUAdQB1AO4I9gj+CAYJDgkTCS0HGwkjCYIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiAAIAAAAFAAYABgAGIAXwBgAHEAdQBFAJUAogCyAKAAYABgAEIA4ABGANMA4QDxAMEBDwE1AFwBLAE6AQEBUQF4QkhCmEKoQrhCgAHIQsAB0MLAAcABwAHAAeDC6ABoAHDCwMMAAcABwAHAAdDDGMMAAcAB6MM4wwjDWMNow3jDaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAEjDqABWw6bDqABpg6gAaABoAHcDvwOPA+gAaABfA/8DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DpcPAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcAB9cPKwkyCToJMAB1AHUAdQBCCUoJTQl1AFUJXAljCWcJawkwADAAMAAwAHMJdQB2CX4JdQCECYoJjgmWCXUAngkwAGAAYABxAHUApgn3A64JtAl1ALkJdQDACTAAMAAwADAAdQB1AHUAdQB1AHUAdQB1AHUAowYNBMUIMAAwADAAMADICcsJ0wnZCRUE4QkwAOkJ8An4CTAAMAB1AAAKvwh1AAgKDwoXCh8KdQAwACcKLgp1ADYKqAmICT4KRgowADAAdQB1AE4KMAB1AFYKdQBeCnUAZQowADAAMAAwADAAMAAwADAAMAAVBHUAbQowADAAdQC5CXUKMAAwAHwBxAijBogEMgF9CoQKiASMCpQKmgqIBKIKqgquCogEDQG2Cr4KxgrLCjAAMADTCtsKCgHjCusK8Qr5CgELMAAwADAAMAB1AIsECQsRC3UANAEZCzAAMAAwADAAMAB1ACELKQswAHUANAExCzkLdQBBC0kLMABRC1kLMAAwADAAMAAwADAAdQBhCzAAMAAwAGAAYABpC3ELdwt/CzAAMACHC4sLkwubC58Lpwt1AK4Ltgt1APsDMAAwADAAMAAwADAAMAAwAL4LwwvLC9IL1wvdCzAAMADlC+kL8Qv5C/8LSQswADAAMAAwADAAMAAwADAAMAAHDDAAMAAwADAAMAAODBYMHgx1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1ACYMMAAwADAAdQB1AHUALgx1AHUAdQB1AHUAdQA2DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AD4MdQBGDHUAdQB1AHUAdQB1AEkMdQB1AHUAdQB1AFAMMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQBYDHUAdQB1AF8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUA+wMVBGcMMAAwAHwBbwx1AHcMfwyHDI8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAYABgAJcMMAAwADAAdQB1AJ8MlQClDDAAMACtDCwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB7UMLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AA0EMAC9DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAsBywHLAcsBywHLAcsBywHLQcwAMEMyAwsBywHLAcsBywHLAcsBywHLAcsBywHzAwwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1ANQM2QzhDDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMABgAGAAYABgAGAAYABgAOkMYADxDGAA+AwADQYNYABhCWAAYAAODTAAMAAwADAAFg1gAGAAHg37AzAAMAAwADAAYABgACYNYAAsDTQNPA1gAEMNPg1LDWAAYABgAGAAYABgAGAAYABgAGAAUg1aDYsGVglhDV0NcQBnDW0NdQ15DWAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAlQCBDZUAiA2PDZcNMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAnw2nDTAAMAAwADAAMAAwAHUArw23DTAAMAAwADAAMAAwADAAMAAwADAAMAB1AL8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQDHDTAAYABgAM8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA1w11ANwNMAAwAD0B5A0wADAAMAAwADAAMADsDfQN/A0EDgwOFA4wABsOMAAwADAAMAAwADAAMAAwANIG0gbSBtIG0gbSBtIG0gYjDigOwQUuDsEFMw7SBjoO0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGQg5KDlIOVg7SBtIGXg5lDm0OdQ7SBtIGfQ6EDooOjQ6UDtIGmg6hDtIG0gaoDqwO0ga0DrwO0gZgAGAAYADEDmAAYAAkBtIGzA5gANIOYADaDokO0gbSBt8O5w7SBu8O0gb1DvwO0gZgAGAAxA7SBtIG0gbSBtIGYABgAGAAYAAED2AAsAUMD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHJA8sBywHLAcsBywHLAccDywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywPLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAc0D9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHPA/SBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gYUD0QPlQCVAJUAMAAwADAAMACVAJUAlQCVAJUAlQCVAEwPMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA//8EAAQABAAEAAQABAAEAAQABAANAAMAAQABAAIABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQACgATABcAHgAbABoAHgAXABYAEgAeABsAGAAPABgAHABLAEsASwBLAEsASwBLAEsASwBLABgAGAAeAB4AHgATAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABYAGwASAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWAA0AEQAeAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAFAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJABYAGgAbABsAGwAeAB0AHQAeAE8AFwAeAA0AHgAeABoAGwBPAE8ADgBQAB0AHQAdAE8ATwAXAE8ATwBPABYAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAFAATwBAAE8ATwBPAEAATwBQAFAATwBQAB4AHgAeAB4AHgAeAB0AHQAdAB0AHgAdAB4ADgBQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgBQAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAkACQAJAAkACQAJAAkABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAFAAHgAeAB4AKwArAFAAUABQAFAAGABQACsAKwArACsAHgAeAFAAHgBQAFAAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUAAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAYAA0AKwArAB4AHgAbACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAB4ABAAEAB4ABAAEABMABAArACsAKwArACsAKwArACsAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAKwArACsAKwBWAFYAVgBWAB4AHgArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AGgAaABoAGAAYAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQAEwAEACsAEwATAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABLAEsASwBLAEsASwBLAEsASwBLABoAGQAZAB4AUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABMAUAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABABQAFAABAAEAB4ABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUAAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAFAABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQAUABQAB4AHgAYABMAUAArACsABAAbABsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAFAABAAEAAQABAAEAFAABAAEAAQAUAAEAAQABAAEAAQAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArACsAHgArAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAUAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEAA0ADQBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUAArACsAKwBQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABABQACsAKwArACsAKwArACsAKwAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUAAaABoAUABQAFAAUABQAEwAHgAbAFAAHgAEACsAKwAEAAQABAArAFAAUABQAFAAUABQACsAKwArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQACsAUABQACsAKwAEACsABAAEAAQABAAEACsAKwArACsABAAEACsAKwAEAAQABAArACsAKwAEACsAKwArACsAKwArACsAUABQAFAAUAArAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLAAQABABQAFAAUAAEAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAArACsAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AGwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAKwArACsAKwArAAQABAAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAAQAUAArAFAAUABQAFAAUABQACsAKwArAFAAUABQACsAUABQAFAAUAArACsAKwBQAFAAKwBQACsAUABQACsAKwArAFAAUAArACsAKwBQAFAAUAArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArAAQABAAEAAQABAArACsAKwAEAAQABAArAAQABAAEAAQAKwArAFAAKwArACsAKwArACsABAArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAHgAeAB4AHgAeAB4AGwAeACsAKwArACsAKwAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAUABQAFAAKwArACsAKwArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwAOAFAAUABQAFAAUABQAFAAHgBQAAQABAAEAA4AUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAKwArAAQAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAKwArACsAKwArACsAUAArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAFAABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQABABQAB4AKwArACsAKwBQAFAAUAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQABoAUABQAFAAUABQAFAAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQACsAUAArACsAUABQAFAAUABQAFAAUAArACsAKwAEACsAKwArACsABAAEAAQABAAEAAQAKwAEACsABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArAAQABAAeACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAXAAqACoAKgAqACoAKgAqACsAKwArACsAGwBcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAeAEsASwBLAEsASwBLAEsASwBLAEsADQANACsAKwArACsAKwBcAFwAKwBcACsAXABcAFwAXABcACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAXAArAFwAXABcAFwAXABcAFwAXABcAFwAKgBcAFwAKgAqACoAKgAqACoAKgAqACoAXAArACsAXABcAFwAXABcACsAXAArACoAKgAqACoAKgAqACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwBcAFwAXABcAFAADgAOAA4ADgAeAA4ADgAJAA4ADgANAAkAEwATABMAEwATAAkAHgATAB4AHgAeAAQABAAeAB4AHgAeAB4AHgBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQAFAADQAEAB4ABAAeAAQAFgARABYAEQAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAAQABAAEAAQADQAEAAQAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAA0ADQAeAB4AHgAeAB4AHgAEAB4AHgAeAB4AHgAeACsAHgAeAA4ADgANAA4AHgAeAB4AHgAeAAkACQArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgBcAEsASwBLAEsASwBLAEsASwBLAEsADQANAB4AHgAeAB4AXABcAFwAXABcAFwAKgAqACoAKgBcAFwAXABcACoAKgAqAFwAKgAqACoAXABcACoAKgAqACoAKgAqACoAXABcAFwAKgAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqAFwAKgBLAEsASwBLAEsASwBLAEsASwBLACoAKgAqACoAKgAqAFAAUABQAFAAUABQACsAUAArACsAKwArACsAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAKwBQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsABAAEAAQAHgANAB4AHgAeAB4AHgAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUAArACsADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWABEAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQANAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAANAA0AKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUAArAAQABAArACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqAA0ADQAVAFwADQAeAA0AGwBcACoAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwAeAB4AEwATAA0ADQAOAB4AEwATAB4ABAAEAAQACQArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAHgArACsAKwATABMASwBLAEsASwBLAEsASwBLAEsASwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAXABcAFwAXABcACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAXAArACsAKwAqACoAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsAHgAeAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKwAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKwArAAQASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACoAKgAqACoAKgAqACoAXAAqACoAKgAqACoAKgArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABABQAFAAUABQAFAAUABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwANAA0AHgANAA0ADQANAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwAeAB4AHgAeAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArAA0ADQANAA0ADQBLAEsASwBLAEsASwBLAEsASwBLACsAKwArAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUAAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAAQAUABQAFAAUABQAFAABABQAFAABAAEAAQAUAArACsAKwArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQACsAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAFAAUABQACsAHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQACsAKwAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQACsAHgAeAB4AHgAeAB4AHgAOAB4AKwANAA0ADQANAA0ADQANAAkADQANAA0ACAAEAAsABAAEAA0ACQANAA0ADAAdAB0AHgAXABcAFgAXABcAFwAWABcAHQAdAB4AHgAUABQAFAANAAEAAQAEAAQABAAEAAQACQAaABoAGgAaABoAGgAaABoAHgAXABcAHQAVABUAHgAeAB4AHgAeAB4AGAAWABEAFQAVABUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ADQAeAA0ADQANAA0AHgANAA0ADQAHAB4AHgAeAB4AKwAEAAQABAAEAAQABAAEAAQABAAEAFAAUAArACsATwBQAFAAUABQAFAAHgAeAB4AFgARAE8AUABPAE8ATwBPAFAAUABQAFAAUAAeAB4AHgAWABEAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArABsAGwAbABsAGwAbABsAGgAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGgAbABsAGwAbABoAGwAbABoAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAHgAeAFAAGgAeAB0AHgBQAB4AGgAeAB4AHgAeAB4AHgAeAB4AHgBPAB4AUAAbAB4AHgBQAFAAUABQAFAAHgAeAB4AHQAdAB4AUAAeAFAAHgBQAB4AUABPAFAAUAAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgBQAFAAUABQAE8ATwBQAFAAUABQAFAATwBQAFAATwBQAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAUABQAFAATwBPAE8ATwBPAE8ATwBPAE8ATwBQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABPAB4AHgArACsAKwArAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHQAdAB4AHgAeAB0AHQAeAB4AHQAeAB4AHgAdAB4AHQAbABsAHgAdAB4AHgAeAB4AHQAeAB4AHQAdAB0AHQAeAB4AHQAeAB0AHgAdAB0AHQAdAB0AHQAeAB0AHgAeAB4AHgAeAB0AHQAdAB0AHgAeAB4AHgAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHgAeAB0AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAeAB0AHQAdAB0AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAdAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAWABEAHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAWABEAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AHQAdAB0AHgAeAB0AHgAeAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlAB4AHQAdAB4AHgAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AJQAlAB0AHQAlAB4AJQAlACUAIAAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAdAB0AHQAeAB0AJQAdAB0AHgAdAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAdAB0AHQAdACUAHgAlACUAJQAdACUAJQAdAB0AHQAlACUAHQAdACUAHQAdACUAJQAlAB4AHQAeAB4AHgAeAB0AHQAlAB0AHQAdAB0AHQAdACUAJQAlACUAJQAdACUAJQAgACUAHQAdACUAJQAlACUAJQAlACUAJQAeAB4AHgAlACUAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AFwAXABcAFwAXABcAHgATABMAJQAeAB4AHgAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARABYAEQAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAEAAQABAAeAB4AKwArACsAKwArABMADQANAA0AUAATAA0AUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUAANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAA0ADQANAA0ADQANAA0ADQAeAA0AFgANAB4AHgAXABcAHgAeABcAFwAWABEAFgARABYAEQAWABEADQANAA0ADQATAFAADQANAB4ADQANAB4AHgAeAB4AHgAMAAwADQANAA0AHgANAA0AFgANAA0ADQANAA0ADQANAA0AHgANAB4ADQANAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArAA0AEQARACUAJQBHAFcAVwAWABEAFgARABYAEQAWABEAFgARACUAJQAWABEAFgARABYAEQAWABEAFQAWABEAEQAlAFcAVwBXAFcAVwBXAFcAVwBXAAQABAAEAAQABAAEACUAVwBXAFcAVwA2ACUAJQBXAFcAVwBHAEcAJQAlACUAKwBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBRAFcAUQBXAFEAVwBXAFcAVwBXAFcAUQBXAFcAVwBXAFcAVwBRAFEAKwArAAQABAAVABUARwBHAFcAFQBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBRAFcAVwBXAFcAVwBXAFEAUQBXAFcAVwBXABUAUQBHAEcAVwArACsAKwArACsAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwAlACUAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACsAKwArACsAKwArACsAKwArACsAKwArAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBPAE8ATwBPAE8ATwBPAE8AJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADQATAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABLAEsASwBLAEsASwBLAEsASwBLAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAABAAEAAQABAAeAAQABAAEAAQABAAEAAQABAAEAAQAHgBQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAeAA0ADQANAA0ADQArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAAQAUABQAFAABABQAFAAUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAeAB4AHgAeAAQAKwArACsAUABQAFAAUABQAFAAHgAeABoAHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADgAOABMAEwArACsAKwArACsAKwArACsABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwANAA0ASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUAAeAB4AHgBQAA4AUABQAAQAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArAB4AWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYACsAKwArAAQAHgAeAB4AHgAeAB4ADQANAA0AHgAeAB4AHgArAFAASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArAB4AHgBcAFwAXABcAFwAKgBcAFwAXABcAFwAXABcAFwAXABcAEsASwBLAEsASwBLAEsASwBLAEsAXABcAFwAXABcACsAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAFAAUABQAAQAUABQAFAAUABQAFAAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAHgANAA0ADQBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAXAAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAKgAqACoAXABcACoAKgBcAFwAXABcAFwAKgAqAFwAKgBcACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcACoAKgBQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAA0ADQBQAFAAUAAEAAQAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQADQAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAVABVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBUAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVACsAKwArACsAKwArACsAKwArACsAKwArAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAKwArACsAKwBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAKwArACsAKwAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAKwArACsAKwArAFYABABWAFYAVgBWAFYAVgBWAFYAVgBWAB4AVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgArAFYAVgBWAFYAVgArAFYAKwBWAFYAKwBWAFYAKwBWAFYAVgBWAFYAVgBWAFYAVgBWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAEQAWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAaAB4AKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAGAARABEAGAAYABMAEwAWABEAFAArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACUAJQAlACUAJQAWABEAFgARABYAEQAWABEAFgARABYAEQAlACUAFgARACUAJQAlACUAJQAlACUAEQAlABEAKwAVABUAEwATACUAFgARABYAEQAWABEAJQAlACUAJQAlACUAJQAlACsAJQAbABoAJQArACsAKwArAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAcAKwATACUAJQAbABoAJQAlABYAEQAlACUAEQAlABEAJQBXAFcAVwBXAFcAVwBXAFcAVwBXABUAFQAlACUAJQATACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXABYAJQARACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAWACUAEQAlABYAEQARABYAEQARABUAVwBRAFEAUQBRAFEAUQBRAFEAUQBRAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcARwArACsAVwBXAFcAVwBXAFcAKwArAFcAVwBXAFcAVwBXACsAKwBXAFcAVwBXAFcAVwArACsAVwBXAFcAKwArACsAGgAbACUAJQAlABsAGwArAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAAQAB0AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsADQANAA0AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAA0AUABQAFAAUAArACsAKwArAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwArAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwBQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAUABQAFAAUABQAAQABAAEACsABAAEACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAKwBQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAA0ADQANAA0ADQANAA0ADQAeACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAArACsAKwArAFAAUABQAFAAUAANAA0ADQANAA0ADQAUACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsADQANAA0ADQANAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArAAQABAANACsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAB4AHgAeAB4AHgArACsAKwArACsAKwAEAAQABAAEAAQABAAEAA0ADQAeAB4AHgAeAB4AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsASwBLAEsASwBLAEsASwBLAEsASwANAA0ADQANAFAABAAEAFAAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAeAA4AUAArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAADQANAB4ADQAEAAQABAAEAB4ABAAEAEsASwBLAEsASwBLAEsASwBLAEsAUAAOAFAADQANAA0AKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAANAA0AHgANAA0AHgAEACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAA0AKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsABAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsABAAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAUAArACsAKwArACsAKwAEACsAKwArACsAKwBQAFAAUABQAFAABAAEACsAKwAEAAQABAAEAAQABAAEACsAKwArAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAQABABQAFAAUABQAA0ADQANAA0AHgBLAEsASwBLAEsASwBLAEsASwBLAA0ADQArAB4ABABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUAAeAFAAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABAAEAAQADgANAA0AEwATAB4AHgAeAA0ADQANAA0ADQANAA0ADQANAA0ADQANAA0ADQANAFAAUABQAFAABAAEACsAKwAEAA0ADQAeAFAAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKwArACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBcAFwADQANAA0AKgBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAKwArAFAAKwArAFAAUABQAFAAUABQAFAAUAArAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQAKwAEAAQAKwArAAQABAAEAAQAUAAEAFAABAAEAA0ADQANACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABABQAA4AUAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAFAABAAEAAQABAAOAB4ADQANAA0ADQAOAB4ABAArACsAKwArACsAKwArACsAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAA0ADQANAFAADgAOAA4ADQANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAAQABAAEAFAADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAOABMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAArACsAKwAEACsABAAEACsABAAEAAQABAAEAAQABABQAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAaABoAGgAaAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABIAEgAQwBDAEMAUABQAFAAUABDAFAAUABQAEgAQwBIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABDAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAJAAkACQAJAAkACQAJABYAEQArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwANAA0AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAANACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAA0ADQANAB4AHgAeAB4AHgAeAFAAUABQAFAADQAeACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAA0AHgAeACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAARwBHABUARwAJACsAKwArACsAKwArACsAKwArACsAKwAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUQBRAFEAKwArACsAKwArACsAKwArACsAKwArACsAKwBRAFEAUQBRACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAHgAEAAQADQAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQABAAEAAQABAAeAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQAHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAKwArAFAAKwArAFAAUAArACsAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUAArAFAAUABQAFAAUABQAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAHgAeAFAAUABQAFAAUAArAFAAKwArACsAUABQAFAAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeACsAKwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4ABAAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAHgAeAA0ADQANAA0AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArAAQABAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwBQAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArABsAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAB4AHgAeAB4ABAAEAAQABAAEAAQABABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArABYAFgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAGgBQAFAAUAAaAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUAArACsAKwArACsAKwBQACsAKwArACsAUAArAFAAKwBQACsAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUAArAFAAKwBQACsAUAArAFAAUAArAFAAKwArAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAKwBQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8AJQAlACUAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB4AHgAeACUAJQAlAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAlACUAJQAlACUAHgAlACUAJQAlACUAIAAgACAAJQAlACAAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACEAIQAhACEAIQAlACUAIAAgACUAJQAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAIAAlACUAJQAlACAAIAAgACUAIAAgACAAJQAlACUAJQAlACUAJQAgACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAlAB4AJQAeACUAJQAlACUAJQAgACUAJQAlACUAHgAlAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACAAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABcAFwAXABUAFQAVAB4AHgAeAB4AJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAgACUAJQAgACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAIAAgACUAJQAgACAAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACAAIAAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACAAIAAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAA==",VF=50,Ert=1,jF=2,qF=3,Srt=4,Trt=5,KF=7,$F=8,WF=9,Lu=10,Zw=11,XF=12,t2=13,Irt=14,cg=15,e2=16,ly=17,lg=18,Lrt=19,JF=20,r2=21,Ag=22,n2=23,hf=24,ka=25,ug=26,hg=27,df=28,Frt=29,ff=30,Mrt=31,Ay=32,uy=33,i2=34,s2=35,o2=36,dg=37,a2=38,hy=39,dy=40,c2=41,YF=42,Prt=43,Urt=[9001,65288],ZF="!",Vo="",fy="",l2=wrt(Crt),FA=[ff,o2],A2=[Ert,jF,qF,Trt],tM=[Lu,$F],eM=[hg,ug],Rrt=A2.concat(tM),rM=[a2,hy,dy,i2,s2],Drt=[cg,t2],Ort=function(r,t){t===void 0&&(t="strict");var e=[],n=[],i=[];return r.forEach(function(s,a){var o=l2.get(s);if(o>VF?(i.push(!0),o-=VF):i.push(!1),["normal","auto","loose"].indexOf(t)!==-1&&[8208,8211,12316,12448].indexOf(s)!==-1)return n.push(a),e.push(e2);if(o===Srt||o===Zw){if(a===0)return n.push(a),e.push(ff);var h=e[a-1];return Rrt.indexOf(h)===-1?(n.push(n[a-1]),e.push(h)):(n.push(a),e.push(ff))}if(n.push(a),o===Mrt)return e.push(t==="strict"?r2:dg);if(o===YF||o===Frt)return e.push(ff);if(o===Prt)return s>=131072&&s<=196605||s>=196608&&s<=262141?e.push(dg):e.push(ff);e.push(o)}),[n,e,i]},u2=function(r,t,e,n){var i=n[e];if(Array.isArray(r)?r.indexOf(i)!==-1:r===i)for(var s=e;s<=n.length;){s++;var a=n[s];if(a===t)return!0;if(a!==Lu)break}if(i===Lu)for(var s=e;s>0;){s--;var o=n[s];if(Array.isArray(r)?r.indexOf(o)!==-1:r===o)for(var h=e;h<=n.length;){h++;var a=n[h];if(a===t)return!0;if(a!==Lu)break}if(o!==Lu)break}return!1},nM=function(r,t){for(var e=r;e>=0;){var n=t[e];if(n===Lu)e--;else return n}return 0},Nrt=function(r,t,e,n,i){if(e[n]===0)return Vo;var s=n-1;if(Array.isArray(i)&&i[s]===!0)return Vo;var a=s-1,o=s+1,h=t[s],f=a>=0?t[a]:0,g=t[o];if(h===jF&&g===qF)return Vo;if(A2.indexOf(h)!==-1)return ZF;if(A2.indexOf(g)!==-1||tM.indexOf(g)!==-1)return Vo;if(nM(s,t)===$F)return fy;if(l2.get(r[s])===Zw||(h===Ay||h===uy)&&l2.get(r[o])===Zw||h===KF||g===KF||h===WF||[Lu,t2,cg].indexOf(h)===-1&&g===WF||[ly,lg,Lrt,hf,df].indexOf(g)!==-1||nM(s,t)===Ag||u2(n2,Ag,s,t)||u2([ly,lg],r2,s,t)||u2(XF,XF,s,t))return Vo;if(h===Lu)return fy;if(h===n2||g===n2)return Vo;if(g===e2||h===e2)return fy;if([t2,cg,r2].indexOf(g)!==-1||h===Irt||f===o2&&Drt.indexOf(h)!==-1||h===df&&g===o2||g===JF||FA.indexOf(g)!==-1&&h===ka||FA.indexOf(h)!==-1&&g===ka||h===hg&&[dg,Ay,uy].indexOf(g)!==-1||[dg,Ay,uy].indexOf(h)!==-1&&g===ug||FA.indexOf(h)!==-1&&eM.indexOf(g)!==-1||eM.indexOf(h)!==-1&&FA.indexOf(g)!==-1||[hg,ug].indexOf(h)!==-1&&(g===ka||[Ag,cg].indexOf(g)!==-1&&t[o+1]===ka)||[Ag,cg].indexOf(h)!==-1&&g===ka||h===ka&&[ka,df,hf].indexOf(g)!==-1)return Vo;if([ka,df,hf,ly,lg].indexOf(g)!==-1)for(var b=s;b>=0;){var C=t[b];if(C===ka)return Vo;if([df,hf].indexOf(C)!==-1)b--;else break}if([hg,ug].indexOf(g)!==-1)for(var b=[ly,lg].indexOf(h)!==-1?a:s;b>=0;){var C=t[b];if(C===ka)return Vo;if([df,hf].indexOf(C)!==-1)b--;else break}if(a2===h&&[a2,hy,i2,s2].indexOf(g)!==-1||[hy,i2].indexOf(h)!==-1&&[hy,dy].indexOf(g)!==-1||[dy,s2].indexOf(h)!==-1&&g===dy||rM.indexOf(h)!==-1&&[JF,ug].indexOf(g)!==-1||rM.indexOf(g)!==-1&&h===hg||FA.indexOf(h)!==-1&&FA.indexOf(g)!==-1||h===hf&&FA.indexOf(g)!==-1||FA.concat(ka).indexOf(h)!==-1&&g===Ag&&Urt.indexOf(r[o])===-1||FA.concat(ka).indexOf(g)!==-1&&h===lg)return Vo;if(h===c2&&g===c2){for(var B=e[s],R=1;B>0&&(B--,t[B]===c2);)R++;if(R%2!==0)return Vo}return h===Ay&&g===uy?Vo:fy},krt=function(r,t){t||(t={lineBreak:"normal",wordBreak:"normal"});var e=Ort(r,t.lineBreak),n=e[0],i=e[1],s=e[2];(t.wordBreak==="break-all"||t.wordBreak==="break-word")&&(i=i.map(function(o){return[ka,ff,YF].indexOf(o)!==-1?dg:o}));var a=t.wordBreak==="keep-all"?s.map(function(o,h){return o&&r[h]>=19968&&r[h]<=40959}):void 0;return[n,i,a]},Qrt=function(){function r(t,e,n,i){this.codePoints=t,this.required=e===ZF,this.start=n,this.end=i}return r.prototype.slice=function(){return Xi.apply(void 0,this.codePoints.slice(this.start,this.end))},r}(),zrt=function(r,t){var e=sy(r),n=krt(e,t),i=n[0],s=n[1],a=n[2],o=e.length,h=0,f=0;return{next:function(){if(f>=o)return{done:!0,value:null};for(var g=Vo;f<o&&(g=Nrt(e,s,i,++f,a))===Vo;);if(g!==Vo||f===o){var b=new Qrt(e,g,h,f);return h=f,{value:b,done:!1}}return{done:!0,value:null}}}},Hrt=1,Grt=2,fg=4,iM=8,py=10,sM=47,pg=92,Vrt=9,jrt=32,gy=34,gg=61,qrt=35,Krt=36,$rt=37,my=39,yy=40,mg=41,Wrt=95,ha=45,Xrt=33,Jrt=60,Yrt=62,Zrt=64,tnt=91,ent=93,rnt=61,nnt=123,_y=63,int=125,oM=124,snt=126,ont=128,aM=65533,h2=42,Fh=43,ant=44,cnt=58,lnt=59,yg=46,Ant=0,unt=8,hnt=11,dnt=14,fnt=31,pnt=127,Nl=-1,cM=48,lM=97,AM=101,gnt=102,mnt=117,ynt=122,uM=65,hM=69,dM=70,_nt=85,vnt=90,jo=function(r){return r>=cM&&r<=57},bnt=function(r){return r>=55296&&r<=57343},pf=function(r){return jo(r)||r>=uM&&r<=dM||r>=lM&&r<=gnt},wnt=function(r){return r>=lM&&r<=ynt},xnt=function(r){return r>=uM&&r<=vnt},Bnt=function(r){return wnt(r)||xnt(r)},Cnt=function(r){return r>=ont},vy=function(r){return r===py||r===Vrt||r===jrt},by=function(r){return Bnt(r)||Cnt(r)||r===Wrt},fM=function(r){return by(r)||jo(r)||r===ha},Ent=function(r){return r>=Ant&&r<=unt||r===hnt||r>=dnt&&r<=fnt||r===pnt},Fu=function(r,t){return r!==pg?!1:t!==py},wy=function(r,t,e){return r===ha?by(t)||Fu(t,e):by(r)?!0:!!(r===pg&&Fu(r,t))},d2=function(r,t,e){return r===Fh||r===ha?jo(t)?!0:t===yg&&jo(e):jo(r===yg?t:r)},Snt=function(r){var t=0,e=1;(r[t]===Fh||r[t]===ha)&&(r[t]===ha&&(e=-1),t++);for(var n=[];jo(r[t]);)n.push(r[t++]);var i=n.length?parseInt(Xi.apply(void 0,n),10):0;r[t]===yg&&t++;for(var s=[];jo(r[t]);)s.push(r[t++]);var a=s.length,o=a?parseInt(Xi.apply(void 0,s),10):0;(r[t]===hM||r[t]===AM)&&t++;var h=1;(r[t]===Fh||r[t]===ha)&&(r[t]===ha&&(h=-1),t++);for(var f=[];jo(r[t]);)f.push(r[t++]);var g=f.length?parseInt(Xi.apply(void 0,f),10):0;return e*(i+o*Math.pow(10,-a))*Math.pow(10,h*g)},Tnt={type:2},Int={type:3},Lnt={type:4},Fnt={type:13},Mnt={type:8},Pnt={type:21},Unt={type:9},Rnt={type:10},Dnt={type:11},Ont={type:12},Nnt={type:14},xy={type:23},knt={type:1},Qnt={type:25},znt={type:24},Hnt={type:26},Gnt={type:27},Vnt={type:28},jnt={type:29},qnt={type:31},f2={type:32},pM=function(){function r(){this._value=[]}return r.prototype.write=function(t){this._value=this._value.concat(sy(t))},r.prototype.read=function(){for(var t=[],e=this.consumeToken();e!==f2;)t.push(e),e=this.consumeToken();return t},r.prototype.consumeToken=function(){var t=this.consumeCodePoint();switch(t){case gy:return this.consumeStringToken(gy);case qrt:var e=this.peekCodePoint(0),n=this.peekCodePoint(1),i=this.peekCodePoint(2);if(fM(e)||Fu(n,i)){var s=wy(e,n,i)?Grt:Hrt,a=this.consumeName();return{type:5,value:a,flags:s}}break;case Krt:if(this.peekCodePoint(0)===gg)return this.consumeCodePoint(),Fnt;break;case my:return this.consumeStringToken(my);case yy:return Tnt;case mg:return Int;case h2:if(this.peekCodePoint(0)===gg)return this.consumeCodePoint(),Nnt;break;case Fh:if(d2(t,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(t),this.consumeNumericToken();break;case ant:return Lnt;case ha:var o=t,h=this.peekCodePoint(0),f=this.peekCodePoint(1);if(d2(o,h,f))return this.reconsumeCodePoint(t),this.consumeNumericToken();if(wy(o,h,f))return this.reconsumeCodePoint(t),this.consumeIdentLikeToken();if(h===ha&&f===Yrt)return this.consumeCodePoint(),this.consumeCodePoint(),znt;break;case yg:if(d2(t,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(t),this.consumeNumericToken();break;case sM:if(this.peekCodePoint(0)===h2)for(this.consumeCodePoint();;){var g=this.consumeCodePoint();if(g===h2&&(g=this.consumeCodePoint(),g===sM))return this.consumeToken();if(g===Nl)return this.consumeToken()}break;case cnt:return Hnt;case lnt:return Gnt;case Jrt:if(this.peekCodePoint(0)===Xrt&&this.peekCodePoint(1)===ha&&this.peekCodePoint(2)===ha)return this.consumeCodePoint(),this.consumeCodePoint(),Qnt;break;case Zrt:var b=this.peekCodePoint(0),C=this.peekCodePoint(1),B=this.peekCodePoint(2);if(wy(b,C,B)){var a=this.consumeName();return{type:7,value:a}}break;case tnt:return Vnt;case pg:if(Fu(t,this.peekCodePoint(0)))return this.reconsumeCodePoint(t),this.consumeIdentLikeToken();break;case ent:return jnt;case rnt:if(this.peekCodePoint(0)===gg)return this.consumeCodePoint(),Mnt;break;case nnt:return Dnt;case int:return Ont;case mnt:case _nt:var R=this.peekCodePoint(0),D=this.peekCodePoint(1);return R===Fh&&(pf(D)||D===_y)&&(this.consumeCodePoint(),this.consumeUnicodeRangeToken()),this.reconsumeCodePoint(t),this.consumeIdentLikeToken();case oM:if(this.peekCodePoint(0)===gg)return this.consumeCodePoint(),Unt;if(this.peekCodePoint(0)===oM)return this.consumeCodePoint(),Pnt;break;case snt:if(this.peekCodePoint(0)===gg)return this.consumeCodePoint(),Rnt;break;case Nl:return f2}return vy(t)?(this.consumeWhiteSpace(),qnt):jo(t)?(this.reconsumeCodePoint(t),this.consumeNumericToken()):by(t)?(this.reconsumeCodePoint(t),this.consumeIdentLikeToken()):{type:6,value:Xi(t)}},r.prototype.consumeCodePoint=function(){var t=this._value.shift();return typeof t>"u"?-1:t},r.prototype.reconsumeCodePoint=function(t){this._value.unshift(t)},r.prototype.peekCodePoint=function(t){return t>=this._value.length?-1:this._value[t]},r.prototype.consumeUnicodeRangeToken=function(){for(var t=[],e=this.consumeCodePoint();pf(e)&&t.length<6;)t.push(e),e=this.consumeCodePoint();for(var n=!1;e===_y&&t.length<6;)t.push(e),e=this.consumeCodePoint(),n=!0;if(n){var i=parseInt(Xi.apply(void 0,t.map(function(h){return h===_y?cM:h})),16),s=parseInt(Xi.apply(void 0,t.map(function(h){return h===_y?dM:h})),16);return{type:30,start:i,end:s}}var a=parseInt(Xi.apply(void 0,t),16);if(this.peekCodePoint(0)===ha&&pf(this.peekCodePoint(1))){this.consumeCodePoint(),e=this.consumeCodePoint();for(var o=[];pf(e)&&o.length<6;)o.push(e),e=this.consumeCodePoint();var s=parseInt(Xi.apply(void 0,o),16);return{type:30,start:a,end:s}}else return{type:30,start:a,end:a}},r.prototype.consumeIdentLikeToken=function(){var t=this.consumeName();return t.toLowerCase()==="url"&&this.peekCodePoint(0)===yy?(this.consumeCodePoint(),this.consumeUrlToken()):this.peekCodePoint(0)===yy?(this.consumeCodePoint(),{type:19,value:t}):{type:20,value:t}},r.prototype.consumeUrlToken=function(){var t=[];if(this.consumeWhiteSpace(),this.peekCodePoint(0)===Nl)return{type:22,value:""};var e=this.peekCodePoint(0);if(e===my||e===gy){var n=this.consumeStringToken(this.consumeCodePoint());return n.type===0&&(this.consumeWhiteSpace(),this.peekCodePoint(0)===Nl||this.peekCodePoint(0)===mg)?(this.consumeCodePoint(),{type:22,value:n.value}):(this.consumeBadUrlRemnants(),xy)}for(;;){var i=this.consumeCodePoint();if(i===Nl||i===mg)return{type:22,value:Xi.apply(void 0,t)};if(vy(i))return this.consumeWhiteSpace(),this.peekCodePoint(0)===Nl||this.peekCodePoint(0)===mg?(this.consumeCodePoint(),{type:22,value:Xi.apply(void 0,t)}):(this.consumeBadUrlRemnants(),xy);if(i===gy||i===my||i===yy||Ent(i))return this.consumeBadUrlRemnants(),xy;if(i===pg)if(Fu(i,this.peekCodePoint(0)))t.push(this.consumeEscapedCodePoint());else return this.consumeBadUrlRemnants(),xy;else t.push(i)}},r.prototype.consumeWhiteSpace=function(){for(;vy(this.peekCodePoint(0));)this.consumeCodePoint()},r.prototype.consumeBadUrlRemnants=function(){for(;;){var t=this.consumeCodePoint();if(t===mg||t===Nl)return;Fu(t,this.peekCodePoint(0))&&this.consumeEscapedCodePoint()}},r.prototype.consumeStringSlice=function(t){for(var e=5e4,n="";t>0;){var i=Math.min(e,t);n+=Xi.apply(void 0,this._value.splice(0,i)),t-=i}return this._value.shift(),n},r.prototype.consumeStringToken=function(t){var e="",n=0;do{var i=this._value[n];if(i===Nl||i===void 0||i===t)return e+=this.consumeStringSlice(n),{type:0,value:e};if(i===py)return this._value.splice(0,n),knt;if(i===pg){var s=this._value[n+1];s!==Nl&&s!==void 0&&(s===py?(e+=this.consumeStringSlice(n),n=-1,this._value.shift()):Fu(i,s)&&(e+=this.consumeStringSlice(n),e+=Xi(this.consumeEscapedCodePoint()),n=-1))}n++}while(!0)},r.prototype.consumeNumber=function(){var t=[],e=fg,n=this.peekCodePoint(0);for((n===Fh||n===ha)&&t.push(this.consumeCodePoint());jo(this.peekCodePoint(0));)t.push(this.consumeCodePoint());n=this.peekCodePoint(0);var i=this.peekCodePoint(1);if(n===yg&&jo(i))for(t.push(this.consumeCodePoint(),this.consumeCodePoint()),e=iM;jo(this.peekCodePoint(0));)t.push(this.consumeCodePoint());n=this.peekCodePoint(0),i=this.peekCodePoint(1);var s=this.peekCodePoint(2);if((n===hM||n===AM)&&((i===Fh||i===ha)&&jo(s)||jo(i)))for(t.push(this.consumeCodePoint(),this.consumeCodePoint()),e=iM;jo(this.peekCodePoint(0));)t.push(this.consumeCodePoint());return[Snt(t),e]},r.prototype.consumeNumericToken=function(){var t=this.consumeNumber(),e=t[0],n=t[1],i=this.peekCodePoint(0),s=this.peekCodePoint(1),a=this.peekCodePoint(2);if(wy(i,s,a)){var o=this.consumeName();return{type:15,number:e,flags:n,unit:o}}return i===$rt?(this.consumeCodePoint(),{type:16,number:e,flags:n}):{type:17,number:e,flags:n}},r.prototype.consumeEscapedCodePoint=function(){var t=this.consumeCodePoint();if(pf(t)){for(var e=Xi(t);pf(this.peekCodePoint(0))&&e.length<6;)e+=Xi(this.consumeCodePoint());vy(this.peekCodePoint(0))&&this.consumeCodePoint();var n=parseInt(e,16);return n===0||bnt(n)||n>1114111?aM:n}return t===Nl?aM:t},r.prototype.consumeName=function(){for(var t="";;){var e=this.consumeCodePoint();if(fM(e))t+=Xi(e);else if(Fu(e,this.peekCodePoint(0)))t+=Xi(this.consumeEscapedCodePoint());else return this.reconsumeCodePoint(e),t}},r}(),gM=function(){function r(t){this._tokens=t}return r.create=function(t){var e=new pM;return e.write(t),new r(e.read())},r.parseValue=function(t){return r.create(t).parseComponentValue()},r.parseValues=function(t){return r.create(t).parseComponentValues()},r.prototype.parseComponentValue=function(){for(var t=this.consumeToken();t.type===31;)t=this.consumeToken();if(t.type===32)throw new SyntaxError("Error parsing CSS component value, unexpected EOF");this.reconsumeToken(t);var e=this.consumeComponentValue();do t=this.consumeToken();while(t.type===31);if(t.type===32)return e;throw new SyntaxError("Error parsing CSS component value, multiple values found when expecting only one")},r.prototype.parseComponentValues=function(){for(var t=[];;){var e=this.consumeComponentValue();if(e.type===32)return t;t.push(e),t.push()}},r.prototype.consumeComponentValue=function(){var t=this.consumeToken();switch(t.type){case 11:case 28:case 2:return this.consumeSimpleBlock(t.type);case 19:return this.consumeFunction(t)}return t},r.prototype.consumeSimpleBlock=function(t){for(var e={type:t,values:[]},n=this.consumeToken();;){if(n.type===32||$nt(n,t))return e;this.reconsumeToken(n),e.values.push(this.consumeComponentValue()),n=this.consumeToken()}},r.prototype.consumeFunction=function(t){for(var e={name:t.value,values:[],type:18};;){var n=this.consumeToken();if(n.type===32||n.type===3)return e;this.reconsumeToken(n),e.values.push(this.consumeComponentValue())}},r.prototype.consumeToken=function(){var t=this._tokens.shift();return typeof t>"u"?f2:t},r.prototype.reconsumeToken=function(t){this._tokens.unshift(t)},r}(),_g=function(r){return r.type===15},gf=function(r){return r.type===17},ii=function(r){return r.type===20},Knt=function(r){return r.type===0},p2=function(r,t){return ii(r)&&r.value===t},mM=function(r){return r.type!==31},mf=function(r){return r.type!==31&&r.type!==4},kl=function(r){var t=[],e=[];return r.forEach(function(n){if(n.type===4){if(e.length===0)throw new Error("Error parsing function args, zero tokens for arg");t.push(e),e=[];return}n.type!==31&&e.push(n)}),e.length&&t.push(e),t},$nt=function(r,t){return t===11&&r.type===12||t===28&&r.type===29?!0:t===2&&r.type===3},Mu=function(r){return r.type===17||r.type===15},hs=function(r){return r.type===16||Mu(r)},yM=function(r){return r.length>1?[r[0],r[1]]:[r[0]]},Ks={type:17,number:0,flags:fg},g2={type:16,number:50,flags:fg},Pu={type:16,number:100,flags:fg},vg=function(r,t,e){var n=r[0],i=r[1];return[mi(n,t),mi(typeof i<"u"?i:n,e)]},mi=function(r,t){if(r.type===16)return r.number/100*t;if(_g(r))switch(r.unit){case"rem":case"em":return 16*r.number;case"px":default:return r.number}return r.number},_M="deg",vM="grad",bM="rad",wM="turn",By={name:"angle",parse:function(r,t){if(t.type===15)switch(t.unit){case _M:return Math.PI*t.number/180;case vM:return Math.PI/200*t.number;case bM:return t.number;case wM:return Math.PI*2*t.number}throw new Error("Unsupported angle type")}},xM=function(r){return r.type===15&&(r.unit===_M||r.unit===vM||r.unit===bM||r.unit===wM)},BM=function(r){var t=r.filter(ii).map(function(e){return e.value}).join(" ");switch(t){case"to bottom right":case"to right bottom":case"left top":case"top left":return[Ks,Ks];case"to top":case"bottom":return ac(0);case"to bottom left":case"to left bottom":case"right top":case"top right":return[Ks,Pu];case"to right":case"left":return ac(90);case"to top left":case"to left top":case"right bottom":case"bottom right":return[Pu,Pu];case"to bottom":case"top":return ac(180);case"to top right":case"to right top":case"left bottom":case"bottom left":return[Pu,Ks];case"to left":case"right":return ac(270)}return 0},ac=function(r){return Math.PI*r/180},Uu={name:"color",parse:function(r,t){if(t.type===18){var e=Wnt[t.name];if(typeof e>"u")throw new Error('Attempting to parse an unsupported color function "'+t.name+'"');return e(r,t.values)}if(t.type===5){if(t.value.length===3){var n=t.value.substring(0,1),i=t.value.substring(1,2),s=t.value.substring(2,3);return Du(parseInt(n+n,16),parseInt(i+i,16),parseInt(s+s,16),1)}if(t.value.length===4){var n=t.value.substring(0,1),i=t.value.substring(1,2),s=t.value.substring(2,3),a=t.value.substring(3,4);return Du(parseInt(n+n,16),parseInt(i+i,16),parseInt(s+s,16),parseInt(a+a,16)/255)}if(t.value.length===6){var n=t.value.substring(0,2),i=t.value.substring(2,4),s=t.value.substring(4,6);return Du(parseInt(n,16),parseInt(i,16),parseInt(s,16),1)}if(t.value.length===8){var n=t.value.substring(0,2),i=t.value.substring(2,4),s=t.value.substring(4,6),a=t.value.substring(6,8);return Du(parseInt(n,16),parseInt(i,16),parseInt(s,16),parseInt(a,16)/255)}}if(t.type===20){var o=MA[t.value.toUpperCase()];if(typeof o<"u")return o}return MA.TRANSPARENT}},Ru=function(r){return(255&r)===0},Ms=function(r){var t=255&r,e=255&r>>8,n=255&r>>16,i=255&r>>24;return t<255?"rgba("+i+","+n+","+e+","+t/255+")":"rgb("+i+","+n+","+e+")"},Du=function(r,t,e,n){return(r<<24|t<<16|e<<8|Math.round(n*255)<<0)>>>0},CM=function(r,t){if(r.type===17)return r.number;if(r.type===16){var e=t===3?1:255;return t===3?r.number/100*e:Math.round(r.number/100*e)}return 0},EM=function(r,t){var e=t.filter(mf);if(e.length===3){var n=e.map(CM),i=n[0],s=n[1],a=n[2];return Du(i,s,a,1)}if(e.length===4){var o=e.map(CM),i=o[0],s=o[1],a=o[2],h=o[3];return Du(i,s,a,h)}return 0};function m2(r,t,e){return e<0&&(e+=1),e>=1&&(e-=1),e<1/6?(t-r)*e*6+r:e<1/2?t:e<2/3?(t-r)*6*(2/3-e)+r:r}var SM=function(r,t){var e=t.filter(mf),n=e[0],i=e[1],s=e[2],a=e[3],o=(n.type===17?ac(n.number):By.parse(r,n))/(Math.PI*2),h=hs(i)?i.number/100:0,f=hs(s)?s.number/100:0,g=typeof a<"u"&&hs(a)?mi(a,1):1;if(h===0)return Du(f*255,f*255,f*255,1);var b=f<=.5?f*(h+1):f+h-f*h,C=f*2-b,B=m2(C,b,o+1/3),R=m2(C,b,o),D=m2(C,b,o-1/3);return Du(B*255,R*255,D*255,g)},Wnt={hsl:SM,hsla:SM,rgb:EM,rgba:EM},bg=function(r,t){return Uu.parse(r,gM.create(t).parseComponentValue())},MA={ALICEBLUE:4042850303,ANTIQUEWHITE:4209760255,AQUA:16777215,AQUAMARINE:2147472639,AZURE:4043309055,BEIGE:4126530815,BISQUE:4293182719,BLACK:255,BLANCHEDALMOND:4293643775,BLUE:65535,BLUEVIOLET:2318131967,BROWN:2771004159,BURLYWOOD:3736635391,CADETBLUE:1604231423,CHARTREUSE:2147418367,CHOCOLATE:3530104575,CORAL:4286533887,CORNFLOWERBLUE:1687547391,CORNSILK:4294499583,CRIMSON:3692313855,CYAN:16777215,DARKBLUE:35839,DARKCYAN:9145343,DARKGOLDENROD:3095837695,DARKGRAY:2846468607,DARKGREEN:6553855,DARKGREY:2846468607,DARKKHAKI:3182914559,DARKMAGENTA:2332068863,DARKOLIVEGREEN:1433087999,DARKORANGE:4287365375,DARKORCHID:2570243327,DARKRED:2332033279,DARKSALMON:3918953215,DARKSEAGREEN:2411499519,DARKSLATEBLUE:1211993087,DARKSLATEGRAY:793726975,DARKSLATEGREY:793726975,DARKTURQUOISE:13554175,DARKVIOLET:2483082239,DEEPPINK:4279538687,DEEPSKYBLUE:12582911,DIMGRAY:1768516095,DIMGREY:1768516095,DODGERBLUE:512819199,FIREBRICK:2988581631,FLORALWHITE:4294635775,FORESTGREEN:579543807,FUCHSIA:4278255615,GAINSBORO:3705462015,GHOSTWHITE:4177068031,GOLD:4292280575,GOLDENROD:3668254975,GRAY:2155905279,GREEN:8388863,GREENYELLOW:2919182335,GREY:2155905279,HONEYDEW:4043305215,HOTPINK:4285117695,INDIANRED:3445382399,INDIGO:1258324735,IVORY:4294963455,KHAKI:4041641215,LAVENDER:3873897215,LAVENDERBLUSH:4293981695,LAWNGREEN:2096890111,LEMONCHIFFON:4294626815,LIGHTBLUE:2916673279,LIGHTCORAL:4034953471,LIGHTCYAN:3774873599,LIGHTGOLDENRODYELLOW:4210742015,LIGHTGRAY:3553874943,LIGHTGREEN:2431553791,LIGHTGREY:3553874943,LIGHTPINK:4290167295,LIGHTSALMON:4288707327,LIGHTSEAGREEN:548580095,LIGHTSKYBLUE:2278488831,LIGHTSLATEGRAY:2005441023,LIGHTSLATEGREY:2005441023,LIGHTSTEELBLUE:2965692159,LIGHTYELLOW:4294959359,LIME:16711935,LIMEGREEN:852308735,LINEN:4210091775,MAGENTA:4278255615,MAROON:2147483903,MEDIUMAQUAMARINE:1724754687,MEDIUMBLUE:52735,MEDIUMORCHID:3126187007,MEDIUMPURPLE:2473647103,MEDIUMSEAGREEN:1018393087,MEDIUMSLATEBLUE:2070474495,MEDIUMSPRINGGREEN:16423679,MEDIUMTURQUOISE:1221709055,MEDIUMVIOLETRED:3340076543,MIDNIGHTBLUE:421097727,MINTCREAM:4127193855,MISTYROSE:4293190143,MOCCASIN:4293178879,NAVAJOWHITE:4292783615,NAVY:33023,OLDLACE:4260751103,OLIVE:2155872511,OLIVEDRAB:1804477439,ORANGE:4289003775,ORANGERED:4282712319,ORCHID:3664828159,PALEGOLDENROD:4008225535,PALEGREEN:2566625535,PALETURQUOISE:2951671551,PALEVIOLETRED:3681588223,PAPAYAWHIP:4293907967,PEACHPUFF:4292524543,PERU:3448061951,PINK:4290825215,PLUM:3718307327,POWDERBLUE:2967529215,PURPLE:2147516671,REBECCAPURPLE:1714657791,RED:4278190335,ROSYBROWN:3163525119,ROYALBLUE:1097458175,SADDLEBROWN:2336560127,SALMON:4202722047,SANDYBROWN:4104413439,SEAGREEN:780883967,SEASHELL:4294307583,SIENNA:2689740287,SILVER:3233857791,SKYBLUE:2278484991,SLATEBLUE:1784335871,SLATEGRAY:1887473919,SLATEGREY:1887473919,SNOW:4294638335,SPRINGGREEN:16744447,STEELBLUE:1182971135,TAN:3535047935,TEAL:8421631,THISTLE:3636451583,TOMATO:4284696575,TRANSPARENT:0,TURQUOISE:1088475391,VIOLET:4001558271,WHEAT:4125012991,WHITE:4294967295,WHITESMOKE:4126537215,YELLOW:4294902015,YELLOWGREEN:2597139199},Xnt={name:"background-clip",initialValue:"border-box",prefix:!1,type:1,parse:function(r,t){return t.map(function(e){if(ii(e))switch(e.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},Jnt={name:"background-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},Cy=function(r,t){var e=Uu.parse(r,t[0]),n=t[1];return n&&hs(n)?{color:e,stop:n}:{color:e,stop:null}},TM=function(r,t){var e=r[0],n=r[r.length-1];e.stop===null&&(e.stop=Ks),n.stop===null&&(n.stop=Pu);for(var i=[],s=0,a=0;a<r.length;a++){var o=r[a].stop;if(o!==null){var h=mi(o,t);h>s?i.push(h):i.push(s),s=h}else i.push(null)}for(var f=null,a=0;a<i.length;a++){var g=i[a];if(g===null)f===null&&(f=a);else if(f!==null){for(var b=a-f,C=i[f-1],B=(g-C)/(b+1),R=1;R<=b;R++)i[f+R-1]=B*R;f=null}}return r.map(function(D,Q){var k=D.color;return{color:k,stop:Math.max(Math.min(1,i[Q]/t),0)}})},Ynt=function(r,t,e){var n=t/2,i=e/2,s=mi(r[0],t)-n,a=i-mi(r[1],e);return(Math.atan2(a,s)+Math.PI*2)%(Math.PI*2)},Znt=function(r,t,e){var n=typeof r=="number"?r:Ynt(r,t,e),i=Math.abs(t*Math.sin(n))+Math.abs(e*Math.cos(n)),s=t/2,a=e/2,o=i/2,h=Math.sin(n-Math.PI/2)*o,f=Math.cos(n-Math.PI/2)*o;return[i,s-f,s+f,a-h,a+h]},Gc=function(r,t){return Math.sqrt(r*r+t*t)},IM=function(r,t,e,n,i){var s=[[0,0],[0,t],[r,0],[r,t]];return s.reduce(function(a,o){var h=o[0],f=o[1],g=Gc(e-h,n-f);return(i?g<a.optimumDistance:g>a.optimumDistance)?{optimumCorner:o,optimumDistance:g}:a},{optimumDistance:i?1/0:-1/0,optimumCorner:null}).optimumCorner},tit=function(r,t,e,n,i){var s=0,a=0;switch(r.size){case 0:r.shape===0?s=a=Math.min(Math.abs(t),Math.abs(t-n),Math.abs(e),Math.abs(e-i)):r.shape===1&&(s=Math.min(Math.abs(t),Math.abs(t-n)),a=Math.min(Math.abs(e),Math.abs(e-i)));break;case 2:if(r.shape===0)s=a=Math.min(Gc(t,e),Gc(t,e-i),Gc(t-n,e),Gc(t-n,e-i));else if(r.shape===1){var o=Math.min(Math.abs(e),Math.abs(e-i))/Math.min(Math.abs(t),Math.abs(t-n)),h=IM(n,i,t,e,!0),f=h[0],g=h[1];s=Gc(f-t,(g-e)/o),a=o*s}break;case 1:r.shape===0?s=a=Math.max(Math.abs(t),Math.abs(t-n),Math.abs(e),Math.abs(e-i)):r.shape===1&&(s=Math.max(Math.abs(t),Math.abs(t-n)),a=Math.max(Math.abs(e),Math.abs(e-i)));break;case 3:if(r.shape===0)s=a=Math.max(Gc(t,e),Gc(t,e-i),Gc(t-n,e),Gc(t-n,e-i));else if(r.shape===1){var o=Math.max(Math.abs(e),Math.abs(e-i))/Math.max(Math.abs(t),Math.abs(t-n)),b=IM(n,i,t,e,!1),f=b[0],g=b[1];s=Gc(f-t,(g-e)/o),a=o*s}break}return Array.isArray(r.size)&&(s=mi(r.size[0],n),a=r.size.length===2?mi(r.size[1],i):s),[s,a]},eit=function(r,t){var e=ac(180),n=[];return kl(t).forEach(function(i,s){if(s===0){var a=i[0];if(a.type===20&&a.value==="to"){e=BM(i);return}else if(xM(a)){e=By.parse(r,a);return}}var o=Cy(r,i);n.push(o)}),{angle:e,stops:n,type:1}},Ey=function(r,t){var e=ac(180),n=[];return kl(t).forEach(function(i,s){if(s===0){var a=i[0];if(a.type===20&&["top","left","right","bottom"].indexOf(a.value)!==-1){e=BM(i);return}else if(xM(a)){e=(By.parse(r,a)+ac(270))%ac(360);return}}var o=Cy(r,i);n.push(o)}),{angle:e,stops:n,type:1}},rit=function(r,t){var e=ac(180),n=[],i=1,s=0,a=3,o=[];return kl(t).forEach(function(h,f){var g=h[0];if(f===0){if(ii(g)&&g.value==="linear"){i=1;return}else if(ii(g)&&g.value==="radial"){i=2;return}}if(g.type===18){if(g.name==="from"){var b=Uu.parse(r,g.values[0]);n.push({stop:Ks,color:b})}else if(g.name==="to"){var b=Uu.parse(r,g.values[0]);n.push({stop:Pu,color:b})}else if(g.name==="color-stop"){var C=g.values.filter(mf);if(C.length===2){var b=Uu.parse(r,C[1]),B=C[0];gf(B)&&n.push({stop:{type:16,number:B.number*100,flags:B.flags},color:b})}}}}),i===1?{angle:(e+ac(180))%ac(360),stops:n,type:i}:{size:a,shape:s,stops:n,position:o,type:i}},LM="closest-side",FM="farthest-side",MM="closest-corner",PM="farthest-corner",UM="circle",RM="ellipse",DM="cover",OM="contain",nit=function(r,t){var e=0,n=3,i=[],s=[];return kl(t).forEach(function(a,o){var h=!0;if(o===0){var f=!1;h=a.reduce(function(b,C){if(f)if(ii(C))switch(C.value){case"center":return s.push(g2),b;case"top":case"left":return s.push(Ks),b;case"right":case"bottom":return s.push(Pu),b}else(hs(C)||Mu(C))&&s.push(C);else if(ii(C))switch(C.value){case UM:return e=0,!1;case RM:return e=1,!1;case"at":return f=!0,!1;case LM:return n=0,!1;case DM:case FM:return n=1,!1;case OM:case MM:return n=2,!1;case PM:return n=3,!1}else if(Mu(C)||hs(C))return Array.isArray(n)||(n=[]),n.push(C),!1;return b},h)}if(h){var g=Cy(r,a);i.push(g)}}),{size:n,shape:e,stops:i,position:s,type:2}},Sy=function(r,t){var e=0,n=3,i=[],s=[];return kl(t).forEach(function(a,o){var h=!0;if(o===0?h=a.reduce(function(g,b){if(ii(b))switch(b.value){case"center":return s.push(g2),!1;case"top":case"left":return s.push(Ks),!1;case"right":case"bottom":return s.push(Pu),!1}else if(hs(b)||Mu(b))return s.push(b),!1;return g},h):o===1&&(h=a.reduce(function(g,b){if(ii(b))switch(b.value){case UM:return e=0,!1;case RM:return e=1,!1;case OM:case LM:return n=0,!1;case FM:return n=1,!1;case MM:return n=2,!1;case DM:case PM:return n=3,!1}else if(Mu(b)||hs(b))return Array.isArray(n)||(n=[]),n.push(b),!1;return g},h)),h){var f=Cy(r,a);i.push(f)}}),{size:n,shape:e,stops:i,position:s,type:2}},iit=function(r){return r.type===1},sit=function(r){return r.type===2},y2={name:"image",parse:function(r,t){if(t.type===22){var e={url:t.value,type:0};return r.cache.addImage(t.value),e}if(t.type===18){var n=NM[t.name];if(typeof n>"u")throw new Error('Attempting to parse an unsupported image function "'+t.name+'"');return n(r,t.values)}throw new Error("Unsupported image type "+t.type)}};function oit(r){return!(r.type===20&&r.value==="none")&&(r.type!==18||!!NM[r.name])}var NM={"linear-gradient":eit,"-moz-linear-gradient":Ey,"-ms-linear-gradient":Ey,"-o-linear-gradient":Ey,"-webkit-linear-gradient":Ey,"radial-gradient":nit,"-moz-radial-gradient":Sy,"-ms-radial-gradient":Sy,"-o-radial-gradient":Sy,"-webkit-radial-gradient":Sy,"-webkit-gradient":rit},ait={name:"background-image",initialValue:"none",type:1,prefix:!1,parse:function(r,t){if(t.length===0)return[];var e=t[0];return e.type===20&&e.value==="none"?[]:t.filter(function(n){return mf(n)&&oit(n)}).map(function(n){return y2.parse(r,n)})}},cit={name:"background-origin",initialValue:"border-box",prefix:!1,type:1,parse:function(r,t){return t.map(function(e){if(ii(e))switch(e.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},lit={name:"background-position",initialValue:"0% 0%",type:1,prefix:!1,parse:function(r,t){return kl(t).map(function(e){return e.filter(hs)}).map(yM)}},Ait={name:"background-repeat",initialValue:"repeat",prefix:!1,type:1,parse:function(r,t){return kl(t).map(function(e){return e.filter(ii).map(function(n){return n.value}).join(" ")}).map(uit)}},uit=function(r){switch(r){case"no-repeat":return 1;case"repeat-x":case"repeat no-repeat":return 2;case"repeat-y":case"no-repeat repeat":return 3;case"repeat":default:return 0}},yf;(function(r){r.AUTO="auto",r.CONTAIN="contain",r.COVER="cover"})(yf||(yf={}));var hit={name:"background-size",initialValue:"0",prefix:!1,type:1,parse:function(r,t){return kl(t).map(function(e){return e.filter(dit)})}},dit=function(r){return ii(r)||hs(r)},Ty=function(r){return{name:"border-"+r+"-color",initialValue:"transparent",prefix:!1,type:3,format:"color"}},fit=Ty("top"),pit=Ty("right"),git=Ty("bottom"),mit=Ty("left"),Iy=function(r){return{name:"border-radius-"+r,initialValue:"0 0",prefix:!1,type:1,parse:function(t,e){return yM(e.filter(hs))}}},yit=Iy("top-left"),_it=Iy("top-right"),vit=Iy("bottom-right"),bit=Iy("bottom-left"),Ly=function(r){return{name:"border-"+r+"-style",initialValue:"solid",prefix:!1,type:2,parse:function(t,e){switch(e){case"none":return 0;case"dashed":return 2;case"dotted":return 3;case"double":return 4}return 1}}},wit=Ly("top"),xit=Ly("right"),Bit=Ly("bottom"),Cit=Ly("left"),Fy=function(r){return{name:"border-"+r+"-width",initialValue:"0",type:0,prefix:!1,parse:function(t,e){return _g(e)?e.number:0}}},Eit=Fy("top"),Sit=Fy("right"),Tit=Fy("bottom"),Iit=Fy("left"),Lit={name:"color",initialValue:"transparent",prefix:!1,type:3,format:"color"},Fit={name:"direction",initialValue:"ltr",prefix:!1,type:2,parse:function(r,t){switch(t){case"rtl":return 1;case"ltr":default:return 0}}},Mit={name:"display",initialValue:"inline-block",prefix:!1,type:1,parse:function(r,t){return t.filter(ii).reduce(function(e,n){return e|Pit(n.value)},0)}},Pit=function(r){switch(r){case"block":case"-webkit-box":return 2;case"inline":return 4;case"run-in":return 8;case"flow":return 16;case"flow-root":return 32;case"table":return 64;case"flex":case"-webkit-flex":return 128;case"grid":case"-ms-grid":return 256;case"ruby":return 512;case"subgrid":return 1024;case"list-item":return 2048;case"table-row-group":return 4096;case"table-header-group":return 8192;case"table-footer-group":return 16384;case"table-row":return 32768;case"table-cell":return 65536;case"table-column-group":return 131072;case"table-column":return 262144;case"table-caption":return 524288;case"ruby-base":return 1048576;case"ruby-text":return 2097152;case"ruby-base-container":return 4194304;case"ruby-text-container":return 8388608;case"contents":return 16777216;case"inline-block":return 33554432;case"inline-list-item":return 67108864;case"inline-table":return 134217728;case"inline-flex":return 268435456;case"inline-grid":return 536870912}return 0},Uit={name:"float",initialValue:"none",prefix:!1,type:2,parse:function(r,t){switch(t){case"left":return 1;case"right":return 2;case"inline-start":return 3;case"inline-end":return 4}return 0}},Rit={name:"letter-spacing",initialValue:"0",prefix:!1,type:0,parse:function(r,t){return t.type===20&&t.value==="normal"?0:t.type===17||t.type===15?t.number:0}},My;(function(r){r.NORMAL="normal",r.STRICT="strict"})(My||(My={}));var Dit={name:"line-break",initialValue:"normal",prefix:!1,type:2,parse:function(r,t){switch(t){case"strict":return My.STRICT;case"normal":default:return My.NORMAL}}},Oit={name:"line-height",initialValue:"normal",prefix:!1,type:4},kM=function(r,t){return ii(r)&&r.value==="normal"?1.2*t:r.type===17?t*r.number:hs(r)?mi(r,t):t},Nit={name:"list-style-image",initialValue:"none",type:0,prefix:!1,parse:function(r,t){return t.type===20&&t.value==="none"?null:y2.parse(r,t)}},kit={name:"list-style-position",initialValue:"outside",prefix:!1,type:2,parse:function(r,t){switch(t){case"inside":return 0;case"outside":default:return 1}}},_2={name:"list-style-type",initialValue:"none",prefix:!1,type:2,parse:function(r,t){switch(t){case"disc":return 0;case"circle":return 1;case"square":return 2;case"decimal":return 3;case"cjk-decimal":return 4;case"decimal-leading-zero":return 5;case"lower-roman":return 6;case"upper-roman":return 7;case"lower-greek":return 8;case"lower-alpha":return 9;case"upper-alpha":return 10;case"arabic-indic":return 11;case"armenian":return 12;case"bengali":return 13;case"cambodian":return 14;case"cjk-earthly-branch":return 15;case"cjk-heavenly-stem":return 16;case"cjk-ideographic":return 17;case"devanagari":return 18;case"ethiopic-numeric":return 19;case"georgian":return 20;case"gujarati":return 21;case"gurmukhi":return 22;case"hebrew":return 22;case"hiragana":return 23;case"hiragana-iroha":return 24;case"japanese-formal":return 25;case"japanese-informal":return 26;case"kannada":return 27;case"katakana":return 28;case"katakana-iroha":return 29;case"khmer":return 30;case"korean-hangul-formal":return 31;case"korean-hanja-formal":return 32;case"korean-hanja-informal":return 33;case"lao":return 34;case"lower-armenian":return 35;case"malayalam":return 36;case"mongolian":return 37;case"myanmar":return 38;case"oriya":return 39;case"persian":return 40;case"simp-chinese-formal":return 41;case"simp-chinese-informal":return 42;case"tamil":return 43;case"telugu":return 44;case"thai":return 45;case"tibetan":return 46;case"trad-chinese-formal":return 47;case"trad-chinese-informal":return 48;case"upper-armenian":return 49;case"disclosure-open":return 50;case"disclosure-closed":return 51;case"none":default:return-1}}},Py=function(r){return{name:"margin-"+r,initialValue:"0",prefix:!1,type:4}},Qit=Py("top"),zit=Py("right"),Hit=Py("bottom"),Git=Py("left"),Vit={name:"overflow",initialValue:"visible",prefix:!1,type:1,parse:function(r,t){return t.filter(ii).map(function(e){switch(e.value){case"hidden":return 1;case"scroll":return 2;case"clip":return 3;case"auto":return 4;case"visible":default:return 0}})}},jit={name:"overflow-wrap",initialValue:"normal",prefix:!1,type:2,parse:function(r,t){switch(t){case"break-word":return"break-word";case"normal":default:return"normal"}}},Uy=function(r){return{name:"padding-"+r,initialValue:"0",prefix:!1,type:3,format:"length-percentage"}},qit=Uy("top"),Kit=Uy("right"),$it=Uy("bottom"),Wit=Uy("left"),Xit={name:"text-align",initialValue:"left",prefix:!1,type:2,parse:function(r,t){switch(t){case"right":return 2;case"center":case"justify":return 1;case"left":default:return 0}}},Jit={name:"position",initialValue:"static",prefix:!1,type:2,parse:function(r,t){switch(t){case"relative":return 1;case"absolute":return 2;case"fixed":return 3;case"sticky":return 4}return 0}},Yit={name:"text-shadow",initialValue:"none",type:1,prefix:!1,parse:function(r,t){return t.length===1&&p2(t[0],"none")?[]:kl(t).map(function(e){for(var n={color:MA.TRANSPARENT,offsetX:Ks,offsetY:Ks,blur:Ks},i=0,s=0;s<e.length;s++){var a=e[s];Mu(a)?(i===0?n.offsetX=a:i===1?n.offsetY=a:n.blur=a,i++):n.color=Uu.parse(r,a)}return n})}},Zit={name:"text-transform",initialValue:"none",prefix:!1,type:2,parse:function(r,t){switch(t){case"uppercase":return 2;case"lowercase":return 1;case"capitalize":return 3}return 0}},tst={name:"transform",initialValue:"none",prefix:!0,type:0,parse:function(r,t){if(t.type===20&&t.value==="none")return null;if(t.type===18){var e=nst[t.name];if(typeof e>"u")throw new Error('Attempting to parse an unsupported transform function "'+t.name+'"');return e(t.values)}return null}},est=function(r){var t=r.filter(function(e){return e.type===17}).map(function(e){return e.number});return t.length===6?t:null},rst=function(r){var t=r.filter(function(h){return h.type===17}).map(function(h){return h.number}),e=t[0],n=t[1];t[2],t[3];var i=t[4],s=t[5];t[6],t[7],t[8],t[9],t[10],t[11];var a=t[12],o=t[13];return t[14],t[15],t.length===16?[e,n,i,s,a,o]:null},nst={matrix:est,matrix3d:rst},QM={type:16,number:50,flags:fg},ist=[QM,QM],sst={name:"transform-origin",initialValue:"50% 50%",prefix:!0,type:1,parse:function(r,t){var e=t.filter(hs);return e.length!==2?ist:[e[0],e[1]]}},ost={name:"visible",initialValue:"none",prefix:!1,type:2,parse:function(r,t){switch(t){case"hidden":return 1;case"collapse":return 2;case"visible":default:return 0}}},wg;(function(r){r.NORMAL="normal",r.BREAK_ALL="break-all",r.KEEP_ALL="keep-all"})(wg||(wg={}));for(var ast={name:"word-break",initialValue:"normal",prefix:!1,type:2,parse:function(r,t){switch(t){case"break-all":return wg.BREAK_ALL;case"keep-all":return wg.KEEP_ALL;case"normal":default:return wg.NORMAL}}},cst={name:"z-index",initialValue:"auto",prefix:!1,type:0,parse:function(r,t){if(t.type===20)return{auto:!0,order:0};if(gf(t))return{auto:!1,order:t.number};throw new Error("Invalid z-index number parsed")}},zM={name:"time",parse:function(r,t){if(t.type===15)switch(t.unit.toLowerCase()){case"s":return 1e3*t.number;case"ms":return t.number}throw new Error("Unsupported time type")}},lst={name:"opacity",initialValue:"1",type:0,prefix:!1,parse:function(r,t){return gf(t)?t.number:1}},Ast={name:"text-decoration-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},ust={name:"text-decoration-line",initialValue:"none",prefix:!1,type:1,parse:function(r,t){return t.filter(ii).map(function(e){switch(e.value){case"underline":return 1;case"overline":return 2;case"line-through":return 3;case"none":return 4}return 0}).filter(function(e){return e!==0})}},hst={name:"font-family",initialValue:"",prefix:!1,type:1,parse:function(r,t){var e=[],n=[];return t.forEach(function(i){switch(i.type){case 20:case 0:e.push(i.value);break;case 17:e.push(i.number.toString());break;case 4:n.push(e.join(" ")),e.length=0;break}}),e.length&&n.push(e.join(" ")),n.map(function(i){return i.indexOf(" ")===-1?i:"'"+i+"'"})}},dst={name:"font-size",initialValue:"0",prefix:!1,type:3,format:"length"},fst={name:"font-weight",initialValue:"normal",type:0,prefix:!1,parse:function(r,t){if(gf(t))return t.number;if(ii(t))switch(t.value){case"bold":return 700;case"normal":default:return 400}return 400}},pst={name:"font-variant",initialValue:"none",type:1,prefix:!1,parse:function(r,t){return t.filter(ii).map(function(e){return e.value})}},gst={name:"font-style",initialValue:"normal",prefix:!1,type:2,parse:function(r,t){switch(t){case"oblique":return"oblique";case"italic":return"italic";case"normal":default:return"normal"}}},xs=function(r,t){return(r&t)!==0},mst={name:"content",initialValue:"none",type:1,prefix:!1,parse:function(r,t){if(t.length===0)return[];var e=t[0];return e.type===20&&e.value==="none"?[]:t}},yst={name:"counter-increment",initialValue:"none",prefix:!0,type:1,parse:function(r,t){if(t.length===0)return null;var e=t[0];if(e.type===20&&e.value==="none")return null;for(var n=[],i=t.filter(mM),s=0;s<i.length;s++){var a=i[s],o=i[s+1];if(a.type===20){var h=o&&gf(o)?o.number:1;n.push({counter:a.value,increment:h})}}return n}},_st={name:"counter-reset",initialValue:"none",prefix:!0,type:1,parse:function(r,t){if(t.length===0)return[];for(var e=[],n=t.filter(mM),i=0;i<n.length;i++){var s=n[i],a=n[i+1];if(ii(s)&&s.value!=="none"){var o=a&&gf(a)?a.number:0;e.push({counter:s.value,reset:o})}}return e}},vst={name:"duration",initialValue:"0s",prefix:!1,type:1,parse:function(r,t){return t.filter(_g).map(function(e){return zM.parse(r,e)})}},bst={name:"quotes",initialValue:"none",prefix:!0,type:1,parse:function(r,t){if(t.length===0)return null;var e=t[0];if(e.type===20&&e.value==="none")return null;var n=[],i=t.filter(Knt);if(i.length%2!==0)return null;for(var s=0;s<i.length;s+=2){var a=i[s].value,o=i[s+1].value;n.push({open:a,close:o})}return n}},HM=function(r,t,e){if(!r)return"";var n=r[Math.min(t,r.length-1)];return n?e?n.open:n.close:""},wst={name:"box-shadow",initialValue:"none",type:1,prefix:!1,parse:function(r,t){return t.length===1&&p2(t[0],"none")?[]:kl(t).map(function(e){for(var n={color:255,offsetX:Ks,offsetY:Ks,blur:Ks,spread:Ks,inset:!1},i=0,s=0;s<e.length;s++){var a=e[s];p2(a,"inset")?n.inset=!0:Mu(a)?(i===0?n.offsetX=a:i===1?n.offsetY=a:i===2?n.blur=a:n.spread=a,i++):n.color=Uu.parse(r,a)}return n})}},xst={name:"paint-order",initialValue:"normal",prefix:!1,type:1,parse:function(r,t){var e=[0,1,2],n=[];return t.filter(ii).forEach(function(i){switch(i.value){case"stroke":n.push(1);break;case"fill":n.push(0);break;case"markers":n.push(2);break}}),e.forEach(function(i){n.indexOf(i)===-1&&n.push(i)}),n}},Bst={name:"-webkit-text-stroke-color",initialValue:"currentcolor",prefix:!1,type:3,format:"color"},Cst={name:"-webkit-text-stroke-width",initialValue:"0",type:0,prefix:!1,parse:function(r,t){return _g(t)?t.number:0}},Est=function(){function r(t,e){var n,i;this.animationDuration=yr(t,vst,e.animationDuration),this.backgroundClip=yr(t,Xnt,e.backgroundClip),this.backgroundColor=yr(t,Jnt,e.backgroundColor),this.backgroundImage=yr(t,ait,e.backgroundImage),this.backgroundOrigin=yr(t,cit,e.backgroundOrigin),this.backgroundPosition=yr(t,lit,e.backgroundPosition),this.backgroundRepeat=yr(t,Ait,e.backgroundRepeat),this.backgroundSize=yr(t,hit,e.backgroundSize),this.borderTopColor=yr(t,fit,e.borderTopColor),this.borderRightColor=yr(t,pit,e.borderRightColor),this.borderBottomColor=yr(t,git,e.borderBottomColor),this.borderLeftColor=yr(t,mit,e.borderLeftColor),this.borderTopLeftRadius=yr(t,yit,e.borderTopLeftRadius),this.borderTopRightRadius=yr(t,_it,e.borderTopRightRadius),this.borderBottomRightRadius=yr(t,vit,e.borderBottomRightRadius),this.borderBottomLeftRadius=yr(t,bit,e.borderBottomLeftRadius),this.borderTopStyle=yr(t,wit,e.borderTopStyle),this.borderRightStyle=yr(t,xit,e.borderRightStyle),this.borderBottomStyle=yr(t,Bit,e.borderBottomStyle),this.borderLeftStyle=yr(t,Cit,e.borderLeftStyle),this.borderTopWidth=yr(t,Eit,e.borderTopWidth),this.borderRightWidth=yr(t,Sit,e.borderRightWidth),this.borderBottomWidth=yr(t,Tit,e.borderBottomWidth),this.borderLeftWidth=yr(t,Iit,e.borderLeftWidth),this.boxShadow=yr(t,wst,e.boxShadow),this.color=yr(t,Lit,e.color),this.direction=yr(t,Fit,e.direction),this.display=yr(t,Mit,e.display),this.float=yr(t,Uit,e.cssFloat),this.fontFamily=yr(t,hst,e.fontFamily),this.fontSize=yr(t,dst,e.fontSize),this.fontStyle=yr(t,gst,e.fontStyle),this.fontVariant=yr(t,pst,e.fontVariant),this.fontWeight=yr(t,fst,e.fontWeight),this.letterSpacing=yr(t,Rit,e.letterSpacing),this.lineBreak=yr(t,Dit,e.lineBreak),this.lineHeight=yr(t,Oit,e.lineHeight),this.listStyleImage=yr(t,Nit,e.listStyleImage),this.listStylePosition=yr(t,kit,e.listStylePosition),this.listStyleType=yr(t,_2,e.listStyleType),this.marginTop=yr(t,Qit,e.marginTop),this.marginRight=yr(t,zit,e.marginRight),this.marginBottom=yr(t,Hit,e.marginBottom),this.marginLeft=yr(t,Git,e.marginLeft),this.opacity=yr(t,lst,e.opacity);var s=yr(t,Vit,e.overflow);this.overflowX=s[0],this.overflowY=s[s.length>1?1:0],this.overflowWrap=yr(t,jit,e.overflowWrap),this.paddingTop=yr(t,qit,e.paddingTop),this.paddingRight=yr(t,Kit,e.paddingRight),this.paddingBottom=yr(t,$it,e.paddingBottom),this.paddingLeft=yr(t,Wit,e.paddingLeft),this.paintOrder=yr(t,xst,e.paintOrder),this.position=yr(t,Jit,e.position),this.textAlign=yr(t,Xit,e.textAlign),this.textDecorationColor=yr(t,Ast,(n=e.textDecorationColor)!==null&&n!==void 0?n:e.color),this.textDecorationLine=yr(t,ust,(i=e.textDecorationLine)!==null&&i!==void 0?i:e.textDecoration),this.textShadow=yr(t,Yit,e.textShadow),this.textTransform=yr(t,Zit,e.textTransform),this.transform=yr(t,tst,e.transform),this.transformOrigin=yr(t,sst,e.transformOrigin),this.visibility=yr(t,ost,e.visibility),this.webkitTextStrokeColor=yr(t,Bst,e.webkitTextStrokeColor),this.webkitTextStrokeWidth=yr(t,Cst,e.webkitTextStrokeWidth),this.wordBreak=yr(t,ast,e.wordBreak),this.zIndex=yr(t,cst,e.zIndex)}return r.prototype.isVisible=function(){return this.display>0&&this.opacity>0&&this.visibility===0},r.prototype.isTransparent=function(){return Ru(this.backgroundColor)},r.prototype.isTransformed=function(){return this.transform!==null},r.prototype.isPositioned=function(){return this.position!==0},r.prototype.isPositionedWithZIndex=function(){return this.isPositioned()&&!this.zIndex.auto},r.prototype.isFloating=function(){return this.float!==0},r.prototype.isInlineLevel=function(){return xs(this.display,4)||xs(this.display,33554432)||xs(this.display,268435456)||xs(this.display,536870912)||xs(this.display,67108864)||xs(this.display,134217728)},r}(),Sst=function(){function r(t,e){this.content=yr(t,mst,e.content),this.quotes=yr(t,bst,e.quotes)}return r}(),GM=function(){function r(t,e){this.counterIncrement=yr(t,yst,e.counterIncrement),this.counterReset=yr(t,_st,e.counterReset)}return r}(),yr=function(r,t,e){var n=new pM,i=e!==null&&typeof e<"u"?e.toString():t.initialValue;n.write(i);var s=new gM(n.read());switch(t.type){case 2:var a=s.parseComponentValue();return t.parse(r,ii(a)?a.value:t.initialValue);case 0:return t.parse(r,s.parseComponentValue());case 1:return t.parse(r,s.parseComponentValues());case 4:return s.parseComponentValue();case 3:switch(t.format){case"angle":return By.parse(r,s.parseComponentValue());case"color":return Uu.parse(r,s.parseComponentValue());case"image":return y2.parse(r,s.parseComponentValue());case"length":var o=s.parseComponentValue();return Mu(o)?o:Ks;case"length-percentage":var h=s.parseComponentValue();return hs(h)?h:Ks;case"time":return zM.parse(r,s.parseComponentValue())}break}},Tst="data-html2canvas-debug",Ist=function(r){var t=r.getAttribute(Tst);switch(t){case"all":return 1;case"clone":return 2;case"parse":return 3;case"render":return 4;default:return 0}},v2=function(r,t){var e=Ist(r);return e===1||t===e},Ql=function(){function r(t,e){if(this.context=t,this.textNodes=[],this.elements=[],this.flags=0,v2(e,3))debugger;this.styles=new Est(t,window.getComputedStyle(e,null)),P2(e)&&(this.styles.animationDuration.some(function(n){return n>0})&&(e.style.animationDuration="0s"),this.styles.transform!==null&&(e.style.transform="none")),this.bounds=iy(this.context,e),v2(e,4)&&(this.flags|=16)}return r}(),Lst="AAAAAAAAAAAAEA4AGBkAAFAaAAACAAAAAAAIABAAGAAwADgACAAQAAgAEAAIABAACAAQAAgAEAAIABAACAAQAAgAEAAIABAAQABIAEQATAAIABAACAAQAAgAEAAIABAAVABcAAgAEAAIABAACAAQAGAAaABwAHgAgACIAI4AlgAIABAAmwCjAKgAsAC2AL4AvQDFAMoA0gBPAVYBWgEIAAgACACMANoAYgFkAWwBdAF8AX0BhQGNAZUBlgGeAaMBlQGWAasBswF8AbsBwwF0AcsBYwHTAQgA2wG/AOMBdAF8AekB8QF0AfkB+wHiAHQBfAEIAAMC5gQIAAsCEgIIAAgAFgIeAggAIgIpAggAMQI5AkACygEIAAgASAJQAlgCYAIIAAgACAAKBQoFCgUTBRMFGQUrBSsFCAAIAAgACAAIAAgACAAIAAgACABdAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABoAmgCrwGvAQgAbgJ2AggAHgEIAAgACADnAXsCCAAIAAgAgwIIAAgACAAIAAgACACKAggAkQKZAggAPADJAAgAoQKkAqwCsgK6AsICCADJAggA0AIIAAgACAAIANYC3gIIAAgACAAIAAgACABAAOYCCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAkASoB+QIEAAgACAA8AEMCCABCBQgACABJBVAFCAAIAAgACAAIAAgACAAIAAgACABTBVoFCAAIAFoFCABfBWUFCAAIAAgACAAIAAgAbQUIAAgACAAIAAgACABzBXsFfQWFBYoFigWKBZEFigWKBYoFmAWfBaYFrgWxBbkFCAAIAAgACAAIAAgACAAIAAgACAAIAMEFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAMgFCADQBQgACAAIAAgACAAIAAgACAAIAAgACAAIAO4CCAAIAAgAiQAIAAgACABAAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAD0AggACAD8AggACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIANYFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAMDvwAIAAgAJAIIAAgACAAIAAgACAAIAAgACwMTAwgACAB9BOsEGwMjAwgAKwMyAwsFYgE3A/MEPwMIAEUDTQNRAwgAWQOsAGEDCAAIAAgACAAIAAgACABpAzQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFIQUoBSwFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABtAwgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABMAEwACAAIAAgACAAIABgACAAIAAgACAC/AAgACAAyAQgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACAAIAAwAAgACAAIAAgACAAIAAgACAAIAAAARABIAAgACAAIABQASAAIAAgAIABwAEAAjgCIABsAqAC2AL0AigDQAtwC+IJIQqVAZUBWQqVAZUBlQGVAZUBlQGrC5UBlQGVAZUBlQGVAZUBlQGVAXsKlQGVAbAK6wsrDGUMpQzlDJUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAfAKAAuZA64AtwCJALoC6ADwAAgAuACgA/oEpgO6AqsD+AAIAAgAswMIAAgACAAIAIkAuwP5AfsBwwPLAwgACAAIAAgACADRA9kDCAAIAOED6QMIAAgACAAIAAgACADuA/YDCAAIAP4DyQAIAAgABgQIAAgAXQAOBAgACAAIAAgACAAIABMECAAIAAgACAAIAAgACAD8AAQBCAAIAAgAGgQiBCoECAExBAgAEAEIAAgACAAIAAgACAAIAAgACAAIAAgACAA4BAgACABABEYECAAIAAgATAQYAQgAVAQIAAgACAAIAAgACAAIAAgACAAIAFoECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAOQEIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAB+BAcACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAEABhgSMBAgACAAIAAgAlAQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAwAEAAQABAADAAMAAwADAAQABAAEAAQABAAEAAQABHATAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAdQMIAAgACAAIAAgACAAIAMkACAAIAAgAfQMIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACFA4kDCAAIAAgACAAIAOcBCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAIcDCAAIAAgACAAIAAgACAAIAAgACAAIAJEDCAAIAAgACADFAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABgBAgAZgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAbAQCBXIECAAIAHkECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABAAJwEQACjBKoEsgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAC6BMIECAAIAAgACAAIAAgACABmBAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAxwQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAGYECAAIAAgAzgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBd0FXwUIAOIF6gXxBYoF3gT5BQAGCAaKBYoFigWKBYoFigWKBYoFigWKBYoFigXWBIoFigWKBYoFigWKBYoFigWKBYsFEAaKBYoFigWKBYoFigWKBRQGCACKBYoFigWKBQgACAAIANEECAAIABgGigUgBggAJgYIAC4GMwaKBYoF0wQ3Bj4GigWKBYoFigWKBYoFigWKBYoFigWKBYoFigUIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWLBf///////wQABAAEAAQABAAEAAQABAAEAAQAAwAEAAQAAgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAQADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUAAAAFAAUAAAAFAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAQAAAAUABQAFAAUABQAFAAAAAAAFAAUAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAFAAUAAQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAAABwAHAAcAAAAHAAcABwAFAAEAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAcABwAFAAUAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAQABAAAAAAAAAAAAAAAFAAUABQAFAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAHAAcAAAAHAAcAAAAAAAUABQAHAAUAAQAHAAEABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwABAAUABQAFAAUAAAAAAAAAAAAAAAEAAQABAAEAAQABAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABQANAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAABQAHAAUABQAFAAAAAAAAAAcABQAFAAUABQAFAAQABAAEAAQABAAEAAQABAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUAAAAFAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAUAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAcABwAFAAcABwAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUABwAHAAUABQAFAAUAAAAAAAcABwAAAAAABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAAAAAAAAAAABQAFAAAAAAAFAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAFAAUABQAFAAUAAAAFAAUABwAAAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABwAFAAUABQAFAAAAAAAHAAcAAAAAAAcABwAFAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAAAAAAAAAHAAcABwAAAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAUABQAFAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAHAAcABQAHAAcAAAAFAAcABwAAAAcABwAFAAUAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAFAAcABwAFAAUABQAAAAUAAAAHAAcABwAHAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAHAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUAAAAFAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAUAAAAFAAUAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABwAFAAUABQAFAAUABQAAAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABQAFAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAFAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAHAAUABQAFAAUABQAFAAUABwAHAAcABwAHAAcABwAHAAUABwAHAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABwAHAAcABwAFAAUABwAHAAcAAAAAAAAAAAAHAAcABQAHAAcABwAHAAcABwAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAUABQAFAAUABQAFAAUAAAAFAAAABQAAAAAABQAFAAUABQAFAAUABQAFAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAUABQAFAAUABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABwAFAAcABwAHAAcABwAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAUABQAFAAUABwAHAAUABQAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABQAFAAcABwAHAAUABwAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAcABQAFAAUABQAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAAAAAABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAAAAAAAAAFAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAUABQAHAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAFAAUABQAFAAcABwAFAAUABwAHAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAcABwAFAAUABwAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABQAAAAAABQAFAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAcABwAAAAAAAAAAAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAcABwAFAAcABwAAAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAFAAUABQAAAAUABQAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABwAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAHAAcABQAHAAUABQAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAAABwAHAAAAAAAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAFAAUABwAFAAcABwAFAAcABQAFAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAAAAAABwAHAAcABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAFAAcABwAFAAUABQAFAAUABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAUABQAFAAcABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABQAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAAAAAAFAAUABwAHAAcABwAFAAAAAAAAAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAHAAUABQAFAAUABQAFAAUABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAABQAAAAUABQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAHAAcAAAAFAAUAAAAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABQAFAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAABQAFAAUABQAFAAUABQAAAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAFAAUABQAFAAUADgAOAA4ADgAOAA4ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAMAAwADAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkAAAAAAAAAAAAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAAAAAAAAAAAAsADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwACwAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAADgAOAA4AAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAAAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4AAAAOAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAAAAAAAAAAAA4AAAAOAAAAAAAAAAAADgAOAA4AAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAA=",VM="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",xg=typeof Uint8Array>"u"?[]:new Uint8Array(256),Ry=0;Ry<VM.length;Ry++)xg[VM.charCodeAt(Ry)]=Ry;for(var Fst=function(r){var t=r.length*.75,e=r.length,n,i=0,s,a,o,h;r[r.length-1]==="="&&(t--,r[r.length-2]==="="&&t--);var f=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"&&typeof Uint8Array.prototype.slice<"u"?new ArrayBuffer(t):new Array(t),g=Array.isArray(f)?f:new Uint8Array(f);for(n=0;n<e;n+=4)s=xg[r.charCodeAt(n)],a=xg[r.charCodeAt(n+1)],o=xg[r.charCodeAt(n+2)],h=xg[r.charCodeAt(n+3)],g[i++]=s<<2|a>>4,g[i++]=(a&15)<<4|o>>2,g[i++]=(o&3)<<6|h&63;return f},Mst=function(r){for(var t=r.length,e=[],n=0;n<t;n+=2)e.push(r[n+1]<<8|r[n]);return e},Pst=function(r){for(var t=r.length,e=[],n=0;n<t;n+=4)e.push(r[n+3]<<24|r[n+2]<<16|r[n+1]<<8|r[n]);return e},Mh=5,b2=11,w2=2,Ust=b2-Mh,jM=65536>>Mh,Rst=1<<Mh,x2=Rst-1,Dst=1024>>Mh,Ost=jM+Dst,Nst=Ost,kst=32,Qst=Nst+kst,zst=65536>>b2,Hst=1<<Ust,Gst=Hst-1,qM=function(r,t,e){return r.slice?r.slice(t,e):new Uint16Array(Array.prototype.slice.call(r,t,e))},Vst=function(r,t,e){return r.slice?r.slice(t,e):new Uint32Array(Array.prototype.slice.call(r,t,e))},jst=function(r,t){var e=Fst(r),n=Array.isArray(e)?Pst(e):new Uint32Array(e),i=Array.isArray(e)?Mst(e):new Uint16Array(e),s=24,a=qM(i,s/2,n[4]/2),o=n[5]===2?qM(i,(s+n[4])/2):Vst(n,Math.ceil((s+n[4])/4));return new qst(n[0],n[1],n[2],n[3],a,o)},qst=function(){function r(t,e,n,i,s,a){this.initialValue=t,this.errorValue=e,this.highStart=n,this.highValueIndex=i,this.index=s,this.data=a}return r.prototype.get=function(t){var e;if(t>=0){if(t<55296||t>56319&&t<=65535)return e=this.index[t>>Mh],e=(e<<w2)+(t&x2),this.data[e];if(t<=65535)return e=this.index[jM+(t-55296>>Mh)],e=(e<<w2)+(t&x2),this.data[e];if(t<this.highStart)return e=Qst-zst+(t>>b2),e=this.index[e],e+=t>>Mh&Gst,e=this.index[e],e=(e<<w2)+(t&x2),this.data[e];if(t<=1114111)return this.data[this.highValueIndex]}return this.errorValue},r}(),KM="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Kst=typeof Uint8Array>"u"?[]:new Uint8Array(256),Dy=0;Dy<KM.length;Dy++)Kst[KM.charCodeAt(Dy)]=Dy;var $st=1,B2=2,C2=3,$M=4,WM=5,Wst=7,XM=8,E2=9,S2=10,JM=11,YM=12,ZM=13,t4=14,T2=15,Xst=function(r){for(var t=[],e=0,n=r.length;e<n;){var i=r.charCodeAt(e++);if(i>=55296&&i<=56319&&e<n){var s=r.charCodeAt(e++);(s&64512)===56320?t.push(((i&1023)<<10)+(s&1023)+65536):(t.push(i),e--)}else t.push(i)}return t},Jst=function(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];if(String.fromCodePoint)return String.fromCodePoint.apply(String,r);var e=r.length;if(!e)return"";for(var n=[],i=-1,s="";++i<e;){var a=r[i];a<=65535?n.push(a):(a-=65536,n.push((a>>10)+55296,a%1024+56320)),(i+1===e||n.length>16384)&&(s+=String.fromCharCode.apply(String,n),n.length=0)}return s},Yst=jst(Lst),Ph="",e4="",Zst=function(r){return Yst.get(r)},tot=function(r,t,e){var n=e-2,i=t[n],s=t[e-1],a=t[e];if(s===B2&&a===C2)return Ph;if(s===B2||s===C2||s===$M||a===B2||a===C2||a===$M)return e4;if(s===XM&&[XM,E2,JM,YM].indexOf(a)!==-1||(s===JM||s===E2)&&(a===E2||a===S2)||(s===YM||s===S2)&&a===S2||a===ZM||a===WM||a===Wst||s===$st)return Ph;if(s===ZM&&a===t4){for(;i===WM;)i=t[--n];if(i===t4)return Ph}if(s===T2&&a===T2){for(var o=0;i===T2;)o++,i=t[--n];if(o%2===0)return Ph}return e4},eot=function(r){var t=Xst(r),e=t.length,n=0,i=0,s=t.map(Zst);return{next:function(){if(n>=e)return{done:!0,value:null};for(var a=Ph;n<e&&(a=tot(t,s,++n))===Ph;);if(a!==Ph||n===e){var o=Jst.apply(null,t.slice(i,n));return i=n,{value:o,done:!1}}return{done:!0,value:null}}}},rot=function(r){for(var t=eot(r),e=[],n;!(n=t.next()).done;)n.value&&e.push(n.value.slice());return e},not=function(r){var t=123;if(r.createRange){var e=r.createRange();if(e.getBoundingClientRect){var n=r.createElement("boundtest");n.style.height=t+"px",n.style.display="block",r.body.appendChild(n),e.selectNode(n);var i=e.getBoundingClientRect(),s=Math.round(i.height);if(r.body.removeChild(n),s===t)return!0}}return!1},iot=function(r){var t=r.createElement("boundtest");t.style.width="50px",t.style.display="block",t.style.fontSize="12px",t.style.letterSpacing="0px",t.style.wordSpacing="0px",r.body.appendChild(t);var e=r.createRange();t.innerHTML=typeof"".repeat=="function"?"&#128104;".repeat(10):"";var n=t.firstChild,i=sy(n.data).map(function(h){return Xi(h)}),s=0,a={},o=i.every(function(h,f){e.setStart(n,s),e.setEnd(n,s+h.length);var g=e.getBoundingClientRect();s+=h.length;var b=g.x>a.x||g.y>a.y;return a=g,f===0?!0:b});return r.body.removeChild(t),o},sot=function(){return typeof new Image().crossOrigin<"u"},oot=function(){return typeof new XMLHttpRequest().responseType=="string"},aot=function(r){var t=new Image,e=r.createElement("canvas"),n=e.getContext("2d");if(!n)return!1;t.src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>";try{n.drawImage(t,0,0),e.toDataURL()}catch{return!1}return!0},r4=function(r){return r[0]===0&&r[1]===255&&r[2]===0&&r[3]===255},cot=function(r){var t=r.createElement("canvas"),e=100;t.width=e,t.height=e;var n=t.getContext("2d");if(!n)return Promise.reject(!1);n.fillStyle="rgb(0, 255, 0)",n.fillRect(0,0,e,e);var i=new Image,s=t.toDataURL();i.src=s;var a=I2(e,e,0,0,i);return n.fillStyle="red",n.fillRect(0,0,e,e),n4(a).then(function(o){n.drawImage(o,0,0);var h=n.getImageData(0,0,e,e).data;n.fillStyle="red",n.fillRect(0,0,e,e);var f=r.createElement("div");return f.style.backgroundImage="url("+s+")",f.style.height=e+"px",r4(h)?n4(I2(e,e,0,0,f)):Promise.reject(!1)}).then(function(o){return n.drawImage(o,0,0),r4(n.getImageData(0,0,e,e).data)}).catch(function(){return!1})},I2=function(r,t,e,n,i){var s="http://www.w3.org/2000/svg",a=document.createElementNS(s,"svg"),o=document.createElementNS(s,"foreignObject");return a.setAttributeNS(null,"width",r.toString()),a.setAttributeNS(null,"height",t.toString()),o.setAttributeNS(null,"width","100%"),o.setAttributeNS(null,"height","100%"),o.setAttributeNS(null,"x",e.toString()),o.setAttributeNS(null,"y",n.toString()),o.setAttributeNS(null,"externalResourcesRequired","true"),a.appendChild(o),o.appendChild(i),a},n4=function(r){return new Promise(function(t,e){var n=new Image;n.onload=function(){return t(n)},n.onerror=e,n.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(new XMLSerializer().serializeToString(r))})},$s={get SUPPORT_RANGE_BOUNDS(){var r=not(document);return Object.defineProperty($s,"SUPPORT_RANGE_BOUNDS",{value:r}),r},get SUPPORT_WORD_BREAKING(){var r=$s.SUPPORT_RANGE_BOUNDS&&iot(document);return Object.defineProperty($s,"SUPPORT_WORD_BREAKING",{value:r}),r},get SUPPORT_SVG_DRAWING(){var r=aot(document);return Object.defineProperty($s,"SUPPORT_SVG_DRAWING",{value:r}),r},get SUPPORT_FOREIGNOBJECT_DRAWING(){var r=typeof Array.from=="function"&&typeof window.fetch=="function"?cot(document):Promise.resolve(!1);return Object.defineProperty($s,"SUPPORT_FOREIGNOBJECT_DRAWING",{value:r}),r},get SUPPORT_CORS_IMAGES(){var r=sot();return Object.defineProperty($s,"SUPPORT_CORS_IMAGES",{value:r}),r},get SUPPORT_RESPONSE_TYPE(){var r=oot();return Object.defineProperty($s,"SUPPORT_RESPONSE_TYPE",{value:r}),r},get SUPPORT_CORS_XHR(){var r="withCredentials"in new XMLHttpRequest;return Object.defineProperty($s,"SUPPORT_CORS_XHR",{value:r}),r},get SUPPORT_NATIVE_TEXT_SEGMENTATION(){var r=!!(typeof Intl<"u"&&Intl.Segmenter);return Object.defineProperty($s,"SUPPORT_NATIVE_TEXT_SEGMENTATION",{value:r}),r}},Bg=function(){function r(t,e){this.text=t,this.bounds=e}return r}(),lot=function(r,t,e,n){var i=hot(t,e),s=[],a=0;return i.forEach(function(o){if(e.textDecorationLine.length||o.trim().length>0)if($s.SUPPORT_RANGE_BOUNDS){var h=i4(n,a,o.length).getClientRects();if(h.length>1){var f=L2(o),g=0;f.forEach(function(C){s.push(new Bg(C,LA.fromDOMRectList(r,i4(n,g+a,C.length).getClientRects()))),g+=C.length})}else s.push(new Bg(o,LA.fromDOMRectList(r,h)))}else{var b=n.splitText(o.length);s.push(new Bg(o,Aot(r,n))),n=b}else $s.SUPPORT_RANGE_BOUNDS||(n=n.splitText(o.length));a+=o.length}),s},Aot=function(r,t){var e=t.ownerDocument;if(e){var n=e.createElement("html2canvaswrapper");n.appendChild(t.cloneNode(!0));var i=t.parentNode;if(i){i.replaceChild(n,t);var s=iy(r,n);return n.firstChild&&i.replaceChild(n.firstChild,n),s}}return LA.EMPTY},i4=function(r,t,e){var n=r.ownerDocument;if(!n)throw new Error("Node has no owner document");var i=n.createRange();return i.setStart(r,t),i.setEnd(r,t+e),i},L2=function(r){if($s.SUPPORT_NATIVE_TEXT_SEGMENTATION){var t=new Intl.Segmenter(void 0,{granularity:"grapheme"});return Array.from(t.segment(r)).map(function(e){return e.segment})}return rot(r)},uot=function(r,t){if($s.SUPPORT_NATIVE_TEXT_SEGMENTATION){var e=new Intl.Segmenter(void 0,{granularity:"word"});return Array.from(e.segment(r)).map(function(n){return n.segment})}return fot(r,t)},hot=function(r,t){return t.letterSpacing!==0?L2(r):uot(r,t)},dot=[32,160,4961,65792,65793,4153,4241],fot=function(r,t){for(var e=zrt(r,{lineBreak:t.lineBreak,wordBreak:t.overflowWrap==="break-word"?"break-word":t.wordBreak}),n=[],i,s=function(){if(i.value){var a=i.value.slice(),o=sy(a),h="";o.forEach(function(f){dot.indexOf(f)===-1?h+=Xi(f):(h.length&&n.push(h),n.push(Xi(f)),h="")}),h.length&&n.push(h)}};!(i=e.next()).done;)s();return n},pot=function(){function r(t,e,n){this.text=got(e.data,n.textTransform),this.textBounds=lot(t,this.text,n,e)}return r}(),got=function(r,t){switch(t){case 1:return r.toLowerCase();case 3:return r.replace(mot,yot);case 2:return r.toUpperCase();default:return r}},mot=/(^|\s|:|-|\(|\))([a-z])/g,yot=function(r,t,e){return r.length>0?t+e.toUpperCase():r},s4=function(r){Hc(t,r);function t(e,n){var i=r.call(this,e,n)||this;return i.src=n.currentSrc||n.src,i.intrinsicWidth=n.naturalWidth,i.intrinsicHeight=n.naturalHeight,i.context.cache.addImage(i.src),i}return t}(Ql),o4=function(r){Hc(t,r);function t(e,n){var i=r.call(this,e,n)||this;return i.canvas=n,i.intrinsicWidth=n.width,i.intrinsicHeight=n.height,i}return t}(Ql),a4=function(r){Hc(t,r);function t(e,n){var i=r.call(this,e,n)||this,s=new XMLSerializer,a=iy(e,n);return n.setAttribute("width",a.width+"px"),n.setAttribute("height",a.height+"px"),i.svg="data:image/svg+xml,"+encodeURIComponent(s.serializeToString(n)),i.intrinsicWidth=n.width.baseVal.value,i.intrinsicHeight=n.height.baseVal.value,i.context.cache.addImage(i.svg),i}return t}(Ql),c4=function(r){Hc(t,r);function t(e,n){var i=r.call(this,e,n)||this;return i.value=n.value,i}return t}(Ql),F2=function(r){Hc(t,r);function t(e,n){var i=r.call(this,e,n)||this;return i.start=n.start,i.reversed=typeof n.reversed=="boolean"&&n.reversed===!0,i}return t}(Ql),_ot=[{type:15,flags:0,unit:"px",number:3}],vot=[{type:16,flags:0,number:50}],bot=function(r){return r.width>r.height?new LA(r.left+(r.width-r.height)/2,r.top,r.height,r.height):r.width<r.height?new LA(r.left,r.top+(r.height-r.width)/2,r.width,r.width):r},wot=function(r){var t=r.type===xot?new Array(r.value.length+1).join(""):r.value;return t.length===0?r.placeholder||"":t},Oy="checkbox",Ny="radio",xot="password",l4=707406591,M2=function(r){Hc(t,r);function t(e,n){var i=r.call(this,e,n)||this;switch(i.type=n.type.toLowerCase(),i.checked=n.checked,i.value=wot(n),(i.type===Oy||i.type===Ny)&&(i.styles.backgroundColor=3739148031,i.styles.borderTopColor=i.styles.borderRightColor=i.styles.borderBottomColor=i.styles.borderLeftColor=2779096575,i.styles.borderTopWidth=i.styles.borderRightWidth=i.styles.borderBottomWidth=i.styles.borderLeftWidth=1,i.styles.borderTopStyle=i.styles.borderRightStyle=i.styles.borderBottomStyle=i.styles.borderLeftStyle=1,i.styles.backgroundClip=[0],i.styles.backgroundOrigin=[0],i.bounds=bot(i.bounds)),i.type){case Oy:i.styles.borderTopRightRadius=i.styles.borderTopLeftRadius=i.styles.borderBottomRightRadius=i.styles.borderBottomLeftRadius=_ot;break;case Ny:i.styles.borderTopRightRadius=i.styles.borderTopLeftRadius=i.styles.borderBottomRightRadius=i.styles.borderBottomLeftRadius=vot;break}return i}return t}(Ql),A4=function(r){Hc(t,r);function t(e,n){var i=r.call(this,e,n)||this,s=n.options[n.selectedIndex||0];return i.value=s&&s.text||"",i}return t}(Ql),u4=function(r){Hc(t,r);function t(e,n){var i=r.call(this,e,n)||this;return i.value=n.value,i}return t}(Ql),h4=function(r){Hc(t,r);function t(e,n){var i=r.call(this,e,n)||this;i.src=n.src,i.width=parseInt(n.width,10)||0,i.height=parseInt(n.height,10)||0,i.backgroundColor=i.styles.backgroundColor;try{if(n.contentWindow&&n.contentWindow.document&&n.contentWindow.document.documentElement){i.tree=f4(e,n.contentWindow.document.documentElement);var s=n.contentWindow.document.documentElement?bg(e,getComputedStyle(n.contentWindow.document.documentElement).backgroundColor):MA.TRANSPARENT,a=n.contentWindow.document.body?bg(e,getComputedStyle(n.contentWindow.document.body).backgroundColor):MA.TRANSPARENT;i.backgroundColor=Ru(s)?Ru(a)?i.styles.backgroundColor:a:s}}catch{}return i}return t}(Ql),Bot=["OL","UL","MENU"],ky=function(r,t,e,n){for(var i=t.firstChild,s=void 0;i;i=s)if(s=i.nextSibling,p4(i)&&i.data.trim().length>0)e.textNodes.push(new pot(r,i,e.styles));else if(_f(i))if(b4(i)&&i.assignedNodes)i.assignedNodes().forEach(function(o){return ky(r,o,e,n)});else{var a=d4(r,i);a.styles.isVisible()&&(Cot(i,a,n)?a.flags|=4:Eot(a.styles)&&(a.flags|=2),Bot.indexOf(i.tagName)!==-1&&(a.flags|=8),e.elements.push(a),i.slot,i.shadowRoot?ky(r,i.shadowRoot,a,n):!zy(i)&&!g4(i)&&!Hy(i)&&ky(r,i,a,n))}},d4=function(r,t){return R2(t)?new s4(r,t):m4(t)?new o4(r,t):g4(t)?new a4(r,t):Sot(t)?new c4(r,t):Tot(t)?new F2(r,t):Iot(t)?new M2(r,t):Hy(t)?new A4(r,t):zy(t)?new u4(r,t):_4(t)?new h4(r,t):new Ql(r,t)},f4=function(r,t){var e=d4(r,t);return e.flags|=4,ky(r,t,e,e),e},Cot=function(r,t,e){return t.styles.isPositionedWithZIndex()||t.styles.opacity<1||t.styles.isTransformed()||U2(r)&&e.styles.isTransparent()},Eot=function(r){return r.isPositioned()||r.isFloating()},p4=function(r){return r.nodeType===Node.TEXT_NODE},_f=function(r){return r.nodeType===Node.ELEMENT_NODE},P2=function(r){return _f(r)&&typeof r.style<"u"&&!Qy(r)},Qy=function(r){return typeof r.className=="object"},Sot=function(r){return r.tagName==="LI"},Tot=function(r){return r.tagName==="OL"},Iot=function(r){return r.tagName==="INPUT"},Lot=function(r){return r.tagName==="HTML"},g4=function(r){return r.tagName==="svg"},U2=function(r){return r.tagName==="BODY"},m4=function(r){return r.tagName==="CANVAS"},y4=function(r){return r.tagName==="VIDEO"},R2=function(r){return r.tagName==="IMG"},_4=function(r){return r.tagName==="IFRAME"},v4=function(r){return r.tagName==="STYLE"},Fot=function(r){return r.tagName==="SCRIPT"},zy=function(r){return r.tagName==="TEXTAREA"},Hy=function(r){return r.tagName==="SELECT"},b4=function(r){return r.tagName==="SLOT"},w4=function(r){return r.tagName.indexOf("-")>0},Mot=function(){function r(){this.counters={}}return r.prototype.getCounterValue=function(t){var e=this.counters[t];return e&&e.length?e[e.length-1]:1},r.prototype.getCounterValues=function(t){var e=this.counters[t];return e||[]},r.prototype.pop=function(t){var e=this;t.forEach(function(n){return e.counters[n].pop()})},r.prototype.parse=function(t){var e=this,n=t.counterIncrement,i=t.counterReset,s=!0;n!==null&&n.forEach(function(o){var h=e.counters[o.counter];h&&o.increment!==0&&(s=!1,h.length||h.push(1),h[Math.max(0,h.length-1)]+=o.increment)});var a=[];return s&&i.forEach(function(o){var h=e.counters[o.counter];a.push(o.counter),h||(h=e.counters[o.counter]=[]),h.push(o.reset)}),a},r}(),x4={integers:[1e3,900,500,400,100,90,50,40,10,9,5,4,1],values:["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"]},B4={integers:[9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},Pot={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,400,300,200,100,90,80,70,60,50,40,30,20,19,18,17,16,15,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},Uot={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},vf=function(r,t,e,n,i,s){return r<t||r>e?Eg(r,i,s.length>0):n.integers.reduce(function(a,o,h){for(;r>=o;)r-=o,a+=n.values[h];return a},"")+s},C4=function(r,t,e,n){var i="";do e||r--,i=n(r)+i,r/=t;while(r*t>=t);return i},Ji=function(r,t,e,n,i){var s=e-t+1;return(r<0?"-":"")+(C4(Math.abs(r),s,n,function(a){return Xi(Math.floor(a%s)+t)})+i)},Uh=function(r,t,e){e===void 0&&(e=". ");var n=t.length;return C4(Math.abs(r),n,!1,function(i){return t[Math.floor(i%n)]})+e},bf=1,Ou=2,Nu=4,Cg=8,PA=function(r,t,e,n,i,s){if(r<-9999||r>9999)return Eg(r,4,i.length>0);var a=Math.abs(r),o=i;if(a===0)return t[0]+o;for(var h=0;a>0&&h<=4;h++){var f=a%10;f===0&&xs(s,bf)&&o!==""?o=t[f]+o:f>1||f===1&&h===0||f===1&&h===1&&xs(s,Ou)||f===1&&h===1&&xs(s,Nu)&&r>100||f===1&&h>1&&xs(s,Cg)?o=t[f]+(h>0?e[h-1]:"")+o:f===1&&h>0&&(o=e[h-1]+o),a=Math.floor(a/10)}return(r<0?n:"")+o},E4="",S4="",T4="",D2="",Eg=function(r,t,e){var n=e?". ":"",i=e?"":"",s=e?", ":"",a=e?" ":"";switch(t){case 0:return""+a;case 1:return""+a;case 2:return""+a;case 5:var o=Ji(r,48,57,!0,n);return o.length<4?"0"+o:o;case 4:return Uh(r,"",i);case 6:return vf(r,1,3999,x4,3,n).toLowerCase();case 7:return vf(r,1,3999,x4,3,n);case 8:return Ji(r,945,969,!1,n);case 9:return Ji(r,97,122,!1,n);case 10:return Ji(r,65,90,!1,n);case 11:return Ji(r,1632,1641,!0,n);case 12:case 49:return vf(r,1,9999,B4,3,n);case 35:return vf(r,1,9999,B4,3,n).toLowerCase();case 13:return Ji(r,2534,2543,!0,n);case 14:case 30:return Ji(r,6112,6121,!0,n);case 15:return Uh(r,"",i);case 16:return Uh(r,"",i);case 17:case 48:return PA(r,"",E4,"",i,Ou|Nu|Cg);case 47:return PA(r,"",S4,"",i,bf|Ou|Nu|Cg);case 42:return PA(r,"",E4,"",i,Ou|Nu|Cg);case 41:return PA(r,"",S4,"",i,bf|Ou|Nu|Cg);case 26:return PA(r,"","",T4,i,0);case 25:return PA(r,"","",T4,i,bf|Ou|Nu);case 31:return PA(r,"","",D2,s,bf|Ou|Nu);case 33:return PA(r,"","",D2,s,0);case 32:return PA(r,"","",D2,s,bf|Ou|Nu);case 18:return Ji(r,2406,2415,!0,n);case 20:return vf(r,1,19999,Uot,3,n);case 21:return Ji(r,2790,2799,!0,n);case 22:return Ji(r,2662,2671,!0,n);case 22:return vf(r,1,10999,Pot,3,n);case 23:return Uh(r,"");case 24:return Uh(r,"");case 27:return Ji(r,3302,3311,!0,n);case 28:return Uh(r,"",i);case 29:return Uh(r,"",i);case 34:return Ji(r,3792,3801,!0,n);case 37:return Ji(r,6160,6169,!0,n);case 38:return Ji(r,4160,4169,!0,n);case 39:return Ji(r,2918,2927,!0,n);case 40:return Ji(r,1776,1785,!0,n);case 43:return Ji(r,3046,3055,!0,n);case 44:return Ji(r,3174,3183,!0,n);case 45:return Ji(r,3664,3673,!0,n);case 46:return Ji(r,3872,3881,!0,n);case 3:default:return Ji(r,48,57,!0,n)}},I4="data-html2canvas-ignore",L4=function(){function r(t,e,n){if(this.context=t,this.options=n,this.scrolledElements=[],this.referenceElement=e,this.counters=new Mot,this.quoteDepth=0,!e.ownerDocument)throw new Error("Cloned element does not have an owner document");this.documentElement=this.cloneNode(e.ownerDocument.documentElement,!1)}return r.prototype.toIFrame=function(t,e){var n=this,i=Rot(t,e);if(!i.contentWindow)return Promise.reject("Unable to find iframe window");var s=t.defaultView.pageXOffset,a=t.defaultView.pageYOffset,o=i.contentWindow,h=o.document,f=Not(i).then(function(){return Go(n,void 0,void 0,function(){var g,b;return bo(this,function(C){switch(C.label){case 0:return this.scrolledElements.forEach(Hot),o&&(o.scrollTo(e.left,e.top),/(iPad|iPhone|iPod)/g.test(navigator.userAgent)&&(o.scrollY!==e.top||o.scrollX!==e.left)&&(this.context.logger.warn("Unable to restore scroll position for cloned document"),this.context.windowBounds=this.context.windowBounds.add(o.scrollX-e.left,o.scrollY-e.top,0,0))),g=this.options.onclone,b=this.clonedReferenceElement,typeof b>"u"?[2,Promise.reject("Error finding the "+this.referenceElement.nodeName+" in the cloned document")]:h.fonts&&h.fonts.ready?[4,h.fonts.ready]:[3,2];case 1:C.sent(),C.label=2;case 2:return/(AppleWebKit)/g.test(navigator.userAgent)?[4,Oot(h)]:[3,4];case 3:C.sent(),C.label=4;case 4:return typeof g=="function"?[2,Promise.resolve().then(function(){return g(h,b)}).then(function(){return i})]:[2,i]}})})});return h.open(),h.write(Qot(document.doctype)+"<html></html>"),zot(this.referenceElement.ownerDocument,s,a),h.replaceChild(h.adoptNode(this.documentElement),h.documentElement),h.close(),f},r.prototype.createElementClone=function(t){if(v2(t,2))debugger;if(m4(t))return this.createCanvasClone(t);if(y4(t))return this.createVideoClone(t);if(v4(t))return this.createStyleClone(t);var e=t.cloneNode(!1);return R2(e)&&(R2(t)&&t.currentSrc&&t.currentSrc!==t.src&&(e.src=t.currentSrc,e.srcset=""),e.loading==="lazy"&&(e.loading="eager")),w4(e)?this.createCustomElementClone(e):e},r.prototype.createCustomElementClone=function(t){var e=document.createElement("html2canvascustomelement");return O2(t.style,e),e},r.prototype.createStyleClone=function(t){try{var e=t.sheet;if(e&&e.cssRules){var n=[].slice.call(e.cssRules,0).reduce(function(s,a){return a&&typeof a.cssText=="string"?s+a.cssText:s},""),i=t.cloneNode(!1);return i.textContent=n,i}}catch(s){if(this.context.logger.error("Unable to access cssRules property",s),s.name!=="SecurityError")throw s}return t.cloneNode(!1)},r.prototype.createCanvasClone=function(t){var e;if(this.options.inlineImages&&t.ownerDocument){var n=t.ownerDocument.createElement("img");try{return n.src=t.toDataURL(),n}catch{this.context.logger.info("Unable to inline canvas contents, canvas is tainted",t)}}var i=t.cloneNode(!1);try{i.width=t.width,i.height=t.height;var s=t.getContext("2d"),a=i.getContext("2d");if(a)if(!this.options.allowTaint&&s)a.putImageData(s.getImageData(0,0,t.width,t.height),0,0);else{var o=(e=t.getContext("webgl2"))!==null&&e!==void 0?e:t.getContext("webgl");if(o){var h=o.getContextAttributes();(h==null?void 0:h.preserveDrawingBuffer)===!1&&this.context.logger.warn("Unable to clone WebGL context as it has preserveDrawingBuffer=false",t)}a.drawImage(t,0,0)}return i}catch{this.context.logger.info("Unable to clone canvas as it is tainted",t)}return i},r.prototype.createVideoClone=function(t){var e=t.ownerDocument.createElement("canvas");e.width=t.offsetWidth,e.height=t.offsetHeight;var n=e.getContext("2d");try{return n&&(n.drawImage(t,0,0,e.width,e.height),this.options.allowTaint||n.getImageData(0,0,e.width,e.height)),e}catch{this.context.logger.info("Unable to clone video as it is tainted",t)}var i=t.ownerDocument.createElement("canvas");return i.width=t.offsetWidth,i.height=t.offsetHeight,i},r.prototype.appendChildNode=function(t,e,n){(!_f(e)||!Fot(e)&&!e.hasAttribute(I4)&&(typeof this.options.ignoreElements!="function"||!this.options.ignoreElements(e)))&&(!this.options.copyStyles||!_f(e)||!v4(e))&&t.appendChild(this.cloneNode(e,n))},r.prototype.cloneChildNodes=function(t,e,n){for(var i=this,s=t.shadowRoot?t.shadowRoot.firstChild:t.firstChild;s;s=s.nextSibling)if(_f(s)&&b4(s)&&typeof s.assignedNodes=="function"){var a=s.assignedNodes();a.length&&a.forEach(function(o){return i.appendChildNode(e,o,n)})}else this.appendChildNode(e,s,n)},r.prototype.cloneNode=function(t,e){if(p4(t))return document.createTextNode(t.data);if(!t.ownerDocument)return t.cloneNode(!1);var n=t.ownerDocument.defaultView;if(n&&_f(t)&&(P2(t)||Qy(t))){var i=this.createElementClone(t);i.style.transitionProperty="none";var s=n.getComputedStyle(t),a=n.getComputedStyle(t,":before"),o=n.getComputedStyle(t,":after");this.referenceElement===t&&P2(i)&&(this.clonedReferenceElement=i),U2(i)&&jot(i);var h=this.counters.parse(new GM(this.context,s)),f=this.resolvePseudoContent(t,i,a,Sg.BEFORE);w4(t)&&(e=!0),y4(t)||this.cloneChildNodes(t,i,e),f&&i.insertBefore(f,i.firstChild);var g=this.resolvePseudoContent(t,i,o,Sg.AFTER);return g&&i.appendChild(g),this.counters.pop(h),(s&&(this.options.copyStyles||Qy(t))&&!_4(t)||e)&&O2(s,i),(t.scrollTop!==0||t.scrollLeft!==0)&&this.scrolledElements.push([i,t.scrollLeft,t.scrollTop]),(zy(t)||Hy(t))&&(zy(i)||Hy(i))&&(i.value=t.value),i}return t.cloneNode(!1)},r.prototype.resolvePseudoContent=function(t,e,n,i){var s=this;if(n){var a=n.content,o=e.ownerDocument;if(!(!o||!a||a==="none"||a==="-moz-alt-content"||n.display==="none")){this.counters.parse(new GM(this.context,n));var h=new Sst(this.context,n),f=o.createElement("html2canvaspseudoelement");O2(n,f),h.content.forEach(function(b){if(b.type===0)f.appendChild(o.createTextNode(b.value));else if(b.type===22){var C=o.createElement("img");C.src=b.value,C.style.opacity="1",f.appendChild(C)}else if(b.type===18){if(b.name==="attr"){var B=b.values.filter(ii);B.length&&f.appendChild(o.createTextNode(t.getAttribute(B[0].value)||""))}else if(b.name==="counter"){var R=b.values.filter(mf),D=R[0],Q=R[1];if(D&&ii(D)){var k=s.counters.getCounterValue(D.value),j=Q&&ii(Q)?_2.parse(s.context,Q.value):3;f.appendChild(o.createTextNode(Eg(k,j,!1)))}}else if(b.name==="counters"){var et=b.values.filter(mf),D=et[0],st=et[1],Q=et[2];if(D&&ii(D)){var mt=s.counters.getCounterValues(D.value),pt=Q&&ii(Q)?_2.parse(s.context,Q.value):3,yt=st&&st.type===0?st.value:"",ft=mt.map(function(ut){return Eg(ut,pt,!1)}).join(yt);f.appendChild(o.createTextNode(ft))}}}else if(b.type===20)switch(b.value){case"open-quote":f.appendChild(o.createTextNode(HM(h.quotes,s.quoteDepth++,!0)));break;case"close-quote":f.appendChild(o.createTextNode(HM(h.quotes,--s.quoteDepth,!1)));break;default:f.appendChild(o.createTextNode(b.value))}}),f.className=N2+" "+k2;var g=i===Sg.BEFORE?" "+N2:" "+k2;return Qy(e)?e.className.baseValue+=g:e.className+=g,f}}},r.destroy=function(t){return t.parentNode?(t.parentNode.removeChild(t),!0):!1},r}(),Sg;(function(r){r[r.BEFORE=0]="BEFORE",r[r.AFTER=1]="AFTER"})(Sg||(Sg={}));var Rot=function(r,t){var e=r.createElement("iframe");return e.className="html2canvas-container",e.style.visibility="hidden",e.style.position="fixed",e.style.left="-10000px",e.style.top="0px",e.style.border="0",e.width=t.width.toString(),e.height=t.height.toString(),e.scrolling="no",e.setAttribute(I4,"true"),r.body.appendChild(e),e},Dot=function(r){return new Promise(function(t){if(r.complete){t();return}if(!r.src){t();return}r.onload=t,r.onerror=t})},Oot=function(r){return Promise.all([].slice.call(r.images,0).map(Dot))},Not=function(r){return new Promise(function(t,e){var n=r.contentWindow;if(!n)return e("No window assigned for iframe");var i=n.document;n.onload=r.onload=function(){n.onload=r.onload=null;var s=setInterval(function(){i.body.childNodes.length>0&&i.readyState==="complete"&&(clearInterval(s),t(r))},50)}})},kot=["all","d","content"],O2=function(r,t){for(var e=r.length-1;e>=0;e--){var n=r.item(e);kot.indexOf(n)===-1&&t.style.setProperty(n,r.getPropertyValue(n))}return t},Qot=function(r){var t="";return r&&(t+="<!DOCTYPE ",r.name&&(t+=r.name),r.internalSubset&&(t+=r.internalSubset),r.publicId&&(t+='"'+r.publicId+'"'),r.systemId&&(t+='"'+r.systemId+'"'),t+=">"),t},zot=function(r,t,e){r&&r.defaultView&&(t!==r.defaultView.pageXOffset||e!==r.defaultView.pageYOffset)&&r.defaultView.scrollTo(t,e)},Hot=function(r){var t=r[0],e=r[1],n=r[2];t.scrollLeft=e,t.scrollTop=n},Got=":before",Vot=":after",N2="___html2canvas___pseudoelement_before",k2="___html2canvas___pseudoelement_after",F4=`{
    content: "" !important;
    display: none !important;
}`,jot=function(r){qot(r,"."+N2+Got+F4+`
         .`+k2+Vot+F4)},qot=function(r,t){var e=r.ownerDocument;if(e){var n=e.createElement("style");n.textContent=t,r.appendChild(n)}},M4=function(){function r(){}return r.getOrigin=function(t){var e=r._link;return e?(e.href=t,e.href=e.href,e.protocol+e.hostname+e.port):"about:blank"},r.isSameOrigin=function(t){return r.getOrigin(t)===r._origin},r.setContext=function(t){r._link=t.document.createElement("a"),r._origin=r.getOrigin(t.location.href)},r._origin="about:blank",r}(),Kot=function(){function r(t,e){this.context=t,this._options=e,this._cache={}}return r.prototype.addImage=function(t){var e=Promise.resolve();return this.has(t)||(z2(t)||Jot(t))&&(this._cache[t]=this.loadImage(t)).catch(function(){}),e},r.prototype.match=function(t){return this._cache[t]},r.prototype.loadImage=function(t){return Go(this,void 0,void 0,function(){var e,n,i,s,a=this;return bo(this,function(o){switch(o.label){case 0:return e=M4.isSameOrigin(t),n=!Q2(t)&&this._options.useCORS===!0&&$s.SUPPORT_CORS_IMAGES&&!e,i=!Q2(t)&&!e&&!z2(t)&&typeof this._options.proxy=="string"&&$s.SUPPORT_CORS_XHR&&!n,!e&&this._options.allowTaint===!1&&!Q2(t)&&!z2(t)&&!i&&!n?[2]:(s=t,i?[4,this.proxy(s)]:[3,2]);case 1:s=o.sent(),o.label=2;case 2:return this.context.logger.debug("Added image "+t.substring(0,256)),[4,new Promise(function(h,f){var g=new Image;g.onload=function(){return h(g)},g.onerror=f,(Yot(s)||n)&&(g.crossOrigin="anonymous"),g.src=s,g.complete===!0&&setTimeout(function(){return h(g)},500),a._options.imageTimeout>0&&setTimeout(function(){return f("Timed out ("+a._options.imageTimeout+"ms) loading image")},a._options.imageTimeout)})];case 3:return[2,o.sent()]}})})},r.prototype.has=function(t){return typeof this._cache[t]<"u"},r.prototype.keys=function(){return Promise.resolve(Object.keys(this._cache))},r.prototype.proxy=function(t){var e=this,n=this._options.proxy;if(!n)throw new Error("No proxy defined");var i=t.substring(0,256);return new Promise(function(s,a){var o=$s.SUPPORT_RESPONSE_TYPE?"blob":"text",h=new XMLHttpRequest;h.onload=function(){if(h.status===200)if(o==="text")s(h.response);else{var b=new FileReader;b.addEventListener("load",function(){return s(b.result)},!1),b.addEventListener("error",function(C){return a(C)},!1),b.readAsDataURL(h.response)}else a("Failed to proxy resource "+i+" with status code "+h.status)},h.onerror=a;var f=n.indexOf("?")>-1?"&":"?";if(h.open("GET",""+n+f+"url="+encodeURIComponent(t)+"&responseType="+o),o!=="text"&&h instanceof XMLHttpRequest&&(h.responseType=o),e._options.imageTimeout){var g=e._options.imageTimeout;h.timeout=g,h.ontimeout=function(){return a("Timed out ("+g+"ms) proxying "+i)}}h.send()})},r}(),$ot=/^data:image\/svg\+xml/i,Wot=/^data:image\/.*;base64,/i,Xot=/^data:image\/.*/i,Jot=function(r){return $s.SUPPORT_SVG_DRAWING||!Zot(r)},Q2=function(r){return Xot.test(r)},Yot=function(r){return Wot.test(r)},z2=function(r){return r.substr(0,4)==="blob"},Zot=function(r){return r.substr(-3).toLowerCase()==="svg"||$ot.test(r)},fr=function(){function r(t,e){this.type=0,this.x=t,this.y=e}return r.prototype.add=function(t,e){return new r(this.x+t,this.y+e)},r}(),wf=function(r,t,e){return new fr(r.x+(t.x-r.x)*e,r.y+(t.y-r.y)*e)},Gy=function(){function r(t,e,n,i){this.type=1,this.start=t,this.startControl=e,this.endControl=n,this.end=i}return r.prototype.subdivide=function(t,e){var n=wf(this.start,this.startControl,t),i=wf(this.startControl,this.endControl,t),s=wf(this.endControl,this.end,t),a=wf(n,i,t),o=wf(i,s,t),h=wf(a,o,t);return e?new r(this.start,n,a,h):new r(h,o,s,this.end)},r.prototype.add=function(t,e){return new r(this.start.add(t,e),this.startControl.add(t,e),this.endControl.add(t,e),this.end.add(t,e))},r.prototype.reverse=function(){return new r(this.end,this.endControl,this.startControl,this.start)},r}(),cc=function(r){return r.type===1},tat=function(){function r(t){var e=t.styles,n=t.bounds,i=vg(e.borderTopLeftRadius,n.width,n.height),s=i[0],a=i[1],o=vg(e.borderTopRightRadius,n.width,n.height),h=o[0],f=o[1],g=vg(e.borderBottomRightRadius,n.width,n.height),b=g[0],C=g[1],B=vg(e.borderBottomLeftRadius,n.width,n.height),R=B[0],D=B[1],Q=[];Q.push((s+h)/n.width),Q.push((R+b)/n.width),Q.push((a+D)/n.height),Q.push((f+C)/n.height);var k=Math.max.apply(Math,Q);k>1&&(s/=k,a/=k,h/=k,f/=k,b/=k,C/=k,R/=k,D/=k);var j=n.width-h,et=n.height-C,st=n.width-b,mt=n.height-D,pt=e.borderTopWidth,yt=e.borderRightWidth,ft=e.borderBottomWidth,Dt=e.borderLeftWidth,It=mi(e.paddingTop,t.bounds.width),ut=mi(e.paddingRight,t.bounds.width),At=mi(e.paddingBottom,t.bounds.width),Bt=mi(e.paddingLeft,t.bounds.width);this.topLeftBorderDoubleOuterBox=s>0||a>0?xi(n.left+Dt/3,n.top+pt/3,s-Dt/3,a-pt/3,Wn.TOP_LEFT):new fr(n.left+Dt/3,n.top+pt/3),this.topRightBorderDoubleOuterBox=s>0||a>0?xi(n.left+j,n.top+pt/3,h-yt/3,f-pt/3,Wn.TOP_RIGHT):new fr(n.left+n.width-yt/3,n.top+pt/3),this.bottomRightBorderDoubleOuterBox=b>0||C>0?xi(n.left+st,n.top+et,b-yt/3,C-ft/3,Wn.BOTTOM_RIGHT):new fr(n.left+n.width-yt/3,n.top+n.height-ft/3),this.bottomLeftBorderDoubleOuterBox=R>0||D>0?xi(n.left+Dt/3,n.top+mt,R-Dt/3,D-ft/3,Wn.BOTTOM_LEFT):new fr(n.left+Dt/3,n.top+n.height-ft/3),this.topLeftBorderDoubleInnerBox=s>0||a>0?xi(n.left+Dt*2/3,n.top+pt*2/3,s-Dt*2/3,a-pt*2/3,Wn.TOP_LEFT):new fr(n.left+Dt*2/3,n.top+pt*2/3),this.topRightBorderDoubleInnerBox=s>0||a>0?xi(n.left+j,n.top+pt*2/3,h-yt*2/3,f-pt*2/3,Wn.TOP_RIGHT):new fr(n.left+n.width-yt*2/3,n.top+pt*2/3),this.bottomRightBorderDoubleInnerBox=b>0||C>0?xi(n.left+st,n.top+et,b-yt*2/3,C-ft*2/3,Wn.BOTTOM_RIGHT):new fr(n.left+n.width-yt*2/3,n.top+n.height-ft*2/3),this.bottomLeftBorderDoubleInnerBox=R>0||D>0?xi(n.left+Dt*2/3,n.top+mt,R-Dt*2/3,D-ft*2/3,Wn.BOTTOM_LEFT):new fr(n.left+Dt*2/3,n.top+n.height-ft*2/3),this.topLeftBorderStroke=s>0||a>0?xi(n.left+Dt/2,n.top+pt/2,s-Dt/2,a-pt/2,Wn.TOP_LEFT):new fr(n.left+Dt/2,n.top+pt/2),this.topRightBorderStroke=s>0||a>0?xi(n.left+j,n.top+pt/2,h-yt/2,f-pt/2,Wn.TOP_RIGHT):new fr(n.left+n.width-yt/2,n.top+pt/2),this.bottomRightBorderStroke=b>0||C>0?xi(n.left+st,n.top+et,b-yt/2,C-ft/2,Wn.BOTTOM_RIGHT):new fr(n.left+n.width-yt/2,n.top+n.height-ft/2),this.bottomLeftBorderStroke=R>0||D>0?xi(n.left+Dt/2,n.top+mt,R-Dt/2,D-ft/2,Wn.BOTTOM_LEFT):new fr(n.left+Dt/2,n.top+n.height-ft/2),this.topLeftBorderBox=s>0||a>0?xi(n.left,n.top,s,a,Wn.TOP_LEFT):new fr(n.left,n.top),this.topRightBorderBox=h>0||f>0?xi(n.left+j,n.top,h,f,Wn.TOP_RIGHT):new fr(n.left+n.width,n.top),this.bottomRightBorderBox=b>0||C>0?xi(n.left+st,n.top+et,b,C,Wn.BOTTOM_RIGHT):new fr(n.left+n.width,n.top+n.height),this.bottomLeftBorderBox=R>0||D>0?xi(n.left,n.top+mt,R,D,Wn.BOTTOM_LEFT):new fr(n.left,n.top+n.height),this.topLeftPaddingBox=s>0||a>0?xi(n.left+Dt,n.top+pt,Math.max(0,s-Dt),Math.max(0,a-pt),Wn.TOP_LEFT):new fr(n.left+Dt,n.top+pt),this.topRightPaddingBox=h>0||f>0?xi(n.left+Math.min(j,n.width-yt),n.top+pt,j>n.width+yt?0:Math.max(0,h-yt),Math.max(0,f-pt),Wn.TOP_RIGHT):new fr(n.left+n.width-yt,n.top+pt),this.bottomRightPaddingBox=b>0||C>0?xi(n.left+Math.min(st,n.width-Dt),n.top+Math.min(et,n.height-ft),Math.max(0,b-yt),Math.max(0,C-ft),Wn.BOTTOM_RIGHT):new fr(n.left+n.width-yt,n.top+n.height-ft),this.bottomLeftPaddingBox=R>0||D>0?xi(n.left+Dt,n.top+Math.min(mt,n.height-ft),Math.max(0,R-Dt),Math.max(0,D-ft),Wn.BOTTOM_LEFT):new fr(n.left+Dt,n.top+n.height-ft),this.topLeftContentBox=s>0||a>0?xi(n.left+Dt+Bt,n.top+pt+It,Math.max(0,s-(Dt+Bt)),Math.max(0,a-(pt+It)),Wn.TOP_LEFT):new fr(n.left+Dt+Bt,n.top+pt+It),this.topRightContentBox=h>0||f>0?xi(n.left+Math.min(j,n.width+Dt+Bt),n.top+pt+It,j>n.width+Dt+Bt?0:h-Dt+Bt,f-(pt+It),Wn.TOP_RIGHT):new fr(n.left+n.width-(yt+ut),n.top+pt+It),this.bottomRightContentBox=b>0||C>0?xi(n.left+Math.min(st,n.width-(Dt+Bt)),n.top+Math.min(et,n.height+pt+It),Math.max(0,b-(yt+ut)),C-(ft+At),Wn.BOTTOM_RIGHT):new fr(n.left+n.width-(yt+ut),n.top+n.height-(ft+At)),this.bottomLeftContentBox=R>0||D>0?xi(n.left+Dt+Bt,n.top+mt,Math.max(0,R-(Dt+Bt)),D-(ft+At),Wn.BOTTOM_LEFT):new fr(n.left+Dt+Bt,n.top+n.height-(ft+At))}return r}(),Wn;(function(r){r[r.TOP_LEFT=0]="TOP_LEFT",r[r.TOP_RIGHT=1]="TOP_RIGHT",r[r.BOTTOM_RIGHT=2]="BOTTOM_RIGHT",r[r.BOTTOM_LEFT=3]="BOTTOM_LEFT"})(Wn||(Wn={}));var xi=function(r,t,e,n,i){var s=4*((Math.sqrt(2)-1)/3),a=e*s,o=n*s,h=r+e,f=t+n;switch(i){case Wn.TOP_LEFT:return new Gy(new fr(r,f),new fr(r,f-o),new fr(h-a,t),new fr(h,t));case Wn.TOP_RIGHT:return new Gy(new fr(r,t),new fr(r+a,t),new fr(h,f-o),new fr(h,f));case Wn.BOTTOM_RIGHT:return new Gy(new fr(h,t),new fr(h,t+o),new fr(r+a,f),new fr(r,f));case Wn.BOTTOM_LEFT:default:return new Gy(new fr(h,f),new fr(h-a,f),new fr(r,t+o),new fr(r,t))}},Vy=function(r){return[r.topLeftBorderBox,r.topRightBorderBox,r.bottomRightBorderBox,r.bottomLeftBorderBox]},eat=function(r){return[r.topLeftContentBox,r.topRightContentBox,r.bottomRightContentBox,r.bottomLeftContentBox]},jy=function(r){return[r.topLeftPaddingBox,r.topRightPaddingBox,r.bottomRightPaddingBox,r.bottomLeftPaddingBox]},rat=function(){function r(t,e,n){this.offsetX=t,this.offsetY=e,this.matrix=n,this.type=0,this.target=6}return r}(),qy=function(){function r(t,e){this.path=t,this.target=e,this.type=1}return r}(),nat=function(){function r(t){this.opacity=t,this.type=2,this.target=6}return r}(),iat=function(r){return r.type===0},P4=function(r){return r.type===1},sat=function(r){return r.type===2},U4=function(r,t){return r.length===t.length?r.some(function(e,n){return e===t[n]}):!1},oat=function(r,t,e,n,i){return r.map(function(s,a){switch(a){case 0:return s.add(t,e);case 1:return s.add(t+n,e);case 2:return s.add(t+n,e+i);case 3:return s.add(t,e+i)}return s})},R4=function(){function r(t){this.element=t,this.inlineLevel=[],this.nonInlineLevel=[],this.negativeZIndex=[],this.zeroOrAutoZIndexOrTransformedOrOpacity=[],this.positiveZIndex=[],this.nonPositionedFloats=[],this.nonPositionedInlineLevel=[]}return r}(),D4=function(){function r(t,e){if(this.container=t,this.parent=e,this.effects=[],this.curves=new tat(this.container),this.container.styles.opacity<1&&this.effects.push(new nat(this.container.styles.opacity)),this.container.styles.transform!==null){var n=this.container.bounds.left+this.container.styles.transformOrigin[0].number,i=this.container.bounds.top+this.container.styles.transformOrigin[1].number,s=this.container.styles.transform;this.effects.push(new rat(n,i,s))}if(this.container.styles.overflowX!==0){var a=Vy(this.curves),o=jy(this.curves);U4(a,o)?this.effects.push(new qy(a,6)):(this.effects.push(new qy(a,2)),this.effects.push(new qy(o,4)))}}return r.prototype.getEffects=function(t){for(var e=[2,3].indexOf(this.container.styles.position)===-1,n=this.parent,i=this.effects.slice(0);n;){var s=n.effects.filter(function(h){return!P4(h)});if(e||n.container.styles.position!==0||!n.parent){if(i.unshift.apply(i,s),e=[2,3].indexOf(n.container.styles.position)===-1,n.container.styles.overflowX!==0){var a=Vy(n.curves),o=jy(n.curves);U4(a,o)||i.unshift(new qy(o,6))}}else i.unshift.apply(i,s);n=n.parent}return i.filter(function(h){return xs(h.target,t)})},r}(),H2=function(r,t,e,n){r.container.elements.forEach(function(i){var s=xs(i.flags,4),a=xs(i.flags,2),o=new D4(i,r);xs(i.styles.display,2048)&&n.push(o);var h=xs(i.flags,8)?[]:n;if(s||a){var f=s||i.styles.isPositioned()?e:t,g=new R4(o);if(i.styles.isPositioned()||i.styles.opacity<1||i.styles.isTransformed()){var b=i.styles.zIndex.order;if(b<0){var C=0;f.negativeZIndex.some(function(R,D){return b>R.element.container.styles.zIndex.order?(C=D,!1):C>0}),f.negativeZIndex.splice(C,0,g)}else if(b>0){var B=0;f.positiveZIndex.some(function(R,D){return b>=R.element.container.styles.zIndex.order?(B=D+1,!1):B>0}),f.positiveZIndex.splice(B,0,g)}else f.zeroOrAutoZIndexOrTransformedOrOpacity.push(g)}else i.styles.isFloating()?f.nonPositionedFloats.push(g):f.nonPositionedInlineLevel.push(g);H2(o,g,s?g:e,h)}else i.styles.isInlineLevel()?t.inlineLevel.push(o):t.nonInlineLevel.push(o),H2(o,t,e,h);xs(i.flags,8)&&O4(i,h)})},O4=function(r,t){for(var e=r instanceof F2?r.start:1,n=r instanceof F2?r.reversed:!1,i=0;i<t.length;i++){var s=t[i];s.container instanceof c4&&typeof s.container.value=="number"&&s.container.value!==0&&(e=s.container.value),s.listValue=Eg(e,s.container.styles.listStyleType,!0),e+=n?-1:1}},aat=function(r){var t=new D4(r,null),e=new R4(t),n=[];return H2(t,e,e,n),O4(t.container,n),e},N4=function(r,t){switch(t){case 0:return lc(r.topLeftBorderBox,r.topLeftPaddingBox,r.topRightBorderBox,r.topRightPaddingBox);case 1:return lc(r.topRightBorderBox,r.topRightPaddingBox,r.bottomRightBorderBox,r.bottomRightPaddingBox);case 2:return lc(r.bottomRightBorderBox,r.bottomRightPaddingBox,r.bottomLeftBorderBox,r.bottomLeftPaddingBox);case 3:default:return lc(r.bottomLeftBorderBox,r.bottomLeftPaddingBox,r.topLeftBorderBox,r.topLeftPaddingBox)}},cat=function(r,t){switch(t){case 0:return lc(r.topLeftBorderBox,r.topLeftBorderDoubleOuterBox,r.topRightBorderBox,r.topRightBorderDoubleOuterBox);case 1:return lc(r.topRightBorderBox,r.topRightBorderDoubleOuterBox,r.bottomRightBorderBox,r.bottomRightBorderDoubleOuterBox);case 2:return lc(r.bottomRightBorderBox,r.bottomRightBorderDoubleOuterBox,r.bottomLeftBorderBox,r.bottomLeftBorderDoubleOuterBox);case 3:default:return lc(r.bottomLeftBorderBox,r.bottomLeftBorderDoubleOuterBox,r.topLeftBorderBox,r.topLeftBorderDoubleOuterBox)}},lat=function(r,t){switch(t){case 0:return lc(r.topLeftBorderDoubleInnerBox,r.topLeftPaddingBox,r.topRightBorderDoubleInnerBox,r.topRightPaddingBox);case 1:return lc(r.topRightBorderDoubleInnerBox,r.topRightPaddingBox,r.bottomRightBorderDoubleInnerBox,r.bottomRightPaddingBox);case 2:return lc(r.bottomRightBorderDoubleInnerBox,r.bottomRightPaddingBox,r.bottomLeftBorderDoubleInnerBox,r.bottomLeftPaddingBox);case 3:default:return lc(r.bottomLeftBorderDoubleInnerBox,r.bottomLeftPaddingBox,r.topLeftBorderDoubleInnerBox,r.topLeftPaddingBox)}},Aat=function(r,t){switch(t){case 0:return Ky(r.topLeftBorderStroke,r.topRightBorderStroke);case 1:return Ky(r.topRightBorderStroke,r.bottomRightBorderStroke);case 2:return Ky(r.bottomRightBorderStroke,r.bottomLeftBorderStroke);case 3:default:return Ky(r.bottomLeftBorderStroke,r.topLeftBorderStroke)}},Ky=function(r,t){var e=[];return cc(r)?e.push(r.subdivide(.5,!1)):e.push(r),cc(t)?e.push(t.subdivide(.5,!0)):e.push(t),e},lc=function(r,t,e,n){var i=[];return cc(r)?i.push(r.subdivide(.5,!1)):i.push(r),cc(e)?i.push(e.subdivide(.5,!0)):i.push(e),cc(n)?i.push(n.subdivide(.5,!0).reverse()):i.push(n),cc(t)?i.push(t.subdivide(.5,!1).reverse()):i.push(t),i},k4=function(r){var t=r.bounds,e=r.styles;return t.add(e.borderLeftWidth,e.borderTopWidth,-(e.borderRightWidth+e.borderLeftWidth),-(e.borderTopWidth+e.borderBottomWidth))},$y=function(r){var t=r.styles,e=r.bounds,n=mi(t.paddingLeft,e.width),i=mi(t.paddingRight,e.width),s=mi(t.paddingTop,e.width),a=mi(t.paddingBottom,e.width);return e.add(n+t.borderLeftWidth,s+t.borderTopWidth,-(t.borderRightWidth+t.borderLeftWidth+n+i),-(t.borderTopWidth+t.borderBottomWidth+s+a))},uat=function(r,t){return r===0?t.bounds:r===2?$y(t):k4(t)},hat=function(r,t){return r===0?t.bounds:r===2?$y(t):k4(t)},G2=function(r,t,e){var n=uat(Bf(r.styles.backgroundOrigin,t),r),i=hat(Bf(r.styles.backgroundClip,t),r),s=dat(Bf(r.styles.backgroundSize,t),e,n),a=s[0],o=s[1],h=vg(Bf(r.styles.backgroundPosition,t),n.width-a,n.height-o),f=fat(Bf(r.styles.backgroundRepeat,t),h,s,n,i),g=Math.round(n.left+h[0]),b=Math.round(n.top+h[1]);return[f,g,b,a,o]},xf=function(r){return ii(r)&&r.value===yf.AUTO},Wy=function(r){return typeof r=="number"},dat=function(r,t,e){var n=t[0],i=t[1],s=t[2],a=r[0],o=r[1];if(!a)return[0,0];if(hs(a)&&o&&hs(o))return[mi(a,e.width),mi(o,e.height)];var h=Wy(s);if(ii(a)&&(a.value===yf.CONTAIN||a.value===yf.COVER)){if(Wy(s)){var f=e.width/e.height;return f<s!=(a.value===yf.COVER)?[e.width,e.width/s]:[e.height*s,e.height]}return[e.width,e.height]}var g=Wy(n),b=Wy(i),C=g||b;if(xf(a)&&(!o||xf(o))){if(g&&b)return[n,i];if(!h&&!C)return[e.width,e.height];if(C&&h){var B=g?n:i*s,R=b?i:n/s;return[B,R]}var D=g?n:e.width,Q=b?i:e.height;return[D,Q]}if(h){var k=0,j=0;return hs(a)?k=mi(a,e.width):hs(o)&&(j=mi(o,e.height)),xf(a)?k=j*s:(!o||xf(o))&&(j=k/s),[k,j]}var et=null,st=null;if(hs(a)?et=mi(a,e.width):o&&hs(o)&&(st=mi(o,e.height)),et!==null&&(!o||xf(o))&&(st=g&&b?et/n*i:e.height),st!==null&&xf(a)&&(et=g&&b?st/i*n:e.width),et!==null&&st!==null)return[et,st];throw new Error("Unable to calculate background-size for element")},Bf=function(r,t){var e=r[t];return typeof e>"u"?r[0]:e},fat=function(r,t,e,n,i){var s=t[0],a=t[1],o=e[0],h=e[1];switch(r){case 2:return[new fr(Math.round(n.left),Math.round(n.top+a)),new fr(Math.round(n.left+n.width),Math.round(n.top+a)),new fr(Math.round(n.left+n.width),Math.round(h+n.top+a)),new fr(Math.round(n.left),Math.round(h+n.top+a))];case 3:return[new fr(Math.round(n.left+s),Math.round(n.top)),new fr(Math.round(n.left+s+o),Math.round(n.top)),new fr(Math.round(n.left+s+o),Math.round(n.height+n.top)),new fr(Math.round(n.left+s),Math.round(n.height+n.top))];case 1:return[new fr(Math.round(n.left+s),Math.round(n.top+a)),new fr(Math.round(n.left+s+o),Math.round(n.top+a)),new fr(Math.round(n.left+s+o),Math.round(n.top+a+h)),new fr(Math.round(n.left+s),Math.round(n.top+a+h))];default:return[new fr(Math.round(i.left),Math.round(i.top)),new fr(Math.round(i.left+i.width),Math.round(i.top)),new fr(Math.round(i.left+i.width),Math.round(i.height+i.top)),new fr(Math.round(i.left),Math.round(i.height+i.top))]}},pat="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",Q4="Hidden Text",gat=function(){function r(t){this._data={},this._document=t}return r.prototype.parseMetrics=function(t,e){var n=this._document.createElement("div"),i=this._document.createElement("img"),s=this._document.createElement("span"),a=this._document.body;n.style.visibility="hidden",n.style.fontFamily=t,n.style.fontSize=e,n.style.margin="0",n.style.padding="0",n.style.whiteSpace="nowrap",a.appendChild(n),i.src=pat,i.width=1,i.height=1,i.style.margin="0",i.style.padding="0",i.style.verticalAlign="baseline",s.style.fontFamily=t,s.style.fontSize=e,s.style.margin="0",s.style.padding="0",s.appendChild(this._document.createTextNode(Q4)),n.appendChild(s),n.appendChild(i);var o=i.offsetTop-s.offsetTop+2;n.removeChild(s),n.appendChild(this._document.createTextNode(Q4)),n.style.lineHeight="normal",i.style.verticalAlign="super";var h=i.offsetTop-n.offsetTop+2;return a.removeChild(n),{baseline:o,middle:h}},r.prototype.getMetrics=function(t,e){var n=t+" "+e;return typeof this._data[n]>"u"&&(this._data[n]=this.parseMetrics(t,e)),this._data[n]},r}(),z4=function(){function r(t,e){this.context=t,this.options=e}return r}(),mat=1e4,yat=function(r){Hc(t,r);function t(e,n){var i=r.call(this,e,n)||this;return i._activeEffects=[],i.canvas=n.canvas?n.canvas:document.createElement("canvas"),i.ctx=i.canvas.getContext("2d"),n.canvas||(i.canvas.width=Math.floor(n.width*n.scale),i.canvas.height=Math.floor(n.height*n.scale),i.canvas.style.width=n.width+"px",i.canvas.style.height=n.height+"px"),i.fontMetrics=new gat(document),i.ctx.scale(i.options.scale,i.options.scale),i.ctx.translate(-n.x,-n.y),i.ctx.textBaseline="bottom",i._activeEffects=[],i.context.logger.debug("Canvas renderer initialized ("+n.width+"x"+n.height+") with scale "+n.scale),i}return t.prototype.applyEffects=function(e){for(var n=this;this._activeEffects.length;)this.popEffect();e.forEach(function(i){return n.applyEffect(i)})},t.prototype.applyEffect=function(e){this.ctx.save(),sat(e)&&(this.ctx.globalAlpha=e.opacity),iat(e)&&(this.ctx.translate(e.offsetX,e.offsetY),this.ctx.transform(e.matrix[0],e.matrix[1],e.matrix[2],e.matrix[3],e.matrix[4],e.matrix[5]),this.ctx.translate(-e.offsetX,-e.offsetY)),P4(e)&&(this.path(e.path),this.ctx.clip()),this._activeEffects.push(e)},t.prototype.popEffect=function(){this._activeEffects.pop(),this.ctx.restore()},t.prototype.renderStack=function(e){return Go(this,void 0,void 0,function(){var n;return bo(this,function(i){switch(i.label){case 0:return n=e.element.container.styles,n.isVisible()?[4,this.renderStackContent(e)]:[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}})})},t.prototype.renderNode=function(e){return Go(this,void 0,void 0,function(){return bo(this,function(n){switch(n.label){case 0:if(xs(e.container.flags,16))debugger;return e.container.styles.isVisible()?[4,this.renderNodeBackgroundAndBorders(e)]:[3,3];case 1:return n.sent(),[4,this.renderNodeContent(e)];case 2:n.sent(),n.label=3;case 3:return[2]}})})},t.prototype.renderTextWithLetterSpacing=function(e,n,i){var s=this;if(n===0)this.ctx.fillText(e.text,e.bounds.left,e.bounds.top+i);else{var a=L2(e.text);a.reduce(function(o,h){return s.ctx.fillText(h,o,e.bounds.top+i),o+s.ctx.measureText(h).width},e.bounds.left)}},t.prototype.createFontStyle=function(e){var n=e.fontVariant.filter(function(a){return a==="normal"||a==="small-caps"}).join(""),i=xat(e.fontFamily).join(", "),s=_g(e.fontSize)?""+e.fontSize.number+e.fontSize.unit:e.fontSize.number+"px";return[[e.fontStyle,n,e.fontWeight,s,i].join(" "),i,s]},t.prototype.renderTextNode=function(e,n){return Go(this,void 0,void 0,function(){var i,s,a,o,h,f,g,b,C=this;return bo(this,function(B){return i=this.createFontStyle(n),s=i[0],a=i[1],o=i[2],this.ctx.font=s,this.ctx.direction=n.direction===1?"rtl":"ltr",this.ctx.textAlign="left",this.ctx.textBaseline="alphabetic",h=this.fontMetrics.getMetrics(a,o),f=h.baseline,g=h.middle,b=n.paintOrder,e.textBounds.forEach(function(R){b.forEach(function(D){switch(D){case 0:C.ctx.fillStyle=Ms(n.color),C.renderTextWithLetterSpacing(R,n.letterSpacing,f);var Q=n.textShadow;Q.length&&R.text.trim().length&&(Q.slice(0).reverse().forEach(function(k){C.ctx.shadowColor=Ms(k.color),C.ctx.shadowOffsetX=k.offsetX.number*C.options.scale,C.ctx.shadowOffsetY=k.offsetY.number*C.options.scale,C.ctx.shadowBlur=k.blur.number,C.renderTextWithLetterSpacing(R,n.letterSpacing,f)}),C.ctx.shadowColor="",C.ctx.shadowOffsetX=0,C.ctx.shadowOffsetY=0,C.ctx.shadowBlur=0),n.textDecorationLine.length&&(C.ctx.fillStyle=Ms(n.textDecorationColor||n.color),n.textDecorationLine.forEach(function(k){switch(k){case 1:C.ctx.fillRect(R.bounds.left,Math.round(R.bounds.top+f),R.bounds.width,1);break;case 2:C.ctx.fillRect(R.bounds.left,Math.round(R.bounds.top),R.bounds.width,1);break;case 3:C.ctx.fillRect(R.bounds.left,Math.ceil(R.bounds.top+g),R.bounds.width,1);break}}));break;case 1:n.webkitTextStrokeWidth&&R.text.trim().length&&(C.ctx.strokeStyle=Ms(n.webkitTextStrokeColor),C.ctx.lineWidth=n.webkitTextStrokeWidth,C.ctx.lineJoin=window.chrome?"miter":"round",C.ctx.strokeText(R.text,R.bounds.left,R.bounds.top+f)),C.ctx.strokeStyle="",C.ctx.lineWidth=0,C.ctx.lineJoin="miter";break}})}),[2]})})},t.prototype.renderReplacedElement=function(e,n,i){if(i&&e.intrinsicWidth>0&&e.intrinsicHeight>0){var s=$y(e),a=jy(n);this.path(a),this.ctx.save(),this.ctx.clip(),this.ctx.drawImage(i,0,0,e.intrinsicWidth,e.intrinsicHeight,s.left,s.top,s.width,s.height),this.ctx.restore()}},t.prototype.renderNodeContent=function(e){return Go(this,void 0,void 0,function(){var n,i,s,a,o,h,j,j,f,g,b,C,st,B,R,mt,D,Q,k,j,et,st,mt;return bo(this,function(pt){switch(pt.label){case 0:this.applyEffects(e.getEffects(4)),n=e.container,i=e.curves,s=n.styles,a=0,o=n.textNodes,pt.label=1;case 1:return a<o.length?(h=o[a],[4,this.renderTextNode(h,s)]):[3,4];case 2:pt.sent(),pt.label=3;case 3:return a++,[3,1];case 4:if(!(n instanceof s4))return[3,8];pt.label=5;case 5:return pt.trys.push([5,7,,8]),[4,this.context.cache.match(n.src)];case 6:return j=pt.sent(),this.renderReplacedElement(n,i,j),[3,8];case 7:return pt.sent(),this.context.logger.error("Error loading image "+n.src),[3,8];case 8:if(n instanceof o4&&this.renderReplacedElement(n,i,n.canvas),!(n instanceof a4))return[3,12];pt.label=9;case 9:return pt.trys.push([9,11,,12]),[4,this.context.cache.match(n.svg)];case 10:return j=pt.sent(),this.renderReplacedElement(n,i,j),[3,12];case 11:return pt.sent(),this.context.logger.error("Error loading svg "+n.svg.substring(0,255)),[3,12];case 12:return n instanceof h4&&n.tree?(f=new t(this.context,{scale:this.options.scale,backgroundColor:n.backgroundColor,x:0,y:0,width:n.width,height:n.height}),[4,f.render(n.tree)]):[3,14];case 13:g=pt.sent(),n.width&&n.height&&this.ctx.drawImage(g,0,0,n.width,n.height,n.bounds.left,n.bounds.top,n.bounds.width,n.bounds.height),pt.label=14;case 14:if(n instanceof M2&&(b=Math.min(n.bounds.width,n.bounds.height),n.type===Oy?n.checked&&(this.ctx.save(),this.path([new fr(n.bounds.left+b*.39363,n.bounds.top+b*.79),new fr(n.bounds.left+b*.16,n.bounds.top+b*.5549),new fr(n.bounds.left+b*.27347,n.bounds.top+b*.44071),new fr(n.bounds.left+b*.39694,n.bounds.top+b*.5649),new fr(n.bounds.left+b*.72983,n.bounds.top+b*.23),new fr(n.bounds.left+b*.84,n.bounds.top+b*.34085),new fr(n.bounds.left+b*.39363,n.bounds.top+b*.79)]),this.ctx.fillStyle=Ms(l4),this.ctx.fill(),this.ctx.restore()):n.type===Ny&&n.checked&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(n.bounds.left+b/2,n.bounds.top+b/2,b/4,0,Math.PI*2,!0),this.ctx.fillStyle=Ms(l4),this.ctx.fill(),this.ctx.restore())),_at(n)&&n.value.length){switch(C=this.createFontStyle(s),st=C[0],B=C[1],R=this.fontMetrics.getMetrics(st,B).baseline,this.ctx.font=st,this.ctx.fillStyle=Ms(s.color),this.ctx.textBaseline="alphabetic",this.ctx.textAlign=bat(n.styles.textAlign),mt=$y(n),D=0,n.styles.textAlign){case 1:D+=mt.width/2;break;case 2:D+=mt.width;break}Q=mt.add(D,0,0,-mt.height/2+1),this.ctx.save(),this.path([new fr(mt.left,mt.top),new fr(mt.left+mt.width,mt.top),new fr(mt.left+mt.width,mt.top+mt.height),new fr(mt.left,mt.top+mt.height)]),this.ctx.clip(),this.renderTextWithLetterSpacing(new Bg(n.value,Q),s.letterSpacing,R),this.ctx.restore(),this.ctx.textBaseline="alphabetic",this.ctx.textAlign="left"}if(!xs(n.styles.display,2048))return[3,20];if(n.styles.listStyleImage===null)return[3,19];if(k=n.styles.listStyleImage,k.type!==0)return[3,18];j=void 0,et=k.url,pt.label=15;case 15:return pt.trys.push([15,17,,18]),[4,this.context.cache.match(et)];case 16:return j=pt.sent(),this.ctx.drawImage(j,n.bounds.left-(j.width+10),n.bounds.top),[3,18];case 17:return pt.sent(),this.context.logger.error("Error loading list-style-image "+et),[3,18];case 18:return[3,20];case 19:e.listValue&&n.styles.listStyleType!==-1&&(st=this.createFontStyle(s)[0],this.ctx.font=st,this.ctx.fillStyle=Ms(s.color),this.ctx.textBaseline="middle",this.ctx.textAlign="right",mt=new LA(n.bounds.left,n.bounds.top+mi(n.styles.paddingTop,n.bounds.width),n.bounds.width,kM(s.lineHeight,s.fontSize.number)/2+1),this.renderTextWithLetterSpacing(new Bg(e.listValue,mt),s.letterSpacing,kM(s.lineHeight,s.fontSize.number)/2+2),this.ctx.textBaseline="bottom",this.ctx.textAlign="left"),pt.label=20;case 20:return[2]}})})},t.prototype.renderStackContent=function(e){return Go(this,void 0,void 0,function(){var n,i,k,s,a,k,o,h,k,f,g,k,b,C,k,B,R,k,D,Q,k;return bo(this,function(j){switch(j.label){case 0:if(xs(e.element.container.flags,16))debugger;return[4,this.renderNodeBackgroundAndBorders(e.element)];case 1:j.sent(),n=0,i=e.negativeZIndex,j.label=2;case 2:return n<i.length?(k=i[n],[4,this.renderStack(k)]):[3,5];case 3:j.sent(),j.label=4;case 4:return n++,[3,2];case 5:return[4,this.renderNodeContent(e.element)];case 6:j.sent(),s=0,a=e.nonInlineLevel,j.label=7;case 7:return s<a.length?(k=a[s],[4,this.renderNode(k)]):[3,10];case 8:j.sent(),j.label=9;case 9:return s++,[3,7];case 10:o=0,h=e.nonPositionedFloats,j.label=11;case 11:return o<h.length?(k=h[o],[4,this.renderStack(k)]):[3,14];case 12:j.sent(),j.label=13;case 13:return o++,[3,11];case 14:f=0,g=e.nonPositionedInlineLevel,j.label=15;case 15:return f<g.length?(k=g[f],[4,this.renderStack(k)]):[3,18];case 16:j.sent(),j.label=17;case 17:return f++,[3,15];case 18:b=0,C=e.inlineLevel,j.label=19;case 19:return b<C.length?(k=C[b],[4,this.renderNode(k)]):[3,22];case 20:j.sent(),j.label=21;case 21:return b++,[3,19];case 22:B=0,R=e.zeroOrAutoZIndexOrTransformedOrOpacity,j.label=23;case 23:return B<R.length?(k=R[B],[4,this.renderStack(k)]):[3,26];case 24:j.sent(),j.label=25;case 25:return B++,[3,23];case 26:D=0,Q=e.positiveZIndex,j.label=27;case 27:return D<Q.length?(k=Q[D],[4,this.renderStack(k)]):[3,30];case 28:j.sent(),j.label=29;case 29:return D++,[3,27];case 30:return[2]}})})},t.prototype.mask=function(e){this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.lineTo(this.canvas.width,0),this.ctx.lineTo(this.canvas.width,this.canvas.height),this.ctx.lineTo(0,this.canvas.height),this.ctx.lineTo(0,0),this.formatPath(e.slice(0).reverse()),this.ctx.closePath()},t.prototype.path=function(e){this.ctx.beginPath(),this.formatPath(e),this.ctx.closePath()},t.prototype.formatPath=function(e){var n=this;e.forEach(function(i,s){var a=cc(i)?i.start:i;s===0?n.ctx.moveTo(a.x,a.y):n.ctx.lineTo(a.x,a.y),cc(i)&&n.ctx.bezierCurveTo(i.startControl.x,i.startControl.y,i.endControl.x,i.endControl.y,i.end.x,i.end.y)})},t.prototype.renderRepeat=function(e,n,i,s){this.path(e),this.ctx.fillStyle=n,this.ctx.translate(i,s),this.ctx.fill(),this.ctx.translate(-i,-s)},t.prototype.resizeImage=function(e,n,i){var s;if(e.width===n&&e.height===i)return e;var a=(s=this.canvas.ownerDocument)!==null&&s!==void 0?s:document,o=a.createElement("canvas");o.width=Math.max(1,n),o.height=Math.max(1,i);var h=o.getContext("2d");return h.drawImage(e,0,0,e.width,e.height,0,0,n,i),o},t.prototype.renderBackgroundImage=function(e){return Go(this,void 0,void 0,function(){var n,i,s,a,o,h;return bo(this,function(f){switch(f.label){case 0:n=e.styles.backgroundImage.length-1,i=function(g){var b,C,B,It,ie,ae,Bt,vt,ft,R,It,ie,ae,Bt,vt,D,Q,k,j,et,st,mt,pt,yt,ft,Dt,It,ut,At,Bt,vt,ne,ie,ae,te,ce,le,Te,rt,wt,St,qt;return bo(this,function(Jt){switch(Jt.label){case 0:if(g.type!==0)return[3,5];b=void 0,C=g.url,Jt.label=1;case 1:return Jt.trys.push([1,3,,4]),[4,s.context.cache.match(C)];case 2:return b=Jt.sent(),[3,4];case 3:return Jt.sent(),s.context.logger.error("Error loading background-image "+C),[3,4];case 4:return b&&(B=G2(e,n,[b.width,b.height,b.width/b.height]),It=B[0],ie=B[1],ae=B[2],Bt=B[3],vt=B[4],ft=s.ctx.createPattern(s.resizeImage(b,Bt,vt),"repeat"),s.renderRepeat(It,ft,ie,ae)),[3,6];case 5:iit(g)?(R=G2(e,n,[null,null,null]),It=R[0],ie=R[1],ae=R[2],Bt=R[3],vt=R[4],D=Znt(g.angle,Bt,vt),Q=D[0],k=D[1],j=D[2],et=D[3],st=D[4],mt=document.createElement("canvas"),mt.width=Bt,mt.height=vt,pt=mt.getContext("2d"),yt=pt.createLinearGradient(k,et,j,st),TM(g.stops,Q).forEach(function(se){return yt.addColorStop(se.stop,Ms(se.color))}),pt.fillStyle=yt,pt.fillRect(0,0,Bt,vt),Bt>0&&vt>0&&(ft=s.ctx.createPattern(mt,"repeat"),s.renderRepeat(It,ft,ie,ae))):sit(g)&&(Dt=G2(e,n,[null,null,null]),It=Dt[0],ut=Dt[1],At=Dt[2],Bt=Dt[3],vt=Dt[4],ne=g.position.length===0?[g2]:g.position,ie=mi(ne[0],Bt),ae=mi(ne[ne.length-1],vt),te=tit(g,ie,ae,Bt,vt),ce=te[0],le=te[1],ce>0&&le>0&&(Te=s.ctx.createRadialGradient(ut+ie,At+ae,0,ut+ie,At+ae,ce),TM(g.stops,ce*2).forEach(function(se){return Te.addColorStop(se.stop,Ms(se.color))}),s.path(It),s.ctx.fillStyle=Te,ce!==le?(rt=e.bounds.left+.5*e.bounds.width,wt=e.bounds.top+.5*e.bounds.height,St=le/ce,qt=1/St,s.ctx.save(),s.ctx.translate(rt,wt),s.ctx.transform(1,0,0,St,0,0),s.ctx.translate(-rt,-wt),s.ctx.fillRect(ut,qt*(At-wt)+wt,Bt,vt*qt),s.ctx.restore()):s.ctx.fill())),Jt.label=6;case 6:return n--,[2]}})},s=this,a=0,o=e.styles.backgroundImage.slice(0).reverse(),f.label=1;case 1:return a<o.length?(h=o[a],[5,i(h)]):[3,4];case 2:f.sent(),f.label=3;case 3:return a++,[3,1];case 4:return[2]}})})},t.prototype.renderSolidBorder=function(e,n,i){return Go(this,void 0,void 0,function(){return bo(this,function(s){return this.path(N4(i,n)),this.ctx.fillStyle=Ms(e),this.ctx.fill(),[2]})})},t.prototype.renderDoubleBorder=function(e,n,i,s){return Go(this,void 0,void 0,function(){var a,o;return bo(this,function(h){switch(h.label){case 0:return n<3?[4,this.renderSolidBorder(e,i,s)]:[3,2];case 1:return h.sent(),[2];case 2:return a=cat(s,i),this.path(a),this.ctx.fillStyle=Ms(e),this.ctx.fill(),o=lat(s,i),this.path(o),this.ctx.fill(),[2]}})})},t.prototype.renderNodeBackgroundAndBorders=function(e){return Go(this,void 0,void 0,function(){var n,i,s,a,o,h,f,g,b=this;return bo(this,function(C){switch(C.label){case 0:return this.applyEffects(e.getEffects(2)),n=e.container.styles,i=!Ru(n.backgroundColor)||n.backgroundImage.length,s=[{style:n.borderTopStyle,color:n.borderTopColor,width:n.borderTopWidth},{style:n.borderRightStyle,color:n.borderRightColor,width:n.borderRightWidth},{style:n.borderBottomStyle,color:n.borderBottomColor,width:n.borderBottomWidth},{style:n.borderLeftStyle,color:n.borderLeftColor,width:n.borderLeftWidth}],a=vat(Bf(n.backgroundClip,0),e.curves),i||n.boxShadow.length?(this.ctx.save(),this.path(a),this.ctx.clip(),Ru(n.backgroundColor)||(this.ctx.fillStyle=Ms(n.backgroundColor),this.ctx.fill()),[4,this.renderBackgroundImage(e.container)]):[3,2];case 1:C.sent(),this.ctx.restore(),n.boxShadow.slice(0).reverse().forEach(function(B){b.ctx.save();var R=Vy(e.curves),D=B.inset?0:mat,Q=oat(R,-D+(B.inset?1:-1)*B.spread.number,(B.inset?1:-1)*B.spread.number,B.spread.number*(B.inset?-2:2),B.spread.number*(B.inset?-2:2));B.inset?(b.path(R),b.ctx.clip(),b.mask(Q)):(b.mask(R),b.ctx.clip(),b.path(Q)),b.ctx.shadowOffsetX=B.offsetX.number+D,b.ctx.shadowOffsetY=B.offsetY.number,b.ctx.shadowColor=Ms(B.color),b.ctx.shadowBlur=B.blur.number,b.ctx.fillStyle=B.inset?Ms(B.color):"rgba(0,0,0,1)",b.ctx.fill(),b.ctx.restore()}),C.label=2;case 2:o=0,h=0,f=s,C.label=3;case 3:return h<f.length?(g=f[h],g.style!==0&&!Ru(g.color)&&g.width>0?g.style!==2?[3,5]:[4,this.renderDashedDottedBorder(g.color,g.width,o,e.curves,2)]:[3,11]):[3,13];case 4:return C.sent(),[3,11];case 5:return g.style!==3?[3,7]:[4,this.renderDashedDottedBorder(g.color,g.width,o,e.curves,3)];case 6:return C.sent(),[3,11];case 7:return g.style!==4?[3,9]:[4,this.renderDoubleBorder(g.color,g.width,o,e.curves)];case 8:return C.sent(),[3,11];case 9:return[4,this.renderSolidBorder(g.color,o,e.curves)];case 10:C.sent(),C.label=11;case 11:o++,C.label=12;case 12:return h++,[3,3];case 13:return[2]}})})},t.prototype.renderDashedDottedBorder=function(e,n,i,s,a){return Go(this,void 0,void 0,function(){var o,h,f,g,b,C,B,R,D,Q,k,j,et,st,mt,pt,mt,pt;return bo(this,function(yt){return this.ctx.save(),o=Aat(s,i),h=N4(s,i),a===2&&(this.path(h),this.ctx.clip()),cc(h[0])?(f=h[0].start.x,g=h[0].start.y):(f=h[0].x,g=h[0].y),cc(h[1])?(b=h[1].end.x,C=h[1].end.y):(b=h[1].x,C=h[1].y),i===0||i===2?B=Math.abs(f-b):B=Math.abs(g-C),this.ctx.beginPath(),a===3?this.formatPath(o):this.formatPath(h.slice(0,2)),R=n<3?n*3:n*2,D=n<3?n*2:n,a===3&&(R=n,D=n),Q=!0,B<=R*2?Q=!1:B<=R*2+D?(k=B/(2*R+D),R*=k,D*=k):(j=Math.floor((B+D)/(R+D)),et=(B-j*R)/(j-1),st=(B-(j+1)*R)/j,D=st<=0||Math.abs(D-et)<Math.abs(D-st)?et:st),Q&&(a===3?this.ctx.setLineDash([0,R+D]):this.ctx.setLineDash([R,D])),a===3?(this.ctx.lineCap="round",this.ctx.lineWidth=n):this.ctx.lineWidth=n*2+1.1,this.ctx.strokeStyle=Ms(e),this.ctx.stroke(),this.ctx.setLineDash([]),a===2&&(cc(h[0])&&(mt=h[3],pt=h[0],this.ctx.beginPath(),this.formatPath([new fr(mt.end.x,mt.end.y),new fr(pt.start.x,pt.start.y)]),this.ctx.stroke()),cc(h[1])&&(mt=h[1],pt=h[2],this.ctx.beginPath(),this.formatPath([new fr(mt.end.x,mt.end.y),new fr(pt.start.x,pt.start.y)]),this.ctx.stroke())),this.ctx.restore(),[2]})})},t.prototype.render=function(e){return Go(this,void 0,void 0,function(){var n;return bo(this,function(i){switch(i.label){case 0:return this.options.backgroundColor&&(this.ctx.fillStyle=Ms(this.options.backgroundColor),this.ctx.fillRect(this.options.x,this.options.y,this.options.width,this.options.height)),n=aat(e),[4,this.renderStack(n)];case 1:return i.sent(),this.applyEffects([]),[2,this.canvas]}})})},t}(z4),_at=function(r){return r instanceof u4||r instanceof A4?!0:r instanceof M2&&r.type!==Ny&&r.type!==Oy},vat=function(r,t){switch(r){case 0:return Vy(t);case 2:return eat(t);case 1:default:return jy(t)}},bat=function(r){switch(r){case 1:return"center";case 2:return"right";case 0:default:return"left"}},wat=["-apple-system","system-ui"],xat=function(r){return/iPhone OS 15_(0|1)/.test(window.navigator.userAgent)?r.filter(function(t){return wat.indexOf(t)===-1}):r},Bat=function(r){Hc(t,r);function t(e,n){var i=r.call(this,e,n)||this;return i.canvas=n.canvas?n.canvas:document.createElement("canvas"),i.ctx=i.canvas.getContext("2d"),i.options=n,i.canvas.width=Math.floor(n.width*n.scale),i.canvas.height=Math.floor(n.height*n.scale),i.canvas.style.width=n.width+"px",i.canvas.style.height=n.height+"px",i.ctx.scale(i.options.scale,i.options.scale),i.ctx.translate(-n.x,-n.y),i.context.logger.debug("EXPERIMENTAL ForeignObject renderer initialized ("+n.width+"x"+n.height+" at "+n.x+","+n.y+") with scale "+n.scale),i}return t.prototype.render=function(e){return Go(this,void 0,void 0,function(){var n,i;return bo(this,function(s){switch(s.label){case 0:return n=I2(this.options.width*this.options.scale,this.options.height*this.options.scale,this.options.scale,this.options.scale,e),[4,Cat(n)];case 1:return i=s.sent(),this.options.backgroundColor&&(this.ctx.fillStyle=Ms(this.options.backgroundColor),this.ctx.fillRect(0,0,this.options.width*this.options.scale,this.options.height*this.options.scale)),this.ctx.drawImage(i,-this.options.x*this.options.scale,-this.options.y*this.options.scale),[2,this.canvas]}})})},t}(z4),Cat=function(r){return new Promise(function(t,e){var n=new Image;n.onload=function(){t(n)},n.onerror=e,n.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(new XMLSerializer().serializeToString(r))})},Eat=function(){function r(t){var e=t.id,n=t.enabled;this.id=e,this.enabled=n,this.start=Date.now()}return r.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.enabled&&(typeof window<"u"&&window.console&&typeof console.debug=="function"?console.debug.apply(console,ny([this.id,this.getTime()+"ms"],t)):this.info.apply(this,t))},r.prototype.getTime=function(){return Date.now()-this.start},r.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.enabled&&typeof window<"u"&&window.console&&typeof console.info=="function"&&console.info.apply(console,ny([this.id,this.getTime()+"ms"],t))},r.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.enabled&&(typeof window<"u"&&window.console&&typeof console.warn=="function"?console.warn.apply(console,ny([this.id,this.getTime()+"ms"],t)):this.info.apply(this,t))},r.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.enabled&&(typeof window<"u"&&window.console&&typeof console.error=="function"?console.error.apply(console,ny([this.id,this.getTime()+"ms"],t)):this.info.apply(this,t))},r.instances={},r}(),Sat=function(){function r(t,e){var n;this.windowBounds=e,this.instanceName="#"+r.instanceCount++,this.logger=new Eat({id:this.instanceName,enabled:t.logging}),this.cache=(n=t.cache)!==null&&n!==void 0?n:new Kot(this,t)}return r.instanceCount=1,r}(),Tat=function(r,t){return t===void 0&&(t={}),Iat(r,t)};typeof window<"u"&&M4.setContext(window);var Iat=function(r,t){return Go(void 0,void 0,void 0,function(){var e,n,i,s,a,o,h,f,g,b,C,B,R,D,Q,k,j,et,st,mt,yt,pt,yt,ft,Dt,It,ut,At,Bt,vt,ne,ie,ae,te,ce,le,Te,rt,wt,St;return bo(this,function(qt){switch(qt.label){case 0:if(!r||typeof r!="object")return[2,Promise.reject("Invalid element provided as first argument")];if(e=r.ownerDocument,!e)throw new Error("Element is not attached to a Document");if(n=e.defaultView,!n)throw new Error("Document is not attached to a Window");return i={allowTaint:(ft=t.allowTaint)!==null&&ft!==void 0?ft:!1,imageTimeout:(Dt=t.imageTimeout)!==null&&Dt!==void 0?Dt:15e3,proxy:t.proxy,useCORS:(It=t.useCORS)!==null&&It!==void 0?It:!1},s=Ww({logging:(ut=t.logging)!==null&&ut!==void 0?ut:!0,cache:t.cache},i),a={windowWidth:(At=t.windowWidth)!==null&&At!==void 0?At:n.innerWidth,windowHeight:(Bt=t.windowHeight)!==null&&Bt!==void 0?Bt:n.innerHeight,scrollX:(vt=t.scrollX)!==null&&vt!==void 0?vt:n.pageXOffset,scrollY:(ne=t.scrollY)!==null&&ne!==void 0?ne:n.pageYOffset},o=new LA(a.scrollX,a.scrollY,a.windowWidth,a.windowHeight),h=new Sat(s,o),f=(ie=t.foreignObjectRendering)!==null&&ie!==void 0?ie:!1,g={allowTaint:(ae=t.allowTaint)!==null&&ae!==void 0?ae:!1,onclone:t.onclone,ignoreElements:t.ignoreElements,inlineImages:f,copyStyles:f},h.logger.debug("Starting document clone with size "+o.width+"x"+o.height+" scrolled to "+-o.left+","+-o.top),b=new L4(h,r,g),C=b.clonedReferenceElement,C?[4,b.toIFrame(e,o)]:[2,Promise.reject("Unable to find element in cloned iframe")];case 1:return B=qt.sent(),R=U2(C)||Lot(C)?ort(C.ownerDocument):iy(h,C),D=R.width,Q=R.height,k=R.left,j=R.top,et=Lat(h,C,t.backgroundColor),st={canvas:t.canvas,backgroundColor:et,scale:(ce=(te=t.scale)!==null&&te!==void 0?te:n.devicePixelRatio)!==null&&ce!==void 0?ce:1,x:((le=t.x)!==null&&le!==void 0?le:0)+k,y:((Te=t.y)!==null&&Te!==void 0?Te:0)+j,width:(rt=t.width)!==null&&rt!==void 0?rt:Math.ceil(D),height:(wt=t.height)!==null&&wt!==void 0?wt:Math.ceil(Q)},f?(h.logger.debug("Document cloned, using foreign object rendering"),yt=new Bat(h,st),[4,yt.render(C)]):[3,3];case 2:return mt=qt.sent(),[3,5];case 3:return h.logger.debug("Document cloned, element located at "+k+","+j+" with size "+D+"x"+Q+" using computed rendering"),h.logger.debug("Starting DOM parsing"),pt=f4(h,C),et===pt.styles.backgroundColor&&(pt.styles.backgroundColor=MA.TRANSPARENT),h.logger.debug("Starting renderer for element at "+st.x+","+st.y+" with size "+st.width+"x"+st.height),yt=new yat(h,st),[4,yt.render(pt)];case 4:mt=qt.sent(),qt.label=5;case 5:return(!((St=t.removeContainer)!==null&&St!==void 0)||St)&&(L4.destroy(B)||h.logger.error("Cannot detach cloned iframe as it is not in the DOM anymore")),h.logger.debug("Finished rendering"),[2,mt]}})})},Lat=function(r,t,e){var n=t.ownerDocument,i=n.documentElement?bg(r,getComputedStyle(n.documentElement).backgroundColor):MA.TRANSPARENT,s=n.body?bg(r,getComputedStyle(n.body).backgroundColor):MA.TRANSPARENT,a=typeof e=="string"?bg(r,e):e===null?MA.TRANSPARENT:4294967295;return t===n.documentElement?Ru(i)?Ru(s)?a:s:i:a};const Fat=Object.freeze(Object.defineProperty({__proto__:null,default:Tat},Symbol.toStringTag,{value:"Module"}));/*! @license DOMPurify 2.4.5 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/2.4.5/LICENSE */function ku(r){"@babel/helpers - typeof";return ku=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ku(r)}function V2(r,t){return V2=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e},V2(r,t)}function Mat(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Xy(r,t,e){return Mat()?Xy=Reflect.construct:Xy=function(n,i,s){var a=[null];a.push.apply(a,i);var o=Function.bind.apply(n,a),h=new o;return s&&V2(h,s.prototype),h},Xy.apply(null,arguments)}function Vc(r){return Pat(r)||Uat(r)||Rat(r)||Dat()}function Pat(r){if(Array.isArray(r))return j2(r)}function Uat(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function Rat(r,t){if(r){if(typeof r=="string")return j2(r,t);var e=Object.prototype.toString.call(r).slice(8,-1);if(e==="Object"&&r.constructor&&(e=r.constructor.name),e==="Map"||e==="Set")return Array.from(r);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return j2(r,t)}}function j2(r,t){(t==null||t>r.length)&&(t=r.length);for(var e=0,n=new Array(t);e<t;e++)n[e]=r[e];return n}function Dat(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Oat=Object.hasOwnProperty,H4=Object.setPrototypeOf,Nat=Object.isFrozen,kat=Object.getPrototypeOf,Qat=Object.getOwnPropertyDescriptor,qo=Object.freeze,jc=Object.seal,zat=Object.create,G4=typeof Reflect<"u"&&Reflect,Jy=G4.apply,q2=G4.construct;Jy||(Jy=function(r,t,e){return r.apply(t,e)}),qo||(qo=function(r){return r}),jc||(jc=function(r){return r}),q2||(q2=function(r,t){return Xy(r,Vc(t))});var Hat=Ac(Array.prototype.forEach),V4=Ac(Array.prototype.pop),Tg=Ac(Array.prototype.push),Yy=Ac(String.prototype.toLowerCase),K2=Ac(String.prototype.toString),Gat=Ac(String.prototype.match),qc=Ac(String.prototype.replace),Vat=Ac(String.prototype.indexOf),jat=Ac(String.prototype.trim),Ko=Ac(RegExp.prototype.test),$2=qat(TypeError);function Ac(r){return function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return Jy(r,t,n)}}function qat(r){return function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return q2(r,e)}}function fn(r,t,e){e=e||Yy,H4&&H4(r,null);for(var n=t.length;n--;){var i=t[n];if(typeof i=="string"){var s=e(i);s!==i&&(Nat(t)||(t[n]=s),i=s)}r[i]=!0}return r}function Rh(r){var t=zat(null),e;for(e in r)Jy(Oat,r,[e])===!0&&(t[e]=r[e]);return t}function Zy(r,t){for(;r!==null;){var e=Qat(r,t);if(e){if(e.get)return Ac(e.get);if(typeof e.value=="function")return Ac(e.value)}r=kat(r)}function n(i){return console.warn("fallback value for",i),null}return n}var j4=qo(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),W2=qo(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),X2=qo(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),Kat=qo(["animate","color-profile","cursor","discard","fedropshadow","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),J2=qo(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover"]),$at=qo(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),q4=qo(["#text"]),K4=qo(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","xmlns","slot"]),Y2=qo(["accent-height","accumulate","additive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),$4=qo(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),t1=qo(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),Wat=jc(/\{\{[\w\W]*|[\w\W]*\}\}/gm),Xat=jc(/<%[\w\W]*|[\w\W]*%>/gm),Jat=jc(/\${[\w\W]*}/gm),Yat=jc(/^data-[\-\w.\u00B7-\uFFFF]/),Zat=jc(/^aria-[\-\w]+$/),tct=jc(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),ect=jc(/^(?:\w+script|data):/i),rct=jc(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),nct=jc(/^html$/i),ict=function(){return typeof window>"u"?null:window},sct=function(r,t){if(ku(r)!=="object"||typeof r.createPolicy!="function")return null;var e=null,n="data-tt-policy-suffix";t.currentScript&&t.currentScript.hasAttribute(n)&&(e=t.currentScript.getAttribute(n));var i="dompurify"+(e?"#"+e:"");try{return r.createPolicy(i,{createHTML:function(s){return s},createScriptURL:function(s){return s}})}catch{return console.warn("TrustedTypes policy "+i+" could not be created."),null}};function W4(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:ict(),t=function(Rt){return W4(Rt)};if(t.version="2.4.5",t.removed=[],!r||!r.document||r.document.nodeType!==9)return t.isSupported=!1,t;var e=r.document,n=r.document,i=r.DocumentFragment,s=r.HTMLTemplateElement,a=r.Node,o=r.Element,h=r.NodeFilter,f=r.NamedNodeMap,g=f===void 0?r.NamedNodeMap||r.MozNamedAttrMap:f,b=r.HTMLFormElement,C=r.DOMParser,B=r.trustedTypes,R=o.prototype,D=Zy(R,"cloneNode"),Q=Zy(R,"nextSibling"),k=Zy(R,"childNodes"),j=Zy(R,"parentNode");if(typeof s=="function"){var et=n.createElement("template");et.content&&et.content.ownerDocument&&(n=et.content.ownerDocument)}var st=sct(B,e),mt=st?st.createHTML(""):"",pt=n,yt=pt.implementation,ft=pt.createNodeIterator,Dt=pt.createDocumentFragment,It=pt.getElementsByTagName,ut=e.importNode,At={};try{At=Rh(n).documentMode?n.documentMode:{}}catch{}var Bt={};t.isSupported=typeof j=="function"&&yt&&typeof yt.createHTMLDocument<"u"&&At!==9;var vt=Wat,ne=Xat,ie=Jat,ae=Yat,te=Zat,ce=ect,le=rct,Te=tct,rt=null,wt=fn({},[].concat(Vc(j4),Vc(W2),Vc(X2),Vc(J2),Vc(q4))),St=null,qt=fn({},[].concat(Vc(K4),Vc(Y2),Vc($4),Vc(t1))),Jt=Object.seal(Object.create(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),se=null,Ae=null,oe=!0,Ce=!0,Pe=!1,Ve=!0,Ke=!1,rr=!1,_e=!1,Ut=!1,pr=!1,ir=!1,Se=!1,Kt=!0,Ie=!1,ke="user-content-",He=!0,De=!1,xr={},Pr=null,Or=fn({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]),nn=null,Br=fn({},["audio","video","img","source","image","track"]),Ur=null,je=fn({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),Ee="http://www.w3.org/1998/Math/MathML",Nr="http://www.w3.org/2000/svg",Vr="http://www.w3.org/1999/xhtml",qr=Vr,rn=!1,Fe=null,Ze=fn({},[Ee,Nr,Vr],K2),ur,Jr=["application/xhtml+xml","text/html"],Un="text/html",qe,sn=null,_t=n.createElement("form"),tt=function(Rt){return Rt instanceof RegExp||Rt instanceof Function},at=function(Rt){sn&&sn===Rt||((!Rt||ku(Rt)!=="object")&&(Rt={}),Rt=Rh(Rt),ur=Jr.indexOf(Rt.PARSER_MEDIA_TYPE)===-1?ur=Un:ur=Rt.PARSER_MEDIA_TYPE,qe=ur==="application/xhtml+xml"?K2:Yy,rt="ALLOWED_TAGS"in Rt?fn({},Rt.ALLOWED_TAGS,qe):wt,St="ALLOWED_ATTR"in Rt?fn({},Rt.ALLOWED_ATTR,qe):qt,Fe="ALLOWED_NAMESPACES"in Rt?fn({},Rt.ALLOWED_NAMESPACES,K2):Ze,Ur="ADD_URI_SAFE_ATTR"in Rt?fn(Rh(je),Rt.ADD_URI_SAFE_ATTR,qe):je,nn="ADD_DATA_URI_TAGS"in Rt?fn(Rh(Br),Rt.ADD_DATA_URI_TAGS,qe):Br,Pr="FORBID_CONTENTS"in Rt?fn({},Rt.FORBID_CONTENTS,qe):Or,se="FORBID_TAGS"in Rt?fn({},Rt.FORBID_TAGS,qe):{},Ae="FORBID_ATTR"in Rt?fn({},Rt.FORBID_ATTR,qe):{},xr="USE_PROFILES"in Rt?Rt.USE_PROFILES:!1,oe=Rt.ALLOW_ARIA_ATTR!==!1,Ce=Rt.ALLOW_DATA_ATTR!==!1,Pe=Rt.ALLOW_UNKNOWN_PROTOCOLS||!1,Ve=Rt.ALLOW_SELF_CLOSE_IN_ATTR!==!1,Ke=Rt.SAFE_FOR_TEMPLATES||!1,rr=Rt.WHOLE_DOCUMENT||!1,pr=Rt.RETURN_DOM||!1,ir=Rt.RETURN_DOM_FRAGMENT||!1,Se=Rt.RETURN_TRUSTED_TYPE||!1,Ut=Rt.FORCE_BODY||!1,Kt=Rt.SANITIZE_DOM!==!1,Ie=Rt.SANITIZE_NAMED_PROPS||!1,He=Rt.KEEP_CONTENT!==!1,De=Rt.IN_PLACE||!1,Te=Rt.ALLOWED_URI_REGEXP||Te,qr=Rt.NAMESPACE||Vr,Jt=Rt.CUSTOM_ELEMENT_HANDLING||{},Rt.CUSTOM_ELEMENT_HANDLING&&tt(Rt.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(Jt.tagNameCheck=Rt.CUSTOM_ELEMENT_HANDLING.tagNameCheck),Rt.CUSTOM_ELEMENT_HANDLING&&tt(Rt.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(Jt.attributeNameCheck=Rt.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),Rt.CUSTOM_ELEMENT_HANDLING&&typeof Rt.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(Jt.allowCustomizedBuiltInElements=Rt.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),Ke&&(Ce=!1),ir&&(pr=!0),xr&&(rt=fn({},Vc(q4)),St=[],xr.html===!0&&(fn(rt,j4),fn(St,K4)),xr.svg===!0&&(fn(rt,W2),fn(St,Y2),fn(St,t1)),xr.svgFilters===!0&&(fn(rt,X2),fn(St,Y2),fn(St,t1)),xr.mathMl===!0&&(fn(rt,J2),fn(St,$4),fn(St,t1))),Rt.ADD_TAGS&&(rt===wt&&(rt=Rh(rt)),fn(rt,Rt.ADD_TAGS,qe)),Rt.ADD_ATTR&&(St===qt&&(St=Rh(St)),fn(St,Rt.ADD_ATTR,qe)),Rt.ADD_URI_SAFE_ATTR&&fn(Ur,Rt.ADD_URI_SAFE_ATTR,qe),Rt.FORBID_CONTENTS&&(Pr===Or&&(Pr=Rh(Pr)),fn(Pr,Rt.FORBID_CONTENTS,qe)),He&&(rt["#text"]=!0),rr&&fn(rt,["html","head","body"]),rt.table&&(fn(rt,["tbody"]),delete se.tbody),qo&&qo(Rt),sn=Rt)},gt=fn({},["mi","mo","mn","ms","mtext"]),Tt=fn({},["foreignobject","desc","title","annotation-xml"]),Ft=fn({},["title","style","font","a","script"]),Ht=fn({},W2);fn(Ht,X2),fn(Ht,Kat);var Vt=fn({},J2);fn(Vt,$at);var Qt=function(Rt){var Qe=j(Rt);(!Qe||!Qe.tagName)&&(Qe={namespaceURI:qr,tagName:"template"});var Be=Yy(Rt.tagName),Er=Yy(Qe.tagName);return Fe[Rt.namespaceURI]?Rt.namespaceURI===Nr?Qe.namespaceURI===Vr?Be==="svg":Qe.namespaceURI===Ee?Be==="svg"&&(Er==="annotation-xml"||gt[Er]):!!Ht[Be]:Rt.namespaceURI===Ee?Qe.namespaceURI===Vr?Be==="math":Qe.namespaceURI===Nr?Be==="math"&&Tt[Er]:!!Vt[Be]:Rt.namespaceURI===Vr?Qe.namespaceURI===Nr&&!Tt[Er]||Qe.namespaceURI===Ee&&!gt[Er]?!1:!Vt[Be]&&(Ft[Be]||!Ht[Be]):!!(ur==="application/xhtml+xml"&&Fe[Rt.namespaceURI]):!1},$t=function(Rt){Tg(t.removed,{element:Rt});try{Rt.parentNode.removeChild(Rt)}catch{try{Rt.outerHTML=mt}catch{Rt.remove()}}},fe=function(Rt,Qe){try{Tg(t.removed,{attribute:Qe.getAttributeNode(Rt),from:Qe})}catch{Tg(t.removed,{attribute:null,from:Qe})}if(Qe.removeAttribute(Rt),Rt==="is"&&!St[Rt])if(pr||ir)try{$t(Qe)}catch{}else try{Qe.setAttribute(Rt,"")}catch{}},ye=function(Rt){var Qe,Be;if(Ut)Rt="<remove></remove>"+Rt;else{var Er=Gat(Rt,/^[\r\n\t ]+/);Be=Er&&Er[0]}ur==="application/xhtml+xml"&&qr===Vr&&(Rt='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+Rt+"</body></html>");var Kr=st?st.createHTML(Rt):Rt;if(qr===Vr)try{Qe=new C().parseFromString(Kr,ur)}catch{}if(!Qe||!Qe.documentElement){Qe=yt.createDocument(qr,"template",null);try{Qe.documentElement.innerHTML=rn?mt:Kr}catch{}}var Sn=Qe.body||Qe.documentElement;return Rt&&Be&&Sn.insertBefore(n.createTextNode(Be),Sn.childNodes[0]||null),qr===Vr?It.call(Qe,rr?"html":"body")[0]:rr?Qe.documentElement:Sn},we=function(Rt){return ft.call(Rt.ownerDocument||Rt,Rt,h.SHOW_ELEMENT|h.SHOW_COMMENT|h.SHOW_TEXT,null,!1)},hr=function(Rt){return Rt instanceof b&&(typeof Rt.nodeName!="string"||typeof Rt.textContent!="string"||typeof Rt.removeChild!="function"||!(Rt.attributes instanceof g)||typeof Rt.removeAttribute!="function"||typeof Rt.setAttribute!="function"||typeof Rt.namespaceURI!="string"||typeof Rt.insertBefore!="function"||typeof Rt.hasChildNodes!="function")},dr=function(Rt){return ku(a)==="object"?Rt instanceof a:Rt&&ku(Rt)==="object"&&typeof Rt.nodeType=="number"&&typeof Rt.nodeName=="string"},Je=function(Rt,Qe,Be){Bt[Rt]&&Hat(Bt[Rt],function(Er){Er.call(t,Qe,Be,sn)})},or=function(Rt){var Qe;if(Je("beforeSanitizeElements",Rt,null),hr(Rt)||Ko(/[\u0080-\uFFFF]/,Rt.nodeName))return $t(Rt),!0;var Be=qe(Rt.nodeName);if(Je("uponSanitizeElement",Rt,{tagName:Be,allowedTags:rt}),Rt.hasChildNodes()&&!dr(Rt.firstElementChild)&&(!dr(Rt.content)||!dr(Rt.content.firstElementChild))&&Ko(/<[/\w]/g,Rt.innerHTML)&&Ko(/<[/\w]/g,Rt.textContent)||Be==="select"&&Ko(/<template/i,Rt.innerHTML))return $t(Rt),!0;if(!rt[Be]||se[Be]){if(!se[Be]&&Rr(Be)&&(Jt.tagNameCheck instanceof RegExp&&Ko(Jt.tagNameCheck,Be)||Jt.tagNameCheck instanceof Function&&Jt.tagNameCheck(Be)))return!1;if(He&&!Pr[Be]){var Er=j(Rt)||Rt.parentNode,Kr=k(Rt)||Rt.childNodes;if(Kr&&Er)for(var Sn=Kr.length,Rn=Sn-1;Rn>=0;--Rn)Er.insertBefore(D(Kr[Rn],!0),Q(Rt))}return $t(Rt),!0}return Rt instanceof o&&!Qt(Rt)||(Be==="noscript"||Be==="noembed")&&Ko(/<\/no(script|embed)/i,Rt.innerHTML)?($t(Rt),!0):(Ke&&Rt.nodeType===3&&(Qe=Rt.textContent,Qe=qc(Qe,vt," "),Qe=qc(Qe,ne," "),Qe=qc(Qe,ie," "),Rt.textContent!==Qe&&(Tg(t.removed,{element:Rt.cloneNode()}),Rt.textContent=Qe)),Je("afterSanitizeElements",Rt,null),!1)},_r=function(Rt,Qe,Be){if(Kt&&(Qe==="id"||Qe==="name")&&(Be in n||Be in _t))return!1;if(!(Ce&&!Ae[Qe]&&Ko(ae,Qe))&&!(oe&&Ko(te,Qe))){if(!St[Qe]||Ae[Qe]){if(!(Rr(Rt)&&(Jt.tagNameCheck instanceof RegExp&&Ko(Jt.tagNameCheck,Rt)||Jt.tagNameCheck instanceof Function&&Jt.tagNameCheck(Rt))&&(Jt.attributeNameCheck instanceof RegExp&&Ko(Jt.attributeNameCheck,Qe)||Jt.attributeNameCheck instanceof Function&&Jt.attributeNameCheck(Qe))||Qe==="is"&&Jt.allowCustomizedBuiltInElements&&(Jt.tagNameCheck instanceof RegExp&&Ko(Jt.tagNameCheck,Be)||Jt.tagNameCheck instanceof Function&&Jt.tagNameCheck(Be))))return!1}else if(!Ur[Qe]&&!Ko(Te,qc(Be,le,""))&&!((Qe==="src"||Qe==="xlink:href"||Qe==="href")&&Rt!=="script"&&Vat(Be,"data:")===0&&nn[Rt])&&!(Pe&&!Ko(ce,qc(Be,le,"")))&&Be)return!1}return!0},Rr=function(Rt){return Rt.indexOf("-")>0},jr=function(Rt){var Qe,Be,Er,Kr;Je("beforeSanitizeAttributes",Rt,null);var Sn=Rt.attributes;if(Sn){var Rn={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:St};for(Kr=Sn.length;Kr--;){Qe=Sn[Kr];var Vn=Qe,kn=Vn.name,Qn=Vn.namespaceURI;if(Be=kn==="value"?Qe.value:jat(Qe.value),Er=qe(kn),Rn.attrName=Er,Rn.attrValue=Be,Rn.keepAttr=!0,Rn.forceKeepAttr=void 0,Je("uponSanitizeAttribute",Rt,Rn),Be=Rn.attrValue,!Rn.forceKeepAttr&&(fe(kn,Rt),!!Rn.keepAttr)){if(!Ve&&Ko(/\/>/i,Be)){fe(kn,Rt);continue}Ke&&(Be=qc(Be,vt," "),Be=qc(Be,ne," "),Be=qc(Be,ie," "));var Yr=qe(Rt.nodeName);if(_r(Yr,Er,Be)){if(Ie&&(Er==="id"||Er==="name")&&(fe(kn,Rt),Be=ke+Be),st&&ku(B)==="object"&&typeof B.getAttributeType=="function"&&!Qn)switch(B.getAttributeType(Yr,Er)){case"TrustedHTML":Be=st.createHTML(Be);break;case"TrustedScriptURL":Be=st.createScriptURL(Be);break}try{Qn?Rt.setAttributeNS(Qn,kn,Be):Rt.setAttribute(kn,Be),V4(t.removed)}catch{}}}}Je("afterSanitizeAttributes",Rt,null)}},Fr=function Rt(Qe){var Be,Er=we(Qe);for(Je("beforeSanitizeShadowDOM",Qe,null);Be=Er.nextNode();)Je("uponSanitizeShadowNode",Be,null),!or(Be)&&(Be.content instanceof i&&Rt(Be.content),jr(Be));Je("afterSanitizeShadowDOM",Qe,null)};return t.sanitize=function(Rt){var Qe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},Be,Er,Kr,Sn,Rn;if(rn=!Rt,rn&&(Rt="<!-->"),typeof Rt!="string"&&!dr(Rt)){if(typeof Rt.toString!="function")throw $2("toString is not a function");if(Rt=Rt.toString(),typeof Rt!="string")throw $2("dirty is not a string, aborting")}if(!t.isSupported){if(ku(r.toStaticHTML)==="object"||typeof r.toStaticHTML=="function"){if(typeof Rt=="string")return r.toStaticHTML(Rt);if(dr(Rt))return r.toStaticHTML(Rt.outerHTML)}return Rt}if(_e||at(Qe),t.removed=[],typeof Rt=="string"&&(De=!1),De){if(Rt.nodeName){var Vn=qe(Rt.nodeName);if(!rt[Vn]||se[Vn])throw $2("root node is forbidden and cannot be sanitized in-place")}}else if(Rt instanceof a)Be=ye("<!---->"),Er=Be.ownerDocument.importNode(Rt,!0),Er.nodeType===1&&Er.nodeName==="BODY"||Er.nodeName==="HTML"?Be=Er:Be.appendChild(Er);else{if(!pr&&!Ke&&!rr&&Rt.indexOf("<")===-1)return st&&Se?st.createHTML(Rt):Rt;if(Be=ye(Rt),!Be)return pr?null:Se?mt:""}Be&&Ut&&$t(Be.firstChild);for(var kn=we(De?Rt:Be);Kr=kn.nextNode();)Kr.nodeType===3&&Kr===Sn||or(Kr)||(Kr.content instanceof i&&Fr(Kr.content),jr(Kr),Sn=Kr);if(Sn=null,De)return Rt;if(pr){if(ir)for(Rn=Dt.call(Be.ownerDocument);Be.firstChild;)Rn.appendChild(Be.firstChild);else Rn=Be;return(St.shadowroot||St.shadowrootmod)&&(Rn=ut.call(e,Rn,!0)),Rn}var Qn=rr?Be.outerHTML:Be.innerHTML;return rr&&rt["!doctype"]&&Be.ownerDocument&&Be.ownerDocument.doctype&&Be.ownerDocument.doctype.name&&Ko(nct,Be.ownerDocument.doctype.name)&&(Qn="<!DOCTYPE "+Be.ownerDocument.doctype.name+`>
`+Qn),Ke&&(Qn=qc(Qn,vt," "),Qn=qc(Qn,ne," "),Qn=qc(Qn,ie," ")),st&&Se?st.createHTML(Qn):Qn},t.setConfig=function(Rt){at(Rt),_e=!0},t.clearConfig=function(){sn=null,_e=!1},t.isValidAttribute=function(Rt,Qe,Be){sn||at({});var Er=qe(Rt),Kr=qe(Qe);return _r(Er,Kr,Be)},t.addHook=function(Rt,Qe){typeof Qe=="function"&&(Bt[Rt]=Bt[Rt]||[],Tg(Bt[Rt],Qe))},t.removeHook=function(Rt){if(Bt[Rt])return V4(Bt[Rt])},t.removeHooks=function(Rt){Bt[Rt]&&(Bt[Rt]=[])},t.removeAllHooks=function(){Bt={}},t}var oct=W4();const act=Object.freeze(Object.defineProperty({__proto__:null,default:oct},Symbol.toStringTag,{value:"Module"}));var Ig=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function X4(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var e1=function(r){return r&&r.Math==Math&&r},Bs=e1(typeof globalThis=="object"&&globalThis)||e1(typeof window=="object"&&window)||e1(typeof self=="object"&&self)||e1(typeof Ig=="object"&&Ig)||function(){return this}()||Ig||Function("return this")(),Cf={},Yi=function(r){try{return!!r()}catch{return!0}},cct=Yi,zl=!cct(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),lct=Yi,r1=!lct(function(){var r=(function(){}).bind();return typeof r!="function"||r.hasOwnProperty("prototype")}),Act=r1,n1=Function.prototype.call,Ws=Act?n1.bind(n1):function(){return n1.apply(n1,arguments)},J4={},Y4={}.propertyIsEnumerable,Z4=Object.getOwnPropertyDescriptor,uct=Z4&&!Y4.call({1:2},1);J4.f=uct?function(r){var t=Z4(this,r);return!!t&&t.enumerable}:Y4;var i1=function(r,t){return{enumerable:!(r&1),configurable:!(r&2),writable:!(r&4),value:t}},tP=r1,eP=Function.prototype,Z2=eP.call,hct=tP&&eP.bind.bind(Z2,Z2),Zi=tP?hct:function(r){return function(){return Z2.apply(r,arguments)}},rP=Zi,dct=rP({}.toString),fct=rP("".slice),Dh=function(r){return fct(dct(r),8,-1)},pct=Zi,gct=Yi,mct=Dh,tx=Object,yct=pct("".split),nP=gct(function(){return!tx("z").propertyIsEnumerable(0)})?function(r){return mct(r)=="String"?yct(r,""):tx(r)}:tx,Oh=function(r){return r==null},_ct=Oh,vct=TypeError,Hl=function(r){if(_ct(r))throw vct("Can't call method on "+r);return r},bct=nP,wct=Hl,Lg=function(r){return bct(wct(r))},ex=typeof document=="object"&&document.all,xct=typeof ex>"u"&&ex!==void 0,iP={all:ex,IS_HTMLDDA:xct},sP=iP,Bct=sP.all,zi=sP.IS_HTMLDDA?function(r){return typeof r=="function"||r===Bct}:function(r){return typeof r=="function"},oP=zi,aP=iP,Cct=aP.all,UA=aP.IS_HTMLDDA?function(r){return typeof r=="object"?r!==null:oP(r)||r===Cct}:function(r){return typeof r=="object"?r!==null:oP(r)},rx=Bs,Ect=zi,Sct=function(r){return Ect(r)?r:void 0},Nh=function(r,t){return arguments.length<2?Sct(rx[r]):rx[r]&&rx[r][t]},Tct=Zi,s1=Tct({}.isPrototypeOf),o1=typeof navigator<"u"&&String(navigator.userAgent)||"",cP=Bs,nx=o1,lP=cP.process,AP=cP.Deno,uP=lP&&lP.versions||AP&&AP.version,hP=uP&&uP.v8,Kc,a1;hP&&(Kc=hP.split("."),a1=Kc[0]>0&&Kc[0]<4?1:+(Kc[0]+Kc[1])),!a1&&nx&&(Kc=nx.match(/Edge\/(\d+)/),(!Kc||Kc[1]>=74)&&(Kc=nx.match(/Chrome\/(\d+)/),Kc&&(a1=+Kc[1])));var ix=a1,dP=ix,Ict=Yi,Lct=Bs,Fct=Lct.String,fP=!!Object.getOwnPropertySymbols&&!Ict(function(){var r=Symbol();return!Fct(r)||!(Object(r)instanceof Symbol)||!Symbol.sham&&dP&&dP<41}),Mct=fP,pP=Mct&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Pct=Nh,Uct=zi,Rct=s1,Dct=pP,Oct=Object,gP=Dct?function(r){return typeof r=="symbol"}:function(r){var t=Pct("Symbol");return Uct(t)&&Rct(t.prototype,Oct(r))},Nct=String,c1=function(r){try{return Nct(r)}catch{return"Object"}},kct=zi,Qct=c1,zct=TypeError,RA=function(r){if(kct(r))return r;throw zct(Qct(r)+" is not a function")},Hct=RA,Gct=Oh,Ef=function(r,t){var e=r[t];return Gct(e)?void 0:Hct(e)},sx=Ws,ox=zi,ax=UA,Vct=TypeError,jct=function(r,t){var e,n;if(t==="string"&&ox(e=r.toString)&&!ax(n=sx(e,r))||ox(e=r.valueOf)&&!ax(n=sx(e,r))||t!=="string"&&ox(e=r.toString)&&!ax(n=sx(e,r)))return n;throw Vct("Can't convert object to primitive value")},mP={exports:{}},yP=Bs,qct=Object.defineProperty,cx=function(r,t){try{qct(yP,r,{value:t,configurable:!0,writable:!0})}catch{yP[r]=t}return t},Kct=Bs,$ct=cx,_P="__core-js_shared__",Wct=Kct[_P]||$ct(_P,{}),lx=Wct,vP=lx;(mP.exports=function(r,t){return vP[r]||(vP[r]=t!==void 0?t:{})})("versions",[]).push({version:"3.30.2",mode:"global",copyright:" 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.30.2/LICENSE",source:"https://github.com/zloirock/core-js"});var Ax=mP.exports,Xct=Hl,Jct=Object,l1=function(r){return Jct(Xct(r))},Yct=Zi,Zct=l1,tlt=Yct({}.hasOwnProperty),$c=Object.hasOwn||function(r,t){return tlt(Zct(r),t)},elt=Zi,rlt=0,nlt=Math.random(),ilt=elt(1 .toString),bP=function(r){return"Symbol("+(r===void 0?"":r)+")_"+ilt(++rlt+nlt,36)},slt=Bs,olt=Ax,wP=$c,alt=bP,clt=fP,llt=pP,Sf=slt.Symbol,ux=olt("wks"),Alt=llt?Sf.for||Sf:Sf&&Sf.withoutSetter||alt,Ps=function(r){return wP(ux,r)||(ux[r]=clt&&wP(Sf,r)?Sf[r]:Alt("Symbol."+r)),ux[r]},ult=Ws,xP=UA,BP=gP,hlt=Ef,dlt=jct,flt=Ps,plt=TypeError,glt=flt("toPrimitive"),mlt=function(r,t){if(!xP(r)||BP(r))return r;var e=hlt(r,glt),n;if(e){if(t===void 0&&(t="default"),n=ult(e,r,t),!xP(n)||BP(n))return n;throw plt("Can't convert object to primitive value")}return t===void 0&&(t="number"),dlt(r,t)},ylt=mlt,_lt=gP,hx=function(r){var t=ylt(r,"string");return _lt(t)?t:t+""},vlt=Bs,CP=UA,dx=vlt.document,blt=CP(dx)&&CP(dx.createElement),A1=function(r){return blt?dx.createElement(r):{}},wlt=zl,xlt=Yi,Blt=A1,EP=!wlt&&!xlt(function(){return Object.defineProperty(Blt("div"),"a",{get:function(){return 7}}).a!=7}),Clt=zl,Elt=Ws,Slt=J4,Tlt=i1,Ilt=Lg,Llt=hx,Flt=$c,Mlt=EP,SP=Object.getOwnPropertyDescriptor;Cf.f=Clt?SP:function(r,t){if(r=Ilt(r),t=Llt(t),Mlt)try{return SP(r,t)}catch{}if(Flt(r,t))return Tlt(!Elt(Slt.f,r,t),r[t])};var Gl={},Plt=zl,Ult=Yi,TP=Plt&&Ult(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),Rlt=UA,Dlt=String,Olt=TypeError,wo=function(r){if(Rlt(r))return r;throw Olt(Dlt(r)+" is not an object")},Nlt=zl,klt=EP,Qlt=TP,u1=wo,IP=hx,zlt=TypeError,fx=Object.defineProperty,Hlt=Object.getOwnPropertyDescriptor,px="enumerable",gx="configurable",mx="writable";Gl.f=Nlt?Qlt?function(r,t,e){if(u1(r),t=IP(t),u1(e),typeof r=="function"&&t==="prototype"&&"value"in e&&mx in e&&!e[mx]){var n=Hlt(r,t);n&&n[mx]&&(r[t]=e.value,e={configurable:gx in e?e[gx]:n[gx],enumerable:px in e?e[px]:n[px],writable:!1})}return fx(r,t,e)}:fx:function(r,t,e){if(u1(r),t=IP(t),u1(e),klt)try{return fx(r,t,e)}catch{}if("get"in e||"set"in e)throw zlt("Accessors not supported");return"value"in e&&(r[t]=e.value),r};var Glt=zl,Vlt=Gl,jlt=i1,Fg=Glt?function(r,t,e){return Vlt.f(r,t,jlt(1,e))}:function(r,t,e){return r[t]=e,r},LP={exports:{}},yx=zl,qlt=$c,FP=Function.prototype,Klt=yx&&Object.getOwnPropertyDescriptor,_x=qlt(FP,"name"),$lt=_x&&(function(){}).name==="something",Wlt=_x&&(!yx||yx&&Klt(FP,"name").configurable),h1={EXISTS:_x,PROPER:$lt,CONFIGURABLE:Wlt},Xlt=Zi,Jlt=zi,vx=lx,Ylt=Xlt(Function.toString);Jlt(vx.inspectSource)||(vx.inspectSource=function(r){return Ylt(r)});var bx=vx.inspectSource,Zlt=Bs,tAt=zi,MP=Zlt.WeakMap,eAt=tAt(MP)&&/native code/.test(String(MP)),rAt=Ax,nAt=bP,PP=rAt("keys"),wx=function(r){return PP[r]||(PP[r]=nAt(r))},xx={},iAt=eAt,UP=Bs,sAt=UA,oAt=Fg,Bx=$c,Cx=lx,aAt=wx,cAt=xx,RP="Object already initialized",Ex=UP.TypeError,lAt=UP.WeakMap,d1,Mg,f1,AAt=function(r){return f1(r)?Mg(r):d1(r,{})},uAt=function(r){return function(t){var e;if(!sAt(t)||(e=Mg(t)).type!==r)throw Ex("Incompatible receiver, "+r+" required");return e}};if(iAt||Cx.state){var Vl=Cx.state||(Cx.state=new lAt);Vl.get=Vl.get,Vl.has=Vl.has,Vl.set=Vl.set,d1=function(r,t){if(Vl.has(r))throw Ex(RP);return t.facade=r,Vl.set(r,t),t},Mg=function(r){return Vl.get(r)||{}},f1=function(r){return Vl.has(r)}}else{var Tf=aAt("state");cAt[Tf]=!0,d1=function(r,t){if(Bx(r,Tf))throw Ex(RP);return t.facade=r,oAt(r,Tf,t),t},Mg=function(r){return Bx(r,Tf)?r[Tf]:{}},f1=function(r){return Bx(r,Tf)}}var p1={set:d1,get:Mg,has:f1,enforce:AAt,getterFor:uAt},Sx=Zi,hAt=Yi,dAt=zi,g1=$c,Tx=zl,fAt=h1.CONFIGURABLE,pAt=bx,DP=p1,gAt=DP.enforce,mAt=DP.get,OP=String,m1=Object.defineProperty,yAt=Sx("".slice),_At=Sx("".replace),vAt=Sx([].join),bAt=Tx&&!hAt(function(){return m1(function(){},"length",{value:8}).length!==8}),wAt=String(String).split("String"),xAt=LP.exports=function(r,t,e){yAt(OP(t),0,7)==="Symbol("&&(t="["+_At(OP(t),/^Symbol\(([^)]*)\)/,"$1")+"]"),e&&e.getter&&(t="get "+t),e&&e.setter&&(t="set "+t),(!g1(r,"name")||fAt&&r.name!==t)&&(Tx?m1(r,"name",{value:t,configurable:!0}):r.name=t),bAt&&e&&g1(e,"arity")&&r.length!==e.arity&&m1(r,"length",{value:e.arity});try{e&&g1(e,"constructor")&&e.constructor?Tx&&m1(r,"prototype",{writable:!1}):r.prototype&&(r.prototype=void 0)}catch{}var n=gAt(r);return g1(n,"source")||(n.source=vAt(wAt,typeof t=="string"?t:"")),r};Function.prototype.toString=xAt(function(){return dAt(this)&&mAt(this).source||pAt(this)},"toString");var NP=LP.exports,BAt=zi,CAt=Gl,EAt=NP,SAt=cx,kh=function(r,t,e,n){n||(n={});var i=n.enumerable,s=n.name!==void 0?n.name:t;if(BAt(e)&&EAt(e,s,n),n.global)i?r[t]=e:SAt(t,e);else{try{n.unsafe?r[t]&&(i=!0):delete r[t]}catch{}i?r[t]=e:CAt.f(r,t,{value:e,enumerable:!1,configurable:!n.nonConfigurable,writable:!n.nonWritable})}return r},kP={},TAt=Math.ceil,IAt=Math.floor,LAt=Math.trunc||function(r){var t=+r;return(t>0?IAt:TAt)(t)},FAt=LAt,y1=function(r){var t=+r;return t!==t||t===0?0:FAt(t)},MAt=y1,PAt=Math.max,UAt=Math.min,QP=function(r,t){var e=MAt(r);return e<0?PAt(e+t,0):UAt(e,t)},RAt=y1,DAt=Math.min,If=function(r){return r>0?DAt(RAt(r),9007199254740991):0},OAt=If,_1=function(r){return OAt(r.length)},NAt=Lg,kAt=QP,QAt=_1,zP=function(r){return function(t,e,n){var i=NAt(t),s=QAt(i),a=kAt(n,s),o;if(r&&e!=e){for(;s>a;)if(o=i[a++],o!=o)return!0}else for(;s>a;a++)if((r||a in i)&&i[a]===e)return r||a||0;return!r&&-1}},HP={includes:zP(!0),indexOf:zP(!1)},zAt=Zi,Ix=$c,HAt=Lg,GAt=HP.indexOf,VAt=xx,GP=zAt([].push),VP=function(r,t){var e=HAt(r),n=0,i=[],s;for(s in e)!Ix(VAt,s)&&Ix(e,s)&&GP(i,s);for(;t.length>n;)Ix(e,s=t[n++])&&(~GAt(i,s)||GP(i,s));return i},Lx=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],jAt=VP,qAt=Lx,KAt=qAt.concat("length","prototype");kP.f=Object.getOwnPropertyNames||function(r){return jAt(r,KAt)};var jP={};jP.f=Object.getOwnPropertySymbols;var $At=Nh,WAt=Zi,XAt=kP,JAt=jP,YAt=wo,ZAt=WAt([].concat),tut=$At("Reflect","ownKeys")||function(r){var t=XAt.f(YAt(r)),e=JAt.f;return e?ZAt(t,e(r)):t},qP=$c,eut=tut,rut=Cf,nut=Gl,iut=function(r,t,e){for(var n=eut(t),i=nut.f,s=rut.f,a=0;a<n.length;a++){var o=n[a];!qP(r,o)&&!(e&&qP(e,o))&&i(r,o,s(t,o))}},sut=Yi,out=zi,aut=/#|\.prototype\./,Pg=function(r,t){var e=lut[cut(r)];return e==uut?!0:e==Aut?!1:out(t)?sut(t):!!t},cut=Pg.normalize=function(r){return String(r).replace(aut,".").toLowerCase()},lut=Pg.data={},Aut=Pg.NATIVE="N",uut=Pg.POLYFILL="P",KP=Pg,Fx=Bs,hut=Cf.f,dut=Fg,fut=kh,put=cx,gut=iut,mut=KP,$o=function(r,t){var e=r.target,n=r.global,i=r.stat,s,a,o,h,f,g;if(n?a=Fx:i?a=Fx[e]||put(e,{}):a=(Fx[e]||{}).prototype,a)for(o in t){if(f=t[o],r.dontCallGetSet?(g=hut(a,o),h=g&&g.value):h=a[o],s=mut(n?o:e+(i?".":"#")+o,r.forced),!s&&h!==void 0){if(typeof f==typeof h)continue;gut(f,h)}(r.sham||h&&h.sham)&&dut(f,"sham",!0),fut(a,o,f,r)}},yut=Dh,Ug=typeof process<"u"&&yut(process)=="process",_ut=Zi,vut=RA,but=function(r,t,e){try{return _ut(vut(Object.getOwnPropertyDescriptor(r,t)[e]))}catch{}},wut=zi,xut=String,But=TypeError,Cut=function(r){if(typeof r=="object"||wut(r))return r;throw But("Can't set "+xut(r)+" as a prototype")},Eut=but,Sut=wo,Tut=Cut,$P=Object.setPrototypeOf||("__proto__"in{}?function(){var r=!1,t={},e;try{e=Eut(Object.prototype,"__proto__","set"),e(t,[]),r=t instanceof Array}catch{}return function(n,i){return Sut(n),Tut(i),r?e(n,i):n.__proto__=i,n}}():void 0),Iut=Gl.f,Lut=$c,Fut=Ps,WP=Fut("toStringTag"),Mx=function(r,t,e){r&&!e&&(r=r.prototype),r&&!Lut(r,WP)&&Iut(r,WP,{configurable:!0,value:t})},XP=NP,Mut=Gl,Put=function(r,t,e){return e.get&&XP(e.get,t,{getter:!0}),e.set&&XP(e.set,t,{setter:!0}),Mut.f(r,t,e)},Uut=Nh,Rut=Put,Dut=Ps,Out=zl,JP=Dut("species"),Nut=function(r){var t=Uut(r);Out&&t&&!t[JP]&&Rut(t,JP,{configurable:!0,get:function(){return this}})},kut=s1,Qut=TypeError,zut=function(r,t){if(kut(t,r))return r;throw Qut("Incorrect invocation")},Hut=Ps,Gut=Hut("toStringTag"),YP={};YP[Gut]="z";var Vut=String(YP)==="[object z]",jut=Vut,qut=zi,v1=Dh,Kut=Ps,$ut=Kut("toStringTag"),Wut=Object,Xut=v1(function(){return arguments}())=="Arguments",Jut=function(r,t){try{return r[t]}catch{}},Px=jut?v1:function(r){var t,e,n;return r===void 0?"Undefined":r===null?"Null":typeof(e=Jut(t=Wut(r),$ut))=="string"?e:Xut?v1(t):(n=v1(t))=="Object"&&qut(t.callee)?"Arguments":n},Yut=Zi,Zut=Yi,ZP=zi,tht=Px,eht=Nh,rht=bx,tU=function(){},nht=[],eU=eht("Reflect","construct"),Ux=/^\s*(?:class|function)\b/,iht=Yut(Ux.exec),sht=!Ux.exec(tU),Rg=function(r){if(!ZP(r))return!1;try{return eU(tU,nht,r),!0}catch{return!1}},rU=function(r){if(!ZP(r))return!1;switch(tht(r)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return sht||!!iht(Ux,rht(r))}catch{return!0}};rU.sham=!0;var oht=!eU||Zut(function(){var r;return Rg(Rg.call)||!Rg(Object)||!Rg(function(){r=!0})||r})?rU:Rg,aht=oht,cht=c1,lht=TypeError,Aht=function(r){if(aht(r))return r;throw lht(cht(r)+" is not a constructor")},nU=wo,uht=Aht,hht=Oh,dht=Ps,fht=dht("species"),iU=function(r,t){var e=nU(r).constructor,n;return e===void 0||hht(n=nU(e)[fht])?t:uht(n)},pht=r1,sU=Function.prototype,oU=sU.apply,aU=sU.call,Rx=typeof Reflect=="object"&&Reflect.apply||(pht?aU.bind(oU):function(){return aU.apply(oU,arguments)}),ght=Dh,mht=Zi,Dg=function(r){if(ght(r)==="Function")return mht(r)},cU=Dg,yht=RA,_ht=r1,vht=cU(cU.bind),Dx=function(r,t){return yht(r),t===void 0?r:_ht?vht(r,t):function(){return r.apply(t,arguments)}},bht=Nh,lU=bht("document","documentElement"),wht=Zi,xht=wht([].slice),Bht=TypeError,Cht=function(r,t){if(r<t)throw Bht("Not enough arguments");return r},Eht=o1,AU=/(?:ipad|iphone|ipod).*applewebkit/i.test(Eht),Qa=Bs,Sht=Rx,Tht=Dx,uU=zi,Iht=$c,hU=Yi,dU=lU,Lht=xht,fU=A1,Fht=Cht,Mht=AU,Pht=Ug,Ox=Qa.setImmediate,Nx=Qa.clearImmediate,Uht=Qa.process,kx=Qa.Dispatch,Rht=Qa.Function,pU=Qa.MessageChannel,Dht=Qa.String,Qx=0,Og={},gU="onreadystatechange",Ng,Qh,zx,Hx;hU(function(){Ng=Qa.location});var Gx=function(r){if(Iht(Og,r)){var t=Og[r];delete Og[r],t()}},Vx=function(r){return function(){Gx(r)}},mU=function(r){Gx(r.data)},yU=function(r){Qa.postMessage(Dht(r),Ng.protocol+"//"+Ng.host)};(!Ox||!Nx)&&(Ox=function(r){Fht(arguments.length,1);var t=uU(r)?r:Rht(r),e=Lht(arguments,1);return Og[++Qx]=function(){Sht(t,void 0,e)},Qh(Qx),Qx},Nx=function(r){delete Og[r]},Pht?Qh=function(r){Uht.nextTick(Vx(r))}:kx&&kx.now?Qh=function(r){kx.now(Vx(r))}:pU&&!Mht?(zx=new pU,Hx=zx.port2,zx.port1.onmessage=mU,Qh=Tht(Hx.postMessage,Hx)):Qa.addEventListener&&uU(Qa.postMessage)&&!Qa.importScripts&&Ng&&Ng.protocol!=="file:"&&!hU(yU)?(Qh=yU,Qa.addEventListener("message",mU,!1)):gU in fU("script")?Qh=function(r){dU.appendChild(fU("script"))[gU]=function(){dU.removeChild(this),Gx(r)}}:Qh=function(r){setTimeout(Vx(r),0)});var _U={set:Ox,clear:Nx},vU=function(){this.head=null,this.tail=null};vU.prototype={add:function(r){var t={item:r,next:null},e=this.tail;e?e.next=t:this.head=t,this.tail=t},get:function(){var r=this.head;if(r){var t=this.head=r.next;return t===null&&(this.tail=null),r.item}}};var bU=vU,Oht=o1,Nht=/ipad|iphone|ipod/i.test(Oht)&&typeof Pebble<"u",kht=o1,Qht=/web0s(?!.*chrome)/i.test(kht),zh=Bs,wU=Dx,zht=Cf.f,jx=_U.set,Hht=bU,Ght=AU,Vht=Nht,jht=Qht,qx=Ug,xU=zh.MutationObserver||zh.WebKitMutationObserver,BU=zh.document,CU=zh.process,b1=zh.Promise,EU=zht(zh,"queueMicrotask"),Kx=EU&&EU.value,Lf,$x,Wx,w1,SU;if(!Kx){var x1=new Hht,B1=function(){var r,t;for(qx&&(r=CU.domain)&&r.exit();t=x1.get();)try{t()}catch(e){throw x1.head&&Lf(),e}r&&r.enter()};!Ght&&!qx&&!jht&&xU&&BU?($x=!0,Wx=BU.createTextNode(""),new xU(B1).observe(Wx,{characterData:!0}),Lf=function(){Wx.data=$x=!$x}):!Vht&&b1&&b1.resolve?(w1=b1.resolve(void 0),w1.constructor=b1,SU=wU(w1.then,w1),Lf=function(){SU(B1)}):qx?Lf=function(){CU.nextTick(B1)}:(jx=wU(jx,zh),Lf=function(){jx(B1)}),Kx=function(r){x1.head||Lf(),x1.add(r)}}var qht=Kx,Kht=function(r,t){try{arguments.length==1?console.error(r):console.error(r,t)}catch{}},Xx=function(r){try{return{error:!1,value:r()}}catch(t){return{error:!0,value:t}}},$ht=Bs,C1=$ht.Promise,TU=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",Wht=TU,Xht=Ug,Jht=!Wht&&!Xht&&typeof window=="object"&&typeof document=="object",Yht=Bs,kg=C1,Zht=zi,tdt=KP,edt=bx,rdt=Ps,ndt=Jht,idt=TU,Jx=ix;kg&&kg.prototype;var sdt=rdt("species"),Yx=!1,IU=Zht(Yht.PromiseRejectionEvent),odt=tdt("Promise",function(){var r=edt(kg),t=r!==String(kg);if(!t&&Jx===66)return!0;if(!Jx||Jx<51||!/native code/.test(r)){var e=new kg(function(s){s(1)}),n=function(s){s(function(){},function(){})},i=e.constructor={};if(i[sdt]=n,Yx=e.then(function(){})instanceof n,!Yx)return!0}return!t&&(ndt||idt)&&!IU}),Qg={CONSTRUCTOR:odt,REJECTION_EVENT:IU,SUBCLASSING:Yx},Ff={},LU=RA,adt=TypeError,cdt=function(r){var t,e;this.promise=new r(function(n,i){if(t!==void 0||e!==void 0)throw adt("Bad Promise constructor");t=n,e=i}),this.resolve=LU(t),this.reject=LU(e)};Ff.f=function(r){return new cdt(r)};var ldt=$o,E1=Ug,Qu=Bs,Mf=Ws,FU=kh,MU=$P,Adt=Mx,udt=Nut,hdt=RA,S1=zi,ddt=UA,fdt=zut,pdt=iU,PU=_U.set,Zx=qht,gdt=Kht,mdt=Xx,ydt=bU,UU=p1,T1=C1,tB=Qg,RU=Ff,I1="Promise",DU=tB.CONSTRUCTOR,_dt=tB.REJECTION_EVENT,vdt=tB.SUBCLASSING,eB=UU.getterFor(I1),bdt=UU.set,Pf=T1&&T1.prototype,Hh=T1,L1=Pf,OU=Qu.TypeError,rB=Qu.document,nB=Qu.process,iB=RU.f,wdt=iB,xdt=!!(rB&&rB.createEvent&&Qu.dispatchEvent),NU="unhandledrejection",Bdt="rejectionhandled",kU=0,QU=1,Cdt=2,sB=1,zU=2,F1,HU,Edt,GU,VU=function(r){var t;return ddt(r)&&S1(t=r.then)?t:!1},jU=function(r,t){var e=t.value,n=t.state==QU,i=n?r.ok:r.fail,s=r.resolve,a=r.reject,o=r.domain,h,f,g;try{i?(n||(t.rejection===zU&&Tdt(t),t.rejection=sB),i===!0?h=e:(o&&o.enter(),h=i(e),o&&(o.exit(),g=!0)),h===r.promise?a(OU("Promise-chain cycle")):(f=VU(h))?Mf(f,h,s,a):s(h)):a(e)}catch(b){o&&!g&&o.exit(),a(b)}},qU=function(r,t){r.notified||(r.notified=!0,Zx(function(){for(var e=r.reactions,n;n=e.get();)jU(n,r);r.notified=!1,t&&!r.rejection&&Sdt(r)}))},KU=function(r,t,e){var n,i;xdt?(n=rB.createEvent("Event"),n.promise=t,n.reason=e,n.initEvent(r,!1,!0),Qu.dispatchEvent(n)):n={promise:t,reason:e},!_dt&&(i=Qu["on"+r])?i(n):r===NU&&gdt("Unhandled promise rejection",e)},Sdt=function(r){Mf(PU,Qu,function(){var t=r.facade,e=r.value,n=$U(r),i;if(n&&(i=mdt(function(){E1?nB.emit("unhandledRejection",e,t):KU(NU,t,e)}),r.rejection=E1||$U(r)?zU:sB,i.error))throw i.value})},$U=function(r){return r.rejection!==sB&&!r.parent},Tdt=function(r){Mf(PU,Qu,function(){var t=r.facade;E1?nB.emit("rejectionHandled",t):KU(Bdt,t,r.value)})},Uf=function(r,t,e){return function(n){r(t,n,e)}},Rf=function(r,t,e){r.done||(r.done=!0,e&&(r=e),r.value=t,r.state=Cdt,qU(r,!0))},oB=function(r,t,e){if(!r.done){r.done=!0,e&&(r=e);try{if(r.facade===t)throw OU("Promise can't be resolved itself");var n=VU(t);n?Zx(function(){var i={done:!1};try{Mf(n,t,Uf(oB,i,r),Uf(Rf,i,r))}catch(s){Rf(i,s,r)}}):(r.value=t,r.state=QU,qU(r,!1))}catch(i){Rf({done:!1},i,r)}}};if(DU&&(Hh=function(r){fdt(this,L1),hdt(r),Mf(F1,this);var t=eB(this);try{r(Uf(oB,t),Uf(Rf,t))}catch(e){Rf(t,e)}},L1=Hh.prototype,F1=function(r){bdt(this,{type:I1,done:!1,notified:!1,parent:!1,reactions:new ydt,rejection:!1,state:kU,value:void 0})},F1.prototype=FU(L1,"then",function(r,t){var e=eB(this),n=iB(pdt(this,Hh));return e.parent=!0,n.ok=S1(r)?r:!0,n.fail=S1(t)&&t,n.domain=E1?nB.domain:void 0,e.state==kU?e.reactions.add(n):Zx(function(){jU(n,e)}),n.promise}),HU=function(){var r=new F1,t=eB(r);this.promise=r,this.resolve=Uf(oB,t),this.reject=Uf(Rf,t)},RU.f=iB=function(r){return r===Hh||r===Edt?new HU(r):wdt(r)},S1(T1)&&Pf!==Object.prototype)){GU=Pf.then,vdt||FU(Pf,"then",function(r,t){var e=this;return new Hh(function(n,i){Mf(GU,e,n,i)}).then(r,t)},{unsafe:!0});try{delete Pf.constructor}catch{}MU&&MU(Pf,L1)}ldt({global:!0,constructor:!0,wrap:!0,forced:DU},{Promise:Hh}),Adt(Hh,I1,!1),udt(I1);var zg={},Idt=Ps,Ldt=zg,Fdt=Idt("iterator"),Mdt=Array.prototype,Pdt=function(r){return r!==void 0&&(Ldt.Array===r||Mdt[Fdt]===r)},Udt=Px,WU=Ef,Rdt=Oh,Ddt=zg,Odt=Ps,Ndt=Odt("iterator"),XU=function(r){if(!Rdt(r))return WU(r,Ndt)||WU(r,"@@iterator")||Ddt[Udt(r)]},kdt=Ws,Qdt=RA,zdt=wo,Hdt=c1,Gdt=XU,Vdt=TypeError,jdt=function(r,t){var e=arguments.length<2?Gdt(r):t;if(Qdt(e))return zdt(kdt(e,r));throw Vdt(Hdt(r)+" is not iterable")},qdt=Ws,JU=wo,Kdt=Ef,$dt=function(r,t,e){var n,i;JU(r);try{if(n=Kdt(r,"return"),!n){if(t==="throw")throw e;return e}n=qdt(n,r)}catch(s){i=!0,n=s}if(t==="throw")throw e;if(i)throw n;return JU(n),e},Wdt=Dx,Xdt=Ws,Jdt=wo,Ydt=c1,Zdt=Pdt,tft=_1,YU=s1,eft=jdt,rft=XU,ZU=$dt,nft=TypeError,M1=function(r,t){this.stopped=r,this.result=t},tR=M1.prototype,eR=function(r,t,e){var n=e&&e.that,i=!!(e&&e.AS_ENTRIES),s=!!(e&&e.IS_RECORD),a=!!(e&&e.IS_ITERATOR),o=!!(e&&e.INTERRUPTED),h=Wdt(t,n),f,g,b,C,B,R,D,Q=function(j){return f&&ZU(f,"normal",j),new M1(!0,j)},k=function(j){return i?(Jdt(j),o?h(j[0],j[1],Q):h(j[0],j[1])):o?h(j,Q):h(j)};if(s)f=r.iterator;else if(a)f=r;else{if(g=rft(r),!g)throw nft(Ydt(r)+" is not iterable");if(Zdt(g)){for(b=0,C=tft(r);C>b;b++)if(B=k(r[b]),B&&YU(tR,B))return B;return new M1(!1)}f=eft(r,g)}for(R=s?r.next:f.next;!(D=Xdt(R,f)).done;){try{B=k(D.value)}catch(j){ZU(f,"throw",j)}if(typeof B=="object"&&B&&YU(tR,B))return B}return new M1(!1)},ift=Ps,rR=ift("iterator"),nR=!1;try{var sft=0,iR={next:function(){return{done:!!sft++}},return:function(){nR=!0}};iR[rR]=function(){return this},Array.from(iR,function(){throw 2})}catch{}var oft=function(r,t){if(!t&&!nR)return!1;var e=!1;try{var n={};n[rR]=function(){return{next:function(){return{done:e=!0}}}},r(n)}catch{}return e},aft=C1,cft=oft,lft=Qg.CONSTRUCTOR,sR=lft||!cft(function(r){aft.all(r).then(void 0,function(){})}),Aft=$o,uft=Ws,hft=RA,dft=Ff,fft=Xx,pft=eR,gft=sR;Aft({target:"Promise",stat:!0,forced:gft},{all:function(r){var t=this,e=dft.f(t),n=e.resolve,i=e.reject,s=fft(function(){var a=hft(t.resolve),o=[],h=0,f=1;pft(r,function(g){var b=h++,C=!1;f++,uft(a,t,g).then(function(B){C||(C=!0,o[b]=B,--f||n(o))},i)}),--f||n(o)});return s.error&&i(s.value),e.promise}});var mft=$o,yft=Qg.CONSTRUCTOR,aB=C1,_ft=Nh,vft=zi,bft=kh,oR=aB&&aB.prototype;if(mft({target:"Promise",proto:!0,forced:yft,real:!0},{catch:function(r){return this.then(void 0,r)}}),vft(aB)){var aR=_ft("Promise").prototype.catch;oR.catch!==aR&&bft(oR,"catch",aR,{unsafe:!0})}var wft=$o,xft=Ws,Bft=RA,Cft=Ff,Eft=Xx,Sft=eR,Tft=sR;wft({target:"Promise",stat:!0,forced:Tft},{race:function(r){var t=this,e=Cft.f(t),n=e.reject,i=Eft(function(){var s=Bft(t.resolve);Sft(r,function(a){xft(s,t,a).then(e.resolve,n)})});return i.error&&n(i.value),e.promise}});var Ift=$o,Lft=Ws,Fft=Ff,Mft=Qg.CONSTRUCTOR;Ift({target:"Promise",stat:!0,forced:Mft},{reject:function(r){var t=Fft.f(this);return Lft(t.reject,void 0,r),t.promise}});var Pft=wo,Uft=UA,Rft=Ff,Dft=function(r,t){if(Pft(r),Uft(t)&&t.constructor===r)return t;var e=Rft.f(r),n=e.resolve;return n(t),e.promise},Oft=$o,Nft=Nh,kft=Qg.CONSTRUCTOR,Qft=Dft;Nft("Promise"),Oft({target:"Promise",stat:!0,forced:kft},{resolve:function(r){return Qft(this,r)}});function cR(r,t,e,n,i,s,a){try{var o=r[s](a),h=o.value}catch(f){e(f);return}o.done?t(h):Promise.resolve(h).then(n,i)}function DA(r){return function(){var t=this,e=arguments;return new Promise(function(n,i){var s=r.apply(t,e);function a(h){cR(s,n,i,a,o,"next",h)}function o(h){cR(s,n,i,a,o,"throw",h)}a(void 0)})}}var zft=Px,Hft=String,jl=function(r){if(zft(r)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return Hft(r)},Gft=wo,lR=function(){var r=Gft(this),t="";return r.hasIndices&&(t+="d"),r.global&&(t+="g"),r.ignoreCase&&(t+="i"),r.multiline&&(t+="m"),r.dotAll&&(t+="s"),r.unicode&&(t+="u"),r.unicodeSets&&(t+="v"),r.sticky&&(t+="y"),t},cB=Yi,Vft=Bs,lB=Vft.RegExp,AB=cB(function(){var r=lB("a","y");return r.lastIndex=2,r.exec("abcd")!=null}),jft=AB||cB(function(){return!lB("a","y").sticky}),qft=AB||cB(function(){var r=lB("^r","gy");return r.lastIndex=2,r.exec("str")!=null}),AR={BROKEN_CARET:qft,MISSED_STICKY:jft,UNSUPPORTED_Y:AB},uR={},Kft=VP,$ft=Lx,Wft=Object.keys||function(r){return Kft(r,$ft)},Xft=zl,Jft=TP,Yft=Gl,Zft=wo,tpt=Lg,ept=Wft;uR.f=Xft&&!Jft?Object.defineProperties:function(r,t){Zft(r);for(var e=tpt(t),n=ept(t),i=n.length,s=0,a;i>s;)Yft.f(r,a=n[s++],e[a]);return r};var rpt=wo,npt=uR,hR=Lx,ipt=xx,spt=lU,opt=A1,apt=wx,dR=">",fR="<",uB="prototype",hB="script",pR=apt("IE_PROTO"),dB=function(){},gR=function(r){return fR+hB+dR+r+fR+"/"+hB+dR},mR=function(r){r.write(gR("")),r.close();var t=r.parentWindow.Object;return r=null,t},cpt=function(){var r=opt("iframe"),t="java"+hB+":",e;return r.style.display="none",spt.appendChild(r),r.src=String(t),e=r.contentWindow.document,e.open(),e.write(gR("document.F=Object")),e.close(),e.F},P1,U1=function(){try{P1=new ActiveXObject("htmlfile")}catch{}U1=typeof document<"u"?document.domain&&P1?mR(P1):cpt():mR(P1);for(var r=hR.length;r--;)delete U1[uB][hR[r]];return U1()};ipt[pR]=!0;var fB=Object.create||function(r,t){var e;return r!==null?(dB[uB]=rpt(r),e=new dB,dB[uB]=null,e[pR]=r):e=U1(),t===void 0?e:npt.f(e,t)},lpt=Yi,Apt=Bs,upt=Apt.RegExp,hpt=lpt(function(){var r=upt(".","s");return!(r.dotAll&&r.exec(`
`)&&r.flags==="s")}),dpt=Yi,fpt=Bs,ppt=fpt.RegExp,gpt=dpt(function(){var r=ppt("(?<a>b)","g");return r.exec("b").groups.a!=="b"||"b".replace(r,"$<a>c")!=="bc"}),Df=Ws,R1=Zi,mpt=jl,ypt=lR,_pt=AR,vpt=Ax,bpt=fB,wpt=p1.get,xpt=hpt,Bpt=gpt,Cpt=vpt("native-string-replace",String.prototype.replace),D1=RegExp.prototype.exec,pB=D1,Ept=R1("".charAt),Spt=R1("".indexOf),Tpt=R1("".replace),gB=R1("".slice),mB=function(){var r=/a/,t=/b*/g;return Df(D1,r,"a"),Df(D1,t,"a"),r.lastIndex!==0||t.lastIndex!==0}(),yR=_pt.BROKEN_CARET,yB=/()??/.exec("")[1]!==void 0,Ipt=mB||yB||yR||xpt||Bpt;Ipt&&(pB=function(r){var t=this,e=wpt(t),n=mpt(r),i=e.raw,s,a,o,h,f,g,b;if(i)return i.lastIndex=t.lastIndex,s=Df(pB,i,n),t.lastIndex=i.lastIndex,s;var C=e.groups,B=yR&&t.sticky,R=Df(ypt,t),D=t.source,Q=0,k=n;if(B&&(R=Tpt(R,"y",""),Spt(R,"g")===-1&&(R+="g"),k=gB(n,t.lastIndex),t.lastIndex>0&&(!t.multiline||t.multiline&&Ept(n,t.lastIndex-1)!==`
`)&&(D="(?: "+D+")",k=" "+k,Q++),a=new RegExp("^(?:"+D+")",R)),yB&&(a=new RegExp("^"+D+"$(?!\\s)",R)),mB&&(o=t.lastIndex),h=Df(D1,B?a:t,k),B?h?(h.input=gB(h.input,Q),h[0]=gB(h[0],Q),h.index=t.lastIndex,t.lastIndex+=h[0].length):t.lastIndex=0:mB&&h&&(t.lastIndex=t.global?h.index+h[0].length:o),yB&&h&&h.length>1&&Df(Cpt,h[0],a,function(){for(f=1;f<arguments.length-2;f++)arguments[f]===void 0&&(h[f]=void 0)}),h&&C)for(h.groups=g=bpt(null),f=0;f<C.length;f++)b=C[f],g[b[0]]=h[b[1]];return h});var O1=pB,Lpt=$o,_R=O1;Lpt({target:"RegExp",proto:!0,forced:/./.exec!==_R},{exec:_R});var vR=Dg,bR=kh,Fpt=O1,wR=Yi,xR=Ps,Mpt=Fg,Ppt=xR("species"),_B=RegExp.prototype,vB=function(r,t,e,n){var i=xR(r),s=!wR(function(){var f={};return f[i]=function(){return 7},""[r](f)!=7}),a=s&&!wR(function(){var f=!1,g=/a/;return r==="split"&&(g={},g.constructor={},g.constructor[Ppt]=function(){return g},g.flags="",g[i]=/./[i]),g.exec=function(){return f=!0,null},g[i](""),!f});if(!s||!a||e){var o=vR(/./[i]),h=t(i,""[r],function(f,g,b,C,B){var R=vR(f),D=g.exec;return D===Fpt||D===_B.exec?s&&!B?{done:!0,value:o(g,b,C)}:{done:!0,value:R(b,g,C)}:{done:!1}});bR(String.prototype,r,h[0]),bR(_B,i,h[1])}n&&Mpt(_B[i],"sham",!0)},bB=Zi,Upt=y1,Rpt=jl,Dpt=Hl,Opt=bB("".charAt),BR=bB("".charCodeAt),Npt=bB("".slice),CR=function(r){return function(t,e){var n=Rpt(Dpt(t)),i=Upt(e),s=n.length,a,o;return i<0||i>=s?r?"":void 0:(a=BR(n,i),a<55296||a>56319||i+1===s||(o=BR(n,i+1))<56320||o>57343?r?Opt(n,i):a:r?Npt(n,i,i+2):(a-55296<<10)+(o-56320)+65536)}},kpt={codeAt:CR(!1),charAt:CR(!0)},Qpt=kpt.charAt,wB=function(r,t,e){return t+(e?Qpt(r,t).length:1)},ER=Ws,zpt=wo,Hpt=zi,Gpt=Dh,Vpt=O1,jpt=TypeError,xB=function(r,t){var e=r.exec;if(Hpt(e)){var n=ER(e,r,t);return n!==null&&zpt(n),n}if(Gpt(r)==="RegExp")return ER(Vpt,r,t);throw jpt("RegExp#exec called on incompatible receiver")},qpt=Ws,Kpt=vB,$pt=wo,Wpt=Oh,Xpt=If,BB=jl,Jpt=Hl,Ypt=Ef,Zpt=wB,SR=xB;Kpt("match",function(r,t,e){return[function(n){var i=Jpt(this),s=Wpt(n)?void 0:Ypt(n,r);return s?qpt(s,n,i):new RegExp(n)[r](BB(i))},function(n){var i=$pt(this),s=BB(n),a=e(t,i,s);if(a.done)return a.value;if(!i.global)return SR(i,s);var o=i.unicode;i.lastIndex=0;for(var h=[],f=0,g;(g=SR(i,s))!==null;){var b=BB(g[0]);h[f]=b,b===""&&(i.lastIndex=Zpt(s,Xpt(i.lastIndex),o)),f++}return f===0?null:h}]});var CB=Zi,tgt=l1,egt=Math.floor,EB=CB("".charAt),rgt=CB("".replace),SB=CB("".slice),ngt=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,igt=/\$([$&'`]|\d{1,2})/g,sgt=function(r,t,e,n,i,s){var a=e+r.length,o=n.length,h=igt;return i!==void 0&&(i=tgt(i),h=ngt),rgt(s,h,function(f,g){var b;switch(EB(g,0)){case"$":return"$";case"&":return r;case"`":return SB(t,0,e);case"'":return SB(t,a);case"<":b=i[SB(g,1,-1)];break;default:var C=+g;if(C===0)return f;if(C>o){var B=egt(C/10);return B===0?f:B<=o?n[B-1]===void 0?EB(g,1):n[B-1]+EB(g,1):f}b=n[C-1]}return b===void 0?"":b})},ogt=Rx,TR=Ws,N1=Zi,agt=vB,cgt=Yi,lgt=wo,Agt=zi,ugt=Oh,hgt=y1,dgt=If,Of=jl,fgt=Hl,pgt=wB,ggt=Ef,mgt=sgt,ygt=xB,_gt=Ps,TB=_gt("replace"),vgt=Math.max,bgt=Math.min,wgt=N1([].concat),IB=N1([].push),IR=N1("".indexOf),LR=N1("".slice),xgt=function(r){return r===void 0?r:String(r)},Bgt=function(){return"a".replace(/./,"$0")==="$0"}(),FR=function(){return/./[TB]?/./[TB]("a","$0")==="":!1}(),Cgt=!cgt(function(){var r=/./;return r.exec=function(){var t=[];return t.groups={a:"7"},t},"".replace(r,"$<a>")!=="7"});agt("replace",function(r,t,e){var n=FR?"$":"$0";return[function(i,s){var a=fgt(this),o=ugt(i)?void 0:ggt(i,TB);return o?TR(o,i,a,s):TR(t,Of(a),i,s)},function(i,s){var a=lgt(this),o=Of(i);if(typeof s=="string"&&IR(s,n)===-1&&IR(s,"$<")===-1){var h=e(t,a,o,s);if(h.done)return h.value}var f=Agt(s);f||(s=Of(s));var g=a.global;if(g){var b=a.unicode;a.lastIndex=0}for(var C=[];;){var B=ygt(a,o);if(B===null||(IB(C,B),!g))break;var R=Of(B[0]);R===""&&(a.lastIndex=pgt(o,dgt(a.lastIndex),b))}for(var D="",Q=0,k=0;k<C.length;k++){B=C[k];for(var j=Of(B[0]),et=vgt(bgt(hgt(B.index),o.length),0),st=[],mt=1;mt<B.length;mt++)IB(st,xgt(B[mt]));var pt=B.groups;if(f){var yt=wgt([j],st,et,o);pt!==void 0&&IB(yt,pt);var ft=Of(ogt(s,void 0,yt))}else ft=mgt(j,o,et,st,pt,s);et>=Q&&(D+=LR(o,Q,et)+ft,Q=et+j.length)}return D+LR(o,Q)}]},!Cgt||!Bgt||FR);var Egt=UA,Sgt=Dh,Tgt=Ps,Igt=Tgt("match"),MR=function(r){var t;return Egt(r)&&((t=r[Igt])!==void 0?!!t:Sgt(r)=="RegExp")},Lgt=MR,Fgt=TypeError,LB=function(r){if(Lgt(r))throw Fgt("The method doesn't accept regular expressions");return r},Mgt=Ps,Pgt=Mgt("match"),FB=function(r){var t=/./;try{"/./"[r](t)}catch{try{return t[Pgt]=!1,"/./"[r](t)}catch{}}return!1},Ugt=$o,PR=Dg,Rgt=Cf.f,Dgt=If,UR=jl,Ogt=LB,Ngt=Hl,kgt=FB,RR=PR("".startsWith),Qgt=PR("".slice),zgt=Math.min,DR=kgt("startsWith"),Hgt=!DR&&!!function(){var r=Rgt(String.prototype,"startsWith");return r&&!r.writable}();Ugt({target:"String",proto:!0,forced:!Hgt&&!DR},{startsWith:function(r){var t=UR(Ngt(this));Ogt(r);var e=Dgt(zgt(arguments.length>1?arguments[1]:void 0,t.length)),n=UR(r);return RR?RR(t,n,e):Qgt(t,e,e+n.length)===n}});var Ggt=Ps,Vgt=fB,jgt=Gl.f,MB=Ggt("unscopables"),PB=Array.prototype;PB[MB]==null&&jgt(PB,MB,{configurable:!0,value:Vgt(null)});var qgt=function(r){PB[MB][r]=!0},Kgt=Yi,$gt=!Kgt(function(){function r(){}return r.prototype.constructor=null,Object.getPrototypeOf(new r)!==r.prototype}),Wgt=$c,Xgt=zi,Jgt=l1,Ygt=wx,Zgt=$gt,OR=Ygt("IE_PROTO"),UB=Object,tmt=UB.prototype,NR=Zgt?UB.getPrototypeOf:function(r){var t=Jgt(r);if(Wgt(t,OR))return t[OR];var e=t.constructor;return Xgt(e)&&t instanceof e?e.prototype:t instanceof UB?tmt:null},emt=Yi,rmt=zi,nmt=UA,kR=NR,imt=kh,smt=Ps,RB=smt("iterator"),QR=!1,Gh,DB,OB;[].keys&&(OB=[].keys(),"next"in OB?(DB=kR(kR(OB)),DB!==Object.prototype&&(Gh=DB)):QR=!0);var omt=!nmt(Gh)||emt(function(){var r={};return Gh[RB].call(r)!==r});omt&&(Gh={}),rmt(Gh[RB])||imt(Gh,RB,function(){return this});var zR={IteratorPrototype:Gh,BUGGY_SAFARI_ITERATORS:QR},amt=zR.IteratorPrototype,cmt=fB,lmt=i1,Amt=Mx,umt=zg,hmt=function(){return this},dmt=function(r,t,e,n){var i=t+" Iterator";return r.prototype=cmt(amt,{next:lmt(+!n,e)}),Amt(r,i,!1),umt[i]=hmt,r},fmt=$o,pmt=Ws,HR=h1,gmt=zi,mmt=dmt,GR=NR,VR=$P,ymt=Mx,_mt=Fg,NB=kh,vmt=Ps,bmt=zg,jR=zR,wmt=HR.PROPER,xmt=HR.CONFIGURABLE,qR=jR.IteratorPrototype,k1=jR.BUGGY_SAFARI_ITERATORS,Hg=vmt("iterator"),KR="keys",Gg="values",$R="entries",Bmt=function(){return this},Cmt=function(r,t,e,n,i,s,a){mmt(e,t,n);var o=function(k){if(k===i&&C)return C;if(!k1&&k in g)return g[k];switch(k){case KR:return function(){return new e(this,k)};case Gg:return function(){return new e(this,k)};case $R:return function(){return new e(this,k)}}return function(){return new e(this)}},h=t+" Iterator",f=!1,g=r.prototype,b=g[Hg]||g["@@iterator"]||i&&g[i],C=!k1&&b||o(i),B=t=="Array"&&g.entries||b,R,D,Q;if(B&&(R=GR(B.call(new r)),R!==Object.prototype&&R.next&&(GR(R)!==qR&&(VR?VR(R,qR):gmt(R[Hg])||NB(R,Hg,Bmt)),ymt(R,h,!0))),wmt&&i==Gg&&b&&b.name!==Gg&&(xmt?_mt(g,"name",Gg):(f=!0,C=function(){return pmt(b,this)})),i)if(D={values:o(Gg),keys:s?C:o(KR),entries:o($R)},a)for(Q in D)(k1||f||!(Q in g))&&NB(g,Q,D[Q]);else fmt({target:t,proto:!0,forced:k1||f},D);return g[Hg]!==C&&NB(g,Hg,C,{name:i}),bmt[t]=C,D},Emt=function(r,t){return{value:r,done:t}},Smt=Lg,kB=qgt,WR=zg,XR=p1,Tmt=Gl.f,Imt=Cmt,Q1=Emt,Lmt=zl,JR="Array Iterator",Fmt=XR.set,Mmt=XR.getterFor(JR),Pmt=Imt(Array,"Array",function(r,t){Fmt(this,{type:JR,target:Smt(r),index:0,kind:t})},function(){var r=Mmt(this),t=r.target,e=r.kind,n=r.index++;return!t||n>=t.length?(r.target=void 0,Q1(void 0,!0)):e=="keys"?Q1(n,!1):e=="values"?Q1(t[n],!1):Q1([n,t[n]],!1)},"values"),YR=WR.Arguments=WR.Array;if(kB("keys"),kB("values"),kB("entries"),Lmt&&YR.name!=="values")try{Tmt(YR,"name",{value:"values"})}catch{}var Umt={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Rmt=A1,QB=Rmt("span").classList,ZR=QB&&QB.constructor&&QB.constructor.prototype,Dmt=ZR===Object.prototype?void 0:ZR,tD=Bs,eD=Umt,Omt=Dmt,Vg=Pmt,zB=Fg,rD=Ps,HB=rD("iterator"),nD=rD("toStringTag"),GB=Vg.values,iD=function(r,t){if(r){if(r[HB]!==GB)try{zB(r,HB,GB)}catch{r[HB]=GB}if(r[nD]||zB(r,nD,t),eD[t]){for(var e in Vg)if(r[e]!==Vg[e])try{zB(r,e,Vg[e])}catch{r[e]=Vg[e]}}}};for(var VB in eD)iD(tD[VB]&&tD[VB].prototype,VB);iD(Omt,"DOMTokenList");function Nmt(r,t){if(Nn(r)!=="object"||r===null)return r;var e=r[Symbol.toPrimitive];if(e!==void 0){var n=e.call(r,t||"default");if(Nn(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(r)}function kmt(r){var t=Nmt(r,"string");return Nn(t)==="symbol"?t:String(t)}function jB(r,t,e){return t=kmt(t),t in r?Object.defineProperty(r,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):r[t]=e,r}var Qmt=RA,zmt=l1,Hmt=nP,Gmt=_1,Vmt=TypeError,sD=function(r){return function(t,e,n,i){Qmt(e);var s=zmt(t),a=Hmt(s),o=Gmt(s),h=r?o-1:0,f=r?-1:1;if(n<2)for(;;){if(h in a){i=a[h],h+=f;break}if(h+=f,r?h<0:o<=h)throw Vmt("Reduce of empty array with no initial value")}for(;r?h>=0:o>h;h+=f)h in a&&(i=e(i,a[h],h,s));return i}},jmt={left:sD(!1),right:sD(!0)},qmt=Yi,oD=function(r,t){var e=[][r];return!!e&&qmt(function(){e.call(null,t||function(){return 1},1)})},Kmt=$o,$mt=jmt.left,Wmt=oD,aD=ix,Xmt=Ug,Jmt=!Xmt&&aD>79&&aD<83,Ymt=Jmt||!Wmt("reduce");Kmt({target:"Array",proto:!0,forced:Ymt},{reduce:function(r){var t=arguments.length;return $mt(this,r,t,t>1?arguments[1]:void 0)}});var Zmt=$o,cD=Dg,t0t=Cf.f,e0t=If,lD=jl,r0t=LB,n0t=Hl,i0t=FB,AD=cD("".endsWith),s0t=cD("".slice),o0t=Math.min,uD=i0t("endsWith"),a0t=!uD&&!!function(){var r=t0t(String.prototype,"endsWith");return r&&!r.writable}();Zmt({target:"String",proto:!0,forced:!a0t&&!uD},{endsWith:function(r){var t=lD(n0t(this));r0t(r);var e=arguments.length>1?arguments[1]:void 0,n=t.length,i=e===void 0?n:o0t(e0t(e),n),s=lD(r);return AD?AD(t,s,i):s0t(t,i-s.length,i)===s}});var c0t=hx,l0t=Gl,A0t=i1,u0t=function(r,t,e){var n=c0t(t);n in r?l0t.f(r,n,A0t(0,e)):r[n]=e},hD=QP,h0t=_1,d0t=u0t,f0t=Array,p0t=Math.max,g0t=function(r,t,e){for(var n=h0t(r),i=hD(t,n),s=hD(e===void 0?n:e,n),a=f0t(p0t(s-i,0)),o=0;i<s;i++,o++)d0t(a,o,r[i]);return a.length=o,a},m0t=Rx,jg=Ws,qB=Zi,y0t=vB,_0t=wo,v0t=Oh,b0t=MR,dD=Hl,w0t=iU,x0t=wB,B0t=If,KB=jl,C0t=Ef,fD=g0t,pD=xB,E0t=O1,S0t=AR,T0t=Yi,Nf=S0t.UNSUPPORTED_Y,gD=4294967295,I0t=Math.min,mD=[].push,L0t=qB(/./.exec),kf=qB(mD),qg=qB("".slice),F0t=!T0t(function(){var r=/(?:)/,t=r.exec;r.exec=function(){return t.apply(this,arguments)};var e="ab".split(r);return e.length!==2||e[0]!=="a"||e[1]!=="b"});y0t("split",function(r,t,e){var n;return"abbc".split(/(b)*/)[1]=="c"||"test".split(/(?:)/,-1).length!=4||"ab".split(/(?:ab)*/).length!=2||".".split(/(.?)(.?)/).length!=4||".".split(/()()/).length>1||"".split(/.?/).length?n=function(i,s){var a=KB(dD(this)),o=s===void 0?gD:s>>>0;if(o===0)return[];if(i===void 0)return[a];if(!b0t(i))return jg(t,a,i,o);for(var h=[],f=(i.ignoreCase?"i":"")+(i.multiline?"m":"")+(i.unicode?"u":"")+(i.sticky?"y":""),g=0,b=new RegExp(i.source,f+"g"),C,B,R;(C=jg(E0t,b,a))&&(B=b.lastIndex,!(B>g&&(kf(h,qg(a,g,C.index)),C.length>1&&C.index<a.length&&m0t(mD,h,fD(C,1)),R=C[0].length,g=B,h.length>=o)));)b.lastIndex===C.index&&b.lastIndex++;return g===a.length?(R||!L0t(b,""))&&kf(h,""):kf(h,qg(a,g)),h.length>o?fD(h,0,o):h}:"0".split(void 0,0).length?n=function(i,s){return i===void 0&&s===0?[]:jg(t,this,i,s)}:n=t,[function(i,s){var a=dD(this),o=v0t(i)?void 0:C0t(i,r);return o?jg(o,i,a,s):jg(n,KB(a),i,s)},function(i,s){var a=_0t(this),o=KB(i),h=e(n,a,o,s,n!==t);if(h.done)return h.value;var f=w0t(a,RegExp),g=a.unicode,b=(a.ignoreCase?"i":"")+(a.multiline?"m":"")+(a.unicode?"u":"")+(Nf?"g":"y"),C=new f(Nf?"^(?:"+a.source+")":a,b),B=s===void 0?gD:s>>>0;if(B===0)return[];if(o.length===0)return pD(C,o)===null?[o]:[];for(var R=0,D=0,Q=[];D<o.length;){C.lastIndex=Nf?0:D;var k=pD(C,Nf?qg(o,D):o),j;if(k===null||(j=I0t(B0t(C.lastIndex+(Nf?D:0)),o.length))===R)D=x0t(o,D,g);else{if(kf(Q,qg(o,R,D)),Q.length===B)return Q;for(var et=1;et<=k.length-1;et++)if(kf(Q,k[et]),Q.length===B)return Q;D=R=j}}return kf(Q,qg(o,R)),Q}]},!F0t,Nf);var z1={exports:{}},Kg={exports:{}};(function(){var r,t,e,n,i,s;typeof performance<"u"&&performance!==null&&performance.now?Kg.exports=function(){return performance.now()}:typeof process<"u"&&process!==null&&process.hrtime?(Kg.exports=function(){return(r()-i)/1e6},t=process.hrtime,r=function(){var a;return a=t(),a[0]*1e9+a[1]},n=r(),s=process.uptime()*1e9,i=n-s):Date.now?(Kg.exports=function(){return Date.now()-e},e=Date.now()):(Kg.exports=function(){return new Date().getTime()-e},e=new Date().getTime())}).call(Ig);for(var M0t=Kg.exports,P0t=M0t,OA=typeof window>"u"?Ig:window,H1=["moz","webkit"],Qf="AnimationFrame",zf=OA["request"+Qf],$g=OA["cancel"+Qf]||OA["cancelRequest"+Qf],Wg=0;!zf&&Wg<H1.length;Wg++)zf=OA[H1[Wg]+"Request"+Qf],$g=OA[H1[Wg]+"Cancel"+Qf]||OA[H1[Wg]+"CancelRequest"+Qf];if(!zf||!$g){var $B=0,yD=0,Vh=[],U0t=1e3/60;zf=function(r){if(Vh.length===0){var t=P0t(),e=Math.max(0,U0t-(t-$B));$B=e+t,setTimeout(function(){var n=Vh.slice(0);Vh.length=0;for(var i=0;i<n.length;i++)if(!n[i].cancelled)try{n[i].callback($B)}catch(s){setTimeout(function(){throw s},0)}},Math.round(e))}return Vh.push({handle:++yD,callback:r,cancelled:!1}),yD},$g=function(r){for(var t=0;t<Vh.length;t++)Vh[t].handle===r&&(Vh[t].cancelled=!0)}}z1.exports=function(r){return zf.call(OA,r)},z1.exports.cancel=function(){$g.apply(OA,arguments)},z1.exports.polyfill=function(r){r||(r=OA),r.requestAnimationFrame=zf,r.cancelAnimationFrame=$g};var R0t=z1.exports;const WB=X4(R0t);var _D=`	
\v\f\r \u2028\u2029\uFEFF`,D0t=Zi,O0t=Hl,N0t=jl,XB=_D,vD=D0t("".replace),k0t=RegExp("^["+XB+"]+"),Q0t=RegExp("(^|[^"+XB+"])["+XB+"]+$"),JB=function(r){return function(t){var e=N0t(O0t(t));return r&1&&(e=vD(e,k0t,"")),r&2&&(e=vD(e,Q0t,"$1")),e}},z0t={start:JB(1),end:JB(2),trim:JB(3)},H0t=h1.PROPER,G0t=Yi,bD=_D,wD="",V0t=function(r){return G0t(function(){return!!bD[r]()||wD[r]()!==wD||H0t&&bD[r].name!==r})},j0t=$o,q0t=z0t.trim,K0t=V0t;j0t({target:"String",proto:!0,forced:K0t("trim")},{trim:function(){return q0t(this)}});var $0t=function(r){this.ok=!1,this.alpha=1,r.charAt(0)=="#"&&(r=r.substr(1,6)),r=r.replace(/ /g,""),r=r.toLowerCase();var t={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};r=t[r]||r;for(var e=[{re:/^rgba\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3}),\s*((?:\d?\.)?\d)\)$/,example:["rgba(123, 234, 45, 0.8)","rgba(255,234,245,1.0)"],process:function(h){return[parseInt(h[1]),parseInt(h[2]),parseInt(h[3]),parseFloat(h[4])]}},{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(h){return[parseInt(h[1]),parseInt(h[2]),parseInt(h[3])]}},{re:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,example:["#00ff00","336699"],process:function(h){return[parseInt(h[1],16),parseInt(h[2],16),parseInt(h[3],16)]}},{re:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,example:["#fb0","f0f"],process:function(h){return[parseInt(h[1]+h[1],16),parseInt(h[2]+h[2],16),parseInt(h[3]+h[3],16)]}}],n=0;n<e.length;n++){var i=e[n].re,s=e[n].process,a=i.exec(r);if(a){var o=s(a);this.r=o[0],this.g=o[1],this.b=o[2],o.length>3&&(this.alpha=o[3]),this.ok=!0}}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.alpha=this.alpha<0?0:this.alpha>1||isNaN(this.alpha)?1:this.alpha,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toRGBA=function(){return"rgba("+this.r+", "+this.g+", "+this.b+", "+this.alpha+")"},this.toHex=function(){var h=this.r.toString(16),f=this.g.toString(16),g=this.b.toString(16);return h.length==1&&(h="0"+h),f.length==1&&(f="0"+f),g.length==1&&(g="0"+g),"#"+h+f+g},this.getHelpXML=function(){for(var h=new Array,f=0;f<e.length;f++)for(var g=e[f].example,b=0;b<g.length;b++)h[h.length]=g[b];for(var C in t)h[h.length]=C;var B=document.createElement("ul");B.setAttribute("id","rgbcolor-examples");for(var f=0;f<h.length;f++)try{var R=document.createElement("li"),D=new RGBColor(h[f]),Q=document.createElement("div");Q.style.cssText="margin: 3px; border: 1px solid black; background:"+D.toHex()+"; color:"+D.toHex(),Q.appendChild(document.createTextNode("test"));var k=document.createTextNode(" "+h[f]+" -> "+D.toRGB()+" -> "+D.toHex());R.appendChild(Q),R.appendChild(k),B.appendChild(R)}catch{}return B}};const YB=X4($0t);var W0t=$o,X0t=Dg,J0t=HP.indexOf,Y0t=oD,ZB=X0t([].indexOf),xD=!!ZB&&1/ZB([1],1,-0)<0,Z0t=xD||!Y0t("indexOf");W0t({target:"Array",proto:!0,forced:Z0t},{indexOf:function(r){var t=arguments.length>1?arguments[1]:void 0;return xD?ZB(this,r,t)||0:J0t(this,r,t)}});var tyt=$o,eyt=Zi,ryt=LB,nyt=Hl,BD=jl,iyt=FB,syt=eyt("".indexOf);tyt({target:"String",proto:!0,forced:!iyt("includes")},{includes:function(r){return!!~syt(BD(nyt(this)),BD(ryt(r)),arguments.length>1?arguments[1]:void 0)}});var oyt=Dh,ayt=Array.isArray||function(r){return oyt(r)=="Array"},cyt=$o,lyt=Zi,Ayt=ayt,uyt=lyt([].reverse),CD=[1,2];cyt({target:"Array",proto:!0,forced:String(CD)===String(CD.reverse())},{reverse:function(){return Ayt(this)&&(this.length=this.length),uyt(this)}});/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var ED=function(r,t){return(ED=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])})(r,t)};function SD(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}ED(r,t),r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}function hyt(r){var t="";Array.isArray(r)||(r=[r]);for(var e=0;e<r.length;e++){var n=r[e];if(n.type===Ne.CLOSE_PATH)t+="z";else if(n.type===Ne.HORIZ_LINE_TO)t+=(n.relative?"h":"H")+n.x;else if(n.type===Ne.VERT_LINE_TO)t+=(n.relative?"v":"V")+n.y;else if(n.type===Ne.MOVE_TO)t+=(n.relative?"m":"M")+n.x+" "+n.y;else if(n.type===Ne.LINE_TO)t+=(n.relative?"l":"L")+n.x+" "+n.y;else if(n.type===Ne.CURVE_TO)t+=(n.relative?"c":"C")+n.x1+" "+n.y1+" "+n.x2+" "+n.y2+" "+n.x+" "+n.y;else if(n.type===Ne.SMOOTH_CURVE_TO)t+=(n.relative?"s":"S")+n.x2+" "+n.y2+" "+n.x+" "+n.y;else if(n.type===Ne.QUAD_TO)t+=(n.relative?"q":"Q")+n.x1+" "+n.y1+" "+n.x+" "+n.y;else if(n.type===Ne.SMOOTH_QUAD_TO)t+=(n.relative?"t":"T")+n.x+" "+n.y;else{if(n.type!==Ne.ARC)throw new Error('Unexpected command type "'+n.type+'" at index '+e+".");t+=(n.relative?"a":"A")+n.rX+" "+n.rY+" "+n.xRot+" "+ +n.lArcFlag+" "+ +n.sweepFlag+" "+n.x+" "+n.y}}return t}function tC(r,t){var e=r[0],n=r[1];return[e*Math.cos(t)-n*Math.sin(t),e*Math.sin(t)+n*Math.cos(t)]}function Wc(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];for(var e=0;e<r.length;e++)if(typeof r[e]!="number")throw new Error("assertNumbers arguments["+e+"] is not a number. "+typeof r[e]+" == typeof "+r[e]);return!0}var zu=Math.PI;function eC(r,t,e){r.lArcFlag=r.lArcFlag===0?0:1,r.sweepFlag=r.sweepFlag===0?0:1;var n=r.rX,i=r.rY,s=r.x,a=r.y;n=Math.abs(r.rX),i=Math.abs(r.rY);var o=tC([(t-s)/2,(e-a)/2],-r.xRot/180*zu),h=o[0],f=o[1],g=Math.pow(h,2)/Math.pow(n,2)+Math.pow(f,2)/Math.pow(i,2);1<g&&(n*=Math.sqrt(g),i*=Math.sqrt(g)),r.rX=n,r.rY=i;var b=Math.pow(n,2)*Math.pow(f,2)+Math.pow(i,2)*Math.pow(h,2),C=(r.lArcFlag!==r.sweepFlag?1:-1)*Math.sqrt(Math.max(0,(Math.pow(n,2)*Math.pow(i,2)-b)/b)),B=n*f/i*C,R=-i*h/n*C,D=tC([B,R],r.xRot/180*zu);r.cX=D[0]+(t+s)/2,r.cY=D[1]+(e+a)/2,r.phi1=Math.atan2((f-R)/i,(h-B)/n),r.phi2=Math.atan2((-f-R)/i,(-h-B)/n),r.sweepFlag===0&&r.phi2>r.phi1&&(r.phi2-=2*zu),r.sweepFlag===1&&r.phi2<r.phi1&&(r.phi2+=2*zu),r.phi1*=180/zu,r.phi2*=180/zu}function TD(r,t,e){Wc(r,t,e);var n=r*r+t*t-e*e;if(0>n)return[];if(n===0)return[[r*e/(r*r+t*t),t*e/(r*r+t*t)]];var i=Math.sqrt(n);return[[(r*e+t*i)/(r*r+t*t),(t*e-r*i)/(r*r+t*t)],[(r*e-t*i)/(r*r+t*t),(t*e+r*i)/(r*r+t*t)]]}var ds,NA=Math.PI/180;function ID(r,t,e){return(1-e)*r+e*t}function LD(r,t,e,n){return r+Math.cos(n/180*zu)*t+Math.sin(n/180*zu)*e}function FD(r,t,e,n){var i=1e-6,s=t-r,a=e-t,o=3*s+3*(n-e)-6*a,h=6*(a-s),f=3*s;return Math.abs(o)<i?[-f/h]:function(g,b,C){C===void 0&&(C=1e-6);var B=g*g/4-b;if(B<-C)return[];if(B<=C)return[-g/2];var R=Math.sqrt(B);return[-g/2-R,-g/2+R]}(h/o,f/o,i)}function MD(r,t,e,n,i){var s=1-i;return r*(s*s*s)+t*(3*s*s*i)+e*(3*s*i*i)+n*(i*i*i)}(function(r){function t(){return i(function(o,h,f){return o.relative&&(o.x1!==void 0&&(o.x1+=h),o.y1!==void 0&&(o.y1+=f),o.x2!==void 0&&(o.x2+=h),o.y2!==void 0&&(o.y2+=f),o.x!==void 0&&(o.x+=h),o.y!==void 0&&(o.y+=f),o.relative=!1),o})}function e(){var o=NaN,h=NaN,f=NaN,g=NaN;return i(function(b,C,B){return b.type&Ne.SMOOTH_CURVE_TO&&(b.type=Ne.CURVE_TO,o=isNaN(o)?C:o,h=isNaN(h)?B:h,b.x1=b.relative?C-o:2*C-o,b.y1=b.relative?B-h:2*B-h),b.type&Ne.CURVE_TO?(o=b.relative?C+b.x2:b.x2,h=b.relative?B+b.y2:b.y2):(o=NaN,h=NaN),b.type&Ne.SMOOTH_QUAD_TO&&(b.type=Ne.QUAD_TO,f=isNaN(f)?C:f,g=isNaN(g)?B:g,b.x1=b.relative?C-f:2*C-f,b.y1=b.relative?B-g:2*B-g),b.type&Ne.QUAD_TO?(f=b.relative?C+b.x1:b.x1,g=b.relative?B+b.y1:b.y1):(f=NaN,g=NaN),b})}function n(){var o=NaN,h=NaN;return i(function(f,g,b){if(f.type&Ne.SMOOTH_QUAD_TO&&(f.type=Ne.QUAD_TO,o=isNaN(o)?g:o,h=isNaN(h)?b:h,f.x1=f.relative?g-o:2*g-o,f.y1=f.relative?b-h:2*b-h),f.type&Ne.QUAD_TO){o=f.relative?g+f.x1:f.x1,h=f.relative?b+f.y1:f.y1;var C=f.x1,B=f.y1;f.type=Ne.CURVE_TO,f.x1=((f.relative?0:g)+2*C)/3,f.y1=((f.relative?0:b)+2*B)/3,f.x2=(f.x+2*C)/3,f.y2=(f.y+2*B)/3}else o=NaN,h=NaN;return f})}function i(o){var h=0,f=0,g=NaN,b=NaN;return function(C){if(isNaN(g)&&!(C.type&Ne.MOVE_TO))throw new Error("path must start with moveto");var B=o(C,h,f,g,b);return C.type&Ne.CLOSE_PATH&&(h=g,f=b),C.x!==void 0&&(h=C.relative?h+C.x:C.x),C.y!==void 0&&(f=C.relative?f+C.y:C.y),C.type&Ne.MOVE_TO&&(g=h,b=f),B}}function s(o,h,f,g,b,C){return Wc(o,h,f,g,b,C),i(function(B,R,D,Q){var k=B.x1,j=B.x2,et=B.relative&&!isNaN(Q),st=B.x!==void 0?B.x:et?0:R,mt=B.y!==void 0?B.y:et?0:D;function pt(rt){return rt*rt}B.type&Ne.HORIZ_LINE_TO&&h!==0&&(B.type=Ne.LINE_TO,B.y=B.relative?0:D),B.type&Ne.VERT_LINE_TO&&f!==0&&(B.type=Ne.LINE_TO,B.x=B.relative?0:R),B.x!==void 0&&(B.x=B.x*o+mt*f+(et?0:b)),B.y!==void 0&&(B.y=st*h+B.y*g+(et?0:C)),B.x1!==void 0&&(B.x1=B.x1*o+B.y1*f+(et?0:b)),B.y1!==void 0&&(B.y1=k*h+B.y1*g+(et?0:C)),B.x2!==void 0&&(B.x2=B.x2*o+B.y2*f+(et?0:b)),B.y2!==void 0&&(B.y2=j*h+B.y2*g+(et?0:C));var yt=o*g-h*f;if(B.xRot!==void 0&&(o!==1||h!==0||f!==0||g!==1))if(yt===0)delete B.rX,delete B.rY,delete B.xRot,delete B.lArcFlag,delete B.sweepFlag,B.type=Ne.LINE_TO;else{var ft=B.xRot*Math.PI/180,Dt=Math.sin(ft),It=Math.cos(ft),ut=1/pt(B.rX),At=1/pt(B.rY),Bt=pt(It)*ut+pt(Dt)*At,vt=2*Dt*It*(ut-At),ne=pt(Dt)*ut+pt(It)*At,ie=Bt*g*g-vt*h*g+ne*h*h,ae=vt*(o*g+h*f)-2*(Bt*f*g+ne*o*h),te=Bt*f*f-vt*o*f+ne*o*o,ce=(Math.atan2(ae,ie-te)+Math.PI)%Math.PI/2,le=Math.sin(ce),Te=Math.cos(ce);B.rX=Math.abs(yt)/Math.sqrt(ie*pt(Te)+ae*le*Te+te*pt(le)),B.rY=Math.abs(yt)/Math.sqrt(ie*pt(le)-ae*le*Te+te*pt(Te)),B.xRot=180*ce/Math.PI}return B.sweepFlag!==void 0&&0>yt&&(B.sweepFlag=+!B.sweepFlag),B})}function a(){return function(o){var h={};for(var f in o)h[f]=o[f];return h}}r.ROUND=function(o){function h(f){return Math.round(f*o)/o}return o===void 0&&(o=1e13),Wc(o),function(f){return f.x1!==void 0&&(f.x1=h(f.x1)),f.y1!==void 0&&(f.y1=h(f.y1)),f.x2!==void 0&&(f.x2=h(f.x2)),f.y2!==void 0&&(f.y2=h(f.y2)),f.x!==void 0&&(f.x=h(f.x)),f.y!==void 0&&(f.y=h(f.y)),f.rX!==void 0&&(f.rX=h(f.rX)),f.rY!==void 0&&(f.rY=h(f.rY)),f}},r.TO_ABS=t,r.TO_REL=function(){return i(function(o,h,f){return o.relative||(o.x1!==void 0&&(o.x1-=h),o.y1!==void 0&&(o.y1-=f),o.x2!==void 0&&(o.x2-=h),o.y2!==void 0&&(o.y2-=f),o.x!==void 0&&(o.x-=h),o.y!==void 0&&(o.y-=f),o.relative=!0),o})},r.NORMALIZE_HVZ=function(o,h,f){return o===void 0&&(o=!0),h===void 0&&(h=!0),f===void 0&&(f=!0),i(function(g,b,C,B,R){if(isNaN(B)&&!(g.type&Ne.MOVE_TO))throw new Error("path must start with moveto");return h&&g.type&Ne.HORIZ_LINE_TO&&(g.type=Ne.LINE_TO,g.y=g.relative?0:C),f&&g.type&Ne.VERT_LINE_TO&&(g.type=Ne.LINE_TO,g.x=g.relative?0:b),o&&g.type&Ne.CLOSE_PATH&&(g.type=Ne.LINE_TO,g.x=g.relative?B-b:B,g.y=g.relative?R-C:R),g.type&Ne.ARC&&(g.rX===0||g.rY===0)&&(g.type=Ne.LINE_TO,delete g.rX,delete g.rY,delete g.xRot,delete g.lArcFlag,delete g.sweepFlag),g})},r.NORMALIZE_ST=e,r.QT_TO_C=n,r.INFO=i,r.SANITIZE=function(o){o===void 0&&(o=0),Wc(o);var h=NaN,f=NaN,g=NaN,b=NaN;return i(function(C,B,R,D,Q){var k=Math.abs,j=!1,et=0,st=0;if(C.type&Ne.SMOOTH_CURVE_TO&&(et=isNaN(h)?0:B-h,st=isNaN(f)?0:R-f),C.type&(Ne.CURVE_TO|Ne.SMOOTH_CURVE_TO)?(h=C.relative?B+C.x2:C.x2,f=C.relative?R+C.y2:C.y2):(h=NaN,f=NaN),C.type&Ne.SMOOTH_QUAD_TO?(g=isNaN(g)?B:2*B-g,b=isNaN(b)?R:2*R-b):C.type&Ne.QUAD_TO?(g=C.relative?B+C.x1:C.x1,b=C.relative?R+C.y1:C.y2):(g=NaN,b=NaN),C.type&Ne.LINE_COMMANDS||C.type&Ne.ARC&&(C.rX===0||C.rY===0||!C.lArcFlag)||C.type&Ne.CURVE_TO||C.type&Ne.SMOOTH_CURVE_TO||C.type&Ne.QUAD_TO||C.type&Ne.SMOOTH_QUAD_TO){var mt=C.x===void 0?0:C.relative?C.x:C.x-B,pt=C.y===void 0?0:C.relative?C.y:C.y-R;et=isNaN(g)?C.x1===void 0?et:C.relative?C.x:C.x1-B:g-B,st=isNaN(b)?C.y1===void 0?st:C.relative?C.y:C.y1-R:b-R;var yt=C.x2===void 0?0:C.relative?C.x:C.x2-B,ft=C.y2===void 0?0:C.relative?C.y:C.y2-R;k(mt)<=o&&k(pt)<=o&&k(et)<=o&&k(st)<=o&&k(yt)<=o&&k(ft)<=o&&(j=!0)}return C.type&Ne.CLOSE_PATH&&k(B-D)<=o&&k(R-Q)<=o&&(j=!0),j?[]:C})},r.MATRIX=s,r.ROTATE=function(o,h,f){h===void 0&&(h=0),f===void 0&&(f=0),Wc(o,h,f);var g=Math.sin(o),b=Math.cos(o);return s(b,g,-g,b,h-h*b+f*g,f-h*g-f*b)},r.TRANSLATE=function(o,h){return h===void 0&&(h=0),Wc(o,h),s(1,0,0,1,o,h)},r.SCALE=function(o,h){return h===void 0&&(h=o),Wc(o,h),s(o,0,0,h,0,0)},r.SKEW_X=function(o){return Wc(o),s(1,0,Math.atan(o),1,0,0)},r.SKEW_Y=function(o){return Wc(o),s(1,Math.atan(o),0,1,0,0)},r.X_AXIS_SYMMETRY=function(o){return o===void 0&&(o=0),Wc(o),s(-1,0,0,1,o,0)},r.Y_AXIS_SYMMETRY=function(o){return o===void 0&&(o=0),Wc(o),s(1,0,0,-1,0,o)},r.A_TO_C=function(){return i(function(o,h,f){return Ne.ARC===o.type?function(g,b,C){var B,R,D,Q;g.cX||eC(g,b,C);for(var k=Math.min(g.phi1,g.phi2),j=Math.max(g.phi1,g.phi2)-k,et=Math.ceil(j/90),st=new Array(et),mt=b,pt=C,yt=0;yt<et;yt++){var ft=ID(g.phi1,g.phi2,yt/et),Dt=ID(g.phi1,g.phi2,(yt+1)/et),It=Dt-ft,ut=4/3*Math.tan(It*NA/4),At=[Math.cos(ft*NA)-ut*Math.sin(ft*NA),Math.sin(ft*NA)+ut*Math.cos(ft*NA)],Bt=At[0],vt=At[1],ne=[Math.cos(Dt*NA),Math.sin(Dt*NA)],ie=ne[0],ae=ne[1],te=[ie+ut*Math.sin(Dt*NA),ae-ut*Math.cos(Dt*NA)],ce=te[0],le=te[1];st[yt]={relative:g.relative,type:Ne.CURVE_TO};var Te=function(rt,wt){var St=tC([rt*g.rX,wt*g.rY],g.xRot),qt=St[0],Jt=St[1];return[g.cX+qt,g.cY+Jt]};B=Te(Bt,vt),st[yt].x1=B[0],st[yt].y1=B[1],R=Te(ce,le),st[yt].x2=R[0],st[yt].y2=R[1],D=Te(ie,ae),st[yt].x=D[0],st[yt].y=D[1],g.relative&&(st[yt].x1-=mt,st[yt].y1-=pt,st[yt].x2-=mt,st[yt].y2-=pt,st[yt].x-=mt,st[yt].y-=pt),mt=(Q=[st[yt].x,st[yt].y])[0],pt=Q[1]}return st}(o,o.relative?0:h,o.relative?0:f):o})},r.ANNOTATE_ARCS=function(){return i(function(o,h,f){return o.relative&&(h=0,f=0),Ne.ARC===o.type&&eC(o,h,f),o})},r.CLONE=a,r.CALCULATE_BOUNDS=function(){var o=function(C){var B={};for(var R in C)B[R]=C[R];return B},h=t(),f=n(),g=e(),b=i(function(C,B,R){var D=g(f(h(o(C))));function Q(le){le>b.maxX&&(b.maxX=le),le<b.minX&&(b.minX=le)}function k(le){le>b.maxY&&(b.maxY=le),le<b.minY&&(b.minY=le)}if(D.type&Ne.DRAWING_COMMANDS&&(Q(B),k(R)),D.type&Ne.HORIZ_LINE_TO&&Q(D.x),D.type&Ne.VERT_LINE_TO&&k(D.y),D.type&Ne.LINE_TO&&(Q(D.x),k(D.y)),D.type&Ne.CURVE_TO){Q(D.x),k(D.y);for(var j=0,et=FD(B,D.x1,D.x2,D.x);j<et.length;j++)0<(ce=et[j])&&1>ce&&Q(MD(B,D.x1,D.x2,D.x,ce));for(var st=0,mt=FD(R,D.y1,D.y2,D.y);st<mt.length;st++)0<(ce=mt[st])&&1>ce&&k(MD(R,D.y1,D.y2,D.y,ce))}if(D.type&Ne.ARC){Q(D.x),k(D.y),eC(D,B,R);for(var pt=D.xRot/180*Math.PI,yt=Math.cos(pt)*D.rX,ft=Math.sin(pt)*D.rX,Dt=-Math.sin(pt)*D.rY,It=Math.cos(pt)*D.rY,ut=D.phi1<D.phi2?[D.phi1,D.phi2]:-180>D.phi2?[D.phi2+360,D.phi1+360]:[D.phi2,D.phi1],At=ut[0],Bt=ut[1],vt=function(le){var Te=le[0],rt=le[1],wt=180*Math.atan2(rt,Te)/Math.PI;return wt<At?wt+360:wt},ne=0,ie=TD(Dt,-yt,0).map(vt);ne<ie.length;ne++)(ce=ie[ne])>At&&ce<Bt&&Q(LD(D.cX,yt,Dt,ce));for(var ae=0,te=TD(It,-ft,0).map(vt);ae<te.length;ae++){var ce;(ce=te[ae])>At&&ce<Bt&&k(LD(D.cY,ft,It,ce))}}return C});return b.minX=1/0,b.maxX=-1/0,b.minY=1/0,b.maxY=-1/0,b}})(ds||(ds={}));var Xc,PD=function(){function r(){}return r.prototype.round=function(t){return this.transform(ds.ROUND(t))},r.prototype.toAbs=function(){return this.transform(ds.TO_ABS())},r.prototype.toRel=function(){return this.transform(ds.TO_REL())},r.prototype.normalizeHVZ=function(t,e,n){return this.transform(ds.NORMALIZE_HVZ(t,e,n))},r.prototype.normalizeST=function(){return this.transform(ds.NORMALIZE_ST())},r.prototype.qtToC=function(){return this.transform(ds.QT_TO_C())},r.prototype.aToC=function(){return this.transform(ds.A_TO_C())},r.prototype.sanitize=function(t){return this.transform(ds.SANITIZE(t))},r.prototype.translate=function(t,e){return this.transform(ds.TRANSLATE(t,e))},r.prototype.scale=function(t,e){return this.transform(ds.SCALE(t,e))},r.prototype.rotate=function(t,e,n){return this.transform(ds.ROTATE(t,e,n))},r.prototype.matrix=function(t,e,n,i,s,a){return this.transform(ds.MATRIX(t,e,n,i,s,a))},r.prototype.skewX=function(t){return this.transform(ds.SKEW_X(t))},r.prototype.skewY=function(t){return this.transform(ds.SKEW_Y(t))},r.prototype.xSymmetry=function(t){return this.transform(ds.X_AXIS_SYMMETRY(t))},r.prototype.ySymmetry=function(t){return this.transform(ds.Y_AXIS_SYMMETRY(t))},r.prototype.annotateArcs=function(){return this.transform(ds.ANNOTATE_ARCS())},r}(),dyt=function(r){return r===" "||r==="	"||r==="\r"||r===`
`},UD=function(r){return 48<=r.charCodeAt(0)&&r.charCodeAt(0)<=57},fyt=function(r){function t(){var e=r.call(this)||this;return e.curNumber="",e.curCommandType=-1,e.curCommandRelative=!1,e.canParseCommandOrComma=!0,e.curNumberHasExp=!1,e.curNumberHasExpDigits=!1,e.curNumberHasDecimal=!1,e.curArgs=[],e}return SD(t,r),t.prototype.finish=function(e){if(e===void 0&&(e=[]),this.parse(" ",e),this.curArgs.length!==0||!this.canParseCommandOrComma)throw new SyntaxError("Unterminated command at the path end.");return e},t.prototype.parse=function(e,n){var i=this;n===void 0&&(n=[]);for(var s=function(b){n.push(b),i.curArgs.length=0,i.canParseCommandOrComma=!0},a=0;a<e.length;a++){var o=e[a],h=!(this.curCommandType!==Ne.ARC||this.curArgs.length!==3&&this.curArgs.length!==4||this.curNumber.length!==1||this.curNumber!=="0"&&this.curNumber!=="1"),f=UD(o)&&(this.curNumber==="0"&&o==="0"||h);if(!UD(o)||f)if(o!=="e"&&o!=="E")if(o!=="-"&&o!=="+"||!this.curNumberHasExp||this.curNumberHasExpDigits)if(o!=="."||this.curNumberHasExp||this.curNumberHasDecimal||h){if(this.curNumber&&this.curCommandType!==-1){var g=Number(this.curNumber);if(isNaN(g))throw new SyntaxError("Invalid number ending at "+a);if(this.curCommandType===Ne.ARC){if(this.curArgs.length===0||this.curArgs.length===1){if(0>g)throw new SyntaxError('Expected positive number, got "'+g+'" at index "'+a+'"')}else if((this.curArgs.length===3||this.curArgs.length===4)&&this.curNumber!=="0"&&this.curNumber!=="1")throw new SyntaxError('Expected a flag, got "'+this.curNumber+'" at index "'+a+'"')}this.curArgs.push(g),this.curArgs.length===pyt[this.curCommandType]&&(Ne.HORIZ_LINE_TO===this.curCommandType?s({type:Ne.HORIZ_LINE_TO,relative:this.curCommandRelative,x:g}):Ne.VERT_LINE_TO===this.curCommandType?s({type:Ne.VERT_LINE_TO,relative:this.curCommandRelative,y:g}):this.curCommandType===Ne.MOVE_TO||this.curCommandType===Ne.LINE_TO||this.curCommandType===Ne.SMOOTH_QUAD_TO?(s({type:this.curCommandType,relative:this.curCommandRelative,x:this.curArgs[0],y:this.curArgs[1]}),Ne.MOVE_TO===this.curCommandType&&(this.curCommandType=Ne.LINE_TO)):this.curCommandType===Ne.CURVE_TO?s({type:Ne.CURVE_TO,relative:this.curCommandRelative,x1:this.curArgs[0],y1:this.curArgs[1],x2:this.curArgs[2],y2:this.curArgs[3],x:this.curArgs[4],y:this.curArgs[5]}):this.curCommandType===Ne.SMOOTH_CURVE_TO?s({type:Ne.SMOOTH_CURVE_TO,relative:this.curCommandRelative,x2:this.curArgs[0],y2:this.curArgs[1],x:this.curArgs[2],y:this.curArgs[3]}):this.curCommandType===Ne.QUAD_TO?s({type:Ne.QUAD_TO,relative:this.curCommandRelative,x1:this.curArgs[0],y1:this.curArgs[1],x:this.curArgs[2],y:this.curArgs[3]}):this.curCommandType===Ne.ARC&&s({type:Ne.ARC,relative:this.curCommandRelative,rX:this.curArgs[0],rY:this.curArgs[1],xRot:this.curArgs[2],lArcFlag:this.curArgs[3],sweepFlag:this.curArgs[4],x:this.curArgs[5],y:this.curArgs[6]})),this.curNumber="",this.curNumberHasExpDigits=!1,this.curNumberHasExp=!1,this.curNumberHasDecimal=!1,this.canParseCommandOrComma=!0}if(!dyt(o))if(o===","&&this.canParseCommandOrComma)this.canParseCommandOrComma=!1;else if(o!=="+"&&o!=="-"&&o!==".")if(f)this.curNumber=o,this.curNumberHasDecimal=!1;else{if(this.curArgs.length!==0)throw new SyntaxError("Unterminated command at index "+a+".");if(!this.canParseCommandOrComma)throw new SyntaxError('Unexpected character "'+o+'" at index '+a+". Command cannot follow comma");if(this.canParseCommandOrComma=!1,o!=="z"&&o!=="Z")if(o==="h"||o==="H")this.curCommandType=Ne.HORIZ_LINE_TO,this.curCommandRelative=o==="h";else if(o==="v"||o==="V")this.curCommandType=Ne.VERT_LINE_TO,this.curCommandRelative=o==="v";else if(o==="m"||o==="M")this.curCommandType=Ne.MOVE_TO,this.curCommandRelative=o==="m";else if(o==="l"||o==="L")this.curCommandType=Ne.LINE_TO,this.curCommandRelative=o==="l";else if(o==="c"||o==="C")this.curCommandType=Ne.CURVE_TO,this.curCommandRelative=o==="c";else if(o==="s"||o==="S")this.curCommandType=Ne.SMOOTH_CURVE_TO,this.curCommandRelative=o==="s";else if(o==="q"||o==="Q")this.curCommandType=Ne.QUAD_TO,this.curCommandRelative=o==="q";else if(o==="t"||o==="T")this.curCommandType=Ne.SMOOTH_QUAD_TO,this.curCommandRelative=o==="t";else{if(o!=="a"&&o!=="A")throw new SyntaxError('Unexpected character "'+o+'" at index '+a+".");this.curCommandType=Ne.ARC,this.curCommandRelative=o==="a"}else n.push({type:Ne.CLOSE_PATH}),this.canParseCommandOrComma=!0,this.curCommandType=-1}else this.curNumber=o,this.curNumberHasDecimal=o==="."}else this.curNumber+=o,this.curNumberHasDecimal=!0;else this.curNumber+=o;else this.curNumber+=o,this.curNumberHasExp=!0;else this.curNumber+=o,this.curNumberHasExpDigits=this.curNumberHasExp}return n},t.prototype.transform=function(e){return Object.create(this,{parse:{value:function(n,i){i===void 0&&(i=[]);for(var s=0,a=Object.getPrototypeOf(this).parse.call(this,n);s<a.length;s++){var o=a[s],h=e(o);Array.isArray(h)?i.push.apply(i,h):i.push(h)}return i}}})},t}(PD),Ne=function(r){function t(e){var n=r.call(this)||this;return n.commands=typeof e=="string"?t.parse(e):e,n}return SD(t,r),t.prototype.encode=function(){return t.encode(this.commands)},t.prototype.getBounds=function(){var e=ds.CALCULATE_BOUNDS();return this.transform(e),e},t.prototype.transform=function(e){for(var n=[],i=0,s=this.commands;i<s.length;i++){var a=e(s[i]);Array.isArray(a)?n.push.apply(n,a):n.push(a)}return this.commands=n,this},t.encode=function(e){return hyt(e)},t.parse=function(e){var n=new fyt,i=[];return n.parse(e,i),n.finish(i),i},t.CLOSE_PATH=1,t.MOVE_TO=2,t.HORIZ_LINE_TO=4,t.VERT_LINE_TO=8,t.LINE_TO=16,t.CURVE_TO=32,t.SMOOTH_CURVE_TO=64,t.QUAD_TO=128,t.SMOOTH_QUAD_TO=256,t.ARC=512,t.LINE_COMMANDS=t.LINE_TO|t.HORIZ_LINE_TO|t.VERT_LINE_TO,t.DRAWING_COMMANDS=t.HORIZ_LINE_TO|t.VERT_LINE_TO|t.LINE_TO|t.CURVE_TO|t.SMOOTH_CURVE_TO|t.QUAD_TO|t.SMOOTH_QUAD_TO|t.ARC,t}(PD),pyt=((Xc={})[Ne.MOVE_TO]=2,Xc[Ne.LINE_TO]=2,Xc[Ne.HORIZ_LINE_TO]=1,Xc[Ne.VERT_LINE_TO]=1,Xc[Ne.CLOSE_PATH]=0,Xc[Ne.QUAD_TO]=4,Xc[Ne.SMOOTH_QUAD_TO]=2,Xc[Ne.CURVE_TO]=6,Xc[Ne.SMOOTH_CURVE_TO]=4,Xc[Ne.ARC]=7,Xc),gyt=Ws,myt=$c,yyt=s1,_yt=lR,RD=RegExp.prototype,vyt=function(r){var t=r.flags;return t===void 0&&!("flags"in RD)&&!myt(r,"flags")&&yyt(RD,r)?gyt(_yt,r):t},byt=h1.PROPER,wyt=kh,xyt=wo,DD=jl,Byt=Yi,Cyt=vyt,rC="toString",Eyt=RegExp.prototype,OD=Eyt[rC],Syt=Byt(function(){return OD.call({source:"a",flags:"b"})!="/a/b"}),Tyt=byt&&OD.name!=rC;(Syt||Tyt)&&wyt(RegExp.prototype,rC,function(){var r=xyt(this),t=DD(r.source),e=DD(Cyt(r));return"/"+t+"/"+e},{unsafe:!0});function G1(r){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?G1=function(t){return typeof t}:G1=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},G1(r)}function Iyt(r,t){if(!(r instanceof t))throw new TypeError("Cannot call a class as a function")}var Lyt=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],Fyt=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function Myt(r,t,e,n,i){if(typeof r=="string"&&(r=document.getElementById(r)),!r||G1(r)!=="object"||!("getContext"in r))throw new TypeError("Expecting canvas with `getContext` method in processCanvasRGB(A) calls!");var s=r.getContext("2d");try{return s.getImageData(t,e,n,i)}catch(a){throw new Error("unable to access image data: "+a)}}function Pyt(r,t,e,n,i,s){if(!(isNaN(s)||s<1)){s|=0;var a=Myt(r,t,e,n,i);a=Uyt(a,t,e,n,i,s),r.getContext("2d").putImageData(a,t,e)}}function Uyt(r,t,e,n,i,s){for(var a=r.data,o=2*s+1,h=n-1,f=i-1,g=s+1,b=g*(g+1)/2,C=new ND,B=C,R,D=1;D<o;D++)B=B.next=new ND,D===g&&(R=B);B.next=C;for(var Q=null,k=null,j=0,et=0,st=Lyt[s],mt=Fyt[s],pt=0;pt<i;pt++){B=C;for(var yt=a[et],ft=a[et+1],Dt=a[et+2],It=a[et+3],ut=0;ut<g;ut++)B.r=yt,B.g=ft,B.b=Dt,B.a=It,B=B.next;for(var At=0,Bt=0,vt=0,ne=0,ie=g*yt,ae=g*ft,te=g*Dt,ce=g*It,le=b*yt,Te=b*ft,rt=b*Dt,wt=b*It,St=1;St<g;St++){var qt=et+((h<St?h:St)<<2),Jt=a[qt],se=a[qt+1],Ae=a[qt+2],oe=a[qt+3],Ce=g-St;le+=(B.r=Jt)*Ce,Te+=(B.g=se)*Ce,rt+=(B.b=Ae)*Ce,wt+=(B.a=oe)*Ce,At+=Jt,Bt+=se,vt+=Ae,ne+=oe,B=B.next}Q=C,k=R;for(var Pe=0;Pe<n;Pe++){var Ve=wt*st>>mt;if(a[et+3]=Ve,Ve!==0){var Ke=255/Ve;a[et]=(le*st>>mt)*Ke,a[et+1]=(Te*st>>mt)*Ke,a[et+2]=(rt*st>>mt)*Ke}else a[et]=a[et+1]=a[et+2]=0;le-=ie,Te-=ae,rt-=te,wt-=ce,ie-=Q.r,ae-=Q.g,te-=Q.b,ce-=Q.a;var rr=Pe+s+1;rr=j+(rr<h?rr:h)<<2,At+=Q.r=a[rr],Bt+=Q.g=a[rr+1],vt+=Q.b=a[rr+2],ne+=Q.a=a[rr+3],le+=At,Te+=Bt,rt+=vt,wt+=ne,Q=Q.next;var _e=k,Ut=_e.r,pr=_e.g,ir=_e.b,Se=_e.a;ie+=Ut,ae+=pr,te+=ir,ce+=Se,At-=Ut,Bt-=pr,vt-=ir,ne-=Se,k=k.next,et+=4}j+=n}for(var Kt=0;Kt<n;Kt++){et=Kt<<2;var Ie=a[et],ke=a[et+1],He=a[et+2],De=a[et+3],xr=g*Ie,Pr=g*ke,Or=g*He,nn=g*De,Br=b*Ie,Ur=b*ke,je=b*He,Ee=b*De;B=C;for(var Nr=0;Nr<g;Nr++)B.r=Ie,B.g=ke,B.b=He,B.a=De,B=B.next;for(var Vr=n,qr=0,rn=0,Fe=0,Ze=0,ur=1;ur<=s;ur++){et=Vr+Kt<<2;var Jr=g-ur;Br+=(B.r=Ie=a[et])*Jr,Ur+=(B.g=ke=a[et+1])*Jr,je+=(B.b=He=a[et+2])*Jr,Ee+=(B.a=De=a[et+3])*Jr,Ze+=Ie,qr+=ke,rn+=He,Fe+=De,B=B.next,ur<f&&(Vr+=n)}et=Kt,Q=C,k=R;for(var Un=0;Un<i;Un++){var qe=et<<2;a[qe+3]=De=Ee*st>>mt,De>0?(De=255/De,a[qe]=(Br*st>>mt)*De,a[qe+1]=(Ur*st>>mt)*De,a[qe+2]=(je*st>>mt)*De):a[qe]=a[qe+1]=a[qe+2]=0,Br-=xr,Ur-=Pr,je-=Or,Ee-=nn,xr-=Q.r,Pr-=Q.g,Or-=Q.b,nn-=Q.a,qe=Kt+((qe=Un+g)<f?qe:f)*n<<2,Br+=Ze+=Q.r=a[qe],Ur+=qr+=Q.g=a[qe+1],je+=rn+=Q.b=a[qe+2],Ee+=Fe+=Q.a=a[qe+3],Q=Q.next,xr+=Ie=k.r,Pr+=ke=k.g,Or+=He=k.b,nn+=De=k.a,Ze-=Ie,qr-=ke,rn-=He,Fe-=De,k=k.next,et+=n}}return r}var ND=function r(){Iyt(this,r),this.r=0,this.g=0,this.b=0,this.a=0,this.next=null};function Ryt(){var{DOMParser:r}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t={window:null,ignoreAnimation:!0,ignoreMouse:!0,DOMParser:r,createCanvas(e,n){return new OffscreenCanvas(e,n)},createImage(e){return DA(function*(){var n=yield fetch(e),i=yield n.blob(),s=yield createImageBitmap(i);return s})()}};return(typeof DOMParser<"u"||typeof r>"u")&&Reflect.deleteProperty(t,"DOMParser"),t}function Dyt(r){var{DOMParser:t,canvas:e,fetch:n}=r;return{window:null,ignoreAnimation:!0,ignoreMouse:!0,DOMParser:t,fetch:n,createCanvas:e.createCanvas,createImage:e.loadImage}}var Oyt=Object.freeze({__proto__:null,offscreen:Ryt,node:Dyt});function jh(r){return r.replace(/(?!\u3000)\s+/gm," ")}function kD(r){return r.replace(/^[\n \t]+/,"")}function QD(r){return r.replace(/[\n \t]+$/,"")}function da(r){var t=(r||"").match(/-?(\d+(?:\.\d*(?:[eE][+-]?\d+)?)?|\.\d+)(?=\D|$)/gm)||[];return t.map(parseFloat)}var Nyt=/^[A-Z-]+$/;function zD(r){return Nyt.test(r)?r.toLowerCase():r}function nC(r){var t=/url\(('([^']+)'|"([^"]+)"|([^'")]+))\)/.exec(r)||[];return t[2]||t[3]||t[4]}function HD(r){if(!r.startsWith("rgb"))return r;var t=3,e=r.replace(/\d+(\.\d+)?/g,(n,i)=>t--&&i?String(Math.round(parseFloat(n))):n);return e}var kyt=/(\[[^\]]+\])/g,Qyt=/(#[^\s+>~.[:]+)/g,zyt=/(\.[^\s+>~.[:]+)/g,Hyt=/(::[^\s+>~.[:]+|:first-line|:first-letter|:before|:after)/gi,Gyt=/(:[\w-]+\([^)]*\))/gi,Vyt=/(:[^\s+>~.[:]+)/g,jyt=/([^\s+>~.[:]+)/g;function qh(r,t){var e=t.exec(r);return e?[r.replace(t," "),e.length]:[r,0]}function GD(r){var t=[0,0,0],e=r.replace(/:not\(([^)]*)\)/g,"     $1 ").replace(/{[\s\S]*/gm," "),n=0;return[e,n]=qh(e,kyt),t[1]+=n,[e,n]=qh(e,Qyt),t[0]+=n,[e,n]=qh(e,zyt),t[1]+=n,[e,n]=qh(e,Hyt),t[2]+=n,[e,n]=qh(e,Gyt),t[1]+=n,[e,n]=qh(e,Vyt),t[1]+=n,e=e.replace(/[*\s+>~]/g," ").replace(/[#.]/g," "),[e,n]=qh(e,jyt),t[2]+=n,t.join("")}var Kh=1e-8;function iC(r){return Math.sqrt(Math.pow(r[0],2)+Math.pow(r[1],2))}function V1(r,t){return(r[0]*t[0]+r[1]*t[1])/(iC(r)*iC(t))}function sC(r,t){return(r[0]*t[1]<r[1]*t[0]?-1:1)*Math.acos(V1(r,t))}function oC(r){return r*r*r}function aC(r){return 3*r*r*(1-r)}function cC(r){return 3*r*(1-r)*(1-r)}function lC(r){return(1-r)*(1-r)*(1-r)}function AC(r){return r*r}function uC(r){return 2*r*(1-r)}function hC(r){return(1-r)*(1-r)}class Dr{constructor(t,e,n){this.document=t,this.name=e,this.value=n,this.isNormalizedColor=!1}static empty(t){return new Dr(t,"EMPTY","")}split(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:" ",{document:e,name:n}=this;return jh(this.getString()).trim().split(t).map(i=>new Dr(e,n,i))}hasValue(t){var{value:e}=this;return e!==null&&e!==""&&(t||e!==0)&&typeof e<"u"}isString(t){var{value:e}=this,n=typeof e=="string";return!n||!t?n:t.test(e)}isUrlDefinition(){return this.isString(/^url\(/)}isPixels(){if(!this.hasValue())return!1;var t=this.getString();switch(!0){case t.endsWith("px"):case/^[0-9]+$/.test(t):return!0;default:return!1}}setValue(t){return this.value=t,this}getValue(t){return typeof t>"u"||this.hasValue()?this.value:t}getNumber(t){if(!this.hasValue())return typeof t>"u"?0:parseFloat(t);var{value:e}=this,n=parseFloat(e);return this.isString(/%$/)&&(n/=100),n}getString(t){return typeof t>"u"||this.hasValue()?typeof this.value>"u"?"":String(this.value):String(t)}getColor(t){var e=this.getString(t);return this.isNormalizedColor||(this.isNormalizedColor=!0,e=HD(e),this.value=e),e}getDpi(){return 96}getRem(){return this.document.rootEmSize}getEm(){return this.document.emSize}getUnits(){return this.getString().replace(/[0-9.-]/g,"")}getPixels(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!this.hasValue())return 0;var[n,i]=typeof t=="boolean"?[void 0,t]:[t],{viewPort:s}=this.document.screen;switch(!0){case this.isString(/vmin$/):return this.getNumber()/100*Math.min(s.computeSize("x"),s.computeSize("y"));case this.isString(/vmax$/):return this.getNumber()/100*Math.max(s.computeSize("x"),s.computeSize("y"));case this.isString(/vw$/):return this.getNumber()/100*s.computeSize("x");case this.isString(/vh$/):return this.getNumber()/100*s.computeSize("y");case this.isString(/rem$/):return this.getNumber()*this.getRem();case this.isString(/em$/):return this.getNumber()*this.getEm();case this.isString(/ex$/):return this.getNumber()*this.getEm()/2;case this.isString(/px$/):return this.getNumber();case this.isString(/pt$/):return this.getNumber()*this.getDpi()*(1/72);case this.isString(/pc$/):return this.getNumber()*15;case this.isString(/cm$/):return this.getNumber()*this.getDpi()/2.54;case this.isString(/mm$/):return this.getNumber()*this.getDpi()/25.4;case this.isString(/in$/):return this.getNumber()*this.getDpi();case(this.isString(/%$/)&&i):return this.getNumber()*this.getEm();case this.isString(/%$/):return this.getNumber()*s.computeSize(n);default:{var a=this.getNumber();return e&&a<1?a*s.computeSize(n):a}}}getMilliseconds(){return this.hasValue()?this.isString(/ms$/)?this.getNumber():this.getNumber()*1e3:0}getRadians(){if(!this.hasValue())return 0;switch(!0){case this.isString(/deg$/):return this.getNumber()*(Math.PI/180);case this.isString(/grad$/):return this.getNumber()*(Math.PI/200);case this.isString(/rad$/):return this.getNumber();default:return this.getNumber()*(Math.PI/180)}}getDefinition(){var t=this.getString(),e=/#([^)'"]+)/.exec(t);return e&&(e=e[1]),e||(e=t),this.document.definitions[e]}getFillStyleDefinition(t,e){var n=this.getDefinition();if(!n)return null;if(typeof n.createGradient=="function")return n.createGradient(this.document.ctx,t,e);if(typeof n.createPattern=="function"){if(n.getHrefAttribute().hasValue()){var i=n.getAttribute("patternTransform");n=n.getHrefAttribute().getDefinition(),i.hasValue()&&n.getAttribute("patternTransform",!0).setValue(i.value)}return n.createPattern(this.document.ctx,t,e)}return null}getTextBaseline(){return this.hasValue()?Dr.textBaselineMapping[this.getString()]:null}addOpacity(t){for(var e=this.getColor(),n=e.length,i=0,s=0;s<n&&(e[s]===","&&i++,i!==3);s++);if(t.hasValue()&&this.isString()&&i!==3){var a=new YB(e);a.ok&&(a.alpha=t.getNumber(),e=a.toRGBA())}return new Dr(this.document,this.name,e)}}Dr.textBaselineMapping={baseline:"alphabetic","before-edge":"top","text-before-edge":"top",middle:"middle",central:"middle","after-edge":"bottom","text-after-edge":"bottom",ideographic:"ideographic",alphabetic:"alphabetic",hanging:"hanging",mathematical:"alphabetic"};class VD{constructor(){this.viewPorts=[]}clear(){this.viewPorts=[]}setCurrent(t,e){this.viewPorts.push({width:t,height:e})}removeCurrent(){this.viewPorts.pop()}getCurrent(){var{viewPorts:t}=this;return t[t.length-1]}get width(){return this.getCurrent().width}get height(){return this.getCurrent().height}computeSize(t){return typeof t=="number"?t:t==="x"?this.width:t==="y"?this.height:Math.sqrt(Math.pow(this.width,2)+Math.pow(this.height,2))/Math.sqrt(2)}}class Hi{constructor(t,e){this.x=t,this.y=e}static parse(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,[n=e,i=e]=da(t);return new Hi(n,i)}static parseScale(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,[n=e,i=n]=da(t);return new Hi(n,i)}static parsePath(t){for(var e=da(t),n=e.length,i=[],s=0;s<n;s+=2)i.push(new Hi(e[s],e[s+1]));return i}angleTo(t){return Math.atan2(t.y-this.y,t.x-this.x)}applyTransform(t){var{x:e,y:n}=this,i=e*t[0]+n*t[2]+t[4],s=e*t[1]+n*t[3]+t[5];this.x=i,this.y=s}}class jD{constructor(t){this.screen=t,this.working=!1,this.events=[],this.eventElements=[],this.onClick=this.onClick.bind(this),this.onMouseMove=this.onMouseMove.bind(this)}isWorking(){return this.working}start(){if(!this.working){var{screen:t,onClick:e,onMouseMove:n}=this,i=t.ctx.canvas;i.onclick=e,i.onmousemove=n,this.working=!0}}stop(){if(this.working){var t=this.screen.ctx.canvas;this.working=!1,t.onclick=null,t.onmousemove=null}}hasEvents(){return this.working&&this.events.length>0}runEvents(){if(this.working){var{screen:t,events:e,eventElements:n}=this,{style:i}=t.ctx.canvas;i&&(i.cursor=""),e.forEach((s,a)=>{for(var{run:o}=s,h=n[a];h;)o(h),h=h.parent}),this.events=[],this.eventElements=[]}}checkPath(t,e){if(!(!this.working||!e)){var{events:n,eventElements:i}=this;n.forEach((s,a)=>{var{x:o,y:h}=s;!i[a]&&e.isPointInPath&&e.isPointInPath(o,h)&&(i[a]=t)})}}checkBoundingBox(t,e){if(!(!this.working||!e)){var{events:n,eventElements:i}=this;n.forEach((s,a)=>{var{x:o,y:h}=s;!i[a]&&e.isPointInBox(o,h)&&(i[a]=t)})}}mapXY(t,e){for(var{window:n,ctx:i}=this.screen,s=new Hi(t,e),a=i.canvas;a;)s.x-=a.offsetLeft,s.y-=a.offsetTop,a=a.offsetParent;return n.scrollX&&(s.x+=n.scrollX),n.scrollY&&(s.y+=n.scrollY),s}onClick(t){var{x:e,y:n}=this.mapXY(t.clientX,t.clientY);this.events.push({type:"onclick",x:e,y:n,run(i){i.onClick&&i.onClick()}})}onMouseMove(t){var{x:e,y:n}=this.mapXY(t.clientX,t.clientY);this.events.push({type:"onmousemove",x:e,y:n,run(i){i.onMouseMove&&i.onMouseMove()}})}}var qD=typeof window<"u"?window:null,KD=typeof fetch<"u"?fetch.bind(void 0):null;class Xg{constructor(t){var{fetch:e=KD,window:n=qD}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.ctx=t,this.FRAMERATE=30,this.MAX_VIRTUAL_PIXELS=3e4,this.CLIENT_WIDTH=800,this.CLIENT_HEIGHT=600,this.viewPort=new VD,this.mouse=new jD(this),this.animations=[],this.waits=[],this.frameDuration=0,this.isReadyLock=!1,this.isFirstRender=!0,this.intervalId=null,this.window=n,this.fetch=e}wait(t){this.waits.push(t)}ready(){return this.readyPromise?this.readyPromise:Promise.resolve()}isReady(){if(this.isReadyLock)return!0;var t=this.waits.every(e=>e());return t&&(this.waits=[],this.resolveReady&&this.resolveReady()),this.isReadyLock=t,t}setDefaults(t){t.strokeStyle="rgba(0,0,0,0)",t.lineCap="butt",t.lineJoin="miter",t.miterLimit=4}setViewBox(t){var{document:e,ctx:n,aspectRatio:i,width:s,desiredWidth:a,height:o,desiredHeight:h,minX:f=0,minY:g=0,refX:b,refY:C,clip:B=!1,clipX:R=0,clipY:D=0}=t,Q=jh(i).replace(/^defer\s/,""),[k,j]=Q.split(" "),et=k||"xMidYMid",st=j||"meet",mt=s/a,pt=o/h,yt=Math.min(mt,pt),ft=Math.max(mt,pt),Dt=a,It=h;st==="meet"&&(Dt*=yt,It*=yt),st==="slice"&&(Dt*=ft,It*=ft);var ut=new Dr(e,"refX",b),At=new Dr(e,"refY",C),Bt=ut.hasValue()&&At.hasValue();if(Bt&&n.translate(-yt*ut.getPixels("x"),-yt*At.getPixels("y")),B){var vt=yt*R,ne=yt*D;n.beginPath(),n.moveTo(vt,ne),n.lineTo(s,ne),n.lineTo(s,o),n.lineTo(vt,o),n.closePath(),n.clip()}if(!Bt){var ie=st==="meet"&&yt===pt,ae=st==="slice"&&ft===pt,te=st==="meet"&&yt===mt,ce=st==="slice"&&ft===mt;et.startsWith("xMid")&&(ie||ae)&&n.translate(s/2-Dt/2,0),et.endsWith("YMid")&&(te||ce)&&n.translate(0,o/2-It/2),et.startsWith("xMax")&&(ie||ae)&&n.translate(s-Dt,0),et.endsWith("YMax")&&(te||ce)&&n.translate(0,o-It)}switch(!0){case et==="none":n.scale(mt,pt);break;case st==="meet":n.scale(yt,yt);break;case st==="slice":n.scale(ft,ft);break}n.translate(-f,-g)}start(t){var{enableRedraw:e=!1,ignoreMouse:n=!1,ignoreAnimation:i=!1,ignoreDimensions:s=!1,ignoreClear:a=!1,forceRedraw:o,scaleWidth:h,scaleHeight:f,offsetX:g,offsetY:b}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{FRAMERATE:C,mouse:B}=this,R=1e3/C;if(this.frameDuration=R,this.readyPromise=new Promise(et=>{this.resolveReady=et}),this.isReady()&&this.render(t,s,a,h,f,g,b),!!e){var D=Date.now(),Q=D,k=0,j=()=>{D=Date.now(),k=D-Q,k>=R&&(Q=D-k%R,this.shouldUpdate(i,o)&&(this.render(t,s,a,h,f,g,b),B.runEvents())),this.intervalId=WB(j)};n||B.start(),this.intervalId=WB(j)}}stop(){this.intervalId&&(WB.cancel(this.intervalId),this.intervalId=null),this.mouse.stop()}shouldUpdate(t,e){if(!t){var{frameDuration:n}=this,i=this.animations.reduce((s,a)=>a.update(n)||s,!1);if(i)return!0}return!!(typeof e=="function"&&e()||!this.isReadyLock&&this.isReady()||this.mouse.hasEvents())}render(t,e,n,i,s,a,o){var{CLIENT_WIDTH:h,CLIENT_HEIGHT:f,viewPort:g,ctx:b,isFirstRender:C}=this,B=b.canvas;g.clear(),B.width&&B.height?g.setCurrent(B.width,B.height):g.setCurrent(h,f);var R=t.getStyle("width"),D=t.getStyle("height");!e&&(C||typeof i!="number"&&typeof s!="number")&&(R.hasValue()&&(B.width=R.getPixels("x"),B.style&&(B.style.width="".concat(B.width,"px"))),D.hasValue()&&(B.height=D.getPixels("y"),B.style&&(B.style.height="".concat(B.height,"px"))));var Q=B.clientWidth||B.width,k=B.clientHeight||B.height;if(e&&R.hasValue()&&D.hasValue()&&(Q=R.getPixels("x"),k=D.getPixels("y")),g.setCurrent(Q,k),typeof a=="number"&&t.getAttribute("x",!0).setValue(a),typeof o=="number"&&t.getAttribute("y",!0).setValue(o),typeof i=="number"||typeof s=="number"){var j=da(t.getAttribute("viewBox").getString()),et=0,st=0;if(typeof i=="number"){var mt=t.getStyle("width");mt.hasValue()?et=mt.getPixels("x")/i:isNaN(j[2])||(et=j[2]/i)}if(typeof s=="number"){var pt=t.getStyle("height");pt.hasValue()?st=pt.getPixels("y")/s:isNaN(j[3])||(st=j[3]/s)}et||(et=st),st||(st=et),t.getAttribute("width",!0).setValue(i),t.getAttribute("height",!0).setValue(s);var yt=t.getStyle("transform",!0,!0);yt.setValue("".concat(yt.getString()," scale(").concat(1/et,", ").concat(1/st,")"))}n||b.clearRect(0,0,Q,k),t.render(b),C&&(this.isFirstRender=!1)}}Xg.defaultWindow=qD,Xg.defaultFetch=KD;var{defaultFetch:qyt}=Xg,Kyt=typeof DOMParser<"u"?DOMParser:null;class j1{constructor(){var{fetch:t=qyt,DOMParser:e=Kyt}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.fetch=t,this.DOMParser=e}parse(t){var e=this;return DA(function*(){return t.startsWith("<")?e.parseFromString(t):e.load(t)})()}parseFromString(t){var e=new this.DOMParser;try{return this.checkDocument(e.parseFromString(t,"image/svg+xml"))}catch{return this.checkDocument(e.parseFromString(t,"text/xml"))}}checkDocument(t){var e=t.getElementsByTagName("parsererror")[0];if(e)throw new Error(e.textContent);return t}load(t){var e=this;return DA(function*(){var n=yield e.fetch(t),i=yield n.text();return e.parseFromString(i)})()}}class $D{constructor(t,e){this.type="translate",this.point=null,this.point=Hi.parse(e)}apply(t){var{x:e,y:n}=this.point;t.translate(e||0,n||0)}unapply(t){var{x:e,y:n}=this.point;t.translate(-1*e||0,-1*n||0)}applyToPoint(t){var{x:e,y:n}=this.point;t.applyTransform([1,0,0,1,e||0,n||0])}}class WD{constructor(t,e,n){this.type="rotate",this.angle=null,this.originX=null,this.originY=null,this.cx=0,this.cy=0;var i=da(e);this.angle=new Dr(t,"angle",i[0]),this.originX=n[0],this.originY=n[1],this.cx=i[1]||0,this.cy=i[2]||0}apply(t){var{cx:e,cy:n,originX:i,originY:s,angle:a}=this,o=e+i.getPixels("x"),h=n+s.getPixels("y");t.translate(o,h),t.rotate(a.getRadians()),t.translate(-o,-h)}unapply(t){var{cx:e,cy:n,originX:i,originY:s,angle:a}=this,o=e+i.getPixels("x"),h=n+s.getPixels("y");t.translate(o,h),t.rotate(-1*a.getRadians()),t.translate(-o,-h)}applyToPoint(t){var{cx:e,cy:n,angle:i}=this,s=i.getRadians();t.applyTransform([1,0,0,1,e||0,n||0]),t.applyTransform([Math.cos(s),Math.sin(s),-Math.sin(s),Math.cos(s),0,0]),t.applyTransform([1,0,0,1,-e||0,-n||0])}}class XD{constructor(t,e,n){this.type="scale",this.scale=null,this.originX=null,this.originY=null;var i=Hi.parseScale(e);(i.x===0||i.y===0)&&(i.x=Kh,i.y=Kh),this.scale=i,this.originX=n[0],this.originY=n[1]}apply(t){var{scale:{x:e,y:n},originX:i,originY:s}=this,a=i.getPixels("x"),o=s.getPixels("y");t.translate(a,o),t.scale(e,n||e),t.translate(-a,-o)}unapply(t){var{scale:{x:e,y:n},originX:i,originY:s}=this,a=i.getPixels("x"),o=s.getPixels("y");t.translate(a,o),t.scale(1/e,1/n||e),t.translate(-a,-o)}applyToPoint(t){var{x:e,y:n}=this.scale;t.applyTransform([e||0,0,0,n||0,0,0])}}class dC{constructor(t,e,n){this.type="matrix",this.matrix=[],this.originX=null,this.originY=null,this.matrix=da(e),this.originX=n[0],this.originY=n[1]}apply(t){var{originX:e,originY:n,matrix:i}=this,s=e.getPixels("x"),a=n.getPixels("y");t.translate(s,a),t.transform(i[0],i[1],i[2],i[3],i[4],i[5]),t.translate(-s,-a)}unapply(t){var{originX:e,originY:n,matrix:i}=this,s=i[0],a=i[2],o=i[4],h=i[1],f=i[3],g=i[5],b=0,C=0,B=1,R=1/(s*(f*B-g*C)-a*(h*B-g*b)+o*(h*C-f*b)),D=e.getPixels("x"),Q=n.getPixels("y");t.translate(D,Q),t.transform(R*(f*B-g*C),R*(g*b-h*B),R*(o*C-a*B),R*(s*B-o*b),R*(a*g-o*f),R*(o*h-s*g)),t.translate(-D,-Q)}applyToPoint(t){t.applyTransform(this.matrix)}}class fC extends dC{constructor(t,e,n){super(t,e,n),this.type="skew",this.angle=null,this.angle=new Dr(t,"angle",e)}}class JD extends fC{constructor(t,e,n){super(t,e,n),this.type="skewX",this.matrix=[1,0,Math.tan(this.angle.getRadians()),1,0,0]}}class YD extends fC{constructor(t,e,n){super(t,e,n),this.type="skewY",this.matrix=[1,Math.tan(this.angle.getRadians()),0,1,0,0]}}function $yt(r){return jh(r).trim().replace(/\)([a-zA-Z])/g,") $1").replace(/\)(\s?,\s?)/g,") ").split(/\s(?=[a-z])/)}function Wyt(r){var[t,e]=r.split("(");return[t.trim(),e.trim().replace(")","")]}class Hu{constructor(t,e,n){this.document=t,this.transforms=[];var i=$yt(e);i.forEach(s=>{if(s!=="none"){var[a,o]=Wyt(s),h=Hu.transformTypes[a];typeof h<"u"&&this.transforms.push(new h(this.document,o,n))}})}static fromElement(t,e){var n=e.getStyle("transform",!1,!0),[i,s=i]=e.getStyle("transform-origin",!1,!0).split(),a=[i,s];return n.hasValue()?new Hu(t,n.getString(),a):null}apply(t){for(var{transforms:e}=this,n=e.length,i=0;i<n;i++)e[i].apply(t)}unapply(t){for(var{transforms:e}=this,n=e.length,i=n-1;i>=0;i--)e[i].unapply(t)}applyToPoint(t){for(var{transforms:e}=this,n=e.length,i=0;i<n;i++)e[i].applyToPoint(t)}}Hu.transformTypes={translate:$D,rotate:WD,scale:XD,matrix:dC,skewX:JD,skewY:YD};class yi{constructor(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(this.document=t,this.node=e,this.captureTextNodes=n,this.attributes={},this.styles={},this.stylesSpecificity={},this.animationFrozen=!1,this.animationFrozenValue="",this.parent=null,this.children=[],!(!e||e.nodeType!==1)){if(Array.from(e.attributes).forEach(o=>{var h=zD(o.nodeName);this.attributes[h]=new Dr(t,h,o.value)}),this.addStylesFromStyleDefinition(),this.getAttribute("style").hasValue()){var i=this.getAttribute("style").getString().split(";").map(o=>o.trim());i.forEach(o=>{if(o){var[h,f]=o.split(":").map(g=>g.trim());this.styles[h]=new Dr(t,h,f)}})}var{definitions:s}=t,a=this.getAttribute("id");a.hasValue()&&(s[a.getString()]||(s[a.getString()]=this)),Array.from(e.childNodes).forEach(o=>{if(o.nodeType===1)this.addChild(o);else if(n&&(o.nodeType===3||o.nodeType===4)){var h=t.createTextNode(o);h.getText().length>0&&this.addChild(h)}})}}getAttribute(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,n=this.attributes[t];if(!n&&e){var i=new Dr(this.document,t,"");return this.attributes[t]=i,i}return n||Dr.empty(this.document)}getHrefAttribute(){for(var t in this.attributes)if(t==="href"||t.endsWith(":href"))return this.attributes[t];return Dr.empty(this.document)}getStyle(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=this.styles[t];if(i)return i;var s=this.getAttribute(t);if(s!=null&&s.hasValue())return this.styles[t]=s,s;if(!n){var{parent:a}=this;if(a){var o=a.getStyle(t);if(o!=null&&o.hasValue())return o}}if(e){var h=new Dr(this.document,t,"");return this.styles[t]=h,h}return i||Dr.empty(this.document)}render(t){if(!(this.getStyle("display").getString()==="none"||this.getStyle("visibility").getString()==="hidden")){if(t.save(),this.getStyle("mask").hasValue()){var e=this.getStyle("mask").getDefinition();e&&(this.applyEffects(t),e.apply(t,this))}else if(this.getStyle("filter").getValue("none")!=="none"){var n=this.getStyle("filter").getDefinition();n&&(this.applyEffects(t),n.apply(t,this))}else this.setContext(t),this.renderChildren(t),this.clearContext(t);t.restore()}}setContext(t){}applyEffects(t){var e=Hu.fromElement(this.document,this);e&&e.apply(t);var n=this.getStyle("clip-path",!1,!0);if(n.hasValue()){var i=n.getDefinition();i&&i.apply(t)}}clearContext(t){}renderChildren(t){this.children.forEach(e=>{e.render(t)})}addChild(t){var e=t instanceof yi?t:this.document.createElement(t);e.parent=this,yi.ignoreChildTypes.includes(e.type)||this.children.push(e)}matchesSelector(t){var e,{node:n}=this;if(typeof n.matches=="function")return n.matches(t);var i=(e=n.getAttribute)===null||e===void 0?void 0:e.call(n,"class");return!i||i===""?!1:i.split(" ").some(s=>".".concat(s)===t)}addStylesFromStyleDefinition(){var{styles:t,stylesSpecificity:e}=this.document;for(var n in t)if(!n.startsWith("@")&&this.matchesSelector(n)){var i=t[n],s=e[n];if(i)for(var a in i){var o=this.stylesSpecificity[a];typeof o>"u"&&(o="000"),s>=o&&(this.styles[a]=i[a],this.stylesSpecificity[a]=s)}}}removeStyles(t,e){var n=e.reduce((i,s)=>{var a=t.getStyle(s);if(!a.hasValue())return i;var o=a.getString();return a.setValue(""),[...i,[s,o]]},[]);return n}restoreStyles(t,e){e.forEach(n=>{var[i,s]=n;t.getStyle(i,!0).setValue(s)})}isFirstChild(){var t;return((t=this.parent)===null||t===void 0?void 0:t.children.indexOf(this))===0}}yi.ignoreChildTypes=["title"];class ZD extends yi{constructor(t,e,n){super(t,e,n)}}function Xyt(r){var t=r.trim();return/^('|")/.test(t)?t:'"'.concat(t,'"')}function Jyt(r){return typeof process>"u"?r:r.trim().split(",").map(Xyt).join(",")}function Yyt(r){if(!r)return"";var t=r.trim().toLowerCase();switch(t){case"normal":case"italic":case"oblique":case"inherit":case"initial":case"unset":return t;default:return/^oblique\s+(-|)\d+deg$/.test(t)?t:""}}function Zyt(r){if(!r)return"";var t=r.trim().toLowerCase();switch(t){case"normal":case"bold":case"lighter":case"bolder":case"inherit":case"initial":case"unset":return t;default:return/^[\d.]+$/.test(t)?t:""}}class xo{constructor(t,e,n,i,s,a){var o=a?typeof a=="string"?xo.parse(a):a:{};this.fontFamily=s||o.fontFamily,this.fontSize=i||o.fontSize,this.fontStyle=t||o.fontStyle,this.fontWeight=n||o.fontWeight,this.fontVariant=e||o.fontVariant}static parse(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",e=arguments.length>1?arguments[1]:void 0,n="",i="",s="",a="",o="",h=jh(t).trim().split(" "),f={fontSize:!1,fontStyle:!1,fontWeight:!1,fontVariant:!1};return h.forEach(g=>{switch(!0){case(!f.fontStyle&&xo.styles.includes(g)):g!=="inherit"&&(n=g),f.fontStyle=!0;break;case(!f.fontVariant&&xo.variants.includes(g)):g!=="inherit"&&(i=g),f.fontStyle=!0,f.fontVariant=!0;break;case(!f.fontWeight&&xo.weights.includes(g)):g!=="inherit"&&(s=g),f.fontStyle=!0,f.fontVariant=!0,f.fontWeight=!0;break;case!f.fontSize:g!=="inherit"&&([a]=g.split("/")),f.fontStyle=!0,f.fontVariant=!0,f.fontWeight=!0,f.fontSize=!0;break;default:g!=="inherit"&&(o+=g)}}),new xo(n,i,s,a,o,e)}toString(){return[Yyt(this.fontStyle),this.fontVariant,Zyt(this.fontWeight),this.fontSize,Jyt(this.fontFamily)].join(" ").trim()}}xo.styles="normal|italic|oblique|inherit",xo.variants="normal|small-caps|inherit",xo.weights="normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit";class uc{constructor(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Number.NaN,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Number.NaN,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Number.NaN,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:Number.NaN;this.x1=t,this.y1=e,this.x2=n,this.y2=i,this.addPoint(t,e),this.addPoint(n,i)}get x(){return this.x1}get y(){return this.y1}get width(){return this.x2-this.x1}get height(){return this.y2-this.y1}addPoint(t,e){typeof t<"u"&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=t,this.x2=t),t<this.x1&&(this.x1=t),t>this.x2&&(this.x2=t)),typeof e<"u"&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=e,this.y2=e),e<this.y1&&(this.y1=e),e>this.y2&&(this.y2=e))}addX(t){this.addPoint(t,null)}addY(t){this.addPoint(null,t)}addBoundingBox(t){if(t){var{x1:e,y1:n,x2:i,y2:s}=t;this.addPoint(e,n),this.addPoint(i,s)}}sumCubic(t,e,n,i,s){return Math.pow(1-t,3)*e+3*Math.pow(1-t,2)*t*n+3*(1-t)*Math.pow(t,2)*i+Math.pow(t,3)*s}bezierCurveAdd(t,e,n,i,s){var a=6*e-12*n+6*i,o=-3*e+9*n-9*i+3*s,h=3*n-3*e;if(o===0){if(a===0)return;var f=-h/a;0<f&&f<1&&(t?this.addX(this.sumCubic(f,e,n,i,s)):this.addY(this.sumCubic(f,e,n,i,s)));return}var g=Math.pow(a,2)-4*h*o;if(!(g<0)){var b=(-a+Math.sqrt(g))/(2*o);0<b&&b<1&&(t?this.addX(this.sumCubic(b,e,n,i,s)):this.addY(this.sumCubic(b,e,n,i,s)));var C=(-a-Math.sqrt(g))/(2*o);0<C&&C<1&&(t?this.addX(this.sumCubic(C,e,n,i,s)):this.addY(this.sumCubic(C,e,n,i,s)))}}addBezierCurve(t,e,n,i,s,a,o,h){this.addPoint(t,e),this.addPoint(o,h),this.bezierCurveAdd(!0,t,n,s,o),this.bezierCurveAdd(!1,e,i,a,h)}addQuadraticCurve(t,e,n,i,s,a){var o=t+.6666666666666666*(n-t),h=e+2/3*(i-e),f=o+1/3*(s-t),g=h+1/3*(a-e);this.addBezierCurve(t,e,o,f,h,g,s,a)}isPointInBox(t,e){var{x1:n,y1:i,x2:s,y2:a}=this;return n<=t&&t<=s&&i<=e&&e<=a}}class ln extends Ne{constructor(t){super(t.replace(/([+\-.])\s+/gm,"$1").replace(/[^MmZzLlHhVvCcSsQqTtAae\d\s.,+-].*/g,"")),this.control=null,this.start=null,this.current=null,this.command=null,this.commands=this.commands,this.i=-1,this.previousCommand=null,this.points=[],this.angles=[]}reset(){this.i=-1,this.command=null,this.previousCommand=null,this.start=new Hi(0,0),this.control=new Hi(0,0),this.current=new Hi(0,0),this.points=[],this.angles=[]}isEnd(){var{i:t,commands:e}=this;return t>=e.length-1}next(){var t=this.commands[++this.i];return this.previousCommand=this.command,this.command=t,t}getPoint(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"x",e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"y",n=new Hi(this.command[t],this.command[e]);return this.makeAbsolute(n)}getAsControlPoint(t,e){var n=this.getPoint(t,e);return this.control=n,n}getAsCurrentPoint(t,e){var n=this.getPoint(t,e);return this.current=n,n}getReflectedControlPoint(){var t=this.previousCommand.type;if(t!==Ne.CURVE_TO&&t!==Ne.SMOOTH_CURVE_TO&&t!==Ne.QUAD_TO&&t!==Ne.SMOOTH_QUAD_TO)return this.current;var{current:{x:e,y:n},control:{x:i,y:s}}=this,a=new Hi(2*e-i,2*n-s);return a}makeAbsolute(t){if(this.command.relative){var{x:e,y:n}=this.current;t.x+=e,t.y+=n}return t}addMarker(t,e,n){var{points:i,angles:s}=this;n&&s.length>0&&!s[s.length-1]&&(s[s.length-1]=i[i.length-1].angleTo(n)),this.addMarkerAngle(t,e?e.angleTo(t):null)}addMarkerAngle(t,e){this.points.push(t),this.angles.push(e)}getMarkerPoints(){return this.points}getMarkerAngles(){for(var{angles:t}=this,e=t.length,n=0;n<e;n++)if(!t[n]){for(var i=n+1;i<e;i++)if(t[i]){t[n]=t[i];break}}return t}}class Gu extends yi{constructor(){super(...arguments),this.modifiedEmSizeStack=!1}calculateOpacity(){for(var t=1,e=this;e;){var n=e.getStyle("opacity",!1,!0);n.hasValue(!0)&&(t*=n.getNumber()),e=e.parent}return t}setContext(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!e){var n=this.getStyle("fill"),i=this.getStyle("fill-opacity"),s=this.getStyle("stroke"),a=this.getStyle("stroke-opacity");if(n.isUrlDefinition()){var o=n.getFillStyleDefinition(this,i);o&&(t.fillStyle=o)}else if(n.hasValue()){n.getString()==="currentColor"&&n.setValue(this.getStyle("color").getColor());var h=n.getColor();h!=="inherit"&&(t.fillStyle=h==="none"?"rgba(0,0,0,0)":h)}if(i.hasValue()){var f=new Dr(this.document,"fill",t.fillStyle).addOpacity(i).getColor();t.fillStyle=f}if(s.isUrlDefinition()){var g=s.getFillStyleDefinition(this,a);g&&(t.strokeStyle=g)}else if(s.hasValue()){s.getString()==="currentColor"&&s.setValue(this.getStyle("color").getColor());var b=s.getString();b!=="inherit"&&(t.strokeStyle=b==="none"?"rgba(0,0,0,0)":b)}if(a.hasValue()){var C=new Dr(this.document,"stroke",t.strokeStyle).addOpacity(a).getString();t.strokeStyle=C}var B=this.getStyle("stroke-width");if(B.hasValue()){var R=B.getPixels();t.lineWidth=R||Kh}var D=this.getStyle("stroke-linecap"),Q=this.getStyle("stroke-linejoin"),k=this.getStyle("stroke-miterlimit"),j=this.getStyle("stroke-dasharray"),et=this.getStyle("stroke-dashoffset");if(D.hasValue()&&(t.lineCap=D.getString()),Q.hasValue()&&(t.lineJoin=Q.getString()),k.hasValue()&&(t.miterLimit=k.getNumber()),j.hasValue()&&j.getString()!=="none"){var st=da(j.getString());typeof t.setLineDash<"u"?t.setLineDash(st):typeof t.webkitLineDash<"u"?t.webkitLineDash=st:typeof t.mozDash<"u"&&!(st.length===1&&st[0]===0)&&(t.mozDash=st);var mt=et.getPixels();typeof t.lineDashOffset<"u"?t.lineDashOffset=mt:typeof t.webkitLineDashOffset<"u"?t.webkitLineDashOffset=mt:typeof t.mozDashOffset<"u"&&(t.mozDashOffset=mt)}}if(this.modifiedEmSizeStack=!1,typeof t.font<"u"){var pt=this.getStyle("font"),yt=this.getStyle("font-style"),ft=this.getStyle("font-variant"),Dt=this.getStyle("font-weight"),It=this.getStyle("font-size"),ut=this.getStyle("font-family"),At=new xo(yt.getString(),ft.getString(),Dt.getString(),It.hasValue()?"".concat(It.getPixels(!0),"px"):"",ut.getString(),xo.parse(pt.getString(),t.font));yt.setValue(At.fontStyle),ft.setValue(At.fontVariant),Dt.setValue(At.fontWeight),It.setValue(At.fontSize),ut.setValue(At.fontFamily),t.font=At.toString(),It.isPixels()&&(this.document.emSize=It.getPixels(),this.modifiedEmSizeStack=!0)}e||(this.applyEffects(t),t.globalAlpha=this.calculateOpacity())}clearContext(t){super.clearContext(t),this.modifiedEmSizeStack&&this.document.popEmSize()}}class Xn extends Gu{constructor(t,e,n){super(t,e,n),this.type="path",this.pathParser=null,this.pathParser=new ln(this.getAttribute("d").getString())}path(t){var{pathParser:e}=this,n=new uc;for(e.reset(),t&&t.beginPath();!e.isEnd();)switch(e.next().type){case ln.MOVE_TO:this.pathM(t,n);break;case ln.LINE_TO:this.pathL(t,n);break;case ln.HORIZ_LINE_TO:this.pathH(t,n);break;case ln.VERT_LINE_TO:this.pathV(t,n);break;case ln.CURVE_TO:this.pathC(t,n);break;case ln.SMOOTH_CURVE_TO:this.pathS(t,n);break;case ln.QUAD_TO:this.pathQ(t,n);break;case ln.SMOOTH_QUAD_TO:this.pathT(t,n);break;case ln.ARC:this.pathA(t,n);break;case ln.CLOSE_PATH:this.pathZ(t,n);break}return n}getBoundingBox(t){return this.path()}getMarkers(){var{pathParser:t}=this,e=t.getMarkerPoints(),n=t.getMarkerAngles(),i=e.map((s,a)=>[s,n[a]]);return i}renderChildren(t){this.path(t),this.document.screen.mouse.checkPath(this,t);var e=this.getStyle("fill-rule");t.fillStyle!==""&&(e.getString("inherit")!=="inherit"?t.fill(e.getString()):t.fill()),t.strokeStyle!==""&&(this.getAttribute("vector-effect").getString()==="non-scaling-stroke"?(t.save(),t.setTransform(1,0,0,1,0,0),t.stroke(),t.restore()):t.stroke());var n=this.getMarkers();if(n){var i=n.length-1,s=this.getStyle("marker-start"),a=this.getStyle("marker-mid"),o=this.getStyle("marker-end");if(s.isUrlDefinition()){var h=s.getDefinition(),[f,g]=n[0];h.render(t,f,g)}if(a.isUrlDefinition())for(var b=a.getDefinition(),C=1;C<i;C++){var[B,R]=n[C];b.render(t,B,R)}if(o.isUrlDefinition()){var D=o.getDefinition(),[Q,k]=n[i];D.render(t,Q,k)}}}static pathM(t){var e=t.getAsCurrentPoint();return t.start=t.current,{point:e}}pathM(t,e){var{pathParser:n}=this,{point:i}=Xn.pathM(n),{x:s,y:a}=i;n.addMarker(i),e.addPoint(s,a),t&&t.moveTo(s,a)}static pathL(t){var{current:e}=t,n=t.getAsCurrentPoint();return{current:e,point:n}}pathL(t,e){var{pathParser:n}=this,{current:i,point:s}=Xn.pathL(n),{x:a,y:o}=s;n.addMarker(s,i),e.addPoint(a,o),t&&t.lineTo(a,o)}static pathH(t){var{current:e,command:n}=t,i=new Hi((n.relative?e.x:0)+n.x,e.y);return t.current=i,{current:e,point:i}}pathH(t,e){var{pathParser:n}=this,{current:i,point:s}=Xn.pathH(n),{x:a,y:o}=s;n.addMarker(s,i),e.addPoint(a,o),t&&t.lineTo(a,o)}static pathV(t){var{current:e,command:n}=t,i=new Hi(e.x,(n.relative?e.y:0)+n.y);return t.current=i,{current:e,point:i}}pathV(t,e){var{pathParser:n}=this,{current:i,point:s}=Xn.pathV(n),{x:a,y:o}=s;n.addMarker(s,i),e.addPoint(a,o),t&&t.lineTo(a,o)}static pathC(t){var{current:e}=t,n=t.getPoint("x1","y1"),i=t.getAsControlPoint("x2","y2"),s=t.getAsCurrentPoint();return{current:e,point:n,controlPoint:i,currentPoint:s}}pathC(t,e){var{pathParser:n}=this,{current:i,point:s,controlPoint:a,currentPoint:o}=Xn.pathC(n);n.addMarker(o,a,s),e.addBezierCurve(i.x,i.y,s.x,s.y,a.x,a.y,o.x,o.y),t&&t.bezierCurveTo(s.x,s.y,a.x,a.y,o.x,o.y)}static pathS(t){var{current:e}=t,n=t.getReflectedControlPoint(),i=t.getAsControlPoint("x2","y2"),s=t.getAsCurrentPoint();return{current:e,point:n,controlPoint:i,currentPoint:s}}pathS(t,e){var{pathParser:n}=this,{current:i,point:s,controlPoint:a,currentPoint:o}=Xn.pathS(n);n.addMarker(o,a,s),e.addBezierCurve(i.x,i.y,s.x,s.y,a.x,a.y,o.x,o.y),t&&t.bezierCurveTo(s.x,s.y,a.x,a.y,o.x,o.y)}static pathQ(t){var{current:e}=t,n=t.getAsControlPoint("x1","y1"),i=t.getAsCurrentPoint();return{current:e,controlPoint:n,currentPoint:i}}pathQ(t,e){var{pathParser:n}=this,{current:i,controlPoint:s,currentPoint:a}=Xn.pathQ(n);n.addMarker(a,s,s),e.addQuadraticCurve(i.x,i.y,s.x,s.y,a.x,a.y),t&&t.quadraticCurveTo(s.x,s.y,a.x,a.y)}static pathT(t){var{current:e}=t,n=t.getReflectedControlPoint();t.control=n;var i=t.getAsCurrentPoint();return{current:e,controlPoint:n,currentPoint:i}}pathT(t,e){var{pathParser:n}=this,{current:i,controlPoint:s,currentPoint:a}=Xn.pathT(n);n.addMarker(a,s,s),e.addQuadraticCurve(i.x,i.y,s.x,s.y,a.x,a.y),t&&t.quadraticCurveTo(s.x,s.y,a.x,a.y)}static pathA(t){var{current:e,command:n}=t,{rX:i,rY:s,xRot:a,lArcFlag:o,sweepFlag:h}=n,f=a*(Math.PI/180),g=t.getAsCurrentPoint(),b=new Hi(Math.cos(f)*(e.x-g.x)/2+Math.sin(f)*(e.y-g.y)/2,-Math.sin(f)*(e.x-g.x)/2+Math.cos(f)*(e.y-g.y)/2),C=Math.pow(b.x,2)/Math.pow(i,2)+Math.pow(b.y,2)/Math.pow(s,2);C>1&&(i*=Math.sqrt(C),s*=Math.sqrt(C));var B=(o===h?-1:1)*Math.sqrt((Math.pow(i,2)*Math.pow(s,2)-Math.pow(i,2)*Math.pow(b.y,2)-Math.pow(s,2)*Math.pow(b.x,2))/(Math.pow(i,2)*Math.pow(b.y,2)+Math.pow(s,2)*Math.pow(b.x,2)));isNaN(B)&&(B=0);var R=new Hi(B*i*b.y/s,B*-s*b.x/i),D=new Hi((e.x+g.x)/2+Math.cos(f)*R.x-Math.sin(f)*R.y,(e.y+g.y)/2+Math.sin(f)*R.x+Math.cos(f)*R.y),Q=sC([1,0],[(b.x-R.x)/i,(b.y-R.y)/s]),k=[(b.x-R.x)/i,(b.y-R.y)/s],j=[(-b.x-R.x)/i,(-b.y-R.y)/s],et=sC(k,j);return V1(k,j)<=-1&&(et=Math.PI),V1(k,j)>=1&&(et=0),{currentPoint:g,rX:i,rY:s,sweepFlag:h,xAxisRotation:f,centp:D,a1:Q,ad:et}}pathA(t,e){var{pathParser:n}=this,{currentPoint:i,rX:s,rY:a,sweepFlag:o,xAxisRotation:h,centp:f,a1:g,ad:b}=Xn.pathA(n),C=1-o?1:-1,B=g+C*(b/2),R=new Hi(f.x+s*Math.cos(B),f.y+a*Math.sin(B));if(n.addMarkerAngle(R,B-C*Math.PI/2),n.addMarkerAngle(i,B-C*Math.PI),e.addPoint(i.x,i.y),t&&!isNaN(g)&&!isNaN(b)){var D=s>a?s:a,Q=s>a?1:s/a,k=s>a?a/s:1;t.translate(f.x,f.y),t.rotate(h),t.scale(Q,k),t.arc(0,0,D,g,g+b,!!(1-o)),t.scale(1/Q,1/k),t.rotate(-h),t.translate(-f.x,-f.y)}}static pathZ(t){t.current=t.start}pathZ(t,e){Xn.pathZ(this.pathParser),t&&e.x1!==e.x2&&e.y1!==e.y2&&t.closePath()}}class pC extends Xn{constructor(t,e,n){super(t,e,n),this.type="glyph",this.horizAdvX=this.getAttribute("horiz-adv-x").getNumber(),this.unicode=this.getAttribute("unicode").getString(),this.arabicForm=this.getAttribute("arabic-form").getString()}}class kA extends Gu{constructor(t,e,n){super(t,e,new.target===kA?!0:n),this.type="text",this.x=0,this.y=0,this.measureCache=-1}setContext(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;super.setContext(t,e);var n=this.getStyle("dominant-baseline").getTextBaseline()||this.getStyle("alignment-baseline").getTextBaseline();n&&(t.textBaseline=n)}initializeCoordinates(){this.x=0,this.y=0,this.leafTexts=[],this.textChunkStart=0,this.minX=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY}getBoundingBox(t){if(this.type!=="text")return this.getTElementBoundingBox(t);this.initializeCoordinates(),this.adjustChildCoordinatesRecursive(t);var e=null;return this.children.forEach((n,i)=>{var s=this.getChildBoundingBox(t,this,this,i);e?e.addBoundingBox(s):e=s}),e}getFontSize(){var{document:t,parent:e}=this,n=xo.parse(t.ctx.font).fontSize,i=e.getStyle("font-size").getNumber(n);return i}getTElementBoundingBox(t){var e=this.getFontSize();return new uc(this.x,this.y-e,this.x+this.measureText(t),this.y)}getGlyph(t,e,n){var i=e[n],s=null;if(t.isArabic){var a=e.length,o=e[n-1],h=e[n+1],f="isolated";if((n===0||o===" ")&&n<a-1&&h!==" "&&(f="terminal"),n>0&&o!==" "&&n<a-1&&h!==" "&&(f="medial"),n>0&&o!==" "&&(n===a-1||h===" ")&&(f="initial"),typeof t.glyphs[i]<"u"){var g=t.glyphs[i];s=g instanceof pC?g:g[f]}}else s=t.glyphs[i];return s||(s=t.missingGlyph),s}getText(){return""}getTextFromNode(t){var e=t||this.node,n=Array.from(e.parentNode.childNodes),i=n.indexOf(e),s=n.length-1,a=jh(e.textContent||"");return i===0&&(a=kD(a)),i===s&&(a=QD(a)),a}renderChildren(t){if(this.type!=="text"){this.renderTElementChildren(t);return}this.initializeCoordinates(),this.adjustChildCoordinatesRecursive(t),this.children.forEach((n,i)=>{this.renderChild(t,this,this,i)});var{mouse:e}=this.document.screen;e.isWorking()&&e.checkBoundingBox(this,this.getBoundingBox(t))}renderTElementChildren(t){var{document:e,parent:n}=this,i=this.getText(),s=n.getStyle("font-family").getDefinition();if(s){for(var{unitsPerEm:a}=s.fontFace,o=xo.parse(e.ctx.font),h=n.getStyle("font-size").getNumber(o.fontSize),f=n.getStyle("font-style").getString(o.fontStyle),g=h/a,b=s.isRTL?i.split("").reverse().join(""):i,C=da(n.getAttribute("dx").getString()),B=b.length,R=0;R<B;R++){var D=this.getGlyph(s,b,R);t.translate(this.x,this.y),t.scale(g,-g);var Q=t.lineWidth;t.lineWidth=t.lineWidth*a/h,f==="italic"&&t.transform(1,0,.4,1,0,0),D.render(t),f==="italic"&&t.transform(1,0,-.4,1,0,0),t.lineWidth=Q,t.scale(1/g,-1/g),t.translate(-this.x,-this.y),this.x+=h*(D.horizAdvX||s.horizAdvX)/a,typeof C[R]<"u"&&!isNaN(C[R])&&(this.x+=C[R])}return}var{x:k,y:j}=this;t.fillStyle&&t.fillText(i,k,j),t.strokeStyle&&t.strokeText(i,k,j)}applyAnchoring(){if(!(this.textChunkStart>=this.leafTexts.length)){var t=this.leafTexts[this.textChunkStart],e=t.getStyle("text-anchor").getString("start"),n=!1,i=0;e==="start"&&!n||e==="end"&&n?i=t.x-this.minX:e==="end"&&!n||e==="start"&&n?i=t.x-this.maxX:i=t.x-(this.minX+this.maxX)/2;for(var s=this.textChunkStart;s<this.leafTexts.length;s++)this.leafTexts[s].x+=i;this.minX=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.textChunkStart=this.leafTexts.length}}adjustChildCoordinatesRecursive(t){this.children.forEach((e,n)=>{this.adjustChildCoordinatesRecursiveCore(t,this,this,n)}),this.applyAnchoring()}adjustChildCoordinatesRecursiveCore(t,e,n,i){var s=n.children[i];s.children.length>0?s.children.forEach((a,o)=>{e.adjustChildCoordinatesRecursiveCore(t,e,s,o)}):this.adjustChildCoordinates(t,e,n,i)}adjustChildCoordinates(t,e,n,i){var s=n.children[i];if(typeof s.measureText!="function")return s;t.save(),s.setContext(t,!0);var a=s.getAttribute("x"),o=s.getAttribute("y"),h=s.getAttribute("dx"),f=s.getAttribute("dy"),g=s.getStyle("font-family").getDefinition(),b=!!g&&g.isRTL;i===0&&(a.hasValue()||a.setValue(s.getInheritedAttribute("x")),o.hasValue()||o.setValue(s.getInheritedAttribute("y")),h.hasValue()||h.setValue(s.getInheritedAttribute("dx")),f.hasValue()||f.setValue(s.getInheritedAttribute("dy")));var C=s.measureText(t);return b&&(e.x-=C),a.hasValue()?(e.applyAnchoring(),s.x=a.getPixels("x"),h.hasValue()&&(s.x+=h.getPixels("x"))):(h.hasValue()&&(e.x+=h.getPixels("x")),s.x=e.x),e.x=s.x,b||(e.x+=C),o.hasValue()?(s.y=o.getPixels("y"),f.hasValue()&&(s.y+=f.getPixels("y"))):(f.hasValue()&&(e.y+=f.getPixels("y")),s.y=e.y),e.y=s.y,e.leafTexts.push(s),e.minX=Math.min(e.minX,s.x,s.x+C),e.maxX=Math.max(e.maxX,s.x,s.x+C),s.clearContext(t),t.restore(),s}getChildBoundingBox(t,e,n,i){var s=n.children[i];if(typeof s.getBoundingBox!="function")return null;var a=s.getBoundingBox(t);return a?(s.children.forEach((o,h)=>{var f=e.getChildBoundingBox(t,e,s,h);a.addBoundingBox(f)}),a):null}renderChild(t,e,n,i){var s=n.children[i];s.render(t),s.children.forEach((a,o)=>{e.renderChild(t,e,s,o)})}measureText(t){var{measureCache:e}=this;if(~e)return e;var n=this.getText(),i=this.measureTargetText(t,n);return this.measureCache=i,i}measureTargetText(t,e){if(!e.length)return 0;var{parent:n}=this,i=n.getStyle("font-family").getDefinition();if(i){for(var s=this.getFontSize(),a=i.isRTL?e.split("").reverse().join(""):e,o=da(n.getAttribute("dx").getString()),h=a.length,f=0,g=0;g<h;g++){var b=this.getGlyph(i,a,g);f+=(b.horizAdvX||i.horizAdvX)*s/i.fontFace.unitsPerEm,typeof o[g]<"u"&&!isNaN(o[g])&&(f+=o[g])}return f}if(!t.measureText)return e.length*10;t.save(),this.setContext(t,!0);var{width:C}=t.measureText(e);return this.clearContext(t),t.restore(),C}getInheritedAttribute(t){for(var e=this;e instanceof kA&&e.isFirstChild();){var n=e.parent.getAttribute(t);if(n.hasValue(!0))return n.getValue("0");e=e.parent}return null}}class Jg extends kA{constructor(t,e,n){super(t,e,new.target===Jg?!0:n),this.type="tspan",this.text=this.children.length>0?"":this.getTextFromNode()}getText(){return this.text}}class t1t extends Jg{constructor(){super(...arguments),this.type="textNode"}}class Hf extends Gu{constructor(){super(...arguments),this.type="svg",this.root=!1}setContext(t){var e,{document:n}=this,{screen:i,window:s}=n,a=t.canvas;if(i.setDefaults(t),a.style&&typeof t.font<"u"&&s&&typeof s.getComputedStyle<"u"){t.font=s.getComputedStyle(a).getPropertyValue("font");var o=new Dr(n,"fontSize",xo.parse(t.font).fontSize);o.hasValue()&&(n.rootEmSize=o.getPixels("y"),n.emSize=n.rootEmSize)}this.getAttribute("x").hasValue()||this.getAttribute("x",!0).setValue(0),this.getAttribute("y").hasValue()||this.getAttribute("y",!0).setValue(0);var{width:h,height:f}=i.viewPort;this.getStyle("width").hasValue()||this.getStyle("width",!0).setValue("100%"),this.getStyle("height").hasValue()||this.getStyle("height",!0).setValue("100%"),this.getStyle("color").hasValue()||this.getStyle("color",!0).setValue("black");var g=this.getAttribute("refX"),b=this.getAttribute("refY"),C=this.getAttribute("viewBox"),B=C.hasValue()?da(C.getString()):null,R=!this.root&&this.getStyle("overflow").getValue("hidden")!=="visible",D=0,Q=0,k=0,j=0;B&&(D=B[0],Q=B[1]),this.root||(h=this.getStyle("width").getPixels("x"),f=this.getStyle("height").getPixels("y"),this.type==="marker"&&(k=D,j=Q,D=0,Q=0)),i.viewPort.setCurrent(h,f),this.node&&(!this.parent||((e=this.node.parentNode)===null||e===void 0?void 0:e.nodeName)==="foreignObject")&&this.getStyle("transform",!1,!0).hasValue()&&!this.getStyle("transform-origin",!1,!0).hasValue()&&this.getStyle("transform-origin",!0,!0).setValue("50% 50%"),super.setContext(t),t.translate(this.getAttribute("x").getPixels("x"),this.getAttribute("y").getPixels("y")),B&&(h=B[2],f=B[3]),n.setViewBox({ctx:t,aspectRatio:this.getAttribute("preserveAspectRatio").getString(),width:i.viewPort.width,desiredWidth:h,height:i.viewPort.height,desiredHeight:f,minX:D,minY:Q,refX:g.getValue(),refY:b.getValue(),clip:R,clipX:k,clipY:j}),B&&(i.viewPort.removeCurrent(),i.viewPort.setCurrent(h,f))}clearContext(t){super.clearContext(t),this.document.screen.viewPort.removeCurrent()}resize(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=this.getAttribute("width",!0),s=this.getAttribute("height",!0),a=this.getAttribute("viewBox"),o=this.getAttribute("style"),h=i.getNumber(0),f=s.getNumber(0);if(n)if(typeof n=="string")this.getAttribute("preserveAspectRatio",!0).setValue(n);else{var g=this.getAttribute("preserveAspectRatio");g.hasValue()&&g.setValue(g.getString().replace(/^\s*(\S.*\S)\s*$/,"$1"))}if(i.setValue(t),s.setValue(e),a.hasValue()||a.setValue("0 0 ".concat(h||t," ").concat(f||e)),o.hasValue()){var b=this.getStyle("width"),C=this.getStyle("height");b.hasValue()&&b.setValue("".concat(t,"px")),C.hasValue()&&C.setValue("".concat(e,"px"))}}}class gC extends Xn{constructor(){super(...arguments),this.type="rect"}path(t){var e=this.getAttribute("x").getPixels("x"),n=this.getAttribute("y").getPixels("y"),i=this.getStyle("width",!1,!0).getPixels("x"),s=this.getStyle("height",!1,!0).getPixels("y"),a=this.getAttribute("rx"),o=this.getAttribute("ry"),h=a.getPixels("x"),f=o.getPixels("y");if(a.hasValue()&&!o.hasValue()&&(f=h),o.hasValue()&&!a.hasValue()&&(h=f),h=Math.min(h,i/2),f=Math.min(f,s/2),t){var g=4*((Math.sqrt(2)-1)/3);t.beginPath(),s>0&&i>0&&(t.moveTo(e+h,n),t.lineTo(e+i-h,n),t.bezierCurveTo(e+i-h+g*h,n,e+i,n+f-g*f,e+i,n+f),t.lineTo(e+i,n+s-f),t.bezierCurveTo(e+i,n+s-f+g*f,e+i-h+g*h,n+s,e+i-h,n+s),t.lineTo(e+h,n+s),t.bezierCurveTo(e+h-g*h,n+s,e,n+s-f+g*f,e,n+s-f),t.lineTo(e,n+f),t.bezierCurveTo(e,n+f-g*f,e+h-g*h,n,e+h,n),t.closePath())}return new uc(e,n,e+i,n+s)}getMarkers(){return null}}class tO extends Xn{constructor(){super(...arguments),this.type="circle"}path(t){var e=this.getAttribute("cx").getPixels("x"),n=this.getAttribute("cy").getPixels("y"),i=this.getAttribute("r").getPixels();return t&&i>0&&(t.beginPath(),t.arc(e,n,i,0,Math.PI*2,!1),t.closePath()),new uc(e-i,n-i,e+i,n+i)}getMarkers(){return null}}class eO extends Xn{constructor(){super(...arguments),this.type="ellipse"}path(t){var e=4*((Math.sqrt(2)-1)/3),n=this.getAttribute("rx").getPixels("x"),i=this.getAttribute("ry").getPixels("y"),s=this.getAttribute("cx").getPixels("x"),a=this.getAttribute("cy").getPixels("y");return t&&n>0&&i>0&&(t.beginPath(),t.moveTo(s+n,a),t.bezierCurveTo(s+n,a+e*i,s+e*n,a+i,s,a+i),t.bezierCurveTo(s-e*n,a+i,s-n,a+e*i,s-n,a),t.bezierCurveTo(s-n,a-e*i,s-e*n,a-i,s,a-i),t.bezierCurveTo(s+e*n,a-i,s+n,a-e*i,s+n,a),t.closePath()),new uc(s-n,a-i,s+n,a+i)}getMarkers(){return null}}class rO extends Xn{constructor(){super(...arguments),this.type="line"}getPoints(){return[new Hi(this.getAttribute("x1").getPixels("x"),this.getAttribute("y1").getPixels("y")),new Hi(this.getAttribute("x2").getPixels("x"),this.getAttribute("y2").getPixels("y"))]}path(t){var[{x:e,y:n},{x:i,y:s}]=this.getPoints();return t&&(t.beginPath(),t.moveTo(e,n),t.lineTo(i,s)),new uc(e,n,i,s)}getMarkers(){var[t,e]=this.getPoints(),n=t.angleTo(e);return[[t,n],[e,n]]}}class mC extends Xn{constructor(t,e,n){super(t,e,n),this.type="polyline",this.points=[],this.points=Hi.parsePath(this.getAttribute("points").getString())}path(t){var{points:e}=this,[{x:n,y:i}]=e,s=new uc(n,i);return t&&(t.beginPath(),t.moveTo(n,i)),e.forEach(a=>{var{x:o,y:h}=a;s.addPoint(o,h),t&&t.lineTo(o,h)}),s}getMarkers(){var{points:t}=this,e=t.length-1,n=[];return t.forEach((i,s)=>{s!==e&&n.push([i,i.angleTo(t[s+1])])}),n.length>0&&n.push([t[t.length-1],n[n.length-1][1]]),n}}class nO extends mC{constructor(){super(...arguments),this.type="polygon"}path(t){var e=super.path(t),[{x:n,y:i}]=this.points;return t&&(t.lineTo(n,i),t.closePath()),e}}class iO extends yi{constructor(){super(...arguments),this.type="pattern"}createPattern(t,e,n){var i=this.getStyle("width").getPixels("x",!0),s=this.getStyle("height").getPixels("y",!0),a=new Hf(this.document,null);a.attributes.viewBox=new Dr(this.document,"viewBox",this.getAttribute("viewBox").getValue()),a.attributes.width=new Dr(this.document,"width","".concat(i,"px")),a.attributes.height=new Dr(this.document,"height","".concat(s,"px")),a.attributes.transform=new Dr(this.document,"transform",this.getAttribute("patternTransform").getValue()),a.children=this.children;var o=this.document.createCanvas(i,s),h=o.getContext("2d"),f=this.getAttribute("x"),g=this.getAttribute("y");f.hasValue()&&g.hasValue()&&h.translate(f.getPixels("x",!0),g.getPixels("y",!0)),n.hasValue()?this.styles["fill-opacity"]=n:Reflect.deleteProperty(this.styles,"fill-opacity");for(var b=-1;b<=1;b++)for(var C=-1;C<=1;C++)h.save(),a.attributes.x=new Dr(this.document,"x",b*o.width),a.attributes.y=new Dr(this.document,"y",C*o.height),a.render(h),h.restore();var B=t.createPattern(o,"repeat");return B}}class sO extends yi{constructor(){super(...arguments),this.type="marker"}render(t,e,n){if(e){var{x:i,y:s}=e,a=this.getAttribute("orient").getString("auto"),o=this.getAttribute("markerUnits").getString("strokeWidth");t.translate(i,s),a==="auto"&&t.rotate(n),o==="strokeWidth"&&t.scale(t.lineWidth,t.lineWidth),t.save();var h=new Hf(this.document,null);h.type=this.type,h.attributes.viewBox=new Dr(this.document,"viewBox",this.getAttribute("viewBox").getValue()),h.attributes.refX=new Dr(this.document,"refX",this.getAttribute("refX").getValue()),h.attributes.refY=new Dr(this.document,"refY",this.getAttribute("refY").getValue()),h.attributes.width=new Dr(this.document,"width",this.getAttribute("markerWidth").getValue()),h.attributes.height=new Dr(this.document,"height",this.getAttribute("markerHeight").getValue()),h.attributes.overflow=new Dr(this.document,"overflow",this.getAttribute("overflow").getValue()),h.attributes.fill=new Dr(this.document,"fill",this.getAttribute("fill").getColor("black")),h.attributes.stroke=new Dr(this.document,"stroke",this.getAttribute("stroke").getValue("none")),h.children=this.children,h.render(t),t.restore(),o==="strokeWidth"&&t.scale(1/t.lineWidth,1/t.lineWidth),a==="auto"&&t.rotate(-n),t.translate(-i,-s)}}}class oO extends yi{constructor(){super(...arguments),this.type="defs"}render(){}}class q1 extends Gu{constructor(){super(...arguments),this.type="g"}getBoundingBox(t){var e=new uc;return this.children.forEach(n=>{e.addBoundingBox(n.getBoundingBox(t))}),e}}class yC extends yi{constructor(t,e,n){super(t,e,n),this.attributesToInherit=["gradientUnits"],this.stops=[];var{stops:i,children:s}=this;s.forEach(a=>{a.type==="stop"&&i.push(a)})}getGradientUnits(){return this.getAttribute("gradientUnits").getString("objectBoundingBox")}createGradient(t,e,n){var i=this;this.getHrefAttribute().hasValue()&&(i=this.getHrefAttribute().getDefinition(),this.inheritStopContainer(i));var{stops:s}=i,a=this.getGradient(t,e);if(!a)return this.addParentOpacity(n,s[s.length-1].color);if(s.forEach(Q=>{a.addColorStop(Q.offset,this.addParentOpacity(n,Q.color))}),this.getAttribute("gradientTransform").hasValue()){var{document:o}=this,{MAX_VIRTUAL_PIXELS:h,viewPort:f}=o.screen,[g]=f.viewPorts,b=new gC(o,null);b.attributes.x=new Dr(o,"x",-h/3),b.attributes.y=new Dr(o,"y",-h/3),b.attributes.width=new Dr(o,"width",h),b.attributes.height=new Dr(o,"height",h);var C=new q1(o,null);C.attributes.transform=new Dr(o,"transform",this.getAttribute("gradientTransform").getValue()),C.children=[b];var B=new Hf(o,null);B.attributes.x=new Dr(o,"x",0),B.attributes.y=new Dr(o,"y",0),B.attributes.width=new Dr(o,"width",g.width),B.attributes.height=new Dr(o,"height",g.height),B.children=[C];var R=o.createCanvas(g.width,g.height),D=R.getContext("2d");return D.fillStyle=a,B.render(D),D.createPattern(R,"no-repeat")}return a}inheritStopContainer(t){this.attributesToInherit.forEach(e=>{!this.getAttribute(e).hasValue()&&t.getAttribute(e).hasValue()&&this.getAttribute(e,!0).setValue(t.getAttribute(e).getValue())})}addParentOpacity(t,e){if(t.hasValue()){var n=new Dr(this.document,"color",e);return n.addOpacity(t).getColor()}return e}}class aO extends yC{constructor(t,e,n){super(t,e,n),this.type="linearGradient",this.attributesToInherit.push("x1","y1","x2","y2")}getGradient(t,e){var n=this.getGradientUnits()==="objectBoundingBox",i=n?e.getBoundingBox(t):null;if(n&&!i)return null;!this.getAttribute("x1").hasValue()&&!this.getAttribute("y1").hasValue()&&!this.getAttribute("x2").hasValue()&&!this.getAttribute("y2").hasValue()&&(this.getAttribute("x1",!0).setValue(0),this.getAttribute("y1",!0).setValue(0),this.getAttribute("x2",!0).setValue(1),this.getAttribute("y2",!0).setValue(0));var s=n?i.x+i.width*this.getAttribute("x1").getNumber():this.getAttribute("x1").getPixels("x"),a=n?i.y+i.height*this.getAttribute("y1").getNumber():this.getAttribute("y1").getPixels("y"),o=n?i.x+i.width*this.getAttribute("x2").getNumber():this.getAttribute("x2").getPixels("x"),h=n?i.y+i.height*this.getAttribute("y2").getNumber():this.getAttribute("y2").getPixels("y");return s===o&&a===h?null:t.createLinearGradient(s,a,o,h)}}class cO extends yC{constructor(t,e,n){super(t,e,n),this.type="radialGradient",this.attributesToInherit.push("cx","cy","r","fx","fy","fr")}getGradient(t,e){var n=this.getGradientUnits()==="objectBoundingBox",i=e.getBoundingBox(t);if(n&&!i)return null;this.getAttribute("cx").hasValue()||this.getAttribute("cx",!0).setValue("50%"),this.getAttribute("cy").hasValue()||this.getAttribute("cy",!0).setValue("50%"),this.getAttribute("r").hasValue()||this.getAttribute("r",!0).setValue("50%");var s=n?i.x+i.width*this.getAttribute("cx").getNumber():this.getAttribute("cx").getPixels("x"),a=n?i.y+i.height*this.getAttribute("cy").getNumber():this.getAttribute("cy").getPixels("y"),o=s,h=a;this.getAttribute("fx").hasValue()&&(o=n?i.x+i.width*this.getAttribute("fx").getNumber():this.getAttribute("fx").getPixels("x")),this.getAttribute("fy").hasValue()&&(h=n?i.y+i.height*this.getAttribute("fy").getNumber():this.getAttribute("fy").getPixels("y"));var f=n?(i.width+i.height)/2*this.getAttribute("r").getNumber():this.getAttribute("r").getPixels(),g=this.getAttribute("fr").getPixels();return t.createRadialGradient(o,h,g,s,a,f)}}class lO extends yi{constructor(t,e,n){super(t,e,n),this.type="stop";var i=Math.max(0,Math.min(1,this.getAttribute("offset").getNumber())),s=this.getStyle("stop-opacity"),a=this.getStyle("stop-color",!0);a.getString()===""&&a.setValue("#000"),s.hasValue()&&(a=a.addOpacity(s)),this.offset=i,this.color=a.getColor()}}class K1 extends yi{constructor(t,e,n){super(t,e,n),this.type="animate",this.duration=0,this.initialValue=null,this.initialUnits="",this.removed=!1,this.frozen=!1,t.screen.animations.push(this),this.begin=this.getAttribute("begin").getMilliseconds(),this.maxDuration=this.begin+this.getAttribute("dur").getMilliseconds(),this.from=this.getAttribute("from"),this.to=this.getAttribute("to"),this.values=new Dr(t,"values",null);var i=this.getAttribute("values");i.hasValue()&&this.values.setValue(i.getString().split(";"))}getProperty(){var t=this.getAttribute("attributeType").getString(),e=this.getAttribute("attributeName").getString();return t==="CSS"?this.parent.getStyle(e,!0):this.parent.getAttribute(e,!0)}calcValue(){var{initialUnits:t}=this,{progress:e,from:n,to:i}=this.getProgress(),s=n.getNumber()+(i.getNumber()-n.getNumber())*e;return t==="%"&&(s*=100),"".concat(s).concat(t)}update(t){var{parent:e}=this,n=this.getProperty();if(this.initialValue||(this.initialValue=n.getString(),this.initialUnits=n.getUnits()),this.duration>this.maxDuration){var i=this.getAttribute("fill").getString("remove");if(this.getAttribute("repeatCount").getString()==="indefinite"||this.getAttribute("repeatDur").getString()==="indefinite")this.duration=0;else if(i==="freeze"&&!this.frozen)this.frozen=!0,e.animationFrozen=!0,e.animationFrozenValue=n.getString();else if(i==="remove"&&!this.removed)return this.removed=!0,n.setValue(e.animationFrozen?e.animationFrozenValue:this.initialValue),!0;return!1}this.duration+=t;var s=!1;if(this.begin<this.duration){var a=this.calcValue(),o=this.getAttribute("type");if(o.hasValue()){var h=o.getString();a="".concat(h,"(").concat(a,")")}n.setValue(a),s=!0}return s}getProgress(){var{document:t,values:e}=this,n={progress:(this.duration-this.begin)/(this.maxDuration-this.begin)};if(e.hasValue()){var i=n.progress*(e.getValue().length-1),s=Math.floor(i),a=Math.ceil(i);n.from=new Dr(t,"from",parseFloat(e.getValue()[s])),n.to=new Dr(t,"to",parseFloat(e.getValue()[a])),n.progress=(i-s)/(a-s)}else n.from=this.from,n.to=this.to;return n}}class AO extends K1{constructor(){super(...arguments),this.type="animateColor"}calcValue(){var{progress:t,from:e,to:n}=this.getProgress(),i=new YB(e.getColor()),s=new YB(n.getColor());if(i.ok&&s.ok){var a=i.r+(s.r-i.r)*t,o=i.g+(s.g-i.g)*t,h=i.b+(s.b-i.b)*t;return"rgb(".concat(Math.floor(a),", ").concat(Math.floor(o),", ").concat(Math.floor(h),")")}return this.getAttribute("from").getColor()}}class uO extends K1{constructor(){super(...arguments),this.type="animateTransform"}calcValue(){var{progress:t,from:e,to:n}=this.getProgress(),i=da(e.getString()),s=da(n.getString()),a=i.map((o,h)=>{var f=s[h];return o+(f-o)*t}).join(" ");return a}}class hO extends yi{constructor(t,e,n){super(t,e,n),this.type="font",this.glyphs={},this.horizAdvX=this.getAttribute("horiz-adv-x").getNumber();var{definitions:i}=t,{children:s}=this;for(var a of s)switch(a.type){case"font-face":{this.fontFace=a;var o=a.getStyle("font-family");o.hasValue()&&(i[o.getString()]=this);break}case"missing-glyph":this.missingGlyph=a;break;case"glyph":{var h=a;h.arabicForm?(this.isRTL=!0,this.isArabic=!0,typeof this.glyphs[h.unicode]>"u"&&(this.glyphs[h.unicode]={}),this.glyphs[h.unicode][h.arabicForm]=h):this.glyphs[h.unicode]=h;break}}}render(){}}class dO extends yi{constructor(t,e,n){super(t,e,n),this.type="font-face",this.ascent=this.getAttribute("ascent").getNumber(),this.descent=this.getAttribute("descent").getNumber(),this.unitsPerEm=this.getAttribute("units-per-em").getNumber()}}class fO extends Xn{constructor(){super(...arguments),this.type="missing-glyph",this.horizAdvX=0}}class pO extends kA{constructor(){super(...arguments),this.type="tref"}getText(){var t=this.getHrefAttribute().getDefinition();if(t){var e=t.children[0];if(e)return e.getText()}return""}}class gO extends kA{constructor(t,e,n){super(t,e,n),this.type="a";var{childNodes:i}=e,s=i[0],a=i.length>0&&Array.from(i).every(o=>o.nodeType===3);this.hasText=a,this.text=a?this.getTextFromNode(s):""}getText(){return this.text}renderChildren(t){if(this.hasText){super.renderChildren(t);var{document:e,x:n,y:i}=this,{mouse:s}=e.screen,a=new Dr(e,"fontSize",xo.parse(e.ctx.font).fontSize);s.isWorking()&&s.checkBoundingBox(this,new uc(n,i-a.getPixels("y"),n+this.measureText(t),i))}else if(this.children.length>0){var o=new q1(this.document,null);o.children=this.children,o.parent=this,o.render(t)}}onClick(){var{window:t}=this.document;t&&t.open(this.getHrefAttribute().getString())}onMouseMove(){var t=this.document.ctx;t.canvas.style.cursor="pointer"}}function mO(r,t){var e=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),e.push.apply(e,n)}return e}function $1(r){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?mO(Object(e),!0).forEach(function(n){jB(r,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(e)):mO(Object(e)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(e,n))})}return r}class yO extends kA{constructor(t,e,n){super(t,e,n),this.type="textPath",this.textWidth=0,this.textHeight=0,this.pathLength=-1,this.glyphInfo=null,this.letterSpacingCache=[],this.measuresCache=new Map([["",0]]);var i=this.getHrefAttribute().getDefinition();this.text=this.getTextFromNode(),this.dataArray=this.parsePathData(i)}getText(){return this.text}path(t){var{dataArray:e}=this;t&&t.beginPath(),e.forEach(n=>{var{type:i,points:s}=n;switch(i){case ln.LINE_TO:t&&t.lineTo(s[0],s[1]);break;case ln.MOVE_TO:t&&t.moveTo(s[0],s[1]);break;case ln.CURVE_TO:t&&t.bezierCurveTo(s[0],s[1],s[2],s[3],s[4],s[5]);break;case ln.QUAD_TO:t&&t.quadraticCurveTo(s[0],s[1],s[2],s[3]);break;case ln.ARC:{var[a,o,h,f,g,b,C,B]=s,R=h>f?h:f,D=h>f?1:h/f,Q=h>f?f/h:1;t&&(t.translate(a,o),t.rotate(C),t.scale(D,Q),t.arc(0,0,R,g,g+b,!!(1-B)),t.scale(1/D,1/Q),t.rotate(-C),t.translate(-a,-o));break}case ln.CLOSE_PATH:t&&t.closePath();break}})}renderChildren(t){this.setTextData(t),t.save();var e=this.parent.getStyle("text-decoration").getString(),n=this.getFontSize(),{glyphInfo:i}=this,s=t.fillStyle;e==="underline"&&t.beginPath(),i.forEach((a,o)=>{var{p0:h,p1:f,rotation:g,text:b}=a;t.save(),t.translate(h.x,h.y),t.rotate(g),t.fillStyle&&t.fillText(b,0,0),t.strokeStyle&&t.strokeText(b,0,0),t.restore(),e==="underline"&&(o===0&&t.moveTo(h.x,h.y+n/8),t.lineTo(f.x,f.y+n/5))}),e==="underline"&&(t.lineWidth=n/20,t.strokeStyle=s,t.stroke(),t.closePath()),t.restore()}getLetterSpacingAt(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.letterSpacingCache[t]||0}findSegmentToFitChar(t,e,n,i,s,a,o,h,f){var g=a,b=this.measureText(t,h);h===" "&&e==="justify"&&n<i&&(b+=(i-n)/s),f>-1&&(g+=this.getLetterSpacingAt(f));var C=this.textHeight/20,B=this.getEquidistantPointOnPath(g,C,0),R=this.getEquidistantPointOnPath(g+b,C,0),D={p0:B,p1:R},Q=B&&R?Math.atan2(R.y-B.y,R.x-B.x):0;if(o){var k=Math.cos(Math.PI/2+Q)*o,j=Math.cos(-Q)*o;D.p0=$1($1({},B),{},{x:B.x+k,y:B.y+j}),D.p1=$1($1({},R),{},{x:R.x+k,y:R.y+j})}return g+=b,{offset:g,segment:D,rotation:Q}}measureText(t,e){var{measuresCache:n}=this,i=e||this.getText();if(n.has(i))return n.get(i);var s=this.measureTargetText(t,i);return n.set(i,s),s}setTextData(t){if(!this.glyphInfo){var e=this.getText(),n=e.split(""),i=e.split(" ").length-1,s=this.parent.getAttribute("dx").split().map(st=>st.getPixels("x")),a=this.parent.getAttribute("dy").getPixels("y"),o=this.parent.getStyle("text-anchor").getString("start"),h=this.getStyle("letter-spacing"),f=this.parent.getStyle("letter-spacing"),g=0;!h.hasValue()||h.getValue()==="inherit"?g=f.getPixels():h.hasValue()&&h.getValue()!=="initial"&&h.getValue()!=="unset"&&(g=h.getPixels());var b=[],C=e.length;this.letterSpacingCache=b;for(var B=0;B<C;B++)b.push(typeof s[B]<"u"?s[B]:g);var R=b.reduce((st,mt,pt)=>pt===0?0:st+mt||0,0),D=this.measureText(t),Q=Math.max(D+R,0);this.textWidth=D,this.textHeight=this.getFontSize(),this.glyphInfo=[];var k=this.getPathLength(),j=this.getStyle("startOffset").getNumber(0)*k,et=0;(o==="middle"||o==="center")&&(et=-Q/2),(o==="end"||o==="right")&&(et=-Q),et+=j,n.forEach((st,mt)=>{var{offset:pt,segment:yt,rotation:ft}=this.findSegmentToFitChar(t,o,Q,k,i,et,a,st,mt);et=pt,!(!yt.p0||!yt.p1)&&this.glyphInfo.push({text:n[mt],p0:yt.p0,p1:yt.p1,rotation:ft})})}}parsePathData(t){if(this.pathLength=-1,!t)return[];var e=[],{pathParser:n}=t;for(n.reset();!n.isEnd();){var{current:i}=n,s=i?i.x:0,a=i?i.y:0,o=n.next(),h=o.type,f=[];switch(o.type){case ln.MOVE_TO:this.pathM(n,f);break;case ln.LINE_TO:h=this.pathL(n,f);break;case ln.HORIZ_LINE_TO:h=this.pathH(n,f);break;case ln.VERT_LINE_TO:h=this.pathV(n,f);break;case ln.CURVE_TO:this.pathC(n,f);break;case ln.SMOOTH_CURVE_TO:h=this.pathS(n,f);break;case ln.QUAD_TO:this.pathQ(n,f);break;case ln.SMOOTH_QUAD_TO:h=this.pathT(n,f);break;case ln.ARC:f=this.pathA(n);break;case ln.CLOSE_PATH:Xn.pathZ(n);break}o.type!==ln.CLOSE_PATH?e.push({type:h,points:f,start:{x:s,y:a},pathLength:this.calcLength(s,a,h,f)}):e.push({type:ln.CLOSE_PATH,points:[],pathLength:0})}return e}pathM(t,e){var{x:n,y:i}=Xn.pathM(t).point;e.push(n,i)}pathL(t,e){var{x:n,y:i}=Xn.pathL(t).point;return e.push(n,i),ln.LINE_TO}pathH(t,e){var{x:n,y:i}=Xn.pathH(t).point;return e.push(n,i),ln.LINE_TO}pathV(t,e){var{x:n,y:i}=Xn.pathV(t).point;return e.push(n,i),ln.LINE_TO}pathC(t,e){var{point:n,controlPoint:i,currentPoint:s}=Xn.pathC(t);e.push(n.x,n.y,i.x,i.y,s.x,s.y)}pathS(t,e){var{point:n,controlPoint:i,currentPoint:s}=Xn.pathS(t);return e.push(n.x,n.y,i.x,i.y,s.x,s.y),ln.CURVE_TO}pathQ(t,e){var{controlPoint:n,currentPoint:i}=Xn.pathQ(t);e.push(n.x,n.y,i.x,i.y)}pathT(t,e){var{controlPoint:n,currentPoint:i}=Xn.pathT(t);return e.push(n.x,n.y,i.x,i.y),ln.QUAD_TO}pathA(t){var{rX:e,rY:n,sweepFlag:i,xAxisRotation:s,centp:a,a1:o,ad:h}=Xn.pathA(t);return i===0&&h>0&&(h-=2*Math.PI),i===1&&h<0&&(h+=2*Math.PI),[a.x,a.y,e,n,o,h,s,i]}calcLength(t,e,n,i){var s=0,a=null,o=null,h=0;switch(n){case ln.LINE_TO:return this.getLineLength(t,e,i[0],i[1]);case ln.CURVE_TO:for(s=0,a=this.getPointOnCubicBezier(0,t,e,i[0],i[1],i[2],i[3],i[4],i[5]),h=.01;h<=1;h+=.01)o=this.getPointOnCubicBezier(h,t,e,i[0],i[1],i[2],i[3],i[4],i[5]),s+=this.getLineLength(a.x,a.y,o.x,o.y),a=o;return s;case ln.QUAD_TO:for(s=0,a=this.getPointOnQuadraticBezier(0,t,e,i[0],i[1],i[2],i[3]),h=.01;h<=1;h+=.01)o=this.getPointOnQuadraticBezier(h,t,e,i[0],i[1],i[2],i[3]),s+=this.getLineLength(a.x,a.y,o.x,o.y),a=o;return s;case ln.ARC:{s=0;var f=i[4],g=i[5],b=i[4]+g,C=Math.PI/180;if(Math.abs(f-b)<C&&(C=Math.abs(f-b)),a=this.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],f,0),g<0)for(h=f-C;h>b;h-=C)o=this.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],h,0),s+=this.getLineLength(a.x,a.y,o.x,o.y),a=o;else for(h=f+C;h<b;h+=C)o=this.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],h,0),s+=this.getLineLength(a.x,a.y,o.x,o.y),a=o;return o=this.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],b,0),s+=this.getLineLength(a.x,a.y,o.x,o.y),s}}return 0}getPointOnLine(t,e,n,i,s){var a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:e,o=arguments.length>6&&arguments[6]!==void 0?arguments[6]:n,h=(s-n)/(i-e+Kh),f=Math.sqrt(t*t/(1+h*h));i<e&&(f*=-1);var g=h*f,b=null;if(i===e)b={x:a,y:o+g};else if((o-n)/(a-e+Kh)===h)b={x:a+f,y:o+g};else{var C=0,B=0,R=this.getLineLength(e,n,i,s);if(R<Kh)return null;var D=(a-e)*(i-e)+(o-n)*(s-n);D/=R*R,C=e+D*(i-e),B=n+D*(s-n);var Q=this.getLineLength(a,o,C,B),k=Math.sqrt(t*t-Q*Q);f=Math.sqrt(k*k/(1+h*h)),i<e&&(f*=-1),g=h*f,b={x:C+f,y:B+g}}return b}getPointOnPath(t){var e=this.getPathLength(),n=0,i=null;if(t<-5e-5||t-5e-5>e)return null;var{dataArray:s}=this;for(var a of s){if(a&&(a.pathLength<5e-5||n+a.pathLength+5e-5<t)){n+=a.pathLength;continue}var o=t-n,h=0;switch(a.type){case ln.LINE_TO:i=this.getPointOnLine(o,a.start.x,a.start.y,a.points[0],a.points[1],a.start.x,a.start.y);break;case ln.ARC:{var f=a.points[4],g=a.points[5],b=a.points[4]+g;if(h=f+o/a.pathLength*g,g<0&&h<b||g>=0&&h>b)break;i=this.getPointOnEllipticalArc(a.points[0],a.points[1],a.points[2],a.points[3],h,a.points[6]);break}case ln.CURVE_TO:h=o/a.pathLength,h>1&&(h=1),i=this.getPointOnCubicBezier(h,a.start.x,a.start.y,a.points[0],a.points[1],a.points[2],a.points[3],a.points[4],a.points[5]);break;case ln.QUAD_TO:h=o/a.pathLength,h>1&&(h=1),i=this.getPointOnQuadraticBezier(h,a.start.x,a.start.y,a.points[0],a.points[1],a.points[2],a.points[3]);break}if(i)return i;break}return null}getLineLength(t,e,n,i){return Math.sqrt((n-t)*(n-t)+(i-e)*(i-e))}getPathLength(){return this.pathLength===-1&&(this.pathLength=this.dataArray.reduce((t,e)=>e.pathLength>0?t+e.pathLength:t,0)),this.pathLength}getPointOnCubicBezier(t,e,n,i,s,a,o,h,f){var g=h*oC(t)+a*aC(t)+i*cC(t)+e*lC(t),b=f*oC(t)+o*aC(t)+s*cC(t)+n*lC(t);return{x:g,y:b}}getPointOnQuadraticBezier(t,e,n,i,s,a,o){var h=a*AC(t)+i*uC(t)+e*hC(t),f=o*AC(t)+s*uC(t)+n*hC(t);return{x:h,y:f}}getPointOnEllipticalArc(t,e,n,i,s,a){var o=Math.cos(a),h=Math.sin(a),f={x:n*Math.cos(s),y:i*Math.sin(s)};return{x:t+(f.x*o-f.y*h),y:e+(f.x*h+f.y*o)}}buildEquidistantCache(t,e){var n=this.getPathLength(),i=e||.25,s=t||n/100;if(!this.equidistantCache||this.equidistantCache.step!==s||this.equidistantCache.precision!==i){this.equidistantCache={step:s,precision:i,points:[]};for(var a=0,o=0;o<=n;o+=i){var h=this.getPointOnPath(o),f=this.getPointOnPath(o+i);!h||!f||(a+=this.getLineLength(h.x,h.y,f.x,f.y),a>=s&&(this.equidistantCache.points.push({x:h.x,y:h.y,distance:o}),a-=s))}}}getEquidistantPointOnPath(t,e,n){if(this.buildEquidistantCache(e,n),t<0||t-this.getPathLength()>5e-5)return null;var i=Math.round(t/this.getPathLength()*(this.equidistantCache.points.length-1));return this.equidistantCache.points[i]||null}}var e1t=/^\s*data:(([^/,;]+\/[^/,;]+)(?:;([^,;=]+=[^,;=]+))?)?(?:;(base64))?,(.*)$/i;class _O extends Gu{constructor(t,e,n){super(t,e,n),this.type="image",this.loaded=!1;var i=this.getHrefAttribute().getString();if(i){var s=i.endsWith(".svg")||/^\s*data:image\/svg\+xml/i.test(i);t.images.push(this),s?this.loadSvg(i):this.loadImage(i),this.isSvg=s}}loadImage(t){var e=this;return DA(function*(){try{var n=yield e.document.createImage(t);e.image=n}catch(i){console.error('Error while loading image "'.concat(t,'":'),i)}e.loaded=!0})()}loadSvg(t){var e=this;return DA(function*(){var n=e1t.exec(t);if(n){var i=n[5];n[4]==="base64"?e.image=atob(i):e.image=decodeURIComponent(i)}else try{var s=yield e.document.fetch(t),a=yield s.text();e.image=a}catch(o){console.error('Error while loading image "'.concat(t,'":'),o)}e.loaded=!0})()}renderChildren(t){var{document:e,image:n,loaded:i}=this,s=this.getAttribute("x").getPixels("x"),a=this.getAttribute("y").getPixels("y"),o=this.getStyle("width").getPixels("x"),h=this.getStyle("height").getPixels("y");if(!(!i||!n||!o||!h)){if(t.save(),t.translate(s,a),this.isSvg){var f=e.canvg.forkString(t,this.image,{ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0,ignoreClear:!0,offsetX:0,offsetY:0,scaleWidth:o,scaleHeight:h});f.document.documentElement.parent=this,f.render()}else{var g=this.image;e.setViewBox({ctx:t,aspectRatio:this.getAttribute("preserveAspectRatio").getString(),width:o,desiredWidth:g.width,height:h,desiredHeight:g.height}),this.loaded&&(typeof g.complete>"u"||g.complete)&&t.drawImage(g,0,0)}t.restore()}}getBoundingBox(){var t=this.getAttribute("x").getPixels("x"),e=this.getAttribute("y").getPixels("y"),n=this.getStyle("width").getPixels("x"),i=this.getStyle("height").getPixels("y");return new uc(t,e,t+n,e+i)}}class vO extends Gu{constructor(){super(...arguments),this.type="symbol"}render(t){}}class bO{constructor(t){this.document=t,this.loaded=!1,t.fonts.push(this)}load(t,e){var n=this;return DA(function*(){try{var{document:i}=n,s=yield i.canvg.parser.load(e),a=s.getElementsByTagName("font");Array.from(a).forEach(o=>{var h=i.createElement(o);i.definitions[t]=h})}catch(o){console.error('Error while loading font "'.concat(e,'":'),o)}n.loaded=!0})()}}class _C extends yi{constructor(t,e,n){super(t,e,n),this.type="style";var i=jh(Array.from(e.childNodes).map(a=>a.textContent).join("").replace(/(\/\*([^*]|[\r\n]|(\*+([^*/]|[\r\n])))*\*+\/)|(^[\s]*\/\/.*)/gm,"").replace(/@import.*;/g,"")),s=i.split("}");s.forEach(a=>{var o=a.trim();if(o){var h=o.split("{"),f=h[0].split(","),g=h[1].split(";");f.forEach(b=>{var C=b.trim();if(C){var B=t.styles[C]||{};if(g.forEach(Q=>{var k=Q.indexOf(":"),j=Q.substr(0,k).trim(),et=Q.substr(k+1,Q.length-k).trim();j&&et&&(B[j]=new Dr(t,j,et))}),t.styles[C]=B,t.stylesSpecificity[C]=GD(C),C==="@font-face"){var R=B["font-family"].getString().replace(/"|'/g,""),D=B.src.getString().split(",");D.forEach(Q=>{if(Q.indexOf('format("svg")')>0){var k=nC(Q);k&&new bO(t).load(R,k)}})}}})}})}}_C.parseExternalUrl=nC;class wO extends Gu{constructor(){super(...arguments),this.type="use"}setContext(t){super.setContext(t);var e=this.getAttribute("x"),n=this.getAttribute("y");e.hasValue()&&t.translate(e.getPixels("x"),0),n.hasValue()&&t.translate(0,n.getPixels("y"))}path(t){var{element:e}=this;e&&e.path(t)}renderChildren(t){var{document:e,element:n}=this;if(n){var i=n;if(n.type==="symbol"&&(i=new Hf(e,null),i.attributes.viewBox=new Dr(e,"viewBox",n.getAttribute("viewBox").getString()),i.attributes.preserveAspectRatio=new Dr(e,"preserveAspectRatio",n.getAttribute("preserveAspectRatio").getString()),i.attributes.overflow=new Dr(e,"overflow",n.getAttribute("overflow").getString()),i.children=n.children,n.styles.opacity=new Dr(e,"opacity",this.calculateOpacity())),i.type==="svg"){var s=this.getStyle("width",!1,!0),a=this.getStyle("height",!1,!0);s.hasValue()&&(i.attributes.width=new Dr(e,"width",s.getString())),a.hasValue()&&(i.attributes.height=new Dr(e,"height",a.getString()))}var o=i.parent;i.parent=this,i.render(t),i.parent=o}}getBoundingBox(t){var{element:e}=this;return e?e.getBoundingBox(t):null}elementTransform(){var{document:t,element:e}=this;return Hu.fromElement(t,e)}get element(){return this.cachedElement||(this.cachedElement=this.getHrefAttribute().getDefinition()),this.cachedElement}}function W1(r,t,e,n,i,s){return r[e*n*4+t*4+s]}function X1(r,t,e,n,i,s,a){r[e*n*4+t*4+s]=a}function fs(r,t,e){var n=r[t];return n*e}function QA(r,t,e,n){return t+Math.cos(r)*e+Math.sin(r)*n}class vC extends yi{constructor(t,e,n){super(t,e,n),this.type="feColorMatrix";var i=da(this.getAttribute("values").getString());switch(this.getAttribute("type").getString("matrix")){case"saturate":{var s=i[0];i=[.213+.787*s,.715-.715*s,.072-.072*s,0,0,.213-.213*s,.715+.285*s,.072-.072*s,0,0,.213-.213*s,.715-.715*s,.072+.928*s,0,0,0,0,0,1,0,0,0,0,0,1];break}case"hueRotate":{var a=i[0]*Math.PI/180;i=[QA(a,.213,.787,-.213),QA(a,.715,-.715,-.715),QA(a,.072,-.072,.928),0,0,QA(a,.213,-.213,.143),QA(a,.715,.285,.14),QA(a,.072,-.072,-.283),0,0,QA(a,.213,-.213,-.787),QA(a,.715,-.715,.715),QA(a,.072,.928,.072),0,0,0,0,0,1,0,0,0,0,0,1];break}case"luminanceToAlpha":i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.2125,.7154,.0721,0,0,0,0,0,0,1];break}this.matrix=i,this.includeOpacity=this.getAttribute("includeOpacity").hasValue()}apply(t,e,n,i,s){for(var{includeOpacity:a,matrix:o}=this,h=t.getImageData(0,0,i,s),f=0;f<s;f++)for(var g=0;g<i;g++){var b=W1(h.data,g,f,i,s,0),C=W1(h.data,g,f,i,s,1),B=W1(h.data,g,f,i,s,2),R=W1(h.data,g,f,i,s,3),D=fs(o,0,b)+fs(o,1,C)+fs(o,2,B)+fs(o,3,R)+fs(o,4,1),Q=fs(o,5,b)+fs(o,6,C)+fs(o,7,B)+fs(o,8,R)+fs(o,9,1),k=fs(o,10,b)+fs(o,11,C)+fs(o,12,B)+fs(o,13,R)+fs(o,14,1),j=fs(o,15,b)+fs(o,16,C)+fs(o,17,B)+fs(o,18,R)+fs(o,19,1);a&&(D=0,Q=0,k=0,j*=R/255),X1(h.data,g,f,i,s,0,D),X1(h.data,g,f,i,s,1,Q),X1(h.data,g,f,i,s,2,k),X1(h.data,g,f,i,s,3,j)}t.clearRect(0,0,i,s),t.putImageData(h,0,0)}}class Yg extends yi{constructor(){super(...arguments),this.type="mask"}apply(t,e){var{document:n}=this,i=this.getAttribute("x").getPixels("x"),s=this.getAttribute("y").getPixels("y"),a=this.getStyle("width").getPixels("x"),o=this.getStyle("height").getPixels("y");if(!a&&!o){var h=new uc;this.children.forEach(R=>{h.addBoundingBox(R.getBoundingBox(t))}),i=Math.floor(h.x1),s=Math.floor(h.y1),a=Math.floor(h.width),o=Math.floor(h.height)}var f=this.removeStyles(e,Yg.ignoreStyles),g=n.createCanvas(i+a,s+o),b=g.getContext("2d");n.screen.setDefaults(b),this.renderChildren(b),new vC(n,{nodeType:1,childNodes:[],attributes:[{nodeName:"type",value:"luminanceToAlpha"},{nodeName:"includeOpacity",value:"true"}]}).apply(b,0,0,i+a,s+o);var C=n.createCanvas(i+a,s+o),B=C.getContext("2d");n.screen.setDefaults(B),e.render(B),B.globalCompositeOperation="destination-in",B.fillStyle=b.createPattern(g,"no-repeat"),B.fillRect(0,0,i+a,s+o),t.fillStyle=B.createPattern(C,"no-repeat"),t.fillRect(0,0,i+a,s+o),this.restoreStyles(e,f)}render(t){}}Yg.ignoreStyles=["mask","transform","clip-path"];var xO=()=>{};class BO extends yi{constructor(){super(...arguments),this.type="clipPath"}apply(t){var{document:e}=this,n=Reflect.getPrototypeOf(t),{beginPath:i,closePath:s}=t;n&&(n.beginPath=xO,n.closePath=xO),Reflect.apply(i,t,[]),this.children.forEach(a=>{if(!(typeof a.path>"u")){var o=typeof a.elementTransform<"u"?a.elementTransform():null;o||(o=Hu.fromElement(e,a)),o&&o.apply(t),a.path(t),n&&(n.closePath=s),o&&o.unapply(t)}}),Reflect.apply(s,t,[]),t.clip(),n&&(n.beginPath=i,n.closePath=s)}render(t){}}class Zg extends yi{constructor(){super(...arguments),this.type="filter"}apply(t,e){var{document:n,children:i}=this,s=e.getBoundingBox(t);if(s){var a=0,o=0;i.forEach(k=>{var j=k.extraFilterDistance||0;a=Math.max(a,j),o=Math.max(o,j)});var h=Math.floor(s.width),f=Math.floor(s.height),g=h+2*a,b=f+2*o;if(!(g<1||b<1)){var C=Math.floor(s.x),B=Math.floor(s.y),R=this.removeStyles(e,Zg.ignoreStyles),D=n.createCanvas(g,b),Q=D.getContext("2d");n.screen.setDefaults(Q),Q.translate(-C+a,-B+o),e.render(Q),i.forEach(k=>{typeof k.apply=="function"&&k.apply(Q,0,0,g,b)}),t.drawImage(D,0,0,g,b,C-a,B-o,g,b),this.restoreStyles(e,R)}}}render(t){}}Zg.ignoreStyles=["filter","transform","clip-path"];class CO extends yi{constructor(t,e,n){super(t,e,n),this.type="feDropShadow",this.addStylesFromStyleDefinition()}apply(t,e,n,i,s){}}class EO extends yi{constructor(){super(...arguments),this.type="feMorphology"}apply(t,e,n,i,s){}}class SO extends yi{constructor(){super(...arguments),this.type="feComposite"}apply(t,e,n,i,s){}}class TO extends yi{constructor(t,e,n){super(t,e,n),this.type="feGaussianBlur",this.blurRadius=Math.floor(this.getAttribute("stdDeviation").getNumber()),this.extraFilterDistance=this.blurRadius}apply(t,e,n,i,s){var{document:a,blurRadius:o}=this,h=a.window?a.window.document.body:null,f=t.canvas;f.id=a.getUniqueId(),h&&(f.style.display="none",h.appendChild(f)),Pyt(f,e,n,i,s,o),h&&h.removeChild(f)}}class IO extends yi{constructor(){super(...arguments),this.type="title"}}class LO extends yi{constructor(){super(...arguments),this.type="desc"}}var r1t={svg:Hf,rect:gC,circle:tO,ellipse:eO,line:rO,polyline:mC,polygon:nO,path:Xn,pattern:iO,marker:sO,defs:oO,linearGradient:aO,radialGradient:cO,stop:lO,animate:K1,animateColor:AO,animateTransform:uO,font:hO,"font-face":dO,"missing-glyph":fO,glyph:pC,text:kA,tspan:Jg,tref:pO,a:gO,textPath:yO,image:_O,g:q1,symbol:vO,style:_C,use:wO,mask:Yg,clipPath:BO,filter:Zg,feDropShadow:CO,feMorphology:EO,feComposite:SO,feColorMatrix:vC,feGaussianBlur:TO,title:IO,desc:LO};function FO(r,t){var e=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),e.push.apply(e,n)}return e}function n1t(r){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?FO(Object(e),!0).forEach(function(n){jB(r,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(e)):FO(Object(e)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(e,n))})}return r}function i1t(r,t){var e=document.createElement("canvas");return e.width=r,e.height=t,e}function s1t(r){return bC.apply(this,arguments)}function bC(){return bC=DA(function*(r){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,e=document.createElement("img");return t&&(e.crossOrigin="Anonymous"),new Promise((n,i)=>{e.onload=()=>{n(e)},e.onerror=(s,a,o,h,f)=>{i(f)},e.src=r})}),bC.apply(this,arguments)}class zA{constructor(t){var{rootEmSize:e=12,emSize:n=12,createCanvas:i=zA.createCanvas,createImage:s=zA.createImage,anonymousCrossOrigin:a}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.canvg=t,this.definitions={},this.styles={},this.stylesSpecificity={},this.images=[],this.fonts=[],this.emSizeStack=[],this.uniqueId=0,this.screen=t.screen,this.rootEmSize=e,this.emSize=n,this.createCanvas=i,this.createImage=this.bindCreateImage(s,a),this.screen.wait(this.isImagesLoaded.bind(this)),this.screen.wait(this.isFontsLoaded.bind(this))}bindCreateImage(t,e){return typeof e=="boolean"?(n,i)=>t(n,typeof i=="boolean"?i:e):t}get window(){return this.screen.window}get fetch(){return this.screen.fetch}get ctx(){return this.screen.ctx}get emSize(){var{emSizeStack:t}=this;return t[t.length-1]}set emSize(t){var{emSizeStack:e}=this;e.push(t)}popEmSize(){var{emSizeStack:t}=this;t.pop()}getUniqueId(){return"canvg".concat(++this.uniqueId)}isImagesLoaded(){return this.images.every(t=>t.loaded)}isFontsLoaded(){return this.fonts.every(t=>t.loaded)}createDocumentElement(t){var e=this.createElement(t.documentElement);return e.root=!0,e.addStylesFromStyleDefinition(),this.documentElement=e,e}createElement(t){var e=t.nodeName.replace(/^[^:]+:/,""),n=zA.elementTypes[e];return typeof n<"u"?new n(this,t):new ZD(this,t)}createTextNode(t){return new t1t(this,t)}setViewBox(t){this.screen.setViewBox(n1t({document:this},t))}}zA.createCanvas=i1t,zA.createImage=s1t,zA.elementTypes=r1t;function MO(r,t){var e=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),e.push.apply(e,n)}return e}function $h(r){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?MO(Object(e),!0).forEach(function(n){jB(r,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(e)):MO(Object(e)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(e,n))})}return r}class Wh{constructor(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.parser=new j1(n),this.screen=new Xg(t,n),this.options=n;var i=new zA(this,n),s=i.createDocumentElement(e);this.document=i,this.documentElement=s}static from(t,e){var n=arguments;return DA(function*(){var i=n.length>2&&n[2]!==void 0?n[2]:{},s=new j1(i),a=yield s.parse(e);return new Wh(t,a,i)})()}static fromString(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=new j1(n),s=i.parseFromString(e);return new Wh(t,s,n)}fork(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return Wh.from(t,e,$h($h({},this.options),n))}forkString(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return Wh.fromString(t,e,$h($h({},this.options),n))}ready(){return this.screen.ready()}isReady(){return this.screen.isReady()}render(){var t=arguments,e=this;return DA(function*(){var n=t.length>0&&t[0]!==void 0?t[0]:{};e.start($h({enableRedraw:!0,ignoreAnimation:!0,ignoreMouse:!0},n)),yield e.ready(),e.stop()})()}start(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{documentElement:e,screen:n,options:i}=this;n.start(e,$h($h({enableRedraw:!0},i),t))}stop(){this.screen.stop()}resize(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;this.documentElement.resize(t,e,n)}}const o1t=Object.freeze(Object.defineProperty({__proto__:null,AElement:gO,AnimateColorElement:AO,AnimateElement:K1,AnimateTransformElement:uO,BoundingBox:uc,CB1:oC,CB2:aC,CB3:cC,CB4:lC,Canvg:Wh,CircleElement:tO,ClipPathElement:BO,DefsElement:oO,DescElement:LO,Document:zA,Element:yi,EllipseElement:eO,FeColorMatrixElement:vC,FeCompositeElement:SO,FeDropShadowElement:CO,FeGaussianBlurElement:TO,FeMorphologyElement:EO,FilterElement:Zg,Font:xo,FontElement:hO,FontFaceElement:dO,GElement:q1,GlyphElement:pC,GradientElement:yC,ImageElement:_O,LineElement:rO,LinearGradientElement:aO,MarkerElement:sO,MaskElement:Yg,Matrix:dC,MissingGlyphElement:fO,Mouse:jD,PSEUDO_ZERO:Kh,Parser:j1,PathElement:Xn,PathParser:ln,PatternElement:iO,Point:Hi,PolygonElement:nO,PolylineElement:mC,Property:Dr,QB1:AC,QB2:uC,QB3:hC,RadialGradientElement:cO,RectElement:gC,RenderedElement:Gu,Rotate:WD,SVGElement:Hf,SVGFontLoader:bO,Scale:XD,Screen:Xg,Skew:fC,SkewX:JD,SkewY:YD,StopElement:lO,StyleElement:_C,SymbolElement:vO,TRefElement:pO,TSpanElement:Jg,TextElement:kA,TextPathElement:yO,TitleElement:IO,Transform:Hu,Translate:$D,UnknownElement:ZD,UseElement:wO,ViewPort:VD,compressSpaces:jh,default:Wh,getSelectorSpecificity:GD,normalizeAttributeName:zD,normalizeColor:HD,parseExternalUrl:nC,presets:Oyt,toNumbers:da,trimLeft:kD,trimRight:QD,vectorMagnitude:iC,vectorsAngle:sC,vectorsRatio:V1},Symbol.toStringTag,{value:"Module"}));xl.CompareMaps=srt,xl.Layers=vo,xl.Map=Zet,xl.Styles=uf,xl.Terrains=ry,Object.defineProperty(xl,Symbol.toStringTag,{value:"Module"})});
